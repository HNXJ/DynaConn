function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-4.579783093371835e-03   -5.439753125571341e-02   +2.365213285313783e-02   -1.422627045821861e-02   -3.585997129076457e-02   -2.974618646555370e-02   +6.898576555808784e-03   -5.508011023411925e-02   +1.025344553687200e-02   -2.244101252798805e-02   +2.453372001431704e-02   -3.780030335286573e-03   +1.819691111524142e-02   -4.088339552220755e-02   +1.711215381604228e-02   +1.901849933272446e-02; -6.479969651798231e-02   +3.341503497409982e-02   +1.000667718870056e-02   +5.051640300691382e-02   -4.479046988479050e-02   +2.500550358972488e-02   +3.817775492446963e-02   +2.835299725362110e-03   -5.104152979124131e-02   -3.638837471696299e-02   -2.936389363676991e-02   +5.917789834389522e-02   +1.684558621845336e-02   -1.225752433557562e-02   -7.205442614881867e-02   +5.220444512940678e-02; +1.875709708296598e-02   -1.737607508121258e-02   +2.680601943583061e-02   +1.093620192988523e-01   -4.015289041516177e-03   -2.684356837040085e-02   -9.426814739554723e-02   -5.411219496182122e-02   -9.824414277803004e-02   +2.289866132317476e-02   +4.072762993757193e-02   +6.118947890438338e-03   +1.035423093634679e-01   -8.787370594076074e-02   +8.539271639681664e-02   -6.573043174681785e-03; -5.238078570086842e-02   -5.101960241713532e-02   +7.522167037289459e-03   +2.222290435719931e-02   -3.373524057705110e-02   -2.264751819149145e-02   -1.587799626049578e-03   +6.853787382284567e-03   -1.398036245625631e-01   -1.202470950029396e-01   +7.476537247902984e-02   +2.934407796083629e-02   +4.593286336808020e-02   +7.488012782136431e-02   +2.335191922142684e-02   -3.149452107138632e-03; -1.489306260479693e-02   -2.944921696782810e-02   -1.319252358441032e-02   -1.634629486255908e-02   -1.011780810344051e-01   +2.229078268482167e-02   +2.615279029332198e-02   +3.774951181648993e-02   +2.213496345378325e-02   -6.281798360722303e-02   +5.193724193618302e-02   +5.294905755973633e-02   +2.007757121038845e-02   +6.607538229133010e-02   -2.585215020409468e-02   -4.764404833177802e-02; -1.020644054023293e-01   +2.388316292070956e-02   +9.532586329755198e-02   -6.642688357754936e-02   -1.304838012268680e-02   +3.870169973271968e-02   +3.013494209809930e-02   +3.073881570281164e-02   -2.039382542486384e-02   +2.666883323879300e-02   -6.784808215382528e-04   -9.297048129228505e-04   +7.252057270839843e-02   -5.192209036019486e-03   -9.888078102052239e-02   +3.879910770488347e-02; +2.723430377252281e-02   +8.163007895130492e-02   -7.124947703827421e-02   -9.591392000687865e-02   -4.827412970369911e-02   -3.225127416213788e-02   +2.532005923044091e-02   -4.974088067486346e-02   +3.448010869677753e-02   -5.057272180930406e-02   +3.978756948548822e-02   +8.260488846412107e-03   +1.013234256178719e-01   -4.823050144821654e-02   +8.280400344171543e-02   +5.088790241743654e-02; -2.172198151173840e-02   +8.540761490037446e-02   +9.968032991806659e-02   -1.040042898504370e-01   -7.444398080853436e-02   -2.993185000455788e-02   +1.070052826948045e-01   +6.263759962162925e-02   -7.606163093722494e-02   -1.155218128857482e-02   +1.026234726410331e-01   -4.153624473661064e-02   +5.720342184398786e-02   +6.240462189909922e-03   +5.905624918148714e-02   -3.436568977623988e-02; -3.837462436376392e-02   -2.805441675227278e-02   +1.092132583773605e-01   +3.807358770655664e-02   -6.131482774459205e-02   +6.011830639145851e-02   +4.779579103002483e-02   -1.399577559956428e-02   -9.374927345917017e-02   +3.720668154566862e-02   +6.457545555456670e-02   -5.979880962835222e-02   +6.921627661318619e-02   +1.211745036331953e-01   -6.117529190357553e-02   +1.087437574506509e-02; +4.493164566515158e-02   -5.234387872534442e-02   -4.117061093065894e-03   +7.438886172132875e-02   +1.041880415758865e-01   +1.452183141289146e-02   -1.216521385207449e-03   -3.358598955750219e-02   +6.295367396345750e-02   +2.923240623714208e-02   -9.077130351701792e-03   +1.626848208978421e-02   +2.351086762101021e-02   +8.401816867149106e-02   -7.462642445788600e-02   -7.920118966492058e-02; +3.513624499200792e-02   +2.187326505722542e-02   -3.696755061065003e-02   -4.649822717261880e-02   +1.980462151465176e-02   +1.245083684927213e-01   -1.100643979239737e-02   -4.368255952903107e-02   +4.975348239061918e-02   -2.736530225607179e-02   -1.157960665996667e-02   -4.319359264226964e-02   -8.178479229488871e-02   -5.959159371272557e-02   -6.358849761801152e-02   -7.215923057317374e-03; -7.036205007890184e-03   -4.369632611863077e-02   -2.934691052302909e-02   +3.698245409016705e-02   -7.280796208819940e-02   -4.158638748147450e-02   +1.443098752347424e-02   +2.201216375404181e-02   -8.089631891000235e-02   +6.073714682327781e-02   -2.223976199208444e-03   -5.983349485995073e-03   -1.990913631358787e-02   -1.602885058754193e-03   +4.374460122841461e-02   +5.587156339803474e-02; -1.334246227948544e-03   -7.258184611747726e-02   +3.029657694728516e-02   +1.481781814733559e-02   +4.710766855319416e-02   -2.625313660840604e-02   +1.951672776813672e-02   -4.089186054873344e-02   +5.486329099653357e-02   -2.708887332089698e-02   +5.103794329072500e-04   +1.086198887825379e-01   -7.488994513480351e-03   +8.100323125733026e-02   +5.478339183090175e-03   -3.167647143614865e-02; +3.281776075018402e-02   -1.592831437078199e-02   -1.573293888776084e-02   +1.018817930604030e-02   +7.269981961059796e-02   -7.916826987829254e-02   +7.569588200472305e-02   +4.431345287772160e-02   +5.712161574845247e-02   +1.875079710510276e-02   -8.465051345715573e-02   -2.057364407099079e-02   -5.313884782922283e-02   -3.178465962405801e-02   +4.495345416719553e-02   -1.088577181580389e-02; -5.592971087960033e-02   +2.544595583067841e-02   +2.576062615508711e-03   +5.023648979502900e-02   +2.564663240632600e-02   -1.048039017233846e-01   +4.477622886080111e-02   +1.494263781138412e-02   -9.816772932821592e-03   +2.784059500021105e-02   +5.748329180371915e-02   +9.137602847465735e-03   +2.414842761788601e-02   -5.230961804221516e-02   -5.924539304892509e-02   -1.509848184644496e-01; -6.452706661059857e-02   +4.701628721041502e-02   +6.106712007505710e-02   -2.024683812709289e-02   -9.028936795576098e-02   -5.652165205809776e-02   -3.038757729916731e-02   -1.325398868372772e-01   -3.562090762048535e-02   -1.360584117798623e-02   -4.999635306302098e-02   -5.600024996828906e-03   -1.660558491178462e-02   -7.356461105880962e-03   -3.158085577799122e-03   +9.206869611137072e-02];
L1E_L1I_iGABA_netcon = [-6.066264749114483e-02   +2.998127624483565e-02   -5.199368207331118e-02   +8.940897252883301e-02   -2.989707011335475e-02   -4.661766466200580e-02   -8.348976444009573e-02   -2.792538833520788e-03   +8.593185032863140e-02   -1.167673995538442e-02   +1.127062211568184e-02   -8.941947571343598e-02   +4.550752339227393e-02   -2.506884936984763e-02   -8.125254874589083e-02   -5.516344112299272e-02; +3.515144768826502e-02   -6.331347829086771e-02   -2.983827992042621e-02   +2.769957305384292e-02   +1.281103695904190e-01   -9.504570381996781e-02   -1.124910886262087e-01   -5.275870818565723e-02   +7.899083571426449e-02   -4.287128870718723e-02   -1.240898434175609e-02   +6.300294847560176e-02   +4.168971561769583e-02   +2.121678840086344e-02   -4.634136921742624e-02   -2.376083508346067e-02; +2.031401873810354e-02   +5.467629040873842e-02   -1.469927991057688e-02   +4.639082454279173e-02   -1.107570730804751e-01   +2.572358795537273e-02   -4.037480496723223e-02   +6.468418608933935e-02   -5.875480509837253e-02   -8.610568433252409e-02   +9.951955044606413e-02   -1.047800428661473e-01   +1.691820410030542e-02   -2.941023784605603e-02   +7.012069640250479e-02   +5.872435233460009e-02; -1.382337157791470e-02   -2.808477424846504e-02   +1.258539572991148e-02   -1.733770392474781e-02   +1.230000263002788e-02   +2.312340390854644e-02   -6.601427005850435e-03   +5.169263178280427e-02   -4.988300784346383e-02   -5.168020445380121e-03   +9.290450242314600e-02   -1.956007267436694e-02   -7.483115873225003e-02   -4.206140019258100e-02   +3.502572793081130e-02   -5.071059088023869e-02; -1.369314170995551e-01   +3.150495918931479e-02   -2.849360946199942e-02   +1.156680886977438e-02   -6.032836276783880e-04   -3.057304408655703e-02   +9.407209003580011e-02   +1.206417921162625e-01   +1.243860437898675e-01   +3.996361741214016e-02   -2.477430836171887e-02   -3.471440524737239e-02   +7.608710720349786e-02   +6.664833143931553e-02   -4.106526475288619e-02   +4.492514622832710e-02; +5.498225421681266e-02   +1.906575397726816e-02   +3.846218843330888e-02   +2.079783486303787e-02   -4.994946305686834e-03   -3.840851635683293e-02   +5.935430778177864e-02   -5.182428189539531e-02   -4.114179840000138e-02   -8.056651020068875e-02   +2.535581187281121e-03   +3.819663282263407e-04   +4.279130316061249e-02   +5.356399162748369e-02   +7.033143021780207e-02   -3.963549305942449e-02; -3.811283231244673e-02   -1.912846077962294e-02   -1.010500108604365e-01   +7.965339129817202e-02   -1.065623967648413e-01   +1.797896150702875e-01   +2.079707690939846e-02   +5.502349395372293e-02   -7.240340457563738e-03   +2.700137384990017e-02   +3.664031973624982e-02   -2.186937258275909e-02   +3.244883502024001e-02   -7.578556526791760e-02   -6.823482633066590e-02   +6.540136705802901e-02; +3.318072502396963e-02   -3.979638285722299e-02   -3.575222683920359e-02   -2.462681873291695e-02   -5.595536765715729e-02   -9.639956714366218e-02   -3.678881251415442e-03   +1.226329655623377e-01   -3.663385456076266e-02   -2.555730070914001e-02   +1.986431103224683e-02   +2.197783623696167e-02   -2.909264128062039e-02   +9.790878994487655e-03   +4.500847048876909e-02   +1.265377134894483e-01; -2.438276400225619e-02   -4.995067520443669e-02   +7.693394867809653e-02   +3.507073636906153e-02   +5.686699692237563e-02   -5.879305170605249e-02   +2.759926695348941e-02   -1.389232176565862e-02   -4.672622005357246e-02   -4.977947304858761e-02   -1.517629894543799e-02   +2.833527569936212e-02   +1.002946162631290e-02   +6.466393228813486e-02   +1.769968609776341e-02   +6.521835713242904e-02; -6.374360931295016e-02   -1.699417664575037e-02   -5.109282304020652e-02   +1.481281913871198e-01   -5.954896886668212e-02   +7.593165029720705e-02   -3.532110815005888e-02   +3.326955401849565e-02   -4.226919010916518e-02   -2.901054213388399e-03   -8.555465735137759e-02   -3.718863750087296e-02   -5.964599326893100e-03   +7.447331015743759e-02   -1.463420408292003e-02   -6.147566879735288e-02; -9.783305147820082e-02   -8.250700289736264e-02   -2.090194227265810e-02   -9.963648962820247e-02   -4.356726223242349e-02   -1.090552759826396e-01   +8.833447710571499e-05   -8.912574786253877e-02   +2.240764407296986e-02   -3.859387289735697e-02   -3.947388152123284e-02   -4.730095761995033e-02   +1.359761757078129e-02   +7.465523301653425e-02   -7.279707438888042e-02   -4.368903417091453e-02; -2.656348091562222e-02   +1.019987462567784e-01   -2.018326661258876e-02   -6.963024904967542e-02   -7.666945022641992e-03   -4.089370462142109e-02   -6.228352620782684e-02   -5.857239188488692e-02   +1.098214579661364e-01   -5.653963577986820e-03   -6.497588997584801e-02   -2.014888258656522e-02   +5.165325153117000e-02   -5.304495086996358e-02   -4.939074182734673e-02   +2.601940036952604e-02; +3.611542040529003e-02   +1.685264106116682e-02   -1.823212862262361e-02   +2.250435607045374e-02   +1.147514285377746e-02   +1.123409812128939e-01   -7.423262180913424e-02   +2.206187836822459e-02   -8.353820223308837e-02   -3.216506141395268e-02   -1.720356286955814e-02   +2.055759274776646e-02   -7.564624771246109e-02   -4.087136962715320e-02   -7.227624085203171e-02   -7.762269152574797e-03; +2.444989867438506e-02   -5.019628567907412e-02   -7.142343520833636e-03   +3.994696939419250e-02   -4.733275814281734e-02   -8.728798109967448e-03   -1.244669084722665e-02   -6.743265804161773e-02   +5.696022784180375e-02   -8.763796373606161e-03   -9.567487136505266e-02   +5.765955050462472e-02   +1.355480401206249e-02   -2.739761202664851e-02   +5.923930395303582e-03   +9.442467892389692e-02; -8.887035265305319e-02   -6.563108196204007e-02   -4.313327563204766e-02   +2.569248392825447e-02   +8.468960394997099e-03   +3.497822866672136e-02   +8.788453301934002e-02   -6.106613986782904e-02   +6.572924953927940e-02   +4.352117453255045e-02   -1.300008454470112e-02   -2.796910907573536e-02   +5.627161071748635e-02   -6.247679988992864e-02   -2.261012149108684e-02   -1.238590460214624e-01; +5.246584698664403e-02   +1.266342695510272e-01   +8.687437445666923e-02   -9.093914082608277e-02   +3.515274955768479e-02   -7.341103250811237e-02   -2.583276147201950e-02   -1.345307363735444e-02   -5.915335950890047e-02   +1.587652689263075e-02   -4.154962632617049e-02   -5.479872475136854e-02   -2.407098699103404e-04   +8.482611092469044e-03   -6.091345180507468e-02   -1.269340437701824e-02];
L2I_L1I_iGABA_netcon = [-5.765124184272668e-02   -1.304899004673112e-02   -4.567424988683608e-03   -6.596747323703059e-02   -5.597996673060355e-02   -2.881465850709088e-02   +4.818828494935971e-02   -4.416860188251068e-02; -6.390800660280918e-02   -2.351368056109242e-02   -1.164728162677579e-02   -1.481270171331739e-02   -7.236849306297768e-03   -2.594059013380460e-02   +3.091428726758700e-02   +2.323850428668289e-02; -3.991580631571871e-02   +4.737293849865001e-02   -1.175875393987786e-01   +3.053663081366195e-02   +1.559146326171268e-01   -8.833547168903236e-02   -3.337104565751065e-02   -9.656635392416023e-02; -2.603004892135218e-02   +5.639261149561651e-02   -1.698401198726068e-01   -1.841813513478038e-02   -2.041604897416250e-02   +3.470273431794251e-02   +1.176917363961222e-03   +4.120494526469641e-03; -4.374220208278065e-02   -5.050563574135289e-02   -3.153188151825909e-02   +7.012069529165949e-02   +8.490315248123441e-02   -1.185233942025816e-03   -4.218138165363437e-02   +4.949380351446955e-02; +2.305170471841830e-02   +1.232773854450273e-02   +4.234887084455400e-02   +1.381198399320622e-02   +1.034471903586469e-01   +1.665511234860179e-02   -6.316786914098818e-02   -1.749851262669740e-02; -5.176247981026820e-02   +1.083586571584585e-01   -8.869375176226926e-02   +4.624156376910383e-02   +2.118331117081109e-02   +1.587467148922387e-02   +4.606768954394760e-02   +6.845971653185434e-02; -1.750369039963220e-02   -3.595149308547262e-02   -5.683745474132914e-02   +5.796151035170670e-02   +7.953865011036576e-02   +6.117873788698508e-02   -2.556102288845249e-02   +5.060169759340558e-02; -7.777369202292413e-02   -6.439335060795726e-02   +1.092852020099564e-01   +7.306207258102750e-02   -3.741069258916887e-02   +5.116476273441470e-02   +8.997139338385500e-02   +8.254258421288194e-02; +2.918356171573853e-03   -6.168249859712061e-02   +7.718606577482301e-04   -4.897276195666914e-02   -6.121586856514482e-02   +8.532757407836183e-02   +4.155747922992394e-02   -4.717058431650819e-02; -8.385556773193020e-02   +8.739730770626752e-02   +1.073882951362874e-02   +1.001715058526424e-01   -9.536999383659069e-02   -6.731728634656915e-02   +3.165069609057910e-02   +3.506553528857915e-02; +6.421881538915068e-02   -2.168275880472467e-03   -3.253705438165243e-02   +1.225204815538820e-02   -3.398232437190696e-02   +3.600004441675148e-02   -1.413756652024052e-02   +8.897228263045176e-02; +1.198494308735538e-02   +3.389192199726700e-02   -4.194810616426786e-02   +4.125945430574606e-04   +2.751708988575117e-02   +1.178687862140538e-01   -1.527990307363673e-03   +1.315846745240618e-02; +1.133684908229420e-01   -2.162326261181663e-02   +4.356640781838844e-02   +1.162012409500060e-01   -4.081111189187864e-02   +7.424177833913667e-02   -3.165425454870838e-02   +2.673531668596098e-02; -2.491484539233092e-02   -1.110642240498917e-01   +5.497600091200758e-02   -7.656252252711057e-02   +2.263852374742908e-02   +2.108145583622578e-02   -7.476541852073249e-02   -1.304182930538682e-02; -8.033940045333401e-02   -8.129639454988820e-03   -7.410558502193813e-02   -5.558129480587308e-02   -4.170852094435781e-04   -1.460314212108948e-02   -3.119392272412951e-02   -3.789261974827089e-02];
L1I_L2I_iGABA_netcon = [-3.045108792771141e-02   -2.381950077883580e-02   +1.696405894465386e-02   +8.352742693315080e-03   -8.416585183337100e-02   +9.100586340130210e-03   +1.139091438174902e-02   +1.063488595733991e-01   +7.246808963027630e-02   -5.962046554227635e-03   -3.871868602037341e-04   -3.125435221915239e-03   -3.751256289504380e-02   +4.720428285174720e-02   -5.020992319228153e-03   +1.490850711711270e-02; -1.319943870737764e-01   +6.332657016445062e-02   +3.647186718341803e-02   +4.353429204497802e-02   -3.322963297105171e-02   -7.013125618422573e-02   -2.795364745954595e-02   +6.446487608205310e-02   -2.117169481756008e-02   +4.696880254712402e-02   -8.162688612751748e-02   -6.469638312220644e-02   +7.154246672897591e-02   -4.497512613880508e-02   -5.594067156258697e-02   +3.518821048334726e-02; -1.325592292163510e-02   +4.927480496694778e-02   -4.742539641303908e-02   -8.573916353479695e-02   -2.138200466522881e-02   +2.722235271414419e-02   -1.754601154341482e-02   -1.403708030060354e-02   -3.309093075434647e-03   -7.485634647296870e-02   -1.632059462522247e-02   +9.158294535040488e-02   -1.171390549781516e-02   +4.089239994369114e-02   -5.012990021846309e-02   +1.997793974083861e-02; -4.945103205543058e-02   -8.898557730738997e-02   +2.034251588585400e-03   -1.311442388768452e-02   -1.615053329375742e-02   +4.694918480430710e-02   -5.672003611435979e-02   -3.146373126150466e-02   -4.643941176627302e-02   -3.793268055422373e-02   -3.834433430844379e-02   +2.996584199667200e-02   -6.397442505077941e-02   -1.994313979425468e-02   +2.500825052020220e-02   -1.276527913949111e-01; +4.346013142514207e-02   -4.504371459003609e-02   +1.319538463068891e-03   -4.995424977423572e-02   +7.469055613585995e-02   +8.726568502239149e-02   +3.130581157933157e-02   -6.496991651706042e-02   +7.506875860080742e-03   +3.927510735059050e-03   -5.689297941494940e-03   -6.472394079309901e-02   +7.482997571577697e-03   +6.654913923743014e-02   +3.556762783320794e-02   -2.121331653570772e-02; -8.647381485424090e-02   -1.547240883762138e-02   +3.227947644204544e-02   +1.062272590183885e-01   -3.680367216526621e-02   +8.371150823102008e-02   -3.106834086270788e-02   +2.554443996329998e-02   -1.040070077688613e-02   +5.655387145447892e-02   +2.043464666794301e-02   -3.753054469778971e-02   +2.567951976107922e-02   +4.283197675371591e-03   -4.140379253653895e-02   -1.532623502375333e-01; -3.141012913343828e-02   +2.918245573455344e-02   -6.531752737727083e-03   -7.866817841903070e-02   +1.503103701340983e-01   +1.191404351235352e-01   +2.829381483842219e-02   +9.381575045655699e-02   -1.275002596214391e-02   -1.289910696832137e-01   -3.622588320582305e-02   +7.483980898493615e-02   +8.301305335699682e-02   +5.619447638227016e-03   +5.242968992553687e-02   +1.591322338174785e-02; +6.488278349662090e-02   -1.006326436962787e-01   +2.731106899209870e-02   -1.547252247324396e-02   -4.825091750855771e-02   -4.342430577408753e-02   +1.956856020060625e-02   -2.021064801416965e-02   +5.835682095490961e-02   +6.074359551485362e-02   -6.350274293708580e-02   +3.792553981660315e-02   -3.953450534835302e-02   -3.429834335488893e-02   +2.386463931000629e-02   -6.164904900911089e-02];
L2E_L1E_iAMPA_netcon = [-6.024686470670311e-02   +3.398155055425879e-03   -3.875045793429155e-02   +3.762822424864215e-02   -2.316415765354695e-02   -8.503394448109307e-02   +2.741031886599682e-02   +2.045314759377526e-03; -2.018366566220174e-02   -1.542545589731149e-02   -6.207830664776255e-02   -2.524187648486072e-02   -5.935788771100669e-02   -7.032169132306754e-02   +1.850671482890567e-02   -3.170836625470625e-03; +7.182124060424473e-02   -1.142971348873217e-01   -1.111937371567959e-01   -3.015917456112118e-02   -2.777818759680401e-02   -1.963293108894763e-02   +1.019053750444565e-01   +9.355369473179978e-02; +2.666615361389657e-02   +1.051732128964888e-01   +6.483933722215372e-03   +4.694834631910209e-02   -4.193062919561841e-03   +5.587743147545182e-02   +1.861718688408354e-02   +1.465044894291942e-02; +6.217795024479126e-02   +3.558051815924997e-02   -2.347854457280495e-04   -5.674729314277201e-02   -5.864720203019292e-02   -6.109781228086794e-02   +1.221688605075322e-04   -7.636869949514982e-03; +1.049258030050633e-01   -4.126102240478909e-02   -2.938924238787068e-02   -1.213459544342418e-03   -3.962735846583274e-02   -1.407889893523565e-02   +1.152933425160776e-02   +1.105439886447707e-01; +3.995005322138893e-02   -1.984462662153866e-02   -7.177520786986669e-02   -5.055628073305873e-02   +2.504511860406981e-02   -1.579727397423002e-02   -1.237807968498126e-02   +6.422798631284794e-02; +7.758571546525617e-02   +4.459566753170744e-02   -6.222921932114668e-03   +3.160009050073116e-02   -6.702100426850995e-04   +1.193830452910260e-02   +7.164871953064912e-02   +5.711246363848678e-02; +6.768584674939764e-02   -9.789732383301845e-02   -3.114097015319235e-02   +2.892032611444423e-02   +2.089455799509856e-02   -1.067837641807692e-03   +6.728615613244521e-02   -1.075994705279535e-01; +9.120314038512028e-02   -9.777120134210822e-02   -2.944467750356565e-02   -4.723340948341746e-02   +4.751119602082786e-02   +4.480510468183581e-02   -3.104485207871167e-02   -3.896253228501043e-02; +1.854480098300160e-02   -4.646365939214724e-02   -3.169834606129909e-02   -2.036976862396312e-02   +8.118648530942101e-02   -7.237406464415375e-02   +9.586775761319954e-03   +4.952441422986302e-02; +1.978849437793246e-02   -4.916170964688629e-02   -4.130513950822323e-03   -7.841450318872574e-02   -1.057932426197099e-01   -9.593407311354616e-03   -1.723616633966129e-02   -3.381327697236155e-02; +4.148456160997549e-02   +2.274289719481765e-02   +4.191638460200444e-02   -9.023510027254311e-02   -1.474585321058912e-02   +3.303456342997849e-02   -7.549241804038662e-03   +8.440251104689959e-02; -7.328135119937686e-02   +2.201973961256642e-02   -8.944315279654939e-03   -6.236303131518494e-02   -7.159487503159805e-03   -1.922921041504188e-02   -6.951215319955297e-03   -5.060049283446613e-02; -4.173095965096181e-02   +7.967357147879794e-02   +6.749382103254697e-02   +5.319664748149052e-03   +2.123228444687351e-03   -1.865084766869535e-02   +1.328738544112573e-02   +1.349816181558108e-02; -8.110166431080679e-02   +4.498558338744773e-02   +4.854785584334852e-03   +1.293056970274682e-02   +2.778904206980576e-02   +8.089326617418556e-02   +1.596748505178720e-02   -7.216583955241548e-02];
L1E_L2E_iAMPA_netcon = [-1.590382257114895e-02   +2.768715480758331e-02   -7.498378440741660e-02   +2.347615294727781e-04   +4.481156473582717e-02   +7.536841371116906e-02   -4.831056908328863e-03   +1.917612496530895e-02   -4.472523283281435e-02   -3.142857890457221e-04   +1.286565587521542e-01   -7.029378095085209e-02   +1.157669922309976e-02   -5.156712759320717e-02   +5.228936332595555e-02   -6.326401402892391e-02; -1.535426378291711e-02   +7.219104315362190e-03   -7.613845816133694e-02   +1.201702900376222e-01   +9.239671817354703e-02   +3.378471191551979e-02   -1.622878676623944e-02   +2.418886247366162e-02   +4.234687466101231e-02   -4.674270931535824e-02   -1.050207745693106e-03   +1.903662688591781e-02   -2.002489337628198e-03   -7.419553952528080e-03   -3.944446524217143e-02   -5.301830187521679e-02; -3.742348543983472e-02   +7.661445219459523e-02   +7.714052845320335e-02   +1.128367753268992e-02   -1.071047159421004e-02   -6.021566056447171e-03   +2.509566023646338e-02   -3.588442983788202e-02   -5.918313821626452e-02   -5.574385401979587e-02   +5.103846117018653e-02   -4.734802813332833e-02   -4.279659777254220e-02   +1.027462492085839e-01   +1.078942430101427e-02   -6.400954419495940e-02; +4.037327593411394e-02   -4.692288577629009e-02   -7.771422847080500e-02   +1.078132211505419e-02   +2.753851730105849e-03   -5.039093281115284e-02   -2.796233686434328e-02   -6.043499061043072e-02   +1.135841190173793e-02   -2.602336759926644e-02   -1.067894579560501e-02   +1.445348931155167e-02   -4.523542812206645e-02   +1.730073053969020e-02   +8.595700202543712e-03   +8.591713094876280e-02; +1.208344561897859e-01   -9.753095307650400e-02   +4.457898703780393e-02   -8.258536958623670e-03   -3.714150212845129e-03   +4.670224875757836e-02   -8.024926335571278e-02   +1.004195734664964e-02   +4.158928952425764e-02   -1.568104710710665e-02   +3.431068122240373e-02   -4.079807871684175e-02   -5.816145759775472e-02   +4.623934318258967e-02   +3.400205122278167e-02   -1.422761092633785e-02; +5.503309076780871e-02   -8.415870588338023e-02   +2.478426715391025e-02   +4.939522846034313e-02   -3.530529224800200e-02   +1.109666031799923e-01   +4.280348214021436e-02   -1.306427687553109e-02   -1.455580460052352e-01   +3.394495086558050e-03   -6.520591683307428e-02   +8.329334820325653e-02   +9.304433342734283e-02   +7.172134737201266e-02   +7.719955813832827e-02   -3.318209701922154e-03; +2.345798176644473e-02   +5.548877684874266e-02   -4.543054741582710e-03   -5.124454362340037e-02   -8.399845047998078e-02   +8.572345486424110e-03   -2.334265916371051e-02   -1.016706194612192e-02   -5.246709353262138e-02   +9.585597345566160e-03   +5.884664187875983e-02   -3.112135394225257e-02   +2.238097075602164e-02   +2.809958430286568e-02   -7.607566743660679e-02   -5.350399696129392e-02; -4.928759735159892e-02   -2.648861456373989e-02   +5.853650533755266e-03   -4.536930316723041e-02   -9.487482604017820e-03   -2.162061687075290e-02   +4.089352537373817e-03   +9.704387947653038e-03   +4.582504866097504e-03   +1.637513529734175e-02   +5.675052415051719e-02   +5.395301864092968e-02   +6.142186751158045e-02   -6.946015078538914e-02   -5.270209495042862e-02   +5.121618642028111e-02];
L2I_L2E_iAMPA_netcon = [+9.185574519526404e-02   -8.979325734542097e-02   -5.395821634170038e-02   -4.039674231952278e-02   +5.316444795052128e-02   -1.901680185196377e-02   +3.140822236254115e-02   -7.257461998857014e-02; +2.810971787548263e-02   -7.180251591449030e-02   -9.355707699831459e-02   +9.807822325595139e-02   +8.512862192008211e-03   -2.274872219543253e-02   -3.287314840693030e-02   -8.569337706174603e-03; -6.861855073365453e-02   +4.116909713767243e-02   -4.435543755413265e-02   +6.308737249646004e-02   -5.579729126594005e-02   +5.600239956843139e-03   +3.976153062856988e-02   -5.331147465497408e-02; +5.592331068973121e-02   -4.472771905239923e-02   -1.935916340663630e-02   +3.183767084362308e-02   -1.074144303099079e-01   +4.042781828188623e-02   -5.295974575183864e-02   -4.597556268716269e-02; -5.666073014116758e-02   +9.168102431023054e-02   +3.185066998806316e-02   +3.611385195650012e-03   +1.573754154204979e-02   +1.116382890583468e-01   +1.180185925750107e-01   +1.017693527256231e-01; -1.417561179979140e-02   -6.809018348755715e-02   -1.668335464111390e-02   +1.140538252326424e-01   +4.555159900475355e-02   -2.981082380327290e-02   -1.509567559765087e-01   -3.034664762843825e-02; -4.618144742993217e-02   +1.780326488085148e-02   -1.082379363542522e-02   -1.041617882690667e-02   -8.741045849207102e-02   +5.460341263998569e-02   -1.147830750887755e-02   +1.662697519113343e-02; -1.291727054060816e-02   +7.194989252342562e-04   +3.476773183802016e-02   -5.068693333740467e-02   +5.557314181341186e-02   -2.083566472131988e-02   -5.067481109934256e-02   -2.445826104623789e-02];
L2E_L2I_iGABA_netcon = [-5.416841096789866e-03   -3.206958516244669e-02   +2.999975755432307e-02   +3.092837604538824e-02   -8.120913688601152e-03   -3.506409495828738e-02   +4.816540409026475e-02   -3.400085137811063e-02; +1.829912659278876e-02   -1.192305170170071e-01   +9.272428686320786e-02   -1.277494660038709e-02   +5.643601743363705e-02   -3.925088314683020e-02   -1.883213792468186e-03   +9.367223409217702e-02; -8.817678494868020e-02   +1.272841180741138e-01   -2.244369270116980e-02   +6.148972830889117e-02   +7.868968358128647e-02   -5.075044485792886e-02   +8.493880058603048e-02   -3.606078888690704e-02; +4.746305430816614e-02   +4.922408049051561e-04   +6.631621995471451e-02   -3.419608397853132e-02   +5.528114520514663e-02   -7.972489184775380e-02   +2.455127408885418e-02   -2.169799221381351e-02; -4.751203044481123e-02   -1.473134129583498e-02   -5.226093215209726e-02   +2.116866666503461e-02   -7.680691120680194e-02   -4.971213984108771e-02   +5.690530082296750e-03   -7.918053368149675e-03; +4.501676134758634e-02   -6.140457151935313e-02   +6.978436836414674e-02   +2.997651401050305e-02   -4.616103401119542e-02   +2.842647347537457e-02   +3.449776803403835e-03   +1.149765445897142e-02; +5.965732393380234e-03   -2.008016364815752e-03   +4.192295591273053e-03   +9.025430895488198e-02   +1.259423279055018e-04   +5.054596997813274e-02   +5.791675766600912e-02   +9.388709706546171e-03; -5.806278735051466e-02   +1.372676575912909e-01   -1.126003292180586e-03   +6.557649547027054e-03   -5.546150163484267e-02   -2.764644996393822e-02   -2.474917975105956e-02   -3.272484643893212e-02];
L3E_L2E_iAMPA_netcon = [-5.557059927624291e-02   -1.107237278501492e-02   +4.091961503701407e-02   +1.652618056273949e-02   +7.696835979552170e-02   -2.724680484000062e-02   -6.434512480092358e-02   -3.993866470259463e-02   -6.190971358363913e-02   -2.190291961150275e-02   +3.724668086028385e-02   +3.166684123526160e-02; -4.813492540873446e-02   +7.394823658095132e-03   +6.660432322595182e-02   -1.537929451524150e-02   +6.675816848839462e-02   -5.973488458834907e-02   +4.502927350897456e-03   +1.183676098393670e-02   +3.008821628269296e-02   -1.524333412287509e-02   -3.589760728387233e-02   -8.939417822345470e-02; +5.426823468229166e-02   -4.064618315414369e-02   -1.064717667441733e-01   +1.321383558807132e-02   +7.138052455688246e-02   +2.621694397763387e-02   -4.209524741379179e-02   -7.226130452306409e-02   -3.571967004104797e-02   -6.632750680683830e-02   -9.716784715568573e-02   -8.483457889838168e-03; +1.005436221654954e-02   -5.834443661920716e-02   +7.405506428550600e-02   +8.859101798012586e-03   -1.213837596408581e-02   +7.895773050037935e-02   +6.661512622123228e-02   +5.521849057678067e-02   -1.606495123913064e-02   +5.782340607556145e-02   -4.808667036764091e-03   +4.017755686178502e-02; +9.332493551824393e-02   +7.570963670632566e-02   -2.549337799199305e-02   +4.312445470118246e-03   +1.632305362498185e-02   -1.211673241188606e-02   -8.067697947448655e-03   -3.828294500753800e-02   +8.863109604176815e-03   +9.164126472482848e-02   +1.562996499791532e-03   +1.076613532096195e-02; -5.390360610474191e-02   +4.611639202271449e-02   -4.091458609534736e-03   +6.805565481596895e-02   +8.703752667773389e-03   +8.948881973915931e-02   +6.376467024485677e-02   +1.203991496584247e-02   +5.919976086729573e-02   +2.449075433047224e-02   +6.530961178887233e-02   -3.625001968885511e-02; -3.863337336193551e-02   -6.529889342993662e-02   -3.231314159359455e-02   -8.646673265601820e-02   +4.490725886059585e-02   -3.775833649146587e-02   -7.656144428393845e-04   +7.138619202386599e-03   -2.499272514974768e-02   +7.259865973103403e-02   +1.398703310656539e-02   +5.324628104967666e-02; -8.201358584827145e-02   -6.017331409039912e-02   -5.380309898247393e-02   +7.682251905158935e-02   -9.424299165906969e-03   -5.344703162912883e-02   +2.212816689751795e-02   +8.894112985312920e-02   +1.849878330605920e-03   +1.758214394881015e-02   +1.434672131115280e-03   -1.122434885069126e-01];
L3I_L2I_iGABA_netcon = [+3.007632894733118e-02   -7.405312978807226e-02   +6.334524174608547e-02   -1.238171600241499e-02   -5.973471700299934e-02   -1.708717199622809e-02   +6.222599158037791e-02   +2.484524185205546e-02   -2.216843588618282e-03   -1.044619553338706e-01   -3.066463856932111e-03   -6.575120148727438e-02; +4.336439254109520e-02   +5.598950105888410e-02   +2.727155861514644e-02   -3.789085675410715e-02   -2.550875595727862e-02   +3.029385344042995e-02   +4.051994668155172e-02   +3.640485359611151e-02   +6.907821591703509e-02   +5.404136451665401e-02   +1.547963947002561e-02   +2.387839684770450e-02; -4.642498002246221e-02   -1.106952265482568e-01   +5.041619755391534e-02   +7.047323894160448e-02   +2.305825641329510e-02   +2.980490731593255e-02   +3.495625926489908e-02   -3.974793099775871e-02   +5.511888294727742e-02   +1.301056847861767e-02   +4.911042292019686e-02   +4.412487782184561e-02; +1.659510775388426e-02   +1.051989956159058e-01   +1.858216563998646e-02   -1.436376622524474e-02   +8.103810737414868e-02   -4.983227882663151e-02   +5.185933159782250e-02   +3.486556569804912e-02   +2.355216485866282e-02   -3.582781615598481e-02   +5.721555248582327e-02   -2.544490772549149e-02; +4.388125802807341e-02   -1.632545149077677e-02   +3.418560940722500e-02   -2.416700765193575e-02   +1.610341266599143e-02   +8.495850275107078e-02   -1.088825923916874e-02   -1.227672201951140e-02   -7.908446526312982e-02   +1.597076134286107e-02   +2.498088651390947e-02   +6.085563687555770e-02; -1.923012663982964e-03   -7.123948053639982e-02   -6.579451538281943e-02   +7.212522267141738e-04   -7.665463023648263e-02   -7.805396412968710e-02   -3.296208601044057e-02   +3.462738949148376e-02   -1.134346121127695e-01   +6.182547119937518e-03   +4.938343245845345e-03   +5.796957623273551e-02; -3.013263825223250e-02   +3.768049401312669e-02   -3.875038247438662e-02   -3.422498385944435e-02   -1.023513665651437e-01   -1.815601280473879e-02   -5.147155900864767e-02   -5.293727237085870e-03   -2.482493030605363e-02   -7.578310431576243e-02   -2.442679725915279e-02   +2.095997344011424e-02; -3.590655654691031e-02   +4.856732577358579e-02   -3.548226907959622e-02   -3.376343368565950e-02   +1.006397379549575e-02   -6.930795783751109e-04   +1.051995511751784e-02   +7.577670292453631e-02   -9.335294609402980e-02   -3.947623633918025e-02   +9.274384359495694e-02   -4.220899391175124e-03];
L2E_L3E_iAMPA_netcon = [+4.693815751989344e-02   -1.171493688135691e-02   -5.093615907705559e-02   -1.635931651835334e-02   +6.252497034255400e-02   -2.977505104049685e-02   -7.782830993895873e-02   +6.714651745013912e-03; +8.691311342302807e-02   -2.302291956625031e-03   -1.063514468419375e-02   -5.677844048966078e-02   -1.202664436413668e-02   -4.516717482433515e-02   -5.151456329067285e-02   +1.099368731944362e-01; -4.964196239370728e-02   +7.083011675892031e-02   +3.408274373927166e-02   -4.274881609571596e-02   +4.020065241588552e-02   -3.966732187416071e-02   +2.601218473752669e-02   +2.974401055115149e-02; +9.774355667023815e-02   +5.181931423872780e-02   -1.999339223664158e-02   +1.918879608913099e-02   +2.974391955689581e-03   -1.255020574322817e-02   -1.412480914280875e-02   -1.801953557026865e-02; -6.395774643761473e-02   +2.986068956562309e-02   +2.585128792354975e-02   -1.993710099042726e-02   -4.354384171292464e-02   -4.832459008561359e-02   -1.416105589336051e-01   -2.659841277200457e-02; +3.884870823259784e-02   -6.240528273687337e-02   +2.765709461362657e-02   +9.014697953739720e-02   +9.618853726309008e-03   -5.951057418777860e-02   -2.129513701891563e-02   +6.319253993055238e-02; -1.466847035601274e-02   -2.431862593876957e-02   +6.043282332815812e-02   +1.120031177239658e-01   -2.500968103125788e-03   +3.689656961222199e-03   -1.056277179556037e-02   +2.292837884784974e-02; -4.011754821345644e-02   +3.746209787440602e-02   -3.199059473220746e-02   +2.800382809342449e-02   +3.364677609858120e-02   -6.626396035671528e-02   +1.099069760958408e-02   +3.229826382846758e-02; +6.910664268247435e-02   -8.716286302880784e-02   +1.617897465891613e-02   +3.831412349814860e-02   +7.934062884769111e-02   -6.457695228197967e-03   +1.784399825822659e-02   -6.898715426183012e-03; -7.178222056955101e-02   -1.567326481683426e-02   +3.422609528360351e-02   -3.106561143070417e-02   -5.476283061393591e-02   -5.381569648312372e-02   +1.324830977739464e-02   +4.889813064774826e-02; -4.845558526843981e-02   -5.455133816847667e-03   -7.730459876461046e-02   +3.569064763035582e-02   +8.267357559459024e-02   +4.522946740871050e-02   -3.210428106785783e-02   -4.429776923750763e-02; -3.912553615918188e-02   -1.111203256665636e-02   -3.893666072116889e-02   +4.971772741270029e-02   -4.233667027543242e-03   -5.073634690376155e-02   +1.730853057128483e-02   -1.234424634741615e-01];
L2I_L3I_iGABA_netcon = [-2.102028555784215e-02   +1.411088480013042e-02   +6.592272881374581e-02   -1.196007090890596e-01   -6.469800230120341e-02   -1.574741013411682e-02   +4.682772350962203e-02   -3.854226494598853e-02; -6.061405331172000e-02   +2.777722918384797e-02   -7.501496397698479e-03   +3.935647709866096e-02   -5.725457312405846e-02   -1.526659872327513e-02   +9.407065550075197e-02   -6.976832169222368e-03; +1.003383833059153e-01   -3.127414910251049e-02   -9.187771057218583e-02   -1.217199432139873e-01   -4.807380669757569e-03   +5.455518723329087e-03   +3.022355184072742e-02   +5.031724653340269e-02; -4.896361272094719e-03   +2.775689452958934e-02   -4.093928597483204e-02   -5.912308641901551e-02   +4.870207232868684e-03   -4.075633759485272e-02   +2.236303704159357e-02   -1.117073860513106e-01; -6.192471871037156e-02   +2.534524069921518e-02   -7.719555629149297e-02   +6.315311142545420e-03   +3.154874484968048e-02   +4.002044602268312e-02   -2.563119938313272e-02   +1.847782692061453e-02; +2.632069241253295e-02   -2.476265506856759e-02   -6.439272554119338e-02   -4.934286472136231e-02   +6.008199732093115e-02   +1.091404438159527e-01   +4.275145898656015e-02   -1.493684579402534e-02; +1.466642111510596e-02   +2.983923253542264e-02   +5.708380723867016e-02   -5.493750580435013e-02   +1.887039306161613e-02   -5.897916243667305e-02   +5.010818022940625e-02   +1.648510090394210e-02; +6.267307894131983e-03   +5.325020480836583e-02   -4.786304483111072e-02   +6.588392209783377e-02   -4.969722232548824e-02   +6.801479279886040e-02   -4.951636661037827e-02   -8.597172348275847e-02; +7.363029829924851e-02   +8.987633726670075e-02   -4.004462822085087e-02   +4.054964313629331e-02   +3.693769338007459e-02   +1.060404175683841e-02   +8.850370470647137e-02   -1.144285710343487e-02; -9.877039704242429e-03   -2.566048523063084e-03   -2.813107132547371e-03   -2.314192955616409e-02   -1.245309990253968e-02   -6.180048307701735e-02   -3.189168036980679e-02   -1.689111360796040e-02; -1.309414014415086e-02   -2.743370284554388e-02   +1.190196463880406e-02   +3.448738957016006e-02   +8.382156804147085e-02   +5.892488984063346e-02   -3.484163165813495e-02   -1.073378317905218e-02; -1.017160974620934e-01   +1.311914079971215e-01   +2.026400373512834e-02   +1.084600461490021e-01   -3.139946797209707e-03   -1.073494082034461e-02   -6.713491399809070e-03   -5.858563946320107e-02];
L3I_L3E_iAMPA_netcon = [+9.119999150687287e-02   -9.173651027147633e-03   +1.795406124377280e-01   +3.474953076529406e-02   +3.637535520121303e-03   +2.561984150060591e-02   -6.638279389483145e-02   +1.871959461265562e-02   -2.127703397427304e-02   +1.611678561149853e-02   +5.202056626253410e-03   +7.766084648374236e-04; -8.180940864628141e-03   -6.018865921124587e-02   +1.339994029446822e-01   -1.708381547665975e-02   +1.700038781412216e-02   -1.353299587563619e-01   +4.925950397841973e-02   +1.221158786887191e-01   +9.189145465727172e-02   +2.638628029591330e-02   -2.641529051687851e-02   -1.200382442483511e-02; +2.720768537598926e-02   -6.018820469378099e-02   -1.011204403290457e-01   -3.001500724349483e-03   +3.518031945620631e-02   +3.521340893122736e-02   -1.369930780991190e-02   +7.078857089703092e-02   +5.505578765013523e-02   -8.524455768278064e-02   -2.505556535997747e-02   +7.827444354380256e-02; +1.357769646298278e-02   +6.026393294447760e-02   +4.939772853156894e-02   -6.697368733212288e-03   +5.876131445838588e-03   +3.923625800433645e-02   -5.891694056176917e-02   +6.609669189708046e-04   +3.728902032430828e-02   +1.750960070525995e-02   -5.200523470146085e-02   +1.291350957651884e-01; -1.444930880353348e-02   -1.244174110517872e-01   -5.745888241037363e-02   -1.264554509082937e-01   -1.279947330644717e-02   -2.917940196960032e-02   +8.763785930771048e-02   +4.125145635255511e-02   -5.751147846459171e-02   -8.333044520550839e-02   +4.673214367402706e-03   -2.143678811978017e-02; -1.855705164662029e-02   +5.275157396521617e-04   +4.163999617347942e-03   +7.100019192529179e-03   -4.827490201104524e-02   +3.823691944244188e-02   +1.373429024343883e-03   -1.855921709035924e-02   -5.512216427380522e-02   +9.031613998485957e-02   +7.110747083955586e-02   -1.214702854452868e-02; +6.586634579148629e-02   -6.914498620522393e-02   -8.730299551487808e-02   +1.616912194285072e-02   +4.526442966815129e-02   +2.822935852273654e-02   +1.656599199054189e-02   +2.903038924050798e-02   -3.659913797393544e-03   -4.081984401496033e-02   +4.433535941190017e-02   +1.083904471440621e-01; -4.198226093202626e-03   +2.869305770249608e-03   +9.250870839559103e-02   +2.406932455957159e-02   +6.282189803725152e-02   +3.731254937254460e-02   +3.355621060382883e-02   +4.852989540650770e-02   +1.520806370197124e-02   -4.738733686512729e-03   +2.897804389647936e-02   +4.406793544627721e-03; +7.850382204934933e-02   -3.775255193113357e-02   +8.740378432282189e-02   -1.555248617671607e-01   -2.577553260029319e-02   +4.275955574464511e-02   +2.029023957969137e-02   -8.213205666555739e-03   -6.620908171641046e-02   -2.217313830402307e-02   -9.221046121311784e-03   -9.238074114667300e-02; -9.472417972557011e-03   -4.413027068392537e-02   -7.472551072122480e-02   +6.205851319082668e-02   -2.002709410425242e-02   -1.826136850486328e-02   -3.283628962151281e-02   -3.442078225556459e-02   +4.509259477738691e-02   +4.236597924317409e-02   +7.885473523066470e-02   -5.229107832595793e-02; +2.717081986128003e-02   +4.399899667425744e-02   -8.720194782700298e-02   -9.347156898698150e-02   +8.216559666383638e-02   -1.352876578410644e-01   -7.227852875179201e-02   +6.663801632053398e-02   +2.904131432268907e-02   +6.357893433100174e-03   +1.187390007751969e-01   +6.176705172103662e-02; -9.985298727644826e-02   +1.136024402068759e-01   -1.885912808558907e-03   +4.392050429393144e-02   +5.826559663257330e-02   -1.211686855905978e-01   +7.096262883847909e-02   -3.510657136553271e-02   -8.157822659541653e-02   +1.027044503827816e-01   +7.763436036916395e-02   +7.071478253013633e-03];
L3E_L3I_iGABA_netcon = [-3.199877131111411e-02   +7.658422120975096e-02   +5.680440810028355e-02   -5.165857419142019e-03   -7.575356338799798e-02   -3.927149251081911e-02   +5.824336354917734e-02   +1.413247522899425e-02   -6.772605714635058e-02   -3.367570410780504e-02   -1.018754851450880e-02   -2.998952095053693e-04; -1.878478478463272e-02   +6.104370744346861e-03   -1.104967914137937e-02   +5.403246517436261e-03   +6.445612417050292e-02   +2.169696067146225e-02   -4.165741132275943e-04   +1.432528664935481e-02   -8.109889185781571e-02   -7.894252007130692e-02   +1.306623432954883e-01   -3.918508798260970e-02; -4.915944892225548e-02   +1.568603125403579e-02   +3.361476329336745e-02   +4.479049326162671e-02   +3.621560957994863e-02   -3.373848610138111e-02   +2.012538097070443e-02   -1.462371091227811e-02   -4.734160802245831e-02   -2.152399575003078e-02   +2.404377529643863e-03   -5.553377036077538e-03; -4.360836496840954e-02   -4.941952457322983e-02   -7.002759968785977e-02   +2.070863012969709e-02   +5.754447882632666e-02   +7.582822588128024e-02   -8.505714684729545e-03   +5.224620801488081e-02   +1.032113913185936e-01   +1.339772108585141e-02   -4.900871888614012e-02   +3.381507894601401e-02; +4.375462096559388e-02   -5.596025255692781e-02   +2.034746834260009e-02   -8.899679544824391e-03   +5.132005842661784e-02   +1.224557516303168e-03   -4.242356336372477e-02   -8.521085846725866e-02   +4.211892241342372e-02   +4.997506696964500e-02   -1.782783057363751e-02   +9.387496057713278e-02; +7.963644964520138e-03   -1.557301913471875e-02   +7.893420537661215e-02   -1.453212024549371e-02   +5.037724940130506e-02   -1.768247839013255e-02   -4.894846077767460e-02   -5.357370335483289e-02   -4.592745496052420e-02   +6.128250784074817e-03   -7.168845338441923e-02   +8.432722099516125e-03; -1.058208450853601e-01   +1.681240303492664e-02   +7.377470958604164e-02   -9.451335529413990e-02   -1.145120842514814e-02   -9.493636542970012e-02   +2.755525279862558e-03   -3.851664060937542e-02   +2.993655890065012e-02   +1.373099122711235e-01   -3.014023185956526e-02   -4.136405709737537e-02; -2.158022234727906e-02   +4.089551566806877e-02   -8.575259305110172e-02   -4.104706581292351e-02   -7.752005938997707e-02   -2.124531530083461e-02   +1.296776281098944e-02   +6.701957727209243e-02   -2.612738933321778e-02   +6.347246657584144e-02   -2.490249858301614e-02   -2.728074811064305e-02; -3.896966612167936e-02   +8.781599490282398e-02   +6.596117795578435e-02   -5.772283619456961e-02   -8.011870156578428e-02   -1.146604570055043e-01   -7.081593364516246e-02   +4.007447461236027e-02   +8.901622211584882e-02   +1.520359817383141e-02   +7.125503487102115e-02   +3.446456705899226e-02; +2.273425875598041e-02   -7.769403402794145e-02   -8.130158988279776e-05   -2.164005736092279e-02   +6.386081165261756e-02   -4.150682084011943e-02   -5.584285788457193e-02   -3.609247166959408e-02   +2.360692032493474e-03   +3.851728835494971e-02   -3.084827443121713e-02   -8.326045613434341e-02; +6.564158653840810e-02   +4.161679523780085e-02   -7.122328355479873e-02   +7.438475064359487e-02   -2.709705259544270e-02   +1.213721706756193e-01   +4.987782997518352e-02   -2.111407342756335e-02   +5.731255954620115e-02   -6.287221392562645e-04   +5.038171268915648e-03   -1.309187100006307e-02; -1.263896318125181e-02   -1.116218722153384e-02   +3.922942739327340e-02   +1.883862203679094e-02   +9.684431444540242e-02   -5.813822443315011e-03   +8.576354102671768e-04   +8.180625851464177e-02   -2.355960770452101e-02   +8.986714440312156e-02   +2.643324529924106e-02   -7.365815054483321e-02];
L2E_Input1_iAMPA_netcon = [+3.096219637644721e-02   -2.449933424071363e-04   +4.858120489542165e-02   -5.886569111205687e-02   +2.102069627705742e-02   -3.812704443822050e-02   +8.262232135390116e-02   +6.051463265427420e-02];
L2I_Input2_iAMPA_netcon = [-7.683966455333009e-02   -5.401205863667757e-02   -5.093396269153987e-03   -1.278342981225716e-01   +7.848253030833309e-02   -3.098588099339266e-02   +1.166712861224534e-01   -5.524110200956630e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
