function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-4.825488603416367e-03   +9.846817983580529e-04   +4.932496807652655e-03   +7.035993547137344e-03   +5.850872849337059e-04   +8.473556662771822e-03   +3.953182598511060e-03   +4.072324487865336e-04   -2.500812166291564e-03   +8.182269943736366e-03   +5.069945768744285e-03   +3.713219393339470e-04   +5.262484851866191e-03   +3.021268298498071e-03   +3.792769692068276e-03   -3.552083116399202e-03; +3.540185765659953e-03   -1.681013711468598e-03   +3.249440417317998e-03   +9.970175604846674e-03   +8.339323070861507e-03   +3.194427572638486e-03   +8.411483779338006e-03   -1.175953624747894e-03   +1.982655949680450e-03   +6.311664808111343e-03   +6.017527493889500e-03   +2.140683577736373e-03   -2.983682154279878e-03   -3.149401427985460e-03   -3.358400923480808e-04   -9.740213178713483e-04; +2.020796545845241e-03   +6.499523956801748e-03   +6.208668409108881e-03   +6.878440509613108e-03   -4.332257200160517e-03   +1.654016662285208e-03   +5.299021681813007e-03   -5.503584590078390e-04   +1.283560465779326e-03   +6.145225274828250e-03   +4.866314723005524e-03   -2.662452229913326e-03   +9.275383053773862e-03   +3.979777506669181e-03   +2.759532291094266e-03   +3.603396648248569e-03; -1.550153670165332e-04   +2.527281984274688e-03   -3.610923727488217e-04   -4.020570661452197e-04   +8.427075798895749e-04   +5.490320027606125e-03   +5.364014211869212e-03   +5.516871870695214e-04   +4.998384317326164e-03   +6.042853041445450e-03   +4.558381151874475e-03   +7.721568900945208e-03   -3.080867776226099e-04   +7.081882811285873e-03   -1.478400462633667e-03   -7.772172321945339e-04; +2.602454678464961e-03   -1.524285053705085e-03   -1.727549715664431e-03   +5.868919006095466e-03   +1.049017410225348e-02   +3.715896830565547e-03   -8.269331868853861e-04   +5.194206546734438e-03   +9.835147773249214e-04   +9.928828358907713e-03   -2.529025138641010e-03   +7.040082123176368e-03   -1.686167321899727e-04   +4.632251560045596e-03   +1.833181912910275e-03   -2.822868716406814e-03; +8.913801887164627e-03   +4.801340089818469e-03   -2.058716968868529e-03   +4.481146696509238e-03   +1.756173336613748e-03   -7.240464896799166e-04   +4.404649273619835e-03   -7.074979313080829e-03   +5.039736595468810e-03   +8.289306890293120e-04   +3.044576059037208e-03   -4.578386665451680e-03   -1.263315960056957e-03   +1.043723359002318e-03   +1.784854507933961e-04   +7.648935210619959e-03; +4.588103319058999e-03   +4.089054866019243e-03   +9.331011633920220e-04   +5.266596849335625e-03   +5.946156348519217e-03   +3.961608835984514e-03   +4.296974716560877e-03   +6.635405068313307e-03   +9.731685191072472e-03   -4.244209033023037e-03   +2.740144904534727e-03   -1.314758883547271e-03   +1.444047115112929e-03   +3.538503397203594e-03   +2.904106820456836e-03   -2.665679396777960e-03; -4.944675324652406e-04   -8.182678114318720e-03   +2.327986368272186e-03   +1.332217234888483e-03   +2.594499387870345e-03   +8.110406563848445e-04   -2.436820522667966e-03   -1.067837421263024e-03   +6.632618640486573e-04   +4.591106471594514e-03   +5.218122182931923e-03   +6.605124521421164e-03   +4.651145762539316e-03   +8.470757038991182e-04   +1.329840691305715e-03   +3.839859717396258e-03; -1.799139310497970e-03   +2.326300654740121e-03   +3.803550520822816e-03   +7.654695661853466e-03   -4.838335208018438e-03   +7.262275035597923e-03   +2.536230452977290e-03   +3.737322516090585e-03   +6.272324682815703e-03   -1.262957214242592e-03   +5.598915677086362e-03   +5.110557673229780e-03   +3.921024796460944e-03   +7.085521530794446e-03   -3.210376633026961e-03   +7.305493560672084e-04; -1.263226929182364e-03   +7.167888051638035e-03   +1.007363883818615e-02   +6.412744628592640e-03   -3.804544712309506e-03   -3.690959968546960e-03   +5.571557102153532e-03   -2.195621045052706e-03   +5.759135042236596e-03   -1.257298369611901e-03   +4.471708653346359e-03   +4.556165427259176e-03   -6.641183713180102e-04   +6.592966683552238e-04   +1.238337808495906e-02   +6.876072881885568e-03; +8.816513447213993e-03   +5.847558526926330e-03   +9.151384534963556e-03   +3.409202250392955e-03   +3.504953893258595e-03   -2.054375787206052e-03   +5.546500884062958e-03   +1.127690581104157e-02   +3.755663627195136e-03   +2.220113346114197e-03   +1.118497146190130e-02   +4.370460185558370e-03   +6.083532242331310e-03   +4.226222929211321e-03   +8.509402642237042e-03   +8.404498057559109e-04; +5.446854493683153e-03   -7.654427007148855e-03   -1.577890504277350e-03   +1.597183319945296e-03   +6.018273366525844e-03   +1.651720753609276e-03   +1.445955142414611e-03   +2.754983138777067e-03   +3.135542936258511e-03   +3.278428031831945e-03   -6.643329904014842e-03   -3.455309611405127e-03   +3.527628881303189e-04   +2.198093403651440e-04   +2.905615695106376e-03   +2.974456623356798e-03; +4.183492822364198e-03   +4.279235111984821e-04   +2.681352640582123e-03   -7.430970540968664e-04   +5.992454151332854e-03   +1.195295700369759e-03   +2.257110543587596e-03   +8.528447182617836e-03   +4.771424124000606e-03   +7.276876460724657e-05   +2.006595551002012e-03   -2.978598828053817e-03   +6.499961429142975e-03   +1.905550767582350e-03   +2.482515878548973e-03   +4.616457628402021e-03; +7.007399196286252e-03   +7.719608876360946e-03   +5.641079633643650e-03   +3.895565699924768e-03   +2.965041259036247e-03   +6.318310434178328e-03   +5.042061822140211e-04   +9.539580968046460e-03   +5.992878805020094e-06   +4.146849670785046e-03   -2.897609200308392e-03   +5.520831881006538e-03   +5.797741808968732e-03   +3.471601035991045e-03   +1.350001136031914e-03   +3.165899501091177e-03; +1.603655742863130e-03   +2.392667770289784e-03   +5.200305214838508e-03   +3.213966181176791e-03   +7.622714811923256e-04   +3.077625034754564e-03   +6.841167805974009e-03   -3.335238154525754e-03   +4.239730741525519e-03   +5.804561629259213e-03   +3.821126019812608e-03   +3.461694210197795e-03   +8.042691451539449e-04   +7.882512595534451e-03   -5.818209371116847e-03   -1.237317106755884e-03; +6.235402233127957e-03   -1.219151659057994e-03   -1.607664106743624e-03   +6.197669901827127e-03   +6.295738795828846e-03   -2.640338425443662e-03   +2.191803914124992e-03   +4.917343351890116e-03   +2.763479994815390e-03   +9.359807529593270e-03   +8.085971715838360e-03   -3.720300037225454e-03   +4.979020438176823e-04   +5.340555990124594e-04   +1.061998386045645e-02   +4.752319214029505e-03];
L1E_L1I_iGABA_netcon = [+1.820731099311207e-03   +9.777429732981796e-03   +3.675239873034910e-04   +6.458581642828433e-03   +1.562968761521461e-03   +5.084887058135531e-03   +9.458657022222356e-03   -3.633992645216939e-03   +3.191067102284712e-03   -3.945487872119235e-03   -8.952099799259465e-05   +3.691981312076809e-04   +5.724612283191209e-03   +7.052984009315960e-03   -6.848913791647655e-05   +6.487887121801770e-03; +7.009073759890405e-04   -1.466340860559497e-03   +5.787300305167178e-03   +8.355345358330331e-03   +4.412482680482782e-04   +3.982149543069804e-03   -1.423620814821016e-03   +3.993081974213518e-03   +2.379697094095988e-03   -3.825381848315819e-03   -3.376822766361114e-03   +5.862739372548702e-03   +5.018831673641415e-04   -7.327812368704934e-04   -4.074469103631661e-03   +1.877193543908146e-03; +5.710411084824347e-03   +7.951386016344934e-03   +6.029485288684440e-03   +1.214561332456851e-03   -1.100673369841338e-03   +2.646213934559131e-03   +1.142081513357528e-04   -3.667672366721334e-04   -1.380976370803103e-03   +4.079283202667112e-03   +6.544167013038340e-03   +1.827457118083468e-03   +1.271744814984051e-03   +9.672550438617450e-03   +3.888614659744892e-03   +4.045507916327925e-03; +1.701329449441529e-03   +1.543739318878725e-03   +6.918164912997074e-03   -3.730452286528818e-04   -3.462249262902019e-03   +9.159819462538955e-03   +3.476300372085835e-03   +4.672327553120025e-03   +8.837698568919859e-03   +1.845554739176280e-03   +4.021998029411718e-03   +4.721359302771290e-03   +3.944433705009827e-03   +5.265393001573575e-04   -5.541080699829641e-05   +8.808081264615183e-03; +3.378428185016604e-03   +3.672113966964789e-03   +4.293217899859889e-03   +1.526743758714279e-03   -2.889782620841158e-04   +8.257541464321581e-03   +2.206533143469796e-03   +5.999253083181479e-03   -8.677768292615929e-04   +4.669183119169023e-03   +5.840020679815989e-03   +1.071465213863959e-03   -3.304586002175050e-04   +7.927940369664486e-04   +5.177972709373699e-03   +6.752309753027891e-03; +5.212704654865986e-03   +6.021406495419256e-03   +6.073622470862348e-04   +4.539676405317011e-03   -5.153221504644868e-04   -5.864167619838998e-04   +7.904377176620259e-03   +2.308861774923792e-03   +3.796424778053720e-03   +1.730722169375925e-03   +9.555525746232172e-03   +3.177928440623777e-03   +5.879111985428650e-03   -1.411909513025247e-04   -2.029897016668768e-04   -1.115491717485787e-03; +3.714905868441648e-03   +1.689755816855148e-03   +2.859153855725975e-04   +1.857829097725393e-03   +6.980336631425704e-03   +4.582641872720276e-05   +8.332167552377945e-03   +6.399412059724023e-03   +3.180829097533619e-03   +3.875889762345920e-04   +4.077244827153650e-03   +7.619985130595104e-03   +2.879164535223577e-03   -3.496752070493848e-06   +2.060327199598481e-03   +2.888932273261583e-03; +5.190420091253006e-03   +4.680235063638601e-03   +4.024753324077246e-03   -2.315899406513566e-03   +4.440120020685648e-03   +4.739455187486780e-03   +8.233143764005727e-03   +6.807927661823653e-03   -8.334341145067425e-03   +6.314417769847131e-03   -1.276151466569128e-03   +9.310430041743305e-03   +1.925166515193888e-03   +8.184976140356155e-04   +3.831906699221192e-03   +5.437390479854040e-03; +3.807768821513161e-03   +2.316407755439236e-03   +1.457369660467875e-04   -2.483178300500385e-03   +3.212924435994059e-03   +4.709060026429970e-03   +1.345413482114186e-02   +3.634393296157524e-03   +6.260490762802880e-04   +1.995848598392239e-03   +7.116521621530655e-03   +5.382804134686060e-03   -3.187103472770907e-04   +5.423643902747553e-03   -2.211024149362077e-03   +5.277116097876284e-03; -1.227569215166586e-03   +6.238159681527437e-04   -1.269994095672899e-04   +1.820711640530399e-03   +6.796633706050932e-03   +6.667587478784194e-03   +2.032594597487259e-03   +2.437145157820443e-03   +6.498511634258925e-03   +6.736999111506443e-03   -2.310632726162505e-03   +1.364566507462211e-02   +2.373954923100182e-03   +2.717569970471281e-04   +4.032897276431096e-03   +3.263215952856553e-03; +6.302535168859367e-03   -5.288109020557484e-03   +1.631138833380332e-03   -2.459391472874196e-04   +5.074871832808979e-03   +2.695569570983857e-03   +9.667174747825517e-03   +6.307274646884995e-03   +2.258117122263464e-03   -3.134722642381111e-03   +2.909139887299792e-03   +4.644216562634902e-03   +1.528195821285832e-03   +6.272865525334373e-03   +3.592788107723759e-03   -9.093092862906928e-04; -2.472806334838468e-03   +1.102079283404121e-03   +8.384520930544185e-03   +3.992064670063756e-04   +5.203503030099289e-04   -1.962929608137407e-03   -2.091204146330075e-03   +4.582103427687079e-03   +1.446773059941933e-03   +3.116418266974791e-04   -3.922285820644298e-03   -7.643624015239248e-04   -2.220785186880864e-03   +1.985092968079072e-03   +4.049289200915029e-03   -3.224711969313839e-03; +3.601444918285208e-03   +3.125051280090419e-03   +5.801873317928311e-03   -2.118595835656168e-03   +3.358944842542342e-03   +2.531724444067541e-03   +1.016965905942787e-03   -3.237026226749705e-03   +6.064804149803893e-03   +2.753819723657598e-03   +1.085565790153414e-03   -3.503691779119777e-04   +4.133714187283277e-03   -4.079112275814783e-03   +4.733977769305207e-03   +9.602178361292514e-03; +1.852563122294001e-04   +8.321189113020193e-04   -1.099479343321150e-03   -3.364876225636394e-03   -1.615522632198631e-03   +6.424801130898120e-03   +1.222293427535406e-02   +3.575832498837998e-03   +2.679941393610273e-03   +6.715968706970461e-03   +4.005584535081384e-03   +5.639408238190773e-03   +8.113715918065235e-03   +3.690755651695664e-03   +3.405290875305150e-03   -3.559554763072736e-03; +4.944885702076961e-03   -4.677020436578087e-04   -2.124414670202741e-03   +4.040543740078511e-03   +7.418687727882545e-03   +4.578739744725796e-03   -3.644826997213142e-03   -9.351854315007793e-05   -2.650713788494656e-03   +1.676285196966082e-03   -2.884184798674028e-03   +7.339446735900243e-03   +1.016514152781569e-03   +1.448207533302756e-03   +1.319600663188759e-03   +1.227908083329101e-03; +2.894912517209829e-03   +4.140394283353519e-03   -1.351419709638074e-03   -3.433045584417641e-03   +8.442901716152234e-03   +7.842707058086625e-03   -3.481354442604445e-04   -1.028830305495107e-04   +3.263419038318039e-03   +1.679405028922032e-03   +1.010545388596754e-03   +6.865599354549463e-03   +9.458953032022906e-03   +5.286282100500748e-03   +5.253954025402247e-03   +6.174997886185544e-03];
L2I_L1I_iGABA_netcon = [+1.071876889706834e-02   +6.051854732684315e-03   -1.577457222880652e-03   +6.939385574875424e-03   +2.509786878411928e-03   +1.302333558197375e-03   +4.143562828606542e-03   +5.704008000882949e-03; +4.935272069765558e-04   -5.876867700743744e-04   +7.089674632160543e-04   -3.766797693607289e-04   +2.519951921963759e-03   -1.292537526980440e-04   +3.784579119180992e-03   -1.260106917796209e-03; +2.962009515143111e-03   -1.851876467356606e-03   -4.501934065668102e-03   +5.768026130284274e-03   +1.074055423415683e-02   +1.430312631138622e-02   +1.056406445823013e-04   +2.385636737388761e-03; +2.877959900781533e-03   -5.480358416817458e-04   +7.454895418224991e-03   -1.224557090404786e-03   +5.542984227946868e-05   +3.412195520090929e-03   +4.533200485309266e-03   +7.353472120844111e-03; -8.146442646683966e-04   +2.725342536154464e-03   +2.282044854314945e-04   +5.232601849105933e-03   +4.132504197741677e-03   +2.493139579911974e-03   +2.331493562572787e-03   +5.841684497704569e-04; +8.649793622379536e-03   +2.175228052362995e-04   +3.101734034166252e-03   +9.348644623882773e-03   +6.339995505936895e-03   +5.351865726278237e-03   -3.328265866428899e-03   +6.475287474290253e-03; -3.254914832176347e-03   -1.132070731755655e-03   -2.019576909689799e-03   +3.393376650665982e-03   +3.856532566918024e-04   -3.346977040183062e-03   +3.655945666457932e-04   +3.969700186607595e-03; +5.561679476172013e-03   -3.717082321510396e-03   +2.202642434513661e-03   +3.976203665769551e-03   +3.769367310362727e-03   +1.312883060456253e-02   +2.463667701591744e-03   -2.452153745374011e-03; -3.086086971605081e-03   +2.531940409917591e-03   +3.207681033723795e-03   +1.792114734682428e-03   -1.307332419441308e-03   -1.556316124367661e-04   -2.627249472224169e-04   +1.208511774859002e-02; +1.718121635023761e-03   +2.197160877830789e-03   -2.475510224662837e-04   +3.530750161240476e-03   +6.124823577500696e-05   -1.239628909576659e-03   +5.556438748569179e-03   +1.561262859985390e-03; +2.660638172895915e-04   +8.586583972416939e-03   +1.074665393200915e-02   +5.144404975441227e-03   +2.364033749538375e-03   +6.219002023076078e-04   +4.644406175134126e-03   -2.416378037311805e-04; +1.004791785058958e-02   -4.329000393996289e-04   +4.858147325137131e-03   +1.902516257480200e-03   +1.292029487478853e-02   +5.967914297830627e-04   +3.310110505803062e-03   +1.170871866609313e-03; -7.653308218665566e-03   +5.723355817290549e-03   +4.576217244302269e-03   -1.663286207645863e-03   -4.696208832203197e-04   +1.232001033176919e-03   +9.537947742810192e-04   +7.826830681462806e-03; +4.155532083625384e-03   +1.591561332777758e-03   +1.063989525620737e-02   -1.642356561491326e-03   +4.415536832481982e-03   -3.079632331382229e-03   +6.661128696906755e-03   +1.799472451892257e-03; +2.738628402463382e-03   +1.156855401942287e-03   +1.971839169858844e-03   +7.173235117479471e-03   +4.115535025525079e-03   -1.330157896257811e-03   +5.560535680938162e-03   -4.580471375170119e-03; +5.894777119332770e-03   +6.640388515188171e-03   +6.294993685288236e-03   +5.570784242710589e-03   +5.897460188915983e-03   -3.567792751291621e-03   +3.283997023919580e-03   +1.881967462689514e-03];
L1I_L2I_iGABA_netcon = [+9.887612471121035e-03   +8.300466525483574e-03   +3.544113775294301e-03   +1.305715267665568e-03   -2.886769957227774e-03   +7.362498600360353e-03   +1.112426585179676e-02   +2.324937901156233e-03   +8.332762381014727e-03   +5.948288386039087e-03   -5.572271292238655e-03   -2.392121343793666e-03   +8.841757693443253e-03   +5.351650422153303e-03   -5.140191364916688e-03   +5.195986451214618e-03; +6.204169629401470e-03   +2.613591316177263e-03   -1.038253007197551e-03   +3.412254760290573e-03   +3.108527654829600e-03   +1.330054176055819e-03   +5.668372116645589e-03   +6.798541158636457e-03   +3.741347518307745e-03   +4.237646461025059e-03   +3.569612288287299e-03   +2.660772023619739e-03   +3.925518635893305e-03   +2.265139441938075e-03   -1.795208851030619e-03   +5.760324371905561e-04; +4.051988948715420e-03   +2.041939812799824e-03   -3.740147919440698e-03   -7.254122562919877e-04   -1.851782379037579e-04   +9.825327226634723e-03   +6.086699484631883e-03   +1.493192743854591e-03   +2.296075914450121e-03   +7.102498088228124e-03   +2.901627942669118e-03   +1.511927589634317e-03   +5.997198857384214e-04   +1.830284361893241e-03   +3.645200147863256e-03   +7.238887879614215e-04; -1.759629037315831e-03   +1.607546539700495e-03   +5.760802156403717e-03   +1.089198627104802e-03   +2.736323753025873e-03   +4.613375373897592e-04   +4.128270332020684e-03   +2.843081754059373e-03   +1.314684410962441e-03   +2.574640671310453e-03   +5.524392179212137e-03   +7.429578613266435e-03   +3.037763007987230e-03   -2.641444692909042e-03   +3.089219099387494e-03   +3.812444861863355e-03; +2.585328753807099e-03   +7.462126614780136e-03   +2.665052760432887e-03   +4.097260466324797e-03   -1.155046258354836e-04   +4.485630174215129e-03   +2.097424007212893e-03   +1.041874051661066e-02   -7.425898431472014e-04   +3.509150105889523e-03   +6.524354836833820e-03   -5.941405367855167e-04   +1.046285418313924e-02   +3.833213091627800e-03   -1.693807610367885e-03   +2.058802408521635e-03; +5.258033316724909e-03   +2.657696398593587e-03   -4.269135775948396e-03   +7.983088232597482e-03   +1.020654980995189e-02   +6.005034341230756e-03   +1.069234024734350e-02   +3.242018034331419e-03   +5.263324236069381e-03   -8.084410313594137e-04   -6.213510730976238e-04   +9.434120277167234e-03   +1.551244965133184e-03   +6.417088243687335e-03   +8.896801143327665e-03   +1.501402295167959e-04; +4.282516333071930e-03   +5.065158006317180e-03   +2.002498694253847e-03   +3.024939198025711e-03   +4.320187049283637e-03   +6.401514926060728e-03   +5.563598214636947e-03   +2.689733254051273e-03   +4.241933418211513e-03   +6.582837989367398e-03   +1.976804615212424e-04   +1.466290661749357e-05   +7.645281440163828e-03   -6.703059725427974e-03   +5.233459545950852e-03   -1.413719765689504e-03; +6.282546953614187e-03   +4.868865745605607e-03   +1.464775193119096e-03   +1.771458703127904e-03   -2.077033602783598e-03   +1.661377739449911e-03   +1.080980393109927e-03   +3.338771833645579e-03   -4.144497840459992e-03   +3.586982538337768e-04   +2.728716707992273e-03   -1.846145057953753e-03   -3.604087734393053e-03   +1.738030829312632e-03   +1.758660443104132e-03   +1.496547036277837e-03];
L2E_L1E_iAMPA_netcon = [+1.652342463562048e-03   +4.654843076436216e-03   +1.737707062741231e-03   +4.556633063677229e-03   -2.357929955055091e-03   +2.467463783902011e-03   +6.037784322784727e-03   +3.249688391325718e-03; +7.280506464044437e-03   +4.792452757466253e-03   +7.111578590835393e-03   +2.297973342768091e-03   +4.649258024480063e-03   -4.263125415965231e-03   +1.708223676994804e-03   -5.924584919808228e-04; +2.076785146563885e-03   +2.547188082778989e-03   +4.075590593006143e-03   +6.549450401781301e-03   +5.289487820916402e-04   +1.031511582940656e-02   +1.872434995039032e-03   +2.083787015882195e-03; +5.055654246333620e-04   +2.863365020786562e-03   +2.059649167363771e-03   +9.997466488956027e-03   +8.312929732488983e-03   +1.789921185456697e-03   +4.244021341331755e-03   +5.746953879895802e-03; +9.909597573324357e-04   +8.233616753981031e-03   -1.022290506555619e-04   -5.578903036648639e-03   +3.565192728725026e-03   +3.558260334487333e-03   +1.075613541761632e-02   +1.815531235357322e-03; +4.762965206040002e-03   +7.684473393079316e-03   +8.939870901920111e-03   +6.291109613754835e-03   +5.028382887227455e-03   -3.446711606372536e-03   +4.282519037591939e-03   -3.240142990797901e-04; +2.439948581178142e-03   +3.892213287413583e-03   -5.933792582215529e-03   +9.474188090311290e-04   +3.895240367493954e-03   +5.358967222580386e-03   -3.760020281856031e-03   +5.664719380541196e-03; -6.530663609712398e-03   -6.400210549094521e-03   +2.825440228474795e-03   +5.061365351255239e-03   +7.444196985799757e-03   +3.159982448001708e-03   +6.065441353747626e-03   -1.732945128054003e-03; +9.893136453564882e-04   +2.132128647568298e-03   -3.093409528325217e-03   -2.495033968757448e-03   -3.840085536929059e-03   +5.646361780888039e-03   +3.166746968342236e-03   +6.821203430440137e-03; +7.054998199794596e-03   -2.819446831078059e-03   +3.954968055275822e-03   +8.391480585249798e-03   +7.682374966091532e-03   +3.084527106725051e-05   -4.057053158365676e-03   -1.285794170449885e-03; +2.565013274959406e-03   +4.472621463151163e-03   -3.771364228584368e-03   +2.534464238865402e-03   +3.711381559510349e-03   +2.653447367234530e-03   +4.775977190749481e-03   +4.078988674414219e-03; -5.891315444539298e-03   +4.502420211185116e-03   +3.020107946871682e-03   +4.708511612981034e-03   +5.956512733473964e-03   -1.005420539163176e-03   +1.058384030701250e-02   +2.793998002100380e-03; +5.042293591393133e-03   +6.065962804438395e-03   -2.773175313005732e-03   -1.750828434435401e-03   +1.064585062537793e-02   +1.479950062292606e-03   +8.300864671722065e-03   +7.996584469765481e-03; +2.103904179373206e-03   +6.952284928766407e-03   +2.576533093655541e-03   +8.807286836564791e-04   -3.161204682933991e-03   -1.142808476366659e-03   +1.754415636722036e-03   +7.178226240679628e-03; -2.045683019127381e-03   +4.289191679579767e-03   -1.064659602899934e-03   +2.865115171542559e-03   +3.655919111755681e-03   -1.355593123515571e-03   +7.212435865072499e-03   +2.699974762549201e-03; +6.452857305662998e-03   +5.270539534822322e-03   -5.577014057261928e-03   +1.241313181913955e-04   -4.254567015607557e-03   -3.414149969559274e-03   +4.121653084401484e-03   +6.627069174001406e-03];
L1E_L2E_iAMPA_netcon = [-3.968074080934870e-03   +2.062447836967736e-03   +5.489099636099107e-03   +7.176455534394334e-03   +1.009473575198321e-02   +7.524751475434212e-03   +4.479777529116921e-03   +5.934248961843048e-03   +1.837522834824617e-03   +1.808376478497788e-03   +1.596819357818977e-03   +1.429825510303008e-03   +5.611712829185206e-03   +4.458564430302653e-03   +3.300852471609350e-03   +6.906772821884243e-03; +4.629763900028209e-03   +8.833289018255313e-03   +2.451347783436469e-03   -2.184002641113752e-03   -1.516702286436415e-03   +4.135270820285996e-03   +1.456073833294451e-03   -8.588951911579436e-04   -5.799516590681345e-04   +1.270848633888231e-03   -1.156203017645214e-03   +4.291132260147780e-03   -5.382157471968642e-03   +5.093894175016051e-03   +5.027853476503839e-03   -9.394204792942122e-05; +2.719533686766545e-03   +1.279520578219429e-03   +8.770919270636507e-03   +1.228326280970457e-02   +3.901818787505228e-03   +1.854223776279644e-03   -1.591444092664188e-03   +2.513240991873707e-03   +7.593163139160275e-04   +2.033634598336189e-04   +3.834615178692347e-03   -1.843433992278828e-03   +8.841960319812929e-04   +2.324232065820547e-03   +9.765870731969233e-03   +3.134327631837012e-04; +4.473790896872519e-03   +2.012647279908333e-03   -2.788418672726703e-03   +6.762628522680973e-04   +5.643871968878030e-03   +7.372689744845129e-03   +6.010186616085244e-03   +2.745754789037164e-03   +3.074654925576502e-03   +6.409707856901091e-03   +2.994717220113797e-03   -3.520883539729530e-03   +7.918471960851501e-03   +3.214303388002522e-03   +5.425793082686143e-03   +7.465793948315914e-03; -2.520205361122027e-03   +1.738202325980252e-03   +4.154277046442641e-03   +8.302627838265495e-04   +5.608955956749799e-04   +4.147549364859465e-03   +8.792126874164816e-03   +1.053046909536940e-03   +8.738439488342079e-04   +1.619213327517572e-03   -2.712205968051459e-03   +9.170301238915216e-03   -1.935387595649925e-03   -3.297012620762472e-04   +5.708877466662141e-03   +4.971111943902167e-04; +6.216048140577516e-03   +9.116175696505449e-03   -8.630261689470809e-04   +2.909622061872267e-03   +1.744673514170089e-02   +4.639089277937242e-03   +1.956833372550564e-03   +5.567879569146259e-03   -1.017227783649456e-04   -2.324652631105863e-03   +6.310472363434690e-03   +5.858340433854240e-03   +5.627044944267214e-03   -4.455155873156589e-03   +1.768604791570237e-03   +6.988464444235723e-03; +4.415187236548827e-03   +5.041204343204893e-03   +2.571466778500738e-03   -2.977002002312064e-03   +2.754177695202294e-03   +2.291518434881762e-03   +5.488462522093927e-03   +4.690078623669070e-03   +2.686658205013791e-03   +3.285012792517098e-03   -5.658693168534284e-04   -1.969550495226774e-03   +6.611598993846816e-04   +4.045545728074838e-03   +1.168075125052317e-04   +1.910860891781792e-03; -5.205409062620519e-03   +2.591531004334385e-03   +4.251550613074685e-03   +1.848982056310961e-03   -4.242408723140216e-03   +1.331585659124141e-03   +2.252399461348577e-03   +7.521921438209111e-03   +2.270163247791094e-03   +5.087577564912324e-03   -1.948335085854957e-03   +2.671794227749337e-03   +3.116303512111283e-03   +1.845750604170947e-03   +1.346541015546683e-03   +3.539176177848781e-03];
L2I_L2E_iAMPA_netcon = [-2.665350360830332e-04   +1.027718165376373e-02   +2.060760655573403e-03   +8.728008745046058e-03   +5.074172330802852e-03   +3.536789394420865e-03   +7.531301618280272e-04   +6.425750210379262e-03; -8.874697946484538e-04   -7.431467479723952e-04   +1.249405514651920e-03   +9.119256207821317e-03   +1.311927594295798e-03   +1.133510491259518e-04   +3.651548935370279e-03   +3.297929415687682e-03; +7.773133372856904e-03   +5.355123327851051e-03   +7.530986136147002e-03   -3.476093685060717e-03   +4.079315755414337e-03   +2.916426597672357e-03   +2.875302297218859e-03   -3.727389075785667e-04; -7.901122602668506e-04   +7.418894067265085e-04   +1.049329954771220e-02   +8.324708312887714e-04   +5.875917378240549e-03   +5.606101251431446e-03   +1.243224303827060e-03   +1.117003293328704e-02; +4.329796816493672e-03   +5.572687614258680e-03   +5.366914537975862e-04   -5.118454192061748e-03   +6.688238761947202e-03   +5.358975736225217e-03   +6.229523405567181e-03   +8.091170394737097e-04; +1.317835022024148e-03   -1.921170696775603e-03   +4.008558469665205e-03   -4.585868976691459e-04   +6.117703590270267e-03   +5.834277079791085e-03   -6.195421860068454e-03   +6.600940619658667e-03; +6.530168295624007e-03   +4.309087675336458e-03   -9.707002224621462e-04   +1.722653981265876e-03   -2.908222303113554e-03   +4.978816612361354e-03   -6.808672328399651e-03   +6.325711781232288e-03; +4.829933063758061e-03   -2.079813995950469e-03   +2.345936439801268e-03   -2.939343705418370e-04   +4.519148386954423e-03   +5.005115371244470e-03   +5.632625378269402e-03   +1.165600470517919e-03];
L2E_L2I_iGABA_netcon = [+4.006214510792595e-03   +2.841390979161282e-03   +3.367214462048956e-03   +5.037737324345960e-03   +8.814518700229144e-03   +4.031313600269365e-03   -2.758839361049229e-03   +5.700262627105578e-03; -3.498794497046845e-03   +2.801463320699089e-03   +6.128274907871474e-03   -3.388586924013861e-03   +7.464865683682590e-03   +4.291061606052768e-03   +9.814434153181643e-03   -7.513054426148555e-04; +4.969883254178091e-03   -1.972901620099624e-03   +7.644741732574568e-04   +2.098543414701769e-03   +5.535502166880052e-03   -4.763999104148159e-03   +3.822803192083265e-03   +4.837778111132613e-03; +3.171445480920250e-03   +2.547221354403982e-04   -2.804556582494399e-03   +2.934970219550326e-03   -2.339432951165168e-03   +3.383506094357205e-03   +2.436279056352565e-03   +3.374144031554581e-03; +3.100482650544904e-03   +2.152086949994076e-03   +5.730835096968852e-03   +7.231179158475350e-03   +2.547862361593276e-03   +1.143192510269474e-03   +5.376950743076204e-03   +1.652851794122623e-03; +6.095875607976043e-03   -5.261752153983715e-03   +3.825559448049794e-03   +7.482305260270493e-03   +3.169698345074128e-03   +1.357216093079844e-03   +3.777131142046780e-03   +1.038054501392109e-03; +7.644892481901598e-03   +3.608759650694725e-03   -3.788310075916104e-03   -1.572632334681333e-03   +4.551063234175262e-04   -2.173141396495900e-03   -4.055303363468162e-04   +9.700419122649506e-04; +9.678082422204106e-03   +2.014982498541890e-03   -8.495435614302147e-05   -2.633413699742336e-03   +1.704878540498546e-03   +4.484900544384117e-03   +1.278452887953797e-03   +2.085158570503699e-03];
L3E_L2E_iAMPA_netcon = [+2.258861074478529e-03   +1.225234906836927e-02   +1.146512408990884e-03   -2.638341691769572e-03   -4.144373922796547e-03   -6.223137203563135e-04   +5.198069683290391e-03   +8.949249033057414e-03   -2.505057437797990e-03   +1.703886901253049e-03   +1.054687175682143e-03   +1.216696868139119e-03; +2.617869910229633e-03   +6.470017247618452e-03   +5.910792690750417e-03   +3.182356411998439e-03   -2.208850451179249e-03   +1.221865264724493e-03   +5.795561925390204e-03   +9.712366194712536e-03   +5.668149882249528e-03   +2.826663108791716e-03   +1.462459905351711e-03   +3.224195564574644e-03; +6.677580632717783e-04   +5.673690306562180e-03   -5.414334201603393e-03   +2.874035877479804e-03   -1.840281359612358e-03   +7.985763712613786e-04   +4.338419966827327e-03   +4.420228107533265e-03   +6.276606170689402e-03   +2.591754315712404e-03   +8.482566853052301e-03   +4.694331371373538e-03; -1.386433079194127e-03   +4.299002470029966e-06   +8.114513699894813e-05   +5.658786384734937e-03   -2.261638895597533e-03   -1.744182843587097e-03   +3.195377533472788e-03   +4.814095077387132e-03   +5.822345085673758e-03   +6.890957373541332e-03   +4.114821830378468e-03   +3.943573729869416e-03; +3.998609289106625e-03   +2.728995682150851e-03   -5.531354875512077e-04   +9.994006746525945e-03   +1.124387848761681e-03   +1.661372484143624e-03   +5.130314603522360e-03   -5.169075843249237e-03   -2.026654559379151e-03   +1.286774057828525e-02   +7.864322935348996e-03   +4.737399846617711e-03; +1.014389300257169e-02   +3.246028864893693e-03   -3.127949250218340e-03   -1.862252088227598e-03   +2.694235709078334e-03   +9.818477130957792e-03   +7.492762982581015e-03   +5.775855001267247e-03   +5.353254754601206e-03   -1.466943924103294e-03   +5.265658845485964e-03   +3.195380688139955e-03; +7.585255467309785e-03   -2.450287637919067e-03   +5.304746517494865e-03   -8.282343547859463e-04   -4.021288444654694e-03   +3.908969609787936e-03   +8.230862307811898e-04   +8.995361419996665e-03   +1.524206064087115e-03   +5.011720599778207e-04   +6.568524045996106e-03   +3.237330839797080e-03; +1.618053194506876e-03   +1.232600055167894e-03   +2.443750671729022e-03   +8.303530327424084e-04   +4.055005414851600e-03   -5.011606004690569e-03   -3.206472151398028e-03   -7.723660252766353e-04   +1.424277415847844e-04   +7.695245506713485e-03   +2.838559729102234e-03   +2.499982473559532e-03];
L3I_L2I_iGABA_netcon = [+2.212585115450418e-03   +5.127439271220350e-03   +6.362645776825562e-03   +1.016185407121320e-02   +4.283349583869688e-03   -2.664448145097745e-03   -3.460895942648333e-03   -5.030104900019887e-03   +2.523407981052519e-03   +2.230179681905831e-03   -7.805600479039027e-03   +1.198057069103097e-02; -1.488300622415329e-03   +2.137358007973195e-03   +5.542015987226713e-03   -2.211909648472838e-03   +7.282590626746546e-03   +4.315887550958034e-03   +6.099774298059506e-03   -1.402805376663898e-03   +5.679267486349121e-03   +3.686127006178071e-03   -1.793264552514099e-03   -4.130378411839566e-03; -6.372390562731804e-04   +2.394165674466917e-03   +4.914581387137454e-03   +6.210671055811368e-04   +9.456377737936174e-04   -2.627191287632447e-03   +1.040509643955857e-03   +2.081377803738107e-03   +7.023598352587955e-03   +2.016927092168261e-03   -1.386170309965149e-03   +3.714348317396861e-03; +9.213187646475881e-03   +2.675046862079112e-03   -2.122657952153681e-03   -4.040724032234455e-04   -7.579165366215476e-04   +7.365045755994219e-03   -2.581244583777411e-03   +2.497090365988811e-03   +5.797831731164689e-03   -3.490003716613779e-03   +4.357807900430465e-03   +9.148453151163517e-03; +2.987124694941338e-03   +2.317996334907293e-03   -9.987212749388659e-04   -2.197040958537645e-03   -5.521951695023272e-03   +8.351984747382532e-03   -4.323500969243772e-03   -6.021585529823242e-04   +7.905814510512877e-03   +1.275789422735818e-02   -3.468331873238103e-03   +1.195582631355373e-03; -3.611306687420941e-03   -3.530888416027638e-03   +1.652505397959982e-03   -3.137250740224405e-03   -5.694099692172530e-04   +1.915306050140955e-03   +4.299821890743153e-03   +5.247379183997036e-03   -1.729068792174722e-03   +2.517112642114174e-03   +4.570232318183575e-03   -7.607275106614470e-04; +8.288802388920227e-03   +1.037670258221979e-03   +6.569267137442888e-03   +7.808501366909614e-03   +6.251481534447212e-04   +5.725806433691450e-04   +5.705563198970528e-03   +4.310268465030771e-03   -1.294159171809881e-03   +9.125235158047917e-03   -1.521955580620069e-03   +2.115161777905225e-03; -9.242197002028516e-04   -4.258352543612155e-03   +5.336411917245903e-04   +5.618787177145356e-03   +4.813163429941035e-03   +3.261474219144763e-03   -3.028898794481217e-03   -4.241292368446310e-04   +1.083231578924306e-02   +5.245945907171147e-04   +5.116244538627874e-05   +3.147772417637040e-03];
L2E_L3E_iAMPA_netcon = [+4.948909015360436e-03   -7.788958560646529e-04   +3.820738374864915e-04   +6.718285547741168e-03   -5.226616678957091e-03   +3.318957969207539e-03   +6.643778001304152e-03   +5.935494284289536e-03; +4.717556792375639e-03   +4.076090911468555e-03   +1.000938486140328e-02   +8.998871259294761e-03   +8.538776813749302e-04   +4.601526378200789e-03   +6.248873352074188e-03   +4.923423525676542e-03; +4.631421475069328e-03   +6.738211653062112e-03   +9.293410504670680e-03   +2.813061215681333e-03   +1.801172058605967e-03   +4.329710726709722e-03   +6.327021142166581e-03   +5.612187715307914e-03; +4.748738974351071e-03   +1.079994682690447e-03   +5.876563904654416e-03   +2.698361310521605e-03   +2.098173930721841e-03   +2.466987026192666e-03   -7.450571397225594e-03   +3.832262810675098e-03; +3.556499559827526e-03   -2.026839042507642e-03   -2.895236505122222e-03   +6.502163251255049e-04   +3.284823718068517e-03   +3.651254268625604e-03   +7.174511568705853e-03   +3.562257410234774e-03; +5.170756496065388e-03   +2.913741619078708e-03   +2.527093727852005e-03   -1.573717148877581e-03   +2.926899223042031e-03   +9.310059588845208e-03   +1.254976616964585e-04   +1.041858615425540e-02; +6.618174889064393e-03   +1.789036912987516e-03   +6.084437089731016e-03   -3.209824488616317e-03   -1.037868972997880e-03   +3.614354265750397e-03   -3.482049641719402e-04   +3.694733350860657e-03; +1.241713238929885e-02   -2.452574584316442e-03   +5.202078659185212e-03   +6.423009990879924e-03   +3.911663712299813e-03   +6.340817595744823e-03   +7.435088787196649e-03   +4.275889778716132e-03; +3.019434272319465e-03   +3.465882452265380e-03   +2.211098254318039e-04   +7.705705058032006e-03   +6.403429430015208e-03   -3.577026366869419e-03   +2.915755529680584e-03   +1.293038387539758e-04; -1.610269835547510e-03   +1.673651875407462e-03   +1.147472606888434e-03   -2.023721559335402e-04   +7.487228155841670e-03   +1.517620173761086e-03   -1.847745162117899e-03   +6.989034233743949e-03; +2.167931294792054e-03   +1.139980137836724e-03   +7.207929199998694e-03   +3.534026839030126e-03   +1.157390575698301e-02   +6.115462682208807e-03   +1.620585918103793e-03   -1.297762696212480e-04; +4.675013495606505e-03   +3.778520081539114e-03   +2.278077003782210e-03   +6.859662361860431e-03   +6.740433988649600e-03   -3.591865860672859e-04   +5.298153994327158e-03   +5.062536764362774e-03];
L2I_L3I_iGABA_netcon = [+7.472527734476059e-03   +6.818387103807381e-03   +3.501160228038464e-03   +5.350640098740273e-03   +7.267309842859802e-03   +1.779694917631457e-03   -1.891342364457391e-03   +5.973342122323165e-03; +2.001509241869271e-03   +1.566012563465686e-03   +4.155559894829791e-03   -5.608988023875789e-04   +5.363048748739254e-03   +7.998197807414013e-03   +8.003626650129824e-04   +4.217520490569296e-03; +2.694408976646672e-03   +2.481196322945456e-03   +6.237370677744340e-04   +8.694241612105922e-04   +7.631189993683736e-04   +4.924302141848237e-03   +8.486994113741509e-03   -2.345732194284115e-03; +1.677249027339400e-03   +9.287034220562363e-03   -1.536206145438634e-04   +4.829284901464495e-03   -9.537569845859829e-03   -2.779023350415555e-05   +6.992015828538354e-03   +4.707451259113794e-03; -3.767030896401535e-04   -3.241071467875087e-04   -1.755003828250675e-03   -6.760804531644414e-04   +6.405204837308545e-03   +3.157953372293252e-03   +3.424103342788581e-03   +3.146228039466642e-03; -3.228799581722714e-04   -3.171738627096374e-03   +5.019221747238590e-03   +6.480931463599071e-04   -2.050413997472618e-03   -5.045078844082077e-03   +1.309153207301310e-03   +9.650403151681917e-03; +1.433263831072369e-03   +3.269214084298967e-03   +5.586987299283743e-03   +2.415114443341965e-03   +2.345063485175676e-03   +5.864638453512779e-05   -4.381770511507812e-03   +4.639676187370986e-03; -1.560119237431426e-04   +2.080653905349393e-03   +7.527893558174670e-03   +1.881885347542481e-04   +3.112772763651077e-03   +9.902815584451476e-03   +3.732379551252969e-03   -1.088995963293929e-03; +7.515125106373651e-03   +2.793168259333598e-03   +9.605254247597683e-03   +5.056421507235815e-03   +4.826044047795595e-03   -7.055250917999921e-04   -1.963556008340788e-03   +7.579645155706056e-03; +5.750848808681149e-03   +4.635855493242319e-03   -1.640634604776394e-03   -3.876812221204861e-03   +2.183546574772223e-03   -2.663245372508725e-03   +4.254637925971660e-03   +3.384194548558383e-03; +3.282253836431679e-03   +8.599164339011155e-03   +3.336596362626477e-03   +2.955816771836026e-03   +2.091471325846954e-03   +4.513837266055060e-03   +7.734066289952173e-03   +4.504039218608660e-03; +1.484214672519007e-03   -6.405972858710835e-03   +1.822797553014855e-03   +7.315841606139543e-03   +8.300615781522793e-04   +7.107035026736703e-03   +7.501370778788239e-03   +6.234810783753469e-03];
L3I_L3E_iAMPA_netcon = [+6.721906775866450e-03   +4.180781637299688e-03   -1.853680540161333e-03   +5.267907574788427e-03   +8.194032273193276e-03   -2.794857455920165e-04   +3.521058841544062e-03   -6.181447392747451e-03   +4.870598016639676e-03   +3.068907137319106e-03   -1.268949808432329e-03   +6.242031338327994e-04; +3.295875030549591e-03   +1.271101951257858e-03   +5.994527422388160e-04   +2.815110599137977e-03   +6.281304669774275e-04   +3.818634820969302e-03   +8.070167591695014e-04   +2.725563008118494e-03   +3.565173872519893e-03   +3.458331254619861e-03   -8.505382252527026e-04   +5.661504734691973e-03; +1.486186887789260e-03   +3.359099332311100e-03   +2.747705225111645e-03   +3.173394103809399e-03   +2.350658596627988e-03   +6.543352749459989e-03   -7.867669356801943e-04   +7.266572666698176e-03   -1.008842181422036e-03   +4.014980703612951e-03   +2.457266823249223e-03   +3.789217663530554e-03; +6.622056283579963e-03   +9.721303940611289e-03   +5.025566731904949e-03   +2.613259308258559e-03   +7.586876291002647e-03   +8.104633031098315e-03   +7.115126149413412e-03   +2.319614851615494e-03   +6.771964910370595e-04   +7.491128816598212e-03   +1.911777666437983e-03   +9.193740977323584e-03; +2.896367074391061e-03   +3.559268616767174e-03   +3.040822716126501e-03   +5.335200897864923e-03   +1.026359970181376e-03   +4.310132327595820e-03   +2.354890559250508e-03   -1.921262366282855e-03   +2.989551005745155e-03   +3.596431827773651e-03   +6.353043101590751e-04   +2.009303210415619e-03; +8.909895920783178e-04   +1.082272453633546e-02   +4.372280948695213e-04   +9.600948627018052e-03   +3.148655674418784e-03   +3.577373176152370e-03   +8.266511403455364e-03   +4.756788955908449e-04   +3.479180845972863e-03   +1.532179076574026e-03   -6.487030279633215e-03   -5.944173165925775e-04; +2.238986419653988e-03   -8.965604059331258e-04   +2.890517421026991e-03   -1.452337878697480e-03   +7.434729026335102e-03   -9.074060752354465e-04   +1.443755053794233e-03   +7.602518236328439e-03   -1.212887027513961e-03   +6.464259298838877e-03   +1.525581439030145e-03   +5.090060682805264e-03; +7.122898646010550e-03   +5.176705257049255e-03   +9.308694824985390e-03   +7.398759303161603e-04   +6.006399016831370e-03   +2.149069938492452e-03   +3.161814710982386e-03   -1.115549510988038e-03   -5.652054958810706e-05   -6.630282682305781e-04   +6.378235146971944e-03   +1.415619797935231e-04; +5.518121459287893e-04   +1.155766370325646e-03   +8.641781165801399e-04   +1.255124684489033e-03   +2.771070801579171e-03   +4.214218146380627e-03   -4.027819542546685e-03   +6.769400650499845e-03   +1.004087349434649e-02   +4.607721652556119e-03   +2.701665767131152e-03   -1.855560929992126e-03; +1.313168520283275e-03   +6.484870244790155e-03   +8.968841186178748e-03   +1.902097272069534e-03   +4.735406711545572e-03   +3.954115948681847e-03   -2.014839349720915e-03   +1.170156042810782e-02   +4.624338830535936e-03   -1.535211144784386e-03   +3.160444915236572e-03   -8.668732882856430e-04; +1.716217171701652e-03   +1.121479140174429e-03   +1.168695673100378e-02   +3.832829946410074e-03   -1.886076513662692e-03   +2.065978813669242e-03   +2.181128834730729e-03   +1.439254222951870e-03   -2.935628508560456e-03   +2.634198061776907e-03   +6.378784852530605e-03   -1.439109514089567e-03; -5.551011770792727e-03   +3.459044289907645e-03   -2.904237041592858e-03   +6.807504187248323e-03   +6.748474386954939e-03   -7.796693478845437e-04   +7.831170342847821e-03   -6.919608821386078e-03   +2.109640919616475e-03   -2.718911680656223e-03   +5.157307529063627e-03   +6.072723559017631e-03];
L3E_L3I_iGABA_netcon = [+3.036466138132385e-04   +3.314680932589214e-04   +2.576506089638055e-03   +8.434075198923101e-03   +9.627066133323203e-04   +1.179968261565808e-02   +3.418933605194587e-03   +4.075262666535030e-03   -1.273589644261530e-03   +5.354682241161156e-04   +3.421948562273059e-03   -1.920022328353772e-03; +5.316975980710277e-03   +1.604555762971621e-03   +2.138981549753317e-03   -5.181728658524900e-04   +6.487351965633299e-03   +4.893040378971735e-03   +1.762017320759616e-03   +5.822711169791172e-03   +4.174832134705248e-03   +7.693331092094313e-03   -1.625950350139094e-04   +3.758769741059086e-03; -2.651741322374183e-03   +2.512539353817176e-04   +6.186153660746204e-03   +5.436487472342931e-03   +2.482892425851357e-03   +7.748107788704113e-03   +1.267738265966318e-03   +1.288650950763467e-03   +3.706998976459749e-03   +7.183440046487562e-04   +4.683292629742817e-03   -5.653494479562830e-03; -2.997706902240238e-04   +4.300356538787505e-03   +1.362618416869101e-04   +9.566570820714588e-03   +5.285288222879923e-03   -1.809936577384965e-03   +3.481413654250588e-03   +3.032796322065415e-03   +6.779893609685429e-03   -7.107792630932707e-04   -2.473505702658751e-03   +6.473319689023527e-03; -5.830835450308403e-04   +3.005834590553679e-04   +7.257355277663587e-03   +7.907369126299130e-04   +4.524356913075537e-03   +4.952348560668961e-03   +5.496911128185230e-03   +8.985471973889256e-03   +3.457798438627819e-03   +3.561158391292243e-03   +8.403335421293720e-03   +5.112628388946281e-04; +5.101660954894990e-03   +3.564108489048137e-03   +8.476285575136119e-03   -3.479984896850578e-04   +3.683233408195024e-03   +6.774421734491479e-03   +4.408256950340349e-03   -7.126063426020181e-03   +2.135178336681217e-03   +4.074210753907154e-03   +5.399955655616151e-03   -2.771012068650632e-04; +5.711554818996752e-03   +3.599848237393148e-03   +3.278482109392983e-03   +1.097917279644291e-03   +2.756268880084780e-03   +4.868915189771561e-03   -1.780187507725683e-03   +1.652381186572742e-03   +3.812393154540685e-04   -3.342115034861557e-03   -1.015027355032422e-04   +7.338509841218301e-03; -6.157672697417868e-04   +5.860034047686469e-04   +3.431741217238749e-03   +8.965211906193095e-03   +2.602427227160838e-03   +1.615371621754882e-03   +4.782545463549631e-03   +3.248865339472767e-03   +6.213017477715604e-03   +6.486587022318918e-03   -2.834551059914545e-03   +6.996141950774956e-03; -7.011183945397107e-04   +3.316485453999511e-03   +4.633719608233547e-03   +1.454151976592620e-03   +4.166379000861395e-03   +9.454802641009197e-03   -7.404435903256032e-04   +7.250460498199477e-03   +3.210110487384122e-03   +6.860758285874227e-03   +1.990099038633325e-04   +4.911300457504181e-03; +2.388551974257354e-03   -2.634862954025207e-03   +7.882175774258548e-04   -4.875357831781913e-03   +6.867262290566340e-04   +7.863212280124253e-03   +6.704228286073593e-03   +3.150978452416723e-03   +4.430090801428969e-03   +5.657679823909720e-03   +4.069358979359612e-03   -6.745721295776787e-03; +3.134658999455960e-03   +2.758647407945549e-03   +1.899878382529584e-03   +3.074528226008865e-03   +7.384290429363672e-03   -3.658637680859192e-03   +8.793256638648394e-03   +2.372824496731444e-03   +9.366444554482758e-03   +6.436483066425016e-03   +4.689017860753347e-03   +5.351058264849470e-03; +7.292245729625457e-03   +5.548267762345650e-03   -3.464490575296113e-04   +5.959446922680006e-03   -9.404725727729023e-04   +1.619628415662793e-03   +8.616565948992613e-03   -5.019154369083022e-03   +1.175713681355560e-02   +2.281876171607044e-03   -6.564765001626810e-04   +3.087174827934889e-03];
L2E_Input1_iAMPA_netcon = [+1.683360017548534e-03   +1.234578211563956e-02   +4.880180000279264e-03   +5.821813049944858e-03   +1.036941445101302e-02   +4.130676633786357e-03   +2.517768362149929e-03   +2.958889496529805e-03];
L2I_Input2_iAMPA_netcon = [+7.130805339812882e-03   +8.816440553099263e-03   +8.008796435737243e-03   +5.869480531894822e-03   +4.820379491889478e-03   +4.063198894189341e-03   +6.245358811796242e-03   +1.073176322568600e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
