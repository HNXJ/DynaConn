function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.262376576131982e-01   +3.566149488531086e-01   +5.591756472523627e-01   -1.344575825297510e-01   +2.962122940629422e-01   +7.620186836883519e-01   +6.086667248653026e-01   +4.047810825012779e-02   -1.012930056479122e-01   +1.403111748746754e-01   +5.653801686448056e-01   +2.587635816398278e-01   +5.904153988941827e-01   +3.613809167246374e-01   +5.794066335072595e-01   +2.685366183935711e-01; +4.572007660833199e-01   +2.295276675136453e-01   +2.265445892074283e-01   +5.541902212124247e-01   +5.363199758921672e-01   +2.005379801706806e-01   +2.248575517786242e-01   +2.635663433885717e-01   -1.824585907329543e-01   +3.403965276045679e-01   +5.085616391155537e-01   +5.065490571168596e-01   +6.239425189859492e-01   +3.447579457141321e-01   +7.087988611897935e-01   +3.436540044051087e-01; +2.223550075300568e-01   +2.249725791763663e-01   +4.312048481563671e-01   +6.394293473103133e-01   +5.155204773274735e-01   +1.374924457332988e-01   +2.731493092493915e-01   +3.736315191937015e-01   +4.253622175753056e-02   -3.812071624090963e-02   +3.547392456109318e-01   +7.463344684653690e-01   -1.740170605873447e-01   +2.798052838632516e-01   +3.898128099961452e-01   +3.235321903416574e-01; +2.054018713864566e-01   +5.314262492271438e-01   +6.357309489640532e-01   +7.510769066764730e-01   -7.155404354360398e-03   +6.480510999106796e-01   +8.010854780718889e-01   +3.333931393546771e-01   +6.941809292798437e-01   +5.843173583523003e-01   -4.947827284906244e-02   +3.877969215387336e-01   +5.545529441259455e-01   +5.334333968104344e-01   -1.321534409399951e-01   +2.084624842942130e-01; +7.886335139405836e-04   +2.956973362353670e-01   +1.674457123320239e-01   +3.854397115456715e-01   +6.575300720558748e-02   +1.831639682879996e-01   +3.774793659486653e-01   +4.922707437470513e-01   +7.407633234303439e-01   +1.214482736971319e-01   +6.548220824050417e-01   +4.129415700087260e-01   -1.838243898494615e-01   +6.320008853399295e-01   +3.647380384238141e-01   -2.304207505684513e-02; +5.574866410360414e-01   +8.705817237201922e-01   +3.995381376845986e-01   +3.230510915220323e-01   +1.482354614677839e-02   +6.349639829646434e-01   +4.214768819862916e-01   +3.919525545762186e-01   +2.190507294261573e-02   +7.644154447237492e-01   +2.179684546223239e-01   +4.155167207951069e-01   +6.321915874221403e-01   +5.563529936032470e-01   +7.787195210055953e-01   +7.146384459472571e-02; +6.162398379096400e-01   +3.471319457428206e-01   +4.939916052791372e-01   +3.511162618078642e-01   +4.001891586300905e-01   +3.126906878608794e-01   +2.647017047852468e-01   +1.742870745085782e-01   +3.011169072312490e-01   -1.161507057578123e-01   +1.889541791364698e-01   +5.691073089711371e-01   +3.227755058870788e-01   +2.553778357353420e-01   +5.155549674034253e-01   +1.117340336658885e-01; +3.850496189714915e-01   +2.712561275300999e-01   -8.947274933889406e-02   +1.887454239428416e-01   +5.336649458858755e-01   +3.559265994080898e-02   +3.107484493176227e-01   +3.800862085280391e-01   +2.094275632689244e-01   +2.618146076190944e-01   +1.723214474778428e-01   +3.089028392867180e-01   -3.490756698685550e-02   +5.673198553378237e-01   +8.681252134512500e-02   +8.922584915715120e-02; +5.166608264494486e-01   +2.862066511515621e-01   +5.304712151282317e-01   +3.136336862402577e-01   +6.569351588746440e-01   +3.996864495512920e-01   -1.518591864514337e-01   -2.312820374894510e-02   +2.240920797188854e-01   +2.652080168099265e-01   +4.968906068548942e-01   +4.300337306768731e-01   +3.439927857957368e-01   +5.314715338592054e-01   +2.268705169785161e-01   +2.657096562478705e-01; -8.015506430662907e-02   +6.567517435864519e-01   +3.171586702238405e-01   +1.808443648616946e-01   +5.018560838581286e-01   +6.823006258871996e-01   +4.867509623057512e-01   +2.351874384209366e-01   +4.023045035950806e-01   -9.597490375919770e-02   +2.986634323341848e-01   +5.590391616168110e-01   +2.012423659790448e-01   +1.317739038673912e-02   +4.299138180539226e-01   +1.526997722560380e-01; +1.606455776036347e-01   -2.702991397858336e-01   +4.320405082774524e-01   +5.603373441719435e-01   +3.026491080978362e-01   +4.246568326093784e-01   +5.933247615660802e-01   +1.761692858060932e-01   +7.783104554274884e-01   +4.748489325915535e-02   +3.098942242220072e-01   +3.369203313870430e-01   +1.473605204323159e-02   -1.840532048110878e-01   +6.660313814979876e-01   +7.680378830647933e-02; +1.112470085787196e-01   -8.167442276637214e-02   +7.808417035521407e-02   +3.285130249394515e-01   +2.234486348544679e-01   +5.364725711142738e-01   +2.850742325060029e-01   +5.882741627467769e-01   +4.232756876306286e-01   +3.513336865987780e-01   +1.948625018970508e-01   +5.224290071947870e-01   +3.395544490902391e-01   +1.905542411018371e-01   +5.181806410627409e-01   +6.458474282429242e-01; +1.686257696498922e-02   +9.553005170340237e-02   +3.247792975704525e-01   +2.826994561747900e-01   +4.279607503608530e-02   +6.010007949933908e-01   +4.815418280319376e-01   +2.820687347666825e-01   +8.219801617576330e-01   +5.552264380630557e-01   +2.921133126883581e-01   +5.937494317944954e-01   +5.368520050664409e-01   +5.175395287800133e-01   +1.000000000000000e+00   +4.605044651758647e-01; +4.093082455439907e-02   +6.360981583249774e-01   +6.059793443077304e-01   -4.928323902999122e-02   +1.742124891300407e-02   +5.355221044633365e-01   +6.084336073566955e-01   +2.638861517364031e-01   +3.852536553605068e-01   +4.591378104017114e-01   +4.165932984536818e-01   +2.540907470353590e-01   +6.213223575717258e-01   +4.560941974815387e-01   +8.064916225988208e-02   +3.213379963794252e-01; -2.267088749501278e-02   +2.122278034283118e-01   +6.622035676988183e-01   +1.265695936592127e-01   +1.959880288117904e-01   +1.898974430511429e-01   +6.881075862622564e-01   +5.011439683687072e-01   +1.414522348182270e-01   +4.108077159478045e-01   +8.978064076187209e-02   -1.340143572636459e-02   +7.540051059568396e-02   +1.372459633945884e-02   +4.981705846175949e-01   +1.062201441289676e-01; +2.615544905006271e-01   +3.617291552632558e-01   +5.513674357187884e-01   +5.167344943218704e-01   +4.982764489938310e-01   +4.016114397612541e-01   +1.953971430553902e-01   +5.290828632739127e-01   +3.007783428784267e-01   +4.537502059544317e-01   -1.586801131527902e-01   +3.581152351200120e-01   +3.827314074029400e-01   +5.201714421367915e-01   +6.575530635106400e-01   +6.107692655923054e-01];
L1E_L1I_iGABA_netcon = [+5.715742471108047e-01   +1.950627347454570e-01   +2.262136079492898e-01   +4.258356314318035e-01   +4.770320240723630e-01   +2.431330664349998e-01   +7.959787575190448e-02   +3.474891400336169e-01   +6.166128788417281e-01   +1.477780295117171e-01   +7.737887254881621e-01   +4.479645351254261e-01   +2.359903023093460e-01   +6.607165142069035e-01   +3.981189213707490e-01   +1.661382219638280e-01; +2.994065589699148e-01   +2.301492776940266e-01   +5.994339209358028e-01   +5.518227610232538e-01   +3.562433966344793e-01   +8.510359474751555e-02   +4.068159070177085e-01   +1.179265102374716e-01   +2.686490909434856e-01   +3.691944961227070e-01   -1.021936125612332e-01   +3.397154448320232e-01   +2.748008217873342e-02   -2.672461112531966e-02   +4.010654756685382e-01   +2.258783496720442e-01; +4.178056868640713e-01   +3.003571587554670e-02   +3.285678596108075e-01   +4.336920474055206e-01   +2.303629390232909e-01   +3.597034065405614e-01   +1.932882850713306e-01   +4.460308031512093e-01   +2.532043647076992e-01   +2.149828565185288e-01   +2.199206642145359e-01   +3.011811109479364e-01   +6.924722231206814e-01   +4.212726223992366e-01   -2.568637239928014e-02   +4.527388633521074e-01; -1.126641888082882e-01   +6.178507360859995e-01   +5.849810928749259e-01   +4.956914617496174e-02   +5.234555125233300e-01   +5.416450930595398e-01   +1.448773969770734e-01   +2.117763087010174e-01   +1.118208462962538e-01   -7.160937401690924e-02   +7.557360049074856e-02   +2.820950035522791e-01   -2.224305720842631e-01   +4.302322415517836e-01   +1.904983598156011e-01   +4.058398954929319e-01; +6.757193587586875e-02   -6.618622452016841e-02   +7.594068144108211e-02   +3.579782963189113e-01   +1.070126192147381e-01   +5.849809190385756e-01   -2.287501879478175e-01   -1.840541490342611e-01   +1.359932011340038e-01   +3.065567760046938e-01   +3.945667799452250e-01   +7.028997548909437e-01   +2.334719852507924e-01   -1.942966756370577e-02   +6.061002785886402e-01   +1.000000000000000e+00; +5.856040131262997e-01   -1.469799845822755e-02   +1.012317246145261e-01   +4.042601081272964e-01   -6.713964597838869e-02   +3.944746897791253e-01   +1.843776749552007e-01   +8.728827128509713e-01   +2.117055518326606e-01   +9.027968060862959e-01   +7.314419801752221e-01   +6.413267694119835e-01   +3.133477426333645e-01   +2.314013796509777e-01   +1.098905339863013e-01   +3.674637950487830e-01; +4.276863451558168e-01   +3.190647188539065e-02   -1.753535356248767e-01   +2.604294800803060e-02   +4.969010720153330e-01   +3.134416673371732e-01   +5.937966255233972e-01   +1.888268430124784e-01   +5.244115768447715e-01   +6.442848321979041e-01   -9.954722546047003e-02   +6.681338035424925e-01   +1.148959762210879e-01   +4.301677241643618e-01   +1.263959645166471e-01   +1.712944812369068e-01; +5.162782155420239e-01   -2.918609912535751e-02   +6.239958085723877e-01   +7.868324455579271e-01   -5.080212449654268e-03   +4.709689680248063e-01   +1.198469320598866e-01   +5.094261497398654e-01   +5.162642608247213e-01   +2.577312446668097e-01   +1.386637895405966e-02   +6.275119645178642e-01   +4.680212589195866e-01   +3.253577592581471e-02   -4.102701691876139e-01   +2.444961049420245e-01; +1.067870719102605e-01   +4.436188958835932e-01   +3.654704711403933e-01   +1.205036311393906e-02   +5.906490006843865e-01   +2.160974617261517e-01   +4.405632580320775e-01   +3.878590891569196e-01   +1.961096850169470e-02   +6.521653106250942e-01   -4.664616419319721e-03   +3.400121213450032e-01   -3.947127659842142e-02   +2.371208075495801e-01   -1.468735396256821e-01   +2.473707607194126e-01; +3.382984684552049e-01   +3.706650213097900e-01   -6.219260298855884e-02   +4.597658819909648e-02   +5.270328973084200e-01   -2.507596498862238e-01   +3.054032306502230e-01   +9.384400803727095e-01   +2.153420390430461e-01   +3.783343579021891e-01   +3.444576313992217e-02   +3.989635559235652e-01   +3.847109875576902e-01   +1.677392517308041e-01   +4.581020732657270e-01   +6.801991146896651e-01; +6.382998549879514e-01   +3.348296004490319e-01   +6.033911245046668e-01   +5.243651332129652e-01   +5.335635421440835e-01   +2.641714138086692e-01   +9.368103999993033e-02   +1.599245064435003e-01   +6.605955560858716e-01   -1.120021275385430e-01   +3.223833321076921e-01   +4.950274675443081e-01   +3.458197940101924e-02   +5.945672180074409e-01   +1.843707774895123e-02   +3.056225329778127e-01; -7.076218689700546e-02   +3.567217235795375e-01   +2.482899325040111e-01   +8.413180204988454e-01   -2.019211268605157e-01   +3.663745629387455e-01   +9.486521043576247e-02   +4.006881533181541e-01   +6.963237482619097e-01   +2.120646963809447e-01   +5.149101643829792e-01   +8.306770837346494e-01   +2.455766260217929e-01   +3.826145552749640e-01   +1.784585378878661e-01   +8.467453949603206e-02; +8.567344542623460e-02   +5.363885904820151e-01   -8.125503406707756e-02   +6.529193740991138e-01   +1.405757200669368e-01   +4.617382771761357e-01   +3.304631407814881e-01   +3.220640967461847e-01   +4.529512386209023e-01   +7.033592876371416e-01   +1.134988120780736e-01   +2.513111535642126e-01   +2.589526269025887e-01   +1.972382998388156e-01   -2.464608251057535e-02   +5.833524045895901e-01; +6.681153161032725e-01   -9.216198208046106e-02   +5.076534272124696e-01   +5.911793658969304e-01   +4.111733080951158e-01   +7.463285993094791e-02   +5.483303690296737e-01   -2.448421400964933e-02   +5.000980874554580e-01   -8.192496840210117e-02   +5.054061147698794e-01   +7.223460443470097e-01   +3.257620147212715e-01   +3.599428109758999e-01   +5.149469141170077e-02   +2.934849589167829e-01; +5.919984776611201e-02   +1.475811504226467e-01   +5.030603858616598e-02   +3.523489124657670e-02   +5.564736068542497e-01   +3.181340443580115e-01   +6.726088626819661e-01   +6.560178689174202e-01   +7.642114996904897e-01   +4.744411432592662e-01   +3.475369748798472e-01   +2.717979003777716e-01   +2.267117530252524e-01   +5.246008474105125e-02   +3.750651401883862e-01   +9.719310637586684e-02; +6.210408117816533e-01   -3.878975464580711e-03   +8.125238121953900e-01   +7.392222449114658e-02   +2.601914657291831e-01   +5.803136124188069e-01   +5.910770371292590e-01   +1.533418186590691e-01   +4.003560374391987e-01   +6.842810937994412e-01   +5.698940079028487e-01   +2.430608881128688e-01   +5.757049705183781e-01   +1.152827752412026e-01   -5.025910158512239e-02   -4.034710517405116e-02];
L2I_L1I_iGABA_netcon = [+4.493166774700065e-02   +6.614222019560640e-01   +7.647566816476238e-01   -6.677625880581817e-02   +5.235557726407305e-01   +2.072051321825372e-01   +2.701423952749656e-01   +4.630964837299003e-01; +2.114004930283170e-01   +6.235274917726518e-01   +3.512595340451745e-01   +1.172924801270388e-01   +6.259390630183231e-01   +1.161066565073700e-01   +5.039872190247937e-01   +9.839314728636606e-01; +1.946049326370589e-01   +2.745484366512754e-01   +5.851093138738193e-01   +8.185709089091384e-01   +3.928354740196900e-01   +4.628093542583481e-01   +7.529859674215171e-02   -6.316773972158674e-02; +4.579083595922336e-01   +2.453698447641295e-01   +5.267847626832181e-01   +9.764112565929358e-01   +2.607776486130595e-01   +1.136703634762277e-01   +4.339158858321291e-01   -9.859380246332813e-02; +1.000000000000000e+00   +7.722207100325268e-02   +2.575174217133596e-01   -4.068233803952714e-02   +7.556201035840547e-01   +1.274610509536116e-01   +9.865039553721393e-01   -2.088425215830916e-02; +5.355767946548198e-01   +6.549146682014650e-01   +7.616166767719210e-01   +7.597453928330231e-01   +8.007980958854261e-01   +7.430878923141280e-01   +6.251546306401502e-01   +7.063699565556161e-01; +6.986263596500245e-01   +5.731191121052932e-01   +4.208891511698940e-01   +1.654875132170994e-01   +7.961091603498550e-01   +3.846435653507306e-01   -2.642425016680278e-01   +5.304262424943916e-01; +7.681215267464020e-01   +3.899594556159067e-01   -2.088031471192510e-01   +6.510546058577359e-01   +5.111986405550606e-01   +6.819238913325335e-01   +7.547170985002597e-01   +1.421579809777822e-01; +4.283548026871149e-02   +3.783193293124976e-01   +1.855061898805513e-02   +1.277749860545560e-01   +4.549602426989115e-01   +7.634544419444980e-01   +3.969366950537770e-01   +1.641814591654290e-01; +7.928945709098343e-01   +7.647939525659131e-01   +6.419323654891146e-01   +4.513294047400443e-01   +3.892948630153627e-01   +3.370354107767124e-01   +6.338643411718523e-01   +2.529261573853257e-01; +4.646291978060172e-01   -1.044113772663535e-01   +7.239569416345341e-01   +6.161354937990551e-01   +1.040048531241799e-02   +3.631787734117043e-01   +3.968794979632894e-01   +2.234922334987289e-01; +4.833977607983655e-01   +6.154199359391262e-02   +3.152072684889328e-01   +5.715903723075455e-01   +1.697190163317723e-01   +4.884099497704686e-01   +1.409135578350841e-01   -1.968621628631249e-03; +8.461965488962706e-01   +9.240014075154256e-01   +2.573246017642272e-01   +4.171385947308309e-01   +4.625002106403543e-01   +5.735983192396878e-02   +2.038897453167015e-01   +8.063246184339420e-01; +2.217154785801985e-01   +9.153801888323142e-01   +2.718656523430698e-01   -1.818806594664171e-01   +5.489137223986685e-01   +7.738615946941817e-01   +6.461780997896933e-01   +5.123913285556454e-01; +2.118609772773113e-01   +4.082220461995398e-01   +3.852579901249334e-01   +3.579601985481921e-01   +6.268012026509697e-01   +2.367946832310569e-01   -2.059197868605195e-01   +7.267931284793927e-01; -2.761946460303076e-02   +2.230945485461328e-01   -1.996955226404659e-01   +7.538108815275145e-02   +5.328582811278133e-01   +5.824530103673546e-01   +1.410868234408125e-01   +4.537042461491659e-01];
L1I_L2I_iGABA_netcon = [-1.312328637513883e-01   +6.730499020106592e-01   +2.070848630701983e-01   +1.748354963133009e-01   +8.991076807985116e-01   +7.995183718836288e-01   -1.994480271096600e-01   +1.575001078841317e-01   +4.947030177484062e-01   +4.355564043762857e-01   +6.768498650901604e-01   +6.684197429690013e-01   -2.920581743608047e-01   +4.693608804870387e-01   +2.793675635527385e-01   +6.803369717345827e-01; +5.457064265759466e-01   +7.435142182200332e-01   +5.043547455420916e-01   +6.346637682808683e-02   +7.765275256426465e-02   +6.691491471780840e-02   +2.588670513939235e-01   -2.011950043075232e-01   +1.057401859441933e-01   -4.003617247878686e-02   +2.201213512356103e-01   +9.827325313469926e-02   +5.870149010528699e-01   +3.332184169452339e-01   +9.937917306373394e-01   -1.529213701026329e-01; +4.949776255806824e-01   +4.484771900248242e-01   +7.354536893468339e-01   +8.945729234084630e-02   +1.370526853839665e-01   +2.855182662910206e-02   +7.398719488826254e-01   +1.545417390300722e-01   -1.115215910098707e-01   +8.710059654474860e-01   +1.194482821448717e-01   +2.543634174376543e-01   +4.208816700810147e-01   +5.271980160243400e-01   +1.615352379773851e-01   +2.639944493451165e-01; +4.511777693174840e-01   +3.950228513843600e-01   +1.997614104478341e-01   +3.607755004275815e-01   +8.629122092702119e-01   +2.549775859147577e-01   +2.066613472429631e-01   +2.001030999358420e-01   +4.441386737920854e-01   +4.914303480642233e-01   +1.072882373638586e-01   +1.564635967777690e-01   +2.047544627546952e-01   -1.058277824342837e-01   -1.083426662279589e-01   +4.126379383514087e-01; +4.787517720454744e-01   +6.169024688776361e-01   -2.522268541029515e-01   +6.517675577233294e-01   +5.027625024484721e-01   +4.014619805347444e-01   +4.632222888154682e-01   -1.135856544112814e-01   +5.422321202974761e-01   +4.244394096854199e-01   +8.300271629933351e-01   +8.240259920382775e-01   +5.603866734173591e-01   -2.881119123435253e-01   +4.364768429758919e-01   +4.329822879892930e-01; +3.386483224458509e-01   +5.096362960252807e-02   +3.914151992839842e-01   -1.616757707995310e-02   +2.097849947733503e-01   +2.999151357685790e-01   +5.828596115685437e-01   +5.163598207614568e-01   +5.419532730274387e-01   +4.878699066653100e-01   +5.708684154535938e-01   +4.855655603280198e-01   +4.755699730539600e-01   +3.934237337810619e-02   +4.215367590252967e-01   +5.681382389247626e-01; +1.859489619709097e-01   +1.229603392532932e-02   +3.520152234966099e-01   +4.790299154902219e-01   +5.330748706129214e-01   +5.580163746844483e-01   +1.328742559370333e-01   +1.248027231102187e-01   +1.343429149691075e-01   +2.821190692749015e-01   +8.330423587311014e-02   +3.994600121229951e-02   +2.397911856721925e-01   +2.406211128484488e-01   +4.787432620130751e-01   +2.221453304968096e-02; +4.782263321436087e-01   +9.695321257317264e-01   +4.252824861625277e-01   +1.198502212329877e-01   +5.863603854209751e-01   +3.673149577635938e-01   -9.086409982675046e-02   +2.179160382208148e-01   +2.729963720351174e-01   +3.374547532764209e-01   +3.111330036089319e-01   +9.523839073666078e-01   +5.308790990072039e-01   +6.176645400045234e-01   +1.579439328781724e-01   +3.970953815858976e-01];
L2E_L1E_iAMPA_netcon = [+2.032322616241162e-01   +4.318265460946212e-01   +6.575094433505635e-01   +2.338030589655223e-01   +4.219638206655515e-01   +8.152706772139459e-01   +2.212797613535220e-01   -1.740519467148404e-01; -1.222314469048215e-02   +2.943347889256546e-01   +2.254150760286452e-01   -7.554578743561234e-02   +3.381464102458189e-01   +6.618827067313907e-02   +4.979678253851013e-01   +1.346080607409074e-01; +5.996503324491542e-02   +2.843955999965691e-01   +6.612313782042940e-01   +5.121421151779285e-01   +9.843673086951384e-02   +5.507743498279531e-01   +3.027865476387603e-02   +7.460931384144327e-01; -1.842417941006857e-01   +4.113172193585837e-01   +9.145862289251937e-01   +2.652481395865515e-01   +2.654202275462804e-01   +4.314219240216237e-01   +1.006369978345003e-01   +5.603368181452469e-03; +7.993593281692721e-01   +7.301115820435425e-02   +3.444558905482346e-01   +8.016178923187394e-01   +1.029547411679353e-01   +6.620335333300150e-01   +6.143772052062596e-01   +5.867181632232742e-01; +6.700664182349789e-01   +1.612957909517638e-01   +5.123893359973152e-01   +5.812584263435796e-01   +4.492082441109334e-01   +7.668271522598650e-01   +6.914958709401008e-01   +6.790381528742023e-01; +5.448827281415067e-01   +5.950206196907204e-01   +7.161007073587771e-01   +1.635865055404768e-01   +8.553174507854050e-02   -3.140095778714446e-01   +3.422776761366510e-01   +7.527603011950819e-01; +5.580412501805622e-01   +7.356275363400486e-01   +6.965897482223780e-01   +4.169897046681184e-01   +2.185791433771285e-01   +9.139159965968722e-01   +4.759454273073091e-01   +5.351545367225607e-01; +2.322755097812566e-02   +3.127378629865508e-01   +5.451635296295934e-01   +4.476580874459427e-01   -1.639590952492917e-01   +3.713035298280454e-01   +3.286739818423733e-01   +7.147603956723130e-01; +2.322807249556152e-01   +1.818400736958793e-01   +4.627334732559288e-01   +2.480165757780762e-01   +2.974710845283104e-01   +3.228763337020218e-01   +3.067855249763031e-01   +4.861048915870694e-01; +4.017902277908811e-01   +8.235092999068340e-01   +4.324180778121911e-01   -1.714174200381333e-01   +4.829814714687693e-01   +7.608844849450728e-01   -2.902364181853299e-01   -2.005140786913838e-01; -1.657498986670260e-03   +3.427230001025211e-01   +5.720305271791433e-01   -3.976352482317025e-02   +2.401957848797800e-01   +2.794057818952030e-02   +7.594716881652506e-01   +2.074048306483952e-01; +1.810773459845065e-01   +4.675358333993099e-01   +8.288558108469628e-01   -2.605413866010198e-01   +3.250380535816290e-01   +3.245995486899304e-01   -2.770348991632540e-01   +7.239491984831241e-01; +8.592973325883001e-02   -4.052589716648078e-01   +7.769691174614096e-02   +2.633362084442318e-01   +5.167000898988398e-01   +6.214691574845406e-01   -9.845757696147362e-03   +1.231692344919999e-01; +3.909830591527924e-01   +4.686120489171568e-01   +2.115226314793583e-01   +2.404811499605571e-01   +3.827417401542527e-01   +2.237974026868124e-01   +4.598498450577659e-01   +5.476145351553068e-01; +4.772951939469571e-01   +6.640812529828792e-01   +1.778148859914481e-01   +1.330402250065801e-01   +1.115589766995192e-02   +3.611243786717638e-01   +4.055466384669721e-01   +3.771427625491784e-01];
L1E_L2E_iAMPA_netcon = [+4.890427809932534e-01   +3.196119012507944e-01   +2.597091169538042e-01   +7.830508796605552e-01   +6.646425204816909e-01   -1.285325893778254e-01   +3.916648096099558e-01   +7.275040325347771e-01   +2.536957843792160e-01   +3.695018844868041e-01   +4.828140156864688e-01   +9.860053060916295e-01   -6.675190162901692e-03   -3.307128207985600e-02   +7.574313891813216e-01   +1.107643917889679e-01; +2.450577182890247e-01   -1.173800903462842e-02   +4.025466995006918e-01   +5.401829407047688e-01   +2.233659718141291e-01   +9.548563010852483e-02   +2.095487322328038e-01   -6.903549412692898e-02   +5.568618445118568e-01   +9.617728757901512e-01   +5.941424245292913e-01   +1.486387412952572e-01   +8.130852881466657e-01   +8.187369280658447e-01   +5.076767450844396e-01   +5.330294568644101e-01; +2.112691620999949e-01   +8.257133279275262e-01   +1.732073560573423e-01   -1.331784728863028e-02   +5.859193145967582e-01   -7.532559075811573e-02   +5.772365841514420e-01   +6.240564306844407e-01   +5.392630772662343e-01   +1.167537832835003e-01   +6.320775686952482e-01   +1.579352650046525e-01   +4.546662148388647e-01   +2.640952724918146e-01   +7.642943858530704e-02   +4.395731195657833e-01; +5.895873075277295e-01   +4.572542015247991e-02   +2.625520054360577e-01   +3.365526002369377e-01   +1.787304729275105e-01   +6.876045282926327e-02   +9.067157518807861e-03   +5.702761180914755e-02   +8.513570304124893e-01   +4.062467068512569e-01   +3.903752901857510e-01   +2.285964209520018e-01   +3.038951491434037e-01   +5.183115924988514e-01   +6.976028545419702e-01   +2.911829045414319e-01; +4.127937676900756e-01   +2.267538737268339e-01   +1.288986435896339e-01   +2.404266097520190e-01   +4.057249742267931e-01   +7.203723950720755e-01   +1.190286330085776e-01   +3.425426586060916e-01   +2.933443292844611e-01   +1.285909022778219e-01   +2.935090522627156e-01   -8.728191772764349e-02   +7.891335161038578e-02   +5.568836588116088e-01   -2.787066237831704e-01   +5.339784201661857e-01; +7.001932321418100e-01   -3.827510566506078e-02   +3.862362790158667e-01   +4.072884493042395e-01   +1.455734470940795e-01   +1.871352852091386e-01   +4.871167689954431e-01   +1.453507120936700e-01   +5.767768683926354e-01   +4.611518052844556e-02   +2.637030886689146e-01   +5.821048724071525e-01   -7.803521426308910e-02   +7.039393737213495e-02   +1.457541405977573e-01   +4.477328348462465e-01; +3.735673938734354e-01   +2.049568114963787e-01   +2.369613303388056e-01   +1.440740771395118e-01   +1.000000000000000e+00   +4.291299281771407e-01   -2.681112495284546e-02   +5.860144089956403e-01   +4.320265759888774e-01   +6.984958771299103e-01   +4.379648487032878e-01   +3.101002729441323e-01   +1.329908651651001e-01   +2.879257105253594e-01   +5.377501981278068e-01   +2.592777279393004e-02; +2.193894764363198e-01   +3.297940596490513e-01   +9.089958341257949e-01   +3.940059244233102e-02   +8.189601136432130e-01   +2.101851138698252e-01   +4.014163943489645e-01   +7.615788313384828e-02   +2.288131792887540e-01   +5.370374620354189e-01   +4.461447039360998e-01   +1.204366532384928e-01   +6.967156036162505e-01   +5.122425711348439e-01   +5.060011331821654e-01   +3.795928566809174e-01];
L2I_L2E_iAMPA_netcon = [+5.096376207928323e-01   +9.993010437330179e-01   +3.618712719739125e-01   +5.367868296891685e-01   +7.436336904867115e-01   +6.096030408860140e-01   +8.350332211887765e-01   +2.763931671825944e-01; +1.000000000000000e+00   +1.964705145225103e-01   +3.553040432087112e-01   +1.810404779186302e-01   +6.535400910006237e-01   +3.580529324336104e-01   +2.365960493948268e-01   +7.013853257691256e-01; +6.411109634160219e-01   +4.084217103990029e-01   +8.186201949455766e-01   +3.389096104060849e-01   +4.529905275586827e-01   +3.467503417235809e-01   -5.328668028082227e-02   +7.413162654239204e-01; +3.717796887635849e-01   +6.195695688523079e-01   +3.950546597005404e-01   +3.068662175847972e-01   +5.236029502327191e-01   +1.409910238656813e-01   +9.898311771968779e-02   +4.770727420569337e-01; +5.091174465096230e-01   +5.568020648367186e-01   +8.849026037505245e-01   -2.855833816438617e-02   +7.302886552005754e-01   -1.366884268766426e-01   +8.003821036381266e-02   +2.882939456026061e-01; +6.195499260120452e-02   +1.084425013269958e-01   +5.720150703489097e-01   -5.682265247508211e-02   +6.151857796251803e-01   +5.844329559607322e-01   -1.457352412283024e-01   +4.209329412054096e-01; +5.097888291659559e-01   +1.978235201899951e-01   +6.384943282846920e-01   +4.555524773151896e-01   +1.537401046643580e-01   +8.975087410461889e-02   +2.414113803091723e-01   +6.907446706228519e-01; +6.247157700835576e-01   +7.152941790433970e-01   -5.224433016245228e-02   +5.568882013017030e-01   +2.007758363662860e-02   +7.076123391595831e-01   +1.126623099977305e-01   +5.240526972727411e-01];
L2E_L2I_iGABA_netcon = [+2.616519580498569e-01   +1.879066436568337e-01   -2.333602537012663e-01   +8.761976118257386e-01   +4.425105004792774e-01   +5.384382643785744e-01   +5.168864430111502e-01   +1.705339120589804e-01; +4.505407432621224e-01   +6.932229247409513e-01   +1.073433895937964e-01   +2.385321776736816e-01   +5.318053020569247e-01   +4.652233946302537e-01   -1.873797539020294e-02   +4.949032964580405e-01; +2.677644668453252e-01   -4.333640136716649e-02   +2.164299565885541e-01   +3.954675645745240e-01   +1.093136457040843e-01   +2.517794843895926e-01   +1.060639891872860e-01   +4.222938682384345e-01; -1.370347765789982e-02   +4.053774393766861e-01   -1.208277739103587e-01   +7.283559793877740e-01   +3.820300444323610e-01   +4.070514335753265e-01   +7.897305212171767e-01   +7.477027547813277e-01; +2.730887505147028e-01   +2.741774953912386e-01   +3.818062803309601e-01   +1.951942080797588e-01   -4.154834565530667e-02   +3.848572734433185e-01   +1.809669402419185e-01   -3.071022142430206e-01; +5.556161316296719e-01   +7.942867213711433e-01   +9.859501119357782e-01   +1.000000000000000e+00   +5.533827572923020e-01   +3.567389008633974e-01   +3.741555782721275e-02   +4.825136062200621e-01; +2.961861786792374e-01   +3.132556094133356e-01   +6.229598388828980e-02   -4.948096429970209e-02   +3.497736335569646e-01   -1.759129950263776e-01   +1.904729529431199e-01   +3.858657564562655e-01; -1.665436279915580e-01   +5.072118578758377e-01   +3.772750835407645e-01   +2.213017562667937e-01   +5.356684425136059e-01   +2.708917957057181e-01   +6.093659381787461e-01   +6.208245568661821e-01];
L3E_L2E_iAMPA_netcon = [+1.565680631801772e-01   +3.961892794853882e-01   +5.430493820416524e-01   +8.817509484355016e-02   +1.210320720199558e-01   +6.081225757559909e-01   +6.757015988162849e-01   +4.874422030203431e-01   +5.070699316614283e-01   -2.639329959241297e-02   +3.553317366753700e-01   -5.222233061837132e-02; -2.350443097201466e-01   +5.630858892434901e-01   -1.833788119828863e-01   +1.433865384471337e-01   +3.481165972512265e-01   +5.300054136963415e-02   +3.539211231125676e-01   +2.709581355137562e-01   +2.962339386051178e-01   +9.492303810588767e-02   -1.999382829450062e-01   +3.921995920008834e-01; +3.021957764175960e-01   +6.103918535447465e-02   +1.358291949547331e-01   +3.714494358569379e-01   +3.089427823998879e-01   +6.669349079852656e-01   +4.069079449699236e-01   +4.713008170258553e-01   -3.061054475066959e-03   +4.791528898293673e-01   +3.563497848328833e-01   +7.529192025197500e-01; +6.981126224762624e-01   +4.458907568660562e-01   +4.526282145728993e-01   +4.311136477630313e-01   +3.030509704394218e-01   +9.605882846324658e-01   +3.856669401103283e-01   +1.830807270062333e-01   +3.921515080317721e-01   -4.340398607374854e-01   +3.872928368263600e-01   +9.098197030434417e-01; +4.106179649755404e-01   +4.828550243176258e-01   +2.629666869711857e-01   +2.267807629676442e-01   +1.235705397479877e-01   +4.130321517766222e-01   +1.066015066134686e-01   +7.466542275186745e-01   +8.205274003747570e-01   +3.249825687662588e-01   +3.918955228036519e-01   +2.001588215494052e-01; +1.056359195568474e-01   +9.014812422939475e-02   +5.779511304693893e-01   -1.699805285786384e-01   +1.979517480485808e-01   +4.665950367296219e-01   +3.193265409538109e-01   +3.717291095375694e-01   +2.276305554365304e-01   +4.780854384910458e-01   +1.446020330681204e-01   -4.605267267243233e-02; -4.651754493484470e-02   +1.285809633258732e-01   +8.925047084277531e-02   +4.756025387420392e-01   +9.464589876427236e-01   +6.291423859533893e-01   +7.879519681411220e-01   +6.756081869374622e-01   +6.843836675400657e-01   +3.174230566390429e-01   +2.394937736734336e-01   +6.501390595380783e-01; +3.070986615079043e-01   +1.308675839215132e-01   +4.929605207338015e-01   +6.480609909860239e-01   +3.088507367920720e-01   +5.816089813359485e-01   +5.559250151401438e-01   +1.998589765711861e-01   +5.886968879858262e-01   +2.036819357470685e-01   +1.034295963138495e-01   +1.107876621354338e-01];
L3I_L2I_iGABA_netcon = [+5.496604509347258e-01   -4.000896563414176e-02   +2.726922311494508e-01   +7.226758085959655e-01   +5.472947993226415e-01   -1.657625065690262e-01   +2.394167127068171e-01   +4.895432270909066e-01   +1.131712962599186e-01   -1.204921107400520e-01   +5.872738049703900e-02   +5.443067529182049e-01; +7.166132150758928e-01   -2.638000177352814e-01   +1.566389759490277e-01   +3.734743817431351e-01   +7.165300159148784e-01   +4.573494042730279e-01   +3.728305573708860e-01   +4.229454866139829e-01   +1.623051540059619e-01   +4.100096040152021e-01   +3.435869020984048e-01   +3.039632664697995e-01; +5.330020878134102e-01   +7.857308318106622e-02   +4.663729696811748e-01   -1.819732726105070e-01   +3.995845902462384e-01   +2.416313643638061e-01   +4.922382203386478e-01   +5.441271399294084e-02   +3.307953135529804e-01   +5.132926077680777e-01   +1.671716780734051e-01   +9.471480380384102e-01; +4.294182490789395e-01   +3.189931156815215e-01   +5.974354738271246e-01   +7.759347986404720e-01   +3.108910126230768e-01   -2.888200150295135e-01   +6.236437302696214e-01   +2.984733790853483e-01   +6.882464666020198e-01   +5.863962621552038e-02   +8.702783809880923e-02   +4.760993306128335e-01; +4.374741529012052e-01   +4.167219465882720e-01   +5.518874773636779e-01   +1.678139747860962e-01   +4.990293777307374e-01   +6.940438672908197e-01   +5.445940193074572e-01   +1.000435773358942e-01   +3.212303207937947e-01   +4.250702155843586e-01   +8.488163847197272e-01   +1.166166676522588e-01; +4.876826549293743e-01   +1.592726070105053e-01   +4.981864825230394e-01   +8.650936960759372e-01   +8.157364986426965e-01   -1.546869323408072e-01   +1.713365876275696e-01   -6.993548371939631e-02   +2.650260622463054e-01   +1.757759538270043e-01   +1.863788338032693e-01   +1.128297179851709e-01; +4.835302980061107e-01   +4.089756835066871e-01   +7.641548452023194e-01   +5.260388539869958e-02   +2.309294845942438e-01   +3.501705284343402e-01   +1.125305931545452e-01   +4.744424392142214e-01   +2.009495614896508e-01   +8.784694001305358e-01   +3.969804574149260e-01   +6.899649057852670e-01; +2.534343085354949e-01   -1.815161870754152e-02   +3.531971022804266e-01   +4.439517909510535e-01   -2.390165170173910e-01   +3.065634999984201e-03   +2.677491106998283e-01   -1.984673449634438e-01   +4.140274102605612e-01   +5.521025176669718e-01   +2.921374908644040e-01   +4.140369491440823e-01];
L2E_L3E_iAMPA_netcon = [+1.325647552838108e-01   +8.476801949775785e-01   +6.062206916510819e-01   +6.511951574711419e-01   +2.246858476387783e-01   -6.850707269277514e-02   -2.276609185934212e-02   +3.145525993870226e-01; +2.262305827045521e-01   +5.733508679099043e-01   +4.474825560433532e-01   +2.674176049688136e-01   -1.053510556453566e-01   +5.400956035842797e-02   +3.103954489660806e-01   +4.148959148760833e-01; +4.951416132961553e-02   +2.501006077680903e-03   +6.785636425300298e-01   +7.153138050781961e-01   +5.895883176870581e-01   +2.172881182214079e-01   +1.462742191246806e-01   +3.600233119328796e-01; +3.225198774599320e-01   +3.856051970227024e-01   +1.087600091405164e-01   +6.912684549206471e-01   +5.246672178016624e-01   +5.257634546561333e-01   +3.757979895823653e-01   +1.504010468930334e-01; +5.212283257228447e-01   +6.903287468711248e-01   +5.818270913261515e-01   +8.919005124295146e-01   +5.316943194667691e-01   +3.326183152062904e-01   +3.359021031942033e-02   +9.200308581010532e-01; +9.689734139317382e-01   +5.215115851504617e-01   +3.351263228299213e-01   +1.439190253053488e-02   +4.773659931760086e-01   +5.413070491322487e-01   +5.455145618712872e-01   +4.764264993758187e-01; -1.185490704023527e-01   +4.788359919541078e-01   -2.672406030603514e-02   -3.000479546516364e-01   +1.625481471522958e-01   +1.690141908195864e-01   +1.877879768755858e-01   +3.335983032398442e-01; +7.637477785926511e-01   +2.605322109477889e-01   +6.914010925858806e-01   +3.056151053828296e-02   +8.582151010371648e-02   +2.602224169099249e-01   +4.572067457833218e-01   -2.153876254770237e-01; +1.434631939355140e-01   +5.825621048713825e-01   +4.108969498575751e-01   +9.558277941603294e-02   +2.039275869857467e-01   +6.460808748194574e-02   +3.669939054823247e-01   +5.074560995139329e-01; +1.744764026405994e-01   +4.296411464442527e-01   +3.580039980939698e-01   +2.566433636421087e-01   +5.414705548252423e-01   +3.818163903243536e-01   +7.318604372713470e-01   +4.916892074172591e-01; +4.211446202006198e-01   +6.020442104925198e-01   +7.275375469971465e-01   +2.884768696042883e-01   +7.237184225951866e-02   -1.208122154207400e-01   +7.520827156688575e-01   +1.468676765162778e-01; +5.445517576299297e-01   +3.566915379569480e-01   +4.533236029001441e-01   +6.357095656213935e-01   +2.845248912560424e-01   +5.927204642854763e-01   +3.558544895606356e-01   +5.529331195315658e-01];
L2I_L3I_iGABA_netcon = [+3.279023834717526e-01   +3.351227968113052e-01   +6.706585211079124e-01   +4.641151755355850e-01   +4.029885544415428e-01   +4.812686773708335e-01   +4.831904427112510e-02   +4.369497607207871e-01; +1.351715999239892e-01   +5.910912128824946e-02   +6.361043554239744e-01   +3.527778025543742e-01   +4.325288646448440e-01   +3.469756330653562e-01   +1.000000000000000e+00   +5.995422849231252e-01; +9.249206236094212e-02   +4.943397293518125e-01   -1.080099371337424e-01   +3.755090310740764e-01   +7.012583723907136e-02   +8.462210242240373e-01   +3.910227151231329e-01   +4.227654190711506e-01; +3.473635582732125e-01   +2.310758896038264e-01   -2.338000851582095e-01   +2.457184143991173e-01   +6.149124198541699e-01   +1.569339655817333e-01   +7.936100527367659e-02   +3.011655609365705e-01; +5.617521845213508e-01   +2.455844924422563e-01   +5.143369148605449e-01   +6.366024794250462e-01   +4.269897519498433e-01   +5.365326937081329e-01   +8.587389211803916e-03   +5.889231697964045e-02; -4.704068123708311e-01   -2.627897647284318e-02   +4.865511999561485e-01   +5.030569002726573e-01   +6.529650898400455e-01   +4.690123776847971e-01   +5.855949849593237e-01   +2.406056403310458e-01; +1.711672195510695e-01   +3.989598594973361e-01   +1.519384295155096e-01   +3.167285082723221e-01   +1.687932863884897e-01   +6.229577870689045e-01   +4.541190525507791e-01   +8.572159746625080e-01; +3.347576044105838e-01   +5.601207300792843e-01   +1.676412465118119e-01   +2.545781495375507e-01   -3.435226619355876e-01   +2.614942509057530e-01   +3.123946770482707e-01   -9.626907954294696e-02; +5.377778063315147e-01   +1.639369255339945e-01   -2.210949051179194e-02   +3.686783135160326e-02   +4.561411266062198e-01   +1.961963393224496e-01   +1.961944771065181e-01   +3.199687761294198e-01; +9.916586827592844e-02   -3.825938511599693e-01   +5.362233253300656e-01   +4.709462554217147e-01   +8.219793317431688e-01   +6.395205938768014e-01   +4.394647942835978e-01   +2.258012311506503e-01; +2.612581607876742e-01   +2.927971491726656e-01   +6.114341175086838e-01   -1.906106924817466e-01   +5.119729417065693e-01   +3.007090658074786e-01   +3.389780083532054e-01   +1.907230709307588e-01; +6.558505973573170e-01   +2.430768329222076e-01   +7.441760118192441e-02   -1.520536319601868e-01   +3.364036558948752e-01   +8.343621100396393e-01   -5.651524096955858e-03   -5.677884571808498e-03];
L3I_L3E_iAMPA_netcon = [+1.515826694798949e-01   +2.266982417104379e-01   +3.174767923797917e-01   +7.688991623149234e-01   +5.830980462887557e-01   +2.734676608240660e-01   +2.318663382555766e-01   +1.824051602963764e-01   -1.221250427397103e-01   -6.275827581008707e-02   +3.702896010849255e-01   -3.356868824190157e-01; +2.679265653303554e-01   +4.222566066517937e-01   +2.607852809268406e-01   +4.203583048627545e-01   +2.634165850652221e-01   +1.549009618837200e-01   +4.064714096906674e-01   +1.519762827583024e-01   +2.009644677691792e-01   +3.792074337639827e-01   +3.890795220921375e-01   +6.470356559672109e-01; -7.948340852634986e-02   +7.657065519296536e-01   +4.385393042148519e-01   +7.650388642923657e-02   +1.092727164710370e-01   +3.859282392693057e-01   +1.032518758651132e-01   +2.631160682156486e-01   +4.530897356938607e-01   -3.270509440802744e-01   +5.909828892799713e-01   +3.462434975784929e-01; +2.243683841046024e-01   +2.410705119703053e-02   +2.807505258820993e-01   +7.941164686190695e-02   +6.936225507260840e-01   -1.440791525054959e-02   +6.477148637217085e-02   +1.709484972020499e-01   +4.414667291336442e-01   +5.044235100456422e-01   +2.864021609199736e-01   +1.445613383410439e-01; +6.301667221550152e-02   +8.281114715395947e-01   +7.732911329711033e-02   +1.932371524691009e-01   +4.211624982144838e-01   +3.281497225443360e-01   +1.955369093754978e-01   +1.882367513710855e-01   +6.284158144119640e-01   +2.684887949534101e-01   +2.158484995405581e-01   +1.045185519769553e-01; +2.582115487049982e-03   +2.687134521370523e-01   +8.926334815462718e-01   -3.915695668038695e-02   +2.162323069743838e-01   +2.994363249070390e-01   +2.991493234259983e-01   -1.862511323534333e-01   +6.201962557990005e-01   -7.160088098790898e-02   +2.684811652146425e-01   +8.635789940117290e-01; -1.382350123405357e-01   +6.719286867119988e-01   -4.559855810474718e-03   +4.447687563233826e-01   +4.468909774773400e-01   +4.038543767528192e-01   +2.061817371134427e-01   +1.551614299456061e-01   +7.143490215388280e-01   +7.239849670492777e-01   +1.802358862378895e-01   +6.881508702068114e-01; +6.758164493097716e-03   +6.419796363870681e-01   +5.263644439441215e-01   +5.275499943592252e-01   +9.864627329181066e-01   +7.443564463603879e-02   +1.000000000000000e+00   +1.006122544953184e-01   +9.583597174042300e-01   +5.531888012311446e-01   +4.526178753785481e-01   +4.576837579194895e-01; +4.455148427889611e-01   -2.069759151872748e-01   +7.993558897904315e-02   +5.420959873591786e-01   +7.100812615840240e-01   -1.689500907839420e-01   -1.043013103721601e-01   +4.130040473251823e-01   +5.315280613525619e-01   +9.044907464074966e-01   +3.179716837222771e-01   +1.817677909746980e-01; +4.620355609907550e-01   +3.059596086512123e-01   +5.084662029856363e-01   +3.364373920227678e-01   +1.489359862140848e-01   +2.563539477636395e-01   +7.211459970130712e-01   +5.377829641365861e-01   +3.369618686239365e-01   +8.199892732332316e-02   +7.836663294995445e-02   +4.468594337711390e-01; +3.145310355727705e-01   +7.236547408925935e-01   +1.902820005431767e-01   +5.512985690027906e-01   +7.050819124239853e-01   +1.346123419324703e-01   +4.673578442240222e-01   +7.732712635990625e-01   +2.757038206637107e-01   +4.594024596895607e-01   -7.799048335454738e-02   +7.667490484015235e-01; +2.804772610611387e-01   +1.033114886563173e-03   +3.843900555820770e-01   +7.421602714204597e-01   +7.359040010074543e-01   +2.687700313060628e-01   +1.908652407962901e-01   +3.576675720689205e-01   +7.220236244405792e-01   +4.159783876921235e-01   +2.747491697436424e-01   +3.871498419731706e-01];
L3E_L3I_iGABA_netcon = [+1.032574864786941e-01   +3.962805328441914e-01   +5.368778515963755e-01   +4.844152314162727e-01   +7.549248244790681e-01   +6.192568174248508e-01   +4.053995231735581e-01   +6.035719268028258e-01   +7.526348982224942e-01   +1.807432235792711e-01   +1.109749164071679e-02   +2.897405618450140e-01; +7.689713124754115e-01   +7.219956725938733e-01   +4.551956348464265e-01   +6.605625635636430e-01   +3.092367842229641e-01   +1.365062436939465e-01   +6.405768985161530e-01   +3.761545371382366e-01   +3.750530614000097e-01   +3.854512676009461e-01   +2.899964230052381e-01   +4.078689165790699e-01; +2.637987915778028e-01   +9.529793541732767e-01   +3.246439234272429e-01   +6.827507980232357e-01   +1.424277384653133e-01   +3.776837027787118e-01   -4.242414947389461e-02   +2.250675701925489e-01   +3.181721067000226e-01   +1.905302906939806e-01   +1.576041678486480e-01   +7.756598497232976e-02; +1.833575833239438e-01   +2.503355092546998e-01   +6.854996354535089e-01   +1.095696728958541e-01   +3.971770728036965e-02   +6.000340724356312e-02   +7.285049168044557e-01   +4.369344380992740e-01   +3.363632637102573e-01   +4.351304970040247e-01   +2.259783891170044e-01   -1.140686306717887e-02; +7.300895081226222e-01   +4.205879332570755e-01   +8.917945106188465e-01   +3.067041203276722e-01   +6.534084810238115e-01   +6.387545908070583e-01   +4.937417956981400e-01   +8.993597854764789e-01   +1.817652444193021e-01   +6.458028822799784e-01   +5.857243483908802e-01   +3.705896276716875e-01; +7.909703636149701e-01   +6.565682072108061e-01   +2.538735797345956e-01   +4.838878184470430e-01   +1.941884261978708e-01   +5.783853152884881e-01   +1.392599609321603e-01   +8.967785156483971e-01   +3.740828872527683e-01   +6.437223631198742e-01   -5.819290959458282e-02   +1.304261090101518e-01; +5.391084179453246e-01   +6.962069528688660e-01   +4.588252232048937e-02   +6.807317090829365e-01   +8.117717072208597e-02   +4.196839131659635e-01   +2.996884711784421e-01   +2.508979417736660e-01   -4.874916863837163e-02   +1.800430385393845e-01   +6.636899688782745e-01   +3.710408504945399e-01; +5.900323044206470e-01   +2.033862703051440e-02   +4.118431543311298e-01   +3.413817352101185e-01   +7.390422269899219e-01   +8.737881508092997e-02   -4.439247462476922e-02   +2.137469269662576e-01   +4.281703722795468e-01   +5.967892228372618e-01   -1.447533159126465e-01   +2.478093621414313e-01; +6.123730672691823e-01   +2.113865925771416e-01   +4.306210476151568e-01   +5.215998871807310e-01   +2.853917332976714e-01   +2.987887095072749e-01   -3.097266824194732e-01   +6.417304506421292e-01   -3.350978416304569e-02   +5.594945595108441e-02   +1.000000000000000e+00   -2.515475562251442e-01; +1.677820142007873e-01   +3.451158136633026e-01   +1.631618015993880e-01   +2.534504228263317e-01   -1.710001104300588e-01   +6.647469548065656e-01   -1.108366699079679e-01   +4.740746933699517e-01   +2.064019023502542e-01   +2.415643176665326e-01   -7.544303154477028e-02   +8.988106524729561e-02; +6.349163468758996e-01   +2.230454978217190e-01   +7.951771241829255e-01   +2.463292421669468e-01   +7.084243052938695e-02   +5.289207503568686e-01   +4.915044440714736e-01   +3.002341242228295e-01   +3.409663683784261e-01   +9.237740634125660e-02   +3.152544492312586e-01   +5.764868600524146e-01; -1.331419209541402e-01   +9.942215028790023e-02   +3.866719379828854e-01   -7.127705593211113e-02   +5.094263225675536e-02   +3.508023227332939e-01   +6.679006787384606e-01   +6.808167588367581e-01   +7.203392032481690e-02   +8.452467103659023e-02   +1.513542716980106e-01   +2.499147523793558e-01];
L2E_Input1_iAMPA_netcon = [+8.992166286243986e-01   +5.273153148671705e-01   +7.125831305635751e-01   +9.185605039662558e-01   +9.415880830201667e-01   +8.662220892024243e-01   +8.724865910384949e-01   +6.813806977883359e-01];
L2I_Input2_iAMPA_netcon = [+8.198003524875991e-01   +6.800032315201386e-01   +5.790826666633951e-01   +6.252272901621612e-01   +6.274995386507934e-01   +6.254223309716861e-01   +1.000000000000000e+00   +9.036362556288874e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
