function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-6.551858533645483e-01   -3.671904651651710e-01   +3.244279183907646e-01   +1.903457500983941e-01   -1.092158021420152e-01   +8.736500155889804e-01   +3.384100587001654e-01   -4.560093111304052e-01   +2.571450668960558e-01   -1.951196148360519e-01   +3.659796257725567e-01   -6.571618296167745e-01   +3.816063600407586e-01   -1.415280388368292e-01   -3.123523239090304e-01   +1.734695050120051e-02; +5.892475446876878e-02   +2.141932746400342e-01   +4.501422659916366e-01   +8.938184842383889e-02   -5.810438141179993e-01   -1.306816224942632e-01   +3.725684100645725e-01   +2.754636045061964e-02   +1.021986365897433e-01   +5.006413430407719e-01   -1.994048315668913e-01   -5.790356361020951e-02   +5.613897437950859e-01   +3.042986435447004e-01   +6.139151165446710e-01   +8.235293679844435e-02; +3.797029985642242e-01   +3.167553705108582e-01   -1.926366976185546e-01   +1.107787299757016e-01   -4.463723255777846e-03   +1.795290956000389e-02   +6.571304884550044e-02   +1.617150948572310e-02   +4.886959843290378e-03   +1.525189487854551e-01   -5.918982421788312e-01   +7.852299070577864e-02   +3.898929802437676e-02   -1.381497784507949e-01   -2.492678485793008e-01   +1.192834804363154e-01; -5.792145196274445e-01   +2.002646532423646e-02   +1.852441624021242e-01   -3.145179612633050e-01   +3.455197135233110e-02   +4.541259819237904e-01   +1.369580934138120e-01   +9.982820478148248e-02   -2.373835162114770e-01   +3.655479838166975e-02   +2.767287797073597e-01   +1.903563634047571e-01   +1.616518726010081e-01   +3.826226213995391e-01   +3.646333025045993e-02   +2.981874430675894e-01; +8.674024553365578e-02   -4.571904187745254e-01   -4.617055862139761e-01   +1.942839054831112e-01   -3.372965211560192e-03   -4.575922663585075e-01   +2.228109132516282e-01   +2.772685100587247e-01   +2.506192194859514e-01   +2.348010826980833e-01   +4.864990662556316e-01   +2.715946216929903e-01   +8.477855516948819e-02   +3.337392971876039e-01   +1.397109343023609e-02   +7.709023229184832e-01; +4.484159254480072e-02   +4.568170554116749e-01   -7.534682997432633e-01   +6.705928371386225e-01   +1.492716738025492e-01   +9.413051722747150e-01   +6.888031907431491e-02   -4.571808934232884e-01   -3.252460524127736e-01   +6.321639567517953e-01   -1.632474769304028e-01   +1.110304830062248e-01   -3.166726297592461e-01   +2.116809015674732e-01   -2.527778881014951e-01   -3.102045807372713e-01; +3.888687805284379e-01   -2.384687653046832e-01   -2.244934393910261e-01   +5.537776189313570e-02   -4.379724396800574e-01   -5.779538377216195e-01   -3.230327432196335e-01   -3.208145059538134e-01   +2.491957503151721e-01   -5.068701343069111e-01   +4.495134243809946e-01   -5.559201170670933e-02   -1.628720091366003e-01   -9.479127300093190e-02   +2.247224336845410e-01   -2.696938942973872e-01; +1.226435231101839e-01   +6.315311787336458e-02   -5.935828583410596e-02   +4.993962479656271e-01   +1.877201967490646e-02   -6.554161642493865e-01   -4.028680091539675e-01   -3.537936622424800e-01   -2.704762576503739e-02   -5.692809963061314e-02   +5.296211623185335e-01   -1.903614775588806e-01   +2.234296873147436e-01   -3.426497831554071e-02   +3.228770865875137e-01   +1.383189756030507e-01; +2.802947136319266e-01   -2.076306138620410e-01   -1.646295539895496e-01   -6.159764642727313e-01   -3.543188333911769e-01   -6.746516370739010e-02   +3.718476102188495e-01   +3.953436166271318e-02   -1.928167103183873e-01   +4.784894516861009e-01   -4.519396799005220e-01   -3.865680873887386e-01   +3.522978599156604e-01   +3.463813186902354e-01   +4.723847703281392e-01   -6.201537107789766e-01; +9.491259965629954e-02   -1.365956514486663e-01   +1.282952352244624e-01   +1.319116077300510e-01   -2.626654306978007e-01   +4.047335459173719e-01   +4.683338004991891e-01   +2.669263529881589e-01   +3.841028953264944e-01   -2.885982959166200e-01   -1.597469195687746e-01   -6.178067255567331e-01   +8.304301313350966e-01   +5.538298221276812e-01   +8.914744144833675e-04   +2.812252768184531e-01; +4.699873911561064e-02   -8.179724240969165e-02   -2.876717799629750e-01   -5.106532339894589e-01   +1.711798502532733e-01   -5.925963298794977e-01   +3.549778239559588e-01   +2.896082506019534e-01   +2.167842957397480e-01   +9.172065913639177e-02   -8.522127141476488e-03   +1.855848072951466e-01   -2.848610655853488e-01   +5.315575385135290e-01   -2.229325444283292e-01   -5.906931843009205e-02; -1.388793152872755e-01   -5.785195395201385e-01   -2.765793338352030e-01   +6.594858345375680e-01   -3.141244117798806e-01   +6.980933206648098e-01   -1.226579884423419e-01   +3.340036192683676e-02   +4.868343950639984e-01   -1.945903239299487e-01   -2.317272353768574e-01   +7.547841385118360e-01   -6.632579516793958e-01   -2.158868821431932e-01   +8.350655185891093e-03   +1.958762246917281e-01; -1.227414860022394e-01   +6.263594454934833e-01   -1.941252115415639e-01   -6.138372262405054e-02   -4.759408523835302e-01   +4.224845612773717e-01   +2.379861370835814e-01   +2.694106084830260e-01   -1.663098389046464e-01   +3.278431848697353e-01   +6.253126389655342e-02   -7.654081231542234e-01   +5.178208385151186e-01   -1.502777362921873e-01   -3.815303262946492e-01   +1.414304299509852e-01; +8.164129806622658e-02   +1.079422763616598e-01   -5.875409534534923e-02   +2.568931217822728e-02   -1.655368661778311e-01   +3.270391513507679e-01   -4.896610625980915e-01   +2.857720195173022e-01   +2.843344717547666e-01   +1.458131758226295e-01   +9.662289822322004e-02   +3.748215363181713e-01   +3.799070089655130e-01   +3.608925993024162e-01   +4.175265984101205e-01   -5.094699118245738e-01; -1.449589544565976e-01   -5.024604792170381e-01   +2.491173894273937e-01   +1.008619944530097e-01   -4.354534813269801e-01   -4.102555981148135e-01   -6.983851920620210e-01   -4.281326919442676e-01   +1.462225479420769e-01   -5.043433133430984e-02   -5.060049863374657e-01   -2.071587676791079e-01   -1.184513965502341e-01   -1.425082537147123e-01   -1.793400466300170e-01   +1.488502935417038e-01; +6.202821719744884e-01   -6.921414062678863e-01   -9.195196195623413e-02   -1.648884471738989e-01   +2.604938497551127e-01   +6.668304023552424e-02   -1.318683008883383e-01   -5.300056786927493e-02   +9.908256288486231e-02   -9.270089367387280e-02   +5.475026453183313e-01   +1.266328889878311e-01   +1.696895782839920e-01   -5.055810707465964e-01   -9.214029474809302e-02   -2.294286153673314e-02];
L1E_L1I_iGABA_netcon = [-5.898359952282233e-01   -1.202217355993279e-01   +3.665045168495242e-01   +3.964915472600494e-01   +1.588666809056698e-04   -2.668814388020239e-01   +5.139783966225261e-02   -1.845249109405798e-01   +3.851256460175315e-01   +5.233643325466022e-01   +4.284738010273020e-01   -2.555235722995287e-01   -2.552542362919484e-01   +2.304997959544092e-01   -1.778687642157271e-01   +5.413968708388025e-01; -4.159413415153221e-01   +3.384186844159661e-01   +8.379102055312661e-02   +2.707421674170963e-01   -2.192993221872257e-02   -1.136454043624862e-02   -1.630627846393066e-01   +3.945528948290225e-02   +4.966063034453985e-01   +4.609807472798232e-01   +4.942587863905745e-01   -3.369603469000497e-01   -2.706189828891638e-01   +8.561146244705302e-03   +1.768070102562697e-01   -1.788717417844114e-01; -2.424555476651564e-01   -7.884360833077127e-02   -9.512903146204982e-02   +3.105369477672471e-02   -1.058095215386554e-01   -4.615596414374905e-02   +4.789527521644849e-02   +3.610426652944909e-01   +3.984303370591369e-01   +1.388911365773106e-01   -2.628069864066772e-01   +3.066305600010193e-01   +1.484030385745011e-01   +1.708296016816378e-01   -1.022629777130126e-01   +3.251650712165304e-01; +7.917775898710974e-01   -1.698588680958554e-01   +7.085048385612761e-01   -5.343457564917203e-02   -4.992984775822800e-01   -2.222907513111642e-01   -4.677233436340984e-01   +2.983273185570328e-01   +1.702010594721265e-01   +8.715243607732687e-02   +7.828298859020598e-02   -1.416400752302812e-01   +4.786715441137084e-02   +5.457491189917618e-01   -1.124019409059849e-01   -1.810602334285494e-01; +3.152017288079427e-01   -2.221686713858603e-02   -5.236632374402762e-01   +8.960184985728993e-02   -1.610934053953814e-01   +1.965831140920044e-01   +2.063747956004089e-01   +4.758248375635163e-01   -3.452206969106247e-01   -3.073448324757223e-01   -2.746761106886415e-01   +8.601726859385815e-02   +1.832756174490295e-02   -4.228716939957764e-01   -3.036879181794164e-01   -2.942467214722091e-01; +2.470300562469241e-01   +3.623189990629729e-01   -2.990631219591579e-01   +1.273859806877623e-02   +6.545031382907598e-02   -2.237271712952801e-01   -1.616786176772550e-01   +1.635842025352985e-01   -1.069131088887244e-01   +4.761337497273626e-01   -1.427056463768451e-01   -1.259502076957182e-01   +1.727500931840773e-01   +1.000000000000000e+00   +2.185973039130970e-01   +3.576320357063481e-01; +6.349718439156252e-01   -9.844639754733821e-02   +4.159787364294063e-01   +2.265298546113126e-01   -6.534389256307803e-02   -5.778454149329006e-02   -8.450863256714639e-03   +1.009051657561945e-01   -1.382838790191305e-01   +6.762910467757242e-02   -8.365521370157360e-02   +5.100348085369913e-01   -8.536981366463527e-02   +1.501070675492963e-01   +2.004255059956093e-01   -2.176781551217805e-01; +2.138228690737718e-01   +2.956376639395786e-01   -3.662837408810102e-03   -2.484805973153836e-01   +4.539116287466426e-01   -2.404502217800639e-03   -9.141883182563623e-02   +3.098331863042612e-01   +1.207469914482653e-01   +1.051440911582891e-02   -5.292923387002801e-01   +2.463486355332580e-01   +5.285170367835980e-02   -2.499822183815161e-01   -1.591444175480266e-02   +9.908250490646246e-02; -1.776618532879759e-01   -1.938957066361007e-01   +1.567435088521457e-01   +2.753897126722882e-01   -4.109777238341227e-02   +1.969951014982912e-01   -8.160972837530359e-02   +4.054987414361317e-01   -1.297534073941156e-02   +2.913123196137316e-01   +6.720155798958749e-02   -4.590050786810383e-01   +1.251912218669315e-01   +5.376878481128153e-01   +8.107359412899740e-03   +1.762056071191521e-01; -7.327519323113375e-02   +2.568007572495276e-01   +3.265977949726507e-01   +6.188046262005367e-02   +2.613271362800439e-01   -1.462411212416546e-01   +2.797377333914747e-01   -2.064276147336812e-01   -1.727808804910276e-01   +2.679674343988228e-02   +5.808677841374117e-01   +7.401688545249945e-02   +2.618694992999632e-01   -1.449203067140437e-01   -5.071852185972950e-01   +2.486166084253308e-01; -1.614710108449748e-01   -2.381485465598091e-01   +5.020942928348088e-02   +3.748852948121010e-01   +2.369807913497801e-01   +1.051558448869607e-01   -1.866958417833968e-01   +1.538850184833034e-01   +2.533051791934321e-01   -3.580819541586797e-01   -4.931520062969571e-01   +3.260087675443924e-01   -1.748438150729620e-01   -2.720178296449293e-01   -4.398857547465911e-01   -2.727039295378519e-01; -7.325718322932592e-02   -1.767975303191290e-01   -2.246076247272794e-01   +6.905109611543774e-01   -1.298061165919983e-01   +5.170953840418128e-01   -3.838884704075102e-01   +7.508695894256859e-02   +9.006601489145744e-02   +1.369326704887491e-01   -2.707233965178503e-01   -1.482755694495768e-01   -5.182573882902672e-01   +4.335985706791293e-01   -4.187655515445057e-01   -1.051439880938879e-01; +4.646439272027464e-01   -6.255574054204818e-01   -5.439722495283769e-01   +4.807639118830149e-01   -9.407940423524266e-02   +3.059638962267391e-01   +3.352071505686432e-02   +1.858191703152646e-01   +1.191146676426625e-01   -3.939400996362207e-01   +5.814156071091148e-02   +3.230568907344500e-01   +3.022413183550482e-02   -5.839308515213117e-01   -7.302292378640329e-02   -9.595333606898258e-02; +2.878936288337066e-01   -5.184117707510527e-02   -1.350506562654676e-02   -2.052487788326237e-01   -3.025736076918161e-03   +3.348799968233558e-03   +3.681670461555814e-01   +6.888122268569428e-02   -7.588287917624188e-02   +4.368335217689273e-01   -8.683701749131778e-02   -8.312185933387901e-03   +4.716758910961533e-01   -1.945022926409465e-01   +1.043513915956472e-01   +1.536055135792003e-01; -3.267735356608208e-01   -2.084421618870638e-01   +3.836995867483660e-01   -2.563020956211158e-01   -5.116975295893416e-02   -8.436275823537948e-02   +2.669660346715386e-01   +2.265780671519280e-01   +1.175507106942688e-02   +1.166298738491100e-02   -4.339182317408643e-02   +3.713711400650011e-02   +2.874356535260741e-01   -3.689991553437572e-01   +3.144030415907667e-01   +1.042567914326111e-01; +6.867539341049989e-01   -2.260237733777125e-01   -6.415931748385845e-02   +4.808080108729680e-01   +2.792463748813394e-01   -3.345151312317836e-01   +5.421935237046638e-01   +4.151111611250238e-01   +1.547706783462718e-02   -2.154749956919275e-01   +8.004261839145060e-02   +2.641355320126698e-02   +1.030708585891897e-01   +7.578149765649782e-02   +5.144100853175049e-01   +2.812725465928200e-01];
L2I_L1I_iGABA_netcon = [+3.126494878047614e-01   -2.395500831495577e-01   -3.039322293539276e-01   +4.878993110985302e-02   +3.676847468375678e-02   +2.749829578059913e-02   +7.869883876164242e-01   -6.673599473201636e-01; +1.289785292676423e-01   +2.205767540554866e-01   +3.220015598912291e-01   -4.583903681180705e-02   +1.373301490428935e-01   +2.415957778036801e-01   +1.083107050418343e-01   +1.826083976361743e-01; -7.385001993867411e-01   -2.248234471219662e-01   +5.744636615094387e-01   +1.168312847910317e-01   +4.484597770318897e-01   -9.089789807972828e-03   -5.629146590032790e-01   -1.680831746026381e-01; +7.767805495532767e-01   +2.435319742146939e-01   -8.048591804885596e-03   +1.184090034195181e-01   -2.379900997241691e-01   -1.006111940911432e-01   +8.156451883677143e-01   +2.846336208255256e-01; +3.601251556972673e-01   -5.115074183881732e-02   +4.895252550418926e-01   +1.679939160800802e-01   +2.962693886607961e-01   -2.649005312751395e-01   -6.573025330261584e-02   +1.016958308159903e-01; +1.973282950278456e-01   -5.293318020828365e-01   +1.862512375342276e-01   -4.168541684338798e-01   -4.153359898469707e-01   +4.168952564034501e-01   +8.234554150778967e-01   +4.200178705876170e-01; -4.201394380337680e-01   +6.295206316040201e-02   +3.554454260417914e-01   +3.761879341101219e-01   -4.546727779530713e-01   -2.387882326715306e-01   -9.671512789777331e-02   +1.691560150645304e-01; +3.935934874027895e-01   -4.778578441254620e-01   +1.024676383611984e-02   -3.238773167169445e-01   -4.831174027844437e-01   -1.871600198998035e-01   +1.843593031129425e-01   +5.276255350351103e-01; -2.800897311610692e-01   -6.255160024528885e-01   +5.278701424411043e-01   +4.679247925362616e-01   -3.735471696464857e-01   -9.261037776458828e-02   +3.417255441786053e-01   +1.028118709189847e-01; +1.616710249437301e-01   +1.397968437693707e-01   +2.605013872188636e-01   -4.645615719330175e-01   -1.634569122607488e-01   -1.108978593292570e-01   -7.845504300828842e-01   +1.021974729152594e-01; +3.292438367378001e-02   -3.747308695842405e-02   +6.970624634924332e-01   -9.142894808148205e-02   +1.823184828236291e-01   -9.034081396918662e-01   +2.526415834657252e-01   +1.312714412470861e-01; -3.277265750631656e-01   -3.345102108884765e-01   -2.609178780499188e-02   +1.835786678327286e-02   +2.558267646095846e-01   -7.946184608423035e-01   -3.879384668482483e-01   +2.450328630547396e-01; -2.034422557904895e-01   +5.319441748998098e-01   +2.498499014655499e-01   -3.742889881695844e-01   +3.074307799020999e-01   +3.571329321873883e-01   +4.399793076546134e-01   -1.842489590487517e-01; -4.225749789022951e-01   +4.409109531179979e-01   +1.624945670616107e-01   -4.858438305133052e-01   +5.230417083724356e-02   +2.652362146655972e-02   -8.641484167242149e-01   -1.964828044758458e-01; -3.508038905581728e-01   +6.696126523620066e-01   +9.038513369004401e-02   +2.596526437122650e-01   -1.105669261707201e-03   -3.951083103566658e-01   +1.006027643115605e-01   +5.277365298674115e-02; +3.463322228529750e-01   +3.066293419479008e-02   +2.110847089129266e-01   -2.609810282734380e-01   +2.571249211513612e-01   -3.036996366639003e-02   -9.502268048576143e-02   +4.256364727142862e-01];
L1I_L2I_iGABA_netcon = [+8.105301610879223e-01   +4.803075765652859e-01   -7.789911846496481e-01   +4.178825969124096e-01   -1.788189939113213e-01   +3.871766221134540e-01   -1.167256183987618e-01   -7.588801067059173e-02   -2.901724987613170e-01   -1.510266440619717e-01   +3.404647888097876e-01   -7.941292325664433e-01   -7.242025717568908e-01   +8.489320773370613e-01   +3.663253266980807e-01   +3.690784042717955e-01; +2.421676594515948e-01   -2.554671574571420e-01   +5.376532240968107e-02   -2.667901450224329e-01   +3.967195420984286e-01   -3.411379267551350e-01   -1.414439147201623e-01   +1.189165162524797e-01   -2.542847684840979e-01   -1.303631916752235e-01   -5.755242168359750e-01   +6.191203599447627e-01   -3.099074311660995e-01   +6.772787201273053e-02   -5.496101601941830e-01   +9.169126008860411e-02; +3.566662076617809e-01   +2.896172145108131e-01   -6.607608927370230e-01   -1.206133679867591e-02   -3.884942944980891e-01   -3.128097588532440e-01   -2.620079495900719e-01   -5.896037678561842e-01   -4.512492051825019e-02   -2.709554299790941e-01   +1.345767672352592e-01   -3.605554176896011e-01   +4.040205522353632e-01   -1.309289271401984e-01   +2.523111509951154e-01   -5.565744827163195e-01; -1.257871729969141e-01   -1.302070832132537e-01   +5.544028420609866e-01   -1.485215249851702e-01   -7.709378067957363e-01   -3.128114706505804e-02   +1.832630625193802e-01   -1.288197133088228e-01   +8.976713682363556e-01   +2.278775318595447e-02   +4.050357548694290e-01   -3.704269684585936e-01   +3.281166746884349e-01   -5.154634026993954e-01   -1.752616257447309e-01   -5.632680111983893e-01; +1.119626501444673e-02   -3.835239132348117e-01   +2.959429653605959e-01   -2.774358115307808e-01   +3.576196678577840e-01   -5.868723053871738e-01   +1.178216399383215e-01   +6.861910698485685e-03   -5.616281332248407e-01   -1.070024707466066e-01   +2.633482814475238e-01   +1.872141402654630e-01   -1.356053093209978e-01   -4.432706749841898e-02   +3.393019986305017e-01   -4.072279074249677e-01; +4.857268226495806e-01   -2.914870864343417e-01   -1.611829704807874e-02   -2.881566577617897e-01   +3.092293671492040e-02   +2.405585405940536e-01   -4.177142595838113e-01   +4.102149741015490e-01   -2.201527611703622e-01   +2.453289627089442e-01   -4.534040475965906e-01   +2.355378796073924e-01   -3.437837232949872e-01   -1.920336985276652e-01   +2.890912853280805e-01   +2.608715068365243e-01; -3.839087893942258e-01   -2.421630694100280e-01   -9.614549397485866e-02   +4.441834904190414e-01   +6.878988363473676e-01   -8.068912302838850e-01   -2.848969953653819e-01   +6.169901417926642e-01   +7.086354631905564e-02   +5.634071468265078e-01   -6.184447209201843e-01   +2.130392473503189e-01   +3.717491476720926e-01   +3.485099170683525e-01   -2.543681864909548e-01   -1.718880835889822e-02; +2.345595192554233e-01   -2.466762819817773e-01   +6.210495712439934e-01   -2.248859811909427e-02   -3.513175584066948e-01   -5.063681159614615e-01   +2.532454277068353e-01   +1.510438633512109e-01   -7.120298751055083e-02   +1.296020848674201e-01   +3.476097462193367e-01   -1.717366531137546e-01   +5.731309094755166e-03   -5.211965539147244e-02   +7.655755047125508e-01   -2.618227190001167e-01];
L2E_L1E_iAMPA_netcon = [+8.788594520206222e-02   +3.286263777143815e-01   -4.502427551031096e-02   -3.991265157327988e-01   -5.055903017387293e-01   +9.039310774662992e-02   -1.651972771133007e-02   -4.129296704694335e-01; +2.680834676909434e-01   -1.947326688327667e-01   -6.827631390759806e-01   -3.272015724736314e-01   +1.557665720247533e-01   -4.285973094887341e-01   -3.745181582188261e-01   +3.671014940844680e-01; +2.677220126147213e-01   -1.752542165921855e-01   +1.463980852809482e-01   -1.183695951693816e-01   +5.137713980393126e-02   -7.196208079349412e-01   +3.149076233167709e-01   -3.747039037364278e-01; -4.547822585201086e-01   +4.039801389362405e-02   -3.162746174809488e-01   +3.668171321158136e-01   -5.390726800314126e-01   -2.367410599563261e-01   +3.013421052017071e-01   +4.654936026755076e-01; +3.444853637533283e-01   -1.743107672165554e-01   +1.408335433008711e-02   +9.161832148699550e-01   +6.093278282565024e-01   -9.478199223577763e-02   +5.763805769584791e-01   +1.330449493884296e-01; +5.061410373940958e-01   -7.251834236515015e-01   -2.741942908409479e-01   -5.124468681431421e-03   -3.992809140898956e-01   -4.397173236307134e-01   -5.169324141671345e-01   -3.901966564658362e-01; -5.545246448748296e-01   +2.913844628510340e-01   +5.710119363871573e-02   -1.570232463577922e-01   -4.897212992300176e-02   +3.207101598775947e-01   -3.586044764900252e-01   +8.177375215825227e-01; +2.811050572369742e-01   -4.759009094043471e-01   +2.465205248122840e-01   -1.589420792220111e-01   +6.068630214134670e-01   -2.370242083645719e-01   -1.770521790504002e-01   -9.913273989333835e-02; -7.782882319304566e-03   -1.978425171410663e-01   -1.664487784689907e-01   -1.235169228568829e-01   -3.791966104892489e-01   +1.227499903010053e-01   +4.104094823354418e-01   +1.835631831823832e-01; -1.187852219949448e-01   +3.243033753845299e-01   -1.209714343064166e-01   -4.427553397659493e-04   +4.486816692356752e-01   +8.219250833090084e-03   +8.421899728497972e-01   -1.763436344611738e-01; -3.149227415701696e-02   +4.388291714584093e-01   +3.928824405782271e-01   -1.582562177581535e-02   +1.946024875891148e-01   -1.000000000000000e+00   -3.999650234857273e-01   +1.527696926765468e-02; -2.073660200534057e-01   +2.519527952790744e-01   -3.197884675406898e-01   -4.355075022463769e-01   +3.219424578856078e-01   -4.105869465702355e-01   +5.367572661995660e-01   -2.811535303423801e-01; -9.475605654038986e-02   -2.527809956928399e-02   +6.669952111273413e-01   +2.728167257905633e-01   +1.549674841851207e-01   -3.960116290260443e-01   -7.845763743603605e-02   +9.272166620124919e-02; +4.339008250501855e-01   +6.399851565350649e-01   +1.350917108250116e-01   -4.128297911692255e-01   +2.951830628096419e-01   -4.871029506620131e-01   -4.225042200204020e-02   +2.720799705750118e-01; +1.441110216856077e-01   -1.937579606512531e-01   +3.099147205288345e-02   -2.273723696627725e-01   -3.182638592940708e-01   -3.837219214169126e-01   -4.958143324592705e-01   +1.052659065251489e-02; -2.802889771317076e-01   -1.811221983588780e-02   -1.315084174553873e-01   +1.273932436326437e-01   -2.580839130954928e-01   +7.186395226871767e-02   +8.491474857365684e-02   +6.077635008770027e-01];
L1E_L2E_iAMPA_netcon = [+9.192695889632549e-02   +2.708921123722146e-01   -5.788258175210097e-01   +2.726707594758604e-01   +9.169333124884665e-02   +2.651615115596084e-01   +2.350845496014133e-01   -4.012141581209827e-01   -1.081526313680370e-01   -2.707910225633881e-03   -5.908747047189379e-01   +9.543127245043306e-01   -1.693465484344492e-02   -3.425667410903855e-01   -2.170521804473755e-01   -8.008122519677149e-01; +3.478215066319635e-01   -3.841647291634319e-01   -1.506216752172565e-01   -2.099527525473505e-01   -5.350288178607223e-01   -1.945552718851002e-01   +1.975030834139796e-02   +4.075978802294755e-01   +9.954623070822551e-02   +4.554879221299981e-01   -6.919161871022454e-02   +6.390735539628962e-01   -2.320142698300462e-01   +5.270079112118169e-01   +2.664886458618620e-01   +6.591353968141055e-02; -8.236640211135293e-04   +1.231461041155702e-01   +2.227659440347591e-01   -3.791189338422638e-02   +5.518860240074391e-01   +4.955713683140159e-01   -4.478982764754824e-01   +3.541442235988556e-02   +2.601555091351405e-01   +1.826360732436187e-01   -2.548362326836496e-01   -2.009269064067535e-01   -5.347586666765207e-01   +3.724640323508374e-01   +4.975262083546521e-01   -3.104928662011038e-01; +3.527505798601931e-01   -3.290010285824232e-02   -1.262685246841393e-01   -1.520696698047064e-01   +4.791006148962843e-01   -6.964697218932125e-02   +5.427552737811436e-01   +1.134153502567228e-01   +1.131428549978961e-01   +3.227613566015147e-01   +9.696375623681755e-02   +4.727594490037544e-01   +2.087825265721263e-02   -1.902779308460616e-01   -3.995000640138741e-02   -4.247914346888014e-01; -3.863432827612956e-01   +1.535382935404124e-03   -4.417393782192751e-01   -8.279634193153398e-02   -6.384119313921922e-02   -3.579017168695608e-02   -1.420098855330805e-01   +2.913148662612142e-01   -1.233721063195045e-02   -5.364712019581408e-02   -4.395056244566753e-01   +2.769467187723456e-01   -2.691572197465986e-02   +2.412996488417768e-01   +3.276972844881176e-01   +6.574302109579424e-01; +6.394992329046612e-01   -2.885065523496699e-01   -2.547229575278379e-01   -7.895798341201440e-02   +2.270712617862478e-01   -5.151550351643219e-01   -2.337860222741966e-01   +1.257698676333824e-01   +3.806894565593282e-01   +7.761104907840809e-01   -4.238190614151296e-01   -4.437121339540357e-01   -4.168829414952172e-01   -5.311864181549980e-02   +6.235568026658929e-02   +3.769493290784718e-01; -1.435857484855135e-01   +6.427388710938806e-02   +7.505285188272567e-02   +4.162558123996624e-01   -5.347588872229649e-01   +2.377173703091493e-01   +8.332973152869158e-02   +3.613671247828407e-01   -5.853065472931100e-01   -1.963323526278067e-01   -2.052020759856295e-01   -1.538931173257353e-01   +1.030708446269826e-01   +1.484189614395090e-02   -4.964319097910021e-01   +7.057934483248421e-02; +2.975623817596713e-01   +1.270966285533831e-01   -1.326484575318056e-01   +2.633602347547460e-01   +1.272108575238601e-01   +3.592662164065993e-01   -4.181743574274077e-01   +2.514332170753145e-01   +3.115590209145435e-01   -3.134154703089606e-02   -3.216992133123799e-01   +4.938731057724838e-02   +4.074104982066035e-01   -2.982703108325090e-01   -2.699326480935211e-01   +5.850098773405040e-01];
L2I_L2E_iAMPA_netcon = [-8.045614938787927e-02   +4.914809149701518e-02   -4.289620298725433e-01   +4.932063698222610e-01   -1.058275821199426e-01   +1.000000000000000e+00   +4.174828209864160e-01   -4.873313520568130e-01; +6.162220629200443e-01   +6.612895509239347e-02   -6.806603811195699e-02   +2.727899679874247e-01   +2.145259501865013e-01   +9.332635878775544e-02   -3.702522113122647e-01   +4.999702781007517e-02; +9.237625342048199e-02   -6.457064924535465e-02   -3.345324224650152e-01   -4.206036451155734e-01   +4.869709782463474e-02   -8.957751150817325e-02   +5.261323555332428e-01   +3.137042016420460e-02; -4.534422261495031e-01   +4.311498717007642e-01   -4.765638496168546e-01   -1.833934888380538e-02   -3.490003640336021e-01   +7.880806741794179e-03   -7.250758978759991e-02   -8.010655664698101e-02; +2.540361985822300e-01   +2.432073625892142e-01   +5.722807311415559e-01   +5.252165211862181e-01   +2.248949020915385e-01   -8.164148903436814e-02   +3.325879478992226e-01   -4.262999102801523e-01; -7.642950002593582e-02   -6.470589945011690e-02   +4.043215156027426e-01   -2.663551321293292e-01   +3.084862990499572e-01   -8.920828424235804e-02   -6.766187507078143e-01   -4.564473861113467e-01; -2.300177144000967e-01   +4.366907576801477e-02   +1.765192090481132e-01   -1.001416973346852e-01   +2.709683659015029e-01   -2.624383645231280e-01   -2.541013569259205e-01   -2.159534843079862e-01; -3.640867459668242e-01   +8.603072359816186e-02   -7.662694085744005e-02   -5.607252709972630e-01   +3.937758396103668e-01   -8.185042717403922e-01   -6.508397915466067e-02   -5.741480805558860e-01];
L2E_L2I_iGABA_netcon = [+7.864942891668858e-01   -3.492742121531510e-01   +1.556578657476786e-01   -5.872935791197897e-01   +3.805047226565416e-01   +2.520691653206345e-01   +2.737471884854397e-01   -3.244982770393634e-01; -4.301816195535253e-01   -2.190699570140192e-01   +1.619136461595234e-01   -2.357554113939773e-02   +3.864298170801431e-02   +5.257737091508132e-01   -7.557072552161326e-02   -1.796439755404288e-01; +1.185538037705444e-02   -2.002063680198978e-01   +1.104593987838875e-01   +3.993830373301804e-02   -6.957859310710718e-02   -1.734581550911733e-01   -6.694096291880060e-01   +7.239186909681976e-01; -1.086591120797791e-01   +1.072212433611456e-01   -4.211874091834544e-01   -3.941769751671761e-02   +8.253165191489645e-01   -5.180323658517579e-01   +8.990442378092742e-02   +4.119777398877938e-01; +5.396728999701962e-01   -8.173730324290425e-01   -4.076927435503381e-01   +5.661196442877273e-01   +2.943301738480499e-01   +2.500681406833641e-01   +5.556840627980636e-01   -2.074976423330118e-01; -2.922596178927059e-01   -2.676711923206419e-02   +5.330310943630285e-01   -3.520924407951086e-01   +3.057278263553200e-01   -1.298765050097170e-01   +1.413236223784501e-01   -4.629658123284530e-01; +1.943949273440445e-01   +1.684292606978438e-01   +5.004861553427876e-01   -8.196870452980515e-02   -9.056615106813131e-01   +1.451705774092849e-01   -2.362013687890401e-02   -3.440765826242024e-01; +4.003524286109796e-02   -9.093185207883296e-01   -2.070841901400949e-01   +1.389018159189856e-01   +2.560635222872109e-01   +1.667357679123254e-01   -6.370102326329602e-02   -5.412835556481990e-01];
L3E_L2E_iAMPA_netcon = [-2.168941085664644e-01   +1.388744309266796e-01   -5.409933853187927e-01   +3.926568566057095e-02   +9.082244220823248e-02   +3.496466775159280e-01   -5.274900600628780e-01   -2.260129362693185e-01   +2.531851359527736e-01   -4.391844683269859e-01   -4.907215813231498e-02   -2.420096748615950e-01; +3.173080604522703e-01   +2.387165028869786e-01   +2.637151521064903e-01   +6.793508866959687e-01   +1.937530671157528e-02   +1.750034482014577e-01   +1.116213302990683e-01   +7.507802284749132e-01   +5.461555449548106e-01   -2.248102350072343e-01   -9.023746642682381e-02   -4.443504547512307e-01; -6.276511709611224e-02   +1.258425466298526e-01   -1.335014314545850e-01   +5.295147098018719e-01   -5.453283215903891e-01   -1.847625943088734e-01   -1.100970624882208e-01   -3.083030908023485e-01   +3.321216220993923e-01   -3.238878437876062e-01   +2.581826662027200e-01   +3.885705482329130e-01; -4.033951187967940e-01   +6.821438568858451e-02   -5.598334775138015e-01   -6.050590837414113e-02   +4.230894026422581e-01   -2.203628866466506e-01   -5.000594270498371e-03   -1.840961265031930e-01   +3.322953282183543e-01   -3.597769431448662e-01   -5.388951180800455e-01   -3.336370083569854e-01; +2.483078267151074e-01   -7.522483568012440e-01   -1.806675077337239e-01   -2.004911665559504e-01   -1.213817743807393e-01   -5.969202517674486e-02   +1.663516754923624e-01   -9.384450932362678e-01   +3.577076376734325e-01   -2.052473685947082e-01   +3.866547068740239e-02   +5.238296576323757e-01; +7.033134320301500e-01   -2.113345994609581e-01   +9.903685620975838e-02   -3.388838281373251e-01   -5.061610433058072e-02   +5.029381716653751e-01   +1.374427212017433e-01   +3.831043658967271e-01   -4.853135473923928e-01   +9.153969788707061e-02   +2.483013411637303e-01   -1.073354091518468e-01; -1.294846393138153e-01   +7.648639396146219e-02   -4.822181134857632e-01   +2.578780800170004e-01   -5.745564600793749e-01   -4.638211209680307e-01   -4.885861479255527e-01   +2.570498362082030e-01   -5.411150117001925e-01   +6.046965834307781e-01   +2.442270567384326e-01   -2.248344740138526e-01; +2.301063252533641e-01   -4.960409227082968e-01   +2.355849470044788e-01   +3.873777854596135e-01   -2.133122303678227e-01   -1.274212851214971e-01   -9.103841784183470e-03   +1.601191916191360e-01   +2.025489940473473e-01   +1.465121082852587e-01   +9.356541009872329e-01   -7.031013529333714e-01];
L3I_L2I_iGABA_netcon = [+3.295240856998549e-01   +6.251444941174171e-02   -5.134277597378681e-01   +3.607480531998444e-02   -2.615896641908572e-01   +5.237372438231708e-02   -4.396601238033289e-01   -2.117859835299127e-01   -1.244144462156384e-01   +1.598774113343283e-01   +1.942782992046900e-01   +1.931811396632231e-01; +2.133617604656045e-01   -5.061698916450309e-01   +7.356055279334590e-01   -2.905545290860351e-01   -1.744226361358561e-01   +5.094608765293466e-01   +4.370701678542459e-02   +1.424307335893646e-01   +1.665866364277096e-01   +3.017455025497821e-01   -4.920098073892451e-02   +6.892469008059454e-02; -2.875852373634663e-03   +1.444733813831009e-01   +1.480352114174207e-01   +2.305445447590099e-01   -3.511416696414049e-02   +4.150940138992084e-01   +1.219119538663495e-01   -3.176343651324525e-01   -6.428293358056082e-01   -9.793391022136391e-02   -3.660839675437955e-01   -5.084354949430302e-01; +1.340295359941617e-01   +7.155765778628190e-01   +1.904027086374353e-01   -2.971740235330351e-02   +8.638314719747017e-02   -4.155095974526342e-01   +5.407472805199522e-01   -3.243089206146043e-01   +7.328658168053411e-01   -4.327310789529341e-01   +7.447936198598488e-01   +3.165555215949542e-01; -5.660114365459389e-01   +4.241228894672123e-02   -2.432985062655707e-01   -1.139922915402791e-01   +4.042406430568929e-01   +5.384585394665486e-01   -2.193077872464894e-03   -4.414853240183770e-01   +1.678439217851301e-01   -3.310885350939520e-01   +5.672280646460270e-02   -5.703412941159706e-01; +4.376362210900203e-02   -3.391221551083196e-01   -6.774417395442635e-02   -9.782903205650391e-01   +3.081553514266668e-01   -1.637711787595677e-01   +8.409143746729637e-02   +6.136292498194501e-01   +2.658989389821296e-01   -2.888740731315810e-01   +2.685235652232491e-03   +6.544650179637262e-01; +1.311261587076059e-01   +4.412371591636870e-01   -3.371220372191664e-01   -2.847335076422611e-02   -4.427823493941298e-02   -3.124214862264746e-01   +1.260922698723065e-01   +4.722155413363369e-01   +4.425631713060759e-01   +1.865357581845328e-01   -1.096518241397847e-01   -1.454391176107543e-01; +2.856541206565131e-01   +2.613497780784093e-01   +4.136857704261035e-02   +1.632007715922915e-01   +2.489284184493324e-01   +4.387170125049301e-01   +5.974710582220731e-01   +6.499182717763740e-01   -1.897345828322637e-01   -2.496555588664260e-01   +6.699098167580158e-01   -5.244861679671688e-01];
L2E_L3E_iAMPA_netcon = [+8.740589658466486e-02   -1.840009467074499e-01   -2.971891010492793e-01   -1.877714859225108e-01   +6.294485224614889e-01   -1.675219491040978e-02   +4.262427195749011e-01   +1.736507492854951e-02; +5.065922287260842e-01   +9.054419751471909e-02   -5.781471110803878e-02   +1.019350818819267e-01   +3.965612839826296e-01   -6.778413057186798e-01   -1.910157398339965e-01   -1.098381297480553e-01; -5.337880496519924e-01   -2.164518440458959e-01   +3.231316315035686e-01   +2.553201593307540e-01   -3.345579082740813e-01   +3.699771989400020e-01   -1.122889931425050e-01   -2.597212892955219e-01; +2.068858756847628e-01   -2.386211150423966e-01   +1.955785163006728e-01   +9.618002578594520e-02   +3.275470600311070e-01   +3.230601135557722e-02   +1.393832431303530e-01   +6.437448427565318e-02; -3.155440086657552e-01   +4.205641411278215e-02   -6.649531855720698e-01   -2.207378683009875e-01   -8.584136400393083e-02   +1.112354303917483e-01   -7.104105965906242e-01   +3.100921645004516e-01; +1.570157371925944e-01   -2.218623128958108e-01   +1.655979198772176e-01   +2.557704489573679e-01   -8.840260235807233e-02   +2.559294928470746e-01   -1.684431777927421e-01   -1.449260677086305e-01; -3.033922869734068e-01   -6.782541848515490e-03   -1.348610592146673e-01   +4.840906401679284e-01   -5.248260605991845e-01   -9.719304534990164e-02   -5.363475343502649e-01   +2.298496078599490e-01; +1.604488902641724e-01   +7.529579077206616e-02   -1.874934216852660e-01   -5.930051621552832e-01   -3.936107063561697e-01   -6.920179187978427e-02   -7.243881102077268e-01   -4.522083745659727e-02; -1.057191974631574e-01   -2.011046086429759e-01   +3.609748361439293e-01   +2.324149628849408e-01   +6.279706389861327e-01   +5.303944001264312e-01   +1.874355835087069e-01   -3.551355560768757e-01; -7.554255204741206e-02   +7.347001413824245e-02   -3.089985873235060e-01   -1.031773191000496e-01   -8.853837087849028e-01   -7.048885064136268e-01   +1.359562750220962e-01   +9.446530897858789e-02; -3.352753444915407e-01   -2.277119717489884e-01   +1.039253582589181e-01   -2.184482445153086e-02   -1.030658355996070e-01   -2.537735321188292e-01   +2.797847851380099e-01   +4.095275647458261e-01; -6.834369413541669e-02   +7.177139922480320e-03   -7.679319911039026e-02   +1.241929881952432e-01   +1.748154104453100e-01   +6.312856103613782e-01   -9.964399619052766e-03   -2.935154398289861e-01];
L2I_L3I_iGABA_netcon = [-2.133518216199119e-01   +6.735839116667249e-01   -1.513586615238109e-01   +8.889072361981545e-02   -1.914082455384617e-01   -1.309750588240441e-01   -1.970297366239757e-01   +1.344070773136289e-01; +2.000893664126005e-01   -5.388106883644996e-01   +3.070154146733567e-01   -4.423727697460172e-01   +1.892106534438380e-01   +1.028087513727128e-01   -4.227659143648071e-01   -6.732605602066991e-02; +3.318730882667300e-01   -6.373360208032729e-02   +3.590746442880305e-01   +3.299070741749371e-01   +8.656864201901501e-01   -9.148004671273385e-03   -2.252892464333744e-01   -3.004467067581622e-01; +1.314387452640953e-01   -3.025037770193956e-01   +2.897021741685906e-01   -5.888600858343550e-03   -3.738309503365712e-01   +2.529404024844203e-02   +4.272400783408882e-01   +3.628520490052797e-01; +2.547630700712324e-01   +1.245784701507997e-01   -2.305114367455876e-01   +3.174671682248556e-01   +3.361796567551437e-01   -5.733903631258241e-01   -2.481741438275511e-01   -8.152843360877998e-02; +5.682841306991346e-02   -1.342985888900569e-01   -4.043092641051608e-01   +3.772762726253659e-01   +5.125950216117489e-01   +5.720925953742585e-01   +3.956721073203844e-01   -2.478918851077698e-01; -9.505902899343738e-02   +6.352567099442610e-02   -1.944139608597915e-01   +1.647142495630633e-01   +4.825543697436872e-01   -1.002828189034446e-01   +8.675694138477466e-02   -8.344169227139059e-02; +2.020177624449143e-01   -1.580293900906070e-02   +3.095685633680159e-01   +3.993435106576966e-01   -1.684230075142917e-01   -3.521290413317629e-01   -2.159768024545294e-02   +8.571758774505439e-02; +2.600854301508351e-01   +7.646646296055292e-01   +6.839509138640899e-01   +3.856324610366194e-02   +3.093508818295485e-01   -4.695415460677908e-02   -2.582006112151420e-01   +3.654196363294549e-01; +2.526073937193779e-02   -5.070829936565288e-01   +1.775731849506884e-01   -1.457027370126391e-02   -2.280984384888442e-01   -9.517914776198277e-02   -8.501813323940274e-02   -9.770581978087620e-02; +1.579289896350577e-01   +1.432641166545571e-01   -2.018504449309489e-01   +4.045307913643317e-01   -3.125733739816745e-01   -1.833472339523769e-02   +1.497779709509374e-01   -3.953390653185229e-01; -3.621607807954152e-01   +2.248739487313633e-01   +1.096145028119980e-01   +2.409745310862686e-01   -1.217187457169578e-01   +4.606855732671220e-02   +1.088886859885973e-01   -3.792810533365821e-01];
L3I_L3E_iAMPA_netcon = [-5.807930770188311e-01   +1.527532203370900e-01   -6.807276004855867e-02   +1.111211960107535e-01   -1.036234002631437e-01   +1.177519444162706e-01   -6.608128801302129e-02   +1.133412929055343e-01   +2.257587508077686e-01   -7.162206561711017e-02   +1.558465572712477e-01   +3.511380483371405e-01; -6.072307551496403e-01   +1.569665061762864e-01   +1.351086411872410e-01   +2.774987055225328e-01   +4.616254785148854e-01   -1.710543367110078e-01   +5.491246296966967e-01   +1.354434192039314e-01   -2.119814221451460e-01   +2.092894228054933e-01   -4.065457179810252e-01   +1.345096122478417e-01; +5.236621160355006e-01   +3.775314978815978e-01   -3.724241115693071e-01   +3.001017354936709e-01   -1.148647071786048e-01   +2.403638243552144e-02   +6.762089276278304e-01   +6.902805516522573e-02   -6.520878300785596e-01   +1.001863345826453e-01   +4.625217886194471e-01   +7.511883228967876e-02; -9.813482214574823e-02   +3.989755852330296e-01   -9.621213428385726e-02   +5.982599749724395e-01   -2.368998266910644e-03   +6.202056816260357e-01   -1.952899998486462e-01   -2.948836248426453e-01   -3.202925772544547e-01   -1.158380969528640e-01   +3.409437724657919e-01   +3.027033997067292e-01; -2.638984681561815e-01   -2.743778919129605e-02   +1.784071727887483e-01   +5.036936228913930e-01   -1.788447313054595e-02   -4.219860488093932e-01   +2.336252760342206e-01   -2.625809382033177e-01   +5.417414254594513e-01   -2.447014925316160e-02   -6.225952262943889e-02   +1.875294199382023e-01; +5.471093923030059e-01   -3.502106918462319e-01   +3.523007364269243e-01   +4.324901065815795e-01   -2.272685288869557e-01   +5.655388361495774e-02   -1.629431674053277e-01   +2.960330275634994e-01   +2.154696068185709e-01   +5.209027400071966e-01   +6.425800804053313e-01   -3.505201292028398e-01; +2.890007799349003e-01   -5.536369237928210e-02   -2.087423533607732e-01   +4.114534727002238e-01   +3.169304319128043e-02   -6.698454041989310e-01   -5.372070369905069e-01   +4.381321369544477e-02   +3.206556362403641e-01   +3.611722085981026e-01   -7.409048927050835e-02   +4.016775543085664e-01; +3.901852428892146e-01   -2.974578801715949e-01   +6.681198923646234e-01   -4.322553383537544e-01   +3.106158718545843e-01   -2.901718468224055e-01   -3.164352732013555e-01   -1.533196606669542e-01   -1.797467746424263e-01   -2.699341271467072e-01   +2.049138327869408e-01   +3.077642145540004e-01; -5.676248511024096e-02   +7.247820628939019e-01   -4.004183623920579e-01   -3.165275722231691e-01   +1.115020618866340e-01   +1.013144072291025e-01   -3.403083603281182e-01   +2.029076004671902e-01   +6.499940284402417e-02   -5.626528943130676e-03   +5.330862040798839e-01   +2.383773874275030e-01; -3.053086454097204e-02   +3.537106868095140e-01   -1.708422610787450e-01   +1.920178125144815e-01   +2.517890812244432e-01   -1.357208840365260e-01   -1.963996196559146e-01   +4.952017411473760e-01   +6.310857063356502e-01   -1.503968288339444e-01   +9.796873716595993e-02   +5.729694369286555e-01; -1.781545083688188e-01   -9.735360747582965e-02   -6.949197037513428e-02   -2.245592655416422e-01   +8.387711213428978e-02   +5.792149314045146e-01   +7.346915438980520e-02   +5.034070613621973e-01   -8.304167581126044e-01   -5.142067030635666e-01   -3.612831057674433e-01   -1.679655300212918e-01; +3.154173988561466e-01   +3.954984437210987e-01   -3.482888794726902e-01   -6.596962662395653e-02   +3.290630251866030e-01   -3.848071387711763e-01   -2.011371889595749e-01   +2.872547980105505e-02   +9.286654008000600e-02   -5.687251865027810e-01   -2.793680355001023e-01   -3.483881663653622e-01];
L3E_L3I_iGABA_netcon = [+1.860863839011497e-01   -5.181233294098195e-02   -1.346828893720938e-01   -2.676543499985155e-01   +9.437227414808391e-02   -1.958576189243660e-01   +2.890395300415683e-01   -5.608995980598078e-02   -1.747213610193973e-01   +4.151785281815054e-02   +4.519743748589360e-01   -5.160325583065225e-01; -1.836163898716116e-01   -6.914401392288871e-02   -7.599636585693378e-01   +4.385471924191546e-02   +4.054549435085782e-01   -4.185071056458392e-01   +4.233805669996210e-01   +1.578759268552211e-02   +2.889146593653224e-01   +1.429836945524180e-01   +2.596362835662170e-01   +3.066150573271254e-02; +1.594197400901856e-01   -1.131385021583169e-01   -5.472859833578534e-01   +8.301766488948913e-02   +3.901979332987766e-02   -1.319380027260456e-01   +7.277708490469940e-01   +2.685495857284130e-01   -4.668353715277615e-01   +3.558673217889423e-01   -1.498059156440314e-01   +1.617958477258524e-01; +7.555670656852085e-01   +3.410314983124128e-01   -4.615461344492734e-01   +5.855690046515993e-02   -6.858818531669346e-01   -3.039162820562766e-01   -3.916380866455673e-01   -1.211978627663779e-02   +1.602433725013427e-02   +4.870931106278719e-01   +2.966624624135552e-01   +1.953157698392244e-01; +2.784196909177899e-03   -1.709639826627007e-02   -2.020525396299573e-01   +6.577909542578211e-01   -3.986074475320174e-01   +4.414345965081240e-01   +4.681998894489414e-01   +4.432801615954593e-02   -1.897094596171913e-01   -1.688347382118944e-01   -1.780085531337489e-02   +3.460305370768937e-02; -1.001070297588366e-01   -3.676875565240569e-01   -3.248601745863627e-02   -1.383138893920732e-01   -2.999481323225803e-02   -2.645860450909295e-01   -4.370341791778454e-01   +3.800331484945871e-01   +3.138488198895194e-01   +8.087750795133544e-02   +7.668333475313370e-02   -2.476418212529352e-02; +3.253845639069838e-01   +1.648519470664123e-01   +2.533760415976944e-01   -9.399742342029892e-02   -1.720510718406872e-01   +2.156270058466060e-01   -5.068730470557765e-01   -4.463785800196426e-01   -1.627396669185758e-01   -2.011369517851102e-01   -1.689960418005156e-01   +4.075058647388341e-01; +6.510832432596722e-01   +1.204539301491429e-01   -2.029355921302087e-01   -2.155294678661553e-02   +8.287267293310091e-01   -7.686355923914957e-01   +6.261803958314499e-01   +1.205701803401601e-01   -2.413723337821430e-01   -4.520679621412627e-01   +5.555168764693811e-01   -7.260190681409931e-02; +9.627124381135832e-02   +8.823358358351803e-01   +3.030359072236603e-01   +7.028678799340639e-03   +9.536670881535236e-02   +2.627319970509902e-01   +1.094254553151483e-01   +3.474950181447748e-01   +2.687299142427684e-01   +5.202449647679352e-01   -9.703352151578973e-02   -4.566544638467582e-01; -2.244731155988139e-01   -1.613756079459180e-01   +3.419723139185726e-02   -7.463256779009684e-01   +5.746695756995891e-01   -2.451199737927172e-01   -1.985051030934939e-01   +3.061088447684768e-02   +2.889806191423606e-01   +6.108291374245736e-01   +6.415417062127902e-02   +3.964557024826425e-01; -5.758747052631213e-03   +1.873256824243603e-01   +3.819769547342103e-02   +4.786949866007620e-01   -3.495725677764114e-01   -5.598152723018324e-01   -1.496719830256854e-01   +3.821374273668159e-01   +2.628908079676501e-01   +2.476695429510682e-01   +4.684213647536163e-01   -3.310321298131750e-01; +1.369255395441213e-01   -3.031889076807003e-01   -1.795191699787721e-01   +3.260937361397868e-01   +1.984010011195761e-01   +7.770301626625706e-02   -5.738811605676332e-03   -1.130139382980601e-01   -4.670946817409114e-01   -7.119365390355133e-02   -2.478595652284486e-01   +2.782211302567602e-01];
L2E_Input1_iAMPA_netcon = [+1.360587726837614e-01   +5.165356375666710e-02   +1.728393166141293e-01   +5.152631777717516e-01   -4.446164296365496e-01   -8.913480920334177e-01   +6.597670696405863e-01   -2.002014793726527e-01];
L2I_Input2_iAMPA_netcon = [-5.986960579514790e-01   +3.516779213286002e-01   -3.533334018839874e-01   -1.591910853557585e-01   -1.498847095602264e-01   +4.167174202469738e-01   -2.278214376889925e-02   -1.669716807373483e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
