function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.349059313037789e-01   -1.438511958701692e-01   -4.997360844509211e-01   -3.176996394599793e-01   -5.128672861528382e-02   -6.187911041639388e-01   +7.772799585666373e-01   +5.736942438218152e-02   -4.377682285886946e-01   +5.025939578772324e-02   -1.387782562422539e-02   -5.155146878592451e-02   +5.048003558381136e-01   +5.004246226448354e-01   -3.202513882527293e-01   +1.621698150209218e-01; -1.753771925015744e-01   -6.699772549599006e-01   -2.388928490697367e-02   -6.539497808650806e-02   -1.986434839007236e-01   -3.572439945630733e-01   -3.227724544208865e-01   +3.848072176574809e-01   -2.452746482020808e-01   +3.294486579912352e-02   +5.973866509877663e-01   +1.395614363599028e-01   -1.728981010310710e-02   +2.817580445094874e-01   +6.649471564280250e-01   +2.976314445998292e-01; -5.962022910426150e-02   +4.549899820740642e-01   -9.398801056999023e-02   +1.439724414310767e-01   -2.037112509406583e-01   +1.007416422058237e-01   -2.303366938342547e-01   +1.099647861336297e-02   +3.706790589845725e-01   +2.554103644234955e-01   -5.877273429599016e-02   -3.364489558835919e-01   +4.462799451635325e-01   -3.354063514789355e-01   +2.255363696417431e-01   -2.507781568906850e-01; -2.274246422494648e-01   +1.802052595298802e-02   +4.841279209044185e-02   +3.827007438470000e-02   -1.545866985870469e-02   -7.071926383212001e-01   -9.830173354076660e-02   -6.106374759903238e-01   -3.166483171052258e-01   -1.003686853536554e-01   +1.112850939947161e-01   -7.931185637709928e-02   -2.338408919198339e-01   +1.975727468716377e-01   +4.690163030956873e-01   -4.572665564089317e-01; +8.717952706823402e-02   +5.132339738123346e-01   -3.207090944658998e-01   -3.987010077198087e-01   +1.724112304755807e-02   -8.359277139184635e-01   -2.430291858336845e-01   +3.214099855886150e-01   +4.214717825265292e-01   -4.127928718389036e-01   +8.133055973377168e-01   +2.754306526943304e-02   -1.010266688052297e-01   +5.321384331668234e-01   +5.661205987095161e-01   -9.046290313143763e-01; -1.634965195286335e-01   +4.218094527174070e-02   +3.416986752062618e-01   +4.382314048893903e-01   -2.329423689223176e-01   +1.855171704316196e-01   -1.946759272349567e-01   +2.984244274504482e-01   -2.474188340217571e-01   +2.128976407235352e-01   -3.394442752499424e-01   +1.044985083855001e-01   +1.614842567463901e-01   -1.708466972801264e-01   -2.700009188818312e-02   +4.588903987754471e-01; +3.079121811343974e-01   +1.654686232504957e-01   -2.448647118998314e-01   +3.602482363374995e-01   +3.600969073374286e-02   -1.072385474476219e-01   -3.723144854868553e-02   +6.102592169244017e-02   -5.348963571692168e-02   -3.034222839475773e-01   -4.038418733510460e-01   -2.218208885447166e-02   +5.739458109430658e-02   +2.746923640586106e-01   +3.293526288795178e-01   -4.120778117069888e-01; +4.688362777994154e-01   +5.270428543607113e-01   +2.696599416030415e-01   -1.982837054410683e-01   -6.256733248832062e-01   +1.195988376911069e-01   +7.690480931957634e-01   +2.096303545330732e-01   -4.650002650036101e-01   -4.137896924587546e-02   +5.982670846119663e-01   +5.049987031412827e-02   -1.181291963146528e-01   -2.919384755839761e-01   -4.956497444821200e-01   +2.557958356169251e-01; +1.606937310770190e-01   +3.338034092417912e-02   +9.064905610205405e-02   +6.871235057229169e-01   +4.754607112515845e-01   -3.755725131792275e-01   +9.044893127061645e-01   -3.885376146695736e-01   -2.756397813566088e-01   +5.847742157245142e-01   +2.951099660503843e-01   +4.795938762888801e-01   -5.419946627908563e-01   -2.721667520578842e-01   -7.500189379372141e-02   -3.877646192072141e-01; -5.743504050191542e-02   +3.633732512526388e-01   +5.640017619886962e-01   -1.023044024286835e-01   +2.235023398335616e-01   +4.072034376436985e-01   +8.530239787461931e-02   +2.265209510333135e-01   +1.324420663136088e-02   -1.065279466469486e-01   -1.670810982084509e-01   +1.861256514603132e-01   -2.039129738302811e-01   -3.895991944432017e-01   -2.035134463608202e-01   -7.972373257441900e-01; -6.227609811115888e-01   +6.744002942521576e-01   +2.328640672580425e-02   +3.816146676337656e-01   -5.857968597728408e-01   -1.658976748692093e-01   +5.024401095905889e-02   -9.133504606302881e-01   +5.325795363764106e-01   -9.042799553123327e-01   +6.206227439933064e-01   +3.330985819201823e-02   -1.767572711211082e-01   -2.959972811714960e-01   +4.506925169045335e-01   +2.637744518564312e-02; +3.116519595744399e-01   -1.569675138499888e-01   +4.137046573279253e-01   +5.501234031201941e-01   -3.521372296952280e-01   +1.000000000000000e+00   +1.542574308069284e-01   -4.026933530502716e-01   -2.553178193541143e-01   -3.909453899295883e-01   -5.273714874883572e-01   +1.086938727398846e-01   -5.555926085795944e-01   +4.914945533258852e-01   -1.401482563630127e-01   +3.765860818689271e-01; -6.328015073634798e-01   -3.700794169492214e-01   +1.502910938420205e-01   +1.321480921868241e-01   +5.668195793175981e-03   -4.216495717362495e-01   +2.065400121010947e-01   +2.426087407143800e-01   +2.183327843631651e-01   +3.683694817648890e-01   +1.128037764271289e-01   +4.043022638858220e-01   -1.825764761669847e-01   -3.967466644187627e-01   +1.717855538273462e-01   +3.602909032081936e-01; -1.536542294717006e-01   +4.057765534292359e-01   +7.257795422513951e-01   -2.949190072811151e-01   +4.740011158373469e-01   -1.333532947162469e-01   +7.214908323000886e-01   +1.410985982511747e-01   -3.994144537319284e-01   +5.622731838432480e-01   -1.293990041285225e-01   +5.975324940641549e-02   +3.321004623647471e-01   +5.386106164091369e-02   -1.663922046649421e-01   -3.795425007205737e-01; -2.877175909829044e-02   +8.404354558204766e-01   -3.576468792815780e-02   -4.517785429149230e-01   -5.265126091601827e-01   +4.289247397421640e-01   -1.202593452219403e-01   -1.924036411335776e-01   -1.764314513061589e-01   +3.438883958129890e-01   -4.236741125034816e-01   +5.253523054257861e-01   -2.337736018563217e-01   +9.372617544268233e-02   +4.743351785518651e-01   -1.334332379791678e-01; +2.631165194873100e-01   +3.676528857553801e-01   +6.115549566111982e-01   -2.473522377860500e-02   -5.089700251656040e-02   +2.711763236728069e-01   -2.041016469111992e-01   +1.208289167653389e-01   +4.093479138158858e-01   +7.965187341275295e-02   -3.129312899046198e-01   -8.401773904338611e-01   +4.498515394537138e-01   +1.389281100276932e-01   +5.475902077821879e-01   +3.495231499380550e-01];
L1E_L1I_iGABA_netcon = [+1.425243305729168e-01   +1.344535893094767e-01   +4.326975137620624e-01   +7.350549319094220e-02   +6.416919282143989e-01   +4.242753005998557e-01   +3.598224100780265e-01   -5.902298820190229e-01   -4.665259624481125e-01   -2.841678615833315e-01   -5.389183165537652e-03   +4.869279662598966e-01   -2.016683423529324e-01   +1.285839773715267e-01   -3.907863823227502e-02   +1.986612335110597e-01; +3.656453488614201e-01   +2.656369314032281e-01   -2.073247254284296e-01   -2.083056240979627e-01   -3.848536660522760e-01   -1.150900740206579e-03   +1.893123943444758e-02   -2.587234161102243e-01   +1.035391527415869e-01   -3.269838261893004e-01   -3.329527940121601e-01   -5.407943859286772e-01   -5.871494483060851e-03   +6.255593087314348e-02   +2.323142134993647e-02   +9.996261004563126e-02; +1.009108498738862e-02   +2.307190098495747e-01   +3.741039882258222e-01   -3.376313984840092e-01   +5.521415156910259e-02   -8.149488677320585e-01   -5.027818357650038e-01   -1.166695736802481e-01   +4.175660517239483e-01   +1.432331046370637e-01   -5.763955041063424e-02   -9.330749257628368e-02   -5.961994170902886e-01   -4.390265058277688e-01   +5.186465353289023e-01   +9.479072776576282e-01; -1.886946341093003e-01   +1.743174051808445e-01   -3.380199540182792e-01   +5.706697172061542e-01   -1.386356214308775e-01   +4.710456435259507e-01   -5.741524288292615e-02   +3.028312664253522e-02   -6.621031715805346e-01   -1.469485867035213e-01   +8.415191987694970e-01   +6.976602636298723e-02   -1.379890946108284e-01   -4.181940642281798e-01   +1.263494688260241e-01   -1.410699823385557e-01; -9.185787634461577e-02   +4.473170772223054e-01   -7.587503633309810e-01   +2.805788767284854e-01   -5.759906705716809e-02   -2.190220363400692e-01   -3.817040658814672e-01   -3.190732923576000e-02   +3.215506266492309e-02   -2.968002953054556e-01   -4.725594863069055e-01   -5.886037965649678e-01   -9.496852349493964e-02   -7.752850802880731e-02   +5.768046544099837e-01   +2.164805325723394e-01; -3.001827179621300e-01   +1.249010027528105e-01   +6.473395845666426e-02   -2.233696082310166e-01   -5.061677577167982e-01   -1.146726525465415e-01   +3.411940259533003e-01   +4.520009392227881e-01   -1.827831336913570e-01   -5.514811424601883e-01   +7.949577390845743e-02   +2.516422980805904e-01   +2.770241365010143e-01   -6.990746802139045e-02   -1.512907001839892e-01   -5.921040599889708e-01; -8.078091013716326e-02   +1.886980382132505e-01   +3.380435674492568e-01   +3.968743370530147e-01   +6.042453203462306e-02   -1.557178572799272e-01   +2.271602308702739e-01   -4.245815022484810e-01   +3.335306975135034e-03   +2.363609531571202e-01   +1.516480417050192e-01   +5.135741060705044e-02   -3.297263696872884e-01   -6.780365622533771e-02   -6.776998022681703e-02   -2.925649649728890e-01; -1.178492401383929e-03   +1.192313377877971e-01   -4.749174467539179e-02   +1.618534415594579e-01   -3.969000606065797e-01   +8.310464048207145e-01   +4.608972581614946e-01   -4.493936201886816e-01   -3.650741039859376e-01   +6.901115619396521e-01   -5.607448762560561e-01   -1.642754180185018e-01   -6.988220700444793e-02   -3.541966556180782e-01   +1.347550162727604e-02   +5.028205501748835e-01; +8.590063480679883e-01   -7.488039234170915e-03   -1.543118327345115e-01   -1.887633974840957e-01   +4.071437475971885e-01   -4.630165619250884e-01   -5.440375005431554e-01   -1.486332010511970e-01   -3.577162666608527e-01   +3.676581500138934e-01   -1.069586545361136e-01   +4.406824728453745e-01   +5.796251806851281e-01   +5.629984381832274e-01   -3.954828661041749e-01   -1.893633738663815e-01; +2.657729766350274e-01   -7.007248805846370e-01   -1.912149670902951e-01   -1.182906652342356e-01   -3.899005678796504e-03   -1.228213438615739e-01   +3.967555960082553e-01   -5.782661623642892e-01   -3.877519324293671e-01   -5.248023811177419e-01   +5.017749901470928e-02   +6.960986184548343e-01   -2.615616848935360e-01   +8.445192867558764e-02   -1.283215695815113e-01   -3.902151916324642e-01; +6.247996237073228e-01   +2.084308870958076e-01   +2.267124245422759e-02   -5.565906870113760e-01   +2.835985034667202e-01   +5.619889887182017e-01   -3.147086803282403e-01   -8.664081968621734e-02   -1.219753511186080e-01   -5.327474108391110e-01   +5.882554573993389e-01   +2.399703943485161e-02   -1.192976455360748e-01   +1.550364620875260e-01   -3.811004664935045e-01   +2.356309486769735e-01; +7.225439559418786e-01   +1.895257611886671e-01   +1.128139728912985e-01   -1.537409349063334e-01   +2.404720323608686e-01   +4.585787957544232e-01   -3.656925008311077e-01   -3.436592641857157e-02   -2.030617514897959e-01   -1.883741724266725e-01   -5.803188344693170e-01   -5.935294701206154e-01   +4.842685964337544e-01   -3.124062021826294e-01   +4.872562342762562e-01   -6.411502575278468e-01; +7.196901935105122e-02   +3.095295227647473e-01   -5.238805995340481e-01   -4.657726921343555e-01   +4.850844112215768e-01   +5.704648271807998e-01   -4.316075945712889e-02   -4.107045205656718e-01   +1.934699712711124e-01   -7.757011015042846e-01   -6.121702743463828e-01   +1.229365179198014e-01   -3.487304694462306e-01   -1.871917590149961e-01   +4.233782097260461e-01   -1.029429126983387e-01; -4.037004665007675e-01   -2.801351249061376e-02   +2.700873840022313e-01   +3.012498156064341e-02   +1.904730290202352e-01   +1.339553218328037e-01   +9.237581466870745e-03   -9.213776282570972e-02   -2.410337354398298e-02   -6.053228919802305e-01   -2.972080930124246e-01   -9.833883523524226e-01   +7.262547487667693e-02   -7.665542433176378e-02   +3.658980972234500e-01   -2.004244666996045e-01; +3.377459796911315e-01   -7.069776006851580e-01   -3.550984727867039e-01   -2.364575291952242e-01   -3.918584925460620e-01   -1.867687829419118e-01   +6.528608051482112e-03   +1.640693063196592e-01   +3.864757641115509e-01   -4.955206801390979e-02   -4.800470130804281e-02   -2.990888744569605e-01   -3.158405401470237e-01   +2.122407914076938e-01   +5.059560544187529e-01   -1.307777328407169e-01; +3.464220273815534e-01   -6.719645336316992e-01   -3.850103304191973e-01   -2.459899506585817e-02   +4.349007994816226e-01   -1.000000000000000e+00   +1.476135823127595e-01   -1.154920901309408e-01   -4.345785647136664e-01   -2.521124225672869e-01   -5.848628081648909e-01   -2.040902635862223e-01   +3.420938892407233e-01   +1.168192433953505e-01   -5.637961713578821e-01   +4.956292908824271e-01];
L2I_L1I_iGABA_netcon = [+5.118402882984003e-01   +5.070094627113582e-01   -7.832273946603197e-02   -1.095383969907276e-01   +6.890313888621918e-01   +2.196753839032399e-01   -6.410132707883862e-03   +5.789667385929316e-01; +9.107677020945595e-02   -1.846557358633414e-01   +3.365174422629302e-01   -1.616179133922784e-01   +4.964691782379448e-01   +4.865639286816713e-01   -6.109676341423503e-02   +4.354682415316276e-03; +3.535699755280540e-01   -4.392220017121816e-01   +3.882850895015765e-01   -5.733378095575982e-01   -6.860168380271635e-01   -1.492327959502249e-01   -1.560869421206686e-01   +5.689777828654108e-01; +6.907495519810658e-02   +4.206114540073094e-01   +2.423951853047119e-01   -6.872275414878884e-02   -2.466887585425608e-01   -1.033835547244798e-01   -4.327377006852134e-02   -3.972086855750093e-01; +1.005659953806534e-01   +6.683521721207064e-01   +2.014282615737703e-01   -1.711612385865208e-01   -9.115789052330139e-01   +1.752066189597331e-01   -7.113102630674425e-02   +4.858146452985925e-01; -3.831358981680643e-01   +3.762467031380118e-01   +6.194385065943991e-03   +6.043865590936542e-02   +2.598005417805053e-01   -4.124955751460199e-01   +6.268668415393084e-01   -1.456175865904496e-01; -2.742824796480172e-02   +9.423221396316966e-01   +5.516901710406172e-01   +2.265243817147663e-01   +2.459377222621080e-01   -5.381780648240858e-01   +3.076269166659673e-01   +1.775080893248430e-01; +3.509763392651424e-01   +3.471025557758101e-01   -3.154665571029422e-03   -2.116966610564239e-01   -1.000000000000000e+00   -3.803912628203917e-01   -2.681498717267515e-01   +1.605828462264920e-01; -1.096081339728311e-03   -3.560340385081929e-02   -1.969229229005384e-01   +4.666813594384618e-01   -1.266796771750030e-01   -2.570439395887142e-01   -3.949470966412405e-01   +6.474139563916712e-02; -4.063044869988272e-01   -7.121068876764081e-01   -3.756745025548807e-01   -4.264851977461136e-01   -1.335241267257246e-01   +3.395582705342526e-01   +8.755527596261417e-02   +1.922658650404835e-01; +7.080334870289784e-01   -4.161094836771600e-01   +1.624047012781973e-01   +5.444255182405446e-02   +3.896673495226555e-01   +5.871795042820398e-02   -4.575101509642955e-02   -2.937259144963491e-01; -2.562358168129961e-01   -3.261923174139658e-01   +4.910199422857127e-02   -2.406864970527446e-01   +1.820417774513442e-01   +1.091137850420240e-01   -2.774303969347265e-01   +4.306194027917724e-01; -7.324193096559239e-01   -3.046302854875504e-01   -2.306840161599588e-01   +3.433702293042587e-01   +2.971221930567634e-01   +7.737773459743445e-02   -3.596635000246087e-01   -2.393339134820795e-01; +5.433781997702648e-01   +8.075937255394873e-05   +2.226521147981260e-01   +4.992434277975579e-01   -6.329314566828377e-02   -5.784874536683849e-02   +3.980108863435462e-01   -3.940490580381316e-01; +2.408641722322294e-01   -5.117750787304456e-01   -2.230050567113020e-01   -4.539525274475867e-01   +2.644522043162808e-01   +3.473771785386333e-01   +3.257487073013725e-01   -1.620448935821376e-01; -2.121004115527236e-01   +3.293305565417778e-01   +4.206773207884478e-01   -2.768325844081226e-01   +5.599818094280846e-01   +2.395874785590519e-01   -5.874050673116056e-02   +9.623204024344011e-01];
L1I_L2I_iGABA_netcon = [-1.346983925489754e-01   +1.035694877353381e-01   -4.579065306671398e-01   -8.093137340490416e-01   +3.416501635855559e-01   +5.608573327405123e-01   -1.052453066305478e-01   -6.482893279636853e-01   +4.431202514380201e-01   +4.110684753755169e-01   -2.259150199697719e-01   +3.724874898740037e-01   -2.325140590185130e-01   -2.693035319091819e-02   +5.585307812804576e-01   -3.787433199973790e-01; -7.755286849734785e-02   +4.368359313002978e-01   +3.821999426522291e-01   -2.722267961097174e-01   -2.289853408848208e-01   -4.092922479724596e-03   -9.855423558793672e-02   -5.598042294868334e-01   +2.042136938886187e-01   -7.699813870497323e-02   -2.335064125881719e-01   -6.122856174123870e-01   -1.938446279404253e-01   +3.784643355838471e-01   +2.821178898042885e-01   -8.949340616610191e-01; +2.861073409104654e-01   -3.121409836505908e-01   -7.401825653607982e-02   +1.789481454311593e-01   -3.047980356912959e-01   +2.403701410282480e-01   +1.028922681136830e-01   -1.771784787802705e-01   +1.261834765301523e-01   -4.857224430493345e-01   -9.783220463447628e-02   -2.418045072880554e-01   +6.023918087440368e-03   +4.374483524900753e-01   +2.729946184648022e-01   +2.693487137790487e-01; -2.416670148797366e-01   -2.198447584666277e-02   +4.052893587530282e-01   -8.590394086154787e-02   +2.526958648945170e-01   -1.076704334405386e-01   +3.452065744406736e-01   +6.384354018826375e-01   -5.060332748663805e-01   -1.441029178517738e-01   -1.195604783504009e-01   +1.177578769912076e-01   +9.801249814560214e-01   +2.066197512549272e-01   -4.588761988815727e-01   +3.695780365516958e-01; +8.124148249098553e-02   +4.654043878704210e-02   -4.784399652398514e-01   -6.627608744143734e-01   -1.488538519928325e-01   +3.885248441803992e-01   -3.891241167540033e-01   -1.572709692683009e-02   +2.197549226997693e-01   -1.000000000000000e+00   -6.151805482774952e-01   -4.884684437898026e-02   +2.063567052395202e-02   +3.496716580920273e-01   +4.442862730615749e-01   -1.161525803920334e-01; -1.075192112864717e-01   +3.583668131703712e-01   +2.753757463664013e-01   +5.232156544520636e-01   +8.296110818670310e-02   +3.363939817310596e-01   -3.370138867419523e-02   -4.129943148656320e-01   +5.561580070591232e-01   -2.202574883617289e-01   +1.009861442773636e-01   -2.566220542244249e-01   -9.610404006969592e-01   -7.574454299872130e-01   +1.161162370724532e-01   +4.637070817938034e-01; -1.649066603348498e-01   +1.357442740118654e-01   +4.155896589493772e-01   -1.358070849990859e-01   +2.797769399657498e-01   -4.479838400522178e-01   -5.876606689893458e-01   -1.090857657456304e-01   +7.909660809946097e-01   -5.617182506382880e-01   +1.774682700766563e-01   -6.518693151831186e-01   -6.770444397080214e-02   -9.307413158020447e-01   -7.948018950277976e-01   -5.421635083751456e-01; +1.844804083266138e-01   +6.919382503038046e-01   -7.046579890375658e-01   -5.929598837590004e-02   -6.053622338496942e-01   +3.075489972673624e-01   +2.165843068837057e-01   -9.192498881796328e-01   -1.760836012295397e-01   -7.386039843625748e-01   +5.446512531710770e-01   +2.953241981082639e-01   +3.087003235204908e-01   +1.781126408570523e-01   +4.275913730519766e-02   -2.970692113746555e-01];
L2E_L1E_iAMPA_netcon = [+2.181122023413217e-01   +2.110720918244272e-01   +7.332091831784526e-01   +6.163272367207275e-01   -6.141414637067364e-01   -2.892840205133079e-01   +6.630638100820622e-01   +5.913455466792696e-01; +6.049450679560598e-01   -2.761371023280828e-01   -1.227053140295685e-01   +4.650855597447411e-01   +7.871143713184870e-01   +6.418081509215857e-01   -2.975830234684673e-02   -5.952959275664249e-02; -2.579458364976478e-01   +5.492458642084346e-01   +6.486191090538717e-01   -1.749877240351795e-01   +1.754925366391696e-02   -7.438216643213515e-01   +2.500257072103607e-01   +4.193203669435142e-02; -8.850689838160926e-01   +3.514958412145237e-01   -2.442809177135645e-01   +3.196210806243510e-01   +8.092653452743968e-01   -4.292078763638810e-01   -4.636115342209066e-01   +1.477649442029595e-01; -2.174117176646488e-01   -3.270350536267014e-01   +4.727284638909525e-01   -4.130244871065200e-01   +6.667753118093720e-01   +1.251260528553094e-02   +5.228690150643032e-01   -2.807034975987014e-01; +4.989099618126878e-01   +3.413590010893752e-01   +2.188304774456629e-02   -2.397932120229943e-02   +1.032202215797479e-01   +1.905553445404533e-01   -7.113360984490622e-01   +1.593051220563450e-01; +2.045527791498274e-01   -1.349006615489631e-01   -3.382243384184457e-01   -3.116298037900707e-01   -3.695693402787765e-01   +5.866358378200431e-03   +5.965836049455722e-01   +8.654081585876992e-01; -2.704312701469481e-01   -2.124467932261078e-01   -3.995226317402681e-01   +3.239717946052635e-01   +2.307334111028381e-01   +7.038845202273714e-02   +4.871750483145929e-01   +9.466320237694820e-02; -1.190625461723470e-01   +4.651459604029031e-01   -2.556587648907098e-01   +8.942745423958987e-02   -3.405159616544545e-01   +2.936667076406336e-01   +5.213381915076396e-01   -5.495416518143326e-01; -5.342742671615197e-01   -4.148384468220142e-01   +1.777530833311777e-01   +2.743023473245088e-02   -2.814988374059286e-01   -6.894083233575184e-01   -2.811441070712993e-01   +7.300871192096218e-01; +5.689982205600358e-01   +4.897028210038432e-01   -3.949416203198711e-01   +5.495345449843696e-01   +2.512519136027659e-01   -2.671683051328225e-01   -2.312464201293715e-01   -4.003530888337403e-01; +1.474235374466874e-01   -5.501433431428587e-01   +1.317573028002843e-01   +2.135427299542328e-01   -7.043290118819612e-02   +1.345043621856773e-01   -2.226287268205608e-01   -9.517547603681237e-02; +2.195768242591991e-01   +3.739154492396762e-01   -3.149525719434542e-01   -6.839729419960027e-01   +5.018217383139898e-01   -1.008484158870334e-02   -6.128814449842282e-02   +6.020162470728851e-01; -4.599349931521447e-01   +2.021910156926995e-01   -4.518844850834375e-01   +9.448607442438134e-02   +1.996826924280150e-01   -1.008481735878711e-01   +4.677803100124113e-01   +3.070119786311158e-01; -9.084825413701553e-02   +3.409756731919465e-01   +1.294021611332752e-01   +6.462190815235261e-02   +3.922922483909483e-01   +2.117351250738031e-01   +1.959763097856424e-01   -9.746353692164644e-01; -2.012434622075410e-02   -1.753546200305726e-01   -1.263009634052011e-01   -6.827632267369709e-01   +1.543278341650075e-01   -7.206784093204404e-01   +1.427388850027486e-01   +5.274182842482480e-01];
L1E_L2E_iAMPA_netcon = [-2.579687076143869e-01   -5.428091638660884e-01   +7.185636033344514e-02   +1.242263476569212e-01   -3.214722156793953e-01   -2.982597482615528e-01   +4.537458426112588e-01   +6.365107151566751e-02   +1.946071071412266e-01   -4.338521001224548e-01   +1.929934421913783e-02   -6.045389144162683e-03   -1.482103550954753e-02   -9.253887127575191e-01   +2.937861497852802e-02   +3.037273062018178e-01; +1.424496166843818e-01   -6.602442686155321e-02   +7.574790837669858e-02   -2.632190854569029e-01   +6.343817522000804e-01   +2.072847649242106e-01   +6.887859311639450e-01   +4.823492119425726e-01   -5.068946434435735e-01   +2.713882588572562e-01   -2.090873339387803e-01   +2.012564874966307e-01   -8.997804509118433e-02   +7.398812288082622e-01   +5.802742410599111e-01   +2.341458310258591e-01; -4.620039024645266e-01   +6.474417842056576e-02   +2.886751953044768e-01   -8.409956944933691e-01   +2.721545871226541e-02   +3.741059102528722e-01   -1.466848524832025e-01   -4.774013123725713e-01   +4.264080950956550e-02   -4.744205690782856e-01   -3.628865053042186e-01   -5.920981794553486e-01   -2.573356749728862e-01   -1.000000000000000e+00   +3.631436870182321e-01   -1.460630830060940e-01; +3.803215487170903e-01   -3.307948153003563e-01   -7.442860935225828e-02   -7.031184250165931e-01   +5.390951092678751e-01   +4.712803242056761e-01   -3.744521131751767e-02   -9.870283795442431e-02   -6.522832441001059e-02   +1.736361434974120e-01   -1.332916350793736e-01   +7.657680913847694e-03   +6.780720703822364e-01   -4.318940800589096e-01   -4.045577933451029e-01   +5.739764608726783e-02; +3.005073328042209e-01   +3.950831912167940e-01   -7.733413993763371e-03   -4.262887836878008e-01   +1.906005348071963e-01   +2.135272308972822e-01   -4.220531676193563e-01   -4.975072007134422e-01   -8.718054513795695e-02   -6.742856090598751e-01   -3.160541119554863e-01   +2.334848664004943e-01   +4.935024758435928e-01   +4.659355638443392e-02   +5.568381805466852e-02   +4.609569893085336e-01; -5.750994337127494e-01   +4.288128905796856e-01   +7.815389837540802e-01   -1.115382748843388e-01   -5.071598463281789e-01   +4.695972384256029e-01   +2.353993456777758e-02   +1.954748204194710e-01   +1.928010931051395e-01   -1.188611014937552e-02   -1.722084641163410e-01   +2.090029712119223e-01   -2.806996417919328e-01   -2.817589137225225e-01   +6.346699137311215e-01   +6.422033812222194e-02; -2.762357446997764e-01   +9.555790875438288e-01   -9.996023174715023e-01   -3.053312552219463e-01   -1.172869277534931e-01   -7.120286432531286e-01   +4.416209896312903e-01   +7.529708670031214e-01   -8.702664001014148e-03   +2.748015532892244e-01   +1.584373811412992e-01   -1.977854407813613e-01   +5.659139202936027e-01   +2.918981952525676e-01   -8.129896463558427e-01   +2.772429846246462e-01; -6.850443584688728e-01   -7.235391915439331e-01   -2.009244692565400e-01   +3.279215656549676e-01   -3.979696126149272e-01   -9.442280003358632e-02   +5.841441045769448e-01   -4.770918576015149e-01   +4.890161458892050e-01   -7.680286688487169e-03   +4.657600867718403e-01   -3.409039674245500e-01   -1.812312340160140e-01   +1.727391033513357e-02   -1.215491857616523e-01   -2.250038401548345e-01];
L2I_L2E_iAMPA_netcon = [+1.102668923764743e-01   -4.288714654124863e-01   -4.401504296214144e-02   -7.773929787723693e-01   +3.338304457590129e-03   +2.169401736974135e-01   +4.804673370952623e-01   +3.079246304110168e-01; -1.184317779216073e-01   -2.919569111520898e-01   +3.534196033822948e-01   -5.505018673295252e-01   +1.480931263085199e-01   -1.938357690962433e-01   +2.601743918553040e-01   -5.563725116227486e-01; +8.492362661219751e-01   +2.334391397849758e-02   -3.500040583942485e-01   +2.625851031187357e-01   -9.293179543649998e-01   +3.363665093519313e-01   +2.338271203906602e-01   +2.075105300378639e-01; +3.703892440600337e-01   +8.605704653918103e-02   -1.191560071879720e-01   -3.243696227277922e-01   -4.041222278081609e-03   -2.698268713223621e-01   -5.896558911115989e-01   +5.223008462019330e-01; +1.679332757245653e-01   +4.079851907155455e-01   +8.817548963885922e-01   +1.090055123841456e-01   +4.779129661536818e-01   -6.507509624839157e-01   +1.351044103136209e-01   -2.629448062496852e-01; -3.309148102150426e-02   +8.382477716951109e-01   -8.237873115500266e-02   +4.963638120249831e-01   +1.857342228689456e-01   -9.654485010319230e-01   +1.000000000000000e+00   -3.586282602552744e-01; -2.101171929176380e-01   -2.484776941261766e-01   +6.554784698395515e-01   +1.225428564307102e-01   +8.059277059340474e-01   -8.862659303871575e-01   -1.865396262375912e-01   -1.345909485988261e-01; +2.732357806979505e-01   -3.170441304736449e-01   +1.255616456900653e-02   -9.277867498002740e-01   +1.148389416412920e-01   +2.452073353459284e-01   -2.783984044524777e-01   +4.092863769205394e-01];
L2E_L2I_iGABA_netcon = [-1.906101348532995e-01   -1.886236957409635e-01   -4.430099046868491e-01   +9.411955018589591e-02   -4.039483640083433e-01   -9.220381236222535e-01   +3.865966569247931e-01   -2.576829377263089e-01; +4.859836395533923e-01   +5.954129427944183e-01   -4.924728352231856e-01   +4.006874509197282e-01   -7.929825536498905e-01   +2.233668505134029e-01   +8.770303658782386e-02   +4.038078177005633e-01; +2.560028415344117e-01   -3.126721028532451e-01   -2.946972236990328e-01   +9.089595962709460e-02   -1.038581802066919e-01   -4.385431356668701e-01   -2.689900344159992e-01   +1.551520285444276e-02; +4.296948339056972e-01   -3.153697502110153e-02   +7.030231842683501e-01   -6.462900890138268e-02   -3.937207765867606e-01   +3.750290709140832e-01   +7.555586050582910e-01   -2.334975849292111e-01; +2.495694621858985e-01   +6.861327919426724e-02   +8.067324625244605e-01   +2.690497965424089e-01   -5.775288858887089e-02   -3.198308173625816e-01   +1.334105192845238e-01   +2.012029703620304e-01; -6.078553573758194e-03   -8.271623425532196e-01   +1.867961209385884e-01   -3.761749949484389e-01   +6.057832918481093e-01   +8.800852628532182e-01   -3.534888812576498e-01   -5.806238139886344e-02; +5.386105023454101e-01   +7.717447846735062e-01   -2.039137763682449e-01   -3.957283997207809e-01   -5.381654400075375e-01   +6.275883242060307e-01   +5.832340272894200e-01   -4.899059759674901e-01; -5.677796681644208e-01   +2.510991473135893e-01   -5.475204344637810e-01   -8.714225556730288e-01   -1.361134119214585e-02   +2.982093924258211e-02   -4.479798163214064e-01   -2.260161143394675e-01];
L3E_L2E_iAMPA_netcon = [+2.730725666485080e-02   -3.912687186672949e-01   +3.691584804156727e-02   -4.357290100214923e-01   +7.324392546008995e-01   -4.910690900604050e-01   -3.729150129642615e-01   +2.621940007685532e-01   -6.319628561972124e-02   +1.459485240422791e-01   -2.698910930792389e-01   +1.353342946444422e-02; +8.332368507502270e-01   -1.099589893122277e-01   +7.096862545393796e-01   -1.807799427407727e-01   +6.756211146324689e-01   -5.980421254992430e-01   +1.081962872794151e-02   -5.405978741338753e-01   +2.137239318161414e-01   -5.773922857251100e-01   -3.166903117427909e-01   -1.410961447593903e-01; -1.784096091253175e-01   +2.670219431417032e-02   +3.183424399210026e-03   -2.437389191780786e-02   +4.831036717013013e-01   +7.023336568620200e-01   +4.687538524379212e-01   +2.935190791718081e-01   -9.881008933925896e-01   +1.800976249991352e-01   -1.567935816918042e-01   +2.715425702907830e-01; +2.313328820193921e-01   +4.696433406983669e-01   -8.384400379542669e-01   +2.533098238395973e-03   +8.089432622616535e-01   -3.033790912734523e-01   +2.790459633497437e-01   -6.666737360862052e-01   +2.852705605714983e-01   -3.128566207779428e-01   -4.488566266540747e-01   -2.641783595621424e-01; +6.312691777366466e-02   +1.063084932115822e-01   +4.084235592370171e-01   +3.439341992069253e-05   -1.399801190975746e-01   -2.880405760170733e-01   -2.778906299848246e-01   -5.862987630486897e-01   +2.271672043626052e-01   -3.285145908249527e-02   +3.740795316260839e-01   -9.802494508885541e-02; +6.246610522099911e-01   +5.486914442003868e-01   +9.236060940493572e-02   +3.972265293786783e-01   -2.591017436859659e-01   -1.000000000000000e+00   +6.567335901620783e-02   -7.351383512105577e-01   -1.561744167323461e-01   +4.581959793806114e-01   -8.012898958124046e-01   -2.473799024527633e-01; +3.593232267755146e-01   -4.154889145955007e-01   +3.741913721042123e-01   -6.042665171082907e-01   -3.995146918972657e-01   +1.230077331082150e-01   -7.456557264278557e-02   -1.852439394798709e-01   -9.164060627303698e-02   -1.777310022979346e-01   -2.940742400444179e-01   +2.759096236251197e-02; +1.940889612616032e-01   +2.093823299897324e-01   +1.181756550771121e-01   +4.902331910619064e-01   +3.352157342409605e-01   -3.938890794725861e-01   +6.650072886545608e-01   -3.361670455784981e-01   -2.558663088597818e-01   +7.272568793473589e-01   +6.807366125490615e-02   -5.552203821802630e-01];
L3I_L2I_iGABA_netcon = [-1.897160040585692e-01   -1.206329912674499e-01   +5.736161562972691e-01   +3.103266608153445e-01   -6.327351014472286e-01   -4.805031890145201e-01   +7.961238124959840e-01   +4.372274697014986e-01   -2.799239179296202e-01   +7.758910621389212e-01   +3.053266141451021e-01   +1.569445314396316e-01; +1.872386868596657e-01   -2.032512403793684e-01   +3.298948102171880e-01   +4.504597137510273e-01   +3.896269474133323e-01   -2.456133074595379e-01   +1.507692998443125e-01   -3.437957469443080e-01   -3.711215720909275e-02   +1.594237100957968e-01   +6.945768329234170e-01   -7.922355541402346e-01; -1.162328649102170e-01   +2.578759355446122e-01   +3.612843728034676e-01   +2.165336102246979e-01   +5.752416767874926e-01   +4.075173848143751e-01   +3.007785320736315e-01   -9.669330343548699e-02   -3.733237291966198e-01   +4.886098536315553e-04   +3.355688702539263e-01   +1.926191037141825e-01; -4.520350184322243e-01   +6.288993544909268e-01   +4.027827714103968e-01   +1.151304186522325e-01   -2.416387698714856e-01   +8.449911751710468e-01   -9.352944987910212e-01   +6.419243645067727e-01   -1.043085483815059e-01   +2.284069173453814e-01   +5.837816415770395e-01   -1.467963893958548e-01; -1.087999693367042e-01   +2.004215343448012e-01   +5.537163526591264e-01   +5.624074414632613e-01   +2.747690781794765e-03   -1.281158723556538e-01   +2.190672427821663e-01   +1.889581195303226e-01   -2.890543650262472e-01   -2.177056537538870e-01   -5.917808055804629e-01   +2.978112816971295e-01; +5.614880702593560e-01   +3.262929997361889e-01   +4.961675976042653e-01   -3.680973139177615e-01   +7.870705762088995e-02   -7.417923208581845e-02   +6.127950836895130e-02   +1.617500331096212e-01   -5.644994807223340e-01   +1.548090835696146e-01   +6.524757329850703e-01   -5.449406377974192e-02; -7.122364132568483e-01   +7.268174643429179e-01   -2.579312694091711e-01   -7.848909575669306e-01   +8.409053668309631e-02   +5.381294119827214e-01   +2.863182622939301e-01   -5.060863919076696e-01   -7.132386396435900e-02   -3.502747042328919e-02   +2.413897955091600e-01   +7.107055805924348e-02; +5.233647269681367e-01   +2.147850056080300e-02   +2.167057206731216e-01   +5.897783888403857e-01   +3.365273152834795e-01   -1.493298488562951e-01   -4.250316213661189e-01   +3.494790134142152e-01   -4.892793561253548e-01   +2.318701084357298e-01   +7.003842052326513e-01   -2.094711528789530e-01];
L2E_L3E_iAMPA_netcon = [-1.276941805448986e-01   +9.112388346372272e-01   -6.970912907924005e-01   -3.865827208017820e-01   -6.919235180683996e-01   -4.548492122030378e-01   -1.319894943701111e-01   -1.892490800752275e-01; -1.928316794506151e-01   -3.439867578962831e-01   +6.125736595953254e-01   +2.958406108712198e-01   +2.802926897774596e-03   -4.039056198297702e-01   +3.677177106011546e-01   +4.203992421075193e-01; -4.291748294839898e-01   +4.091815370995780e-01   -3.502996198537413e-01   -6.410538484245635e-01   -1.697368568556610e-01   +3.549439624852133e-01   +2.878558372581846e-01   +7.067700647946148e-01; -1.235223231910277e-01   -1.244742237603340e-01   -1.724616078815440e-02   +4.020907287901661e-01   +2.290862497335785e-02   -1.502269987351928e-01   -2.668125251860406e-01   +2.147525582332042e-01; +5.450073599592487e-02   -1.000000000000000e+00   -3.941681808936671e-01   -9.737120529797008e-02   -3.585160070216309e-01   -4.763098738160048e-01   +9.572229284919366e-01   -1.055413713001755e-01; +1.640096329728601e-01   +6.972312634344550e-01   +9.976454538161242e-01   -5.292849603831090e-01   +4.434433653306113e-01   +6.159097866955220e-01   -5.396183511891858e-01   +2.661598689634990e-01; -3.489933563658742e-01   +6.340267257223497e-01   -8.196157957790170e-01   -4.363851966401878e-01   -3.286403591434969e-01   -2.902080086433717e-01   -1.847908557580992e-01   +6.151871880279938e-01; -2.972412640899585e-01   +3.685272275077656e-01   -1.403728039578960e-01   +2.837017772351516e-01   +7.653255050899106e-03   -4.546631476878265e-02   -8.282616986684659e-02   +4.630610662345483e-01; -1.441809039142807e-01   +1.870754288162012e-01   -4.659017301826932e-01   -4.246793206035752e-03   -1.817731460496308e-01   -1.266928375838081e-01   -3.576479655295166e-01   +7.619292438930556e-01; -3.724572844313812e-01   +2.965208602263179e-01   -1.937571833468955e-01   +3.259438158687191e-01   +3.873609794154476e-01   +5.765192599097161e-01   +5.574624726832151e-01   -5.848168645625330e-01; +2.235311694275107e-01   +6.082399984204788e-01   +2.129205938002697e-02   +1.888094999071076e-01   +3.742319592324339e-01   -1.862375597313739e-01   +3.991544546681191e-01   -3.398192873763895e-02; -5.645671854303100e-01   +1.499015309525345e-01   +2.443165380560536e-02   -2.922623022929412e-01   -2.333940675205449e-01   +3.073245936921232e-01   -1.195131211907430e-01   -1.235777810451947e-01];
L2I_L3I_iGABA_netcon = [-2.515407050672289e-01   +3.729011417578789e-02   -4.045516278497295e-02   +2.448533623359062e-01   +7.140814406366521e-01   -3.498142709976743e-01   +1.022715902089720e-01   -2.542697822408138e-03; -1.000000000000000e+00   +1.432355535656840e-02   -3.568330810425552e-01   +8.410624792986378e-02   -3.589357742696073e-01   +9.985972704772560e-01   -1.708228556456148e-01   -1.073256414187084e-01; +3.843163297776320e-01   -2.258364772528076e-02   -2.475276406936218e-02   -1.493982806874429e-01   +7.174117213818042e-02   -1.465627573736235e-01   -2.410265404170672e-01   +6.652939364846468e-02; +8.489680314112402e-01   -4.467465065231418e-01   +5.866370265143308e-01   -4.480175977744082e-01   +7.379623223656298e-01   -1.472021875360285e-01   -1.523044730242474e-01   +1.065757275594928e-01; +3.275381236821824e-01   +1.900578059373648e-01   +5.568202989163682e-01   +1.230567764576833e-01   -1.788864891052531e-02   -5.936882255617977e-01   +1.036962566266503e-01   +8.256101492377630e-01; -5.055579380318407e-01   -1.787600907663292e-01   +2.026722130575712e-01   +2.166659609267987e-01   -1.799417432194137e-01   +8.541713216785125e-01   +2.609759665753463e-01   -4.623449695811742e-02; +1.145015105934816e-01   -5.175376096848889e-01   -1.634173228027951e-01   +5.564176223492272e-02   +2.353996102572676e-02   -2.271519661253569e-01   +7.928644384772275e-02   +3.034214114045190e-01; -7.444223876746308e-01   -2.584569957167093e-01   +4.772191431134843e-01   +1.298148847983473e-02   -4.291646223849968e-01   +2.453254386476157e-01   +2.140608745495785e-01   +4.278074722557250e-01; +7.605340241717151e-02   -3.227944869652689e-01   +6.578042342538074e-01   +2.748153781217553e-01   +5.110702311778316e-02   +2.239946266079328e-01   -2.283972994294123e-01   -1.314653367858535e-01; +1.013465313944726e-01   +1.906234903956213e-01   +1.626847244116899e-01   +6.921060466165890e-02   +4.582758428833946e-01   +3.084165362449506e-01   -4.066149915660334e-01   +3.749673213950243e-02; +3.717731221432118e-02   +2.032316713980976e-01   +9.449582740525092e-02   -4.230685532039324e-01   +2.673454364715145e-01   -3.750902745679512e-02   -5.022626659657157e-01   -6.660086944479856e-01; +4.001046513225118e-02   -1.678607141689396e-01   -2.400932988104842e-01   -9.835465299425281e-01   -2.435193758960196e-01   -4.340563132631159e-01   -4.237833953373892e-01   +3.757915501922690e-01];
L3I_L3E_iAMPA_netcon = [+6.395991199326624e-01   -5.579310644275580e-01   -3.290968274685166e-01   -5.916020489325861e-01   -2.136471624135548e-02   +2.243772388995736e-01   -3.699099688690782e-01   -5.300391939495977e-02   -3.579179975935570e-01   +3.335714078904599e-01   -2.341693702549534e-01   +2.159264611231589e-01; -2.528099883051975e-01   +7.228628879262964e-01   -3.894921125247349e-01   +3.928550224439109e-03   -1.266312916128423e-01   -1.021987746791988e-01   +5.693378131062741e-01   +3.744570710775671e-01   -4.866699115241614e-01   -8.390220542236405e-01   -3.238170175817109e-01   -4.026080821037736e-01; +1.714248503387280e-01   +4.353110194213628e-01   -5.781859556623273e-01   +2.286796672201231e-01   +3.110279836062915e-01   -1.539214878602355e-01   +1.797852325974836e-02   -7.917377705806058e-02   -2.312223827784188e-01   +1.824141127616509e-02   +2.059862292140767e-01   +2.043164264640813e-01; -6.659800169718185e-01   -5.376714582267317e-01   -3.550214329302112e-01   -1.373479400447762e-01   -3.368731568308031e-02   -7.148190123432948e-01   +7.001976590267045e-01   +5.020878100932632e-02   +7.636375030091593e-02   -1.986940195928192e-01   +3.321067693515280e-01   -5.179162902554298e-01; +9.776715311215611e-02   -3.124974131211188e-01   -1.915260357523548e-02   -4.495349267011078e-01   +4.192863129284412e-01   +6.827971997113196e-02   -6.973999897081189e-03   -3.063077751387147e-01   +1.942722792349236e-01   +5.044740046707806e-01   +7.650426169006466e-03   +6.485404493273340e-01; +2.027927924854316e-01   -2.318568901804193e-01   -9.642735429583193e-03   -1.653722567253382e-01   -4.542627427671775e-01   -3.098316150869419e-02   +1.641297902043098e-01   -2.904380860295702e-01   +7.251008276097114e-02   -1.451896085437953e-01   +2.667381529624366e-01   +1.376120715775533e-01; -7.154419077911548e-01   +2.566921498375769e-01   +1.447454888586134e-01   +6.879071063451743e-01   -3.606515806675219e-01   -5.172796290156165e-01   +4.621320664507865e-01   -6.280133894666894e-02   +3.034647220367617e-01   +6.885883102679630e-01   -1.267597486620307e-01   -2.745943800436667e-01; +4.375978383022044e-02   -8.536685282974840e-02   -3.180579522233494e-01   -3.180275318694573e-01   +5.784341490504729e-01   -1.244810687154908e-01   -4.740171384281312e-01   -5.947132849525265e-01   -5.172991511613285e-01   +5.782999363178163e-01   +1.300293242755156e-02   +2.352226185050292e-02; +1.001094262018617e-01   -3.562197742278398e-01   -4.150991925595777e-01   +3.101078932111175e-01   +2.480587581983489e-01   -1.843078215283969e-01   -4.357515927051608e-01   +5.674812142782189e-02   +2.674831378895580e-01   -3.359285503087069e-01   +1.500437600202734e-01   +4.233389745664100e-01; -2.924969748496841e-01   +6.044784708186425e-02   -2.885864444022171e-01   +1.818783067270340e-01   +5.173590619979626e-01   +2.676835732894850e-01   -1.853217615489331e-01   +2.825557363366065e-01   -1.000000000000000e+00   -2.436744523924950e-02   -3.162538769272387e-01   +7.122432729834208e-01; +8.525778434061999e-02   +8.980885292318676e-02   -1.089538448547483e-01   -2.919455033426736e-01   -1.158355671957883e-01   +4.809080794456434e-01   +5.152264241543298e-01   -5.079296112025390e-01   +4.983181642096046e-01   -6.547368038500120e-01   +2.522781412164252e-01   -2.036290737070573e-01; +2.839032412014463e-01   -3.037324334038801e-01   +6.545518539824089e-01   -1.032392360730733e-01   +1.858997110688652e-01   +1.962056865632100e-01   +5.595925349422636e-01   -2.423497713424406e-01   +4.691802252964940e-01   +8.931656882681692e-02   +6.595791399518953e-01   -3.192959966301350e-01];
L3E_L3I_iGABA_netcon = [+7.905021657471787e-01   +4.283329181000282e-01   -9.534211853172964e-02   +1.413092359769578e-01   -3.688423181055173e-02   +6.684303189907807e-02   +3.098482932474980e-01   -6.664752307305143e-02   -4.422737933634940e-01   +6.142305652999454e-02   -1.565901215808627e-01   -6.064242929765908e-01; -1.958768189785004e-01   +6.168737211325422e-01   -2.818643303638215e-01   +4.226478735102790e-01   -6.961100435355562e-02   -1.000000000000000e+00   +8.358870210931564e-02   -4.041284753853567e-01   -7.204605652581487e-01   +4.917953029082970e-01   +4.578944626642424e-02   +7.783245845182252e-01; -4.829155657669620e-01   +2.810508656513727e-01   -2.276439888652817e-01   -2.654190521460084e-01   +3.044215672808536e-01   +3.365044368982333e-01   +5.353519957658891e-01   -6.644829310517892e-01   +2.680419296049334e-01   -1.036564124090801e-01   -3.844265090731978e-01   -2.203127620990531e-01; +6.958027554150622e-01   +4.281902321935339e-01   +2.595736045263533e-01   +2.432540818057280e-03   -5.585926763650928e-02   +1.688081309727446e-01   +9.178596297980752e-03   +5.450502723383183e-01   +4.122985098214559e-01   +1.566801075641168e-01   -2.102076369730850e-01   +5.590313501880544e-01; -4.854987985725446e-01   +1.480507682602071e-01   +3.926767404154502e-01   -5.524115903490580e-01   -2.529811225656912e-01   -1.505295324102657e-01   +6.998314143757437e-01   -2.455990100807051e-01   +1.987950011406092e-01   -1.952199037079746e-01   -2.728294863732398e-01   +7.057643528109867e-01; +9.584093310214126e-02   +4.189088300285417e-01   +6.053844474004542e-01   -1.740617404159490e-01   -2.574608080224058e-01   +5.643440133093902e-02   +1.280931814013630e-01   +7.239740437330677e-02   -7.329630582907115e-02   +3.117023854470781e-01   +4.751008532260582e-01   +2.137093482335523e-01; -5.452403508213793e-02   -3.574273049913143e-01   +7.776940834864269e-01   -4.630903331985927e-01   -3.302400930823300e-01   +6.459527082037581e-01   +6.915906079319094e-01   -3.217138257284035e-01   +3.200935835041410e-03   +2.999697231186859e-01   +1.820643310253214e-01   +3.570340496103975e-01; -3.565422684541742e-01   +3.643859585831982e-01   -2.378710555955370e-01   +2.178554782614275e-01   -4.318264376899473e-03   -1.480045670504511e-01   +7.744812986778296e-01   +4.255863677697858e-01   +3.359855112469957e-01   -6.939964970021184e-01   +5.385780932786114e-01   -3.543943042888175e-01; -4.850954742137467e-01   +2.422257858549001e-01   -1.522747086278911e-01   -4.139379345505932e-01   +2.663282659448353e-01   +5.630135258143457e-03   -2.168412280680670e-01   -5.992162555088115e-01   +3.934738867337512e-01   -4.992528380106681e-01   +1.737108290757258e-02   +3.825936996742448e-02; -2.487501183130641e-01   -5.987577147422602e-02   +1.217703223852680e-01   -4.217541907044810e-01   +3.883653996533998e-01   +1.579615392341312e-01   -7.353733456180701e-02   -4.680258201139209e-01   +7.164207025513615e-01   -2.436582230983747e-01   +6.290575555748399e-01   +1.504988507534518e-01; +3.837162154536627e-02   +7.084496645774119e-01   +8.566260937049445e-01   +6.061750414778182e-01   -5.472779936153457e-02   +7.105360074613574e-01   -9.910794968970781e-02   -7.432800697291674e-01   +7.329786542015787e-01   +1.908004007024232e-02   +3.193020828516757e-01   -3.771268534494833e-02; -3.007367852732228e-01   -8.568509078486605e-02   -1.982232111413547e-02   -3.799359323663088e-01   -6.080535012014648e-01   +1.168903503642666e-01   -7.668519017358318e-01   -8.072861174454928e-02   -3.444033256262514e-01   -3.670843656186138e-01   +6.868486679596223e-01   -1.667695580343297e-01];
L2E_Input1_iAMPA_netcon = [+2.348699320601889e-01   -5.310142203530156e-01   -3.787065484296034e-01   +4.194094788485562e-01   -7.970482760344648e-01   +4.256291183938947e-01   -6.004599338032234e-01   +7.961544765838970e-01];
L2I_Input2_iAMPA_netcon = [+1.692375872327154e-01   -4.133991521117896e-01   +5.978788435798177e-02   +1.244596550212552e-02   +9.319994861928035e-01   -2.774462379088469e-01   -3.336192058725431e-01   -4.655280436579128e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
