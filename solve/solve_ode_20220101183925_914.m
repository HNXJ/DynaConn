function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+6.423985603935689e-01   +2.351094186124669e-01   +3.399602704588516e-01   +6.444560590978412e-01   +1.904757649861155e-01   +1.393136408752474e-01   +5.834585741020358e-01   +1.295766155838981e-01   +3.061617948750142e-01   +2.827818069350175e-01   +6.135100469675087e-02   +1.085522173291240e-01   +3.155545847204355e-01   +5.810088904755192e-01   +6.008828358498106e-01   +7.281561330638301e-01; +6.236439574561594e-01   +6.614601162065895e-01   +4.921725960686851e-01   +9.170517786411382e-02   +1.231616090975120e-01   +2.432626400413113e-01   +1.709042638930398e-01   +2.921732261519040e-01   +6.018510291749840e-01   +5.446433348967964e-01   +7.565736611237561e-01   +5.160141457513575e-01   +7.511478775178024e-01   +3.080053077306467e-01   +5.316160034851564e-01   +2.051203083381751e-02; +7.990894598106623e-01   +6.009749363344075e-01   +7.483703016920745e-01   +7.079425142724077e-01   +7.677827119300784e-01   +6.822990888058159e-01   +4.542184394323769e-03   +9.284349356616647e-02   +3.727328458294009e-02   +8.048176480704097e-01   +4.160511560976059e-01   +2.400891815106264e-01   +6.206067837317646e-02   +3.786414303269170e-01   +2.704857748606696e-01   +5.615682909620882e-01; +5.818687558583201e-02   +8.090255274470308e-01   +2.995304643431108e-01   +8.368687107047439e-02   +1.059553044720456e-01   +1.410338098968074e-01   +3.067246554802178e-01   +3.685258277644187e-01   +5.627246098201012e-02   +5.257328227070723e-01   +2.158863031016058e-01   +4.175264512888194e-01   +4.117922823180838e-01   +6.683824253850673e-01   +7.644814259265190e-01   +2.891332649833487e-02; +7.553582277595421e-01   +2.112068561280591e-01   +6.348765039436006e-01   +7.590809012670245e-01   +3.064008490649784e-01   +1.266070402691935e-01   +6.923967266239803e-01   +4.623863631405791e-01   +6.423954856818397e-02   +1.376001732028799e-01   +8.087432541367915e-01   +5.643694050518410e-01   +6.865845803622952e-01   +6.014210317615406e-01   +2.946248979315019e-01   +6.734238850814716e-01; +4.363450527191167e-01   +4.493063235072306e-01   +4.745122482796132e-01   +1.164833481376094e-01   +4.314542072854006e-01   +3.738742588153847e-01   +2.183281158560902e-01   +2.937013605534191e-01   +4.490832516054367e-01   +4.634514150819129e-01   +4.595541486277659e-01   +9.046277508632748e-02   +2.533651187365075e-01   +7.509847061326598e-01   +4.259000643633390e-01   +7.357430085764731e-01; +6.812798321942334e-01   +4.734571757165193e-01   +6.930260185059628e-01   +4.088413750541119e-01   +7.419815769740254e-01   +3.575600308234023e-01   +2.744495343197675e-01   +2.772879536601907e-01   +5.585538182425996e-01   +5.164300853309945e-01   +4.900493414090594e-01   +8.856897670667045e-02   +7.754011315400554e-02   +7.695120161730080e-01   +4.773266282069382e-01   +6.189263906775285e-01; +9.726377729546520e-03   +7.701112051509371e-01   +3.138061843940637e-01   +6.776280922359977e-01   +3.278955051477551e-01   +5.389923050211271e-02   +4.053950438107882e-02   +1.799434774302840e-02   +7.267514141870327e-02   +4.704831784205212e-01   +7.497710451866149e-01   +6.360888456939350e-01   +2.425259977229456e-01   +2.037261361454506e-01   +5.697131089282211e-01   +2.396322116960973e-01; +4.879919007080927e-01   +1.213674181963585e-02   +6.770728138877774e-02   +2.012874766471038e-01   +1.429396275962660e-01   +5.007574144945184e-01   +5.546873605779360e-01   +2.967495873207552e-01   +4.787822225635466e-01   +4.632790355982019e-01   +2.578538176978177e-01   +5.843710494586518e-01   +2.183702984220423e-01   +1.967881387261735e-01   +7.408852264762283e-01   +3.322590909321108e-01; +6.910013578250916e-01   +1.810293109843163e-01   +7.069472578578754e-01   +1.665901521065754e-01   +1.333454489682383e-01   +1.568648290186561e-01   +2.292286626107978e-01   +5.077342840074955e-02   +2.553930843880072e-02   +1.696381262546244e-01   +6.640040472598506e-01   +7.941797970674724e-01   +9.855176764996514e-02   +2.820639993624465e-01   +7.055178258160092e-01   +7.976567576486919e-01; +2.766438162614582e-01   +7.869281916051769e-01   +5.000683745526918e-01   +5.509319496563357e-01   +1.171599374040746e-01   +3.857955674799487e-01   +6.455026983195992e-01   +3.488336832893931e-01   +3.944352882359260e-01   +2.606291657044592e-01   +1.563482287258085e-01   +4.310316807270805e-02   +7.585357050228370e-01   +2.161197005303934e-01   +7.196204048442933e-01   +5.436734049134246e-01; +7.214724269772094e-01   +2.209751086166327e-01   +7.692923688007390e-01   +6.287050596703303e-01   +2.165040266683736e-01   +2.168950978223638e-02   +5.097461646616814e-01   +3.830293479550868e-01   +7.487426817213344e-01   +5.999109440274879e-01   +4.120338578946335e-02   +1.271236806650302e-01   +6.490852074253614e-01   +4.217889920892102e-01   +6.863334081151525e-01   +2.359539355913785e-01; +1.399700753546312e-02   +6.408833382307035e-01   +5.556198784285936e-01   +9.133579511924619e-02   +2.598802507887677e-01   +4.939635567978907e-01   +1.359161190843667e-01   +5.936355118925231e-01   +5.019503250922850e-01   +2.994850916557010e-01   +2.148659537996828e-01   +6.589750872726455e-01   +7.724950223773490e-01   +7.608683731176090e-01   +1.275353340154949e-01   +3.098978668703776e-01; +9.084286554299598e-02   +6.806977621571425e-01   +7.568125449233560e-01   +7.626354823430305e-01   +2.087250153278312e-01   +2.027873662241695e-02   +2.907170656144929e-01   +2.408865514889892e-01   +5.855828752273005e-01   +6.982732961412611e-01   +4.074861238821414e-01   +6.986587781290734e-01   +7.077158225131319e-01   +1.084520031772794e-01   +5.896709038844856e-01   +5.477001279460058e-01; +3.047003171121911e-01   +3.034489163535558e-01   +6.734220496972027e-01   +1.267854213536145e-01   +4.931229809647178e-01   +3.992900614525600e-01   +2.551880144268120e-01   +3.707207786735334e-01   +8.121268205844590e-02   +7.982345313234199e-03   +1.626241538155942e-01   +8.000438505057393e-01   +6.656817701222020e-01   +5.085883534579314e-01   +6.399728974299758e-01   +5.891937801755264e-01; +2.807806104643045e-01   +7.734153789048492e-01   +3.943030000966255e-01   +5.942289062150465e-01   +8.072549283986015e-01   +5.906538550089054e-02   +3.897919894320173e-01   +3.751226623573185e-01   +5.453834728012785e-01   +8.011951021277838e-01   +7.032524468582892e-01   +2.986541309163222e-01   +6.278687990343309e-01   +1.385467998057419e-01   +2.055559256324729e-01   +7.675573922525181e-01];
L1E_L1I_iGABA_netcon = [+4.666755260111562e-01   +4.946957259454851e-01   +2.651514761044421e-01   +6.768691722038870e-01   +2.614420647388396e-01   +7.312335552549130e-01   +4.690267008494739e-03   +1.348644148783083e-01   +3.078529573326957e-01   +7.701335758108695e-01   +2.916590357342119e-01   +4.871878349397134e-02   +1.209128409446041e-01   +5.254437224917676e-01   +6.353433980998788e-01   +3.775457695752936e-01; +2.633400135201052e-01   +1.021779190574018e-02   +5.349161623351499e-01   +7.439315467855946e-01   +7.950042516645847e-01   +4.585441332725753e-01   +1.094561502059992e-01   +8.050665060179568e-01   +4.636253249693393e-01   +6.912872766068942e-01   +1.631169994209798e-01   +7.411520571873885e-01   +1.689232197057555e-01   +7.749009947100252e-01   +4.813929314438876e-01   +6.460026448382062e-01; +7.485019849919547e-01   +6.287239602227350e-01   +1.606223220131662e-01   +7.634601548601375e-01   +7.981085962899042e-01   +4.219834712701859e-01   +7.646064849274397e-01   +4.123884828920656e-01   +2.763064528185263e-01   +1.316380611448810e-01   +1.070957280520043e-01   +3.451640112902918e-01   +1.832024599257822e-01   +7.133275247855168e-01   +2.577815373788986e-01   +2.543745283557297e-01; +2.310949553505802e-01   +2.372435099355035e-01   +7.927245814033813e-01   +3.216448327160093e-01   +5.138080251063788e-01   +6.619676394456155e-01   +1.017515153942369e-01   +6.305518647548997e-01   +7.725832679949489e-01   +5.908150245965665e-01   +7.511658810934412e-01   +2.867744241745519e-02   +3.355266897616127e-01   +5.596380315936405e-01   +5.464872519805525e-01   +6.005634618958113e-01; +6.986122513618085e-01   +9.387329336167120e-02   +3.854912701965383e-02   +1.274558580846555e-01   +8.181202633523986e-02   +1.878607674062414e-01   +4.380256168890959e-01   +4.820478959773639e-01   +2.668176161479159e-01   +2.893115912698624e-01   +4.176371343345734e-01   +1.375678006577801e-01   +3.301414923998110e-01   +3.571549098215577e-01   +3.370967979683149e-01   +3.034095033475562e-02; +7.192935879321950e-01   +1.531895691739433e-02   +1.167356336710560e-01   +4.111210913593866e-01   +5.996846300448056e-02   +2.480301551293270e-01   +5.660450622539120e-01   +7.788140443335568e-01   +3.931434197877470e-01   +4.321942745176106e-01   +5.611951659058287e-01   +5.599936723258730e-02   +2.789277660822856e-01   +3.348009832149842e-01   +1.144126342132862e-01   +1.266315614873147e-01; +7.991281081183829e-01   +3.281409266755867e-01   +7.223944564906611e-01   +3.564323223388576e-01   +6.947848733434506e-01   +1.399537566525657e-01   +6.941950580287644e-01   +3.399913962008023e-01   +3.754107017237434e-01   +4.331342192847069e-01   +2.777322648618577e-01   +7.109568066975038e-01   +9.533845782919846e-02   +4.987117003259182e-01   +6.542565101797031e-01   +1.376118896765642e-02; +7.698571391909017e-01   +1.322597128716315e-01   +1.243149827999163e-01   +4.745299010460883e-01   +6.935600406329078e-01   +1.246792695430034e-01   +1.445599098701667e-01   +1.230383632257767e-01   +1.033564897236042e-01   +2.371750722026574e-01   +1.678450954152397e-01   +2.616187904461530e-01   +6.474092790941207e-01   +9.694819845671666e-02   +3.780582191252745e-01   +1.592273646618423e-01; +6.226688372044514e-01   +4.377002730681672e-01   +6.823562729709080e-01   +1.479854994852791e-01   +6.003715885634032e-01   +6.173988213057562e-01   +8.086644570923558e-01   +1.034773735619769e-01   +7.289691492031204e-01   +2.749605922475056e-01   +5.397428873062925e-01   +4.897028207771461e-01   +6.929370373742823e-02   +2.829586723836008e-01   +6.647674772024496e-01   +2.458185409142577e-01; +5.077983773369601e-01   +7.310685627703951e-01   +3.452367631254243e-01   +4.075653882869596e-02   +7.764699351354146e-01   +2.892757527195165e-01   +4.258121757553255e-01   +4.659167181627424e-01   +6.222157287692126e-02   +6.552556858527722e-01   +1.680820608003006e-01   +2.520475826948870e-01   +3.571387452865986e-01   +4.822965844078231e-01   +8.089096465568428e-02   +5.402084592573151e-01; +6.838498864903892e-01   +6.248671476373219e-01   +3.834607196904324e-01   +4.542790243100830e-01   +2.831050873963047e-01   +2.093640258692113e-01   +3.726012923788315e-01   +9.699618178569592e-03   +2.465620737209890e-01   +3.609430045542268e-01   +3.205714093916088e-01   +5.984974155896892e-01   +5.362712502566106e-01   +1.617418670445908e-01   +3.607020708159981e-01   +7.525945293973765e-01; +3.046245058734395e-01   +3.442193674542152e-01   +4.881394341039819e-01   +6.064115180734239e-01   +5.291559474447717e-01   +2.366508715234103e-01   +2.060224945394446e-01   +5.645761198440418e-01   +4.077788268808950e-01   +6.099707650156712e-01   +6.573617943423508e-01   +1.241353577338435e-03   +6.494802366373142e-02   +3.849623656045876e-01   +6.693741788525832e-01   +3.561136036513026e-01; +6.000284118284075e-01   +1.705954701423043e-01   +4.882567263637089e-01   +6.938824013335333e-01   +5.819349071561144e-01   +4.477847511963029e-01   +3.234426452001131e-01   +4.274942747996397e-01   +3.219257454799730e-01   +3.033321889904025e-01   +2.129565773711043e-01   +2.210490882199312e-01   +6.656007601492860e-01   +8.050161121316798e-01   +3.044035766231108e-01   +4.174147958052540e-01; +3.349327117580326e-01   +1.365643619229747e-01   +3.881692318536891e-01   +2.989675510399550e-01   +3.088981192786248e-01   +5.666428458937181e-01   +6.655632246182408e-02   +7.584680814482070e-01   +7.802047501054233e-01   +6.314495467691301e-01   +1.004884273986578e-02   +3.511587874113118e-01   +1.128693280010273e-01   +1.991299970266220e-01   +1.640424770613366e-01   +7.176455631311315e-01; +5.076804725743177e-01   +8.896324494524790e-04   +3.261290526801933e-01   +9.249451399867259e-02   +1.603944762110078e-01   +6.325734018699979e-02   +7.027824000178473e-01   +3.936437831285912e-01   +7.639906337733432e-01   +5.299281976341426e-01   +3.349875114891760e-01   +7.079969941463437e-01   +3.090866887847835e-01   +7.760867858491913e-01   +7.638811413309292e-01   +6.059859360267329e-01; +2.719516081443748e-01   +1.312319510993237e-01   +1.320316059369839e-01   +4.258168429604247e-01   +5.488128863993245e-01   +7.645857957407811e-01   +3.178277441140365e-01   +6.343951227833416e-02   +7.984003260900385e-01   +2.263963578000592e-01   +4.747370746223149e-01   +5.128142504551094e-01   +9.248531519820881e-02   +7.468102509354413e-02   +1.012897856222012e-01   +2.053974759168400e-01];
L2I_L1I_iGABA_netcon = [+3.737427735404830e-01   +7.867028912452561e-01   +5.198233234004065e-02   +4.897173413897997e-01   +7.585454259193330e-01   +2.592149350983404e-01   +3.121770034200325e-01   +5.967640427083832e-02; +1.523247196778460e-01   +1.494722699910153e-02   +5.218925053051852e-01   +6.386668869044934e-01   +2.465042926646287e-01   +4.762838346840046e-01   +3.041865200050797e-01   +2.245679296739753e-01; +5.978120768024502e-01   +1.866690148024066e-01   +1.919904634208227e-01   +5.670470960567520e-01   +1.862177437667669e-01   +5.087446254972970e-01   +4.658891948076893e-01   +5.642975139234601e-01; +3.593215252344034e-01   +5.827598439061928e-01   +5.351149205866599e-01   +2.684819034950591e-01   +7.157180047278033e-01   +4.990798971089392e-01   +9.650042635621212e-02   +6.022407054553687e-01; +3.873929461509265e-01   +1.784386027196123e-01   +3.609907201447762e-02   +1.880425040386341e-01   +1.156355055699189e-01   +6.749956141477373e-01   +6.078407336164915e-01   +1.908791881540061e-01; +7.697100458501183e-01   +2.675538334914712e-01   +5.220947576977759e-01   +2.696114291387549e-01   +6.359977868980309e-01   +6.248809273765488e-01   +9.833313806966101e-02   +1.477090872110484e-01; +3.157247006071943e-01   +6.998132240314464e-01   +5.796868688972154e-01   +6.952874687612960e-01   +5.221536853335381e-01   +2.391739637630768e-02   +7.867015862001563e-01   +1.333874324282968e-01; +7.977826573706981e-01   +3.336198599686178e-01   +3.707447428502686e-02   +4.424742749223596e-01   +4.287406626645869e-01   +2.108018059670323e-01   +6.591516093487212e-01   +1.160505084654861e-01; +4.609030350342588e-01   +2.041408954269230e-01   +2.497230373841723e-02   +8.934218826204376e-02   +1.678904608027665e-01   +4.804540612319169e-02   +6.362980208772129e-01   +1.990392559757076e-01; +2.264630860655078e-01   +3.521818931950664e-01   +3.377704780914458e-01   +1.074111568948787e-01   +6.821339628044375e-01   +5.526309085070082e-01   +1.166350886433468e-01   +2.230296481063751e-01; +2.350946446854690e-01   +6.224593508491068e-01   +1.108111803323075e-01   +5.727022476695206e-02   +3.548211294308662e-01   +2.301018630644363e-01   +1.926368161459515e-02   +8.091356877671529e-01; +7.810154480143044e-01   +2.936518589890358e-01   +2.534277157245152e-01   +7.791103805758478e-01   +6.625980415371127e-01   +1.673092089297115e-01   +2.742877680579278e-01   +1.230982548674356e-01; +7.889906391380039e-02   +4.108353097673680e-01   +6.374062010372601e-01   +5.038617285725714e-01   +5.359756885378958e-01   +5.340973652650136e-02   +2.372363039501723e-01   +8.020726953268082e-01; +2.725779203453076e-01   +2.757592798627139e-01   +1.085194265508719e-01   +1.760915223237924e-01   +7.859091519550844e-01   +9.826606791619510e-02   +4.099916115687305e-02   +4.468188558116782e-01; +6.290274226965707e-01   +5.948151773803871e-01   +7.673754492800227e-01   +6.198170767142448e-01   +9.656039605971574e-02   +9.984907365542239e-02   +1.584876086460024e-01   +1.667173075824927e-01; +5.836384896413132e-01   +7.381736453414837e-01   +5.568445135372446e-02   +1.612611985327829e-02   +1.752477906289595e-01   +6.439039650937871e-01   +2.941288751508069e-02   +5.160028263504317e-01];
L1I_L2I_iGABA_netcon = [+2.802541329019250e-01   +5.110998933241429e-01   +7.124643464438846e-01   +1.691182133392813e-01   +2.808793406827338e-01   +5.916025472480925e-01   +7.611911241366034e-02   +1.146578879733907e-01   +1.165852592015763e-01   +5.936221246076044e-01   +3.051677303657076e-01   +4.316481628769026e-01   +6.273595810185782e-01   +6.644868908725871e-01   +6.458831582681958e-02   +3.728963892295890e-01; +2.630827306567001e-01   +2.824201605985499e-01   +1.895194352106369e-01   +3.204344461178874e-01   +6.975117780351194e-01   +1.458099447068345e-01   +4.811671025281246e-01   +1.745640844615576e-01   +3.998116930286109e-01   +1.351215588281704e-01   +7.622257944219206e-01   +5.452110911381286e-01   +8.274813924403471e-02   +1.776720438985833e-01   +5.385205235772563e-01   +4.980872092081199e-01; +4.268212094937989e-01   +2.501273750627585e-02   +1.395812423248280e-01   +7.979939118137676e-02   +2.999175293881501e-02   +1.448033283750392e-01   +6.460973386415355e-01   +2.577625476720176e-01   +4.977207343355700e-01   +4.183428564038595e-01   +5.491414218883048e-01   +3.289530440327135e-01   +5.655159214129958e-01   +4.881583943246200e-01   +3.601116680000803e-01   +4.135235229952673e-01; +4.660151396586524e-01   +8.370044951888518e-02   +3.324250486705011e-01   +8.164000503685076e-02   +4.629592261694343e-01   +5.801575311120831e-01   +5.179213593574085e-01   +2.857455865955127e-01   +5.105112980261598e-02   +6.221535101403801e-01   +8.613563249931504e-02   +6.347183248986101e-01   +3.965796845029304e-01   +5.091206096774169e-01   +1.284709854070429e-01   +7.785072077725388e-01; +9.204289225826280e-02   +6.968904945512161e-01   +7.909993011333016e-02   +4.929552457139201e-01   +2.784169216679763e-01   +3.639310795064956e-01   +4.368951839309382e-01   +5.275300310677137e-01   +4.299916664151148e-01   +5.671871815454769e-01   +3.634790578659859e-01   +5.085032370789810e-01   +2.017586192780287e-01   +6.373329288348382e-01   +7.528704942547549e-01   +2.290018597210671e-01; +1.209359550537997e-01   +4.415173487655563e-01   +7.447486529172220e-01   +6.490351137745668e-01   +5.700763600559637e-01   +7.224710157374728e-02   +3.507374495428668e-01   +1.039693214406922e-01   +1.587957723568851e-01   +2.855849815912845e-01   +1.765801838611064e-01   +3.859323479327968e-02   +7.353845023706276e-01   +4.337518383884494e-01   +6.900798216858263e-01   +3.043924637620786e-01; +4.879426428012938e-01   +2.775128205781028e-01   +1.147125608653305e-01   +6.213797528291041e-01   +1.027650331110047e-01   +5.234846500810616e-01   +2.539797940476354e-01   +5.444521048225263e-01   +3.752100202067873e-01   +7.187605947631154e-01   +6.550896722618260e-01   +2.980035730420283e-01   +5.097424033931294e-01   +4.755053526080570e-01   +5.163372669237959e-01   +2.162306187665747e-01; +3.968358393544061e-01   +7.627893303019500e-01   +1.787881350939461e-01   +7.429238391610055e-02   +5.237009406366255e-01   +6.020185085095509e-02   +4.798906487820424e-01   +2.070937021765931e-01   +4.713885343910831e-01   +1.974856942780451e-01   +7.208824871322912e-02   +4.156240254756793e-01   +6.501093918984392e-01   +2.365886552237312e-01   +6.232204427101330e-01   +3.087269663026231e-01];
L2E_L1E_iAMPA_netcon = [+7.329325460323562e-01   +6.890860796461417e-01   +6.206734141948801e-01   +7.760394155777803e-01   +6.641594542531730e-01   +5.878058906427213e-01   +4.727849451724032e-02   +7.988860368327169e-01; +3.964948476062839e-01   +1.035904458652048e-01   +2.034380014154311e-01   +1.697380352387358e-01   +3.106235517844659e-01   +3.203362976324544e-01   +1.163917058477026e-01   +2.486934631559020e-01; +1.235397670651314e-01   +5.293796824351402e-02   +4.428646674390434e-01   +3.879440558332910e-02   +5.712390156787406e-01   +4.834924787922448e-01   +6.482638001941293e-01   +8.039758987664025e-01; +5.852689471004725e-01   +4.209904043629510e-01   +8.030031630762483e-01   +7.746351043203054e-01   +7.084420856770361e-01   +4.626620831943435e-01   +3.098813962602259e-01   +1.180508960884138e-02; +6.441349178251762e-01   +4.656870155544280e-01   +4.202358193798940e-01   +5.352284048968896e-01   +3.782086973988236e-01   +7.393297194427879e-01   +6.775179755175911e-01   +2.830464927667349e-01; +4.720926231187656e-01   +8.050143390316091e-01   +6.671301709163886e-01   +1.981717903937044e-01   +3.186868522276972e-01   +3.513024123517398e-01   +2.415586922614205e-01   +6.919658136708452e-01; +2.205662454060851e-01   +5.919769302797470e-01   +6.917457596301522e-01   +2.128839553886430e-01   +7.057779288351904e-01   +4.019236326701952e-01   +2.008968296483485e-01   +2.201961186577419e-01; +4.955760461000709e-01   +7.162884364373138e-01   +6.500717640823128e-01   +8.023187013073885e-01   +4.093580264140168e-01   +3.245802340088808e-01   +7.482395653282026e-01   +2.393637422565815e-01; +4.266894547920072e-01   +4.591576208337991e-02   +2.660995217608218e-01   +3.262761105456601e-01   +3.551322164543564e-01   +3.303767508896346e-01   +6.332810236638043e-01   +1.227548477678027e-01; +7.467879700401745e-01   +5.538445847864178e-02   +4.066369169964733e-02   +6.680471734859018e-01   +6.560364094656198e-01   +6.385777823393728e-01   +4.920559001426504e-01   +2.495408076571698e-01; +5.977430581373124e-01   +7.117776894492132e-01   +1.648987414955349e-01   +4.426978339750767e-01   +3.019787308940424e-01   +3.432668286597413e-01   +4.778113398248034e-01   +6.052012440903815e-02; +4.631128448838816e-01   +6.272247673539938e-01   +8.008089276994521e-01   +5.686192584756925e-01   +4.250585281093224e-01   +6.285545188143521e-01   +3.491721019925268e-01   +6.707364771992523e-01; +9.277739373106623e-02   +7.816182272621062e-01   +1.458236874541885e-01   +5.069667582210175e-02   +4.639455579743618e-01   +7.289978601675835e-01   +2.275643617151188e-01   +5.293115982136136e-01; +7.911852575774410e-01   +6.062907343027345e-01   +4.667454148019958e-01   +3.287640923379618e-01   +7.192312032860773e-01   +6.186399861947511e-01   +4.003937952730107e-01   +4.715042989506557e-01; +2.861651431736856e-01   +5.725447414116055e-01   +4.775675802750919e-01   +6.050626037844083e-01   +3.689284138712140e-01   +5.747341374414969e-01   +5.156891259494942e-02   +2.080576177676188e-01; +4.215409776952108e-01   +2.993202995610031e-01   +2.240950419049515e-01   +3.376761926721449e-01   +5.333899148391835e-02   +5.439898534571159e-01   +3.738091844285801e-01   +1.300951928394126e-01];
L1E_L2E_iAMPA_netcon = [+3.195009647035110e-01   +5.020229771307376e-01   +6.130101825094656e-01   +7.352581554729429e-01   +6.599401602589109e-01   +7.641968529900774e-01   +5.042559637696058e-01   +6.458029872495483e-01   +4.081972980369279e-01   +4.189010816384960e-02   +2.436598345297992e-01   +5.840123966170712e-01   +3.889444105971852e-01   +1.302353073936976e-01   +1.210177336705888e-01   +2.462777911649003e-01; +4.340578823433042e-01   +3.803998805381126e-01   +4.900543843716960e-01   +3.310061087705036e-01   +7.965143757807136e-01   +2.132649899834714e-01   +3.474194170292774e-01   +4.376414810484922e-01   +4.886768514508386e-01   +6.491559522157362e-01   +7.869207406583906e-01   +2.180987462619972e-01   +1.564754354727750e-01   +1.472598542144089e-01   +5.925031204220057e-01   +1.426677441468746e-01; +4.831478924607732e-01   +7.344849484883832e-01   +2.599984940221837e-01   +7.001419615126850e-01   +1.226839044023403e-01   +4.327497199492030e-01   +4.054562205961905e-01   +4.336131015931857e-01   +7.842369850932707e-01   +5.875039978055220e-01   +4.898198237357854e-01   +7.134419929613321e-01   +4.267248930041306e-01   +5.403422185372697e-01   +4.523186399314773e-01   +6.904789017292899e-01; +2.124105734817374e-01   +4.801833984533917e-01   +5.094645844496494e-01   +1.148112433342705e-01   +3.523641446353736e-01   +8.310046303224740e-02   +5.832808371744044e-02   +9.903877624458746e-02   +4.685494948956697e-01   +5.135821673423793e-01   +4.189964289731037e-01   +3.712698146328269e-01   +2.979891964516743e-01   +8.747664607501610e-02   +7.736517423391615e-01   +5.513012907832020e-01; +2.286520081829415e-01   +4.219955282895758e-01   +5.624363964443101e-01   +6.332554113271576e-01   +7.560027562203263e-02   +1.932928816147127e-01   +2.679709313381067e-02   +1.338489993654642e-01   +6.795576638818954e-01   +4.090775631685459e-02   +2.919218632553696e-02   +1.658037112022339e-01   +3.633999466685249e-01   +7.852714632621576e-01   +4.445894730273302e-01   +7.989602054577510e-01; +1.782169288462495e-01   +3.319929744852316e-01   +4.759767814515908e-01   +5.605770669515602e-01   +2.562736853386784e-01   +2.474270605639268e-01   +2.036246856238367e-01   +8.001050425766781e-01   +6.231995939160206e-01   +4.052977295375899e-01   +7.602212708818810e-01   +5.726447394007896e-01   +3.300575316965360e-01   +2.593334024071129e-01   +2.312830050209516e-01   +2.091682876832548e-01; +6.965546373850590e-01   +2.092078385947874e-02   +7.147489234598136e-01   +3.801543050567354e-01   +5.211469632448001e-02   +7.512761547914352e-01   +3.310149905413873e-01   +4.062808385943076e-02   +6.919498506363169e-01   +4.177440243014326e-01   +4.205621275655644e-01   +1.518828806608737e-01   +5.905729738173124e-01   +5.186899601544031e-01   +2.249915211990002e-01   +7.920702592355133e-01; +7.102638229151609e-01   +3.314871928941712e-01   +6.783029959637003e-01   +3.055763394885359e-01   +2.031170732439007e-01   +3.596769336785545e-01   +6.467288331069380e-01   +5.812140490034622e-01   +4.230160964728958e-01   +2.745044297852796e-01   +1.937583074158154e-01   +4.244995745918653e-01   +4.321406066925437e-01   +2.734078845139969e-02   +2.821991766873725e-01   +1.402545199339562e-01];
L2I_L2E_iAMPA_netcon = [+5.943663373428799e-02   +9.773285064499658e-02   +5.303199552350629e-02   +1.154974071150635e-02   +4.701941977615851e-01   +7.282553255204274e-01   +7.410026578213016e-01   +8.022198627697220e-01; +6.446058952267023e-01   +3.544045405612624e-01   +3.394654094155946e-01   +4.879263843978591e-01   +4.811416230056343e-01   +4.538325457502402e-01   +3.457360827558569e-01   +4.238549929589592e-01; +9.509178006356353e-02   +4.535911039903643e-01   +1.001532336382654e-01   +5.247718770045434e-01   +2.136130448400550e-01   +5.165143506509456e-01   +5.864283391511598e-01   +9.353605415846736e-02; +2.858127825021856e-02   +5.045122497594233e-01   +7.217889127839233e-01   +7.013661739186240e-01   +4.194038753223599e-01   +5.616893003312174e-01   +4.426500842788063e-01   +2.977902660028242e-01; +6.765531240341970e-01   +4.911828571644298e-01   +3.940649969671475e-01   +6.230996141152896e-01   +6.898761361090603e-01   +6.184180360690968e-01   +3.776337080106537e-01   +5.387841876986146e-01; +5.640424526461597e-01   +2.001161130807509e-01   +5.066517992719429e-01   +8.895603060011115e-02   +2.273814375583441e-01   +5.995433472345209e-01   +7.243682581278541e-01   +2.417138439528612e-01; +6.423469317173656e-01   +6.803330352344057e-01   +4.851717523043505e-01   +7.368608104024044e-01   +4.222272656759966e-02   +8.055940726571298e-02   +7.698000696498428e-01   +7.699023720582661e-01; +4.297522826469809e-02   +2.286019319175838e-01   +7.117854090272284e-01   +5.064720339697569e-01   +3.126784590227026e-01   +4.232180567117817e-01   +2.384855094883889e-01   +1.398395901704469e-01];
L2E_L2I_iGABA_netcon = [+5.810936319638571e-01   +5.103026134147228e-01   +6.447225122164905e-01   +1.757872508838001e-01   +2.196570456087023e-01   +3.489283268843909e-02   +5.153678899083832e-01   +1.314987750484072e-01; +5.463708702417268e-01   +3.919533129697074e-01   +4.424042315063306e-01   +3.749144442338551e-01   +5.598031270551591e-01   +8.418621207611894e-02   +7.582279405822981e-02   +2.054436407380923e-02; +2.445823040220930e-01   +2.827960185972977e-01   +1.226371026980195e-01   +3.403392506302117e-01   +7.864645258970573e-01   +6.147244526128629e-02   +7.270791088043125e-01   +3.548463915230517e-01; +8.083825226962892e-01   +1.057483390428603e-01   +4.880212787953023e-01   +6.409772417525011e-02   +7.076672281518656e-01   +2.681930570373879e-01   +6.937556382650201e-01   +3.864860314856909e-01; +6.824587218827880e-01   +3.819722935910917e-02   +2.525020684317517e-02   +1.395505486932783e-01   +2.645719565918691e-01   +5.845861108288424e-01   +5.570159259160934e-01   +4.610332308436754e-01; +2.546163048761075e-01   +1.459087648044530e-01   +3.112510280664341e-01   +1.327673454175847e-01   +6.079981274726078e-02   +1.052870234074172e-02   +7.343216266982105e-03   +1.984055365285388e-01; +2.109491778001999e-01   +6.934560086170005e-01   +6.743178655409161e-01   +3.192212794833497e-01   +7.052732311139347e-01   +3.793395110670465e-01   +3.435558399529005e-01   +4.242588784714858e-01; +1.033924286124416e-01   +5.749893198064430e-01   +4.175011396977538e-01   +5.111809075888284e-01   +1.681369476268165e-01   +1.817021005885276e-01   +1.117863508190329e-01   +2.514826753166839e-01];
L3E_L2E_iAMPA_netcon = [+3.863532727626763e-01   +4.384022608689863e-01   +6.813474844926338e-01   +3.838204253563026e-01   +3.719882646880114e-01   +5.120994317096742e-01   +1.436728165161668e-02   +3.811607687021803e-01   +5.105402133079621e-01   +7.440741994862464e-01   +3.475853163493296e-01   +7.190634375574920e-01; +5.936999706205432e-01   +4.813739722453370e-01   +2.013700176198876e-01   +2.831040285007774e-01   +3.876616055298034e-02   +9.723292273683942e-02   +1.753572066673282e-01   +9.437500264370599e-02   +2.129860658337624e-01   +7.114873359942914e-01   +6.797905120746348e-02   +1.179140237304896e-02; +6.298308805204270e-01   +6.611988755585798e-01   +7.944220388884961e-01   +7.112909185314984e-01   +2.550037093470995e-01   +1.436421965127708e-01   +5.242748739549104e-02   +2.867343979493903e-01   +3.719612626787713e-01   +1.173189097481543e-01   +4.589020233083792e-01   +3.990723411851093e-01; +3.017838050637575e-01   +5.708507714937318e-01   +3.415510975534452e-01   +5.551426498187293e-01   +4.438906113062084e-01   +4.016332510403720e-01   +4.144502174458220e-01   +3.464247939227403e-01   +1.648183690743892e-01   +4.800564955300156e-01   +2.576193791390036e-01   +5.446037470231524e-01; +2.642365977785395e-01   +2.047453887732641e-01   +5.255020376110101e-01   +7.611241615217951e-01   +5.081311715399817e-01   +3.305090912248715e-01   +1.393898963553361e-01   +6.054612194372248e-01   +6.082875804477860e-01   +3.228861315290339e-01   +1.568986168698991e-01   +7.814187835607882e-01; +2.232774782294648e-01   +3.342641812940669e-01   +4.647987286845238e-02   +3.983903086496596e-01   +3.135258655986016e-01   +5.237998450444893e-01   +3.466177312709551e-01   +6.726360575651424e-01   +1.404341078798066e-01   +7.903837308158544e-01   +6.456644827409627e-01   +1.925208557028276e-01; +6.395554009614325e-01   +7.178641070044401e-01   +3.881112738644502e-01   +8.085758237101531e-01   +6.933521550330242e-01   +7.478484852019388e-01   +5.256716266009350e-01   +3.679741559586108e-01   +6.214391516157020e-03   +9.854842287879366e-02   +1.288361339066624e-01   +2.821904110914801e-01; +2.300573783631565e-01   +2.709578630961642e-01   +4.260220207936098e-01   +5.481546995007002e-01   +6.408790866701228e-01   +6.326358670795863e-02   +3.261102054573329e-02   +7.445697362279081e-01   +3.863642207973267e-01   +6.280309376318467e-01   +2.679458631146256e-01   +2.890485329506749e-01];
L3I_L2I_iGABA_netcon = [+6.502592084285680e-01   +5.473150731063317e-01   +4.950148174851736e-01   +7.307290959713701e-02   +4.558252797508603e-01   +2.126829909034129e-01   +3.910466016666924e-02   +7.293827653005001e-01   +1.865267597699742e-01   +3.540772916603850e-02   +5.848854248583804e-02   +5.026570738773567e-01; +5.406194259174156e-02   +6.975923675673323e-02   +2.667201858238735e-01   +4.765892163370591e-01   +6.486678905259891e-01   +4.466591489497927e-01   +2.832318371219927e-01   +7.250312099955369e-01   +6.275724923057522e-01   +4.303048737273008e-01   +8.039267918115430e-01   +2.349616079070033e-01; +4.022472908309319e-01   +2.033938843763907e-01   +5.232301541909906e-02   +3.587520944266072e-01   +6.153601998023643e-01   +3.899455729924539e-01   +4.310875924530860e-01   +2.817717327076215e-02   +5.286479258682818e-01   +1.124053601621630e-01   +2.745059189596260e-01   +4.337710092997623e-01; +1.437659059872773e-01   +2.002758081335337e-01   +6.752193241738546e-01   +4.003696798705521e-01   +5.633347086847469e-01   +5.491655142034598e-01   +2.390433905763253e-01   +1.705995502450589e-01   +2.578577153819649e-01   +4.056482726470612e-01   +3.307790800873985e-01   +3.802178643550467e-01; +3.712228635079250e-01   +2.430945992183070e-01   +7.303218189348050e-01   +7.202031612267595e-01   +8.930570379655337e-02   +2.017385230404440e-01   +5.921622961606090e-01   +5.532848956375397e-01   +1.876162658270460e-01   +4.615654217740157e-01   +2.569569135445814e-01   +1.931559591141017e-01; +1.104223498125540e-01   +7.957969108984997e-01   +1.590929848945655e-01   +6.352657898321331e-01   +2.667017316379595e-01   +6.583675043348733e-01   +5.682136495653517e-01   +7.821186142588223e-01   +5.223175479622907e-01   +7.145437976622412e-01   +7.921864000280783e-01   +9.123759640785435e-02; +6.388076637903760e-01   +2.764788589133668e-01   +3.741734426852641e-01   +2.555334149112561e-01   +1.231084608387983e-01   +3.059441092912765e-01   +6.189405370766563e-01   +6.126489263178932e-01   +4.563406780606931e-01   +1.093797462677876e-01   +2.730834672120500e-01   +2.172541850746001e-01; +2.166693550143930e-01   +6.261193017544395e-01   +5.144478125763021e-01   +7.880547805160595e-01   +7.163243644514088e-01   +6.524507637863541e-01   +1.438180760513210e-01   +3.794665177399670e-01   +1.365540945384113e-01   +3.768317268622024e-01   +7.741069126040472e-01   +5.874121823916370e-02];
L2E_L3E_iAMPA_netcon = [+5.588373920277963e-01   +1.183421573645872e-02   +1.347938359047067e-01   +4.946675102659683e-01   +4.069486066733913e-01   +4.828980039212436e-01   +5.760808517108098e-01   +3.403709375243302e-01; +7.814190242579082e-01   +6.694132495555212e-01   +7.634971637559903e-01   +5.068840311732454e-01   +4.755106971760104e-02   +5.750205046227747e-01   +3.464081422987261e-01   +7.338096822450260e-01; +4.263517597973555e-02   +5.657170698481336e-01   +3.455347119251072e-01   +4.608385769513264e-01   +5.980512387232709e-01   +1.392235729795009e-01   +1.182046298654291e-01   +3.682611183529325e-01; +4.070121710203898e-01   +4.706962639010872e-01   +2.174976551803894e-01   +2.497754075640178e-01   +7.728957176387633e-01   +3.878536368935576e-01   +6.940466442066452e-01   +4.827052638263658e-01; +2.956766665660799e-01   +7.525445140998445e-01   +5.661243014196841e-01   +4.930481824266025e-01   +2.018894356018165e-01   +6.891868358671388e-01   +1.863105523806925e-01   +4.203368965687518e-01; +7.469263457694417e-01   +7.014093929273811e-01   +2.681068827502791e-01   +2.002822044394166e-01   +9.009457374041949e-02   +7.356544667001623e-01   +4.035385368969088e-01   +1.215685234014243e-01; +3.340230414166491e-01   +5.462294240656134e-01   +4.139121956700729e-01   +4.773103159531064e-01   +5.544534571395522e-01   +7.749654897837943e-01   +2.607696704749307e-01   +8.185991572580995e-02; +4.217867075563477e-01   +2.679123167009433e-01   +3.635946382443990e-01   +3.068003454881222e-01   +5.926161373176105e-01   +3.622240937718428e-01   +6.409391307781718e-01   +4.486988385321613e-01; +5.669182215034649e-01   +4.921130315478575e-01   +4.905057466345762e-01   +1.924654960561317e-01   +6.325959473974306e-01   +6.877102425554983e-01   +3.199105042986289e-01   +3.151416808148704e-01; +4.942870523885550e-02   +3.340505355885548e-01   +6.741345106050008e-01   +9.990339687349492e-03   +1.250671343323199e-01   +7.794641971760572e-01   +4.687905367221738e-01   +7.140888811739635e-01; +7.935181961686050e-01   +7.003343577476399e-02   +5.981919760708813e-01   +1.325971646864292e-02   +5.408692895721229e-01   +4.662136218781687e-01   +6.430187496481273e-01   +6.987833687935003e-01; +6.551556345406162e-01   +6.714287169714230e-02   +3.751806649093151e-01   +2.145276500613419e-02   +7.266829793475649e-01   +7.150288953201126e-01   +3.117373699176852e-01   +1.791425038248131e-01];
L2I_L3I_iGABA_netcon = [+1.555023179039785e-01   +6.984485603852539e-01   +3.980407353574376e-01   +4.701658040967434e-01   +5.272993442152040e-01   +4.117879719350485e-01   +5.034348213606600e-01   +7.627974487043144e-01; +1.253238413166847e-02   +6.232918053683522e-01   +8.257688263729490e-02   +1.001748028841430e-02   +7.872661366517961e-01   +7.257622163628634e-01   +1.779627175774293e-01   +2.643819624113325e-01; +7.324371964124912e-01   +1.799629872255477e-01   +4.626791829946417e-01   +6.133265329674563e-01   +2.524553832305015e-02   +3.753097393299702e-01   +1.215764981481172e-02   +8.084826454829005e-01; +2.964051740469743e-01   +1.480594529494315e-01   +7.327838542662904e-01   +7.359468077593518e-01   +8.072869130452227e-01   +7.521994034959011e-02   +5.578088543894026e-01   +6.195389587644782e-01; +3.110207784617093e-01   +1.954915595394601e-01   +1.076826849129804e-01   +2.829439752256703e-01   +4.144911347013500e-01   +1.724110121085645e-01   +7.486770937056424e-02   +6.494640130070448e-01; +3.893169471591184e-01   +5.709734396467215e-01   +6.479237750213993e-01   +1.115279203617561e-01   +4.915551517081575e-02   +5.681366257179790e-01   +7.473638550495763e-01   +6.370206051120838e-01; +3.127325359053731e-01   +6.811146856040152e-01   +7.584223078053481e-01   +6.078139050566301e-01   +2.229338088013358e-01   +6.410831784264434e-01   +6.367369898234185e-01   +1.313160474106129e-01; +1.288882848093802e-01   +2.108931068769162e-01   +2.745333492213613e-01   +6.182292719742689e-02   +3.858917817160711e-01   +5.323136033807457e-01   +4.393795297773000e-01   +5.787693146130058e-01; +2.690322966684829e-02   +1.438446150477763e-02   +1.169681525822284e-01   +4.923602186369967e-01   +2.714249217322815e-02   +5.322998165975221e-01   +9.541581876839487e-02   +6.116320892969022e-01; +4.718222926044229e-01   +1.106561944629760e-01   +8.359018609324802e-02   +2.811847864589768e-01   +1.411651437193407e-01   +4.816214464001793e-01   +9.599347366642132e-02   +4.210086343112960e-01; +2.815205355753421e-04   +7.837130546739804e-01   +2.735868724259313e-01   +2.137969615586393e-03   +8.825273804738186e-02   +2.233980435399369e-01   +7.522919181392254e-01   +1.797331092616027e-01; +2.837140302761365e-01   +1.217877944246595e-01   +7.766766130359000e-01   +3.642179056543611e-01   +4.972470518693584e-01   +8.584648115177511e-02   +3.035617761501191e-01   +2.258841055568370e-01];
L3I_L3E_iAMPA_netcon = [+8.067789245648397e-01   +4.387061105129532e-01   +2.845803085582556e-01   +7.634040659234020e-01   +4.415462951648721e-02   +2.097939643886827e-01   +3.867202330618552e-01   +7.556881010797916e-01   +5.843152631675858e-01   +1.040071048016234e-01   +2.730551237064689e-01   +5.086078350928176e-01; +4.353641276986849e-01   +2.492766403932289e-01   +6.163536608738409e-01   +4.155571552173029e-01   +5.438075180606151e-01   +6.282598372600413e-01   +7.449659605548268e-01   -4.144827454044052e-04   +5.611784977246885e-01   +3.960536091594493e-02   +2.450299499446860e-01   +2.937823303781322e-01; +5.186127893732494e-02   +7.256156561469755e-01   +3.789165672544986e-01   +3.066627640302401e-01   +4.542803304230162e-01   +8.544393627153346e-02   +3.630237068890683e-01   +1.098188068046892e-01   +2.162137990365380e-01   +6.756621042550240e-01   +2.138986521270383e-02   +6.591958125139050e-01; +7.427571142312704e-01   +1.792667241812748e-02   +1.805319869155328e-02   +3.946338616710490e-01   +3.584852909050469e-01   +5.584868904236587e-01   +2.277551295975475e-01   +2.650488958698375e-01   +4.754321877645117e-01   +1.178537670449171e-01   +6.689115323751602e-01   +2.878336879047606e-01; +6.010915748614770e-01   +2.440548752562405e-01   +2.631835218597162e-01   +2.227571088172082e-01   +5.461445619824090e-01   +4.654203102378045e-01   +7.956753994720998e-01   +2.933345611515832e-01   +1.886906361246323e-02   +2.937502841207850e-01   +6.569190189656323e-01   +4.160376769424321e-01; +4.560025938416291e-01   +1.909426219170847e-01   +5.949948569670516e-01   +8.052994272244411e-01   +4.516237322139527e-01   +4.450591543644529e-01   +7.566391739472051e-01   +5.056082841279241e-01   +4.354191262444358e-01   +5.730120461100595e-01   +1.079451447897061e-01   +7.542583780726454e-01; +2.587938923722313e-01   +3.279649079708130e-01   +6.912361943624946e-01   +7.060655640906098e-01   +3.823618277483671e-01   +4.626962669235035e-01   +6.953028874354380e-01   +6.176934790767876e-01   +1.345947290917051e-01   +5.815444974379526e-01   +5.199805317588451e-01   +6.046656555974282e-01; +6.113597971831912e-01   +7.559360588980281e-01   +4.714269483994453e-01   +1.469596269985485e-01   +5.039961217913463e-01   +1.113997919492725e-01   +1.819798736969013e-01   +3.444650674713169e-01   +3.226598265287874e-02   +5.777286307070673e-01   +7.227154266574891e-01   +3.018623963064371e-01; +4.503630227207838e-01   +6.229464084726056e-01   +2.743424764606561e-01   +6.049896111486319e-01   +5.905056271596527e-01   +3.127568199380040e-01   +2.625680309324309e-01   +7.754296789632572e-01   +4.610147202076459e-01   +7.462385097389221e-01   +3.941540788426985e-01   +1.884208910147715e-01; +4.257899966684559e-01   +3.673265410818577e-01   +1.253101196391718e-01   +5.062761638176797e-01   +1.535902534807707e-01   +5.366874953021530e-01   +2.182825551746157e-01   +3.422939533418716e-01   +6.903438353085470e-01   +3.035694644150646e-01   +6.600528171150031e-01   +3.984976916188077e-01; +5.389639774160457e-01   +7.702045338503278e-01   +3.021258774850470e-01   +1.600860417615455e-01   +1.655530026547261e-01   +1.631107335870831e-01   +2.222024924750243e-02   +1.337734278560286e-02   +5.811590751493662e-02   +5.406615125182951e-01   +6.621362347595489e-01   +4.587213077474035e-01; +7.066181248156747e-01   +1.703813354927909e-01   +1.956125422180501e-01   +5.820773984020640e-01   +7.186710925878079e-01   +2.341340925626713e-01   +3.885185866834724e-01   +5.426226582828417e-01   +3.569864115810507e-01   +4.000497460033869e-01   +3.760346872559576e-01   +6.943429942719458e-01];
L3E_L3I_iGABA_netcon = [+2.772790258850090e-01   +4.253654011352293e-02   +1.765603462188872e-01   +1.283463568905782e-01   +6.169626759637955e-01   +1.431948478491044e-01   +1.444488609496068e-02   +7.283003901145252e-01   +3.074124438500415e-01   +3.252357068403570e-02   +1.597690499901194e-01   +5.498201045110279e-01; +2.681054334310975e-01   +4.877869430895725e-01   +7.970825640970962e-01   +2.884110874609869e-01   +7.897412580765160e-02   +4.227224014997827e-01   +1.713255290941110e-01   +4.507824977057710e-01   +3.014321989907305e-01   +7.825730987521797e-01   +2.895188131649902e-01   +2.953669781640254e-01; +2.185813079085355e-01   +7.603334672231475e-01   +2.263959833691042e-01   +3.840511745518339e-01   +3.674278647077289e-01   +5.806459406515034e-01   +7.351113592694413e-01   +5.455002575972254e-02   +1.378242650997850e-01   +2.248330870804226e-01   +5.265408617783539e-01   +6.783562049151222e-01; +1.865737577232880e-01   +7.236636617328792e-01   +3.693682009793308e-01   +6.334946529999127e-01   +2.229669493751301e-01   +7.586458730584186e-01   +7.948911798663720e-01   +4.974807003135651e-01   +4.696520323460217e-01   +3.048109024335408e-01   +5.364937943310590e-01   +4.493643559250410e-01; +6.233781764658486e-01   +4.247705124776266e-01   +6.334587694308962e-04   +7.637450792792896e-01   +1.116761955272700e-01   +3.901460544874127e-01   +7.004226879853663e-01   +4.248045941897861e-01   +3.439588572634463e-01   +7.772600189130434e-01   +3.718260390206274e-01   +3.951755731255907e-01; +7.602466288075147e-01   +5.410595757754387e-01   +3.773306611034339e-01   +2.815805241470068e-01   +5.957488665175206e-01   +1.917198524254563e-01   +3.821303287752201e-01   +6.546541374386826e-01   +2.243903901281781e-01   +1.963299383308456e-01   +9.509590596824671e-02   +5.690168258176581e-01; +6.014615517838441e-01   +1.381742804889456e-01   +7.687782052926019e-01   +3.160476239902529e-01   +2.722563760816680e-01   +5.395622399041325e-01   +5.127454345656831e-01   +6.156722020171040e-01   +4.227958604258751e-02   +7.699844285658128e-02   +1.656632842587668e-01   +2.268537699856580e-01; +2.202687273133889e-01   +2.555638869518295e-01   +4.536899979505304e-01   +3.976329758537755e-01   +7.240669816338342e-01   +5.514563771057993e-01   +4.408451290554969e-01   +1.745364330353042e-01   +6.684594892818708e-01   +4.771199895730285e-01   +8.667917878951829e-02   +3.944891842319490e-01; +2.502169168970322e-01   +4.207960888181064e-01   +3.575255789246943e-01   +2.402300168255931e-01   +6.571302566546724e-01   +4.131032812401527e-01   +1.224429876800319e-01   +5.758570246810580e-01   +7.634892517074207e-01   +1.707143764181605e-01   +1.841556429580122e-01   +6.743828148806525e-01; +1.223005036213168e-01   +1.310100764252062e-01   +3.536269315986326e-01   +7.972857464062060e-01   +4.644917881689733e-01   +8.733919844892971e-02   +6.782707502258267e-01   +2.372124544962881e-01   +4.944855279825543e-01   +5.766260239735262e-01   +1.139627076291629e-01   +5.297103518040976e-01; +6.988870614216022e-01   +2.296580406022351e-01   +2.461598221785121e-01   +3.770723388775792e-01   +2.552203267518814e-01   +2.663464836185475e-01   +8.023359164941132e-01   +6.201592426302622e-03   +1.602224623180634e-01   +1.634517295861922e-01   +5.723605122480811e-02   +3.576775501926226e-01; +2.178080804788378e-01   +4.454252290657577e-01   +1.085259767780562e-01   +4.006465929587096e-02   +7.860938376926340e-01   +5.333537945038153e-01   +3.504141563660189e-01   +2.457357218288691e-01   +8.826861843545455e-02   +3.246629871790190e-01   +7.105376450803194e-01   +1.457401005996077e-01];
L2E_Input1_iAMPA_netcon = [+2.027418834806143e-01   +4.816729963302991e-01   +1.828947634749310e-01   +1.087773172353128e-01   +4.990926330656433e-01   +1.706157186588362e-01   +5.868833828719476e-01   +3.461390391269136e-01];
L2I_Input2_iAMPA_netcon = [+7.997350768809870e-01   +4.014015162095809e-01   +4.082283271194734e-01   +1.981727553154635e-01   +1.195630281593210e-01   +1.106098986974342e-01   +5.947989991990704e-01   +4.656230368942310e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  5.6 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = -10*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
