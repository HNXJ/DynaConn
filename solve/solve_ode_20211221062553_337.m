function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.094037709726006e-01   -4.163562653009396e-02   +1.147756793201734e-01   -2.478596001290205e-01   +3.379223370105177e-01   -5.038076970541518e-02   +2.177087448392911e-01   +2.403493314672080e-01   +1.832723405950709e-02   +1.499324833327947e-01   +2.632589324221403e-01   +1.218267900088487e-01   -1.020531330038323e-01   +2.661068288403636e-01   +3.551537047410499e-01   +3.349443728722571e-01; +4.033057039541245e-01   -7.614988300160030e-02   -2.294763211747066e-01   -8.117276551170879e-03   +2.427847019915820e-01   -1.539156979515120e-01   +5.515389304424215e-02   +4.746140876888055e-01   +3.917147847114960e-01   +1.296604233716683e-01   +2.613859648142415e-01   +5.969760037410338e-01   -1.395119754426394e-01   -2.704057090197958e-01   +2.143975162601691e-01   +8.886219685019384e-03; -2.754227358187357e-01   +4.586749872614075e-01   +9.886619613608739e-02   -1.460892905741080e-01   -2.452547496323862e-01   +1.214387669453426e-01   -2.591498868350406e-01   +7.993419770250429e-02   -2.598182454989342e-01   -2.857112800220557e-01   +3.005483615936201e-01   -9.683820956759291e-02   -1.853778398193883e-01   +5.406452489128937e-01   +1.110966010818038e-01   -4.997329794222158e-01; -7.060773893972923e-02   +8.646199364824175e-02   +2.842182958278239e-01   +3.566761393855828e-01   +1.468839472451704e-01   -6.029399718621357e-02   +5.045878490819349e-01   +5.748396813595050e-02   +3.677734190145456e-01   +2.097564611209826e-01   -5.722440337923966e-01   -1.786478984360378e-01   -5.346961624789662e-02   -2.250932754961470e-01   +3.799627556671773e-01   -1.440269344994974e-01; -1.320349133495943e-01   -2.781238161262595e-01   +2.488173361806538e-01   -2.175204462713148e-01   +1.062595840651657e-01   -1.480115997888454e-01   -2.272463594169744e-01   +8.409454088581905e-02   +3.714731947573949e-01   -4.730752116342126e-01   -1.535259798259829e-01   +6.817875126067136e-02   +2.416626961930368e-01   +4.340720749247851e-01   +7.527167359571310e-02   +4.549145652214516e-01; +1.857592643447354e-01   +1.273450324141159e-01   -2.310805010375527e-01   +7.482811264527300e-02   +3.974927876492049e-01   -2.569645288389553e-01   -5.731144122005076e-01   +3.060081520710852e-01   -1.452858661348171e-02   +6.434262649641125e-01   +1.150079101300119e-02   +5.805466544178968e-01   -2.087117230377184e-02   -3.393284108100864e-01   +7.799914980943221e-02   -5.511239115387057e-02; -1.820708439092858e-02   +5.802131092476452e-02   +6.201284750047924e-01   -3.857810127825707e-01   +1.959048331874811e-01   +1.415101458370970e-01   -8.676280801540812e-02   +1.219056950826732e-01   +4.691088264838169e-01   -3.130945743746463e-01   -6.927968240831496e-01   +3.228683596559532e-01   -2.027987069035730e-02   +4.898382172388542e-01   -5.804475958599704e-01   -4.564126364032654e-01; -3.096450649419399e-01   +9.239788788974132e-02   -3.239816316047005e-01   -3.608534498119643e-01   -3.101454136371118e-01   +5.812039390513759e-01   +4.988938170372882e-01   -5.105928706554326e-01   -2.451338516539629e-01   +9.330630477681971e-02   -5.890238602090653e-02   -4.587630415080616e-01   +3.540280462593620e-02   -4.086095647371955e-01   -6.816418259280885e-01   +3.032262548562403e-01; -7.117826231055200e-01   +1.680810600678162e-02   -1.664232407850892e-01   -2.386793644296183e-01   +3.867138649012057e-01   +1.166824824441022e-01   +2.485084286257146e-01   +4.635086953216451e-02   +3.163915038626104e-01   -3.853504751593861e-01   -8.856982923238430e-02   +1.105567360911965e-02   -3.928501210650536e-01   -7.773366578026158e-01   -2.513440794397376e-01   -2.032195349257480e-01; -5.806202408381281e-01   +3.105252678118559e-01   +4.682469006379224e-02   +3.982466273791465e-01   +5.422225417879257e-01   +2.030469034268727e-01   -7.936974231468935e-02   -7.593347232920485e-01   -1.312902143091802e-01   -2.374117040510619e-01   -7.081452826896859e-02   -7.558526076709181e-01   -7.035784127157977e-01   +2.284573702344799e-01   +2.783657678108365e-01   -3.843096358982717e-01; +2.944855476351019e-01   +2.443597301931118e-02   -1.335810102000083e-01   -5.225978597822392e-01   +2.675464474277804e-01   -4.754048661235157e-03   -6.144461745154578e-01   -2.837296010062366e-01   +8.195055175505761e-02   -2.541402043371390e-01   -2.249412387024282e-01   -1.874905639790679e-01   -1.918182791912508e-01   +1.243828859636287e-01   +2.304020268918494e-02   -3.629440065560091e-01; +8.745121768121886e-01   +2.103288014942735e-01   -6.032478214416540e-01   -1.381270590492068e-01   +7.276323772662679e-02   +1.827405463992471e-01   +1.576936199788388e-01   +1.639858996530758e-01   -1.089730480972473e-01   +1.961878389769950e-01   +1.811332515971988e-01   +3.503400751862475e-01   -8.153249059908927e-01   -3.412404733962032e-01   -6.427663234076417e-02   -2.043117262755962e-01; -2.705152822863492e-01   -7.435068632444800e-01   -1.440492306426834e-01   +2.509841224078841e-02   +5.402372585614068e-02   +1.514983779152350e-01   +6.036326559714535e-01   -2.875983048712192e-01   +1.022642113565642e-01   +6.142055622521489e-02   +8.368121871885682e-02   -4.165308946266009e-01   -6.867980741656817e-01   +1.605688255859432e-01   -1.953679295332127e-02   +3.052460351402222e-01; +2.675448406539904e-01   -3.291030677487576e-01   -1.136405679209177e-01   +1.248355927833052e-01   +2.643597584460126e-01   +6.675574304901760e-02   +6.667408969910439e-02   +1.982854304111496e-01   -6.552691164349392e-01   -5.508737327849067e-01   -7.327009566980228e-02   +3.040685452371891e-02   -1.563257167518482e-01   -1.975813502869373e-01   -3.456594888647838e-02   +5.084933253556436e-01; +3.204038235040387e-01   +1.316756441985445e-01   -3.749108065081931e-01   -5.092185951106762e-01   -3.444542617996106e-01   -8.644937735875267e-02   -9.296236008214409e-02   +4.476700905333013e-01   +2.351625606230811e-01   -2.333601577633476e-01   -4.946176777597391e-01   +5.539347088191351e-01   -2.074995115405090e-01   +9.186733455543028e-02   -1.931772980564916e-01   +1.758857678524748e-01; -4.456519843259975e-01   -1.294706060022929e-01   -1.859314441258175e-01   +9.305246800881366e-02   +6.785996282822043e-02   +1.229076855001499e-01   -4.772066018931459e-03   -2.894144143028866e-01   -3.684687781977617e-01   -3.679825083868969e-01   -3.561091326720473e-01   -2.933345723200882e-01   +4.558516689366014e-02   -9.313538091801662e-02   +4.378769034483122e-02   -2.247117073482662e-01];
L1E_L1I_iGABA_netcon = [+3.176987831433557e-01   -1.239553777866353e-01   -3.476531807375512e-01   -5.087220211853394e-02   -2.671394921785046e-01   +4.196312229876424e-01   +3.588683669537572e-01   +9.552243715929445e-02   +1.106210300783046e-01   -2.756127027862239e-01   -4.764133541475274e-01   -2.962098737473091e-01   -5.927998625604946e-01   -7.701510004236343e-01   -3.523992108970295e-02   +1.297557221897123e-01; -6.551627894913656e-02   -4.918410311956165e-01   -2.509295325253363e-01   -2.461652871386601e-02   +3.004373565842476e-01   +2.634716196423462e-01   +4.523483028158359e-01   +7.455641570185917e-02   +1.657586863497146e-01   -2.943217912841504e-01   -1.473816734911771e-01   -3.546488007467189e-01   -1.173889225550374e-01   -4.671436534918134e-01   +2.416725844625973e-01   +2.666739185912523e-01; +1.407093277680480e-01   -1.041584088784370e-01   +6.940592709074792e-01   +5.822520746607579e-02   +1.962567312320616e-01   -4.798931911486172e-01   +6.822714353127000e-01   +6.257019218038776e-01   -1.157717806753963e-01   -9.589061533599175e-02   +4.572290847637380e-01   +1.917045795033272e-02   -2.816519335485669e-01   -6.901716532944072e-02   -2.475185174979457e-01   +3.445631381982398e-01; +2.738779980308725e-01   -3.561665954931860e-01   -5.658532406169741e-01   -3.207984850526723e-01   -1.215953803365588e-01   +1.870188299577883e-02   -7.019155421490946e-01   +3.656875271692276e-01   -3.136446903893906e-01   +8.528076248166027e-01   -5.103565545284166e-01   +2.010654085128971e-02   -3.935187101602950e-01   -3.856578667166249e-01   +6.940356255532787e-02   +1.142802971952632e-01; +3.219773304159722e-01   +1.817016951368214e-02   +1.676156658760132e-01   -7.019935335154096e-02   +4.602770994835324e-02   +1.455927769598112e-01   +7.073971060364492e-02   -8.939456869279550e-03   -7.673432140079789e-03   +1.694718634819506e-01   +1.445654084157515e-01   -2.163141806081179e-01   +1.812265634859700e-01   +2.934673812682254e-02   +1.693232566622206e-01   +1.678238164665773e-01; +5.618672236656775e-01   +2.827954903309359e-02   +3.591829993978514e-01   -6.733471174691105e-01   -5.439262917965415e-01   -1.997945345768194e-01   -5.669733622529664e-01   -4.761079652028265e-01   -4.292905823329782e-02   +4.320752138462267e-01   +7.239035322788998e-01   +4.792941524308406e-01   +2.991722069131969e-01   +4.744757456251817e-01   -3.341156094351355e-01   +2.063853037059558e-01; +1.149570368985206e-01   +2.615706704927842e-01   -1.507424479411598e-01   -3.128805140925137e-02   +2.635991823604906e-01   +4.928227167173035e-02   -2.366478639257912e-02   -3.671619739404522e-01   -2.091400145558669e-01   -3.385077532875819e-01   -1.851547333219503e-01   -5.845786620274678e-01   -1.658200475921107e-03   +4.911564268270814e-01   -1.378429371420468e-01   +8.629892416526672e-02; +3.132440785992817e-02   -2.041639533868012e-01   +8.129229351456979e-02   -1.225833651629616e-01   -1.750387816005982e-01   -6.189259115920069e-01   +5.531328465614432e-02   -6.639891280277616e-02   -1.149131246928753e-01   +4.208520800483420e-01   -3.968628650295685e-01   -1.028670670572550e-01   +6.150021443822437e-02   +4.188483455440971e-02   +2.357454847541257e-01   +3.814601601071877e-01; -2.086488553931546e-01   +1.851927792378216e-01   -9.535937194888355e-02   +2.789420094700922e-01   +1.374479218066616e-01   -3.093822216793109e-02   -1.426939129798923e-01   +3.489634170879158e-01   +3.568058842984970e-01   -5.305244556603789e-01   +2.904069327369996e-01   +2.617109153173637e-01   -6.268062172365990e-02   +7.325217290602355e-01   +2.582155591531083e-01   +1.292681636923047e-02; +1.007534121103910e-01   +4.924765345624650e-01   +3.477384085868249e-01   +3.618297549897202e-01   +5.012032169055665e-01   +2.087669390263869e-01   -3.286040411905053e-01   -4.374027336773904e-01   -2.269147917931271e-01   -6.271321169740433e-01   +3.642840966118144e-01   +3.670485214909736e-02   -2.533501522272913e-03   +2.028773999051234e-01   -4.977670203872975e-01   -2.402308493518021e-01; -1.671436056800174e-02   -5.952770591993421e-02   +1.630286084411712e-01   -1.329012907330610e-02   +3.894170432057177e-01   -2.773422566495958e-01   +4.507024598340682e-02   +4.021583416744203e-01   +2.394345149492572e-01   +4.979137475231783e-01   -3.444912406752542e-01   +4.164434742412862e-02   -4.027368536512355e-01   +8.686367705102427e-02   -9.207631226365076e-02   +4.295553066946192e-01; -5.984631849302788e-02   -6.997882799837957e-02   -3.026497784752943e-01   +4.080388096657638e-01   +2.663968900745889e-01   -2.262562728494791e-01   +1.405564804562138e-01   -3.070489097349335e-01   +5.754251242136587e-02   +5.706795465442849e-01   +1.953935630988755e-01   +3.751434770233487e-01   +1.803144918279513e-02   +2.271826839057472e-01   -3.843949163159784e-01   -7.728902896926129e-01; +1.878551338983006e-01   -3.880959552065741e-01   +3.258719599871501e-01   +5.250116499312928e-01   +3.925132587214959e-01   +2.407841724335447e-01   +2.177426881860909e-01   -3.247055589338929e-01   -4.435557456551742e-02   +2.420352235321198e-01   -6.545615259907379e-02   +2.889214418697096e-02   +2.447586472354664e-01   +4.119633723362282e-02   +2.890940242758508e-01   -2.141685046706398e-01; -1.938834466437688e-01   -3.375569807358031e-01   -4.660394340237128e-03   +1.582189090594318e-01   +3.178530070795451e-01   +1.399547935226707e-01   +3.652859877938058e-01   +4.427738177729619e-01   -2.397012313362181e-01   +6.515790871739237e-03   +2.407931679562864e-01   -1.074822740652269e-01   +4.646162620492122e-01   -6.655477809265040e-02   -4.181107970771993e-01   -5.148843283277536e-02; -2.612988681443699e-01   +3.506425549639546e-01   +2.744244080638550e-01   +2.255391162238777e-01   +4.464166497573445e-01   +9.045825285050892e-02   +8.804635588114210e-02   -3.050334123280737e-01   +3.912033576010935e-01   +1.783218924413768e-01   -2.052749518095317e-01   -9.664620720086579e-02   -5.867253224588234e-02   +5.294780355569794e-01   -3.022508632816507e-01   +1.864292010611520e-01; +3.361359402070972e-01   -1.656017716163481e-01   +4.115093952767537e-03   -2.040524330603412e-01   +5.701871230331059e-01   +3.188144161892521e-01   -1.250251455294685e-01   -8.205184158055891e-02   -2.802375041110395e-01   +1.160848728911074e-01   -6.258215657109132e-01   +3.062877360007550e-01   +5.635865118052705e-01   -4.663455343618807e-01   -4.267946098357298e-01   -7.111806062262841e-01];
L2I_L1I_iGABA_netcon = [-2.506854227900541e-01   -1.255869001877537e-01   +2.545402815049974e-01   +2.830644985353278e-01   +1.738534747228930e-01   +2.990660662776364e-01   +3.659716550530323e-01   +7.489821702286816e-01; +3.390911081856631e-01   +1.733048787724139e-01   -7.130312860253247e-01   -1.730839254813416e-01   +1.224231031226944e-01   +6.804015918553464e-01   -4.224584239845480e-03   +4.979384915574467e-02; -1.092610596956780e-01   +1.391079832652630e-01   +2.499241520291860e-01   +2.983341277672725e-02   -4.369280414216781e-01   -4.424298211574506e-01   -3.344675091372880e-01   +4.214964037337353e-01; +2.214606420584019e-01   -1.818081934166502e-01   -4.376514758918564e-01   -5.924211008003152e-03   +1.486815618587682e-01   +2.824058619657416e-01   +4.575756067683749e-02   +3.911465587471775e-01; +1.402247595120206e-01   +2.521680363025394e-01   -1.974501352397469e-02   +5.817592032420724e-01   -3.346170277126986e-01   +2.242551698597234e-01   +2.450946341595674e-01   +1.267497233787054e-01; +1.856484601423893e-01   -3.576662513181684e-01   -2.680414301180511e-01   -6.944896846934863e-02   -4.057044433060945e-01   -7.289734348629280e-01   -6.645139312170478e-01   -4.368355045907268e-02; +1.038158975064752e-01   -4.632461528804900e-01   +9.697706302791025e-02   +1.059930606631239e-01   -7.779632882933933e-01   +1.361013665501837e-01   -6.176276322713736e-01   -3.002489183665157e-01; +5.637603309950291e-01   -5.160459188651031e-02   +3.189936764159468e-01   +2.589902737355941e-01   +3.367844300217840e-01   -1.261805347875148e-01   +5.934643718205240e-01   -2.033168508100931e-01; -4.009322154230435e-01   +1.272798875872466e-01   -2.329987209322478e-01   -4.005833903747377e-01   -2.387734565869382e-03   -2.728717295919695e-01   -2.109032036561081e-01   +4.527559735082632e-01; -3.635221606925142e-01   -1.051910625521623e-01   -1.476125259762600e-01   +4.310437273159202e-01   -4.676843917568604e-01   +1.793641890657423e-01   +6.725019789400184e-01   -4.397052093288848e-01; +2.447678118585349e-01   -5.421854698686460e-01   +2.906817075822566e-01   +2.118284435627682e-01   -6.075442234015823e-01   -3.157804550250770e-01   -1.389345219553221e-01   -1.115342862717838e-01; -8.782762950072872e-01   -1.220468698604610e-01   -2.994113834305236e-01   +2.456687254348873e-01   +6.314125470192926e-01   +3.673025816849509e-01   -4.293448695346322e-01   +4.720064183857026e-01; +5.208903128585971e-01   +4.683990585506810e-01   -1.063140092220634e-01   +2.288324652718070e-01   +1.981909529913126e-01   +4.959260869517814e-01   +4.101639193338695e-01   +1.828186684101409e-01; +4.891993941282680e-02   +5.771221164970605e-01   -5.613204869443971e-01   +6.905514551940112e-02   -5.455741565990178e-03   -2.530399584226220e-01   -1.972726193554223e-02   +2.798107508719185e-01; +6.932908082509081e-01   -6.667938192071585e-02   +6.667174744992919e-03   -3.474825419839670e-01   -2.269937704946581e-01   +1.867789408439080e-01   +8.274704017632134e-01   +9.366109248580961e-01; -3.033872743612370e-01   -3.687542826595143e-01   +1.758490306213852e-01   +7.556972915613715e-03   +7.927749723758026e-01   -4.514167003235153e-01   +1.112875963822580e-01   +6.094446786568477e-01];
L1I_L2I_iGABA_netcon = [-2.942071796137821e-01   +5.042982493126583e-01   -6.474146498454608e-02   -6.803814873430305e-01   +9.369692902936014e-02   -1.290643130708437e-01   -4.723861091338772e-01   -1.618802045197174e-01   -5.777608326445955e-01   +3.806456428471627e-01   +2.685359692404925e-01   -1.797614400701114e-01   +2.787554830262386e-01   -6.268364684088874e-02   +1.627953250613395e-01   +9.902051427104321e-02; -3.206629623273944e-01   -1.536247435577201e-02   +4.568013172900566e-01   +3.475199629537136e-01   +4.079747461171913e-01   +7.882111165506873e-01   -1.705301807736629e-01   -4.749734801781919e-01   +1.556917603708088e-01   -4.791943822424881e-01   -4.347414984045504e-01   -1.692463661251155e-01   +6.849083760876536e-02   -1.118205108194524e-01   -3.160306209935808e-01   +1.032719059455718e-01; -5.860116794772835e-02   +4.854913593264718e-01   -4.153145437526555e-01   +3.969823061869026e-01   -4.705986368621133e-01   -2.835085725812385e-01   -7.797047732788322e-02   +3.573623722344788e-01   +5.241987888198903e-01   -5.463990295370754e-01   -2.412911570338545e-01   +2.168938381671865e-01   +1.687018922805063e-01   -2.370621701548048e-01   +1.026799396807227e-01   +3.807837903304506e-02; +4.630287857919620e-01   +6.270480557150976e-01   +3.788274667829151e-01   +1.389541306617337e-01   +5.639250739936140e-01   +2.474484351743962e-01   +4.130575493129824e-02   -1.944885368099674e-01   -2.070392321733723e-02   -4.328055930663608e-01   +1.520464576087779e-01   -5.268398971996033e-02   -4.602414461907459e-01   +2.528988195793547e-01   +3.779270531789958e-01   +5.703126829093471e-01; +3.982702558861853e-01   +1.697152940369503e-01   +3.894277871595068e-01   +3.173900102391367e-01   -7.227695902618179e-02   -4.309048653270343e-01   +6.242418442818566e-02   +3.486979097840130e-01   +4.531589263246474e-01   -1.220676497958738e-01   -1.502497322839220e-01   +1.090428993170093e-01   +5.760330668545874e-01   -2.629922458106425e-02   +4.000473769520134e-01   +1.324633285819262e-01; +1.647566945039856e-01   -3.660974541564457e-01   -6.944536745005820e-01   -7.966498237506752e-01   -4.159898552562509e-01   -8.605426028809969e-02   -6.336488536996258e-02   -5.371074895935584e-01   -1.292145860150276e-01   +4.896520497170298e-01   -3.717888630393161e-01   -4.155403236237805e-01   -4.394033408944015e-01   +2.064246379651468e-01   -3.059796772222143e-01   +2.948357695156726e-01; -7.063965246401074e-02   +4.731679789883705e-01   -6.225257747479780e-02   +2.267016812477210e-01   +3.287100644275716e-01   +3.394105564016752e-01   -1.124677112317528e-01   -3.304396247057376e-01   -1.155679725224287e-01   +1.634513145493335e-01   -2.900227248105159e-01   -4.946360275361701e-01   -2.364994075323896e-01   -8.258161651465329e-02   -2.130370271962730e-01   +4.582010027788325e-01; -3.368437846911084e-01   -4.745222716880932e-01   -1.738336607001177e-01   +1.374951604923826e-01   -6.145572048840826e-01   +5.073392179306534e-01   -4.777663496959693e-01   +6.932757401716366e-01   +3.051802884381430e-01   +7.069840852381509e-01   +2.392941242343393e-01   -5.155391190531620e-01   -2.440900876016577e-01   -6.090087192986449e-01   -4.314626953821125e-01   -1.662663960024079e-01];
L2E_L1E_iAMPA_netcon = [+1.230703058046766e-01   +3.840056899576422e-01   +2.470001773712568e-02   -4.346578085292478e-01   -4.219076449435807e-01   -2.865644934601999e-01   +1.246571202773998e-01   +6.279067425242163e-01; -1.122305635405464e-01   +6.999006624571894e-01   -1.130212277152002e-01   +1.612458340870007e-02   -2.335193365912226e-01   -6.658905655095466e-02   -3.092199529909668e-01   +1.644187936211647e-02; +4.414876284445080e-02   -1.138364054802412e-01   +9.206416362870923e-03   +7.048810828354728e-01   +2.819554223248482e-01   -1.938436923700452e-01   +2.889080258354390e-01   -5.001559925708530e-01; +1.106698357469408e-02   -1.627239569139303e-01   -1.823025558329178e-01   +5.429165881223732e-01   -2.154049428454606e-01   -1.886680614770274e-01   +3.352246253216858e-01   +1.152656733836969e-02; +2.345321350270916e-01   +3.308992193333747e-01   -2.093247147373958e-02   +8.595901866712213e-02   +1.676650206559216e-01   -7.787947220443597e-03   -1.838799523191951e-01   -3.835177428729180e-01; +5.600694965318187e-01   -3.979812199773581e-01   -1.486632121147251e-01   -1.116535135423759e-01   -7.395089967532747e-01   +4.630364700979113e-02   -2.960347828958242e-01   +2.593200461046135e-01; -5.383912382003413e-01   +1.135605856669252e-01   +2.753758027723616e-01   -2.830373347379713e-01   +3.132199608379755e-01   +5.613180104548638e-02   -2.312117277200650e-01   +6.137418400242719e-01; +3.131036016061243e-01   +4.403055518730495e-01   +1.055568782661286e-01   +2.450167889960438e-01   -6.582428090259329e-01   -9.464684331258216e-03   +2.044776158871682e-01   +5.716315246365099e-01; -1.964826136910983e-01   +4.201225404128871e-01   -2.887394100525699e-01   -1.459126675024056e-01   -1.385575411032579e-01   -5.767799483715728e-01   +5.994791338586131e-01   +1.387395425485813e-01; +6.525206587638264e-02   +2.803218640893444e-02   -1.248825568122797e-01   +3.716857457556407e-01   -2.810973797813879e-02   +1.034385701518176e-01   -5.990715286109047e-02   +1.160815094188942e-01; +2.591472769032905e-01   -3.637109899181594e-01   +5.273076036044547e-01   -5.166109403050322e-01   -1.132727981983240e-01   +9.182661349879348e-02   -3.535853331020948e-01   -8.511562578004905e-02; -5.928668881380067e-01   -4.900271092273192e-01   -1.113016520617029e-01   +1.351002732721806e-01   -5.699556524533207e-01   +1.605291904220237e-01   +8.958614600779606e-02   -3.116540790663733e-01; -2.493652394849167e-01   +4.524547904049079e-01   -2.656394929795198e-02   +2.125267083004439e-01   -2.878553522355617e-01   +4.313943613720692e-02   -3.096678338913246e-02   -1.231770977769832e-01; -6.960009348199555e-01   +1.806365720097092e-01   -9.924046289572501e-02   -2.773162161033308e-01   +6.251206483498714e-01   +4.902021856193329e-01   +4.549352343190941e-01   -5.743787769405653e-01; +9.234230131490878e-02   +1.410388913586754e-01   -1.940147382009483e-03   -7.372081575194632e-01   -5.944867174745918e-02   +6.587404498950195e-02   +1.957333307248633e-01   -4.398667462894127e-01; +3.496092958498019e-01   +1.869636739553759e-02   -2.730080484255295e-01   +6.291970090420647e-01   +2.460270324510390e-01   +5.396937590261656e-02   +2.579152578136733e-01   +3.806928833663474e-01];
L1E_L2E_iAMPA_netcon = [-5.123786551581235e-01   +2.961148208943736e-01   -1.971883687725046e-01   -1.126665679150216e-01   +3.649637849415089e-01   +3.588858687154013e-01   -1.128547143379723e-01   +1.659688714722379e-01   +2.059886604605346e-01   +5.502350959275907e-01   +2.722100123083290e-01   -5.512056018177028e-01   +5.913382342452285e-02   +4.502775867628775e-01   -1.474191542142880e-01   -5.303434089560325e-01; -1.933870735760150e-01   +2.955867978037583e-02   -2.743204608963877e-01   +1.535747688918875e-01   +1.938133535946325e-01   -1.750764466548995e-01   +1.321673161773932e-01   +1.521282624757462e-01   -1.543495537695107e-01   +2.117019661168340e-01   +4.199944951193128e-02   -3.113874135217916e-01   -4.801215660524680e-01   -2.765655232745748e-01   -1.556893113680968e-01   +2.619270420499914e-02; -3.444111307559042e-01   -1.124143716036193e-01   +1.305374704075883e-01   -3.103109624428565e-01   -3.370407405108841e-01   -4.367064028321269e-02   -2.061227215434286e-01   -2.452223158544415e-01   -5.356878984220570e-02   -4.260668558723217e-01   -2.112721478967279e-01   +3.275736977270847e-01   +2.110835514168685e-01   +4.860252351787705e-01   +3.041283261881240e-01   +2.815318690634304e-01; -3.964403741600437e-01   +3.145253305802695e-01   +3.729023632501175e-01   -3.348613190752785e-01   +3.717339031478891e-01   -2.439728394801197e-01   +4.411171342140273e-02   +1.832295024710390e-01   +1.614932573404569e-01   +1.406867628783852e-01   +3.643743788659496e-01   +3.859388927392448e-01   +2.541943006117761e-02   -1.438087190160608e-01   -4.318618717005788e-01   -2.584028404389503e-01; +6.272825537784247e-01   -3.278424094967468e-01   +2.023318268834270e-01   +2.400587359898309e-01   +2.229733452191432e-01   -3.129549736048733e-01   -4.061114946956991e-01   -5.185830639147884e-01   +6.220051672426976e-01   +5.536971275024041e-02   -4.845127286154917e-01   +1.757131452073044e-01   +2.838792618209531e-01   +1.749705566260432e-01   -1.172974545148485e-01   -3.025868203780933e-01; +2.845008980724864e-01   +2.725055763248149e-01   -6.282943080274130e-01   +5.991719083690212e-01   +3.693201577290877e-01   -2.276050394232024e-01   -1.220598667688432e-01   -9.417314331647740e-03   -5.772105393142603e-01   +7.768418570596317e-02   +3.819790999498573e-02   +3.223774706988274e-01   -4.068547751299497e-01   +7.553203106553874e-02   +4.399055439487957e-01   +5.374074761389486e-02; +7.758156449833695e-02   +5.779450533521349e-01   +1.279680857414233e-01   +1.000588530471911e-01   -3.051423595010067e-01   +8.944958962322665e-02   +3.180015826841988e-01   -3.812482634915798e-02   -5.214568152376640e-01   -3.015014386854271e-01   +5.761357829402494e-01   +1.413932030503948e-01   +3.206030652869570e-01   -2.338142198473999e-01   +1.363300092541571e-01   +2.094782455938986e-01; +4.185406161796877e-01   +7.737084958366482e-02   -8.359046214340861e-02   +3.234023662495832e-01   +2.310870471332077e-03   -1.461901995228435e-01   -1.099814004650801e-01   -4.782873500275970e-01   -8.503751604743988e-01   +4.453170790609168e-01   -6.808076714649838e-02   -9.582559517231737e-02   +1.103947288638454e-01   +5.243486872289478e-01   -5.329132028434554e-01   -4.985016159786528e-01];
L2I_L2E_iAMPA_netcon = [-4.546618934724090e-01   +2.148389269595475e-01   -1.356650359631411e-01   +2.758339763524253e-01   -1.470387220578571e-01   -1.422163556973456e-01   -1.058420303989187e-01   +6.859885384902120e-01; +2.284497840985429e-01   -3.142169571300180e-02   +4.094331985874091e-01   -2.271190964565157e-01   +3.414023089518758e-01   +5.342023378311204e-01   -3.545720884548744e-01   -2.460184958526216e-01; -4.609908212799976e-01   +7.245835059806850e-01   +2.162925039034855e-02   -1.315354969696731e-01   +1.650971990577768e-01   +1.638135835928526e-01   +3.376277411640515e-01   +1.424689212100594e-01; -2.397487047474175e-01   +7.594880243603420e-01   +3.936215411501199e-01   -2.935654439740129e-01   +8.652546414658197e-01   -4.862841453795499e-01   +6.295177822225563e-02   +1.849006695456285e-01; +5.483947273466054e-01   -3.484717475723774e-01   -3.744245898677771e-01   -3.226491396078369e-01   +3.149408185996626e-01   +3.044412891441675e-01   +3.496646026356964e-03   +4.520373145952143e-01; +1.005149541329267e-01   -1.252936618129323e-01   +4.411044726462809e-02   -6.787173879667273e-02   +2.168981360833641e-01   -6.299367279815533e-02   -2.385149824067685e-01   -1.324828874886982e-01; +1.858695915203152e-01   -4.095797263612398e-02   -1.725324908709815e-01   +1.371338757688604e-01   -7.354750529976289e-01   +9.619675162952190e-02   -4.135588042076768e-01   -2.242042298657952e-01; +2.600890364950354e-01   -2.191430712478451e-01   +4.294918550221518e-01   +1.800741182217673e-01   +2.014098730555827e-02   -2.297572718188177e-01   -1.927758481670605e-01   +6.583980536354492e-03];
L2E_L2I_iGABA_netcon = [+2.243301271714611e-01   -2.570286029277977e-01   +2.403596958633541e-01   +1.374005054526952e-01   -4.570489006673409e-01   +3.474516092388087e-01   -7.606402821435160e-02   +2.870266280025652e-02; -5.906158262516668e-01   +8.976093452126815e-02   -3.122339066659336e-01   -4.564608581595623e-01   +4.173499059193592e-01   +3.356940818975417e-01   -3.074516113048138e-01   -5.369364607998469e-01; -2.589657045280636e-02   +3.833575467188322e-01   +1.685802092151723e-01   +7.679145345350710e-01   -3.190259314345149e-01   -5.907668646822448e-01   -1.851234349594638e-01   -1.923673439652421e-01; -4.208306986863288e-01   -1.567400075400327e-02   +2.730784771793171e-01   -1.377743475692726e-01   -2.827393476739543e-01   +1.944293087137964e-01   -4.956328209280950e-02   +1.348002042440808e-01; +4.193495214433600e-01   +4.135659897935667e-01   -1.278526353955894e-01   -4.606075256129491e-02   -2.586207365566859e-01   +2.229473083566741e-01   +2.889419476902086e-01   +8.938815794418767e-02; +6.772989876859530e-01   +5.627434826590875e-01   -6.589218364777527e-01   +1.798127629323291e-01   +2.156468701986229e-01   +4.297608056634331e-01   -1.068843146158514e-01   -2.888292084560640e-01; -7.037328093636818e-01   +1.031582111674118e-01   +8.643534749071820e-01   -4.128148866272698e-01   -4.145954815055790e-01   -1.412425249949782e-01   -1.214499153178204e-01   -6.601377689216573e-02; -1.352824808111685e-01   -4.931514283694292e-01   -4.420019408577067e-01   +4.930817874660265e-01   +3.470784145752694e-01   +3.804533415180887e-01   +5.143364576204749e-01   -9.645256944498758e-02];
L3E_L2E_iAMPA_netcon = [+1.851954652434016e-01   +2.589389770103913e-01   +2.448228537504303e-01   +4.158511611032381e-01   +6.299685330349571e-02   +1.732129545896807e-01   +2.868353141900248e-01   -2.414404163314263e-02   -4.745589498487732e-02   -1.117068039106281e-02   -4.420697246096075e-01   +2.997007061460259e-02; -4.841877375155459e-01   +6.923491694368149e-01   +4.184670215968527e-01   -1.380216709763347e-01   +1.265658518107843e-01   +1.992496443547888e-01   -3.266528206608421e-01   -3.594481481584009e-01   +4.762535280657637e-01   +5.698890234168918e-03   -2.789267968326863e-01   +6.515759034733511e-01; +4.416424557477373e-01   -4.089309017633737e-01   -3.681560110829049e-02   -3.499776124476090e-01   -2.434020894693263e-01   +4.536392088450737e-01   +6.178054392409938e-01   +2.002710841844488e-01   -5.538148691370055e-02   +2.956094178530083e-01   -2.389697846170093e-01   +3.285153085186242e-02; +1.103361687054951e-01   +4.787315926240842e-01   -4.490780054419861e-01   -2.369000997261134e-01   -4.397538460920574e-01   -4.842434749913206e-01   -2.633341905471494e-01   -2.909885625958401e-01   +4.962025139892532e-01   +6.163860466198733e-01   -1.418430955154538e-01   +2.118558230945898e-01; +6.222456636787286e-01   -6.004610208546390e-01   +5.892170036889935e-02   +4.071732459003009e-01   -1.374027141610673e-01   -1.188371961203509e-01   +4.986622750079920e-01   +3.687501152657021e-01   -2.244310834781660e-01   -1.361189554805079e-01   +2.719383698946899e-01   -7.544047237488707e-02; +1.253258216665506e-01   +7.561299520152722e-01   -3.371860630607595e-01   -1.294467005805142e-01   -2.463674513835751e-01   +3.972456088279321e-01   +1.030293121462838e-01   -4.987615514796548e-01   +6.275078792027198e-01   +8.410993273965012e-01   -9.233346724509453e-02   +4.629635264459750e-01; -4.141239797307026e-01   +7.529593617017213e-02   +7.979666579416549e-01   -7.841488664433833e-01   -6.665005913264535e-02   -3.239896462340004e-01   -1.885048831336621e-01   +4.429320639412451e-01   +5.503453423086425e-02   -2.953588335426627e-01   +2.750457607222074e-01   -3.849545976050744e-02; -1.995782412668759e-01   +4.071261730309368e-01   -2.845039305829419e-02   -2.546448436437288e-01   -6.130963078209761e-01   +3.511029713957400e-01   -2.540217929193528e-01   -4.486955383402813e-01   +1.022481875763706e-01   +8.279665046964748e-01   -4.428861373374588e-01   +4.043796375617104e-02];
L3I_L2I_iGABA_netcon = [+3.344782877544298e-01   -5.705757534174830e-01   -4.595668327169371e-01   -6.843135832831793e-02   -6.863515729536255e-01   +1.335051093554936e-01   -8.165938587886330e-01   -8.366033913807762e-01   -6.384757115923012e-01   +4.139137118731817e-01   -8.024788893328590e-01   +2.545396667653865e-02; -4.559924112386666e-01   +2.267291842023010e-01   +9.313644196814172e-02   -3.291634305015047e-02   +2.532458413227133e-01   +2.045491577360634e-01   +4.909953919001094e-01   +3.919180426700419e-01   -4.492935537660437e-01   +1.317653074172775e-01   +2.114246444728324e-01   -3.998637564254172e-01; +4.147145526697214e-01   +2.482233523831629e-01   +5.165161469766333e-01   -8.773736981849838e-01   -4.961416206283396e-01   +1.836353041890931e-01   -3.083651141308950e-01   -1.775232542726556e-01   -7.201823577814534e-02   +1.778922901499948e-01   +3.860706397594723e-01   +4.636448434735059e-01; +7.475604725700089e-01   -3.578411118076120e-01   +1.906116327157507e-01   -6.194597449207147e-01   -1.425657244014800e-01   -6.592894083798413e-02   -2.852175261232671e-01   -1.127469473102085e-01   -5.008060388989807e-01   +5.797856967143592e-01   -4.685285373604344e-01   +1.823628736048139e-01; +4.382615386838549e-01   -4.889781672146832e-01   +8.113780397804642e-02   -4.329534669368073e-01   +1.444975391968153e-01   -1.630609563590225e-02   -2.359320434068562e-01   +2.846131341954337e-01   -2.112606627469092e-01   -2.713071452628255e-01   -6.235346005764305e-01   -8.710035902501843e-02; +5.186388443886745e-01   -3.864656560075729e-01   -6.011941637838536e-02   -2.867465699729168e-01   -2.374422171034088e-01   +2.740882212123564e-01   +1.169226713707527e-02   -1.587203264991915e-01   +7.725419013700413e-02   +4.386673413867755e-01   -1.648222975829166e-01   -4.077032830212978e-01; +5.084675872330587e-01   -1.337945599886323e-01   -7.360182646327340e-02   +2.938218253372035e-01   +3.452413646768410e-01   +3.632566428498643e-01   -1.939506754006909e-01   +1.954026227234815e-01   -7.425256462619628e-01   +5.179107204895259e-01   -4.230612414310913e-01   +1.878519918242755e-02; -4.974680063128463e-02   -4.484166602342587e-01   +1.240750802062795e-01   -5.887439257235849e-01   -5.476451185578793e-01   -6.512097724573264e-02   -2.436567683258940e-01   -1.172501088911281e-01   +1.975356822052312e-01   -3.158774725270643e-01   +1.797252621883246e-01   -6.754572374943611e-02];
L2E_L3E_iAMPA_netcon = [+3.618171005696336e-01   +3.303664648901772e-01   +3.131903540997503e-01   +3.602942716722226e-01   +2.595799959125034e-01   +8.710844176555527e-02   +2.875477703694376e-01   +1.544955055564615e-01; -4.019896645494514e-02   -1.513634737487124e-02   +3.837617219424818e-01   -8.421193953223732e-02   +1.254741424900514e-01   +1.616361872391557e-01   -3.179728876966552e-01   -1.713508747390978e-01; -1.044245159560108e-01   -5.460173239906594e-01   -4.919409815682703e-01   +8.800022866217251e-02   -3.418793474441641e-02   -7.546404193987093e-02   -2.044258581054132e-01   +3.852417655782842e-03; -1.389655869900802e-01   -8.360758624758821e-02   +3.352937496428296e-01   +3.478226210503019e-01   -4.085845425589175e-01   -1.670060649830226e-01   +2.482300615578868e-01   +1.234828528985344e-01; -2.180033307161600e-01   +1.348651889034225e-01   -1.354140513067747e-01   +3.133968525016190e-01   -9.846458487818874e-02   +2.812915316265445e-02   -2.165155819560231e-01   +1.128045807994447e-01; -6.446376131623058e-02   +9.531914896161110e-02   -5.372913211338221e-01   +5.680740574266663e-01   +5.107337404565120e-02   -1.074051757401164e-01   -4.828835161030172e-01   -3.340558626058360e-02; -5.331919292576893e-01   -5.395449511548729e-01   +1.242688948176986e-01   +2.557934886001769e-01   -5.050685813806651e-01   +1.529941242153479e-01   -3.118316293681302e-02   -2.207361309294723e-02; +3.370327178290597e-01   +2.239349460065992e-02   +1.319667697862870e-01   +4.757972676511816e-01   -2.173503602289285e-01   -5.474739603211353e-02   -2.861480169560996e-01   +7.877125889591907e-02; +2.225158247997233e-01   +2.187942205268568e-01   +1.763290624719119e-01   +1.499685083512919e-01   -3.647328688347099e-01   +2.537927883882592e-01   +3.258776517110554e-02   -3.341346205282691e-01; -5.568208789339006e-02   -5.861485462493007e-01   +1.972509263756140e-01   +2.886230223794243e-01   +4.875957568277687e-01   +5.825401030207564e-02   +2.310589957018225e-01   -5.871293276635745e-01; +4.555951412867356e-01   +2.319082064900390e-01   +3.175073602332051e-02   +5.181182340272031e-01   -6.566232332736531e-01   +4.067710492739815e-01   +3.924686198364661e-01   -5.668074400680124e-01; -4.764803466853936e-01   +4.396561897564640e-02   -6.711809700311100e-02   +2.017188331467400e-01   +9.419665554606266e-02   +7.028543751711517e-01   +2.123115842217619e-01   +1.706458753433162e-01];
L2I_L3I_iGABA_netcon = [+5.577424891049615e-01   -5.022829268565479e-01   -2.628431642845416e-02   -5.909760957678734e-01   -5.789869250224440e-01   +3.286402891936137e-01   +9.056896717496431e-02   -3.601793446803968e-03; -9.060001753771638e-02   -2.013409277188709e-01   -1.830717357913708e-01   -3.507871792820978e-01   -2.487640481846718e-01   +1.920814599517030e-01   -3.213805169640011e-01   +7.063059108404504e-02; +5.060672102419349e-01   +3.136675006930494e-01   -3.710862905751552e-03   +4.173770845240019e-01   +1.882307046241293e-01   +4.594212572917326e-01   -1.511438454317909e-01   +8.896932688119829e-01; -1.263094378755859e-01   -1.182242632815425e-01   -5.905113294386009e-01   -2.324999261922375e-01   +1.193114638300193e-01   -2.228658253604018e-01   -1.606200981169435e-01   -2.250240187466063e-01; -1.727250143732885e-01   -6.997757810646600e-01   -6.463366769302071e-01   +5.582726078434289e-01   +6.354455282785472e-01   +3.842688050071031e-01   -2.410875200163468e-01   +1.871531924657678e-01; -2.764785640286209e-01   +1.407574417534618e-02   +3.135060727779172e-01   -1.965755991151426e-01   +7.042959410521031e-01   -8.056027105340171e-03   +4.361109487762460e-01   +2.421391028415795e-01; +2.733373485139814e-01   +2.388890880340830e-01   -1.624290244268594e-01   +3.384065270005197e-02   +5.621383490475366e-02   -2.861795101722135e-01   +6.629474343570949e-01   +1.552179353239142e-01; +6.379832700377754e-01   +2.688681641330884e-01   +2.736410028950382e-01   -8.064405104080092e-01   -2.841907012669670e-01   -4.098991985738875e-01   +5.968983915694869e-01   -6.148993757735471e-01; -3.797857369928167e-01   -5.534335119444601e-01   -2.642795626526532e-01   +8.453713914638302e-01   +4.552585841993985e-01   -2.794527337008123e-01   -2.273378412045007e-01   +2.618405874810563e-01; -4.011240424182623e-01   -4.155348880222178e-01   -1.407516859605363e-01   -5.205769013294361e-01   +4.466312199197551e-01   +3.493259599141275e-02   -3.676504633808330e-02   +2.361274082088952e-02; -2.373111511545501e-01   +1.476711028353780e-01   -2.051553363494903e-01   +5.501578022942231e-02   +6.189640538172357e-02   -3.834581714462652e-01   -4.187910941096252e-01   -5.076638881199474e-02; -3.221512196790258e-01   +3.020880863279484e-01   -2.075890309256572e-01   +3.355762239217439e-01   +2.420492734552649e-01   +3.638105301503745e-01   -4.443097531478863e-01   -7.410097655007798e-01];
L3I_L3E_iAMPA_netcon = [-8.411060190870670e-02   -1.089078268688323e-01   -7.972559061653786e-01   -1.905598012528178e-01   -4.831596593807725e-01   +1.161973770421527e-01   -5.667453553789887e-01   +1.336960999967177e-02   +4.855201800293668e-02   -1.312358771809310e-01   -5.182038601519451e-01   -7.892553268043225e-01; +5.011786522600260e-02   -8.130106381174512e-02   -3.043342174724811e-02   -2.333925138719904e-01   +2.133588085883810e-01   +1.225425021307363e-01   +2.648416525924975e-02   -3.748228024380741e-02   +2.103420542958861e-01   -9.133473193962130e-02   +3.285481477624247e-01   +3.477986460284059e-01; -1.761998472970513e-01   -6.472942585362182e-02   +9.127716592407945e-01   +8.322074895468454e-02   -2.668938315096831e-01   -5.993447721776699e-02   +4.146086045894131e-01   +4.139065859142643e-01   -1.272605117930855e-01   +3.967116623450848e-01   -3.767502623413889e-01   +2.427803969870762e-02; -6.169122169329028e-02   -9.848043382158636e-02   +5.072640349309239e-01   -1.588455937930017e-01   +3.725229908024846e-02   -2.304690646750929e-01   -1.612879521598917e-01   +3.179568739212911e-01   -1.107255362024894e-01   -4.971013216339126e-02   +3.257462473472074e-01   -5.438926484328579e-01; -2.269828607004186e-01   +3.841518426117785e-01   -4.173575658348256e-01   +1.470316757324861e-01   -7.349840389868496e-01   -5.018581350187151e-01   -1.617086979480107e-01   +3.341431316766141e-01   -1.166904089829156e-01   +1.862273500788413e-01   -1.767930525305533e-01   -2.537700392853537e-01; -7.046069944522138e-02   -4.852342915717865e-01   +1.018487561419645e-03   +1.247166010719549e-01   +4.299082115404881e-01   +3.499733827022627e-02   -5.828587802757616e-02   +3.407214874151465e-02   -4.731782077136238e-01   -3.652541602634493e-01   +2.458705652254600e-01   -4.848560064986313e-01; +1.458394592840951e-01   +3.881962913452505e-01   -3.087278241373105e-01   -5.739824836556076e-01   +2.367875484573831e-01   +1.167192583182128e-01   -1.213115101327880e-01   -3.202066028322520e-01   +3.722605560311206e-01   +5.397032793222957e-01   +4.592923422111508e-01   +2.606554755991786e-01; +1.202600446187627e-01   -2.812400740201722e-01   -5.144811530474553e-01   -2.694661655909401e-01   -2.266443040928479e-01   -8.224771755014514e-02   -3.595023987099107e-01   +2.223500377169885e-01   +9.233825754118810e-02   -2.753552902665544e-01   -3.428639025539314e-01   +3.198006932983007e-01; -1.646415006390489e-01   +3.223551471343113e-01   -4.601561670893039e-01   +6.670037412490449e-01   +4.695233059529096e-01   +1.723987091173042e-01   +1.650428430615400e-01   +1.785754093281587e-01   -2.675612152730432e-01   -6.041097984912353e-02   -9.807910663962875e-02   +3.056653327905607e-01; -2.065919718716498e-01   -7.143688856666738e-01   +2.586409416740792e-03   +5.968966696965741e-01   -3.911253672337247e-01   -1.374116900816461e-02   -1.539440448161063e-01   +3.128211234974925e-01   +4.633925921976745e-02   -3.072306362253724e-01   -3.056282677690515e-01   +2.994078475755363e-03; -1.281864859124081e-01   +5.312317359421836e-03   -1.637774882274139e-01   +7.654740209299862e-01   -4.714631172309878e-01   +1.416860867585252e-01   -1.694252089475377e-01   +2.144416991360532e-01   -8.805957382786334e-03   +2.477787231094533e-01   -3.567326956343312e-01   -3.015367977164111e-01; -4.815259785497105e-01   -5.685248583792302e-01   +7.736828941777951e-02   +3.676883550804653e-01   -8.630591316105728e-01   -2.219060234402934e-01   -2.498655520777041e-01   -9.201999943831511e-02   -4.841489694763246e-01   +5.316051448406414e-02   -1.337046842203641e-01   +6.083645841120945e-01];
L3E_L3I_iGABA_netcon = [-2.795881453717841e-01   +2.088751139617695e-01   +1.005726737982522e-01   +3.747356881154320e-01   -4.175128264818306e-01   -2.818900380501334e-01   +7.093866740351268e-02   -2.032311985879416e-01   -7.571091328219537e-04   +2.026650776607650e-01   +7.345651133943640e-01   -3.402657858291468e-01; +3.572781688005955e-01   +2.324130170673582e-01   +2.266536943998586e-01   -1.345330821235433e-01   -4.563871006747634e-01   -2.721765833630330e-01   +4.171366456303618e-02   +2.502164386262067e-01   +4.314795785026001e-01   -6.625897324555846e-02   +3.399401634784500e-01   +4.279972892970330e-03; +8.088731939896038e-03   -1.992127999418964e-02   -3.266628909197595e-01   +1.634563858174296e-01   +1.547998627603846e-01   +3.278852435652636e-02   +7.088733322730978e-01   -1.765788103352494e-01   -6.664384427113897e-01   +1.308112197114722e-01   +6.038066311346622e-01   -9.317851239081378e-03; -3.086709787563044e-01   +5.135752144861893e-01   +6.248077287005220e-01   -8.729884369178989e-02   -2.906768510959005e-01   +1.543435675029654e-01   +3.008220726127636e-01   -1.331400232806161e-01   -2.215188387776606e-01   +2.504445687006517e-02   -3.224071105782129e-01   +2.111263263873084e-01; -2.974963976586819e-01   +1.343272270934499e-01   +4.625198967781732e-01   -3.533984092336240e-01   -6.202090570673178e-01   -2.099250443790922e-01   -6.121159895749737e-02   -2.131227305277477e-01   +4.941677963750618e-01   -8.561369321265070e-01   -3.862267633960772e-01   +6.784255191724347e-01; +3.257101840565926e-02   +1.113020045418076e-01   +2.068241141252486e-01   -1.519251114350781e-01   -1.979596462060212e-01   -4.508249531223590e-01   +3.345990807203886e-01   +4.289224014955742e-01   +4.578364000977792e-01   -1.874028770677643e-01   +6.317377621038722e-01   +1.791646776254960e-01; -9.907952825585123e-02   +4.550234555744820e-01   -3.132472637083206e-02   +2.558711685591295e-01   -2.354526500067893e-01   +2.544158766396364e-01   -3.099092437482726e-01   -3.859626214155693e-01   +2.189787658609985e-01   -1.727390424043529e-02   +1.767539870086137e-01   -1.677154985260359e-01; +2.775992884739923e-01   +1.919860252137975e-01   -4.795575647082691e-01   -3.702727345603665e-01   +2.016890926510849e-01   -2.628435654578607e-01   +9.681005658893749e-02   +3.416435047426839e-01   +5.472320302485292e-01   +2.986102897685160e-01   -1.048426699720827e-01   -2.151652736062091e-01; -2.912317140821969e-01   -3.394017094358737e-01   +2.098002129084636e-01   -3.417837620279572e-01   -6.110075140701663e-01   -4.490307883047800e-03   +1.049008802450158e-02   +2.050877049663226e-01   +4.607446048167332e-02   +9.850276704131678e-03   +1.505063182448402e-01   +2.391696243554437e-02; +3.181075460367577e-01   -8.743781175283155e-02   +2.762617375524183e-01   +5.693544921893078e-01   -2.608400718715984e-01   -4.461211229836216e-01   -1.621949194787607e-02   +7.010908453487241e-01   +6.899130556114494e-01   -5.685550966376897e-01   +5.089121028944883e-01   +3.742872982884493e-01; +2.709884630209433e-01   +2.752359507146153e-01   -2.101380567140580e-01   -7.368759822113870e-02   +4.516397174737157e-01   -3.203645721919571e-01   -1.247981982214550e-01   +6.518136531970072e-02   +2.793089557631681e-01   -6.737254754532538e-01   -7.651234592654474e-02   -5.812984529442981e-02; -7.786947013077483e-02   +2.110696565097542e-02   +1.636667030399223e-01   -2.794893423003209e-03   -1.999526231389376e-01   +1.427228800378407e-01   +2.189265024636445e-01   +4.668916728916889e-01   -2.844716158623034e-01   +2.486308941147458e-03   +1.141156154613140e-01   -5.992368406154185e-02];
L2E_Input1_iAMPA_netcon = [-8.283379214295177e-01   +3.042404554806175e-01   +4.658094512810992e-02   +3.823689669180310e-01   -3.534216601383539e-01   -6.360240354593705e-03   -7.553998830106280e-03   -4.564957062197923e-02];
L2I_Input2_iAMPA_netcon = [-2.457967604560405e-01   -1.695734955552274e-01   +1.728820883848687e-01   +3.507394158906068e-01   -2.279241954676015e-01   -2.770846558020448e-01   -4.876961557326799e-01   +3.916810261923883e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
