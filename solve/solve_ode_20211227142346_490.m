function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.366488992911881e-03   +5.525190261102594e-04   +4.385151521822370e-02   -7.673789115466878e-03   -3.072769975514246e-02   -1.220423775826085e-01   +3.080040190380768e-02   -5.912576322301302e-02   +6.651834100000333e-02   -3.727004632277070e-02   +3.857240974117308e-02   +9.445886878323272e-02   +4.199248732973475e-02   -4.522910734853826e-02   +3.509447270013073e-02   +1.080279002547313e-02; -5.444886542553074e-02   +4.984239677904545e-02   -4.480966253854669e-02   +6.267366241722086e-02   -5.356634533001249e-02   +7.420606214252091e-02   +2.576808916101076e-02   +1.884613640250641e-02   -9.356742368581800e-02   -1.857950298279270e-02   -3.624676526767898e-02   +7.416340879176249e-02   +4.417571998928532e-02   -1.234143065411413e-02   -7.083089959221532e-02   +7.680916022406707e-02; +1.835385535084115e-02   -9.903333817993945e-02   +4.228938623099571e-02   +9.336793647736112e-02   -2.968666065893122e-02   -5.682977552833597e-02   -1.294201358478286e-01   -1.057853132178981e-01   -8.529096285373228e-02   +3.263857773533421e-02   +5.304941061768358e-02   +1.844776352248752e-03   +9.512172910962148e-02   -6.048590562922185e-02   +1.151327458695936e-01   +5.681695590241667e-02; -1.164854983231755e-02   -6.467461284790688e-02   +1.564967582835508e-02   +5.545622368170557e-03   +1.578376731012298e-02   +6.751028458480260e-03   +4.978827598625884e-02   +2.817028927965008e-02   -1.239144251508427e-01   -6.969091791491656e-02   +2.784669910209899e-02   +6.759211679151629e-02   +9.391442747143373e-02   +1.365851623858132e-02   +4.510748519841961e-02   -1.401464644822047e-02; +3.339193069137396e-03   -1.701277493087153e-02   -6.271728462425233e-02   -2.555237582287500e-02   -1.234943342975725e-01   +1.006115700237593e-02   +8.526210386357370e-02   +1.004051673858391e-01   +1.049017910688601e-01   -9.663435852841749e-02   +5.368039286696430e-02   +7.355749423463627e-02   -2.908169413800442e-02   +6.525137154972872e-02   -1.588488804956226e-02   -4.963786743517718e-02; -1.053760538026799e-01   +1.160314154860326e-01   +9.410475723725860e-02   -7.818592220028987e-02   +5.816120382279812e-02   +6.451085830401825e-02   +4.876590930596215e-03   -4.319728766038318e-02   -1.254435679695588e-02   -2.061342145414770e-02   -2.304081318568812e-02   -1.588054112066414e-02   +1.113154742964946e-01   -6.054095158941697e-02   -1.095931424026960e-01   +6.838786242729329e-02; +1.003495785060980e-02   +1.092242712732325e-01   -1.412566485721204e-01   -1.206881602630507e-01   -6.238101137864488e-02   -5.520549284616708e-02   +1.183294468131728e-02   -3.690252485996515e-02   +6.111665586605924e-02   -1.928975768614093e-02   +3.274591870022310e-02   +6.285501206396119e-02   +7.858758478169624e-02   -6.969152879210169e-02   +9.205836135213957e-02   +1.041461169502897e-01; -2.045637436677760e-02   +1.463906548798232e-01   +1.328869104571423e-01   -9.424979164003612e-02   -3.666138928450997e-02   -6.610095310016120e-02   +7.630765521843538e-02   +6.062630457072683e-02   -4.492332919127225e-02   -3.255926992673653e-03   +8.611504301599628e-02   -7.629562437790344e-02   +5.473138304185732e-02   +2.899835055975223e-02   +4.492951794138166e-02   +3.014710232949213e-02; -6.723370624273906e-02   -8.523200876188430e-02   +9.795998393383921e-02   +8.628711291191126e-03   -2.700211156807596e-02   +2.882017800466644e-02   +1.071762763345261e-01   -5.010156599495101e-02   -7.122170372689633e-02   +1.190110020945158e-02   -4.290753286181490e-03   -2.582274106905603e-02   +1.197903699867560e-01   +8.270428099831217e-02   -2.810720866593855e-03   +3.490248928002032e-02; +3.426992196038771e-02   -4.926389447827006e-02   -4.790016552638235e-02   +1.193014121124647e-01   +1.629815092488879e-01   -1.813049351331084e-02   -4.342691220427714e-02   -6.654112729845947e-02   +2.914788246993815e-02   -1.740258664762196e-02   -8.712203396318453e-02   +4.782282328119292e-02   +8.758726018473460e-02   +1.017536354549039e-01   -4.858628603043823e-02   -1.255053302806392e-01; +1.026440277378532e-01   -1.825551382640460e-02   -3.744081850619998e-02   -6.157615164206143e-03   +2.244878989382706e-02   +1.339954981371681e-01   -3.522752170616754e-02   -2.668493772023224e-02   +1.001262975823639e-01   -8.162667730617056e-02   +4.316973054919247e-02   -2.583243649949202e-02   -1.071818918733081e-01   -5.849608990029347e-02   -1.307262020809550e-01   +9.554153852207314e-03; +2.249392021072901e-02   -1.431013833898661e-01   +6.266253036404101e-03   +1.139992886247467e-02   -4.684853661010099e-02   -1.160390264081998e-02   +7.444831385326065e-03   +7.540330290689974e-02   -8.365026691347237e-02   +6.864859739079870e-02   +5.754455159803386e-02   +4.939162739217980e-02   -4.314722192631168e-02   +3.468837957433991e-03   +6.859996956114883e-02   +1.366572068302439e-02; +9.939186708561622e-04   -3.336531004760894e-02   +1.403520590270713e-02   -1.106925773362846e-02   +4.308265845852643e-04   -6.399638055965386e-02   +9.329069677661012e-02   -1.026585358403829e-01   +1.644996760852754e-02   -9.305423790721311e-02   +3.066634313708963e-02   +5.613902668629497e-02   +3.626337888381286e-02   +6.227215176066715e-02   -4.736962585267383e-02   -4.394169660452476e-02; +1.541144561565023e-02   -1.213889366683490e-03   -3.431170237123850e-02   -2.449125964029822e-02   +9.768299602720346e-02   -1.166518346871349e-01   +1.075690622010850e-01   +4.320412748429573e-02   +5.282501623863747e-02   -3.762650926418227e-03   -2.499712913279664e-02   -9.246252622801301e-02   -6.029610900877931e-02   -1.079711746231348e-01   +1.174159870411413e-01   -2.262105905528870e-02; -1.251484265482914e-03   -6.090608071278681e-02   -1.061320608649600e-02   +5.353636253160045e-02   +7.686114650186167e-02   -9.698634310732121e-02   +6.612300438360483e-02   +8.283625618461096e-02   -3.407772624843507e-02   +6.758211563571524e-02   +3.119755546834609e-02   -1.184903286860943e-02   +2.879874366459165e-02   -1.098238173160429e-01   -1.095436876399613e-01   -1.830882282960603e-01; -5.812402372165352e-02   +3.826551404788817e-02   +5.039944185165049e-03   -8.541003045118310e-02   -1.199297529227849e-01   -4.274850992776278e-02   -6.870455558225308e-02   -1.150344081351065e-01   -3.094952650134739e-02   -2.984726316871881e-02   -1.040971065896522e-01   +4.684416565628064e-02   -3.413832665402681e-02   -4.346043722281084e-02   -9.640152879917169e-02   +6.713727948848516e-02];
L1E_L1I_iGABA_netcon = [-5.559557103775133e-02   +4.118522424603602e-02   -3.706437155447104e-02   +1.595081543016284e-01   -3.538575662454550e-02   -9.308631011534474e-02   -1.540469265790847e-01   -4.514239289165946e-02   +6.281815561902039e-02   -6.575267719416696e-02   -5.587475380710231e-02   -1.223065904390027e-01   +3.108600162688002e-02   -5.445806234313495e-02   -2.192934674662035e-02   -1.086134794863417e-01; -2.095795058314243e-03   -8.107846133864912e-03   +5.671053762618343e-04   +3.962941802775596e-02   +1.823647330434255e-01   -8.433306623061544e-02   -1.021401242781076e-01   -6.923123316467623e-02   +2.221557865208605e-02   -7.448237478326762e-02   -5.159056583837720e-02   +2.087174617062285e-02   +1.653470177474576e-02   +2.900141234625336e-02   -2.543312407674173e-02   -2.936840404126918e-02; -2.405281164429907e-02   +1.395238423859312e-01   +1.582072680733183e-02   +5.480589664231689e-02   -7.424433427310111e-02   +8.600118289987829e-02   -5.316595057010347e-02   +1.032223666737668e-01   -9.243533821218519e-02   -7.495757684724158e-02   +9.164980423599617e-02   -1.574065122715961e-01   +5.230766212113504e-02   +1.578599935551581e-02   +4.771366450019372e-02   +5.656891048064339e-02; +4.066014909087395e-02   -1.126756951488652e-02   +1.060090469438808e-02   -5.558676721443202e-02   -1.903411740537493e-03   -2.149579221450212e-02   -2.375297434700673e-02   +3.380576166883346e-02   -6.862813535248398e-02   +8.029617624283208e-03   +1.727575234123070e-01   +1.046020918270597e-02   -1.073510088152253e-01   -1.145247767803949e-02   -8.289364339384608e-03   -5.652627840408958e-02; -1.472245627009677e-01   -3.856743373230283e-02   -8.416130984229336e-02   -6.130766042509132e-02   +3.932326926512620e-02   +6.926867857312981e-02   +9.945377857534518e-02   +1.685024585597615e-01   +1.444480741764524e-01   +6.350500515370535e-03   -5.439048298246883e-02   +3.008822020780773e-03   +1.057546883411287e-01   +6.920199526983081e-02   -2.615319096000993e-02   +3.818821501598388e-02; +1.454501972615966e-01   +1.519596475072667e-02   +7.161474925111143e-02   +4.257451738355263e-02   -1.302132701890303e-02   -8.333139991165767e-03   +2.850445081283699e-02   -7.879124381903301e-02   -2.702553853481926e-02   -1.637468005574732e-01   +2.269705729727053e-02   -3.812025550394939e-02   +3.498119562778741e-02   +1.197582148264584e-02   +9.927132016658728e-02   -1.332115572753045e-02; +2.133472229773066e-02   -2.264771684264393e-02   -1.444321209331574e-01   +6.201729745717922e-02   -9.527822642702465e-02   +2.023533618557425e-01   -2.297858273688377e-03   +8.344003980512980e-02   -6.283762122624029e-02   +7.451106031425167e-02   +2.344714023865789e-03   +5.706969361517588e-02   -2.819606459878655e-02   -7.218053529536581e-02   -3.147834078119455e-02   +5.761168166452266e-02; +3.381757631565474e-02   -7.794298340681960e-02   -2.603424974785924e-02   -3.900591291997332e-02   -7.357265248996159e-02   -9.184686996852892e-02   +4.573085951242830e-02   +5.008907142726639e-02   -2.238741827323478e-02   +2.568859756807495e-02   -3.864659323927769e-03   +2.442441589818918e-02   -3.476498139534886e-02   +5.410000346395713e-02   +7.651027306988469e-02   +1.210989892332547e-01; -5.624766325317594e-02   -2.781942220199910e-02   +1.184722337210528e-01   +7.297985626284562e-02   +9.239767179287701e-02   -4.892152554993203e-02   +3.550549633447255e-02   +2.987919236944983e-02   -9.933076229658547e-02   -1.185951270858177e-01   -2.715456997757047e-02   -1.974810004628815e-02   +7.890323299393548e-02   +9.911935270669318e-02   +1.189266992708642e-01   +1.769313335651474e-02; -4.965953206223303e-02   -7.050318918802927e-02   -8.486666479959767e-02   +1.320273172389315e-01   -7.868881706886845e-02   +1.296463780852988e-01   -4.380507529538519e-02   +2.294191497964602e-02   -8.857719977142098e-02   -3.703469599750902e-02   -9.197348066689898e-02   -5.349435153202286e-02   +1.432140306872680e-02   +5.201569605271812e-02   -5.281102111966597e-03   -7.661748907474672e-02; -1.487421895699957e-01   -1.359154087705455e-01   -3.596598317686418e-02   -1.092538263878670e-01   -8.317760892426433e-02   -1.326853111721856e-01   -2.798402863272462e-02   -7.348475336956431e-02   +1.831073660974389e-02   -7.983193683304460e-02   +1.302789489085074e-02   -4.764493166042141e-02   +1.756276641198395e-02   +3.967303495889934e-02   -3.219820196166860e-03   +5.968753681242389e-03; -5.527678459082451e-02   +1.267697183424187e-01   -2.536163938690780e-02   -5.477450896814572e-02   +2.247871243090786e-02   +8.301618496092324e-03   -6.935728743458500e-02   -6.182537591146993e-02   +1.256235002474606e-01   -2.932156189117367e-02   -1.028754449674819e-01   -1.231456085456746e-01   +4.163776491018299e-02   -1.917223387812088e-02   -1.082575860265124e-02   +6.800780197641776e-02; -2.081985390755587e-02   -2.288676295716891e-02   +5.556842544215882e-03   +7.034983620437182e-02   +2.799609362850723e-02   +1.022991623848570e-01   -1.180802347917467e-01   +5.609972867614973e-03   -8.506574987050573e-02   -1.001507501452764e-02   +3.553460547008330e-02   -3.722933201122682e-02   -1.360225656601693e-01   -5.027248829461169e-02   -1.088346097599415e-01   -4.962608568363922e-03; +1.783781742503845e-02   -7.130369790441833e-02   +4.584835270650894e-02   +4.750351525007161e-02   -1.281620584300406e-01   -6.412019141280322e-02   -1.514228825190912e-02   -7.705369203531588e-02   +7.682175332979647e-02   -3.693755722055022e-02   -1.357019333025332e-01   +8.172874741574236e-02   +3.415624688489986e-02   -2.064414485965778e-02   +6.385645141930924e-03   +8.763538466041809e-02; -7.106697946879544e-02   -1.281742374451628e-01   +1.877825895752488e-02   +4.250121914601751e-02   +2.045879045168254e-02   +1.478877249940641e-02   +1.150564743205229e-01   -6.028908464009408e-02   +8.950608750333237e-02   +3.619512873610786e-02   -2.396086431866818e-02   +2.578697435763675e-03   +9.301056604285063e-02   -1.110150776710206e-01   -7.386298398357256e-03   -1.357056856958470e-01; +4.901126319734984e-02   +1.262314524568141e-01   +1.621892200073021e-01   -7.496817665018773e-02   +5.626809799610022e-02   -1.197789525599940e-01   -2.409706857625552e-02   -1.571445275585578e-02   -6.860209145237967e-02   -3.378082560242789e-02   -1.154762607529468e-02   -7.314576586781601e-02   -4.353795909224003e-02   -2.054487974403462e-02   -6.251478576003326e-02   +1.620114773345667e-02];
L2I_L1I_iGABA_netcon = [-1.959824552587016e-02   -4.269968308428631e-02   -5.936456768199274e-02   -1.270464562143964e-01   -6.729193759912261e-02   -5.159775989113666e-04   +6.976845868586060e-02   -8.622967865025481e-02; -4.622370826518724e-02   -3.888063500042953e-02   -2.988982559793167e-02   -2.851278428425487e-02   +9.247728572435984e-03   -9.245885918612314e-03   +1.769347709834811e-02   -1.343143236353023e-02; -1.087880016935471e-01   +4.139379970879193e-02   -7.205105593345607e-02   -2.711007542970313e-02   +1.998857731683586e-01   -5.168388222065932e-02   -4.658016241919937e-02   -1.146289718105880e-01; -1.105188827393694e-01   +7.393833720912540e-02   -2.004326422869728e-01   -2.668088318811344e-03   +1.588771014735960e-04   -1.144337382850063e-02   -4.771780895033748e-02   -6.363951292341750e-02; -8.817336125238326e-02   +6.508430228915093e-03   -7.287640360308774e-02   +9.023317194577650e-02   +3.330085160085027e-02   +8.570809340759532e-02   -8.536943042888956e-02   +1.029364763618071e-01; +1.088835281937013e-01   +4.201314762195350e-02   +6.307370470865996e-02   -3.832770669120172e-02   +1.030338993119198e-01   +7.549893456148551e-02   -9.836093721577567e-02   +8.311677965389466e-03; -6.848632119663124e-02   +8.441292313790588e-02   -1.254187097715365e-01   +7.242759393301850e-03   -1.453915593143677e-03   +5.610638552370156e-02   +4.960066078078657e-02   +4.437617984772052e-02; -2.939860617598516e-03   -6.542163843741684e-02   -1.411781573048798e-01   +5.247358107569295e-02   +3.940038988758869e-02   +2.625415702145639e-02   -8.876507089895945e-02   +8.741799411579768e-02; -1.292932216788091e-01   -7.863169435056880e-02   +6.599594351576892e-02   +7.182074641899304e-02   -3.023984967137617e-02   +3.018235505018449e-02   +9.981474696389465e-02   +1.371211435986520e-01; +6.392739013803983e-03   -4.540293778035851e-02   +3.058296055373133e-02   -5.420645843447677e-02   -8.002760872239480e-02   +9.389708605272561e-02   +5.331426829984078e-02   -1.145832699086365e-01; -8.344701324721075e-02   +7.634224979632742e-02   +1.461787396665137e-02   +1.751067291449348e-01   -9.699923632082359e-02   -1.115909749793041e-01   +3.705540395852355e-02   +8.359648503088718e-02; +7.244570469212198e-02   +5.117002291769467e-02   -5.455021763371531e-02   -3.227975859143370e-02   -7.192958493234562e-02   +9.131915668734165e-02   -5.480978412491106e-02   +6.425614923022817e-02; -7.869130402679102e-02   +3.233529761525936e-02   -4.503343812477952e-02   +9.487167442302522e-03   -3.249545874106636e-02   +1.099383149024008e-01   -1.500113627512008e-02   -5.688468490579506e-02; +1.138807621233885e-01   -6.702315985083808e-02   +5.431282339953090e-02   +1.279174722223080e-01   -1.000843724303822e-01   +5.219206582866414e-02   -8.520451722752810e-02   +4.874841106306675e-02; -4.237591701937965e-02   -7.996058692432828e-02   +6.800471223512662e-02   -6.179384842374441e-02   +7.762771898723218e-03   +1.140292843450386e-01   -4.372350333496493e-02   -1.356552714810726e-02; -1.591247085300181e-01   +3.685857897816629e-02   -6.764826507733604e-02   -3.846064333173822e-02   -4.174191051318789e-03   +4.909269578851930e-03   -4.052556331389187e-03   -7.321744258708268e-04];
L1I_L2I_iGABA_netcon = [-1.309745911369471e-02   -6.125587748854897e-02   +3.556039494281732e-02   +4.401885832873585e-03   -1.446362616459769e-01   +2.887564200108915e-02   -4.089121234886188e-03   +1.224568121097104e-01   +8.918468450929640e-02   -1.961629648306772e-02   +2.997325229627050e-02   +2.714472705422888e-02   -2.978637149882240e-02   +5.062573740770384e-02   -8.310994461041554e-02   +7.352265196173879e-03; -1.540171823893212e-01   +4.535011113924413e-02   -6.105584399508372e-03   -1.033191592482281e-02   -6.648450275508409e-02   -1.107615945600113e-01   -5.615174711543947e-02   +1.639723440403333e-01   -4.489664974436267e-02   -3.093541034552907e-03   -8.165031840476827e-02   -1.693673338129595e-01   +1.903378987265374e-03   -1.019249184289795e-02   -6.141018703465856e-02   +6.672816536369788e-02; +2.428075297373946e-02   +3.306551125333073e-02   -2.510563568102407e-02   -7.064731084003184e-02   +4.052935563902341e-02   +1.979627912503799e-02   -3.403710174839363e-02   -2.250193985806397e-04   +4.765422763289813e-03   -8.879375233772495e-02   -1.689415332403968e-02   +5.444119369523226e-02   -3.468620078001330e-02   +1.150747825060061e-01   -7.833053377072435e-02   -1.816536376513554e-02; -4.949921419400253e-02   -1.187648304782964e-01   +9.750012994465601e-03   +5.449630612975244e-02   -9.743461342376156e-02   +5.947231032422698e-02   -9.173026036482039e-02   -3.256157097080954e-03   -1.185663292590864e-02   -1.234331526189003e-01   -8.066335129561747e-02   +4.953583346153650e-02   -6.776689564502084e-02   -3.565043276262417e-02   +5.552494664609898e-02   -1.665464704452977e-01; +8.122866725573022e-02   -4.611980714235128e-02   +3.919467814359497e-02   -3.736399175354616e-02   +5.027659439260490e-02   +8.995426294922568e-02   +9.769884045480855e-03   -3.528024850560133e-02   -6.272007599496994e-02   +3.730854287193006e-02   -1.783359931133100e-02   -5.194817501770563e-02   +3.667270295206457e-02   +4.497776078798849e-02   +3.973132199479810e-02   -1.307354386351514e-02; -1.586555748976968e-01   -3.821974069265554e-02   +1.464397984865727e-02   +8.216417254130179e-02   -5.284251545732862e-02   +9.227065548128713e-02   -3.983822366224190e-02   +7.566000925008760e-02   -9.763598450336056e-02   +2.952749652493320e-02   +3.414537574674301e-02   -1.635207444446419e-02   +3.438897019934919e-02   +6.637532435903093e-02   -9.270950503782699e-02   -1.435380021680607e-01; -7.464252182045079e-02   +2.186805950134369e-02   -2.950410408677864e-02   -9.339888433364479e-02   +1.629737485478386e-01   +1.251252939027852e-01   +1.412576977593050e-02   +1.621904314139950e-01   -5.152677287578381e-02   -1.325698740593609e-01   -3.187602790883707e-02   +1.083258312474946e-01   +6.273771076397100e-02   -3.297130721007913e-03   +7.945679558675234e-02   +2.944547004058624e-02; +7.047013825055612e-02   -1.193195784368473e-01   +2.591842415338940e-02   -1.450751569322981e-02   -3.076053403172682e-02   -1.796087520003307e-02   +5.953049462739782e-02   -6.765343311977466e-03   +2.894055187352432e-02   +1.068990705501460e-01   -4.997642386037434e-02   +4.027761674480889e-03   -6.768272069522525e-02   -7.767608744367660e-03   +2.490564726338628e-03   -7.770410636329889e-02];
L2E_L1E_iAMPA_netcon = [-1.287915027802951e-01   +4.724383874901323e-02   -3.549089667411444e-02   +5.459587968607541e-02   -1.280229080844087e-03   -1.564510733937232e-01   +3.113541075552360e-02   +7.528706268255372e-02; -3.160708009440103e-02   -4.133204912620640e-02   -6.629069525408679e-02   +3.142356086429533e-02   -2.780226070418434e-02   -7.700130290762619e-02   +7.335029343343444e-02   +2.629760315045261e-02; +9.420124087020626e-02   -1.110747005687086e-01   -1.305464282668228e-01   -1.882287145268326e-02   -4.685476655786821e-02   -6.748976174409514e-02   +7.864911515935410e-02   +4.500329174437820e-02; +7.666226069718771e-02   +8.339328706602069e-02   +1.883929724257686e-02   +3.354309407492313e-03   -6.955858706091886e-02   +9.576654659527484e-02   -2.914348572771757e-02   +1.504599198884936e-02; +4.947784783263775e-02   +6.375883197012491e-02   +1.960622228111640e-02   -5.043714708144054e-02   -7.886524300337744e-02   -4.640927746222669e-02   +9.276283543870524e-02   -4.574417809002115e-02; +7.556647268744437e-02   -8.597572797586540e-02   +7.023276238342938e-03   -8.373139584611855e-02   -6.463738215815136e-02   -3.589431951941267e-02   +1.410228003545080e-02   +1.322317222075744e-01; +3.200012091626361e-02   -1.275188884167338e-02   -6.850649338834863e-02   -5.326531959808042e-02   +2.887171291210852e-02   -4.977726023401692e-02   -2.849751298046078e-02   +1.243898393489841e-01; +8.760493117811199e-02   +4.457631204876981e-02   +3.003646358640576e-02   +3.810440451056401e-02   +5.318001538656614e-02   -5.830705831133957e-02   +1.197524960164703e-01   +3.861909337492392e-02; +3.453399101724439e-02   -1.904690265062860e-01   -5.501458120063393e-02   -1.571774906276153e-03   +6.980204779866314e-02   +8.112545052810258e-03   +5.725856930324424e-02   -1.305885197620427e-01; +1.017198399260895e-01   -8.221753820109461e-02   -3.093764964040660e-02   -1.964176517755151e-02   +4.385449202481004e-02   +9.794196832703043e-03   -3.926125222809091e-03   -4.196207960098099e-02; +6.294624167727710e-02   -2.740976556555610e-02   -3.579766840727429e-02   -6.901305172591374e-02   +1.355296318273727e-01   -8.000263952287220e-02   +4.875779933427917e-03   +3.553274834966363e-02; +5.130801127442405e-03   +2.110452709052626e-04   -4.765795329618348e-04   -8.251818978608658e-02   -1.383864457155587e-01   +2.789834215755461e-02   -3.663450208413559e-02   -1.174687520040647e-01; +3.781333916015119e-02   +6.103371882376181e-03   +1.084295793993355e-02   -1.324842248045829e-01   -3.748200214941862e-02   -1.676874726928416e-03   -2.317646685059315e-02   +1.054089602037392e-01; -9.491221835624201e-02   +4.995426535091788e-02   -8.637870203099460e-02   -8.750903948549288e-02   +4.744460723414844e-02   -6.313615318919767e-02   -2.201704320183917e-02   -9.120063233854292e-02; +1.334466244189500e-02   +4.782486187327377e-02   +2.372987124053171e-02   +3.083814239015785e-02   +5.604721647582232e-02   -6.531678316196209e-02   -4.332091312070664e-04   +3.169114362497077e-02; -1.039326697449302e-01   -1.435745802187343e-02   -2.851989464777828e-02   +1.948723650204115e-02   -2.278070368726618e-02   +1.588626509897337e-01   +3.988903445300723e-02   -7.384364689037747e-02];
L1E_L2E_iAMPA_netcon = [-5.083389382697771e-02   +7.942259985858595e-02   -9.488572172299228e-02   -2.330196021972473e-02   +3.645475117692458e-02   +1.002500877631563e-01   -1.283125026471852e-02   -1.489870622717075e-03   -9.492870679407078e-02   +1.683533216678984e-02   +1.544852288464497e-01   -5.642230217967890e-02   +5.206374319528530e-03   -5.063356566322151e-02   +3.280044192798063e-02   -1.074899157883011e-01; -4.114925785252299e-02   -9.367220250544718e-03   -5.176631793229880e-02   +7.721320735342933e-02   +1.514772778868814e-01   -1.441718940153838e-02   +1.218098040164061e-02   +5.656316782973245e-02   +3.870849363344080e-02   -5.853053462034971e-02   +1.175514819659843e-02   +3.747292238620197e-02   +7.586269891982782e-03   -5.129163143697348e-02   -1.029706326010895e-01   -1.148981446904397e-01; -2.220306268780379e-02   +4.083352292210491e-02   +9.027624947254569e-02   +3.396007614688987e-02   -2.872260065007676e-02   -7.179000336514332e-03   +9.507792771082262e-03   -4.473982840458522e-02   -1.072273346095555e-01   -6.378013433854358e-02   +6.375214830140029e-02   -8.090612794425878e-02   +1.235175203204481e-02   +1.716939400349977e-01   +2.080947974815506e-02   -9.077347644794841e-02; +1.176638970865463e-01   -5.714139124150862e-02   -4.120487532643544e-02   +6.143263165311447e-02   -5.471117585421843e-02   +1.359821863920953e-02   -6.637325785377837e-03   -1.257448717145206e-01   -8.596579355972548e-03   -7.010176284604351e-02   -2.712736310408607e-02   +6.139700188677912e-02   +5.262519942653340e-04   +1.678124589110743e-02   -7.933602827533535e-02   +2.325031951226123e-02; +1.939764229119621e-01   -9.706996423808298e-02   +5.453408539590599e-03   -1.991465370091988e-02   +8.936367620677220e-04   +2.561178022963307e-02   -7.956418948663395e-02   -3.872245572777572e-04   +2.842926472485258e-02   -1.602682426118554e-02   +1.144809676559825e-01   -6.752806880159580e-02   -5.958021037687832e-02   +2.567083689034817e-02   +6.371538488588672e-02   -5.686281096264074e-02; +5.548776714420118e-02   -6.474335273508607e-02   +3.520343764607207e-02   +8.444294602917611e-02   -1.898776999051182e-02   +1.291517855566717e-01   +2.972961811526886e-02   -5.871325167360756e-02   -1.384307113825730e-01   -3.497879386242685e-02   -1.035515398919114e-01   +8.066405462022953e-02   +8.847871693214110e-02   -5.738657706689597e-03   +1.054747997445933e-01   -3.038041995792276e-02; -2.847063666803575e-02   +3.995680834739417e-02   +4.534636865501876e-02   -1.902438222823034e-02   -7.157444937029990e-02   +2.420599775303816e-02   -9.882741836607618e-02   -7.043985711252045e-02   -1.863555475223788e-02   -8.382941653642198e-02   +8.152571618323713e-02   -5.133816151029195e-02   +2.234029242584367e-02   +6.827950957790041e-02   -2.880899384548753e-02   -1.369442167749788e-02; -1.054941690581720e-01   -5.128228360356708e-02   +1.553280735138838e-02   -4.595228726431601e-02   -1.626155978283835e-02   -6.461851301296584e-02   +2.234166277147579e-02   +1.706551935462462e-02   -5.357970446891987e-02   +5.092181111401758e-02   +1.080869269945694e-01   +7.311408636822558e-02   +3.530966899917094e-02   -7.823132711000129e-02   +8.967874187618120e-03   +1.390927643976427e-01];
L2I_L2E_iAMPA_netcon = [+1.548425053021574e-01   -7.286069734668847e-02   -7.755747987981645e-03   -7.655149889774826e-02   +3.542600813126030e-02   +4.813811301408182e-02   +1.203066001869064e-02   -7.294519703165148e-02; -2.992666713476099e-02   -2.556450485989861e-02   -7.651229085667199e-02   +1.023510362393754e-01   -9.011350506819259e-02   -1.950515610228631e-02   +1.715862665104018e-02   +3.283957903971812e-02; -4.510216341698391e-02   +3.913128033228631e-02   -6.846259808057899e-02   -1.622723026184914e-02   -1.123868710465750e-01   +6.833352748756853e-02   -3.347816820153051e-03   -1.498480720609784e-02; +5.374040916928361e-02   -5.750640266334802e-02   +6.615721519403922e-03   +8.948109447222369e-02   -8.491873450525843e-02   +7.458624742051914e-02   +8.490888069136778e-03   -5.033906464924490e-02; -3.585893218126036e-02   +9.034654806160168e-02   +2.701213342549122e-02   -1.920148279178025e-02   +1.569469574749037e-02   +1.013151930251679e-01   +1.267219741458705e-01   +1.085372670504086e-01; +2.668078115520078e-02   -9.497686179769900e-02   -7.497838968052317e-02   +1.331956477783116e-01   +6.451568765724668e-02   -7.354309242893478e-02   -1.212235901424877e-01   -5.362603491080575e-02; -9.812955768382081e-02   +6.818494125424718e-02   +2.629516416222821e-02   -1.354387861142182e-02   -8.250015141078931e-02   +8.406550825691091e-02   -4.048241677579398e-02   -7.639773812884325e-03; -6.780321443116827e-02   -4.812424397129293e-02   +5.903694548491598e-02   -1.304723601647352e-02   +9.340175467586499e-02   -8.178330805460232e-02   -8.486273159575761e-02   +8.264222019692718e-03];
L2E_L2I_iGABA_netcon = [-2.566066623111558e-02   -7.455298820797197e-02   +1.484059904937289e-03   +1.253270542570347e-01   -2.746658461290374e-02   -8.322567116836321e-03   +1.911753557042847e-02   -3.922582688848320e-03; +9.255508473587837e-02   -1.021308898679166e-01   +1.328630966171508e-01   -6.504401732275445e-03   +9.489780955554489e-02   -1.995577955467400e-02   +3.864389867349411e-02   +1.154844491691216e-01; -1.357826287507407e-01   +1.758218144181728e-01   -2.932107394790932e-02   +8.236393442657379e-02   +7.586527600689015e-02   -4.126555613676217e-02   +9.361799792185700e-02   -5.840080641728452e-02; +9.230694493974034e-02   +4.833197130242710e-03   +7.315893839740371e-02   -7.884655257096725e-02   +4.918666838279357e-02   -1.037360440048645e-01   +2.883306119242288e-02   -3.471277576219032e-02; -9.515916724200160e-02   -5.380443232914436e-02   -4.691266220743259e-02   -9.237755004853528e-03   -4.321913395365989e-02   -3.280069383772807e-02   -1.219061766556347e-02   +2.521551583131673e-02; +3.162883550561622e-02   -1.331859950841040e-01   +7.961249853926083e-02   +5.546919960846695e-02   -1.787373910569654e-02   +1.753582604035743e-02   +3.921805473707900e-04   -2.154560814363272e-02; +9.036027055247788e-03   -3.506357958373880e-02   +7.579146335670896e-02   +1.648737851524365e-01   -2.497296020082535e-02   +8.656275208342153e-02   +8.128069403218217e-02   +6.351507738067365e-02; -6.943864221768772e-02   +1.676642103112804e-01   +3.354770907426972e-02   +1.104461024062973e-02   -6.078828628172080e-02   -4.724352892698931e-02   -4.474798712428248e-02   -1.913702362543161e-03];
L3E_L2E_iAMPA_netcon = [-5.319957383718003e-02   +4.258232743605934e-02   +8.735687489306081e-03   -3.922258540756030e-02   +1.291920928327603e-01   +3.049928220446609e-02   -5.227809464355686e-02   -5.235077393443635e-03   -9.359596627961864e-02   -3.726227342608191e-02   +7.965469074260853e-02   +7.299900972820791e-02; +1.493892162283039e-02   +3.878370982655240e-03   +7.961689665209430e-02   -3.462194281241368e-02   +5.890062681414442e-02   -7.419765661450048e-02   +2.490014625525501e-03   +1.317102490018722e-02   +1.115429473283182e-01   +2.062825077077700e-02   -2.925381781243699e-02   -9.835491359183268e-02; +7.339854683343092e-02   -1.404653926536072e-02   -7.793217621563993e-02   -2.407255579933931e-02   +7.154893667524362e-02   -5.678437486791029e-03   -1.348876050543434e-02   -6.527077828705594e-02   -8.723774998228727e-02   -2.995717905249231e-02   -1.312436500106207e-01   -4.090770923846613e-02; +2.696222527352631e-02   -1.631500792116189e-02   +7.656935744841911e-02   -3.244436265357301e-02   +2.239987645092188e-02   +7.997589162524840e-02   +2.370083006444145e-03   +9.408702165827224e-02   -3.583875384223445e-02   +1.098206101789801e-01   -1.542903549404712e-02   +2.402827710878480e-02; +8.574034874663758e-02   +4.722567278185723e-02   -4.224670722177652e-02   -3.861224407195010e-02   +4.470275040241833e-03   +3.174011682448978e-03   -8.053598114060671e-03   -9.402775961487617e-02   +6.771545924959814e-02   +3.123168270888961e-02   +5.948334580091270e-02   +7.039581460426653e-03; -1.191196088569768e-01   +7.680945059345171e-02   -1.576116939291258e-02   +8.161522426796496e-02   +5.690301191452174e-02   +1.086377461023569e-01   +3.765837807857050e-04   -2.004356935477748e-02   +1.015196690633569e-03   +3.869963866776491e-02   +1.174085863149698e-01   -7.642230075551171e-02; -4.519632084828856e-02   -6.777466208406425e-02   +1.304098463246635e-02   -7.312813768024884e-02   +8.983719482365067e-02   -9.439501059669220e-02   +7.621300357871093e-02   -1.745104827226440e-03   -6.748915838949249e-02   +5.017309308679486e-02   +2.324530495095918e-02   +7.013455021417883e-02; -1.312892286977820e-01   -1.167834701230011e-01   -4.302984538987234e-03   +4.179632404649283e-02   +2.177223846663836e-02   +2.301015954358839e-02   +7.741360767059655e-02   +8.724964018536484e-02   +4.133621764929005e-02   -1.999113789988917e-02   +2.609428444499935e-03   -8.006701437971529e-02];
L3I_L2I_iGABA_netcon = [+8.208401993070169e-02   -6.832678629216342e-02   +1.966393069052078e-03   -1.216422422181374e-02   -3.800289053113143e-02   -3.369683221200144e-03   +7.060461290628231e-02   -1.080142818149696e-02   +1.208309800014951e-02   -1.130050523556976e-01   +9.150972326897289e-02   -2.351175981868198e-02; +7.725886659238394e-02   +5.457716129343299e-02   +3.099850907481806e-02   -5.046022478463679e-02   -1.795215566489589e-02   -3.567255542282520e-02   +8.066222602284126e-02   +8.373288297747450e-02   +5.087089266161291e-02   +1.722250788145386e-02   +5.966036228989210e-02   +2.850162763973037e-02; -7.617182321059295e-02   -1.230300373453325e-01   +5.900581014576152e-02   +1.113834849816783e-01   +9.712800405270530e-02   -7.869265778657802e-03   +4.857684752734551e-02   -7.354901957957279e-02   +7.523863327225397e-02   -6.988191420876586e-02   +6.882630781560491e-02   +4.741295811775303e-02; -6.268853005288109e-02   +1.165407268043780e-01   +2.201037082991192e-02   -1.382198513755537e-03   +4.792182162232338e-02   -7.874095214664334e-02   +7.632921288016688e-02   +2.914515140879956e-02   +4.005957418414745e-02   -6.369409080068376e-02   +8.661267938345782e-02   +1.353363732266225e-02; +7.308143820134422e-02   +2.601071095872701e-02   +9.902698657166564e-02   -1.361626440211447e-02   -4.629076378532949e-02   +1.230624240633982e-01   -3.649527551680436e-02   +2.659844969323650e-02   -7.379272848541539e-02   +5.101013555076092e-02   -1.671872747380750e-02   +6.587181579777336e-02; +4.624547732607270e-02   -1.178884917387991e-01   -1.195899601812756e-01   +7.407284072145429e-03   -1.123207845151573e-01   -1.107403788390773e-01   -3.395315434830765e-02   +6.001691272018211e-02   -1.068939860581590e-01   -7.510572274509777e-02   +1.246870646922128e-03   +1.054739293046994e-01; -1.182309732413461e-02   +6.752458841398863e-02   -6.846897434090209e-02   -4.630666349449963e-02   -1.221814363050174e-01   -2.202888638524618e-02   -4.846573513852123e-02   -3.820979099396384e-02   -2.759422123166238e-02   -8.853701021513355e-02   -1.046123448433622e-01   +5.213328670124402e-02; -5.543549021587119e-02   +5.928692536416146e-02   -4.197847775521200e-02   -4.188650682047793e-02   +1.003014194576217e-02   +1.526338981364504e-02   +3.418734942466869e-02   +1.227869083446093e-01   -1.049932624897518e-01   -5.937374749503559e-02   +1.141798163310841e-01   -3.150488526191981e-02];
L2E_L3E_iAMPA_netcon = [+1.011139889912502e-01   +2.048206137952395e-03   -1.279403698632503e-01   -1.401938042051800e-03   +3.931071479854633e-02   -6.000593480613869e-02   -1.414796960975089e-01   +4.595748846011467e-02; +5.514802302284599e-02   -7.354916407249479e-02   -2.778420404544063e-02   -1.174763709873694e-01   -3.764431951722400e-02   -5.951004058982315e-03   -2.480935207612849e-02   +1.592338627007205e-01; -9.282418506419932e-02   +1.155559540313509e-01   +8.486956369032001e-03   -4.319237541515587e-02   +2.748775139495570e-02   -2.934313493147476e-02   +4.428149818176005e-02   +8.420574095507684e-02; +1.204734633652914e-01   +1.715678362405379e-01   +3.964511254559997e-04   -2.925450582942768e-02   +3.626469472693874e-03   -4.056151901325045e-02   +3.495206471780020e-02   +7.084595417830311e-02; -5.724717195375666e-02   +8.903911680799609e-02   -3.067595567110201e-02   +5.481277994499216e-02   -2.850329435740290e-03   -4.828147562278598e-02   -1.308872826224599e-01   -6.167330310705961e-04; +2.085097521705420e-03   -8.521911996327876e-02   +5.178336202444851e-02   +8.594709511773166e-02   +6.687897944099505e-02   -1.350307584296463e-02   -5.279287656121458e-02   +1.113967071298242e-01; -3.889130469304307e-02   -6.694922493080815e-02   +7.964656324750546e-02   +7.938332991998688e-02   +1.616597104364351e-02   +8.736076294051003e-03   -4.998041172827716e-02   +6.006889480661802e-02; -2.648171531444169e-02   +7.745811090369892e-02   -2.532010471427648e-03   +3.211151779129645e-02   +1.688648451839985e-02   -7.448084142923822e-02   +2.398534544892531e-02   +1.067024378941211e-01; +5.459594156272710e-02   -7.515329844291686e-02   +8.340555256584738e-02   +5.915111022095003e-02   +7.171447352925361e-02   +1.888991070645663e-02   +2.260191619905209e-02   -1.529750781407135e-02; -1.380372510880835e-01   -7.029746500503056e-02   -1.419848127278487e-02   -5.085626678958470e-02   -2.579052943894451e-02   -6.424567267875053e-02   +3.307233991402694e-02   +6.129285164785545e-02; +1.157005985239679e-02   +1.605407693930118e-02   -7.506850008881066e-02   +1.708120816917108e-02   +4.281777931298540e-02   +2.562318606788803e-02   -2.350722601549798e-02   -3.896686639402189e-02; -7.644012912917879e-02   -1.852626043041820e-03   +1.179130796029534e-04   +5.268060310036384e-02   -3.545043186837624e-02   -8.754039064717735e-02   -8.099873468572435e-03   -1.289213742282724e-01];
L2I_L3I_iGABA_netcon = [-6.506103617562993e-02   +4.952138505535927e-02   +8.752778222607258e-02   -1.099179793093215e-01   -1.811733718291882e-02   -2.905632459745000e-03   +4.946561475727531e-02   -3.609780366945013e-02; -5.090759207554010e-02   +4.349847225509371e-02   -2.223134658378619e-02   +1.875738582839158e-02   -6.389713142699337e-02   +5.234260422097218e-03   +1.664416540129129e-01   -1.707527010159015e-02; +1.054397418181467e-01   +1.462309705566623e-02   -4.610650499931612e-02   -1.298013772602213e-01   +2.457142458699826e-02   -2.625724446061865e-02   +2.715761721945260e-02   +6.431560010837574e-02; +4.377616007602221e-03   +1.011456344791043e-01   +3.473552575739276e-02   -4.753221017777701e-02   +4.421299212856127e-02   -2.531881164389598e-02   +6.477251021335097e-02   -1.365621797025966e-01; -8.393321656397917e-02   -2.392827416843854e-02   -7.741443190620650e-02   -5.556195947496865e-02   +4.313784436985695e-02   +4.146879528407811e-02   -2.547610596173244e-02   +3.155429285430646e-02; +3.921827444438200e-02   -2.170166390386669e-02   -4.212498734425527e-02   +1.456267028360931e-02   +7.848505755853580e-02   +1.069711839031643e-01   +8.451570682618408e-02   +4.804175223813984e-02; +2.008050913378561e-02   +5.573203439789598e-03   +6.769501480610840e-02   -7.803226277464016e-02   +2.313876301231723e-02   -3.357511588135542e-02   +3.360246968389673e-03   +4.751081074108175e-02; -2.770239792356156e-02   +1.530351528036227e-01   +2.271608539238859e-02   -4.877887899504069e-03   -5.080980023644240e-02   +4.102030136538776e-02   -6.688126251540855e-02   -6.914181125731286e-02; +1.244729550423991e-01   +5.454680101929393e-02   -1.492961890657716e-02   +7.336050638788817e-02   +1.570277279093955e-02   -1.448435465863246e-02   +1.305396222797847e-01   -5.575911206272229e-02; -8.694520675502958e-04   +1.250357457738911e-02   -3.839987761960147e-02   +2.808091697780223e-02   -4.261894978269953e-02   -1.179967913140093e-01   -3.156444523668156e-02   -1.886005672848746e-02; -4.930737720802968e-02   -3.657221040342862e-02   -2.771285896831462e-02   +4.299818584009753e-02   +6.394215424208866e-02   +6.982435702899835e-02   -3.168905356417378e-02   +4.197091342408208e-03; -9.631143213138828e-02   +1.088843903717908e-01   +2.658791283895072e-02   +1.324231209967500e-01   -6.039793256276922e-02   -1.493923128628750e-02   -1.842679089256738e-02   -5.769547276508469e-02];
L3I_L3E_iAMPA_netcon = [+1.062701189994396e-01   -2.572010417353563e-02   +1.690866806826323e-01   +3.873916216791956e-02   -1.849873602467735e-03   +8.164620795001537e-02   -1.266094948289689e-01   -5.515720056916159e-02   -4.840189123772606e-02   -6.841344348043189e-03   -3.407862395250724e-02   +9.615627998344886e-03; -4.049425026417020e-02   -4.093966827881005e-02   +1.350364817775100e-01   -2.615532460622370e-02   +7.840374813688090e-04   -2.183839892526185e-01   +3.292723592134590e-02   +1.445415933443099e-01   +1.815141176419457e-01   -1.905695457843278e-02   -7.584736831247879e-02   +4.480785867638645e-02; -1.574348600751684e-02   -8.893068713857182e-02   -1.127571175946897e-01   -8.248445677718494e-03   +8.911136680872950e-02   +2.847184264954193e-03   +3.989182244746228e-02   +5.022577397504462e-02   -5.379465327316407e-03   -4.419569765844306e-02   -4.240403235215292e-02   +1.250544737222097e-01; -8.918209421897322e-04   -1.031896682878294e-02   +1.177060435746785e-01   -4.127613807956283e-02   -5.377492656152572e-02   +9.351472668622221e-02   -1.058067761938794e-01   +1.808089060456475e-02   +6.335837636422109e-02   -5.521514619412545e-03   -4.558993204765715e-02   +1.282003666430104e-01; -6.274328959215553e-02   -1.668188719300817e-01   -1.240246160682388e-01   -1.279760035771885e-01   -3.813293350233172e-02   -9.405738123848793e-02   +8.969813338866309e-02   +1.699385511875077e-03   -5.189524947038461e-02   -1.416709943967847e-01   -4.471221694378327e-02   -6.676907170520875e-02; +5.275725791204842e-02   +7.678035304810228e-02   +1.378323809191068e-02   -6.786814398700580e-02   -9.484833246669636e-02   +6.418530266459366e-02   +2.703794324644461e-02   -7.322233728082104e-03   -1.497236565864461e-02   +1.011909824293481e-01   +6.000266453050249e-02   +1.933238686634136e-03; +1.000014351387422e-02   -7.970226885777301e-02   -7.865023594742894e-02   +5.251356112880380e-02   +2.262546783136303e-02   -2.578400945806781e-02   +5.373003583506230e-02   +1.636953622031844e-02   +3.098752545700222e-02   -2.330872883895871e-03   +2.402896730465890e-02   +9.324517163268571e-02; +3.155266723614759e-02   -2.644711743493851e-02   +7.199315102946549e-02   +4.306608405459238e-02   +1.320291542312386e-01   +5.200424119032591e-02   +1.147232779537967e-02   +3.638338620120388e-02   +6.150141230300873e-02   -2.761266958179944e-02   +4.254552695128192e-02   +7.487542514112691e-02; +1.408032796528063e-01   -8.512663484627048e-02   +9.392781926890723e-02   -1.506932854293637e-01   +3.556196630626788e-02   +1.117826358722986e-01   +1.033189947743110e-01   +1.607941312361009e-02   -8.246410515410464e-02   +2.673331064310448e-02   +2.934256161373094e-02   -1.652745716635314e-01; +4.931492962971129e-02   -5.205756579157348e-02   -1.094819396742279e-01   +3.696552551772621e-02   -3.423767488255578e-02   -4.356929182676675e-02   -2.778270022304740e-02   -8.860799854464130e-02   -2.935057465365707e-03   +3.128135903729178e-02   +8.771698305181062e-02   -4.420265090397078e-04; +6.701593723636268e-02   +3.479953467815627e-02   -1.273790506687404e-01   -5.772224805872855e-02   +8.371517155859634e-02   -1.045141050271510e-01   -2.305331015212480e-02   +4.360781715004910e-02   +8.158066994981553e-02   -4.278885795888042e-02   +8.675914980633784e-02   +4.598692829411706e-02; -1.131201712243512e-01   +1.030902705245528e-01   +1.521373669068300e-02   +2.013306740311350e-02   +7.321365803957444e-02   -1.283349327315718e-01   +4.216880133562430e-02   -6.926329938690778e-02   -2.655543785582586e-02   +1.279155721011511e-01   +1.216508192324020e-01   +5.985325767373169e-02];
L3E_L3I_iGABA_netcon = [-3.358983811948844e-02   +2.531214565929225e-02   +7.773248185541773e-02   -7.721286263549233e-02   -9.806428994763311e-02   -1.084080709438987e-01   +1.737777457111604e-02   -5.199836972782219e-02   -7.352387841279438e-02   +1.331230559585966e-02   -1.946067660466582e-02   +4.680001009432272e-02; -5.681399007841480e-02   -8.252252386820404e-03   -2.507910734091022e-02   -7.701647357508086e-02   +1.487597047982653e-01   -1.080514837483072e-02   +7.252114812026764e-03   +5.354679969107028e-02   -9.054798618690403e-02   -7.915220343871915e-02   +1.596040625745054e-01   -6.525585857981315e-04; -7.832024325181813e-02   -2.018736462680647e-02   +7.906707293584481e-02   +1.417700413644352e-02   +7.291569237757119e-02   -1.129366937759436e-03   +3.210228522894445e-02   -2.539810158398562e-06   -5.725678298501153e-02   -7.752424646780666e-02   -5.427539250256500e-02   -2.532554308995502e-02; -5.637239636785830e-02   -3.070251967094040e-02   -6.813711055690350e-02   -2.560235803811208e-02   +2.142508810707579e-02   +9.939003842666171e-02   -1.364288835822097e-02   -2.169735085180051e-02   +5.064757722886350e-02   +1.005074739678198e-03   -8.616258537098113e-02   +1.821622016639417e-02; +2.499402080643736e-02   -1.351859538484958e-02   +2.939213240664395e-03   +5.010252714886946e-02   +3.584788967834700e-02   +5.657189714539258e-03   -1.312078455314397e-02   -1.094358845321916e-01   -4.162568590453051e-03   +1.516505244093064e-02   -8.143176400012207e-02   +1.649519334098565e-01; -2.267155183718095e-02   -3.169455312920279e-02   +1.099586418510742e-01   +9.725222635306322e-03   -2.341263834069091e-02   -2.423038177607647e-02   +3.004761918655341e-02   -1.173821463615907e-01   -8.059829263603777e-02   -1.055031433039112e-02   -7.618226440538520e-02   +1.111359094046715e-03; -1.030684679523121e-01   -7.767394199973519e-03   +2.905895870905224e-02   -1.167876931092196e-01   -8.604817610479021e-02   -1.118155309686334e-01   -4.878985577029123e-02   +3.379289414726830e-02   +2.368118925484677e-02   +1.519594571141985e-01   +2.772674585265629e-02   -1.151288970469468e-02; +3.509403804765900e-02   +8.517990115812342e-03   -1.067524519038128e-01   -4.962344567793858e-02   -5.365010323965626e-02   +6.868092613733336e-03   +2.293021854306291e-02   +1.686715275320635e-02   +8.424290520004781e-03   +6.547569700277610e-02   -8.713686382690101e-02   -3.709981973430876e-02; -7.705037112692942e-02   +1.631324155708734e-01   +5.603892052581895e-02   -6.988419291495047e-02   -1.075445618011425e-01   -1.617786005290230e-01   -1.066208969788602e-01   +5.685997320232923e-02   +1.044122226525766e-01   +6.286469514520070e-02   +6.095593792332571e-02   +3.099945594244397e-02; -5.067502156125456e-02   -4.894677129040857e-02   +1.944188236058433e-02   -5.969487620970944e-02   +1.077180388249934e-01   -6.050984484145484e-02   -2.416855567646844e-02   -3.816434365025584e-03   +3.466201333220355e-02   -3.384566676287073e-02   -2.888594784230928e-02   -6.634365976658080e-02; +8.416868326810412e-02   -9.394224602981432e-04   +1.538841547966349e-02   +4.393851311310889e-03   +6.546673550409831e-03   +1.377563639098384e-01   +5.435778478941360e-02   -7.093033889289919e-02   +5.052489034595033e-02   +7.922701242482304e-02   -6.369067340638938e-02   -2.169971617120442e-02; +2.696379111987601e-02   +3.901591185306146e-02   +6.957517660013972e-02   +1.921262760938095e-02   +1.207936177357033e-01   -2.019529671474367e-02   -1.398997758774029e-02   +6.069676653173969e-02   +2.721278098897041e-02   +1.200299692789453e-01   +6.532772216853569e-02   -6.492710214900499e-02];
L2E_Input1_iAMPA_netcon = [-1.232105496029748e-02   -7.524411552095615e-02   +9.511495753088393e-02   -4.993136356524220e-02   +4.074642548712651e-02   -4.436682063567818e-02   +2.809741104890859e-02   +6.119829452630704e-02];
L2I_Input2_iAMPA_netcon = [-6.919083236148928e-02   -3.259827540758999e-02   -8.681945300186808e-02   -1.727338000034279e-01   +6.983182167948533e-02   -8.735627661936521e-02   +1.397107515597484e-01   -7.841052621773519e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
