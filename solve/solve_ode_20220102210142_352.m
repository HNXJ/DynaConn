function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.035112760297645e-01   -3.899913141080796e-01   +3.392764174170555e-01   +1.330647307152970e-01   -6.313381817557527e-02   +1.283899590401414e-01   -4.772166092536163e-01   +1.971972432104703e-01   +5.140410113185564e-01   +3.671296084471458e-01   +2.818667828896844e-01   +9.475656814788951e-02   +3.200099350101731e-01   -1.000840652801342e-01   -1.143319253583246e-01   +1.369753150870538e-01; +6.689005445741295e-01   +3.146072550628416e-01   -3.821006192002890e-02   -1.958186388114458e-01   -4.529853918622028e-03   +4.709873180884558e-01   -4.925648897066869e-01   -1.139356943768079e-01   +3.805695429940222e-01   -1.375250103384246e-01   +4.548026517484192e-01   +3.920365816662274e-01   +5.300198658596398e-01   +2.983895506308096e-02   +1.685518177065674e-01   -1.394811787089755e-01; +5.116028204268142e-01   +1.655805251919230e-01   -3.488612632634983e-02   +3.648447305266218e-01   -9.425692215710119e-02   +2.559508172910416e-01   +3.099911231674350e-01   -1.938583037629314e-01   +3.708738004910675e-01   +3.284319200380326e-01   +6.182178226266383e-01   +2.481972006538075e-01   +1.145238001379349e-01   -5.104364476793860e-01   -3.029187760754247e-01   +1.752668972468747e-01; +4.893520823278120e-02   -5.176599247750439e-02   -1.722668661805169e-01   +7.068444083964198e-01   +1.046322931328199e-01   +6.363741834061368e-01   +6.999395452222366e-01   +7.662034613240909e-01   +4.093290877883254e-01   -2.781915541106456e-01   +4.432953387596764e-01   +2.456737919631073e-01   +1.378940803704317e-01   +5.411438307899998e-01   +2.935812207249969e-01   +7.720689669015036e-01; +9.721196089601307e-02   +3.230354972174375e-01   +5.557498409632157e-01   +5.261287069927165e-01   -4.775311194191798e-02   +2.060587370587195e-01   +9.775331824841607e-02   +7.371728959548392e-03   +3.607721249022915e-02   +5.457338495915178e-01   +7.765565631002090e-01   -1.715219237712204e-01   +4.238252549722566e-01   +4.875731976790340e-02   +2.152181989242898e-01   +2.396733522023599e-01; +5.118169021857598e-03   +7.393800865485760e-01   +2.698524531758020e-01   +6.542593665095454e-02   +4.670043198785667e-01   +3.271296464583585e-01   +3.881053387976239e-01   -2.462107611578055e-01   +3.316590043485627e-01   +1.603516496310061e-01   +6.432289820500537e-01   -2.901616380946601e-01   +5.522025261527700e-02   +1.718962653788911e-01   -7.010845014552443e-02   -7.039875421552608e-01; +2.626952189689542e-01   +4.617314815618094e-01   +4.114463088834711e-01   +4.164847160524383e-01   -2.073427125068298e-01   +3.763350939756019e-01   +2.784747437300620e-01   +6.835569270567259e-02   -8.234140219926332e-01   +2.875283222567301e-01   -2.874399259147344e-01   +1.269810112008985e-01   +6.454057302705422e-01   -2.613746129334059e-01   +4.290141844477886e-01   +7.578204272038239e-01; +4.083125196021880e-01   +4.136093467309150e-01   -1.128525249657902e-01   +3.501321387197976e-01   +2.357222272315419e-01   -1.191204638475393e-01   +4.011798276865686e-01   +4.061649523208110e-01   +4.704606844857166e-01   -6.041448683321342e-02   +5.420479905033984e-01   -4.362669593270790e-02   +1.395612984000784e-01   +2.981286940868759e-01   -9.857844820695662e-02   +2.356023044438545e-01; +1.937152199928073e-01   +6.540454088255283e-01   -3.323152011201903e-01   +1.574410029384250e-01   +3.657166482140548e-01   +6.677203447218389e-01   -6.616825982496885e-02   -3.729612189506976e-01   +3.066232111546703e-01   +9.687385477248728e-03   +4.787442377069079e-01   -9.308283416566282e-02   +2.791965562493778e-01   +3.524363744004017e-01   +4.564522842515283e-02   -3.023230287015674e-01; +2.847291208899411e-01   +8.102091147736873e-01   +2.636811465502307e-01   +1.291597920296536e-01   +6.289458293166864e-03   +1.294607690901495e-01   +5.530059347132182e-01   -2.006527950503155e-01   +2.688762865064873e-01   +1.914019556789616e-01   +9.301485862320120e-01   +1.389816448173013e-01   +4.320214617289739e-01   -3.710545833444660e-02   +1.645810003899731e-01   +5.376332749762430e-01; +2.959786597108433e-01   +1.000000000000000e+00   -7.629391438001044e-02   +2.247090727854731e-01   +6.510504844377517e-01   +1.106297659640900e-01   +1.215594901811952e-01   -2.894024165711971e-02   -1.712358967669718e-02   +5.076751056169672e-01   -3.849823747691765e-01   +1.175689999943655e-01   -6.329521063606085e-01   +1.168555741348400e-01   +2.572502356116239e-01   +1.955632579844357e-01; +3.133695175204257e-01   +3.623203703817167e-01   +2.944638390337721e-02   -4.344839967379526e-03   -2.778632855437279e-02   +1.821222886590219e-01   +4.376523536518264e-01   +1.932981524356160e-01   +5.417333177285636e-01   -2.826036599812984e-01   +4.516016447672742e-01   +7.883484273560232e-01   +6.389617778573722e-01   +4.100976605503379e-02   -2.404589001701800e-01   -1.032059633525567e-01; -9.263149075192516e-02   +1.450683411502001e-01   +4.993228316839249e-01   +2.046685040953475e-01   +9.856405767720977e-01   +5.347360534876496e-01   +1.118290777406360e-01   +5.110490466244753e-02   +5.578357110175022e-01   +3.632138644368662e-01   +3.692313268433688e-01   +4.444667652148341e-01   -3.430269180989595e-01   -8.232835612208279e-02   +2.708108336871632e-01   -8.695591984964103e-02; -6.077928363216491e-02   +3.587139168346240e-01   +1.799459899854244e-01   -4.127798591805990e-01   +2.891788137020987e-01   +4.724573375895995e-01   -3.608565159719418e-02   +2.375852677598511e-01   -1.993876614805064e-01   +1.099134866358092e-01   +5.920947643857720e-01   -1.187576666093183e-01   -5.959100628375520e-02   +6.270777564511811e-01   -1.571438203874818e-01   -2.446413712326148e-01; +4.237401315228981e-01   -3.384170509714496e-01   +5.335281727245398e-01   +2.010632502364844e-01   -3.135088750516755e-01   +1.192044415621380e-01   +3.659369310633602e-01   +2.715627261115855e-02   +9.535433790306513e-02   -3.565593557349537e-01   -9.903943502632158e-02   +1.546602414758421e-01   +5.013203445176506e-01   +2.302848978552777e-01   +2.915988775523906e-01   -2.556070278819546e-01; -5.275890929803941e-01   +3.069748518124704e-01   -1.618590217828826e-01   +2.139593503097768e-01   +9.252928167124540e-01   +4.805110868844784e-01   +2.195844232040300e-02   +7.117712090240519e-01   -1.129611950495811e-01   +4.263423439930132e-01   +5.602252287135284e-01   +3.256084667482945e-01   +1.996775565552155e-01   +4.321915296137085e-01   +3.865267042794542e-01   +1.077597659979678e-01];
L1E_L1I_iGABA_netcon = [+1.270307963295600e-01   +4.209756220633802e-01   -4.239432675401146e-01   -8.972305802983732e-02   +7.605058618158048e-01   +7.735898579925633e-03   +5.190388808035032e-01   +2.951349334033706e-01   -7.364518774171039e-02   -2.827810413105895e-01   +1.152737096153253e-01   +2.865427846744871e-01   +6.794001720910690e-01   -2.255229821557856e-01   +3.957965254998425e-01   +8.296976153128682e-01; -4.983983930657852e-01   -3.178610925755663e-01   +6.101560697594479e-01   -5.852225930741370e-01   +3.307293222705796e-01   -3.649739747766225e-01   +4.926792110281804e-01   +6.114639273437309e-01   +1.838732041869246e-01   -1.563534300312471e-01   +2.419992345696427e-01   +3.779335120260646e-02   +6.061240599948369e-01   +3.189516693648522e-01   +4.352857308484899e-01   +1.121648452695681e-01; +5.138930918108945e-02   +2.220091624069584e-01   -4.901751448553721e-01   +4.056608414577367e-01   -1.968704249199583e-01   -2.074549494708263e-01   -1.001807395411248e-01   -3.021581839398601e-02   -1.034761252488408e-01   +7.758805232172497e-02   +1.218217993676943e-01   +2.180627024076147e-01   +2.249656142006996e-02   -3.779799556940805e-01   +5.996083073067003e-01   -6.075034214580902e-02; +4.162277687099962e-01   -3.967045807962810e-01   -2.715528244513536e-01   +1.194744826906341e-01   +1.311765698697963e-01   +2.386467964637252e-01   -2.051149629821297e-01   +3.748628007003479e-02   -5.488726016321827e-02   +1.639935810807283e-01   +2.824413892419190e-01   +1.962657742731640e-01   -1.742867158331314e-01   +3.941466688504811e-01   +5.378638933433111e-02   -1.689418781380503e-01; -1.650534310221783e-01   +5.675122037046101e-02   +2.396646220309089e-01   +3.645110005603323e-01   +4.459890228322626e-01   -1.319493712822946e-01   +2.692987681122667e-01   -5.232379680114823e-01   -2.214030860226109e-01   +2.787283243477062e-01   -2.449733035306848e-01   +4.714446370877252e-01   +5.088647696820081e-01   +5.608682401217306e-01   +2.850439064289004e-02   +1.240825502453987e-01; +2.030703396103167e-01   +4.473116884180836e-02   +7.637739422807549e-02   -3.152732277906033e-01   -3.073417189791522e-01   +7.565374475635920e-01   -1.099239070087308e-01   -2.054143415572190e-01   -2.034706556852225e-01   +5.451561669576994e-02   -3.091935787946356e-01   +5.179516589721642e-01   +1.036954389253614e-02   -1.984093861614324e-01   +3.049343413170296e-01   +1.041186436192821e-01; -3.451071641087582e-01   -1.634281500377694e-01   -4.311868032378153e-01   -4.452997435270939e-01   +5.870811514236359e-01   -6.213295554644323e-02   +9.042108982564570e-02   -2.576453875553614e-01   +2.356686824924707e-01   +2.680036754773033e-01   +7.208652586579701e-01   +2.362691931888105e-01   +2.181870771398164e-01   +1.840255701995491e-01   +8.956227594560621e-01   -2.173292678702375e-01; +9.480773768566154e-02   +4.696696265230384e-01   -2.159086679180882e-01   -1.108352586081214e-02   +1.670030668332106e-01   -3.480309528983149e-01   +9.015574936033743e-01   +7.569144628261008e-02   +4.949586165802033e-01   +7.135812585020396e-02   +1.200965474821687e-01   -1.855048045054646e-01   +6.144934274539746e-01   +5.099069287215741e-01   +4.602541930914560e-01   +5.887152813725332e-01; +4.797317346274692e-01   +7.349063565266167e-01   +1.109045442451870e-02   -1.243806326966781e-01   -3.871233461823227e-01   +6.150315780227619e-01   -2.600840983879751e-02   -3.604744091709430e-02   +1.156361568542137e-01   -1.773954717253250e-01   +8.827963899359634e-02   -1.289969610305329e-01   -2.856719424596982e-01   -7.503525438335240e-03   +6.869997665613459e-01   -3.438793779466038e-01; +2.068787093753782e-01   +5.423078102633441e-01   -4.588235963429718e-02   -2.806957152711023e-01   -3.784379331728721e-01   -7.629825706883853e-02   -3.362559430891360e-01   -5.995953359924874e-02   +4.056809019167829e-01   +2.195712521889124e-01   -4.700918283874889e-01   -1.247830975820323e-01   +4.124360361489844e-01   +5.124714665334574e-01   +3.243013344600927e-01   +4.751888956054922e-01; +2.603639609052914e-01   +2.425332483961146e-01   +2.508880324961307e-01   +7.174822432297457e-01   +4.028206119222697e-01   -9.589419200944720e-02   +1.203701570483195e-01   -1.061084678930610e-01   +6.684675230236877e-01   +2.240994715878096e-01   -7.472682480584518e-02   +3.841175647035625e-01   +8.210661782267182e-01   +4.432136619385903e-01   +3.989584243479927e-01   -3.900422695247113e-01; +3.039495260729453e-01   +8.444472817473919e-02   +7.074573614388344e-02   -8.343897627996524e-01   -1.281027931806382e-01   +7.783623525839935e-02   -1.171544732331014e-01   +3.489118013671068e-02   -7.695279704523748e-02   -1.489089564364263e-01   +2.920951897479345e-01   +2.571336064699754e-01   +9.672415917226254e-02   -2.170277784409192e-02   +3.426985848724656e-01   +1.777305572746428e-01; +3.089052082213977e-01   +6.532877261161153e-01   +1.342188458575712e-01   +2.366064213752929e-01   -1.143405648433114e-01   +3.484425175053548e-02   -9.168461453466296e-02   +3.503284289529621e-01   +5.258359913973241e-01   -9.362192278690026e-02   -5.363196981876590e-02   +8.091771544467563e-02   +2.480739017702135e-01   +2.684387954676064e-01   +3.962418256782200e-01   +3.651198047174672e-01; +6.234673375027643e-01   -9.433442467066938e-02   -2.499777179738361e-01   +2.826947847603676e-01   +1.220673730432573e-02   -1.637675514039302e-01   +2.210181728568940e-01   +1.668114234182836e-01   +5.684101005351099e-01   -3.999299146079093e-01   +1.931215613439817e-01   +1.813002906173086e-01   +2.576532306730155e-02   -3.607603540416113e-02   -1.342369285273809e-01   -2.356616267454773e-01; +3.773441342086943e-01   +2.963447360255212e-01   +1.545370408138868e-01   -4.181874522764467e-02   +1.134306763488081e-02   +1.042520687601964e-01   +2.310912583917009e-01   -1.357227487543739e-01   +4.563113388339239e-01   +6.162999158420508e-02   +3.988194988077047e-01   +1.151416753492933e-01   +1.960988095937356e-01   -7.209767673169696e-01   +7.626987032769844e-01   +1.811262402536886e-01; -2.894821059176586e-01   +4.442824709858031e-01   +4.670096201328843e-02   -4.582124631181838e-03   +6.217688893244801e-02   +9.290387823180157e-03   +1.663962361979356e-01   +9.460343436983734e-02   +5.759272458165975e-02   +2.588761046751786e-01   +1.828798502683654e-02   +1.180044492524936e-01   +3.884952965050855e-01   +2.293767977344947e-01   +1.727481287724854e-01   +5.229503424787929e-01];
L2I_L1I_iGABA_netcon = [-2.118666805859354e-01   -1.650737998628468e-01   +1.079943027844930e-01   +5.039527667384566e-02   -3.320303441903425e-01   +2.146224904854477e-01   +2.050930115644787e-01   -3.496796410727485e-01; +3.273490909858847e-01   +6.546065525360034e-01   -8.301076131948641e-02   +2.484843452285956e-01   +6.920226979733269e-01   +4.913297292203760e-01   +1.678923303056296e-01   -5.888337709079259e-02; +5.512039838703948e-01   +4.229775712140618e-02   +2.358399286920879e-01   +2.083044333094182e-01   +2.486636005964007e-01   -4.753181316706010e-02   +4.720216162797240e-02   +9.201691867612709e-02; +3.039871289307984e-01   +1.269278967028823e-01   +8.142683001360760e-01   +3.734499182884490e-01   +5.025559710900962e-01   +3.912937684902777e-01   +4.591241819426811e-01   +8.575174621435717e-02; +1.990877666295935e-01   -1.216876461351200e-01   +6.132281270716613e-01   +2.267118034535326e-01   +5.007619810609103e-01   +1.068186947857695e-01   +1.757639008733729e-02   -3.054448234022876e-02; +2.785457142565094e-01   -3.350880142679166e-01   +1.836665555821553e-01   +3.191641435653234e-01   +9.313679361599159e-02   +3.459302092726345e-01   +1.868109712489990e-01   +5.969676218471076e-01; +4.228888433914020e-01   +4.148770405299389e-03   +3.512106385042129e-01   -1.293887272339155e-01   +2.538846518043668e-01   +7.094484434885581e-01   +5.279592352360682e-01   +4.793570472884406e-01; -7.159109420017942e-02   +2.381154980706865e-01   +1.567354128527773e-01   +3.317315452767530e-01   +2.327731625308423e-01   -1.958003898454269e-01   -2.259689744775100e-02   -5.690386971710152e-03; +4.357641140188491e-01   +1.000000000000000e+00   -5.046637068709351e-01   +4.354303178567735e-01   +3.863991905441288e-03   +2.998912631674229e-01   +3.563655809715769e-01   -2.046415753808357e-01; -1.211814917658074e-01   -1.998015479599261e-01   +1.645802700651166e-01   +4.800762853045239e-02   +5.244672986646634e-01   -2.469658851583429e-01   -1.853045641711830e-01   +4.237163203347057e-01; +1.439115269561185e-01   -6.895568566825978e-02   +2.523696864197374e-01   +3.746264014329231e-02   +1.589376752973894e-01   +3.915373460874533e-02   +2.904315096469947e-01   +1.430454498762895e-01; +4.601957199421847e-01   +2.938414839263338e-01   +1.762803585073878e-01   +1.093343753022533e-01   -3.423250985113248e-02   +1.345662065364057e-01   +6.129795257466222e-01   +4.898117089352981e-01; +3.572571923617016e-01   +3.384247584209413e-01   +2.870966317456833e-01   +2.072852967630341e-01   +3.966857001836476e-01   +1.089392042908396e-01   +3.899818198660960e-02   +2.611829359525913e-01; +1.193162424544051e-01   -2.932154759537538e-01   +3.036339580882805e-01   -4.850063028052621e-01   +3.425806886543193e-01   -1.585626189362733e-01   +3.593303963357284e-01   +3.677139360895658e-01; +2.670520077558287e-01   +1.122477779862874e-01   +3.223555977953021e-01   -8.025152237933743e-03   -5.226615537550613e-02   +9.834810773696906e-01   +5.448018892193864e-01   +7.356633591335600e-01; -1.701787876212755e-02   +7.985512598147586e-02   -2.437979231758040e-02   +5.037926844738403e-01   +7.487744244171306e-02   +1.766789278779021e-01   +1.024403008526864e-01   +1.536506574003304e-01];
L1I_L2I_iGABA_netcon = [+3.211073892228552e-01   -2.947755501072206e-01   -1.034671618139393e-01   +2.161353340023277e-01   +2.270901433609841e-01   +1.622870488900135e-01   -6.620000453511676e-02   +1.036929572768370e-01   -1.668434947872965e-01   +2.966197900727722e-01   -9.744861842414453e-02   +1.563588771808816e-01   +6.054162168394683e-02   -1.237490349772365e-01   -1.194006152861718e-01   +2.537249133515662e-01; +4.595976709313162e-01   -2.509459514845733e-01   +1.546668654995988e-01   -3.144312345426335e-01   -5.776738509578808e-03   +9.081961128075244e-02   +3.037601119123117e-01   +3.329924644973591e-01   +1.429130687461751e-01   +6.031706364074868e-01   +3.731360630839006e-02   -2.761108119497832e-01   -2.224377167515891e-02   -3.038638008839934e-01   +3.548606491354093e-01   +3.203823339881091e-01; +2.942118445028710e-01   -2.783550987546410e-01   +4.635725125167006e-01   -4.465126739972698e-02   +1.818200092069605e-01   -8.906898601871936e-02   +5.374778072880647e-01   +3.353031245664852e-01   -1.008666730942126e-01   -1.040207997587449e-01   -1.869492762704799e-01   +1.251546569511618e-01   +2.000306820994605e-01   +5.690287198298446e-01   +1.000000000000000e+00   +1.461366451173196e-01; +3.670183905899228e-01   +6.738334947540062e-01   +4.027863720929103e-01   +1.948600137568970e-01   +5.350913178291627e-01   +6.740197206732628e-01   +4.813393531922515e-01   +2.815379611280315e-01   -2.049580094228527e-02   +7.851331386821460e-01   +3.951010460620240e-01   +2.363339618803549e-01   +4.124445552552166e-01   +2.128457762480941e-01   +2.519446004936328e-01   +2.281592394821555e-01; -5.175436304043665e-01   +1.619809279050171e-01   +3.305331232235145e-03   +4.367966389324324e-01   +1.350703526754700e-01   +7.117761154032454e-01   +3.937918502053506e-01   +5.578753204347366e-01   +4.602989546348796e-01   +3.842970039357433e-01   -1.511405961563244e-01   -4.690400371388596e-02   -5.667117323772148e-01   -1.316098358718636e-01   +3.089586636237506e-01   +5.364324112933365e-01; +2.466132558508563e-01   +2.657052910542061e-01   -2.599737725731820e-01   +5.335334676019946e-01   -2.072994723141023e-01   -1.541620008916897e-02   +4.035171318054817e-01   -1.805264349178458e-01   +1.270400565901568e-01   +9.110911290387809e-02   +1.090389928427039e-01   -1.185048622646957e-01   +4.306899455081116e-01   +9.766943003468370e-01   +1.739221947153352e-01   -5.285432531301267e-03; +2.611884677836936e-01   +4.096627000642440e-01   -4.226148523951086e-01   +1.879040555706180e-01   +4.131355855949773e-01   -3.993100828496102e-01   +3.546130663257961e-01   -5.659767986173587e-02   -2.623897536880150e-01   -2.081601273564483e-01   +2.980994625040574e-01   +2.619311753192877e-01   -1.659417831746234e-02   -7.266399002442049e-02   -1.936579026487132e-02   +2.827430346908407e-01; +4.849547414200306e-01   -6.834491221146954e-02   -2.838877780099224e-01   +2.303350146792734e-01   +1.622918233957744e-01   +3.045395073125625e-01   -5.956109980204988e-02   +1.615358544916485e-01   +8.662371861487662e-02   +1.769431988672066e-01   +9.686114181611712e-02   +7.121124666977181e-01   +8.010381665364556e-02   +2.612007864533614e-03   +5.140728450754013e-01   +4.677892536302602e-01];
L2E_L1E_iAMPA_netcon = [+4.667691642927120e-01   -2.275609923447422e-01   +9.328875100692267e-02   +4.947103546581285e-01   +8.329765868626932e-01   +5.716580708667696e-01   +5.165891203923898e-01   +1.627812727105952e-01; -2.713752867141377e-01   +1.086149483491481e-01   -9.853341858892782e-02   +5.409596011207912e-02   +3.090424156045672e-01   +3.048039735422193e-01   +3.881674555261056e-01   +3.222248216634366e-01; +4.292536051989338e-01   +2.244951616650059e-01   -3.954986634506234e-03   +1.717722535296992e-02   -1.542020817844450e-01   -1.815250985450022e-01   +8.501692843701834e-02   +3.365331566098199e-01; +5.612771622623239e-01   +8.617847972293517e-02   -4.157717952917691e-01   +5.220583772798250e-01   -3.465454940822731e-02   +1.665154603375874e-01   -4.771613301468046e-01   +1.161098222980647e-01; -1.020561074912596e-01   -5.080809453586140e-02   +3.769754158621745e-01   -2.461876376651434e-01   -1.830989800817390e-01   -3.594224261072623e-02   +1.122160522327162e-01   +3.377983995290534e-01; +4.545207458877707e-01   -3.454025262349105e-01   +1.752839565982243e-01   +1.876459759503388e-01   +2.255170860627863e-01   +8.163174155661220e-01   +5.226109529815646e-01   +4.479941932439540e-01; -1.777123309950379e-01   +4.145106215494003e-01   +1.750072347264259e-01   -3.221176238849883e-02   -9.692334003993082e-02   +2.201785075767149e-01   +6.825118001289979e-01   -4.929622637339263e-01; +6.253208566387974e-02   +3.481684443270524e-01   +9.898892531684141e-01   +8.616647797350308e-02   -1.965663828698689e-01   +4.767970299218919e-01   +1.584289747598226e-01   +1.123740030536369e-01; +4.745040291937053e-01   +1.385669580754424e-02   +3.402037140698047e-01   +4.929922617425856e-01   -2.724366773466058e-01   +6.304780590793034e-01   +4.630504752989798e-01   -1.356386608409446e-01; -5.781266050781231e-02   +1.499540367182347e-01   +2.534793400511349e-01   +8.017295758715881e-02   +1.918954591847648e-01   -5.163045780427002e-02   +6.457986582556856e-03   +7.080517690624097e-02; -1.391685568564574e-01   +5.003945664412603e-01   +5.649008296583303e-01   -6.864428294287181e-02   -2.426248298796003e-01   +9.085048601448074e-02   +1.612311548786850e-02   +3.041690735059117e-01; +1.328291335759665e-01   -1.512723497241212e-01   +4.460734788561954e-01   -1.353856989588130e-01   -2.202992857294100e-01   +2.058715847560095e-01   -2.489175794909728e-01   -1.576604908575897e-01; -1.689765083475573e-01   +2.816104065717224e-01   +1.229643094092468e-01   -3.100304534090854e-01   +6.507582407965248e-01   -3.352515152301055e-01   +3.553809405621040e-01   -5.978292778532306e-02; +1.424270280273297e-01   +7.831478922985174e-01   -2.697153247391327e-01   +1.452294234498666e-01   +3.424807102854122e-01   +2.958206365154964e-01   -5.772908861657147e-02   +2.331398172653499e-01; +2.488504359417181e-01   +3.985087302764995e-02   -4.881410820157980e-02   +3.108508526877421e-01   +1.777047823558550e-01   -1.417396530412061e-01   -2.064260251042751e-01   -1.134125695715394e-01; +2.441870404892636e-01   -1.420186221105478e-01   -4.220613795558158e-01   +9.362780934127168e-02   +3.928377426721713e-01   +3.978457725199963e-01   +5.323943187112790e-01   +9.011533948045632e-02];
L1E_L2E_iAMPA_netcon = [+2.817262382905973e-01   +4.781704555940832e-01   +2.692417709108378e-01   -3.073815761280594e-01   +3.599655679567931e-01   +1.406782424860328e-01   +3.738549546358285e-02   -5.097153178529251e-02   -2.301689001614558e-01   -1.974418717832229e-01   +5.237997795793601e-01   -1.892921896346859e-01   +2.498613272011617e-01   -3.470648782105813e-02   -3.132005540985759e-01   -1.008595174784981e-01; +7.920788065485193e-02   -3.715511422534218e-01   +5.620771569960291e-01   -2.546214351543213e-02   +1.365332020663462e-01   +2.782204498674544e-01   +4.416969556744402e-01   +1.627549552462453e-01   -1.450496101819546e-01   +7.235113367841312e-02   +3.982664128684114e-01   +4.107215658017111e-01   +3.836202921585732e-01   +1.663277477958958e-01   -3.555225375913906e-02   -2.369197613196355e-01; +8.571086080554969e-01   +5.704459231053249e-02   +1.098336424425241e-01   -3.460703865093893e-02   +1.718584989313831e-01   +2.300266272608625e-01   -9.194566346413244e-02   +3.074710926278630e-01   +2.004004057278053e-02   -4.028628586220974e-01   +6.204516288939207e-02   +4.173915530397299e-01   -1.654754121848026e-03   +4.857931443450884e-01   -2.684393749979840e-01   -2.048296662225713e-02; -3.996233306380081e-02   +1.437144598515548e-01   +1.596652918525210e-01   +2.492150223368952e-01   +1.496144006853331e-01   +5.428752636526385e-01   +9.503361040653820e-01   -2.084868423811662e-01   -2.086771237287877e-01   +3.329370284318167e-01   +4.804930093899690e-01   -2.711372561903161e-01   -3.482051544337759e-01   +8.828182786836681e-01   +3.765708240091213e-01   -3.277167877485725e-01; -1.058228293818766e-01   -6.055537614155695e-01   +2.690918075776344e-01   -2.891813506960702e-02   +1.609717092583981e-01   +2.313648482589641e-01   +3.346322743106985e-01   +5.259582481240237e-02   +4.450818317698086e-01   -1.908536253670195e-02   +3.151069140236094e-02   -4.405501441638136e-01   +5.223598164074956e-02   -1.098520109161510e-02   +3.514828359369007e-01   -2.713901727896986e-01; +2.388251654388686e-01   +4.844152568506946e-01   +1.239264762917227e-01   +6.784251452338111e-01   +8.165847649682710e-02   -2.536077417499429e-03   +8.094458929309316e-01   -9.879007802386351e-02   +3.089723712342355e-01   -1.858803228381036e-01   +4.165729082476333e-01   +4.517560730929325e-02   -1.405548318457026e-01   -1.060711276148787e-01   -3.564961754833930e-01   +5.938197677250218e-01; +2.108951496553446e-01   +1.252570034777861e-01   +4.732322798122854e-02   +1.909070594570849e-01   +1.683880039357915e-01   +1.281094700522416e-01   +2.810985557473301e-01   -4.791027838936174e-01   -9.179861915595633e-02   +1.764758552928650e-01   -2.038337951506110e-01   -1.313298023595084e-01   -3.838419790703676e-01   +3.952667000678410e-01   +5.218354985009376e-01   +2.778119013847852e-01; +3.913573150848288e-01   +3.858073007699001e-01   +5.600880374635804e-01   +6.540691060929954e-01   +2.136747843766366e-01   +6.800889655192263e-01   +2.246771187920109e-01   +1.027731862184731e-01   +2.657387402908703e-01   -6.728745535694548e-02   -2.664852552529341e-01   -1.143978453411490e-01   -5.721883642476353e-01   +3.822661121758953e-01   +2.049247006059085e-01   +3.429226788201911e-01];
L2I_L2E_iAMPA_netcon = [+2.597185667343579e-01   +5.686306731883486e-01   +1.097895203212036e-01   +8.855322260617531e-02   +2.171889657233723e-01   +5.276701259477101e-01   +3.873921370101489e-02   +6.229213198519722e-01; +6.645354605286747e-01   +2.439685040271357e-01   +6.127705606492462e-01   +6.930988492559419e-01   +4.764288210616305e-01   -1.871355874700282e-01   +2.114418243927963e-01   +2.588053536417730e-01; -2.110332586335911e-02   +2.835553750587896e-01   -9.917203845187444e-02   +5.018307454642952e-02   -9.464822807343357e-02   -1.600106199056811e-01   +2.072913645972769e-01   +9.608006289931854e-02; +2.345737270139113e-01   +2.150689007799867e-01   -4.005656621666710e-01   +1.318014038041481e-01   +5.793855340646294e-01   -1.800431160647524e-01   +4.070737586195627e-01   +2.008303005669191e-01; +3.346344526527823e-01   +5.984057854749436e-02   +4.947782565959362e-02   +4.214671130776214e-01   +6.738958709113301e-01   -3.272712375519305e-01   +3.567620745054227e-01   -1.620699908329281e-01; +5.563030904536426e-01   +2.515983173355875e-01   -4.488669681788447e-02   +4.319996554226164e-01   -1.812963650803679e-01   +1.168290661282452e-01   +1.013814496969002e-01   -2.965357875401086e-02; +4.713045388918096e-01   -6.472852894747428e-01   +4.180184688983427e-01   +4.851452465640023e-01   +8.337361969423508e-02   -2.899579076131546e-01   +9.409369930101674e-01   -3.348513439420578e-01; +2.785152869470684e-01   +2.063978548959031e-02   -5.679146176719925e-01   +2.746246674094360e-01   +8.631460697358609e-02   -1.534972192232662e-01   -9.785118853296038e-02   +6.892965649937507e-01];
L2E_L2I_iGABA_netcon = [+1.584927765912549e-01   +3.086476693204597e-01   +2.325529809176524e-01   -3.962662094994364e-01   -1.987691565784327e-01   +1.215684316153523e-01   -1.490041976307969e-01   +6.694321693158806e-01; +2.407183670928777e-01   +8.514796199861960e-02   +1.664569967091725e-01   +1.000000000000000e+00   +7.609206799150255e-01   +1.256818272728019e-01   -4.119990042607611e-01   +1.784995735672773e-01; +2.273790926639666e-01   +6.997431182341636e-01   -4.411929722276523e-01   -4.648754063144170e-01   +3.114735966000411e-01   +7.346419799059197e-01   +2.053600309250359e-01   +2.099015715075463e-01; +1.547055272378582e-01   +6.123316412343790e-01   -5.023371762724097e-02   +6.117895828539714e-01   +9.569612001057830e-01   -5.673793148753885e-01   -1.737322372501696e-01   -8.038442188424993e-02; -1.242286344413794e-01   -2.952654732108592e-01   -2.709028700320322e-01   +3.400624336353989e-01   +9.121558836556262e-01   +4.362232867005235e-01   +1.495625101598820e-01   +8.984966594590011e-03; +9.422894956041231e-01   +4.535079688938563e-01   +3.959644555688700e-01   +5.387739230191151e-01   +5.082983433705897e-01   -4.407960514297887e-01   +5.140238741047430e-01   -5.084967655182090e-01; +1.911759273558165e-01   +2.236268226845059e-01   -5.061989065459723e-01   -7.311853535973080e-03   +1.377084498776529e-01   -5.162866322968546e-01   +1.592973844154490e-01   +9.316726848005896e-01; -2.065318817128537e-02   +4.580079124912637e-01   +4.607853536465459e-01   +9.940522353751258e-02   +4.202914865002025e-01   +5.626508190057162e-01   +2.487864479896028e-01   +6.076831049012946e-01];
L3E_L2E_iAMPA_netcon = [+4.964070449900782e-01   -1.030511418172257e-01   -1.542108118162575e-01   +2.550847238755955e-01   +5.676016612637936e-01   +4.100491715515703e-01   -4.069700984304225e-01   +7.951384469566845e-01   +2.850465078016470e-01   +2.280771569866052e-01   +2.324613914878358e-01   -5.667580961000775e-01; -7.119702528973629e-02   +2.286951706107583e-01   +5.623839977338926e-02   -3.006211893087533e-01   -2.635111485930652e-01   -2.312882146968059e-01   -3.908202369946471e-01   -4.674574407941465e-02   +2.090751702607621e-01   +4.084972805525137e-01   -2.444262209385119e-01   +6.624404990152456e-01; -2.811550949977716e-01   -2.509056815913839e-01   +4.668879749604864e-01   +2.925038107188689e-01   +2.105652751730727e-01   -2.173892419309244e-01   +1.724435793301401e-01   +2.297996624736057e-01   +6.671185562606100e-01   -4.706864443405859e-01   +9.292455895790921e-01   +5.604084660713846e-01; +3.848824374780508e-01   +3.113737036155272e-01   +1.333203688372609e-01   +1.608156203018446e-01   +4.323326022383205e-01   +2.673289653211650e-01   +8.305612800146374e-02   +5.377894597776415e-01   -4.123644418214806e-02   -1.486957758566157e-01   -2.416560864605994e-01   +4.265543744551930e-01; +1.178111285956555e-01   +4.682462390649986e-01   +3.945809787145407e-01   +3.701107182279355e-01   +5.141576851043018e-01   +3.791604134701274e-01   -7.528780543029842e-02   -4.083574958218491e-02   -1.046294090392011e-01   +4.907935782015835e-01   +3.888008450637582e-01   +4.515927444077701e-01; +2.913307471794754e-01   -1.040112215997138e-01   +2.358186529451040e-01   +2.007715319516970e-01   +4.221129412385057e-01   +6.492039464388550e-01   -4.606743948486989e-01   -2.726759453884386e-01   +1.614696230228089e-01   +2.670303500486643e-01   +1.301195001496828e-02   -2.041914645401005e-01; +3.702474285436421e-01   +5.819194779644279e-02   +1.080720219522437e-01   -2.338114059776162e-01   +1.512731876048709e-01   +3.902939422012615e-01   +9.397392899031978e-03   +3.832538762880167e-01   +1.010962857384660e-01   +3.103025469738144e-01   -5.013670428050640e-02   +3.507687676583022e-01; -1.594148736613820e-01   +7.098063527447875e-01   +1.238580351040586e-01   -5.735275890882302e-01   +4.822411592866102e-01   -3.196600518752114e-01   -5.031010420786198e-01   -2.424121735900495e-01   +3.381236128467198e-01   +7.765595364420411e-02   +2.337145649176646e-01   -3.563519268267679e-02];
L3I_L2I_iGABA_netcon = [+1.000000000000000e+00   +5.478895322773270e-01   -1.401064295485429e-01   +5.463666777972072e-01   -4.512927229915253e-01   -7.024356861962501e-02   +8.162770071664477e-01   +6.494511560107248e-01   +4.456924155481050e-01   +1.725528405809445e-01   +4.627929598507545e-02   +2.594082844594475e-03; -6.021412073641487e-02   +1.536197327821794e-01   +1.344306945690588e-01   -3.719032452845265e-01   +3.606339994309816e-01   +1.395672674126583e-01   -1.666517213101079e-01   +7.966301382379057e-02   +1.575386342900421e-01   -1.933387229030089e-01   +2.223138405367970e-02   -4.304688413494124e-02; +3.619541195881339e-02   +1.935197783107959e-01   +3.458555468030713e-02   -3.620990179402181e-01   -1.510536968154559e-01   +3.494773473866449e-01   +3.323828927671127e-01   +2.016902791835749e-01   +8.311769341516316e-02   -9.109686486977905e-02   +2.493252508298319e-02   +8.414511458975431e-01; +4.491727369423510e-01   +2.159057029107336e-01   +5.730969054937112e-01   -7.278419791844523e-02   +2.256080508848096e-01   -5.845763772357115e-03   +1.827857333052317e-01   -1.181073915751221e-01   +3.443641013403020e-01   +5.759233316928563e-01   +4.623033113503536e-01   -3.603723103481234e-01; +3.080249729696218e-01   +2.282559829674717e-01   -5.240652433687623e-02   -9.286475461497182e-02   +3.940224154367531e-01   +5.302208839358630e-01   +2.244309245570214e-01   +6.044610686663252e-01   +4.838892510535380e-01   +1.419529956453608e-01   +3.014169273954147e-01   +1.627249609322229e-01; -2.210597162403393e-02   +5.206506960625600e-01   +5.876419844561360e-01   +2.039006262725812e-02   +2.458642682106048e-01   +1.284312387668619e-01   +5.082495972790255e-03   -1.521817818040193e-01   +3.729182334196374e-01   +2.307588515892122e-01   -5.874521463675000e-01   +1.100699584826035e-02; +3.497217071830111e-01   +4.828358638025904e-02   +4.385728268776271e-01   +2.874913847262477e-01   +4.723045564644499e-01   +7.444763588058160e-01   +3.361501962879595e-01   +1.406226137639223e-01   -6.630421611401243e-01   +4.639886507823561e-01   +4.326407479299150e-02   -3.738842565882278e-01; +3.556999245526293e-02   +1.702286975601288e-02   +4.595174770732564e-01   +2.735422048650189e-02   +3.403281173604107e-02   +4.598124577498952e-01   +6.301811889798137e-01   +4.867044307460479e-01   +4.711001438225639e-01   +4.128001054226808e-02   +1.212242899880180e-01   +2.173750858011622e-01];
L2E_L3E_iAMPA_netcon = [+3.069719241126314e-01   +8.699425817937659e-02   +7.227909214964361e-01   -5.755342057357600e-01   -6.691447996035135e-02   +4.705879980855723e-01   +6.698231789791225e-01   +5.668089640096005e-01; +1.932943301688013e-01   -8.941776229332238e-02   +4.209050805118242e-02   +3.449706953133924e-01   +6.206361538910841e-01   -4.190532733575384e-01   -4.786790000978327e-01   -5.089307475012910e-01; -3.308734776164093e-02   +5.258258688206787e-02   +1.911736227309616e-01   +1.832577072088956e-01   +1.391531701610922e-01   +9.726143194040622e-02   +2.999525820212038e-01   -8.717081324650500e-02; +3.670914607201025e-01   +6.177264111133277e-01   +7.671922143480844e-01   +9.164421434248440e-01   +1.537420170067059e-01   +4.492932252120720e-01   -3.493263221028934e-02   -5.992268201231377e-01; -1.103232564813509e-02   +1.590971814446888e-01   +8.421388849668388e-02   +5.575218828117711e-01   +1.127097921768798e-01   +2.191130470453241e-01   -4.782007714939404e-03   -4.569699097267689e-01; +1.351737922627421e-01   +4.135082488618499e-01   +5.552356860636609e-01   +6.869834038747148e-01   +1.890280909801551e-01   +3.278927663941331e-02   -1.689579945927625e-01   +3.038739920744139e-01; +1.766799668875955e-01   +9.318510607591367e-01   +3.930435435788763e-01   -2.822610299708085e-01   +1.985496593199859e-01   +3.557030356108743e-02   +2.855523923287097e-01   -2.566170581527616e-01; +3.651433017522127e-01   +3.791040538089634e-01   +1.797569124571607e-01   +2.593105068165894e-01   -2.648990705617487e-01   -1.475547773374783e-01   -1.816379234530101e-01   +5.516588091707147e-01; +2.456371738421463e-01   +6.121735809444933e-01   +6.549848795967377e-01   +6.984488564892155e-01   +9.924857625345064e-04   -2.450869756849815e-02   +5.237460553569117e-01   -2.558909046229689e-01; -1.767173723660322e-01   +9.661459029932433e-02   +3.562885492124981e-01   +3.014488814954257e-02   +1.438615551684471e-01   -3.463026456698701e-01   +2.116218449490076e-01   -9.258937541095696e-02; +4.655219210250984e-01   +4.720266695775821e-01   -6.315066703149044e-02   +6.384457770691530e-01   +3.199746137855629e-01   +7.974952847709991e-01   -4.013116764555642e-01   +1.392148115322953e-01; -1.982381661193816e-01   +3.883555352690463e-01   +3.507350015161783e-01   +1.395320330998170e-01   +2.012905371639582e-01   +5.996535060775252e-02   +8.907515405302661e-02   +2.826650395757653e-01];
L2I_L3I_iGABA_netcon = [-1.307288634124487e-01   -5.887175778833062e-03   +2.318549787455593e-01   +2.157273403551919e-01   +2.164693013468811e-01   +6.497573663978378e-01   +4.229184264795320e-01   +3.151465284169201e-02; -2.898005951941894e-01   +1.893995980833008e-01   -2.596581926537340e-02   -7.363541655437597e-02   +5.397747378182396e-03   -3.090479750754087e-01   +3.867816768481521e-01   -4.320186173434708e-02; +2.706632069114113e-01   +9.910639277283548e-01   +6.383827827577879e-02   +2.721253210657599e-01   +3.108744343627061e-02   +6.777471158990999e-01   -1.416876386317670e-01   +3.506478021880846e-02; -2.789057837987850e-01   -3.796967592495007e-02   +8.651299964827086e-01   -1.387268030537184e-01   +1.288427327395408e-02   +6.394541601051947e-01   +5.534876884654133e-01   +2.354106126303367e-01; +4.698625733247112e-02   +2.778922108335509e-01   +4.059056985586481e-01   +3.572465578704160e-01   +2.458719194286056e-01   +2.796286738353508e-01   +3.622135077756203e-01   -1.462794502983616e-01; +1.684886659792109e-01   +5.333768258879559e-01   +2.960348001555160e-01   +6.269685318594553e-02   +4.725935900026506e-01   +3.803791193299288e-01   -9.168450116048470e-02   +6.329963746067883e-02; -2.683005452417613e-02   +6.532271668778352e-01   +2.314000693761585e-01   +9.583463035006867e-02   -3.173124735614059e-01   +2.330579168820823e-01   +8.662984422292531e-01   +3.858013873002423e-01; -3.548680109599811e-01   +4.586260567235909e-01   +3.916479589331200e-01   +4.880478678593234e-02   -6.761366905858826e-02   +5.739490704840419e-01   +1.272325380682684e-01   +5.491279355457146e-01; -3.579086608275193e-01   +6.899527701919521e-01   +6.756932102637305e-01   +1.273883590486761e-02   +2.213637376231294e-01   +1.447330796809507e-01   +1.642668856154031e-01   +1.330179783648473e-01; -8.044791388130718e-03   -1.123807120722797e-01   +1.885562053387467e-01   +7.648209046082262e-02   +4.034738494507411e-01   +3.662971632599912e-01   +1.016222168738122e-01   +1.690293793169103e-01; +6.159923085623359e-01   +1.287583849308631e-01   -4.581350083240917e-01   +4.162709089246542e-01   +1.040674463050974e-01   -3.440752642693415e-01   +2.508897791086791e-01   +5.280785848983319e-01; -1.276240647337504e-01   +4.450280948530392e-01   -1.405427010296564e-01   +3.230288283454701e-01   +3.593066812938697e-01   +3.543163614795606e-01   +1.554659397447978e-01   -2.140331906246180e-01];
L3I_L3E_iAMPA_netcon = [+1.754873815640818e-02   -3.320362399869871e-01   +3.462278201484738e-01   +2.308519198947974e-01   +5.150707980269533e-03   -1.731351353137063e-01   +8.959730667139829e-02   +5.626905839964750e-01   +5.199185567429209e-01   +4.268522813583498e-01   +9.358765534996583e-02   +5.088964125937869e-01; +2.912130395728157e-01   -3.111090408823233e-02   +2.437621983974959e-01   +7.282445260987166e-01   +4.179136167749146e-01   +2.055138060152651e-02   +3.142604193820261e-01   +5.507501201142042e-01   +5.027490297925935e-01   +4.347108757612468e-01   -2.995344672367725e-01   -1.109381570799958e-01; +2.721932265459063e-01   +5.015964749333945e-01   +1.447634330099945e-01   -6.106735018499587e-02   +9.835148336246169e-01   +5.276115707621627e-01   +4.538949318820948e-01   -1.153734985660465e-01   +3.495679682611375e-01   +8.727622370364382e-02   -1.075157182396641e-01   +2.198325316680171e-02; +3.589710646646171e-01   +1.715493152234080e-01   +2.035202528242884e-01   -1.252854300160755e-01   +8.514221062263565e-02   +4.066495539644426e-01   +4.483871934781120e-02   +3.381397954274967e-01   -3.348350400111551e-02   +1.660487030186282e-01   -2.343474395397844e-01   +8.764818194452828e-02; +6.138112700105723e-02   +3.048625537639487e-01   +8.287267221304154e-01   +5.603628663049384e-01   -1.332235732535132e-02   -1.996700583728232e-01   -1.158100644922696e-01   +5.120519461652872e-01   +3.480223598848567e-01   +1.420591631826498e-01   +1.398187461502870e-01   +7.543661846286398e-02; +7.815611114337867e-02   -5.468431690598051e-02   -1.963673230513105e-01   +9.012094302581780e-02   +2.364958889364659e-02   -1.259493967362199e-01   +5.710998398797312e-01   -1.790979873292084e-02   +2.606225546161623e-01   +3.613506788770413e-02   +1.852362376974429e-02   +6.266501079297496e-01; +2.446972914821006e-01   -2.196825428498468e-02   -2.395922365097200e-01   -1.542225127146458e-01   +1.408809845599252e-01   +4.094819152258550e-02   +3.133192045953264e-01   +2.342079382111525e-02   +1.151389559769216e-01   -1.209030052910712e-01   +1.985718265187963e-01   -4.072751076400776e-02; +3.100037724614826e-03   +2.199427956855913e-01   -2.046193079303638e-01   -1.510001968906423e-01   +4.322514174379908e-01   +4.240842680933702e-01   -4.808419972114227e-02   +6.196040627533594e-03   -2.677375747592662e-01   -3.009869008591853e-01   -1.197507910408318e-01   +2.294529433368198e-01; -4.299128602228614e-01   +5.350902685722234e-01   +8.574062040200857e-02   +5.579875860611617e-01   +1.143848925096270e-01   +4.165510622747842e-01   +4.934437377740402e-01   +4.529005732464142e-01   +1.691775287535091e-01   +1.811102752332698e-01   +2.841639525963046e-01   +5.345540385802683e-01; +8.041190048583539e-01   -5.685763120394487e-01   +7.303215959293832e-01   +1.720678917738880e-01   -5.274459584259342e-02   -1.902057481950509e-01   +3.416841239522789e-01   +1.447588843323941e-01   +2.174730897841533e-02   -2.179119755006615e-01   +6.642024661785001e-01   -3.326879138133759e-01; -3.294958909224103e-01   +4.736222421620719e-01   +4.647397106904881e-01   +2.298757801061958e-01   +1.943300976121650e-01   +3.038251960306341e-02   +3.974813675213021e-01   +7.716834306115469e-02   +5.849868131240616e-01   +7.562940577281263e-02   -7.358859796570960e-02   +3.235153032207172e-01; +2.358515108952684e-01   +8.840968874007388e-02   +4.275008648405942e-02   +5.963713824057671e-01   -1.591051611326493e-01   -2.048900340667331e-01   -4.211259719069127e-01   +2.527875363271951e-01   +1.744815751882838e-01   -2.754851232980469e-01   +2.527322768720028e-01   -9.959461800280782e-02];
L3E_L3I_iGABA_netcon = [-8.403206901194368e-02   -4.607282963189852e-03   +2.551620385585372e-01   +4.030420807355597e-01   +3.992253829042307e-01   -7.073990603512560e-02   -3.723080899785696e-01   +2.147832129675650e-01   -1.654901206509509e-01   +6.976768719667729e-01   +2.791766671531279e-01   +7.059582058467814e-02; +2.320282014509714e-01   +1.337296987206839e-01   +5.053723013152620e-01   +2.423734877720264e-01   +5.216186869873087e-01   +1.557567710537774e-01   +2.911864071927631e-01   -5.563175147196080e-02   -5.092911165976953e-01   +1.513096090957979e-01   -6.838222893580508e-01   -6.062300621455850e-02; -1.192426880809994e-01   -1.897593995184365e-01   -3.594143743703805e-01   +4.722189214440814e-02   +9.356659466513202e-02   +2.594345972403636e-01   +4.085529327282419e-01   +1.215448351941199e-02   -1.976091673204972e-01   +3.126528109437398e-02   -3.042770001376793e-01   +1.561055349614479e-01; +2.594466420622870e-01   +1.234486690674063e-01   -2.501917781248940e-01   +7.622476534851179e-01   +9.151085809298604e-01   -2.265272986314383e-01   -6.007121086186341e-02   +1.681381426793889e-01   +8.636855791768688e-01   +4.784359952666047e-01   +3.001609117517124e-01   -3.216487945649795e-01; +1.620993964224795e-01   +1.961808645052057e-01   -2.433941278299587e-01   +8.049779524789950e-02   +1.083599653390332e-02   -1.972456072993231e-01   +3.212909361850279e-01   +4.058781841441285e-01   -3.176075442956391e-01   +6.786916405507002e-01   +3.073098578864213e-01   -1.719059313920972e-01; +3.296910024919375e-01   -3.584620930130157e-01   -3.237494959473247e-02   +9.096917092393683e-02   -2.567993815400488e-03   +7.246211982050856e-02   +3.941773136702491e-01   -1.233940944029273e-02   +3.525671240117658e-01   +2.016798683920875e-01   -6.840225751028929e-02   +4.207384579731846e-02; -1.738399797705519e-01   +1.498856549850707e-01   +2.739905330962206e-01   +8.428718996052124e-01   +1.433421006079754e-01   +3.677790313748099e-01   +3.674830134513048e-01   +6.506435769304119e-01   +7.131066254695351e-02   +2.754102266666819e-01   +3.698530734768739e-01   +3.177604645766302e-01; -4.669065844659579e-02   +4.309706052420820e-01   +6.302930889793389e-01   +2.566786545273199e-02   +1.251606734840904e-01   -4.819707211113506e-01   -5.601576322120402e-01   +6.011531867545439e-01   -1.064640375947211e-01   -2.446477853382487e-01   +5.329536805510936e-01   +2.582339213793130e-01; +6.800046869011974e-01   +1.493874587689816e-02   +4.013344876575405e-01   -2.029959995206153e-01   +4.429317343751913e-01   -8.271124047868535e-02   -7.408227119916159e-01   -3.461299421970893e-02   +5.293398390372427e-01   +2.477235914333288e-01   +1.050075530175696e-01   +5.014099806301660e-01; +2.027199036244151e-01   -5.402772901656497e-02   +4.204184295347906e-01   -3.521099174368116e-02   -6.745096126266814e-01   -9.441351165929106e-02   -4.241528050901678e-01   +1.700087318901542e-01   -2.768039251362437e-02   -7.571541256416317e-03   +1.648263034313271e-01   +2.009576131065244e-01; +3.625101022440547e-02   -2.326900164036816e-01   +2.319113708640012e-01   -4.168270096791813e-02   +1.531933068964744e-02   -1.430899225146817e-01   +2.888795201523296e-01   -2.088388375188866e-01   -2.740010281827909e-01   -3.019177787649810e-01   -3.508847495076303e-02   +4.039032464379789e-01; -5.421765802804160e-02   -4.732471272943989e-02   -4.549452466043908e-01   -1.157611030550150e-01   +9.854666987133812e-01   +4.248986244346962e-01   +4.178311956973091e-01   +3.001844373024107e-01   +1.354241067986954e-01   -2.966568556063505e-01   +2.726033199686857e-01   -4.721205006142645e-01];
L2E_Input1_iAMPA_netcon = [+8.475505601986796e-01   +1.000000000000000e+00   +6.366776139297008e-01   +4.165787414184346e-01   +4.404590393853263e-01   +2.863081390085620e-01   +7.437073020780451e-01   +5.613199369473969e-01];
L2I_Input2_iAMPA_netcon = [+7.100173359637836e-01   +7.370966196210439e-01   +4.845654640559923e-01   +1.245015005922968e-01   -8.901310098215787e-02   +9.094395716450399e-01   -7.452720878895674e-02   +1.100116989670741e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
