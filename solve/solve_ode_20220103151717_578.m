function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.691120571577097e-01   +3.076321939381619e-01   +5.960646003853909e-01   +1.666307431701398e-01   +3.845229441195571e-01   +7.740290130955341e-01   +6.584178976746121e-01   -2.537043731998700e-02   -6.229770201010656e-02   +1.514787730609719e-01   +5.354794103418209e-01   +5.389489793142072e-01   +4.441188488210161e-01   +3.989225059292665e-01   +7.542301015518295e-01   +4.838112664755098e-01; +4.645356944055397e-01   +1.230314493850863e-01   +3.098818550520645e-01   +3.705967226251665e-01   +4.364832018476275e-01   +2.693422788277211e-01   +2.857039887381028e-01   +5.029495323408424e-01   -1.332371211419666e-02   +7.747275496977810e-01   +4.422472246483147e-01   +7.027541206660166e-01   +8.447611685907905e-01   +3.094993015433756e-01   +6.898019226298989e-01   +4.292815022742873e-01; +1.434872173437808e-01   +3.755177293834849e-01   +6.262006476440847e-01   +7.382203937754085e-01   +8.773562356154521e-01   +2.248671355691821e-01   +2.483762227627865e-01   +5.588921193871407e-01   +6.264468885182954e-02   +3.091809614861462e-02   +5.459103800553970e-01   +8.287469310817117e-01   -1.237778718223512e-01   +2.856759080382352e-01   +6.102240255582936e-01   +1.422410583813525e-01; +4.193207160548545e-01   +7.022698908067456e-01   +7.241513204143389e-01   +8.187337551000335e-01   +1.281962484999482e-01   +5.451892509433914e-01   +8.986515295754118e-01   +5.288095713177613e-01   +7.504307334739366e-01   +3.707455527658466e-01   -9.532624457684166e-02   +4.991203007483931e-01   +5.635958077893735e-01   +6.550980164793747e-01   -8.938831720990362e-02   +2.970631238800094e-01; +2.443636050009759e-01   +6.130232491598430e-01   +1.698829282175925e-01   +4.147429252815766e-01   +2.527322847963441e-01   +9.124362530404329e-02   +3.110123460303831e-01   +4.758927635662074e-01   +6.923261091597105e-01   +2.190464918234465e-01   +6.142392438362481e-01   +6.105142720056965e-01   +5.896892639043202e-02   +5.285571005789729e-01   +4.135044410858972e-01   +2.297338536523046e-01; +9.226305319866155e-01   +7.354579842465604e-01   +4.913400962440719e-01   +2.447664208739262e-01   +3.209343275118819e-01   +6.957699220532443e-01   +7.944027517510129e-01   +1.548118145259882e-01   +1.018570883979363e-01   +6.974269210898697e-01   +2.681855134439313e-01   +8.290989236012063e-01   +5.883594602786959e-01   +5.645034175714440e-01   +9.245008581097446e-01   -6.529183606442306e-02; +6.590165390415630e-01   +6.097059467071471e-01   +5.493957432793111e-01   +4.479948687672519e-01   +5.160675079948907e-01   +4.229163135793181e-01   +5.809876867583331e-01   +3.294935366601638e-02   +1.344296296289974e-01   +2.180837305679480e-01   +3.240174127989069e-01   +4.627418267293172e-01   +7.054768759675254e-01   +4.284396437105747e-01   +6.236954234065442e-01   +1.392994315820101e-01; +5.138461013677136e-01   +4.881603024563361e-01   +1.077482742027139e-01   +1.367563763097447e-01   +2.739128312596685e-01   +2.246136418442317e-01   +5.124203495043442e-01   +4.467147808105489e-01   +1.084079762238540e-01   +3.357774651558383e-01   +3.757008894183179e-01   +2.231019959590668e-01   -8.396168324995115e-02   +6.514170754756745e-01   +1.887128491984078e-01   +9.669282979381638e-02; +6.829929139681571e-01   +2.232726338414431e-01   +7.255843397629507e-01   +9.169580314746045e-02   +6.888640822500368e-01   +4.745407918807381e-01   +1.009478780199866e-01   +1.679338263067804e-01   +5.899796726534200e-01   +2.331813155004594e-01   +3.723634540666321e-01   +5.307588433025704e-01   +6.492374184909904e-01   +6.050960996300158e-01   +4.341821564725608e-01   +5.355543428090543e-01; +1.303352364756991e-01   +6.465914892108209e-01   +3.710711987765650e-01   +3.370650003058654e-01   +5.635886254372642e-01   +9.658425442475254e-01   +5.404942118315869e-01   +3.878543842624035e-01   +3.486243918437830e-01   +6.756024037026459e-02   +3.988237106841506e-01   +5.444293060230270e-01   +2.875604708532637e-01   +2.537636184121086e-02   +3.634506834569226e-01   +2.514137880055337e-01; +2.051396067202917e-01   +8.939093531703769e-02   +3.779883796137730e-01   +5.338432390995839e-01   +5.932678098663420e-01   +7.324990646866896e-01   +7.697640046701660e-01   +2.674959531873687e-01   +9.187641074335159e-01   +2.278205268688413e-01   +5.471831035442575e-01   +4.708252527709152e-01   +1.576828020191230e-01   +1.118426956980158e-01   +7.003475901701826e-01   +3.006040214422484e-01; +3.804002219377349e-01   -9.718055214641481e-02   +1.455127766303730e-01   +3.475417278173389e-01   +1.200690983588813e-01   +7.345427917703700e-01   +2.860966946012503e-01   +8.259336401484368e-01   +7.214374546064464e-01   +7.019757542200563e-01   +3.682574266601443e-01   +7.527532362502437e-01   +4.247546419873074e-01   +2.111956010425662e-01   +6.277953325591302e-01   +7.364927080682461e-01; -6.904244619973845e-03   +4.970350177123626e-02   +6.786848139163779e-01   +2.220484378276483e-01   -4.157385440195207e-02   +5.663664784111984e-01   +5.533735983599423e-01   +6.957695688653166e-01   +8.072588340268403e-01   +8.589131560937789e-01   +2.571956659531619e-01   +6.751575949820287e-01   +7.458791422677048e-01   +6.195558168627321e-01   +1.000000000000000e+00   +2.894596953803004e-01; +2.578039775519812e-02   +8.623700999776728e-01   +5.995443434679661e-01   +2.346342229146254e-01   +2.839285572232878e-01   +6.525973195089754e-01   +5.266667107547746e-01   +6.869994296771332e-01   +2.002479705905041e-01   +7.166817967496605e-01   +7.968002156105557e-01   +4.676705451725362e-01   +8.115117529896990e-01   +5.497416640274327e-01   +6.722644099063717e-02   +7.228501367911709e-01; +1.380101857948028e-02   +4.030391600320024e-01   +6.841839719557448e-01   +2.238465883315995e-02   +1.403827741900610e-01   +2.904753295204284e-01   +7.751855318998999e-01   +6.933846537631795e-01   +3.986023723887570e-02   +8.548771732798479e-01   +2.871301570290753e-01   +1.959439373047246e-01   +2.977104600506668e-01   +1.508462735939748e-01   +5.704826448200492e-01   +4.853976502123489e-01; +3.287445780577612e-01   +6.121353305631516e-01   +7.528918567098908e-01   +6.744896491060818e-01   +6.511401071959690e-01   +3.734719668515947e-01   +1.716111794581425e-01   +4.530337790386874e-01   +5.046822669784716e-01   +7.400295135168312e-01   +2.229094964902992e-02   +4.759524482701251e-01   +4.123094087192931e-01   +8.232853207445785e-01   +6.567576909439521e-01   +7.932801770045472e-01];
L1E_L1I_iGABA_netcon = [+3.818982317987395e-01   +1.604577926486418e-01   +2.655924771202158e-01   +4.805964907758531e-01   +3.439058631088287e-01   +3.977096912751658e-01   -1.949690683339432e-02   +4.268808075145492e-01   +5.730200940061735e-01   +1.877771829212562e-01   +5.952594328810581e-01   +4.741211630256674e-01   +2.729888943926615e-02   +5.602342319248997e-01   +6.490994035281424e-01   +2.505515733615526e-01; +3.314624426037057e-01   +7.797376298879725e-02   +6.734394008473352e-01   +5.608463477697345e-01   +3.715985350503130e-01   +1.276136147087256e-01   +5.217607092974321e-01   +3.843667284599613e-01   +4.426950260169350e-03   +3.542722866669507e-01   +1.917320871685458e-01   +3.932528822501827e-01   -4.143729890552111e-02   -6.629517025468011e-02   +5.506613220902085e-01   +3.241242334429620e-01; +4.357087569889648e-01   +7.637934987577182e-02   +4.669326313148223e-01   +5.559928380312495e-01   +3.914702055673565e-01   +4.647727769743367e-01   +4.229958503318482e-01   +5.267846895038145e-01   +2.858534330429156e-01   +3.144622682815506e-01   +4.166768892733256e-01   +3.908608383987132e-01   +8.496550762502542e-01   +5.376340388756160e-01   -1.350958596113744e-01   +6.604003851304204e-01; +5.550658767579054e-02   +7.578660970181867e-01   +5.746363604872607e-01   +2.091286096907085e-01   +7.414934187326200e-01   +6.670241768355892e-01   +5.290801017512117e-02   +5.743850428028952e-01   +2.444311880379993e-01   +5.095106086227348e-02   +4.917460880488412e-02   +2.561782827432544e-01   +1.333947218354124e-01   +3.836781508776251e-01   +1.509462064378003e-01   +4.933445235457919e-01; +2.057242230282298e-01   +8.582109112324518e-02   +7.391515908913765e-02   +3.889938819955422e-01   +6.585740027578993e-02   +5.199818155249891e-01   -1.284271509232098e-01   +2.482672855464966e-02   +1.459014061075674e-01   +8.436346124948138e-02   +1.440335513326609e-01   +8.263828601474270e-01   +3.186658001559553e-01   -5.370804003964118e-02   +6.224302007269813e-01   +9.416653216552183e-01; +5.327824874718501e-01   +8.427008515621467e-02   +1.279727297376785e-01   +3.067231647716671e-01   +1.986001423702455e-02   +4.451596034663146e-01   +2.553323364183150e-01   +7.305313495237921e-01   +4.281659994247007e-01   +8.849713793020682e-01   +6.859239249864119e-01   +8.437691217255817e-01   +5.690420713547615e-01   +4.448029717601438e-01   +3.303058444829356e-02   +2.740023226571959e-01; +5.446471495877624e-01   +1.480742966228564e-01   +3.859898535780942e-02   +2.848305713195854e-02   +7.096981232517370e-01   +5.392221834603974e-01   +6.760027212694468e-01   +9.258045005219893e-02   +3.214533636297541e-01   +8.305122739097524e-01   +3.144046337076919e-02   +6.419231968126162e-01   +3.741351266322500e-01   +4.809137096604593e-01   +1.662605362711039e-01   +1.692359172894021e-01; +4.126591432503611e-01   +1.466319811121898e-01   +6.805537478423522e-01   +9.629890355384183e-01   +1.049812550001877e-01   +5.232889789106426e-01   +1.769304705334882e-01   +7.073257876053588e-01   +2.621008293714154e-01   +2.085909188006995e-01   +3.151081293851468e-02   +6.346689418335915e-01   +4.687002047914678e-01   +3.875729775489276e-02   -7.346419618904529e-02   +5.472347136402487e-01; +1.137151995892282e-01   +7.309033507377374e-01   +4.208609579923943e-01   -1.014776393918160e-02   +7.349594564718728e-01   +3.893025728411145e-01   +4.238489662999169e-01   +2.771060107862716e-01   +1.842922895646243e-01   +7.793747615465972e-01   -6.047707484150165e-02   +7.385476335870184e-01   +1.951186034337774e-01   +2.905632746226772e-01   +9.721721120354364e-02   +3.497411969610426e-01; +3.727868575535641e-01   +4.071668005167304e-01   -3.622126813048891e-02   +2.366664524466393e-02   +6.542359645357377e-01   -1.306236212709650e-01   +4.521071565436450e-01   +8.747234714036014e-01   +2.187167659251521e-02   +6.803231716513097e-01   +6.586766696127502e-02   +6.788663399840755e-01   +2.476974756611867e-01   +3.266328778739787e-01   +4.147633686071260e-01   +7.511017325268728e-01; +8.113970317582970e-01   +4.618091541899444e-01   +5.744873516095068e-01   +6.913023243186449e-01   +6.182648945222798e-01   +4.583675634526873e-01   +1.129445934875629e-01   -5.839472438918751e-02   +5.703333288545419e-01   -6.291426503551568e-02   +4.323946169294765e-01   +5.108235280748173e-01   +8.103851865342065e-02   +8.657107058067470e-01   -1.309608576846548e-02   +3.874536284876849e-01; +1.692542770573999e-02   +5.324102542118583e-01   +2.721012591601708e-01   +8.745092965226442e-01   +7.329720357181296e-03   +3.145592045303773e-01   +2.726725966036656e-01   +3.285632493272387e-01   +8.297322170519181e-01   +3.681353656854562e-01   +5.619665257903635e-01   +7.413260332385151e-01   +1.994265019652206e-01   +7.160933436314828e-01   +5.519602795208494e-01   +4.213760037753815e-01; +1.610825889690885e-02   +5.719664782842010e-01   -1.692554695110272e-02   +5.799938972307309e-01   +4.271464359195476e-02   +6.078666340508937e-01   +4.213168733234254e-01   +4.352463653977414e-01   +4.253410715742447e-01   +6.262102786621343e-01   +1.891532500685331e-01   +6.265160752870663e-02   +2.900267281426640e-01   +2.981717929350874e-01   +2.364040647314949e-01   +7.746090638540156e-01; +8.066338703664047e-01   +7.667132527498243e-03   +4.437270804775996e-01   +5.906039906964785e-01   +4.116985015884732e-01   -6.267763889314265e-02   +3.448665046241263e-01   +6.095291044868118e-02   +5.894683836884693e-01   -3.397920924976193e-02   +4.933990871664386e-01   +7.072588122771675e-01   +4.399689617618380e-01   +7.216967958960925e-01   -6.795924075704010e-02   +3.743343416355403e-01; +6.452978166909951e-02   +4.356850356381869e-01   +4.349091715187160e-02   +2.160656727902825e-01   +6.109654247884850e-01   +3.591164689280923e-01   +6.767413984568055e-01   +5.425357194290424e-01   +8.170856461852696e-01   +6.408111295251808e-01   +6.558080254498239e-01   +3.374855109650424e-01   +2.662355868518418e-01   +9.006875964880556e-02   +3.332200356896611e-01   +2.754517437222531e-01; +3.542359575887766e-01   +1.406918366840286e-01   +5.542189171012922e-01   +2.982312818905779e-02   +3.551282324118715e-01   +7.014693890662224e-01   +4.667206032606961e-01   +1.833838070024283e-01   +6.738224135161404e-01   +7.068700311260354e-01   +7.215980136840553e-01   +4.471092618215208e-01   +5.131870861785779e-01   +1.214263716745299e-01   -2.431272494891109e-02   +8.061468459489082e-02];
L2I_L1I_iGABA_netcon = [+6.416242930700163e-02   +5.757550976630462e-01   +6.119447290927441e-01   +9.065201050026608e-02   +6.683971222045896e-01   +1.920374726611800e-01   +4.779895640533854e-01   +6.838237542594312e-01; +1.181586302309639e-01   +2.207070997673005e-01   +2.307613768918006e-01   +7.951727519994049e-02   +7.697046345301503e-01   +1.326238525355813e-01   +4.940546761947260e-01   +8.368160954705132e-01; +2.584356521873483e-01   +4.854336757995749e-01   +5.501215862151779e-01   +6.107987001377336e-01   +4.216014473296127e-01   +4.905609539063002e-01   +2.320400621320298e-01   +5.304628922657618e-02; +3.932974937369273e-01   +5.202785101094418e-01   +4.090334912845600e-01   +7.585317517669188e-01   +3.039265006886932e-01   +3.907633921300141e-02   +4.813246464117088e-01   +1.441054261236480e-01; +9.669435438591125e-01   +3.498169461426082e-01   +2.837673812911967e-01   -2.390703004004029e-02   +5.730721146270660e-01   +6.891899608851978e-02   +9.090531433402775e-01   +1.608567903247619e-01; +5.225746920822859e-01   +5.278178495057935e-01   +6.968350403254001e-01   +7.942967042077076e-01   +6.794675383044918e-01   +6.783428346725124e-01   +3.510091143341402e-01   +5.758709344393206e-01; +8.383215261434070e-01   +3.223964308649263e-01   +4.030902460987842e-01   +2.404974645687716e-01   +6.740128534608151e-01   +4.588460035195812e-01   -6.247103262650345e-02   +4.886509826276682e-01; +6.472440660422261e-01   +3.884200770805213e-01   +3.504114116917811e-02   +6.074936239627446e-01   +6.308531801318575e-01   +8.292504206276756e-01   +5.282186837189908e-01   +2.553795307476511e-01; -1.472215359742091e-01   +4.384715314093335e-01   +1.044644624285633e-01   +3.753570199979262e-01   +4.328989505232100e-01   +5.910820750599638e-01   +5.139609765023126e-01   +2.522628484803296e-01; +5.916608574644533e-01   +9.871609220935531e-01   +3.468109210911313e-01   +5.256403322435089e-01   +2.236392771976333e-01   +1.799535131774626e-01   +4.616745564212257e-01   +2.240252794080827e-01; +2.683216689565244e-01   +8.583645237467111e-02   +6.337361028985898e-01   +5.279078054512999e-01   -5.889616224062622e-02   +1.400395999418360e-01   +4.476687037358879e-01   +1.227112139331053e-01; +1.819209138864899e-01   +2.072550237662038e-01   +1.765396717956778e-01   +5.065439753836015e-01   +1.243061546432089e-01   +4.836999130235752e-01   +1.023920629705985e-01   -6.720384793049869e-02; +7.406084577555584e-01   +8.478163441430749e-01   +2.341767212134545e-01   +4.602279817474886e-01   +3.886687913512286e-01   +1.807936680375212e-01   +3.614455966473883e-03   +7.426849581460772e-01; +3.709541185747815e-01   +8.664668593925222e-01   +2.493719883762582e-02   +1.316424482212833e-01   +4.445565174774267e-01   +4.703622002954612e-01   +5.746391711046591e-01   +5.090275507620298e-01; +2.995594777504547e-01   +2.562005259696445e-01   +3.082900029456705e-01   +2.558474359431049e-01   +4.900723224532479e-01   +1.462170966574981e-01   -4.785227283446263e-02   +4.835742833078106e-01; -8.366246334426027e-02   +1.301275971995579e-01   +2.537222976041436e-01   +1.599610576789531e-01   +3.609017255595136e-01   +7.013349295506024e-01   +2.268593078619310e-01   +3.851028879211682e-01];
L1I_L2I_iGABA_netcon = [+9.209660148681983e-02   +6.526038798557587e-01   +2.451505315973587e-01   +1.286743176358803e-01   +8.065899946065536e-01   +7.884155585550713e-01   -1.287798228682450e-01   +1.700778560897296e-01   +1.634297980912658e-01   +6.276675027262120e-01   +5.625230242460945e-01   +3.916455494384091e-01   -1.129792996346188e-01   +3.574355904529884e-01   +6.952888611120639e-02   +5.812038116664349e-01; +6.639123989087120e-01   +4.860362301387962e-01   +3.469596624489139e-01   +1.909430631388455e-01   -3.590047664353057e-02   +2.089877615180362e-01   +4.622765113117788e-01   -8.067940345163654e-02   +2.447182859379257e-01   +1.570507890913663e-01   +3.382527531667032e-01   +2.057008343036080e-01   +5.995395166657281e-01   +4.641241385876324e-01   +1.000000000000000e+00   +1.005880915028383e-01; +3.191644119300180e-01   +3.629894980414080e-01   +8.816543084996764e-01   +2.579789837338356e-01   +1.630389040684158e-01   +4.100092855081055e-02   +7.056010623220080e-01   +4.468400900129976e-01   -1.646977341749074e-01   +7.194911625739639e-01   +1.742984197771967e-01   +3.146897742573481e-01   +6.972288903990295e-01   +5.434780550008764e-01   +1.269104344810634e-01   +2.156820925903814e-01; +5.726740204198374e-01   +4.407524785070362e-01   +3.468406386160033e-01   +2.517665801380410e-01   +5.956587873485246e-01   +4.216942491022949e-01   +4.278747719708163e-01   +1.195109867570766e-01   +4.091713447879878e-01   +2.478336449010023e-01   +1.886537813237012e-01   +1.970920393465629e-01   +3.379016162132427e-01   -1.836070600745844e-01   -4.196930593320404e-02   +3.544970842716894e-01; +5.991407234677799e-01   +5.663029550751778e-01   -1.223149394012699e-01   +7.770200100664256e-01   +5.016064718294625e-01   +3.945780060342274e-01   +4.872933112493260e-01   +7.224445009664171e-02   +7.937784751301145e-01   +4.850595577351388e-01   +6.623315324561752e-01   +6.844197976645668e-01   +6.599516017898928e-01   -9.093394879389635e-02   +6.063047727746625e-01   +6.678106613175547e-01; +3.042105037316349e-01   +2.015420264549048e-01   +8.029872544176233e-01   +1.843156343950004e-01   +7.789025859887827e-02   +4.565420925328258e-01   +5.515862851586273e-01   +6.816067144068876e-01   +6.681971479008397e-01   +4.556577155151910e-01   +8.074405746553199e-01   +5.157232665155801e-01   +5.488370429666244e-01   +1.110773616037736e-01   +2.913881124942337e-01   +7.920406347053305e-01; +2.026700133860785e-01   +1.195595797898803e-01   +2.399557889260559e-01   +5.853490480889348e-01   +4.418727526693325e-01   +4.692578647674502e-01   +1.000722280423326e-01   +2.730781491675460e-01   +2.016654223696428e-01   +1.677154129625173e-01   +3.371103269993915e-01   -5.962858979790088e-02   +4.471736106727365e-01   +4.120968741223612e-01   +6.695218091233607e-01   +6.970662287778930e-02; +4.040323793829412e-01   +6.917866267375079e-01   +4.159915596764913e-01   +1.228862896044872e-01   +5.020659076192163e-01   +1.820600708414284e-01   +3.945084811816621e-02   +5.200462782078513e-01   +5.402508259885068e-01   +3.496803405240422e-01   +1.770857801235139e-01   +7.950266430867177e-01   +4.253959000734241e-01   +6.140585430016448e-01   +3.721852841041015e-01   +4.090444584002420e-01];
L2E_L1E_iAMPA_netcon = [+3.445750740223460e-01   +4.832449171918968e-01   +5.820497736910133e-01   +3.738318038623156e-01   +3.327805212718631e-01   +6.972876815189816e-01   +5.732783989532267e-01   +1.352011232534381e-02; +3.021206739359174e-01   +2.419553771575929e-01   +2.780151881620850e-01   +3.634449449402095e-02   +2.902090081648229e-01   +3.240307974522822e-01   +5.815084548417284e-01   +2.384307177747847e-01; +1.513081307228829e-01   +6.788969783285262e-02   +7.365789663706691e-01   +4.535056212878053e-01   +2.985349125781510e-01   +4.327285740636218e-01   +1.301599469651505e-02   +4.536792866364061e-01; +1.216011505056106e-01   +2.665659064145778e-01   +8.928317809921995e-01   +1.742560966570181e-01   +3.278423179373481e-01   +5.553755485520551e-01   +1.337639512635365e-01   +2.537052929862946e-01; +5.690367261763517e-01   +1.781692772491672e-01   +5.337510685664008e-01   +6.657682202802555e-01   +1.388107371316382e-01   +4.844265486573736e-01   +6.117799206844441e-01   +6.616555768925360e-01; +8.585439151928642e-01   +2.508735665353860e-01   +5.142503283249025e-01   +4.833879623320875e-01   +3.125529618964674e-01   +8.511167088157230e-01   +5.727422280051652e-01   +8.285401513124178e-01; +7.520172945939642e-01   +7.022471723466143e-01   +7.937692402987950e-01   +1.671542558025599e-01   -1.192468015056523e-03   -1.722795424378628e-01   +6.713285405720993e-01   +6.918080599775107e-01; +5.898047250724365e-01   +8.053027484552132e-01   +6.640762489975155e-01   +3.852216286819951e-01   +4.859967417155148e-01   +6.997718354816649e-01   +6.892959084871372e-01   +5.563335831013602e-01; +1.289178929915101e-01   +3.528957140555980e-01   +4.891771917879341e-01   +4.749378146057305e-01   +2.233171042382316e-02   +4.941668163812141e-01   +5.256204884133266e-01   +8.481299991001994e-01; +1.268228134360919e-01   +6.546845265454133e-02   +4.385785235968578e-01   +2.558818515125898e-01   +5.461324306445298e-01   +3.469921339518798e-01   +4.152150958769569e-01   +5.495435733039858e-01; +4.243497091453736e-01   +8.293856829341860e-01   +3.620662214826846e-01   +7.448781583917084e-02   +3.707733608900463e-01   +6.354069116789113e-01   +2.245934354295111e-02   -4.540218109738303e-02; -3.761757904626191e-02   +4.573071304943830e-01   +7.617448319612763e-01   +4.519317754340504e-02   +1.816798160061474e-01   -1.697576846942296e-01   +5.209243367468862e-01   +3.651044438896499e-01; +9.840049574247664e-02   +4.929648406340389e-01   +1.000000000000000e+00   -8.227518518446393e-02   +5.076445873882578e-01   +1.485325280764948e-01   -9.733825915280808e-02   +6.490364716487471e-01; +1.894585066735283e-01   +2.385027613274414e-03   +2.494944899430879e-01   +5.421305195647974e-01   +5.264809110464003e-01   +7.811118940838542e-01   +1.717653759159443e-01   +8.036150136438250e-02; +5.583756826458185e-01   +5.905498188814569e-01   +1.822509414946005e-01   +4.329910752075670e-01   +5.295478557731178e-01   +2.298437167318088e-01   +4.375764531846261e-01   +5.323417092162117e-01; +3.971669042617512e-01   +5.545556769432166e-01   +2.205528379629252e-01   +4.824266688153093e-01   +8.574186332020518e-02   +4.616762889447821e-01   +2.809286003154255e-01   +4.688590387652101e-01];
L1E_L2E_iAMPA_netcon = [+5.950625360120527e-01   +4.591701549464374e-01   +1.547422619176653e-01   +5.819909605645773e-01   +8.717492221657696e-01   +3.423545891689884e-02   +3.526289412210963e-01   +6.242577123147767e-01   +4.346174072964833e-02   +3.224638765023578e-01   +4.652534545051675e-01   +8.521130726386978e-01   +5.097806577497712e-02   +1.456541322544870e-01   +7.804980744170067e-01   +2.954040061584012e-01; +6.021462484998617e-02   -6.375233800318800e-02   +5.177901478717321e-01   +2.870904774583674e-01   +2.656808330325242e-01   +4.557642393259362e-02   +2.912168824632020e-01   +1.325929447512917e-01   +5.479937288238880e-01   +8.822592274855673e-01   +4.541384776612596e-01   +1.298863483834908e-01   +8.642426557843198e-01   +9.308531893334687e-01   +4.026448543420242e-01   +5.267945414145765e-01; +2.361724334722018e-01   +7.337338136410093e-01   +2.497236986136972e-01   +6.764928205901058e-02   +6.536352307822418e-01   +1.012235401329655e-02   +8.838196497784768e-01   +6.340913733005056e-01   +6.515646077281881e-01   +4.562160597496815e-01   +6.019738065763445e-01   +1.297187843833955e-01   +4.756444464378329e-01   +3.789009637741503e-01   +8.967561492918763e-02   +4.144514855047219e-01; +8.193009297672841e-01   +3.363063881610300e-01   +2.808948978875951e-01   +2.315652834569368e-01   +2.560186268578002e-01   +4.233015051377255e-01   -5.859538276029287e-02   -4.005212230430027e-02   +7.476950327046534e-01   +3.856385479873751e-01   +3.989521827289770e-01   +1.305694081509742e-01   +4.741818336778871e-01   +6.551482943217737e-01   +5.019978049397075e-01   +4.788098483590188e-01; +4.899910293137522e-01   +1.432344320226245e-01   +2.157488494926061e-01   +4.719579034336727e-01   +3.824952274936892e-01   +6.041609987815174e-01   +2.389910697740548e-01   +3.178832976785670e-01   +3.392565912752911e-01   +4.154668195729727e-01   +2.515971443769368e-01   -4.532996604720151e-02   +5.535017013368132e-02   +6.177315977967396e-01   -2.410924254857780e-01   +6.780389431682239e-01; +9.666868594962967e-01   +1.332959880084572e-01   +1.978559494281255e-01   +6.765741378725415e-01   -7.099758460317909e-02   +9.127516025349305e-02   +5.061060128590915e-01   +1.868061434571809e-01   +4.283532911812080e-01   +1.456065397199502e-01   +3.643156112264946e-01   +8.235670795938835e-01   -1.354871947710389e-01   +1.001041609473388e-01   +3.619895483762461e-01   +6.241269627981552e-01; +2.219230034904189e-01   +1.102873138148716e-01   +2.966366787407961e-01   +2.808261679770216e-01   +8.226618890089451e-01   +4.558967481689997e-01   +1.143551085635568e-01   +7.078550974488865e-01   +3.094756114918806e-01   +8.520330978978410e-01   +4.711233730454392e-01   +1.275279489501862e-01   +2.015863129243129e-01   +1.343646291171446e-01   +5.467999071693150e-01   +2.001545970326243e-01; +3.266286009424498e-01   +1.985059050717725e-01   +7.194281680431808e-01   +5.031306416430798e-02   +6.635874572187844e-01   +1.969897455856223e-01   +2.036528543383920e-01   -1.208198974981524e-02   +2.070682095605963e-01   +7.331928527723695e-01   +4.574945484827324e-01   +3.527876887091963e-02   +7.776059610652529e-01   +6.463591552139053e-01   +3.036219776578767e-01   +2.620824925991806e-01];
L2I_L2E_iAMPA_netcon = [+5.420054485908599e-01   +8.038295291653335e-01   +2.738994544722748e-01   +5.784046869271307e-01   +8.398860803754991e-01   +7.084318324175518e-01   +6.977434323869739e-01   +2.191626357566053e-01; +9.115566060386907e-01   +5.211719192883580e-02   +3.782073661525259e-01   +6.456015042605376e-02   +8.065705238257760e-01   +3.348158774400504e-01   +3.108714460423156e-01   +7.335374208617484e-01; +9.757226254222061e-01   +2.914091611259117e-01   +7.428575804592319e-01   +4.613289255241058e-01   +2.625819527784967e-01   +5.752573704190196e-01   +9.622096384199760e-02   +7.930700119477627e-01; +4.062851503155034e-01   +7.308459261570824e-01   +2.695374263773258e-01   +1.747714762426609e-01   +4.118925246319100e-01   +1.901559573461954e-01   +1.017903382570136e-01   +3.269086415092948e-01; +4.298215572641395e-01   +3.451138402350170e-01   +6.032839128754535e-01   -5.534956845390064e-02   +6.252549274349375e-01   -1.770524275509881e-02   +1.771778844063137e-01   +5.128711166034278e-01; +2.738174956510801e-01   +2.434536540382025e-01   +5.871918149444180e-01   +3.624685547076032e-02   +4.887646742068332e-01   +5.571864558149238e-01   -7.991708157436771e-02   +3.086866431265194e-01; +3.880092427000668e-01   +1.078855737197046e-01   +4.356303116607034e-01   +5.422098574567229e-01   +8.612882482779667e-02   -1.419932687115426e-01   +3.443857524420040e-01   +5.434042059262089e-01; +4.074075625854212e-01   +4.956314615181530e-01   -1.366926860639648e-02   +6.705867518702521e-01   +7.742035476569787e-03   +8.093648058107492e-01   +2.411264293734366e-01   +6.126593878453589e-01];
L2E_L2I_iGABA_netcon = [+1.373740799652653e-01   +3.026125652138155e-01   -1.930648018581286e-01   +8.514341958019379e-01   +4.265168399595468e-01   +8.915907371703042e-01   +7.059269145958998e-01   +1.868819218546035e-01; +6.287441835259895e-01   +5.768466599954714e-01   +3.987882403935151e-01   +5.126681456256118e-01   +6.074971298507020e-01   +3.605180932761175e-01   +1.259049122761577e-01   +8.314819342729142e-01; +3.308483042469160e-01   +6.515515753274242e-02   +4.749976192099786e-01   +5.542707661878552e-01   +2.385101408361952e-01   +3.438860292373742e-01   +1.384234569870952e-01   +7.298670412353888e-01; -4.322954632302011e-02   +5.996098549372590e-01   -4.892939122824787e-02   +7.396700641246458e-01   +3.959935865399100e-01   +4.052257602714114e-01   +9.030946674432552e-01   +8.086012623432136e-01; +3.165798170555067e-01   +5.693562725574998e-01   +1.883542895996123e-01   +2.510510709608205e-01   +7.970078087888381e-02   +5.753218850174264e-01   +7.870934948514173e-02   -1.722523097686419e-02; +6.560259228002776e-01   +8.626585820152265e-01   +9.735653529370136e-01   +9.812529855974352e-01   +7.859002719285906e-01   +4.721249510775625e-01   +4.063830335135394e-01   +4.172377345281821e-01; +1.409584245350219e-01   +3.930128844003790e-01   +1.428389715840673e-01   -6.916921015900435e-02   +3.776047890921656e-01   -1.467465478734364e-01   +1.834657729176205e-01   +6.630459746744508e-01; -1.777158248026414e-02   +5.424216748579493e-01   +5.341019225463098e-01   +1.397613245729984e-01   +4.068179385456425e-01   +4.557228227350374e-01   +4.493202091284118e-01   +6.978334094464573e-01];
L3E_L2E_iAMPA_netcon = [+4.125397157498720e-01   +4.731894247994659e-01   +6.179618008034576e-01   +1.293626866329411e-02   -7.709178251201876e-02   +7.858000510105898e-01   +9.000657701868680e-01   +7.135254588229281e-01   +5.465248579026851e-01   +9.123700054115221e-03   +3.488710162222612e-01   +1.597187939410176e-01; -8.925633605242583e-02   +8.069669982825702e-01   +9.567609296720767e-03   +9.636778550798533e-02   +3.966820883913613e-01   -2.573383931798530e-01   +5.085106034842962e-01   +1.500784221294427e-01   +4.105084181869962e-01   +4.483013448703749e-01   -8.323548865256082e-02   +2.181574122840055e-01; +3.091556801390421e-01   +1.926844152208520e-01   +2.596247929359103e-01   +5.018427490260590e-01   +3.325511711841995e-01   +6.491723686045647e-01   +5.663888007045276e-01   +7.251156209786072e-01   -3.298526177968905e-02   +7.253548699923356e-01   +5.223016186541781e-01   +7.348799487507782e-01; +7.186841308556579e-01   +5.084864142515922e-01   +6.092066964317089e-01   +4.490196432749284e-01   +3.523095580007538e-01   +9.402038584327258e-01   +3.542541175717356e-01   +2.340686037720110e-01   +5.607528537189034e-01   -3.340579979287301e-01   +2.670368060314022e-01   +7.515355063008524e-01; +6.294543695942982e-01   +3.862254914492552e-01   +4.042201126415045e-01   +4.428370260702847e-01   +5.529168526677007e-02   +4.364465741581983e-01   +4.054019416031974e-01   +7.342541313464751e-01   +1.000000000000000e+00   +3.607211805390408e-01   +7.385821823512977e-01   +2.377129714128628e-01; +2.489829191033236e-01   +2.396036235553473e-01   +4.257334571312032e-01   -7.635512608605723e-02   +1.506352397016749e-01   +5.226045726535323e-01   +4.281586764230784e-01   +5.930954888321874e-01   +5.378185391654577e-01   +4.332832511633128e-01   +3.743386847982978e-01   -8.866170632087365e-02; -5.579346394250247e-02   +9.300462189763005e-02   +1.988697864831311e-01   +4.431145068430010e-01   +9.442941609690692e-01   +7.221673161095898e-01   +5.381727782159734e-01   +4.076858752800996e-01   +5.411215824674313e-01   +2.740726206221275e-01   +3.343061865617228e-01   +4.865559271710418e-01; +2.744103577569096e-01   -3.291589684955903e-02   +5.836512165101768e-01   +7.624482261150977e-01   +3.501407248970975e-01   +5.805484722462052e-01   +6.145249055311740e-01   +2.566781650935934e-01   +5.828091057576713e-01   +2.339358701049816e-01   +9.212386895365330e-03   +2.511975364615261e-01];
L3I_L2I_iGABA_netcon = [+7.356894834175897e-01   -3.603040959599114e-02   +3.579872975304396e-01   +6.272341461895201e-01   +2.784140838838068e-01   -1.869999704464498e-02   +2.211157084210419e-01   +3.039374327883488e-01   +2.638308476888145e-01   -3.306234806799959e-02   +1.951601928253218e-01   +8.982067418844895e-01; +8.416310343769554e-01   -6.157412956836063e-02   +1.496032804874000e-01   +5.237631503636707e-01   +8.835886901346537e-01   +4.250044837650676e-01   +4.105487858566461e-01   +5.498558758139933e-01   +2.842911567336792e-01   +4.848037418925007e-01   +1.184319012580926e-01   +4.224316927897051e-01; +7.772540415214684e-01   +1.553204750166378e-01   +7.392405834201999e-01   -1.531809101539274e-01   +7.096428232596068e-01   +2.952282442401608e-01   +5.935440789854102e-01   +1.113243801643833e-01   +3.419574229679014e-01   +5.216458942470101e-01   +2.956370265641556e-01   +9.915330618637016e-01; +5.038718715382964e-01   +3.803398410149508e-01   +8.176600809065225e-01   +9.691090748439063e-01   +4.823433690343880e-01   +5.941532140923018e-03   +7.756928691076943e-01   +1.965403213282981e-01   +9.124828875485960e-01   +9.054135516182055e-02   +9.443618411454827e-02   +6.050571043122728e-01; +2.482043883634282e-01   +3.101495490361214e-01   +5.115722038212729e-01   +1.901269735115473e-01   +5.426298083670841e-01   +7.037328598453594e-01   +3.429715118271319e-01   +1.991818256727814e-01   +7.370836935244525e-02   +1.189078529301483e-01   +1.000000000000000e+00   -4.814887934873131e-03; +8.453051423164990e-01   +1.458168024762385e-01   +6.021522054139441e-01   +8.643541354249034e-01   +6.380654038252778e-01   +1.264069703588236e-01   +3.491826935193784e-01   +1.408055947750593e-02   +4.049870710263426e-01   +9.147931573609641e-02   +2.122706624766885e-01   +1.902168530777930e-01; +5.434000359646954e-01   +6.310262691944225e-01   +7.980602302758257e-01   +2.982376978780822e-01   +3.229330670764327e-01   +7.329847535563885e-01   +5.269388499327564e-01   +6.466980387734172e-01   +1.779732880645294e-02   +9.467531416589402e-01   +3.294789774153978e-01   +7.249432131006869e-01; -4.768975334651637e-02   +2.550619275254460e-01   +5.834616108736577e-01   +4.992173931365305e-01   +1.773339081249927e-02   +1.516609537824173e-01   +1.637081786808331e-01   -1.442967111584693e-01   +6.216253221632473e-01   +4.893517600810216e-01   +3.363876982884780e-01   +1.100547142304526e-01];
L2E_L3E_iAMPA_netcon = [+2.673658952917274e-01   +9.856413483384957e-01   +3.916403590505487e-01   +6.904419199991831e-01   +2.854293604152320e-01   -6.430808057461324e-02   +1.456642623877578e-02   +2.560778075672752e-01; +3.467591914860508e-01   +4.812340740286846e-01   +5.388940249815054e-01   +2.783471275542543e-01   -2.736853801037532e-02   +2.018252316769315e-01   +5.283499117555405e-01   +5.448616213131091e-01; +5.154669857477588e-02   +1.961518573501602e-01   +9.999762128528265e-01   +9.291203163365703e-01   +4.689080643777679e-01   +2.532685805367660e-01   +4.785708317330096e-01   +5.972707019192189e-01; +3.075305611780065e-01   +3.268160848548925e-01   +1.867333754038831e-01   +5.909156499152876e-01   +2.614880512094488e-01   +7.355747226041326e-01   +5.097229642501160e-01   +1.453766529069544e-01; +2.635758151017158e-01   +6.537676945254146e-01   +6.119482754595590e-01   +9.265819377258220e-01   +6.774119444903889e-01   +1.625351440770879e-02   +1.442779802581893e-01   +8.946461444990882e-01; +9.487983792710404e-01   +6.393579084466656e-01   +2.663692330547807e-01   +2.434917593104955e-01   +3.915908534021703e-01   +6.179248346667805e-01   +4.774307705663866e-01   +7.688621387019277e-01; -2.688555418605295e-03   +4.787014761710643e-01   +2.138279786558833e-01   -1.965787142164962e-01   +1.641307420851819e-01   +5.016802234016060e-01   +2.384700881621012e-01   +1.247518463853945e-01; +5.470957596946914e-01   +1.386034728832636e-01   +8.986588651274794e-01   +2.380820293986186e-01   +1.150188332511204e-01   +3.058340153530558e-01   +2.310551997099633e-01   -1.820490082313165e-01; +4.691344211011582e-01   +6.386621482809621e-01   +5.868596771607563e-01   -8.062472402119857e-02   +4.380628375511229e-01   +3.543317349422904e-03   +4.240153068713484e-01   +6.478016348204005e-01; +3.102198505590587e-01   +5.724632764368600e-01   +3.117391448195549e-01   +5.158437003621034e-01   +6.184726293511339e-01   +4.450139047868612e-01   +6.929508313396616e-01   +2.430228916665895e-01; +5.667342901035328e-01   +3.732493484486556e-01   +6.840850330483278e-01   +2.859703433027636e-01   -1.778047194784375e-02   +1.453961901490962e-01   +7.446283778966509e-01   +5.487276870411327e-01; +6.810595411300121e-01   +4.583680228240795e-01   +4.951935856468305e-01   +8.042608651508624e-01   +2.950950818743940e-01   +6.020025264338703e-01   +4.337905866728178e-01   +4.275431494961808e-01];
L2I_L3I_iGABA_netcon = [+3.241696791879132e-01   +1.534711570409319e-01   +6.766787167492679e-01   +2.277692369989181e-01   +1.856985093489410e-01   +4.187487604069344e-01   -1.018511049437433e-01   +5.572656724767405e-01; +2.224517500347948e-01   -3.342659494547574e-02   +5.932229369334041e-01   +4.908882969894404e-01   +4.433848577269793e-01   +3.878721564825593e-01   +7.196058912530879e-01   +4.278116639023692e-01; +2.575028753357114e-01   +6.528795017146426e-01   +1.882553429988273e-01   +2.813837890792994e-01   -3.125606599138779e-02   +8.902666424362049e-01   +2.924816131633438e-01   +5.331864618330093e-01; +3.855580027157724e-01   +3.159090568589382e-01   -4.394499150452382e-02   +3.434138975225004e-01   +5.497525757375462e-01   +2.142326757998553e-01   +3.409370556016612e-01   +1.438961076377497e-01; +4.786031616246922e-01   +3.065635263498903e-01   +4.918545689262198e-01   +6.241148144391074e-01   +2.162017268201562e-01   +4.168399683218044e-01   -5.060622528872782e-03   +1.519574379294445e-01; -2.771701596929655e-01   +5.348210290838717e-02   +4.061630343456489e-01   +7.471284185863274e-01   +7.120697724957298e-01   +6.015242804782209e-01   +6.949984290468443e-01   +1.819080820248029e-02; +3.512659780052335e-01   +2.349691699193083e-01   +3.653626516168875e-01   +4.967284918882026e-01   +1.671747333364141e-01   +7.930188564447953e-01   +7.596970888456555e-01   +1.000000000000000e+00; +3.953081851814356e-01   +4.334087048603265e-01   +1.938178959139464e-01   +2.847950002572743e-01   -1.481260483934882e-01   +6.891027737650225e-02   +1.384490884663667e-01   +1.524241824267325e-01; +2.553448317427815e-01   +2.352087044888843e-01   +1.093436553530770e-01   -1.997092779161249e-01   +5.329518923556098e-01   +9.467043708390456e-02   +1.184148210142359e-01   +3.146623619264757e-01; +1.362767761126711e-01   -1.661931257820214e-01   +6.139957642651883e-01   +5.051005642411523e-01   +6.169686715345514e-01   +7.158734151602899e-01   +6.255922007375625e-01   +1.868421858993968e-01; +4.131950405355484e-01   +3.106151381079056e-01   +7.117138388527968e-01   +1.293200260259415e-01   +6.458498628872232e-01   +3.995657364833576e-01   +6.405241755130824e-01   +1.992931516798457e-01; +5.398909626362808e-01   +1.480874532261778e-01   +1.894390221787458e-01   +9.843349022944917e-02   +4.969141153062736e-01   +7.454722904186027e-01   +2.400566286849075e-01   +8.816996950191347e-02];
L3I_L3E_iAMPA_netcon = [+3.728784381789959e-01   -5.334785967717024e-04   +3.746911813661455e-01   +9.446131269801226e-01   +9.458104063870871e-01   +2.450222447485537e-01   +3.890951359476845e-01   +1.086541789313906e-01   -1.550558270277855e-01   +8.815051704248962e-02   +4.755607618205189e-01   -2.322390017318228e-01; +3.014750786847996e-01   +5.995688675371325e-01   +4.689248842905456e-01   +5.020867595011332e-01   +1.785461108157896e-01   +1.096790156408792e-01   +3.690011553845232e-01   +9.504184967042137e-02   +2.340767931576411e-01   +4.974450465586543e-01   +4.216669320350496e-01   +7.195944158581891e-01; +1.343174123257920e-03   +8.388439783915255e-01   +5.684304449632379e-01   +3.821946505505069e-01   +4.957254315056560e-01   +1.599824073454308e-01   +4.037861735818170e-01   +4.572128604610635e-01   +2.038894679416794e-01   -2.050047123497422e-02   +7.727667335566816e-01   +3.025220899093390e-01; +5.018185262579758e-01   -7.152891496050347e-02   +6.943727079774632e-01   +1.477216907047907e-01   +8.767631343422317e-01   +1.593368597046317e-01   +9.252918921942062e-02   +4.780034809065637e-01   +4.556567576186721e-01   +3.740633749367562e-01   +4.529195868706761e-01   +1.292609456055482e-01; +2.449103103741494e-02   +7.675195915139663e-01   +1.256866707813730e-01   +1.542820904735547e-01   +7.189160252873298e-01   +3.047964784075217e-01   +1.287933130125164e-01   +2.477195830456281e-01   +7.880958109031025e-01   +1.002027261071629e-01   +4.100494007555151e-01   -1.489250414226212e-02; +1.627288317363162e-01   +2.283896925010060e-01   +7.514412285575812e-01   +2.274887863191273e-01   +2.207058409654546e-01   +4.566783664027234e-01   +2.521621029371079e-01   +2.050656778539063e-01   +6.670033852355581e-01   -1.462939624148471e-01   +2.697910722372361e-01   +7.677880636727185e-01; +1.298323906870426e-02   +8.665206387970811e-01   -2.574942374251281e-02   +5.335823820745536e-01   +3.546776084912902e-01   +4.657698094460646e-01   +4.132876336552148e-01   +2.245324143804018e-01   +6.745692349076374e-01   +9.090981892234088e-01   +3.016464268933189e-01   +6.962969459911731e-01; +1.497582983741350e-01   +5.785857705435400e-01   +6.766707299659792e-01   +5.216929905307686e-01   +9.966317976102358e-01   -1.011691529400002e-01   +1.000000000000000e+00   +2.966561754946453e-01   +9.099590020503939e-01   +6.040820680522783e-01   +6.653389175992184e-01   +5.080446680776551e-01; +7.866212348523143e-01   -4.020744321838067e-02   +6.194733981185835e-02   +5.864876066939204e-01   +7.972340798885039e-01   +6.155250070294074e-03   +6.538413505973771e-02   +4.135879207163087e-01   +5.090739086386927e-01   +9.774855282359620e-01   +5.221957803654431e-01   +3.924158453212994e-01; +6.742178819280812e-01   +4.946591228595109e-01   +4.408205596720322e-01   +4.552996844458393e-01   +3.290937273733162e-01   +7.415448063396896e-02   +9.293336693073696e-01   +6.396120455848515e-01   +4.192117221435082e-01   +2.680282612403725e-01   +1.548237035912473e-01   +6.056994063171577e-01; +2.670855100233755e-01   +5.384764088677012e-01   +1.415138333750655e-01   +4.878219671588719e-01   +6.500336010342650e-01   +1.027445664034795e-01   +6.559444737974837e-01   +8.139253150035313e-01   +1.301352296258435e-01   +6.159927673396740e-01   -1.901927903381032e-02   +9.337620809325112e-01; +4.570150345929708e-01   -1.472064981107236e-01   +3.983706489155827e-01   +7.368084266088781e-01   +9.075400141038074e-01   +3.740371328067475e-01   +2.501617167293197e-01   +2.992235351787639e-01   +8.173335478928617e-01   +5.564438644100586e-01   +2.416748095274011e-01   +4.934224620173812e-01];
L3E_L3I_iGABA_netcon = [+8.832867268687122e-02   +4.671552095834472e-01   +3.474822683640466e-01   +4.886338597249632e-01   +7.153294283295781e-01   +4.782843651394854e-01   +7.637358744325696e-01   +9.032557081123581e-01   +9.034731220967543e-01   +2.450282491710337e-01   +2.379278860489037e-01   +5.351004902763465e-01; +5.677641774330395e-01   +6.743090089328957e-01   +6.265760441716387e-01   +7.766571888724821e-01   +4.061681195752220e-01   +1.761164008764323e-01   +6.689181084492841e-01   +7.663313060604219e-01   +7.200670288864200e-01   +6.937519557969859e-01   +2.537821608927697e-01   +4.450954460049975e-01; +3.855509549707314e-01   +9.689905789152938e-01   +1.795846683145375e-01   +7.993912648329108e-01   +1.331896543446206e-01   +4.727996567399728e-01   -3.762650670124598e-02   +4.377033475827085e-01   +1.319092409539820e-01   +7.987110610485341e-02   +1.028211432225496e-01   +1.463726581749755e-01; +1.548485245101787e-01   +5.562416706864273e-02   +8.457665947379077e-01   -4.334244321194542e-02   +1.558580455845942e-01   +8.160351461428295e-03   +8.350245055042284e-01   +3.872521106429822e-01   +6.169252939553627e-01   +4.408186655362415e-01   +7.229671676900247e-02   +2.051526414209549e-01; +8.411907519480055e-01   +6.263175895192196e-01   +9.113447468186249e-01   +3.508019985885014e-01   +5.659968296826590e-01   +5.836124211641577e-01   +6.342225459711397e-01   +1.000000000000000e+00   +1.153967212935584e-01   +8.870268814671841e-01   +4.683523636454623e-01   +3.875829579843155e-01; +9.044676724437419e-01   +7.673717528110546e-01   +3.987164256111506e-01   +5.296164556267963e-01   +3.512242565516007e-01   +8.240254519153165e-01   +3.284353503452738e-01   +7.673977206917153e-01   +2.295256299954011e-01   +5.427498617876160e-01   +5.834868329624592e-02   +1.526282176430923e-01; +6.298748097193034e-01   +6.569013057115205e-01   +1.459092496870894e-01   +9.545971211042513e-01   +3.897965605075187e-01   +2.302781852264518e-01   +4.460919721986659e-01   +2.373675372203241e-01   +1.985601760409334e-01   +2.756797609686935e-01   +9.768581852194839e-01   +5.522268045780957e-01; +7.715339966565278e-01   +1.986717475639584e-01   +3.942782194566894e-01   +4.543305512164759e-01   +7.262943848385315e-01   +2.797643138092080e-01   +1.591900408354619e-01   +4.301758466899256e-01   +3.897798131985137e-01   +8.205484680416190e-01   +1.552963495880809e-01   +4.748510787074160e-01; +3.124420880969285e-01   +2.374427245246638e-01   +6.236393055645738e-01   +6.027882158728496e-01   +2.081621037456664e-01   +5.634985052551718e-01   +2.529066706714803e-02   +6.069113011704443e-01   +2.740151425953969e-01   +1.434651985288183e-01   +9.138734271902548e-01   -9.348901840254556e-02; +2.647679508310072e-01   +6.587427883124116e-01   +3.267124906656730e-01   +3.147133154730005e-01   +1.030856546856651e-02   +6.107876405593629e-01   +6.179511656336090e-02   +7.446377657901784e-01   +2.002531688664946e-01   +4.397780481731949e-01   -1.635516677945389e-01   +1.368573327009033e-01; +8.324545761776195e-01   +2.286387421038647e-01   +7.829750872197465e-01   +2.247259771598677e-01   -7.287605187974651e-02   +1.990132223628547e-01   +5.427613823834364e-01   +1.938194554378657e-01   +1.794171119465660e-01   +1.740199108794265e-01   +4.968972735473185e-01   +4.361875211429774e-01; -2.417022916813975e-02   +3.529284432853621e-01   +7.407321421652823e-01   +7.094161802059010e-02   +2.333974052974917e-01   +4.620477980544479e-01   +7.337401431402556e-01   +6.589192514013903e-01   +1.970046019902923e-01   +1.463747403720909e-01   +1.993822158916416e-01   +3.381178694230608e-01];
L2E_Input1_iAMPA_netcon = [+8.799106917985072e-01   +7.281329875082454e-01   +6.989930200695612e-01   +8.356287102460920e-01   +8.281865984717318e-01   +9.543086619888325e-01   +9.388400169481294e-01   +7.912071196588704e-01];
L2I_Input2_iAMPA_netcon = [+8.760381288254852e-01   +9.117015617583465e-01   +8.208135153070530e-01   +7.821366743172907e-01   +7.203558638404689e-01   +6.225404821606396e-01   +7.297954473442627e-01   +8.862997944442269e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
