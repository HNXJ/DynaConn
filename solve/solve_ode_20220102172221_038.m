function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.900843472526584e-03   -4.794486482836650e-03   -8.291160993160300e-04   +1.863750749919052e-03   -2.037276293020107e-04   +5.540012734813096e-03   +7.587566379632263e-03   -3.861074761823391e-03   -7.034837077915837e-04   +5.997420753679357e-03   +2.558613736011900e-03   -1.113897840708106e-03   +6.471846258438499e-03   +3.465413036964300e-03   +5.987856355656201e-03   -2.091907325276221e-03; +3.983137327420972e-03   -1.579159341851153e-03   +8.272173298691980e-04   +5.359436301659973e-03   +2.431302267679629e-03   +2.692524083541397e-03   +7.132644586192349e-03   -2.463741328540587e-03   -7.529447548911026e-04   +8.648758063522399e-03   +3.510228832601725e-03   +1.259972078565565e-03   -5.624679024331217e-03   -4.399671754984466e-03   +1.514568488316432e-03   -6.662060253635828e-03; +4.451971259674678e-03   -2.022408523964415e-03   -1.802057942505183e-03   +5.365391671089600e-03   -1.963313004200942e-03   +5.614917159465281e-03   +4.684290504306545e-03   -1.625636616155909e-03   +6.403158815244891e-03   +7.845306701857235e-03   +2.713911546201945e-03   +3.074116818041080e-03   +5.942801631063989e-03   +5.923534260187958e-04   -1.230731442978654e-03   +5.187618138754262e-04; +1.499600849544874e-03   -4.212118028555190e-04   -2.045934150065496e-03   -2.871947117914755e-03   +3.070750683384924e-05   +4.274265826566645e-04   +2.073447719594781e-03   -9.693988012645865e-04   +3.387438488605374e-03   +6.748732572599747e-03   +7.032314800345446e-03   +2.738001941266627e-03   +3.600605005481473e-03   +2.416129527852440e-03   -5.337394951061907e-03   -6.188943810911401e-03; +3.748095515731320e-03   -1.728649239669491e-03   +3.652381738616864e-03   +5.853617889998442e-03   +1.048818708392342e-02   -2.762128805698911e-04   -5.667261049804108e-03   +4.514023516214468e-03   -2.597997940798806e-03   +6.135230737730797e-03   -2.224863151309987e-03   +9.123491415339557e-04   +5.467206493935356e-03   -1.102278430056977e-03   +2.039003455267562e-03   -1.354658542459087e-03; +3.990166937640092e-03   +3.851301376096594e-04   -1.890845898048902e-04   +2.835050935937769e-03   +9.577302033990893e-04   -2.864101762558004e-03   -3.570600139374134e-03   -3.388788474657172e-03   +2.631172563860424e-03   -5.436490556683976e-03   -1.757793391658251e-03   -3.910866739258801e-03   -5.052641272320707e-03   +1.871555544053143e-03   -2.784945337183654e-03   +2.406272066217094e-03; +7.381866636569391e-03   +2.641732750903589e-03   +2.478785490329824e-03   +1.680909702772223e-03   +8.969739141405561e-04   +5.058387798936175e-03   +2.632989656313112e-03   -3.294268968826055e-03   +6.126244977825381e-03   -3.935159465211453e-04   +5.870038306462095e-03   -1.576038738968619e-03   -2.708780592077146e-03   -5.549220657145865e-04   +3.668220813270620e-03   -3.808475885152887e-03; -3.420362539741902e-03   -6.157359156369382e-03   +4.119285943725882e-03   +3.109565149388014e-03   -1.202969932671401e-03   -3.212488848279124e-04   -2.788136508428751e-03   -1.939073380194808e-03   +4.860383926537158e-03   +9.166912205603360e-04   +6.810532500773138e-03   +8.428191469507920e-03   +1.549695754636025e-03   -6.266521274119513e-04   +3.115052344826431e-03   +2.013776288491600e-03; -2.507121450927049e-03   +6.631780060347704e-03   +1.286456945787984e-03   +2.140861548027672e-03   -6.256416994445486e-03   +5.229930767699833e-03   -5.743683816752337e-04   -8.311883976362266e-04   +2.743533825364345e-03   +3.547558028381484e-04   +4.544354563807673e-03   +8.829450263924680e-03   +4.428443387410576e-03   +2.620401577640956e-03   +1.885035221423835e-03   -9.003619623962330e-04; -5.465350867570161e-04   +7.815426394342524e-03   +6.097607625396145e-03   +1.493709019452482e-03   -4.770646494349910e-03   -3.153405134528210e-03   +2.034543159219676e-03   +7.963305317049053e-04   +1.040283509138410e-02   +3.456545091310673e-04   +9.934969468982757e-05   -5.536158724474967e-04   +5.291472613198201e-03   -5.600182452658519e-04   +4.798494254932530e-03   -5.961930028585896e-04; +7.065505078207924e-03   +6.127175971048671e-04   +2.725686845418892e-03   -2.156326554669278e-03   +4.604760843411828e-03   +1.907170654432763e-03   -3.990062286877630e-03   +3.823073988925422e-03   -1.488558220463242e-03   -1.452337173779227e-04   +8.188625323625029e-03   -3.020170439817938e-03   +6.573427366263677e-03   +1.806355884517155e-03   +3.616403034560186e-03   -1.897385489456381e-03; +8.487617329869222e-04   -4.590420913247778e-03   -3.824375110088964e-03   +2.355962516509795e-03   +3.457595550328964e-03   -3.206598478239014e-04   -2.168838822345957e-03   +3.330863279979164e-03   +2.564731935781629e-03   -2.809908205263533e-03   +1.231327549326694e-03   -4.643678244813701e-04   -2.591121487963283e-04   +1.310524310536395e-03   -2.921793778956381e-03   +4.171009700229641e-03; +7.610972790924686e-03   +2.514894492674039e-03   +5.772610945832043e-03   -3.326067759355366e-04   -1.079668282747957e-03   +3.279713189053936e-04   +5.267642255936561e-03   +7.600993710510769e-03   +8.810811494982541e-03   +5.719589053392871e-04   +4.235450469153540e-03   -2.725088417257426e-03   +3.979429417946060e-03   +2.208527781211492e-03   +3.396868028759683e-03   +3.522367103904596e-03; +9.573160753320343e-03   +6.483704216865334e-03   +5.030108972302843e-03   -2.405859825229139e-03   +3.686688732448606e-03   +3.086348458893897e-03   +1.577705792919614e-03   +9.671517230168491e-03   -3.449941187008126e-03   -6.348694912441573e-04   +8.229256825223747e-04   +6.266669109923593e-03   +2.865541063014677e-04   -1.461629706307233e-03   +5.151781136452329e-03   +1.512014948879171e-03; -3.025532086047037e-03   -1.953389467626866e-04   +1.605614713032648e-03   +1.197847781635180e-03   +4.163655224225801e-04   -4.802721241293273e-04   +3.378988535461957e-03   -1.919404013394062e-03   +4.212100665883152e-03   +6.745290327003494e-03   -3.610893082822097e-03   +7.538725868623516e-03   +3.263466968738822e-04   +3.317151436489699e-03   -1.730179058032080e-03   -7.580359807496360e-03; +5.781070991804445e-03   +5.039204301078290e-03   -2.005120082073211e-03   +8.210151095089921e-03   +9.025540695881115e-03   +1.367342364383398e-03   +3.165438720676486e-03   +2.426167424326619e-04   +5.724156452243519e-03   +8.256879443331895e-03   +1.540333402624328e-03   -4.807109249312250e-03   -8.064365277443192e-04   +5.359085826439912e-04   +4.539232960499824e-03   +2.993209507527585e-03];
L1E_L1I_iGABA_netcon = [+4.448733631087170e-03   +8.258806113204335e-03   +4.034571726142088e-03   +6.539078613465924e-03   -2.671912331811442e-03   +3.442688660874320e-03   +1.945196136017791e-03   -5.730958097438185e-03   +7.067912833852406e-03   -3.125137293512323e-03   -2.422761336448048e-03   +1.945571328113869e-04   +8.576474545100646e-03   +1.016759624663148e-03   -3.519471717487839e-03   +6.846845203065214e-03; -5.795224349544731e-04   +2.293039681161711e-03   +9.350732932857944e-03   +4.312753675096446e-03   -6.789029363975293e-04   +6.303541256822434e-04   -3.987414395734865e-03   +4.821197000062307e-03   +4.466021642803891e-03   -6.738771279785874e-03   -4.063867725981324e-05   +1.670565275010375e-03   +1.948015656339932e-03   +3.796411174509573e-03   +5.551076641157997e-05   +4.633703669335649e-03; +1.055758809506377e-02   +1.988827201207444e-03   +4.353274658362109e-03   -3.161171981342299e-03   -2.912602553851112e-03   -2.610604953066064e-03   +4.986606024031641e-03   +1.307260043475064e-03   +3.532506870785584e-03   -2.220541248786974e-03   +8.376603046379648e-03   +2.833404819222979e-03   +2.510774401098775e-03   +7.211934451823377e-03   -9.365918604237401e-04   -5.124156326447414e-03; -5.084721144310237e-03   -2.361363714447578e-03   -1.591237803302239e-03   +3.122398520412202e-04   -3.289777557942390e-03   +2.795660761135700e-03   +2.335550417617614e-03   +1.687529459227757e-03   +2.709852808762558e-03   -3.265466015054660e-03   +1.870427946611520e-03   -1.103856390660256e-03   +2.038928705461046e-03   -3.717321830161998e-03   -1.731255784270269e-03   +6.380533128963310e-03; -6.155935852081116e-04   +2.187839006937640e-03   +3.511915064115717e-03   +1.426952971424319e-04   -5.653993861751446e-03   +5.758837909061056e-03   +7.608704406131746e-04   +8.910189740395274e-03   -5.089816264488015e-03   +2.349527465470624e-03   +1.015672170920956e-03   -3.963237801227823e-03   -3.905250306103391e-03   -1.414254606024473e-03   +6.473930120809234e-03   +4.204663579815544e-03; +5.180454724842027e-03   +4.220418942288156e-03   -3.024341526059160e-03   +4.242051807234542e-03   -1.422103777523810e-03   -3.755390779389407e-03   +7.078100357931066e-03   +7.355509700578266e-04   +6.930049711311507e-03   +2.283821363868828e-03   +5.076913573191955e-03   -1.173204068128851e-03   +2.259815182833009e-03   -1.402281261120169e-03   -1.987678617801282e-03   -4.683108453099935e-03; +4.188314245384965e-03   -7.589246340548018e-04   -3.110605559679846e-03   -2.287995396190453e-03   +3.357612000502571e-03   +1.418364776009323e-03   +3.253459600619116e-03   +3.418797015177049e-03   +3.723239047801561e-03   +4.719582636673074e-04   +1.172504195758498e-03   +5.718947884130192e-03   +7.649149579075814e-03   -1.364187040062322e-03   +9.627556453930608e-04   +3.620527031862338e-03; +1.569491631299042e-03   -3.772828027920585e-03   -2.625616891516572e-03   -5.276475109739753e-03   +3.373220929855840e-03   -2.180520094599236e-03   +6.230917303008203e-03   +1.361309446818359e-03   -5.787785333244629e-04   +3.937096240513285e-03   +3.107519979270593e-03   +5.929242290503814e-03   +2.062996448892318e-03   -2.286079308457637e-03   +3.836687165564266e-04   +3.170508654863462e-03; +6.736999563017255e-04   +4.456972425103419e-03   +3.898315816262935e-03   +2.225367696185076e-03   +5.340643856191818e-03   +3.877195142335001e-03   +5.032175100877953e-03   +2.830148183167634e-03   +3.599737089497945e-03   -7.217887961504949e-04   -1.132728145362435e-04   -8.748422217940610e-04   +4.550293606738254e-03   +1.429602698690489e-03   +9.582286939818919e-04   +1.495019065162175e-03; -1.307024747297832e-03   +6.872758402273565e-03   -2.020612614621517e-03   -1.003276150732540e-04   +5.964210882619767e-03   +1.665752532105057e-03   +6.968433690315884e-04   +1.589737342635123e-03   +8.972150717173451e-03   +4.290198819927328e-03   +1.583272125724127e-03   +2.180084988878931e-03   +3.109678343090529e-03   +5.851583210842301e-03   +4.328598407548955e-03   +1.560115391215653e-03; -1.421603371945424e-04   -5.696895918250898e-03   +1.372823198100927e-03   -3.492854313236721e-03   -1.461451689290382e-03   +5.768952296947769e-04   +5.214235879293492e-03   +8.213757779862278e-03   +7.581135774651364e-04   +1.730255075267539e-03   +1.590310331251309e-03   +2.083907125121904e-03   -3.873354662051435e-04   +8.962859950428378e-04   +4.362951483020263e-03   +1.855442755710740e-03; -4.377378589185471e-03   +1.267401437339956e-05   +2.195403951690884e-03   +6.955456148974572e-04   -3.577706204549656e-03   +1.662531051767812e-03   +4.217187210540884e-04   +7.462306219663114e-03   +3.168073495260148e-03   +1.660918659326827e-03   -3.093750125524801e-03   -7.346614016249423e-03   -6.297538492850442e-03   -1.352040922664933e-03   +8.316337747254395e-04   -1.402518115195835e-03; +3.434589410577537e-04   +1.787148789230861e-03   +1.845292845757645e-03   +1.465056608156233e-03   -1.034288932652557e-03   +2.462039944019707e-04   +5.001175614061965e-03   -3.988336569127660e-03   +3.630326352078382e-03   +7.271474419759680e-04   +2.404290427972492e-03   -4.266405389471488e-04   +2.425247672831262e-04   +8.781406101734284e-04   +7.460716451063891e-03   -2.305325116508918e-04; -2.128440524492266e-04   +7.622835131127830e-03   -8.346163512556210e-04   +5.993770756059413e-04   +5.277038861366941e-03   +7.118484888874112e-03   +7.754183456789976e-03   +8.589549918923073e-03   -8.129839775914667e-04   +3.646458727224184e-03   +2.789039170446497e-03   +4.654737272611374e-03   +1.395119051320903e-03   -8.605526665909660e-04   -9.807593959174370e-04   -2.645222261376231e-03; +4.973641568388898e-04   -5.579541389685872e-03   +9.237758741593028e-04   -2.396855140085993e-03   +1.394897310748710e-03   +5.898801869046635e-03   +2.282214053015669e-03   -8.013423691914830e-05   +2.385255783415433e-03   +3.457438401939728e-03   -7.662811632569617e-04   -1.231529206255858e-03   -3.384694771329259e-03   +2.425150716186936e-03   -2.787642041266965e-03   -3.144938832693248e-03; +1.595696683194229e-03   +5.761601991303212e-03   -1.892640935871007e-05   -6.032573807861021e-04   +2.752756180067087e-03   +1.010119370950068e-02   +2.032572483796880e-03   +1.567638299478898e-03   +3.359688782991958e-04   -2.880773912917748e-03   -2.579045389760652e-03   -1.056060543209455e-03   +8.436583699438405e-06   +8.666400658864207e-03   +1.357649810583451e-03   +1.046931842400052e-02];
L2I_L1I_iGABA_netcon = [+2.922252698940971e-03   +5.872289607494281e-04   -5.223794652416615e-03   +4.757780786397716e-03   +5.877143632718756e-03   +2.360935777854802e-03   +1.816985738545758e-03   +3.429875770027935e-03; -1.000699932207973e-03   +1.549279072987473e-04   +4.387298699461511e-03   +1.724727386929860e-03   +1.004387755547160e-03   -8.156193847089416e-04   +1.101026213630944e-03   -3.074818469805762e-03; -2.565089072023456e-03   -1.872310570006890e-04   -2.503373524218197e-03   +5.587019293412082e-03   +7.461478997748840e-04   +9.084285980663678e-03   +1.545013266151982e-04   +2.073815664234941e-03; +3.009640369392234e-03   -3.664801928810277e-03   +7.019009560500341e-03   -1.349579359174513e-03   +2.441320144689287e-03   -3.156345504740545e-03   +1.082051038886914e-03   +2.146605670154177e-03; +1.624224307454078e-03   +6.556636305200703e-03   +8.070391952460274e-03   +6.551784794475929e-04   +2.588084569935820e-03   +8.239966843327005e-04   -9.488346322940081e-04   +1.418291448274582e-03; +3.123368942255007e-03   +5.612884191322951e-04   -2.495256870202371e-03   +4.513413677247547e-03   +1.470796841266500e-03   +4.299094737119928e-03   -1.317397219618601e-03   +5.589011174124144e-03; +2.002541619865782e-03   -6.151068727906958e-03   -2.294534662681933e-03   +6.149893345247660e-03   +8.121518183084775e-04   -6.213656275552822e-04   +2.637932289703566e-03   -1.446857600938742e-03; -1.790488899078975e-03   -2.140538496488197e-03   -2.950980676781985e-03   +2.620940808899586e-03   +4.286340562834722e-03   +6.306930997992156e-03   +6.313463544474773e-03   -2.336842316624451e-03; -4.147907675079612e-04   +3.609375662106661e-03   +6.969851928627410e-03   -2.138089701344714e-03   -6.432677401844350e-04   -1.406601239222653e-03   +1.838281840291162e-03   +6.254011384403239e-03; -1.399444887376714e-03   +3.267363653786561e-03   +6.135938010053437e-03   +3.428296664096969e-03   +2.452659130861446e-03   +1.152580236335183e-03   +2.404617938845777e-03   -1.706062258008066e-03; +1.225853853614043e-03   -2.321256899508365e-04   +3.432577911542392e-03   +2.697538005776927e-03   +2.167813521183721e-03   +5.171795080086122e-03   +4.579482366350012e-03   -1.856707826519953e-03; +5.728226792033662e-03   +4.213422221446984e-03   +3.008772070750617e-03   -1.693324147865641e-03   +2.687285905294412e-03   +1.189981863784675e-03   +2.874892780211660e-03   +1.395523530988310e-03; -1.700287685992785e-03   +5.875856188670614e-03   +5.373150386266672e-03   -2.941375127869823e-03   -2.266120733108745e-03   +4.817935984018452e-03   +5.947923747135055e-03   +7.787141954575522e-04; +5.694001656350344e-04   -1.231348989754786e-03   +1.930942535502015e-03   +1.134152841927179e-03   +1.476804680403713e-04   -5.757258448954212e-04   -2.695325917685317e-03   +1.048272237970446e-04; -1.052511618631697e-03   -1.723438757924045e-03   +3.732463802454956e-03   +3.947449916713232e-03   +1.952405827604408e-03   +3.708925844541749e-03   +6.533588818791796e-03   -2.373412238815650e-03; +6.164388913439999e-03   +1.510316607778818e-03   +5.702541552904119e-03   +7.371236939881049e-03   +4.079997672107140e-03   -3.431333653483980e-03   -1.371796896966242e-03   +1.418794219801298e-03];
L1I_L2I_iGABA_netcon = [+2.917494749583038e-03   +2.592477062716955e-03   +6.795340605941231e-03   -2.722158428166184e-03   -2.389324661488031e-03   +5.042099811132928e-03   +9.763026520764912e-04   -1.654356752732435e-03   +4.241923959612579e-03   +1.162946502030400e-02   -6.120129228867375e-03   +9.948818546946642e-04   +4.446905512461911e-03   +5.964251836674549e-04   -4.098505700152114e-03   -8.949127194809966e-04; +2.275028839030417e-03   -5.888403594860908e-04   +4.530279440757794e-03   +1.328909260342886e-03   +3.138782176400698e-03   +5.035835042774329e-03   +2.255472876775857e-03   -9.628685457375296e-04   +6.146848553903910e-03   -4.761078780581459e-03   +3.785742779083640e-03   +2.539375412017813e-03   +5.684646369048830e-03   +1.149247364070736e-03   -1.626687839130168e-03   -2.218721715343949e-03; +7.064435572508732e-03   +2.272179301209164e-03   +7.623873742296724e-04   +1.858545402588632e-04   +1.486084261589291e-03   +2.817492085066668e-03   +2.307565910816832e-03   +5.817137432560621e-04   -1.452167694225527e-04   +3.979287977453980e-03   +6.691183375898838e-03   -3.915134757863680e-03   -1.995712213639012e-03   +8.815679554891511e-03   -2.360624411462995e-03   -7.726756183783131e-04; -3.838683156159988e-03   -2.350234681255711e-03   +7.601831394710323e-03   -4.536328115537398e-04   -7.863256573962120e-03   -7.231074444318416e-03   -1.867562576393924e-03   +5.222246098192021e-03   -1.102280989609183e-03   +6.705601319639708e-04   +3.338573593599134e-03   +1.716928843246437e-03   +1.572202521792113e-03   -4.397121073274196e-03   +2.603219624541415e-03   +3.840379930475082e-03; -3.630855160681981e-03   +6.014170214832227e-03   +1.673563013677041e-03   -5.310081695876197e-05   +1.511867343131052e-03   +1.083030093785760e-03   +1.457531949442812e-03   +7.228660429873083e-03   -1.004652535526813e-03   -2.730294708333407e-04   +1.906291437548694e-03   +9.170152644271206e-04   +6.715040596922729e-03   +1.866406810954682e-03   -1.787674982460540e-03   +1.597787881195529e-03; +6.267161510793005e-03   +1.757931954493479e-03   -1.431194177436013e-03   -7.804209225547492e-04   +1.074973556625749e-02   -7.474724476426611e-04   +5.242035000295129e-03   +1.293063125011409e-03   -5.825606433215190e-03   -3.690794636284253e-03   -7.542481334040842e-04   +7.173976457744137e-03   +3.768612839069760e-03   +6.621504508876786e-04   +7.046001111579056e-03   +3.691639317709424e-03; +2.691109214441809e-03   +8.368398306536625e-03   +3.741255960875696e-03   +3.637049987749709e-03   +2.022635276922953e-03   +2.316525391235043e-03   +1.626596047238627e-03   -3.024972522730101e-03   +1.065587719856840e-03   +5.277515699839188e-03   +4.298098931764723e-03   +4.320584158724250e-03   +2.705819212376310e-03   -2.299206214042721e-03   +3.076757834142930e-03   -3.007535423003086e-03; -2.754749388517957e-03   +5.703116143572387e-03   +1.293806917271082e-04   +1.681208103148452e-03   -4.114773953888524e-03   +2.784550300302347e-03   -4.618118338683812e-03   +6.068821098951013e-03   +2.395208623312468e-03   +2.946236360022286e-03   -3.064898298796744e-04   +2.530523139776662e-03   -2.532928513079670e-03   +5.941335017602253e-04   -2.546603111297559e-04   +1.439667109634346e-03];
L2E_L1E_iAMPA_netcon = [+6.745215170314003e-04   +3.312318756404084e-03   -2.810606273095961e-04   +1.082000412926007e-03   -5.674083163935116e-04   -4.373569606962981e-03   +1.081002470947783e-02   +9.096945363801191e-03; +4.686825240683289e-03   +1.916831095176624e-03   +3.740948274651380e-04   +5.301470605658460e-03   +7.901510434405602e-03   -3.005313127977564e-03   +4.478967890853632e-03   -6.220003189720992e-03; -2.646780569186583e-03   -1.856185459998871e-04   -1.600956595128750e-03   +2.208560659258606e-03   -4.633895760997674e-03   +4.299862044264053e-03   -2.418800692260847e-04   -1.050650834892248e-03; -3.927151728049844e-03   -6.682650629968485e-04   -1.827037343472960e-03   +2.304047707561601e-03   +6.172390610843792e-03   -1.582349887265167e-03   +1.231429979595375e-03   +5.006426768385367e-03; -2.054931960056121e-03   +5.821908663033732e-03   -5.988068060303947e-04   -2.007788743898170e-03   -2.203469073441805e-03   +5.986729809192272e-04   +6.884346118995047e-04   -8.706693096543171e-04; +5.845778577613669e-04   +3.169632885244285e-03   +6.414434692726165e-03   +2.946868050206141e-03   +2.504974591669315e-03   -3.006334655633480e-03   +3.761871403457823e-03   +3.424325819529753e-03; +2.673307994342965e-03   +1.306158244214217e-04   -4.254883713896403e-03   +4.547436878840252e-03   -1.472587013602764e-03   +8.990267502630672e-04   -4.074988033953880e-03   +7.765520812169355e-03; -5.698933100744362e-03   -3.741036379389972e-03   -2.610877697631997e-03   +2.528153800163117e-03   +1.970581903652195e-03   +1.469700466112281e-03   +7.739914036480427e-03   +4.976560403477830e-04; -1.511180734809954e-03   -4.119871474308485e-03   +2.635875213078294e-04   -3.351370063817483e-03   -7.586026577625886e-03   +8.983020288306099e-03   +6.109197204081743e-04   +3.601488394864132e-03; +3.914265010081478e-03   -2.220103354685333e-03   -5.801326317323337e-04   +2.345064264129729e-03   +6.622948624451554e-03   +6.877621800125015e-04   -8.571022603284543e-04   +1.892802410915013e-03; +3.385325789892700e-03   +1.404824180798967e-03   +2.838631982041326e-03   -8.949021390944951e-04   +5.096727328069163e-03   -1.118675556900295e-03   +2.626924076607206e-03   -1.420265888439004e-03; -2.463089029646244e-04   -1.223156685560960e-03   -2.218857365949596e-03   +1.142933947479226e-03   +6.248605715520166e-03   -2.602309551244298e-03   +6.490526788847324e-03   +2.440630003320840e-03; +3.304585153755316e-03   +2.711728015684460e-03   +4.188974599016697e-03   +3.330360869142142e-03   +8.194984157705041e-03   -1.112515844708090e-03   +5.152884771612098e-03   +8.090696984087188e-03; -3.790489188084747e-04   +2.162352710122019e-03   -1.259744425985710e-03   +1.361756191455946e-03   -3.558680182701549e-03   +1.143294166315205e-03   +1.526702391075012e-03   +5.026210923698381e-03; -4.779242205051573e-03   +3.534022775639483e-04   -4.561535543732341e-03   +3.928391280532554e-03   +1.085987690109365e-03   -7.138724357454801e-03   +3.109536456867874e-03   +1.388816855461414e-03; +1.777073119382893e-03   +3.105577376415232e-03   +1.100435034336090e-03   -4.650682576236607e-03   -3.274633742529619e-03   -3.631162662516870e-03   +4.359827414197802e-03   -1.907028037181766e-05];
L1E_L2E_iAMPA_netcon = [-5.732052727700986e-03   +1.418531591497617e-03   +5.092634683243437e-04   +5.070892161602212e-04   +2.995212493173406e-03   +1.017319501571929e-02   -6.659655589613684e-04   +6.052062540766609e-03   +1.346400213217854e-03   +2.840976065874687e-03   +1.341998813790351e-03   -1.235262707360364e-03   +1.772931488216069e-03   -1.416102360435340e-03   +2.784850713299782e-03   +2.108629794787704e-03; -2.117038523469719e-03   +6.597930263903162e-03   +4.991664070760671e-03   -5.169723211920788e-03   -2.712435128895937e-04   +4.142198076666151e-03   +3.407064239292064e-03   +6.180574828590267e-03   -7.270139932407417e-03   -2.337561826245708e-03   -7.776624826960362e-04   +1.910446209977268e-03   -2.069351861366858e-03   +2.097970503330138e-03   +4.807798581644928e-03   -7.852231571759834e-04; +2.962184525839921e-03   +3.124602910688110e-03   +7.188048654674806e-03   +8.921832096707388e-03   +3.246237157669618e-03   -3.536603637970174e-04   -2.800229600002333e-03   -3.010257591571135e-03   +6.984528228090375e-05   -2.678252073433031e-03   -2.179226210513797e-03   +6.352914787234511e-05   -5.006450514667496e-03   +8.328319085489616e-04   +1.232662341230535e-03   +2.718075097350210e-03; -4.597531099198190e-03   -5.671594224212087e-04   +7.770655526885646e-04   -6.286511761049261e-04   +4.182710261613984e-03   +5.116163930401836e-03   +2.100743619215324e-03   -2.878104942589772e-03   +6.718141998400607e-05   +1.233181740757028e-03   +3.642331072243939e-03   +1.680285214599624e-03   -3.365994538797195e-03   +1.356048495375647e-03   +5.076763070051918e-03   +1.003695424898428e-03; -7.487732058681165e-05   -2.846879801572383e-03   +5.612450054643319e-03   +2.932974510773984e-03   -5.633998763335344e-03   +1.387408640777509e-03   +4.167540474422018e-03   +1.273336607034839e-03   +2.563908713047113e-03   -4.717132642522142e-03   -6.107522324387435e-03   +6.305843139444931e-03   +9.524293577585591e-04   -3.630817436346090e-03   +8.215002918686012e-03   +6.396010676038287e-04; -1.193354413613025e-05   +6.232769191381774e-03   -3.155606729352955e-04   -2.488674942203716e-03   +7.150352747835865e-03   -3.506097065754298e-03   +3.462343683888831e-03   +6.278749120140484e-03   -4.250185019255751e-03   -3.062367310828578e-03   +8.934376382259549e-03   +2.212888390431153e-03   +4.227305719191461e-03   -3.789356620992257e-03   +5.504235401307454e-04   +3.507319443794637e-03; +9.479487252026830e-04   +4.014742393177170e-03   -2.373758326741430e-03   -9.863102386269192e-04   -3.945998024533852e-04   +2.003249946067540e-03   +6.527391953084737e-03   +3.172723839518148e-03   -1.239950517390456e-03   -4.166215849124567e-03   -5.025643857465317e-03   -3.674742213872410e-05   -2.960827082831528e-03   +7.917589295351984e-05   -2.430241306193548e-03   +1.419644706802494e-03; -5.947232380033763e-03   +4.399508578890416e-03   -5.210808801523709e-03   +6.051453493963765e-04   -2.456305004967740e-04   -4.732914309166193e-05   +5.578405069996666e-03   +5.158885891653768e-04   +4.979695160848512e-03   +2.494128346046611e-03   -1.819457441688937e-03   -7.430409400892420e-04   +5.000987729153110e-03   +8.641402470983793e-04   +4.271515017228477e-03   +6.182719118567943e-03];
L2I_L2E_iAMPA_netcon = [+3.911739102481291e-03   +6.830906404948052e-03   +8.276213375429900e-04   +5.641970866770923e-03   +2.771130479084460e-03   +3.719552229584725e-03   +3.446207887735063e-03   +2.249235816095458e-03; +3.007914154609621e-03   +1.748307529317337e-03   -8.470827399174325e-04   +7.299478480649094e-03   -1.607970301984752e-03   +1.312817924930518e-04   +1.736982214537340e-03   -2.555552976794438e-03; +7.166690768181573e-03   -1.412355649231870e-04   +3.801056268240409e-03   -2.274185696443971e-03   -1.742749388856469e-03   -3.992557258308310e-03   +3.536740538312110e-03   -9.034911674191893e-04; -8.348419085461909e-04   +2.755173894263821e-03   +5.857948420484387e-03   -1.528611204977938e-03   +6.832268283855705e-03   +2.727350133658189e-03   +4.853678557803165e-03   +1.080589450155047e-02; +2.440671224834244e-03   +4.774717776885647e-03   +1.251475973843665e-04   -6.036849384707030e-03   +2.749291350743491e-03   +8.203901068384975e-05   -7.095823433360272e-04   +7.276521478674621e-04; +2.269725768805521e-03   +9.948777558710347e-04   +2.559017484486288e-03   +1.331283024385048e-03   +1.575652929356683e-03   +4.654187678130355e-03   -9.504451800916747e-04   +4.158058236363114e-03; +2.602090884573873e-03   +3.101824454293319e-04   -1.383637163257937e-03   -2.708495002507253e-03   +3.295352022837745e-03   +4.013396684932581e-03   -5.200654702256864e-04   +6.527156650284147e-03; -1.154707192097732e-03   -1.453256622794149e-03   +1.099307239832072e-03   -6.012502100876476e-03   -3.179730996872100e-03   -7.383793883309686e-04   +2.731584661694408e-03   -2.347808861788528e-03];
L2E_L2I_iGABA_netcon = [+4.593010724953994e-03   -2.095138792954189e-03   +5.864573547868466e-03   +2.128065935674397e-03   +5.629732609600620e-03   +5.817976958942361e-04   +2.781485457550656e-03   +2.920496809140384e-03; -4.216404797020300e-03   +7.022442767405913e-03   +2.700014174680423e-03   +3.264434597662126e-03   +3.188325201815920e-03   +8.012271091774895e-03   +5.460051239652911e-03   +2.351175932224579e-04; +6.808665278580754e-03   -1.086250208864825e-03   -1.117408396041635e-03   +9.658211641920495e-04   +2.699603966251404e-03   -6.242297298358823e-03   +3.110013260278386e-04   +5.898174479046253e-03; +7.088144287804402e-03   -4.323528153227146e-03   +3.407353659391477e-03   +7.245773642208958e-03   +3.393477568091917e-03   +8.074093464287462e-04   -3.981136896676020e-03   +3.643920969344505e-03; +5.763797717766010e-03   +2.785574371827317e-03   +7.286532944585551e-03   +8.620254926860898e-03   +6.199381640675721e-03   -1.212498584897229e-03   +2.963856372061759e-03   +3.770608178158594e-03; +3.736127768233448e-03   -3.145046267256625e-03   +2.495525047031548e-03   -1.932662385348333e-03   +1.334140798124623e-03   +1.965361204492955e-04   +4.337954669579687e-03   +1.348938407916190e-04; +6.689696539773974e-03   +1.561485170609164e-03   -2.705750840458788e-03   -6.869832960773562e-04   +2.971089771408811e-04   +3.554336763351948e-03   +1.778867571674964e-03   +3.084011724434758e-03; +5.307461235360058e-03   +2.745402156260715e-03   +3.675297474548009e-03   -2.170672385400277e-03   +1.334580529459312e-03   +1.332315080321439e-03   +2.093442095294792e-03   -5.814440077957055e-05];
L3E_L2E_iAMPA_netcon = [+8.177354734629890e-04   +5.314157524472436e-03   +2.379849485657981e-03   -2.830351638282012e-03   -4.017704783400442e-03   +1.535039585131759e-03   +2.170433887695489e-03   +5.447147259807129e-03   -1.101161919504275e-04   +1.033159285254533e-03   +1.171633884223967e-03   +2.445778045962051e-05; +3.017191174391181e-03   +6.710459288579710e-03   +5.558959119678107e-03   +1.781682525191146e-03   -5.365988612053155e-04   +1.944135356728124e-04   +7.429026303334588e-04   +3.517352551810285e-03   +5.210498475059422e-03   -1.381169813655982e-03   +8.437953296271024e-04   -4.626228837902812e-04; +2.374235315364793e-03   +1.500808277337041e-03   -2.409703401910232e-03   -8.516838116404098e-04   +7.205840206430785e-04   +3.893996767559651e-04   +1.964008034427616e-03   +8.260431498618952e-03   +7.445402986334171e-03   +2.483697198030847e-03   +3.039997945819143e-03   +1.656728005775433e-03; -1.827843025574266e-03   -2.283862775841472e-03   +1.282476136832211e-03   +6.338340824291178e-03   -1.714447581673703e-03   +2.735676231973367e-03   +3.095835325260651e-03   +3.395541118732782e-03   +2.514632167566373e-03   +7.137513041434667e-03   +5.684762964366244e-03   +3.470781658080016e-03; +1.408597944261515e-03   +7.516902674765188e-04   -2.649450107822705e-03   +3.545695949430257e-03   -2.765846560635507e-03   +3.213601701841767e-03   +1.820218039347383e-03   +4.719463494070480e-04   +2.108594899450098e-03   +8.956596988117042e-03   +1.581209436563265e-03   +2.709462977377612e-03; +4.559576952287693e-04   -1.569702941603891e-03   -4.920582535110537e-03   +3.044197022541105e-05   -1.457170610546673e-03   +8.666901820956596e-03   +4.867283658337236e-03   +5.662347245375124e-03   -3.118678559346998e-04   -3.456309357701412e-03   +6.796620463406140e-03   +3.950158217108012e-03; +3.634594826692533e-03   +2.324054028115559e-03   +6.839715824424174e-03   +3.209124933542770e-03   -4.368300491460024e-04   +5.377676345651666e-03   -1.443799137180742e-04   +9.278979342374963e-03   +1.705232610598387e-03   -6.583170793351504e-04   +3.317424657447706e-03   -2.513999870515230e-03; -1.477502821334194e-03   -1.979176011425959e-03   +5.169259685128144e-03   +2.124425020442603e-03   +4.353914154714537e-03   -3.386812576045812e-03   -3.071377939364013e-03   +3.396858949698587e-03   -3.298481671697697e-03   +3.318464194360136e-03   -3.699941017621010e-04   +9.989826514788178e-04];
L3I_L2I_iGABA_netcon = [+5.024083878028681e-03   +2.817246668936012e-03   -3.023237061483186e-03   +1.106924663987701e-03   +3.903752379467173e-03   -4.405057783413649e-03   +3.276812030938459e-03   -4.589390019121643e-03   +1.356692794096229e-03   +3.649329200745717e-03   -2.472433865429809e-03   +3.009959030411283e-03; +1.008250561923431e-03   -3.014615898797037e-03   +1.829060128202062e-03   +3.350379022163447e-03   +5.217593309991705e-03   +2.318244802285816e-04   +5.628353545824851e-03   -4.555680103274899e-03   +7.843147220922091e-03   -1.209180171437382e-03   -4.126122106162117e-03   +7.899504684716308e-04; +2.643669706457186e-03   +4.697653221932697e-03   +3.216020542564536e-03   +1.663837274917334e-03   +7.476876629320086e-04   +4.997536359195878e-04   -1.021627615088037e-03   -1.726453389623655e-04   +5.404814566898370e-03   +5.881959754513778e-04   -5.604184493636425e-03   -1.147240182810954e-03; +4.648982862525702e-03   +2.235316470598906e-03   +4.050431631450196e-03   -4.206955312358467e-03   +1.029784999020617e-03   +6.399823871729302e-03   -5.391270652621748e-03   +2.532362146358299e-03   +3.493195070633706e-03   -5.013723739570245e-03   +4.149044714617326e-03   +7.435320928712040e-03; +4.034676550196413e-03   +1.965872787892377e-04   +1.870985064241399e-03   +3.454017219618166e-03   -1.545894409836592e-03   +1.857703267495918e-03   -1.994288117165601e-03   +5.381403061227642e-03   +2.519418011042999e-03   +6.462028970141179e-03   -2.754103586003235e-03   -4.294212459454156e-03; +5.076788510770026e-04   -3.526002702202264e-03   +4.047749271703250e-03   +5.515278485551435e-03   +4.663491737297726e-03   -1.570876164420959e-03   -1.538395545849919e-03   +5.599369046275572e-03   -6.662332854653370e-07   +5.326548695959808e-03   -2.507535549692339e-03   +1.250157799132894e-03; -3.531637601944114e-05   +3.638640806980386e-03   -7.754406526414064e-04   +1.049151556073761e-03   -1.272522942975528e-03   +4.737905506007805e-03   -9.624945402374146e-04   +4.053508629830357e-03   -3.440691451148481e-03   +5.431232852996093e-03   +2.833148139143439e-03   +1.156219611618376e-03; -2.204597740249769e-03   -3.128098170564631e-03   +8.231373714810630e-04   -1.348968818979078e-03   +6.808563331145058e-03   +3.170697925172746e-04   -4.172873166439421e-03   +1.424599488556064e-03   +2.694307951705660e-03   +1.913018294970294e-03   -4.826844202528199e-03   -9.812115614809889e-04];
L2E_L3E_iAMPA_netcon = [+2.111380236341239e-03   +4.590870979430286e-04   -7.545311218424006e-04   +2.049534673853891e-03   -1.281506870658426e-03   +3.673407740938070e-03   +1.503124263072230e-03   +5.910052373217949e-03; +1.959289443697574e-03   +5.048209535870753e-03   +7.162784248091076e-03   +5.751435877374159e-03   +2.897414358530865e-03   +1.440690806581393e-03   +1.699033882910934e-03   -1.838121514128474e-03; -2.211922502680676e-03   +7.409833560615985e-04   +4.223994354545984e-03   +4.160874919234373e-03   +2.136990908290825e-03   +8.501766402192978e-03   +3.592137975781105e-03   +8.084406774114872e-03; -1.518241540513580e-04   -4.528874218780354e-03   -1.139957365798429e-03   -7.386213869711262e-04   +4.904369325009181e-03   +7.277618781459785e-03   -2.142724220135110e-03   +6.807527092125338e-03; -5.662486943067047e-04   -1.446224804475680e-03   +1.395732585119589e-03   +5.292803466850106e-03   +3.205309625577696e-03   +4.004042777780705e-03   +1.399559999527307e-03   -4.493869594832681e-04; +6.297144778202982e-03   +5.782214709451094e-03   +3.661740959240681e-03   +1.247332706213721e-03   +3.257322344524429e-03   +8.090910628765442e-03   -1.916041982532350e-03   +4.419434029315023e-03; +5.079017988350989e-03   +2.331144610049819e-03   +3.540981620355845e-04   -3.335210540823742e-03   -3.089629389121072e-03   +2.562573088795635e-03   +4.944148809535732e-04   +1.308632795492167e-03; +9.977719063699717e-03   -3.423121031269725e-03   +1.690306720000679e-03   +4.079987870009758e-03   +7.846574866010496e-03   +4.767360097590031e-03   -1.321804254243501e-03   +7.777599172175353e-05; -1.566993262544728e-04   +5.686489984248366e-03   +5.626719549048671e-03   +2.297381456558381e-03   +2.617771933418318e-03   -3.947195801723291e-03   +2.010820382268897e-03   -2.137004511981332e-03; +3.500065539543532e-04   +2.287678081553444e-03   +5.179749494389947e-03   -3.131448325631462e-03   +4.684564926162893e-03   -7.114898784306025e-04   +2.653646377709696e-03   -7.709699835072840e-04; +1.237371933930733e-03   -2.433607019342108e-03   +4.649779633824583e-03   +1.528720768090932e-03   +1.384053461260206e-02   +2.208227619842232e-03   -8.508387559545523e-04   -5.422467063175818e-03; +8.470579403746480e-03   +1.728960199192404e-03   +1.192793110584032e-03   +9.653669821190686e-04   +4.006627846405859e-03   +1.939661395755986e-03   +6.958071648131719e-03   +1.983422577853493e-03];
L2I_L3I_iGABA_netcon = [+5.231104669431241e-03   +1.742451117125048e-04   -4.153725299134082e-04   +2.925130098438710e-03   +7.494144284057568e-03   +1.099048029727042e-04   -6.339231180642654e-04   +2.246342081721177e-03; +2.689925882258972e-03   +2.559326497961040e-04   +3.379909283131432e-03   -5.089271016301600e-03   -1.606171997758336e-03   +4.379431274898936e-03   -3.301061355089299e-03   -2.120952466853177e-03; +3.507185290840258e-03   -2.651996851765460e-03   +2.895229071641174e-03   -4.912108612711491e-03   +6.332196452161295e-03   +6.987229056091639e-03   +8.502646000465471e-03   +5.732192952465424e-03; -2.821533228833516e-03   +6.760738416155499e-03   -2.949530059475349e-03   +6.458564437684786e-03   -3.680527068716495e-03   -2.309521116632940e-03   +2.590751986485167e-03   -1.644099909558691e-03; +2.463366503543610e-03   -7.431798266797005e-03   -3.569876704320696e-03   -4.496012166903063e-03   +3.547043848142866e-03   -1.080195889376996e-04   +4.695718494306569e-03   +4.587539196612528e-03; -4.573943465058745e-03   -1.106985606817501e-03   +5.476831244180793e-03   -1.783845663783810e-03   -5.565514226989026e-04   -2.944945278275715e-03   +1.042727514554836e-03   +1.124084047984695e-02; -5.053322254204806e-03   +3.739090249968079e-03   +4.059382328041561e-03   +2.663511518291630e-03   -4.634505777273024e-04   -1.413273443816222e-03   +3.129167514363816e-03   +5.279903866706655e-03; -1.419617998500203e-03   +3.085026760372982e-03   +5.193314559698224e-03   +1.286474085621086e-03   +4.809920558817378e-05   +7.960885427365470e-03   +4.363357858500236e-03   +4.012997878524910e-03; +4.242099652898944e-03   -2.851358414956053e-03   +2.374906491335061e-03   +2.911111992776231e-03   -1.141851845746555e-03   +8.258093087247384e-04   +4.880127936413575e-03   +5.235259785836315e-03; +3.542303011309594e-03   -2.129452701689042e-03   +5.988044524301665e-03   -1.383791215966672e-03   +4.744182872452892e-03   +1.876030942849708e-03   +9.121764437289819e-04   +2.213533095714790e-03; -2.156121432230871e-03   +2.741503092358684e-03   +1.317377275721290e-03   +5.494424108261741e-04   +2.354799242883138e-03   +8.772382972558768e-03   +3.911787372750648e-03   +5.474669334282487e-03; +7.929378610945807e-04   -4.197132242879808e-03   +3.581713692254494e-03   +5.105324820492943e-04   +7.990403982509190e-04   +1.803486078682232e-03   +9.910900342295708e-04   +3.314484948578424e-03];
L3I_L3E_iAMPA_netcon = [+1.737128363457510e-03   +5.184357791023948e-04   -1.015908741163905e-04   +2.408860281140382e-03   +6.387680098112405e-03   +3.000629236052663e-04   -1.266948530497690e-03   -1.204380545506390e-03   +7.755248753264742e-04   +1.698756885809345e-03   +7.202149482594872e-04   +9.654447807414612e-04; +1.342205991013012e-03   +3.207594656452586e-03   +2.571109720612580e-03   -3.473696739046510e-03   +1.363361744574645e-03   -7.479992094212233e-04   +5.383583194776879e-03   -5.252555625453303e-04   -1.407241203842698e-03   +2.223180032472249e-03   +5.587279969472767e-04   +7.865445130534471e-03; -6.115639164421024e-03   +4.168743821415275e-03   +2.994395599053364e-03   -6.658352173472316e-04   -6.157523774023930e-05   +4.436944007518960e-03   +4.026343625126146e-03   +4.177300362134386e-04   -3.107020504861740e-03   +1.635259296127929e-03   -2.135756784668067e-03   +1.812407635037199e-04; +4.509235030116402e-03   +4.732596913472911e-03   +1.475024268514222e-03   +4.237829431013083e-03   +8.208439703670457e-03   +1.707738175113487e-03   +1.422274938570395e-03   +1.484135689776657e-03   +2.945520459128255e-03   +5.394922392851868e-03   +4.507799236739214e-03   +6.589778337468760e-03; -3.773241478572861e-03   +2.326679044061819e-03   +1.398382384802708e-03   +1.415458320364751e-03   +4.878116954024775e-03   +3.351035730620540e-03   -2.531784863196449e-03   +5.605382513474981e-04   +2.066565836127873e-03   -8.763487326923238e-04   +1.263472557996621e-03   +6.351449305116827e-03; -1.659796783047559e-03   +2.063915234457552e-03   +1.359971523400415e-04   +2.890877627490823e-03   -1.309779928344573e-03   -1.948464349597566e-04   +9.301190856542959e-03   +2.593294118818803e-03   -3.157030244497196e-04   +3.022623903281505e-03   -2.149454785535919e-03   -1.471927115942870e-03; +4.324752505798006e-04   -2.151101995939206e-03   -3.281733752760628e-03   +1.824460096753884e-03   +7.106078029423495e-03   +4.155749072304062e-04   -5.966637896788097e-04   +4.365387239467436e-03   +2.997797750436140e-03   +4.178581685986907e-03   +5.300045859299509e-03   +8.464980315265930e-03; +3.240930672336456e-03   -3.002973453611124e-03   +9.520622363030546e-03   +2.336829519633250e-03   +4.643393096742188e-03   +3.235502053411157e-03   +5.435149656367353e-03   -1.319459605808384e-03   +1.624337708287659e-03   -2.181690388539981e-03   +4.794536269655342e-03   +2.493424982700715e-03; +1.078635777425614e-03   -1.609714625829327e-03   +3.467175429185396e-04   +1.364760935264331e-03   +1.599249167811268e-03   +4.910656379078619e-03   -3.120432141013296e-03   +2.886361479376805e-03   +4.406448939329201e-03   +1.543359493047623e-03   +4.407978635047986e-03   -6.345624244123711e-03; -3.235106172884665e-04   +4.267454366057769e-03   +3.641100252740518e-03   +2.025558925550278e-03   +3.663840191217202e-03   -1.678433797681520e-03   +2.913746916581097e-03   +3.332276826728627e-03   +2.972478202011312e-03   +3.098772503692749e-03   +4.691907845247462e-03   -2.794644720221226e-03; +2.659019734527009e-03   -6.163518264272060e-05   +5.233706028596875e-03   +5.057189384735006e-03   -4.193515439270069e-03   -3.009576767656407e-03   +1.387410175419460e-03   -3.048304434395989e-03   -3.912328540434084e-03   +2.376507295099452e-03   -2.877742223298944e-04   +2.625876465825951e-03; -3.083509644184838e-03   -3.011449572303180e-03   -4.540310962911901e-03   -8.752240785063860e-04   +2.104957410167806e-03   +2.379547184919671e-03   +5.831459400053593e-03   -5.152030167302648e-03   +1.710315429515576e-03   -2.031207171679820e-03   +4.658444689064603e-05   +1.231143086250679e-03];
L3E_L3I_iGABA_netcon = [+2.197883846553453e-03   +7.114377165127073e-03   -2.078998233925024e-03   +2.774515814020503e-03   -1.888962696230627e-03   +8.012214168496363e-03   +1.836270706108336e-04   -2.591246395137709e-04   +5.414649921270653e-03   -4.305403741958896e-03   +2.194575888991252e-03   +1.208880299065925e-03; +5.177113344888402e-04   -1.608973393939254e-03   +9.032919780767917e-04   -3.049418049971887e-03   -4.387014410420325e-04   -2.691170908070849e-03   -2.304859259012149e-04   +1.319059043341141e-03   +1.497822575055957e-03   +1.044018339112154e-02   -9.073173225836642e-04   +1.559537546803534e-03; +3.408908193765372e-03   +1.291399362847839e-03   +4.660586284082630e-03   -1.565684236179926e-03   +2.776704924894155e-03   +5.772738129293430e-03   +3.211416412474919e-03   -1.679046007672595e-03   -1.985377158831268e-04   -8.684225283132291e-04   +1.081598690804222e-03   -2.486740395253871e-03; +1.171453922246768e-03   +2.949374559676924e-03   -1.980141578482752e-03   +9.820728348298212e-03   +2.276906632247598e-03   +1.891706284021180e-03   +3.613117032028292e-03   +8.953000320193211e-04   -3.867278306314329e-03   +8.050594075320251e-03   -1.060671977199952e-03   +4.536083019834989e-04; +2.765929678885304e-03   +7.232537049008742e-04   +1.015706425342721e-03   +1.941699677711264e-03   +2.456465630670203e-03   +4.257461596329522e-03   +5.211170185474442e-03   +2.639712831573461e-03   +4.945044038099061e-03   +2.599578803689670e-03   -2.259517369065939e-03   +4.454553553334597e-03; +4.484656145304590e-03   +4.486162262573818e-03   +6.554443854489427e-03   +1.745079372180902e-03   +5.085103678300248e-03   +6.284789635711724e-03   -7.821016154555261e-04   +8.652823991366186e-04   +3.677424921216581e-03   +4.663169669587379e-03   +2.502362913023484e-03   -3.823944955340852e-03; +3.101907524017831e-03   +3.849978432482775e-03   +1.091509608264509e-03   +2.356528029967653e-03   +4.928106455706369e-03   +6.949826790364687e-03   +1.357055141571734e-03   +4.324380873011702e-03   -2.333890871245329e-03   +3.716248079553948e-04   -2.536325261390550e-03   +5.179922553501072e-03; -4.751803845187153e-03   -2.013759990570217e-03   +5.172066505552297e-03   +4.153963891265408e-03   -3.288978842404827e-03   -1.556720408361700e-04   +5.068681985574119e-03   +3.190035356873176e-03   +2.459917508167550e-03   +3.984464330920560e-03   -1.245294328731722e-03   +2.690578149745737e-03; +4.708607102615129e-03   -9.731087891047722e-04   +5.836812223950097e-03   -1.711549002818603e-03   +2.079168452610069e-03   +3.900343954462933e-03   -2.320419007534712e-03   +7.719892155108351e-03   -1.513581248690172e-03   +5.572317849646634e-03   -1.193878869193435e-03   +5.704233788428871e-03; +3.263653842715647e-03   -2.139518070641934e-03   +1.007882683464090e-03   -4.682521535320461e-03   -1.494585786905116e-03   +2.252363997988891e-03   +3.686323547530844e-03   +2.941080501947640e-04   +6.530755615374500e-03   +3.622644764345585e-05   +1.563930425728294e-03   -2.886233339882765e-03; +3.798891181534675e-03   +5.088336176543634e-04   +4.539916449605900e-03   -1.756110659891495e-03   +5.962300463525261e-03   +8.618478480506606e-04   +4.666790596320975e-03   +4.603834206280025e-03   +7.840464342334402e-03   +5.840083432091141e-03   +4.983708267445319e-04   +1.603782187865586e-03; +4.578575135396705e-03   +7.792522493599893e-03   +1.405608260072187e-03   +2.263952139296799e-03   -6.089477861722891e-03   +2.090007145520942e-03   +5.866479690637553e-03   -5.661360070599807e-03   +7.204060359347727e-03   +4.310447512230520e-03   -2.751388097771858e-03   +1.030670195676323e-04];
L2E_Input1_iAMPA_netcon = [+1.001878153497126e-04   +4.077773317103244e-03   +6.899197812546026e-03   +2.827066068123348e-03   +9.118139156959484e-03   +1.043724289921605e-03   -3.607162959355596e-04   +2.564620339047515e-03];
L2I_Input2_iAMPA_netcon = [+7.977125605653048e-03   +7.238520216692184e-04   +1.745039850994459e-03   -2.616928102865156e-03   +7.261777053016013e-03   +1.293557880051547e-03   +3.721244010522229e-03   +5.032377497341933e-03];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
