function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.836402128791834e-02   +5.396806503260381e-01   -1.689153609814072e-01   -5.931561265094053e-01   -5.534182510802825e-01   +3.490837166668351e-01   -1.254042878220814e-01   +1.231670416266677e-01   +3.673766891857789e-01   -1.650133393197882e-01   -4.324546829468228e-01   +2.039135430080005e-01   -6.128150534280721e-01   -4.001230799862880e-01   +4.153179542512643e-01   +7.119300542726079e-01; +8.818385266553224e-01   +2.537024959386635e-01   +4.465813351311592e-02   -3.442318410308112e-01   +5.032649118574029e-02   +6.389288906475507e-02   +4.643706639901021e-02   -5.275892400118001e-01   -7.115322333357341e-02   -3.074390807801036e-01   -1.504947570046508e-01   -1.481120686412898e-01   -7.626330458281043e-01   -3.039714271188991e-01   +6.739276435555039e-01   +1.414780097118194e-02; +2.408843669685829e-01   +4.934441082517302e-01   +6.289338246629163e-01   +1.531372832833428e-01   -4.255968270513606e-01   +1.578479314088125e-01   +4.989009221579918e-02   -1.664337949689924e-01   +2.617368615529120e-01   +4.023165935662038e-01   +1.613553281702168e-02   +4.717879843978248e-01   -3.249928780680005e-01   +1.059071573274302e-01   -2.421088273238525e-01   -3.464434474276243e-01; +4.566514522420533e-01   +1.917576290894135e-01   +5.041570885374622e-02   -3.473981687842031e-01   +4.327570510230088e-01   -3.238715661406127e-01   -2.747842139922452e-01   -1.924085400668614e-01   -8.799900657960507e-01   -3.208909760149877e-01   +6.685891611499767e-03   +5.191604399896954e-02   -8.694802829212871e-02   -6.720300774561916e-01   +2.025205908886099e-01   +2.300600480502998e-01; -4.857207426113559e-01   +6.978493491817768e-02   +5.011727304377296e-01   -2.566850208061705e-02   +1.072059895793807e-01   +1.439299945349032e-01   -4.568468326006420e-01   +4.439707067165271e-01   +2.917885031584700e-01   -2.823293060788767e-01   -2.196928818807828e-01   +6.794261073882278e-01   -4.922107650008415e-01   +7.638481902324303e-01   -3.655908534494426e-02   -9.161679472072821e-01; -2.222804597834440e-01   -2.429542157752676e-01   -2.726863613134938e-01   -4.296330547398887e-01   -4.056928003965817e-01   +4.465652654077650e-01   +1.054904946119586e-01   -2.177525450908201e-02   -4.841313930200359e-01   -5.495898420054067e-03   +7.788715236667543e-03   -6.007585190840536e-01   -3.992328467809696e-01   -2.553319524375188e-01   +6.142855396577369e-01   -1.939045351706183e-01; +3.519141825180968e-01   -2.993121679610960e-01   -4.006507050156732e-01   +3.557418791926885e-01   +2.289014365511277e-01   +5.786885666941006e-01   -2.983884371150843e-02   +2.445694127622494e-01   -2.925158107733059e-01   +9.940160002798346e-02   -1.621937571279583e-01   -7.230544836458579e-02   +3.699325557122743e-01   -5.152068521653334e-01   -2.997852071085649e-01   -3.264673413802847e-01; -3.204886924792832e-02   +5.106011783866842e-01   +1.994842595541106e-01   -3.041182375089551e-01   +2.686109879207766e-01   +7.169595796129541e-01   -2.563848013598221e-01   -1.404862715832324e-01   +3.334735441876835e-01   -1.079214033307418e-01   +4.017582734964411e-01   -3.254244196990403e-01   -1.256016639690646e-01   +4.812922571008084e-01   +4.294988716430637e-04   -6.989490811641094e-01; -5.254445824982024e-04   +6.976485181862196e-03   -5.116914002018538e-01   +6.680398000270118e-01   +1.069074205921040e-01   -3.308366516394891e-01   -4.957796720250494e-01   +1.070995100733580e-01   +5.853809603528431e-01   +3.510342376439562e-01   -5.999917259044272e-01   +4.630523479341123e-01   +2.033779305191562e-02   -4.982485766898541e-01   +1.672480599258558e-01   +1.160949386525814e-01; -9.198221576957513e-02   -5.560364595720250e-01   +2.022499851773008e-01   +1.462956309586153e-02   +1.809928880539627e-01   +3.967216377201637e-01   -4.779109507273990e-02   +1.113579076732150e-01   +2.355532541155884e-02   +3.171505177066571e-01   -1.042891942747970e-01   -8.858831755062296e-01   +1.984691856628578e-01   -4.098208524260571e-02   -2.563685152531361e-01   -3.691610145426730e-01; -7.042782163207020e-02   +5.028376808202140e-01   +2.727284016475016e-01   +3.580525101988656e-01   -1.069945722396829e-01   +1.298821381029704e-01   -2.419356267384823e-02   +2.430029943391211e-01   -2.246816699910300e-01   +2.675035459807739e-01   +2.336266192671696e-01   -1.155903821948694e-01   +1.271340994260354e-01   -4.258981496137559e-01   -2.076541142229980e-01   +3.661611503066566e-01; +5.249519846176478e-01   +3.024106971420748e-01   +2.642209133375414e-01   +1.328640811829723e-01   -1.683234423465653e-01   +2.718341759281950e-02   -1.666215753964930e-01   +5.072319093736273e-01   +1.044816870650919e-01   +7.189155589756374e-02   -5.282253480546432e-01   -2.747238528282561e-01   -3.380308454401678e-01   +8.390045115575362e-01   +1.616924123389645e-01   -1.630979565805036e-01; +4.148735405360698e-01   -2.765015303601566e-01   +3.008230485893532e-01   +5.451253643718407e-02   +3.617922177293334e-02   +4.619148214184875e-01   -2.102123501448327e-01   -7.695840608384850e-01   +2.440458286770122e-01   -6.100329556484513e-02   +1.409827522351652e-01   -1.582334128204265e-01   -7.831600127954896e-02   -3.731669244762383e-01   -5.173023877944979e-01   -4.446141207583986e-01; -1.363556992304116e-02   +1.741401933537958e-01   -6.130879301915384e-01   -1.874975835715667e-01   -1.214864090918219e-01   +5.723910697364909e-02   +2.776362896100844e-01   +7.028052886212877e-01   +7.870917468497227e-02   +2.859998718111429e-01   -3.017188278076858e-01   +6.644424586451633e-01   +5.131934647929394e-01   +3.271695579606476e-01   -3.346466018877270e-01   -3.413588088091150e-01; -2.408399485194810e-01   +2.880392990082181e-01   +2.168855683669839e-01   +2.506970221707998e-01   -1.106859668932410e-01   +2.000253461187490e-01   -1.035383873982787e-01   +1.414511045911932e-01   +3.693487869146024e-01   -4.949636133123619e-02   -3.059864599510417e-01   -5.562800742188049e-01   +2.227393000290369e-01   -1.168796686384672e-01   -7.514938769126063e-01   -3.265127896484615e-01; +2.819709342491830e-03   -6.711894349120338e-02   +5.876765020026467e-02   +5.617942270602888e-02   -1.600612255030167e-01   +2.262825120510162e-01   +1.615293365468768e-01   +3.338307068172081e-01   +2.203286795182771e-01   +1.876821393972926e-01   -8.385356664960099e-02   +1.462200980058594e-01   -5.782692869317145e-01   +4.094525074066935e-01   +4.383472516669221e-01   +1.057629785263230e-01];
L1E_L1I_iGABA_netcon = [-3.399047125694070e-01   +3.713209153339586e-02   -5.249752558655635e-01   -4.453509107166333e-01   +4.178799668946026e-01   -2.098693035222102e-02   +5.300437126359649e-01   +1.189006049772900e-03   +1.014215940522666e-01   +6.738352490992686e-01   -8.801563052715340e-01   +2.748953321222214e-01   +1.235540697914021e-01   -1.421866800343668e-01   -1.278395803690672e-01   -8.330989076716433e-01; +2.802781385791482e-01   +2.003052491380246e-01   +4.733646602463775e-01   -3.024709748791657e-01   -7.551750416493211e-02   -4.121010119155089e-01   -4.092803432304595e-02   -4.199269297621568e-01   +4.632404733472485e-01   -1.573782717414781e-01   -8.879246051667324e-02   -7.610273275468075e-01   +4.672443535683588e-01   -6.270341417513203e-03   +2.125328450649551e-01   +3.750035982135457e-01; +2.302338701427599e-01   -3.601763522810120e-02   +7.270638881280531e-02   -3.498566052958872e-01   +3.185317521672703e-01   -3.299681226029337e-01   -2.721214349964191e-01   -5.838556756980158e-01   +2.873813484772126e-01   -3.602088265826188e-01   -3.241809212859177e-01   +1.957475267425297e-01   -4.592922249932274e-01   +7.774454433427447e-01   -2.793673610695172e-01   -5.781869260810135e-02; +3.588862078799591e-02   -2.382558974889984e-01   +6.979839220181637e-02   +4.232359862581606e-02   +2.932517119303760e-01   +6.869401557326715e-01   +1.083256471938698e-01   +1.228695510666732e-01   +2.025877389467736e-01   +2.379987895824892e-01   -6.098260959950312e-02   -2.950493640283404e-01   +3.645244280147157e-01   +6.164453816846065e-02   +1.062475583542691e-01   -1.585905384247739e-01; -4.314487098108342e-01   -3.068796383744901e-01   -3.809631583859122e-01   +5.931165625761543e-01   -4.474243336676043e-01   +6.793660408640328e-02   +1.350930077287066e-01   -6.230381533582410e-01   -1.637127190391801e-01   -3.507532180705525e-02   -1.560538401464470e-02   +2.196113237188734e-01   +1.070523971067673e-01   -4.608044812115146e-01   +1.337963332266043e-01   -3.523280516279351e-01; +1.837428630337487e-02   -1.354778776831497e-01   +7.245913565995125e-02   +1.040918946740447e-01   +2.876558402882307e-01   -3.490373529990511e-01   +9.968370084945374e-02   -1.591784087853549e-01   +1.387306074963929e-02   +2.051561962741986e-01   +2.246282568630233e-01   +3.111665509557341e-01   +6.428346250356728e-01   +1.044969171274204e-01   -8.857132902485201e-01   -3.678201838687148e-01; +2.790008644125218e-01   -2.893773247906524e-01   -2.363168123931111e-01   +1.350370082211023e-01   -4.452736336894132e-01   -1.492231720035467e-01   +8.835124487411717e-01   +2.073974651458218e-01   -1.666045075350173e-01   +6.570837076220946e-01   +2.251692687691223e-01   -6.409628384194457e-01   -1.519276425712089e-01   -7.178080175169848e-01   +6.144001319688465e-01   -5.588908600342402e-01; -1.425226970560988e-01   -6.379745369721290e-02   +5.588983355898718e-01   +5.534439018171203e-01   +1.778369171380014e-01   +6.457248012071098e-01   -2.534684830197130e-01   -2.159739423614340e-01   +1.654749324759675e-03   -6.569150441971761e-01   -5.593802635326200e-01   +5.292680100429679e-03   -2.750834040210661e-01   -1.130068916338700e-01   +1.908684819219595e-01   +1.985799733071967e-01; +4.610254598540707e-01   +2.373017709236487e-01   +5.480693150455547e-02   +4.785285894364910e-01   +1.675004531025612e-01   +5.141656687734253e-01   +1.893522139748285e-01   +7.429087504961054e-02   -2.902901218209283e-02   +2.488843750045234e-01   -1.912798847271239e-01   +3.170408990333425e-01   -6.423602780797090e-02   -4.182809495935758e-01   -4.647906411389505e-01   -1.307821122760355e-01; -2.000573928275234e-01   +2.735674587307815e-01   -1.859049544872319e-01   -1.298220205976230e-01   -5.993208785917860e-01   +2.720489075402777e-01   -5.976174208738790e-02   -4.945515868121086e-01   -3.888053056515659e-01   -6.183204839388390e-05   -2.122378202708910e-01   -5.091500997706987e-02   -9.840236713351269e-02   -3.023676941164491e-01   -1.830290628419271e-01   -1.334809774076027e-01; -4.396277244640707e-01   -2.489553899413579e-01   +1.654557630098628e-01   -1.100318441864387e-01   +1.729050678283326e-01   +5.876671004368722e-02   +4.022519768492283e-01   -2.709372362848457e-01   +2.669785610332256e-01   +3.329453068362928e-01   +9.453548105641221e-02   -2.276070213164775e-01   +1.557501777995823e-01   +2.206908691107786e-01   -1.644545038646268e-01   +1.401037045281958e-01; +5.311505278894526e-02   +4.652037539268592e-01   +7.465195959088862e-02   +5.272591702537562e-01   -5.017272534242269e-01   +5.252689332514601e-01   -6.993795882805066e-02   -4.060272267396649e-01   +4.715017525976507e-01   +1.132393997256260e-01   -2.238699466162529e-01   -5.268399244466513e-02   +2.507570077723512e-01   +3.148314222508141e-01   -4.578918015215963e-02   -4.788246325254442e-01; +3.292504405762128e-01   +8.600021692873118e-02   -2.695059282122506e-01   -3.663941148829205e-01   +1.370292401795374e-01   -3.591304849377998e-01   -2.571751385389893e-01   -2.831488405083710e-01   -8.431703989054753e-02   -2.724051964288840e-01   +2.114385690179539e-01   +8.157912715044233e-02   -5.842063500420189e-01   -6.062381753853268e-01   -1.336437989534123e-01   +4.883359619107749e-02; +1.595280890268561e-01   -2.256288071621440e-01   -4.236398483258288e-01   +5.249759469097091e-01   +5.053107974944123e-01   +1.724039820624604e-01   -1.485223869234271e-01   +1.238770911091123e-01   +2.108843736320415e-01   -2.974529646912741e-01   -8.576968969437625e-01   -4.250239774828332e-01   +4.657174597357330e-03   +1.052621889938032e-01   +8.369228959054476e-02   -1.456778110824785e-01; -2.401112009787433e-01   -1.793031234138292e-01   -3.623496191392931e-01   -8.760150485577017e-02   -6.111436974767864e-01   -8.281880386491050e-01   +2.265829742248105e-01   +5.161778524727870e-01   +3.373075929292569e-01   +2.372058252021728e-01   +3.809559252304914e-01   +3.728278094300443e-01   +1.660240729119529e-01   +9.592575198161752e-01   -2.495006594349940e-01   -1.450487362185688e-01; +6.676710123475784e-01   +3.312004624405034e-01   -4.095949861589371e-01   -1.735753762691342e-01   -2.502635972416180e-01   -1.298590472504398e-01   +2.583947370896775e-01   +2.085780756129845e-02   +3.989413522325774e-02   -1.667243486019832e-01   -3.697517388772267e-02   -9.336393212542088e-02   -2.105457915920332e-01   +2.622657670979258e-01   -2.360349397285481e-01   +4.332977248794755e-01];
L2I_L1I_iGABA_netcon = [+7.654649876607214e-01   +1.236691170201656e-02   -5.912526208408855e-02   -1.319710833500264e-01   -4.489058386823235e-01   -5.087819156360898e-02   +2.807719417405129e-01   +6.797440804350052e-02; -9.675682961165416e-02   -2.660356840962722e-02   +8.397282919486997e-02   -4.247408095796912e-01   +1.558046170487184e-01   +3.737605644041680e-01   +2.699465083483016e-01   +2.942033425371868e-01; -2.304269751625054e-01   +4.477505305283517e-01   +3.125978058622146e-01   +1.147329204707586e-01   -2.184215683968972e-01   +8.139221699982600e-02   +3.522824974366777e-01   +6.284504877262284e-02; +4.303690161593923e-02   +7.061601551756723e-02   +3.775437761802791e-01   -5.595187545617235e-02   -5.800345003244174e-01   +3.842010243552497e-01   -1.549989551650384e-01   -4.906024189946030e-01; -7.441229160711464e-01   +7.166278821141872e-01   -2.455468196399803e-01   -1.183997415676464e-01   -1.040324022420045e-01   +2.656085104687434e-01   +1.346009964900739e-01   -3.915600039666865e-02; -1.802174248547904e-01   +2.031341907707824e-01   +6.044742639087317e-02   +5.898660325495839e-02   +3.050239233841596e-01   -2.094933585077311e-01   +4.623742977190037e-01   -1.928605847692444e-01; -2.123994201071591e-01   +1.321594291930881e-01   +5.711661669022179e-01   +1.435073234120336e-01   +6.121988308611595e-02   -1.429271206739940e-01   -9.317177468162947e-02   +9.938976662513854e-02; -1.255847877364088e-01   -3.104951869724494e-01   -3.584162101793587e-01   -6.723258238533947e-01   -1.023843287411547e-01   +4.447906648484689e-01   -2.211255473632864e-01   +6.014416203803448e-01; +9.200164418217367e-02   +9.345240181186459e-03   -1.091655419048904e-02   +6.095913150708195e-02   +4.715722349785761e-03   +1.957680891360524e-01   -3.797113159047544e-01   -2.024895049826919e-01; -1.869106132305348e-01   -5.316206475578563e-01   -5.091175620030018e-01   -7.998345348771525e-02   +4.051280238310519e-02   +3.316947499407503e-01   +1.689846365430426e-01   +2.344274883757482e-01; -4.653312668262303e-01   -2.916357746431862e-01   -1.488858556614007e-01   -1.872796129680198e-01   -2.389638343389829e-02   -4.730848897109797e-01   +3.497491589442263e-02   +1.682069674578575e-01; -3.973276557270228e-03   +1.619979451425450e-01   +2.829879095300803e-01   -4.051237029604720e-01   +3.015509937812562e-02   -4.691328987278387e-02   -1.737435658949514e-01   +2.048277270113026e-02; -1.659401768658281e-01   +3.273737439413273e-01   +4.579912138449221e-01   +7.421023001851966e-02   -3.438394760553911e-02   +9.617120247463858e-02   -3.167308142137921e-01   -1.143874002257056e-01; -7.319213142974323e-02   -7.090300967809723e-02   -6.946629853718257e-02   -2.142103964503308e-01   -4.483759738211380e-01   +1.604891117593946e-01   -3.218597233588745e-01   -6.999811555037370e-01; -3.674759322361875e-01   -1.189308009621565e-01   -8.551642005727370e-02   +2.727397812717766e-01   -3.527677828306059e-01   +4.212578500851247e-01   +2.404220311065483e-01   +3.038652901888764e-02; -4.799589891676631e-01   +7.823971376448177e-01   -2.712939066500361e-01   +1.482962593446467e-01   -4.326699928419894e-01   +2.640789391777995e-01   +1.156217896971651e-03   +4.932862935917960e-02];
L1I_L2I_iGABA_netcon = [+6.996275874960645e-01   -3.591738729968993e-01   +5.335828411300035e-01   -2.079853562723918e-01   +3.197972878984390e-01   -2.873610149897850e-01   -3.463656270544309e-01   -6.620768395133233e-01   +1.359229370990802e-01   -6.259406674531770e-02   -2.933647045822039e-01   -1.681665521582753e-01   +1.042512551662753e-03   +2.516307393255356e-02   +1.597531874874467e-02   +4.103558077501139e-01; -6.472112421065647e-01   +1.207801786917113e-01   +6.075159625813694e-01   -1.919678943143363e-01   +3.702403049071601e-01   +4.384405315575698e-01   +3.460281563707897e-01   -3.910561663914877e-01   +1.465886064841614e-02   +4.941129279413944e-02   +1.883098525312534e-01   +6.519619133156469e-01   -6.615969646984652e-01   +5.564400182255252e-01   -5.255041837684056e-01   +1.004934853607429e-01; +4.845147577489330e-01   -3.688851202745964e-01   +5.436177936460137e-01   +6.504642068948578e-01   -1.464674661212411e-02   -4.510853624931963e-03   +2.645462506356724e-01   +5.174665105156916e-02   -6.948644072420904e-02   +1.579060351286724e-01   +1.793682251241264e-01   -4.343224934913871e-01   -2.039069896549798e-01   -1.590449715369643e-01   -6.675510853993583e-01   +3.082106870380603e-01; -1.766471079973961e-01   -2.663678198721367e-01   +3.180693031582265e-01   -3.520249201048070e-01   +5.558291028472049e-01   -8.082210008005464e-03   -2.110695223165822e-01   -5.512470582116832e-02   -1.467484775558561e-01   +4.570693423088251e-01   -3.386409025682564e-01   +3.986625647939601e-01   +2.889484833823733e-01   +1.462579584175186e-03   -1.670368311280263e-01   +1.739543190078443e-01; -1.610730895488854e-01   -3.166381730685713e-01   -3.745206875528241e-01   -4.022055080833934e-01   -1.641988361018871e-01   -3.972789901271123e-01   -1.413334817143552e-01   -2.291056091909637e-01   +2.190850707985343e-01   -4.761947158918489e-01   +2.460798680789633e-01   -1.171437965234853e-01   +5.245978693387964e-01   +8.143132452492240e-01   +6.065120561673873e-02   +5.008342715220228e-01; +3.329137528044875e-01   +8.194034247157995e-02   +6.359204319643539e-01   +4.725358853485518e-01   -7.930532853416086e-02   +9.188510639477049e-02   -4.036239187068396e-01   +3.593744760169846e-01   -2.194715912207257e-01   -1.146745725399886e-02   -2.190969822757595e-01   -2.916317409804725e-02   -4.160573057776338e-01   +1.469511417115704e-01   +4.357523306233965e-02   -4.587398141457518e-01; -5.698284768081083e-02   +4.906829379200405e-01   -2.641249772418125e-01   -1.248320066896165e-01   +8.958189182680142e-02   -7.280452224459388e-03   +6.856831908854383e-02   +3.044416748645382e-01   +1.563796776462346e-01   +2.298410290637881e-01   +7.191997831970162e-01   -2.836123307229474e-01   -1.639655290704753e-01   -5.752155084346017e-01   -7.294166055389664e-01   +3.739200304151089e-01; +2.520845574748240e-02   +7.101526567117621e-03   -6.860502084619496e-03   -1.963551688203100e-01   +2.106464918174876e-01   +2.367196285588094e-01   -3.348646136839378e-01   +3.381681718036009e-01   -1.683875624655561e-01   -3.683058781410530e-01   -8.723185042456777e-02   +3.844993863265218e-01   +5.555270301218236e-01   +3.440742014258993e-01   -2.222929178404720e-01   +8.280329418416957e-03];
L2E_L1E_iAMPA_netcon = [+1.159836663925288e-01   -2.009069676976759e-01   -3.755099596904804e-01   -5.234291984692124e-02   -3.673159723181716e-01   -3.465605602122203e-01   +3.662422939658476e-01   +3.655013159315522e-01; -2.573948253752104e-01   +7.286939382418245e-02   -4.216139835803172e-01   -1.901842478460661e-01   -2.099701093478083e-01   -1.507104966328666e-01   +1.347627021980511e-01   +1.487250336993170e-02; -6.951872789651115e-01   +6.852400646117521e-01   -6.515776226825016e-01   +6.237546067982729e-01   -2.485312437881884e-01   -9.486758283123342e-02   -3.362500611657603e-01   -2.137952022862269e-01; -6.515659183057699e-01   +5.983152349746117e-01   -2.028642672690902e-01   -2.430674613640516e-01   -1.019441802619683e-01   -8.951707260444957e-01   +3.169144326486968e-01   +4.997754310156682e-01; +1.689208501793067e-01   -3.110701135603544e-01   +1.286849429247393e-01   +6.408008169887761e-02   +1.639519808324095e-01   +2.869703893605056e-01   +1.088146840662401e-01   -5.174927571965224e-01; +6.197470134095580e-01   -3.482225789216803e-01   +2.210322063574599e-01   -1.756933751770239e-01   +3.427726550705642e-01   +5.370910911689629e-02   +1.815256015585733e-01   -2.086024792329518e-01; -9.759902729824527e-02   -5.917496200544295e-01   +3.722125419892417e-01   -4.582104383758751e-01   -2.419289929285508e-01   -1.929740676734090e-01   -7.174076028196544e-01   -1.724593677132405e-01; -3.677379601524408e-01   +3.050468443063775e-02   -1.322567403779690e-01   -5.648347970192338e-01   +2.867883353015607e-01   -3.132555698187476e-01   +1.007326521086966e-01   -2.933448971341039e-01; +8.844853997784649e-01   +5.008097633478592e-01   +1.714906577206770e-01   -4.289689633885889e-02   -3.511751348414502e-01   -4.220271675822325e-01   -2.798303693168561e-01   +2.963329659559982e-02; +4.526554207796569e-01   -1.537199396975119e-01   +6.305674299765449e-02   -1.254871707868413e-01   -8.050348125877639e-02   -1.068021886533469e-01   -5.873046387471501e-02   +5.982612115437164e-01; +1.637675681057258e-01   +4.152046226947403e-02   +3.092913428552728e-01   +3.351076637132462e-01   +3.681687742419181e-01   -2.056067846253208e-01   +2.147999892737276e-01   -3.474923642920282e-01; -8.113535179473430e-01   -5.873956012621651e-02   +2.201737141316168e-01   +3.668880883711685e-01   -5.005013676573165e-01   +3.843704823107936e-01   -2.722557469665037e-01   +1.775759196061769e-01; +6.189337206052153e-01   -1.637520161571774e-01   +7.080824788455634e-02   -6.438215416751999e-01   +2.001309370628504e-01   +7.589371930472228e-01   +2.945251043086164e-01   +1.958035305009625e-01; -3.694345453362304e-01   -2.810976896189977e-01   +2.781768070834257e-01   +2.699869254958892e-01   +9.209293900171960e-01   -1.579213024128158e-01   -1.809453777880977e-03   +4.085381943732992e-01; +1.283839184415379e-01   +9.478970514221165e-02   -1.688416547967436e-01   -9.320307903684924e-02   +3.726238659332759e-01   +5.053060828427982e-01   -5.020560742604318e-01   +9.574944074529335e-02; +3.324929109816721e-02   +2.322208857323335e-01   -6.409377147445872e-01   -4.986639071162097e-01   -2.791576903573424e-01   +2.568426643196736e-01   -3.626253751860515e-01   +2.635502024256036e-01];
L1E_L2E_iAMPA_netcon = [+2.836292834697677e-01   -4.148194342193328e-01   -2.979161612916099e-01   +2.552937930122591e-01   -2.819011905724864e-01   +1.034582012577232e-01   -2.867279287186159e-02   +4.124826322082807e-01   +4.314770698248562e-01   -1.469066019565070e-02   +1.725724832408605e-01   -4.133915908503513e-01   -8.266609715947708e-01   -9.045182976287112e-01   -2.135696557045105e-01   -6.693946337017371e-01; +7.219008741864723e-02   +4.768638813565917e-01   +6.070533700995382e-01   -5.221592075073006e-02   -4.679398113989224e-01   +3.145684524227565e-01   +2.205345204060121e-01   +6.554941634820158e-02   +1.906683512865965e-01   +2.804753301492924e-01   -1.561802477597949e-01   +6.895880608082532e-01   +4.395509806889608e-01   +1.828374314185615e-01   +1.852695584109444e-01   -6.833794921494046e-01; -5.126316000224993e-01   +6.795809021165122e-02   +2.647618871609927e-01   -9.856567547762217e-02   +1.313859032879711e-01   +2.264310197866763e-01   -4.681075428643217e-01   +2.991007643577323e-01   +3.558817533630344e-01   +6.491638916346025e-01   +1.590615731185862e-01   -2.214092022690435e-01   +8.466535926168381e-02   -6.677486560716819e-01   -1.192090629237723e-01   +4.686652406036687e-01; +2.856868997711915e-01   -4.202213469535754e-01   -3.146203433420374e-01   +1.532969314954090e-01   -2.894758632130123e-04   -1.499972664663824e-01   -7.778599764772974e-01   -4.722344469404517e-01   -7.051238984908068e-01   +1.389590510945660e-01   +2.490107518173464e-01   +7.015108804569457e-02   -8.615971438607531e-01   +3.474443499071074e-01   -3.321762106148681e-01   -8.466382651090717e-01; -2.245318164907147e-01   +4.829873225330278e-01   -2.449167783499998e-01   +1.319355392701682e-01   +7.174340056651679e-01   +4.980965762494459e-01   -3.831248780747626e-02   +1.900226918318252e-01   +1.507618777030605e-02   +3.557353084824122e-02   -9.757369802333704e-02   -1.614485711202326e-01   -6.702555652172082e-01   -5.325066652456079e-01   -2.122905260077351e-02   +6.260033688115843e-02; -5.943545358516606e-01   -7.605741069526888e-01   +3.395759266358903e-01   +4.571717192840399e-02   -1.168322248662397e-01   -1.794033223342941e-01   -3.461139140494639e-01   +1.736662594185871e-02   +4.818163190185814e-01   +1.493134069105258e-01   -4.996756977540606e-02   +3.928753124790214e-01   +7.791674643541484e-01   +1.013212905166427e-02   -3.290214393300354e-01   +7.790646294225463e-02; +2.740093931437343e-01   +4.367599971295394e-01   -7.489600095797030e-01   +1.489658676298592e-01   +4.993724159415358e-02   +5.833176910124770e-01   +4.084558173093580e-01   +2.486874204773454e-02   +2.237243226049300e-01   -1.534312013223159e-01   +9.922631306157365e-03   +7.289602557643067e-02   +4.646029240257870e-01   +2.160553636264427e-01   -4.582965248079425e-01   -1.472558593420454e-01; +4.353251721261467e-01   +5.528990831756058e-01   -1.049470910256988e-01   +5.233177742414861e-02   -4.869156440087999e-01   -2.045593542757439e-01   -3.440872826283461e-02   -1.733830073051469e-01   -1.976467119632131e-01   +1.334206248901820e-01   -7.786328066068554e-02   +3.883915114907488e-01   -2.750127998063615e-01   -2.623766343673062e-01   -4.788784228051549e-01   -2.610605072723333e-01];
L2I_L2E_iAMPA_netcon = [+4.619663508369456e-01   +1.370155286005878e-01   +1.679536983871655e-02   +6.250459006120161e-01   -4.856098578320062e-02   +3.108673817225621e-01   +4.695400009727103e-01   +4.373074238392212e-01; -3.510788159518540e-01   -8.300275814437633e-02   -3.775594738523972e-02   -1.160433892531378e-01   +2.897863857555347e-02   +4.738701295956169e-01   +1.852367130921982e-01   -7.459220724470030e-01; -5.531064106618117e-02   -2.110854493173667e-02   +3.021579651866105e-01   -4.436771988111293e-01   -6.997903351436232e-01   +2.393450456023260e-01   -5.544041345277742e-01   -2.145304658300089e-01; -2.075807348494666e-01   -5.372173378299684e-01   -6.906753359251985e-02   -6.752759262464696e-01   -3.679226698520380e-01   +1.926222458425489e-01   -4.973891439735136e-01   -7.441282672930186e-02; -6.869285929222494e-01   -2.029332670290445e-01   -3.113792481717038e-01   +3.739573400939381e-01   -2.733409299794948e-01   -1.745848511683587e-02   +2.371982717359216e-01   -2.233700781160075e-02; +6.016989555915413e-01   +6.633511837120006e-01   -1.311434486053323e-01   -6.147789130203023e-01   +1.056060643802234e-02   -2.488421700038437e-01   -2.394616591581949e-01   -2.623454649037550e-01; -6.327051986786189e-02   +2.972995977268073e-01   -6.944828239536908e-01   +2.577146577907854e-01   +3.796936794223276e-01   -6.429918984292450e-01   -9.194141755649704e-02   -2.089153615956328e-01; +6.018583316401185e-01   -3.433615756653537e-01   -1.934586255398505e-01   -2.337572517353763e-01   +6.475370740007698e-01   -7.829766592863180e-02   +4.109200146209989e-01   -7.960818655936350e-01];
L2E_L2I_iGABA_netcon = [-4.329139436990613e-01   -8.033537027961342e-01   -2.058063460596538e-02   +1.960311864388851e-01   +7.449643416761170e-02   +6.144828073177566e-03   +1.183401143751138e-01   +1.182915581422194e-01; +1.740033535341117e-01   +6.951940257096152e-01   +4.841440690830676e-01   +2.513763634693537e-02   -4.174358642153654e-01   +1.288100053738781e-01   -4.257683086557686e-01   -3.642101134274385e-01; -8.467637967046640e-02   +8.177120849060368e-02   +4.434550147940526e-01   +5.914266186643540e-01   -2.755930232052336e-01   +1.803153389628936e-01   +1.897435738583237e-01   +6.543468913127154e-02; +5.013908647305055e-01   +5.788066807827290e-01   +3.586564307996812e-02   +4.947492807524982e-02   +5.081759437833925e-01   -6.255550380843740e-01   +6.900145013307502e-02   +3.525640678108924e-01; -3.612347191552875e-01   -3.701097890748619e-01   -3.289844160829503e-01   +4.354107812360895e-01   +2.095546640432475e-01   -4.460473035311943e-01   +4.121929355751077e-01   -8.841136144780866e-02; +7.444029217381475e-01   -1.989349485495049e-01   +5.305421753029500e-01   -1.408725258883906e-01   +4.316082067368679e-01   +2.478300017743769e-01   +5.382138760231677e-01   +3.888474297757947e-01; -3.579740548354263e-01   +1.588144315980967e-01   -8.037276066959728e-02   -8.630530729829611e-02   +3.536033981450717e-02   -3.040982457619005e-01   +3.832619831438767e-01   +5.113152408038951e-02; -6.694048600820744e-01   +2.895003071046100e-01   -6.468206872738563e-01   -5.048712317607526e-02   +6.366593867595155e-01   -2.852034842432863e-01   -4.569303143328932e-01   -6.164345803418827e-01];
L3E_L2E_iAMPA_netcon = [+2.609548870585177e-01   +2.523324921996137e-01   +2.041772349795188e-01   -2.575634592474226e-01   -6.211482679042313e-03   +1.665056021883105e-01   -1.948029338561949e-01   +1.612767374884785e-01   +4.210212620757841e-01   -8.174815935902717e-01   -9.304223173128136e-02   -6.055416679287670e-01; +5.015807913830964e-01   +3.251852192755635e-02   +1.011926198834669e-01   +3.918827257668724e-01   -6.778257524800958e-02   -8.020037353670053e-01   -3.071822422801430e-01   -4.738935047215326e-01   -3.297303692134654e-01   +4.812859150990373e-01   -6.046409244314370e-01   -1.720159591378718e-01; +4.364641074178773e-01   -4.857101618203311e-01   +7.225387993733225e-02   +3.921665090739216e-01   -6.543453943269721e-01   +1.542305100743687e-01   -5.714316601763383e-01   +2.550977606091938e-01   +4.740785156705856e-01   +6.303478189999491e-01   +8.524214231692983e-03   +8.726706179020363e-01; -9.694218880789243e-02   -5.798424682206108e-01   +4.230746864363079e-01   -6.557612062208679e-01   +1.192517916198388e-01   -4.248810526740026e-01   -3.731702484917051e-01   -1.671199572569491e-01   -4.035001026725015e-01   -1.389238944617547e-01   +5.022470972104967e-01   -6.592615786639910e-01; -6.318945304904379e-01   -4.621577784617855e-01   +3.012419230890007e-03   +4.531653833960501e-01   +3.553012971539756e-01   -2.327259057001155e-01   +2.769819439148659e-01   +2.990651110284573e-01   -4.931036223124038e-01   +7.910722289924535e-02   +8.426637448500193e-02   -6.317706347771052e-01; +7.211338785240270e-01   -1.823572503594372e-01   +2.635913845608697e-01   +2.633200207527483e-01   +2.406689177689466e-01   -4.980159237957912e-01   -1.596156601953703e-01   -7.097965367838831e-01   -1.672172243673180e-01   +2.496044105865786e-01   -3.261410303751008e-01   -5.200679352050702e-01; -3.458125793000193e-01   +2.521687425330760e-02   +1.544011414219983e-01   +9.546061553980248e-02   +2.002131453393626e-01   -4.426971560361841e-01   +1.819847664442035e-01   -1.953060914747617e-01   -3.659668279863735e-01   +3.344325341052541e-01   +2.379331435758569e-01   -5.353508200705082e-01; -6.294411737229116e-01   -2.062301183042223e-02   -7.666892886557761e-02   -1.679588883717655e-01   +1.153507949015910e-01   +9.922828395999321e-02   +2.365528533587893e-01   -3.373808757818695e-01   -2.106515956923141e-01   -1.412433381291645e-01   +1.829408320951391e-01   -3.190359940081532e-01];
L3I_L2I_iGABA_netcon = [+1.548602785772742e-01   -4.077323310732450e-02   +9.369391753628917e-02   +1.823612995676866e-01   -1.813834116878922e-01   +2.613704608585926e-01   +2.039323340829610e-01   -5.866045653595367e-02   +3.832864860744030e-01   +5.769591710739834e-01   +2.316858421068802e-01   -6.812756557996414e-01; +3.790338700699331e-01   -5.887158875902306e-01   -3.985667038895365e-01   -2.534863405168609e-01   +7.130897362854959e-01   -3.244278664699814e-02   +4.777249797074994e-01   -7.057830798013579e-01   -5.750862183203261e-01   -3.886816913421918e-01   -5.048444635537956e-01   -4.705961632986036e-02; +1.075375335937875e-01   +3.544608067847567e-01   -2.574249349150138e-01   -1.449919289373567e-01   -2.559512546311808e-01   +3.861214499045523e-02   -1.371184276064751e-01   +4.864586947348724e-01   +2.674631039556499e-01   +5.585218681493945e-01   +2.899802191764443e-01   +1.850143030389942e-01; +3.866523038899727e-01   -5.691277933041214e-02   +1.764695786969184e-01   +3.600865057748003e-01   +9.932336443995159e-01   -4.055429574923452e-01   +5.655336933535482e-01   -1.454073247831466e-01   +5.674381309578559e-01   +4.443371068298085e-02   -1.383203948427500e-01   -2.175163703979094e-01; +4.484673698946938e-02   +3.788957111413173e-01   -8.255776143037797e-01   +4.775554652590574e-01   +1.009038410061537e-01   -6.708587803167831e-01   -3.150236451837481e-01   +4.254271687231948e-01   +1.842302043745236e-02   -2.519613354917575e-01   -4.305249253373317e-01   -4.195347166188853e-01; -2.432429122568569e-01   +1.401497169670006e-01   -3.719343600614995e-01   -4.432542957720811e-01   -1.678583889156187e-01   +1.851194165433533e-01   +3.437858398843053e-01   +2.671947494634910e-01   +7.283742783019049e-01   +3.674186495828003e-02   +1.162270336516855e-01   +1.874140675046000e-01; +1.135701895889333e-01   -3.902378470496269e-01   +4.295929526753844e-02   -2.587494310583650e-01   +1.813088002468720e-01   -1.428060536208463e-01   +1.743219019245073e-01   +9.908696474424272e-03   +1.137898712177454e-01   -4.500811438749307e-01   -4.806593673384745e-01   -1.145496194497863e-01; -4.568631077600038e-01   -1.222321089018202e-01   -1.104587307410628e-01   +5.629897014387427e-01   +8.093076374225072e-03   +1.987863432546802e-01   +1.837009951048655e-01   +5.312186364776126e-01   -6.822761896573648e-01   +3.204274211932280e-01   -5.111530043702605e-03   +1.318977951277752e-01];
L2E_L3E_iAMPA_netcon = [+9.164319955869211e-01   +8.137244144643451e-01   +1.384585351859952e-01   +3.633294322123720e-01   -7.083627905357539e-01   -5.746876028226430e-01   -2.558969141002495e-01   +4.873929455688648e-01; -2.524446727739043e-01   +2.701163207805397e-01   -2.288000156709127e-02   -5.033566208475633e-01   +1.606305424149337e-01   -5.977860307752431e-02   -5.703253604470354e-03   +1.060350459775559e-01; -1.975875636896994e-01   -2.856372658407949e-02   +5.649606251880523e-02   +2.385360394246440e-02   -2.441033524040931e-03   -6.424243516517205e-01   +4.343994770800657e-01   +6.745489536266877e-02; +3.890424354257194e-01   +4.463516118764880e-01   +3.466031705413972e-01   -4.522260289128170e-01   -5.246150635242090e-02   -8.400904140336929e-02   -1.743815089109247e-01   -1.194757450342088e-01; -1.172825308650737e-01   +1.351617612998744e-01   +3.770048370726908e-01   -3.081068892085488e-01   -6.104374282708536e-01   -3.407212491642563e-01   -2.891301606658325e-01   -1.128829947585599e-01; -9.784269311760654e-01   +6.014890413961322e-01   +6.813112318350603e-01   -3.222931559970285e-01   +4.695134115034350e-02   -3.874080318722123e-01   -5.777413859909793e-02   +8.229690065823389e-02; -4.565650566247949e-01   +3.947230668895908e-01   -1.575777461497292e-01   -5.702770154436760e-01   -6.012273472131782e-02   -3.025922337734045e-01   -2.511790410106862e-01   -2.539023983632046e-01; -2.106863785162515e-01   -7.065176047072372e-02   +2.777510271951221e-01   +4.746340963427371e-01   -5.206031855709827e-01   -2.771207477980436e-01   -3.990699912046169e-01   -2.491089598474348e-01; -3.104079907245757e-01   +2.598353249816989e-01   +2.453321535294701e-01   +1.509894219725255e-01   -4.293463969168558e-01   +2.000141917623269e-01   +2.770103444088561e-01   -3.664733714241941e-01; +1.309926002975442e-01   +6.334877222882294e-01   +6.878951729447579e-01   +3.707934745664790e-01   +8.598491727665081e-03   +1.986700586818874e-02   -2.156841163924468e-01   +2.328568641479547e-01; +1.912690996451413e-01   +1.533269670335121e-01   -3.576189540599935e-01   +5.165933089494669e-01   +5.866253636953247e-01   -5.321095341397253e-01   +5.340036970232703e-01   +2.308121943158160e-01; -3.861483957716735e-01   -2.963963501127346e-01   -1.387247138963007e-01   +5.388516104006722e-01   -2.397704650649966e-01   -2.201332401889426e-02   +9.163012585507323e-02   +1.272650311781537e-01];
L2I_L3I_iGABA_netcon = [-8.797380596644394e-02   -2.849814783848332e-01   +3.772849503868382e-01   -3.254314108992820e-02   +8.449183079296606e-01   -1.882114131658318e-01   +2.298970498306825e-02   +4.433453516281790e-02; -1.533190881983460e-01   +2.053794028331198e-01   -1.626797048349571e-03   -4.291759326996633e-01   +3.008119376476386e-01   +2.096880345458497e-01   -4.093899375507378e-01   +6.241804985192898e-01; +1.421759359013047e-01   -6.965830145873086e-02   +2.667791644501354e-01   -6.030202862884987e-01   -3.993654296907957e-02   +2.611671053837786e-01   +7.523606782139942e-02   +2.773664225300330e-01; -3.023258094239218e-01   +1.079221965632266e-01   +1.709374574289397e-01   -6.105511044875502e-02   +3.654215848325336e-01   -2.218843259016803e-01   -1.236226794263860e-02   -1.127620099214304e-01; +8.861067668426388e-02   -5.714056165987199e-01   +2.506973619252352e-01   -3.054096305775587e-01   -4.935138683357309e-02   +6.512943105663659e-01   -4.990993575572840e-01   +5.562016836545014e-01; -3.037725490317152e-01   +6.046735844709784e-01   -1.000000000000000e+00   -5.861775852168111e-02   +7.918303276376280e-02   +3.744718932871707e-01   +8.255824431213150e-02   -3.310118419160320e-02; -5.662574504062241e-01   -6.961669629883568e-01   +4.600605841710214e-01   -2.969231800957470e-01   +4.935861923485623e-01   +1.704351164718516e-01   +4.983961172522072e-01   -5.739828729014575e-02; -2.626905798660589e-01   -3.187377751069896e-01   +1.968173874596376e-01   -1.186778264080972e-01   -6.626023857370947e-01   +1.444910481463025e-01   +3.223638489249416e-01   +8.092459822950739e-02; -4.391964859033569e-01   -1.614953450255694e-01   -3.455062354269394e-01   +5.070583151203895e-01   +1.081152858368324e-01   -4.769900303645562e-01   -2.365013646359161e-01   +2.034046080973403e-02; +2.786906249950810e-01   +3.712934608926093e-01   +3.089689241840857e-01   -1.669576595352913e-01   +5.754558698405330e-02   -4.729613400341678e-02   +1.272764122219705e-02   +4.752989000198104e-01; +5.258399946530733e-01   +1.635208196602455e-01   +2.117922556621350e-01   -9.450537371484469e-02   +3.355828636930461e-01   +5.255566459860510e-02   -2.718938218152877e-02   +1.296851124954206e-01; -1.562734712143193e-01   -5.139286630871884e-01   -7.654743135169567e-02   -5.038408007065217e-01   +2.896237815817186e-01   +7.976671744633489e-02   +2.165062990619594e-02   -5.941005880547079e-01];
L3I_L3E_iAMPA_netcon = [+3.191032792987413e-01   -3.991556856288418e-01   +4.627543754063633e-01   +6.649642253816723e-02   -2.683775798317853e-01   +1.625727398061466e-03   +3.209393862600333e-01   -5.980811360943830e-01   +2.008180785492644e-01   -5.325097104757448e-01   -5.605213736347222e-01   +5.704789125987491e-01; +7.019002787974937e-01   +8.798335332101987e-01   -3.910934660707152e-01   +6.616652109779186e-03   +5.278419681700582e-01   +6.282602881812356e-01   +6.917338477585752e-01   +6.341262666828618e-01   -9.794826687337202e-02   +3.660635415713411e-01   -5.965815765043385e-01   +2.072489742797261e-01; +1.543064704970801e-02   -4.998903630217097e-01   +2.315956316820267e-01   -1.237258228082210e-01   +5.427251869951779e-01   +4.400363581166152e-01   -1.202530018518462e-01   +3.801169572044097e-01   +2.692624222163891e-01   -5.891728626963523e-01   +4.740037234758479e-01   -2.865392883250520e-02; +7.141625123668804e-02   -2.354944348927930e-01   +7.344225366490786e-02   -5.761754082899293e-01   -1.542025389869812e-01   +2.160693199930791e-01   -3.562987022219349e-01   +5.322482110946535e-01   +2.346716731689805e-01   -4.437505998237780e-01   +5.385764611360591e-01   -2.747679844981884e-01; +3.721499029173944e-01   -9.777846048813049e-01   +4.352784212801116e-01   +2.403242040669284e-01   +2.190235843379700e-01   +2.695793543387809e-01   +4.616685260366515e-02   +3.823813217559019e-01   +3.901079729783999e-03   -5.941565094857529e-01   +2.666894520403670e-01   +5.735040269117538e-02; +5.327180545361751e-02   -9.811950924425179e-02   +1.650881999721676e-02   -3.399554807863995e-02   -3.175068059861808e-01   +2.469025467482780e-01   -4.582583823289041e-02   -1.822630469501678e-01   +6.188746377090540e-02   -3.044439294504819e-01   +4.113062528987272e-01   -3.872680125571569e-01; +7.113643363081884e-01   -5.343607785730308e-01   +2.919761626847043e-01   +6.233555556077861e-01   -3.327509590083488e-01   -1.190657107597976e-01   -5.291228733572044e-01   +4.149940324157900e-02   +4.294486205663824e-01   -9.710274674181991e-02   -1.654853901868457e-01   +2.910817924320095e-01; +5.427638458499151e-01   +6.212703828535621e-02   +1.510899543907238e-01   -2.568561185292759e-02   +5.915770390539574e-01   +7.046481457016135e-01   -1.810841599429136e-01   -4.712597949546559e-01   -4.655050440982003e-01   -3.197851670769136e-01   +2.515693645777351e-01   +1.906824958253329e-01; -6.238635919141769e-03   +1.282509793272071e-01   +2.440269168930211e-01   -6.256736009787748e-01   -6.008988478605160e-01   +1.935972377935992e-01   -2.591188027667046e-01   -8.197270451169815e-01   -5.986899335846876e-02   -2.765378497098411e-02   -2.992337940400439e-01   -1.111734800160764e-01; +6.666745727455679e-01   -4.030697726342388e-01   -3.349994898851516e-03   +3.635537048764867e-02   +4.716192541304590e-01   +1.775145042073741e-01   +7.135566940167787e-02   +4.273805363233044e-01   -5.492288979329332e-01   +3.486322493954346e-01   +4.536967196923566e-01   +3.049112082967416e-01; -4.124882297959247e-01   -3.016924971696652e-01   -6.168475678691666e-02   -4.385112038395321e-01   +5.485816728310099e-01   -2.966490784682491e-02   +3.607376622906520e-01   +5.975117810397612e-01   -2.033105452146637e-01   -6.782967370424794e-02   -2.795077559712688e-01   -2.622439513592736e-01; +6.894146804190976e-02   +1.982347625338777e-01   +2.999791200332801e-01   -2.527076014722389e-01   +3.463625292936809e-01   +1.890704972261817e-01   +1.406413357507294e-01   -2.090855419888505e-01   -4.027383453368718e-01   +8.304415915064538e-01   -1.312968035099116e-01   +4.121588977834593e-02];
L3E_L3I_iGABA_netcon = [-4.149464053076542e-02   +1.088397343885130e-01   +4.649621315808526e-01   +1.129324006858728e-02   +1.440779076316779e-01   +8.731872177128372e-02   -2.298448607825864e-01   -4.849435977943263e-01   -3.081889112606331e-01   +5.387319459996062e-01   -7.555098019315967e-02   +1.188520753719561e-01; -3.978391782737760e-01   -3.811916024583581e-01   +4.121001464029355e-01   +4.936017897890273e-02   -2.772285596801970e-01   +4.045262123177082e-02   +6.800916721216449e-01   -2.038748918610406e-01   +5.784719407150543e-02   +4.185078436332819e-01   +3.103483311280679e-01   +2.828691435909252e-02; -3.250880534795565e-01   +5.866357213624880e-01   +6.267820630112687e-01   -4.437955590321714e-01   +1.496411643523995e-01   +1.848928432397026e-01   +3.004212707915942e-01   +3.588553439800016e-01   -3.268000784821100e-01   -2.555742242949004e-01   -4.509868818970812e-01   +1.078339542890666e-01; +5.135411481496386e-01   -5.581861064890781e-01   -6.145419953218442e-01   -6.007919761665075e-01   +2.060463446081511e-01   +5.674230155062983e-01   -3.617272700424543e-02   -4.336153976207928e-01   -2.265313164222375e-01   +1.429387629126591e-01   -5.497478948871717e-01   +2.411595347087659e-01; -8.487881432496560e-01   +8.300781880032497e-02   +1.747108101347081e-01   -3.965382849796150e-01   +6.509587535782442e-01   +1.759455170447621e-03   +4.737414105370724e-02   +6.480028663392384e-02   +3.284582901826794e-01   +2.464365458352397e-01   +3.243813481506708e-01   -5.876564883049551e-01; +5.444907720078929e-01   +5.075792705267899e-01   -3.288586395428928e-01   -1.026103558856791e-01   +8.766323313225508e-03   +2.194920634996200e-01   +8.965716690310220e-02   +3.277971994174852e-01   -4.858503883467035e-01   -3.410658242308502e-01   +4.491786740512355e-01   -7.953451550456400e-02; +1.998870033489325e-01   +3.514295721799262e-01   +5.000720446003637e-02   +2.540739317029190e-01   -4.636608777318153e-01   +7.835942835129160e-01   -3.613522155743797e-01   +2.713369354829060e-01   +1.275203311251763e-01   +4.776735032911514e-01   +1.544748648657898e-01   -4.345550923147001e-01; +2.407982259322697e-01   +8.928820728891326e-02   +3.708314827898309e-01   +1.652505684171534e-01   -4.339043989275006e-02   -1.038115563908251e-01   +5.463509989873820e-01   +3.039005035868219e-01   -3.802307645539343e-01   -2.391338502357706e-01   -2.804844583403456e-01   -3.871776612136458e-01; +1.906348012913850e-01   -1.802163412706649e-01   -3.809266333732081e-01   +3.383088858343825e-01   +6.808434777084169e-02   -4.837969205175483e-01   -2.033810396867179e-01   -4.236090276265776e-01   -3.393711790388305e-01   -6.240861510842184e-01   +2.318513010102969e-01   +7.366703685340939e-02; -2.100206941208464e-01   -2.152847728436559e-01   -2.250339198101081e-02   +3.808779284851610e-01   -4.818774507137464e-01   -4.681819562344912e-01   -6.201031563196263e-01   +3.273335172970239e-02   +6.139009198703005e-02   +2.815909977011759e-01   +1.667012452133883e-01   +1.776767263065210e-01; +5.023383293776001e-02   +5.330639913173019e-01   +2.027004437256799e-01   +5.804299846461355e-01   -4.675672672128817e-01   +1.108627279072986e-01   +8.131013714992427e-02   -1.618966494955371e-01   -6.982590613081086e-02   +1.306886971655307e-01   +2.538812961138351e-01   +2.666087731908399e-01; +4.324694881378727e-01   +3.035350553457069e-01   +4.830309158677322e-01   +1.657911635966957e-01   +4.225649482912728e-01   -4.031944494708429e-01   -2.438899047171617e-01   +4.258722976964433e-01   -3.233054539833581e-01   +3.882509348548079e-01   +6.149124129256700e-01   -1.816065846362091e-01];
L2E_Input1_iAMPA_netcon = [+2.976606916745443e-01   +2.290868343311527e-01   +1.294155938988858e-01   -9.101114803483632e-01   +4.274400310899336e-01   -7.295192696941474e-02   +5.653686592665839e-01   -1.732669356367255e-01];
L2I_Input2_iAMPA_netcon = [-5.659255100099457e-01   -2.061178676805015e-01   +6.832185281166610e-01   +1.043281641242608e-01   -1.317744541059808e-01   -1.437534346019565e-02   -1.304980190795792e-01   -3.001939372028164e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
