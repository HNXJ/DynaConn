function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-7.780770675322006e-02   +2.893527928052333e-02   +3.850407450802175e-03   +1.120685547974534e-01   +2.538198324741279e-01   -1.085614240853808e-01   +9.505316189994056e-02   +1.156775657363449e-02   +1.317447876586344e-01   +8.756063885867835e-02   +9.298972180260859e-02   +1.752182240480077e-01   -8.642154856181744e-02   +4.529295555694712e-02   -1.777471252681987e-01   +1.462815227625531e-01; +2.106444710224737e-01   +8.654111875035315e-02   +4.380234313545500e-02   +8.943172541288028e-03   +1.009616616901729e-01   +2.534657991894985e-03   +3.180339748580417e-02   +8.218528522213811e-02   +1.354849346333578e-01   -5.560591847328891e-02   +4.739130537543491e-02   +7.727268906621509e-02   -4.621790720969742e-02   +5.047858016849023e-02   +8.548906046610853e-03   +1.654611255161862e-01; +3.209018302660826e-02   +7.180794329064311e-02   +1.119604280900132e-01   +3.600184453788342e-02   -5.922634444137777e-02   +9.879498438249316e-02   +6.944787385188635e-02   -8.427568453806291e-03   +8.969313228494176e-02   +1.767693951142862e-01   +7.470391089593470e-02   +1.390653704506406e-01   +1.363122586780966e-01   +1.113612630269925e-01   -1.104620686079247e-01   -1.151003560854369e-01; +7.644796859114777e-02   +2.055989125139658e-01   +2.369095803579691e-02   -2.936732866718066e-02   +3.605859135163100e-02   +8.759869139524649e-02   +7.252260804778395e-02   +7.686152904829971e-02   -8.199510833503683e-03   -7.140699227088704e-02   -5.011540238961278e-02   -1.594331525040879e-02   +1.943909872787485e-01   +6.483015435541813e-02   +1.792452148702445e-01   +1.447038863317175e-01; +5.756874830271458e-03   -9.186057382427429e-02   +1.467492621946529e-02   +2.567976998247850e-02   +5.866223347287355e-03   +6.751973662208519e-02   -3.772084789084293e-03   +5.766715136650225e-03   -3.256031636765069e-02   +1.803216656079768e-01   +2.540818784629863e-02   -6.830861702352833e-03   -5.462358288460642e-02   +3.996601387114464e-02   +1.255057788541321e-01   +2.903109830937088e-02; +2.460469874020250e-01   +4.752483224105174e-02   -1.065661580772128e-01   +1.200263516801902e-01   +1.021838339747714e-02   +2.380792958181386e-01   -1.065962481107540e-01   +4.208633330671519e-02   +7.935750923248780e-02   +2.094253295592247e-01   +2.889219947706089e-03   +5.535813629380133e-02   +1.427913953616263e-01   +3.160472312222576e-02   +9.361538195286134e-03   +1.118663690053247e-01; +5.957076921880788e-02   -7.609096759041943e-03   +1.355575767047130e-02   +1.910539013873219e-01   +1.221342901588560e-01   +3.188927568339766e-01   +1.483565785434947e-01   +1.095465718083941e-01   +4.226077243331258e-02   +1.180998091584319e-02   -1.006971948227974e-01   +3.227836476031951e-02   +2.608360307470227e-01   +6.638344626341128e-02   -8.114456971622139e-02   +7.458786846542782e-02; -7.764860926881167e-02   +1.505961207013795e-01   -7.706031667375275e-03   +8.474957679411466e-02   -5.290808983182256e-02   +1.639192773148878e-01   -1.980756130532982e-03   -4.091941823682154e-02   -3.573438732637230e-02   +9.758693991609997e-02   +7.057471764445925e-02   +1.046340250238319e-01   -2.406118844101773e-03   +1.036355482291345e-01   -1.154422534709660e-02   -9.849239906919569e-02; +6.374489471317875e-02   -1.780232732895281e-02   +6.526901761327231e-02   -5.815830520476951e-02   +1.390503366857058e-01   -3.129906830493103e-02   +1.903089601830826e-01   -2.530871001065274e-02   -1.030924548750116e-02   +1.520227638145655e-01   +5.375680191768112e-02   -2.321707694375755e-02   +2.069908080968628e-01   +1.183150701482044e-01   -1.029726535355770e-01   +1.011960440250820e-01; -4.518521939525730e-02   -3.574222098393161e-02   +4.322261648200555e-02   +9.047303728663753e-02   -2.832969715448526e-02   +1.369095361532844e-01   -3.492960276146335e-02   +1.136150801688791e-01   +9.109059229111668e-02   +4.446606094144356e-02   +3.053907898314208e-02   +7.158160092459794e-02   +3.095802087756426e-02   +4.773124387442630e-03   -3.335422544379477e-02   -9.611608534399606e-02; -7.720807979202438e-02   -7.744192486541066e-02   -2.976896955982006e-02   +1.512430159422248e-01   +1.321734290506708e-01   -1.438212411757948e-02   -6.396916445219115e-02   +1.245959998863382e-01   +1.138812299038377e-01   +8.722627725974388e-02   +5.492362000320805e-02   -7.277062486921575e-02   +4.228340555279460e-02   -3.115104556603753e-03   +6.690040605328346e-02   -1.927294024542482e-02; +1.160710996156821e-01   +1.443610708551101e-01   +5.615447240287873e-02   +1.154931284915075e-01   +2.295190974395223e-01   -3.649135900423198e-02   +1.261060014228215e-01   +1.226405784722018e-01   +2.198085546908671e-02   +1.042102948532828e-01   +1.163600328900289e-01   +1.021676846194886e-01   +5.711393228870246e-02   +1.152967700420094e-01   +9.052851820207897e-02   +1.496243900347256e-01; -3.975140268420477e-02   +1.880561977302595e-01   +2.314877586571533e-02   +1.300355311286343e-01   +9.791901945328803e-02   +1.385750502567945e-01   +4.144834486595036e-02   -1.929736938563457e-02   +1.595941713175483e-01   +2.098567365751111e-01   +2.155006520572119e-01   +3.424860186242282e-03   +1.715128446884462e-01   +1.855621824535033e-01   -1.778344941607446e-01   -3.302028587681427e-02; -1.478976997219351e-02   -1.160228196615414e-01   +1.054000451785313e-01   +1.359164286604455e-01   +1.364070628301771e-02   +4.811586168955397e-02   +4.903348975941373e-02   +7.349296286774562e-02   +7.121588638225247e-02   -4.501767489101546e-02   -3.566523262384834e-02   +1.774390548409150e-01   +9.136337149237769e-02   +2.066064529539334e-01   -9.774193362202011e-02   +5.166537318371182e-03; +1.386540937960051e-01   +9.048314478146249e-02   +9.090760532786399e-02   +6.371527296907548e-02   +2.882138462080763e-01   +7.239708566683750e-02   +1.787914778068243e-01   +1.504847385158538e-01   +1.422877349317932e-02   +8.897772260330229e-02   -3.442492810943954e-02   -6.729722679965709e-03   -1.387133982203805e-01   -4.816650255756845e-02   +3.840496896432356e-02   +2.653995565979220e-01; +5.083227191771608e-02   +1.226626171448068e-01   +1.647988851168318e-01   +1.315580742044123e-02   +9.514476825021556e-02   +9.540697821751210e-03   +1.378924746882292e-01   +6.248283074593725e-02   +1.530506435052542e-01   +8.874094025044324e-02   -1.903205372930222e-02   -1.193782966796147e-01   -2.321826804405021e-02   +1.027517776763452e-01   +1.024529032017787e-01   +5.747117999782539e-02];
L1E_L1I_iGABA_netcon = [+6.525017363744538e-02   +5.202756190807414e-02   -8.109301441695303e-03   -4.490153996088181e-02   +1.652316915223010e-01   -3.348529076957771e-02   -4.021185258446194e-02   +2.151671137301036e-01   +4.286635278946017e-02   -1.064835384860640e-02   +4.095141275782477e-02   +1.745641335227181e-01   +3.398953554468325e-01   +1.265765070628260e-01   -3.970681881579720e-02   +1.359334806338630e-01; +2.251369875017817e-01   +1.199402778606245e-01   -1.216662698618517e-01   +4.230752431194410e-02   +9.927492113231788e-04   +1.422659206401636e-01   +4.872799896132564e-02   +2.843307062315699e-02   +1.441409870837830e-01   +9.595001441691564e-02   +1.392962136778871e-02   +1.627877446956662e-01   +6.792419183601857e-02   +9.550962143039038e-02   +1.085633721897037e-01   -4.118932327468172e-02; +8.849077860434718e-02   +3.669301959106648e-02   -2.277863980780834e-01   -2.328475932403196e-02   +1.604405772855830e-01   +4.252473007059056e-02   -2.108180564249393e-02   +1.537390191268777e-02   +6.500717196063423e-02   -1.034612242791054e-01   -1.310255489742757e-01   +1.028392773102423e-01   +1.085527951687223e-01   +1.732748008111032e-01   -1.366043289535255e-01   +2.977001433681533e-02; +1.054408235774636e-01   -4.220632361849334e-02   +2.739469521219190e-02   +2.893766660437192e-02   -1.414465202692609e-02   +3.906777438007954e-02   +1.216376661820043e-01   +9.677624882465699e-02   -1.800442189588852e-02   +1.353495606004979e-02   +3.544621353451248e-02   -1.304833026858115e-01   +2.231373639086615e-02   -4.202143401332140e-02   -8.093985387473895e-02   +1.825481299066815e-01; +1.895431321361384e-01   +7.081036724195018e-02   +5.927164536688424e-02   -7.718494333544118e-02   +3.645143680429147e-02   +7.320651916126103e-02   +6.796720125872432e-02   -1.480682697201072e-02   +1.466376133259217e-01   +1.589498116337948e-01   +2.433356083708615e-02   +1.086474101252999e-01   -6.404188562325644e-02   +1.732393531259141e-02   +1.648139762849293e-02   -1.866916494146781e-02; +2.364819613257220e-02   +1.435248439374807e-01   +1.114588755093607e-01   -5.495392913353254e-02   +2.301007050828946e-01   +8.425888059915121e-02   +1.025658534755436e-01   -8.761935254873905e-02   +1.153543406836879e-01   +3.610585107528706e-02   +4.331393818117774e-03   +6.745095333291323e-02   -1.244933694432824e-01   -4.034377869653910e-02   +4.422574951252511e-02   +1.007482161207640e-01; +1.162843656071970e-01   +1.634594231933008e-01   +1.071387297697489e-01   +9.880227308499324e-02   -2.098504302036439e-02   +5.865869133549476e-02   +6.770977166794782e-02   -5.352975258845035e-02   +1.072541650359592e-01   -3.036956268002203e-02   -4.481622997587072e-02   +1.610716744940537e-01   -6.054029392093827e-02   -8.159555967941436e-02   +4.446833186911040e-02   +7.481926796101011e-02; +7.909738717310470e-02   -1.009956380585987e-01   +1.609460061166108e-01   +1.218994902455932e-01   -1.427120037320288e-01   -1.087428766454652e-01   +9.243692163505694e-02   +1.480600705968414e-01   +7.357905699908454e-02   +3.527855701392502e-02   -3.435021221826635e-02   +1.216965478588810e-01   -4.002832102346930e-02   +1.082206473430460e-01   +7.989591326485174e-02   -2.162504890183389e-02; +1.432552518897248e-01   +1.149943015582315e-01   +1.241762739436724e-01   +4.809661569094026e-02   +2.319684301122842e-01   +4.509025001841738e-02   -8.437880700923153e-03   +6.000244046141481e-02   +1.502867568980025e-01   +1.400950033775687e-01   +8.703208513294640e-02   +1.177132076121072e-01   +1.289381666723599e-02   +5.202041950957605e-02   +1.226769334514063e-01   +1.095388245958580e-01; -2.002994422423143e-02   +1.575491306208373e-03   +1.474613881213566e-01   -6.053637238989044e-02   -4.115677386539949e-02   +1.151383193241343e-01   +1.132440949010101e-01   +1.415919960090957e-01   +8.068629893073316e-02   -1.698271260026375e-01   +3.087303738536941e-02   +1.529897665746398e-01   +5.388561323527574e-02   -1.743448339438626e-02   -2.436128997361662e-01   -5.992720258683125e-02; +9.343889497707596e-02   +8.316361999133191e-02   -6.635421920893543e-02   +1.406077649562296e-01   +2.324293032062255e-02   -1.845850613881529e-01   +2.125295802357307e-01   +4.295891472651991e-02   +1.395231576124252e-01   -1.077123551901234e-01   +5.213540172562906e-02   +7.670163774815804e-02   +6.310477497193823e-02   +9.332627997437225e-02   +4.030680955132176e-02   +5.731959643971662e-02; -3.321688104273347e-02   +1.008900854928201e-01   +5.410463013549531e-02   +8.933855622948104e-02   +2.990199393488312e-02   +1.810499468450815e-01   +2.489174088436830e-02   +4.979717935789520e-02   +7.219857039267805e-02   +9.140578269583245e-03   +1.576517365834695e-01   -5.039702264788833e-02   +4.393281456117754e-02   -3.216377897152027e-02   +1.776506762743661e-02   +2.597743366396519e-01; -1.089480496363138e-01   +2.126925705708702e-01   +1.391126547214802e-02   -1.518652796170539e-02   +8.672682493139108e-02   +1.656921316903051e-02   +2.973306523856593e-03   +9.927349389927284e-02   -1.383275054994608e-01   +1.434211995428826e-01   +6.389494246488381e-02   +4.579366542204895e-02   +1.892144492608509e-01   +1.313514393124409e-02   +1.238395471792178e-01   -4.428353879789176e-02; +3.648327513642087e-02   +1.673961288892067e-01   +1.316614707832291e-02   +2.955695986977110e-01   -8.876511631033439e-02   -6.705449040233398e-02   -1.053116745107488e-01   +1.209675444040317e-01   +3.047059368782241e-02   -5.444226586804642e-02   -9.856925935896031e-02   -7.314877529157160e-03   -1.074132182321931e-01   +5.302233639055413e-02   +1.086895960767379e-01   -1.997050326380765e-01; +6.277600639270911e-02   +3.975547429765658e-02   +3.970698143368299e-02   -1.551861137551780e-01   +1.399129608831286e-02   +1.184231903845686e-01   +1.465385461156534e-01   +1.163245745714368e-01   +3.598729169484754e-02   -1.749108348948766e-01   +3.568462216703979e-02   -2.031653750315167e-01   +1.355310202198702e-01   -5.189906073202453e-02   +2.839967986230239e-02   +1.641203003168937e-01; +1.120241086356440e-01   +7.260935587225530e-02   +1.929874336419140e-02   +1.720077902535824e-02   +6.447164244990347e-02   +1.787754884333120e-01   +6.277154335108587e-02   +1.188901751510407e-02   -4.484722861069211e-02   +6.617768554327910e-02   +8.956003152364864e-02   +2.231004276550095e-01   +8.747637197340993e-02   +1.476161056105641e-01   -5.623628172441505e-02   +1.520137451562569e-02];
L2I_L1I_iGABA_netcon = [+1.337274514898430e-01   +1.288670358096008e-01   +6.012730594257098e-02   +3.420999921252664e-02   +8.924429198468828e-02   +1.977704862745178e-02   -1.071686150816858e-01   -7.604098609636908e-02; +7.005400021738031e-02   +6.958960996273630e-03   +1.690799088626650e-01   -5.572234335025543e-02   +7.089235430014959e-02   +7.557800437934462e-02   +1.797140037019742e-01   +8.638597853286709e-02; +1.069507032425051e-01   +6.780655361833376e-02   +1.399621774075805e-01   +1.072568086078938e-01   +1.937272407234721e-01   +1.445368786007340e-01   -9.020892613375658e-02   +2.038153487899936e-01; +9.067301784487430e-02   -9.326018395802073e-02   -5.041237230619989e-03   +3.020217901349986e-01   -5.791545507649234e-02   +3.919510268785844e-03   +1.947825874362549e-01   -9.545023979962190e-02; -3.717478061568059e-02   +1.240096435320424e-01   -1.390918414339133e-02   +1.637052528922054e-01   -4.094524825035355e-02   +1.787620110573812e-01   -1.388811174123712e-02   -4.004226500813556e-02; -2.070527393957906e-01   -2.971755982466301e-02   +1.902291074332657e-02   +1.466219919835917e-01   +8.535496870615354e-02   +9.666991467592589e-02   +6.959772538663697e-02   +7.569337651857436e-02; -2.216850854457903e-02   -7.269641048427401e-02   -3.390541464175481e-02   +1.935140897408255e-01   +1.364050943336151e-01   +2.097944990724084e-01   +8.608487415834133e-02   +1.466115712895357e-01; +1.369367942803159e-01   -2.230819988913022e-02   -4.414018719879433e-03   +4.872455834810391e-02   +3.039168579860691e-02   +2.968298051730828e-02   +1.610765704704914e-01   +8.393243081787496e-02; +1.807361277214635e-02   +8.395325206667067e-02   -6.266277370910991e-02   -1.258049206805419e-01   +3.831460066493120e-03   +6.004168712121906e-02   -9.563942991669012e-02   +2.571742326420326e-01; +3.300252027915470e-02   +1.357050174362723e-01   +1.099634198961695e-02   -4.727062021358877e-02   -1.215511920730317e-03   +2.142391713102720e-01   +7.154160362811905e-03   +1.083410886379653e-01; +5.330784767481757e-02   +3.490908034120373e-02   +3.684885544859067e-02   +5.712830151732076e-02   +7.582089851431043e-02   +4.755858144847948e-03   +3.394791313578124e-02   +1.383021549948117e-01; +1.009265216995882e-01   -8.862018812459377e-02   +1.659713659933382e-01   +7.461457831911009e-02   +1.166557694608383e-01   -2.756066542525752e-03   +5.799385075508157e-02   -7.345287380133808e-02; +1.809166311637654e-01   -5.654997635444663e-02   -7.525433941881744e-02   -2.910367358807574e-02   -5.541193432575173e-03   +1.673640347439289e-01   +6.924499957040210e-02   -2.749875923857813e-02; -6.670427386371275e-03   +4.555314107643531e-02   +3.286464471831719e-02   -4.030400069066246e-03   -7.247803982687272e-03   -6.355309267227219e-02   +2.257306095203849e-02   +1.633184943727080e-01; +1.583606342474644e-01   -1.933259371702931e-02   +2.121225959869463e-01   +1.469290050850459e-01   +9.612490839874721e-02   -1.153876113337924e-01   -1.104356142580763e-02   +1.631737758512157e-01; +6.236507906081840e-02   +2.099393205394372e-01   +4.437420721374723e-02   +3.724651331106353e-02   +1.327580134499705e-01   +1.206673537420126e-01   +1.309378726435420e-01   -2.132707101227368e-02];
L1I_L2I_iGABA_netcon = [+1.363619663193529e-01   +1.084992047523083e-02   +1.545230663158123e-01   -3.917215299491938e-02   +1.040345519552432e-01   +7.958664785511224e-02   +2.622968874195997e-02   -8.219395529118895e-02   -8.063169649293475e-03   +8.113304271121709e-02   +1.915623429914207e-01   +1.079320363865089e-01   -1.191827704379067e-02   +1.035752515189392e-01   +3.186358501177710e-01   +9.566492081267941e-02; +2.689329289898165e-02   +6.907000660680246e-02   +1.573603654374717e-01   +1.217199289189045e-01   -2.243143345859037e-02   -3.915068415008426e-02   +1.629859874192503e-02   +1.099829050207019e-01   +1.623813854227310e-01   -6.030027634238058e-02   +9.030917066819608e-02   +2.304912393986219e-02   +3.524013563590521e-02   +9.105724291385847e-02   +1.589245947104516e-01   +2.391074956025217e-02; +1.422681678888525e-01   +3.165028162631395e-03   -1.564228895696506e-01   +1.333288994314791e-01   -6.630565545327086e-02   +1.805273888814563e-01   +1.079788556208373e-01   +5.871883212853253e-02   +4.914187280466303e-02   -1.616133898696996e-01   +7.540167573743990e-03   -4.829221616648754e-02   +1.614466021856330e-01   +6.449384315638784e-02   +9.846152630585600e-02   -5.840996469931431e-02; +5.081076751016983e-02   +2.167726985305538e-01   +4.524800017895873e-02   -4.745875400255098e-02   +2.407745289748511e-01   -7.654479588873897e-02   -1.133715677980684e-02   +1.835796991435378e-01   +2.294985546696848e-02   -5.753960206800285e-02   -3.546129949533090e-02   +1.037749907457013e-01   +1.175433718179828e-01   +5.020598896043898e-02   +9.200214626395174e-02   +8.980460145695104e-03; +9.288142617778984e-02   -3.204039055193441e-03   -2.272919135667453e-02   +8.625170994172282e-02   -4.519026331028604e-02   -1.539479485912030e-02   -8.877222614074631e-02   +1.185229827544148e-01   +8.024396302208804e-02   +2.341803893444595e-01   +2.740583226771944e-01   +7.805546959767300e-02   +8.516470133499610e-02   -7.294966779094671e-02   +1.389970116600000e-01   +2.170473033935399e-01; +1.013840240596823e-01   +5.120830390635980e-02   +9.823194267396385e-02   +1.337970890886167e-01   +2.012373176428994e-01   +1.840139955624690e-02   +1.917302415955855e-01   +2.455439365593634e-01   +3.631640004887626e-02   -2.053810557564484e-02   +8.915361175337190e-02   +1.180187451114110e-01   +6.988170819086219e-02   +1.597438491381447e-02   +6.648336612334126e-02   +9.528914364579522e-02; -2.761448566039677e-02   +1.642123569237013e-01   +1.087429812145639e-01   -1.576488389817955e-03   +2.471524495404637e-02   +4.875768336593488e-02   +4.809697800431453e-02   -1.618025286950524e-01   +5.710462987774644e-02   +8.343771084214467e-02   +8.970110047379935e-02   -6.475512718080437e-02   +1.079396869288952e-01   -1.423087096289175e-02   -3.068643340631822e-02   +1.746801042088763e-01; +3.283785612552467e-02   +1.430434426513462e-02   +5.334237574674405e-02   +6.876149318200533e-02   +2.032156403244104e-01   +5.417619936364459e-02   +1.505383707769613e-01   +1.136431088231409e-01   +5.330367629256329e-02   +2.138569876329314e-01   +1.769582504881578e-01   +1.380693958888916e-01   +5.130876739468819e-02   +1.602105879510508e-01   -7.066825141336673e-02   +3.682357250373403e-02];
L2E_L1E_iAMPA_netcon = [+1.652959312883754e-01   +1.223326463176567e-01   +1.283206888660230e-02   +3.338302870878088e-02   +1.843771203653370e-01   -2.822556275681700e-02   +5.704921809455143e-02   +1.595645245140467e-01; +1.072518564528368e-01   +2.087489445288077e-01   -6.682113792054029e-02   +4.483963109246615e-02   -6.896097868403486e-02   +9.586586658108182e-02   +1.918534690490376e-01   +3.794009300099672e-02; +1.362866777900270e-01   +4.077808309426904e-02   +4.130834501409421e-02   +8.856686700487783e-02   -5.739634694955308e-02   +2.725248574997340e-01   +8.209230575126010e-02   +5.829958861032121e-02; +9.379431206818498e-02   +6.124530833123098e-03   +1.066714664117751e-01   -9.663570786272911e-03   +3.998331440113793e-02   +4.089565716987965e-02   -8.342019163952882e-02   -1.383697018706996e-02; +1.609378871369340e-01   +1.313106019528928e-03   +5.343822378949702e-02   +1.088041160031095e-01   +2.896785504953049e-01   -6.200606467691988e-02   -3.971614092406278e-02   +1.197734086346966e-02; -2.999435159820007e-02   +1.870945527117817e-01   +5.731040945034599e-02   +4.139429275107554e-02   +8.832103645230865e-02   +8.243826559665532e-02   -4.199975380086911e-02   +3.014773519729328e-02; -5.771984389590167e-02   +3.578442131123848e-02   +1.934695523461094e-02   -2.348361054157771e-02   -1.026348745004455e-01   +8.978738210811435e-02   -4.121123985481917e-02   +9.233644603161001e-03; +1.209412677460502e-02   +2.963663380961402e-02   +8.011296917810148e-02   +1.793979872358359e-01   +7.468343731457029e-02   +5.026244685785528e-02   -7.870273150638436e-02   -4.902181202479217e-02; +2.325557362997575e-01   -2.788115729742663e-03   -6.904032165363272e-02   +2.352265841560752e-01   -5.638359990958583e-02   +7.819988203407159e-02   +1.146249286900040e-01   +1.109971257295856e-01; +8.656895702991975e-02   +9.143600709539852e-03   +7.554937977742890e-02   -9.378423844499689e-03   +3.447783853600108e-02   -9.932869989399029e-02   -7.563631673594486e-02   -4.945840841127157e-02; +9.604598498296150e-02   +2.914554354590442e-01   -7.763757337598923e-02   +2.119084068210781e-01   +1.225579842787441e-01   -1.689839353914278e-03   +4.929825822330022e-02   +1.469389596993595e-01; -1.067952323454988e-02   +5.015618052280806e-02   +1.803405699084520e-01   +7.699696917050558e-02   +2.175828960169031e-01   +1.140776684759708e-01   +1.303578383414675e-01   +1.095137787774026e-01; -4.997827891312959e-02   -6.721656819052868e-02   +1.374814135459480e-01   -1.377214569341442e-02   +7.328404925212012e-02   +5.937211504015936e-02   +1.401660806801415e-01   +7.318991721352562e-02; -7.490902792056377e-02   -1.004235168893889e-01   -2.457837905662729e-02   +2.144949787441736e-02   +2.210103681988220e-01   +1.818602816118034e-01   +8.794043130472888e-02   -8.943491117830121e-02; +6.308181676397892e-02   +1.150621784734659e-01   +1.196691025555307e-01   +5.564896640368503e-02   +6.935733981846920e-02   +1.575435622147539e-02   -4.874769672491593e-02   -1.940251481084185e-02; +1.891477490688432e-01   +7.211561075585128e-02   +3.448537172761512e-02   +1.993807034599936e-02   -5.996399514923975e-02   +1.123644892097409e-01   +3.315417080685581e-03   -2.086305472013825e-02];
L1E_L2E_iAMPA_netcon = [-5.419640677734437e-02   -3.806458394394704e-02   +8.523360821785170e-02   +1.583566885097093e-01   +4.698973305022608e-03   -1.596641877269565e-03   +8.636939963459750e-02   -1.199009570741877e-02   +1.000290595052929e-01   +4.415385673679453e-02   +7.741432166807288e-02   +5.546756916251022e-02   +1.802479558266438e-01   +7.949741586476054e-02   +7.140853841539131e-02   +1.578011165947884e-01; -7.731727991978868e-02   +3.095204059844948e-03   -1.486031330619451e-02   -3.162397957400481e-02   +5.832247043955976e-02   +7.090356062243518e-02   -6.967619193395072e-03   +1.545420355127124e-02   -5.357366666613431e-02   -7.821596330328830e-03   +2.230152558432457e-01   +4.705001058749843e-02   -2.242197731045610e-02   +1.826682589131027e-02   +3.167116947096384e-02   -2.771301603055228e-03; +3.282843140463887e-01   -9.338103956551103e-02   +1.004392962282571e-01   -7.272151730805959e-02   +7.666007027420260e-02   +2.509634878513102e-02   -2.209748357383438e-02   -5.210368815930817e-02   +3.967547503548931e-02   +7.147612162865243e-03   +1.168445153669668e-01   -7.246660473785321e-02   +1.185924966696885e-01   +2.332459028464862e-01   -8.552699085960024e-02   +7.648803770555752e-02; -7.171932788696511e-02   +9.432724051174134e-02   +1.946257971743432e-01   -5.500850943124430e-02   +3.171228561387143e-02   +5.802578057953933e-02   +1.076174662797968e-05   +1.166289922143018e-01   +8.498403899806552e-02   -2.272263303323319e-02   +4.767954689403067e-02   +7.862583495267299e-02   +2.233258723503759e-01   +2.245282423566836e-01   +1.290876459216082e-01   +1.135372298134288e-01; +1.663960949083855e-01   -1.247285663598497e-01   +2.636963477787917e-02   -1.240340468413463e-01   -1.511894823044341e-01   -7.910988222491977e-03   +1.027662209601609e-01   -1.528440917754684e-01   +4.410578621071844e-02   +3.384635499722655e-02   -1.711565905796913e-02   +1.983274914985952e-02   +2.045381838923158e-01   -9.473436026458629e-02   +5.829457480452711e-02   +8.152183786610726e-02; +1.282307227240979e-01   -4.392393242650381e-02   +8.595932296784939e-02   +1.023505640291297e-01   +5.616726183579347e-02   +1.126507062569930e-01   -1.921702617051545e-02   -1.298897827265184e-02   +8.850207441528564e-02   +2.399975923949585e-02   +1.247181224733988e-01   +1.491730630752471e-01   +9.895146805070681e-02   +2.127342711788894e-02   -1.982807754694992e-02   +1.607940137109949e-02; -8.355036731666554e-02   +2.486991554108079e-01   +7.546739275315645e-02   +8.181979893877556e-02   -4.452299528504007e-02   +2.594057928833578e-01   +2.021579633996216e-02   +1.554373505703123e-01   -5.117484594050522e-02   +2.888489842008731e-01   -4.582144494795334e-02   +8.264777746668420e-02   +1.511281105590760e-01   -5.405340977710626e-02   +1.804520536931275e-01   +8.158614133302780e-02; +9.440898088652734e-03   +1.880829280401922e-01   +9.028400328460667e-02   -3.749349745238241e-02   +4.130596288445119e-02   +3.329044046131746e-02   +7.865891397834732e-02   +1.815187310729123e-01   +9.784187905708494e-02   -1.889314611558817e-01   -3.038321990820446e-02   -3.442165304879255e-02   -1.958125032595216e-03   +1.793624452261390e-01   +7.469920839414473e-02   +4.782519798425320e-02];
L2I_L2E_iAMPA_netcon = [+2.012220215394880e-01   +6.291797463898649e-02   +1.555232709853955e-01   -8.733133562019581e-02   +2.084880143394904e-01   +4.448943900230090e-02   +1.007514243959053e-01   +5.509994983872006e-02; -4.947175728880088e-02   +4.048632016618248e-02   +9.004981684046934e-02   +9.360680897522071e-02   +1.338305826305068e-01   +1.136191084491197e-01   +3.046112321261451e-02   +1.013453026562482e-01; +8.089473853823968e-02   -1.038137804250701e-01   +9.607190049235415e-02   +5.554387833275580e-02   -4.189881632384509e-03   +6.148667677826385e-02   -9.166177432112492e-02   -4.569404156727642e-02; +1.136406892201605e-01   +1.275954238811147e-03   +1.261679735285338e-01   +1.641013426127956e-01   +6.274582023088762e-02   +2.113246440627074e-01   +2.970098860408644e-02   +2.154982985637331e-01; -9.622678956083311e-02   +1.349757358495894e-01   +2.065068665290912e-01   +2.073826728644074e-01   +1.579798247627267e-01   +1.181018416637885e-01   -5.487733663648404e-02   +2.013311695572628e-02; +7.109311749828942e-02   +8.781012895006515e-02   +2.572751965142513e-02   +1.378140407175565e-01   +9.977671073623058e-02   -1.649107846638549e-02   +3.227958375211974e-02   +2.030526344470958e-01; -6.971310045736090e-04   -8.227717765593043e-02   +3.751594094899256e-02   +8.443368634347652e-02   +8.811530811903662e-02   +1.408790102749633e-01   -1.589149018858901e-01   +2.795445259836402e-02; -2.764169820931162e-02   +1.445709293185386e-01   +5.732005859750249e-02   -1.114832793163360e-01   +8.454081985933591e-02   -5.851666778027557e-03   -6.964406458639362e-03   +2.956284193703617e-03];
L2E_L2I_iGABA_netcon = [-5.491327156880968e-02   -3.784264963159449e-03   +1.549190595848637e-01   +3.886035664870553e-02   -3.884520411783483e-02   -2.790585261823043e-02   +4.661603019772847e-02   +5.201934775991479e-02; +2.312421743651246e-01   -3.384071442740944e-02   -3.718421895814939e-03   +1.643892890797213e-01   +6.818035168758524e-02   +1.809645206390685e-01   +4.651532098332758e-03   +1.252226830381690e-01; +8.057678438263847e-03   -5.040910184157028e-02   +1.146835329682020e-01   +1.646410796885381e-01   -7.137129202493647e-02   -1.819948089562599e-02   +1.134398121698598e-01   +1.421235931510469e-01; +1.336472646244768e-01   +1.730491250394611e-01   -6.662922328059775e-02   +1.794702493170715e-01   +8.803733629397323e-02   +1.181803934774857e-01   -4.210289748589692e-02   -1.027203893050306e-01; +1.418188463491047e-01   +1.253644037804741e-01   +7.562954034299718e-02   +6.986241976857047e-02   +1.189789633277828e-01   +3.804960639838711e-02   -1.408335809053201e-01   +1.908450868009901e-01; +3.052736522016109e-02   +6.836267708993407e-02   +5.742464318564891e-02   +4.233403201337328e-02   +1.689823124878257e-01   -2.626291716300325e-02   -9.770920329620184e-02   +2.549548365097166e-02; +6.615435334532098e-02   +1.704803787262617e-01   -9.688905393333025e-02   +2.220916835402744e-01   +1.413494379821710e-01   -7.843757897875964e-02   +3.005541209627439e-02   +5.845869169353970e-02; +1.305752238767781e-01   +1.841827487924692e-01   -3.031630617356314e-02   +1.228099686828056e-01   -7.666796562196295e-03   +1.554537259510800e-01   +1.360333951443759e-01   +5.914893586686767e-02];
L3E_L2E_iAMPA_netcon = [+1.234052910233168e-01   +1.086829357696202e-01   +1.321908216727159e-01   -3.702799377995614e-03   +6.194851751751118e-02   +2.175082570122672e-01   +1.101114382005802e-01   +2.448730439218429e-03   -1.282887063255614e-01   +1.038075970637630e-01   -1.162128222718004e-01   -5.813937722921830e-02; +1.012884073598416e-01   +1.368077860540086e-01   -1.494979482612842e-01   -4.155523174593828e-02   -1.654636726848183e-02   -4.943865022282911e-02   +3.714363251544868e-02   -6.569912862705085e-02   +1.766568316192031e-01   +2.976231901511321e-02   +1.416194274907938e-02   +1.279428589842598e-01; +9.131547277501996e-03   +2.238392584990050e-01   +1.964624647625189e-01   -3.772816684181671e-02   +1.112877633199088e-01   +1.393149041155502e-01   +1.950201471557729e-01   +3.224241445349812e-02   +3.742774614379214e-02   +5.487923200036737e-02   +8.405349207038691e-02   -3.078381746051500e-02; +5.895228460529641e-02   +6.696874845368131e-02   +8.250903146078287e-02   +1.371115407851721e-01   -6.110373034689285e-02   +6.368103695791272e-02   +1.409968554457216e-02   +9.296878187401311e-03   -2.595697962175640e-02   -4.553714111916517e-02   +1.315970340102198e-01   +1.367775658251414e-01; -7.155046675067249e-03   +2.189623123814818e-01   +1.047850518682930e-01   -1.006328477271656e-02   +6.311192907281608e-02   +4.829256169666304e-02   +1.644384358012458e-01   +1.708695907190832e-01   -2.770595280350036e-02   -1.083351818398431e-01   +1.098252263152080e-01   -1.710530948064406e-01; +5.954441260839697e-02   -8.678548606216720e-03   -3.272596489324897e-03   +1.688755888046160e-02   +1.046331530248516e-01   +3.443384592892557e-02   +1.578111276093608e-01   +1.039443076978006e-02   -2.874378240491658e-02   +1.164218938508300e-01   -4.608441463136274e-02   +7.839943513633603e-02; +1.011254862630983e-01   -1.366736949158726e-01   +6.243005765114511e-02   +8.959643407902348e-02   -8.526082633435496e-03   -8.571152819352099e-04   -3.765514267276304e-02   +1.629055924270524e-01   +7.714349129144335e-02   -7.987135924954214e-02   +1.168662388935546e-01   +6.033854968363508e-02; +1.351838982471976e-01   +4.708113785779354e-02   -6.368965583017736e-02   +1.407209829581848e-01   +1.141498505794066e-01   +1.362038574444753e-01   -2.224753578874653e-03   +1.054030051851411e-01   +1.701692153383712e-01   -6.235343902104372e-02   -1.115661487124689e-01   -2.779310763110919e-02];
L3I_L2I_iGABA_netcon = [-6.872558504890450e-02   -3.830313711644651e-02   +2.089367631576828e-01   +5.629116800116681e-02   +3.503666746835525e-02   +4.031985816017231e-02   -8.985044707971665e-04   +3.328103382402145e-02   +1.197843349527595e-02   +5.397025707773473e-02   +1.044025062065242e-01   +1.240117190440052e-02; +2.125993239122650e-02   +7.554157949989242e-02   +2.306139128157675e-01   +1.046467158748337e-01   -2.849556239510993e-02   +1.938982210477539e-01   -2.560907349337457e-02   -1.938173465375349e-01   +2.729881250335293e-01   +1.175819203667504e-01   +1.813695803664520e-01   +2.087502017026317e-01; +8.969471815329838e-02   +8.581559209161699e-02   +1.137847757201175e-01   +5.963098028883460e-02   +1.076692561921499e-01   +3.247436311323171e-02   +2.490590782050325e-02   +4.224703772343889e-02   +7.786378928004940e-03   +1.479477985327527e-01   +1.238349540580892e-01   +2.974282132365776e-02; +8.403509366745221e-02   +1.439218702531458e-01   +1.190389600823867e-01   -4.011612377681480e-02   +2.143338330989344e-01   -1.029902284208937e-01   +6.981805682297741e-02   -1.061519986234054e-02   +1.535865763512450e-01   -5.501065907445053e-02   +1.098733293525751e-02   +9.733898778558500e-02; +6.956595509865288e-02   -1.296951747362337e-01   +7.150073165521274e-02   +1.028022102145412e-01   +1.445023150277540e-01   +7.872397877733976e-02   +9.810785485966231e-02   -2.137054768229192e-02   +1.552091281294375e-02   +1.403206422859629e-01   -2.851002879791381e-02   +8.726878233535931e-02; +4.171142272982329e-02   +5.387302074211106e-03   +2.415972598439748e-01   +8.515445044592533e-02   +2.726476932236924e-01   +2.467278018475962e-01   -2.613572664169918e-02   +8.318361044353496e-03   +2.334631119745679e-01   +1.249970410833411e-01   -1.652969864014200e-02   +1.227016778678920e-01; -4.882650105578953e-02   +1.798385473740152e-01   +1.850830840572972e-01   -4.386966158206893e-02   +1.512294227077523e-02   +5.881817753063071e-04   +1.342209632871047e-01   +1.637647625041410e-01   +1.794320633239992e-02   -8.249049218813725e-02   +2.263178767361965e-02   +1.067989468729537e-01; +1.841903936958478e-01   +2.741672734906601e-03   +1.029154896867331e-01   +1.781348455607420e-01   +1.774304192079197e-01   +7.071758235694994e-02   +1.862410648404899e-01   +1.927586432629934e-01   +6.187013059496456e-02   +1.054419549354585e-01   +2.263931283455066e-02   -6.957196328040639e-02];
L2E_L3E_iAMPA_netcon = [+5.524316408949635e-02   +2.203985257697715e-02   +1.507639133223517e-02   -8.077963254812870e-02   -5.393077820339427e-02   +1.132807846651312e-02   +2.429820553772962e-01   +1.626912588066387e-01; -9.375429862581580e-04   +1.435376039828541e-01   +1.281535958607075e-01   -8.916002119051768e-02   +1.708101855683070e-01   +8.942984000121990e-02   +1.389181241992562e-01   -5.808060508613466e-02; -2.590008198285428e-03   +7.925067082232595e-02   +1.210994262011166e-01   +1.425321272274302e-01   +1.411595475871641e-01   +1.809482512058549e-01   +4.631854059708824e-02   +8.036862213895121e-02; -6.852619085161743e-02   -9.022293069160413e-02   -3.084663779485493e-02   -6.558322636619858e-02   +1.088044698407780e-01   +7.427523469871405e-02   -5.563512632435461e-02   -6.633313279932447e-03; +1.267020178328977e-02   +1.695584503923776e-02   +1.759335968133612e-02   -3.820118112707865e-02   -3.525939404844936e-02   +2.512822156530393e-01   +1.293196775373188e-01   +3.914247744582917e-02; +9.056492315560019e-02   -8.497109844003145e-02   +4.150462716069452e-02   -6.897499887835293e-02   +1.174005798177362e-01   -3.759009693337600e-02   +6.930482958867928e-03   -1.135936046497765e-01; +9.215950411385772e-02   +4.104692749570185e-02   +9.117252545065666e-02   -5.071703538569909e-02   -5.654116365643014e-02   +1.009454852072176e-01   -1.786926964274172e-01   +3.887932193480091e-02; -7.734747593165175e-02   +1.305131349143246e-01   -4.301587999877544e-02   +4.969525381205458e-02   +1.055523406660021e-01   +2.590348744982978e-02   +4.577948380419269e-02   -1.164002637184675e-01; +1.157198948125582e-01   +1.479655377861249e-01   +4.273411442172908e-02   +1.988991069693956e-01   -2.309361569564155e-02   +9.363025718692598e-02   +9.789281230997429e-02   +3.035669935995553e-02; -5.046397818073033e-02   -6.811148738064532e-02   -1.254241582843233e-02   +4.895405545989118e-02   +6.858772468979063e-02   +2.210136983047920e-02   +1.263819151974466e-01   -1.442682253490847e-01; +2.091095415436772e-01   -5.430032856044777e-02   +1.081909238013444e-01   +1.516146294843012e-01   -1.736422326253538e-01   -1.031350229071925e-02   +7.894414610819193e-02   +1.026172697097190e-01; +2.865873405893962e-03   +9.518714113617470e-02   +1.012693067051941e-01   +1.779597553620655e-01   +4.075090702906002e-02   +1.289411653525722e-01   +2.011034505326361e-01   -6.666382802399753e-02];
L2I_L3I_iGABA_netcon = [+1.160682671024389e-01   -1.042689233987039e-01   +4.417927752003634e-02   +7.239549419993764e-02   +1.487030192983629e-01   +1.559478846217710e-03   +2.084117676142413e-01   +2.057671890833769e-01; +7.728086212188112e-02   +1.209561468275951e-01   +4.518547667810980e-02   +1.383660309356994e-01   -6.998397256514180e-02   +1.446780486860798e-01   +6.782020411325661e-02   +8.734229698003664e-02; -1.209181648023250e-02   +4.942589926350983e-02   +1.103000010743594e-01   +1.768595260809767e-01   -4.983090368990943e-02   +4.960605451055626e-02   +4.149484200932543e-02   +1.139088578137699e-01; +6.497924655536483e-02   +6.744685798752154e-02   +2.204358716768453e-01   +5.648090307006721e-02   +3.781655434362374e-02   +9.018113692231305e-02   -7.212904392880698e-02   -5.105701414871109e-02; +2.314642717896159e-01   +1.464957519679715e-01   +1.283755542137008e-01   +8.042447529336921e-02   -5.338246111616812e-02   +2.052156768260980e-01   +7.428588163270192e-02   +2.589432094286097e-01; +1.222218474086161e-01   +1.292919551042537e-01   +1.024574000212312e-01   +1.615623624492415e-01   +1.380799535438054e-01   -9.225978151373787e-02   +4.146793362092093e-02   +1.807997233754438e-01; -5.487957690489107e-02   +1.552614009675953e-01   +1.938515024527844e-01   +1.867843415725919e-01   +3.910095044797242e-02   +2.025363311308184e-01   +3.116538652405411e-02   -2.181661232847666e-03; +1.054619647429481e-01   -1.722435401610543e-02   +2.280404544958458e-02   +7.531757021840096e-02   -4.399818146349486e-02   +1.294229131272928e-01   +1.002452690737086e-01   -3.526891882835381e-02; +5.650696427380669e-03   +1.742470865254142e-01   -2.954736364558376e-02   +1.440928882440686e-01   +9.640957033096675e-02   -3.372934084298687e-02   +3.379069400471221e-02   +1.235273359724967e-01; +1.050427746952571e-01   -6.022461126901585e-02   +8.734371352382475e-02   +1.490938527896833e-01   +1.017058054289523e-01   -8.179577268779772e-02   -3.542212682750772e-02   +4.593616898621929e-03; -1.909721156963131e-01   +6.510695418787674e-02   +1.784622023420368e-02   -9.650121003963463e-03   -1.076994860541419e-01   -4.144978883521147e-02   +4.306734915507226e-02   -2.399622578245807e-02; +1.577483326626359e-01   +1.376719547869629e-01   +2.589741958998786e-02   +2.024637754396837e-01   +1.568663818475033e-01   -9.404480026652262e-02   -6.837354795538785e-02   +8.291557719202114e-02];
L3I_L3E_iAMPA_netcon = [+7.870725794158893e-03   +2.127005834729399e-01   +5.527861569403707e-02   -1.865664961352836e-02   +2.170764994707189e-02   +4.280211092481324e-02   +7.937974893015409e-02   -2.554341496084305e-02   -2.602700918477032e-02   +1.787679549822306e-01   +1.944674907479312e-01   -2.103075812040772e-02; -1.740459489607721e-02   +2.403479640779090e-01   +7.095256665760880e-02   -6.200387180011316e-02   +2.402977607799330e-01   +2.770262057543001e-02   -6.922963707607184e-02   +3.255836418576822e-02   +4.792582540832917e-02   +5.066139626492558e-02   -4.087525148825259e-02   +4.978890510143669e-02; +1.599201467560058e-02   +1.132223490905603e-01   -1.535269300276463e-01   -4.691256092529492e-02   +9.210341957093986e-02   +2.393585083518549e-01   +1.121718202342572e-01   +4.011185399969525e-02   -6.274453687312560e-02   +5.912892249025533e-02   +9.645164295029321e-02   +1.119981789619266e-01; -2.043963711581801e-03   +3.379482686338457e-02   -7.619021087318548e-02   +9.648065514029556e-03   +1.306146142180697e-01   +9.282287916633303e-02   -1.288648391524781e-01   -1.172467717775264e-01   -5.822645544070265e-02   +9.738803831978947e-02   -1.103777419366622e-02   +9.823771393591482e-02; -9.657049268054496e-02   +6.364788545593059e-02   -8.601384186283466e-02   +1.205181168621611e-01   -2.189434353287875e-02   +2.213450581966947e-01   +7.057865603596772e-02   -1.153222776712212e-01   +7.062621939330613e-02   -2.044700249218881e-01   -8.061649028205337e-02   +2.099350421537811e-01; +1.669743810004885e-01   -1.643451173350087e-03   -1.009487221069218e-01   +1.556088304597769e-01   +1.186133671765365e-01   +1.042477182492427e-01   +2.511282296505542e-02   -7.825952980135074e-02   +8.047290435044489e-02   +3.665056494013653e-02   +2.849369361727333e-01   +1.686887207929927e-01; +8.378812190893348e-02   +1.946312976561120e-01   +1.214653235527365e-02   +1.956383179283551e-01   +8.362761903253156e-02   +1.642718150123681e-01   +6.586318787314022e-02   -5.396015038372222e-02   +2.051868209335671e-02   +3.407361095116852e-02   +8.734278502488789e-02   +1.730850282813499e-01; -5.722335635419366e-02   +1.504948372538430e-02   -3.392165644594521e-02   -1.551127295876073e-02   +1.178577102569694e-01   +1.197551229678556e-01   +4.271897517616598e-02   +4.831265698706495e-02   +1.717326903281927e-01   +1.184188972360278e-01   +8.414609462039180e-02   +9.397792111549587e-02; -1.141223226549036e-01   -5.683325643987088e-02   -1.180533227307158e-01   +1.563960068505997e-01   +6.823624909852319e-02   +1.827500331041970e-01   +4.465563563999381e-02   +1.475637930722364e-01   +5.093388268593667e-02   -3.998970723849801e-02   +9.718462475814427e-02   -7.538306246560292e-02; +7.663475210706361e-02   -1.187869025261060e-01   -2.172851316526184e-02   +1.024487393300075e-01   -8.880760997815909e-02   +2.532042561536371e-01   +1.043854393466186e-01   +1.862284029004760e-01   +1.902641426653716e-03   +4.032265097494454e-03   +6.601498878317485e-02   +1.214718651846104e-02; -6.779827090519726e-02   +4.201825694168738e-02   +1.517627394011871e-01   +1.814477782611810e-02   -3.695401853540545e-02   -3.258795547024869e-02   +1.197744704317740e-01   -3.468700704262639e-02   -4.893745134996702e-02   +2.360618470547089e-01   +1.246268235141110e-01   +6.627859230590623e-02; +1.244374891832733e-01   +4.720444056525218e-02   +9.443382745423105e-02   -5.666044089293912e-02   +5.463659136132520e-02   -1.511056412022743e-01   +6.119038896060240e-03   +1.498253096359827e-01   +1.173647502667646e-01   -3.070299443866571e-02   +7.134049703394776e-02   +1.065304685804140e-01];
L3E_L3I_iGABA_netcon = [+1.232607683097962e-01   +1.474945882702113e-01   -2.633159084329893e-02   +1.818988451844506e-01   +9.886409528432691e-02   +9.228797792285048e-02   +1.555542121782265e-01   +1.877640521271124e-01   -2.411519220708281e-02   +1.614821959651581e-01   +1.888725479838589e-01   +8.827430047710813e-02; -1.653642212726993e-01   +4.266743393109526e-02   +1.409889580004768e-01   +1.226637381804240e-01   +2.279139179663614e-01   +1.520878378812273e-01   +8.186256259479724e-02   +2.099247341389009e-01   +7.863952335298109e-02   -5.886855386241700e-02   +1.295994996159751e-01   +1.525194198470499e-01; -4.448839147315857e-02   +1.453018174549574e-01   +1.080033792776599e-01   -8.224952055824074e-02   +1.208310549789766e-01   -1.173064450512029e-01   +3.462783674451687e-02   +1.954574306482041e-01   +2.153377747414131e-01   -4.872433495880681e-02   -4.492975546546342e-02   -2.060779911749614e-02; -1.453197465730732e-01   -8.499926073027679e-03   +9.409389667850573e-02   -3.751646123606109e-02   -1.215469534765010e-04   -1.103907336399943e-01   -1.908224358953515e-02   +2.007446650781750e-01   -1.050990396567219e-02   -2.200167065419951e-02   +1.956722300048767e-01   +3.417981165478349e-02; +3.434542206130124e-02   -7.548505435131123e-02   +2.295056674630352e-01   +6.819017115403979e-02   +1.733962524040794e-01   -1.446364450785948e-01   +8.807863190453095e-02   +1.101449356270665e-01   -8.868192783816448e-02   -1.285132118545939e-02   -5.535867379713037e-02   +2.623874317453110e-02; -8.461773086472257e-02   +1.280305219710757e-02   -7.056041593799460e-02   -4.909083908013423e-03   -9.201796344949033e-03   +7.492716274307781e-03   +1.125830139628050e-01   +2.252546427135513e-01   -1.989862712405821e-02   +6.792106194969966e-02   +9.764744680108635e-02   +9.513541548461325e-02; +1.342921794407285e-01   +1.216101017176507e-01   +1.778287513942325e-01   +7.648780497625886e-02   -6.856684886127597e-02   -4.635987085996415e-02   +1.237954580583157e-01   +6.592766190412246e-02   +2.246599486544890e-02   +1.283828296499807e-01   +1.370018473089624e-01   +9.452956820201505e-02; +7.497849986034875e-02   +7.968367430523861e-02   +1.178761191631618e-01   +1.701523529756937e-01   +2.687049852361626e-02   +5.538159216870357e-02   +1.861197330824247e-01   -4.481703029842168e-02   +1.767502475311441e-01   +2.108798547357322e-01   -4.096433481386773e-04   -3.335759370216328e-02; +3.056179087621236e-02   -1.714165938352897e-02   +4.925441948176254e-02   +7.621521223551214e-02   +8.696474797976164e-02   +4.483799315063161e-02   +1.135430073028482e-03   +1.507650807476821e-01   +1.014260912421613e-01   +1.322503378278657e-01   +5.053177331159818e-02   -7.746519880528670e-02; +8.312850189287277e-04   -3.331989640061907e-02   -2.157287054481166e-01   +1.848881374124983e-01   +6.170818971584915e-02   +9.036954309957215e-02   +6.897763876357021e-02   +7.095281924427546e-02   -5.084303560077820e-02   +9.231505916935906e-02   -1.546329311020215e-02   +2.264635721774403e-02; +8.561983391456061e-03   +1.262931303908345e-01   +2.164427659858592e-01   +1.266261976623207e-01   +7.421647395108488e-02   +8.088039277142324e-02   +2.111836246926529e-01   +1.040574145083216e-01   -7.498787391332445e-02   +1.297957326463512e-01   +1.019486951244913e-01   +6.741751352295958e-02; +3.136629186855214e-02   -7.371181650658476e-03   +1.006149128447325e-01   +6.462621046773982e-03   -6.592336859580836e-02   +1.142382933201176e-01   +4.529442057854836e-02   +1.376576344541539e-01   -1.518130790468481e-02   +3.470400795856883e-02   +7.623439006200720e-02   -6.557366064895728e-02];
L2E_Input1_iAMPA_netcon = [-4.061838769595828e-02   +7.604326127790213e-02   +9.922643579748724e-02   +6.127325004830805e-02   +2.047490568627011e-01   +1.185329513746731e-01   -3.317482259834133e-02   +2.633356938602162e-01];
L2I_Input2_iAMPA_netcon = [+1.003141164923207e-01   -9.080829712568093e-03   +8.176681570258550e-02   +6.448985357423981e-02   -1.264997359494613e-02   -9.078452186464663e-02   +9.647601919986688e-02   -8.942019392722865e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.6*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.8*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.8*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.8*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.6*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.8*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.8*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.8*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
