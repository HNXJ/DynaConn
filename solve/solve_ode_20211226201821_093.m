function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-5.184665901868374e-02   +4.094224160895068e-01   +3.148169173921250e-01   +6.961413412972481e-02   +1.964769829163925e-02   -3.159949016584437e-01   +1.170277859264646e-01   +2.386864852710886e-01   -1.523750624881741e-02   +1.316950250436658e-01   +1.522449411046287e-01   -1.614919652174326e-01   +3.784116608756913e-02   +5.758062470131349e-02   +3.111564328032101e-01   -3.556806825959362e-01; -3.228795691473457e-01   -5.436137402979890e-02   -2.242735202117978e-01   -9.704737462241664e-02   +1.807764116967053e-01   -1.620306608764080e-01   -1.208963567697653e-01   -1.392592780701497e-01   +1.951156045941778e-01   -2.110168753323727e-01   -1.238599887032716e-01   +4.359727652814526e-02   -4.629192499760431e-01   -2.159221273011724e-01   -1.120787482356111e-03   +7.418206233631192e-02; +1.035679597411829e-01   -7.198486676907728e-04   -2.856070215377960e-01   +1.222377557284277e-01   -1.106423608682227e-01   -2.358595287537494e-01   +2.864544512764727e-01   +1.480766919798876e-01   +3.891187937117953e-01   -5.845155243295716e-02   +2.529930530077137e-01   -1.222261984793354e-01   -2.734729209894175e-02   +1.745099052503019e-01   +6.824847728762108e-02   +1.660826580850819e-01; +1.961510466088953e-01   +1.778843927615535e-01   +2.675128702879890e-01   -3.670018242696722e-01   -3.721803897322425e-01   +1.261372749979538e-01   -1.325255717514010e-01   +3.041057653363243e-01   -5.386431457011924e-02   -3.348068186127645e-01   +3.707007333154188e-01   +2.583176491205253e-01   -2.880834061379128e-01   +4.670037085953181e-01   +7.498927950545813e-02   +7.957219855592955e-02; +2.568896928369016e-01   +1.574213828060587e-01   -1.018558946736569e-01   -5.527784951293492e-01   +2.276251539548835e-01   -2.521536737034746e-02   +2.872359080455508e-01   +2.117675315275218e-01   -3.341921518253753e-01   -1.694610186608647e-01   -2.113246210858993e-01   +2.173964698834630e-01   +3.781669583620326e-02   +2.660710297236577e-01   -2.641194777894347e-01   -4.626698068845316e-01; +9.743539015664350e-02   -1.038313131043762e-01   -1.990229315994479e-01   -1.946569680963034e-01   +1.564207976404831e-01   +6.693167307868715e-02   -1.785991377528835e-01   -1.845562859132845e-01   +4.399422455257676e-01   -2.964219644315129e-02   -2.738207469337994e-02   +4.972341190106819e-02   -1.221625606153273e-01   +4.342603474830963e-01   -2.418045916428123e-01   -1.691425719910112e-01; +4.915191344324505e-01   +2.222104576112281e-02   +7.445296490897851e-02   +2.022511986377295e-01   +3.342379628077151e-01   +2.331058045055750e-01   -1.848129650007053e-02   -8.256000031491066e-02   +2.363470155312262e-01   -2.703853243002967e-01   +1.942914717295532e-01   -1.944775447642813e-01   +1.546655528894411e-01   -2.802592652154203e-01   -7.634843330247219e-02   -1.000343504302524e-01; -5.841409197661149e-02   +3.977318002878986e-01   +6.071256576133487e-02   +5.925803988449733e-02   +9.441533475095562e-02   -1.250931355602586e-01   -4.080979175166217e-01   -5.262747027680292e-02   -2.640771901553353e-01   +2.342611150444716e-01   -3.815619635638909e-01   +7.581605500373612e-02   +1.425280610213632e-01   -4.102063094352103e-01   +7.856758430329816e-02   +3.745195132948040e-01; +1.714382071112246e-01   -1.064726605185643e-01   +2.838241454014881e-02   +1.589756777317808e-01   -1.617754014088729e-02   +9.725114685379427e-02   +2.688499173977268e-01   +2.078421701469034e-01   -2.567304542404940e-01   +1.320734160687026e-01   +2.150738940130810e-01   -8.364136713780357e-02   +5.664371503918584e-01   -1.775313498088153e-01   +2.964886865978510e-01   -7.247535455902723e-02; -8.371826730025167e-02   +2.722339848316371e-01   +2.920988969822520e-01   -3.120728795436641e-01   -4.045681276772162e-01   -8.258311332987515e-01   +2.888352807799514e-01   -1.553359192381047e-02   +2.823736801699876e-01   +1.565009721469416e-01   +5.281919493657441e-01   -2.818493024314136e-01   -1.254667812297753e-01   +6.555146164331835e-02   +6.033625749981546e-02   +3.319112398529959e-01; -6.255588353870421e-02   -9.594571639307060e-02   -4.237273939833797e-01   -8.490854826182619e-02   -1.341139191075413e-01   -2.542806707316931e-01   +1.373563220185222e-01   +2.674766353893651e-01   -2.745843073626447e-01   -3.751027619189155e-01   +1.341997548078558e-01   -4.266961600582992e-01   +1.727522673745238e-01   -1.392090463761102e-01   -8.365738107479315e-02   +8.254325583194352e-02; +2.687689531977278e-01   +4.187749111639097e-01   +4.544982404074659e-01   +2.290415398293572e-01   +4.896095700440978e-02   +4.758497204868360e-02   -1.562312451221999e-01   -1.905240739398062e-01   -4.629226314198547e-02   -8.402235222658730e-02   -1.513661638549140e-01   -1.927348515107594e-01   +3.200311212611458e-02   +7.837059178890446e-02   -1.725907655751039e-01   -2.132236192866397e-01; -1.237138458438251e-01   +4.641100971154122e-01   +7.304979720486909e-02   -3.191462036838373e-01   +1.687399868099242e-01   -3.333913012097195e-01   -3.121809805698157e-02   +3.874587016390922e-01   +1.225447769474207e-01   +4.626799813194143e-01   +3.765146618798537e-01   -1.921713278580224e-01   +4.114499516259411e-01   +2.525900630960808e-01   -1.514313963077541e-01   +1.271410861510011e-01; +2.220417508557079e-01   -2.694224224188587e-01   +3.894155883827734e-02   -4.354288062984735e-01   -2.380164655598495e-01   -1.709640927301212e-01   -1.636074477634972e-01   -5.466305787654024e-02   -2.436657270860386e-01   -2.089416072825672e-01   -7.579470645715938e-02   -8.722171923101923e-02   +1.612059313393374e-01   -2.117312199581149e-01   +1.247126807135183e-02   +1.252546674371948e-01; -2.179727758084474e-02   +1.189362863540996e-01   -2.143193543710321e-01   -1.469637396606642e-01   -2.361324461201595e-01   -2.015067235671568e-01   +1.002265685239032e-01   +2.537975382809476e-01   +6.165065528420060e-02   +1.086389087408727e-01   +9.718220146420964e-02   -2.722297920915692e-01   +6.364331216903406e-05   +7.338025555174513e-02   +2.649444490496479e-01   +1.885698350836930e-01; +1.903910646693544e-01   -1.056397556216951e-01   +1.928755406598501e-01   +5.093753491009027e-01   -7.241018633834698e-02   -1.127431498751620e-01   -6.487000865760396e-02   -3.869247618440554e-01   +3.266205145187270e-01   -2.407753535021531e-01   -1.191564158144758e-01   -2.784236069319653e-01   +2.819476231396958e-01   -1.819786208565351e-01   +3.887233829800214e-01   +1.379861592579510e-01];
L1E_L1I_iGABA_netcon = [+3.435665421036072e-01   -1.509031186409855e-01   -4.547479870985449e-02   -2.149904312968025e-01   +1.909031402953856e-01   -6.510413756317954e-01   +3.994016983760411e-01   +1.705505932473809e-01   +1.976576165440726e-02   -1.636601131335055e-01   -4.097732600312957e-01   -4.946687802502725e-02   -1.520834077962934e-01   +3.788859054849412e-02   -1.475987667940963e-01   -2.536442368683678e-01; -2.429245568402410e-01   -2.305951553698952e-01   +9.883572119357351e-02   +3.204586493750193e-01   +2.851824805740875e-01   -1.642232842054503e-01   +1.763186730468877e-01   -1.301325650136481e-01   -4.747331405207714e-02   +2.752290189800548e-02   +2.324674960473827e-01   -1.773059287357702e-01   +1.767435089796507e-01   -1.047460421497397e-01   -2.724509603093336e-01   +1.677538287623171e-01; +1.449292316360689e-01   +4.886417891996090e-01   +2.170174074641211e-02   +2.036496564010447e-01   -1.622606153188490e-02   -7.192870493524517e-03   -2.482864955368767e-01   +2.191285164426749e-01   -7.926377467161855e-02   -1.836131591575184e-01   +2.360634367538265e-01   -3.322726340437505e-02   -2.586653217901288e-01   +2.522792905351913e-01   -1.133873190246747e-01   +5.450280365515157e-01; +5.273510651886729e-02   -2.961590742386714e-01   -1.313435133829394e-01   +2.995420623903782e-01   -1.869184427635589e-01   +3.115834811396188e-01   -1.039806477001223e-02   +2.931427823720435e-01   +1.021810656726439e-01   -1.689525312758794e-01   -1.734232057315174e-01   +2.808970423952737e-01   +2.366385443972921e-01   -3.054873184172133e-01   -2.084223103545726e-01   -1.752973126958113e-01; -1.199989585559220e-01   -1.140801090714322e-01   -1.648112750108641e-01   -3.003474419152157e-01   -2.073647487908582e-01   +2.023474235793142e-01   +2.481046640340636e-01   -3.250740256584249e-02   +8.556523419995617e-02   +2.498258528245491e-01   -4.495881375341265e-01   -1.459388059367297e-01   +3.832111764734642e-01   -2.706862794730524e-01   +1.530757821569543e-01   +1.456756108151499e-01; +3.966660026202806e-03   +2.738685845819790e-01   +1.488804858515570e-01   +3.671804907730369e-02   +1.541888233886426e-02   +1.807820523365607e-01   +1.014802746836382e-01   -2.823209774250668e-01   -5.781459202499131e-02   -8.378977990059672e-02   +1.159009807650236e-01   -1.339144577812876e-01   +2.616636029684834e-02   +1.577553787612843e-01   +3.203830680046009e-01   +1.315758212677885e-01; -2.258742391997886e-01   -1.532596880799603e-01   -4.055514941653672e-01   +4.692888746175296e-01   -1.706833198878163e-01   +1.385176375505870e-01   -3.507338492652057e-01   +7.022547572147127e-02   +1.037602536608057e-01   -1.468898629740092e-01   -6.956350908649502e-02   -1.272868855109648e-01   +2.298649603290249e-01   -2.975679585632002e-01   -8.603571154702394e-02   -4.970634328580017e-02; -1.526160265500302e-01   -4.731393774953977e-01   +1.475591250052632e-01   +1.839574263372909e-01   +2.462112055067582e-01   +2.935709906912005e-01   -3.216895908398412e-01   +1.470243067291621e-02   -2.232536907545607e-01   +2.431515452343718e-01   +1.422071570589466e-01   +1.118165573191724e-01   +1.484235073546193e-02   -1.285070890923760e-02   -3.325924262131175e-01   +5.269186316691299e-01; +2.315961472120019e-01   +2.332538398954980e-01   +1.159407405657421e-01   -3.909357916972404e-01   +2.103971155029156e-01   -1.405335056050221e-01   +2.996278695315022e-01   +2.289531197269443e-01   -1.789149271846692e-02   -8.976649165853828e-02   -6.040693458122014e-02   +2.402490808110233e-01   +1.954531448960614e-01   -1.580967671067675e-02   +8.248045684815501e-02   +2.004226408683918e-01; -2.721313443093759e-01   +1.488021791983046e-01   +3.265129942872287e-01   +1.907140834229768e-01   +4.891001759536054e-01   +5.805828219868801e-02   -2.230847899281389e-01   +1.348692652437987e-01   -3.872028121054746e-01   +1.967834430748380e-01   -3.632880660340054e-01   +2.160908282124177e-01   -2.945534048561259e-01   -2.316331277131049e-01   +1.231413907327964e-01   -3.434767014410949e-02; -9.281320800577111e-02   -2.991281796862376e-01   -8.901367184667291e-02   +2.212783630202471e-01   +1.354519773069237e-01   +1.278349693226046e-01   -3.650756793510465e-01   -7.541122332535928e-02   +3.512942871055979e-01   -2.647314431187857e-01   -2.734794371409996e-01   +4.002308398357417e-01   -2.648329680214301e-01   +2.936924713804812e-02   -1.074711347626886e-01   -8.042438302592242e-03; +3.559277869900557e-01   +7.787789981894550e-03   +4.026383002294207e-02   -5.849163946033958e-02   -4.560307726050049e-02   +1.744590595778603e-01   +3.226856119775881e-02   +2.208710885793258e-01   +1.462100677978084e-01   -1.176279857967468e-01   +4.112702121044656e-01   +2.148758732580642e-01   +1.014760223764123e-01   +3.372107046200472e-02   -1.854182712122830e-01   -1.113731403398841e-01; +1.319295117788483e-01   +1.983413143441084e-01   +9.372029552681771e-02   +4.051996215383457e-01   +2.778935129945628e-01   -1.828323161338164e-01   -1.473308059528432e-01   -2.401593827667622e-01   -3.923694062587225e-01   -2.140840592370963e-01   +1.296519177668607e-01   +1.924316635630180e-01   +1.502408324914248e-03   +2.716769021891415e-01   +3.202542526423847e-01   +2.903354909979479e-01; +1.099395859699506e-01   +1.036167378366592e-01   -3.009764245244408e-02   +4.977757197796445e-01   +4.595030762428244e-01   +3.337479134760389e-01   +1.288037020503831e-01   +5.431771582614602e-01   +2.450027551988351e-02   +1.628255792283743e-01   -1.510212567008716e-01   +1.002205841820622e-01   +1.739382178596098e-02   -9.412428484245325e-02   -9.970902366471932e-02   -5.735727847071555e-02; -3.656695157902304e-01   -2.588660832760839e-01   +2.155327860221711e-01   -4.212961415876098e-01   +1.542998150925332e-01   +4.021520106403578e-01   +3.346549428383983e-01   -1.572398622016963e-01   -4.561825966495758e-02   +4.363310987261824e-01   -1.038946688340795e-01   +2.536318747543659e-01   -8.443580791404566e-03   -2.666217051002597e-01   +1.848129803963850e-01   +6.944115812791632e-02; -8.358376465330139e-02   +3.117453435148090e-01   -2.437943838726731e-01   -9.529136509853853e-02   -5.251428337530348e-02   -8.641606107767712e-02   +1.217741512367864e-01   -2.928074321134891e-01   -4.950456993827429e-02   +1.864952885359919e-01   +1.344189881633709e-01   +5.937382264264113e-02   -3.209296289193380e-01   -2.290369306245330e-01   +2.345234682418167e-01   +5.814945429628822e-02];
L2I_L1I_iGABA_netcon = [+4.084329102147131e-01   +1.573194275772894e-01   +2.763912127163557e-01   -2.189517192210474e-02   +1.580958911859393e-02   -3.358013331964727e-01   -7.363359641065981e-02   +2.385684928530620e-01; +1.566031346196796e-01   -1.634927263115630e-01   -5.992792968899009e-02   +3.829647154946361e-02   -2.586093542172521e-01   +2.660351622490313e-01   +2.607350861490709e-01   -3.356776626926409e-01; -2.675928281008015e-01   +2.291793588693309e-01   +1.307854451501589e-01   -3.668322179417259e-01   -5.074197391888404e-01   -9.648157382318306e-04   -4.483420654151257e-02   +3.492643854439353e-01; +2.637266243691849e-01   +1.248576693644724e-01   -2.579861316288048e-01   -1.450196613779132e-01   -4.867512352061139e-01   +2.494140378672482e-02   +2.879051196891477e-01   -1.061117054721798e-01; +1.015977292513714e-02   +2.095614246067274e-01   -2.112688889191833e-03   -3.877874671581333e-02   -1.432454750072608e-01   -3.162420504392906e-02   +6.064023978495579e-02   +1.428452167986206e-01; +1.577131343742894e-02   -4.570076173524487e-01   +4.395475707696374e-01   -1.423141697551608e-01   +1.247880132925642e-01   +1.173876147543865e-02   +2.068427648323566e-01   -3.774223784638389e-02; +1.826595467071226e-01   -3.922842326171876e-02   -1.826954667309812e-02   +3.679032672990326e-02   +4.028131500669870e-01   -4.138078279412729e-01   +7.111913213678829e-02   +7.331693899843893e-02; -2.929748095028290e-01   +1.011371619318306e-01   -1.412265068564962e-01   -5.745406416353058e-02   +9.695594902263367e-02   -1.484960864376774e-01   -2.909859535945395e-01   -1.242988483341128e-01; +2.638033504889532e-01   -2.618202687716012e-01   +2.624546889482510e-01   +3.253385807313591e-01   -3.204982424948387e-01   +8.483991891247401e-02   +7.019271832269441e-02   +2.644113940432357e-01; -4.814280889387840e-02   +4.409766354759560e-01   -2.860707255524733e-01   -1.993765933279188e-01   +3.451968916268264e-01   -2.076699387043771e-01   -3.780405319354039e-01   -5.037768421732156e-02; -1.842921447956347e-01   -1.789352514137534e-01   +1.107606702080547e-01   +1.123673642311808e-01   +8.903761836303281e-02   -1.452642282529104e-01   -2.921090628977507e-01   -3.120722367365633e-01; +1.701080119721832e-01   +4.282126553938919e-01   +3.995347432269702e-03   +3.933243509034707e-01   -2.766693956984691e-01   -5.885627931044429e-02   +2.588028309398708e-01   -1.711275751478214e-01; -1.818515261051128e-01   +1.447593596783145e-01   +1.096464370836895e-02   -1.158256208868380e-01   +2.032869059448753e-01   -1.926905699793788e-01   +7.948216901831431e-02   -2.102302014928540e-01; +2.441351812753766e-01   +1.214192521097814e-01   -3.771623142375984e-01   -2.559446840035504e-01   -4.567088058206265e-02   -5.840089739190931e-01   +3.217111794531660e-01   +5.121111407826510e-02; +1.853645914483473e-01   +2.356009490526583e-01   +5.606599360184145e-02   +7.655497366857730e-02   -4.757957066286323e-02   +1.064599377833627e-01   +6.547961621232190e-02   +2.551680247471999e-02; -3.927050528260913e-01   +3.355552066428916e-01   -3.782368873327555e-02   -2.589122693132994e-01   +4.001768441992732e-01   +1.975631510073621e-02   -3.248060643469580e-01   +1.569696022323466e-01];
L1I_L2I_iGABA_netcon = [-3.167168835786525e-01   -2.841262254808590e-01   -1.842220490146950e-01   +1.447788090384635e-01   +2.056528866730784e-01   +1.485692701983403e-01   -4.556705249423017e-02   +2.373588914417862e-02   -1.249851719303087e-01   +5.113886672002960e-01   +1.952244705005265e-01   -5.305050685727327e-01   +1.538728812372685e-02   +2.056902571343689e-01   +1.465599735328701e-01   +3.322690798540369e-01; -1.911631521158031e-01   +1.770384938308291e-01   +2.725424291028319e-02   +5.010523498264607e-01   +1.293621861019062e-01   +2.497748143217049e-01   -4.442660144856198e-03   -1.612620741585108e-01   +3.710737709183297e-02   +4.554809309441816e-01   -1.818243682191174e-01   +2.984899142568337e-01   +7.687707555249629e-02   +7.315969131908558e-02   +5.538005333100562e-02   +2.134495033901483e-01; -2.783605438084014e-01   +7.947932173990424e-02   +6.776577224202995e-02   -1.650632185623100e-01   -8.199375362910237e-02   +1.551068239235722e-01   +1.436065424826051e-01   +2.747391173273732e-01   -4.580197489876753e-02   -3.455845575561339e-01   -8.486055508646444e-02   -3.323865754933658e-01   +2.301828211607311e-01   -1.150929657143247e-01   -4.762660887521178e-01   -2.512563981333475e-01; +1.287957840847354e-01   +1.963146790532119e-02   +6.062384237178282e-02   -3.504389401654531e-01   -1.104092530039967e-01   -5.765104430408755e-02   -1.374323439612776e-01   +2.646337194637132e-01   +3.188680623943987e-02   +6.548024884206040e-02   +2.940288395743312e-03   +1.849320377512246e-01   -3.170246808766427e-01   -6.605446628838653e-02   +2.304291262422369e-01   +1.024159732657674e-01; +1.582216388797260e-01   +2.330311076614136e-01   +2.683940564892903e-01   -1.176523520398342e-01   +9.973326265513924e-02   +2.387795480761856e-01   -2.210054554832343e-01   -2.244618157201796e-01   -1.837412282108998e-01   -3.349921782598312e-01   -1.300683216301098e-01   +5.015941228807261e-02   +2.905980120474036e-02   -6.946121717795754e-02   +5.729627857500205e-01   +1.904118243613629e-01; -4.278059658536426e-01   +6.705265647944006e-02   -1.088036684974639e-01   +1.139591758354633e-01   +1.562092479749483e-01   +6.097067428039828e-02   -3.690153673945202e-01   +2.618011018141406e-01   +1.982599254633658e-01   -1.559056738731314e-01   -1.982831781415448e-02   -2.695664280951192e-01   +2.839574412851303e-01   +8.222729933744730e-02   +5.279513730369462e-01   -1.463093146986542e-01; +9.018364723131511e-02   +5.032648055327216e-01   +4.073196838048354e-02   -3.638402462863995e-01   +4.637793314005129e-02   -8.372593623225669e-02   -2.081821584690762e-01   +8.341961255846186e-02   -1.594493915594795e-01   +1.621106434010648e-01   -7.653055898397344e-02   +2.977554385047915e-01   -2.019878869123066e-01   +2.245880330325498e-02   -1.836978139989741e-02   -3.405956347381109e-01; +1.768498450004197e-01   +1.833258391100604e-02   -3.393981311305326e-01   +1.324804179060848e-03   -3.549744565670081e-02   +2.122028799197313e-01   -9.111597738237963e-03   -3.155745002232245e-02   -4.536035006873025e-01   +1.969246008579498e-01   +1.204702674629734e-01   +1.838886622101863e-01   -6.034347042714467e-01   +2.382515971248412e-01   +7.411768234005872e-02   +1.709539301933460e-01];
L2E_L1E_iAMPA_netcon = [-2.083957989621537e-01   +5.820736356136991e-02   -4.712493916420036e-01   -8.001963159144072e-02   -1.081233943858380e-01   +1.630106181722653e-01   +2.091725985235621e-01   +1.520944591331438e-03; +1.300162682633372e-01   -1.775741360517660e-01   -1.472015520526851e-01   -3.533973428053897e-01   +3.204282798417345e-01   -4.479395630485158e-03   -4.114325895374830e-01   +2.135115746074418e-01; -6.061721030922480e-02   +1.506525104021254e-01   +9.814057859128882e-02   +1.412973165198427e-02   -7.463855340271244e-02   -3.153027066811949e-02   -1.637305696058048e-01   +8.578751870605837e-02; -3.273558292977685e-02   -2.081180128007169e-01   -1.690900905209760e-01   +8.801532176370494e-02   +1.040024252152922e-01   -2.810323451415127e-01   +6.920843242521421e-02   +2.499648427585553e-01; +2.581006431055191e-01   -3.543875781045280e-02   -5.292456332788283e-02   +3.104102182991841e-02   +3.685810466797527e-01   -2.766178983905638e-01   -1.686877861962925e-01   -2.286805199031104e-01; +1.628441418970408e-01   -7.650853958389288e-02   -1.341872328959099e-01   +7.250370910044504e-02   +5.520261649672756e-02   -1.543116536137123e-01   -3.082327066084493e-02   +4.026445503251880e-01; -2.321916472588947e-01   -1.936352256492976e-01   -1.584668043123027e-01   +1.332428898549751e-01   -1.139913055310504e-01   -3.897418455388968e-01   -3.110930370581175e-02   -3.110417100394353e-02; +3.888174121385034e-02   +2.875937875982946e-01   +2.865041748491383e-01   -1.247689600806109e-01   +1.914101734547058e-02   +3.472701975201125e-01   +2.703686893578444e-01   +2.144817268906253e-01; +8.444842295439953e-02   -1.030044970355402e-01   +3.748631084683386e-02   +2.098073818787244e-01   -1.342305058710160e-01   +8.144177616240111e-02   +1.614425879547008e-01   +1.833456898626969e-01; +1.017015478193495e-03   +3.805963724149085e-01   +7.956750021858899e-02   -1.404757929955528e-01   +3.882807373488323e-01   -8.755174885054381e-02   +9.005974179261639e-02   +6.563260059740189e-02; -1.771489853791565e-03   -1.516840733363994e-01   +1.074812160404400e-01   +1.295129235545009e-01   -8.549972611156945e-02   +1.096842792773538e-01   -1.930012621812333e-01   -1.323814188963045e-01; +1.168536591450531e-01   +2.433244801277538e-01   +1.987526582373032e-01   -4.490901438459919e-01   -1.168690640759857e-01   -1.904706604940049e-02   -3.851543577856376e-02   -3.386478373907726e-02; +9.418804656714154e-02   -3.547705053176835e-01   +1.929731211798733e-01   +2.933664482306410e-01   +1.696473534609944e-01   -1.825190276524321e-01   +3.035728595831976e-01   -1.001631299241390e-01; +3.038531205912772e-01   -8.249909988615289e-02   +1.350239676375386e-01   +5.246314963019458e-02   +1.956325390446682e-01   -1.771060125573208e-01   -3.108350832084666e-01   +2.251125904743296e-01; -1.583661360081756e-01   -1.826111733894686e-04   +1.739076157570194e-01   -5.869707480777914e-02   -1.858728091946792e-01   -9.079740510782577e-02   -1.514515044056254e-01   +4.810213159329594e-01; +1.750839593787700e-03   -8.525796993345133e-02   +1.873151215731143e-01   +7.745593177958117e-02   -3.442735001663522e-01   +5.186117304258964e-02   +2.320845534542963e-01   +2.009050222997824e-01];
L1E_L2E_iAMPA_netcon = [+3.682881756836438e-01   -4.175160935895075e-02   -2.154067510962724e-01   +8.925110483649890e-02   -2.744846296399357e-01   -5.789421909294658e-02   +3.043876434325677e-01   +2.959738784675996e-01   +4.160680142832548e-01   +8.846333843491799e-02   -7.670626908288791e-03   -1.572463574757765e-01   +2.870913138297781e-01   -2.380215068267470e-02   +1.021751143899469e-01   +1.535195676493977e-01; +9.549553355666286e-02   +9.517853656254904e-02   +4.514644450842543e-02   -4.312948153488593e-01   +2.429788868103334e-02   -1.694035253178673e-01   -6.957218464493639e-02   +1.923675207149978e-01   -3.377021374382410e-01   +9.335281040574843e-02   -4.496208662313032e-02   +1.827854113748730e-01   -1.994282675826010e-01   -4.771381010060761e-01   +1.614594208206910e-01   +1.126548248216267e-01; -3.270328428266878e-01   +2.844186949382093e-01   -1.392948112863051e-01   -1.332473656663434e-01   -1.082240353952598e-01   +2.431443022428615e-01   +1.667635395070359e-01   +2.209565257693202e-01   -4.848775678722855e-02   +9.571518649833417e-02   +3.929441058777670e-01   -8.273238068823714e-02   -2.063645786728087e-01   -1.308200953976832e-01   -1.642681096399147e-01   -1.327773705221905e-01; -4.118054777790151e-01   -4.831838119070338e-02   +2.713297412567418e-01   -1.192595479780524e-01   -5.157907286301988e-02   +2.027793857134405e-01   -2.371948654861111e-02   +2.727600292382273e-01   +2.801820595954320e-02   -1.486468264937074e-01   -5.367502975423977e-02   +1.548674733706996e-01   -3.411477437148467e-01   -8.868936145128924e-02   -1.926929812090420e-01   +7.616747516032872e-02; -5.979834519885131e-02   +3.883135403857765e-02   +5.826609606126112e-01   +1.022882882265009e-01   -1.019529616326040e-01   -3.936685570842192e-01   +2.341068155836941e-01   -9.565093399312916e-02   -3.799373354992964e-01   +2.380293633162034e-01   -1.834417309400928e-01   -6.925505935854977e-02   -1.594467171748265e-01   +5.088002202104143e-01   +3.324898324223478e-01   +2.308605456984330e-01; -3.281073766112902e-01   -1.164331403754658e-01   -2.045775502691262e-01   +4.329740227156884e-01   -3.920081587262719e-02   -1.555852417704890e-01   -5.231993930533960e-01   +1.933396687913776e-02   +1.994604604426627e-01   +2.674658541274622e-02   -4.606396623344456e-01   -2.180908488085211e-01   -5.663330711911690e-03   -9.278141279525411e-02   +1.371293567301625e-01   -2.124112744047893e-01; -2.824910583898637e-01   +3.554475218579199e-01   -1.171363099950251e-01   -1.862199676120866e-01   +1.844410019153916e-01   +5.606461306331727e-01   -2.435941184484967e-01   +3.524807654287320e-01   -9.743394895258567e-02   +2.255612048952435e-01   +1.697749711403517e-01   -1.093742998941445e-02   +8.666248891836881e-02   -2.190508110030296e-01   +1.422251048998883e-01   +1.672419183523534e-01; -1.301241884338689e-01   +1.022006812408002e-01   +1.021837579676203e-01   +3.366700570436160e-01   +5.817580169852071e-01   -3.281635628673545e-01   +8.039056820422075e-02   -4.673356808184249e-02   +5.773324027596951e-01   +4.675481381959240e-02   +3.584440452743281e-01   -5.290550310748322e-02   -3.115406912423520e-01   -3.276936715408136e-01   -3.875923296538607e-01   -1.149346935957366e-01];
L2I_L2E_iAMPA_netcon = [-3.929536557321118e-01   +1.565861449742000e-01   +1.408652549525085e-01   -2.110808546174970e-01   +8.188377006362593e-02   -2.385879627680351e-01   +3.415630992361501e-04   +1.482083640169764e-01; +5.856395904180577e-02   -2.870697532838327e-03   -2.291366971687405e-01   +2.606448484979563e-01   -1.214390903761937e-01   -2.501366773211323e-01   +2.280183523343890e-01   -2.842772765565327e-01; -2.516731866191595e-01   -5.240667275935664e-02   -1.910412992778796e-01   -4.372356058996182e-01   -2.298167368058537e-01   -2.908308050141630e-01   -3.280372997604583e-01   +1.547649907024224e-01; +1.329550959176582e-01   +3.948143739007980e-01   -3.890087300589904e-01   +4.148405373847480e-01   -3.920085712227271e-01   -2.328452081705464e-02   +2.780768279167484e-01   -1.612332986815433e-01; +2.105908946620058e-01   +1.802563785654385e-01   +1.137401384444539e-01   +1.532962988427526e-01   -5.429505775355491e-02   +4.413262630165327e-02   -9.701305016651675e-02   -1.767477699631229e-01; +2.673128746058561e-01   -1.788199495785479e-01   -1.866550393463380e-01   +4.940285273956518e-01   +1.452996341019862e-01   -1.087070209465378e-01   +3.430341841556874e-01   -1.554795358143991e-01; -1.661950959492165e-02   +3.755024761160327e-01   +1.893527226069575e-01   -2.584886163295550e-01   -1.155646532070799e-01   -5.430326136932621e-01   -2.235645678765868e-01   -1.131299157716897e-03; -1.912775177924954e-01   +4.181305878515419e-01   +2.227191581467849e-02   -2.816893089501479e-02   -3.831430119495941e-03   +4.403244025577148e-01   +4.028913026441369e-01   -5.529553803611775e-01];
L2E_L2I_iGABA_netcon = [-1.952392291544738e-02   -1.172174437423211e-01   -1.194613341309571e-02   -8.034112819492614e-02   +3.485448619324094e-01   -2.194269078016836e-01   -1.442722509476667e-01   -1.113740094040630e-02; +2.133787707624840e-01   -3.237044312481431e-01   +5.744352733876846e-02   +6.479663701280525e-02   +7.238077725020323e-02   -2.749586274224174e-01   +3.479723506800446e-01   -2.087254600428642e-01; +7.884135926915752e-02   -1.123345161788815e-01   +2.127885704144269e-01   -2.117946487353025e-01   +1.136135471621690e-01   +1.554730419021591e-01   +2.406545087536371e-02   -1.682866256352159e-01; +1.944261787044198e-01   +5.223323684761333e-03   -1.705213470206034e-01   +9.248635485691971e-02   -3.323767978613887e-02   +1.414426044099574e-01   -7.879850028267604e-03   +2.042586109457653e-01; +2.096520716194117e-01   -3.809554266266508e-02   -8.128259453735368e-02   +6.094287234886905e-02   +3.224849214643967e-02   +2.207154180284505e-01   +1.060548147479504e-01   +2.337292849426874e-02; +1.061607765200128e-01   +2.331655631944590e-01   +1.755773156842239e-02   -2.509151868929114e-01   +3.102367379278019e-01   +4.202029710645054e-01   +1.485925970556617e-01   -1.136987982442839e-01; -8.266307264703382e-02   +3.587364841926453e-01   +5.772414940422562e-01   +9.557593267418645e-02   +8.164174090061009e-02   -1.949127977184557e-02   +1.628465644733806e-02   +1.592683196789520e-01; +4.131015336828386e-03   -3.743995780750528e-02   -4.555956581049070e-02   +3.194522426482270e-02   -2.695655425036293e-02   +3.179138647623168e-01   +2.413527499821797e-02   +3.249159372697044e-01];
L3E_L2E_iAMPA_netcon = [+1.640831375055198e-01   -2.069349150372261e-01   +1.188399853958945e-01   -5.394772516187881e-01   -2.823946313421554e-01   +8.029446481440994e-02   +3.056134175996949e-01   -3.052612406965888e-01   -2.686771576075829e-01   -2.394363982896204e-02   -3.136037866309958e-01   +1.958001638923350e-01; +2.925286709685121e-02   -3.124425512680441e-01   -7.060009296842237e-04   +6.272231540645609e-02   -3.283589992782605e-01   -2.131900450041933e-01   -2.477659056399518e-01   +3.506532828969515e-01   -1.786136987635805e-01   +7.702448132852967e-02   -2.496252970647277e-01   +1.544594782560302e-01; -3.645141891217826e-03   +1.191130130124870e-01   -5.659762470422943e-02   +3.902887750584148e-02   +4.070825617449840e-02   -1.747118407136791e-01   -1.658415773779427e-01   +6.690333231413466e-02   +1.635029171633306e-01   +1.063629433639979e-01   -3.489769436488458e-01   -2.122793255517272e-01; -3.965083925220763e-01   -1.916370903836985e-01   +3.392241823560519e-01   +1.282113894291641e-01   +9.273189316544130e-02   +6.574100309329675e-02   +2.479745089960328e-01   +1.045990214772065e-01   +2.823259878516587e-02   -2.732640143051054e-01   -1.719404895797320e-01   +5.108287288580249e-02; +2.391322668256662e-01   +1.789501925818707e-01   -9.955450942423602e-02   -1.472334349566525e-01   +5.403317407222616e-02   +2.663078429153618e-01   -1.521020060009598e-01   +8.523379604270806e-02   +1.355883671415647e-01   -1.604467406301052e-01   -1.770868955817949e-01   -1.286441729473142e-02; -4.325086022210007e-01   +7.362056433259602e-02   -1.006149764656036e-01   +2.830303434201445e-01   -2.864767614727992e-01   -2.446285182906426e-01   +5.469665467196351e-01   -3.318313865030842e-01   +1.167091632420129e-01   +5.350433445829677e-02   +2.212191799667816e-01   +6.722124805923491e-04; +2.631982047524184e-02   -1.863778177086444e-01   +2.573372675058511e-01   -3.775934306805926e-01   +2.642097727328119e-01   -4.978227719148212e-02   +2.520233565660948e-01   +1.049187536624266e-01   -2.162904387924324e-01   +2.274984583094274e-01   -3.571871842048523e-01   -1.103601603679617e-01; -5.622844661634825e-02   +1.504362908023913e-01   +6.280726954759123e-01   +1.461560992839391e-01   +1.504688993849120e-01   +3.193254468265617e-01   -2.631197442836148e-01   +3.806517139846289e-01   +1.143975178114253e-01   +1.331084263346891e-01   -1.113999027399059e-01   -3.731672404908695e-01];
L3I_L2I_iGABA_netcon = [-2.066396492599491e-02   +5.866397996938453e-01   +1.643821327982699e-01   +4.517870695026668e-01   -2.030763985438924e-01   -3.390904071080941e-01   -4.552178504193415e-01   +2.826373272376401e-02   -3.109005883633363e-01   +1.236318430384507e-01   -6.324105150246187e-02   +1.965687981069910e-01; +2.022978488359394e-01   -1.378216771456255e-01   -9.212125366530230e-02   +1.934779392899372e-01   -2.164027239139172e-01   -1.562239984619966e-01   +5.895086414200869e-02   -1.612715729335949e-02   -2.912453617164074e-01   -1.925697409094183e-01   -1.105417902444662e-02   +1.318213858990573e-01; +2.784468826762236e-01   -1.854127199310711e-01   -1.738508385425389e-01   -2.774727161505082e-01   +1.889818019408492e-01   +9.939459783137171e-02   -1.312735413384343e-01   -2.341953345376329e-01   -1.609900813431440e-02   +8.398837294423668e-02   -4.029887793254898e-01   +6.650320460069754e-02; +1.753365741052708e-02   -1.303210319240174e-01   +1.199379851559121e-01   -4.886317369438385e-01   +1.898418825542141e-01   -1.299049807842095e-01   -2.901787883585973e-02   +6.691176318848588e-02   +2.729232091102944e-01   +1.456147640921245e-01   +5.297435971098520e-02   +9.572456786512301e-02; +2.917092671847235e-01   -3.509284333085134e-01   +2.225153696953477e-01   -9.511673487482941e-02   -3.570704587457821e-01   +3.719146303034702e-01   -1.598509437491567e-01   +2.421877063058738e-01   -1.214459958731772e-01   +3.208747527517440e-01   -3.379106384959967e-01   -2.153363106416812e-01; +3.984736068539148e-01   -2.166772359521932e-01   -1.295388839900313e-01   -1.336831305188819e-01   +2.918774382043634e-01   -4.615452413080406e-01   +1.339244184146273e-01   -1.688773908255675e-01   +6.942869103548843e-02   -1.205645999194991e-01   -1.869136779110018e-01   -7.439055695138665e-03; -4.534609037232304e-02   +3.071970571966458e-01   +1.893384878785172e-01   -4.306044446082291e-01   -6.697041735609055e-02   +1.291496181357939e-01   +2.864615959582159e-02   +5.915814024339910e-03   -8.537153154306625e-03   -3.778824028996415e-01   +1.026034236751724e-01   -2.515384327298137e-01; +2.550506905475113e-01   -3.294465922957657e-01   +9.645986068651125e-02   +3.724267158713692e-01   -2.530403950759463e-02   +8.429408305574115e-02   +4.535271876900783e-01   -2.025797779868745e-01   -2.924140723766986e-01   -2.011029561013515e-01   -3.887972655137198e-01   +5.498517707460285e-02];
L2E_L3E_iAMPA_netcon = [+3.870509849811985e-01   -1.536299187162099e-01   +6.562765422896669e-02   +3.105418300266855e-01   +2.910856333710875e-02   +7.391651763689701e-01   -3.945475357868206e-02   +1.944551340876970e-01; -2.292410399928687e-01   -3.130298741939767e-01   +3.753673972340156e-01   +5.180595494453429e-01   -2.053556159577397e-01   +3.992694561825278e-01   +9.823302136935129e-02   -1.101328796844465e-01; -9.962733508474128e-02   +1.456877375015837e-01   -1.121200047085998e-01   +2.470182167262236e-01   -7.699346766497500e-03   +6.841720617132535e-02   +1.380749632282125e-01   +2.271524660658782e-01; +1.416723965401752e-01   -1.121226680315667e-01   +3.129695765957726e-01   -4.180541793495983e-02   -2.638672540926555e-01   -1.900922645623908e-01   -1.022053217009805e-01   +9.313522152346576e-02; +1.781106538943683e-01   -1.720327407361336e-01   -3.982113920706257e-01   +3.636386329315515e-01   -3.850338789002623e-02   -2.634729594105498e-01   +8.457442584184344e-02   -1.332223521624601e-02; -2.030427863148320e-01   -2.572770795207995e-02   -3.329323015218993e-01   -3.208081490126961e-02   +3.327141777172724e-01   +2.985539509857763e-01   -6.655140623564797e-03   -2.399842762254133e-01; -4.158107674134107e-02   +6.084366240574867e-02   +3.753083771518799e-01   -3.243092774843485e-01   +2.501591438348805e-01   -2.573366274044116e-01   -1.028202195165422e-01   +7.603150965513443e-02; -1.817454892988467e-01   +2.811287511410610e-01   +5.532376500440207e-02   -8.681343658265016e-02   +2.673904961416740e-01   -1.585457765927324e-01   -3.870727269012705e-01   +2.565820119800248e-01; +8.753514256454061e-02   +7.875109865202259e-02   -3.242819075516326e-02   -1.427968979637292e-01   +3.786962036852643e-01   +2.681492510048552e-01   -6.351321147122549e-01   -3.192359469318176e-01; -1.486259311588908e-01   -2.837050276773875e-02   -1.407021918675465e-01   +3.041671800930043e-01   +2.427595657432738e-03   +1.384246339826113e-01   +1.730693821137948e-01   +8.843752449589889e-02; +2.963462004715715e-01   -3.374408391555334e-01   -1.061877016949508e-01   -2.026622311319388e-01   +2.814078952248312e-01   -1.930920029007481e-01   +2.632710001957326e-01   +1.868461684772910e-02; -1.172684415031394e-01   -1.763186458471896e-01   -3.762565610321278e-01   -3.114390072989898e-02   +6.788525172028952e-02   -3.360670738630910e-01   -1.940764473582304e-01   +2.232870139095450e-02];
L2I_L3I_iGABA_netcon = [-3.832046226848393e-01   +3.747012629338600e-01   +1.386194375562643e-01   +9.915470450308880e-02   -2.852583418683843e-01   +1.129811094235238e-01   -2.514021071689522e-02   +1.596156621507328e-01; -4.661617335993617e-01   +5.638760243907044e-02   +2.149110067837148e-01   +3.108708221077865e-01   +1.341656723389481e-01   -2.631475791595074e-02   +3.741919259993942e-01   -2.546734968652666e-02; -2.324955311750505e-01   +2.100187419542594e-01   +1.209862220443080e-01   +3.357199412797514e-01   +1.248502447198497e-01   +2.624361793273771e-01   +2.104000961154995e-02   -6.617640317234275e-03; -2.681298152855990e-01   +1.383310741026499e-01   -4.856485343157006e-02   -3.881483407566493e-02   +4.875188882432693e-02   +8.481565427179354e-02   +1.398164463326891e-01   +1.177994307395553e-01; -1.311663669035637e-01   +1.137009080369623e-01   +4.965665436439961e-01   -3.940269844242851e-02   -2.458317505488423e-01   +2.998762618933595e-02   -2.516940011908319e-01   +6.923173186805591e-02; +4.908986438795794e-02   -3.567802221966352e-01   -1.370307664896333e-01   +8.325579612397416e-02   -3.058210126903843e-01   +4.302257517049194e-01   -3.007735017672798e-01   +4.722246472947268e-02; -3.343908708067193e-01   -1.379512956800480e-01   +2.921948363673312e-02   -1.702363459525097e-01   -3.124666236908757e-01   +4.929457095272020e-02   +1.298978355263223e-01   -1.915818583340988e-02; +1.900898440969126e-01   +1.486647629915554e-01   +4.313656833413138e-02   -2.518890436086914e-01   -3.496707536403854e-01   -3.345092516721089e-01   -5.412166712141302e-01   +3.362424620425949e-01; +2.069853347510249e-01   -9.691495129047409e-02   +1.379526198788818e-01   -4.702608301675680e-01   +1.451540893896406e-01   -2.899855223755653e-01   -3.327271352084477e-01   +2.317638395218474e-01; +1.654283850726758e-01   +1.214013001604004e-01   -3.767919988215844e-01   -1.800040441406349e-01   +5.015868584354170e-02   +1.971365522274619e-01   +6.866414987716325e-02   -1.906474744910450e-01; -1.649575788661310e-02   +3.557415579487302e-01   +5.902319096274695e-01   +1.716915391556753e-01   -2.390679291727052e-01   -3.511475337100873e-01   -1.831295203364101e-01   +3.806624578481645e-01; +6.683338986005745e-02   +3.462842677569758e-01   +2.303579375132281e-01   -8.819324855711311e-02   -7.167500557179426e-02   +2.556596723607790e-01   -4.904448918307419e-01   +1.946983134879314e-02];
L3I_L3E_iAMPA_netcon = [+1.841304822786062e-01   -1.884880205781518e-01   +1.098470393957667e-01   +4.340670712663584e-01   -2.955363083143510e-01   -5.461656963247490e-01   -1.524093890664560e-02   +7.313573952254093e-02   +1.673038160900887e-01   +5.096054074549792e-02   -1.769688516640654e-01   -8.213429744621228e-02; +1.038411156247343e-01   -1.179024750480749e-01   -1.101435686864371e-01   -1.601080980472425e-01   -3.140577444839425e-01   +1.448725610882881e-01   +1.389213181847154e-01   +1.725948504917085e-01   +3.587965480893041e-01   -1.410081190615307e-02   -1.121348131039351e-01   +2.260897776988306e-01; -2.317569115527284e-01   -1.985080431940646e-02   +1.395979807618649e-01   +9.379325096267793e-03   +3.561059928744489e-02   +3.915927803765442e-01   +9.222316696932414e-02   -2.934761706481309e-01   -1.879248220209160e-01   -8.759286564057206e-02   +1.921616324466831e-02   -1.190498597869175e-01; +4.861031152667799e-01   +9.894820026314546e-02   -3.496609978590743e-01   -1.112010613378792e-01   +4.775008766662441e-01   +1.816073303840003e-01   -3.092444888149267e-01   +2.496957772985871e-01   +1.419035765480445e-01   -2.501942833040410e-02   -2.677488675509638e-01   -1.432046214691808e-01; +3.271801239266872e-02   -5.268932019986391e-02   -1.656288257225936e-01   +1.010139399126043e-01   +5.080925401771436e-01   -9.791516687698840e-02   -1.396868794662102e-01   -1.100135226989048e-01   -8.920353007697449e-02   -2.191248680232708e-01   -4.811254936860496e-01   -2.135785503065447e-01; +1.444661852643209e-01   +3.470174949929245e-01   +1.285684896905707e-01   -5.557927475543706e-02   +7.672699248856130e-02   -1.782193672177874e-01   -2.270616670144349e-02   -3.932115578666241e-02   -3.293815062795225e-01   +4.839047712008257e-01   -1.649334399769147e-01   +1.961209073877685e-01; +3.535455912873122e-01   +1.747269468854351e-01   -1.781048028613662e-01   +2.131769750842124e-01   +7.137806910693131e-02   -1.160175490521944e-01   +1.841454516784454e-01   -3.226498836300535e-01   +4.913388304845695e-02   -7.987842561690507e-02   +6.020210402925030e-02   -1.195068270352268e-01; +1.404451794715873e-01   -3.011576261088638e-01   +1.186949789104894e-01   +1.959873913284486e-01   +2.120038494784753e-01   -7.200080232200820e-02   -1.098368797237950e-01   +2.474164692311950e-01   +2.075957427656310e-01   -1.407293499630514e-01   -2.976082027063819e-01   -5.691262209284521e-02; -1.681782770473040e-02   -1.239726198347314e-01   +4.311519178708437e-01   -1.841060494732390e-01   +4.842018787404286e-02   -2.669428347077599e-01   +2.332736689518530e-01   -1.956740097614764e-01   -9.800721177299554e-02   -3.416971513015372e-01   -9.105678548738011e-02   -1.181516595872836e-01; +3.313697492163570e-01   -4.602524418689140e-03   +1.398276270771329e-01   +2.260817159051347e-03   +7.047659713158864e-02   +1.596060606746012e-01   +2.789231965487481e-01   +2.914825729168881e-01   +8.685270204841622e-02   +5.222816710416129e-02   -1.551953231063754e-01   +1.933261409002556e-01; -2.892226160715966e-02   -2.915747292556523e-01   -7.167753392320216e-02   +1.141013620479367e-01   +3.907976381005691e-02   +3.942464002402540e-01   -2.060230108880393e-01   +9.252047641242489e-04   -1.262431997214040e-01   +1.707775152763381e-01   +5.435732601151614e-02   +4.500108071794985e-02; -1.190494914988714e-01   +3.186792833055458e-01   +3.393846885772133e-01   +2.331137044517891e-01   -1.963613877500084e-01   -4.399551847011329e-01   -3.214100863338136e-01   -4.494380975223473e-02   -8.694189736895774e-02   -1.837094895133240e-01   -1.233734078377925e-01   +2.810754770244973e-01];
L3E_L3I_iGABA_netcon = [+2.017699934325852e-01   -2.521269409524375e-01   -2.487401880273838e-01   +1.056342138813459e-01   -1.600122535566323e-02   -2.624125826057399e-01   +2.149847780337381e-01   +2.972009273241339e-01   -4.180807205593507e-02   +1.342510632320933e-01   +4.335688309591660e-01   -2.031786489562062e-01; +7.316669325178830e-02   -2.329163222607787e-01   +1.327982877497420e-01   +2.629892333410885e-01   +2.672704168988044e-03   -6.323067091149576e-02   +1.932763358688373e-01   -3.314143829779780e-01   -1.313675361461962e-01   +1.739622891866388e-01   -2.075651128404163e-01   -2.689239850118763e-01; -4.068072517530696e-02   -1.292968687690492e-01   -3.064516651513657e-01   +2.668756002798969e-01   +6.508393673948909e-02   -3.943263502754120e-01   -2.575973026244929e-01   +3.109847191633732e-01   +2.356710161113244e-02   +1.616768759922262e-01   -1.768952757254308e-01   -6.067803738001095e-01; +9.030637314555376e-02   -3.519800748529610e-01   -1.312154050884126e-01   -2.509831433500295e-01   -3.465682165074416e-01   +1.731836184261882e-01   +9.094953582852301e-02   -5.181258517176830e-01   -1.225751159341549e-01   +1.952111328490412e-01   +2.075163744403294e-01   -1.140911826358060e-01; +3.352896668833610e-01   +1.236052751609754e-01   -5.510908291434307e-01   +7.739335481952858e-02   -1.668517394999365e-01   +3.439157661255335e-01   +1.595406113478441e-01   -3.414781869010752e-01   +1.068989521275185e-01   -3.533284589281083e-01   -1.046425524088418e-01   -9.140087931749297e-02; +1.686100115737295e-01   +4.912610553856017e-02   -1.273187309550352e-01   +3.240820339646176e-01   +3.677301314555900e-02   -2.466766573119070e-02   -1.866194653993477e-01   -2.471009835048140e-01   +1.085808008367881e-02   -1.701302305799708e-01   +3.652453775533561e-01   +3.525432184070039e-01; +1.204554897563088e-01   -1.521471461463936e-01   +2.669623936576700e-01   -9.885722485197278e-02   -2.975509296464475e-02   +2.965004194472521e-01   +1.965201798502950e-01   -2.875248910224014e-01   -5.431615881961618e-01   +6.033223771328953e-01   -2.200149632290779e-01   +1.141386885790747e-02; -1.051767868321945e-01   +2.000280494578679e-01   +1.149588272647911e-01   -2.555346933246477e-01   -3.521648631769765e-01   -5.551803442220917e-02   -1.935336568199214e-01   -8.404453870426842e-02   +1.511759886151210e-01   -3.763457107506579e-01   -3.152192105263781e-02   -3.638818829144130e-01; -1.794709729620794e-01   -8.545224573064614e-03   +1.357832000389927e-03   -2.074247940739908e-02   +3.708900844976504e-02   -3.896167588484725e-02   +1.644535283154279e-01   +1.756330319271786e-01   -3.484698398870053e-02   +6.771494043371167e-02   -5.919268686588563e-02   -2.386438746130016e-01; -8.024151550205211e-02   +1.041823541126937e-01   +2.631078152540669e-01   +2.850775001904436e-01   +3.691766575802746e-01   -3.456649980362191e-01   -2.379151530290625e-01   +2.492635477474407e-01   -2.381288305032216e-01   -8.557874764919936e-02   +2.001815852505776e-01   +3.942816439275594e-01; -1.203745083320321e-01   +9.687594844199068e-02   +1.507922092243567e-01   -3.024969883721333e-01   -3.424202449673400e-01   -1.399557954957374e-02   +1.074969713041267e-02   +8.419937570951708e-02   +1.112156794923156e-01   +1.218437033360846e-02   +1.080533251053600e-02   +3.390690781623307e-01; -2.229252959857155e-01   +2.569497397436353e-01   -6.344029926746675e-02   +1.993178165336368e-03   +5.287504251139673e-02   +3.030977621563901e-01   -1.597058520032147e-01   -2.714698856040237e-01   +1.970315845387032e-01   -1.937012095134079e-01   +5.910822678996210e-01   +7.287578677874847e-02];
L2E_Input1_iAMPA_netcon = [+3.471319605368328e-01   -1.678892632741045e-02   -2.515798483136956e-01   -9.558206061472665e-02   -1.114246509905640e-01   -1.044431066768081e-01   +2.410798650951824e-02   -7.409812586480288e-02];
L2I_Input2_iAMPA_netcon = [+1.558517694274937e-01   -3.526430132690712e-01   +1.918321072760525e-01   -5.143673415271736e-02   +2.634779459766765e-01   +2.246215418571609e-01   +1.191196766656867e-01   +1.124425956580644e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
