function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.016450831144092e-03   +1.545667121484474e-02   +2.281768352852472e-02   +2.147425208141316e-02   +2.055053744532591e-02   +3.293339940254914e-02   +8.956428485043171e-03   +5.052505685473988e-03   +3.759494384282642e-03   +1.149666655671042e-02   +1.467874624674058e-02   +9.572660594478375e-03   +1.953928689683162e-02   +2.711736980653586e-02   +1.730413657572253e-02   -2.256167436971749e-03; +1.364554921696580e-02   -1.826848088458602e-03   +1.839683117693384e-02   +2.197893954590664e-02   +7.638702938162104e-03   +6.182617534797498e-03   +3.157290984023047e-02   +2.755638486760959e-02   +2.325629099599469e-02   +1.333508314581571e-02   +3.349790005741827e-02   +8.710500432392593e-03   -6.077942689011846e-04   -5.749633385246926e-03   +1.196478698890088e-02   +2.330924603994000e-03; +1.403857715066005e-02   +1.995323667380035e-02   +2.382218817765811e-02   +1.641335077180734e-02   -2.921602799648545e-03   +2.951158167611627e-02   +2.618461428459252e-02   +1.475004697993233e-02   +1.267726482092645e-02   +5.877395860386474e-03   +1.504671550257015e-02   +7.296067355380357e-03   +2.818521141449119e-03   +9.516923814691840e-03   +2.419270897934796e-02   +1.605258476836053e-02; -3.579804929536957e-03   -3.743644454381737e-03   +9.370525356642182e-03   +2.300733510365258e-02   +3.170970197972774e-03   +1.891686023163862e-02   +1.953143169688164e-02   +2.468929080022573e-02   +1.378401790112456e-02   +7.524900842113184e-03   +3.172232647656077e-02   +2.163686306024252e-02   +1.175860317406356e-02   +3.078296738578455e-02   +1.232823479642862e-02   +8.147343430886874e-03; +1.667589635928941e-02   +1.658467241935976e-02   +1.875574520065757e-02   +1.964056330566882e-02   +1.551169536652588e-02   +3.144797003505503e-02   +9.559020728422626e-03   +6.861234296814955e-03   +2.271198565087137e-02   +3.339166218824138e-02   +1.865520982417891e-02   +2.205615922254165e-02   +6.981254262426023e-03   +4.586617940096162e-03   +3.346088189426170e-02   +2.289877084986445e-03; +1.354431820530833e-02   +2.280106137756921e-03   +2.366865888318375e-02   +5.921279511794319e-03   +1.698371277282382e-02   +1.391553896920762e-02   +1.447268690998906e-02   +7.748219950543336e-03   +1.646802795654992e-02   +2.001988359533990e-02   +2.628607101060762e-02   +1.265699764962408e-02   +1.434961939749047e-02   +7.933103362864489e-03   +1.375856480701673e-02   +2.189144490720073e-02; +7.697639587351558e-03   +1.818979018373421e-02   +2.798070891662918e-02   +2.260608018964893e-02   +1.950917304380412e-02   +1.596315599579478e-02   +7.267153718940494e-03   +2.990425522677979e-02   +3.141517984368969e-02   +5.292902968140761e-03   -2.175072591215656e-03   +7.314527789142723e-03   +1.210891635174749e-02   +2.784902508986834e-02   -9.999584109741519e-04   +3.552315504623868e-03; +1.976825714720608e-02   +1.074754649644975e-02   +2.616711582325228e-02   +2.368163151995254e-02   +1.697203609102312e-02   -1.511528184313009e-03   +3.687561004954589e-03   +1.598354460454627e-02   +2.514618975542939e-02   +2.427492855747711e-02   +8.573920838497690e-03   +1.694467150006642e-02   +8.842530627873001e-03   +5.280651426721057e-03   +2.482619104270947e-02   +2.151662463219606e-02; +6.275564431033723e-03   +2.506076307056212e-02   +1.738982770029245e-02   +1.874322881867469e-02   +3.948679823344788e-03   +2.608004137899215e-02   +1.103839413618253e-02   +1.564934659881589e-02   +1.259649566414402e-02   +1.584260565834628e-02   +1.172909094298989e-02   +2.792135705255065e-02   +2.438147455308707e-03   +2.646669444884787e-02   +6.426930645286730e-03   +7.557614792884934e-03; +1.255176824014935e-02   +5.715102595015603e-03   +2.682313673236883e-02   +2.037381791134140e-02   +1.556731708871755e-02   +7.115714139113064e-03   +3.626900222892471e-03   +1.958418662433965e-03   +1.865902291547309e-02   +1.137027068803311e-02   +7.171762614960236e-03   +1.861291588659244e-02   +3.008378039648936e-02   +1.724996712266511e-02   +3.249739344462169e-02   +1.954068497985173e-02; +8.225442461782105e-03   +9.823752785741704e-03   +2.018618306465773e-02   +2.372453779027795e-02   +2.040245503836344e-02   +7.205831435957123e-03   +2.034814911875763e-02   +2.436826787583088e-02   +7.524872076949126e-03   +6.417820683882129e-03   +2.062322783148378e-02   +2.630125604815936e-02   +3.015614744216424e-03   +1.393813677567544e-02   +2.574556293700401e-02   +1.427220328715295e-02; +1.985474670145993e-02   +8.209429171931236e-03   +9.713882437278483e-04   -7.253705576709203e-04   +2.322773316920671e-02   +3.121892346650359e-02   +2.806900054601707e-03   +2.154942209262324e-02   +2.036277159064945e-02   +9.746588483842345e-03   +2.683508116962858e-04   -3.627656857568193e-03   +2.893305081065301e-02   +3.025213084575855e-03   +2.141383260917017e-02   +1.440926056460602e-02; +2.476511702592046e-02   +1.904961361194159e-02   +1.955048897188719e-02   +5.268246458667312e-03   +2.344749313684518e-02   +1.280451847648962e-02   +2.198584848144008e-02   +2.250472417580583e-02   +2.749874426575641e-02   +1.061259595078977e-02   +8.490796453340449e-03   +3.147844195061051e-02   +1.831877531946135e-02   +1.904421104336272e-02   +1.654345115963199e-02   +2.606063395166495e-02; +2.721374382135393e-02   +2.263571680582195e-02   +1.138378925995021e-02   +1.666765142729402e-02   +4.080968513747804e-03   +6.275557118351907e-03   +4.726562065022232e-03   +3.209799359805887e-03   +1.824155145549705e-03   +2.645673531715864e-02   +6.515227846328614e-03   +3.186589945349910e-02   +2.200229855436684e-02   +1.678450102403891e-02   +1.004921450122346e-02   +1.520865276785710e-02; +1.929906995446952e-03   +1.997683982756209e-02   +2.999008571797694e-02   +1.517103204292991e-02   +1.613389891493699e-02   +9.722072927722382e-03   +9.123463135577452e-03   +1.806027533090022e-02   +5.105531656991739e-03   +2.691903799341432e-02   +1.735691251395225e-02   +3.208681277139665e-03   +2.589717041881093e-03   +2.842395405033929e-02   -4.313300567872262e-03   +1.819623005218866e-02; +2.954901941330081e-02   +6.578681377405585e-03   +5.638352708931386e-03   +3.399565052714062e-02   -3.973416142475897e-04   +6.080197251901474e-03   +2.339720855288477e-02   +5.776747212738373e-04   +1.050472520042811e-02   +2.663894169210135e-02   +2.360978658843037e-02   +2.893377304665978e-03   +2.542596222503484e-02   +2.202114668974568e-02   +2.700717999486262e-02   +2.817982163049652e-02];
L1E_L1I_iGABA_netcon = [+1.154188485296841e-02   +2.320822507221582e-02   -1.640903400046459e-03   +1.225900267124592e-02   +2.401699285119239e-02   +1.292258825638950e-02   +1.633399923989091e-02   +9.285596852727828e-03   +2.447011704688760e-03   +7.197253996059515e-03   +5.480647490515758e-03   +1.467940942807000e-02   +1.132961711655116e-02   +2.612122495377490e-02   +2.935239252723434e-03   +1.054136859169367e-02; +4.223365208462854e-03   +2.331707886941804e-02   +1.269069121539842e-02   +2.654650456588002e-02   +1.441489957150887e-02   +1.590171266033207e-02   +3.455099448065969e-03   +1.812047359854572e-02   +1.783968306743732e-02   +3.757708231806830e-03   +3.635763330580886e-03   +2.447092470052191e-02   +9.449794567244624e-03   +1.574829189335325e-02   +1.398012051086900e-02   +2.959233623066295e-02; +1.371904503234191e-02   +3.702760048534540e-02   +2.880590728638251e-02   +2.083518426746002e-02   +3.470014355024546e-03   +1.648871367263543e-02   +2.419743394496931e-02   +2.254497238028090e-02   +3.004327002474090e-02   +2.615260101244637e-02   +2.064322503837216e-02   +1.555961276615558e-02   +2.968813526907512e-02   +2.486871560537334e-02   +1.168900079797485e-02   +2.142151682894202e-02; +2.270377240850748e-03   +9.194059041924670e-03   +2.772962004959465e-02   +6.543861812609483e-03   -3.668645366765608e-03   +1.878147066804909e-02   +2.417505470324887e-02   +1.361164257109171e-02   +1.430025705297083e-02   +2.732940124842263e-02   +1.673650641818512e-02   +4.711632912113041e-03   +1.518875726298048e-02   +1.052400642406263e-02   +3.843299982098212e-03   +2.787229165489340e-02; +1.630397465593129e-03   +2.887500951107701e-02   +1.315326249039119e-02   +4.782581754370916e-03   +1.961152625965314e-02   +2.225039902091644e-02   +1.841150188094434e-02   +1.439281220726869e-02   +5.201940790907506e-03   +7.093715644024226e-03   +2.876853367994289e-02   +2.625605974892968e-03   +2.194974985356171e-02   +1.213919253745276e-02   +1.644472413584789e-02   +8.903143196358380e-03; +2.308299799792280e-02   +2.243792870601096e-02   +2.902987384427774e-03   +1.988426961936817e-02   +7.208025299281895e-03   -2.325900006669755e-03   +2.423066838335659e-02   +6.982797653588948e-03   +2.479019182231679e-02   +2.389258050440824e-03   +1.897735894388160e-02   +4.971259753954459e-03   +1.233255409906508e-02   +1.470808804441332e-03   +2.346844128269358e-02   +2.557238001674695e-03; +1.729071389577968e-02   +9.037370441275958e-03   +3.359805879558480e-03   +1.140612571415902e-02   +6.923599106423478e-03   +1.488864947992852e-02   +9.180158833907218e-03   +1.344618766965797e-02   +2.916297354473122e-02   +8.522816689433541e-03   +2.709007205187858e-02   +3.092669112243736e-02   +3.937591582992305e-02   +2.032262590367741e-02   +1.501699887206141e-02   +8.543748631143301e-03; +6.184737203113310e-03   +5.438790533766614e-03   +8.801871668342115e-04   +3.178231530623188e-03   +1.828826935134158e-02   +1.490140069659903e-02   +1.275754762821795e-02   +1.578267245792200e-02   +5.075875901789632e-03   +1.237669024894608e-02   +2.230031195535570e-02   +3.930716294680066e-02   +1.160826090276329e-02   +1.718411854067569e-02   +2.989889517978236e-03   +2.532089323796904e-02; +7.378262211147662e-03   +1.269775258422907e-02   +7.606010152880648e-03   -2.928718503366413e-03   +1.148199742197518e-02   +2.147888659517484e-02   +3.251154870723133e-02   +2.955395608931801e-02   +9.312866204498747e-03   +3.967844171304648e-03   +2.470554966290466e-02   +9.575571701059660e-03   +2.752435830502332e-02   +3.153045558099755e-02   +1.339910246018456e-02   +6.857152454036187e-03; +5.052650746873067e-03   +1.050909999861322e-02   +1.606821874060419e-03   +2.196240546670472e-02   +7.928031512339699e-03   +2.554393115476083e-02   +1.500345740236747e-02   +4.029580542183158e-03   +2.975443638122960e-02   +2.449714347850732e-02   +2.116299403324866e-03   +2.189515374191525e-02   +3.044459552288236e-02   +1.367239056381459e-02   +1.445153553403369e-02   +8.825263236023978e-03; +2.863630201456840e-02   +3.834635665552148e-03   +9.717910289885636e-03   +1.518545221780313e-02   +2.012882272219497e-02   +1.448917894015355e-02   +1.924205257484714e-02   +2.971358695203987e-02   +1.431155149126346e-02   +1.102468456596584e-02   +2.238321412608620e-02   +1.883109737026308e-02   +8.460683845888085e-03   +3.202231716943819e-02   +2.393029426282733e-02   +6.990580397547693e-03; +1.170529555487381e-02   +2.899677487232852e-02   +1.627664456956699e-02   +2.744196448406694e-02   +3.322878391537154e-02   +1.851113099173879e-02   +1.780442427957429e-02   +2.569276593967661e-03   +2.092620914983382e-02   +1.276923205509463e-02   +4.003553534428683e-04   +2.479356807577337e-02   +1.726713050747308e-02   +2.376719525670144e-02   +1.987126197822241e-02   +7.885083255886981e-03; +2.512126833958644e-02   +2.595903059829810e-03   +1.599255059246099e-02   +2.869757854001198e-03   +1.170686172892591e-02   +1.743649102226429e-02   +1.342446036337951e-02   +6.936906625879796e-03   +2.301201984037892e-02   +2.805998458350081e-02   +1.136998078979118e-02   +2.292019420591465e-02   +3.707471745743794e-02   +2.253079623433795e-02   +8.074183508821126e-03   +3.622459802497020e-03; +1.276080419488568e-02   +2.058558620725650e-03   +1.112023284408844e-03   -1.829761836332957e-03   +1.707576197004372e-03   +2.435170123261243e-02   +3.382685563564659e-02   +2.427059570762383e-02   +1.085345794242407e-02   +1.679435703930215e-02   +2.220422804243216e-02   +1.923360169220796e-02   +1.880170323409464e-02   +2.912821233090786e-02   +2.504825085367900e-02   +2.355437679740304e-02; +1.868970872153487e-02   +5.577105447379351e-03   +1.315061336948398e-02   +2.501707636621500e-02   +1.732372347853742e-02   +1.077997095340011e-02   +3.399569440180188e-03   +1.158541161062888e-02   +3.732357789855951e-03   +2.232597178814711e-02   +8.976852511930583e-03   +1.717227422346560e-02   +6.503969720048626e-03   +5.605283970558208e-04   +5.020386084436361e-03   +1.320066787001649e-02; +1.618655699502373e-02   +5.474632796843171e-03   +1.084966429512120e-02   +2.931236471481998e-02   +2.934843092785211e-02   +7.863040591140961e-03   +9.532009061643859e-03   +2.825538673006733e-02   +2.451562970962153e-02   +2.444219706890444e-03   -2.162553377741231e-03   +1.499419961169615e-02   +2.593430596544582e-02   +2.029665666773259e-02   +1.148423509793961e-02   +1.885873899980246e-02];
L2I_L1I_iGABA_netcon = [+3.578603788979638e-02   +8.040404405843792e-03   +5.495800867138689e-03   +3.083545475322195e-02   +3.280982678372928e-02   +2.510097516786192e-02   +9.702690164580013e-03   +2.707910154747547e-02; +2.432664264785537e-02   +2.637234075312918e-02   +1.616736160441732e-02   +1.365522702736883e-02   +1.598761225692944e-02   +2.494694762191828e-02   +2.282090268664600e-02   +5.122164579325211e-03; +6.327375193269401e-03   +1.005463983621398e-02   +4.171394162807203e-03   +5.542512541791338e-03   +2.958082363188455e-02   +3.112380427128114e-02   +8.948064207622234e-03   +2.070523167719237e-02; +4.706170358552622e-03   +2.910914548869973e-02   +2.062596976840170e-02   +1.913210647040416e-02   +1.962375499057309e-02   +1.749260835207597e-02   +1.480233573486220e-02   +3.142399499592370e-02; +9.504001017428963e-03   +8.104523253757621e-03   +2.461952763014836e-02   +1.818829791796921e-02   +1.058457121539356e-02   +2.747271270826536e-02   +1.396896324534200e-02   +2.573842573876982e-02; +2.612857043356822e-02   +2.166258483353882e-02   +2.598275719958288e-02   +1.741986419554283e-02   +1.354878733257137e-02   +2.007411720597340e-02   -1.603410268959427e-03   +2.183864342782569e-02; -6.010563506874346e-04   +1.346382137562517e-02   +1.274954480966206e-02   +1.511702637796998e-02   +2.156029947906126e-02   +8.877935745682193e-03   +9.209068479166849e-03   +2.575591619998767e-02; +1.497318361859773e-02   +1.081549008439528e-02   +2.621067152089753e-02   +1.168814051460490e-02   +7.288442600765771e-03   +2.341989956999919e-02   +1.690411749080431e-02   +5.283953959947850e-03; +1.617257208053382e-02   +1.505093576456664e-02   +1.297370586935552e-02   +1.110070626832988e-02   +8.798319703793035e-03   +5.272472077782992e-03   +1.439547319718626e-02   +3.013552738982462e-02; +1.135558251081462e-02   +1.643936915382077e-02   -3.500968996402060e-03   +1.548880780837738e-02   +5.673827604780283e-03   +2.219397530354970e-02   +3.039495056108959e-02   +1.694266304538231e-02; +7.036830297739835e-03   +2.729545151223722e-02   +2.875694421696708e-02   +9.066078056166188e-03   +2.362636355118057e-02   +2.739905209729479e-02   +2.963847737727444e-03   +9.754304066456283e-03; +2.544512876878917e-02   +1.315299746747592e-02   +1.914466067282129e-02   +1.021730728811445e-02   +2.922900701081431e-02   +5.298864367080080e-03   +2.087765542975008e-02   +5.796210206547499e-03; +5.764374621013599e-03   +2.986975530884736e-02   +2.882010783263667e-02   +4.051085177651587e-03   +1.825602167248276e-02   +7.660090198757257e-03   +1.124793788480388e-02   +2.077041620714974e-02; +2.981348782331129e-02   +3.803495741909770e-03   +3.486699271451776e-02   +1.862246377296742e-02   +2.724202869209004e-02   +5.638428933815910e-03   +2.822817383047378e-02   +7.729237494349860e-03; +3.013528604877184e-02   +1.211760953879944e-02   +5.816950370334785e-03   +3.288522961254161e-02   +2.228729768705630e-02   +5.405678873185464e-04   +1.466943230289894e-02   +2.196091699001902e-02; +3.356827150628930e-03   +2.175597072621912e-02   +1.974846172349857e-02   +1.932611355775586e-02   +2.830241846939183e-02   -1.142408630390412e-03   +2.592848558985976e-02   +1.091237171635823e-02];
L1I_L2I_iGABA_netcon = [+2.220783386356786e-02   +1.874759549234097e-02   +5.827605146682698e-03   +5.598311887465157e-03   +1.692777638938249e-02   +1.454252511085896e-02   +2.865030640310202e-02   +2.179732584891149e-02   +1.374187534147052e-02   +2.759866964275992e-02   +1.698841513755236e-03   +4.837762201708287e-03   +5.372781877614859e-03   +2.922055266337804e-03   +8.209936463474510e-03   +3.136721117284651e-02; +2.825128006897073e-02   +1.758475198405694e-02   +1.435903487038633e-02   +1.111948221467978e-02   +2.424443094320975e-02   +1.827248333109571e-02   +1.102406520439429e-02   +3.047441294755096e-02   +1.563002323994565e-02   +3.462855659025797e-02   +1.771690565878169e-02   +8.607298958660574e-03   +1.677652661762494e-02   +4.571478481099416e-03   +8.113137449908259e-03   +2.943686715815569e-02; +2.171072588224532e-02   +2.107148250073416e-02   +2.631769615786258e-03   +2.351689728236605e-02   +1.602785114497294e-02   +2.712523619884410e-02   +2.292491674855522e-02   +2.240680303431070e-02   +1.347416989930611e-02   +1.808002215771434e-02   +1.743674194951693e-02   +1.260957713717691e-02   +1.500614610190665e-02   +4.773872683989116e-03   +2.245083103229648e-02   +4.994310768435209e-03; +1.399491595344264e-02   -2.142981871106468e-03   +2.177451466137961e-02   +3.105049822270142e-02   +4.515193384560453e-03   +2.730801286693002e-03   +1.585846070703581e-02   +1.057986341924043e-02   +6.885920926328795e-03   +2.142201691883792e-02   +1.498309794384504e-02   +1.062835556708066e-02   +9.427888925353962e-03   +1.676338687541427e-03   +2.270738826938052e-02   +1.851076132780986e-02; +4.125236119477085e-03   +3.023787285559582e-02   +2.621724680017972e-02   +2.376943286111219e-02   +2.456686294027398e-02   +1.846527780187538e-02   +1.859261288063440e-02   +3.068206730564077e-02   +1.139913697840014e-02   +5.335995755323610e-03   +1.131140190422405e-02   -1.085394865873413e-03   +6.759968388243987e-03   +3.202884364993158e-02   +1.006968194807597e-02   +2.080878672238140e-02; +1.983069906380748e-02   +1.854054382256010e-02   +3.070782113206208e-03   +3.114880517164760e-02   +1.392021440372433e-02   +2.781302135583879e-02   +2.363210217088365e-02   +2.940186271923346e-02   +2.436066427908930e-02   +1.550894495924910e-02   +2.342954231247884e-02   +1.822932458976302e-02   +5.042413485717523e-03   +3.007197698648711e-02   +2.406513766327112e-02   +2.724283111424130e-02; +2.738672550320291e-02   +8.996015607376522e-03   +2.385200608113099e-02   +3.010447556292924e-02   +1.602281227390377e-02   +3.568020269970144e-02   +1.796337960870649e-02   +1.505849321196356e-02   -4.856649834000188e-03   +2.175595307730361e-02   +1.609284013665536e-02   +9.049291368735045e-03   +2.674860755975671e-02   +9.080229417461533e-03   +3.011898020829436e-02   +1.541490527885674e-02; +2.599725582414415e-02   -1.234441046068236e-03   +2.543032323726670e-02   +2.429381520612622e-02   +6.495885229170894e-05   +2.509567050062658e-02   +2.198953913278792e-02   +2.612370192256655e-02   +1.280988461408430e-02   +2.481966822074807e-02   +7.413561419879001e-03   +1.574712615139920e-02   +1.445638168339455e-02   -1.358513758900476e-03   +2.685283269717392e-02   +1.531648419778468e-03];
L2E_L1E_iAMPA_netcon = [+2.301327887281448e-02   +7.001377072276887e-03   +3.464609947186974e-03   +3.532600915338370e-02   -1.478208721878760e-03   +9.798616686703355e-03   +2.139524756194751e-02   +6.496166699722066e-03; +2.360646563887535e-02   +2.951264891410862e-02   +1.920250058579112e-02   +7.613153486420506e-03   +2.024578967238904e-02   +1.189106743916329e-02   +3.281509389434394e-02   +1.379553806379729e-02; -6.256773001665833e-03   +5.294939664527000e-03   +2.159736127139936e-03   +1.109691554625425e-02   +1.822535204682753e-02   +3.396166632705119e-02   +1.240053429828742e-02   +9.713630207196748e-03; +9.808680047516468e-03   +2.566729544330685e-02   +8.142034293672095e-03   +2.359659343680444e-02   +2.830930307645991e-02   +1.012658105737393e-02   +2.600050552268788e-02   +3.325046935966761e-02; +5.731395758197705e-03   +3.334407792406046e-02   +3.691076642851096e-03   -6.893867606709569e-03   +2.672750721094571e-02   +3.158619274801689e-02   +2.505552593563115e-02   +1.368514087016745e-02; +1.920922308630098e-02   +1.104914380487164e-02   +2.936878686873310e-02   +2.557190143458490e-02   +1.948796205522949e-02   +7.478751603347668e-03   +1.572932338152861e-02   +2.078702214866397e-02; +4.968121437053033e-03   +1.134910944186015e-02   +5.873916355630296e-03   +1.480955237949897e-02   +2.740126451474364e-02   +1.368835863551227e-02   +2.499773296760434e-03   +1.217629214639698e-02; +3.902186978509461e-03   +6.304744818089367e-04   +1.576400838782320e-02   +2.044627406180588e-02   +9.415123314357265e-03   +3.479761472678507e-02   +2.402428008983662e-02   +2.450649888912994e-02; +8.076678491130421e-03   +2.542583412194318e-02   +4.802053395753849e-03   +5.186681489584405e-03   +3.040613267598690e-03   +3.526778023400302e-02   +1.254467559626687e-02   +4.746807770575984e-03; +1.003336350642425e-02   +2.286041400861132e-03   +3.182351292214947e-02   +1.404024440220618e-02   +3.468946328287241e-02   +3.693767034107037e-03   +1.082545354265483e-02   +2.116892255414795e-02; +2.204104304694639e-02   +1.028544705779695e-02   -2.498486693916624e-03   +2.019562087491009e-02   +1.583181482241987e-02   +7.928234590133391e-03   +2.395594900301999e-02   +2.568105710309524e-02; +9.456742130522031e-03   +9.769021004832306e-03   +2.421710943104692e-02   +1.745144232236540e-02   +1.592397519125463e-02   +7.547774944528914e-03   +2.891414994050810e-02   -2.594701953620540e-05; +1.321168745316179e-02   +2.159555584674398e-02   -9.680186170601020e-04   +6.765474713536277e-03   +2.871941629618855e-02   +1.561316661377862e-02   +1.635079773932315e-02   +2.652629859462647e-02; +1.006432850529460e-02   +4.916158062825748e-03   +2.817122404142053e-03   +3.032266256073101e-02   +5.375297820429598e-03   +4.405309140171899e-03   +5.616666031855698e-03   +2.979361900549329e-02; +1.022890256607381e-02   +1.022838960045741e-02   +2.442193668816731e-03   +3.219649266842275e-02   +4.786193097965453e-03   +6.129233789998838e-03   +1.544170243491108e-02   +1.329140922990543e-03; +8.343195953991698e-03   +1.806404200588743e-02   +6.587173022596974e-04   +1.439928892234596e-02   +2.147159534289231e-03   +1.919990971722028e-02   +3.966179706324281e-03   +2.778584823669333e-02];
L1E_L2E_iAMPA_netcon = [-1.240318170016908e-04   +6.220811684824132e-03   +2.760001682072149e-02   +2.425873607770627e-02   +1.324324450664288e-02   +2.802329717982609e-02   +1.698069067130104e-02   +3.300718659101406e-02   +6.226901158545538e-03   +1.454990176552667e-02   +1.790088739808793e-02   +1.699026080275844e-02   +1.157305009014728e-02   +2.256821083843353e-02   +2.459691452407437e-02   +2.146758909967288e-02; +8.313190175572301e-03   +2.493562047613639e-02   -2.663255731619225e-03   +8.121065053704720e-03   +5.301433460301948e-03   +2.159434681630160e-02   +1.216039875883822e-05   +5.921884167019179e-03   +3.548185170909433e-03   +1.075581137823328e-02   +1.252357618153866e-02   +2.795700661003299e-02   +8.384775069187104e-04   +5.265238857123435e-03   +1.780557715275693e-02   +1.264559494076037e-02; +9.406611187179753e-03   +1.882536980967470e-02   +2.622018340539534e-02   +2.729812819906406e-02   +3.280488333802135e-02   +8.731182738655956e-03   +1.582190548006112e-02   -1.402061721629310e-03   +1.259245052307989e-02   +1.809053093064839e-02   +1.100812748127427e-02   +4.153404042910191e-03   +1.674453329048717e-02   +1.517618997673252e-02   +3.105202666916500e-02   -4.070010156448447e-03; +1.817962813513392e-02   -4.749478830684567e-03   +2.753177376057955e-03   +4.599504488799755e-03   +2.454851454852365e-02   +1.395181988757973e-02   +2.903932369059068e-02   +3.397681901626046e-02   +2.483486989998357e-02   +2.432030194134631e-02   +9.677190598483702e-03   +1.372976331312369e-02   +3.105159464146994e-02   +7.322698321931958e-03   +3.071216869269709e-02   +2.782828956881176e-02; +4.067645063147602e-03   +3.638763401189080e-02   +1.842433745672415e-02   -5.902724867711047e-03   +6.054580359681356e-03   +2.053179825279242e-02   +2.479590367637000e-02   +2.870040384362600e-03   +2.319653323589040e-02   +1.097448138479305e-02   +1.152351785269661e-02   +2.562920366765738e-02   +6.864268710130797e-03   +1.646779978354501e-02   +3.065593881432819e-02   +4.404642650419341e-03; -2.479925142007507e-03   +2.560593656615044e-02   +7.625839477324594e-03   +3.164708468939386e-02   +2.677951854947646e-02   +2.605233570792784e-02   +9.478368193041087e-03   +2.319592791195718e-02   +1.608289407868238e-02   +1.007769051185399e-02   +2.249238466131863e-02   +3.068330490257974e-02   +2.859496080532579e-02   +1.837679918239079e-02   +4.319045248403330e-03   +1.999916959313112e-02; +7.578120524121139e-03   +3.537349366409578e-03   +2.438544557448572e-02   +5.555627196885279e-03   +1.130627823042864e-02   +1.841577439867876e-02   +1.768059877605917e-02   +2.287649117202400e-02   +1.788691737731442e-02   +2.560160947587735e-02   +2.094499992515552e-02   +1.641001865897206e-04   +1.250979572832639e-02   +1.897573375043829e-02   +6.840167282285493e-03   +1.200607121887296e-02; +3.509482257098235e-04   +1.378307627275972e-02   +1.395372877172410e-02   +1.276616736846625e-02   +1.822402502459677e-02   +2.836579625881797e-02   +2.297465921494785e-02   +1.807465688171419e-02   +2.772035278481256e-02   +1.209192187101915e-02   +1.070007989452528e-02   +3.141205754719668e-02   +2.277006435220627e-02   +2.272649898794017e-02   +1.046049796347001e-02   +3.721170414571144e-03];
L2I_L2E_iAMPA_netcon = [+1.644293660335829e-02   +1.095433326693839e-02   +2.444964631352367e-02   +2.042464550409835e-02   +2.960048807516573e-02   +7.258331886283106e-03   -6.368027001309012e-04   +2.386757189014421e-02; +5.372235545129124e-03   -1.365362503559456e-04   +8.142370703677690e-03   +2.431447153907604e-02   +2.556768491896622e-02   +1.304099895973599e-02   +2.500114558618965e-02   +1.973385836204998e-02; +2.442717775094952e-02   +2.744530209999140e-02   +2.272593714135055e-02   +2.240622027503907e-02   +1.997743167745227e-02   +1.256423755930352e-02   +1.420035398567267e-02   +2.324494569478747e-02; +1.126880700741055e-02   +8.758823721235549e-03   +3.114648973633668e-02   +1.334607226760247e-02   +3.280579956530263e-02   +6.113743885287448e-04   +4.519781598490129e-03   +2.829627227479710e-02; +1.676940171125606e-02   +2.555985107700548e-02   +8.812532451110586e-03   +1.907570974964430e-02   +2.715984753847393e-02   +1.852729493103885e-02   +1.352816650157006e-02   +2.390849898275292e-02; +2.252339025117156e-02   +1.823195893581960e-03   +2.800685906345790e-02   +2.384549816909845e-02   +1.448564905573518e-02   +8.412191979356984e-03   +7.917238779317692e-04   +2.706951508825516e-02; +3.214243917280674e-02   +9.819046601357526e-03   -4.536002285261418e-03   +1.508083855257047e-03   +5.487386622400117e-03   +9.205930013181287e-03   +4.365910245959157e-03   +9.399507235651956e-03; +2.495229318716664e-02   +5.764352379409154e-03   +1.420754607926777e-02   +1.731624505299100e-02   +2.106222334837667e-02   +9.655268909884433e-03   +5.660339418900332e-03   +6.004944031903056e-03];
L2E_L2I_iGABA_netcon = [+2.694950956847350e-02   +8.075467554615365e-03   +1.749365748237585e-03   +7.674306048945199e-03   +3.071511316500938e-02   +1.129639415127561e-02   +2.114539710726963e-02   +3.269803666916916e-02; +6.791223302302887e-03   +1.798298358212213e-02   +7.965085906385351e-03   +5.106950870446463e-04   +3.455700200809990e-02   +2.210525836026549e-02   +2.177548959415424e-02   -2.823955884558009e-03; +1.840827642657387e-02   +8.772741324131077e-03   +1.413886732525386e-02   +4.147076403947367e-03   +8.737067489511835e-03   -5.493455423128100e-03   +3.673418567158813e-02   +2.155369136126492e-02; +2.599980608856882e-02   -2.333845611184344e-03   +1.343392646695946e-03   +2.139688836786751e-02   +2.440214918987437e-02   +2.940858266753954e-02   +1.475935696998595e-02   +1.603306238463730e-02; +7.377576862539660e-03   +1.992919996137965e-02   +5.616785293995213e-03   +2.398939965274842e-02   +1.434014101167615e-02   +1.412201765051662e-02   +3.305948840777367e-03   +5.247679863688198e-03; +2.144381878065737e-02   -7.671818932434249e-03   +1.883534852613605e-02   +2.660191412633672e-02   +2.405258054752209e-02   +1.526342205758417e-02   +3.224513047833908e-02   +2.487997105346257e-02; +3.601317622375742e-03   +3.682090479477398e-02   +8.727657190872635e-03   -4.133379504231221e-03   +2.321528896764320e-02   +5.788563907988881e-03   +1.354908494971330e-02   +1.238718912847673e-02; +2.591472138031712e-02   +1.228698457384062e-02   +1.404334690385550e-02   +1.073819970953508e-02   +1.462659076843038e-02   +2.152768511673297e-02   +2.409287661641976e-02   +2.612425543799338e-02];
L3E_L2E_iAMPA_netcon = [+1.160176032776888e-02   +2.079311225035672e-02   +4.451429466744886e-03   -4.761868736708950e-03   -3.604529099541158e-03   +2.962111300122496e-02   +1.298250904652941e-02   +2.782081728869005e-02   +3.917056626058825e-03   +7.538145293353269e-03   +1.083306690841921e-02   +6.981004704469046e-04; +1.100237375313337e-02   +2.985952530082737e-02   +1.010625121406701e-02   +1.553644394799653e-02   +2.258975577540664e-02   +1.673814464103732e-02   +2.809701264447169e-02   +2.797193669814908e-02   +2.086768990523791e-02   +2.676649444639918e-02   +1.507619714399682e-02   +7.185269227435339e-03; +2.252028650662375e-03   +2.780930972043298e-02   -1.978520206825353e-03   +2.573630561225386e-02   -2.111929470240393e-03   -1.505581015476057e-03   +1.507016663402068e-02   +2.948025401395285e-02   +1.913388725148501e-02   +1.160138350866743e-02   +7.305382892279290e-03   +1.396056382349598e-02; +1.908573235663441e-03   +1.157349078379584e-02   +2.649088192822140e-02   +1.344548322067510e-02   +6.854797834087326e-03   -1.103015919192590e-03   +7.919622176925519e-03   +7.237948293508326e-04   +2.231536748458540e-03   +1.417429695462703e-02   +8.232903704023265e-03   +1.116904316628149e-02; +2.755618227692821e-02   +7.451163109038487e-03   +1.011212351602779e-02   +2.905118695457293e-02   +2.023932452862845e-02   +1.189529735423521e-02   +2.673200656613168e-02   +4.341200023582777e-03   +2.245023603626180e-02   +1.942770975297224e-02   +2.602073046282823e-02   +1.345822718250219e-02; +2.111387493596720e-02   +1.679362119429611e-02   +2.910186382213517e-03   +1.052390176324287e-02   +1.246030124588030e-02   +3.215173164217395e-02   +3.682806446196833e-02   +9.251376673409769e-03   +1.920743488517335e-02   +2.551736974699383e-03   +2.193096437573725e-02   +2.204526141342706e-03; +2.336720445022301e-02   +1.250391158209294e-02   +1.525170038989002e-02   +9.281912115801552e-03   -5.489840986558903e-03   +1.808845154878214e-02   +1.962047175234335e-03   +1.377629267204163e-02   +1.058735048597578e-02   +8.025525451349807e-04   +2.137138977684948e-03   +1.164649300697939e-02; +2.586990844300453e-02   +2.810458602545896e-03   -1.179538619861877e-03   +1.257118067551215e-02   +1.014448594795227e-02   +1.937814864086890e-03   +3.630887218711623e-03   +1.235127181126189e-02   +1.154524124166443e-02   +2.968627782712725e-02   -1.777384377830288e-03   +2.010431472054230e-02];
L3I_L2I_iGABA_netcon = [+3.254723749110266e-02   +2.145245048951981e-02   +2.077312787645719e-02   +1.460330058480805e-02   +2.731793300510255e-02   +1.602184374605932e-02   +9.687498021252292e-04   -2.310202339529165e-03   +3.246758519369959e-02   +1.470416936650356e-02   +3.238013476369336e-03   +2.695721516772372e-02; +2.536154994533341e-02   +3.455476855475732e-02   +2.632044060478619e-02   +7.167053713342767e-03   +1.256100328599197e-02   +1.808877710557542e-02   +1.169762968829385e-03   +2.000168461184519e-03   +1.690957563713695e-02   +1.725372499218320e-02   -5.004284051424071e-04   +1.932860634997072e-02; -1.130228025307538e-03   +2.053727299118387e-02   +2.769129208323889e-02   +2.131720352084314e-03   +2.425283840144587e-02   +6.129020456094704e-05   +2.109904298158381e-02   +2.826829036354427e-02   +2.102367449594100e-02   -1.308852875597509e-03   +1.523979629508347e-02   -7.511326811542904e-04; +2.933911394716121e-02   +6.487424384009166e-04   -1.932407485244817e-03   +2.132741424586775e-02   +2.885054885231727e-02   +1.823925497157665e-02   +1.355183365136912e-04   +6.225196277387763e-03   +3.216715633647390e-02   +1.925445207223804e-02   +2.625764600532785e-02   +2.051139674746814e-02; +6.495890273986973e-03   +3.696720158097629e-02   +5.172978676481811e-03   +1.362585734433918e-02   +2.166681386398262e-02   +2.860765701454962e-02   +6.627052434536661e-03   +2.205951867020649e-04   +2.818609853526954e-02   +1.871513316552532e-02   +7.734404632956477e-04   +1.008164285379804e-02; -3.138062671779334e-04   +2.537006228038712e-02   +9.633424182615877e-03   +3.072749974103702e-03   -5.038885598904687e-04   +1.670352478088266e-02   +2.752259797554419e-02   +2.058338720559933e-03   +2.707275167727489e-03   +2.061399470234575e-02   +2.296090620932203e-02   +6.073744331905332e-03; +2.025763555202547e-02   +2.499029119751557e-02   +2.214933495723661e-02   +2.707527449614186e-02   +1.448134577117600e-02   +1.002457030612522e-02   +1.444069921189013e-02   +6.173370019437160e-03   +2.379164324802002e-02   +7.654246045182359e-03   +1.390807550812348e-02   +1.867271015213781e-02; +1.183080838107869e-02   -1.305602730763609e-03   +1.222290489082073e-02   +1.503045256628039e-02   +1.406446058293503e-02   +3.450447385560916e-03   +2.809622448208661e-03   +2.806765577493054e-03   +1.513075438269122e-02   +2.421729549394187e-02   +6.350242697710147e-03   +1.314383906478530e-02];
L2E_L3E_iAMPA_netcon = [+2.389405236644789e-02   +1.412045139079483e-02   +1.276942920559007e-02   +2.614823376992377e-02   -2.372041897664616e-03   +2.190950711127082e-02   +2.227163596087676e-02   +3.341570784486652e-02; +1.984934256994593e-02   +2.087635531562437e-02   +2.600838327468816e-02   +1.612776755112881e-02   -7.656144362318799e-04   +1.761449828725884e-02   +3.281843117151404e-02   +1.888525914451232e-02; +2.562418766147137e-02   +2.534221034602141e-02   +3.411344174072582e-02   +2.866593830971600e-02   +2.583050933396234e-02   +2.426198944665002e-02   +2.065260164639431e-02   +2.285811282985871e-02; +1.448446950952545e-02   +2.760473629717485e-02   +2.406087079947965e-02   +1.410470585842703e-02   +1.594409647352061e-02   +1.907699837622542e-02   +8.215057880067149e-03   +5.100026631137912e-03; +7.701891602197859e-04   +1.607125799459986e-02   +5.686715361471395e-03   +2.274021257530913e-03   +6.766006648302359e-03   +1.549907273533446e-02   +2.588719053530021e-02   +2.457802591859203e-02; +1.911204273735134e-02   +2.859517389297114e-02   +2.724569169286589e-02   +1.563844797271167e-02   +1.929636342306350e-02   +3.391791215155959e-02   +1.673631213137973e-02   +2.428655269406311e-02; +1.291403560261993e-02   -6.621319275604974e-04   +1.537889311891145e-02   +1.287249924440723e-03   +9.786561909408220e-03   +2.913474254949877e-02   +2.890221637369633e-03   +1.825051239282486e-02; +2.923665410511153e-02   +2.321055697363725e-02   +2.049228766960503e-02   +2.937894297160110e-02   +1.151336943371211e-02   +2.530136081029685e-02   +1.813317011089852e-02   +1.717044796037634e-02; +1.171179050836541e-02   +1.825027668490522e-02   +3.057233046914319e-02   +1.783633749790493e-02   +1.522136269604851e-02   +9.929023657565388e-03   +2.314639090611033e-02   +2.034076885278081e-02; +5.958001008623445e-03   +7.923081762664602e-03   +2.342292196653259e-02   +2.871413554937988e-02   +3.124079133606708e-02   +1.343556290722232e-03   +6.977115187568538e-04   +2.317328661940717e-02; +1.832304505251572e-02   +9.034393541205199e-03   +2.220575978655841e-02   +2.253975466495679e-02   +3.271532630835571e-02   +3.604861186792681e-02   +7.205512113995973e-03   +7.875203186301411e-03; -9.311577998178380e-04   +2.148010165652950e-02   +1.000799870969469e-02   +2.560393250654591e-02   +1.740126554397049e-02   +6.477612835158335e-03   +2.147373443474388e-02   +2.689661255588567e-02];
L2I_L3I_iGABA_netcon = [+3.110117943062918e-02   +1.246835239396326e-02   +1.052819919153773e-02   +1.623202082778233e-02   +2.636665346166518e-02   +3.014428964913110e-02   -1.895559626311989e-03   +1.463947153089337e-02; +1.714518108232265e-02   +1.117720979919371e-02   +2.427225786696686e-02   +2.355494067337904e-03   +2.723058017243429e-02   +2.500963876274529e-02   +1.824974860990023e-02   +1.299399727786038e-02; +2.037653248624275e-02   +2.200714251927709e-02   +2.464642855118999e-02   +1.892331305854485e-02   +1.531992553715448e-02   +1.500473724237959e-02   +1.139024903160850e-02   +7.597470332935302e-04; +8.064486760528013e-03   +2.700731882238191e-02   +1.295732183969876e-03   +1.190990707083433e-02   -1.778384421206580e-03   +1.259570810800670e-02   +1.457973601974395e-02   +2.785455203386158e-02; +1.099983794110159e-02   +1.287385604256353e-02   +1.823274394201752e-02   +1.193410767797575e-02   +1.053433516797251e-02   +1.619291193118565e-02   +3.954893462797093e-03   +1.052329058460308e-02; +9.023504678784696e-04   +2.531385265899314e-03   +1.255130598498171e-02   +6.020552845709860e-03   +1.294103825680584e-02   +1.202236624973947e-02   +1.192901382290857e-02   +2.450641271156023e-02; +1.186489465274982e-02   +1.025695866582209e-02   +3.040876435419100e-02   +2.057986390452469e-02   +2.446456025915825e-02   +1.002616471917302e-02   +1.201881260794279e-02   +1.362167493835464e-02; -4.263244328571629e-03   +3.397540407985505e-02   +5.330672540401523e-03   +2.289971630384876e-02   +7.986179863461021e-03   +2.392985812569689e-02   +1.764486889512512e-02   +1.705445510882912e-02; +2.262648592009064e-02   +1.342724424975839e-02   +2.430129601313549e-02   +2.057667065835767e-03   +1.633929853265322e-02   +4.117276270488137e-03   +1.093199661984580e-02   +1.614476437409472e-02; +2.158698880341314e-02   +1.462338249090084e-02   +1.700722486224699e-03   +1.091038757107269e-02   +1.327256311219703e-02   +9.438738188932237e-04   +9.004977772111181e-03   +1.226218494741429e-02; +2.313823064648531e-02   +3.072804525043041e-02   +1.906590800460896e-02   +2.439338996757982e-02   +1.097423590576287e-02   +1.336320211229176e-02   +2.530646237042484e-02   +6.468845619899388e-03; +1.759312840326411e-02   -6.576454157778545e-03   +8.028875907664889e-03   +8.950602115184014e-03   +9.139102180871345e-03   +2.572988354431724e-02   +1.936088998319726e-02   +1.930271588131376e-02];
L3I_L3E_iAMPA_netcon = [+1.622372703270796e-02   +2.777856182319310e-02   +8.721773164547310e-03   +1.894284072859647e-02   +2.295996210409251e-02   +1.617194757015121e-02   +7.762814499194529e-03   +5.422972901912588e-04   +1.685687902170655e-02   +1.653963212970002e-02   +1.134050073630489e-02   +7.245994295573318e-03; +1.131965852188394e-02   +2.196490417860524e-02   +7.990248583804179e-03   +4.158565887843227e-03   -2.928007552717664e-03   +1.929573222593498e-02   +1.880739584423293e-02   +8.228402959365369e-03   +7.448206575304525e-03   +1.713743932794166e-02   +2.430509125203022e-02   +1.602306550021690e-02; -4.589170710415499e-04   +1.653058053102199e-02   +1.095067661171029e-02   +2.149043283550576e-02   +1.554341517259946e-02   +1.382582380701093e-02   +1.441598907128635e-02   +1.056575191226977e-02   +1.654568634692601e-02   +1.880644451198615e-02   +8.388277431671748e-03   +1.610369472223204e-02; +1.342411614416286e-02   +2.343961786629262e-02   +1.929908179089570e-02   +1.161457217375004e-02   +2.227532510618907e-02   +2.553662026915367e-02   +2.435118287224267e-02   +5.429831356609704e-03   +2.788545948580414e-02   +2.991466114691011e-02   +1.276443018711474e-02   +2.151785811165415e-02; +5.785021820263327e-03   +9.288755006911217e-03   +3.787261582305100e-03   +2.060876803560988e-02   +2.157951765897552e-02   +1.560893240933837e-02   +2.945538258454131e-02   -7.836217773157174e-04   +2.264284500662990e-02   +1.101663363766606e-02   +1.259574742540419e-02   +3.603841636223970e-03; +7.934010069177499e-03   +1.613182167812489e-02   +2.704440885257050e-02   +1.735337118270840e-02   +2.643581769615458e-02   +6.603400621328052e-03   +2.206318198470646e-02   +1.049592765268656e-02   +2.040941453622314e-02   +4.089116461032974e-03   +4.988614528429771e-03   +4.933350559754826e-03; +3.037231989215021e-02   +1.524898510864671e-02   +1.163728374835075e-02   +1.275139348927786e-02   +1.435665222653824e-02   +9.561651444716763e-03   +1.595585018611518e-02   +3.245192516756645e-02   +2.769500390920575e-02   +3.359473514620565e-02   +9.465303483718865e-03   +2.433405163570339e-02; +2.239508996244160e-02   +4.613827221608616e-03   +1.914069917023639e-02   +2.052328466481873e-02   +3.142218913230512e-02   +1.735611575475966e-02   -1.728034972679376e-03   +2.004382397324724e-02   +1.747807320402398e-02   +4.497703767569009e-03   +9.164194645942477e-03   +3.414260297903486e-02; +3.684990338141833e-03   +2.541143700657453e-02   +1.776923895269410e-02   +2.239095570436588e-02   +1.147398790839952e-02   +2.190163498995894e-02   +1.011270553370712e-02   +2.640983788941721e-02   +2.428517012767061e-02   +1.152692393738825e-02   +9.754784469441335e-03   +5.628905328135553e-03; +2.522391741620865e-02   +2.675970514509327e-02   +1.960611716808267e-02   +7.070588548280793e-03   +1.813214126219703e-02   +2.564125062388219e-02   +1.636703595207200e-02   +2.989009232237888e-02   +2.703099332910525e-02   +7.895339421657611e-03   +2.524642333951574e-02   +9.353170096226240e-03; +1.453935038527292e-02   +1.411074811959260e-02   +2.908567885809282e-02   +2.871848559850345e-02   -1.903784563624294e-03   +2.197699061104742e-02   +2.359930185782587e-03   +6.193426284968552e-03   +2.794206946972502e-04   +3.056557786280298e-02   +1.716591013460495e-02   +1.180665693633003e-02; -2.281337348616103e-03   +7.557148779920878e-03   +5.217136845347954e-03   +2.321847849794703e-02   +1.044530168155670e-02   +1.545832462093998e-02   +2.331975389967296e-02   +3.909589872606012e-04   +7.357633516794212e-03   +3.149758350096263e-03   +2.495037571204798e-02   +1.451273145728113e-02];
L3E_L3I_iGABA_netcon = [-5.817482133141310e-03   +1.380625751600282e-02   +8.279279826790324e-03   +3.366318211335041e-02   +2.190711033893626e-02   +1.795913904915636e-02   +1.657644933532755e-02   +2.298362747187593e-02   +1.526300455872134e-02   +2.190282238775186e-02   +1.428793510454438e-02   +2.742001190726198e-03; +2.138974701475425e-02   +2.450544137451999e-02   +1.061845796351492e-02   +5.053019441205444e-03   +1.013624195746836e-02   +2.535398017279775e-02   +2.134551174611657e-02   +3.623476539014844e-02   +2.776877061919866e-02   +1.442732253804238e-02   +4.831055517848918e-03   -5.077007871462262e-03; +1.257604641964189e-02   +3.190129710751627e-02   +2.072657769915960e-02   +2.473484277699740e-02   -4.103722179094813e-04   +2.370674274705837e-02   +1.932047776091861e-02   +2.416434371932083e-02   +9.589719395664772e-03   +1.108723076938613e-02   +9.356684369680164e-03   +4.517639494134179e-04; +9.395304339748237e-03   -1.761092087547989e-03   +1.240330998904085e-03   +2.759396931021297e-02   +1.945810466703309e-02   +7.136093145641263e-03   +3.409245217414327e-03   +1.226369824151546e-02   +2.947401668702795e-02   +6.359127190469323e-03   -9.385783832303464e-04   +1.823392661643988e-02; +1.032903000337573e-02   +1.298006699526443e-02   +3.704763813478578e-02   +5.331683209075484e-03   +9.953598321236854e-03   +2.085571394248311e-02   +3.346904207728663e-02   +2.986011586005242e-02   +8.548444472947198e-03   +2.381333947873296e-02   +3.278449896257903e-02   -8.530977085858629e-04; +2.186407655593185e-02   +1.073197586276833e-02   +2.138673723083675e-02   +6.931649825986961e-03   +3.823297288141480e-03   +3.656778187367404e-02   +1.917171424276785e-03   -5.577675473991162e-03   +2.331571188457234e-02   +2.028253261493647e-02   +8.428409698111546e-03   +2.390989817788653e-03; +1.488971871045127e-02   +1.375801195007334e-02   +1.307632853710008e-02   +1.747928968829391e-02   +1.799481516704341e-02   +1.043018254380982e-02   +5.125839137293994e-03   +3.947780578514522e-03   +1.716016869164048e-02   +3.602418981805250e-03   +5.191420322503824e-03   +1.765210949894957e-02; +8.061588968766418e-03   +8.245206960175492e-04   +7.890636428491997e-03   +3.112037464863691e-02   +7.371460867949167e-03   +2.000820574671624e-02   +1.278401656622358e-02   +2.196779808533301e-02   +2.605302329473674e-02   +2.444357991407794e-02   +5.349574171617359e-03   +2.140484532612692e-02; +1.093727413562066e-02   +2.847541886865820e-03   +2.812683559969675e-02   +3.339239514265838e-03   +3.369959831007121e-02   +2.775255206167605e-02   +8.946187398834174e-03   +2.582377146782458e-02   +7.387891654647160e-03   +4.404582248640138e-03   +9.461141821137081e-03   +1.939166658701909e-02; +2.556057883343548e-02   +1.098986912993415e-02   +3.073923454163760e-02   +5.616136019931816e-03   +3.347746624117396e-03   +3.857193974170270e-02   +1.960319865851188e-02   +1.417535527550587e-02   +3.332486733758182e-02   +2.825329661791641e-02   +1.033497967646437e-02   -2.888412874836894e-03; +1.428221163768197e-02   +2.920845863425603e-03   +1.027794053355268e-02   +4.038555229438259e-03   +1.644871540108228e-02   +1.394573562814270e-02   +3.379866057854057e-02   +2.284676643779350e-02   +2.043925570119275e-02   +8.618643531151573e-03   -2.221346109936477e-03   +2.578814001674582e-02; +1.915313408316718e-02   +1.444632525113802e-02   +2.868914369944002e-02   +2.272103373333313e-02   +5.739625526043778e-03   +8.881181599683607e-03   +2.967802920522789e-02   -7.463804821494103e-04   +2.697640614450532e-02   +1.529067926599887e-02   +1.483328994333524e-02   +1.470090645748584e-02];
L2E_Input1_iAMPA_netcon = [+3.073098833940194e-02   +3.271585256030340e-02   +2.523652665324892e-02   +2.882081202730494e-02   +3.425827429398805e-02   +3.552248150485893e-02   +3.384429605716496e-02   +2.447685312288666e-02];
L2I_Input2_iAMPA_netcon = [+2.788289009309206e-02   +2.830187142661087e-02   +3.774673417812673e-02   +2.293299044353496e-02   +2.406278645908317e-02   +3.643767986731866e-02   +3.076240643977783e-02   +2.789572888220939e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
