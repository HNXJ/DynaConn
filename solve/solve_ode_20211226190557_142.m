function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.583961580003161e-01   -8.950809611156108e-02   -9.342232773179715e-02   +3.114527378961439e-02   +7.742760772485216e-02   +2.815722292337365e-02   +1.677988320447139e-02   -1.665513759710201e-01   -1.558926853313393e-01   +5.228556374888366e-02   +3.273623916300717e-01   -1.676488652983532e-01   +2.512830346584342e-01   -1.382498757217398e-01   +1.721230853494266e-02   +8.036300457055319e-02; -7.819808854077925e-02   -1.286944679392300e-01   -2.749817694764933e-02   +1.204096480131424e-01   -3.787232697541446e-01   -2.256577945860604e-01   +1.530045891799716e-01   -2.098774001810495e-01   -3.138792821414874e-02   -2.159883315992007e-01   +4.500440361025954e-02   -5.216792321257913e-02   -1.146386662398421e-01   -1.658934407133688e-01   -3.465930981524092e-02   +2.638053294734647e-01; +1.744192617709068e-01   -7.797886353508383e-02   -3.401145915117471e-02   -3.687883994134163e-01   +1.162740634666724e-01   +2.110144231961746e-03   -9.648746554514073e-02   -1.034464540168206e-01   +6.223482525017770e-02   -1.329362034057549e-01   -7.958163806460472e-02   -1.102727938754417e-01   -1.724014786186553e-01   -1.263636929683614e-01   +2.553160607388793e-01   +1.431295975528875e-01; +1.038267115438249e-01   +4.718640304610139e-02   +5.982547650681548e-02   +2.298597890890349e-01   +2.509732607998803e-02   +4.591238254352345e-02   +1.227817479372687e-01   -1.979743421019896e-01   -3.055306745560141e-02   +1.029220407476412e-02   -7.951532594662152e-02   +1.919484093408440e-01   +6.630307855133465e-02   +1.612915137566298e-01   -1.300657533773528e-01   -8.610599229828951e-03; +8.417376614190165e-02   +1.521770929506513e-02   +2.402178085616308e-01   +9.585476692933390e-02   +7.913698762038221e-02   -2.662588483251083e-01   +6.231823716752451e-03   +1.326013393684986e-01   -1.501516185417581e-01   -3.175002207366179e-02   +1.168452972989403e-01   -7.298685432747901e-02   +1.315186671653500e-01   +1.780398683014409e-02   +1.967516200556881e-01   +2.340272829500181e-02; -2.337792085064256e-02   -1.191062653560578e-01   +1.737612554577445e-02   +1.129506534754926e-01   -1.908605698890138e-01   +6.975769773129893e-02   +1.731347412523538e-01   +2.531686754061656e-01   +2.276560850154590e-01   -2.344625074443965e-02   +5.158057555254458e-02   -1.004029173215109e-02   -4.764946897181997e-02   +8.049676664784992e-02   -1.308311352027527e-01   -8.833497410967787e-03; -3.709441022428044e-02   +1.561093818323768e-01   -9.966703677961136e-02   -1.036622152772414e-02   +1.318537375714212e-01   +2.039853483819974e-01   +1.550174941947178e-01   +4.398628809640855e-02   -6.647804182863716e-02   -1.559666178658716e-01   +5.638211007548333e-02   -1.487219861920635e-01   +1.115048820043401e-01   -1.356774125275868e-02   -4.218096443108069e-02   -5.885889487838485e-02; +8.038175009961381e-02   +2.867776880209464e-01   +2.691005639530488e-02   +2.214003520785890e-01   -2.000863582699603e-01   -1.378003803865556e-01   +2.576530989623400e-01   -3.297903233876182e-01   +1.621413742169908e-01   -8.546034783226569e-02   -1.127060334904584e-01   +7.437601754097549e-03   +1.417954610703431e-01   -1.690347178726339e-01   -1.376686033105192e-02   +2.051820593095069e-01; -1.194468503764502e-01   -5.580779605752294e-02   +1.898141334835322e-01   +5.918497583087986e-02   -8.951784080114897e-02   -1.242279963046903e-01   -1.390615689990248e-01   -8.156104610801782e-02   +2.601315787344641e-01   +2.150789415996109e-01   +2.688703026606765e-01   -1.085151771297139e-01   +1.345108787402902e-01   +2.101222221572672e-02   -1.878847436467680e-02   +4.542738993382535e-02; -6.664166243984206e-02   +8.963340383120486e-02   -1.996527838070298e-01   +2.017594063779855e-01   -1.756772898550891e-01   -1.848308625930258e-02   -5.601271623798665e-02   -1.037201926917809e-02   +3.683724559944844e-01   -1.121336321223182e-01   +1.759837674825350e-01   -1.946652531636448e-01   +2.418726220186329e-01   +2.179315609073387e-02   -1.770919285514266e-01   -3.229205684882465e-02; -4.328149886220109e-02   +3.613923098692425e-02   +1.020414657445174e-02   +1.479565480664672e-01   -1.509287019251392e-01   +2.072796893363517e-01   +1.248302582348497e-01   -1.365198010261124e-01   -8.036105323781283e-02   -1.316571583706113e-01   +3.237124820377439e-01   -2.148211334666847e-01   -2.027211572898108e-01   +1.045469628251425e-01   -1.189414382147808e-02   -1.702001086227175e-01; +7.001540122048072e-02   +3.662475637828541e-02   +8.662711601681040e-02   +3.075854753858369e-01   +9.662308667287255e-02   +1.676267656570255e-01   -1.596099658932886e-02   +8.401949091807132e-02   -1.226278031854413e-02   +2.481308750017618e-01   -4.150422151272676e-02   +2.353413746311367e-01   -2.136532639014761e-01   -1.332194233461210e-01   +7.691294209745186e-02   -7.163435358944644e-03; -1.556867194745900e-01   +1.238197638203109e-02   +6.212453086682677e-02   +4.044368191110043e-01   +8.743637699993811e-02   -3.413170121388237e-02   -1.638250309558190e-01   +2.360543212810669e-01   +1.423428598139345e-01   -1.398083493597681e-01   -2.676842397231333e-01   +8.889730886194271e-02   +3.933555268847743e-01   +6.731793252246880e-02   +1.710582834453183e-02   +1.943217930603879e-03; +1.494065880070157e-01   -7.773735945412247e-02   -5.267061492210362e-02   -1.392234206394461e-01   +8.265087309457457e-02   -9.418370309036368e-02   -1.439122516958037e-01   +1.303791149227798e-01   -1.630182263482420e-01   +7.109082227820786e-02   -1.744420427441268e-01   +2.187779563660525e-01   +7.897794373062378e-02   +1.123697198226182e-01   +8.377649296822384e-02   +4.033011395730587e-02; -3.205762063258791e-03   -5.217717195166043e-02   -4.790578053988950e-02   +2.094534246290698e-01   +3.417756456602836e-02   +1.557170491601561e-01   +3.102388445711672e-01   -4.376381098861229e-02   -1.535688509873213e-01   +4.281843883478272e-03   +5.540745477860608e-02   +1.763987284696287e-01   -2.326761758659877e-01   +6.308406840260793e-02   +1.275626651624244e-02   +2.205773142013564e-01; +1.071968050048755e-01   +3.235638000016084e-01   -1.594964053386959e-01   +2.759110074930534e-02   +1.898630928273248e-01   -3.614189526913621e-02   -1.504626430126535e-01   -7.687094204986324e-02   -4.425192294658467e-01   -5.904475357533097e-02   -1.817361822661204e-01   -1.312405209420593e-01   +1.364144520823460e-01   +2.615577598919420e-02   -1.158640684864988e-01   -6.354536124897472e-03];
L1E_L1I_iGABA_netcon = [-1.725854363927760e-02   -3.261845563236875e-01   +1.191808874507535e-02   -1.277228930737608e-02   +8.986476017324860e-02   +1.392069282883235e-01   +2.504871521919608e-01   -1.188107581778769e-01   +1.248860853295966e-01   +1.526032625320226e-01   -2.731177284902069e-01   +3.497657534165843e-01   -3.121841995133344e-01   -8.371261386195278e-02   -6.400764238734705e-02   +5.782714053742481e-02; +1.789034546423160e-01   +8.525500022705391e-02   -1.422355776659555e-01   +5.239073686861499e-02   +1.413245393356873e-01   +4.359623090014515e-02   -4.737606625719243e-02   -6.563891684854534e-02   +1.617038155039671e-01   +1.949766227263565e-01   +8.061982932029954e-02   +1.372345578490243e-01   +8.467223315953867e-02   +1.336778883189021e-01   +2.235393750628726e-01   -1.484762466238412e-01; -1.666363269026428e-01   -1.636732162013723e-01   -5.549620302827002e-02   -4.161628974870206e-03   -7.170637843873194e-02   +2.159461430925887e-03   +1.167443289516028e-01   +7.032259695320919e-02   +1.922344141511563e-01   -6.638272116318938e-02   +1.798939109947505e-03   -1.076799185808727e-01   +2.221622832642264e-01   -2.370927346727710e-01   +1.820078057530732e-01   -5.744794200015021e-02; +2.214373557976254e-01   -1.585157994392395e-01   +2.828962012498035e-02   -1.537292280723087e-01   -2.542280856025732e-01   -1.222552822737424e-01   +1.664045853161174e-01   +1.469107525478628e-01   +2.325445432517908e-01   +1.782098821607960e-02   +1.738542351964878e-01   +1.772469030968211e-01   -9.423391578080337e-02   +7.939899421418896e-02   +1.558596705357903e-01   -5.305772081282586e-02; +4.140088521366935e-02   +1.716847948666267e-01   +4.121255624909195e-02   -1.727629972900739e-01   +7.323873775900602e-02   +5.124817734156251e-02   -3.962861364978104e-02   -1.156955347068581e-01   +3.807162711495350e-03   +6.970614041786620e-02   -2.942086252565601e-01   -1.956179874027584e-01   +7.324313653920661e-02   -5.382945763337322e-02   +2.861006892501184e-04   +6.254775711378108e-02; -1.324745265295988e-01   -8.411084339362479e-02   +1.365519917560276e-01   -3.034982386573130e-01   +1.204729462980233e-01   +1.941720515139894e-02   -8.716310179480467e-02   -1.221754152815456e-01   -4.142308708992112e-02   -1.216515789928917e-01   +1.246312002676968e-01   -3.230627195303462e-01   +1.782874396920180e-01   +2.492549378225394e-01   +4.727252189083483e-04   -2.658083070299171e-01; -1.129983439905114e-01   +1.648045515730568e-01   +3.067397654130390e-01   +4.021121368513436e-03   +9.444540137244649e-02   +1.906347458329488e-01   +4.221352407560248e-02   -3.366573450338821e-01   -2.548644724724762e-02   -6.347864954451015e-03   +1.893612108022337e-01   -2.961493251915117e-02   +1.624452132758247e-01   -3.385967781256422e-02   -5.551228694977259e-02   +7.501992299664357e-03; -1.861218804902509e-02   -2.848417626339156e-02   -3.652421791096592e-02   +1.733358836046187e-01   -1.634358239093367e-01   +5.513381437453894e-02   +1.733479554091751e-01   -1.727519047372856e-01   -9.292437986024339e-02   -1.412130481240344e-01   +1.407226057858281e-01   -1.163174745087366e-01   +2.354290756684963e-02   -7.587082081283483e-02   -1.905598355737384e-01   +2.389152541637206e-03; -2.716511773631347e-01   -2.766104024835710e-02   +2.578896424583803e-02   +6.900260394683234e-02   +2.831570505044499e-02   -6.106704868229104e-02   +6.019392344308461e-02   -1.688334034521549e-02   -6.902352660722133e-02   -9.958068832422770e-03   -2.629453835456683e-01   -7.873834332464427e-02   +1.465417191364443e-01   +1.945463381192323e-01   +2.589652333098331e-01   -8.954397999019312e-02; -4.840679997763539e-02   -1.983236659902794e-01   -1.873126307263337e-02   +1.203703760627775e-02   -4.100753967472566e-02   +8.518197680771220e-02   -1.169696441301957e-01   -1.222655649404518e-01   +2.100495895490183e-01   +3.628774071024678e-02   -1.215128006894466e-01   +3.152375616671308e-02   -2.228919500131153e-01   +5.345437528989745e-02   +2.643884199390734e-02   +7.836942787317788e-02; -2.985911956346279e-02   +5.600847667793139e-02   +1.694262739767765e-01   -1.766833918995464e-01   -1.611763609848413e-01   +7.165472300520953e-02   +1.517684160969386e-01   -5.714151063446403e-02   +1.613058207122990e-02   -9.407588725046993e-02   +1.756693193364212e-02   +2.082625456984550e-01   +2.000954408465497e-01   +1.352079918484988e-01   +3.259078882842349e-02   -1.732113845696088e-01; -2.051895537505229e-01   -2.932647079518894e-02   -2.043697236688696e-01   +6.350039611525422e-02   +4.582949783593170e-02   +1.883739306495766e-01   +1.864991751871447e-01   +1.070254580309269e-01   -7.153228804859748e-03   +1.346360626065684e-01   -1.402835623109185e-02   -1.916849076088407e-01   -5.336576739509460e-02   -7.998356157236518e-02   -1.518337822573072e-01   +2.819801129014702e-01; +4.158365153324361e-02   -1.265971291370162e-01   +2.992767005038280e-01   +4.299613518011461e-02   -2.718086691505543e-01   -1.090069634160255e-02   +4.108184189306651e-01   -1.208647409490871e-01   +2.675343596318572e-01   +1.655546108709277e-01   +2.365985218479156e-02   +3.170082743829464e-01   +2.024465744253091e-01   -4.952886779755940e-02   -1.195210307113514e-01   +1.920824575789223e-02; -1.650800073746507e-01   +6.297321992078669e-02   +1.208227335775180e-01   +1.977731108737519e-01   -8.882696539419825e-02   +2.615471883155984e-02   -1.232293803382687e-01   +1.563595321028372e-01   +2.952258863339536e-02   +2.870041188950948e-01   -2.037318997742298e-02   -1.111734756693956e-01   +8.023285484125710e-02   -1.878930027118085e-01   -2.568401219811916e-02   -2.944033633596588e-01; +2.712900461472443e-01   +3.120733745556702e-02   +2.125218510796857e-02   +5.481348031651009e-02   +1.182416416112049e-01   +2.124837948389005e-01   +1.054492494556640e-01   +8.233321707584085e-02   +1.084846643387382e-01   -2.687422814311240e-01   +1.891152106574819e-01   +1.601949047185611e-01   +8.935410179643062e-02   +6.298844803370358e-02   +1.079738209949678e-01   +3.366160535948995e-01; +1.157634376426130e-01   -1.254455954667709e-02   -1.496904221988703e-01   -9.254466760412211e-02   +1.557513694321256e-01   +7.563110611970389e-02   -7.177749463751430e-03   +3.396843143099616e-02   -6.836886216881219e-02   -1.937184334632120e-01   +3.094814926236037e-02   -2.555816185223800e-01   -1.928684900312908e-01   -7.559070518995868e-03   +1.147752635313006e-01   +2.167204967419877e-01];
L2I_L1I_iGABA_netcon = [-2.535912462134100e-01   +2.470648685442691e-02   +1.138824455011411e-01   -7.434178952820862e-03   +1.273562263615432e-01   -9.807691197713379e-02   +2.641062337990413e-01   +7.503515540470920e-02; +1.375816579468498e-02   -1.731305383645843e-02   +1.186884055045851e-01   -1.635869285592858e-01   +2.140448597112237e-02   +1.307768907281696e-01   +5.869208937305184e-02   +2.971326429705051e-02; -5.798154729637950e-02   -1.318720530460384e-02   +3.897587478577047e-02   -7.109930807894324e-02   +3.407251385765964e-02   +5.130000986663436e-02   -9.245803997513302e-02   +6.804411116444445e-02; +1.948644789048505e-01   -6.000560597614288e-02   -1.865783131113461e-01   -2.441193077848858e-01   +1.103485665427228e-01   -5.045837917551489e-03   -6.563516866787769e-02   +4.405454321509911e-02; -1.892454635502371e-01   -2.209052032265566e-01   -1.341834960064007e-01   +2.623098554729586e-01   +1.013314803787406e-01   -1.814106864409437e-01   +4.342187678732690e-02   +1.070325135223321e-01; -6.063996712327641e-02   +1.846443027424470e-01   -2.308755327587452e-02   +2.630492057471706e-01   -8.598622321275280e-02   +9.129944636476598e-03   +4.069464984742534e-02   -1.535759685617284e-01; +5.917111636883292e-03   +1.417567080395430e-01   -9.193034382311085e-02   +1.670734727679986e-02   -2.388053889090461e-01   +2.770937420586858e-01   -1.518475838331825e-01   -6.759725072913123e-02; -2.587422577535644e-02   -1.726762187385886e-01   -3.344354818441322e-02   +1.446319095482194e-01   +2.194660898022451e-01   +1.258420727659221e-01   -1.381371331285945e-01   -2.378031789908099e-01; -1.166730116819697e-01   +7.639901634070979e-02   +4.927229709184567e-02   -2.311119126758516e-01   +6.701694985587626e-02   -6.498259504686626e-02   +1.558110347304288e-01   +3.703639460062189e-02; -5.108792707685746e-02   -1.519066626948368e-01   -1.167797836236322e-01   -1.374319170489469e-02   +6.866403885920445e-02   +8.092065087465780e-02   -1.528335227267823e-01   +1.788660968784567e-01; -3.718674428194016e-02   -7.498045736604923e-02   +1.614186949877565e-01   +1.142593626375804e-02   +1.655673570634062e-01   +4.333365737289570e-02   +7.649869863610682e-02   -6.591080313339484e-02; +1.783340939571479e-02   +1.130670623610991e-01   +1.567722215148819e-01   -5.167793016521528e-02   +1.853539921967970e-01   +5.989116735295499e-02   -2.579559207450704e-02   +1.473080607269598e-02; +2.206752135351984e-01   -1.966764091609504e-01   -1.877374954713653e-02   +2.838047419403704e-02   -1.815556592493386e-01   +1.870609449133313e-01   +2.331517561420918e-01   -5.652518380825583e-02; -2.569802146870645e-01   -2.500939450788027e-02   -9.648634496552791e-02   +1.873479517016159e-01   -2.159216394844271e-01   +1.326588340073840e-01   -1.670447666280923e-01   +6.307388157808198e-02; +2.013866481994349e-02   +4.440524336293718e-02   -5.849607013197937e-02   +1.362593767717696e-01   -1.947738510939714e-02   +8.293388117970710e-02   -2.605005675084294e-01   -4.921965755839331e-02; -7.150281190615441e-02   -2.722685537564999e-02   -2.177656940822523e-01   -3.114110317954773e-03   +1.161205133737309e-01   +3.800369901381023e-02   +3.144069448098340e-01   -9.997205798078448e-02];
L1I_L2I_iGABA_netcon = [-2.519774227185999e-01   -1.947657283342476e-02   -4.927756351429131e-02   +2.396397565477606e-01   +8.607441959900788e-02   -7.335633067643524e-02   -6.883675716081548e-02   +1.945958995233045e-01   +2.877952249223468e-01   -1.144211726329597e-01   -7.814394939310989e-03   +9.469113226599246e-02   -1.021160262539575e-01   +9.941399169991491e-02   +4.149518591390776e-02   -1.174355936817033e-01; -1.159142611286443e-01   +3.146620651943158e-01   +1.753866627583057e-01   +3.001079606709429e-01   -3.898082614080898e-02   -1.681792110736621e-01   -2.225751716910231e-01   -1.163916348282983e-02   -1.548389539747124e-01   -6.368704137600278e-02   -1.001378184945770e-01   -9.264262415840027e-02   -1.709081028588886e-01   -1.400080526995252e-02   +1.576993466617508e-01   +2.935081474275196e-01; -9.938213014223170e-02   +1.926411543805178e-01   +9.785649781038033e-02   +1.445651389085786e-01   -2.823804311384138e-02   +3.185729092679052e-02   +2.063022882215184e-01   +9.876671395242211e-02   -1.317380871767113e-01   +1.352826120750709e-01   -2.312007034963909e-01   -2.381382262945146e-01   -3.075147605842866e-02   -4.791430066646403e-02   -9.232817179606613e-02   +2.912928001166817e-01; -3.051777185590122e-02   -1.379719069558755e-01   -1.554684381074169e-01   -5.097828826775742e-02   +1.513416339057260e-03   +1.502895763329943e-01   +2.611403512094198e-01   +7.462511317434498e-02   +1.885173416264852e-01   -4.824876998261664e-02   -1.603004649098034e-01   -8.272416530112700e-02   +1.339323237164458e-01   +1.272778467875756e-01   -2.251384648731717e-01   -1.433358265834709e-01; +3.536293868724948e-02   +2.934238467335223e-01   -1.303843115120281e-01   +6.592217005719005e-02   +7.461194050268048e-02   -7.246528392896948e-03   +1.306604829419651e-01   -3.170411524985997e-03   +2.915342938465427e-02   +1.658005280102261e-01   +1.895893344778930e-01   +1.856471964155907e-01   -2.107700411403833e-01   +3.599824006992472e-02   +1.365904270103963e-01   +1.971576861169715e-01; +1.050708542831011e-01   +3.412945570477263e-02   -2.497632420087266e-01   +3.017887084267135e-02   -2.528485692992710e-01   -1.112515401287548e-01   -1.861551023853145e-01   +1.999626072046800e-01   +2.440793619980446e-01   -3.333943489073945e-02   -5.623267017494821e-02   +1.168008070833387e-01   +1.642190906050388e-01   +2.114295334773280e-01   +9.630356413731696e-02   +2.521087099409423e-01; -1.148446614224207e-01   +1.755859037303956e-02   +2.198213181541284e-02   +3.235730355720814e-02   -6.719151514485053e-02   +2.418941076863874e-01   +8.068282317442262e-02   -4.151587501721137e-03   -2.098109913962741e-01   -8.232112065761310e-02   +7.094828575921515e-02   -8.827646487157970e-02   -6.781174461639512e-02   -1.046049891078103e-01   -4.806064063711936e-02   -1.514061236867172e-01; -1.132239223883916e-02   +3.292372879367045e-01   +1.665174954319968e-01   +1.350715618998470e-01   +7.590933306966546e-02   -2.048249304297040e-01   -7.198831784464674e-02   -1.887826990702355e-01   +2.493748174090041e-02   +7.617809107728005e-02   -1.830169604687645e-02   +1.740575807212385e-01   +1.792188720760785e-01   +7.599783332003597e-02   +8.649495067344448e-02   +3.556898490932307e-02];
L2E_L1E_iAMPA_netcon = [+1.961992722585443e-01   +5.293377536455524e-02   +3.383025018883649e-01   +1.970465751984683e-01   +2.870771513802775e-01   -5.331854218722978e-02   +2.736209178484915e-01   -5.197410619022336e-03; +1.807011873067235e-02   -1.995031893867886e-01   -9.976413437550394e-02   -2.339139307582662e-01   +6.100274328481312e-02   +1.875789533917637e-02   +1.986697273421704e-01   -5.947040553290230e-03; +1.411533518438512e-01   +1.498469868216160e-01   +2.189836584920488e-01   +2.163521802307474e-01   +8.414118583878702e-02   -1.104917122416600e-01   +4.907600881808855e-02   +4.280037633107492e-02; +7.839704669983866e-03   +2.028553173988003e-01   -1.767333837627706e-01   +3.618561858662343e-02   +1.137383445900207e-01   +7.492816697410890e-02   +1.007522919669498e-01   -4.004013963313670e-02; -2.421648570301126e-01   -5.374016688270171e-02   -1.771981962982276e-01   +1.596796219335528e-01   +1.791447610110765e-01   -2.396024278306106e-01   +7.939040126761143e-02   -2.263662551520311e-01; -1.176359750939833e-01   -4.688873742590739e-02   -2.262300992536719e-01   +1.236447743887731e-01   +9.389240153258809e-02   +6.811114499947002e-02   +1.906532883425970e-01   +1.064160673996047e-01; -6.691443072672629e-02   -1.311238966656228e-01   -1.140528171145761e-01   +1.091865866732979e-01   +2.344673082547583e-01   +1.082807615930137e-01   -3.310575768928703e-02   +1.817030640489805e-01; +2.154001291154413e-01   +1.284043275143699e-01   -4.604708862941721e-02   -9.524919586279611e-03   +1.051898580073277e-01   +2.575398616083372e-02   -1.093670747763523e-01   -4.752508333840560e-03; -1.153237105768684e-01   -4.021731847744178e-01   +5.910393061560118e-02   -7.410990697799623e-02   -4.987738434110937e-02   +1.454561326842161e-01   -1.765972041063635e-01   -8.223798142324477e-02; +7.038663211886630e-02   +1.553504912631612e-01   -1.561636822152742e-01   +1.720116034625984e-01   -2.093163068799161e-01   -7.191437703721504e-02   -1.909353606149899e-01   -2.232420835031187e-02; -9.078794909717602e-02   -2.255819263212361e-02   -2.907782206108329e-01   -2.645876696591389e-01   +3.445961799174393e-01   -2.941428890534018e-02   +2.505368759579935e-01   -2.255208505389927e-01; -3.026577598890570e-01   -1.178248863107259e-01   -2.789756790931931e-02   -3.864281331691785e-02   +4.668316923521119e-02   +1.672994116861241e-01   +3.124165351140444e-01   +8.333863886416384e-02; -3.154371237022981e-02   -1.400421245485642e-01   +2.236927714712034e-01   -1.384787555989801e-01   -9.160070211252976e-02   +4.864650764095127e-02   +1.122353742261772e-01   +1.130675552544203e-01; -4.715973592242952e-02   -2.928115453357556e-01   +2.241431356807121e-01   -1.002166898837672e-01   -1.662388382000065e-01   +1.268832352891849e-01   -2.089481135096441e-01   -1.359676058802667e-01; -1.034706347688767e-01   -1.084139184412052e-01   +2.876274151048266e-01   -2.656036672730167e-01   +1.512952084974598e-01   +5.602744606471174e-02   +4.515296692685374e-02   -9.878339258937335e-02; -2.901256346043130e-01   +1.401079124790748e-01   -1.280765305098737e-01   -2.155247703736119e-01   -2.639960570221236e-02   -1.122060249975870e-01   +1.174572560145220e-02   -3.638688838753858e-02];
L1E_L2E_iAMPA_netcon = [-3.686750241460900e-02   -7.187049041050364e-02   +3.370981381538146e-01   -1.574986557045404e-01   +2.542829584691632e-02   -7.609997657727528e-02   -2.554946281571468e-01   -3.492454976987650e-01   +3.027363839996629e-01   +4.430506686457603e-02   -2.515085834156257e-02   +3.358573660043994e-01   +3.607960203729112e-01   +1.851500651706682e-01   -1.190872609563936e-02   -2.699957988142468e-01; -1.389793277142858e-02   +2.304598502160567e-01   +1.204805493021436e-01   -8.316991664878109e-02   +1.760624410151357e-01   -1.992536345756509e-03   +2.237648031975655e-02   +5.412042082791077e-02   -2.301112106496070e-04   +8.003160748425751e-02   -7.593953719015151e-02   -1.643792750081927e-01   +1.392385838273821e-02   -2.965727367900822e-01   -4.118931296152909e-02   +2.524644851651163e-02; +1.790550608530938e-01   +3.733560136786020e-02   +3.045374421395282e-01   +1.740812480904499e-01   -3.264382491178427e-02   +1.134302103816264e-01   +5.883850389193199e-02   +2.727405882265552e-01   +1.225251349448920e-02   -5.745102581573951e-02   +9.846125850246361e-02   +1.349116559759346e-01   -8.909668594258945e-02   +2.295335713125051e-02   +1.546023722579338e-01   -6.456493073112697e-02; +1.256988150476983e-01   +6.911780975324641e-02   -5.754588374958404e-02   -2.238132766534606e-01   -1.386351169094897e-01   +1.735043355308334e-01   -1.720390208477968e-01   -1.371534424366178e-03   +8.041958502032122e-02   -2.259896169681539e-01   +1.578251227133040e-02   -2.357344101517645e-01   +1.123860753440721e-02   +1.824672112408908e-01   +9.315223387711462e-02   +8.371055584437945e-02; -1.431551367440327e-01   +5.882269316480080e-03   -1.751273825575627e-01   -1.666691736787272e-01   +3.229715823074062e-01   +2.823473696978036e-01   -1.217160455709577e-01   -1.327228052880169e-01   -2.979422365119737e-01   -1.323451036376299e-01   -8.360602364575724e-02   +2.321821620294036e-01   -1.063779388132468e-01   +1.258541436112157e-01   -1.483938478846851e-01   -1.181138481934385e-01; -2.139332540607808e-02   -3.167376453926295e-02   +1.205278578674901e-01   -4.505549376647921e-02   +6.638201323078076e-02   -2.566985304898152e-02   +2.245954053462748e-02   +3.390730534524554e-01   +1.793265131558954e-01   +4.269910599772787e-02   +1.031046131053579e-01   +2.235304763867463e-01   -1.887431732059509e-01   -2.240137573717972e-01   +1.166405474195402e-01   -1.605394787259001e-02; +1.911337518482429e-01   -1.708803182366110e-02   -1.890055373584784e-01   -8.375445991441424e-02   +1.104342809211723e-01   -2.655408459534116e-02   -5.114669901421818e-02   +1.722531011273759e-01   +7.162173732718659e-02   +1.310420001416800e-01   -2.217890717576834e-02   +1.252286091564551e-01   +5.708155344420540e-02   -1.672811598777176e-01   +1.636212848830443e-01   -3.223267938286979e-01; -9.219499571605011e-03   -1.199631075369822e-01   +1.564771976215579e-02   -1.105417154774463e-02   -7.109677918703114e-02   -1.096543358656424e-02   +7.078915390840804e-02   -1.262090758714440e-01   -4.485184644558963e-02   +1.405205639237250e-01   -2.885926411199253e-02   +1.479355086097407e-01   +1.691906217537851e-01   -7.497545102398316e-02   +2.438024175235030e-01   +1.210779394977142e-02];
L2I_L2E_iAMPA_netcon = [-9.108025385497674e-02   -5.156245386465447e-02   +2.030785778907749e-01   +1.950600698694995e-01   -3.128493932394632e-01   -4.621273729445857e-02   +1.354990855317104e-02   -1.220559135141111e-01; +1.396808383423066e-01   +2.457938764893118e-01   +3.435877947008186e-03   +2.253323341558925e-01   +5.874039056695694e-02   -9.741067492662854e-02   +2.739530746539504e-01   -1.348856009287380e-01; +1.175754413885934e-01   +2.270771211739524e-01   +1.635289521881166e-01   -6.769693025353728e-02   -1.637823280486344e-02   -2.641828194966050e-01   +6.932612816131180e-02   -8.617100386908454e-02; -1.679892521128091e-01   -9.765573014835921e-02   +9.482574547512029e-02   -7.813411988870655e-02   +4.111036698143742e-02   +7.442139242502714e-02   -7.845193919915411e-02   -1.383011608970661e-01; +6.128258267829011e-02   -1.242627738340883e-01   -2.609294764872069e-02   -1.562451680652592e-01   +4.119109454211467e-02   +9.357247823122908e-02   +8.458224360283695e-02   +2.941284394207902e-01; -2.536511928766800e-01   -6.355291664937969e-02   +1.811586131670337e-01   -8.767283491937033e-02   +7.122268658262380e-02   -1.657008324901607e-02   +1.332436911592501e-01   -7.781091836943001e-02; +3.412154431437567e-04   -1.049340149407471e-01   +6.720153247341948e-02   +7.826874585246771e-02   -8.158233915308694e-02   -1.001068924097846e-01   -1.698898665155532e-01   -3.379228889032203e-02; +3.009571266454342e-01   +1.062012468512144e-01   +1.110789677314432e-01   +2.205357273787590e-03   +1.398245527972146e-01   +9.187642081134181e-02   -1.102821374958015e-01   +3.510283579114451e-02];
L2E_L2I_iGABA_netcon = [+1.636891255722315e-02   -1.159447083927412e-01   -1.089847356919219e-01   -8.082131128874490e-02   +9.292816632365472e-02   +2.600389538709933e-01   +4.780750973667060e-02   +1.714741532552503e-01; +5.919703362571156e-02   -1.401736777272573e-01   -1.385099387100827e-01   +1.746705745879730e-01   +2.955718937718169e-02   +2.208677527681756e-02   -2.099617028164645e-03   -1.101510242172935e-01; +2.066438127318614e-01   +2.707783218315139e-01   -1.079334792581761e-01   +7.593380771011937e-02   +3.390521538658901e-02   +1.025384453657327e-01   +2.299692988797667e-02   +1.453028656186529e-01; +8.197460939983053e-02   -2.472761563614495e-02   -6.216221744663974e-02   -2.160782707845646e-01   -8.697583816847031e-03   +1.181458731851432e-01   -2.146066854431778e-01   +1.031188999127721e-01; +2.354889995743299e-02   +1.542016995484941e-01   +1.163823809615680e-01   -1.799852273300091e-02   +9.127601420737877e-02   -6.902551283629842e-02   +1.788730599033246e-01   -5.468827657702984e-02; +1.394808554205348e-01   -1.367627116360779e-01   -2.240027563327420e-01   -9.516269157834847e-02   +1.179151955550143e-01   +2.474926216756779e-02   -9.826975334279810e-02   -3.691368877154196e-02; +6.799590460249119e-02   -3.106179528820432e-01   -7.808674630540011e-02   +1.917383883561038e-01   +1.078634535754257e-02   -5.382957663659737e-02   +1.274154469078560e-01   -1.760417085125617e-01; -1.728293114482854e-01   -1.440499381362280e-01   -2.132011829147269e-01   +1.222964221939399e-01   +1.597929034099925e-01   -2.854875380230124e-01   +2.494835895570406e-01   +1.484746242211868e-01];
L3E_L2E_iAMPA_netcon = [+9.396789945717443e-02   -1.947330081914830e-01   +1.369040451299165e-01   +4.076392671320024e-02   +1.365073128179480e-01   -5.647206138070738e-02   +8.773348536962275e-02   -1.017504026943273e-01   +6.708913841683381e-02   -1.211550092181318e-01   -3.028494612936024e-01   -2.919195514085326e-01; -9.076210287267937e-02   +3.208012135714331e-02   +3.104555203764727e-01   -2.913132781705272e-01   +2.400202967011011e-01   +3.318104870885981e-01   -2.110419103196145e-01   -5.225859124431094e-02   +2.851625223602272e-01   -1.626881162251259e-01   +4.553582715259354e-02   -4.779150907100854e-02; -7.390519718444963e-02   +1.102162399016674e-01   +4.112599990292155e-03   +1.718658242517035e-01   +1.920827863706703e-01   -2.436078986876451e-01   +6.855217416999512e-02   +2.533881210779238e-02   -1.649778997346289e-01   +8.341800854768031e-02   -1.092739140467125e-01   -1.376705004313671e-01; -3.068396077351799e-01   +5.527749268098139e-02   -2.180423190642929e-01   +8.052096196369776e-02   +2.277480830029124e-02   +4.293887164352446e-03   +4.030078743696806e-02   +2.064793615695375e-01   +1.795658256050549e-01   -1.580591614172839e-01   -1.233806467033692e-01   +1.107536389974101e-01; -8.000605178843710e-02   +7.682422247153925e-02   +9.622671996344326e-02   +1.746990469230052e-01   -3.217181065082031e-01   -1.842241545389409e-02   +3.064851652321624e-01   -1.536351333254476e-01   +2.807222030761355e-01   +2.245848414938232e-01   +1.877274949378896e-01   +3.506315356155700e-02; -3.227936786563541e-02   +1.231994123815115e-02   -8.254181261791187e-02   +1.908851953183592e-01   -6.946573914899792e-02   +9.192075492845420e-02   +2.114421492458070e-01   +7.146782445013886e-02   +9.371807188632283e-02   -2.155144034994630e-01   -1.221857965682846e-01   -5.408016620838471e-02; -2.074993436084774e-01   +2.232395574113682e-01   +1.241097693356544e-01   -3.010860751535688e-01   +2.593766611996851e-02   -3.295529901240768e-02   +1.675442202359750e-01   -4.637904567620277e-02   -1.464113790797665e-01   +5.025190411070238e-02   -5.268643062713914e-02   +1.300640411988538e-01; +1.537206762820587e-01   +9.896224382559661e-02   -3.024612422975967e-02   -6.924220845978869e-02   +1.025280800718433e-01   -6.164822086426995e-02   +9.728778434209781e-02   -1.231186952625749e-01   -1.262187402911936e-01   +1.024315413655822e-01   +2.923533086505037e-01   +3.815902999867228e-02];
L3I_L2I_iGABA_netcon = [+1.264623570812730e-01   -1.087542064978592e-01   +1.236466866384347e-01   +2.573349177250915e-01   -2.985276911770290e-01   -1.478252120724445e-01   +4.797243178896176e-02   -5.435428892163773e-02   +4.327352955566344e-02   +6.433841830753168e-02   +2.387704440097627e-01   +1.035386596752913e-01; -3.496404645116667e-02   -1.105770687615219e-01   +1.200925311125367e-01   +2.716680911139547e-01   -9.872572732877258e-02   +1.613750813148486e-01   +1.278328938211134e-01   -1.356052731671499e-01   -2.765384815993830e-01   +1.493523505789061e-01   +2.013858687795644e-01   +2.007093863562835e-01; +3.138340828549299e-02   +2.521581374529445e-01   +1.711469340051845e-01   +1.910138880034931e-01   -1.576291550249334e-01   +7.342027513199195e-02   +1.179401981290166e-01   +1.134102530382144e-01   -1.228733174385030e-01   +2.081305081556792e-01   -4.822166456821775e-02   +2.651426875767330e-02; +1.305857646006876e-01   -9.355516472395929e-02   -6.300712727039141e-02   +1.599213454705938e-01   +7.881616816181224e-02   -3.332826376610482e-02   -3.285805782555484e-02   +2.403867696292684e-02   +3.678341333554845e-01   +1.902048134503960e-01   +1.539994477502583e-01   -1.875502376241662e-01; -1.699958392869709e-01   +8.431029398922912e-02   +1.471173905585915e-01   -1.767821328197621e-01   -9.173504239613889e-02   -1.036174214563669e-01   -8.852598168930988e-02   +2.853017073699676e-01   +2.410646098790059e-01   +1.282755274782370e-02   -4.602981715228127e-03   +1.838841701373243e-01; -2.270448659366635e-01   -1.953440176533944e-02   +3.378637996780871e-02   -1.735397176949253e-01   -2.739552581300387e-01   +1.260506430679622e-01   -9.900993780236547e-02   +4.704482148462966e-02   +4.555900671010265e-02   -2.361424578657012e-02   +1.615186696706036e-02   -3.373560184763958e-01; -1.638733279442508e-01   -4.936317912322864e-02   -3.261146774451341e-02   +2.350188588124911e-02   -1.466562346625669e-01   +1.423363217371065e-01   +1.655343512428030e-01   +3.607972999165517e-02   -3.349906304739984e-02   -7.794673413127812e-02   -9.510482346761633e-02   -1.405940908415514e-01; -1.950347260086783e-02   +2.262413459312777e-01   -6.452608501436212e-02   -5.976863480961529e-02   -8.950772497382960e-03   -1.608806434341519e-01   -1.274911407634683e-01   -1.079918164839816e-01   +1.909253980465961e-01   +9.305129282834701e-02   -3.983068329465666e-03   +1.410263179006253e-01];
L2E_L3E_iAMPA_netcon = [-5.088870720705910e-02   -7.471154873442930e-02   +9.627549174202873e-02   -6.125156171001420e-02   -1.550375012205587e-01   +2.092250073032876e-01   -3.847519046043708e-02   -6.566288447118517e-02; +1.229640433497531e-01   +1.174790615003255e-01   -3.292499194165109e-02   -4.154957835420391e-02   +1.949042279922471e-01   -1.273446817675231e-01   +1.876660677488490e-01   -1.505391077479782e-01; +1.835027008674870e-01   -2.314503089020868e-01   -1.544957472108442e-01   +1.997985586607610e-01   -2.033686449196555e-01   -4.075340669562304e-02   -8.731437317753003e-02   +8.659847795220037e-02; +2.451743117963829e-02   -1.317967484827280e-01   -1.226644484492790e-01   +1.839958095850593e-01   -1.135895223872002e-01   -1.318898181574192e-01   -1.420246136116614e-01   +8.947695612232938e-02; +3.099917226673318e-01   -1.802632787450077e-01   +2.495594655068095e-01   -7.476082348318816e-02   -1.723445885207234e-01   -9.511777654027104e-02   +3.515684059268576e-02   -1.208682395434106e-01; -4.305876340480922e-02   -1.750360599379099e-01   -2.878459512310480e-02   -1.026988452176619e-01   +3.996884976545922e-03   +9.524965132741589e-02   -1.625753154885731e-01   +1.423750308447037e-01; +1.704998834097320e-01   +1.386183477248347e-03   -1.648735748495717e-01   -3.939667954623470e-01   -1.370986172487278e-01   -1.673330683455490e-01   +2.873352185967448e-01   -3.893106619115083e-02; +3.916095917906660e-01   +1.007202402123012e-01   +5.848996768904369e-02   +2.376616582930032e-01   +1.809690054829279e-01   +1.615138350291262e-01   +4.642475775582607e-02   -1.292757595011713e-01; +2.909481013707730e-01   -1.053673846542370e-02   +1.030704859422486e-01   -1.090155223304127e-02   -5.939971679623926e-03   -2.368359313302264e-02   -2.928194175383348e-01   -2.563286993246353e-01; +6.254331611181392e-03   +1.586209272209483e-01   -1.423710960100919e-01   -7.578555462233107e-02   -4.063984132364609e-02   -1.611674673043258e-01   -1.372976660190451e-02   -6.679581485347870e-02; +3.762232038213570e-02   +3.504690999220036e-02   +1.431138096580530e-01   -1.299365673636424e-01   +4.771861017988420e-02   +8.277526816675960e-03   -3.397010642259648e-02   -7.072209997394217e-02; +2.494086788044388e-01   +2.446093065713237e-01   +6.941837754194310e-02   +2.008653296670269e-02   +1.090483979269635e-01   -6.463420443226844e-02   -1.151463532075455e-01   +1.462413345235350e-01];
L2I_L3I_iGABA_netcon = [-8.556679048100965e-02   -2.489421439771201e-01   +6.794496013697392e-02   +2.974915462481609e-01   -7.511393211875064e-02   +1.139494546315634e-01   -2.032939357713889e-01   -9.913359943139019e-02; +2.847236898782022e-01   -8.061364326907025e-02   -1.199972663918189e-01   +1.368822832047555e-02   +2.322094353901482e-01   +1.118231585866812e-01   +1.048769409009787e-01   -9.289807338439884e-02; -8.126623449898260e-02   +2.365641662017987e-01   -1.566712043765566e-01   -9.368013868714400e-02   +6.943803889715928e-02   +6.890010211871410e-03   -6.605333339072361e-02   +1.277683811624531e-01; -1.331240144717737e-01   -1.853006404929173e-01   -1.688421069955329e-01   +1.110760926195681e-01   +2.606526072329880e-04   +1.756673544333417e-01   +7.682349000982459e-02   +3.563407167953826e-02; -5.511060259541675e-03   +1.132464972344416e-01   -6.089579954993832e-02   +8.381688622488984e-03   +4.775377536830114e-02   +2.069493119771630e-01   -5.849338626190460e-02   +1.413114057885814e-01; +2.247532546049316e-02   +3.599400334181058e-02   +7.167994899863314e-02   +5.481106217673359e-02   -1.939477023268768e-01   +4.508039390669351e-02   -2.563962980929007e-02   -2.144967231960393e-01; -5.435661761392803e-02   +2.118443471138053e-01   -1.045583313399941e-01   +3.866667268959823e-02   -3.589309754605212e-02   -3.974303479410068e-02   +1.167029321341777e-01   +2.718240598158367e-02; +1.996677201341393e-01   -3.758166202650494e-02   -3.080698028615227e-02   -1.550931818058223e-01   -3.513559806020200e-01   +2.103234441242817e-01   -2.526219379674919e-01   +1.572207749003155e-01; -4.472935700015479e-02   -5.361644074701928e-02   +2.689269776663726e-01   +9.979829159662024e-02   +1.856453004015282e-01   +1.575588549972146e-02   +1.535803805797268e-01   +1.668450883309353e-01; +5.530112725902336e-02   -9.309808418966388e-02   +1.730742120401028e-01   +2.460692677503988e-01   +1.833837840875079e-01   +1.004081986552076e-01   +8.429533169486546e-02   -2.228950613434241e-01; -2.617353953399528e-01   -1.807433748153499e-01   -1.167830932046408e-01   +7.843100569469326e-02   -1.438487571170343e-01   +2.487183818495971e-01   -9.868975383666834e-02   -9.193793634047200e-02; -4.565444586056004e-02   -1.190222311909438e-01   +2.194511078564979e-01   +2.402001503378835e-01   +6.794835602007079e-02   +2.952464078831606e-01   +3.776449166354578e-01   -1.101525640023371e-01];
L3I_L3E_iAMPA_netcon = [-1.416043994350841e-01   -1.659262726445232e-01   -1.095010438542215e-01   +2.077869992726677e-01   -3.372996226841682e-01   -1.671990811364145e-01   +8.875827886813244e-02   +1.062623584780694e-01   +1.138036525218539e-01   -1.133620384250108e-01   +7.678494760709344e-02   +1.619824243168715e-01; -2.059448164106492e-01   +4.599963810493326e-03   +1.901518585982350e-01   -6.229775413316666e-02   -1.168980423121504e-01   -2.015862172243800e-01   -1.387207396022192e-01   -1.272292329972922e-01   +2.221628868111748e-01   +2.337141896101385e-01   +8.528859835538227e-02   +8.589393686923691e-02; -1.030890815735859e-01   -2.103333239207701e-01   +1.381476446501523e-02   -3.553382877196493e-03   -2.706292587719597e-02   +1.821148566110570e-01   +1.924092697213929e-01   +3.299232963195814e-01   +3.211143998849940e-01   +1.472334936874719e-01   -1.760391045691071e-01   -2.822175673209402e-01; +6.694911207744363e-02   +2.071454804597939e-01   +2.462711260194202e-01   +5.623125439955743e-03   +2.894073492128030e-01   +1.024635296361251e-01   -9.719316633542829e-02   +1.051281510859275e-01   +7.725582671942163e-02   -1.635502766742254e-01   +8.655137899084601e-02   +4.111526264597866e-01; +1.728097435435166e-01   +4.526338982900778e-03   -1.524782875000505e-01   +2.696989098904787e-01   +7.370777517397623e-02   -7.695135324362774e-02   +8.839205852036751e-03   +1.266697722688014e-01   +1.368600240125154e-01   -1.501790852280111e-01   -1.075521115792597e-01   -1.367212102607732e-01; -9.850653798127652e-03   -1.977777736611342e-02   +3.543212222999129e-02   -2.989202118335699e-02   +1.420128325721618e-01   +1.132547756289981e-01   -1.352423779323387e-01   -2.103111968480612e-01   +4.598601534409615e-03   -9.079031798270190e-02   +1.308403563399766e-01   -1.525158690614335e-01; +1.457172673169693e-01   -1.629406442978741e-01   +4.693825248086030e-02   +2.312036144959388e-01   +7.484302659198290e-02   -3.605242460063521e-02   +2.959919251257167e-02   +2.307785093959980e-01   +1.073788807204838e-01   +1.972815563701954e-01   -2.749057651689374e-01   -1.230455706330310e-01; +1.655166418381437e-01   -4.294153359094234e-02   -8.388242974047368e-02   +1.627190462282180e-01   +7.193674208650137e-02   +3.247658314709834e-02   +2.586011710559587e-02   -1.779109073460621e-01   +1.416361059781061e-01   -2.498421779184741e-02   +1.347913930783954e-02   -1.489752392685952e-01; +2.690700776952074e-01   +2.639126206839530e-02   +2.371923042857406e-02   -5.798766730407100e-02   +9.833765334602809e-03   -2.347429194246327e-01   -6.914261494819991e-02   +1.745954221046334e-02   +5.520691319367717e-02   +1.804098342385232e-01   +1.868940409080639e-01   +5.311815927405761e-02; -1.206472750824444e-01   -6.560637919077641e-02   +2.050565470432378e-01   +2.906225167379593e-02   +1.794166752159396e-01   +6.733222786264823e-02   -1.263097904228103e-01   +1.376705240504468e-01   +5.665765202362039e-03   -6.027648071509196e-02   +2.226442816752046e-01   -9.848191633587727e-02; +1.005610113266905e-02   +1.042214303521584e-02   -8.974922543920778e-02   -5.145383033732263e-02   +2.067924557260639e-01   +1.753663008986919e-01   +4.477081993040595e-02   +9.612516988373974e-04   -2.224400409713307e-01   +1.214439125340704e-01   +2.217774211022750e-01   -1.819530114212417e-02; -2.115745217576068e-01   -6.944566107754693e-02   -9.634365015785196e-02   +1.735598352176017e-01   -1.822009467819160e-01   -4.407544988437262e-02   -9.261812602328774e-02   -2.060454174303671e-01   -3.851259638513624e-02   +1.606716466188399e-01   +3.789720870805270e-02   -4.810381361211265e-02];
L3E_L3I_iGABA_netcon = [+7.196111068537668e-02   +3.114499839180751e-02   -9.964034239351398e-02   -1.378330676440206e-01   -6.125005867779899e-02   -8.951464646891605e-02   -2.629695456793255e-01   +1.479442010503165e-01   +2.738922829116927e-01   -9.172312692203377e-02   -1.534872649336642e-01   +6.722732933890344e-02; +3.263560376206125e-02   +2.825268210134731e-02   -6.248388238161540e-02   -9.414236019821755e-02   +7.936256088448504e-02   +3.940765559384470e-02   +2.351865639204240e-01   +1.222382827846268e-01   -1.009223568300722e-01   -2.207540882187291e-01   -1.493751132275130e-01   -1.904680316412821e-01; -2.265927729334673e-01   -1.280745905315537e-01   +1.240819344039586e-01   -1.652709727865010e-01   +2.769726633588594e-01   -5.384938454377584e-02   -1.820495816666657e-01   -8.125412655553621e-02   +1.600370713861887e-01   +7.099856216578265e-02   -1.097707378963681e-01   -1.394662195514738e-01; +2.272082595956533e-02   -3.263198554625783e-02   -7.459472308109241e-02   +2.382584557606621e-02   +8.000785026536771e-02   -1.674948767695572e-01   -1.617226792830946e-01   +1.654827934548921e-01   +5.895744053463808e-02   -2.790888744998177e-01   +6.539498388508963e-03   -1.793756596884568e-01; +2.178053038270163e-02   -1.113097623055417e-01   -8.356125747706157e-02   +2.007434167294412e-01   -1.583802778292187e-01   -4.933108574743264e-03   -9.725272684455524e-02   -1.491486717632860e-01   +2.109004470570792e-01   -1.297436232083407e-01   +1.454369293091870e-02   -1.536607090646593e-02; -8.753281742458317e-03   +4.748549629982347e-02   -8.835774843543347e-03   +2.073105837363961e-01   +1.074736959356267e-01   -8.707435566247156e-02   +1.808214841903079e-01   +2.864785876371816e-02   +9.852708123160606e-02   -2.198307037395447e-01   +1.962949454080212e-01   +9.044743432157584e-02; +1.786104970725511e-01   +3.665729726780304e-02   +1.182826083448918e-02   -2.759599303272863e-01   -2.529749859134613e-02   -1.597389748080738e-01   +7.867568904668049e-02   +1.354435162833918e-01   -2.262330207830794e-01   +7.850368546372993e-02   -1.873920856661422e-01   -8.295698276713115e-02; +1.627957194645673e-01   -9.757346403512072e-02   +1.452345022850489e-01   +1.715339046355419e-01   +4.703720087472454e-02   +1.354643170902540e-01   +2.044336627760945e-01   +8.625722021288830e-02   +1.446897109720114e-02   -2.307243998819795e-02   +1.973164879929649e-01   +5.073722459003722e-02; -5.705878981677626e-02   -4.697271061350670e-02   -1.726935773597274e-01   +4.595969656774265e-02   +5.412742250069948e-02   +5.926726805193470e-02   +1.480782536549859e-01   +1.831142662280597e-02   +1.722674051115428e-01   +2.334246733652799e-01   -2.555095719872133e-01   +3.020390861391315e-02; +2.448677159996901e-01   +2.056558326980788e-01   -3.430969515472478e-02   -1.508081816836210e-01   -4.817044972037081e-02   -4.955678773447338e-02   +8.788624047318715e-03   +8.090724333809276e-03   +2.877941301446451e-02   +1.083942740937156e-01   +3.191722209961610e-02   -2.690073846438990e-02; -4.370458371433024e-02   -4.481211336673801e-02   -3.844068777853494e-01   -1.603465119893616e-01   -2.501203588970332e-01   -4.140145137609921e-02   +1.450111145588607e-01   -6.141473493618595e-02   -1.451915694814606e-01   -1.313455422552633e-01   -4.269960003664648e-02   -4.457320977429757e-02; -1.162313799398468e-01   -2.682126157316426e-01   -7.083923199912333e-02   -7.136269656663936e-03   -1.952072333854329e-01   -8.019588864283014e-02   +5.196032682155054e-02   +3.429081254752667e-02   -1.652527382968486e-01   +3.788283443986495e-02   -8.152405523103192e-03   +1.505885130994192e-01];
L2E_Input1_iAMPA_netcon = [-1.669869442559268e-01   +1.155959706912055e-01   -3.814688283346181e-02   +2.831338913271167e-02   -1.459377342334409e-01   -1.221340582500226e-02   -2.210635240288935e-01   -1.315575472900755e-01];
L2I_Input2_iAMPA_netcon = [-8.368110539337842e-02   +1.466162647369276e-01   +5.076499306907060e-02   -9.607154231992687e-02   -1.249729222776273e-01   +1.543218898178081e-01   -2.749226363768872e-01   +6.694805795706003e-03];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
