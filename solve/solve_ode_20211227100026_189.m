function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.693355199991574e-01   +1.847280580773564e-01   -5.843972920828273e-02   -1.048354304373257e-01   +1.728913264590653e-01   -1.094793049510024e-01   +7.759491013869843e-02   -2.700443991382590e-01   -4.543969689499425e-01   +7.246203946373153e-02   +6.792171388473900e-02   +8.854352582995106e-02   -6.879627475391503e-02   -7.007233712941463e-02   +2.760483110793018e-01   -3.740557051221492e-01; -1.558672157806381e-01   +1.363314259835757e-01   +4.163532721091890e-01   -1.380295835804987e-01   -2.456600796428547e-01   -3.460331979077677e-01   -2.090718733419918e-01   -1.212349340180053e-01   +1.244999561321813e-01   -4.793777612652858e-02   +1.787411565558670e-01   +7.270990594420529e-02   -1.452181211122298e-01   -3.424035202867844e-02   -8.519471611797994e-02   -9.508767581461744e-02; -8.779275715615356e-02   +9.582406343210323e-04   -2.198298035456976e-01   -2.101340453369474e-01   +2.659783244636712e-01   -1.202602377140238e-01   -1.030186581244641e-01   +1.768083628810522e-01   -1.135440158065878e-01   -9.247429817562217e-02   +7.300687983672988e-02   +1.850472676807879e-01   -1.341678828747446e-01   +1.048860597034819e-01   +3.311783212413589e-01   -5.687189933423014e-02; -8.639775871179503e-02   -3.341647475303849e-01   -6.334824861247153e-02   +9.977045916154101e-03   -2.323905608109825e-01   +8.148348064852977e-02   +2.815652245501049e-01   +2.130443649763335e-01   +6.758542746099896e-02   +3.953773341994718e-01   -1.275378777359715e-01   -3.567421137224983e-01   -6.010858808126162e-02   +1.847566270547862e-01   -1.601231514543340e-01   +1.640054912816876e-02; -2.847237602581093e-01   -7.151941725726539e-02   +1.037821136619513e-02   +1.417295323245731e-01   +1.402704871886592e-01   +3.481410212649318e-02   -2.428418409311258e-01   -3.395023591716323e-02   +6.246646946105450e-02   -6.709830444350189e-02   +7.131378130901780e-02   -8.752813849470426e-02   +1.580078836830451e-03   +1.520384009380985e-02   -1.780913745579106e-01   -1.622444039643339e-01; -1.565264793993638e-02   -5.601473192247217e-02   -1.455091102972778e-01   +4.075472289608829e-02   -2.602014270423504e-01   -8.649560618189189e-02   +1.409212031544972e-01   +9.400998290089613e-02   -1.403768939737534e-01   -3.085278761721997e-01   -7.777575670782093e-02   +8.676934736762973e-02   -2.890970464390977e-01   +8.146258232058941e-03   +8.717694611007548e-02   -3.082401669005463e-01; -5.409098018306790e-02   +2.340518741995006e-02   +2.509146689459031e-01   +3.091579680327103e-01   +1.473278066182135e-01   +2.257256776895970e-01   +1.347318213118229e-01   +1.657145193369493e-01   -9.489873348578948e-02   -3.973640082148834e-02   -1.191776545325443e-01   -1.774702252568383e-01   -8.187759273302031e-02   +9.639388528254397e-02   +1.101423341610460e-02   +2.811218272244686e-01; -2.037008093302557e-01   +1.704331434197453e-01   -7.289095499470793e-03   +1.926655448580045e-01   -2.143381842956164e-01   +5.018553678304583e-02   +3.014429343472373e-02   -3.075360560106078e-02   -8.245934430676315e-02   +2.886464129023953e-03   +2.718502275833988e-02   +2.464439543455391e-02   +2.423564235502807e-01   +2.338236995902835e-01   -2.399323981402509e-01   -2.240779046815188e-01; -4.095630250456510e-02   +7.428571756121449e-02   -3.165561289697919e-01   +1.831796635918741e-01   +6.135246479640286e-02   +1.875497007783050e-01   -2.987835870481639e-04   +1.345206982965289e-01   -2.209780306624987e-01   +1.497193234466201e-01   -5.338059246126215e-02   -1.444856047922500e-01   -1.372280510468995e-01   -2.732756176542619e-01   +4.034452858166866e-02   -1.492199455569958e-01; -1.070200543291749e-01   -2.738003114180881e-02   +1.895474876157289e-01   -1.246790782455445e-01   -8.209367185089532e-02   -1.794909027610322e-01   +2.162460874682408e-01   -2.064352090158405e-01   -1.012634190108249e-01   +1.909183962627626e-01   +1.918410571814624e-01   +8.824282221711303e-02   +2.633767975051497e-01   +1.147078216946887e-01   -2.446569462503926e-01   -2.376585025107832e-01; +2.214340190023071e-01   +2.418333743245424e-01   -9.780610692028005e-02   -2.722158953314222e-01   -2.698243686318514e-02   +6.446885588340902e-02   -1.236491352718947e-01   +9.259755170979488e-02   +9.930462058581702e-02   +8.588837942901723e-02   +1.617520533966237e-01   -2.119818566441478e-01   -1.681731951174318e-01   -5.585515042205320e-02   -9.293046594993283e-02   -9.256623233921166e-02; -1.602782128184411e-02   -8.982537507712579e-02   +1.640645350533555e-01   +3.062038565598850e-01   -5.816568740303010e-02   -5.899107345876828e-02   -4.643745962742993e-02   -1.075093971104974e-01   +2.001144285615851e-01   -3.649111652807018e-01   +8.633268111740626e-02   -3.361626765510878e-01   +5.508665860069119e-02   -1.605869890006091e-01   +1.870373186175437e-01   +1.326043026173107e-01; -9.774657616421389e-03   -3.295045778509991e-01   +3.457442000385559e-01   +1.217820852585618e-01   -1.092395132955601e-01   +1.476248242265465e-01   +1.505198940218169e-01   -1.241465855347253e-02   -2.961925063898135e-01   -3.701394572105753e-01   +2.584807613412741e-01   +8.137600735854797e-02   -1.720450592443049e-01   -2.413444485117312e-01   -5.048333515165720e-02   -5.171855858527913e-02; +9.033645646560305e-03   +1.417479246294059e-01   +7.179347853551490e-02   +6.772978898108599e-02   -3.070164455159736e-02   -6.367280158991080e-02   +1.619593599195128e-01   +1.103110601428845e-02   +1.411416644757306e-01   -2.503841194729830e-02   -4.068073131317015e-01   +4.647073912345688e-02   +3.342093298520387e-01   +1.447188807315343e-01   -2.937695988369254e-01   -2.636257016275195e-02; +1.422093341644185e-02   +1.083880728641059e-01   +3.048304577953973e-01   -1.178273456342535e-01   -1.210475141235413e-01   -5.254928715727215e-02   -1.836137853856874e-01   +1.483283087147975e-01   -1.422090396250721e-01   -1.838679147647072e-02   +8.803931191386764e-02   +1.828921115414602e-01   -2.780576418745217e-01   +5.653914877601900e-02   -7.343596903813844e-02   +4.270163162615719e-02; +5.989166434512671e-02   -1.653772255877682e-01   -2.883779020304016e-01   -1.791676335959878e-01   -3.108014642587177e-01   -4.660982115247950e-02   +7.500287848109206e-02   +7.967156632481226e-02   +2.042745658430900e-01   +1.966984155633848e-01   -2.286162282443507e-01   +2.803205306383332e-01   +9.224212830928784e-02   +5.165751080949094e-02   -4.660812947301667e-02   +2.735008985224903e-01];
L1E_L1I_iGABA_netcon = [-3.705286193597886e-01   -3.552680707016764e-01   -2.103251131772962e-01   -1.895594063533265e-01   +3.964571226753475e-01   -3.452135161265855e-02   -1.526096422185465e-01   -2.643556907943836e-01   +1.540671373360590e-01   -2.057878897486122e-01   +4.702138673662461e-03   -1.374542718669634e-01   -1.976944815644035e-01   -1.247002023556143e-01   -1.126911634473137e-01   -9.507872579911224e-03; -1.144609995772580e-01   +3.684095307613059e-01   -2.216964423860764e-01   -4.514919587424534e-02   +2.332369485520677e-01   -1.493217219578560e-02   +1.776081954717846e-01   +1.328479901798141e-01   +1.124405246820270e-01   +5.061119739254903e-02   +6.552648558987494e-02   -3.393159578175489e-01   -2.597747547674912e-01   -2.636721225940839e-02   +1.255577849734590e-01   -1.168874808726877e-01; -1.576399290005460e-01   -2.039170888440854e-02   -1.940194162592474e-01   +1.752051647206448e-01   -1.677927120144257e-01   +1.684220832996241e-01   -3.796703024285800e-02   -1.729192998581468e-02   +2.152377577606886e-02   +2.274455012597364e-01   -1.939743552161403e-01   -8.209090401537916e-02   +7.948776852449756e-02   +2.933178487156079e-01   -2.652323574262068e-01   +2.735930056835735e-01; +8.672218542888549e-03   -1.191051451624139e-01   +2.571987127268299e-01   +3.137175954445034e-01   +1.110298922192856e-01   +1.787254171986847e-01   -2.262156935404562e-01   -1.947382941515539e-02   -2.746623712179525e-01   -5.353911428242329e-02   -1.828773771227689e-01   -1.562753940850602e-01   +3.658983778259982e-01   -7.472677087793253e-02   -2.077193884812836e-01   +4.340833202973798e-04; -8.511918899557766e-02   -3.169104681914228e-02   -8.612214868927601e-02   -5.921701625475598e-02   -5.419014790240245e-02   +6.825641365462280e-02   -1.675395463519839e-02   +5.497368174822777e-02   -5.057203633531338e-02   +2.888584002298064e-01   +1.377897844046977e-01   -1.437119335696481e-01   +2.610690612834499e-02   +1.265936405400033e-02   +4.168219806075203e-02   +6.158531842611727e-02; +3.333421039729307e-02   -2.223207403759147e-01   -1.044677352617588e-01   -2.513889433534344e-01   -2.149076947619225e-02   -1.720673554683583e-02   -2.383687759666836e-02   -1.329385072710998e-01   +2.864805120921124e-01   -1.282143039588169e-02   +1.144605883833641e-01   +1.014474941072710e-01   +8.263829095601227e-02   +1.596882664292061e-01   +2.859294667044714e-01   +1.227948989550449e-01; -5.584777207924123e-02   -1.258723370155831e-01   +2.577415858219173e-02   -9.932283476681197e-02   +1.655898681046367e-01   -8.068838086158731e-02   +1.706229646599660e-01   +2.628057765707582e-01   -1.139472936712899e-01   +1.418882055577280e-01   -6.335175932891811e-02   -2.688199491583630e-01   +1.621500843481516e-01   +1.736961732724550e-01   -1.061046024115674e-01   +1.844809871551130e-01; +7.022413141270015e-04   +7.276761617202823e-03   -4.945172826332562e-02   -9.010841787049612e-03   -1.409019350930072e-01   +1.722731514302014e-01   -8.276405230886588e-02   -1.306454785622753e-01   +1.280772756541121e-01   +3.011095439741240e-01   -1.953023656293147e-01   -1.120893801076955e-01   -3.006588762660515e-02   -8.066265649564013e-02   +7.884070760528895e-02   +2.453902800806261e-01; -1.059711692160394e-02   -2.773184519331688e-01   +2.073846274001643e-01   +2.682704472438819e-01   -9.068526309958469e-02   +1.290747746168565e-01   -1.159410447514283e-01   +1.045913115570007e-02   +1.860231280845103e-01   -1.291250807298788e-01   +3.620468770736963e-01   -1.389783824388166e-01   -9.167073737997558e-02   -1.294924622461863e-01   +2.957071561569486e-01   +6.981970338173325e-02; -2.184179008861806e-01   -1.469415281118254e-01   -1.018909195289515e-01   +2.862127179707381e-01   -2.152583787171639e-01   -4.595434887799897e-02   -2.392770706295562e-01   -1.586536783713108e-01   -9.229327833475084e-02   -2.841860007351028e-01   -2.216548041543131e-01   +2.009104533513191e-01   +2.354754827328561e-01   -7.064366711031569e-04   +2.837936822572634e-01   -4.266855502447343e-02; -1.682895877056286e-01   -1.368336349541847e-01   +1.709325353078209e-01   -1.213919937389551e-01   +5.812106328126248e-02   -3.181396593456963e-02   +3.390248118120389e-01   -1.228941398496020e-02   -1.112716010595684e-01   -2.810214539260197e-02   -2.233222441300789e-01   -8.639475733623947e-02   -1.592759643570986e-01   -6.239636203336076e-02   +2.884939416552675e-02   +2.383959446861338e-02; +2.648850707335119e-01   -2.753797537635504e-02   -1.730188500098635e-02   -9.334519714551519e-02   -3.136185737432334e-02   +1.986972614066196e-01   -3.313275660709606e-03   +2.096936350165875e-01   +4.809827866032972e-01   -2.049517899728309e-01   -1.174311490030266e-01   -1.490980862788096e-01   +2.729227904250922e-01   +3.545081963708531e-01   -1.831264758296490e-01   +9.187575175856388e-02; -6.389182124759675e-03   -2.260261515809153e-01   -1.259638770906112e-01   -5.591423943055614e-02   +7.311250855676135e-02   -1.088064841599157e-01   -1.428604217665707e-01   +9.805202257000875e-02   +2.071755464098071e-01   +2.874338817620455e-02   +7.449508633608268e-02   +1.298565000054263e-01   -3.530654809173770e-02   -2.327632510731137e-01   -1.099602405912807e-01   +3.786262700469729e-01; -1.865627846363511e-01   -6.708980576764803e-02   +8.377216151825373e-02   +1.944154452647149e-01   -8.012841822123756e-02   -4.647446778214270e-02   +6.655048388118584e-02   -3.437429174987100e-02   +5.995280728131373e-03   -2.662444769409912e-01   -2.078728438240914e-03   +5.467345209333618e-02   -1.766300812813225e-02   -7.890483041829183e-02   +1.579347437966800e-01   +3.914301333646571e-02; -2.663541240511759e-01   -4.041231913560761e-03   +2.732503021439898e-01   +2.181358844653115e-01   +2.000426974501229e-03   +1.865900123209057e-01   -2.342403592174874e-01   -1.325434238887822e-01   -8.379663867238105e-02   -1.878742829933621e-01   -1.183964008271855e-01   +2.184206047808384e-01   +2.185433244534948e-01   -2.112042974114230e-01   +1.374372209760745e-01   +1.127033291738354e-01; -1.813171657600180e-01   -1.080189248741727e-01   +1.113761055406560e-01   -2.938133748197050e-01   +1.038981229774407e-01   -1.070974847227114e-01   +2.069571695351062e-01   +1.326642638050143e-01   -1.226647599093175e-01   -1.454402093441937e-01   +1.953060675581028e-03   +8.113066359459464e-03   +1.339498414657341e-01   +2.212196736404153e-01   +2.557637792506180e-01   +4.689871277243597e-02];
L2I_L1I_iGABA_netcon = [-2.597694954652796e-01   -4.813976922993407e-02   +1.673805797666870e-01   +1.787170651507045e-01   -3.659857226511488e-02   +2.436785925464358e-01   +1.243192890275088e-01   +8.662533150088225e-02; +8.510860513745000e-02   -2.400789322554247e-02   -7.737057291898991e-02   -7.115882929606218e-02   -3.346248206874722e-01   -3.889027690420974e-03   -9.733431598665586e-02   -2.244873382807242e-01; -1.683632748967600e-01   +2.127671760572602e-01   -9.879836980290634e-02   +2.523832803886541e-01   +1.723147881320932e-01   -9.438883435763659e-02   -1.128617869827847e-01   +1.213027782139589e-02; +1.961066284510710e-01   +1.611381976156182e-01   -2.846630929417453e-02   +1.212643161443785e-01   -7.656459207731892e-02   -6.227627652249859e-02   -1.268512727631878e-01   -9.609317093000480e-03; -2.048679150898801e-02   -5.289296171474560e-01   +9.971509010544541e-02   -4.949552108868803e-02   +3.598619748058534e-01   -5.469728323210632e-02   -3.598898526566017e-02   -5.815072211924165e-02; +1.489541215413887e-01   +5.548206488709025e-02   +2.628323338709218e-01   -1.227512605527117e-01   +2.055431901763894e-01   +1.482436457816544e-01   -1.197523311126582e-01   +4.473543504790650e-02; -9.178128930567137e-02   +1.631257247642426e-01   +1.206561299178319e-01   -1.507122500591250e-01   -2.835187408344191e-01   +1.146530481041203e-02   +1.818839132637812e-01   -1.198903911118748e-01; -1.529019247716755e-01   +1.120453787956234e-01   -1.233980410024261e-01   +2.423883030495614e-01   +2.298071963494772e-02   +2.679513955842679e-01   +1.511500094419328e-01   +3.554586822354181e-01; +1.633189520539913e-01   -2.117341072689215e-01   -6.586072363536147e-02   -1.115716363542681e-02   -2.051720917954123e-01   -1.314500114673023e-01   +1.596401682800117e-01   -4.803627861749097e-02; -6.977312258348387e-02   -4.270946502526586e-02   -1.578675813503742e-01   +3.894761033127516e-02   +4.733225234065351e-01   -1.088022147686491e-01   -7.897150621517092e-02   +9.605909063077146e-02; +3.269622635307116e-02   -1.279409128786489e-02   -7.818967871431649e-02   +1.515701618617781e-02   -2.400369724853874e-01   -1.404554661263052e-01   +7.749856893285351e-02   -1.292379848051810e-02; -2.087687021583196e-01   +1.410071782310910e-01   +8.926588709856828e-02   +1.368508375477186e-01   +3.308934335604845e-01   -1.240346888811639e-01   -7.254817362807318e-02   +1.105390506414891e-01; +1.291088827169749e-02   +5.448483955877324e-02   +1.504236666929252e-01   +1.301504248783861e-01   +8.425517186579129e-02   -6.571899583222812e-02   -1.055182276606080e-01   -5.841117877201712e-02; -8.071243765601521e-02   -2.296412989452982e-01   -2.377161131827708e-02   -7.299805536479689e-02   +1.976663108335178e-02   +3.008312082666668e-01   -2.235936014833427e-01   +4.045343106436668e-04; +1.129912930643365e-01   +1.609229192227020e-01   +8.022174062318611e-02   +1.027602395806957e-01   +8.250243367758153e-02   -2.589316248949024e-01   +7.320153452942028e-02   -8.135286624107513e-02; +1.819662876665049e-01   -7.925868630151522e-02   +1.745406054204178e-01   +9.747349169637308e-02   -5.362894270286888e-02   +8.010096321386311e-03   -1.379468130517086e-01   +1.217224369209970e-01];
L1I_L2I_iGABA_netcon = [-3.403952833641500e-03   -3.741263101503388e-01   -2.208749052502830e-02   +1.450922198488593e-01   -1.579520351138370e-01   +1.201516199924104e-01   +1.237952297570489e-02   +1.742651245279346e-01   +1.656419979761082e-02   -5.683434467565891e-02   +1.351066952423645e-01   -1.363229140734744e-04   +3.428938431013635e-02   -2.718315585737324e-01   +1.244294603573594e-01   -8.176651690171240e-03; -8.431789599954660e-02   +4.647251758667383e-01   -9.531818671660533e-02   -3.464546642508903e-02   -1.247684638927437e-01   -2.703279493857415e-01   -2.785295604928472e-01   +1.323277020951605e-01   +2.410140333881746e-01   -4.234891687051465e-01   -1.131619682218099e-01   -6.827371587306745e-02   -1.155408510007772e-01   +7.721999280747302e-02   +4.536576718386852e-02   +1.251156795632328e-01; -1.273788734360333e-01   +1.276621804100266e-01   -3.708646342953619e-01   +8.793087783277104e-02   -1.833853784950194e-01   -6.433267224838701e-02   +3.977927586225637e-03   +5.623571084608841e-02   +2.040715340032986e-01   -1.301935273283235e-01   -2.174065093331668e-02   +1.051862022801732e-01   +1.886835484391582e-01   +7.789249479630304e-02   +5.295243054131984e-02   -6.028554612467470e-02; +1.989223036915849e-01   -1.568938555140667e-01   +2.101692650462745e-01   +2.416854548472518e-01   -2.404783516249773e-01   -2.495573369419124e-02   +1.484475197646747e-01   -8.051961518429546e-02   -1.423442614886977e-01   -7.182500396558765e-02   +5.838785066678213e-02   -2.019359893951865e-01   +5.870474122376380e-02   +1.106299314048835e-02   -3.036597377788946e-01   -4.273509598737252e-02; +2.258433585514993e-01   +5.992068326036992e-05   +1.847875863263417e-01   -1.355966980115236e-01   +8.324704542969415e-03   +7.757967187518013e-03   +2.045074123220270e-01   +2.579485697208427e-01   +1.050261801130995e-01   +1.736019247515225e-01   -2.292034845091284e-01   +6.187863955377380e-02   +5.365648474241208e-02   -7.010295635381765e-02   -1.936467641529089e-01   -1.266551771140715e-01; +8.367102285023117e-02   -1.618040437676635e-01   -1.302443088358704e-02   +1.106867459011264e-01   +6.374137415581549e-02   +2.713858328544431e-01   -5.269104485323200e-02   -2.751654822751526e-01   +1.652801540804841e-02   +1.656970435260154e-01   -7.234280871003144e-03   -8.098019499230141e-05   +3.213308746315714e-02   +1.052464534876667e-01   -2.714145016599452e-02   -1.189249604191602e-02; -6.734924453747988e-02   -5.897561301495252e-02   +1.859456231736198e-01   -3.038293078388978e-01   -7.484344623056893e-02   +1.092454097988623e-01   -3.954731734419065e-01   -2.488792734779776e-01   +1.222017012547079e-01   -5.943570218405595e-02   +2.055645244027802e-01   +2.175614235824340e-01   -2.223072373263257e-01   +2.001821818135439e-02   -6.422181158723776e-03   +3.870123608318631e-01; -1.096082344493278e-01   -1.414474409633373e-01   -7.505714571662429e-02   +6.215101020325647e-02   +7.071635194800868e-02   +4.698240686140950e-02   -7.025110311791827e-02   +9.248591660936553e-02   +8.210255020500150e-02   +7.601359918281000e-02   -1.479138225481735e-01   +2.064630192685095e-01   -3.150639258806907e-01   +1.596365752125975e-01   +2.435851965482417e-01   +2.434423824674700e-01];
L2E_L1E_iAMPA_netcon = [+1.385078148576178e-01   +1.916382382548116e-01   +6.993386261097916e-02   -1.637906581310647e-01   +1.510429292318825e-01   +1.313567486020697e-01   -2.728258236762721e-01   +1.465234650489435e-01; -1.978887856012807e-02   -3.652907455649297e-02   -3.832805625931966e-01   -3.423695044455037e-01   +1.790911295053537e-01   -2.397230021560340e-01   -2.356632569548110e-01   -2.195388373821272e-01; -1.011592971744942e-01   -1.168182638419772e-01   +3.467201642985586e-01   +1.195216009253873e-01   -2.054245041222968e-02   +2.406742460355304e-01   -3.451032874096312e-03   +7.014602504650945e-02; -1.350901802115204e-01   +4.627784067386753e-02   -2.196958451124332e-01   -1.551656662701534e-01   +1.305329927638635e-01   -8.643045964601788e-02   +1.913299693890355e-01   +1.344743093433125e-01; +2.095644714370097e-01   +2.216799869389884e-01   +1.245530419925300e-01   -1.400088851797906e-01   -1.401724705285055e-01   +2.611825053816864e-01   +4.285403312815379e-02   -1.848453293216632e-01; -1.467262958457131e-01   +2.080934622155359e-01   +2.055930132670250e-02   +1.562587385401853e-01   -2.223062850461455e-02   -6.824786376624735e-02   -1.785935618754303e-01   -6.668136932367136e-02; +1.305124024562366e-01   -1.736295611766347e-01   +1.812509683998136e-02   +2.925001969505839e-01   +1.639054239030500e-01   +8.508607942452473e-02   -1.935955089266718e-01   +1.348228923663798e-03; -3.790855188644999e-01   +1.582846378230333e-01   +2.634163188560990e-01   +2.402181522684370e-01   +2.419656235691546e-01   +1.016984504011306e-01   +1.642312349570506e-01   +7.223715801299213e-02; -2.193915765206362e-01   +4.239607505347166e-02   -3.897335306632888e-02   +3.377600341914834e-01   +5.201361053102539e-02   +2.114149405715376e-01   -4.591843389959627e-02   -3.085633128458167e-01; +5.250818692722734e-02   +5.034165248607779e-02   +7.224265509926395e-02   +6.049179402861855e-02   -1.052676353677977e-01   -3.318110108047208e-02   +1.926730095473449e-01   -9.400533861796363e-02; +1.237694659415419e-01   -1.452324715698396e-01   +3.191724272829987e-01   -2.535262606282278e-03   +6.201759718918568e-02   -1.054342636628224e-02   +1.057805359492529e-01   +2.204297445739605e-01; -2.791772206390052e-01   -3.546275886417102e-02   -1.431374306710586e-02   -1.940319263800248e-01   -2.464510786026922e-01   +7.527925554408332e-02   +2.526164760350705e-01   +4.134920645509058e-02; -1.480423487859804e-01   -2.108714689801790e-01   -1.794470103695973e-01   +2.866474939361299e-01   -9.528568067109423e-02   +1.047677725196556e-01   -4.032114719432698e-01   -2.039469427379343e-01; +2.021531356239981e-01   +1.076813004448006e-01   +1.187736594574123e-01   -1.312603853516074e-02   +1.062223003682352e-01   -5.206468909559005e-02   -2.928286574499613e-02   +7.648834639890040e-02; -1.166110237875547e-01   -1.583407142853501e-01   +8.282977581591634e-02   +5.879012079099643e-02   +7.395722437089541e-02   -5.548330031350143e-02   +5.032074501265963e-02   -4.108142689239261e-02; -2.897517579637049e-01   -1.870204885019753e-01   +7.107106453396808e-02   -2.304465606784344e-01   +5.940278051791634e-03   +2.270100111092258e-01   +9.880601586036838e-02   +2.786561004444614e-02];
L1E_L2E_iAMPA_netcon = [-1.625698895320487e-01   +1.629508788323066e-01   -3.648871668901071e-01   -8.832951007667661e-02   +9.743339721263951e-02   -1.945112118998505e-01   -1.237351594400331e-01   +1.386548720423957e-02   +1.626454804651054e-01   -8.545401593602625e-02   +4.867013247058776e-02   +1.936957631757371e-01   +1.228309268197571e-01   +1.362562903422100e-01   -1.245407538968394e-01   -3.145967646114275e-02; -1.301610495849687e-01   -6.383921201146942e-02   +5.437951807394042e-02   -7.296449933761304e-02   +1.311037038111489e-01   +5.783051040624807e-02   -4.338581564471739e-01   -2.106770890973119e-01   -3.683824201893485e-02   -1.006563885327433e-01   -2.439584635749607e-01   +1.123753756208792e-01   +1.215734790319060e-01   -6.376276124799167e-02   -9.065473019057527e-02   -2.407806581507093e-02; +1.962071009670500e-01   -1.353427192100971e-02   -9.578726234500715e-02   -7.581696935528059e-02   +2.396269976717398e-02   +1.053490736521450e-01   -2.209797700254615e-01   -7.626649371893336e-02   +4.444339684118117e-01   +7.193817077486286e-02   +2.524555232559823e-02   +1.306943630756905e-01   -1.097592365591904e-01   +1.867398028749178e-01   +1.163574642469152e-01   +2.355864241967368e-01; -2.330742223940633e-01   -1.738891519991674e-01   -3.228986691525101e-02   -9.622905575839566e-02   +1.051381509622193e-01   -1.255974864744998e-01   -1.643189190052106e-01   +1.396996403816338e-01   +1.349356608619705e-01   +3.478946606483087e-02   +6.618017458005283e-03   +7.962726738368964e-02   -3.547882497446503e-02   +4.634063631644997e-02   +1.571450586467556e-01   +2.174650305070373e-01; +5.301828511026020e-02   +2.647159062040428e-01   +1.679530699133782e-01   +1.402497794688249e-01   +9.445811369132126e-02   +1.475812120874490e-01   -2.083001062146925e-01   -3.258895996372228e-01   +1.573372864350941e-01   -2.349401922334445e-01   -2.276549680136736e-01   -6.601430954074974e-02   +1.023274138922478e-01   +4.329295615820927e-02   +3.432291293505151e-02   +3.332568770868923e-01; -2.148140084754059e-02   +7.255462232822374e-02   +5.414484426857200e-02   -2.019766798858713e-01   +9.003029029947625e-02   -2.367399566985975e-01   +8.452816460672961e-02   -1.718716187747858e-01   -3.322349035676789e-01   +9.959890734213578e-03   -8.282740782480716e-04   -4.975195548338013e-02   -6.778367181835891e-02   +7.464279373282251e-02   +1.750091357082879e-01   +1.440606872127281e-01; +1.210536146484960e-02   -1.532116533993834e-01   -3.447429149666971e-01   +9.090433314276763e-02   +3.926720851967988e-02   -2.176648837701913e-01   -5.409408027914170e-02   -1.103300203149155e-01   -1.034874889753611e-01   +4.079588122980108e-02   +8.777509531527028e-02   +3.642482257575279e-01   -3.013806755826093e-01   -1.144056903125814e-01   +3.931080479122432e-01   +8.136092212693969e-03; +2.035478677277970e-01   +9.585779114363066e-02   -1.497066573043541e-01   +1.718782216559377e-01   +7.863750327297631e-02   +2.767296751287448e-01   +5.605978084872604e-02   +1.919709793847286e-01   +1.536564332454541e-01   -1.409158000343207e-01   -1.606361122575341e-01   +2.018435847714166e-01   -9.235914329975325e-02   +1.103893509620968e-01   -2.373654908758690e-01   +1.145902659383059e-01];
L2I_L2E_iAMPA_netcon = [+1.826823956941311e-01   -5.415181749285804e-02   +8.770460150067812e-02   -6.383489880088970e-02   -1.485734958930780e-01   +6.427899379021815e-02   -4.820095484577380e-02   -1.968600981470087e-02; +1.961277111517307e-01   -5.687542972199252e-02   +8.994121823890358e-02   -2.132797359706875e-02   +6.202694120988207e-02   -1.270717482931696e-01   -7.726353333285205e-02   -8.682449481971886e-02; +3.743395827980818e-02   -2.796443275064798e-01   -2.025202377158551e-01   +6.719892681077895e-02   -2.555920831443612e-01   +1.149260491462641e-01   -8.294950749858511e-02   +1.487728181520636e-01; -1.215563653460290e-01   -1.810705748988545e-01   +1.175000392044048e-01   +8.283025285102136e-02   +1.365521453553914e-01   -1.260523839988044e-01   +1.851161295966873e-01   +2.025220046552629e-02; -1.109956455427093e-01   +3.596798503463589e-01   -1.234802377569790e-01   -2.134950544210744e-01   +4.166249405757099e-01   -1.258817530677027e-02   +1.542717009685662e-01   -1.959280571444962e-01; -2.140046335754819e-01   -2.019331029290188e-01   +1.356257056330306e-01   +2.019349956370980e-01   -2.438810693242316e-01   +7.022196891197896e-02   -5.413648266857313e-02   +1.960321617505369e-01; +3.035378559425304e-02   -1.735042089353248e-02   +2.074785478075211e-01   -4.755662111839904e-02   -1.012532366086775e-01   -9.341116331322863e-02   +1.985861225156079e-01   -1.898371772845003e-01; +1.068520886529658e-01   +2.698656415283996e-01   -4.870332536092695e-02   -2.671173093708749e-01   -2.485510706883090e-03   +4.396099318238553e-02   +1.942491557455853e-02   -4.764380803063367e-02];
L2E_L2I_iGABA_netcon = [+2.363260831871608e-01   +3.199231572871517e-02   +1.110709315062351e-01   +1.078754704869180e-01   +1.907320331660197e-01   -1.273770153698642e-01   -9.777052086668248e-02   -3.420200193163883e-01; -8.213531915287917e-02   +3.091071486768771e-02   -1.177560473202181e-01   -6.647887630564404e-03   -7.860842265909550e-02   +9.416691749314607e-02   +3.016733985935476e-01   +1.053014557979523e-01; +2.845858831539220e-01   -1.711255265958491e-01   -9.379232317760254e-02   -5.024278513159868e-02   -2.800582921018930e-01   -1.581597917117368e-01   +7.266087198768861e-02   -5.816512260015859e-03; +6.972366303660116e-02   -1.279976951553279e-01   +6.453033272296707e-02   -7.699209884503795e-03   -1.416180706381310e-01   -3.087368343604990e-02   +2.386233524381498e-01   -5.201754232435421e-03; -3.545225099937648e-01   -8.750144248699972e-04   +1.677498946513504e-01   -4.539163643752750e-02   -1.567634860834909e-01   +1.075942971701507e-03   +3.244363835049843e-01   +5.505946341553181e-02; -9.104606394443154e-02   -1.853187803392296e-01   -7.886524383173878e-02   -4.154787975604864e-02   -1.658699155421311e-01   -1.896688634808954e-01   -1.664175123511758e-02   +7.491101826384755e-02; +1.636514929500588e-01   -1.990053986830626e-01   -1.542258560164089e-01   +6.877470264854808e-02   -2.883355245572783e-01   +2.420199980595080e-02   +1.495028650430041e-01   -4.790588920270214e-02; -9.827704496736372e-02   -2.551614470962660e-01   +2.561630256951248e-01   +4.012762685288396e-02   +1.030288399547433e-01   -1.423832038594187e-01   -6.267784183070864e-02   +3.914333866458922e-01];
L3E_L2E_iAMPA_netcon = [-8.520293204654078e-02   -3.214488830723451e-01   -1.076679258543358e-01   -1.441672392139605e-01   +3.469717323454455e-01   -1.581895744691554e-01   -1.964351126598259e-01   +4.887141844553610e-02   -1.905334311892976e-01   -1.670787507247189e-01   +7.278773063665803e-02   -1.810048625969349e-01; +1.480534848764915e-01   -8.320708161180002e-02   -2.250128730463049e-01   +1.572207272311026e-01   +1.619724362968960e-01   +1.334227241145377e-02   +2.126769301828844e-01   +9.552612383058329e-02   +8.300636544545718e-02   -2.408818739543777e-01   +3.706112797835218e-02   +9.040642271652695e-02; +1.519212601697986e-01   -1.385135232587513e-01   +2.127920521723202e-01   +4.430780945135930e-02   -3.600417795313539e-01   +2.506984187362066e-01   +1.919394435813093e-01   -1.816611336335057e-01   +4.967858622581164e-02   -6.487983930818848e-02   -3.346418274944002e-02   +1.758435501283985e-01; +1.374812296119337e-01   +1.314956788265067e-01   +5.989926558529673e-03   +1.323187103773907e-01   +1.013720510000288e-01   -1.020977023737054e-02   +2.953869390906152e-02   +7.096584478171504e-02   +1.947195484788712e-01   -2.940889177617257e-01   +1.294792997844604e-02   -2.540696888949439e-01; -1.010266516292347e-01   -1.816252115674075e-01   -3.217666732895350e-03   +1.758673134706162e-01   +2.018245963557467e-01   +1.191843810537032e-01   -2.507428628899079e-01   -2.173622132859827e-01   -2.046782303213585e-01   +6.680137998251102e-02   -8.382647183677183e-02   -1.595595302465134e-01; +9.686318096550356e-02   +2.246897130744637e-01   +1.699185768251432e-01   +9.760896877865036e-03   -1.814869986850473e-01   +1.394544561224548e-01   -2.089295547542135e-01   +1.646335277961450e-01   -1.873177245582207e-02   -1.304674032210515e-01   -1.508043155325680e-01   -2.412308854248872e-01; -2.437934873621302e-01   +1.208450603716104e-01   +3.674130205727326e-02   -1.772747603174337e-01   +3.727627911207067e-02   -1.965617471214500e-01   +1.033134133092256e-01   -2.323269450830351e-01   +2.799980319944460e-01   +1.023566724645860e-01   -2.338686798600309e-01   +3.647644131115162e-02; -2.615613605323421e-01   +2.896921748352865e-01   -2.671362852115903e-01   -5.078425599833861e-03   -1.064753331195804e-02   +6.120642211106195e-02   +3.885390453751477e-03   +6.382045758201586e-02   -4.582842226461481e-02   -2.481313525620154e-01   +1.064741548471844e-01   -4.762474096281978e-02];
L3I_L2I_iGABA_netcon = [+5.671092247670421e-02   -8.058858385160259e-02   -1.986188500093238e-01   -1.763656231591002e-01   +1.196964782167338e-01   -1.910771988209349e-01   +3.952065742228102e-02   +5.278339725868456e-02   -5.679941724830314e-02   -2.964508942317212e-01   +7.465319425122395e-03   +1.617602430621587e-01; +1.103844927671991e-01   +8.928739627979364e-03   +2.537400134614191e-01   +8.577879891746713e-02   -2.106526448698708e-01   +1.616115092521120e-01   -1.269670346889534e-02   +1.230583988819915e-01   -4.060974069062180e-02   +3.212096970830834e-01   +6.900636623119991e-02   +2.263498626192390e-01; +1.156008772988125e-01   +2.255412521974816e-02   -6.500799422043538e-02   -4.387528464804527e-01   +2.825463045849592e-01   +2.000488220743137e-01   -1.070152086782386e-01   -4.325789018636013e-02   +2.362596956466043e-01   +4.004084528848034e-02   -8.515666732259941e-02   +2.680425011255568e-01; -1.241137406509977e-01   +1.030604923902736e-01   -3.492290210154778e-03   +5.544517232187750e-02   -2.412032121379298e-01   +1.241798873087646e-01   -1.953811596453502e-01   +2.994602551439102e-02   +2.152477079732653e-01   +9.199723128699533e-02   +6.208003709613223e-02   -1.012562407978629e-01; -1.673511984871839e-02   -8.797049000389917e-02   -1.783601880553323e-01   -1.617596166913705e-01   +3.133054169648842e-02   +1.883837909610255e-01   +2.151956508865834e-01   +3.943239567670079e-01   +2.600548309978067e-02   -3.696806379720919e-01   -3.376393199296509e-01   +2.134287207476715e-01; -1.054492222460904e-01   +1.584022249643768e-01   -1.728663634614742e-01   -2.153313817459503e-01   +4.667798543287978e-02   +5.082444078551889e-02   +2.657654480688263e-01   +2.207301079770879e-01   +3.724942032987014e-03   -1.469220250905888e-01   +1.643513934774905e-01   +1.659999784658602e-01; -4.533383100198752e-02   +1.947565853822324e-02   -1.968124113929747e-01   +2.782703932704387e-02   -2.763164247243415e-01   -1.182394806217324e-01   -4.240813436420377e-02   +2.734045515266961e-02   +2.012374696227685e-01   +1.041771285095205e-01   -1.303112308972470e-01   -3.376204129393636e-01; +5.350382511776385e-02   -2.184431529483423e-01   -1.737317395444095e-01   +2.201837590938133e-02   -9.972053318675622e-02   +3.638266491105405e-02   -1.563805988936745e-02   -2.398387341132115e-02   -1.054940741729044e-01   +2.389552303344423e-01   -9.483688876193369e-02   -2.333455432588185e-01];
L2E_L3E_iAMPA_netcon = [+5.187938154334117e-02   +2.288368609146050e-01   -7.256936000311015e-02   -1.190211160640647e-01   +3.763162455829753e-02   +8.194098747903042e-02   -1.373100464974066e-01   +7.428339665252431e-02; -6.856991434399998e-02   -1.687526900890089e-02   +2.035011560921903e-01   +1.091488573750881e-01   +1.345684919078634e-01   -3.929814962127174e-01   -4.458622298795299e-02   +6.193979668242579e-02; +1.860314662198714e-01   -2.437862943308586e-01   +1.958045319011823e-01   -7.543188985465030e-02   -2.095028912958846e-01   -3.009569031623078e-01   -2.546134116120657e-01   -1.578165599037888e-01; +2.685827039228152e-01   +2.296924199787182e-01   +1.388260763419678e-01   -7.488526849147609e-02   +1.356880612565564e-01   +3.500687644809594e-01   +5.248901314440090e-02   +3.830945846367438e-01; +6.197744032971124e-03   -1.142108877430259e-01   +3.277276368016425e-01   +1.821624801641356e-01   +1.400712599055540e-01   +7.167834943704396e-02   -3.614604353499556e-03   +1.022755824559270e-01; +3.941940440456521e-02   -2.319862315138825e-01   -9.543998881857543e-03   +4.268537510926254e-02   +2.683327007395553e-01   -5.321727478787579e-02   -2.520566257541800e-01   -1.844277883250943e-01; +5.978414300697896e-02   -1.280541566120313e-01   -7.501114525276542e-03   +2.294985999264320e-01   -3.031421069822445e-01   +1.641944843554862e-02   -1.484809486700557e-01   +2.026222295773392e-01; +1.257659941194330e-01   +1.115988219548592e-01   -1.995515361001487e-02   -1.218621610446808e-01   -4.888250357282342e-02   -4.505310232673113e-02   -2.250524241029252e-01   -1.150076536749499e-01; -8.561867378599680e-02   +3.099798454605474e-01   +7.456929682843012e-02   -5.212767727834133e-02   -1.685938515571005e-02   +3.302870201292665e-01   +1.576572444981935e-01   +2.234142849838984e-02; -3.864811107623118e-02   +1.658563317245089e-01   +1.120215401257197e-01   +2.024716684821461e-01   -8.548228132341786e-02   -2.602532638698936e-01   -1.016144423258239e-01   +7.072834478819599e-03; -6.719040997902644e-03   -1.604507971520519e-01   -8.829017540730082e-02   +9.574215966334954e-02   -2.221873072708742e-02   -1.521567193013726e-01   +1.255617281737558e-01   +1.358046285185699e-01; +1.925102860929134e-01   +1.907055689059269e-01   +3.003655151242807e-01   -5.143353685166511e-02   +1.521070505760162e-01   +2.706801554043384e-02   -6.676889687502457e-02   -1.796067936908775e-01];
L2I_L3I_iGABA_netcon = [-1.781347628482897e-01   -6.753627438914440e-02   -6.303773704444013e-02   +1.320580701370104e-01   -9.998425523661908e-02   -2.254085363767867e-01   +2.084137525742575e-01   -7.902733505400036e-02; -4.181350417268238e-02   -3.138930794994341e-02   +2.300697437689381e-01   -6.598699987589827e-03   -3.703304227754425e-01   +1.301090269888828e-01   +3.801988366949101e-02   +1.729151889613318e-01; -9.080575585005642e-03   +9.366064757514822e-02   +2.671369323973373e-01   +9.432539086509144e-03   -2.402359647698086e-01   -1.045471476411649e-01   -2.582988905579246e-01   +1.357710439017331e-01; -8.798421588477555e-02   +9.425682056562493e-02   -3.531188903892669e-02   -2.096072279254364e-02   -1.278014802522609e-01   +1.014540927123719e-01   -2.701095934064474e-01   -1.223167128536784e-01; +2.643705019963383e-01   -1.848411102285566e-01   +1.401663108202076e-01   +9.603246498136803e-02   +5.030610130549662e-02   +2.531619101404918e-02   +2.669421821091269e-02   -2.080809307489623e-01; -2.818615572048218e-02   -1.233360143614122e-01   -3.355277757148222e-01   -3.969409219028636e-03   +1.708630359438860e-01   +2.326686311407622e-01   -2.503388879468234e-02   +1.412664689089327e-02; -3.091725720603263e-01   -6.750217684539353e-02   -4.191071571301998e-02   +9.983692919559867e-02   +3.460406490390164e-01   -8.938960665261957e-02   -9.635417622343591e-02   -4.748390934294594e-02; -1.573881174602756e-01   -3.150853793580399e-01   +1.345225249808779e-01   -8.811654139193199e-02   +3.662869792123302e-02   +2.715622784895259e-01   +7.954771200200476e-02   +2.107875687674580e-01; +2.167051952579701e-01   +2.277141268306969e-01   +8.134191497571296e-03   +7.657880144541700e-03   +1.841388900455064e-01   -2.449293350359686e-01   -4.257452384392864e-02   +1.518036899679211e-01; -1.603252252953956e-01   +4.667395295930860e-02   -3.161932733235618e-01   -1.402021513616198e-01   +3.108487580977436e-01   -3.602672227922431e-02   +1.340616960181431e-01   -1.548354635668389e-03; -9.665761884182840e-02   +8.254752193106314e-02   +1.882072749332473e-01   -1.813366561482757e-01   +1.283392129086875e-02   +3.385921703079538e-01   -4.083916771588935e-02   -1.848943057651466e-01; +4.804806702426992e-02   +5.804652378469985e-02   +8.110561457997911e-02   +6.111521441129691e-02   -1.119732207389466e-01   +4.937563780424997e-02   -2.607781721332083e-01   +5.804743490558234e-05];
L3I_L3E_iAMPA_netcon = [-1.955173372347609e-01   -2.337879080514769e-01   +7.073062658206172e-02   -1.009398368455632e-01   -1.531773609805831e-01   -3.565996409824952e-02   +1.563058300099299e-01   -2.947489712608268e-01   -1.958998920429433e-01   -5.142444681733781e-02   -9.998226445311448e-02   -1.203237580174766e-01; -2.688650218799723e-01   +1.937368626208172e-01   +3.154781534203634e-01   +9.096359849948782e-02   +1.365332164053233e-01   +6.578554044063353e-02   -2.947208753189761e-01   +5.264957767784140e-02   -1.775369863932210e-01   +2.252219846943791e-02   +3.200996514423355e-01   +1.247868231378253e-01; +1.162015058245666e-01   -1.859950358507979e-01   +2.301642534750378e-02   -8.768106185363346e-02   +1.334294524003559e-01   -8.008828384152217e-02   +7.629815927515542e-03   -2.866704173080272e-01   -2.756623042609815e-01   -1.759375406336021e-01   -2.250768312736889e-01   -1.104657055716119e-02; +1.022492079022103e-01   +8.012880431817848e-02   -3.892313928428798e-01   +2.150092073136545e-01   -3.855555522426032e-02   -2.154020532667557e-01   +1.443112903944713e-01   -1.424276717640706e-01   +7.695509661775374e-02   +8.892014134558032e-02   +2.128352958484611e-02   +1.859234160169161e-01; +1.211385897200791e-01   -9.511535660823614e-02   -1.300924195859822e-01   +6.384840137579140e-02   +2.115515166133921e-01   -1.228100768952058e-01   -3.086233469023636e-02   -1.791289805576775e-01   +2.306318251346372e-01   +1.516991925128580e-02   +2.724203353903545e-03   +1.773515328188901e-01; -6.817474943236727e-02   -8.193574207995500e-03   -4.020634145908658e-02   -2.288782257319412e-01   -1.403424920621283e-01   +2.812685191268790e-02   -2.398050837817610e-01   +1.860464879446513e-01   -1.168079006338094e-01   +2.401155709073121e-01   +1.194093163983229e-01   +1.640165168561659e-01; -2.045054569313619e-02   +2.400224126531141e-02   -7.279503545416952e-02   -2.047294916149164e-01   +1.758844844630279e-01   -2.010792486118227e-01   -5.198524719981280e-02   -8.348464313948165e-02   +2.412222922221223e-01   -2.841847927720047e-02   +1.162338395474695e-02   -9.020315525866830e-03; -4.616218347252517e-02   -1.192064777412875e-02   +1.340439880615831e-01   +1.793756157494227e-01   -3.099243469068214e-02   +1.989150128173193e-01   -9.013047054756540e-02   +1.262165751682688e-01   -2.900165578772256e-01   +6.848240035233112e-02   -2.194930861024886e-01   +4.080200343358041e-02; -1.673558989647580e-01   +1.940557930112442e-01   -1.635971593415775e-01   +2.803718068528607e-01   +1.007735796517840e-02   +8.118688698357734e-02   -1.262605428256190e-01   -2.025472063991136e-01   -7.091682210934558e-02   -1.706017028352483e-01   -1.557592817962410e-01   +1.407383808839598e-01; -3.336168714908156e-01   +9.438321323334184e-02   +2.608405514360394e-02   -1.644517317841303e-01   -2.210527615910838e-01   +4.682763238848621e-02   +9.919780544984824e-02   -6.113833092307591e-02   -4.147754592741256e-01   +1.505854336755295e-01   -1.161927550084729e-01   +7.324248493258073e-02; +9.833646703994973e-03   +8.916206505720939e-02   +1.391390320394627e-01   +1.097856612783505e-01   -2.038163555062362e-01   -2.477213539732568e-02   -2.180372421536238e-01   +3.399263195377946e-02   -1.348647115911715e-01   +4.012493974151481e-02   -1.171102483449386e-01   -2.910447277019740e-01; -8.154258320690921e-02   +3.594752995630614e-02   +3.581367821794888e-02   -2.831580499770481e-02   +9.782298618921033e-02   -1.544762288428559e-01   -4.763307871039105e-02   +2.886776189880165e-02   -2.125925414983921e-01   +2.910335744936586e-01   +2.350007488470346e-01   +5.630353017126417e-02];
L3E_L3I_iGABA_netcon = [-1.015239255220450e-01   -2.233605401057094e-01   +5.339944047791306e-02   +2.013159536113661e-01   -5.768769263049252e-02   +2.738342552088346e-01   +2.524186766351953e-01   +2.208748435127725e-01   -1.344545019718790e-01   +2.137845311507491e-01   +1.018070559380989e-01   -5.120631250218789e-02; -4.143442538276916e-01   +1.780852453742402e-01   -6.849097953273531e-02   -2.373716066419721e-02   -1.654182436724694e-02   -9.878166411960257e-02   +1.829608379740862e-01   +4.178099746879246e-02   +3.637515826051654e-02   -4.748749697127191e-02   +6.126180906637244e-02   +3.087110357416691e-02; +2.033145756410010e-01   -7.049832640631962e-02   -1.643744810860404e-01   +2.900680798689497e-01   +2.186687879405514e-01   -1.326933241963547e-01   -3.138990207970411e-01   -1.134034495985766e-01   -3.314815021046102e-01   -9.032502798883116e-02   -3.453783158474117e-01   -4.495159726134002e-02; +2.466524616830360e-01   -3.795633926133269e-01   -1.148715748774084e-01   -1.072277219606603e-01   -1.091081527263657e-01   +3.889599446958596e-02   -2.127736999941585e-02   -1.993057025344578e-01   -1.492033860071159e-01   -8.099219217643189e-02   -3.739253554203902e-01   -1.450255686773070e-01; -1.182591526584704e-01   +1.598964746025108e-01   -9.318963476160184e-03   -3.385190514930909e-01   +1.319402479424276e-01   +1.306941062601387e-01   +2.367971390243399e-01   +2.737855443267724e-01   -2.673687459310075e-01   +1.322771057120660e-02   -3.647085991736437e-01   +2.327288643879336e-02; +3.605576576094165e-01   -5.126244874359133e-03   -6.461850692736691e-02   +2.013939034689248e-01   +2.702590522063067e-01   -2.104008398901093e-02   +2.449889958824696e-01   +1.950382964937919e-01   +1.875398584794179e-01   -2.868836617810447e-01   -1.147531039698005e-01   -7.670408298782534e-02; +2.912997198984306e-02   -3.573777127149544e-01   -7.331358772201951e-02   +4.787589384732577e-02   -2.156053229260498e-01   -2.992122238193102e-01   +1.417796666415790e-01   +1.243565001170302e-01   +1.105388738782913e-01   +1.622570910653782e-01   +8.160002376315389e-02   -2.206253688354791e-01; -1.912254046559646e-01   +8.459921041547908e-02   -8.822554825179366e-02   +1.348217068238916e-01   -2.860986688279983e-01   +2.440598827399197e-01   +3.553656607885786e-02   +3.608663211162990e-01   +6.767461768793688e-02   -3.639154766750077e-01   -1.815837084902312e-01   +6.952075893326166e-02; +6.081596831497824e-02   +9.248948414312487e-03   +1.063931567121230e-01   +7.564844665557293e-03   +1.078060284444567e-01   -2.315570631516776e-01   +5.523751804858287e-02   +2.713184461234862e-01   +9.841422679398863e-03   -8.280978355064411e-02   -5.993386639430628e-02   -1.655541602159279e-01; -2.028924879865594e-01   +2.714102969721055e-02   -1.268268055247039e-01   -1.745158310251042e-01   +1.711647112277546e-01   +2.614334631417093e-01   +2.513095165015961e-01   -6.329739354362436e-02   +2.589331499284267e-01   -8.779738661724243e-02   +4.645554480280868e-02   +5.744685307883723e-02; +1.736951268366133e-02   -1.284750103569976e-01   -9.570614586459375e-02   +1.246302256359855e-01   -1.245804712407492e-01   +1.731423408734160e-01   +7.984258270446284e-03   +3.354151405086785e-01   +9.889112529165502e-02   -9.377313169906051e-02   +1.449747396594905e-01   +4.427543561989278e-02; -1.298617401974168e-02   -1.105984740417761e-02   +5.728637644601374e-02   -1.619393481056444e-01   -1.435161152236613e-01   +7.053033255809205e-02   -2.630216873324092e-02   -2.834584172121303e-01   -3.263032637410199e-02   -1.834100201328180e-01   +2.653595577545828e-01   +8.239220099471395e-02];
L2E_Input1_iAMPA_netcon = [-9.290109317936766e-02   -2.126449779903604e-01   +1.148228630661542e-01   -2.323343081087737e-01   -1.170243687051254e-01   +1.881319813637623e-01   -5.657490126613678e-02   +2.967717199877378e-01];
L2I_Input2_iAMPA_netcon = [+2.352770805390050e-02   -2.676743620711639e-01   +1.412182939218862e-01   -5.641258744861118e-02   -3.202086584498447e-01   -5.912161588569557e-02   -2.586936009881200e-01   +6.659962888841796e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
