function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.597409979413028e-01   +1.133095739261980e-01   +2.163443170326538e-01   -1.995473588862542e-01   +1.526394325868079e-01   -4.153987905288251e-02   -4.850646068042704e-01   +9.878942750548585e-02   +4.436036618381606e-02   -1.481231649787257e-01   -2.245318547483234e-01   -4.447761186347498e-01   -7.731810600461946e-02   +1.293172836849367e-01   +7.580913908861201e-01   -5.534231789510696e-01; +4.782568996500849e-01   +2.523319986934808e-01   +3.074032754228277e-01   +5.298953361518270e-02   -1.010400459694832e-01   +2.888239042284405e-01   -2.797477658181171e-02   +4.932009404636089e-01   +3.778493558622688e-01   -2.526503982902408e-01   +1.403650528384655e-01   +4.371158864967128e-01   +4.006791163051492e-01   -2.590691853900581e-02   -1.965645618194399e-01   -1.659971946930765e-01; +3.073179574624000e-01   +4.564484404665081e-01   +1.553606788486668e-01   +3.160276704453621e-01   -1.521646923408282e-01   +2.581862738829716e-01   -2.472537647117394e-01   +2.533311309898738e-01   +8.757443689977511e-02   +6.023295910564818e-01   +4.913058794280868e-01   -1.098419892887826e-01   -1.562129312879008e-01   +6.443396886209851e-02   +9.649813103852588e-02   -2.247929166284131e-01; -2.432587142785265e-01   -1.658135858845627e-01   -9.517169890450509e-02   -6.220866590817081e-01   -8.164311763502680e-01   -2.350422242432037e-01   -7.405066616701740e-01   -1.594961965222507e-01   +2.470251680468276e-01   +1.390862794185111e-01   -2.961471866966390e-01   -1.175800162621103e-01   +1.619320003925814e-01   +4.618314368662230e-01   +1.672661479946151e-01   -4.381919274850674e-02; +2.493928366011434e-01   -3.012877890107107e-01   -4.941554308035922e-01   +1.616523145984042e-01   +3.290041719705289e-02   +1.498930760884208e-01   +8.192373148706086e-01   +6.918600703282789e-02   +4.357467364239507e-01   -5.890743420151057e-01   -4.182337917160961e-01   -1.538390847444257e-01   +8.324902252847131e-02   +4.914643401922847e-01   +5.220814059593553e-01   -2.155596507703378e-02; -9.088859746149763e-03   +3.279680045420982e-01   +3.306010204411562e-01   -1.732355360490021e-01   +3.548577823673466e-01   +2.868335610022367e-01   -2.075114809448352e-02   +1.516272951265434e-01   -6.348132001519590e-01   -4.742704027951065e-01   -1.433467239984562e-01   +7.826309163587941e-02   +6.474929228089048e-03   -2.002528259892596e-01   +3.360414220486717e-01   +3.134297666188365e-01; -4.950617384433534e-01   +1.583755882805838e-02   -3.508636721356749e-01   +3.794103205469491e-01   +7.513924546825422e-02   -5.027498641353734e-02   -1.937847584139924e-02   +7.586987518158705e-01   +2.673109932142901e-01   +8.930636845260358e-02   +2.218709806350531e-02   -8.060450454588717e-01   -2.114673914160332e-01   -3.127446035356634e-01   +5.118752037379775e-01   -1.398866028965897e-01; -4.920324677818291e-02   +2.189602951242551e-01   +5.064457430781426e-01   +5.912087868159915e-01   -5.992678969816058e-01   -5.652038130569410e-01   -5.501592387856843e-02   -2.243212983276508e-01   -2.577810059705633e-01   +7.385265313116041e-02   -7.553596412191502e-02   +1.645609271373410e-01   +5.615756338821721e-01   +4.662760966625083e-01   -7.518009688331478e-01   -4.404576007643443e-01; +3.472377700019173e-02   +8.554018087770711e-02   +1.905457890014310e-01   -1.173656319687198e-01   -4.670275651916099e-01   -2.594800976865929e-02   +3.184502886487414e-01   -6.962764821782053e-01   +4.568325564813284e-01   +2.696641389389617e-01   -1.840589684715635e-01   -2.193343996202190e-02   -2.924206408914080e-01   +4.640015523997229e-01   +1.984848271879416e-01   -3.292731875031015e-01; -3.265016406324550e-01   +5.615857199222574e-01   +2.634640531243442e-01   -7.595050093904158e-02   +2.698628686754057e-01   +8.630467358628714e-02   -7.559365109632032e-02   +2.652505677164482e-01   -3.150585086159474e-01   +5.223769314234139e-01   +2.760000985303424e-01   +5.559481786064993e-01   -1.468016074918116e-01   -3.595692759307571e-01   -1.773977962796814e-01   +6.966615011901737e-01; +8.313252685595920e-01   +1.563815645476027e-01   +6.260890971538757e-01   +4.005590966368565e-01   +4.106564731890066e-01   +2.196777630721801e-01   +7.534697023407672e-02   +2.092375854344766e-01   -3.517990159659656e-01   +3.388822250095699e-01   -5.442737394778802e-01   +4.330329451538842e-01   +6.242700607201906e-01   -1.190649301966936e-01   -4.267288525991398e-01   -2.521711837799196e-01; -1.726348864852298e-01   +5.148116681850898e-01   -7.170745524326565e-02   -2.759680749605710e-01   +5.334767213718327e-01   +8.866707170099882e-03   -2.954297428157637e-01   -2.469473194986904e-01   +7.161361314492258e-01   -2.039477030161792e-01   -4.591329553038490e-01   +2.017975843483831e-01   +3.953058116756156e-01   +4.077662118633206e-03   +9.215289316517461e-02   +2.703234861629064e-02; -3.215664156906173e-01   +6.152759925488794e-01   -1.464528599141309e-01   +1.724578041030096e-01   +2.809251183731977e-01   +1.212348416092359e-01   +3.371292432609414e-01   -6.750728080220383e-01   +8.726649626702478e-02   -2.020824022516801e-01   -2.352611003460811e-01   +2.158150405333665e-01   +4.788152340014775e-01   -2.145505375295605e-01   -5.260738499411706e-01   +1.167091057555759e-01; +1.804004213322244e-02   -2.954001211826556e-01   +4.710903759909160e-01   +3.994875418183157e-02   -2.917945890198592e-01   +5.346192855058436e-01   -8.605578611317248e-01   -5.277123179922643e-01   -1.553530165938299e-01   +5.742536631526988e-01   +1.034714711161464e-01   +1.360329397399417e-01   -1.741986788367516e-01   -3.887603461401548e-01   -4.370678911426636e-01   +1.923659397114313e-01; -3.134856014709253e-02   +1.751276833460430e-02   -8.400983634668473e-01   +2.164853246231289e-01   -1.263490287961393e-01   -5.015416338114130e-01   -1.325617446616757e-02   -1.290968420128404e-01   +4.464490881466232e-01   +2.393472903951012e-01   -1.713981906633767e-01   -4.081653464388845e-01   +7.967645379098975e-02   -6.070461428581413e-01   -1.733267686326978e-01   +8.923662487768866e-02; +1.100871781353536e-01   -5.201861464038773e-01   +7.878988492290170e-02   +1.000000000000000e+00   +1.840073238246420e-01   -1.883051863269510e-01   +2.880524301515894e-01   -2.363122300606457e-01   -6.650651679723101e-01   -3.351513868903014e-02   +2.322773215812986e-02   +6.242682189997478e-01   -2.724383448191015e-01   -5.165236339602426e-01   +3.315703332488317e-01   -1.966780835434499e-01];
L1E_L1I_iGABA_netcon = [+5.386054823011549e-01   -2.235203379591739e-01   +2.623087889600069e-01   +1.915776164096544e-01   -1.225487418975379e-01   +2.284601902375296e-01   -7.451113038360875e-01   +2.594901927722199e-01   -5.660324218939035e-01   +2.900939884749374e-01   +1.121777649871507e-01   +7.259083960590820e-01   +3.665927052162793e-01   +2.363631550600061e-01   -2.299432212073426e-01   -4.806534996471277e-01; -6.537807168741457e-01   -1.539182026459308e-01   +1.816350492987551e-01   +9.218371645745359e-01   -7.687615949033501e-01   -4.934897502283133e-01   +3.579275789401924e-01   -2.632735893303344e-01   +3.218291373086763e-01   -1.016787990647380e-01   -6.020094815481194e-01   +5.951704844205532e-01   +2.365566137250399e-01   +8.879107166455189e-01   -4.454954270638998e-01   +5.973925340011846e-01; +3.722311122398178e-01   -1.169478271911279e-01   +3.396780146021721e-01   -2.046025737340487e-01   +2.433615302298578e-01   -5.849594416363609e-01   -1.485160575926782e-01   -4.858942495250225e-01   +1.324101573178626e-02   -2.017375480842262e-01   +5.020866521251769e-01   -7.589351030611662e-01   -2.827382088612618e-01   -1.607816971533022e-01   -3.400681560870569e-02   -6.432765138831090e-02; +5.725303478887775e-01   -3.310651587074365e-01   +6.169703136259762e-02   +1.385483710196372e-01   +5.471989940328582e-01   -6.721935606952596e-01   -3.943641893276410e-01   +1.165299594914275e-01   -1.399823954340886e-01   -4.910296572530040e-01   -4.725395766963467e-01   -7.456794541402850e-01   +1.443211806725955e-01   -7.079238397283261e-01   -6.137565237558069e-01   -1.000000000000000e+00; -6.054700158801516e-01   -7.759282231010069e-02   -2.888571116371778e-01   -9.836813245482441e-02   -5.179147763052665e-01   -4.995086834654960e-01   -1.238062886182239e-01   +6.193552883099906e-02   +2.849041443199504e-01   -7.238568360119760e-02   -1.752856545289422e-01   +9.495582509563598e-02   +1.395075640412948e-01   +2.384972735211647e-02   +2.120524421462560e-02   -5.504452877515981e-01; -4.784916177330727e-01   +2.344456229002720e-01   +1.033262485792042e-01   +1.655292163446802e-01   -3.231180213701830e-01   -1.261938515605930e-01   +7.553186200211905e-02   +2.014470001412935e-01   -5.868162089229134e-01   +2.739488884039364e-02   +3.998577786264406e-01   -6.591236656789846e-01   -3.612481789533567e-03   -3.167004203499482e-01   +1.808675022682758e-01   -1.048284805809941e-01; +7.113453040859238e-01   +4.369725027081819e-01   +5.324442706817106e-02   -4.077119166031032e-01   +1.903985942014326e-01   -5.067936851974838e-01   +4.710874827344229e-01   -3.679655136965336e-02   -6.692490822422789e-01   +1.812595026362494e-01   -7.332036535095720e-01   +5.525518671993760e-01   +6.139415250259965e-02   +3.111756278311217e-01   +6.714833746492208e-01   -2.594254552100788e-02; +4.680197783394868e-02   -1.965769997981535e-01   -1.310895977272726e-01   -5.509428206899649e-01   +2.035611847068406e-01   -1.690893493024749e-01   +2.597416114208461e-01   -9.830121594913154e-01   +8.624683264485086e-01   +2.515380720975874e-01   +4.012003925738180e-01   +3.662090082560842e-01   +1.566976902713620e-01   -4.441284256208879e-01   -5.358843549940037e-01   +3.042716161340607e-01; -2.880017183925875e-01   -8.141373384293055e-01   +1.111967051609465e-02   +1.239966867112779e-01   -3.614050385896798e-01   -2.122390759835838e-01   -3.052090960517276e-01   +4.618309381632581e-01   +4.098651162824546e-01   +1.164519560137365e-01   -2.458934243186750e-01   +2.212925189141794e-01   +2.382845929963754e-01   -1.605203360733453e-01   -2.948201014763012e-01   -2.790761651650033e-01; -5.797757469435411e-01   -5.943214247815385e-01   -7.111381509856995e-02   +3.956788124298908e-01   -3.169257052627872e-01   -5.556704786295148e-01   +2.070153872575336e-01   +1.556434768417252e-03   -8.899370421766741e-01   -6.684971821430419e-02   +6.101130385066103e-01   -7.472132295776727e-02   +2.392726705817647e-01   -6.350309913187145e-01   -8.295461901727629e-01   +1.791127115510086e-01; -2.608736746428588e-01   +2.942378748299071e-01   -1.191984546274116e-01   -1.878397211227940e-01   -2.618944919991562e-01   -7.754405039324787e-01   -4.796698092805495e-01   +3.190371891271643e-01   +2.485673515989870e-01   -8.957955268273023e-01   -3.351742766926252e-01   +2.370205655116287e-01   +1.482271846933858e-01   +4.983507443404299e-01   +7.746890658662101e-02   -1.053200695180198e-01; +4.236149132598939e-01   -5.390834239003079e-01   -4.738163801343431e-01   +4.654152824300203e-02   -2.919615665940649e-02   -6.468687185650873e-01   +3.646882393879843e-02   -4.224651442373091e-01   +1.068134259858371e-01   -8.682718097434136e-01   +8.399355129718600e-02   -2.597410573322693e-01   +2.641717903837965e-02   +1.022957919959518e-01   -1.851757790083188e-01   -8.306808505192176e-01; -6.239903376288637e-01   +4.408483581614592e-01   -4.218003119572049e-01   -2.673513637704709e-01   +3.252989390783229e-01   -4.366304580971729e-01   -1.468020721438799e-01   +6.485015263313434e-01   +1.134905153335510e-01   +2.068784979006195e-02   +7.708448744937471e-02   -4.190338956654979e-01   -1.892934797129872e-01   -7.693285390375008e-01   -7.879103982310125e-01   +9.435888242960291e-02; +2.218510540265006e-01   +1.164004311746798e-01   -2.112630399857253e-01   +4.812033136801231e-01   -3.523665390200326e-01   -3.593038160303478e-01   -2.241421065553416e-01   +3.047641293823969e-01   -2.914983432662341e-01   +4.949320682219909e-01   -3.978479980905374e-01   +1.465510411053060e-01   -8.347436623825377e-03   -3.360563552779779e-01   +7.609881712607871e-01   -2.128023115397809e-01; +1.374147494329693e-02   -2.781109880788767e-01   +2.219345007398682e-02   -8.136098949899806e-02   +2.039626814716121e-01   -5.060612318192459e-01   +8.238100764010480e-01   +3.387296186172669e-01   -3.576403079646178e-01   -9.489022960882275e-02   -1.843883072078306e-01   +2.984725454423298e-01   +2.118636738989901e-01   -7.811338329008412e-01   +6.415682883391514e-01   +2.610242332043315e-01; +7.353453374331469e-01   +2.588933145301263e-02   +4.803141224007914e-01   +5.366480564776225e-01   -6.642501141412631e-02   +5.797783131952313e-01   +1.601772644026050e-01   -2.888615673043227e-02   -1.262876956601375e-01   +5.192561659071878e-02   -4.812899205564579e-01   +2.350660921912628e-01   +6.680557332759417e-01   +2.804654851241185e-01   +2.546434400305918e-01   -2.839435416000372e-01];
L2I_L1I_iGABA_netcon = [-5.775990915873463e-01   -1.506846827490409e-01   +5.388735378887223e-01   +1.290116135397454e-01   -3.930753292595607e-01   -2.438856120306875e-01   +1.653951183377313e-01   +4.714548040619035e-01; +8.622520128627988e-02   -1.108975796476265e-01   -3.887336026734499e-01   -6.990101382200516e-02   -7.151771946071614e-01   +2.173524508389437e-01   +1.698542479973706e-01   +2.452881629157390e-01; +4.209774743140306e-01   -3.613648953312092e-01   -5.572920024858171e-01   +4.566974778120635e-01   -3.107212118225851e-01   -2.051079828027368e-01   +1.420535545249798e-01   +4.469935135077054e-01; +1.587451200681542e-01   -8.141276486275553e-01   +4.856666768231633e-01   -2.203809742340666e-02   +2.173881831595959e-01   +7.108436991941651e-01   +1.015245887671551e-01   -9.552861766693226e-01; +2.054570114824127e-01   -4.501473961781182e-02   -9.647689744839824e-02   +4.395994232844531e-01   -1.563825008707024e-01   +9.846785931213391e-02   +6.624533649280274e-02   +1.496012119830754e-01; +3.314625690878571e-01   -2.989076819177703e-01   -1.559469342102961e-01   -1.521158748997958e-02   +7.854303181107343e-01   +1.393329258652292e-01   +7.401721288145325e-01   -3.125989417529993e-01; +2.137799594018178e-01   +1.285387777097911e-01   +4.098854441377273e-01   +6.202082198420469e-01   +2.027248960002636e-01   -3.069209334293359e-01   +2.937907679402075e-01   +1.841244974814534e-01; -5.678223286691632e-01   -2.855308149631894e-01   +1.760823753038032e-01   +1.000000000000000e+00   +4.701286779763239e-01   +9.629245847913862e-02   -1.631268653295538e-01   -5.019595872286773e-01; -3.316995741147182e-01   +3.253509040481639e-01   +2.688247948797424e-02   +1.644540222851420e-01   -6.801364152722954e-01   +1.966634246809515e-01   +6.299680389613086e-01   +3.442055400136702e-01; +1.786297354796865e-02   +5.223212099335617e-01   -1.155582927804388e-01   +7.625903750024184e-02   -1.651104267137499e-01   -2.318691731588048e-01   -8.816836326013242e-02   -7.677230105306467e-01; -8.202622848311374e-02   +1.597542538618532e-01   +2.571066573083757e-01   -2.629462759263940e-01   +8.648993396851251e-01   -6.854853477682430e-01   -1.323427748677456e-01   +2.640947422594849e-01; -2.360200463612276e-01   -1.350799867053508e-01   -1.334269279232394e-01   +5.129698241988442e-02   -3.579084218893916e-01   +2.280790489768371e-01   -1.073049827064752e-01   +3.870159291988520e-01; -1.029843864327195e-01   +4.365836906648718e-01   -5.102702930942712e-01   -1.501099000114195e-01   -1.765338641806714e-02   +4.403005724100598e-01   -7.065052997774699e-01   -5.801230305537705e-01; +2.834797797204821e-01   +1.216567738151332e-01   +1.959618080407050e-01   +8.163659700266647e-02   -1.993435035350751e-01   -3.639563205892739e-01   +4.820117498686891e-01   -4.020044504311312e-01; -5.346547237432674e-01   -9.745206906206078e-01   -5.159224614820466e-01   -1.610209620814579e-01   -3.819661853844508e-01   +2.878157145747604e-01   -7.914122474125626e-02   +3.289360718668772e-01; +9.241160646036878e-02   -2.426492603558236e-02   +2.843129123504625e-01   +5.622297360195756e-01   -2.371477925369637e-01   -4.644671546244504e-01   -6.093343928319027e-02   -4.470583208431442e-01];
L1I_L2I_iGABA_netcon = [+4.154924511090448e-01   -1.389306355899341e-01   +4.558611819296612e-01   -1.089608705723215e-01   -3.244633082662106e-01   -1.238386056013369e-01   -1.722414808825514e-01   +9.981945422719789e-01   -1.798700985178213e-01   +1.000000000000000e+00   +1.638300634044088e-01   +5.851861759376394e-01   -4.314789007429478e-02   +7.867629753569382e-01   -1.176541470147219e-01   +5.662337628281097e-01; -1.316497860065983e-01   -3.587874833181718e-01   -2.989486147185420e-01   -6.493782327610623e-01   +3.544003039684365e-01   +3.174771630193852e-03   +5.551673320792267e-01   -2.116523786233184e-01   -7.021214934080021e-02   -8.886478551221948e-02   +3.126388163991972e-01   +2.665459511111430e-01   +1.449119786839176e-01   +3.133234184666778e-01   -1.918714712424507e-01   -8.641184680192264e-01; +2.275424806671794e-01   -9.598189635805192e-02   +3.992545942656656e-01   +2.407669319128678e-01   +7.839450604319324e-02   -5.437521888105208e-01   +2.148508461973338e-02   +1.006663601076867e-01   -4.893716808240519e-01   -1.344272324842069e-01   +3.271791196457739e-01   +1.270435026246380e-01   -5.297112035948086e-01   -2.966150106704156e-01   -1.039641454911753e-01   +1.253720483278492e-01; -6.999488283305455e-01   +9.707294577378929e-01   -5.514085635259077e-01   -9.966159653279064e-02   +5.839481405737887e-01   +3.324571981446603e-01   -4.075653851957481e-01   +7.581863403476133e-02   -1.462165837970184e-01   +8.235496808359735e-02   -3.906361728111138e-01   -6.715259786891049e-01   -2.117059088382627e-01   -5.627067655234512e-02   +4.495180724048804e-01   -3.109978873299140e-01; -8.646051125788560e-03   +1.560264244227046e-01   -1.285666135916629e-01   +2.764081257530647e-01   -2.547648770266687e-01   +3.538415534575033e-01   -6.945181627335650e-01   -3.731337149089538e-01   +3.785279249679643e-01   +6.826432006329294e-01   +1.407192258999915e-01   -5.704004543912373e-01   +7.778827413521745e-04   -1.643256953074620e-01   -1.077779828039463e-01   -3.711548549683146e-01; -2.091727265232868e-01   +1.292557195065666e-01   -4.466688160445596e-01   -6.472615336484876e-01   +5.975767994139881e-01   +4.636053600547140e-01   +8.182866729886950e-01   +7.953006711819680e-02   -7.361008978077299e-02   +4.185569632948018e-02   +3.040347290350887e-01   -2.916756642603048e-01   +1.969580495320251e-01   -5.118331741068270e-02   +1.173285460627631e-01   +4.350970669065623e-01; +4.233818699748045e-01   +5.392131911892314e-01   +3.641015459450312e-01   +5.769532126116578e-01   -3.609643570273762e-02   +5.467541787562557e-02   -2.038589672757166e-01   -4.384352924990277e-01   -7.786567105083068e-01   +6.289866978129089e-01   +4.513272071359855e-03   +4.441180932141096e-01   +4.553425311954957e-01   -4.957070914779065e-02   -1.094908844145492e-01   +6.041082192040276e-01; +4.931939399640978e-01   -7.795969906893438e-01   -1.422846032143919e-01   -1.023910170590061e-01   -2.479227205950258e-01   +5.035511433341917e-01   +2.379438076005413e-01   +3.155044776237403e-01   -1.566411920421137e-01   -4.003417369149021e-01   +2.260394682369211e-01   -5.651152435347762e-02   -3.961184023336198e-01   +1.766363651465891e-01   -3.903327826754112e-01   +3.733499832911561e-01];
L2E_L1E_iAMPA_netcon = [+5.579165457234213e-01   +6.077126464868229e-01   +1.747688235096745e-01   +2.159882583386204e-01   -5.034126046940556e-01   +3.052223244588081e-01   +2.555986802251930e-01   +4.030373037654112e-01; -4.088840269945156e-02   -2.761946041050027e-02   +2.370526937357617e-01   -5.594726704140875e-01   -5.252964820095544e-01   +3.308556586099871e-01   -4.096554502057462e-01   -3.302166232234899e-01; +5.419264527002602e-01   -5.157908313544453e-01   +5.428943374643150e-01   +2.694935953356334e-01   -3.208527411380832e-01   +2.122275171765025e-02   -5.319443653753996e-01   +5.528056391191073e-01; -1.832559443608498e-01   -6.473270985992581e-02   -1.978917504625529e-01   -1.151250493965132e-02   -9.993994224267944e-02   +3.735977896646206e-01   +1.333616590937117e-01   -4.380017578266238e-01; -2.360085994270485e-01   +1.625286574129436e-01   -5.890027913459024e-01   -5.290793421521029e-01   +7.853226533718609e-02   -3.088312049710162e-01   -7.939932574543168e-02   +7.582002164283262e-02; +4.445748705897457e-02   +2.592433996696293e-02   +2.267703004469596e-01   -3.155730504209421e-01   -5.337297700221534e-01   +1.064029650052870e-02   +2.709461927322984e-01   +2.149673548373556e-01; -2.145178299783102e-01   -4.712870162758332e-01   +1.573158308379584e-01   +1.463758210987298e-01   -7.958415344888289e-02   -2.997195339960212e-01   +3.587338600168107e-01   -3.290069326276857e-01; +1.534939391263205e-02   -3.102776288678476e-01   +1.449996579069424e-01   -5.629257260394878e-01   +6.830873179083127e-02   -7.363397318200927e-01   -2.892098664030275e-01   -2.950760125048297e-02; +3.522136533628730e-01   +7.049274940487800e-01   +4.700577981385122e-01   -5.783181689575784e-01   +2.497052899321375e-01   +2.615087549388603e-02   +4.544992987192988e-02   -3.356770495378976e-01; -3.276449919858432e-01   +1.620468737730585e-01   +8.010782138086255e-02   +6.966504617953587e-01   +1.592302702605067e-01   +7.795029684111365e-01   +2.109132095367207e-01   +7.092775650498263e-01; -2.725098752936349e-01   +3.402577112873131e-02   -6.017219233997010e-01   -7.508033663218486e-01   -2.274732756030425e-01   +3.752853074423128e-01   -9.761188999965646e-03   -1.085520596328252e-01; +7.120557548634977e-02   -6.625735718693632e-03   +2.187039344438151e-01   -3.855522397135270e-01   -5.948557544341230e-01   -4.866784866957503e-01   +2.920190484293191e-01   -8.987812153050533e-02; +5.168014217064910e-01   +3.150231296063302e-01   -1.111276299282063e-01   -6.822915440062297e-02   -3.094974759120476e-01   -8.674364228230907e-01   -5.341610099106138e-01   +4.139546223770052e-01; -3.749980159346879e-02   +7.481882873582421e-01   -3.755140313380216e-01   +1.796048578142677e-02   -4.282478928976616e-01   -1.810459422181816e-01   -8.819681557854912e-02   -4.206504761432510e-01; +9.075489028820732e-02   -1.041371070499605e-01   +6.794187724040436e-01   +1.390288847992818e-01   +9.672551558892776e-03   -1.924908840835107e-01   +2.947316617481491e-01   +4.839730414971907e-02; -3.262049470798307e-02   -3.940122208556781e-01   -1.778602870669076e-01   +9.508680146927172e-01   -2.448338111580572e-02   -1.274194464988405e-01   +1.000000000000000e+00   -8.330832741837434e-02];
L1E_L2E_iAMPA_netcon = [+2.527893617160806e-01   +4.567173506942308e-01   +2.326711870155457e-01   +9.913879192764050e-02   -5.920814224263878e-02   -7.952977054618672e-01   +9.157578445943135e-01   +1.528032012941915e-01   +1.507119916030010e-01   -2.098312620626314e-01   -4.219652636755482e-01   -2.222523129203146e-01   -4.160662777165269e-01   -9.734665961080960e-03   +3.519560511630897e-02   +1.261787636863657e-02; -4.627835125023214e-01   -5.097428296774879e-01   -3.395010247479670e-02   +2.681532184615763e-01   +5.711456501533436e-01   +1.520517089679792e-01   +6.444403354049463e-01   +2.947221100976193e-01   -3.397360077930237e-01   +6.601447968365046e-02   +1.379029451297189e-01   -5.422325329398457e-01   -1.434404053850036e-01   +1.831954630893138e-01   +8.520354476037106e-01   -6.738568268406208e-01; -1.024408292720722e-01   -6.193940430909783e-01   +4.898156472664933e-01   -1.984992760553700e-01   +1.084903669574789e-01   +3.304745328378457e-03   +5.909487633674362e-01   +1.212949144505020e-01   -2.164145654359169e-01   +1.719621851899055e-02   +8.475335594757278e-01   +7.747066328102058e-01   -1.622347798591183e-02   -3.369505255184569e-01   -2.284759082518571e-02   +1.667840607774718e-01; +4.733822597501902e-01   +5.668429288956198e-01   +7.398196750503497e-01   -3.010466210008273e-01   -1.235924200691293e-03   +4.527437427079349e-01   -5.508355329916927e-01   -6.058610225526787e-01   -5.335308639125338e-01   -5.691851169355500e-01   +9.128119511209783e-02   -2.458388026611515e-01   -3.897488681665149e-01   -8.595746827498115e-01   -1.000000000000000e+00   -3.669428656197732e-01; -1.309198797480474e-01   +2.161970539787964e-01   +2.535065140430032e-01   -8.306892296196648e-01   -4.692380320981875e-01   -5.620835003442981e-01   -3.733777081074038e-01   +3.955920946832581e-01   +2.132206285043233e-01   -2.230594189340709e-01   -9.425676856278806e-02   -8.057297981954009e-02   +5.351320634516744e-02   -8.723683739080118e-02   +1.193160082309567e-01   -7.508401344971779e-01; +2.422048093193709e-01   -5.267715734465306e-01   -5.877507401383407e-01   -5.020977551368346e-01   -5.717200903013602e-01   +9.009514914289336e-01   -4.069171146151110e-01   -8.688219375634107e-02   -4.138140253644780e-01   -3.675747913990308e-01   -2.487428647388476e-01   -5.828757716354184e-01   +4.742112669553490e-03   +5.313529303632666e-02   +6.100140039181154e-01   +3.792973520539662e-01; -6.850503334372220e-01   -1.662773061252667e-01   +1.948755711828818e-01   -2.103994397721050e-01   -3.065188686092777e-01   -3.938595452651737e-01   +5.691344896048549e-01   -3.038876711348727e-01   -1.731434046308067e-02   +4.485486315973972e-01   +4.035532238929785e-02   +2.706978192575975e-01   +2.247756244100531e-01   +1.452797535450143e-01   -6.715459734123017e-02   -5.730696029567504e-02; -1.970384860906673e-01   -2.712578174208332e-01   -3.510913602789633e-01   -6.927975011102885e-02   +3.938752295364561e-01   +8.606904368409152e-01   +6.107952169324913e-01   +1.483138186870836e-01   +5.877217697102770e-02   +4.755810746531512e-02   -4.928192404419876e-01   -5.604573923837632e-01   -8.945510694203755e-01   +4.997290967061260e-02   +4.183033142036072e-01   -1.504805753733814e-01];
L2I_L2E_iAMPA_netcon = [-4.132775108204169e-01   +2.061418877630699e-01   -2.777212645748767e-02   -2.410281963528848e-01   -3.672869067955964e-01   -2.823555984455112e-01   +4.448158771267940e-01   +1.964041587859168e-01; +2.852577993613423e-01   -3.658453416716994e-01   -6.409946086442483e-01   -3.254850754454807e-01   -1.559994068524116e-01   +8.811808302314049e-02   +6.212986698446724e-01   +4.421318297753308e-01; -5.550388539784845e-01   -4.251927452283876e-01   -5.356785359502124e-01   +8.899711228933664e-02   +1.308174989736309e-01   -2.144124374289937e-01   -2.716159565258230e-02   +1.488907265412429e-01; -5.296124661586721e-02   +3.563835605042721e-01   +3.913756865429029e-01   -6.726691817194167e-01   -1.933798162108002e-02   -2.180086505327412e-01   -7.586273824301054e-02   +2.689589432337851e-01; +2.348522015134707e-01   -8.855277270646722e-02   -5.685588862249999e-01   -2.575838842653510e-01   +1.989651095353617e-01   +3.518557358713780e-01   -4.538914107395208e-01   -1.674782750729492e-01; -4.470208299973896e-02   +9.316045783797142e-01   -2.942153897178291e-01   +1.029594043557550e-01   -5.028560566855577e-01   -2.507285516706607e-01   +2.750983737283016e-01   +7.498676169472712e-02; +4.306935293607177e-01   +3.562929154956405e-01   +4.582035073876000e-01   +6.011812327287450e-01   +5.318783435236009e-01   +5.656443725395344e-01   -3.063792504224005e-01   +4.839893423216877e-02; -2.598608562650819e-01   +8.397653677825345e-02   +5.243402252969832e-01   +1.723128699317420e-01   -6.466186282722974e-01   +4.227526109781606e-02   +7.893340442295727e-02   +4.195138025831920e-01];
L2E_L2I_iGABA_netcon = [-7.844846078793130e-01   +4.617466911560155e-01   +9.886688910064890e-01   -5.049672000210651e-02   -3.502734383484395e-02   -5.670882090188734e-01   -8.431135606251906e-01   +2.739213323633227e-01; +5.693225410798938e-01   -5.194203265237559e-01   +6.485877281233537e-02   +4.455360944545877e-02   +2.384620118519554e-01   -4.627998079819021e-01   -1.975087844750830e-01   +7.216795893516426e-01; +2.425222944322569e-01   +1.952988049153626e-01   +3.167470749285292e-01   +3.094679022835881e-02   +2.283979854105957e-01   +3.380380647524851e-01   -2.123584478981381e-01   +2.751971475346919e-01; -6.723381259387959e-01   +4.320916544603798e-01   -2.438747819593591e-01   -4.767615005854564e-01   +1.278471387091153e-01   +4.557874815229974e-02   -8.152050487392953e-01   +3.061810689136833e-01; +8.446400082133546e-01   +6.539456401124462e-01   +3.129456188077480e-01   +5.779079716847363e-01   +5.468975786400964e-01   -5.535882324484104e-01   +6.100029559440514e-01   +6.556658887094247e-01; +1.789113916693974e-02   +8.525558836994453e-02   +6.601941448045254e-01   +3.336301267100785e-03   -5.248500841141590e-01   +3.719820361140507e-01   +5.864617518607766e-01   -1.358151350242950e-01; -3.989626769536344e-01   -9.245893892757240e-02   -7.570213583871435e-01   -1.240657186289949e-01   +1.568577607172800e-01   -4.729132293356062e-01   -4.405323886867648e-01   -1.000000000000000e+00; -4.454636461128127e-01   +2.607675342314039e-01   +7.048572275829323e-01   -7.686928747952994e-01   +2.473980508677726e-01   +5.257785522175524e-01   -3.277143682626364e-01   -4.296320037546539e-02];
L3E_L2E_iAMPA_netcon = [-1.599518613465026e-01   -5.082538992758481e-01   +1.900819383418505e-01   +4.395135866187658e-01   +4.563626599739956e-01   +9.370739216333002e-02   +6.616919121076164e-01   +4.090961587618083e-02   -1.315505591530736e-01   -4.359947940462277e-01   -1.592978051304803e-01   -4.284122165935268e-02; -2.444085402589522e-01   -3.085760239554536e-01   +1.772735708955614e-01   -4.791477119558557e-02   +6.602668454328835e-02   +7.186455902667369e-02   -2.357322563838256e-02   +2.745794793740053e-01   -3.731927356404662e-01   +1.000000000000000e+00   -5.422823105751280e-01   +3.751665022781680e-02; -7.968016839427651e-02   -8.487075692328691e-01   +1.453222481596571e-01   -3.124526035338622e-02   +6.854727226970897e-01   +4.187960280629480e-01   +1.492290144346166e-01   -2.549131881223546e-01   +6.217109780419261e-01   +1.794652538184232e-02   -4.411287021862566e-01   +4.715598361958877e-01; -3.254989141821491e-01   +1.779597622352801e-01   +1.968260413996802e-01   -2.289075223434677e-01   +4.470506863105851e-01   +2.212006352364819e-02   +5.098050663538813e-01   +3.616979544358307e-01   +1.356600778480401e-01   +3.116394494623381e-01   +6.605746108438749e-01   -2.969687734926827e-02; -2.076195148774367e-01   +2.958900023744819e-02   -3.994817624366322e-01   -2.415634892258937e-01   -2.674638911311061e-02   +9.821118926201453e-02   -6.448989910052823e-02   +6.641858463473417e-02   -1.656977124272874e-01   -3.916082738764772e-01   -4.167277545702511e-01   -1.260753275804102e-01; -3.125030734287548e-01   -6.931737451765992e-02   +5.977848981090773e-02   -7.939127639138708e-01   -7.774893741135101e-02   +4.156893535171874e-01   +2.188615761096287e-01   +9.454882028551388e-02   -7.278399280449339e-02   -2.065412505322209e-01   -2.278735440507983e-01   -7.407332797232083e-03; +1.173275030632286e-01   -1.481029249995694e-01   -1.694310551022057e-01   +2.049113462743168e-01   +4.268683179662299e-01   -1.214404527115091e-01   -4.804178859005483e-01   -1.431169621641907e-01   -4.288559781965191e-02   +6.766483705118438e-02   -9.088059271312079e-01   +7.849763191678458e-01; +1.468384680327474e-02   -2.361062011376204e-02   -1.378784347843283e-01   -6.633316714761345e-01   +3.357525335266570e-01   -7.843415196246360e-02   +6.752545098570133e-03   -4.260293202115146e-01   +1.450165148806623e-01   -2.390037357539173e-01   +2.401139866589680e-02   -3.797213722646894e-01];
L3I_L2I_iGABA_netcon = [+1.568804738908762e-01   +4.773008814078239e-02   +7.941262468846919e-01   -1.264113331313888e-01   -3.889881026925255e-01   +4.500608454426112e-02   -6.909996516430938e-01   -9.649257823298907e-01   -3.529373729498330e-01   -4.213521943541828e-01   -1.026364457135844e-01   +6.033812373076886e-01; -1.095976374494710e-01   +9.160668927745379e-01   +4.589621908556019e-01   +1.941786900879525e-01   -1.378340404537554e-01   -4.153779878096232e-01   -1.536202362721243e-01   +4.061148900736270e-01   +2.446959586766964e-01   +1.445283034346599e-01   -6.672727737533630e-01   -8.157557054026671e-01; -2.662791731200695e-01   -1.459125470693207e-01   -2.851476588247462e-01   +5.284238690088726e-01   +7.625898660698091e-02   +7.088402977339008e-01   +7.312272052841073e-01   -2.067844500570041e-01   +2.676933690341204e-01   +3.132428508962223e-01   +9.496648686846090e-03   -4.393718130479368e-01; +3.804774364029266e-01   -2.338590444570369e-01   -5.352635557408965e-01   +9.588302185976288e-02   +3.979558567020564e-01   -4.880237124709301e-01   +1.544037686167866e-01   +1.085669388854774e-01   -5.684428488356558e-02   -5.432120289107264e-01   +1.872844051814152e-01   -2.156637701912043e-01; +7.021217686449128e-01   -3.928806707705668e-01   -3.958111486959269e-01   +4.807366807738566e-01   -7.374092072325751e-01   +5.246906546345429e-01   -2.245899580392365e-01   +7.272482807954449e-01   -7.812425172177910e-01   -8.447891711869482e-02   -1.511889969566146e-01   +7.629664553841298e-02; +8.674708296638936e-01   -2.543062052357548e-02   -4.176849342464182e-01   -1.345713082621628e-01   +2.534811061799606e-01   -8.683494223600949e-01   +5.930734246976349e-01   -7.948379182878633e-01   +5.297546433688318e-01   +8.725856746394143e-01   -2.146060207612628e-01   +6.198265292481882e-01; +2.592769228253927e-01   +2.268824460825319e-01   -4.416404110132840e-01   -3.670099710676863e-01   -6.623566109621606e-01   -5.091598610810006e-01   -4.895142377254156e-01   +2.661328306908795e-04   +2.085973948538904e-01   +6.561200043882215e-01   -5.847342448204282e-01   +6.651074806801818e-02; +5.812748951069223e-01   +5.580575774194336e-01   -4.148494827033972e-02   +2.198833960804223e-01   -2.735005441677479e-01   +4.070328937980239e-01   -2.054788060816043e-01   -3.442007630444103e-01   -1.406922690523063e-01   -5.531405024780853e-01   -4.389279818909996e-01   -5.560637487646907e-01];
L2E_L3E_iAMPA_netcon = [+2.068987957434522e-01   +2.596155059220387e-01   +1.428732588487011e-01   +2.992729556026150e-01   +2.484099234110434e-02   -1.670743595528660e-02   +1.056752483287057e-01   +4.353234235966802e-01; -1.359624860722265e-01   +1.045307608459395e-01   +2.732884248713451e-01   -7.751093338815808e-01   -6.867114843055944e-02   -4.052116383041798e-01   +4.251775810258769e-01   +2.908451453301526e-02; -3.790962890071325e-02   -8.419151087333590e-02   +4.823807338213302e-01   -8.301930050661797e-02   +6.933574989042006e-01   -1.608731859954571e-01   +5.501741170572612e-01   +5.298563818357175e-01; -5.808818971265909e-02   +1.065012022632454e-01   -2.103712268891898e-01   -2.321158936602142e-01   -4.585439039834514e-01   -3.304182059058000e-01   +1.900761951894777e-01   -1.078333088190710e-01; +5.602276853802840e-01   +2.575366507012602e-01   +7.197428310445610e-01   -6.743617971547170e-01   +4.643646420684974e-01   -1.238780699831353e-01   -5.923115922769395e-01   +3.838230735636274e-01; -7.634366382199897e-01   -3.747201321328644e-02   +5.177872809088555e-01   -3.744521216636493e-01   -8.873429312102178e-02   +1.846754263649763e-01   +1.339322241610395e-01   +6.722119151716008e-01; +6.442901853795004e-02   -9.072690350942617e-01   -3.702870064461003e-01   +5.602212336406975e-02   +1.030815783445712e-01   -5.314486296001519e-02   +1.026516007926711e-01   +1.326210290494774e-01; +1.434557740369763e-01   +3.414104103469779e-01   +6.357158169920597e-01   -1.533534808089180e-01   +1.372355752960696e-01   -6.283514153469483e-02   +2.886571655230977e-02   -6.615866342143030e-01; +5.106230458271984e-01   -8.846232813949347e-02   +9.929467347018318e-02   -5.670817038399294e-01   -6.984072641763087e-01   -5.937446218181525e-01   -5.086748514976086e-01   -8.831250613567192e-02; -2.425043521648471e-01   +3.974949382799140e-01   -2.830282689297378e-01   +1.362640986369180e-01   +3.191340709804184e-01   +6.705752440024226e-02   +3.046723704163600e-01   -4.956622014391632e-02; -8.113715258088886e-03   -5.150555410449584e-01   +4.179907423572251e-01   -1.241778224192091e-01   +5.672575356182405e-01   +7.953408621104444e-02   +2.958741663999570e-01   -2.141144054445902e-01; -5.042679103777820e-02   +2.779959648803154e-01   +1.981276356511127e-01   -1.000000000000000e+00   -2.268476043173734e-01   -4.677776261839797e-01   -1.323236182409822e-01   +2.110954808161062e-01];
L2I_L3I_iGABA_netcon = [-2.404226235274540e-02   -2.258087671143849e-01   -2.484456875848043e-01   -1.267563541234315e-01   -4.716338310500122e-01   +3.010365515490459e-01   +3.400385207110927e-01   +4.721864451607468e-04; -8.519376398694333e-01   -6.948069736199365e-02   +1.000000000000000e+00   +1.725593381798237e-02   +5.902208676002400e-01   -2.607210241418492e-01   -1.933613825441322e-01   -3.069958414767832e-01; +6.417906152255918e-01   +1.587321928187715e-01   -5.741777766169045e-01   -8.413735552584277e-02   +3.177639765937998e-01   -1.141827108891206e-01   -3.727145228988071e-01   +3.202745497930073e-01; +4.997569898431548e-01   -1.576035033066161e-01   +4.198987906050051e-01   +6.424025835644803e-01   +4.684524933617566e-02   -3.551651573413524e-01   +6.084165477575916e-01   +8.374478649552217e-01; -4.061543253157296e-01   +2.906140969477552e-01   +3.306074605577591e-01   +3.584907911824436e-01   -1.354725004209906e-01   -8.445027325004516e-02   +8.328814304213491e-01   +4.213928130096733e-01; +6.783953469890646e-01   +2.531375098537735e-01   -2.824576105444050e-01   -1.599505429002593e-01   -4.620595912573088e-03   +1.047472366258515e-01   +5.309169700428467e-01   -8.758889384994153e-01; -1.792191499781953e-01   +5.506179537626095e-02   +1.470823001666689e-01   +1.324683587095573e-01   +7.189577644330528e-01   -4.414482298505006e-02   +5.697338297319032e-01   +5.447903427718246e-01; +1.531274724829509e-01   -2.115698609328317e-01   +7.090092581613956e-01   -2.141444972670659e-01   +5.853313962994241e-02   +2.128451420891174e-01   -5.910873431929211e-01   -2.184490606203545e-01; -4.104039013925898e-01   -2.507972188025698e-01   -6.076297850739391e-01   +2.051168286729400e-01   -1.186391013318662e-01   -2.626325081505333e-01   -8.216106090647050e-01   +2.166562088546575e-01; -6.184153779193579e-01   -4.528450832259532e-01   -2.828213528512087e-01   -9.209732770270581e-01   -3.037541984400904e-01   +6.671819332878625e-01   +6.357619760486523e-01   +5.280641024841264e-01; -1.635973465084798e-01   -1.788809632721163e-01   +4.906627390510245e-01   -5.609514015482069e-01   +6.581821248286833e-01   +4.632360392931950e-01   +2.133082070026976e-01   +5.943695333498710e-02; -4.311467133489861e-01   -5.468251212767765e-01   +1.070179022406909e-01   +1.015665269075959e-01   +8.687298536306377e-01   +3.038210172112132e-01   +2.471572518793715e-01   -8.195006065038103e-01];
L3I_L3E_iAMPA_netcon = [+1.363154802025541e-01   -1.000000000000000e+00   -4.628583163042672e-01   -4.463794371968000e-01   -9.275469390195645e-02   -3.467128630750687e-01   +2.416599940303159e-01   -1.547800731874914e-01   -2.354946270142645e-01   -5.215293987526481e-01   +2.460729728536439e-01   -4.960668902179002e-01; +7.555708665137655e-03   +5.021067802886225e-01   -6.603207231312842e-01   +2.128201342449053e-01   -3.208174172396990e-01   -3.457572139569450e-01   +7.981703749036222e-02   +6.195888364040213e-01   -5.266416046292622e-01   +1.139664197299387e-02   -1.563714276530281e-01   +3.819091873783209e-01; +2.582506585547058e-01   -5.085165364956802e-01   -5.983520699840047e-01   -2.555572733542526e-01   -1.420489786656920e-01   +4.975720419658759e-01   +3.929038233227430e-01   +2.167361746360771e-01   -2.546077603589062e-01   -2.206164483161546e-01   +4.614019870502140e-01   +2.965674816804040e-01; -1.335877785593885e-01   +7.385327581513114e-01   -1.046478958158663e-01   -5.260331954545613e-01   +2.635602538583880e-01   +2.164396799184675e-01   -9.352054250166719e-02   -5.523429685141404e-01   -7.418672506669103e-01   -7.637214254531434e-02   -8.602394908255737e-02   -1.689716801212403e-01; +1.055886869668744e-01   +2.615186802522165e-01   +2.298171688760463e-01   +2.951420472587742e-01   -5.786233342403647e-02   +4.722560333594582e-01   -2.090063128337317e-01   +4.627168309008339e-01   -1.048260289902797e-01   +2.746617528149138e-01   -6.603716094013053e-01   +4.696651172750263e-01; +3.467035397243668e-01   -1.490424040516208e-02   -1.702944608853052e-02   +2.841825422064619e-02   -2.520419129989536e-01   +1.213616968574830e-01   -4.214253131789466e-01   -3.337240804979713e-01   -2.731178386077717e-01   -4.628652939452175e-02   +5.387858461760106e-01   -2.099753394773178e-01; -5.708750626942618e-01   +4.685049719204483e-01   +5.662117621467923e-02   -2.598090471733046e-01   +1.756447130180361e-01   -4.378541549031231e-01   +5.259182296526891e-01   +4.387761586387702e-01   +1.653250181104223e-01   -3.669876116622030e-01   -9.268042004176879e-01   -5.854494147618964e-01; +1.402715234432975e-01   -4.587795200664087e-01   +4.635567640169364e-01   +1.801005367886165e-02   +2.122656693156742e-01   -2.410346356960027e-01   -6.520081170644112e-01   +2.047090456938264e-02   +2.694572033350762e-01   +8.135181246273596e-02   +6.803588453354692e-01   -3.683809333151453e-02; -7.024460941170564e-02   +4.611430370873839e-01   +3.751526363708500e-01   -9.579809381468921e-01   +7.348219998046494e-02   -1.348352907374073e-01   +3.002997691812308e-01   -8.102989367696120e-01   -3.650052409709819e-01   -5.577553456628606e-01   +2.097701262618816e-01   -1.215928223396134e-01; +4.181571177495663e-01   -6.496856801005312e-01   +4.962340910861378e-01   +2.759528545413075e-01   +5.105129796176096e-01   +5.449298840285696e-01   +3.210889785708895e-02   +6.079464428330551e-02   -3.751587757061559e-01   +4.061418386170532e-02   -8.085628009025350e-01   -4.150524750708937e-01; -1.242168509522301e-01   +7.081383008643225e-01   +3.830975554607134e-01   +1.696416048137390e-01   -5.924881407032830e-02   -4.786941327847314e-01   +1.252772655483911e-01   -6.332731953508617e-01   +8.090894248089869e-01   +2.125737631347134e-01   -3.553626034978132e-01   -4.680592803090053e-01; +2.454888696348430e-01   +2.800451790644084e-01   +5.312521445662716e-01   -3.208262132292375e-01   -9.007378090911410e-02   -1.862735856888345e-01   -1.296619796616771e-01   -1.292758297545188e-01   -1.559004818613978e-01   +1.778566719399521e-01   +7.533453783042123e-01   -4.660279131905271e-01];
L3E_L3I_iGABA_netcon = [-3.004704217678258e-01   -1.168352953207442e-01   +6.187080771535537e-01   -1.026742493402178e-01   -9.768962022642863e-01   -2.520091435445594e-01   -1.997950704798969e-01   -2.270948044208379e-01   -2.262703080240395e-02   -2.440929158048640e-01   -3.413170941593189e-01   -1.323879066334701e-01; -3.454935024151954e-01   -9.285949842960033e-02   -3.324488554116582e-01   +6.830425117469426e-01   -1.967653337096564e-01   -7.261334426844795e-02   -7.767443412557937e-01   +2.352594113593913e-02   -7.006083122506344e-01   -3.686109818209958e-02   -5.242067172391840e-01   +9.518777915096924e-02; -4.597667975796136e-01   +2.314533901397516e-01   +2.598069696564726e-01   +3.441036223804199e-01   +4.596902081737370e-02   +2.749337194870443e-01   +4.494516705715558e-01   -1.141649960661576e-01   -6.539806342915947e-01   +3.767400122260776e-01   -4.659733149127724e-01   -2.056224191251640e-03; +1.462897890131147e-01   -3.848761481009644e-01   +1.576038265534176e-01   +4.991860850968147e-01   -1.131394156326166e-03   +3.262955997786636e-01   -5.417406675643990e-01   +1.598482858175969e-02   -4.746196541825049e-02   -2.290839644055325e-01   +5.008891391641633e-01   +5.561385703407936e-01; -9.978620755289352e-01   +5.211564271415084e-01   +5.713329211785144e-01   +2.968931310527512e-01   -6.201369808743028e-01   -8.097413437432650e-02   +1.058145493200791e-01   -6.466177880933706e-01   -5.152298044636695e-01   -1.583739486447703e-01   -5.213891222976916e-01   -3.535270160068536e-03; +3.185767993761975e-01   -5.463931321225353e-01   -4.878959790891065e-02   +3.822277836101815e-02   -4.706950918111679e-02   +4.935580772171085e-01   -2.848832740330249e-01   -1.552746107639710e-01   +6.328571581925151e-01   -3.305700346303544e-01   +2.874282700576840e-01   -2.142604021216200e-01; -1.119929558584922e-01   -5.767199964440103e-01   +5.801573428782210e-02   +2.975155251291784e-01   -3.006286504862756e-01   +4.301529335748360e-01   -1.341020174853880e-01   -5.580428267114194e-01   -4.168082701779176e-01   +2.580912423768075e-01   +3.606909008536713e-01   -9.898884029292378e-02; +3.039080087846397e-01   -6.861449411359919e-01   -8.975153978999778e-01   -2.363328284858255e-01   +5.007983876792148e-01   +1.191478417638726e-01   +8.333282194734838e-02   +2.101879658344173e-01   +4.198453231074027e-01   +1.186420782542251e-01   +3.036600180284640e-01   +7.015185076859326e-02; +3.075651174744716e-01   +5.948570474593078e-01   +2.590964664792612e-01   -3.887422958386515e-02   -2.808201680170296e-01   +3.467334085743232e-01   +6.299166996784016e-01   +3.508950735708178e-01   -4.556021268239192e-01   +3.693287199106727e-02   +1.039643541076289e-01   -6.391174045887584e-01; +8.909181278366038e-01   -2.192118075064146e-02   +4.280016756816094e-02   +6.353378355622780e-01   +2.986933138016126e-01   -3.478478989613763e-01   -2.379378415263776e-01   +1.512040211150099e-02   +4.660412730309800e-01   +4.453762431519932e-02   +3.262297090883202e-01   -6.316150977418771e-01; +9.184134032524641e-01   +2.773592274567084e-01   +7.009566297322024e-01   +1.518746427865394e-01   +7.799830524671417e-01   +8.288147498672619e-01   +1.983709700266054e-01   +1.939740045728672e-01   +3.474954953614270e-01   -1.061380558067635e-01   -4.249619827359859e-01   +1.749636927748155e-01; -3.553346599682947e-01   -6.844208768368397e-01   +8.160273613217076e-01   +1.068308576512610e-01   +6.885967476848174e-01   +4.996784892167215e-01   +1.000000000000000e+00   +2.332467027587941e-01   +2.436102077938990e-01   -3.377410305117868e-01   +6.585695655610861e-01   +7.438084241756948e-01];
L2E_Input1_iAMPA_netcon = [+3.344067256206088e-01   -9.134587029086735e-01   -1.649844193948809e-02   -1.589951143737367e-01   -6.434578312580078e-01   +1.000000000000000e+00   +2.088652575267965e-01   +5.986835152484387e-01];
L2I_Input2_iAMPA_netcon = [-4.792291714696699e-01   +5.030004951273636e-01   -7.329679297479612e-01   +5.776285477761504e-01   -6.636536802441177e-01   -5.380929338141736e-01   +5.989426342165909e-01   -9.590148578401220e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
