function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.039666008833096e-01   +1.514576769688444e-01   +1.274635339282075e-01   -4.860057126870863e-01   +1.782181620707954e-01   -9.414669083440380e-02   -2.138524132050946e-01   +5.612736670587964e-01   +1.870674177830040e-02   -7.556823106826666e-02   +1.208605898449261e-02   +2.325257666348683e-01   +5.030628862106570e-01   +5.275308836776152e-02   +4.109001006486979e-01   +6.221128006394896e-01; +2.495412029030264e-01   -2.921508221557998e-01   +1.557830732488798e-01   -3.137026061951016e-01   +3.502819533068133e-01   -2.478562625236244e-01   -1.016780532237301e-01   -2.915647944509733e-01   -1.139250137153262e-01   +1.977912324462247e-01   -5.786623913844208e-02   +2.414801787295482e-01   +2.600162974125839e-01   -1.192728303928663e-01   +7.207711399754638e-02   +4.823984712285924e-01; -1.678206205697691e-01   +6.552047142014483e-01   -4.222748104348726e-01   +3.009728447596545e-01   -1.169537691060594e-01   -2.206659366340880e-02   -1.585821791390474e-02   +9.154302206369595e-02   +3.596414643971804e-01   +3.431766614870424e-02   +2.663115777185437e-02   +2.294717951019454e-01   +6.466921337808658e-01   -7.871411264773803e-02   +6.184892940730548e-01   +5.757097872146013e-01; +4.015428365914533e-01   +4.522585288133709e-01   +5.620347921790729e-01   -3.060064716133997e-01   -9.820874432730886e-02   -7.098498819945262e-02   +3.740298514830764e-01   +2.557513785865304e-01   -1.473747909169124e-01   +2.783915984744706e-01   +3.414053609387804e-02   +2.889359379832586e-01   -5.938008684287579e-01   +3.421241884356572e-01   +1.434308745947206e-01   -4.078086222043757e-01; -3.456591281723910e-01   -9.626036455065157e-02   +3.989704540978369e-01   +4.411419535224135e-01   -1.176584920698473e-01   -3.434364176444243e-03   -4.387642136261793e-02   +1.695561269108166e-01   +6.128850129489652e-02   +3.968176976934218e-01   +1.872345689467331e-01   -2.778377337495688e-01   -2.572047302927027e-01   +2.513285517608629e-01   -1.757218657337419e-01   +1.835201047915107e-01; -8.786116398321864e-02   +4.302382312303139e-01   +5.191467454635141e-01   +4.277428491583820e-01   +2.858128291101431e-01   +1.911072613468085e-01   +4.707085771248639e-01   -2.979423969007799e-01   -3.631022966793657e-01   -2.193398523757645e-01   +3.010825388264072e-01   +1.237831808927392e-01   -6.569414498471207e-01   +5.108641852770276e-01   -3.129418161909153e-01   +2.216413426967939e-01; -7.739680071445451e-02   -2.387401696172170e-01   -1.762446993641604e-01   +5.878814626982479e-01   +5.348258868519293e-01   -1.604328567188220e-01   -3.589974495722242e-02   +3.159197051983222e-01   +4.770644736622591e-01   +3.153922995493582e-01   -7.203504500649971e-02   +2.656864649784201e-01   +5.038886225241166e-01   -2.398401822996506e-01   -1.429580725868471e-01   +1.845473324059149e-01; +1.872009329930653e-01   +3.406693651248817e-01   +1.415575784298596e-01   +2.548918604365038e-01   -5.831066560114658e-01   +4.360525602174432e-01   -5.920499399449208e-02   +1.067349754178777e-01   -3.280836794763592e-02   +3.663632923090165e-01   +8.196064130152864e-03   -3.014505597805816e-01   -1.632480388440427e-01   -1.920493413410441e-01   +2.899114129292778e-01   +3.716584875919031e-01; +4.172408628135946e-01   +3.870497525423077e-01   +4.725933969495055e-01   -7.893786584062673e-03   +2.571507438322729e-01   +1.954379018531088e-01   -5.909891248908254e-02   -3.357868643043532e-02   +1.427536326399973e-01   +1.720064006454690e-01   +2.129156289894381e-01   +3.109449922221947e-01   +3.129241045097202e-01   -5.959809807386540e-01   +3.307114730032962e-01   +1.677575475134578e-01; -2.555575720115813e-01   -1.117951185869495e-01   +2.199354799646450e-01   +2.335506642611482e-01   -9.619215484269514e-03   +1.582708924512487e-01   +5.547299595542887e-01   +1.428809517946098e-01   +3.906096114512684e-01   -1.229596319570740e-01   +4.753828335561571e-02   +5.174366281135627e-01   -2.698507256404457e-01   -3.184185955789416e-01   +1.824571669636716e-02   -3.541230054790144e-01; +2.759839629166574e-01   -3.170749652742402e-01   +2.571466694283960e-01   +4.640533910187074e-01   +1.219651670804226e-01   +8.067294630379640e-02   +4.845432255094776e-01   -2.312884739003321e-02   +2.124267300698972e-01   -5.051923418005859e-01   -1.300048776557613e-01   -5.038587934697776e-02   +3.305457119569343e-02   +6.340836034506979e-02   +5.833414502583691e-01   -1.599737591007571e-01; +5.478816265458196e-01   +1.955458373761665e-01   +1.986061813295677e-01   +1.449011879239385e-01   +6.221018208868631e-02   +3.852992902849425e-01   -6.772633789480946e-02   -3.338913561702288e-01   -6.642815094261756e-02   -1.034776912862519e-01   +5.402973385562229e-01   +3.019600594100492e-01   -8.476482439271085e-02   +1.195463736466068e-01   +3.282345586622237e-01   +2.882542474269194e-01; +6.714409425582801e-02   -2.992988225281429e-01   +2.150245810198259e-01   -9.855088759266675e-02   -7.040272997674701e-02   +2.840323693842175e-01   -5.840910881900114e-02   +2.983100614984106e-01   -4.587830238040527e-02   +2.512858367025873e-01   -1.245095988793084e-01   +2.003284027235180e-01   +2.381379217408097e-01   +1.337808246430108e-01   -1.022075170898735e-01   +2.796275521018775e-01; -4.074845689867179e-01   -4.040906371513867e-01   +2.545261091555483e-01   -2.625938954717837e-01   -4.954578941396687e-02   +1.516230902118635e-01   -1.761402835330861e-01   +1.953110719408583e-01   -1.569362585443509e-01   -1.574347076212681e-01   +3.383611059652177e-01   +1.389284033061878e-01   +5.513301283911149e-01   +4.562971499303545e-03   -3.365624440522799e-01   -5.576140791698068e-01; +2.487672428207965e-01   -2.634657393518480e-02   +2.841172942949594e-01   -9.934645776434445e-03   +4.296923457266837e-01   +2.507776741184349e-01   -4.043673160206265e-02   -1.293511061889001e-01   +3.195921131403687e-01   -2.158039094816344e-01   +1.131628504436558e-01   +5.016278884582434e-01   +4.889929608624925e-01   +8.456031920785252e-02   +1.158546807029379e-02   +5.121986775492486e-01; -6.823554416373623e-02   +4.917139521110032e-01   +2.400805422555410e-01   +2.639441378909826e-01   +1.852815770480668e-01   +1.238775541866731e-01   +3.220891956935704e-02   +3.911322972676809e-02   -2.550788354975689e-01   -6.126985767546673e-01   +2.437018759187218e-01   +1.438823966053729e-01   +1.227270069093033e-01   +5.778575736060616e-01   -2.092139311638404e-01   -2.541562209434843e-01];
L1E_L1I_iGABA_netcon = [+3.833351981027147e-01   -5.590008192499527e-01   +9.390887009515461e-02   -6.374025154707862e-02   +2.808154655067703e-01   +1.955625414525753e-01   +2.453415288001134e-01   -5.318763244600405e-01   -3.190120288987778e-01   +2.941202338951149e-01   -2.712931879343367e-01   -1.351293138360529e-02   +6.348418780210700e-02   +2.105401105728885e-01   -5.172488710874819e-01   +4.270881752978921e-01; -1.281699854832673e-01   +4.539916225149969e-01   -2.163199378678215e-01   +2.039105869498482e-01   +2.614455655356624e-01   -1.371242871856830e-01   +4.263635729661639e-01   -3.032488829252607e-02   +3.338942029047624e-01   +2.014412128456521e-01   -6.607166363111969e-02   +2.979133681784584e-01   -1.406494335350909e-01   +2.555097379386524e-01   +5.340550493578128e-02   -1.760421295098285e-01; +1.870899830897611e-01   +6.244297992914473e-01   +1.379312603549043e-01   -1.785025429147748e-01   -5.845767789084794e-02   +1.416994192904829e-01   +2.720467055820790e-01   -7.725960798379544e-02   +4.520939587362393e-01   -1.206022869410885e-01   +2.079959216076552e-02   -1.776185584706300e-01   -1.715143961959293e-01   +6.749192745634755e-02   -7.017941868639473e-02   +8.561887233382570e-02; +1.968405139716511e-02   +1.127627521757949e-01   -5.185057543862404e-01   +4.397523487752888e-02   +1.483573100125047e-02   -4.255177357116686e-01   +2.473417335006934e-01   -1.504236216661018e-01   +3.891010011497162e-01   +2.689031687380026e-01   +4.067985161505521e-01   +4.234896361456363e-01   -6.693663438739433e-02   -5.399420372633098e-01   -6.501125977878483e-02   +2.351946932367705e-01; -9.021949345271113e-02   -8.695770736857257e-02   +1.687075533549044e-01   +1.738109999581485e-01   +4.747904174831707e-01   -7.654936234164333e-02   +2.160821078730749e-01   -1.288812847569740e-01   -3.071675138386391e-01   +2.301518850471509e-01   +3.339328524942164e-02   -2.739776426391081e-01   +2.454763635208120e-01   -1.756774808081576e-01   +3.167544431098470e-01   +5.042784806203887e-02; -2.505138150267404e-01   -1.953478831377242e-01   -1.296048322487955e-01   +1.811012552983885e-01   +5.408464363950136e-01   +1.064800555319512e-01   +1.600002623651461e-01   +3.054283867477563e-01   +5.960485933880197e-02   +3.410504148568124e-01   -1.915439666206720e-02   +9.106510365105852e-02   -2.052227350689436e-01   +4.141720509972456e-02   +1.057106448673750e-01   -1.434109908405447e-01; +3.082355489275537e-01   -6.177931335220890e-02   +1.352257811738011e-01   -1.667822801191680e-01   +6.828868926046596e-01   +4.046147023206999e-01   +1.873339900766070e-01   +3.943123390277121e-01   +5.082110549203237e-01   +2.936705927051952e-01   -1.797159225914180e-01   -1.383847146013941e-01   -5.045422360907277e-01   -3.255442240378316e-01   -2.496713872884692e-01   +1.847312807949287e-01; +1.324062280121679e-01   +8.185433123187499e-01   -4.061822784782777e-01   +2.573977579968970e-02   +1.390280903683173e-01   +1.438474405038916e-01   -1.302481997467347e-01   -2.068145325081889e-01   -4.636351341916604e-01   +1.285415317069954e-01   +5.555173542429813e-01   +5.660400907230870e-01   -4.060475061569411e-01   -3.150845630999002e-01   +3.863192876477961e-03   +2.240318093859691e-01; -4.770434706100921e-02   +2.090970416583669e-01   +2.956653863397488e-01   -2.341323351701196e-01   +2.620546357336005e-01   +1.803115977999398e-01   +8.988194935319838e-01   +1.924720373193013e-01   +1.760498493013934e-01   -3.546534425880394e-01   -5.125527740522090e-02   +3.208693248546811e-01   -2.514090875599648e-01   +1.731509526751091e-01   -1.332223740000643e-01   +3.078031568033863e-01; +4.317873243560028e-01   +2.860527235847651e-01   -3.138183508219328e-01   +1.737986342641162e-01   -5.310106993145976e-02   -8.391051102277894e-02   +4.404113985917468e-01   +1.748506420698208e-01   +3.708486525512731e-01   -2.249638449055696e-01   -2.418834064768458e-01   +2.842464796075623e-01   +1.367341254960429e-02   +4.978630702889297e-01   +3.920421859602299e-02   -1.534767243070342e-02; -1.898322739503053e-01   +4.206268190375774e-01   -1.173787403536331e-01   -8.844451333740230e-02   +3.327052373315715e-01   -3.526090588415081e-01   -1.509873965057172e-01   +3.233058453488443e-01   +5.491067137116585e-01   +3.515692416069532e-01   +2.989280937203325e-01   -9.566819070963928e-02   +1.419186196213524e-01   +2.390402231627491e-01   +5.556179432528842e-01   +2.756499372584283e-01; -1.506700795795654e-01   +4.178265412215111e-01   +4.829538443170847e-01   +2.872938383729448e-01   +3.127322994087053e-01   +3.752041067832732e-01   +1.689948886527803e-02   -1.785474615237465e-01   +3.077425465008152e-02   +4.245303733184691e-02   +1.978285079328625e-01   +3.492304746060344e-01   +4.525148090635612e-01   -2.527570358530716e-01   +8.093405960894443e-02   +4.825249000029089e-01; -8.903840788281220e-02   +3.216351656734436e-02   +7.575520658805670e-01   +9.590154132042350e-02   +2.546124359010961e-01   +2.547019901468881e-01   -1.458448795908032e-01   -6.703528932968553e-02   +8.065544925477960e-02   +1.711045967067207e-02   +1.182977289966537e-01   -3.503355266556035e-01   -1.323647895443461e-01   +2.365183307116183e-01   +8.200076363470775e-02   -2.464723969968022e-01; +1.925151509259441e-01   -1.137891428044040e-01   +7.166698616042344e-01   +5.501763905468634e-01   +3.597360128679235e-01   +8.309053615953288e-02   -7.081373925281932e-02   -4.341330456859767e-01   +1.917430374767951e-01   +2.108281445995128e-01   +1.200112813461361e-02   +2.824718867142865e-01   +4.338320880152420e-01   +4.333014070840103e-01   -1.723442701179485e-01   -2.783251411136929e-01; +2.863984750240597e-01   +2.693865079337245e-01   -2.270639480821119e-01   +4.030312420439804e-01   +4.983046229895657e-01   -4.923739340333044e-01   +3.599400702671259e-01   -2.068812416343080e-01   +3.735750190202879e-01   -1.818347024014746e-01   +2.695852690745268e-01   +2.213512794737402e-01   -2.319658475622246e-01   -1.946651857220555e-01   +3.459687126117370e-01   -1.782497553457207e-01; +6.782032805130894e-02   -3.076245638261293e-02   -2.509782604756678e-01   -3.076688877133628e-01   +4.401943417374455e-01   -9.306396939540276e-02   +1.236087137097009e-01   +4.473136441735043e-01   -2.794146930762966e-01   -6.143881306978810e-02   +3.740466448071207e-01   +1.509073264124607e-01   +1.367068555208055e-01   +3.329909916481988e-02   +2.757811679008800e-01   +6.462203341915126e-02];
L2I_L1I_iGABA_netcon = [+2.634136524388026e-01   -3.464031436826170e-01   +3.307034863270686e-02   +3.601196940371501e-02   +1.142988678110605e-01   +1.466270377810083e-02   +3.709682106600043e-01   -3.406661940253127e-01; +1.840300849682925e-01   -1.863079051575310e-01   +3.401860875054373e-01   -1.252942536462757e-01   +2.754066322666957e-01   +3.619215448826849e-02   +3.403908656470722e-03   -2.442548135474971e-02; -2.864344383563216e-01   +1.757368959178599e-01   +5.067840521044490e-01   +3.178836558985123e-01   -5.667446560891125e-02   -4.270061417748772e-04   -5.847389647041006e-01   +1.237360983022446e-01; +4.655820038347416e-01   +6.387277034568888e-02   -2.827635189086497e-01   -1.119200392327572e-01   +2.659647207671970e-01   +4.351362618746318e-02   +3.918102882493093e-01   -3.465585768299474e-01; +2.271456971533657e-01   +2.250176797205045e-01   +4.339215178269767e-02   +6.205335873782051e-01   +2.394770462957806e-01   +9.062135178615675e-02   +9.060415344707852e-01   +2.372796519109365e-01; +1.967300553580913e-01   -1.512932165278419e-01   +1.115690116093185e-01   +5.201906879622363e-01   +8.248347125932204e-02   +7.395603182670352e-02   +4.006028376475199e-01   -1.169600562317674e-02; -3.460089912555808e-01   +4.692082839252620e-01   -2.022948864674176e-01   +1.162088508637686e-01   -4.629580109074489e-01   +3.289607737747929e-01   +2.401598230062919e-02   +7.531607436700344e-02; -1.086474632120347e-01   +4.086809903150597e-01   -4.278630433149039e-01   -3.291812649790523e-01   +2.958706592315481e-01   +8.555647465490568e-01   +1.087200581168306e-01   +8.457972308274624e-02; -1.682798316068331e-01   -2.696806858144202e-01   +3.027259603541081e-01   +8.325685126512089e-02   +1.891578647811191e-01   +3.043799426330687e-01   +1.208417197129582e-01   -3.735213186232650e-02; -1.677714821438043e-01   +1.954527739961118e-01   +5.485759648689286e-01   -1.894354521549371e-01   -9.464316551323322e-02   +2.630755537325069e-01   -3.947200544372664e-01   -2.901822609023966e-01; +9.241955411231356e-02   +3.327848757367547e-01   +4.320435858745959e-02   -3.580113537485747e-01   +1.503207258482613e-01   -1.816689831449702e-01   +1.032481137400399e-01   -2.912072469372103e-01; +3.933380772015572e-02   -2.936224693825111e-01   +3.295710447684640e-01   +2.352030544315342e-01   -5.357836471792361e-01   +3.817987253181211e-01   +6.619110691631689e-01   -7.342412269837684e-02; -1.430485625452606e-01   +5.230977607099392e-01   +8.263591162258468e-02   +9.118120263120158e-03   +4.633530792617447e-01   +3.484119250911546e-01   -2.975462718808477e-01   +3.671003857193001e-01; +1.783116044324674e-01   +5.661716415718845e-01   +3.100299637775920e-01   -4.529015255740232e-01   +3.198258217399075e-01   -2.668248704030001e-01   +6.010872987464113e-01   -3.376892818710220e-01; +2.556505689067013e-01   -4.631299911730311e-02   +2.924314223762113e-01   +2.437634465452325e-01   +1.471667200937538e-02   -1.380496722691505e-02   +2.119548535796368e-01   -2.689066012291441e-01; +8.395445759653942e-01   +2.211550727384811e-01   +1.632259993522675e-01   +2.506447070494188e-01   -1.877908837629202e-01   +6.135706826448792e-01   -3.019720887743750e-01   -1.194612281025104e-01];
L1I_L2I_iGABA_netcon = [-2.704353247453508e-01   -4.896489135981408e-01   -2.939575519841169e-01   +3.918552008487202e-01   +1.944488836645096e-01   -1.240330420717228e-02   -3.907804742300526e-01   +6.035402908937373e-01   -2.517429266342469e-01   -8.377063470154139e-02   +3.476327621762525e-01   -4.123034596377954e-01   -3.338912026343286e-01   +1.245686238160365e-01   -1.559032106233264e-01   +8.044455471566145e-02; -5.443853285940004e-02   -2.017705004590151e-01   -1.101557687094412e-01   +4.539631719810368e-01   +2.290723000551048e-01   +2.086943554704124e-01   +4.274516651984553e-01   +3.599991777064455e-01   +3.567123987382215e-02   +1.116304262442376e-01   +2.960867397882452e-01   -2.424974387301199e-01   -2.368654329604603e-01   +2.255451116391967e-01   +3.079890721955461e-01   -3.512223376140444e-02; -1.028421920732431e-01   +3.488114214115971e-01   -5.181784713011076e-02   -3.819318864843868e-02   +2.169754887538853e-01   +1.250024536587457e-01   +3.943256903924159e-01   +2.509426493906123e-01   -1.632510676842849e-02   +3.617993128165839e-01   -2.438793812811562e-02   +4.171427074260617e-03   +2.908913439194802e-02   -1.518764762011700e-01   +1.924572611962437e-01   -5.729238010192986e-01; -2.048410508316517e-01   +4.305315285889425e-01   +4.854777361149409e-01   +1.091560643525552e-01   +6.653548859347003e-02   +3.256259989594936e-01   +5.478005339349424e-01   +6.404777856608740e-01   -2.286180381545608e-01   -9.423341637322891e-02   -1.962056966065608e-02   -1.895149442252997e-01   +6.606885542651871e-01   +2.265193487456715e-01   +3.366531876384278e-01   +2.001365237053477e-01; -3.095625336354991e-01   +1.085357527763069e-01   +3.993956001890717e-03   +5.982102956010533e-01   +3.976678997799392e-01   +3.924894083299498e-01   +1.873812225221623e-02   +9.149116416885230e-03   +5.316390421317264e-01   -3.176900408684386e-02   +1.851046116484718e-01   +3.567772931958065e-01   -4.829239720581449e-02   -6.121236997837629e-02   +5.602218634586166e-01   -1.152666233776622e-02; +2.203350600071981e-01   -7.295426758624213e-02   +3.310462974096612e-01   +6.197675596950868e-01   -1.724386313510605e-01   +2.965706037506055e-01   +8.441478935411806e-02   +2.216137833615180e-01   -7.243740206072534e-01   -2.104220444082745e-01   +3.045791885111390e-01   +1.108719245677288e-01   -1.125399810685018e-02   -4.838929583183837e-02   +4.640876216489003e-01   -8.929682632801293e-02; +8.857651949012491e-02   +8.114287473605604e-01   +7.961952931368778e-02   -1.465626765105693e-01   +6.821482090897185e-01   +1.673656603744069e-01   +2.944712674070691e-01   +3.517993569628405e-01   +5.230319884029817e-01   +2.044947023710894e-01   +3.538849521486447e-01   +2.684403526149808e-01   -2.194485726084605e-01   -1.634089186579198e-02   +4.261983344480541e-01   -4.542319117404636e-02; -3.974398495599993e-02   -7.465603214459107e-02   +5.988770957092365e-02   -3.197343272126771e-01   +4.457957238062646e-02   -1.360086177657535e-01   -3.129847760291709e-01   +3.322043987749691e-01   -1.539883521219496e-01   +1.870374837589276e-01   +1.366532432499121e-01   +5.651905301328104e-01   -5.592953373860079e-02   -3.461737130975258e-01   +6.585065183093024e-01   +6.220489990482832e-02];
L2E_L1E_iAMPA_netcon = [+2.047042734402248e-01   +3.595364210786294e-01   -3.393614934918067e-01   +2.673011564428505e-01   +1.841005165239148e-01   +1.313740901022397e-01   +2.609717818682114e-01   +6.697428781005448e-01; +1.556540374176705e-01   -8.753946592335057e-02   +1.374645971679882e-01   -1.809019728161068e-01   +6.418598813617168e-02   +6.247073036329935e-01   -3.425311597310464e-01   +3.808058762617427e-01; -7.116376028732582e-02   +1.602463483050490e-01   -4.836075567230043e-02   +9.725575121357855e-03   -5.404100463314745e-02   +2.481263840322635e-01   -8.040386952615908e-02   -7.148297824966282e-02; -2.238148535558949e-01   +6.053647342070408e-01   -4.693433685349159e-02   -2.006287058605175e-01   -9.520706359788128e-02   +8.371705492300607e-02   +9.322540629382767e-02   -2.161837666253749e-01; +7.717260224851340e-01   +3.145754004325765e-01   +3.025941821507845e-01   +1.956655218450940e-01   -1.645529555284951e-01   +3.061938628662920e-01   +5.137827364033039e-01   +7.174293092664535e-01; +2.818886099750008e-01   +1.222925968689017e-01   +7.086079682925880e-01   -3.322146070348230e-01   +1.143375803780190e-01   +3.211962983527307e-01   +3.475352732202543e-02   -6.554875289814141e-02; +4.061446108998322e-01   +7.600331580581951e-02   +2.644983238110226e-01   -7.807696670585568e-02   +2.081831007242147e-01   +1.656783880669144e-01   +2.641930434929139e-01   +1.255665131694936e-01; +1.483576564414928e-01   +1.175881433154352e-01   +1.124619976785298e-01   -1.245410097026838e-01   -1.306636924600430e-01   +2.291823212395774e-01   +6.888184438803608e-01   +3.321250630090068e-01; -3.835645349058974e-01   +1.472676649391857e-02   +3.280593214253405e-02   +5.750943136952355e-02   +1.538113400314425e-01   +8.735857738063325e-01   +1.861891970989673e-01   +5.659955376962664e-03; +3.532206752608253e-01   -2.016184793324353e-01   +4.664908856165969e-01   +7.004381180929090e-02   -1.943355822998222e-01   +1.711760549725466e-01   -8.823686179367332e-02   +1.642600257520037e-01; -7.003175348447589e-02   +7.142714702738528e-02   -1.050835768485613e-01   +6.758035129700510e-01   +5.743853184430323e-01   +4.813854538421181e-02   +2.932258101994911e-01   -2.516224942921399e-01; +3.584395322448989e-01   +7.167660540714871e-02   -1.763994562548425e-01   +3.756027144403776e-01   +3.604521311216080e-01   -1.096429655825123e-01   +5.989828550762357e-01   +3.496718483945672e-01; +4.716864552643368e-01   -2.220461202100159e-01   +7.093219625622593e-02   -3.970089768513844e-01   +6.510661961671213e-02   -2.274407834974602e-01   -9.993908670952623e-03   -3.141501725466187e-01; +1.256803187880009e-01   -1.128305167746427e-01   -4.104388784299586e-01   +2.819471602035365e-01   -2.843009410330635e-01   +2.506695791422104e-01   +1.382931487000842e-01   +2.462281328364915e-01; -1.077776861822368e-01   -4.137594091700629e-01   +1.458396916284649e-01   -2.284349732764694e-01   -7.627476970282754e-02   +7.616099795224270e-02   -1.358663560326301e-01   +5.261069910338868e-01; +4.636998711340178e-01   -2.079725388999067e-03   +1.219254716189827e-01   -2.158144383902567e-01   +3.315231070270984e-01   -8.595662091809536e-02   -2.148563240444765e-01   +2.573566912623436e-01];
L1E_L2E_iAMPA_netcon = [+1.614249762287195e-01   +2.973486243716499e-01   +2.531341475911543e-01   -2.197639938971232e-01   +4.871765028373051e-01   +3.548820501786456e-01   +8.708617390179194e-02   -6.326907690249590e-02   +6.924480850968293e-02   +2.452531354221046e-01   +2.264331000567922e-01   +6.669214198824610e-01   -5.269627339436142e-02   +2.569506247768862e-01   -1.328064774490069e-01   -6.680843961422464e-02; -1.603134023429020e-01   +4.052119604027793e-01   +4.747088500464919e-01   +7.758186322836927e-02   +1.097531855480689e-01   -1.451439525138012e-01   -2.602190625238358e-01   -3.111369307669229e-01   +1.276227511212245e-01   -1.625107753941124e-01   +1.103088092412139e-01   +1.025143253779751e-01   +3.988554613583456e-02   +5.410520972484516e-01   +2.694238654618767e-01   +5.048293362384357e-02; +2.552848115773670e-01   -9.176643349766128e-02   +3.600329273415968e-01   +4.437189703598804e-01   -1.833918926626946e-01   +3.408343927932910e-01   +4.402358087443230e-01   -3.333556533204560e-01   +1.400572198203456e-01   +2.610646000885579e-01   +9.455433112830847e-02   +1.959631700193959e-02   +6.486937165033357e-02   +2.933639942074169e-01   +1.055236601365437e-01   +7.193722073228104e-03; -2.522133588987119e-01   -1.178682721503004e-01   -2.754347024832555e-01   +4.695904848018636e-01   -6.121962815632789e-02   +4.790343743184775e-02   +1.993776757828213e-01   +3.263145424663841e-01   -2.923461198241510e-01   -4.240866499198748e-02   +6.960693403297599e-02   -1.730868549636741e-01   -8.637168538704248e-02   -2.283401404800126e-01   +4.009252269636576e-01   +2.666956539355966e-01; -2.859900017234593e-01   +3.100285483186718e-01   +2.672407630091491e-01   +7.128272469149142e-01   +5.219124975719456e-01   +5.368634614791397e-01   -2.610691664839515e-02   +2.955294662192548e-02   -1.739975933423371e-01   -5.053174178740243e-01   +5.292974938294451e-02   -1.834867755751973e-02   +1.154769169295893e-01   -3.384916772993449e-01   -3.446708024504341e-01   +1.130339243179725e-01; +1.167701482557947e-01   +3.530827264449758e-01   +2.776304296174822e-01   +3.264669333093209e-01   -2.511139141286354e-01   -1.325868741341869e-02   +9.958395058365888e-02   +2.487369236226018e-01   -6.313528348646374e-02   +3.219872271005213e-01   +1.258570480516233e-01   -1.931790693443642e-01   +2.941400028556512e-01   +1.415383126609288e-01   +3.667244973433791e-01   +4.398972900352460e-03; +1.293020625780132e-01   +2.785727299795139e-01   +5.353779041381984e-01   +4.011496985937137e-01   +2.667933974760355e-01   -1.594578087584571e-01   -5.612328854716200e-02   -3.318328959076303e-02   -1.263461671792431e-01   -2.884343991279282e-01   -2.337715950412168e-01   -1.583597075982041e-01   -5.781581111272457e-02   +3.046086738771831e-01   +1.258656309730816e-01   +3.652744687249417e-01; -2.155342017956454e-01   -2.414835295192564e-01   +3.325596186453116e-01   -3.866375584378912e-03   +3.072345330906164e-01   +2.248063696404822e-01   -3.016786043438583e-01   +3.988185571502826e-02   +2.644783727985826e-01   +2.516858652686413e-01   -6.163886758553386e-02   +1.396208141636618e-01   +3.628852725134482e-01   +2.080888559924433e-01   +4.746571282426930e-01   -2.652604317322227e-01];
L2I_L2E_iAMPA_netcon = [+1.541546533031623e-01   -3.471217260509048e-01   +5.142292038098213e-01   +1.535518363459122e-01   +4.394082932691819e-01   +2.567902170910659e-01   -1.212374559809023e-01   +3.360903064990068e-01; +1.648836872459573e-01   +1.958462933841228e-01   +1.795952101105635e-01   +3.888894394448353e-01   -2.710899869263797e-01   -4.069217159906424e-01   +4.871108436045618e-01   -2.914771561545872e-01; +2.372437782289881e-01   +1.047637760858558e-02   +2.205734983981301e-01   +1.830564626613081e-01   -2.557370226480946e-01   +8.475073067256040e-01   -4.633237369222586e-01   +5.556458654041940e-01; +2.750226858651280e-01   +8.406984094544739e-03   -7.181587501439568e-02   -8.883163068690955e-03   +3.103961562834257e-02   -2.562588086027778e-01   -3.977760562760100e-01   +1.255079576264369e-01; -9.650600948979568e-02   +6.020284760298666e-01   +2.120991508591211e-01   +1.190297121331537e-01   +5.405326606154870e-01   +2.998530093099221e-01   -4.783842328540807e-01   -8.436552836854577e-02; +2.464073684483838e-02   -3.343663584512322e-01   -1.125852938341984e-03   +4.953156564134985e-01   -2.919566222808641e-01   +3.322502432802920e-01   +2.282400783769855e-01   +2.081830200885697e-01; +2.301086299621281e-01   -9.077902611065909e-02   +4.026492909145949e-01   +3.510758298822297e-01   +2.595211561297482e-01   +4.169716731085710e-01   +2.381845913095097e-01   -2.086442781500195e-01; +4.235917137708957e-01   +1.982346711201068e-01   -1.744597704413758e-01   +3.082886294888567e-01   +4.239961240262384e-01   -4.331441507945727e-02   +4.931145541823183e-02   +3.512652625405157e-01];
L2E_L2I_iGABA_netcon = [-3.010802868006801e-01   -2.613130467607323e-01   +1.308007345031634e-02   +5.292580401125717e-01   +1.293899665437465e-01   +4.879556878887977e-01   +5.297603810776941e-01   -1.605632689990615e-01; -2.489880345493759e-01   +4.332851049677093e-01   +3.318791444373512e-02   +3.883813388036348e-01   +6.717202889345659e-01   +4.119493420030518e-01   +3.321144283105318e-01   -4.760855862854253e-01; +6.046928371359249e-02   -7.112696078912861e-01   +2.708086134444325e-01   -2.646499379191022e-01   -2.109809175964792e-01   +8.651203308556504e-02   +1.910164519721110e-01   +3.593347497774118e-01; +3.269072436929158e-01   +5.116065621532731e-03   +1.313233543394328e-01   +1.928643332909456e-01   +3.947877191706471e-01   -1.351792594219491e-01   -1.066570648984460e-01   +2.272204411167975e-01; -1.202732412710039e-01   +2.910667887365522e-01   +1.583620395164210e-01   -2.240577328095698e-01   +3.365164178306710e-01   +3.034674659521869e-02   +2.841962479809743e-01   +5.850624259300757e-02; +3.509621281552042e-01   +1.634062160533540e-01   +1.212496531047717e-01   +4.516976191030442e-01   +2.357541266762403e-01   +3.286551141983081e-01   +1.460402215441262e-01   -3.024706758707665e-01; -6.716140886181421e-02   -4.798370379461404e-01   -3.507309181876582e-01   -2.514656767866275e-01   +6.869634545223176e-01   +3.192494254535898e-01   -1.259662549203145e-01   -9.861224991865968e-02; +1.382395833414812e-01   -4.354091847480251e-02   -1.099959155873002e-01   -1.723329223031507e-01   +3.594402033340727e-01   +6.230786570051682e-02   -2.416671270610314e-02   +6.815178296837121e-02];
L3E_L2E_iAMPA_netcon = [+4.720350719304803e-01   +4.520347633339205e-01   +3.141578153800615e-01   +4.070240490760163e-02   -6.544719515698427e-02   +9.095567777282934e-02   +3.618676823694554e-01   +2.521570682765996e-01   +6.005381684241475e-01   -3.643104852330196e-01   -1.970780797776230e-01   +1.433824065892877e-01; +9.601650438972859e-02   +1.742328707913145e-01   -8.256428811736428e-02   +8.450017030901905e-02   +1.722346574385750e-01   -4.010841561040639e-01   -5.010063756488844e-02   +5.210399509498349e-02   +7.410254802741212e-02   +2.787323887225584e-01   -2.597106828579041e-01   +4.939455131263949e-01; +2.103142463310504e-01   -5.585993370298521e-02   +5.465028223680498e-01   +1.144514806523684e-01   +2.549950698856757e-01   +3.789576492043263e-01   +4.160095562391533e-01   -1.063985938240944e-01   +1.373413495202046e-01   +8.915476236122008e-02   -5.736026798125555e-02   +1.933378339844404e-01; +2.501967526850028e-01   -1.118348927308530e-01   -6.915659303211003e-03   +2.674366547219352e-01   +1.201170030441819e-01   +6.630070632790604e-01   -2.280228976765796e-01   +1.418038768472390e-01   +3.026594693952854e-01   +1.643433243124426e-01   +2.098545913337674e-01   +3.560156916173208e-01; -1.526637425948006e-01   -3.588531044387576e-01   +3.500981648443584e-01   -4.559071404585050e-01   -3.546887969881257e-02   -5.477480559468928e-01   +3.509488044128827e-01   +1.848237613535788e-01   +4.078600229605234e-01   +1.696955138631744e-02   +2.221306601861088e-01   +3.392269143387877e-01; +2.540565218801545e-01   -8.634925493952295e-02   -9.152246349764803e-02   +3.846127507691910e-01   +1.975478037611066e-01   +3.124527576886316e-01   -2.557501211531534e-01   +5.290751815907081e-02   +1.760441193292578e-01   +4.991854412360747e-03   +1.652912623647124e-01   +1.877769566544435e-02; +2.526342353727152e-01   +6.953730835169478e-01   +1.938138883337555e-01   +3.330666890673942e-01   +1.701814352084488e-01   +2.526007980457706e-01   +6.688420990341030e-01   -1.836667868017454e-01   +2.181118610357846e-01   +4.838280675241888e-01   -1.746303181425548e-01   +3.838540573189116e-01; -5.860826401214754e-01   +2.092985503240918e-01   +1.975674930573676e-02   +4.167186138114660e-01   -1.335747405612073e-02   +1.096479821092239e-01   +3.809701363537765e-01   +7.639848213093074e-01   +1.576550991051287e-01   -1.346786761595030e-01   +1.916999386956314e-01   -2.499690950221672e-02];
L3I_L2I_iGABA_netcon = [+1.730824669856739e-01   +5.277436184986206e-01   +2.027695182937693e-01   +1.364758840514604e-01   +2.436018322729434e-01   +2.090087742544756e-01   +2.028332887665545e-01   -1.249141941479542e-01   +1.660286361824274e-01   -2.131593621608829e-01   +1.779136589183770e-01   +4.052855306996453e-01; -1.639016637386200e-01   +2.766792034269396e-01   +6.315031783112088e-03   +4.365122306787947e-01   -7.323198867725700e-03   -1.213182305713782e-01   +4.735302784975304e-01   -2.515972272385686e-01   +5.828979630025891e-02   +1.136112968592387e-01   +4.622185456594004e-01   +2.414505906069886e-01; +1.522080191310418e-01   -1.758554204564999e-02   -9.581297293244617e-02   -1.202926019187041e-01   -2.162672670763235e-01   -1.602778991816598e-01   +2.003061951041119e-02   +4.887379112387336e-01   +5.887496264989691e-01   -1.972401320533799e-01   -3.493350036015842e-01   +2.855395738821652e-01; +2.784137694430577e-01   -2.709773640554166e-01   -1.464136363884118e-01   +5.823401947149901e-01   -5.636367827212068e-01   +4.338631901863368e-01   +8.107645254835409e-02   +2.311388322141327e-01   +1.160236464457454e-01   +3.171673165455134e-01   -7.093617181899348e-02   +3.536222601562470e-01; -1.163267722016355e-01   +5.426507857396852e-01   -2.954597640009949e-01   +5.126125596430823e-01   -8.261014179671891e-02   +4.026201530806952e-01   -1.277879439449919e-02   +1.855789687682230e-01   +2.017342021725510e-01   +4.774442145660101e-01   +5.251686220698458e-01   +7.193753433109551e-02; +6.293034339551704e-02   +1.221436702823011e-01   +4.257961111112326e-01   -1.988488284436790e-01   -1.663340235745785e-01   -2.336537982850217e-01   -2.965909599203748e-01   -3.383418601788017e-01   +5.086583331404952e-01   -4.865219090939784e-01   +2.652822370666078e-01   -4.434258959956316e-02; +3.712440843090874e-01   -4.876197838659512e-01   -5.690340769288144e-02   -2.280451702895059e-01   +2.406028125354504e-01   -2.578153917182249e-01   +2.422022515009755e-01   +1.661364347425238e-01   -1.129549109876368e-01   +2.651882435953570e-02   +2.665940535497256e-01   +4.996096063897658e-01; +4.655191747063155e-01   +2.074915645309603e-01   -1.215293147124227e-01   -9.587316085677973e-02   +5.442808904663242e-01   +2.876721756804942e-01   -2.243822280700646e-01   +7.128341992856320e-01   -1.447122091894058e-01   -2.204528799951100e-01   +1.308332889128156e-01   -9.364353086525723e-03];
L2E_L3E_iAMPA_netcon = [+5.585721509876601e-02   -3.595892186777271e-01   +3.857858128513696e-01   -2.908255488886302e-01   -2.234899493798451e-01   -2.363354756059942e-01   +2.113527122659566e-01   +3.701847945213689e-01; -4.913812691247733e-01   +4.186942962556784e-01   +1.503627434498749e-01   +2.638678054206754e-01   -3.392956740979051e-01   +1.946538721198825e-01   -3.634580067598983e-01   +4.490504482473994e-01; -2.927316606952549e-01   +2.755486771843112e-01   -1.270214126703647e-01   +2.729737398247292e-01   -1.820850656590638e-01   -1.163050997289555e-01   +3.452651480419556e-01   -1.332447504697373e-01; -8.920339179173165e-02   +1.751460353638680e-01   +2.639473441148616e-01   +3.774119443215562e-01   -1.384549821948861e-01   -2.897138141299771e-03   +4.585320776055739e-01   -1.548841430132363e-01; +1.341584606725215e-01   -4.567695534771568e-02   -1.628207034408562e-02   +4.831584000760899e-01   +3.153588502441518e-01   +7.230480519940588e-02   -7.132444221550777e-02   +3.885728449847170e-01; +5.181157271075928e-01   +1.028269914650697e-01   +4.991117325269291e-01   -1.225792702637378e-01   +1.366549722739557e-01   -6.710419466872300e-02   +1.678134697430159e-01   +1.293487449108476e-01; +1.970338773007335e-02   -2.590710013146522e-01   +4.855007465537619e-01   -1.335066199908272e-01   +2.998569346564459e-01   +3.257906748236091e-01   -7.284686353912317e-02   -1.453042821502387e-01; +3.143027122505702e-01   +9.132610200565597e-02   +2.012598572562714e-01   +1.471262279141694e-01   +5.871758925760138e-01   +4.269745012824535e-01   -2.955092590078804e-01   -3.738233387118499e-01; -5.638395567179427e-02   +2.203919921076374e-01   +1.174354766975103e-01   -6.873284313866181e-02   -1.293502186999974e-01   +3.311831014796152e-01   +4.349458428794628e-02   -2.285408287699586e-01; +6.249557711978448e-01   +1.945274450631119e-01   -5.077512787282336e-01   +2.792023531628960e-01   -2.092920630292913e-01   -3.709574650250590e-02   -1.214383208215812e-01   +2.475614910766660e-01; +5.273486797526497e-01   +4.477909400833006e-01   +3.523898384306167e-01   +4.850805998417920e-01   +2.063478737859196e-01   +4.903404180560584e-01   +1.297833700320729e-01   +1.427890676179796e-02; -4.032789767133724e-01   -2.582248497407487e-01   +2.736732141189342e-01   -1.205112334259101e-01   +1.547371833970971e-02   +3.069348051875991e-01   -3.472283926642396e-01   -3.326762655153488e-01];
L2I_L3I_iGABA_netcon = [-3.789635735516159e-02   +1.793390850519909e-01   +3.452019155584030e-02   -7.974470188275540e-02   +3.065955785581305e-02   -1.615745548671108e-01   -9.916617332561736e-02   +1.268648084287454e-01; -1.420163469351390e-01   +4.562948720196304e-01   +2.277086074459213e-01   +1.458072349561576e-01   -5.833137324646470e-02   +4.673638307639180e-01   +3.602049860857985e-01   +5.615589027622157e-01; +5.047336208854867e-01   +2.142045090129916e-01   +2.399236488925149e-03   +4.098944678305604e-01   +1.460585714184666e-01   +3.597506868896478e-01   +5.071595527252848e-02   +1.390891206074130e-01; -1.109791086893293e-01   +3.398100977627565e-01   +3.634621160040700e-01   +1.251055452465203e-01   +5.220567395925400e-01   +1.256770561530505e-01   -2.763933706255886e-01   +1.636911079465712e-01; -1.592883840703578e-01   +2.886515774312778e-01   +2.134823823016175e-01   +3.832854667371272e-01   -3.587249800657653e-02   -3.703505264694215e-02   -4.805573346092249e-01   -1.795596429929656e-01; +2.792666252845859e-01   +7.510995753165095e-02   +2.702691312094063e-01   -9.697818644828188e-02   +2.482482379708416e-01   +3.717664250893444e-01   +2.890549335913224e-01   +2.298700988399277e-02; +3.127612224909849e-01   +4.096682676569077e-01   -1.416972897717120e-01   -2.979549139225698e-01   +2.871217053665693e-01   -1.541831629086690e-01   -4.759462032011836e-01   +2.206774723544119e-01; +3.376392017997464e-01   -4.592756943819848e-02   -2.540934044740847e-01   +3.245779721218646e-03   -1.427175048912195e-02   +4.371933010951635e-01   +2.125713018950045e-01   -1.641226355152142e-01; -8.154188802938020e-02   -4.794239759628607e-01   +4.993835987820336e-01   +5.496314367383601e-01   +1.033073849410767e-01   +3.349306443250761e-01   +8.102146743716382e-02   +2.232910661281992e-01; +1.004683434606176e-01   +6.736418840884675e-01   -2.474682461972050e-01   +3.381798886967595e-01   -1.699509549367225e-01   +2.938071920702342e-01   +5.257481622278118e-01   +4.732555641110875e-02; +2.724736280456353e-02   -3.198039621855051e-01   +3.089031283401200e-02   -1.315023941555824e-01   +7.083395912527454e-02   -5.061805059596905e-02   +5.696737727231459e-01   -2.755261164121270e-01; -3.422541054081805e-01   +3.562835995946789e-01   +5.268628560765745e-02   +1.544901273646708e-01   +2.442613209263005e-01   +5.081799200012138e-01   +6.256139126048943e-01   -5.310488458754023e-02];
L3I_L3E_iAMPA_netcon = [-2.212666253305658e-01   +1.333881977013752e-01   +1.579352475845250e-01   -1.699258312431566e-01   +6.679090237831964e-01   -1.800646254567094e-01   +4.166060509068101e-01   -3.806105843861034e-01   -2.393506496177988e-02   +1.433539163708043e-01   +3.137567548437598e-01   +4.161155116894627e-02; +4.537595752421815e-01   +1.511199129975420e-01   +1.027509625202050e-01   +3.564669609488793e-01   +1.826451229740788e-01   -4.557874444771788e-01   -1.835415095432559e-01   +4.705078924635206e-01   +3.769451400669857e-01   +8.890917868282851e-02   +1.628666743298570e-01   +1.849465887568606e-01; -1.503208002880929e-02   +3.847223959755873e-01   -4.189562072354804e-01   -4.584852306670045e-02   -3.829411603549598e-01   +3.125727009856780e-02   -1.620373123338593e-01   -7.822875084237571e-02   +4.232441749193647e-01   +4.273277257275582e-02   -4.761821516158338e-02   +2.099185731664129e-02; +4.917053432239170e-01   +1.290586025919449e-01   +3.264053878049741e-01   +2.138607186520162e-01   -3.924383160899442e-02   +4.649754329959358e-01   +3.574488515297645e-01   -3.686767766519750e-02   +3.604725387478204e-02   -6.795743393270751e-02   +2.292624276695764e-01   +1.122544728902200e-01; +1.313833079257673e-01   +4.961245804338171e-02   +3.356124657184310e-01   -2.495670335031818e-01   +1.957897282503364e-01   +4.640905930469970e-02   +8.742455020121785e-01   -2.462222511943290e-01   +1.592917359283809e-01   +4.212957994433397e-02   +3.227299292704525e-01   +2.474049002514179e-01; -2.034850963417295e-01   -3.827770258754000e-02   -1.190176035214010e-01   -3.545694242302238e-01   +1.579323030024314e-01   -2.096591665951189e-01   +7.113923065556955e-02   +4.193074325001462e-01   +5.390452037921069e-01   -4.890882153032328e-02   +2.035165488914955e-01   +1.813168646881899e-02; +3.741024167382718e-01   -2.009580322822854e-01   +3.238431362055050e-01   +6.237380131532202e-01   -1.885384322707967e-01   -2.579389422169608e-01   +1.364122319796451e-02   +2.670210617708580e-01   +6.856816054961010e-01   +1.405441589045945e-01   +4.358248225503931e-02   -4.039850964769869e-01; +7.690073143333587e-02   -2.585828216634477e-01   +1.322459269788134e-01   -1.292473479527304e-01   -1.491835353438764e-01   -1.848250243247667e-01   -3.706302697079262e-01   +4.199373772264536e-02   +6.045212724392937e-02   -5.855246561649105e-02   -3.761985324114486e-01   +4.701962573727044e-01; -1.602225919483296e-01   +5.386795781801953e-01   +4.079770347138043e-01   +2.018267675140050e-01   -1.221178563593283e-01   +1.790359915962245e-01   -5.585290102623360e-02   +3.223278642253128e-01   -8.744458156308824e-02   +7.000814225075203e-01   +3.079791016630327e-01   +1.964617684952130e-01; +3.838153351295847e-01   +1.560030656087435e-01   +6.979810794905789e-02   +4.384074988303432e-02   +2.638170949737201e-01   +3.228580046645063e-01   +2.753062758971691e-01   -1.325078562701286e-01   +3.918461998997669e-01   +1.006481956998512e-01   -3.285636570059292e-01   +5.827459516850020e-01; +1.852021670567268e-01   +6.464965449484694e-01   -2.760148131590842e-01   +3.233003713515134e-02   +2.670738391499666e-02   -4.421614367860760e-01   -2.435039999016550e-01   -2.195247273234502e-03   +2.370518123894317e-01   +3.511685913321924e-01   +2.926489577823453e-01   -2.084020442149329e-01; +1.640308973209462e-01   +3.006622291326341e-01   -6.976774319037707e-02   +2.486745927410770e-01   -1.705917595795328e-01   -1.648963383140839e-01   +1.752107562385694e-01   -5.279688510195002e-02   -1.895475441303405e-01   +1.239867965179425e-01   -1.785548779047746e-02   +2.480919030423825e-02];
L3E_L3I_iGABA_netcon = [+2.576713699410860e-01   +4.157646193805754e-01   -3.399916483629639e-02   -1.295791501130002e-01   +1.468335029624072e-01   -1.306739650192681e-01   -3.368413872723009e-01   +2.115554852018182e-01   +5.303587606113450e-02   +3.689804622281126e-01   -5.970006035932043e-01   +3.279240246733453e-01; +3.650219845069864e-01   -4.156952224060950e-02   +2.371324724522199e-01   +2.922316225228095e-01   -5.479350699331645e-01   -5.246815725411639e-01   -3.496718425875579e-01   -1.098112240549745e-01   +4.403416428805087e-01   +1.137612656074164e-01   -5.966681244653377e-02   -2.126920195537170e-01; +4.923094853082567e-01   +1.840709553717294e-02   -2.143964136446992e-01   +3.646322374963964e-01   +1.637748019662923e-01   +3.336378998456124e-03   +4.162712929372653e-01   -3.658475597951031e-01   +1.472386588865728e-01   +9.422483932720623e-02   -3.673625026148842e-03   +4.060779204066805e-01; +2.460621167873641e-01   +2.013827606683066e-01   +1.391577936107851e-01   +2.453904138706912e-02   -3.126559030298781e-02   +2.065053545923474e-01   -2.817759433003814e-01   +1.455216430508666e-03   +4.510135887641539e-01   -2.271226577883914e-01   +3.487376716496194e-01   +8.639626652254190e-02; +2.901784814891442e-01   +4.836089302532647e-02   +6.864270391854574e-01   -4.944310793881938e-01   -3.463345596897212e-01   -2.228103557778092e-01   +6.439147451550498e-01   +1.369853930538828e-01   -2.077292380302191e-01   -1.348148606473153e-01   +5.019681296538301e-01   -9.039172757889197e-02; -1.189869906452466e-01   +4.504324845228980e-01   +2.400969822783484e-01   +2.802998856652621e-01   +1.346694991435627e-01   -2.602858479308282e-01   -1.696620588066958e-01   -1.914279166843191e-02   +1.498028676512452e-01   +4.180054962543029e-01   -1.991180854739538e-01   +2.395195522985335e-01; +4.505646287487060e-01   +1.957213116233826e-01   +3.164369032958733e-01   -3.283565522627434e-01   +5.910158528163960e-01   +2.596779371868815e-02   +3.052176704994805e-01   +2.452612403662548e-01   +1.257694621598827e-01   +9.599557553350369e-02   -1.668076621781488e-01   -1.944589084692904e-01; +6.269029450725694e-02   +6.536404469231755e-02   +7.323474483814043e-01   -3.848750595300904e-01   +3.505372133445933e-01   -7.769415577461779e-02   -1.291770319906664e-01   -1.171338772129793e-01   +3.320751499616968e-01   +4.809223037493406e-01   -5.155478955381343e-01   +1.432606809219889e-01; +2.969647223504206e-01   +5.038716421889190e-01   -2.976623951137484e-01   -6.898452999038912e-02   -2.759388609270454e-01   -4.149513800617121e-01   -1.274567109412983e-03   -2.431531752188112e-01   +6.235342909470107e-01   +4.127298107814503e-02   -6.927994051844638e-02   +1.939719495455980e-01; +2.792163384905382e-01   -1.526744453968803e-01   +2.607170441958088e-01   -1.465170088533903e-02   +2.881961667193342e-01   -8.787489344155436e-03   +3.147226844186951e-01   +7.346389470775311e-02   -3.656553337175983e-01   +1.696354009857679e-02   +1.040426305840380e-01   +1.332881325710304e-01; -1.614316968006820e-02   +4.277010234737393e-01   +1.396363784310495e-01   +1.042999164298136e-01   +1.925746666562265e-01   +2.698258390934269e-01   +5.738769970892230e-01   -2.341782561612771e-03   +9.448132495489361e-02   +2.121891354114662e-01   +2.351921915188767e-01   -1.036155807046857e-03; +5.471438510772459e-01   -1.050357602710425e-01   -5.551915245387572e-01   +4.499936247239317e-01   +4.843051715419798e-01   +6.046817759018258e-02   -1.898585424838062e-02   +2.019311668765633e-01   +9.227348352433273e-02   +1.728836108671949e-02   -4.255678663304530e-01   -2.038825280714334e-01];
L2E_Input1_iAMPA_netcon = [+1.048237779496080e-01   +2.956731972596584e-02   +7.339298318359677e-02   +2.735383296229262e-01   +3.756867456466245e-02   +2.602859726139800e-02   -1.549616807441667e-02   -8.106687215378708e-02];
L2I_Input2_iAMPA_netcon = [+2.204243965028453e-01   -3.532828201297680e-01   +3.104647924605595e-01   +4.652595131136049e-01   -2.922524201755131e-02   -7.712568806743031e-02   +4.208342784119189e-01   +4.237352577232071e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  33.63 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 60*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = -60*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
