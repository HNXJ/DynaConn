function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-7.388431787903518e-03   +4.044993643693782e-02   +2.148296313779745e-02   +1.432632428171474e-03   +2.947229634231800e-02   +7.443958495045134e-03   +2.164702054322722e-02   +2.374431561964387e-02   -1.730153026484146e-02   +1.290701224627130e-02   +2.923272812942718e-02   +8.015231504801702e-02   +1.623545312555228e-02   -2.044654681371180e-02   +5.484225631879450e-02   +3.343796907202148e-02; +4.326125191246578e-02   -3.907560770078308e-02   -1.227157054775459e-02   +6.969533817829940e-02   +8.521440302289025e-02   +7.379107994423226e-02   +5.231669425677030e-05   +5.426185102538230e-03   +2.200056906314521e-02   -1.805961489750084e-03   +4.257949763315430e-02   +8.605308208949293e-03   +4.145438694707193e-02   +1.198462951137680e-02   -1.756360606634499e-02   -1.357485303335472e-02; +4.925832670643818e-02   +5.621406348073341e-02   +2.902179700425027e-02   -1.048364062482621e-02   -4.564074335863803e-02   +2.118999491129314e-02   -2.237284136380469e-05   -1.293598959196900e-02   -1.027897387261949e-02   +5.819438325991390e-02   -7.647730560575837e-02   +3.820227764927524e-02   -3.601035413279168e-02   +3.604052716599640e-02   +3.780940803642961e-02   +3.516940284478428e-03; +4.253692496156210e-02   +1.094061497400959e-01   +5.072875753715086e-02   +3.316580894483395e-02   +6.482042234409006e-04   +5.967501294821299e-02   +2.080284422051434e-02   +4.818331203332421e-02   +5.763979479118001e-02   +9.583827891726062e-03   -7.874808197837069e-02   -3.032523940832353e-02   +3.081433174513787e-02   -4.865810520337796e-02   +1.839797825171299e-02   +1.127078820550654e-01; +4.162777379978046e-02   +5.477134393980310e-03   +3.962464342900988e-02   +6.269285658737313e-02   +5.031276150486724e-02   +2.721481542529954e-02   +6.029020839605700e-02   +5.459069300985812e-02   -3.519504784299812e-02   -4.009502968373217e-02   -1.513750617724523e-02   -2.454226955891749e-02   -1.016051951078008e-02   -8.464452603007527e-03   +1.610345636560699e-02   +1.065893204741129e-01; +4.766338093440968e-02   +7.202626764307619e-02   -2.173189162166465e-02   +1.790911028294200e-02   +1.595818988287594e-02   -3.086351760694186e-02   +8.466843356680091e-02   -5.852381593185848e-03   +4.137130003939421e-02   +2.960011785534468e-02   +1.278777183666589e-01   +1.045585808540411e-01   -4.783591228751213e-02   +5.630576209253349e-03   +6.957338393389405e-02   -2.828332889264545e-02; -2.222800677960016e-02   -1.939345034371489e-02   +5.291685883867301e-02   +7.034235189562685e-02   +8.968357175951798e-04   -4.230003978628771e-02   +5.551616395485942e-02   -1.406187481146661e-02   +9.605869111594545e-02   +4.868111239639941e-02   -2.712170524753832e-03   +1.953782771063711e-02   +2.489748133216972e-02   +7.108850975039818e-02   +1.649087511637581e-02   +7.128339394850368e-02; +1.027887287534145e-02   +9.750796946942381e-02   +5.046298340728689e-02   -9.382686419260391e-04   +5.361980175815931e-03   +4.800300026443648e-02   +1.075978213663426e-01   -3.729079700470087e-02   -6.061213210038668e-02   -2.647043979689246e-02   +6.473592425879583e-02   +2.510361911724313e-02   -2.871555469239569e-02   +9.946118553856367e-04   -2.521217842541350e-02   -1.115545623731860e-02; +5.723326656786229e-02   +3.129696867239386e-02   +4.566655607612696e-02   +4.823238440728335e-02   +9.773719290889597e-04   -4.164881209949946e-02   -1.535530114692246e-02   +5.159248770034968e-03   +1.457707076289713e-02   -2.156184607505726e-02   +9.154162959110190e-02   +6.425131304942935e-02   +4.890456937764710e-02   +3.672068618920326e-02   -1.688846927835294e-02   +1.125503994243393e-01; +2.330684071187966e-02   +1.157117070044073e-01   +4.018192786482371e-02   +1.640875735047856e-02   +3.181141347528802e-02   +6.600266897569783e-02   -5.526450941865099e-02   +9.304638560454815e-03   +5.190102178666516e-03   +5.800972217658855e-02   +6.996560094561641e-02   +4.649123537944443e-02   +8.134907247416892e-02   +1.927484820897237e-02   +1.995453584439138e-02   -1.365021342474854e-02; +2.057109391232076e-02   +1.139769739015742e-02   +3.530959785984862e-02   +9.494761376068212e-03   +7.414672687764859e-02   +1.373388946986351e-01   +3.683586389934308e-02   -2.211156787158153e-02   +6.667816047003018e-02   +2.968328297006123e-02   -1.153071234117083e-02   -2.011253839417064e-02   +2.015468879768004e-02   -1.060145940968019e-02   +3.764706144867574e-02   +6.130860954466744e-02; +9.184170666936909e-03   +4.196716902312124e-04   +4.760457555586869e-02   +1.458381822057270e-02   +1.313999950164176e-02   -2.997872793193376e-02   +8.250942192334515e-02   +5.905181645376790e-02   +7.219781132192338e-02   -4.015835081873975e-02   +1.002761200978161e-01   -9.398145684188687e-03   +4.916118457019664e-02   +4.898571115075659e-02   +5.973570650380584e-02   +1.078813486411161e-01; +6.629946261123369e-02   +7.341917225776179e-02   +1.529697769042302e-02   -3.374858900850170e-02   +2.545351263476051e-02   +1.850197605929020e-02   +6.608877432260746e-02   +2.799988683047160e-02   +4.023965743915732e-02   +7.090998771483160e-02   +5.201519018695898e-02   +2.329890979536360e-02   +1.824789089717443e-02   -9.778585559661023e-03   +2.637972537660931e-02   -7.962474212997504e-02; +5.098624188719825e-02   -3.447679496281977e-02   +4.839427826035093e-02   +9.287032109196949e-02   +4.562097470064575e-02   +8.851567159099120e-02   +2.706959919599758e-02   -2.197310687506792e-03   +1.070102348711383e-01   +5.516196333616975e-02   +4.768486479139922e-02   +1.203802419713503e-02   +7.040945961761663e-02   +3.689127017703547e-02   +9.202388697226548e-02   +6.906979999677276e-02; -7.696758487853523e-03   +3.555136926284488e-03   -9.636603047334255e-03   +1.245618301377104e-02   +3.981937429989670e-02   +2.778297631718183e-02   -1.477324343030968e-02   +3.254424787155805e-02   +4.171882701729812e-02   +4.308811064824108e-02   +7.549613606927499e-02   -1.549757540133572e-02   +5.486720258116860e-02   +4.568417823518928e-02   +5.235046359738202e-02   -2.056229170780502e-02; +4.137300943278232e-02   +5.288824189745957e-02   -1.570949456197371e-02   -4.401450505540025e-02   +9.180381133479444e-02   +2.879207692306452e-02   +4.120476251087363e-02   +2.667489048033599e-02   +2.117155707292543e-02   +1.734850290415675e-02   +4.227250098084522e-02   -1.719544059596604e-03   +8.608108753048058e-02   -3.759453459943881e-03   +5.353016653001197e-02   +7.384242876190580e-02];
L1E_L1I_iGABA_netcon = [-1.409499468221457e-02   +6.772325191749214e-02   +1.592958228471708e-02   +4.402119281769351e-02   -1.189410131785147e-04   +1.253899385448192e-02   +4.432549144734850e-02   -4.511751068012490e-02   +8.065698268634623e-02   +2.146111220130487e-02   -1.600882235114973e-02   -1.799951313166431e-03   +3.518438739915026e-02   -3.900508688595595e-02   +1.437148674162826e-02   +9.213393178623669e-02; +1.424929301697329e-02   -3.335373169114338e-02   +6.935606923003150e-02   -1.980592518575853e-02   -8.103456000586190e-02   +4.358143690585170e-02   -1.901694428346506e-03   +2.661192896242836e-02   -1.310806726430733e-02   -3.796017166920404e-02   -1.208205657804799e-02   +8.160910934499777e-02   +1.037757435602553e-02   +1.157401850940310e-03   +6.471947359118146e-02   +6.528584836875102e-02; -8.275338363336640e-02   +6.839806297759414e-02   -3.657532320322511e-02   -4.590253037212391e-02   -2.399027558179602e-02   -4.581515775596701e-02   +9.669717373011935e-03   +6.037949930735313e-02   +2.461816320866865e-02   +7.000969500938890e-03   +7.264992881568810e-02   +3.123130708587175e-02   +2.905242392234290e-02   -3.998210605466117e-02   +4.764916960374307e-02   -1.035935003992498e-02; +2.422290336804563e-02   +6.215349733467355e-02   +5.415408904641236e-02   -2.736295085300743e-02   +7.151065038414924e-02   +9.929813399748964e-02   +2.692586738931709e-02   -2.019790058024752e-03   -2.524943059038117e-03   +7.673594781492259e-02   +2.666757662238422e-02   +4.404168948006607e-02   +1.934557507427280e-02   +8.677012675583264e-04   +4.515862093772978e-02   +2.751116934330346e-02; +5.678899752683257e-02   +4.480240871500227e-02   +7.535943263147847e-02   +1.590452951769913e-02   +2.700751737385855e-02   +9.934948653990407e-02   +3.445000837359834e-02   +5.525479108893699e-02   +5.073436290967365e-02   +2.819065965454512e-02   +8.121914134517570e-02   -8.235147685835434e-03   -1.207928904072250e-02   +6.619059903391067e-03   +4.567109172618959e-03   +5.982484659488870e-02; +3.005078684563777e-02   -1.513752159950096e-03   +1.297381640185093e-02   +6.348892511054020e-02   +7.864738339966547e-02   -6.894037305968353e-03   +9.740422025443386e-03   -2.402217194123132e-02   +1.068782146332926e-01   +1.592657928214129e-02   +5.783506367590187e-02   -4.505013547288537e-02   +9.835201256796335e-02   -5.047235421570921e-03   -2.204899782860300e-02   +4.571741078050567e-02; -5.419939886175616e-02   +6.776631036978157e-03   +5.243265897517366e-02   +1.266480903377782e-02   +7.640656087479934e-02   +6.634631973828718e-03   +5.099196918958757e-02   -7.430414249152469e-04   -2.067620157944898e-02   +1.997458335874061e-02   +2.157479154719823e-02   +1.056046252594285e-02   +3.463130631726034e-03   -5.464286154101367e-02   -7.172822703425636e-03   +7.622697133104198e-02; +7.147616721642822e-02   +4.311874102566302e-02   +5.214102982081619e-02   +2.873978887753728e-02   +7.055481395545470e-03   +2.645178625194128e-02   -1.618592449861196e-02   -6.310551125031154e-02   +7.366503488616059e-03   -1.230836764982419e-02   +8.110789048268077e-02   -4.070101311912277e-02   -3.004116731452681e-03   +7.662976930664402e-02   -5.372083648192802e-02   +1.281028682581191e-01; -6.448759121145732e-03   +8.877138114465007e-02   +4.707409790161472e-02   -4.653688569036812e-03   +8.001608277339714e-02   -3.956165737986540e-02   -4.401151620636450e-02   -1.796163917595238e-02   +3.866627544437522e-02   +1.793802884278779e-02   +4.073655106591823e-02   +2.918145554995613e-02   +3.053592731742286e-02   +9.194577862664544e-02   +5.807775768576127e-02   +9.624176886379432e-02; -1.149555743831106e-02   +5.569669161623779e-02   -1.744814641444451e-02   +5.964309308284513e-02   +3.139824351151947e-02   +8.531319548289672e-02   +1.022291710553842e-01   +2.553269325081749e-02   +8.942207087142437e-02   +3.450767147093368e-02   +6.793148643326015e-02   +6.687548697460649e-02   +1.740936726560839e-02   +5.342022342626271e-02   +7.854276557791280e-02   -1.149657233414427e-02; +7.697639351333390e-03   +3.757860117195399e-02   +1.408241510950688e-02   -1.526585395203896e-02   +2.174746692475289e-02   +8.126240177870236e-02   -2.252893881315134e-02   +4.343756565517837e-02   +1.280944351024282e-02   +7.438867771558860e-02   -2.825702591704614e-03   +8.191931761925937e-02   +1.621810528595101e-02   +4.990929536884563e-02   -3.195820993000089e-02   +6.509960448823789e-02; +1.460470116081778e-02   +1.774520819493976e-02   +6.582648819363608e-02   +3.605023029627843e-02   +1.778418606208126e-02   +1.883846626593497e-03   +2.719581185282162e-02   +3.605395028676033e-02   -1.853737109835828e-02   +4.513456881043086e-02   -2.108223295271788e-03   -6.745532556438000e-04   +5.047049197903222e-02   +9.838301530358372e-02   +4.378423139860863e-02   +1.127308109832326e-01; -3.417425615222785e-02   +4.610354886738574e-02   +9.494871151092063e-02   -6.530680309312685e-03   +8.981050088609369e-03   -1.997853849412449e-03   +4.515870511289656e-02   -1.783885233382156e-02   +4.568715328731646e-02   +5.915283578921635e-02   +4.602639039670764e-02   -3.317429334626219e-03   +7.658367154688110e-02   +5.077002709383594e-02   +5.094557910589442e-02   +1.599354261295153e-02; +4.041540968259861e-02   +1.278539740983994e-02   +5.156627448125985e-02   -1.803769628832492e-02   -1.206149441053421e-02   -5.802523632650793e-03   -1.459759892521362e-02   +3.427995922543354e-02   +3.682056836409939e-02   +4.728007734503915e-02   -3.616523491833434e-02   -2.171334117686242e-02   +3.716228766055924e-02   +3.514288849284541e-02   -5.444040261292121e-02   -1.001931466846411e-02; +1.850430316494499e-02   -2.574870084223450e-02   -1.416043214523202e-02   +3.161450491174186e-02   -7.485256287094635e-02   +4.867106204506923e-02   -4.241176662498236e-03   -3.084576320742737e-02   +1.196065535337156e-01   +4.679110509112384e-02   -2.246057804508838e-02   +3.995906182547484e-02   +9.441832347074169e-03   -2.470368262212942e-02   +6.022162827651355e-02   +8.603216178321067e-02; -2.533836560163943e-02   -7.650242352137465e-03   +2.735096327707916e-02   -1.992725736671558e-03   -1.123175178250351e-02   +8.301494762369122e-02   -4.992369432372568e-02   -1.656716647940050e-02   +1.182455128368489e-01   +6.220635682486533e-02   +7.658811452181513e-02   +4.972909982698944e-02   -3.650751462982084e-02   +8.709666644623726e-02   +7.134730584513665e-02   -1.688319271185362e-02];
L2I_L1I_iGABA_netcon = [+1.582651315493425e-02   +5.180939424789306e-02   +5.681304672642239e-03   +1.527528984709998e-02   +3.306524547873566e-02   -1.090467994421398e-02   +2.059725986034164e-02   -1.618363566473897e-02; +2.714799567189676e-02   -7.407742296327749e-03   -1.613545117259413e-02   +3.190807719274199e-02   +8.943596854615703e-04   +1.436403828596103e-02   +6.146523137219530e-02   +1.768631121322143e-03; -1.157059978392037e-02   -2.881113014040191e-03   +1.155204806935575e-01   -2.243000048170502e-02   -2.750220198403605e-03   +2.799582118825465e-02   +8.833301250808430e-02   +1.072574154584526e-02; +1.089581030211025e-01   +1.599094312570161e-02   +7.866611196112153e-02   +1.933076591337429e-03   +7.595706206241845e-02   +4.282405231397757e-02   -1.363161690573619e-02   +9.142013559093200e-02; +5.949788983909923e-02   +2.712035952648550e-02   -1.484363811073790e-02   -3.761769246617599e-03   -3.508051873928022e-03   +7.707964130996498e-03   -4.822974223682349e-03   -3.155741972733568e-02; +3.366303236718785e-02   +2.710421118911861e-02   +9.288902410705230e-02   +6.786023654385482e-03   +3.548660393098858e-02   +3.990783988306756e-02   +4.549198164116449e-02   -1.391264185866787e-02; +4.634646301043162e-02   +7.543572737343830e-03   -7.218072829797004e-02   -3.224510321169626e-03   -9.605144985025588e-03   -3.446326699432811e-02   +4.437356119560729e-02   +4.565971426026938e-02; +1.042000426586261e-02   +3.216272726003667e-02   -6.144434070320575e-02   +1.332370834643487e-01   -1.375649807120269e-02   -1.896997195675206e-02   +5.586282337084970e-02   +2.678085489587540e-02; +3.042649533180557e-02   +9.854483570946133e-02   -6.604951179392282e-03   +4.241403088630877e-02   +2.821338789178868e-02   +1.388176444392757e-02   +7.716157624802919e-02   +2.461978900459055e-02; -3.846055732192810e-02   +7.446520998390233e-02   -1.998514580662360e-02   +8.974009903853049e-02   +2.500209730613525e-02   -5.202872583576596e-03   -1.440208345484294e-02   -3.163451191199525e-02; +4.004582308486387e-02   +5.267508953136744e-03   +9.714764029435752e-02   +4.454180319933217e-02   +1.804613038381721e-02   -4.766947730379880e-02   +1.243890732073935e-01   +1.053489444873144e-01; -8.417072181616449e-03   -8.688264650914934e-03   -1.457563985972767e-02   +6.351427866700583e-03   +8.603979473280726e-02   +3.761999946782889e-02   +2.911379834635341e-02   +7.064765661373539e-02; -3.345905976111391e-02   -5.883622608917147e-02   -3.736133765376142e-02   +1.291956295839101e-01   +1.587618064850601e-02   +6.812068057066663e-02   -1.883224251836913e-02   -1.050215258535967e-02; +1.620172601698022e-02   -7.352408276241931e-02   +6.293983097629997e-02   -5.820964858644444e-02   +3.176288064535728e-02   -9.783478867732245e-03   -8.624793924262979e-03   -1.444449731808045e-02; +1.079242782299882e-04   +6.454487295076550e-03   +1.984025688298697e-02   +6.498563322771732e-02   +9.625582533846731e-03   +6.766709372855746e-02   +7.743188402513920e-02   +3.780256229548901e-02; +1.443089389119042e-02   +7.252103211923230e-02   +4.613736856350093e-02   +6.537401606391270e-02   +5.792204129404100e-03   +2.339518400119419e-02   +2.250198849740894e-03   +1.001968117589245e-02];
L1I_L2I_iGABA_netcon = [-3.259368685496208e-02   +6.039877215040941e-02   -4.903716075122740e-03   -4.184729923533288e-02   +4.882690918256171e-02   +8.837823058918848e-02   +4.593488429144173e-02   +5.693689055339509e-02   +4.019972752376176e-02   +3.680181862962922e-02   +5.891356069812713e-02   +3.994710440970481e-02   -1.138291024579428e-02   +3.668800996566955e-02   +4.253489472466905e-02   -2.863939421432575e-02; +2.108278739952490e-02   +1.850489765820616e-02   -2.154566339462972e-02   +4.629212876562875e-02   +6.586983525657722e-02   +2.018225091616191e-02   +7.656769760911465e-02   +2.390668325218788e-02   +1.123524176574891e-02   +7.873473144250387e-02   +1.104502271677773e-02   -7.851973892395604e-02   +7.704033460403893e-02   +3.174175762683284e-02   -1.683218777382779e-02   +2.276454707217868e-02; +5.218905599516414e-02   +3.562755567668364e-02   +7.008997186043066e-02   -1.962610251492040e-02   +9.874703434194448e-02   -7.605656710534583e-02   +5.053535714184763e-02   +1.307483009007290e-03   -7.155288884499759e-04   +3.740790239111142e-02   +1.015077081944123e-01   +2.289889172759358e-02   +4.726419941086826e-02   -4.670555812489487e-02   -5.081218842866719e-02   +1.099182136300548e-02; +7.007999449946473e-02   +7.096470905084380e-02   +7.002413345641877e-02   -2.508903740856942e-02   +3.549452885069478e-02   +3.737939611841862e-02   +2.369094663534660e-02   +2.321655680604346e-02   +2.001955930364000e-02   +4.902452909847183e-02   +5.923794679935746e-03   -6.107854083989678e-02   -2.240972496451801e-03   +1.482916002298943e-02   -1.684479365798777e-02   +4.329786149812494e-02; -1.472196576064420e-03   -1.034564140000619e-02   +4.397569577485026e-02   +3.350423002662206e-02   +1.016527340486000e-01   +8.087180828268752e-02   -5.357898827758782e-02   -1.763676097957148e-02   +6.555938494166398e-02   +2.048260871300280e-02   +2.551791239807126e-02   +5.605161953823971e-02   +2.489029124692314e-03   +2.507160163576035e-02   +5.564230702923733e-02   +8.482508853855203e-02; +3.229199454333444e-03   +4.471400442441543e-02   -2.686821060425858e-02   +2.636422065142944e-02   +8.149442126119097e-02   +6.694294529555302e-02   -7.149189912669127e-02   -3.375946915495103e-02   +2.234438707274872e-02   +5.116503247943171e-03   +1.636846112723069e-02   +5.800341254697916e-02   -4.963692917256770e-02   +5.309410217703411e-02   +4.535359368466879e-02   +4.134942890980657e-02; +1.603715761333079e-02   -9.517612352760480e-03   +2.239780273311179e-02   +4.608584164624990e-02   -1.667214674245533e-02   +7.459095247182906e-02   +2.932136406242207e-02   +4.549959684027860e-02   +4.265379569018480e-02   +1.950413975742965e-02   +4.574818929338391e-02   +1.402030680634568e-02   +4.365391085895497e-02   +3.060936460531451e-02   +7.496332431867100e-02   +8.139343820389739e-03; +4.392134144663819e-02   +5.731371699218828e-02   +4.724781255290082e-02   +6.163117880031314e-02   +6.724706484510791e-02   +8.895465117738394e-03   +4.691287436993637e-02   +1.829067829131261e-02   +5.881371102494191e-02   +5.589316719593370e-02   +4.464453462045667e-02   +2.243138881553755e-02   +1.748460025116610e-02   +1.169562946983807e-02   +2.232557111867615e-02   -3.799500688894494e-02];
L2E_L1E_iAMPA_netcon = [-1.551427715153705e-02   +5.701117019062469e-02   +4.434391470091653e-02   +7.410010444368847e-02   -1.579096736220129e-02   -1.742910963017670e-02   +9.134236978008684e-02   +5.246917998730623e-03; -1.670512121270186e-02   -1.333556619397804e-02   +1.682715942107355e-02   -5.321414436352362e-02   +4.523627566512773e-02   -8.759179391113968e-03   +6.206546074655549e-02   -3.608364977216320e-02; -1.190198077455527e-02   -2.084187909945865e-02   +7.302513108472990e-02   +1.866737262237200e-02   -3.707415926337357e-03   +2.414488108355943e-02   +5.286936212600584e-02   -1.113896535754448e-02; +1.035001623498739e-01   -4.559667419159441e-02   -5.869317167092909e-02   +2.949369207087329e-02   +4.965829696322777e-02   +5.590997732611843e-02   +3.197084960320470e-02   -6.333370123479423e-02; +6.986122838561358e-02   +1.306576038112155e-01   +1.049743697859256e-02   +3.128240786799767e-02   +8.035434796710345e-02   +3.414740224259409e-02   +3.529937012211540e-02   -4.647441897059082e-02; +7.569954454117313e-02   -1.663807085470632e-02   +5.136760837733900e-02   +4.895809050047556e-02   +6.025593539961672e-03   +1.002080532845821e-02   +8.648103302197327e-02   -2.328818782911080e-02; -3.868608792193530e-03   +2.117427646156476e-02   -2.011017945787712e-02   +1.840280125188640e-03   +1.530516585639560e-02   +6.395462581923819e-02   +4.894535447460432e-03   +6.768760433516632e-02; +3.618921606328361e-02   +8.982656287051195e-02   +8.377020680655808e-02   +3.551651374213429e-02   +6.394680888586379e-02   +3.173960084024767e-02   +4.028238954596377e-02   +4.436571166795781e-02; +6.261786118512029e-02   -2.018126938276416e-02   -1.607061771836769e-02   -1.716655556352793e-02   +1.144778068564042e-01   +3.617854052777714e-02   +4.399375486487359e-02   +1.207250130716163e-01; -7.507943030095427e-03   +7.413657170121765e-02   -6.239818136206252e-03   +3.527192783666148e-02   +7.110826977835689e-02   +5.238161129226784e-02   -7.572117196966568e-02   +4.113679787436956e-02; +7.218824817177003e-02   +8.866040817728529e-03   +2.705969043318458e-02   +2.712923139401578e-02   +2.290099884595950e-02   +4.668658453714954e-02   +2.641798204643416e-02   +1.289750936915634e-02; -2.719038711842892e-02   -8.686348716075777e-03   -2.041586015684556e-02   +1.731271922752538e-02   +9.073937561301358e-03   +1.457896374781863e-02   +1.269940994742106e-02   +5.968338516377270e-02; -4.859702310680355e-03   +3.930914685594671e-02   +8.376280045857068e-02   +1.090957039434848e-02   +1.001342145367864e-01   -1.585253418667723e-02   +7.395002024833808e-02   +3.645609649698683e-02; +3.317579867082916e-02   +2.335000757662088e-02   +6.641483966146189e-02   +7.333806806577882e-02   -1.073679871789187e-02   +6.517406424313393e-03   +5.679677548670633e-03   -3.313683599777644e-03; +2.620863486339396e-02   +2.884348557773133e-02   -2.487725027743467e-02   -3.248964171159908e-02   +1.150583087381431e-02   -7.876641371011003e-03   -1.774368122951188e-02   -2.062252108655808e-02; +3.614688819769394e-02   +3.424301722586398e-02   +6.904267545554416e-02   +4.628270913308630e-03   +1.449277406180806e-02   -4.811606363839994e-02   +7.750205402879362e-02   +8.499346087687614e-03];
L1E_L2E_iAMPA_netcon = [-1.141942572825535e-02   +3.440166466071388e-02   +2.240805574457126e-02   +6.533455685002740e-02   +1.898708419776299e-02   +6.188213590512226e-02   +4.645789848400615e-03   +2.375711568944235e-03   +9.861725506962951e-02   +1.084072093299201e-02   +4.067824551374650e-02   -3.615429004788217e-02   +2.338959668458744e-02   -6.957260954641178e-03   -6.820122263817484e-03   +3.966122295327237e-02; +1.410995148728845e-02   +4.153253893653067e-02   +1.065085444570018e-02   -1.065233965299605e-02   +1.444351264663571e-02   -5.469299455543396e-02   +2.472879062292653e-02   -1.725903269369744e-02   -5.172866389973312e-02   -8.911295333305438e-02   -2.946299191627302e-02   -5.562854459727253e-02   +4.628696817440030e-02   -1.364653447873968e-02   -2.156174034716200e-02   +5.897516370245141e-02; -2.460598655261668e-02   +3.250925453953838e-02   +6.001280410499021e-02   +6.414990818770745e-02   +9.361020590373056e-02   +3.617720445843250e-02   +7.407032231641123e-03   +8.319095037683152e-02   +6.831592869006310e-02   +2.079630074350635e-02   -6.789724187460364e-02   +3.658262741690227e-02   -2.356625558297821e-02   +1.492662635867151e-02   +1.399150866841962e-02   +3.671167650225930e-02; +4.271899894320105e-02   +3.845075298534588e-03   -2.228386438362260e-02   +7.890053125697993e-02   -5.507775765448147e-02   +3.063350124192200e-02   +9.641077780017219e-03   -1.857809047562344e-02   +7.150097069234655e-02   +9.059758457634927e-02   +5.773952428022402e-02   -3.204024793891032e-02   +4.573937595724679e-02   -3.483078644398764e-02   +2.738769378550012e-02   +2.034203850976062e-02; +1.230435294277294e-02   +9.209911742117093e-03   -1.704269349791832e-02   -1.382518938555127e-03   +1.169170830234982e-01   +1.206197694640140e-01   +2.996553545811658e-02   +2.964557606538393e-02   +2.681125612671873e-02   +1.856933054195681e-02   +8.318143605300987e-02   +1.956140035324881e-02   -3.960157045225494e-02   +1.365057481223941e-02   +6.412588111124375e-02   +2.767502653662970e-02; -1.008226164205631e-02   +3.059287631672800e-02   -2.450840318161136e-04   -1.891814702840082e-02   -8.163461264344113e-03   +6.238516448236404e-02   -8.458144525918929e-03   +3.033030533831328e-02   +8.777477936325705e-02   +3.369121402732846e-03   +2.426420007502663e-02   -5.871298506917271e-03   +5.291618782960041e-02   +1.180616041515540e-02   +2.427358339056341e-02   -7.671895569071078e-03; +4.593185546616266e-02   -2.915230146426951e-02   +1.403015143686353e-02   -4.227695966250429e-03   +7.692398825678615e-02   -4.129618777195470e-02   +1.177098758534322e-02   +3.811163499620694e-02   +3.704160126983509e-02   +6.116029537874286e-02   -3.505540228485865e-02   -8.158660094780650e-03   +1.290385416492496e-02   -1.937738825497276e-02   +1.067879281343701e-01   +1.558187727360968e-02; -3.462325976553329e-02   -2.949867075279572e-02   +6.841053899116147e-02   +5.771885739334515e-02   +2.053292246802038e-02   +6.547584738380047e-02   +5.525525733949682e-04   -1.828317342102797e-02   -8.778549986862521e-03   +1.003074332343297e-01   +6.990557063902847e-02   +1.268195108832471e-02   +5.421421239992961e-02   +2.562285430405508e-03   +9.397619303949115e-02   +8.863359067311111e-02];
L2I_L2E_iAMPA_netcon = [-1.499106922482746e-03   +6.380606468113241e-02   -3.376662429825660e-02   -2.035920228447970e-02   +5.615122281901300e-02   +3.609512405879377e-02   -3.549852666707456e-02   +1.050495629537270e-01; -2.253825826036881e-02   +1.644952975847306e-02   +1.582899801443360e-02   -2.427785723902717e-02   -9.380737394527392e-03   +5.626756365790190e-02   -1.446645664530196e-02   +4.867810609317814e-02; -1.694188344748299e-02   +2.839398177170615e-02   -1.810072515616156e-02   -5.395009689629655e-03   +1.584659971814843e-02   +8.316230108504941e-02   +2.420487987242107e-02   +2.262962171171390e-02; -3.844587599864748e-03   +1.963344222984292e-02   +5.994719150214793e-03   +1.776695942230874e-02   -2.835667270775285e-03   +1.197632821619807e-02   +4.944822761058475e-04   +3.656257875366517e-02; +6.813355919559217e-03   +5.162728839833260e-02   -2.387542320447054e-02   +3.734650404436871e-02   -2.008736401567502e-02   +5.363592279032717e-02   +9.911917101872995e-03   +7.049900806199434e-02; -1.542595034496924e-03   -1.265835614463056e-02   +5.110990590756352e-02   +3.533925711110338e-03   +9.524859532455572e-02   +3.677943083796983e-02   +1.199140446884105e-02   -2.939936417311673e-03; -3.559334802426360e-02   +1.715616905020344e-02   +2.137177420491105e-02   +3.131446312000129e-02   -6.623547194889172e-02   +5.655394894556671e-02   -4.815028534902516e-02   +9.617641651191271e-02; -4.106001629807474e-02   +6.736998993041263e-02   +1.248105726005536e-01   +6.787163612490021e-02   +6.405081209534480e-02   +3.714541649195077e-02   -9.935552973297694e-03   +8.492119494033522e-03];
L2E_L2I_iGABA_netcon = [+5.995379922020828e-02   +2.055827342127547e-02   +5.610821241601240e-02   -6.002369745086393e-02   +6.080512752957269e-02   +3.906637296365212e-02   +1.600426434081953e-02   -2.386473681312850e-02; +8.650956899740485e-02   +6.978272322052512e-02   -8.454403636296294e-03   +2.368250171253426e-02   +4.207423691406523e-02   +3.378808593400216e-02   +3.743391171175767e-02   +2.345639225660581e-02; +4.971389423909840e-02   +3.697082904395114e-02   +2.039330010707487e-02   +1.375306035553092e-02   -1.468237109412910e-03   +5.810003185103331e-02   +3.921986050738784e-02   -1.179948997137334e-02; +8.877702739523083e-03   +1.448547439451608e-02   +7.131100370659324e-02   +1.199634010997219e-02   +1.726184730704764e-02   +8.338103729517347e-02   +3.436502823172616e-02   -1.077123857585608e-02; +5.016785696286181e-02   +4.943600789203651e-02   +4.713915653600947e-02   +2.441724340074309e-02   +3.658571507689366e-02   +1.732143154508189e-02   +3.042686961023733e-02   -3.248790110217442e-02; +4.445145618336738e-02   +8.245123904961629e-02   +3.576163218323446e-02   -1.399472170163243e-02   +4.180602966274490e-02   +7.482168891117280e-02   +2.869150678576453e-03   -3.670431235642181e-02; +8.651714618122661e-02   +1.206776591199789e-02   +2.918468565643679e-02   +2.387977183120047e-02   +2.960512526143822e-02   -1.270609005946479e-02   -4.063194989960155e-02   -2.007498712809537e-02; -3.698451212574297e-03   +1.443878785672543e-02   +2.844788715873170e-02   +9.500831643025683e-03   +1.830609990717384e-02   +2.380832928996707e-02   +2.662600165522273e-02   +3.986375793336251e-02];
L3E_L2E_iAMPA_netcon = [-5.133663677444973e-02   +9.356251613752989e-03   +4.574889913398363e-02   -2.579074320837091e-02   +5.187960093808767e-02   +6.125971568259310e-02   +7.091736585851525e-03   +4.173905457780294e-02   -2.694532283383087e-02   +7.488700445345570e-02   +3.850702495893382e-02   +2.713046173625245e-02; -1.676849700175452e-02   +8.028968991353992e-02   +3.440392335008009e-02   +7.105169285969259e-02   -8.510310655384611e-03   +7.104972089474861e-02   -1.237917768197825e-02   +2.358670479474869e-02   +5.115359947692739e-02   -1.769399381665783e-02   +5.758977829816332e-02   -1.941733725815097e-05; +5.667240086177447e-02   +1.134784809053975e-01   +7.987055581770233e-02   +3.917573788548245e-02   +4.451308399339318e-02   +2.851824143769249e-03   +3.609024946275135e-02   -8.778241405350089e-03   +4.416470252980677e-02   +3.480167239942327e-02   +4.545496833069510e-02   -3.763766798377048e-03; +1.976210572777940e-02   +4.214668064679673e-02   +8.048295056509798e-02   -8.443286404627173e-03   +6.212033963775773e-04   +2.518917988555877e-02   -2.342395184374940e-02   +6.372427239268112e-02   -1.733061370712361e-02   +6.881461294677066e-02   +5.558252626579289e-02   +3.671509096647358e-03; -1.400302627246056e-03   +7.136252611156682e-02   +1.237192566762232e-01   +9.335378396480128e-02   -2.038631157740255e-02   +5.675409357930412e-02   +5.790207050624461e-02   +3.343009540665165e-02   +3.846726840675010e-02   +4.047639019172828e-02   +7.873562461480003e-02   -2.904742935170773e-02; +2.765403016101529e-02   -7.431949245563048e-03   -1.180487936903365e-02   +7.442838467649091e-02   +6.426974008003912e-02   -1.707714822443332e-02   +6.804061448661199e-02   +9.220833693964861e-02   +4.671503908060998e-02   +3.465615060808432e-02   -5.581296852185564e-02   -3.275175258366784e-02; +6.459092899158975e-02   +9.605119967907392e-03   +1.949271530340661e-02   +4.914917818902097e-02   +2.099713477304581e-02   +2.813473290257055e-02   -2.008591446425113e-02   +2.912933869925826e-02   +5.166687038423180e-02   +5.245859988515900e-02   +9.016254834304033e-02   +5.409542406763959e-02; -5.982011954211955e-03   +2.836441485406740e-02   +4.234159049190703e-02   +7.220395675868765e-02   +3.963041958718268e-02   +6.875246561665754e-03   -3.640705006287558e-02   +9.289588721125520e-04   +1.482841598710708e-02   -3.996703616109389e-02   -1.730497037691151e-02   +4.117300273948488e-02];
L3I_L2I_iGABA_netcon = [+1.182844617801286e-01   +8.472927894770373e-02   -5.248475671526167e-02   +1.869820624111506e-02   +2.465758009115561e-02   +3.323554293251563e-02   -9.947175005281101e-03   +7.717827680213862e-02   +2.161657566150041e-02   +2.163469520400346e-02   +9.668822803057352e-02   -1.345483191435724e-02; +4.575698174068976e-02   -1.945325821766592e-02   +4.481083415145923e-02   +8.372568433097999e-02   -1.717039691148822e-02   +4.125003778337991e-02   +6.074901613286785e-02   +2.326643167791147e-02   +5.331370583089629e-02   +3.667243182386353e-02   +5.497258422613321e-02   -7.696727390409241e-02; +1.360722059444574e-03   +8.415481750757585e-02   -1.072387693488813e-03   +8.290576715929621e-02   +1.122763796813574e-01   +9.088449598444246e-03   +6.678411150128051e-02   +5.374154279100627e-02   +4.291077873758023e-02   -6.911322862556864e-02   +7.957965781273577e-02   +3.710758166925530e-02; -1.760856277655169e-02   +8.586787696481936e-02   +6.353996742500848e-02   -1.462394016418890e-02   +1.028625490595423e-01   +1.598864294661943e-02   -7.267809427032176e-02   +7.136796736835721e-02   +7.744375790984484e-02   +9.374065974408367e-03   -3.160485504026259e-02   +1.307731580182957e-01; -6.173399657416636e-03   -1.516367739171804e-02   +9.255671967112586e-02   +4.432109366984856e-02   +1.292059692751394e-01   +2.128367368889402e-02   +1.139309327613904e-02   +1.059745175446802e-01   +2.174599703555804e-02   +2.601264983836707e-02   +3.224222484457926e-02   +2.051493860153913e-02; +6.655739298289365e-02   +5.213593499971306e-02   +6.875503246151135e-02   -3.407147238874258e-03   +8.780660484230662e-02   +2.779045999212734e-02   -5.634430970890510e-03   -1.662756938069315e-02   -9.425795816373705e-03   +1.195296779794458e-02   +5.382335803626857e-02   +2.807414796104953e-02; +2.639952565350778e-02   +4.360318304027672e-02   +5.277558958063572e-02   +5.313135681242523e-02   +4.728170090816997e-02   +5.323756153274958e-02   -3.011279479803709e-02   -1.089877906682920e-02   -5.786129897573132e-02   +4.351926302450768e-02   +5.582355513427237e-02   +9.603787498846765e-04; +4.939639877817789e-02   -2.771578606945473e-02   +1.761453148983165e-02   -4.169022339758919e-02   +6.889695303397717e-02   +3.960184299225104e-02   +3.289221371230540e-02   +7.961041119255945e-02   +1.512601381547367e-02   +7.622872140575797e-02   -4.838303267743520e-02   +4.933725769912285e-02];
L2E_L3E_iAMPA_netcon = [+1.000517016498838e-01   +4.130940602313554e-02   -1.191039920870034e-05   -5.871860761185739e-03   +3.473431489862823e-02   +1.265017477657294e-02   -1.758006869633475e-02   -3.254920805565466e-02; +2.170644639188307e-02   +4.863000893552487e-02   +6.878942127720390e-02   -4.650009888775038e-02   +6.757203600163476e-02   +2.475710611878241e-02   +5.623899277110316e-03   +7.763652621246640e-02; -1.378399673260209e-02   +3.513780575768857e-02   -1.940918426405014e-02   +3.839461008037705e-02   +1.275683884757942e-02   +6.030584724625578e-02   +9.477512661380164e-02   -4.224233672584995e-02; -9.794207554571352e-03   +1.046366474925329e-02   +1.606831612628321e-02   +1.276980119005299e-01   +3.365819114151686e-02   +8.646989802476794e-02   -2.211250558018046e-03   +4.213398920958908e-02; +8.188933479897453e-02   +8.308955000757272e-02   +7.907985505251898e-02   +5.603690176969753e-02   +6.081816522896109e-02   -8.031106084293027e-03   +1.192183790925250e-02   -5.718327927283914e-02; +1.945457941068390e-02   +6.989619109428641e-02   +4.491538408566002e-03   -2.235544161221255e-02   +6.054208581906155e-02   +5.269366383627250e-02   +4.769211818144703e-02   +4.834761855639549e-02; -2.278578841969735e-02   +3.979128488003594e-02   +1.857422795767522e-02   +1.775606111876010e-03   +4.905101042505024e-02   -1.136970300852426e-02   -9.906175071858004e-04   +2.670040484578831e-02; -8.985853997624589e-03   -5.601800729638053e-02   +9.354011946055564e-03   -1.635257764364420e-02   +6.969436016511685e-02   -5.165245799459092e-02   +1.253487347875404e-02   +4.246279260775614e-02; +7.142370506042074e-02   +3.511900112959576e-02   +3.954965502070289e-02   +6.735546135366344e-02   +4.074898539918105e-02   -4.520229967137084e-02   +5.136661071491749e-02   +6.640678795359206e-04; +7.105516525701710e-03   +1.010001684992252e-02   -2.346378025729605e-02   +7.121985916274629e-03   -3.605075628587339e-02   -1.332935971663128e-02   -1.365653958135410e-02   +8.271369627238694e-03; +5.999375638829952e-03   +3.487866172065523e-02   +6.399802217187678e-02   +1.853110714294148e-02   -4.517973101446388e-02   +4.722996654430504e-02   +4.354740465777714e-03   -1.512449159502124e-02; +4.971829843424648e-03   +1.540762181541835e-02   +2.165511798933420e-02   +2.192771252919667e-02   +7.079997753136917e-04   +4.049708255881004e-02   +6.739885502808636e-02   +5.703205924945227e-02];
L2I_L3I_iGABA_netcon = [+2.853608311675538e-02   +5.424716817517029e-02   +1.629214280112242e-02   +2.370509084307811e-02   -2.984845242171718e-03   -9.928962829679644e-03   -1.047259742978987e-02   -4.142868150932410e-03; -3.780073850230981e-02   +5.106921295825992e-02   +1.178918187276573e-02   +1.360688481360985e-02   -6.054712624009943e-02   +1.823422475990164e-02   +2.619470790829403e-02   +1.250772573597038e-02; -2.221096078597164e-02   +3.339703272735570e-02   +5.620686231022729e-02   +3.496031453668742e-02   -4.614855690699266e-02   +1.832087996162118e-02   +3.860867552928329e-02   +8.627852309010391e-02; +2.231884041514473e-02   +4.653290203066546e-02   +1.815290760089522e-02   +8.016363121029728e-02   -2.449944129827604e-02   -3.556752003241526e-02   +1.700288979528251e-02   +5.805119385102085e-02; +8.030866887327878e-02   +5.933876045833498e-02   +4.172391032483823e-02   +7.060704773873565e-03   +2.623369938862080e-02   +5.120049996202311e-02   +5.859612514656624e-02   +6.975748123174957e-02; +4.824800914275237e-02   +6.743110281749575e-03   +1.640549180346968e-03   +3.343036967059297e-02   +8.602297291290663e-02   +1.299452678182901e-02   +1.369817950566257e-02   -1.922525963952922e-02; +5.325177953297413e-02   +1.007052658235042e-02   +6.431807699797289e-03   +6.015676152291372e-02   +2.696898574944881e-03   -3.505979303291080e-02   -1.856786950100611e-02   +1.523145281022287e-02; +1.689317043119771e-02   -5.346762598364189e-02   +4.654518144541615e-02   +6.454014029032649e-02   +3.575146109204669e-02   -2.991245090270556e-02   +3.509086804153862e-02   +2.412861610330792e-02; +3.537945530777600e-02   -3.348345330130313e-02   +4.326217528383862e-02   +3.548409771111958e-02   +2.980340034330244e-02   +3.997477898763939e-02   +2.784425900064371e-02   +5.698339640837036e-02; -2.115211774601331e-02   +6.234673035475082e-02   +1.731997467995760e-02   +3.085138568889776e-02   +8.360830658461792e-02   +1.497399983002237e-02   +4.533762786364052e-02   +8.955168760694981e-02; -1.721599713753632e-02   +5.539975037222809e-02   +1.838107448114084e-02   +5.097700870302822e-02   +3.272695206717408e-02   +3.417408681758485e-02   +1.064627104874034e-02   +2.470467304240723e-02; -1.009427666448089e-02   -2.545200907592444e-02   +2.834550999235736e-02   -2.413908721472524e-02   +3.835337939406186e-02   +1.766584056986598e-02   -1.541874465773809e-02   -4.767444755273804e-02];
L3I_L3E_iAMPA_netcon = [-3.327557604112946e-02   -2.135269672840353e-02   +2.333215554270144e-02   -5.614206027159661e-03   -3.816822145391041e-02   -6.034165224886083e-03   +4.975569583515771e-02   -2.012339195316998e-02   -2.671977607328887e-02   -2.419430523714110e-02   +1.085608692270467e-02   -4.185160997667523e-02; -1.543909827775157e-03   -7.388087086615792e-02   +2.237689595447143e-03   -9.370808740741162e-03   +4.717326522755708e-02   +6.547557126557001e-02   +5.296718749961203e-02   +1.625255343814102e-02   +5.284343340396660e-02   -6.499159284613323e-03   +4.812464235439320e-02   +1.019007006925529e-01; -9.549065850031299e-03   +2.495436900764620e-02   +9.922624812495569e-03   +2.047525602746341e-02   +2.093484183599579e-02   +3.637784867927919e-02   -8.168500138343228e-03   +2.018305621362690e-02   +2.642017076994802e-03   +2.245933863106660e-02   +2.163140734300374e-02   +3.817799157788348e-02; -1.715925830675890e-02   +2.722316421387627e-02   -6.042195231671386e-02   +2.471396972659403e-02   -3.694953439856459e-02   +1.670274047345727e-02   +1.031126692480675e-03   +1.674743086329028e-02   +4.788269260115324e-02   -1.932465334556777e-02   -2.405687281226951e-02   +8.352651940863428e-03; +6.108783486587892e-03   +6.254957912521028e-02   +3.236339180162664e-03   -2.703868028007000e-02   +1.598600297793908e-02   +1.840816600153361e-02   -6.026811676873592e-03   +1.977480734798268e-02   +1.510893916334063e-02   +2.900572958267529e-02   -3.318431936374229e-02   +5.774151402736670e-02; +1.478812520152919e-02   +1.103941894646620e-02   +4.438146287541293e-02   +9.912923198543011e-02   -2.806795930132578e-02   +6.601841099285261e-02   +3.078972410232245e-02   +5.048933693735627e-02   +5.180076382076214e-02   -3.387054651018955e-02   +6.494351504169840e-02   +5.192830016056738e-02; -3.305832896702857e-02   +6.412480261611939e-02   +8.871169748471248e-02   -7.298347783608525e-03   +5.492225195305198e-02   +1.133521218924994e-02   +3.713067681375684e-02   +5.990065038984737e-02   +6.394120202534104e-02   +1.970375184420308e-02   -1.097401822204058e-03   +1.563656361108782e-02; +3.227806647942526e-02   +1.675566748467151e-02   +3.506470178720818e-03   +5.272598764695871e-02   +4.432477331810607e-02   +2.137565668082636e-02   -3.331497240584755e-02   +9.647939751369286e-02   -5.156068194199670e-02   +3.386704662604081e-02   +2.535536011397997e-02   -2.587684011868737e-02; -5.166236887315098e-02   -2.417372756840983e-02   -6.976603653734864e-03   -2.099114476727106e-02   +3.173181576268649e-02   +8.584977700064680e-05   +5.878349607098699e-02   -2.172004853339651e-02   +2.153566071907698e-03   +8.875315020259456e-04   +2.401603075980208e-02   +1.914475519379982e-02; +7.946649018086088e-02   +2.432235364569219e-02   +2.327595276190194e-02   +5.631894225907397e-02   +1.194834281232859e-02   -1.305868712284223e-03   +3.157204168951992e-03   +1.100986691527307e-01   +7.809656736439401e-02   +3.720033996226277e-03   -2.917070394119510e-02   +9.292360611161039e-02; +5.874251292533131e-02   +1.147016609316078e-02   +2.521800473078501e-02   -1.652643748215672e-02   +3.689549319935158e-03   -2.032935139474010e-02   +6.150434574470176e-03   +3.526907932400500e-02   -2.641802245181823e-02   -3.679690235160037e-02   -1.043721267306814e-02   +4.806115612344197e-02; +3.758516328980875e-02   -4.479971496690004e-02   +2.333266045339583e-02   +3.657311983907446e-02   +5.827557750691660e-03   +2.588775646850112e-02   +1.148904942498258e-01   -1.233424648771833e-03   -4.660751510112789e-02   +3.006928761554582e-02   +6.385807826836849e-04   +6.071158042717253e-02];
L3E_L3I_iGABA_netcon = [+4.399493665808022e-02   +5.137404281254089e-02   +6.127626382969953e-02   +1.008822244974239e-01   +5.009469706753455e-02   +1.176014463266195e-02   -1.276949349266693e-02   +1.240422478515939e-02   -1.733631228317982e-03   +2.574426813780711e-02   +1.416706858555423e-02   +2.902658488502383e-03; -3.831369833280338e-02   -1.470023021006400e-02   +5.565711799711873e-02   +7.364664935526577e-02   -1.194604381743285e-02   +3.695331908744794e-02   +3.774956935187645e-02   +1.335634852705370e-02   -4.585561716963811e-02   +4.273629097319715e-02   +8.348284228146224e-02   +2.249521684189088e-02; +5.244383977327199e-02   -2.639792787455165e-03   -2.420779219353391e-03   +5.406949686097498e-02   -5.406099124717068e-04   +5.467068317889257e-02   +4.329001941198950e-02   +5.762960197259941e-02   -3.676034928207598e-03   +7.876798908919931e-02   +1.727372626970176e-02   -6.879493467743260e-02; -2.021257252632239e-02   +3.544766617115211e-02   +1.478095702962932e-02   -6.148932820689915e-04   -2.120632465953416e-02   +6.378067031878210e-02   +7.737931496768886e-03   -3.133948934339885e-02   -1.027692511073478e-02   -1.588116150721457e-02   +6.962771783737108e-02   -1.165476141628467e-02; +4.209268631580947e-02   +2.022668358240465e-02   +3.115178779143409e-02   +2.414316025503970e-02   -4.809245742623446e-02   +5.087121601341670e-02   +3.723680370402330e-02   +3.042465575527549e-02   +1.454836592527523e-02   +6.239961167088470e-02   +5.784821001235785e-02   +1.635754128722344e-02; +2.195533578125397e-02   -2.435376332482057e-02   -8.020738806791378e-03   +5.299291523776942e-02   +9.694868129304329e-02   +2.831786503078807e-02   -1.818595524863052e-03   +1.623611787999274e-03   +1.197840788877600e-02   -2.483518294316251e-02   -6.413747356738386e-03   -2.466869475608992e-02; +2.569206426562799e-02   +6.959535745504002e-02   -7.088583662244963e-03   -4.133244279101064e-02   +9.580261872715275e-02   +7.402162788186618e-02   +1.791469842168244e-02   +2.053638759641353e-02   +2.362900979593545e-03   +1.549313735136030e-02   +1.151299369387168e-02   +2.332817274628239e-02; +4.204247872622388e-02   -3.106403913280613e-02   +2.741753808560324e-03   +6.579021040632567e-02   +5.085414836168799e-02   -3.878247557218528e-02   -1.935622988637035e-02   +5.828967371047591e-02   +3.191135616023405e-02   +4.083383700496143e-02   +5.782222955769358e-02   -1.184896928403822e-02; +6.549167220389147e-03   +3.543437350984005e-02   -2.104280853559498e-02   -9.593158798363628e-03   +9.842626984017717e-02   +1.045280781502116e-01   +2.733491858520638e-02   -6.188718495974539e-02   -4.612053013319579e-02   +4.374892674107320e-02   +5.115618857938373e-02   +3.391738596375456e-02; -2.072337173353076e-02   +3.396541223856923e-02   +3.869524308760589e-02   -2.327500655534165e-02   +2.637196315921659e-02   +2.454805724169824e-03   +5.608718816701534e-02   +6.291774760253163e-03   +1.130629670637904e-02   +3.563409948647278e-02   +7.686194707282087e-02   -1.810847394549994e-03; +2.032171954320610e-02   +3.421442048440897e-03   -2.241792511724698e-02   +2.937719473073613e-02   +5.872988423911352e-02   -4.382393812214673e-02   -1.070420743042829e-02   +2.066640997172088e-02   -1.214328416297828e-02   -5.574713438478208e-02   +1.271651866428167e-01   +3.381645114494979e-03; +1.245415962933772e-02   +1.017305786099502e-02   -7.253711336453568e-03   +3.835879207834052e-02   +1.015044711939432e-02   -4.003970203737762e-03   +6.857422819418200e-02   -4.903262940617148e-02   +5.712369764837839e-03   +7.659490780062721e-03   +2.200415591094555e-02   +2.940120437800409e-02];
L2E_Input1_iAMPA_netcon = [+3.930707271399787e-02   +3.828699122016875e-02   +6.897026074220909e-03   +1.993502509962186e-02   -2.895562171630403e-02   +4.787259111934400e-02   +4.548781442191106e-02   +5.723385634548785e-02];
L2I_Input2_iAMPA_netcon = [+8.172012773569413e-02   +8.014778916486606e-03   +5.606538768982870e-02   +6.516840102687479e-02   +9.390301962054490e-03   -7.004515433387338e-04   +1.095356906163406e-01   -2.628249022798151e-03];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
