function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+6.195304209902495e-02   -1.637531242594765e-01   +1.997920088111734e-01   -1.487234704825373e-01   -5.509960892154395e-02   +8.942643054574201e-02   +3.071521370289952e-01   -2.290772877950412e-01   +3.648450090084011e-01   +3.995664761897141e-01   +1.121882597766760e-01   -4.363733078655480e-03   -3.136762434424809e-01   +1.304703474541343e-01   -2.259297732269025e-02   +2.521592651051143e-01; +1.419125825875351e-01   +1.931265374003402e-01   +2.936028910763890e-01   -2.740062005932235e-01   +3.340961267827501e-01   -1.953886348122417e-01   -1.677213227155843e-01   +1.445666882710908e-02   -8.084277327908450e-02   +1.077927941521647e-01   +2.962141870664740e-03   -3.181285504457004e-01   +1.350357370676373e-01   +2.517518179179572e-01   -1.395191311406183e-01   +1.287126465036023e-01; +4.497393656160575e-01   +3.684989484787108e-01   -3.052328698654737e-01   +2.908019541749157e-01   +6.242524763992524e-02   +2.467723650885332e-01   -2.544089476768409e-01   -5.852938860779844e-02   +3.489458833425634e-01   -4.735785179197777e-01   -1.146475369371189e-01   -2.026794245682423e-01   -5.521149666336886e-01   -7.400548331267698e-02   +1.467746401556758e-01   +2.452444262412452e-01; -1.413794816896183e-01   -2.304147939429177e-01   -1.395797169834637e-02   +4.696694765864867e-02   +2.440835810349150e-01   -1.752088397767712e-01   -1.026569044901234e-01   +9.276594257178404e-02   +1.491615643962610e-01   +4.850145219395430e-01   +4.986124302411125e-01   +1.048619924989828e-01   +2.755059171996549e-01   +1.377831224166267e-01   -4.392110609203698e-02   +4.980769894846711e-01; +1.570643664405113e-01   -6.368682196721887e-02   +2.489768320362487e-01   +1.648290876747077e-01   +1.754820318178653e-01   +2.365790059407020e-02   -7.021239819621855e-03   -2.350997042962549e-02   +1.790009875157506e-01   +4.401757246225577e-01   -9.441959824814875e-02   +5.195623788872969e-01   +3.911465806970210e-02   +4.918755039319213e-01   -2.688304627818822e-01   +7.746334205812695e-02; +8.172448863303905e-02   +2.930165001473028e-01   +1.025160583000055e-02   -1.561337525315719e-01   +1.990500664875767e-01   -2.335133114605796e-01   +1.744038532630074e-01   +1.572044814062557e-01   -1.092348758111308e-01   -5.078686327405582e-02   +7.167182743171316e-02   +2.300340504455294e-01   +2.985119103667353e-01   -4.359613251756603e-02   -1.716351866723974e-01   -1.961805594865819e-01; +3.412858111275933e-01   +2.175360170913992e-01   +1.865910878320762e-01   +8.991278772912056e-02   -4.122750592312270e-01   -1.486013202649840e-01   -4.504236811665392e-01   -1.784972168855235e-01   +1.360617308537100e-01   +4.295114792887106e-02   +1.010565615359813e-01   +1.542958403446908e-01   +2.356052730233375e-01   -2.103874557484168e-01   +5.459512192050706e-02   +1.385628695503782e-01; +1.675717267377610e-01   +1.976458684338542e-01   +2.900119161098562e-02   +9.287714725324112e-02   +1.909470709662686e-01   -7.810446448042038e-02   +1.510728436123856e-01   -1.205031062323312e-01   +4.852509085868204e-02   -2.442965009362748e-01   +4.972535239027498e-01   +2.050384070899632e-01   -2.776533703092814e-01   +2.588939107628183e-01   -2.887277217502919e-01   -3.186102312944254e-01; -8.232444711002007e-02   +1.762589933719194e-01   +1.636070920888324e-01   -1.066346461907891e-01   -3.490681632995571e-01   -4.810537272047016e-02   +4.225715029646768e-02   -1.587056031087329e-01   -1.987936819264338e-01   +7.174769749665930e-02   +2.491234171432305e-01   -1.452543717832817e-01   +1.231720622228293e-01   +6.834580639615195e-02   +2.616783540182674e-02   -4.541326682207228e-01; -7.715122949921249e-02   -1.929958362947283e-01   -5.571863541044757e-02   +4.738764616477070e-02   -2.892012823598154e-03   +1.839399280012614e-01   +1.382084119780035e-01   -1.819962419392807e-01   -4.064305075947101e-01   -1.122628256944390e-01   +2.843686320900288e-02   -2.725381001681036e-01   +1.186896511673075e-01   +1.506936061176931e-01   -4.559882084701583e-01   -2.618603381594466e-02; -5.344615730789922e-01   -3.450800540532255e-02   -1.785115705703691e-01   -2.649325480962609e-01   +1.999218121165499e-01   +1.958693433514421e-01   -2.671552621735361e-02   -2.539994415016585e-01   +1.475474271188424e-01   -5.606455147912641e-01   -1.082155325539891e-01   -8.844561648114077e-02   +4.026982186993440e-01   -2.260573707574891e-02   -1.200441785172691e-01   +3.451265071984121e-01; -6.128135614993693e-02   -2.964879950120876e-01   +1.573205120536574e-01   -3.509668077229408e-02   -3.538856056329160e-01   -5.926077106326152e-02   -1.527711731645448e-01   +8.151829550275576e-02   -4.104234172428139e-02   -3.869344511427231e-03   -5.655979147997175e-03   -1.635077264358386e-01   +2.772084480015234e-01   +4.824915942998599e-01   -3.628158790838673e-02   +1.764446365253578e-01; +2.209630983808855e-02   -4.754864272593774e-01   -6.913133396276722e-05   -3.775526992137727e-01   +8.360690192494824e-02   +3.399707599483220e-02   +5.777254520277749e-02   -5.414123990569236e-01   -1.845450394208473e-01   -1.970222399715396e-01   -2.133394852247762e-01   +1.720910001070533e-01   -9.208648844373732e-02   +3.231668012021446e-01   +1.479209847396959e-01   +8.172924736723348e-02; +2.013469655080992e-01   -2.742437236323002e-01   +9.000963043623286e-02   +4.235921039603255e-01   +1.285099851465993e-01   +6.924024824916192e-03   -5.680290265856621e-01   +3.198892180146523e-01   -2.561909520593454e-01   -2.495347774731447e-01   -2.762891784726469e-01   +1.764349785031880e-01   +1.599692728784298e-01   -2.666799677099856e-02   -1.990321340036569e-01   +1.016837924095551e-02; +5.632850354450486e-01   -2.650221047252018e-01   -4.437219301044117e-01   -1.629673443491664e-01   +3.469859433736372e-03   +1.538492738115445e-01   +5.758547641741436e-01   +6.428895403061133e-02   -6.828735526637264e-03   -1.646262104596619e-01   -9.259322738794194e-02   -8.429313172381572e-02   +2.647017862045808e-01   +1.285366167755512e-01   +3.345403822356416e-01   -1.582396929176568e-01; +2.837240307903449e-01   -7.229714370864558e-02   +1.952128986522815e-01   -3.565609080464013e-01   +2.038694081490288e-01   -6.753956883373194e-02   -2.004046436971412e-01   -6.746744382014239e-02   +4.707989927563771e-02   -2.170634624750958e-01   +2.953285147706404e-01   -3.152172331221255e-01   -6.290895226229506e-02   +1.587375660605017e-01   -3.504647335750741e-02   -1.757024050357889e-01];
L1E_L1I_iGABA_netcon = [-6.861547984858100e-02   -7.006741237650715e-02   -3.570941506491093e-01   +3.120449444846100e-02   +3.051418676222378e-01   +4.084246781316768e-01   -7.715170797317328e-02   -1.394550479147089e-02   +7.095802940822682e-03   +6.575911558904043e-01   +1.627438792170526e-01   -4.546595128931537e-01   -5.104287855215655e-01   -4.255747515995134e-01   -1.429726023298785e-01   -3.160508264825485e-01; -1.466276512267080e-01   +2.543208493253547e-01   -1.734480467762960e-02   +9.422658196304541e-02   -6.881117196667959e-02   +1.374846821519275e-03   -3.097593425989749e-01   -4.773085793604447e-02   -3.387546128955915e-02   -4.718024358816770e-01   -1.181796887259147e-01   -2.393838157127615e-01   -1.049524749235573e-01   +1.599006594326308e-01   -3.319220907320967e-01   -2.973674253273361e-01; -3.311429608526587e-02   +2.707083314968059e-01   -8.053746416160097e-02   -1.384261952551447e-01   +7.351617012803935e-02   +1.555377053841316e-01   -2.968952596676205e-01   +4.274723099769105e-01   +4.192980206363327e-01   -3.429095508826391e-01   +3.218434608837389e-02   -2.785320111305104e-02   +2.869525870839956e-01   -3.016534786156184e-01   +1.580337208239044e-01   -2.952478960487750e-01; -3.377237578255281e-02   -8.322374450801261e-02   -5.559097194358699e-02   -9.323605204841134e-02   -5.755557414904986e-01   -1.497462994359175e-01   +2.592631957520155e-01   +1.116624692616815e-02   -1.006848389374541e-01   -5.012008328502274e-01   -1.760723943460709e-01   +1.210019576716765e-01   -1.454731962632634e-01   +2.581634136514549e-02   +5.487636247497192e-02   -3.439855161840719e-01; -5.865226033998494e-02   +3.519506313574968e-01   -2.502054424768153e-01   -1.280904122335929e-01   +1.045518166162708e-01   -2.300325021938394e-02   +3.603298474744857e-01   -7.380692963452737e-02   -1.807036094879297e-03   +1.582748627562839e-01   -1.851087285168144e-02   -9.217203121382930e-02   +1.007178941123836e-02   -7.702602511208226e-02   -1.618404380403775e-01   -1.969026429780292e-01; -8.752733446145022e-03   +6.060894797514318e-02   +2.853137893615616e-01   +1.018749737556447e-01   -1.931265396513174e-02   +2.799182388673376e-01   -4.652788906758721e-01   +3.673200369429810e-01   -3.724555403730102e-01   +2.634588932637790e-01   +2.203093341660753e-02   -4.894494219126927e-01   +1.199148369455352e-01   -2.783260944998390e-01   +2.515324909660566e-01   -2.292683546275940e-01; -1.500390445100810e-01   +2.726492573902299e-01   -9.972004252222127e-02   -1.937028499522997e-02   -1.897961745400495e-01   -1.973712430257620e-01   -1.971594425562788e-01   +1.984733975669874e-02   +2.405023773347865e-01   +1.913255897205682e-01   -4.947922043796219e-01   +8.046319463588945e-02   -2.803523199498358e-01   -6.360486252041825e-02   +7.086677078412333e-02   +4.317989031565901e-01; -3.804113503503840e-01   +3.592311188766913e-01   +1.704742401523068e-02   +2.608832779837386e-02   +1.886798711381946e-02   -3.750606801340504e-01   +2.284825863017911e-01   +5.544781712446603e-01   -2.212641843559307e-03   -9.171302078411124e-02   +2.860977844001367e-02   +1.742712068469700e-01   -5.259418420822761e-01   +1.621483053690261e-01   -7.487681341373711e-02   +1.992792299340268e-01; -3.317191089151027e-01   +3.270557830681897e-02   -2.612040084368709e-01   -6.462101614393635e-02   +1.685423830970475e-01   +5.823489723028178e-01   +7.796929623640082e-02   +1.637067044164325e-01   +1.367328306795193e-01   +3.299442773005739e-01   -2.104473400712224e-01   -2.357018277228707e-01   -6.276142272891196e-02   +1.900101562815470e-02   -2.918952501622360e-01   +5.062672201392054e-01; -2.379489609751202e-01   -2.240907028493282e-01   +2.331238135083064e-02   -2.938251592529947e-01   +3.186358850580918e-01   +1.603609230628362e-01   +6.442364646543931e-02   -8.690937910040719e-02   +1.957688782989692e-01   -7.316098505748428e-02   -4.834109092360755e-01   +6.668061296785773e-01   +1.263702580133758e-01   -2.108801221081763e-02   +2.343765909506413e-01   +3.588925646562059e-01; +1.865478660744822e-01   -1.647959056612632e-01   -9.503174359865393e-02   +2.274774329550432e-01   -3.071144831171305e-02   -2.319365972113641e-01   -1.023320717622501e-01   -4.115491655933282e-01   -3.536031574366716e-01   -1.504426521353747e-01   -5.706769005338619e-04   +2.302782980172334e-02   +2.339267171860265e-01   -5.694521521015045e-02   -3.865557785914138e-01   +4.084273098268539e-01; +1.104117004252410e-01   +2.383751249076958e-01   -2.764382099220365e-01   +1.268529330667571e-01   +9.418784797053131e-02   +2.542199631173059e-01   -3.346138283525089e-01   +2.316511611352587e-01   +4.803192290621594e-03   +1.261795610154871e-01   +2.729922002125034e-01   +1.355150930910261e-01   -2.315640917421620e-01   -7.129655098832752e-02   +1.834600615389919e-01   +7.485036276047619e-02; +1.877051576904815e-01   -8.614197622492116e-02   +4.662611672658509e-01   -1.160957004497587e-01   -3.428341865019993e-01   -1.656407067932547e-01   -1.067729736770683e-01   +3.315616455127317e-01   -3.779150152548649e-01   +1.499408305273232e-01   +1.478902167447434e-01   +1.696254308843959e-01   -7.542620568112310e-02   +8.958232555867499e-02   -2.707604930403600e-01   -3.454727695792613e-01; +8.728818981018453e-02   +1.253859669096931e-01   +1.876548637532993e-01   +2.617571736288138e-01   +3.661580758718636e-01   -4.171997843029307e-01   -4.341843601368342e-03   -3.426931738027014e-01   +3.801330107875367e-01   +4.569697769048185e-02   +4.049891362272302e-01   -3.133793421048622e-01   +2.380901734298681e-01   +1.153337278730779e-03   -1.677667060933847e-01   -4.084806260769770e-01; +1.604911938213235e-01   -3.993124365504181e-01   -8.178838663753818e-02   +2.729162661559429e-01   -5.824904378418538e-03   +1.356440631215943e-01   +1.197484875009041e-01   -2.336217124686498e-01   +1.106696534163711e-01   -4.124346879226665e-01   -2.692627511109470e-01   -5.791454271461169e-01   -4.348342347088525e-01   +4.236768190347905e-01   -2.764895402497293e-01   -2.410177436818413e-01; -4.348881657707071e-01   +3.485050031647506e-02   -5.345489677410721e-02   +3.060964096046662e-01   +5.213481774625951e-02   -2.034608288580528e-02   -1.808585466809062e-01   +1.689959802161619e-01   +2.944716221032406e-01   +1.945685226914717e-01   -2.795131669313344e-01   +4.946268638672769e-01   +1.624308359052923e-01   -2.984276794804873e-01   -2.411793896783454e-01   -3.519740718822056e-01];
L2I_L1I_iGABA_netcon = [-7.131052149637765e-02   +1.457466821788994e-01   -1.958725724830541e-01   -3.587923459493978e-01   +2.593648944338445e-02   -2.687176449269234e-01   -5.363850757097163e-01   -1.862560855428727e-01; +6.117849835173114e-02   -1.078855963759604e-01   +3.909575456327832e-02   +2.340605813189873e-01   -1.518586865345482e-01   +1.290839479922933e-01   -1.637445022634762e-01   +1.668556649661399e-01; -6.294008351512795e-02   -3.546505930932070e-01   +5.307562916508607e-02   +1.029620053010428e-01   +2.290866061418898e-01   -2.224819172138558e-01   -1.616404969240991e-01   +3.689540237589037e-02; +9.050567247956712e-02   +2.500751897188978e-01   +1.378910492763770e-01   +6.631980036793436e-02   -3.085506448613707e-01   +3.884778352588919e-02   +1.098680588902097e-01   -8.326863308534257e-02; -8.256088282326733e-02   -7.109597751654004e-02   +3.513478565375192e-01   -1.264108972252939e-01   +7.320995435388297e-02   +4.378595887351942e-01   -8.967896702087169e-03   +3.686034993670649e-01; +4.564673123232227e-02   +1.196271545980960e-01   -1.099646552745396e-01   -5.899006979608681e-01   -1.295699636538913e-01   -4.894074981735437e-02   +1.284748906393474e-01   -1.640369659317691e-01; +2.662964146695823e-01   -1.111017228386254e-01   -2.894464766221363e-01   +3.810438349110759e-01   -9.332799934318399e-02   +2.243650067574811e-01   -1.479195343516129e-01   -1.790520121554211e-01; -2.397717877778412e-01   +1.224874937055889e-01   -2.097200409915350e-01   -1.520395007645014e-01   +1.000358269432627e-01   +2.319605312166699e-01   -1.883092236109913e-01   +1.284115410933907e-01; +4.594374331775328e-02   +8.949177364297306e-02   +2.772296058158810e-01   -3.212734624337329e-01   -2.735176057921517e-01   -1.233486774468366e-01   -1.428621340472886e-01   -2.498325645703389e-01; +5.057071849657363e-01   -6.410412912214353e-02   -1.120521809918765e-01   -1.670595226546757e-01   -1.396363750147861e-02   -8.161326807658809e-02   -2.462468807045891e-01   -4.013531628211747e-01; -1.471024307895352e-01   +1.320215994434894e-01   -2.941731264278848e-01   +3.191603277584718e-01   +1.365691195066421e-01   -5.376045268626586e-01   -5.172302216701974e-02   -1.768249245855576e-01; -4.380953476511316e-01   -4.417479422659899e-01   -4.317639164742981e-02   +6.382657984846350e-02   -1.729708139495809e-01   -1.207021641555328e-01   +2.008213877411660e-02   +1.314155016916706e-01; +8.300472814313445e-03   -7.986648819637546e-02   -3.186412907726255e-01   +3.002006875115584e-02   -5.360166833524291e-02   +2.670714835705379e-01   +3.779646100152581e-01   -3.491081126794747e-01; -5.941354102381947e-02   +1.768399302231193e-01   -1.297086961793712e-01   -2.282770466445199e-01   -2.707818770248875e-01   -1.068726895883405e-01   -3.673820415446734e-01   -6.470957303088154e-02; +1.289571907919991e-01   -7.207764159161240e-02   -2.962829949315458e-01   +3.697496820163979e-02   -6.676896567005847e-03   +2.970098123921344e-01   +7.379580884890652e-02   +4.973392237404784e-02; +1.592867099503540e-01   +6.626536927206829e-02   +3.246286565339351e-01   -1.183199419096653e-01   -3.924031606436196e-01   +3.653748727562935e-01   +1.550463384982885e-01   +1.244149217504892e-01];
L1I_L2I_iGABA_netcon = [-2.058442156452976e-01   +1.397134127380199e-01   -4.337419810363462e-02   +1.747591998282227e-01   +2.469390479935655e-01   -7.576229955985199e-02   +1.270957909010065e-01   +3.325519989445295e-01   -1.268381589026999e-01   +5.239430774794220e-02   -1.018709258427388e-01   -1.641741101549217e-01   +3.033095706379719e-01   +5.308699210079584e-02   -1.206516416508597e-01   -1.000912604262030e-01; -4.637962942500040e-01   -6.200106999919327e-02   +3.614685419093028e-01   +1.187177805335765e-01   +4.206919357011544e-01   +1.123899011627126e-01   -4.267478278673059e-02   -1.822224066236252e-01   -2.050687629273115e-01   -1.282712155926067e-01   +1.763245698773636e-01   +5.480499923617183e-03   -2.468494382025844e-01   -2.235482741302770e-01   -3.567092570015037e-01   -2.020476693663339e-02; -2.849920508329926e-01   -3.630442224766300e-01   +1.060260836105575e-01   +1.787362695984623e-02   +1.784406335373116e-01   -7.777711282085820e-02   +2.332008426687962e-01   -1.604040971576011e-01   +1.120210960241831e-01   -8.341285049286593e-02   -1.890035147588657e-01   +1.354987521656236e-02   +9.076802704367909e-02   -4.284574989110032e-01   +8.561648298015580e-02   +2.254520699368842e-01; -1.966426953645079e-01   +2.420419987580739e-01   -5.731958797201668e-02   +3.406747977708124e-01   -2.656615003378970e-01   -7.410271371750658e-02   +4.072727405580403e-01   -8.938168338913258e-02   +2.364039446947172e-03   +4.868669211933134e-02   -1.286933101604901e-01   +4.418554013683368e-01   +4.027668085990489e-01   +1.497428509606002e-01   +2.210794082885401e-02   +3.300312441497881e-01; +5.741088369173863e-02   +2.558302281474752e-01   +4.197857483601300e-02   -2.696504429432183e-01   -2.502068343192627e-01   -3.604330526440622e-01   -8.645181008688882e-02   +7.246175164757304e-02   +1.277275306597263e-01   +5.051363674757239e-03   +2.867217640458400e-01   +5.638385378372295e-02   -7.387048973633427e-02   +1.358919987194482e-01   +4.885705733739855e-01   +2.000157989704379e-02; +1.443360880690369e-01   -4.197102632418312e-02   +2.789204456549002e-01   -3.627888566056031e-01   -5.451066347038666e-02   +3.880588349447530e-01   +1.205950258414303e-01   +2.740406273148879e-02   +3.875326793186972e-01   +2.511331008909406e-01   +3.671902539829446e-01   +1.033997975852977e-02   +8.459341529495598e-02   -4.475959399392285e-03   -7.861744403933993e-02   -1.657723612178713e-01; +1.992609323355271e-01   +2.615497750946570e-01   +1.776028612122063e-02   +6.720582470031002e-02   -7.267995369287315e-02   +3.041006492377938e-01   +7.974784518270442e-02   -2.915401769393422e-01   +4.041250794520183e-01   +3.868040138978499e-02   +1.111128972069110e-01   +1.597727551824217e-02   -4.844762729142886e-01   -1.501855863721233e-01   +4.280728479915007e-02   -7.861969218855652e-02; +5.064868815930975e-01   +2.879188618076814e-02   -9.586200218690087e-02   -2.638109701552369e-02   +5.887425770597834e-01   -1.729071805092600e-01   +2.991189289145119e-01   +2.074069497344814e-01   +2.129864673847022e-01   +1.781897818345494e-02   -8.191353708598272e-02   -4.381442711329129e-02   -2.458535554421548e-01   -1.487814333793113e-01   -7.717628829688375e-02   -6.638615026560374e-02];
L2E_L1E_iAMPA_netcon = [-8.055241068983959e-02   +1.653592941924149e-01   -4.131314454129080e-01   -2.731455769295278e-01   -2.791312509125124e-01   +2.091351649279660e-01   +2.188887996209381e-01   -2.518440062047150e-01; -1.435590582399731e-01   +1.425845853331710e-01   -3.170877486897815e-01   +1.953116947329908e-01   -3.481663653485320e-02   -3.828904331731876e-01   +9.746904868600353e-02   -8.751590047452455e-02; -2.050980365601121e-01   +2.848167593896158e-01   -2.943652002363976e-01   -4.995896160232258e-02   +2.262512228906307e-01   -1.848944599375787e-01   +1.393570203254026e-02   +1.851411005534447e-01; +9.626419051524966e-02   +2.011721084303147e-01   -3.407920878835567e-01   -4.584568938587820e-01   -8.184902773734665e-02   -1.733362275943652e-01   -4.225936102093635e-01   -1.806631605283755e-01; -1.578496366814099e-01   +1.006008505008907e-01   +1.000058257782821e-01   -3.523685517718045e-01   -2.568086015382743e-01   -8.190806371237536e-02   +6.538650638895571e-02   +1.580765198128189e-02; -1.982102492663811e-01   +4.626336882929944e-02   +3.494637724068704e-01   -1.140586957025016e-01   -5.480996759776725e-02   +1.481868901618810e-01   -1.725198042782600e-01   -2.434022401146424e-01; +2.930172307412154e-02   +1.928776298976472e-01   +1.844866722928637e-01   -2.038303564885638e-01   +2.555808933264847e-03   +1.342889422001879e-01   -1.198338771115003e-01   -1.186186388419943e-01; -1.822778761346860e-01   +1.344624662958383e-01   -1.820813967601264e-01   +1.558798781420284e-02   -6.660417320717081e-02   -2.418377645501182e-01   -3.021760095493191e-01   +2.841740206934598e-01; +3.722202746508685e-02   -7.398500739480035e-02   +9.394914458766571e-02   +1.235669894038559e-01   +9.999786378553704e-02   +8.795579064371246e-02   -1.253223508351246e-01   -1.810104126469146e-02; -9.677774272335203e-02   -1.508127874828641e-01   -1.762850202235333e-01   +1.330441305134172e-01   -1.799232613693015e-01   -3.741841049157168e-01   +2.670163986435815e-01   -1.295634450520275e-01; -2.484046999770511e-01   +7.248964877785512e-01   +3.982015073133865e-03   +3.706849432279723e-01   +2.400336987430943e-01   -7.653300625977139e-02   -4.385375699381695e-01   -3.178752120676001e-01; +2.366639169316150e-02   -9.482438748939231e-02   +3.484180256318953e-01   -1.369746069065348e-01   -1.665016250312320e-01   +6.242140791860075e-02   +5.699287017796428e-02   -3.747381483643316e-01; -2.742486324094041e-01   +2.669074280305768e-01   -3.755699580749051e-01   -3.477347946979950e-01   -2.733162090844016e-01   -4.946606558372602e-02   +2.007791850643948e-01   -2.438140884192919e-01; -2.422629285420010e-01   -1.305930292526900e-01   +4.796243374254373e-02   -5.927280317932353e-02   +8.806925691389469e-02   +1.717109710446158e-01   -9.869406752454055e-02   +3.273612532873116e-01; +8.236112168120868e-03   -1.735143298813847e-01   -1.974612887639074e-01   -2.516155962611469e-01   -1.553489692609836e-02   +2.898316626166647e-02   +3.684223682953690e-02   +2.915757691194151e-01; +1.256881511692264e-01   +1.925046562982549e-01   +1.626194904582623e-01   -6.688655935096158e-02   +5.267290348345542e-01   -1.370963668962007e-01   +3.021737860454557e-02   -2.306546918161470e-01];
L1E_L2E_iAMPA_netcon = [+5.989381744428998e-02   +2.540130744290625e-01   +4.944577895220985e-01   -6.455188664637623e-02   -1.484210301378034e-01   -2.323809322210624e-01   +4.708228538229222e-01   -3.811043505723663e-01   +1.633081101218750e-01   -1.048833815007907e-02   -1.256889765563766e-01   -1.255277601641526e-01   +1.900586707667846e-01   -2.094260690803930e-01   -2.306230181537179e-01   +1.158219574276557e-01; -1.011542796762689e-01   +8.755536440039526e-02   +3.642155550536407e-01   -3.311176908136051e-01   -1.374709541167883e-01   +1.600791521826493e-01   -7.601180414313756e-02   -1.174243895601900e-01   +2.419488959098110e-01   -3.423845058547985e-01   -1.766848946300120e-01   +1.088140180360347e-01   -2.686588309412197e-01   -1.552058494552245e-01   +1.725239283032985e-01   -3.866206060551036e-01; -6.379306968793888e-02   +2.217015643330464e-01   +4.051764962385070e-01   -5.229070612932490e-02   -6.151469300365758e-02   -2.277510390410012e-01   +5.305745630625446e-01   +2.059411815830831e-01   -7.601645737139974e-02   +1.028465048590615e-01   +3.272209265809372e-01   +1.811105118521747e-01   -1.203798642705009e-01   +3.991868154530481e-01   +1.448692006811167e-01   +1.993022991877359e-01; +5.428068433543037e-01   +2.210848373242284e-01   +2.811732202192166e-02   +1.445034608713087e-01   -1.465823138725561e-01   -2.423509207947169e-02   -2.237966081746468e-01   +1.386619677874991e-01   +2.750961444053533e-01   +5.617681996099223e-02   -2.063862924545109e-01   -1.268145610011368e-01   +2.845854080222024e-01   -5.050746876796700e-02   -3.157805785089737e-02   -1.949577694808930e-01; -1.471874569083784e-01   -2.208395408300942e-01   -4.026913983403619e-01   +1.328989780579581e-01   +1.931788548441480e-02   -1.944550618128733e-01   -2.088985749538314e-01   +1.232432552967704e-01   -1.191543786038979e-01   +2.683578108053477e-01   -8.404396784631951e-03   -3.977974330714656e-01   +1.510030966951986e-01   -1.607370999538891e-01   -4.861588497243836e-02   +1.905602098034836e-03; +1.107620362153945e-01   +1.005266746350884e-02   +2.998417119835224e-01   +1.168679550954801e-02   +2.251653424263014e-01   -4.079426409841880e-01   -2.448450041050152e-01   -2.346775963849562e-01   +3.378595689172003e-01   +1.075915397594361e-01   -3.371582851179123e-01   +1.411503888905478e-01   -3.224293370423884e-01   +1.541893874058159e-01   +2.172611583005767e-01   +2.324937652331612e-01; -3.262891885300649e-01   +2.514485047318498e-01   +1.646472740503508e-01   -6.306471668630963e-02   -2.454411528941537e-02   +1.583410839431780e-01   -7.536469781584176e-02   -3.737415076123229e-01   -1.896484622164130e-01   +3.726996224652467e-01   -2.555799122182275e-01   -4.911920886821753e-01   +1.951507332564323e-01   +9.432268826787814e-03   +1.390462261158716e-01   -3.262466621655531e-01; +4.202590751805383e-01   +6.757822893988882e-02   -1.403611560940295e-01   +4.384839628014957e-02   +9.128267221726249e-02   +5.018070398862828e-01   -2.030876827737223e-01   +2.224492683134034e-01   +4.298423669978639e-01   +5.281360087690809e-02   -2.160369284035180e-01   -7.747500104564803e-02   +4.886159787486991e-01   -3.657667370304593e-01   +7.634632207240867e-02   -4.344556109113945e-01];
L2I_L2E_iAMPA_netcon = [+3.148522264201194e-01   -8.253469563337112e-02   +3.526432310984443e-01   -2.714235587583901e-01   -2.786774886753307e-02   +5.103737877049758e-01   +4.257961726940837e-02   -1.192384335135391e-01; +2.243943442991762e-01   +4.411779820712394e-02   +6.745055335713875e-02   +5.634955887671033e-01   -3.512857717064852e-01   +1.642768356566043e-01   +1.497545079065845e-01   +1.552577686084761e-01; +4.451948054253876e-02   +2.327349206485994e-01   -9.722690841259414e-02   +2.514261668093301e-01   -4.017253900064298e-01   +3.156040780740699e-01   +4.565880048896850e-02   +9.864433637420970e-02; +1.838039558023702e-01   -5.442711573302431e-01   +1.018766690438323e-01   +2.477855493945608e-01   +1.048783820927037e-01   -2.070041292744161e-01   +1.257400041239946e-01   +4.567088323163269e-02; -1.666389808730097e-01   +9.260371264797514e-02   -2.644760380402972e-01   -5.740434225120468e-02   -2.905976890573905e-01   +1.656890252636111e-01   +3.736190699275155e-01   +2.058219701660910e-01; -1.296541945392893e-02   +8.103138952554516e-02   -3.731161826096503e-02   -4.648362409777909e-01   +2.246820353998917e-01   +2.767178345763483e-01   -1.775507623231325e-01   +3.469426907175804e-01; +2.308938811938264e-01   +3.508527122338796e-01   -3.031385671189141e-01   +3.127986503275368e-01   -5.493425585266999e-02   -4.554885366482799e-01   +3.876645644238397e-02   -2.550840276103563e-01; +1.910498261712514e-01   +2.417551646928203e-01   -2.189082370923850e-01   -8.525640464063131e-02   -4.684426841487976e-01   +2.271961410866402e-01   +1.867999132900031e-01   -2.687116350458291e-01];
L2E_L2I_iGABA_netcon = [+4.512299084263739e-01   +2.850648401975318e-01   +1.731835919593622e-02   +7.687797592126358e-02   -2.503123049148839e-01   -2.057970808920519e-01   -8.204890635790932e-02   -1.445878795259291e-01; +1.505991925901255e-01   -1.599087834059944e-02   +4.166589048259514e-01   -5.738614147006453e-02   +2.508196910970292e-01   +5.364913577319262e-02   -1.864443469221178e-02   +4.376425259163931e-01; -1.935950992330215e-01   +1.625500976553588e-01   -4.740677884606804e-01   -3.528886934187793e-02   -2.380922574637949e-01   +1.061855715725893e-02   -1.862977169527282e-01   -1.764344157765978e-01; -6.410917566282753e-02   +3.515824994401793e-01   +1.210143855927642e-02   +3.544206142492076e-01   +2.684162136595588e-01   -5.491839237642752e-02   +1.564529397780142e-01   +2.091842479237932e-01; +1.494436988844121e-01   -2.694418321365501e-01   +4.636690644273247e-01   +2.615108324901495e-02   +1.938876209336774e-01   +4.188845074417941e-03   -7.892465585177560e-02   -4.418806809079695e-01; +3.155573821619936e-01   +1.136029146935099e-01   -2.213869964727411e-01   -1.701859495701092e-01   -6.158634305070226e-02   +2.319259494458319e-01   -6.497753271796330e-02   -1.637249907769832e-01; -2.072616261390621e-02   -1.016435132220064e-01   +2.570207678435632e-02   -1.896381693027327e-01   -6.338856929219916e-02   -1.090863100972446e-01   -2.346525873093936e-01   -2.027098860259420e-01; -1.510418391509079e-01   -3.412602538639011e-01   -8.183066050916622e-02   -1.383562081549436e-02   +1.317763636778287e-01   -1.143219085878117e-01   -2.727886210745948e-01   -9.682483561325722e-02];
L3E_L2E_iAMPA_netcon = [-2.425037847437971e-01   +2.487013275594343e-01   +7.790855694518906e-02   +3.755695834214055e-01   -1.910474275088135e-01   +3.014083942541697e-01   +1.377241240228323e-01   +2.289153215800332e-01   -2.797593615459873e-01   -2.617932505434336e-01   -1.741993901346006e-01   -4.596503214470641e-01; -1.377224531012985e-01   -4.202228523616184e-01   -1.369148603023733e-01   +6.723276011785634e-02   +3.421302072398513e-01   +3.150729208968095e-01   -1.227956579322929e-01   +3.343898965194089e-03   -3.178219384845205e-01   -1.843149009137776e-01   +9.436342050855001e-02   -1.795131542839960e-01; +8.256217387289283e-02   -3.177775120620703e-02   -3.104814117842038e-01   +3.864647485000552e-01   +3.193832202131871e-01   -1.269305692523028e-01   +2.078758926763455e-01   +1.682002568946804e-01   +6.948084550563641e-02   +9.610505656452398e-02   -1.585417422305217e-01   -6.733715871839292e-02; +1.573696065538599e-01   +1.128707690849762e-01   +2.209209621586597e-01   -1.868832443553430e-01   -3.680220393702717e-01   +5.251880657441427e-01   +1.369220147872050e-01   +1.066299242474823e-01   +3.423275148950465e-02   +9.172081261568024e-02   +5.132007907879715e-02   -1.132619739536441e-01; -3.204038351010277e-01   +1.733115687134123e-01   +1.231142486066125e-01   -3.376954659140705e-01   -8.180219252720906e-02   -3.403557368037452e-02   -3.229767000600215e-01   -3.409575094408094e-01   -2.135720898526922e-01   -1.155041939259783e-01   +8.275730042904689e-02   -7.884792363037343e-02; +3.613491435877156e-02   +3.685050826827624e-01   +1.761542659985390e-01   -1.236525992692514e-02   +3.697938452854088e-01   +3.900697650413324e-02   -6.069808363281413e-02   -2.704667065416497e-02   -2.498193278933693e-01   +1.979091522566546e-02   -2.957876506650683e-01   -2.357574220440292e-01; +3.940142849689939e-01   +1.503636572376197e-01   -8.280834417605719e-02   -2.579718482278514e-01   +5.931845924824181e-02   -3.294664549306576e-01   +2.675407786798512e-01   +3.065557303407708e-01   +3.012219855795119e-01   -1.344196910210369e-01   +3.106005631926867e-01   -2.532900081717253e-01; +4.235565126445329e-02   -2.110762808331095e-01   -1.999372676931728e-02   -1.200349203748863e-01   -9.494510828201720e-02   +6.687010991787846e-03   +3.341169867213742e-02   -3.031620535949685e-01   +2.338520951692733e-02   -1.372619246819337e-01   -3.889724130433467e-02   +4.950805496189049e-01];
L3I_L2I_iGABA_netcon = [+5.266057802342957e-02   +3.681201926544386e-02   +2.168357799153479e-01   +4.388819756952381e-01   -2.153524309617752e-02   -5.321462108302688e-02   -1.949891296397572e-03   +2.675062309224777e-01   +4.510605534712756e-01   -5.168580855311800e-02   -3.748618441853889e-01   +2.875586006674111e-01; -3.829359045898983e-02   -4.552426306972790e-01   -1.344771171591274e-01   -6.452882322550188e-02   +3.139958616034135e-01   +2.472185941887940e-01   +2.296059541938282e-01   +2.527131157683032e-01   +2.375733088641457e-02   -8.082963740579810e-02   -3.917280613254561e-01   -2.780004107200624e-01; -5.454490473025703e-02   -3.585367278325653e-01   +2.315344892026540e-03   -1.918317036972136e-02   +1.835894878592522e-01   +1.440033039356527e-01   +1.874604866538123e-01   +3.742266261334444e-01   +2.667642597558413e-01   +1.393106243689387e-01   +1.227995335581725e-01   +4.357386250691941e-01; -2.920278571834814e-02   +1.830148715958294e-01   -1.370304948695702e-01   +9.566662479091935e-02   -1.466551791263087e-01   -5.996398058326720e-02   +3.392501446518681e-01   +4.609265663229758e-01   +2.395870936988898e-02   -1.363240945267636e-01   -1.077628159993071e-02   -2.750327468916061e-02; +3.953781901995915e-02   -7.779281976264753e-02   +1.313730959030929e-01   +3.559369171274203e-01   +2.971879663563853e-02   +4.041277786861910e-01   -3.108331247772964e-01   -4.297457873122530e-01   -9.918182896852282e-02   +1.342748467341993e-01   +1.055034330349429e-01   -2.905012472371464e-01; -5.100466914059881e-02   +7.676608525313339e-03   +4.929377017957946e-01   +1.138695383976763e-01   -2.208265158061182e-01   -2.259289844609148e-01   -2.031137589250573e-01   +2.357899796301424e-01   -1.116691557879340e-02   -4.169202718589629e-01   -2.106991069536752e-01   -3.485387359165426e-02; -2.242779077102641e-01   -7.256319041275047e-02   +2.930430526698899e-01   -1.901220070389386e-01   +3.938556203794155e-01   +8.870354222364635e-02   +3.066096662425654e-01   +3.014773714075374e-01   +1.537387742133315e-01   -1.332456023724165e-01   +6.080793312573532e-02   -8.860066144374235e-02; +2.777985614222378e-01   -1.007822101578162e-01   -1.961523038726680e-01   -3.005626867952573e-01   +1.922123066814288e-01   +2.025031430693094e-01   -1.956971583372489e-01   -6.359356747690884e-02   +1.989228858025194e-01   +3.059593352400811e-01   +1.103912329446652e-01   -2.257129461153135e-01];
L2E_L3E_iAMPA_netcon = [+1.329595397157199e-02   -9.651453405374333e-02   +5.044823064736033e-02   -3.400736744349244e-01   +1.635445594365620e-01   +2.152177081178415e-02   +1.119810402501718e-01   +9.937876473680188e-02; -1.411529731733544e-01   -2.839155912267261e-01   +4.525888942957013e-01   -3.791894866215377e-01   -1.185458225505922e-01   -4.990446626491212e-02   +4.358184884227295e-02   +3.023119258427530e-01; +3.648301104756899e-02   +1.845972386690822e-01   +3.310834685567295e-02   +3.045301224375180e-02   -6.336009466198930e-02   -3.757508205889763e-01   +1.993491541811227e-01   +4.104020480058651e-02; -3.807568503285634e-01   +2.834629886985782e-01   -3.075430701387740e-01   -1.661123856969288e-01   +7.781176799316213e-02   -3.184213563481160e-01   -7.989503178393187e-02   +1.229404996334217e-01; +1.819440767993081e-01   +2.277578176341745e-02   +5.769746946363044e-02   -2.973738182592035e-02   +1.687806962796088e-01   -2.555210373088652e-02   +5.298105313764950e-02   +1.478333233006712e-01; -7.447817365128206e-02   -9.087994658593965e-02   -5.894384855031062e-02   -2.707564134044664e-01   -8.422039639932286e-02   +4.208734426845148e-02   +1.635812811858470e-01   +3.361809561277766e-01; +1.909599623576284e-01   +4.238626046790580e-01   +1.717674181758190e-01   +2.931924972818574e-01   +4.252286682495867e-01   +8.193345448684428e-03   -1.638401616546773e-01   +1.247295220984491e-01; -1.851329970474117e-01   +4.493090685561714e-01   -1.700810415403785e-01   +1.324406525898500e-01   -3.401013963346928e-01   +1.261785890269684e-02   +9.683509335431498e-02   +1.361441237285429e-01; -1.830939754938812e-02   -2.279145437766467e-02   +1.586336813138611e-01   +6.137185777350485e-01   -1.930962573798537e-01   +9.626105608346025e-02   +6.023555852617195e-02   -2.415324139558154e-01; -1.565524860906102e-01   +4.706274375700434e-01   -3.596126751023244e-01   -1.046246428849095e-01   +9.396035521868103e-02   +1.085972490126520e-03   +5.462626332592460e-01   -3.963564266882212e-02; +1.747574190883587e-01   +2.238540765138040e-01   -4.996194456877313e-02   -2.327602409632759e-01   +4.698290845021478e-01   -1.441262288998055e-02   -3.360957034061478e-02   -1.457814064837059e-01; +2.038024101921798e-01   -7.972003778335798e-02   +8.061786794817846e-02   -4.410424186156833e-01   +2.054280516042010e-01   +1.346936604951881e-01   +1.751133447185778e-02   +2.157117237251803e-01];
L2I_L3I_iGABA_netcon = [+4.123799283793736e-02   -2.399517465744896e-01   -3.344406742517843e-01   +1.347616556340723e-01   -4.665186073129365e-01   -1.836318229123796e-01   -5.606394589142145e-02   -3.613690505086741e-03; -2.576541101879171e-01   +3.456351062686794e-01   +2.013158634966283e-01   +1.796778337027840e-01   +2.943859963208361e-01   +1.417274051484348e-01   -2.957643938938173e-01   -1.371346251878476e-01; +1.303711656462915e-01   -4.222286776942683e-03   +2.159637298708756e-01   -1.075251532917731e-01   +2.490930050167896e-01   +4.969738975959642e-01   +2.628805539104027e-01   -2.410699857494389e-01; +3.389045353365264e-01   +1.479146399729671e-01   +3.354534885422670e-02   +1.267460134981666e-01   +9.037768525444059e-02   -3.012920927555343e-02   +1.726362215636121e-01   +7.722991759603615e-02; -6.214335469617717e-02   -1.179623615525206e-01   +2.468122397975105e-01   +3.166595716314037e-01   -2.661502450909538e-02   +3.544456246784257e-01   -2.212658593266596e-01   -5.505481773889764e-03; +9.927440173897642e-02   +3.073324507981712e-01   -1.503225256526735e-01   +2.276308345280373e-02   -2.695038147133081e-01   +1.641498418122995e-01   -8.425745752081651e-02   -1.369535413426906e-02; -1.593116919059291e-02   +2.454986876588680e-02   -1.229964919087995e-01   -1.880463036040211e-03   -3.863302542313661e-01   -9.169838275400850e-02   +1.528585069775799e-01   +4.473993804730636e-01; +2.874948406176034e-01   -4.578413719497955e-01   +1.621631942835459e-01   -8.493426974632692e-03   -2.593106191685693e-02   +1.196210481575640e-01   +2.258788961277932e-01   +1.975105219663687e-01; -4.130415255315100e-01   +1.465753943538874e-01   -8.162475229658604e-02   +1.399482022641601e-01   -2.362907975176845e-02   -2.300508988353560e-03   -3.463016124861716e-01   +2.371618824904828e-01; -8.311137074690390e-02   +2.572187220326576e-02   +4.403214945521438e-01   +1.098132960707717e-01   -2.613035903498420e-01   -3.199453219618419e-01   +2.217073773438576e-01   -9.673863033104492e-02; +4.599937918570576e-02   -1.945846046012345e-01   +7.272479245474276e-01   +5.723190815036375e-03   -1.295906653064655e-02   +1.098238861528085e-01   -2.754748393032148e-01   -8.191601068659790e-02; +3.823442462101915e-01   -2.500074931019408e-02   -1.579161267049323e-01   +2.566388452815675e-01   +4.360146282934146e-02   +1.393194432257602e-01   -1.926186353477254e-01   -1.984606499877561e-02];
L3I_L3E_iAMPA_netcon = [-1.403289120624771e-01   +2.243359659748359e-02   -2.845265689244065e-01   -8.366321384855152e-02   -8.402365992215949e-02   +1.992663700535161e-01   +1.705702884775344e-01   -5.851134957922616e-02   -1.061906376239512e-01   +3.854825824378780e-02   -5.695872954486873e-02   +6.348371966941785e-02; -1.228164831038475e-01   -3.653027561578713e-01   +1.239570522854199e-01   +2.382615593012824e-02   +2.360823687060961e-01   +4.788609011529103e-02   -2.540376998431828e-01   +2.875468857542379e-02   -2.763418995180277e-01   -7.672780419194800e-02   -2.851687673988703e-01   -3.408627681535677e-01; -3.933058299079666e-01   +6.039527631518182e-02   -3.283859833112857e-01   -9.235471300004536e-02   +2.397526356687851e-01   -1.494348075397609e-01   +3.860035069776002e-01   +2.873700739230712e-01   +1.197593084487457e-01   -2.229904696517732e-01   -2.224012451770074e-01   -1.395966159498778e-01; -2.164759050301828e-01   +2.496859456972876e-01   -1.088935795360325e-01   -1.658747152980870e-01   +1.904629146701922e-01   +1.548102086742196e-02   +4.755065418938204e-02   -3.055314318219738e-01   -4.699838793138827e-01   +8.982597759767304e-02   +2.138907356992145e-01   +1.277034159271446e-01; -9.711422760023275e-02   -1.045481084338117e-01   -1.796203247880718e-01   +3.711477621737880e-01   +2.038694940508899e-01   +4.843318476188598e-01   +1.375903248528842e-02   +2.696497517059033e-01   -1.016118296851825e-01   +2.876695387374051e-01   +3.131468681468774e-01   -9.107283067983475e-02; -1.820400677491938e-01   -7.716906982710052e-02   -1.377739449930881e-01   -4.397646846380698e-02   +5.304933429488621e-01   -2.492044749154257e-01   +1.417317055086545e-01   +2.363994729082040e-01   -2.486449157465467e-01   +1.800298888401942e-01   -4.228366839974954e-01   -1.313777295452360e-01; -2.300763834869320e-01   +9.727625908669327e-02   -1.130375581991634e-01   +2.145433922117829e-02   -7.994873207262246e-02   +3.858508368243847e-01   +1.123670280987171e-01   -3.993271007799060e-01   +9.006532028136002e-02   +2.707585349742625e-02   +1.364076277101514e-01   -1.061242181719389e-01; +5.547340595824735e-01   +2.414606913973053e-01   -1.321542908550640e-01   +2.026112779183148e-01   +4.330172816896546e-02   +9.855005907465680e-02   -1.062929638202433e-01   -7.750780274039544e-02   -4.484913668465857e-01   +9.795355455723823e-02   -1.784820070118402e-01   -2.154887821211253e-01; +2.379462624675097e-01   +2.063138422481573e-01   -9.228443582318231e-02   -1.771798391998222e-02   -5.735380867653742e-02   +5.214056208886791e-03   +2.283611791785622e-01   +3.094695038449069e-01   +1.678800717417751e-01   -1.511085215583609e-01   -7.232579354598297e-02   -1.453041481186839e-01; +1.733824225469488e-02   +3.562740728054630e-01   +2.142741975950241e-01   +1.482555069301783e-01   +1.987969727651454e-01   -3.290404075349567e-01   +2.160845951295632e-01   -3.484525862874969e-01   -1.741125030982301e-01   -8.378684663774211e-02   -3.172655199935475e-01   -2.928696887392293e-02; +1.209806408515827e-01   -1.610886457912052e-01   -3.809068999831879e-01   +3.784889890181788e-01   -1.543439816282458e-01   -2.957924099604268e-01   -1.681511607151469e-01   +6.610730879574539e-02   -2.526025789492454e-01   +9.495985088182607e-02   -1.893052461678418e-01   +1.662276389825241e-01; +9.253544991000921e-02   -2.311874529042503e-01   +1.454106824950127e-01   +3.091406626564790e-01   +1.330825917124493e-01   -1.325947246689994e-01   +4.304868545550736e-02   -7.059657445913148e-02   +1.094642798775073e-01   +2.869306259569701e-01   -2.188090451660327e-01   +7.299614040769775e-02];
L3E_L3I_iGABA_netcon = [+2.924053295208045e-01   -1.288480276199246e-01   +3.908647429831948e-01   +7.402425161799220e-02   +5.766000109022756e-02   +1.177609227175479e-01   +1.402810881667415e-01   +4.105828305467631e-01   +1.356122101620383e-01   -3.678021719200958e-01   -1.230574933130542e-01   -1.325084288894550e-01; -2.688026322435400e-01   -3.013198137241625e-01   +4.513613160287679e-02   +1.783091137283299e-01   -1.986348741162863e-01   -2.231426366109791e-01   +3.431795979510047e-01   +7.634045617499663e-02   +5.614166820596662e-01   -2.815111321896764e-01   +2.739444282375907e-01   -8.966774114740793e-02; -5.537506728190762e-01   -2.917044119244223e-01   -2.204002951497697e-01   -4.406724730789457e-03   +6.139611085225463e-02   +8.290322243456394e-02   +2.731873476405097e-02   +2.024399429461449e-03   -2.229448733882483e-01   -5.082396243679432e-02   +1.249988466973370e-02   +1.507119696561891e-01; -5.545153739584215e-01   -3.366984889582487e-01   -8.243925480874413e-02   +2.846913374462323e-01   +1.954946148555414e-01   +3.133214162060555e-02   -3.350757701150076e-01   -1.763547462063307e-01   -2.268639598724922e-01   -3.592387179637537e-01   +8.804269209635640e-02   -1.969886208212194e-01; +2.360727611223941e-01   +4.873069761136041e-01   +3.862437973719440e-01   +2.270267628893736e-01   +2.038411807796872e-01   -1.060734347287143e-01   -2.635943692979920e-01   -4.227961425430719e-01   +2.997426504778024e-01   -2.802535738426619e-01   -2.403634676679443e-01   +1.473649469243001e-01; -9.324374640423737e-02   +2.233636563186346e-01   +6.352810872329541e-02   -1.728701207740803e-01   +5.623984807812395e-02   -1.474256038734073e-01   -1.579397200118925e-01   +6.365391930152535e-02   +9.178511343520843e-02   +5.704640628149515e-01   +3.098824014861393e-01   +3.135226726398410e-01; -1.832234984981662e-01   +3.136849259803349e-01   +1.037662292811875e-01   -2.799680344013971e-01   +7.904162012463774e-02   +1.261737937126117e-01   +1.733614597720604e-02   +1.564150365831196e-01   -3.741788103060367e-01   -2.203907510892303e-02   +4.409021274515071e-02   +4.207676786969122e-01; +1.758056968756425e-01   +5.481200530014001e-02   +2.557326394885994e-01   +1.805701653614579e-01   -7.767885323817503e-02   +8.647541750240807e-02   -1.422295198650556e-01   +5.785881915301039e-02   -7.263662951872495e-02   +1.941522921935883e-01   -7.957166065546875e-02   -2.999510773427243e-01; +8.021295992154484e-02   -1.944104561024244e-01   +2.790376521092299e-01   +1.077054150860941e-01   -2.716254227836643e-01   -4.110793005502693e-01   +2.804358876650491e-01   +2.581249030419264e-01   -1.291005318356086e-01   -3.976104093741245e-01   -4.619227151012239e-01   -2.367520562269372e-01; +2.929098009172053e-01   -1.637249747387756e-02   -2.207953723604090e-01   +3.519418926800822e-01   -5.799735064380128e-02   +2.088099468721426e-01   -2.006761682925810e-01   -2.863878781101816e-01   -2.145750547861787e-01   +4.214319001704073e-02   -1.566419426607517e-01   +3.039409453792909e-01; +7.328314239897893e-02   +1.444681224674851e-01   -1.779558724234105e-01   -1.399599094344115e-01   -1.728754674118548e-01   +6.369296182695003e-02   +3.331024598773133e-02   -3.706509208740286e-02   +1.011618087419030e-01   -2.792888819370918e-01   -8.588372577611483e-03   +2.098299196705125e-01; +2.983680283363621e-01   +4.128398781426761e-01   -3.919293480960049e-01   +3.082095606879482e-01   -4.922478637991265e-02   +1.459120467328227e-01   -4.628728835446108e-02   +4.770442075653513e-01   -3.102119740203048e-01   +3.540206186075636e-01   +6.687039073059114e-02   -1.571700583738941e-01];
L2E_Input1_iAMPA_netcon = [-1.855724672976578e-01   +2.710022938179724e-01   +7.353563732642351e-02   +3.113930301687036e-01   +6.490576496350070e-04   -4.899694981549417e-01   -8.088626706657515e-02   +9.047016548195456e-02];
L2I_Input2_iAMPA_netcon = [+1.026499096975049e-01   -3.462406450006641e-01   +6.730463735389722e-02   -2.278759479788903e-01   -4.595994671831485e-01   +2.167218991375900e-01   -1.925532009332094e-02   -5.574502849104257e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
