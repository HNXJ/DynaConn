function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+6.563609090835640e-01   +6.542996760171014e-01   +8.668152465962044e-02   +1.157607215806148e-01   +2.027314517482640e-01   -2.435959294292798e-01   -1.420234945890297e-01   +3.702807731610893e-01   -9.120793967445401e-02   -4.626928554651358e-01   -2.557407222806565e-02   -5.673329245529298e-01   -1.928293967781251e-01   -2.379178788701349e-01   -1.335256706698924e-01   +4.344487902622839e-02; +3.175436974123722e-01   +7.542453848154617e-03   +1.531811301267678e-01   +1.698382080643577e-01   -7.989879509798531e-02   -2.464264062990469e-01   +2.650680546311518e-01   -4.480446005988997e-02   +1.048798122037031e-01   -2.174268809000459e-01   -1.785467585888683e-01   +2.156425385074753e-01   -1.912003545118320e-01   -9.348253104119372e-02   -4.193984377577657e-02   -7.278870242630028e-02; +7.890598251271154e-02   -4.973408128723861e-01   +8.392370556427213e-02   +2.969540803770003e-01   +1.950110967299194e-01   -2.690919653438790e-01   +1.265735125187621e-01   +3.363800898711197e-02   +4.205104249953081e-01   +7.405172812782264e-02   -2.318555341919856e-01   +2.312481438706360e-02   +4.107778115875103e-01   +1.586112814112940e-01   +3.332045445460588e-01   +6.703187847546932e-01; +2.703652101589054e-01   +1.918869344016652e-01   +2.756083954787775e-01   -3.410425626073090e-01   -1.635751994057989e-02   -3.017326019264945e-01   +5.532301601093220e-03   -2.610225320202195e-02   +2.280985679754785e-01   +3.754034146442525e-01   -1.761737579552765e-01   +1.649599544705411e-01   +7.227766185960867e-02   -2.063244385285030e-01   +2.331958890431598e-01   +2.440934291468833e-02; -2.762796780127821e-02   +3.625178586298895e-02   -4.223076070831430e-01   +3.834690090953450e-01   +2.948440064359799e-01   +1.444013223314755e-01   -3.765574103881385e-01   -3.329298053998792e-01   -4.924244688298909e-02   +1.161634450491375e-01   +1.466306023527921e-01   +4.119822471322142e-01   -4.408426631900511e-02   -1.840515733315824e-01   +5.852124876736947e-01   -3.228673093538219e-01; +3.667394161049410e-01   -2.960117819036654e-01   +3.827780660165794e-01   -1.994441737166537e-01   -2.156065346095173e-01   -3.879066973656491e-02   +3.068610789001378e-01   +3.000093459702458e-01   +6.515850985581011e-01   -7.732862386052319e-02   +5.187922040916726e-01   -4.324594082990219e-01   +3.729970558715678e-01   +5.897587524445574e-02   +1.516869053289143e-01   -2.270893634088678e-02; -1.571514665283236e-01   +6.807943534053302e-01   -6.954624192606434e-02   -2.412165937831756e-01   -2.298578947492845e-01   +4.156408445230093e-01   -4.260325664210495e-02   -4.578037604761283e-01   -2.311943872869762e-01   +2.114980033548484e-01   -2.181260316379400e-01   -3.086606964425036e-01   +2.037217675559416e-01   +1.378128980980170e-01   +1.127244156291552e-01   +3.480886032144694e-01; -3.128827929224179e-01   +1.506385237730955e-01   -2.944762153283752e-01   +8.621033370092290e-02   +4.378721499678687e-01   +3.349051869162628e-01   -4.549726590046553e-01   +2.282971384243606e-01   +6.416497767010437e-01   -3.450079548262633e-01   +1.598878482872022e-01   -3.565830411716728e-01   +3.091595368144788e-02   +2.256632763098721e-01   +1.065938847974645e-01   +1.027421744646942e-01; +2.021285877169271e-02   +5.830071572409752e-01   +1.342140780872787e-01   +3.652225277320809e-01   +2.447796959367138e-01   +6.668223239955715e-01   +1.474127375091729e-01   +2.315216586274648e-01   -1.536431568079659e-01   +9.921536611990692e-02   +8.568071070456229e-02   +1.302407753848184e-01   +3.781628110995755e-01   +6.442049036518500e-02   +5.825590309221460e-02   +3.072862071591884e-01; -2.145467241497858e-01   +2.725720777546117e-01   -1.866133762001040e-01   +4.048131265316743e-01   +4.923144214009856e-02   -7.009977590513308e-02   +4.118390378161213e-01   -9.735612395020979e-02   +2.590481693107366e-01   +4.549688983696010e-03   +3.816699150900825e-01   +3.030528606123705e-01   +3.670908211159988e-01   +4.420729421596777e-01   -1.152212477846991e-01   -1.748479638880017e-01; +3.210891894109090e-01   -4.338744068195725e-03   +2.198273715908932e-01   +9.083594981352455e-02   +1.547418846789897e-01   -5.965328654084506e-02   +3.690039487503904e-04   -2.197663117266003e-01   +2.590239994177602e-01   +2.469702103718834e-01   +2.353403839785997e-01   -4.165266618873655e-01   -3.426293148324262e-02   +1.494936042243860e-01   -1.784788726037780e-01   +3.555640958446833e-01; +1.611534730898821e-01   +4.668504037118749e-01   -3.117776963395387e-01   +3.984669954575962e-01   +1.435433427292226e-01   -5.444676761281109e-02   +1.996335080492060e-01   +7.154408137371804e-02   +9.114527981598770e-02   -1.319980591866775e-01   -7.326988183805193e-02   -6.107801181746173e-02   -3.877267173811720e-02   -3.192786249787049e-01   +2.327786768560182e-01   +4.214297419104205e-01; +4.242175422088782e-02   -1.699842941375904e-02   -4.077246817840046e-01   -1.715691878187333e-01   +1.078715607545781e-01   +3.354150384896574e-01   +1.512856759569664e-01   -1.068990129285957e-01   -3.336548839909329e-01   -2.579899416832646e-02   +6.009515480842058e-01   -2.339570823201347e-01   +3.260753821095903e-02   -2.504717778699768e-01   +8.084928420128051e-02   -2.655081325039141e-01; +4.450222837506106e-01   +2.514843906875153e-01   +2.585872853695580e-01   +1.078675909318306e-01   +5.351793046327840e-01   -3.947625966448853e-02   +6.041622157687299e-01   +2.583492171476910e-01   +8.464089175384683e-02   +3.911990366272641e-01   +9.068229758950294e-02   -1.327238445733210e-01   +3.647384347925710e-01   -1.254027621277638e-01   +6.267542833212634e-01   -4.320306967024767e-01; +3.421248859682384e-01   -2.772121316494511e-01   -3.908367058737144e-02   +7.981955921112066e-02   -8.544883578648016e-02   +1.293681082592803e-01   +2.149866076135834e-01   +4.781123986251095e-01   +8.929779849404287e-02   +1.612536799093530e-01   -1.486359350451417e-01   -3.694863298238593e-03   +4.432735439619550e-01   +3.200760838543657e-01   -1.935224078563701e-01   +5.846581737281789e-02; -1.228679386739956e-01   +4.460674076996245e-02   +2.281760004572612e-01   +7.621813909284259e-02   -1.849338437506214e-01   -5.027032252533684e-01   +4.516625829319366e-01   -2.067091279668355e-01   +4.325293195053897e-01   +6.550461358808360e-02   +2.028235404310932e-01   +9.704127692685721e-03   +1.371688372129461e-01   -4.012488711558451e-01   +1.349838205994890e-01   +2.203007202374781e-01];
L1E_L1I_iGABA_netcon = [+7.059468117529687e-02   +1.659669565643964e-01   +7.323002508046371e-02   +6.966717121191141e-02   +3.177056135584418e-01   -1.190459256540047e-02   -1.944252566524858e-02   +6.878090700334363e-02   +1.905667318487848e-01   +1.647106715726193e-01   +2.473394849639949e-02   +1.848269507159974e-01   -3.947555504449585e-01   +1.636644163165648e-01   +3.078495785095056e-01   +2.358761279128718e-01; -2.038162751280758e-01   +4.288319601323788e-01   +1.025366206983378e-01   -4.619320098679305e-02   +1.495308564785722e-02   +3.770164633766062e-01   +2.133700052406307e-01   -6.433466097449497e-01   +3.226970817713312e-01   -1.729672043363836e-01   -1.094232686514221e-01   -2.635403480713239e-01   +1.131466318853874e-01   -5.271779197982621e-01   -2.868572072988745e-01   -2.018738486787138e-01; +4.681185965229818e-01   +1.739385810974487e-01   +3.884528705553697e-02   -5.345110830232824e-02   +4.468818776915758e-01   -1.073422023358469e-01   -2.449257403057015e-01   +5.691176146485987e-01   +1.630079871143474e-02   -5.164133261158571e-01   +4.772951188999269e-01   -1.543161436474018e-01   -3.339123436432739e-02   +3.435137166810103e-01   -1.232825834643225e-02   -1.719243066408530e-02; +1.699376393621228e-01   -2.918481249548148e-01   +7.389526832322138e-02   +6.387533002616386e-01   +7.069136306702078e-02   +2.721114264645509e-01   -2.140425860119146e-01   -1.311047744471351e-01   -4.784765625507675e-01   +3.500844720780024e-01   +3.448156973660483e-01   +4.344983610800765e-02   +2.261104315167543e-01   -3.417226919436572e-01   +2.570554543359969e-02   +2.598019604735785e-02; -1.383515752307971e-01   -1.332179201319718e-01   +1.389657947178290e-01   +1.279777512202625e-02   -1.306686221129545e-01   -4.351596218595335e-02   -1.988983803265792e-01   +4.704635193099189e-01   -1.738208939186042e-01   -3.898462898809488e-01   +1.934959365479457e-01   +4.013335121762824e-01   +4.450966165012133e-01   +3.643359420579148e-01   -5.367175924538997e-01   +3.342901728318481e-01; +3.177547103504534e-02   +2.485922841882295e-01   +2.783134702192751e-01   +8.095216150484884e-02   +4.342442820385851e-01   -1.571745012706616e-01   +4.600636690508103e-01   -2.423950166315134e-01   +3.133796456873810e-01   -4.560151291506682e-01   -1.794644254154874e-01   +3.390189001802434e-01   -3.034966146010978e-01   -3.891810753840551e-02   +1.960528562400580e-01   -2.278629407134617e-01; +3.820700184904113e-01   +8.412703016557371e-02   -9.835817733114094e-02   +1.891514203498652e-01   -1.528373354880009e-01   -3.650751669532024e-01   +3.532332090338279e-01   -6.224154476878890e-01   -8.349884608837954e-03   -5.079902945133712e-02   +4.476116624778004e-02   +2.439865180292493e-01   -7.700877361388334e-02   +2.018681707049777e-02   -9.465325423458643e-02   +2.247297699474917e-01; +2.833976054524254e-01   +1.811686543341993e-01   +2.777623952423054e-02   +2.589431698712152e-01   -3.219376385414112e-01   -1.758005459677669e-01   +2.545422434510913e-01   +3.362167805314095e-02   +4.508288835617266e-01   +2.159058126714226e-01   +5.928721662501701e-02   -2.644381503964177e-01   -5.402849659391248e-02   -1.971117498130477e-01   +1.097287122445738e-01   +1.267722647679903e-01; +1.235389588108835e-01   +1.079744762083303e-01   -1.719790905071462e-01   +5.336442471725936e-01   +5.743116921345265e-01   +3.683837979528938e-01   -9.569513378974892e-02   +4.217765712789860e-01   +5.274513424264163e-01   -2.066581643375130e-01   -4.787205367997481e-01   -5.224611773299116e-02   +3.260933079702643e-01   +3.087040534973978e-02   -1.808808767412851e-03   -1.542496029557661e-01; +3.651196102014150e-02   +5.296877138728430e-01   -4.829221917714938e-01   +3.240061015063661e-01   +2.061855604301510e-01   +4.461931224957605e-01   -1.015040570451114e-01   +3.333180113736142e-01   -1.808635252128441e-01   +4.101065770632647e-01   -1.416851067881527e-01   +5.203554020380691e-01   -1.439833403093334e-02   -2.436422197991850e-01   +2.409731446249745e-01   -3.008597555938769e-01; +1.519433305178841e-02   +2.280802349110560e-01   +4.474062156610049e-02   -6.349129678269111e-01   +3.622413588542963e-01   -3.803698701776852e-01   +5.559975904816198e-01   +3.882416845369944e-01   -4.676279116743496e-01   +5.803183918947631e-01   +4.926019963957193e-02   +4.050574165767641e-01   +1.362473444845874e-01   -1.485416149933429e-01   -3.581089671547990e-01   -2.636756454571126e-01; +1.515154790813308e-01   +2.325007485558842e-01   -1.934830821001606e-01   +1.273712078289021e-01   -2.263807228483609e-01   +5.434896011089632e-01   -3.449127853916953e-01   -5.458516805728375e-02   +5.287955127737358e-01   -2.242769139469631e-01   -3.018905827353467e-01   +3.049406837653483e-02   +2.980495477801544e-01   -2.936680019135433e-01   -7.782338185678198e-02   +2.440156823299190e-01; +1.729237606827988e-02   -1.567756257148666e-01   +7.775530864712082e-03   +1.253699348453163e-01   +4.285452695142752e-02   +5.437004013785556e-01   +4.956238657459677e-01   +3.357732988263957e-01   +2.615998925105223e-01   +4.968666324226447e-01   +7.303772694113673e-01   +4.225100651618395e-01   +4.913022484074574e-01   -2.378950221163372e-01   -6.151416436370460e-03   -3.145819665448198e-01; +6.393495206925955e-01   -7.633131876485058e-02   -6.046282651278739e-03   -1.942553866761247e-01   +1.875576936107402e-01   -2.247942731015404e-01   -5.547383420817936e-02   +4.884058288362407e-02   +3.808554736291803e-01   +2.369816881507262e-01   -3.005910301197836e-01   +1.185675891135629e-01   +2.758806457058874e-01   +2.839219285112829e-01   -3.307820759070691e-03   +4.186925121447994e-01; -2.177896916874916e-01   -2.240935769373342e-01   +2.177713048797174e-01   -1.342636608380480e-01   +1.872288931932289e-01   -9.824328185107235e-02   -3.100793182829166e-01   +1.982695525462923e-01   +1.526869318620022e-01   +1.400685641687285e-01   +1.464545721772307e-01   -4.842468202764291e-02   -3.908475423019053e-02   +4.685325592666734e-02   +4.171166498022276e-01   +1.018078583323448e-01; +3.717139191709670e-03   -1.450257609394669e-01   +1.076752651027120e-01   +3.757912015268339e-01   +3.135737023714779e-01   -3.086268459242115e-01   +1.528415834551265e-02   +3.927042294818646e-01   -4.322769313498953e-02   -8.527408769365624e-02   -3.375141277536776e-01   -1.371499735145648e-02   +3.926697458283572e-01   -2.738013609281583e-01   -1.310186049559880e-01   -2.825382078437458e-01];
L2I_L1I_iGABA_netcon = [+2.885154675780517e-01   +2.040720812941225e-01   +5.984534658567583e-02   +4.853717111001544e-01   +6.368301978283017e-02   +2.476690739965036e-02   -4.285453459573245e-02   +2.538719918247157e-01; -4.658364817116448e-01   +2.664647746233332e-01   +1.350153994517391e-01   -1.244568862715315e-01   +1.469306082437144e-02   +2.610316603808353e-01   +1.954985603972918e-01   +2.979834429161451e-01; +2.486465371317568e-01   +5.682642360023103e-03   +1.827534106935335e-01   +7.689471808655950e-02   +4.443400333370167e-01   -2.054127390838392e-01   -1.180338813838351e-01   +6.169877209073601e-01; +2.443827640159509e-01   +2.319993503617576e-02   +5.287219887134387e-01   +2.594791461636884e-01   +4.323832082720779e-01   -2.251936263077366e-01   +2.125751560872120e-01   -1.825232473110727e-01; -5.071477894803158e-01   +2.088095436123603e-01   +2.751842566554641e-01   -1.556595313998108e-01   +2.120739583248100e-01   +1.970767412378924e-01   -2.947307836973770e-01   +2.652525469030320e-01; +3.344149078063507e-01   -4.011761988528541e-02   +6.936792726233029e-02   -4.823668642132763e-01   -9.077763733180143e-02   -9.889964349878065e-02   +2.296010316916895e-01   -1.395054090806204e-01; +4.644674470088247e-01   +3.708579256587057e-01   -4.872854184352707e-02   +8.732070418076612e-02   +6.763254488048945e-02   -1.083520542825160e-01   +2.540397011781698e-01   +5.323815455750807e-01; -1.143182426711017e-01   +3.464893204382501e-01   +8.941933497317481e-02   +3.967505837692765e-02   -2.012496239251004e-01   +6.296815753837670e-03   +3.132892207627874e-01   +7.878828745102005e-02; +1.869575938707954e-01   +6.126888835029083e-01   -2.408576632289492e-01   -1.888077113711598e-02   +2.307833182949970e-02   -8.544200796116763e-02   -3.703742114317905e-01   -1.259656799379814e-02; +3.163302366769345e-01   +3.618511557885103e-01   +2.793431256643085e-01   -6.768391921546930e-01   +3.546239819561821e-01   -2.551802655301247e-01   +9.546611759337825e-03   -1.255719980383885e-01; +1.589105683292411e-01   +5.500510828857673e-02   +2.449029883335664e-01   -1.460492968297364e-01   -4.474019333161487e-01   -1.263563171333907e-01   +2.580153399951517e-01   +4.978346184285946e-01; -1.423778774683126e-02   +1.613165181540194e-02   -9.396404039719716e-02   +2.055204063485158e-01   +1.583322403029879e-01   +7.423777210960061e-02   -4.513096681051409e-01   -2.079170930421431e-02; +8.490606777868753e-03   -1.950629981056597e-01   +3.566761252960035e-01   +2.744607761115829e-01   -3.741686856578239e-01   +1.108582476168359e-01   -1.090894380885730e-01   +4.316428971978081e-01; +2.790461043879083e-01   -4.578757397421960e-02   -2.200917960055431e-01   +1.833296594132059e-01   -2.950585215660405e-01   -1.098075386684510e-01   -2.448766550594527e-01   +3.119069441624517e-03; +5.665799894059195e-02   +1.763274501213945e-02   +5.530765789495961e-01   -4.558530862041222e-02   +3.548971203123513e-01   +4.281052421597453e-01   +2.780398936238723e-01   +1.733057521629319e-03; +2.274718533156367e-01   +5.204514147698153e-01   -7.701278163343805e-02   -1.686965184082834e-01   -9.796392763872190e-02   +3.025087361530845e-01   +3.775794771641758e-01   -7.209373196522337e-02];
L1I_L2I_iGABA_netcon = [+1.038959264092461e-01   -1.654488042350070e-02   +2.102246895506959e-01   +2.421631574392716e-01   -3.541694875049416e-01   +5.129016502712305e-01   +1.279611810379465e-01   -3.162878896967077e-01   -1.130283754133347e-01   +6.518579035556867e-01   -2.233203386407630e-01   +2.679468310197554e-01   -2.271518539299076e-01   -1.711455671399285e-01   +8.964334023720288e-02   +3.442682811141698e-01; +2.651699828115887e-01   +7.520329411409041e-02   +3.653611784779515e-01   -2.651895260414483e-03   -4.492518713358451e-01   +1.799663028303239e-01   -9.479221440793151e-02   +1.795766654027278e-01   -1.287811280668584e-01   -9.580739325184690e-03   +2.060060022884688e-01   +1.043202699125471e-01   +3.525935715518769e-01   -2.809469003441715e-01   +1.313077621083321e-01   -4.916367359015297e-02; +4.266154576495280e-01   -2.787208990805162e-02   +3.132818423443671e-01   +1.561694991649712e-01   -4.116580499752828e-02   -4.045670969721740e-01   +3.644004019625219e-01   -5.091415604153323e-01   -2.866989866311126e-02   +2.009134589850304e-01   -1.439230823170484e-02   +2.205597646868221e-01   +7.394286142765585e-02   -3.311086409452182e-02   -2.751972161838515e-01   -2.268341403464255e-02; +6.018205364647806e-01   +2.838536336775111e-01   -1.121369836648902e-01   -1.380567981831925e-01   -5.734156607955979e-02   +6.767857068914090e-01   -4.682666416542058e-01   +3.081652943743068e-01   -3.396628981554303e-01   -2.478508766387056e-01   +5.144403804997619e-01   +3.674493027618019e-01   +2.321339636906666e-01   +1.992657061085893e-01   +1.713400957216556e-01   -6.143107595911161e-02; +6.685395722375358e-01   +1.198590375020687e-01   +4.072847584140000e-01   +4.793382402752269e-01   +5.383602661364863e-02   +2.254596378999930e-01   -3.367152611120483e-01   -2.611748986679127e-01   +2.726280234825325e-01   -3.503144143892366e-01   +5.238443926986387e-01   -2.251431776611988e-01   -9.608285017890913e-02   -2.112900669910251e-01   +6.736913015598381e-02   +4.407288218364360e-01; -5.692833402816180e-02   -2.023835411928571e-01   -2.292740123436202e-02   -2.165842904262537e-01   +6.893131258438784e-02   +4.786262547722544e-01   -2.156574441506215e-03   -1.323783726971737e-01   +1.308930272187321e-01   -1.001331730029963e-01   +1.893172652464540e-01   +6.784512000685375e-01   +3.483702165277446e-01   +4.859517116768767e-01   -8.735993715835036e-02   -2.291078253536362e-01; +1.777537331619764e-01   +4.117402344525534e-01   -6.654132326407880e-02   +3.146988201694397e-01   +4.192258793945918e-01   +6.700668867455113e-02   +4.391826906320786e-01   -1.230909029662811e-01   -1.769777314740392e-01   +8.842065991099574e-02   +1.941422859150822e-01   -6.197885491044732e-01   -1.753658832614891e-01   +1.838894623875484e-01   +2.762873465050161e-01   -9.904652388499488e-02; -1.292969698044924e-01   +2.226198828720405e-01   -3.424003380318513e-01   -1.241973214421529e-01   +8.667300990605908e-02   -3.716413907563385e-01   +1.914536511334451e-01   -1.806976555283638e-01   +1.418417908524855e-01   +3.107366455635464e-01   -1.979592988623658e-02   +2.531956610509177e-01   -6.939500207137829e-02   -1.057219271470751e-02   +4.450815151069321e-03   -3.831606939267446e-02];
L2E_L1E_iAMPA_netcon = [+4.957837760616827e-01   -6.130064647565830e-02   +2.418201073438147e-01   -2.396339425005935e-01   -1.305519245270645e-01   -1.706258632903066e-01   +6.839585534977161e-02   -1.100622719493332e-01; +4.492114477386627e-01   +2.453318478729416e-01   -1.612508205649998e-01   -1.188525380265082e-01   +2.573377440947409e-01   -1.542436510101939e-01   -6.639321594976041e-02   +1.406453482893139e-02; +8.711216673880859e-02   +5.210746634774877e-01   -1.145144758967580e-01   -1.983705970298329e-01   -4.148720787731331e-01   +3.522655442588749e-01   +4.119567694504331e-02   +4.973812094101572e-02; -1.040964991013265e-01   -1.744394886802246e-01   +3.096266840471907e-01   -6.007296006575139e-03   +5.840575411593504e-01   +8.972269534180760e-02   -5.156975371913325e-01   -1.058228378288138e-01; +3.427825642496846e-01   +3.985150817652355e-01   +6.016681586570154e-01   -2.342592225220599e-01   -2.083486213771499e-02   +1.091748496440447e-01   +1.381990103269685e-01   +2.303824915324472e-02; +1.666225582159166e-01   +2.459014492918515e-01   +7.885371748463245e-01   -1.439093899434356e-02   +2.406928845783489e-01   +2.041338679726063e-01   +1.608765625488716e-01   +7.423991306964749e-01; -5.643077383974451e-02   -3.122401438185333e-01   +2.028567642129400e-01   -1.531852293326146e-01   +4.843823861914071e-01   -4.279299250453202e-01   +6.541331521425360e-02   -7.422523596549047e-02; -5.075616794199532e-02   +4.030714014460816e-01   -5.552594354798138e-02   -2.420053276949756e-01   +5.020529575578194e-01   +6.247525357800617e-02   +2.429291397234026e-01   -1.797595999378228e-01; +3.758136876587929e-03   +1.539283136157593e-01   +7.039115869640082e-02   -2.317789223596196e-01   +5.644643792320858e-02   -1.551089604469393e-01   +2.679380997412262e-01   +4.822010747300856e-01; +2.269000503358199e-01   -4.206057254699411e-01   +7.681365167443355e-02   +5.651659057487882e-02   +8.349622170509223e-02   +2.560073608620596e-01   +7.844734780485418e-03   +4.457544869427539e-01; +3.034635762703692e-01   +3.395248639921556e-01   +1.020490531717299e-01   -2.325041106880697e-01   -2.216018629796061e-01   +1.781149414449446e-01   +1.861861687762077e-01   +3.728153173752184e-01; +1.610882177718708e-01   -4.178945557249863e-01   -4.980458475164375e-01   +6.442612023788932e-01   +3.015781444699802e-01   -1.135317887976240e-01   +2.377770242929027e-01   -2.854439541495519e-01; -5.450392778385384e-02   +4.814636303684982e-01   +9.762631034087249e-02   +6.133400277927261e-01   +7.357148783138551e-02   +8.819816004436362e-03   +2.354996745306239e-01   -1.211696418820429e-01; +4.569856982750196e-01   +1.182158998565772e-02   +1.370692440848551e-01   +1.501411496842221e-01   -3.809359809247578e-01   -1.366042666083142e-01   +4.614193020501531e-01   +4.546649998120704e-01; -5.627209054515413e-01   +5.020212654948253e-02   -2.281270589837375e-01   +4.374143506294742e-01   +1.207889854254905e-01   -2.521219543566462e-01   +2.631153626171722e-01   -4.492554144783165e-01; +2.287289768412305e-01   +9.364193313700962e-02   +2.392071429492514e-01   -1.256965732374571e-01   +2.843365131318417e-01   +1.503566354189786e-04   +4.343812365846569e-02   -2.077245463226775e-01];
L1E_L2E_iAMPA_netcon = [+5.994089053376843e-01   +2.757193078009387e-01   +1.758982772948105e-01   -4.573244533881604e-01   -2.327668201468078e-02   +3.725497108958630e-01   -8.743873063157657e-02   +6.258842841252235e-03   -1.204534043625857e-01   -9.708027956861862e-02   -9.244169505629457e-02   +7.860136263573947e-02   -2.616232720018460e-02   +3.939558168352986e-02   +1.016113480659814e-01   -2.857517505381434e-01; -1.361075935353306e-01   +7.179465165932191e-01   -1.517491342583595e-02   -9.307980819823988e-02   +2.879443640615550e-01   -2.090115566250521e-01   +1.058432768396868e-01   +1.685366998213584e-01   +4.114802952138140e-01   +4.260894764822601e-01   +4.159077750469984e-01   +6.957587351012084e-01   +1.031254421055191e-01   +5.210955279316595e-02   +2.338449133393280e-01   +1.991146760231579e-01; -3.858749622438981e-01   +2.996879666088273e-01   +3.351327717083750e-01   -2.324230281221670e-02   +2.031157812942327e-01   +2.343622232489811e-02   -2.694292792553328e-01   +3.275605572293013e-01   -4.977500412808169e-03   -3.289821594500683e-01   -2.955864881251545e-01   +3.961564521949983e-01   -1.452877969851473e-01   -9.819720075863991e-02   +6.904012030101789e-02   -3.800292855209525e-02; +1.326422878620690e-01   +3.276487647271380e-01   +4.521044145797765e-01   -9.466559185952010e-02   -2.761745159926804e-02   -7.890224154901468e-02   +1.869314332784300e-02   +1.713008282944909e-01   +1.361180556552150e-01   +3.741314347619242e-01   +1.552594184545682e-01   -1.918145574747491e-01   +8.061432040520071e-02   +5.625172020918533e-01   -2.443063463611130e-02   -4.731489800680520e-02; -4.277468228797111e-01   -7.667781178665123e-02   +4.885187140829639e-01   -2.942542810116527e-01   -2.544795231393051e-01   -1.543550361188588e-01   -7.028041377260716e-02   -6.486541042767660e-02   +2.648832366323827e-01   +1.654607523060272e-01   +2.994030099503118e-01   -2.699936891777147e-01   -4.235464479995462e-01   -4.034216701515074e-01   +1.452508033846305e-01   -2.613458686830192e-01; -1.024054493366763e-01   -3.548585122347292e-03   +5.606972187309907e-01   +4.638860197803903e-02   +2.699899693262468e-01   +2.520222797579908e-01   -9.926373737003609e-02   +1.003473922965201e-01   -9.813317555761578e-03   +8.018902557916474e-02   -2.713536372668695e-01   -4.101984261954867e-01   +2.132398755736010e-01   -1.170553087117592e-01   +6.349061051393083e-01   -1.573805745372902e-01; -4.315918581914252e-01   +2.671266556192669e-01   -1.868676902279408e-01   +6.479214657819907e-01   -4.211878965478558e-01   -5.261060621155680e-01   -4.559014165459704e-02   +3.560734916315009e-01   +7.238886184444380e-01   +3.125561899882027e-01   +3.209766346006518e-01   +2.944193436150125e-01   +8.600611128491545e-02   +7.208400253335741e-02   -3.152572223393549e-01   -4.804220634790940e-02; -4.460088252653099e-02   +4.840712541100346e-01   +1.070032515021178e-01   -3.269306923668489e-01   -3.102075181069618e-01   +5.139970532861564e-01   +4.168997865118458e-01   +1.012841489055638e-01   -9.784444551584814e-02   +2.591583998421583e-01   +2.528208911390961e-01   +3.756607687257907e-01   -2.733025401061942e-01   -2.290317125778323e-01   -1.959128760459002e-02   -2.950743425369315e-01];
L2I_L2E_iAMPA_netcon = [-3.043315432006717e-02   -3.370072516015875e-01   +2.166706478255891e-01   -2.223747528485760e-01   -2.095390800735358e-01   +2.415843356575245e-01   -3.659082455664034e-02   -1.081383832379792e-01; -4.381637630988339e-02   +1.692936889746706e-01   +1.399577773936213e-04   +1.204832210975087e-01   -6.750167477064713e-02   +1.125243006872994e-01   +2.792860096311145e-02   +4.246295003121944e-02; +7.499402801938246e-02   -2.858954249166091e-01   +3.558665828782822e-01   +3.912382440494701e-02   +1.765288310427653e-01   +2.006281704447914e-01   -3.265490819566628e-01   +5.439322686686870e-01; +3.295354059010212e-01   +2.175751429135747e-01   +1.773077202668981e-01   +1.542075931682786e-01   +2.047528757731251e-01   +5.483108692792886e-02   +1.932159284921953e-01   -1.327989105474615e-01; -2.487024695014559e-01   -3.278842152462064e-03   -4.797958637589033e-01   +5.278343659070517e-01   -6.705958499453636e-02   -1.501637214438462e-02   -1.308437945045718e-01   +4.532360875676083e-03; -6.217876024180945e-01   -1.249515615011247e-01   -4.455385010364743e-03   +1.490999460722316e-01   -8.445132908198758e-02   +4.602414783877183e-01   +1.919108139705638e-01   +1.165567103236713e-02; +2.865311675330615e-01   +3.232772801625869e-01   +4.536448252156267e-02   -1.804872369959453e-01   +3.161130303075088e-01   -1.619926524272959e-01   -2.180039164267784e-01   +2.749619318455209e-01; -2.360009182829451e-01   -1.793686296098196e-01   +5.208839923199288e-03   +1.945123978105509e-02   +6.923029355514602e-02   +5.545079720340625e-01   +2.266729098320606e-01   -6.407081826555694e-02];
L2E_L2I_iGABA_netcon = [-4.035842896456696e-02   -1.852365782198536e-01   +1.303185966404919e-01   -2.041031213258677e-01   +3.184023240037176e-02   +2.925412344154665e-04   +2.214287023716001e-01   +3.099377367338320e-01; +1.484156538867324e-01   -4.659932290181567e-01   -2.181740424309037e-02   +4.998147179014922e-01   -1.696165775669591e-02   +5.054583657446940e-02   +1.556012139175116e-01   -1.388233592607322e-01; +6.924302634053983e-01   -1.872626230510630e-01   +2.257230767133647e-01   -1.569218648393857e-01   -3.498273943033205e-02   +3.927765161000016e-01   +5.452194419315700e-02   +1.221799735232824e-01; +5.700169909301606e-02   +3.139995770392025e-01   +4.369140527743226e-01   +1.998953343760180e-01   +2.710973454505169e-01   +3.763360579607208e-01   -2.021590678926515e-01   +6.874272837216221e-02; -1.917842309027548e-01   +4.208269547789344e-01   +4.787198042502858e-02   -3.720871197328695e-01   +1.900978541215623e-01   +1.447323834420149e-01   -3.144169044280870e-01   -8.438348288736924e-02; -5.669879579789325e-02   -1.236475545945024e-01   +3.244043002928444e-01   -1.558064080023875e-01   -3.290244937333847e-01   -1.479520769532878e-01   +4.228001829026595e-01   +1.295632790161728e-01; +6.304431982637316e-01   +1.158143292856930e-01   -1.216590769398480e-01   +4.005658766352634e-01   +1.280477828456086e-01   -2.510343420654540e-02   -1.927427518474621e-01   -4.275453890657425e-01; +3.157597013049190e-01   +4.210671248782479e-01   +4.474885263247886e-01   -1.560737135675154e-01   +1.971502344027872e-01   +2.251557588779303e-01   +6.998811949204647e-02   +1.319343539682672e-01];
L3E_L2E_iAMPA_netcon = [+2.867137651726303e-01   +2.610429585884851e-01   -9.609981326514888e-02   -4.415357882820289e-02   +4.287944356688006e-02   +5.976690321807073e-01   +3.315364191488387e-01   +2.551716702321354e-01   +3.359070124176511e-01   -5.620574882526375e-03   +2.506556588218131e-01   +2.473972147718053e-01; +2.940645237772656e-01   +4.850713839072132e-02   +1.641046129048422e-01   +3.089935357814932e-01   +4.804733571881429e-01   +9.610515524884296e-02   +2.086840343757947e-01   -5.817175631596803e-02   -7.370619034383996e-02   +4.185930178780925e-01   +9.002441846975728e-02   +1.249682485685394e-01; -3.234866295311678e-01   +4.244303168220436e-01   +3.201098529824538e-01   +1.668425635075306e-01   +2.479039376445452e-01   -1.297423600628883e-01   -4.369461785504924e-01   +3.897978379278533e-01   -3.541965473196694e-01   +5.159733049409533e-01   -1.004426597410593e-02   +1.137695479959008e-02; -2.969742369129054e-01   -8.622844712707585e-02   +1.043658309033246e-01   -1.149045319655865e-01   +4.824847831996787e-01   +9.139432092122896e-03   +3.833727477691401e-01   -3.036154780957769e-01   +6.291551350342622e-01   -9.436208973426048e-02   +2.808706789107817e-01   +1.047295087482912e-01; -1.148220065708948e-01   +5.729142435008129e-01   -4.605001863272851e-02   +1.766519161215706e-01   -2.377585585769672e-01   +3.099349705979523e-02   +1.023049295686890e-01   -1.397667469242274e-01   +5.635815273137847e-01   +4.388840599759146e-01   +1.697514408888232e-01   +4.729385820085146e-01; +2.982674424762393e-01   +4.311452103511006e-02   -2.492198825860439e-01   +2.153228659077681e-01   +1.532390559985353e-02   -2.688205581899055e-01   +1.887825292946890e-01   -1.508609803704021e-01   +7.294238225024949e-02   +3.426521489190990e-01   -2.339858637272595e-01   +2.557065842754250e-01; +3.014009921806916e-01   -1.649449088680060e-01   -4.725846855455504e-01   +3.580062618417004e-02   -4.095226574938830e-02   -1.422420916091330e-01   +1.730332613337431e-01   -3.166375321376629e-01   +1.426272901141495e-01   -1.858605826507684e-01   -1.815157226347866e-01   -6.075855633398095e-02; +6.694584486879411e-02   +2.162077048892136e-01   +2.855851197158829e-01   +4.097521930101797e-01   +5.964280281761907e-01   +8.880021025843257e-02   +3.947513742865962e-02   -3.707073281429607e-02   +3.371561238981625e-01   +8.957543257223660e-02   +3.732992016102265e-01   -3.852472490586830e-01];
L3I_L2I_iGABA_netcon = [+1.865628562143388e-01   -2.969325093388428e-02   -1.043344967394506e-01   +5.212192846394132e-01   -2.828025753266876e-01   +2.690931352337241e-01   +1.194742631089878e-01   -8.183699242610411e-02   +1.369276607923857e-01   +1.089942392659383e-01   +3.119684691988626e-01   -9.457246592007761e-02; +2.552567580618069e-01   +1.019711815973055e-01   +2.108925367609317e-01   +3.337923606867228e-01   +1.163879867974797e-01   -1.489541850459776e-01   +4.475023675530090e-02   +3.065954631509307e-01   -3.674702813593575e-02   -1.474306660759240e-01   +3.427600257701588e-02   +1.581668535177042e-01; +6.736501805735582e-01   +1.289639754613371e-02   -4.410759561651812e-01   +2.751717184839300e-01   +6.479756652897345e-02   -4.266914811907407e-01   -2.569369300912211e-01   +1.530636426470707e-01   +1.618452260234820e-01   -2.134517112536314e-01   +3.651989007944181e-01   +3.185956729634224e-01; -1.620624532481773e-01   +1.836293322737280e-01   +1.699740632460131e-02   +3.923604993466873e-02   +2.888558206951540e-01   -2.928425252236515e-02   +1.107256537364963e-02   -1.534927236336688e-01   +6.618755550818983e-02   -4.175566526761431e-01   +2.006509529424889e-01   +2.662817447134753e-01; +3.299896667027651e-01   +8.758598549548578e-02   +4.398006896319759e-02   +2.974881732461346e-02   +4.307631041096766e-01   -3.626089464274164e-02   +2.237407702854352e-01   -2.728647892281737e-01   +3.155148678836801e-01   -4.640278572554800e-03   +1.256334472179930e-01   +4.536663548504026e-01; +3.980525680792519e-01   +3.003255830729123e-01   +3.646262196854722e-01   -6.269036980897219e-02   +3.623811984384835e-01   +3.585094378397700e-01   +5.947678879365055e-01   -2.399531877915531e-01   +3.263489427967808e-01   +1.157933564074505e-01   -2.273109777332034e-01   -1.359959091055686e-01; +4.635400211696431e-01   +2.017551755171560e-01   -2.262120575283092e-01   +2.024538326361741e-02   +1.375536553135789e-02   -2.706868581749161e-01   +6.448447746460824e-01   +2.788433980939210e-01   +3.895216032560613e-01   -1.409835265124106e-01   +3.787155303005563e-01   +7.652784100458387e-03; +7.205124031377019e-03   -3.815100602250532e-01   +3.183306587081016e-01   +1.109125349740438e-01   +8.232214228398502e-02   +8.719911458222887e-03   -2.403627860861152e-01   -3.466085678685975e-01   +5.916737074858887e-01   +2.842172806079910e-01   -2.678850901069307e-01   +2.900581900421156e-02];
L2E_L3E_iAMPA_netcon = [+2.972101677930954e-01   +5.253861287067911e-01   +8.297017121730560e-02   -2.799056479042359e-01   +1.135013668524625e-01   -2.134976182672181e-01   +3.522188580664590e-01   +4.587297817599057e-01; +1.200928930198978e-01   +3.984095928128191e-01   +5.022525772914860e-01   +2.438181730505418e-01   +4.379373562006426e-01   +8.572701717141233e-02   -1.026252752300841e-01   -5.236086501628063e-01; -1.118503448733496e-02   +6.534738173389000e-01   -1.416591733690973e-01   -6.667528376195444e-01   -2.501506761387674e-01   +1.109589319644389e-01   +5.039584319696039e-02   +5.445883023256817e-01; +3.068407549180284e-01   -2.267964706181722e-01   -3.331414430964919e-01   +5.397661960756565e-02   -7.467391838388240e-02   +5.612903929623585e-01   -2.794936873900422e-01   +3.083277267959755e-01; +3.783876224047761e-01   +1.728125654002413e-01   -7.351190557209564e-03   +4.593402073272744e-02   +5.263526555535682e-01   -2.224981921392866e-01   +3.691920875649058e-01   +3.785656543899720e-01; -1.561015821319369e-01   -1.379454090028886e-01   +2.176448708295519e-01   +4.246212178344967e-01   +1.902730703666658e-02   +1.528439999930170e-02   +1.195126098934476e-02   +4.142663645360608e-01; +4.311560434330353e-02   -4.351810938714548e-01   -6.188258483726047e-02   -4.630480782091113e-02   +2.352898106747541e-01   +2.472596140993416e-01   -1.649328134736203e-01   +1.900141255522183e-01; +2.227484585003091e-01   +2.690348460012962e-01   +6.433758287111618e-02   +3.036464856825896e-01   -4.002087053298627e-01   -4.615259024494374e-02   +5.985107743844207e-01   -1.628888213233430e-01; +3.039814695058243e-01   -2.907444311111321e-02   -2.493159965319651e-01   +2.500845670975267e-01   -1.165280609773092e-01   +1.088819370857674e-02   -2.409479265064729e-01   -9.974650631842599e-02; +1.334542771952021e-01   +6.619958336853613e-01   -3.118704119344799e-01   +6.484153006851370e-02   -2.824708361245013e-01   -9.743415928125408e-02   +1.298361645785564e-02   -8.890977179012208e-02; -7.130908585280939e-02   -5.356119087880635e-01   -2.263999954080357e-01   -1.212371738463371e-01   -8.977781298943212e-02   +3.671081882224926e-01   +4.331178233905264e-01   +7.620026877696482e-01; +2.688563569428839e-01   +7.101526342939051e-01   +2.845079613441898e-01   -3.006931837224595e-01   -7.627910415570673e-02   -2.284503081686566e-01   -6.021045881607764e-02   +3.665452352266355e-01];
L2I_L3I_iGABA_netcon = [+2.042573536600669e-01   +6.685698297767571e-01   +2.470777820008327e-01   -3.972862697890565e-01   +4.064275622191860e-02   -5.671347336524468e-02   -7.589781508276347e-02   +1.778667045403023e-01; -4.805237508184462e-01   +1.616096824543582e-01   +3.660183199551172e-01   -4.685702517401361e-02   +1.392223570613226e-01   +3.728973745045529e-01   +1.969233693053309e-01   +3.897964823071456e-01; -1.557029118601614e-01   -1.474583507946765e-01   -1.344970168016885e-01   -2.104930549414049e-01   +5.325995783904365e-02   -2.214721088097536e-01   +7.817330672131666e-02   +5.291902770638093e-01; -3.672405666142476e-01   -1.029650197941463e-01   -4.085142855487731e-02   +8.747755983510304e-02   +1.818278768164729e-01   -7.434234928247113e-02   +2.233202430875642e-02   +5.555016868742553e-02; +1.868189081330629e-03   +2.156977121840739e-01   +1.742116086176861e-01   +4.609247228407398e-02   +3.244932588021955e-01   +2.409343022433533e-01   +3.613150549501805e-01   -3.916111517045467e-01; +1.986850997290238e-01   +3.649120499389717e-01   -1.765256562168037e-01   -2.182778534967525e-01   +8.903677324281903e-02   +2.693168901364819e-01   -3.657997667170266e-01   +2.743295274692941e-01; -1.078788352062818e-01   -2.491493985807083e-02   -4.380925824976123e-01   +2.010052339568849e-02   +3.179674886515574e-02   +3.856405310809694e-02   +1.146792955117473e-01   -1.278574031410974e-01; +4.234823181727846e-01   -1.658093133526901e-01   +2.202857024600784e-01   -4.116777607839144e-01   +2.864106723166792e-01   +6.292683166557338e-01   +4.044404783261811e-01   -3.378981138613339e-01; +2.999788066292280e-02   -1.755696918907496e-01   +1.968381640415101e-01   -1.584927938723769e-01   +4.318467635921810e-01   +5.327837640277653e-01   +5.333451951805102e-01   +5.870631118629359e-01; +7.336342263322962e-02   -1.030644983097006e-01   +1.269348186903843e-03   +3.880922208941178e-01   +1.785418894825224e-01   +6.195392310960156e-01   -2.009026632067747e-01   +3.656924542244371e-01; +5.386773779302303e-01   +2.631530835823308e-02   -7.629465187349370e-02   -1.161645375854359e-01   -2.404786898158777e-01   -2.183045330320623e-01   +3.653184785171820e-03   +7.786615059193200e-01; +5.006921101704803e-01   +3.863188267446332e-02   +9.181788667014634e-03   +1.003655236531512e-01   +3.917023085829140e-02   -4.543986845651192e-01   -1.683685722646834e-01   +1.522415123150120e-01];
L3I_L3E_iAMPA_netcon = [+2.540617261602136e-01   +6.176811513892867e-01   +1.609035333761593e-02   -2.046970372095007e-01   +3.126493953975883e-01   -1.577575774761265e-01   +1.312719057859634e-01   -4.279410457023642e-01   -1.689349014499242e-04   +1.885631704568902e-01   +2.034056061889419e-02   +1.377162841433348e-03; -8.730569110514286e-03   +1.253205411764550e-01   +5.931382295423235e-01   +5.369180108356639e-01   -2.581520481071886e-01   +6.591750178384160e-01   +6.487680046535188e-02   +2.393947188829284e-01   -7.040816326919716e-02   +2.651113306562660e-01   +1.816816700351599e-01   +2.466062870105722e-01; +3.514336582676820e-01   -6.124099689837825e-02   -1.862548654847050e-01   +5.434294358639605e-02   -2.202074758623491e-01   -9.015207256453257e-02   -1.190712258805193e-01   -1.400055901130926e-02   +1.852502859580799e-01   -6.593605076336542e-02   -2.857755761592021e-02   +3.048312562251912e-02; +4.750744931831169e-01   +2.682948570631586e-01   -3.591551338421343e-01   +1.137347732439153e-01   +6.585959509392836e-01   -1.008817868281719e-01   +2.941951819038885e-01   +5.414459962918547e-01   +4.774700333231623e-01   -3.165745465342817e-02   +7.546000346064440e-02   -5.934489113136175e-02; -2.880178990120231e-01   +5.430325723242456e-01   -7.138223070708927e-02   +1.138634816286150e-02   -3.768268356502937e-02   +6.996577006156612e-01   +3.506542873996277e-01   -3.318650628419018e-01   +1.283579349728156e-03   +3.186495955859771e-01   -9.790404170336227e-02   +3.294127644822603e-01; -7.576399635473807e-02   +2.575653693463044e-01   -3.322893743905042e-01   +4.283498011894811e-01   +9.183319972564914e-02   -1.332249116700212e-01   +4.348691042965688e-01   +1.319847538463842e-01   -9.796810000459011e-02   +3.598223212403807e-02   +2.887666399874067e-01   -3.483025904182625e-02; +2.359507120031493e-01   -6.960491265394869e-02   +5.241517963827765e-01   +4.648886917412471e-01   +5.540030273752338e-01   +4.331703959949877e-01   -7.021451880665769e-02   -1.447648110088077e-01   +5.501445258663074e-01   +3.789070894069925e-01   -1.196319262840679e-01   +9.086695327172689e-02; +2.331933988396231e-01   -1.739035990556070e-01   -4.318139142293041e-02   -2.163051355693699e-01   +1.352215369862953e-01   +2.505524996141287e-01   +7.938506692418268e-02   +2.147661747168100e-03   +3.030060804596116e-01   +8.340445253782391e-02   +2.516187250466324e-01   +1.243654229230248e-01; +2.096875599295226e-01   +1.217032917521816e-01   +4.450789199900946e-01   -3.784094986464603e-02   -5.530226312659046e-02   +5.393364217619290e-02   +2.580270439604390e-01   -2.699194509417985e-02   +2.564484780389170e-01   +1.276005917240151e-01   +4.640239012586710e-01   -6.617283917454983e-02; +1.520224821580033e-01   -2.072571027607488e-01   +2.417857507855360e-01   -3.007876020079561e-01   +2.833864183353042e-01   -2.676859054540101e-01   -1.687335858937078e-01   +3.060581225426129e-01   +1.454256792767530e-01   +3.689529546386537e-01   +4.179022045063732e-01   +1.334894620344337e-01; -1.615512419428169e-01   +1.560498697295279e-01   -1.315785073155883e-01   +6.337010002915106e-01   +6.338355395736628e-01   +1.185381682024714e-01   +1.710741272174464e-01   +3.469667517248780e-01   -4.161015399895648e-01   +4.105031883092709e-01   +4.042631042797471e-01   -1.865638075249120e-01; -6.182574613859536e-02   +3.891670918145058e-01   -1.355678836675825e-01   -1.021474439018066e-01   +3.053030613545551e-01   +2.540786334434036e-01   -1.991137182239476e-01   +4.046126121434170e-01   +4.996246596104648e-01   +3.836643073888304e-01   +2.893740606910023e-01   +8.307691338619645e-01];
L3E_L3I_iGABA_netcon = [+3.903573425011787e-01   +1.630395153380893e-01   +9.239503241734875e-02   -2.625748995729525e-01   -5.079253527657476e-02   +5.575302983096955e-02   +7.148270626038049e-02   -4.224991365312433e-02   +1.084370903401773e-01   +3.283999615663595e-01   -4.884153934331132e-01   -2.067788038219824e-01; +3.339768243197571e-01   -7.763302694470239e-02   +4.900162820764968e-01   +3.625615253066990e-01   +1.013410472611403e-01   +3.515573767935470e-01   +3.873681810605957e-01   -2.352214833633240e-01   +3.009337536394203e-01   +3.520267395504232e-01   +1.261863230540429e-01   +1.276990652279876e-01; -2.478597352948879e-01   +1.920672192535383e-01   +2.538653789015757e-01   -2.685545768511831e-01   -1.004905034628345e-01   -6.493228229475655e-02   +4.408928058820111e-02   -1.017894588793360e-01   -2.955235146306845e-02   +2.257086328123601e-01   +1.408131863430302e-01   +2.763873097803144e-01; +1.360054367697294e-01   -7.905804324885840e-02   -8.698365502664399e-02   -2.879127304333771e-01   +6.220956703529643e-02   +2.417621495682913e-01   -3.505433430345135e-01   +2.337136473959191e-02   +1.473275110476709e-01   -5.616821689677494e-02   -2.454184940655227e-01   -3.866487843549417e-01; -4.249490155336249e-01   +2.015649229434124e-01   +8.537741441092470e-04   +5.020859049912088e-02   +2.241086195517819e-01   +1.695749294441790e-01   +3.612138386098150e-02   +1.037183986555456e-01   -8.832488340234036e-02   +1.366105945463958e-02   +1.078714749135448e-01   +3.970802382808062e-01; +3.385705697653011e-01   +6.154977441988091e-03   -3.030354692705585e-01   -1.359286029256162e-01   +7.051860635402155e-02   -1.568224874439775e-01   +1.112056388411655e-01   -1.159310998237895e-01   +1.411421986007336e-01   -4.946228878374056e-01   +5.309497521456361e-01   +1.814788881939968e-01; +1.530702774329448e-01   -1.837815463596923e-01   +1.382222441826132e-01   +6.248591673330492e-01   +1.095712839581670e-01   -1.618731825985304e-01   -3.198730026806613e-01   -3.402281084854165e-01   +1.873645034206597e-01   +2.027408093281069e-01   -1.612279187572407e-01   -2.769135926734823e-01; +3.002247896705654e-01   -2.644146952932819e-02   +1.941912170048601e-02   +1.759693124705142e-01   +2.411325260592879e-01   +2.099293458630693e-01   +4.429654843924648e-01   +1.329655147378975e-02   -6.171282544352512e-01   -8.282778840636038e-02   -1.884588947238395e-01   +2.027270760816477e-01; -1.443297565452242e-01   +4.048045856181445e-01   +2.651120488912898e-01   +2.468584924405217e-01   +3.041022843655446e-01   +1.736473698012034e-02   +4.790141291640265e-03   +7.731862095478859e-02   +5.981074547233775e-02   +4.152197795608047e-01   +3.786443449936690e-01   -3.221300870155899e-01; +1.784417994392649e-01   +1.254518444878842e-01   +5.794188329010657e-01   +5.890015456110483e-02   +3.182931146810445e-01   +1.614174802905936e-01   +1.246928473503355e-01   +1.847432034810012e-01   -8.835019787098708e-02   -2.198502956051210e-01   +4.878619004416140e-01   +3.154153056455798e-01; -7.773972023181497e-02   +2.029600608302923e-01   +9.654131520598958e-02   +6.846733791602988e-02   -2.135525215830219e-01   -3.266058353717562e-02   +3.413642217616248e-01   -4.002348096020303e-01   -2.501911540625917e-01   -9.810690231683851e-02   -3.205806422316779e-02   -1.780841288676383e-01; +2.873506602781223e-02   -6.937807038320518e-02   -1.154517854549285e-01   -6.577177183022639e-02   +1.727050636034186e-01   +4.473498748792224e-01   -7.969415430256571e-02   -2.253017336227313e-01   -1.068097254190928e-01   -3.066212380729848e-01   +1.614849182418895e-01   -3.012208461118305e-01];
L2E_Input1_iAMPA_netcon = [-3.661719433613639e-02   +1.902744812736889e-01   +2.710522236089716e-01   +2.647002945133008e-01   +2.244843130499586e-01   +1.493856343303156e-01   +2.833479243514332e-01   +3.204850229477667e-01];
L2I_Input2_iAMPA_netcon = [-1.932459200751984e-01   +5.146519992449704e-02   -3.755185517857108e-01   +1.410946553238338e-01   +5.744787148244959e-02   -2.611815363382359e-01   +4.846692287838771e-01   +2.075362471493566e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
