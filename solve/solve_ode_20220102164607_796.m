function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.686044896604708e-02   +3.146739278188314e-01   +5.451443281073084e-01   +4.121975072393858e-01   +3.722733523438541e-01   +5.726230116555939e-01   +2.945209007522785e-01   +1.042185095859243e-01   +1.194517473102072e-01   +2.619063319525592e-01   +3.418292566946937e-01   +1.131246067971054e-01   +2.307919641065526e-01   +3.937391549237211e-01   +2.609273612343497e-01   +4.667586833431347e-02; +2.205407603745445e-01   +7.181900084455837e-03   +3.063889937615566e-01   +3.683826850976237e-01   +1.648705641495679e-01   +1.899796200228256e-01   +5.345949918590521e-01   +5.903023637058685e-01   +4.034848415352403e-01   +1.196951384532043e-01   +5.858678901182709e-01   +1.265628936309970e-01   +1.155717597325537e-01   +1.742959260369392e-02   +3.149094836513199e-01   +2.243905354236545e-02; +3.954773927512693e-01   +4.190563731777935e-01   +4.989479224368429e-01   +2.813805384608186e-01   +6.911381557073805e-02   +5.041842651975753e-01   +5.218568570681468e-01   +2.556842463075408e-01   +2.799306556652815e-01   +2.506171684623571e-01   +2.694415475981645e-01   +8.696184710068708e-02   +4.221493830964754e-02   +8.305860174747402e-02   +4.930187998125402e-01   +3.498122987538393e-01; +5.490993307771599e-03   +1.334477485341779e-02   +2.721328184028216e-01   +3.675625762391608e-01   +1.228008378278446e-01   +4.766703736740369e-01   +2.723400117476654e-01   +5.740750607533115e-01   +2.888576157851369e-01   +1.760291837111323e-01   +5.331837801385306e-01   +5.328400112652891e-01   +7.493598768190672e-02   +5.417631942663305e-01   +1.333069138229619e-01   +1.873815185549468e-01; +2.826628273519690e-01   +3.797662697122903e-01   +3.717169968034580e-01   +4.102024468910687e-01   +2.319580991971554e-01   +4.963809544249224e-01   +2.965566260380236e-01   +1.548242354464866e-01   +3.304901319231595e-01   +4.956924857376888e-01   +2.182990271897672e-01   +4.031513277936876e-01   +1.414490813736932e-01   +1.923676573025005e-01   +5.299822915983671e-01   +9.410144112357760e-02; +2.861098789349043e-01   +8.773417153995686e-02   +4.959565538650390e-01   +9.664175402129330e-02   +3.771301689648293e-01   +1.809525804767912e-01   +2.673472756009144e-01   +1.126463677683998e-01   +2.975837289812561e-01   +2.801760554026701e-01   +4.478398768055357e-01   +1.442680640825273e-01   +2.874603957518956e-01   +3.147229619285786e-01   +2.834877286349429e-01   +4.157937510964979e-01; +1.910364994746174e-01   +3.963212622037111e-01   +5.517330565367002e-01   +3.885255055052166e-01   +2.222446511111359e-01   +3.690682072123967e-01   +2.197623155793371e-01   +4.931880619378498e-01   +5.704620307759838e-01   +2.353270296744805e-01   +8.709760501429646e-02   +1.015911615972282e-01   +2.502991300666812e-01   +5.496807309769189e-01   +3.045485959551260e-02   +1.441477559820413e-01; +3.344457971146120e-01   +2.098355522412991e-01   +4.587531451817680e-01   +3.613850543082021e-01   +3.433655424808493e-01   +9.499385744087462e-02   +4.840756977653304e-02   +2.547201014768330e-01   +4.526026317066559e-01   +4.036606638061805e-01   +1.731239329872122e-01   +4.444352766524274e-01   +1.854069721362724e-01   +6.525640072161899e-02   +4.231353212132403e-01   +3.623159442900022e-01; +7.304527159499939e-03   +3.975871569964921e-01   +3.995994800224169e-01   +4.074219370779201e-01   +5.041573943248012e-02   +5.401922940742138e-01   +2.672762128566681e-01   +2.616051631500791e-01   +2.956612810810852e-01   +2.872319528936818e-01   +9.893403940428777e-02   +5.278513848990272e-01   +5.969724614391639e-03   +4.564724877902244e-01   +2.175561803829261e-01   +2.888136144907221e-01; +4.213542804626310e-01   +6.591307788035063e-02   +5.225767724842351e-01   +4.855088803761661e-01   +3.784380800877541e-01   +1.101523626369420e-01   +4.597057598062140e-02   +7.708044532452270e-03   +4.451860734335308e-01   +2.361736305627652e-01   +6.365267023827945e-02   +3.253780259896488e-01   +4.925089963691467e-01   +1.490211773202439e-01   +5.068836013355880e-01   +3.874898387617985e-01; +2.306918223060905e-01   +2.860891470911785e-01   +3.069308165066929e-01   +4.658142288362356e-01   +5.326519104300433e-01   +1.102086054495964e-01   +3.682557707053380e-01   +3.567985643926613e-01   +1.486178424892356e-01   +1.737551151931295e-01   +4.292958784943222e-01   +5.634065725235466e-01   +7.088788423233247e-02   +4.167130472344202e-01   +4.541823440821424e-01   +1.142781559501223e-01; +3.142065729640265e-01   +1.771530481770702e-01   +5.829840323774459e-02   -6.481041563768864e-04   +5.772845445964483e-01   +5.446748327413161e-01   +2.873595722957517e-02   +4.119511707566963e-01   +4.118207634577470e-01   +1.721386161111917e-01   +6.716387902176751e-02   +1.377694005074105e-02   +5.439183042805724e-01   +4.178857336803751e-02   +3.190288508099391e-01   +2.421170005166298e-01; +3.906917344440496e-01   +4.356872807285143e-01   +5.195260772146374e-01   +9.298421420466085e-02   +3.930492013507887e-01   +4.185370192868624e-01   +4.176304329488623e-01   +3.795291512836090e-01   +5.276298724953277e-01   +2.608142351403460e-01   +2.408115572354840e-01   +5.203660139377416e-01   +4.945363155006084e-01   +4.270807917135290e-01   +2.635915254728213e-01   +5.356337640481720e-01; +4.952879654137460e-01   +3.910174413815578e-01   +1.789100161167019e-01   +3.653330822949736e-01   +7.652811534037793e-02   +1.396990563125385e-01   +3.555738556685887e-02   +1.398130900448087e-01   +2.069281933286003e-01   +4.091103287269950e-01   +1.160500470222975e-01   +4.619302205523760e-01   +3.285601494548119e-01   +3.702948556284526e-01   +2.351122241761704e-01   +1.905058424230351e-01; +2.127011463477498e-02   +3.137184428846677e-01   +4.939087576426884e-01   +3.134582468676440e-01   +1.581903830918156e-01   +1.044320663527756e-01   +1.586350559660511e-01   +2.312830874213945e-01   +1.403349700635696e-01   +5.856956057416736e-01   +2.119548544326774e-01   +3.379140802473111e-02   +1.102386546721299e-01   +4.316100196759174e-01   +1.582916385785883e-02   +4.058073270796154e-01; +4.639813183627552e-01   +2.163369936850941e-01   +1.241921250490056e-01   +5.712312250251612e-01   +6.422326277251349e-02   +8.144264188491239e-02   +5.255432182704454e-01   +8.554039844838517e-02   +3.575706167625557e-01   +4.449659812418797e-01   +3.877776392107325e-01   +9.456842831095448e-02   +4.408427997471820e-01   +4.765002692910568e-01   +5.654246945702393e-01   +5.338234198669100e-01];
L1E_L1I_iGABA_netcon = [+3.126668789548097e-01   +3.811398895691070e-01   +4.168255834195492e-02   +1.922898982387266e-01   +4.904602439227580e-01   +2.331460966734022e-01   +2.155316599830677e-01   +1.385263053493559e-01   +5.209806012724531e-02   +2.248233617903305e-01   +2.215775636434885e-01   +3.450553105509663e-01   +1.903492932513386e-01   +5.323118280248860e-01   +1.248066561000512e-01   +3.097212953886186e-01; +8.581125229683745e-02   +5.429235044165868e-01   +3.010993158274777e-01   +5.197762776496385e-01   +2.681556166965681e-01   +2.525402912591800e-01   +8.545113742203066e-02   +3.001459512917920e-01   +2.830673240529389e-01   +9.036747419329827e-02   +1.254910883576279e-01   +4.138031740274431e-01   +2.847103923678921e-01   +4.319993046459225e-01   +2.937903914934079e-01   +4.269431003282876e-01; +3.675721762370809e-01   +5.828613960905896e-01   +4.586739994861980e-01   +3.741967424249182e-01   +7.047173795630274e-02   +3.481364787646658e-01   +3.834217735491794e-01   +5.102506833849464e-01   +5.171820235579294e-01   +5.590120617489598e-01   +3.895044104483338e-01   +2.891833904254237e-01   +5.715571152013412e-01   +4.948960602154497e-01   +2.593980985141459e-01   +3.280996152538548e-01; +3.122255676595217e-02   +8.349857072471828e-02   +5.417677620232800e-01   +2.590465202494823e-02   +1.106930920070245e-01   +4.258458877078997e-01   +4.258404981766285e-01   +3.354048617342368e-01   +2.936445689152734e-01   +5.712724351370488e-01   +3.798508504293611e-01   +4.898394460931628e-02   +2.107483865933402e-01   +1.078120466884846e-01   +6.006691099645128e-02   +5.764607574229240e-01; +8.344339362779332e-03   +5.174506594621948e-01   +3.095629701162275e-01   +5.531996559411933e-02   +2.481885952613354e-01   +5.029977522511373e-01   +4.186419367493851e-01   +2.267063264732846e-01   -4.374582934487265e-04   +9.279827262640937e-02   +4.264319413077429e-01   +7.554054261018020e-02   +4.824436127091039e-01   +2.762109248885410e-01   +3.930092773615357e-01   +3.233463245219312e-01; +4.614274724725718e-01   +5.550329635341082e-01   +9.285755974019611e-02   +4.005109435380354e-01   +2.120293834619768e-01   -3.337301768077585e-05   +4.128233209644797e-01   +1.773426775839916e-01   +4.839059972186145e-01   +1.043101933918227e-01   +5.604340037564917e-01   +7.945469605562465e-02   +2.261848190217659e-01   +7.802642411764762e-02   +3.133802185084907e-01   +8.529028413878535e-02; +2.953048570358728e-01   +1.338459832745922e-01   +7.686616652444707e-02   +1.554821053245985e-01   +1.133049293964226e-01   +2.227111121473200e-01   +1.714875360126558e-01   +3.176741853877472e-01   +5.238192729058846e-01   +9.026527920920074e-02   +4.444281705697119e-01   +5.897298623919264e-01   +5.888034153447338e-01   +3.069837471380789e-01   +3.063299453624510e-01   +1.776599566422462e-01; +1.680182380471159e-01   +1.260797344140065e-01   +1.105732229147037e-02   +9.514980273945726e-02   +4.262448782974271e-01   +3.081053050006534e-01   +2.909112701130885e-01   +3.700156805602023e-01   +1.174425562120291e-01   +2.456665108609732e-01   +4.863746983321237e-01   +5.598828291298376e-01   +3.106096384199434e-01   +2.666781356215888e-01   +1.059017575188433e-01   +4.116194242484261e-01; +1.735338226349482e-01   +3.605118537676483e-01   +1.768970369027942e-01   +1.186911167420162e-02   +1.037955473716385e-01   +4.146556641087779e-01   +4.737572101515327e-01   +5.333001575538299e-01   +2.225444034037512e-01   +6.456966279927216e-02   +4.478851029371427e-01   +2.065764150920884e-01   +5.257903596453404e-01   +5.501612008534172e-01   +3.589933422806281e-01   +4.310783441373234e-02; +2.814754735774415e-02   +2.391693769191796e-01   +8.818795143209321e-02   +3.429877147866120e-01   +2.399817911360315e-01   +4.881018006889346e-01   +1.860303962575134e-01   +1.339634135044284e-01   +5.506571940763372e-01   +4.538871866455265e-01   +1.362508127074992e-01   +3.620458848120259e-01   +4.532862032490023e-01   +1.113730010868368e-01   +4.554376476803841e-01   +1.323617230401944e-01; +5.107880308698681e-01   +5.073000772508711e-02   +1.799428698791393e-01   +2.384688317998255e-01   +3.111212710220864e-01   +3.895604279481057e-01   +2.674440808649815e-01   +5.634641801896059e-01   +1.912715564042904e-01   +2.452809335528991e-01   +3.411271416901479e-01   +2.782394943097527e-01   +1.514737953529497e-01   +5.753705971626327e-01   +5.211659646312496e-01   +2.003797619656809e-01; +1.077561547293110e-01   +5.346236773247317e-01   +3.297556630102548e-01   +5.451789263032900e-01   +5.850069355216557e-01   +3.984521408866204e-01   +2.756225888718687e-01   +8.525247950974887e-02   +4.286227340795587e-01   +2.675519427389790e-01   +2.086286544915723e-01   +4.900626163802106e-01   +3.954470123594389e-01   +2.908417079923567e-01   +4.681737145201622e-01   +1.447425309927344e-01; +4.316050462231882e-01   +5.430208114883205e-02   +3.113477232764530e-01   +7.055350972503399e-02   +3.177682472497098e-01   +3.341067139977020e-01   +3.469202663844648e-01   +1.211565923038913e-01   +4.408511748671103e-01   +5.229175341204727e-01   +1.047524876961781e-01   +4.606468307796374e-01   +5.713731870688847e-01   +3.637059584131307e-01   +2.162320572937317e-01   +8.119000769621303e-02; +1.502573465751776e-01   +1.515560144155280e-01   +1.333205422999585e-01   +5.831266579558288e-02   +1.107805323449893e-01   +5.116772479712788e-01   +5.450798310997309e-01   +4.451779337826620e-01   +2.537064577261279e-01   +3.893752471361601e-01   +5.793631904929333e-01   +4.346646665502530e-01   +3.692443829315918e-01   +5.163294063397602e-01   +3.810666025190144e-01   +4.334286682206534e-01; +2.565140364027209e-01   +9.956169788676227e-02   +2.614890381795940e-01   +5.233687352811961e-01   +3.754677671290880e-01   +3.011467238340133e-01   +6.828032277034005e-02   +2.022516565153373e-01   +9.635139405136241e-02   +2.982298597550059e-01   +1.569337891141422e-01   +2.629216640811565e-01   +2.255283157078127e-01   +1.374954225957409e-01   +1.075502277485247e-01   +1.810350131985702e-01; +2.593402478438512e-01   +4.883828597855380e-02   +1.103502728352174e-01   +5.491724769346221e-01   +5.539425477334489e-01   +4.255440274779039e-02   +1.176503063059655e-01   +4.760084407709971e-01   +4.713201579432325e-01   +7.940630652286471e-02   +3.049286005763811e-02   +3.691395936924871e-01   +3.895430295576702e-01   +3.077050964690921e-01   +2.365542432217612e-01   +2.685949664900441e-01];
L2I_L1I_iGABA_netcon = [+5.789834105929476e-01   +2.861179229694613e-01   +1.705033287836003e-01   +5.191841333601654e-01   +5.488780237642186e-01   +5.500407796012621e-01   +2.130915527852569e-01   +4.651361817911256e-01; +4.672013818559590e-01   +5.132329782887023e-01   +4.193075284985844e-01   +1.653089658845218e-01   +2.532503194221601e-01   +3.963825402259270e-01   +5.324042338570267e-01   +1.291348618566157e-01; +1.208437661566734e-01   +1.432595289102556e-01   +1.567547861804028e-01   +1.805642043027113e-02   +4.691637118775651e-01   +5.680440991449689e-01   +6.192953080208279e-02   +3.635876656649146e-01; +2.260857824012404e-01   +4.643040014078560e-01   +3.961890324199270e-01   +3.667746207618293e-01   +3.547392487036289e-01   +3.600708424308636e-01   +2.901352759942089e-01   +4.723846726545364e-01; +1.829003226087130e-01   +1.100969072920961e-01   +3.538806068356403e-01   +3.355389707686329e-01   +2.596021021162089e-01   +4.570830955619700e-01   +2.963518992155263e-01   +3.517885743510575e-01; +4.647665310994683e-01   +4.258341895874553e-01   +5.337999413952770e-01   +2.429895270563187e-01   +1.711715002030937e-01   +4.144472811594190e-01   +5.409549496936816e-03   +4.006809026792630e-01; +8.841135016808137e-02   +2.145481055016734e-01   +2.264134503492122e-01   +1.385804417032235e-01   +4.076636322575737e-01   +1.623631201295851e-01   +1.337429529267962e-01   +3.950935615203267e-01; +3.460269492374261e-01   +2.023622815105997e-01   +4.621808655419642e-01   +2.314051574843201e-01   +1.602364813936677e-01   +4.081469041035631e-01   +2.655542480274027e-01   +1.775318043730235e-01; +2.403117160369460e-01   +4.169373083421403e-01   +1.169365226032202e-01   +1.381563025920307e-01   +1.894844514122373e-01   +9.908819515533007e-02   +2.461844190061803e-01   +5.649101972619676e-01; +3.136235609623114e-01   +4.040160576639201e-01   +1.240444602244959e-01   +3.227291319729205e-01   +1.032957538192059e-02   +4.092201696335819e-01   +5.314836941076565e-01   +4.111805325280837e-01; +3.031841321772008e-01   +4.633648787081607e-01   +4.935275479191425e-01   +2.162661610284332e-01   +4.179628172104406e-01   +5.767668261288585e-01   +1.106299575386720e-01   +1.648740251539483e-01; +4.678082252705754e-01   +3.104412807696389e-01   +3.622619096719793e-01   +2.487092863616935e-01   +5.708391911488193e-01   +1.599368574159830e-01   +3.713360790251966e-01   +1.909619402256850e-01; +1.812383590338520e-01   +5.625393571742725e-01   +5.407213848905728e-01   +1.191568072985903e-01   +3.301204153395297e-01   +1.739010926603166e-01   +1.864221002947081e-01   +2.957826837200169e-01; +4.091563810031930e-01   +1.496937152272259e-01   +5.818896156353177e-01   +3.074719459234428e-01   +4.864157771628658e-01   +1.096352205244819e-01   +5.676783725755347e-01   +1.311247565649868e-01; +5.619462043349474e-01   +1.278512987587441e-01   +1.633867354196473e-01   +5.330519282916097e-01   +3.874567982705374e-01   +8.071903598585654e-02   +2.337660498856906e-01   +4.086791132012266e-01; +1.105133771686793e-01   +4.070682137977953e-01   +4.246052070981835e-01   +3.648707508039445e-01   +4.875890451117146e-01   +7.436043884260971e-02   +5.745194789613969e-01   +1.776581080675194e-01];
L1I_L2I_iGABA_netcon = [+3.337961402408764e-01   +4.043355371683407e-01   +1.819848486327337e-01   +4.335149119208297e-02   +2.983342031841718e-01   +2.343126363881064e-01   +5.782384659854511e-01   +4.016693266941745e-01   +2.397483583715725e-01   +4.583051756791214e-01   +8.712759662086063e-02   +1.835896022993750e-01   +7.390325332449342e-02   +5.993037414709613e-04   +1.186356199428481e-01   +4.628368885316084e-01; +4.701219657783731e-01   +3.502353327993982e-01   +2.182157562485177e-01   +2.703687470674846e-01   +5.427543278108599e-01   +2.680566135622263e-01   +3.970555590838238e-01   +5.679956703745040e-01   +2.512297741274027e-01   +5.818940972695466e-01   +3.919692185150621e-01   +2.089670464142822e-01   +2.916051683584245e-01   +3.640159866619275e-02   +2.135339286168860e-02   +5.190392851714825e-01; +5.006613541783509e-01   +3.445358409726231e-01   +1.277799834041917e-01   +4.806548150406639e-01   +1.937038847935696e-01   +5.121479040909936e-01   +4.485297789635661e-01   +3.885749513029253e-01   +2.203979060076626e-01   +2.146015948972929e-01   +3.982108676729540e-01   +2.337508415797162e-01   +1.938605923717241e-01   +9.678703576126547e-02   +3.602034993776128e-01   +7.708923519960746e-02; +2.470008638873752e-01   +3.066509042748412e-02   +3.502677291814111e-01   +5.117104767602543e-01   +6.350062269305627e-02   +8.060526054066823e-04   +2.069521220804480e-01   +1.994686975263897e-01   +3.390957478443261e-02   +3.791751978136759e-01   +3.291625690942172e-01   +2.770453890768318e-01   +1.482869973021496e-01   +3.195192168639223e-02   +4.720626359211951e-01   +3.082842827135658e-01; +4.621450811697478e-02   +4.788910818370870e-01   +4.656770769193447e-01   +3.952737037318403e-01   +3.699331552406259e-01   +2.920506283928526e-01   +3.740086209360473e-01   +4.915711651451042e-01   +3.629013732443284e-01   +1.278035802162504e-02   +1.799540603672304e-01   +1.347039758848140e-02   +1.460908388297829e-01   +5.155473173741809e-01   +1.204294053635488e-01   +2.780300130514312e-01; +3.724938905848101e-01   +4.139908948409592e-01   +7.680856721812380e-02   +5.265713276982257e-01   +3.278233560881438e-01   +5.688530955286875e-01   +4.307853121180233e-01   +4.813913217515984e-01   +3.252640782368473e-01   +3.433986278119185e-01   +5.885766730256210e-01   +4.845232042027200e-01   +7.709918143434438e-02   +5.377675304366512e-01   +4.174120382036969e-01   +5.331632185857474e-01; +4.543000172914056e-01   +8.991831079318087e-02   +5.056160320732211e-01   +5.803210687893007e-01   +2.257252928689898e-01   +5.766554871452257e-01   +3.003958657141643e-01   +2.758136157754972e-01   +6.123465461124761e-03   +3.441939614333909e-01   +1.809122780496477e-01   +2.050664990360166e-01   +4.586965760837844e-01   +2.469016783216474e-01   +4.990257026163950e-01   +3.359647058538929e-01; +4.391519069590273e-01   +6.379145713484720e-02   +5.295477884812446e-01   +4.217289957165013e-01   +6.815967357279425e-02   +4.678520844354782e-01   +3.469637371608317e-01   +4.542985750423469e-01   +2.159798587557068e-01   +5.007628245687684e-01   +1.540955157026366e-01   +2.891938708954432e-01   +2.927186998974691e-01   +4.074812773304725e-02   +5.453237565501019e-01   +2.744853951795790e-03];
L2E_L1E_iAMPA_netcon = [+4.597876479137482e-01   +1.685693528663346e-01   +8.889097837224684e-02   +5.801635139867408e-01   +3.932197632145076e-03   +2.844524505744072e-01   +3.890381126015663e-01   +4.559880696141838e-02; +5.421907307989089e-01   +5.131230988297542e-01   +3.108765663512168e-01   +2.167609736722318e-01   +2.972419285764265e-01   +1.062116276824634e-01   +5.361816160744516e-01   +2.348007909744063e-01; +5.223645335801454e-02   +7.812174439516974e-02   +1.924525210064290e-01   +9.338496450656292e-02   +3.693304250190843e-01   +5.000658944387609e-01   +1.971096582686368e-01   +1.853718566071818e-01; +1.513992078414457e-01   +4.289454973883495e-01   +1.252685511290773e-01   +3.854532051461921e-01   +4.465138384002536e-01   +1.849185422048796e-01   +5.203879432283257e-01   +4.893795279256355e-01; +1.158882103638490e-01   +5.798613380583552e-01   +8.239759765316196e-02   +1.593140956579884e-02   +5.567345595988191e-01   +5.597457289282892e-01   +4.034023282674423e-01   +2.745128263699165e-01; +4.112519387949402e-01   +3.019347453390747e-01   +5.601725316171210e-01   +4.581583101104989e-01   +4.116979056315873e-01   +1.301413417199260e-01   +4.693335478592515e-01   +4.054037766096710e-01; +6.312862837544087e-02   +1.982685766651784e-01   +1.726521643065261e-01   +2.724536960366959e-01   +5.426801432192406e-01   +2.751115419712031e-01   +9.510786715479852e-02   +2.017692686233134e-01; +3.944198402138840e-02   +7.564961055647726e-02   +3.123089177451759e-01   +3.985848087982509e-01   +2.347830185034614e-01   +5.344246404954269e-01   +5.733617283637336e-01   +5.379384387068016e-01; +2.066490924970760e-01   +5.215425150322920e-01   +2.547799264129119e-02   +1.600106635580968e-01   +9.720029293916428e-02   +5.674018525681485e-01   +3.125300117337492e-01   +4.274730796139756e-02; +1.762776800327865e-01   +1.641617523910602e-01   +5.081297443961349e-01   +2.436196834105426e-01   +4.818829622067825e-01   +5.162986258773510e-02   +7.609044346269141e-02   +5.678595132498165e-01; +3.346811995783415e-01   +2.768179071083005e-01   +1.087679382357220e-01   +3.571905141081113e-01   +2.396278994592426e-01   +2.435373641990097e-01   +3.444968405250836e-01   +5.289478115119405e-01; +1.542935346510229e-01   +2.671997554221635e-01   +4.848736570411475e-01   +4.339414360262057e-01   +3.795730262477414e-01   +1.106076357119790e-01   +5.855457951149402e-01   +1.395877210692019e-01; +3.544237127813492e-01   +4.885659194933038e-01   +1.449090750362396e-01   +3.441687087281419e-02   +5.776739150683852e-01   +3.924688796033214e-01   +2.743172889210500e-01   +4.785938398863158e-01; +2.506837665603088e-01   +2.960081797198098e-02   +6.546128970674132e-02   +3.939396346198319e-01   +5.483686855088366e-02   +1.761535232095229e-01   +4.693737869193303e-02   +4.358962245109573e-01; +1.643116506230005e-01   +1.218077946598956e-01   +3.698659103578952e-02   +4.498493835368972e-01   +6.982147002154199e-02   +5.506687207631143e-02   +2.434684003068894e-01   +1.389806068665284e-01; +8.844150325118366e-02   +2.591516479705746e-01   +8.300787073869612e-02   +3.180942893204272e-01   +1.508357706435100e-01   +3.246411339057869e-01   +6.330139255851637e-02   +4.832679469522176e-01];
L1E_L2E_iAMPA_netcon = [+2.165985598072424e-01   +9.386989973610274e-02   +5.519089539679294e-01   +5.718385464754077e-01   +1.975295379549398e-01   +5.575435466887657e-01   +2.995295192140258e-01   +5.866712597937767e-01   +8.265081001929506e-02   +3.808808871466726e-01   +3.785000027896536e-01   +4.510786836813389e-01   +2.201679761380451e-01   +4.006131569604391e-01   +3.342885426456831e-01   +2.940141225207008e-01; +2.295227502713205e-01   +3.048050286725390e-01   +1.288629485748811e-01   +5.042004763404791e-02   +3.675505654564809e-02   +4.071250406010782e-01   +4.997215865760134e-02   +1.854606470267009e-01   +1.225761782464944e-01   +1.871868425898934e-01   +1.629024636587871e-01   +5.599312250775604e-01   +8.606180803780944e-02   +1.665573069494431e-01   +3.488540635275023e-01   +1.455098124231081e-01; +1.928824772409178e-01   +3.553170755765839e-01   +5.331537412823699e-01   +5.461517760047596e-01   +5.630695802061511e-01   +6.698923487668269e-02   +1.738238470777430e-01   +3.085321627976443e-02   +2.588329085737363e-01   +3.416606579454565e-01   +2.009230911507524e-01   +6.359489952938767e-02   +4.436891806635404e-01   +3.516518294090671e-01   +5.234896281165895e-01   +4.216567641674414e-02; +4.663991523546691e-01   +1.768886650343644e-02   +1.324178082834797e-01   +1.260414132318797e-01   +4.320996371324488e-01   +1.878437418686714e-01   +5.348994611315411e-01   +5.285489113270783e-01   +4.563039808483255e-01   +4.467301171794704e-01   +2.783828538504663e-01   +3.309482729557391e-01   +5.547176166015628e-01   +1.965639754092625e-01   +5.392247421557385e-01   +5.734638950743517e-01; +7.792354060724573e-02   +5.062140556665604e-01   +5.105545788699800e-01   +1.583343234687654e-02   +9.603522711216005e-02   +4.788010874912245e-01   +5.511545359049049e-01   +1.054118371445215e-01   +3.380245358230041e-01   +2.465466449417695e-01   +3.252734090693558e-01   +4.550652841680349e-01   +1.397283716539048e-01   +3.086742388750190e-01   +5.837982074810443e-01   +2.545883516971716e-02; +2.207631264201690e-02   +5.009395991335446e-01   +1.558192428514449e-01   +4.789441990649760e-01   +5.700687675095520e-01   +5.019392870295802e-01   +3.072811856969017e-01   +5.485757205805163e-01   +1.929982459151725e-01   +2.376977853779755e-01   +4.957373475611123e-01   +5.413738019881439e-01   +4.997668452865949e-01   +3.677151813576444e-01   +1.145802703170834e-01   +3.401222248500518e-01; +1.848510689616647e-01   +1.328497850776214e-01   +3.451094557690993e-01   +1.178723509708710e-03   +2.281276633417178e-01   +3.086686045148833e-01   +4.404904694263107e-01   +3.505723161398442e-01   +3.431110786292341e-01   +4.641894336220849e-01   +3.734862975914208e-01   +6.051740851043566e-02   +2.116767528990626e-01   +3.254347302716036e-01   +1.420915115466931e-01   +2.061923981467128e-01; +4.946341159793995e-02   +3.250689698972751e-01   +2.927645762410836e-01   +2.350129457973983e-01   +4.305562498336496e-01   +5.713784251872921e-01   +5.843353385237638e-01   +3.765708435359230e-01   +5.152919400645057e-01   +2.361022976058481e-01   +2.044790512087700e-01   +5.813275587483017e-01   +3.978222044278896e-01   +5.349163261088399e-01   +1.999526864814590e-01   +6.248155667964485e-02];
L2I_L2E_iAMPA_netcon = [+3.682168970761605e-01   +1.361960909974936e-01   +5.318207429973592e-01   +2.796890450530292e-01   +4.615646271426461e-01   +2.540459824549039e-02   +4.861322503518300e-03   +5.290235977534868e-01; +9.432246052603072e-02   +7.471153404600037e-02   +9.376952635422008e-02   +5.064829792624004e-01   +4.483172603361021e-01   +2.355597110142408e-01   +4.149793233864133e-01   +2.849523502154392e-01; +5.005232046787450e-01   +4.429452569496859e-01   +4.933764599324192e-01   +4.348725833083073e-01   +3.072665636433500e-01   +3.030866424402236e-01   +2.984003413098050e-01   +4.189152896677528e-01; +2.325909350346673e-01   +1.002969362340013e-01   +5.245462968468320e-01   +2.512986608312992e-01   +5.650365160862916e-01   +9.193344837063500e-02   +2.707380069353448e-01   +5.087352442992240e-01; +4.156384556622115e-01   +5.090247715158771e-01   +3.775451103586600e-01   +3.587552707136373e-01   +5.469560042096978e-01   +4.406140760858009e-01   +2.476293419995115e-01   +4.399355206329638e-01; +3.577450955187829e-01   +2.437122274889335e-02   +5.289362768594252e-01   +4.371632843333225e-01   +3.166595719487727e-01   +1.089110656863062e-01   +6.582857319821166e-02   +4.325748478657624e-01; +5.646668605737402e-01   +2.682490938063876e-01   +9.953162298031755e-02   +2.793067122720808e-02   +8.124327537584645e-02   +1.286740606728660e-01   +8.495900388053185e-02   +1.029023306064914e-01; +5.391639062193783e-01   +2.064360066678234e-01   +3.229346652642979e-01   +2.862585336714115e-01   +5.163626348979123e-01   +1.395729186903349e-01   +7.285187625902971e-02   +1.367199820048679e-02];
L2E_L2I_iGABA_netcon = [+5.452458094204566e-01   +1.413709105604816e-01   +1.190423457061981e-01   +1.154493603722455e-01   +3.921217457827776e-01   +2.197561408442388e-01   +4.847811932862096e-01   +5.564698274151416e-01; +1.496431152489089e-01   +2.532513278616114e-01   +7.440270390410134e-02   +8.105892844067713e-03   +5.859083868180408e-01   +4.106863942316258e-01   +4.516392024433468e-01   +4.296913982602723e-02; +3.839631141754491e-01   +2.102612376263925e-01   +3.239807353365667e-01   +2.523007850829556e-02   +2.298111330552877e-01   +4.598974541694762e-02   +5.849953842167434e-01   +4.934819799579045e-01; +5.129858689597456e-01   +4.132632973527505e-02   +1.512369187404172e-01   +4.363451188210256e-01   +5.445692426824335e-01   +3.838741484260964e-01   +2.550078534012059e-01   +3.951222967900002e-01; +9.564302486244375e-02   +5.361382865069456e-01   +3.800763332283939e-02   +4.957240858954942e-01   +1.829581279022142e-01   +2.176403519512295e-01   +2.350680886277137e-02   +1.600507699691523e-01; +4.469749925134171e-01   +1.028268057345089e-02   +3.250034262173028e-01   +4.670806648873919e-01   +5.225290050529273e-01   +1.562310889516145e-01   +5.661868548237179e-01   +4.632596690882589e-01; +9.493059364476793e-02   +5.761559209994480e-01   +1.717559030608876e-01   +2.038839627535354e-02   +4.254918452302832e-01   +3.128288889202127e-01   +3.571286476445557e-01   +3.667420322784707e-01; +5.153391017398279e-01   +1.807415676366459e-01   +2.920197259880133e-01   +1.216887221214166e-01   +2.758895203917627e-01   +4.633888291043892e-01   +5.587725357427195e-01   +3.622744619395161e-01];
L3E_L2E_iAMPA_netcon = [+2.102163598834187e-01   +3.758050613109234e-01   +9.132098052287338e-02   +4.927449597444228e-02   +7.328132480880165e-03   +5.812350424790504e-01   +2.295555360498841e-01   +5.073398738782535e-01   +7.055165954062384e-02   +1.738300562207952e-01   +1.726194745610613e-01   +2.898006127669611e-02; +1.574815291954660e-01   +5.244930380445122e-01   +1.725739318205857e-01   +2.221845609305890e-01   +2.740888642803638e-01   +3.305956036018698e-01   +5.399522854026798e-01   +5.825562079745716e-01   +3.297016127006654e-01   +5.702153935965454e-01   +2.090698171438757e-01   +1.534498073932032e-01; +6.040971529051331e-02   +4.382754337116604e-01   +6.459610863809578e-02   +4.353932273876025e-01   +1.502915734155758e-03   +1.477802266489319e-03   +3.166646110396235e-01   +5.797184331161354e-01   +3.514128891306931e-01   +3.622122882393032e-01   +1.462549040022240e-01   +4.193676313735523e-01; +1.904190233931008e-02   +1.201009323583072e-01   +4.802133383118928e-01   +1.540472321870551e-01   +1.623666777294899e-01   +7.965721088058795e-03   +1.992437331542398e-01   +4.053392035780271e-02   +1.280229189292680e-01   +1.841278856181851e-01   +1.169675838023308e-01   +1.975241363789248e-01; +5.341890632637873e-01   +2.168534321535474e-01   +2.049064541760149e-01   +5.868685104478329e-01   +3.974942240466899e-01   +2.182517471055938e-01   +5.774890267092431e-01   +9.574579841571131e-02   +4.969912693729401e-01   +2.862443143720131e-01   +4.037497240586200e-01   +2.415202742890946e-01; +5.196773542476919e-01   +3.505760690012897e-01   +6.382279859769741e-02   +2.904922488750016e-01   +3.736114276098505e-01   +5.373102549984858e-01   +5.228128285573114e-01   +2.236514412333423e-01   +2.714950504274978e-01   +1.158020807031128e-02   +3.730199755892151e-01   +1.463074060477915e-01; +3.661102075173701e-01   +3.012604529820230e-01   +3.722279076820610e-01   +1.209307038176758e-01   +3.608692031047857e-02   +2.133029520026958e-01   +5.111892264152240e-03   +2.023997855853752e-01   +1.668706392659791e-01   +6.030543385555233e-02   +6.463787760084824e-03   +2.742404937269051e-01; +4.973905195242301e-01   +5.621342490598585e-02   +5.188621819124288e-03   +1.573643383875606e-01   +3.244200468225086e-01   +5.531715154881582e-02   +1.741816145149875e-02   +2.849859939368620e-01   +2.921682668831039e-01   +5.049817697903169e-01   +5.161061541310014e-02   +3.594825701078866e-01];
L3I_L2I_iGABA_netcon = [+5.787583891339572e-01   +2.965537855445338e-01   +3.823264415025302e-01   +1.645584579731302e-01   +5.590857797697067e-01   +2.631578624068812e-01   +3.107393661182356e-02   +1.029112568552231e-02   +5.164380488297284e-01   +2.666132632910310e-01   +5.439124352338989e-02   +4.376805127834181e-01; +5.269647961352357e-01   +5.689216395571601e-01   +5.272526473168235e-01   +9.736340760924030e-02   +3.046432082500479e-01   +4.943719019571299e-01   +3.690100007751521e-02   +1.251402015946112e-01   +2.938657572697340e-01   +3.906411460619679e-01   +6.836057437344868e-02   +3.807912187168832e-01; +6.263513324860655e-02   +5.080858044711937e-01   +5.285350341179880e-01   +6.359891318697204e-03   +4.189639044512098e-01   -1.349181262439495e-03   +3.680426219663600e-01   +5.465433718422794e-01   +4.281673818100382e-01   +1.328518132154069e-02   +3.497892605951572e-01   +6.855996546387183e-02; +5.686495004117890e-01   +1.398352808799727e-02   +1.855065336782560e-02   +3.824741910962594e-01   +5.287158122151673e-01   +3.250934117517884e-01   +2.217354430344410e-02   +8.460715347319278e-03   +5.119408300231264e-01   +4.869722141518239e-01   +5.843160563581246e-01   +3.247183453515148e-01; +9.289766469374748e-02   +5.692248823363348e-01   +2.426012466620400e-01   +2.499544757441407e-01   +3.380598045946825e-01   +5.468045919202756e-01   +2.300977528168900e-01   +1.052118046713759e-01   +5.921860410307200e-01   +2.945897810720109e-01   +1.311740968433413e-01   +1.038997747288704e-01; +2.283901080423074e-02   +4.070982312342832e-01   +1.229810284359525e-01   +8.001481334407578e-03   +1.002422614459084e-01   +3.826628295630922e-01   +4.115782707268964e-01   +1.400847634905077e-01   +3.093014800473821e-02   +4.486272932961826e-01   +5.129246424787427e-01   +4.502341275699306e-02; +3.740995404793191e-01   +5.199817007012928e-01   +3.437855212766888e-01   +3.813738279092172e-01   +2.633412642843965e-01   +1.797466166272273e-01   +4.147959795309571e-01   +3.222675343804699e-03   +4.936637202942073e-01   +2.245900744998911e-01   +2.972789515245871e-01   +4.282077452165052e-01; +2.918711545623092e-01   +1.257104521143289e-01   +1.812000542102499e-01   +3.407801089184933e-01   +2.057393963987464e-01   +8.203910502203321e-02   +1.355161785938984e-01   +1.613973961053816e-01   +3.263525316122113e-01   +5.773320059275786e-01   +1.650076302083154e-01   +1.719050484502407e-01];
L2E_L3E_iAMPA_netcon = [+3.973230732520652e-01   +3.934120636426268e-01   +1.336700306119191e-01   +5.134816746428449e-01   +2.926789053883824e-02   +3.040195635858517e-01   +3.972764807847026e-01   +5.545869743502608e-01; +3.184745301898007e-01   +4.344831279410192e-01   +4.341490189499117e-01   +4.760602085619607e-01   +6.546228217080399e-02   +2.964132257015017e-01   +5.068756991468496e-01   +4.094177367583901e-01; +5.032268640070152e-01   +5.205334314003189e-01   +5.025649987448152e-01   +5.361514491546361e-01   +3.434759553374688e-01   +3.870258618220577e-01   +5.134533637572163e-01   +3.435490778128927e-01; +2.439818941432812e-01   +5.667906885305179e-01   +5.029720393443925e-01   +3.610373600820718e-01   +3.043347952267594e-01   +2.932951462402695e-01   +1.655977733484054e-01   +1.076786904783768e-01; +8.442494670655054e-02   +3.250522309264751e-01   +1.462712010682617e-01   +4.884615972386751e-02   +1.073944358506486e-01   +3.232842977674644e-01   +5.268635292559816e-01   +4.500024925125588e-01; +2.932397462259052e-01   +5.814787336350203e-01   +5.275142996198552e-01   +3.190282354511313e-01   +3.049623105923697e-01   +5.787737679142394e-01   +4.216036110769449e-01   +5.789365733721913e-01; +2.857105254877759e-01   +6.093359620460190e-02   +3.142934448703656e-01   +1.589706190806953e-02   +2.096583449235806e-01   +4.835659299592944e-01   +2.059428873393407e-01   +4.596588627734544e-01; +5.513741847543964e-01   +4.097540605252606e-01   +2.547158010124116e-01   +4.595294329715416e-01   +2.066490920066814e-01   +4.553035652882402e-01   +3.057117630674533e-01   +2.560122125435778e-01; +2.762490567627685e-01   +3.243377088761548e-01   +5.207352533270823e-01   +3.705236604218692e-01   +3.383221441370972e-01   +2.055658307595301e-01   +3.567465925553104e-01   +3.906161824716069e-01; +1.670351992249996e-01   +9.467330264099814e-02   +4.626889508710602e-01   +5.168330532067998e-01   +5.311985216833217e-01   +1.382998709942509e-02   +7.908499863663600e-02   +3.836359067131287e-01; +3.423730215740350e-01   +1.897857409831138e-01   +4.352002887693792e-01   +4.796028934087471e-01   +5.528947033619758e-01   +5.640615128298699e-01   +1.557203152054540e-01   +2.202253069150256e-01; +5.634444651395711e-02   +3.461771999681869e-01   +2.451706086852517e-01   +5.115386018044608e-01   +2.904582953683330e-01   +1.215349496243025e-01   +3.927348988975917e-01   +5.052008772093639e-01];
L2I_L3I_iGABA_netcon = [+5.580795556391247e-01   +2.346783406370514e-01   +1.661904732570998e-01   +4.202898085182253e-01   +4.359018398411339e-01   +4.955057878371664e-01   +2.283049985590325e-02   +3.053332998610559e-01; +3.247485487569019e-01   +2.795364803723273e-01   +4.160035380224836e-01   +9.799447356937935e-02   +5.204871931940805e-01   +4.851603968450565e-01   +2.791404436901711e-01   +1.508588791142511e-01; +4.640160914558876e-01   +4.333722053253130e-01   +5.550876737094247e-01   +3.708319331633112e-01   +2.138108344960404e-01   +3.620668507632139e-01   +2.385842042120914e-01   +1.024257756085949e-01; +1.288585839292787e-01   +4.948260590947612e-01   +1.269595560036931e-01   +2.924944332715224e-01   +1.792639140158710e-02   +2.146247344139431e-01   +2.193334204859786e-01   +5.778794747074132e-01; +1.826696560413856e-01   +2.304375140868345e-01   +3.123886310615603e-01   +2.818655633741987e-01   +2.110252813339274e-01   +3.814760848645797e-01   +5.539332775896094e-02   +7.705943468644749e-02; +7.469738863969271e-03   +1.481053814032747e-01   +2.578189825507564e-01   +1.050994264341456e-01   +2.137012717043477e-01   +2.333339996363515e-01   +3.123510630327817e-01   +4.155814017720592e-01; +2.126410412280960e-01   +2.798212818982700e-01   +5.501908556078176e-01   +3.784428773568146e-01   +4.306550737520878e-01   +1.777959816550692e-01   +1.893601030490230e-01   +1.797593999889284e-01; +1.942457747265437e-02   +5.814247699452011e-01   +1.851953639766371e-01   +5.195687187568967e-01   +4.011569739128443e-03   +4.462435422461003e-01   +3.371614288481604e-01   +4.481178524020288e-01; +5.234612527567951e-01   +1.721235965487051e-01   +4.969363526405983e-01   +3.879053077273274e-02   +2.899748844062670e-01   +1.538791594823325e-01   +2.443463935590973e-01   +2.643192049623446e-01; +4.558597617864581e-01   +2.945241440177828e-01   +1.462790629787297e-01   +2.959806125877127e-01   +3.684484243524870e-01   +2.028106683029479e-01   +1.282972196575252e-01   +1.832119621414221e-01; +4.254735361499474e-01   +5.729850468937835e-01   +3.177115072530529e-01   +4.043481628155303e-01   +1.706923234396454e-01   +2.081265110988302e-01   +5.583795262405101e-01   +7.417475762572052e-02; +4.512635047243525e-01   +2.745961038260496e-03   +1.983136015394293e-01   +8.577635978324197e-02   +8.746032636819381e-02   +5.710969604362218e-01   +2.895239357392239e-01   +3.246561032654295e-01];
L3I_L3E_iAMPA_netcon = [+2.650834716066319e-01   +5.863243250698699e-01   +1.653132101016173e-01   +3.622976398728430e-01   +4.576177695432330e-01   +1.876813368263778e-01   +1.689179903917722e-01   +1.357844994414173e-01   +1.978178395334486e-01   +1.660045081324127e-01   +1.572982549813262e-01   +2.848329374950550e-02; +2.407927938776593e-01   +5.060317165786825e-01   +1.326802512902280e-01   +7.944551088540673e-02   +5.046067321497941e-02   +3.186253741003455e-01   +3.301841913908583e-01   +3.241218546222229e-01   +1.351993794935703e-01   +2.850074828374831e-01   +4.469623768491467e-01   +3.357030557019892e-01; +1.887752424468422e-02   +3.672242760661307e-01   +2.692895105724549e-01   +3.496701408233522e-01   +2.869948391776095e-01   +2.686947649638827e-01   +2.953615581009298e-01   +2.734435073864758e-01   +2.004917523685553e-01   +3.395061289641469e-01   +2.719022151252083e-01   +3.277564249380353e-01; +2.316947488467461e-01   +4.376598446953298e-01   +3.709314909765811e-01   +2.530836658912310e-01   +2.637818612181977e-01   +5.275490494376568e-01   +4.533466082097956e-01   +7.350070014671747e-02   +5.398258706713548e-01   +5.379054520311032e-01   +9.797671782682206e-02   +4.349087562492736e-01; +6.356767226453011e-02   +1.946496284327706e-01   +2.137140207274391e-02   +5.111096296073975e-01   +4.500389947543457e-01   +3.233842777787498e-01   +5.619444927167607e-01   +3.081955108797254e-02   +5.221695398074593e-01   +3.361372727407694e-01   +2.232621674228538e-01   +6.497571030060154e-02; +1.983660771608121e-01   +3.932131543252917e-01   +4.911628486466234e-01   +2.544120586287233e-01   +5.797437664392324e-01   +1.658243133237834e-02   +5.328017624304354e-01   +1.461390780923054e-01   +4.018841027144951e-01   +1.529081106876158e-02   +2.039755080850979e-01   +8.988171106949160e-02; +4.847807965232938e-01   +2.202216919933021e-01   +2.336957964424738e-01   +1.656691114386152e-01   +3.967460787178733e-01   +1.151120720968628e-01   +3.347730837688928e-01   +5.448068052236680e-01   +4.942258216205281e-01   +5.783085957790886e-01   +3.101327668241677e-01   +4.178585251770499e-01; +4.322233010006251e-01   +1.252254136993732e-01   +4.304322529926916e-01   +3.486537511906001e-01   +5.830464894061340e-01   +3.496082956330475e-01   +5.923667619048020e-02   +2.883110984308792e-01   +2.534428937805306e-01   +1.709494295516752e-01   +1.444433568987473e-01   +5.643609968786174e-01; +5.547937056209803e-02   +5.000298555828685e-01   +4.374591384698988e-01   +4.768082190977590e-01   +2.185510430691610e-01   +4.289753374477317e-01   +1.080399071518612e-01   +4.588309262918180e-01   +4.926732218777341e-01   +2.704024312493174e-01   +1.262046291091202e-01   +1.434106823644769e-01; +5.417742337959739e-01   +4.577719242279396e-01   +2.359789238824688e-01   +1.408110884074767e-01   +3.367676410701244e-01   +4.582396223092411e-01   +2.964988533359811e-01   +5.177173564622404e-01   +3.910154623038044e-01   +2.060729512797561e-01   +5.237269626684574e-01   +1.247842388256782e-01; +2.647852090966153e-01   +2.034343062158904e-01   +5.819762804203945e-01   +5.601787415447976e-01   +6.650580129095924e-03   +3.693830868417016e-01   +4.933580623025906e-02   +1.486841474784902e-01   +2.225428160279438e-02   +5.655131543030246e-01   +4.552704003554680e-01   +2.114065828137028e-01; +6.573467295915927e-02   +1.058270866549215e-01   +1.622305201681157e-02   +2.704394279618599e-01   +2.573017550159936e-01   +1.388794318621798e-01   +4.632011062768417e-01   +1.213076668129183e-01   +1.925901270441751e-01   +1.449140827538893e-01   +4.582510109961215e-01   +1.597225049517432e-01];
L3E_L3I_iGABA_netcon = [+1.149160513838109e-01   +2.659747874892220e-01   +1.947849521983267e-01   +5.461329796061629e-01   +4.831273763019248e-01   +3.277952171705511e-01   +1.837119391698418e-01   +4.516466371619792e-01   +3.822492102277250e-01   +4.408247157577015e-01   +3.514091510857071e-01   +1.368434551783335e-01; +4.600673787191840e-01   +3.702309035315902e-01   +1.761911068265740e-01   +1.449910844024555e-02   +2.204207253232468e-01   +4.176732547098932e-01   +3.943001886981229e-01   +5.772482497423854e-01   +5.043896729662588e-01   +2.629506319053218e-01   +7.016408503214455e-02   +2.974306019457665e-03; +3.485641284773314e-01   +5.699440232084071e-01   +5.608019727110709e-01   +4.971315153518413e-01   +2.610535656460648e-03   +4.439379953381162e-01   +3.446866174969229e-01   +4.091818936488437e-01   +2.479144822663569e-01   +2.441440671165883e-01   +1.666409886799350e-01   +8.581592073290982e-02; +2.429521951116468e-01   +1.742826974980728e-03   +7.804682781368348e-02   +4.273370781979697e-01   +4.308997134601190e-01   +1.549281325191432e-01   +2.493870992848342e-01   +2.197321768328050e-01   +5.849743607087114e-01   +2.806357678801543e-01   +2.863543591706102e-02   +3.545624673883285e-01; +2.473689970467867e-01   +2.296044008591309e-01   +5.869784504153064e-01   +1.586596837840674e-01   +3.207305267885610e-01   +4.517414041677278e-01   +5.676428951314905e-01   +5.458552082678007e-01   +1.550887620104301e-01   +3.313957462233846e-01   +4.943280623035069e-01   +3.309818984364021e-02; +4.033662363093547e-01   +2.830526283200073e-01   +4.957369862535549e-01   +5.006894690507149e-02   +2.505582445921677e-02   +5.783724533874736e-01   +5.139031823385521e-02   +3.679179173378092e-02   +4.855982334952375e-01   +3.588844104323285e-01   +1.645231763654437e-01   +1.283617332290933e-01; +3.488433488449880e-01   +2.118590168601723e-01   +2.828529570488434e-01   +3.579034341838419e-01   +4.050847477099078e-01   +2.848216060415600e-01   +2.028299055099950e-01   +9.007310451557190e-03   +1.929152781630987e-01   +9.632291884863511e-02   +1.821149839302878e-01   +4.280619406036008e-01; +1.750590952965225e-01   +1.049394509153529e-01   +7.293402582542911e-02   +5.424590077596386e-01   +2.518033214670716e-01   +4.418228817916202e-01   +3.067250141053263e-01   +4.505708697360051e-01   +4.532160674893059e-01   +5.067573207657017e-01   +9.510247890474401e-02   +3.482331994361911e-01; +1.651785854681600e-01   +1.103486126373275e-01   +4.597545859506051e-01   +3.098856518370907e-02   +5.552717195704130e-01   +5.368728445336850e-01   +1.126187134659228e-01   +4.252227459485862e-01   +1.384692731005386e-01   +2.453587780298521e-01   +2.551389422811706e-01   +3.669172865469528e-01; +4.865139072825809e-01   +1.846039966453883e-01   +5.007437747218940e-01   +1.938626133620500e-01   +2.070742964717329e-01   +5.747194888077981e-01   +4.452183254992566e-01   +3.332383923720853e-01   +5.582995872916923e-01   +5.759261951987185e-01   +9.913326814820529e-02   +2.288724815096285e-02; +3.264212785957044e-01   +7.460359732025375e-02   +1.278127730573664e-01   +1.123566824681334e-01   +4.636550704002899e-01   +2.962889996779277e-01   +4.999461805789445e-01   +3.611122006411780e-01   +3.349720863680326e-01   +9.867118636104566e-02   +5.181511701825382e-02   +4.771219467061013e-01; +3.775245556671480e-01   +3.050359059249974e-01   +5.874930724837191e-01   +4.312307390624913e-01   +1.387999911223562e-02   +3.068262737489877e-01   +5.801673569886890e-01   +3.831434073540059e-02   +4.673012038212899e-01   +2.364915498374839e-01   +2.754510900749885e-01   +2.599017914345414e-01];
L2E_Input1_iAMPA_netcon = [+5.885070380260652e-01   +5.886300923149093e-01   +5.866710998472662e-01   +5.923314883775016e-01   +5.939438318800765e-01   +5.906504914069796e-01   +5.909536162415335e-01   +5.888753637038063e-01];
L2I_Input2_iAMPA_netcon = [+5.886287701654084e-01   +5.901339008183869e-01   +5.915167914862706e-01   +5.913328517116847e-01   +5.896912300819888e-01   +5.909077745600509e-01   +5.880410283693618e-01   +5.878598826631801e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
