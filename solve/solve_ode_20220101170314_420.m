function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.854790421924830e-01   -7.181912661224665e-02   +6.511201962920168e-01   -1.269936030765416e-01   -1.318160196624197e-01   +4.837494959426752e-01   +1.202012596944954e-04   +4.932190092571548e-01   -9.218049942562148e-02   +2.480178533307627e-01   +5.535496745204937e-02   +9.511385603037939e-02   +2.561987157453581e-01   -2.175122723518272e-01   +3.437096886734462e-01   +8.268216805882633e-01; +2.025127344385417e-01   -2.350958969604217e-02   +6.301869486727094e-01   +4.414852205149210e-02   +5.081916089342516e-01   +4.742222557571138e-02   -2.404888577937894e-02   +1.648480581601657e-01   +3.156943104558315e-01   +3.576678044354951e-01   +4.438253861409854e-01   +2.183984820230416e-01   +3.340835812525209e-01   +9.602184869845151e-02   +4.169997708621271e-01   +3.278607207138761e-01; +2.026700672450801e-01   +6.777871965210098e-01   -1.137527612211768e-01   +1.358414642108172e-01   -3.135470174264575e-01   +4.021928149448445e-01   +3.747944050623050e-01   -5.497171516710550e-02   -6.722623968356012e-02   +3.182638763907634e-01   +4.534496207962803e-01   +4.280557997941318e-01   +5.248874548493937e-01   +4.031626370640344e-02   +3.762430890080350e-01   +5.138388049594549e-01; +3.578481238474106e-01   +2.061569473097644e-01   +5.251801088392520e-01   -7.277544278546548e-02   +1.250079126496111e-01   +2.380182830527507e-01   +6.145308329023896e-02   -1.044519533150753e-01   +7.339160352993257e-02   +3.572634494071026e-01   -2.723270633186796e-01   +3.587780746498301e-01   -2.959720629581908e-01   -8.962761021135690e-02   +3.172226913989238e-01   -4.904240972218457e-01; +4.650575587068369e-02   +1.442423074517200e-01   +3.095514721953657e-01   +4.960339869339977e-01   -2.075066424081508e-01   -2.428590458622115e-02   -2.073665011465733e-01   -1.497974988885242e-01   -2.765938838296353e-01   +1.680901230713826e-01   -1.546812678723877e-01   -2.225100843749097e-01   -4.254992559800385e-02   +4.944544414238564e-01   +1.207057855997123e-01   +2.082473895398810e-01; +2.502954005454816e-01   +4.259929411451830e-01   +4.125346190721490e-01   +6.272888147478282e-02   +3.249933449429140e-01   +2.836718785771519e-01   +4.984659199074810e-01   -1.857198942299756e-01   -3.126263768976846e-01   -1.029744803294114e-01   +5.570674634468890e-01   +2.513866933704710e-01   -4.198644689689366e-01   +3.214533337198539e-01   -2.285279230835401e-01   -9.704360284142838e-02; -3.230854591349899e-01   +1.807734243511518e-01   -5.765043149336752e-02   +4.477766088885194e-01   +2.515228689096199e-01   -8.109424265853843e-03   -1.186905346674220e-01   +5.062536999212591e-01   +6.313423161651064e-01   +4.563315257371787e-01   +1.737375053328371e-01   +1.041243292589034e-01   +1.923254229035732e-01   -1.996259394497390e-01   +2.852993587752040e-01   +5.510827124923547e-01; +7.081042030702187e-01   +4.083878967402296e-02   +2.985734966935114e-01   +1.205827524475463e-02   -2.503013546078143e-01   +6.333958391022656e-01   -2.139469217790428e-01   +2.398842683163113e-01   +5.199436963325473e-01   +4.099451239928107e-01   -8.734975162155989e-04   -1.680248278208082e-02   +1.650431581843097e-02   +1.258115134284320e-02   +2.755509177584528e-01   +2.703071732661129e-01; +2.213101005898820e-01   +3.600899227578322e-01   +3.055450483738748e-01   +8.251921376991050e-02   -1.251352116404058e-01   -7.485061542998997e-02   -2.071198508806809e-01   +1.259569352444772e-01   -3.481030923945098e-01   +2.197724823606472e-01   +2.869990664172631e-01   +5.047801764293072e-02   +4.270657042365466e-01   -3.140478776728793e-01   +1.907608362411766e-01   +2.168412931922226e-01; -3.595474285635095e-01   -6.926544094010745e-02   +2.248694673447969e-01   +2.654358091784128e-01   -1.049863641415593e-01   +4.508402617011887e-01   +2.977472440464757e-01   +3.535412959345257e-01   +1.388154476951122e-01   +3.351771356172308e-02   +1.334200525793298e-01   +3.656299655313944e-01   -1.682204910869338e-02   +1.423395695193013e-01   -1.060824563021692e-01   -3.109363700679153e-02; -7.662795604736716e-02   -3.915592163141422e-02   +9.379480348271062e-02   +4.890701221113610e-01   +2.444840029541874e-01   +3.307412350427072e-01   +3.861370338478394e-01   +1.461701796397805e-01   -1.429592515372639e-01   -2.577374661678022e-01   +3.841002834319029e-01   -1.085186400756836e-01   +1.016216123096327e-01   +3.114356612714795e-01   +3.921232733993550e-01   +3.229555424935949e-01; +4.044984992189922e-01   -4.136329530288779e-03   +3.755987216193411e-02   -8.527980116532777e-02   -8.766169889658212e-03   +3.299849370929517e-02   +4.504056053466907e-02   +6.488610285852917e-02   +3.221225053815689e-01   +1.907433146641382e-02   +2.008531644166947e-01   +1.143410060286932e-01   +8.007527763521705e-03   +1.537406672941452e-01   +1.544806356233731e-01   -4.688666675808661e-02; +1.478355694448916e-01   -5.088498258417352e-02   -2.201618072473849e-01   -8.644027932638887e-02   -1.119789360289507e-01   +3.447045187102711e-01   +1.376631019784256e-02   +3.765719331207640e-01   +2.179633452760257e-01   +1.105821705572550e-01   -1.611353470192788e-01   +1.940740934771813e-01   +1.699137978756279e-01   +7.677466785871986e-01   +9.920827814182838e-02   +6.286870020913349e-01; -2.894541095849554e-02   -1.403650819562671e-01   -2.183744192881763e-02   -5.390040579989269e-02   +3.345161148006860e-01   +2.237844444202315e-01   +2.658349116376360e-02   -3.465624863718194e-01   -5.786557757082465e-02   +5.912151362301137e-02   +2.755386529016620e-01   +3.202747656182110e-01   +6.033129333967170e-01   -1.588178028696963e-02   -3.077395760384620e-01   -1.484285994973109e-01; +4.514725014932144e-01   +1.456530823382030e-01   +6.217387950852965e-02   +7.655128126900673e-02   +2.228970711987968e-01   +3.797579324526305e-01   +2.967162815894931e-01   -3.962747419063171e-01   +3.498162484517083e-01   +1.862128023027283e-02   +2.565958238088925e-01   +3.403042040704014e-01   +3.151699708450266e-01   +2.016696696763594e-01   -5.036064785260108e-01   +3.407023978901200e-01; +1.210671405610330e-01   +4.827978975372021e-01   +5.592522621415825e-01   +4.553218553683207e-01   -3.060098591111016e-02   +3.852173797376480e-01   -1.196215199369709e-01   +1.831251285182041e-01   -8.139504629463623e-02   -3.660552915570386e-01   +1.543802189198123e-01   +1.268872039314477e-01   +6.471334256788872e-01   +5.433994943547475e-01   -1.713507421906535e-01   +1.565680916821749e-01];
L1E_L1I_iGABA_netcon = [+5.352307882325549e-01   -6.219487545790903e-01   -7.223819193320050e-02   +2.746178431814902e-02   +3.880448555748933e-01   +5.113920791061263e-01   -9.934361995577484e-02   -4.727879081598195e-01   +7.011428197672424e-02   +3.709100126877724e-03   +1.169727873811596e-01   +1.327560695252469e-01   +1.120504817129144e-01   +9.753002951877360e-02   -1.840101109956857e-01   +1.820677795465858e-01; +2.712288694543113e-01   +6.446959155881229e-02   +7.482336659395207e-02   +1.479610436810544e-01   +2.383103270642291e-01   +8.080958749369277e-02   +5.826763731764537e-01   +1.358461019774855e-01   +2.118702782668273e-01   +2.036530174968609e-01   -8.617265690810805e-02   +2.561290500046917e-01   +8.313183920395416e-02   +1.443863749890152e-01   +4.009621769111434e-02   +2.309678037477096e-01; +1.828143545033343e-02   +6.314432213619855e-01   +2.023229194063842e-01   +1.562917013696933e-01   -5.253997740489759e-01   +1.224567078930345e-01   -2.125645190776967e-02   +2.679216322813806e-01   +4.251208951325201e-01   +4.219168172808456e-01   +1.510011451643071e-01   -3.054972243630081e-01   -3.590202641577185e-01   -8.993379696175771e-02   +1.065693934401026e-01   +4.340789841990679e-01; +4.385908841965275e-01   +5.272752060788571e-01   -3.762358872172170e-01   -1.763511993248489e-02   -1.659328202103798e-01   -2.140176442949146e-01   -4.570789862392921e-02   +3.406000154920047e-01   +4.488374576896043e-02   +2.232253849744978e-01   +1.662564336788002e-01   +3.356361418104440e-01   +2.818388266094921e-01   -2.612103438385204e-01   -4.769918369242221e-01   -1.305313462156098e-01; -1.015400551084567e-02   +1.597325262534037e-01   +7.880056505819957e-01   +4.505624164853911e-01   +2.780356264480509e-01   +4.130323234233120e-01   +2.069286188328924e-01   +1.386377862757248e-01   +1.315544276272239e-01   +4.733489915282914e-01   +2.758614636822243e-01   -1.688185623340179e-01   +2.167006704614853e-01   -3.918460602863790e-01   +9.875893645883148e-02   +9.487677974291167e-02; -1.347345982323098e-01   -2.238998566905914e-01   +9.219639848631001e-02   +4.617402914080236e-01   +6.497368734718080e-01   +1.639337111966059e-01   +7.098195503663968e-01   +2.968048768018242e-01   +3.084763198662048e-01   +1.529556904427145e-01   +4.536420836564400e-01   +6.279338288138628e-01   -4.685874903389329e-01   -3.905566298701828e-02   -1.615680401495266e-01   -6.226286598853012e-01; +3.683978286399953e-01   -1.142303870049413e-01   +2.326854022331109e-01   -4.371401012274076e-01   +4.966882790517464e-01   +1.098591218502883e-01   +2.345382924948709e-01   +4.065240799470872e-01   +1.639662400639737e-01   +1.896191564024891e-02   +3.484076417454598e-01   +5.656829325400390e-02   -3.204220041790088e-01   -5.659892011956574e-03   -1.415963775815132e-01   +3.100577752701167e-01; -2.466763885194721e-01   +6.660142215823401e-01   -3.253591146419030e-01   -7.491438498328307e-02   -1.262229420240043e-01   +3.032758339909664e-01   -1.917133964396550e-02   +1.786660958683567e-01   -2.261967455134182e-01   -1.755417063316859e-02   +5.965046180530914e-01   +2.951304768161144e-01   -2.955824414854552e-01   -1.165386191906571e-01   +5.126006472624247e-01   +1.025611826690489e-01; +1.316751421583914e-02   +1.663743746251059e-01   +2.442083453406431e-01   -2.557886579163027e-02   +1.310131997703672e-01   -1.809103724859187e-02   +8.451623725084074e-01   -1.699882443121106e-01   +3.041257669741331e-01   +1.508296173480068e-01   -3.096956869689192e-01   -2.050462414022442e-01   -8.834827245495504e-02   +2.445905398078405e-01   -1.852979502676894e-01   +1.658859302685788e-01; +5.795482818106341e-01   +1.924707931903079e-01   -5.363754429124483e-02   +1.927420556336509e-01   +3.322908275606287e-02   +1.921070921969990e-01   +2.502061522524756e-01   +2.699503839033363e-01   +5.942267567594745e-02   +2.942767425566084e-01   -2.861924551878419e-01   +4.474970774878518e-01   -1.322628420039826e-01   +5.970422224985842e-01   +2.804064198777703e-02   +1.980888934004357e-01; -1.903657022301428e-01   +6.529409730684949e-02   +2.316261224985370e-01   +1.596629838220409e-01   +2.770683384399694e-01   -1.037013502529974e-01   +1.572949062792192e-03   -1.148903741755809e-01   +2.853916945214073e-01   +1.802003765525872e-01   +3.855407566374028e-01   +8.193995808724097e-03   +3.300612944698614e-01   -6.993088766898684e-02   +3.421110518782533e-01   +3.247506587488469e-01; -1.224134696447815e-02   +2.220337401986613e-02   +1.475608255365592e-01   -2.132743231143086e-02   +2.120539552658336e-01   +1.311111994056238e-01   +4.681692082605092e-02   +1.776670067843047e-01   -2.157495143162230e-02   -1.890948098092379e-01   +2.222287894246160e-01   +1.320210267255836e-01   +3.685561912001742e-01   -3.621389910240893e-01   +2.234666582021542e-01   +6.245683166859065e-01; +3.156888774704589e-01   -1.213426210041512e-01   +7.352654309713000e-01   +3.420998422141160e-01   +1.091979018532685e-02   +6.944150201798908e-01   +1.522125255300780e-01   -4.169671347742626e-02   +3.206459762818817e-01   +4.634856288514869e-01   -3.220435214398282e-01   -7.683678126943549e-02   -1.358811497728771e-01   +1.279536524744714e-01   +1.352946696532689e-01   -2.823327185317128e-01; -1.418955824339884e-01   -9.617895200335394e-02   +4.751002175988277e-01   +3.709443784608326e-01   +6.094424312719282e-01   -3.002485430694283e-01   +9.053924648274916e-02   -2.051891071879939e-01   -2.862436999743905e-01   +2.004554216952723e-01   +3.225778046137516e-01   +6.282632697824407e-01   +2.731129032801508e-01   +3.472778488246646e-01   +6.434223533633716e-03   +7.359705043938874e-02; +3.396291303789613e-01   +7.561283617272649e-02   -3.788182593480052e-02   +3.170356863873305e-01   +4.240861402798752e-01   -1.915362184908794e-01   +1.402926901736910e-01   -3.991016481400489e-01   +4.031831205259838e-01   -9.559288812748215e-02   +9.411190277232151e-02   +3.180522415657132e-01   -3.205765491831084e-01   +4.160103826501874e-02   +3.842783954016302e-01   +1.121277669017675e-01; +1.230579210655468e-02   +3.956018861640873e-01   +1.378567191049443e-01   -3.212811772303010e-01   +2.579068879853206e-01   -4.934031178573267e-02   +5.737686730750982e-01   +3.072566654227492e-01   -1.893967188853409e-01   +4.578137206617542e-01   +1.631601265214857e-01   +2.609100850571719e-01   +1.156274178042266e-01   +6.519110074313191e-01   -8.503816772131403e-02   +4.648114102075291e-01];
L2I_L1I_iGABA_netcon = [-1.972879148073829e-01   +3.143698437561074e-02   +2.409219668086194e-01   +4.611875829353581e-01   -2.260540898757867e-01   +1.531342698709383e-01   +4.694792346630328e-01   -2.114800160305357e-01; +8.058553459167006e-02   +2.101973774787145e-01   +2.284644098671733e-01   +2.858362397201851e-01   +4.741643583254341e-01   -1.030580398240935e-01   +2.754733974087593e-01   -3.216656613024999e-02; -1.997753106559242e-01   +4.510309569201779e-02   +3.630495589150194e-01   +2.897172071237082e-01   -2.089668713067538e-04   +2.875154208168995e-01   -4.389412291242832e-01   +1.509612665696730e-01; +5.641205960039178e-01   +1.876180093649361e-01   -1.459529649102477e-01   +2.527759953772604e-01   +3.860625521437719e-02   +1.393585746015714e-01   +2.488568785955121e-01   -1.460671238512978e-01; +4.188229128137360e-01   -6.651006692015693e-02   +2.352932278019401e-01   +3.874007500806764e-01   +4.356285911526516e-01   -8.680184969199442e-02   +8.151099117186966e-01   +4.005144081000508e-01; -1.651491936029589e-01   -3.320268471979502e-01   +1.417921772068457e-01   +1.931757689098846e-01   +3.823888145931268e-01   +5.223156059357349e-01   +3.024178304183467e-01   +3.658273949076308e-01; -2.698506422348815e-02   +4.461644229268055e-01   +1.574499407055882e-01   +4.722737684511946e-01   -2.115507156961092e-01   +2.802069615905599e-01   +6.182950618042894e-02   +2.376702895928854e-01; +5.083072917178815e-01   +4.645727166235627e-01   -1.460456751923436e-01   +7.905181165351430e-02   -3.555488440840714e-02   +6.746152703028040e-01   -1.651848870023113e-02   +2.838412158495784e-01; -1.297467610288650e-01   +2.793168932265828e-01   +1.757892947800484e-01   +2.361646683180531e-01   -6.657205057746808e-03   +2.562873977890958e-01   +5.934102687414344e-01   +3.471108739751777e-01; +7.227025628786893e-02   +2.906093975802389e-02   +5.016555273424824e-01   +1.580085866335079e-01   +1.911680741525273e-01   +2.758401152129342e-01   -4.394644670494340e-01   +2.377719705690781e-02; +5.229602282468173e-01   +2.997087517759659e-01   +6.037635145515080e-02   -2.145045409217539e-01   +3.641004806148407e-02   +2.626788510678608e-01   +3.862718261784269e-01   -2.642954254580117e-01; +1.718190687540555e-01   -4.099405293780652e-01   +1.250681344341256e-01   +8.413422336984064e-02   -4.840799688845987e-01   +1.854333274119911e-01   +6.032234507629488e-01   +3.711616804241945e-01; +1.611056712193584e-01   +4.226445071288831e-01   +3.305825580537117e-01   +2.049238117037530e-01   +3.706763043702833e-01   +8.599928289678554e-02   +7.920548837701788e-02   +5.991530966375547e-01; +4.712084511238893e-01   +3.750651453910551e-01   +8.062889203738833e-01   -3.744676451575759e-01   +2.293534247594774e-01   -9.790265906849879e-02   +3.448700927715825e-01   -2.344588950537523e-01; +2.112513826131193e-01   +1.867027908018217e-01   +2.280756031645505e-01   +1.909964413916428e-01   +1.244576123651618e-01   +6.696070904910473e-02   -4.321764111666596e-02   -4.262600441481400e-02; +6.321449846753451e-01   +7.584721354956253e-02   +5.215984701137172e-02   +4.469528718849044e-01   -4.968628981979356e-02   +4.056164461420396e-01   +7.707311514353482e-02   -1.270210112636441e-02];
L1I_L2I_iGABA_netcon = [-2.057462542780963e-02   -2.621176464098049e-01   -4.929095765197558e-01   +1.862927428137490e-01   +1.100736522009475e-01   +3.050671545058596e-01   -3.861395291367162e-01   +3.357736157898805e-01   -5.025910087320365e-02   -6.420575295745041e-01   -4.649188791698211e-02   -3.244257018778343e-01   +8.680913541347146e-02   +2.756991589937419e-01   +3.391594945479199e-01   +1.045210712093144e-01; +1.688795239279387e-01   +2.776879922707555e-01   +3.064030294356948e-01   +2.040955720217573e-01   +3.444030599200293e-01   +1.884860981273447e-01   -1.506479907505971e-03   +5.535403283196441e-01   +3.561484348211610e-01   +7.063558780660920e-02   +2.527761015033085e-01   +2.538811139225455e-02   +9.524336709997702e-02   +2.670475193483437e-02   +1.838225688650840e-01   +3.266804034994318e-01; -8.371518748952886e-02   +3.305630905362238e-01   +1.569808344622383e-01   +1.813653731312463e-01   +4.316755291641428e-02   +3.443266513923551e-01   +1.450396525876312e-01   -1.623397936688780e-01   +2.975037322002365e-02   +3.260396224248493e-01   +3.319977171161967e-02   +1.661101454140929e-02   -1.343310426199060e-01   -2.353521882698932e-01   +2.000640754482903e-01   -4.121549449806824e-01; +1.924566158480671e-01   +2.243371855352391e-01   +4.618868635544796e-01   +4.564548682934648e-01   +1.546889511443312e-01   +1.424142829622197e-01   +6.991950132888156e-01   +5.578331520993289e-01   +2.650981940052351e-01   -4.246755919459430e-02   +2.906844559206506e-02   +7.252658401826978e-02   +4.591986507520632e-01   +1.878916957727452e-01   +4.074712330475043e-01   -1.962550003373180e-01; -5.102236609527054e-02   +6.836943540282402e-02   -1.619518864311107e-01   +3.225139041097187e-01   +6.528206849024952e-01   +3.444727089455611e-01   -1.627500365710637e-01   -6.323971713364263e-02   +2.462465597453884e-01   +3.680053846379067e-01   +1.530662992591411e-02   -1.643392728506821e-02   +5.055835177338290e-01   +2.107586924375774e-01   +5.048643551869715e-01   -1.524964839907170e-01; +9.175289545885552e-02   +3.134469477532152e-01   +5.891305398382387e-01   +2.963755677989172e-01   +2.025337943880400e-01   +3.313897713806084e-01   +2.419126110335109e-01   +4.949687362825417e-01   -5.839735869474673e-01   -1.825110534107080e-01   +2.039298255091078e-01   -8.246595536391223e-02   -1.123493466804882e-01   +4.029150075084686e-01   +4.911326880189349e-01   +6.398178359413054e-02; +4.042414930036932e-01   +5.590444299107641e-01   +2.113214113559231e-01   -6.671744965652066e-02   +5.980316742997104e-01   +4.171620027968362e-02   +2.704685996641031e-01   +2.932218348000055e-01   +4.207148220198011e-01   -1.756214832132365e-01   +3.104129751633827e-01   -1.973196709713442e-01   +2.675682469760560e-01   +1.033515006167823e-01   +3.134930933496535e-01   +6.671412358407441e-02; -2.307993697549966e-01   +7.867473348672045e-02   +6.098212866982515e-01   -2.952192417661648e-01   +3.089924561749516e-01   +4.962951078083569e-02   +1.579196030120865e-01   -6.777449137220178e-02   -8.055661011361728e-02   -6.241300594633654e-02   +1.747868232200319e-01   +3.419993556527874e-01   +3.222297871878183e-02   +1.376790943028783e-01   +7.212461504029425e-01   -8.148248562654452e-02];
L2E_L1E_iAMPA_netcon = [+1.062947507055439e-01   +1.533485733538057e-01   +4.642490939240859e-02   -2.653993819433538e-01   +1.533201898094108e-01   +5.724154033425791e-02   -1.631951265132788e-01   +8.823255250295554e-01; -1.146825990007473e-01   +1.165162098960133e-01   +6.094578788577814e-01   -6.744784488351645e-02   -2.921041405063995e-01   +7.061723054912322e-01   +1.759260240176107e-01   +3.191877674238681e-01; +3.958460427914369e-01   -1.332895241283905e-02   +1.302668775708343e-02   -1.122069296807819e-01   +6.714496980567124e-02   -5.679724113935402e-02   +2.146120244810618e-01   +5.361964309506517e-02; -7.245063541962285e-02   +4.777940243899996e-01   -6.165628485169317e-02   -3.286244145172233e-01   -3.668312767661814e-01   +2.886274705676649e-01   -1.428947600716781e-01   +7.830744676308678e-02; +5.173837503056428e-01   +1.691320941836444e-01   +4.199834196436779e-01   +5.881329723907483e-02   +3.806306497027900e-03   +3.938082167235034e-01   +3.756350552310922e-01   +5.315169902466509e-01; +2.279310698333786e-01   +2.451573892304854e-01   +5.500481325306261e-01   -1.742221600938534e-01   +2.226704664481077e-01   +7.041869296171168e-01   -2.303654764106202e-01   +3.476760327108099e-01; +1.828506774287649e-01   +3.865813379562765e-01   +8.030532776799354e-02   +1.587640949263699e-01   -4.684055231687564e-02   -1.204630158467793e-01   -5.306589167871398e-02   +1.722847195519336e-01; +2.848433299788761e-01   +8.408819644251102e-03   +3.678835873801437e-01   +1.988798732872447e-01   +9.270185792466890e-02   -2.716032107682508e-01   +4.132988352595415e-01   -1.881443056143992e-01; -3.027230890034652e-02   +4.025311870836671e-01   +1.890758940769825e-01   +3.972654745747223e-01   -1.090931927145591e-01   +7.842572890346234e-01   +3.905403562396198e-01   -6.275667543763225e-02; -9.522060733837327e-02   +1.348178787537804e-02   +2.726902169168165e-01   +5.715049837171645e-01   -2.620102647740847e-01   -4.621735994951912e-02   +2.723744664657743e-01   +7.721828442116282e-02; -1.192953897528797e-01   -1.800068848716216e-02   -2.200661085072136e-02   +5.923182593556867e-01   +4.084816960762873e-01   +3.766934371968176e-01   +1.080429737392690e-01   +6.993202637652757e-03; +4.322346737328603e-01   +1.377908946887516e-01   +1.813225959156257e-02   +4.626282474434528e-01   +3.646595961364505e-01   +8.290887326208299e-02   +2.883185377994018e-01   +3.373689639563352e-01; +3.980325525420330e-01   +1.334228869694789e-01   +7.129900323994502e-01   -1.975481399178197e-01   +1.889334244827239e-01   +5.679033925199445e-03   +3.695113236084050e-01   -1.411801213503177e-01; -4.013080318322872e-02   +4.754070769854656e-01   -1.734975381649270e-02   +3.041573437325513e-01   -3.638006837156962e-01   +2.397063566650222e-01   -1.223054083885054e-02   -1.517223124680847e-01; +1.843357474411276e-01   -2.822512987243233e-01   +9.881940334274802e-02   -4.844787708006751e-02   +2.977890611164594e-01   +1.472608806416038e-01   +2.856682504586023e-01   +2.244414269001685e-01; +4.904367895814332e-01   -9.682785354243309e-02   -1.763544537723086e-01   +1.395391301007120e-01   +1.885344586521147e-01   -3.664783184867290e-01   -2.668569471868457e-01   +4.370325673320614e-01];
L1E_L2E_iAMPA_netcon = [+5.980765989440132e-02   +2.145723290937105e-01   +1.060490521010190e-01   -1.088311306777378e-01   +5.476105401198035e-01   +7.203663030742535e-02   +1.322408058366142e-01   +1.732898108416032e-01   +3.980248038494437e-01   +7.028962287396743e-01   +5.108637115285980e-01   +6.587193183764208e-01   +2.902078618658396e-01   +2.375161670183179e-02   -7.397324791327987e-02   -3.156524456360932e-02; +2.244361486928893e-01   +2.937500764118088e-01   +5.302326410840703e-01   -2.521914744139649e-01   +7.717996634558447e-02   +2.390218550422223e-01   +3.338588146196578e-02   -9.206035095670050e-02   +2.440643419896416e-03   +1.642325627062450e-01   -2.899613771102774e-02   +4.480800339859239e-02   +8.286156752217752e-02   +2.435561113109694e-01   +3.179963941875946e-01   +1.598720545221820e-01; +2.514633126215963e-01   +3.546817995644355e-01   +7.636322778737675e-02   +3.894322165456876e-01   +2.525996966449308e-01   +4.078995774162419e-01   +2.226075014805064e-01   +8.904418604913522e-02   -5.862612211505036e-02   +4.510858362305817e-02   +3.393095431915165e-01   +4.733204136435960e-02   +6.993104016740994e-01   +3.278944926769268e-01   +1.335710434700099e-02   +5.534113111961980e-01; -2.239723808716176e-01   +5.602620004830602e-02   +1.577250156480305e-01   +1.184718038802273e-01   +3.536465738878066e-01   +1.951054870552953e-01   +4.985016111140618e-01   +5.940171411199091e-02   -9.528367297185848e-02   +2.224681762249324e-01   +2.940159441180576e-01   +2.453515891704889e-01   +4.085849821633327e-01   -3.912852756894376e-01   +2.909375246931505e-02   +4.964929280706380e-01; +8.659668401994917e-02   +6.151636909599899e-01   +4.596065715345360e-01   +4.969858851391517e-01   +4.192206766946453e-01   +3.009578702605082e-01   +3.092801347590112e-01   +6.132284603144105e-01   +4.998753004401552e-02   -4.501679534068092e-01   +2.257019493892048e-01   +4.135943647011479e-01   -2.937781038209217e-02   +2.951147067121471e-02   -1.349260527581928e-01   +4.507045030269276e-01; +4.355120505251369e-01   +7.771521504727801e-01   +3.201809079574058e-01   +2.565175819177530e-01   +1.175462177162466e-01   -6.016000865556634e-02   +4.730507538291033e-01   +1.481296097341086e-01   +6.008311623859484e-01   +2.686528812203152e-01   +2.117497580488416e-01   -1.134219562329866e-02   +7.143612278018244e-02   +2.869299402215866e-01   -2.077779407693506e-02   +2.951994496946564e-01; -2.862019917707526e-01   +2.359940672966634e-01   +4.305715912392271e-01   +3.735222654681868e-01   -1.000248548676496e-01   -2.823880339121494e-01   +3.703591063400059e-01   +1.951209292663397e-01   +2.509680767774618e-01   +1.376184955535686e-02   -6.433390758747511e-02   -4.874120408827530e-02   -9.015553016297567e-02   +2.133721382303168e-01   +4.917263548622203e-02   +3.814985093322910e-01; -2.867210408886233e-01   +6.837376540918408e-02   +1.152244782725795e-01   -3.083545402379330e-01   -9.390145536161187e-02   +3.353850659416487e-01   +1.769462310012523e-01   +5.964761572075845e-02   +2.476583548574137e-01   +3.653306018656830e-01   +3.482038961348923e-01   +1.799272599971609e-02   +2.301395841987172e-02   +2.472590356897427e-01   +3.049505157963901e-01   -1.437723138574070e-01];
L2I_L2E_iAMPA_netcon = [+3.279181639319932e-01   -7.192827188672979e-02   +8.630970050453201e-01   -8.686888696898401e-02   +2.751334477570516e-01   +1.289128830226391e-01   +2.989100784988628e-01   +6.831147305176188e-02; +1.534858671311115e-01   +8.359730842967766e-02   +1.291932833960005e-01   +7.796900345264984e-02   -7.941792518920787e-02   -1.059660899834380e-01   +1.357021646204968e-01   +3.985081834745668e-02; +4.451474181144019e-01   -8.578874721668836e-02   -1.341378756918623e-01   +1.468183838031997e-01   -3.249984792110295e-01   +6.502644369649286e-01   -3.260595584313756e-02   +5.863892496570345e-01; +2.289974954369170e-01   -2.515891580691699e-01   -3.983406686487803e-01   +1.218283525812605e-01   +1.299692961879028e-01   -4.987318967664612e-01   +4.506792483171232e-02   +2.625722848916057e-01; +9.588322959188100e-02   +4.172947209216239e-01   -1.304326972372089e-01   -5.399126601878969e-02   +4.010635650491923e-01   +5.581722447381110e-01   -2.172335884835614e-01   -2.034024343360767e-02; +2.778037402018640e-02   -8.345481337915588e-02   -5.293358023875965e-02   +3.094818548730238e-01   -2.267715652954932e-01   +2.131219347294290e-01   +1.532049553603416e-01   +5.065430572731048e-02; +3.384290458679683e-01   +1.226057294550411e-01   +2.737604427723591e-01   +1.420346304202316e-01   +9.035621345292043e-02   +4.968777516435492e-01   +1.326442124525045e-01   +5.004675271256996e-02; +4.664202364749996e-01   +3.374473789373430e-01   -2.576119929417694e-01   +3.880567200063559e-01   +1.993094663090200e-01   +2.590557703906687e-01   +1.824789400382528e-01   +3.557586190552910e-02];
L2E_L2I_iGABA_netcon = [+2.029063296129421e-01   -1.533534767535633e-01   +2.960614682224318e-01   +4.723893429313784e-01   -1.736183413802267e-01   +5.964146643542512e-01   +5.288532255288511e-01   +3.161026596687390e-01; +5.001050778427132e-02   +1.384107001338501e-01   +3.175500897609398e-01   +5.865490175107982e-02   +4.828116390989554e-01   +2.615497580026885e-01   +3.691862494284188e-01   -5.690629563658158e-01; +5.638809710026917e-02   -4.677311256875027e-01   +6.221828531076445e-02   -2.214668625945502e-01   -4.550634750009985e-02   -2.719916285237663e-01   +3.390326831552137e-01   +5.078319507501009e-01; +5.825054588745993e-01   +1.142379227296464e-01   -4.769261534098906e-02   -7.198947362757921e-02   +5.815972296233304e-02   +1.355205226921483e-01   +2.281644744906229e-01   +7.341483287204242e-03; -9.421135112319849e-02   -1.061423678967965e-01   +5.376012421829400e-02   -2.765472471842025e-01   +2.937499496726956e-01   -3.129576845588092e-02   +6.323218153290927e-03   +1.712185041914313e-01; -9.466519228810819e-02   -8.206028785648035e-02   +2.557646051738638e-01   +3.154294742850031e-01   +3.188846492665091e-01   +3.424632783075018e-01   +5.518691965939977e-01   -7.495840121127524e-02; +3.182205186033177e-01   -3.510793275848871e-01   -8.431364157827395e-02   -2.637191782791636e-01   +4.172336918993547e-01   +1.536529070305670e-01   +2.335582928453523e-01   +2.591773389385477e-01; -4.277150652901870e-02   +2.734433713254812e-01   -2.221372265659317e-01   +2.382137173722854e-01   +7.698479603000050e-02   +4.104739708886976e-02   -4.209685623445128e-02   +4.647994808183136e-01];
L3E_L2E_iAMPA_netcon = [+2.015180129259019e-01   +2.033187804429696e-01   +6.773551926636636e-01   -4.981547053718652e-01   +3.629031730369141e-01   -5.302330659318244e-02   +2.413187473582714e-01   +5.408730516424488e-02   +6.038777127738303e-01   -2.518628096609468e-01   +7.857530653814958e-02   +3.864572314834802e-02; +3.329600937381959e-01   +4.500777940004662e-02   -1.492200940600506e-01   -7.607844144986262e-02   +3.677276748985217e-01   -8.161990626302851e-02   +2.466519947492166e-01   +3.335608226834115e-01   -1.762052399388040e-01   +1.851183621616961e-01   -1.047162262380036e-01   +1.988546715887337e-01; +8.609861271708191e-02   -6.145745767311944e-03   +2.469952729346468e-01   -1.020678201111056e-01   -2.574931875743864e-01   +3.678216203741793e-01   +3.407054901892182e-01   -2.365142693497621e-02   +2.788043213459694e-01   +2.101798747255233e-02   +2.970714586540690e-02   +1.544319213871170e-01; -1.620729344927170e-01   +1.541127235571077e-01   +1.612638836426108e-01   +3.769597292186245e-01   +2.773517324924793e-01   +3.673999361919681e-01   +3.116828903372747e-01   +4.831116673345877e-01   -3.823447560518470e-02   +2.103407275622971e-01   +1.470951578571609e-01   +3.080210962470691e-01; +2.579905853415812e-01   +2.589267462852049e-02   +3.033425449583276e-01   -1.443229275305417e-01   +3.994892281347229e-01   -3.070678553573336e-01   +1.501769240648121e-01   +2.107517452294444e-01   +3.731852285021282e-01   -8.007074421296177e-02   +3.033839889397632e-01   +2.168059493512290e-01; +2.630785850976011e-01   +3.409227488533179e-01   -2.256250706202937e-01   +6.453961307388423e-02   +4.088166193610072e-01   +1.407573927457474e-01   -1.289488271082828e-01   +1.915166646899812e-01   -2.093733404532596e-01   -3.109785227258480e-01   +2.057625499872806e-02   +6.706528638641398e-01; -2.162163216198326e-01   +7.647413570560896e-01   +1.639576708690003e-01   +1.490683368093390e-01   +1.401504710902737e-01   +1.212120423349283e-01   +4.504117213275985e-01   +1.956014519922606e-01   +7.950271633934766e-01   +2.661518923532599e-01   +1.938976173661763e-01   +8.740214870937368e-02; -2.913781684265440e-01   +7.182758258948024e-02   +2.830863301944554e-01   +2.443611236605517e-01   -1.392067371036577e-02   +5.338698845179135e-01   +5.545467168053794e-01   +5.246689804835519e-01   -5.968009292638905e-02   -4.187932439254973e-01   +1.073687804996020e-01   +5.145414384186586e-01];
L3I_L2I_iGABA_netcon = [+1.152577212843378e-01   +7.270206833511819e-01   +2.887674387333533e-02   +4.245500991598489e-01   +2.573419893619371e-01   +4.859222362609354e-01   +2.960913775678423e-01   +2.728502619950913e-01   +2.181363318581112e-01   +2.182907541525524e-01   +3.028803936988430e-01   +2.798301910232118e-01; +2.782425390460182e-02   -4.275308297718830e-02   -1.384072099156583e-01   +1.662998430200178e-01   +4.713471107382290e-01   +3.900206969712115e-01   +8.625787981899247e-02   -2.743834563435138e-01   +7.448822400644678e-03   -3.425710085388763e-01   +2.910942190576750e-01   +7.094619743915042e-01; +3.870376722858347e-01   +4.939214102771314e-01   +2.229183554274442e-01   +2.907265207398794e-01   -1.426811199372027e-01   +3.087949543443932e-01   +1.934477959136756e-01   +4.783020941399111e-01   +2.168821145280231e-01   +2.206390560517581e-01   -5.958064030675109e-02   +1.768535442587600e-01; -1.724230041937108e-01   -1.582079201854814e-01   +7.500891075956286e-03   +4.132831776142649e-01   -4.094943760858795e-01   +2.128749002692070e-01   +1.818589251857970e-01   +9.036357140869428e-02   +5.061131119210750e-01   +2.180600438851103e-01   +3.573567516361184e-02   +4.786365087910097e-01; +1.581820303670307e-01   +2.461355540114413e-01   -1.110689244464591e-01   +2.616252193760088e-01   -7.994165119158975e-02   +3.404333073019202e-02   +1.733413945216198e-01   -6.015483156627810e-04   +4.017579697780442e-01   +6.332606183293558e-01   +2.853307691725726e-01   -1.984205045692210e-01; +2.549839639453940e-01   -2.939243847581737e-01   +6.190144606739150e-01   -1.438743043035274e-01   -1.029168437731632e-01   -2.243234451809717e-02   +8.179030465622582e-02   +1.852661520293418e-01   +6.445026177445141e-01   -1.597062556071783e-01   +6.587391272499786e-01   +3.511225670076596e-01; +3.632917342734536e-01   -3.000209718542774e-01   +5.213149645882211e-01   -3.799889181029054e-01   +1.794923580032294e-01   -3.251983860642067e-01   +2.249544958906651e-01   -7.729766983497169e-02   +2.438977724528252e-01   +3.732638620296704e-01   +1.999965225083907e-01   +4.500910621761957e-01; +4.059630341344992e-01   -1.807227754484636e-02   +1.257037491032978e-01   -9.781821517832071e-02   +3.641102201694893e-01   +1.977819882825083e-02   +1.838995796543006e-01   +5.661993792497612e-01   +5.575000801774307e-02   +1.101324344748745e-01   +1.713831925504983e-02   -2.428962679472125e-01];
L2E_L3E_iAMPA_netcon = [+3.640767454443978e-01   +4.066618968812530e-02   +7.289824274036933e-01   +1.010996260042031e-01   +1.836427690476302e-01   +1.809660974433837e-01   +2.480986858160464e-01   +5.507605833783180e-02; -2.106391721469065e-01   +3.918152436262146e-02   -4.204098636868450e-02   +6.619984671906622e-01   -4.409746928061946e-01   +1.612369456696350e-01   +8.830870966416299e-03   +4.114112338015102e-01; -3.584602572037897e-02   +4.561985367343344e-01   -1.258745593845393e-01   +9.835790671890536e-02   +1.010058531236791e-01   +1.097234800326524e-01   +4.958653027945669e-01   +1.522220190874041e-01; +1.245198828307556e-01   +2.885084925610085e-01   +1.921749520364244e-01   +4.656381111521622e-01   +2.768746154184484e-01   -2.322495896927685e-01   +1.669560702784278e-01   +3.111400635251482e-02; -1.389657749298268e-01   +2.406906059384013e-01   -1.780846169302092e-01   +1.946207542254424e-01   +6.729863966444515e-01   -7.260293588272737e-03   +3.594382046380398e-01   +3.704424320456141e-01; +4.427325101804722e-01   +2.990408066822152e-01   +4.663791807566751e-01   +4.071672663598279e-01   +2.252881391109169e-01   +8.586588411368742e-02   +4.205205668093671e-01   +2.202353500929972e-01; +6.165824594060108e-01   -1.447712367680744e-01   +3.051946659665058e-01   +1.722086897605005e-01   +4.582236179687795e-01   -4.993848509019386e-02   +1.261382161965728e-01   +3.589933092757613e-01; +1.218481891008821e-02   -2.101100920179135e-01   +2.958251234781183e-01   +3.554781954143107e-01   +3.108798570118894e-01   +2.932558020909117e-01   +1.695940116530224e-01   -3.318232799807365e-01; +1.270258473066008e-02   +2.899699720596055e-01   -1.050872378427203e-01   -2.303253114247955e-01   +2.309765564421677e-01   +1.631748318740542e-01   -3.817694585527115e-02   -2.992778237030333e-02; +3.600538071603211e-01   +8.245836482910347e-02   -1.970665694230375e-01   +3.109768327688486e-01   -1.277670093392981e-01   +1.362938374917499e-01   +9.568772312182214e-02   +3.143190556059651e-01; +1.790965637525337e-01   +3.346459526832117e-01   +3.182730334418047e-01   +1.719103411221900e-01   +4.470435242518445e-03   +6.708486851232752e-01   -6.439458488384346e-02   -5.241077683557736e-02; -1.780867899727533e-01   +8.247947217626785e-02   +2.518394219319062e-01   -4.909520045310044e-02   +9.283611902854805e-02   +6.371645112974839e-02   -5.720233944555038e-01   -3.786205904567917e-02];
L2I_L3I_iGABA_netcon = [+2.987170728914851e-01   +3.302756753410171e-01   +2.035962147926941e-01   +4.330914577267701e-01   +3.385731428406400e-01   +4.257410389877009e-02   +1.738903364487519e-01   +1.412319737525200e-01; +1.764531089426263e-01   +5.217042981264263e-01   +3.248705073400799e-01   -2.094925174568804e-01   +8.076360280010136e-02   +3.655656322845160e-01   +2.689156896485304e-01   +6.370189197708336e-01; +4.481509904251658e-01   -2.109889544499313e-02   +2.851502830183235e-01   +1.852092926985025e-01   +6.583540733248870e-01   +3.959219006182215e-01   +5.964760771081137e-01   -3.725723579093589e-01; -6.078243613784428e-02   +5.086664731753668e-02   +2.516527822822813e-01   +9.175081843846508e-03   +6.852724415899445e-01   +1.275489753681956e-01   +1.103830072491170e-01   +4.788243839832282e-01; +2.089941892530642e-01   +5.667238249984619e-02   -1.976241659291885e-01   +3.729675663292837e-01   -4.266266746698377e-02   +1.854747225340515e-01   -3.672127766179678e-01   +2.869169269525018e-01; +6.805953768374273e-02   +6.197992701142256e-01   -3.517779555169025e-02   +2.115747502139358e-01   +6.941948586772250e-01   +2.969156876697602e-01   +2.767954084676544e-02   +3.603875000867236e-01; +6.365827896411502e-02   +2.848191088148337e-01   +1.758947400049033e-01   -1.648899585821145e-02   +1.297112981039990e-01   -5.202111235697916e-02   -3.131217921105193e-01   +1.904226322221380e-01; +5.184125519895799e-02   +4.338796234363456e-01   +3.320867670479943e-02   +1.417693325113908e-02   +1.211342456993005e-01   +3.833651927467190e-01   +6.838171169195399e-02   -8.071930369103758e-02; +3.287154473562103e-02   -1.573190078674710e-01   +3.742158557018279e-01   +2.534495564498045e-01   +2.457067586766493e-01   -2.766751849742363e-02   +5.471242190142146e-01   +4.561261452124460e-03; +2.241779656301265e-01   +5.181011099108050e-01   +1.151352346354046e-01   +1.740117656301613e-01   +1.339175940504967e-01   -6.112162122048098e-03   +1.572067192605716e-01   +4.016122683813819e-01; +2.416312420194619e-02   -7.289146879564239e-02   +2.710401384490079e-01   -1.561633590523229e-02   -1.124887980960047e-01   +2.730993733735950e-01   +4.493464776081882e-01   +1.420755445898005e-01; +3.901679182848630e-02   +2.793518276261301e-01   -2.000620577463182e-01   +3.304724376618369e-01   -1.325788361943347e-01   +1.241696361833455e-01   +6.587235876973530e-01   +1.248104695639168e-01];
L3I_L3E_iAMPA_netcon = [-1.111923792001271e-01   +6.913849004902164e-02   +1.763221252334233e-01   -8.400049933858256e-02   +5.764537782327266e-01   +1.702060193041091e-01   +1.662413281273339e-01   -1.537786356203125e-01   -3.801028017233252e-02   +1.230473050497454e-01   -3.944647617613274e-02   -9.409412077333865e-02; +7.886919076222630e-01   -9.990770046523861e-02   -9.127974419253457e-02   +3.777938673311848e-01   +4.073792789166741e-01   -1.373736142737708e-01   -4.672779131042054e-02   +3.500735960941662e-01   +9.625996010435822e-02   +2.993441341161917e-01   +2.568029670723114e-01   +1.393512104719044e-01; +1.392910727791414e-01   +1.761091891337173e-01   -2.780185266332665e-01   +4.698303885106178e-01   -2.833717671027579e-01   -2.333218102007023e-01   -6.702252042571250e-01   +2.232294670109538e-01   +4.601201353053735e-01   +6.844102703807098e-02   +9.478461228255453e-02   +7.503702954600600e-02; +3.079502080933376e-01   +4.404528074540971e-01   +3.784427581639664e-01   +5.248488094920517e-01   -4.071114310271998e-01   +9.218084069274377e-02   +2.552289942215084e-01   -5.584732630397698e-03   +3.237449435625379e-01   -1.917223107629879e-01   +4.869742537888633e-01   +2.393812258775079e-01; +6.559821950600964e-01   +2.207325575577600e-01   +4.080395198127136e-01   +2.844637071018969e-01   +2.633593946976429e-01   +2.333851859348254e-01   +7.758335261052094e-01   -3.531505966631461e-02   +2.274222403826398e-01   +4.996143310047304e-01   +2.275709029543883e-01   +3.485085992979873e-01; +2.613770943856439e-01   -2.768289245123058e-01   +1.981408442761777e-01   -1.198571330480298e-01   +2.544804824857279e-01   -2.923424498762864e-02   +1.718141712112384e-01   +4.319898745245004e-01   +4.029672839992919e-01   +5.198461261041677e-01   +1.472236847429044e-01   +9.398290259169062e-02; +4.652284996209263e-01   -3.220674389773153e-01   +3.812043499663785e-01   +5.440817004824142e-01   -8.712006391604826e-03   -3.024869856742902e-01   +3.402924587705595e-01   +4.583907769060409e-01   +6.283639746472142e-01   +3.229644216000550e-01   +1.984240906232411e-01   -3.302317989900887e-01; -3.238250773378130e-01   +1.143497487511339e-01   +1.446387807878972e-01   +1.526275304117660e-01   +3.888220116136648e-02   +9.670981090989822e-03   +3.015287543905024e-03   +3.854399853645381e-01   -2.946942181673041e-01   -2.994811732809420e-01   +5.104037287814578e-02   +2.891685389083156e-01; -1.598566405122715e-01   +3.454057043006544e-01   +2.679218379639186e-01   +9.675823700682154e-02   -1.583349484150784e-01   -6.861842661603187e-02   +1.885131930561651e-02   +2.103995280074428e-01   +1.850719560718393e-01   +6.487129332540403e-01   +7.688619426637611e-02   +2.948733966240813e-01; +3.844958195970238e-01   +4.979618783343572e-01   +4.242280961269020e-01   +5.668490230403818e-01   +1.210330625485498e-02   +4.207597662245706e-02   +2.327368889098349e-01   +4.840439583328381e-02   +1.566586849265915e-01   -1.875674371423176e-01   -2.081403819801075e-01   +3.229111635600183e-01; +4.246714808437754e-01   +6.294276838311315e-01   -1.354705020627808e-01   -9.583448426917780e-02   +5.194072888200447e-01   -2.954567872096160e-01   -4.824509531545353e-02   +2.147477697343253e-01   +2.997200539730329e-01   +4.395923642887620e-02   +6.049690145176991e-02   +1.907102099716271e-01; -3.693724642569850e-02   +4.282170953929357e-01   +2.940756683174917e-01   +2.638463377572609e-01   +9.624875535886437e-02   +1.728436219363041e-01   -1.942622298938460e-02   +2.696811004179032e-01   +1.760261276097675e-01   -2.968992376273799e-01   -1.840128418189582e-01   +1.206152501325384e-01];
L3E_L3I_iGABA_netcon = [-1.776753434118182e-02   +3.716123944063395e-01   +3.221384733272408e-01   -9.581637280836187e-02   -2.162059807555765e-01   +1.601491181387327e-01   -7.465837323816359e-02   +2.401272423524499e-01   +1.946441909309046e-02   +6.156669924474767e-01   -5.074875753112856e-01   -4.598469466021432e-02; +4.005826142623730e-01   +4.792582321023554e-01   +3.645939053397714e-01   +2.994940592290173e-01   -3.359882550398318e-01   -5.989603985408872e-01   -7.790938139286296e-02   +1.226647922014014e-01   +4.533633742966700e-01   +3.169621307620312e-01   +4.665549354904833e-01   +2.223700132628020e-01; +3.906847245050510e-01   -1.131158155805088e-01   -3.272678506437419e-01   -5.130310446470721e-02   +2.396113934439218e-01   +3.613444546958719e-01   +6.964550499158442e-01   +6.051949304778269e-02   +1.821566826665384e-01   -7.422946699548184e-02   +1.448129807825476e-01   +4.713560388845227e-01; +3.125710848089965e-02   +4.834646515584606e-01   +6.022432813561981e-02   +1.192200446922026e-01   +1.311694262402581e-01   -2.366576890739144e-01   -2.089976330857962e-02   +4.313240871387248e-01   +3.044906467429006e-01   -7.652688286434139e-02   +4.535385674815404e-01   -2.681625197175390e-01; +3.852894714854704e-02   +1.372844676254945e-01   +5.468198089867660e-01   -3.974440488179189e-01   -6.683078568388504e-02   -1.821126857198788e-01   +5.162146612282501e-01   +6.284748950271341e-03   -3.323693676464105e-02   +3.486991955854182e-01   +1.943294608722067e-01   -4.991476330013890e-01; +3.047396948853140e-01   +4.791869961377015e-01   +9.086537046618981e-02   +8.084029035353985e-02   +3.037640252358847e-01   +1.957553228749285e-01   -1.810727777283080e-01   -4.147391737853865e-01   -2.974096374065916e-01   +1.142813441248273e-01   +2.518151354188936e-01   +4.009322822354786e-01; +5.626175515491100e-02   +5.564317417256094e-01   -8.500539818902639e-02   -8.490693853001069e-02   +3.284890562265547e-01   +4.505275495647804e-01   +1.842906814450280e-01   +3.649856824707234e-01   +2.150870518643121e-02   +2.810609030098212e-01   -9.713281355853581e-02   +9.535146366275561e-02; +1.304364030912963e-01   -7.138799241325355e-02   +6.075013998434349e-01   -7.778704193793330e-02   +3.942107208730704e-01   +9.048568825328066e-02   -3.240030423305786e-01   +1.376764373933591e-01   +3.076782146128079e-01   +1.347698707579435e-01   -4.641157869777582e-01   +5.941208899765834e-01; -2.850553047288992e-02   +1.583975447429304e-01   -3.252835949884100e-02   -4.597485212556385e-02   +4.170008744663556e-02   -2.518100517949166e-01   +5.840207921070302e-01   -4.717671746269560e-02   +3.451268215982441e-01   +1.651358746767715e-01   +1.780793495204085e-01   -1.654351038405374e-03; +2.976334007788624e-01   -1.324502491935579e-01   +2.181715053102558e-01   +1.308188318923716e-01   +9.955323431695509e-02   +1.861295025903986e-01   +5.725413800043391e-03   +4.080140649729293e-02   +2.496078268531917e-02   +9.239952866884153e-02   +3.092275206076867e-02   +2.454968760528389e-02; -7.093624986438335e-02   +2.553218590895565e-01   -2.655277326914628e-02   +3.361412730356333e-02   +5.627857780277673e-01   +1.075212769404582e-01   +3.203840166313013e-01   +4.366076821239894e-01   +2.722680467293310e-01   +1.888291351071115e-01   +3.777923443898910e-01   +4.789300906674765e-01; +1.913878424942501e-01   +6.931893273615042e-02   -4.590929082260131e-01   +2.364244620803917e-01   +3.812834425920942e-01   +4.694603782667540e-01   -1.495549698419223e-01   +5.739802532754854e-02   +5.461974971825306e-01   +4.031437040292284e-01   -1.441426809441753e-01   -1.195686370009380e-01];
L2E_Input1_iAMPA_netcon = [+4.189217978520768e-01   +9.252000451141737e-02   -2.247118369576324e-01   +7.483280531864228e-02   +2.291479008047978e-01   +3.685246992612327e-01   +1.634599221638735e-01   +3.025656288073292e-01];
L2I_Input2_iAMPA_netcon = [+1.166277601857453e-01   -1.430257179959401e-01   +5.409354773772354e-01   +2.131034628147648e-01   +4.389822863436260e-01   +2.577321884794925e-01   +1.372225038521552e-01   +2.231713391285471e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  33.63 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = -60*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 60*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
