function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.687184938100773e-01   +4.141798028293264e-01   +1.843224906113505e-01   +2.511001978381071e-01   +8.238632926785892e-01   +4.747470345682764e-02   +3.817987390485777e-01   +3.825864227934485e-01   +1.845208111621797e-01   +5.553278303267438e-01   +8.211142165459662e-01   +7.667056361078086e-01   +2.596595363216826e-01   +5.920872798952341e-01   +7.138020504825122e-01   +3.632415566534954e-02; +2.482284673982488e-01   +2.986607774162678e-01   +2.629792142675521e-01   +6.613877909001864e-01   +2.022216499780664e-01   +5.290180374795341e-01   +2.792630908326996e-01   +2.281356625189349e-01   +2.937294775983423e-01   +2.500933134063867e-01   +2.992608925558704e-01   +9.346304672933210e-02   +7.032692744121850e-01   +2.630693259809130e-01   +3.846916211559307e-01   +4.834504284842841e-01; +5.090289247129626e-01   +3.695726482975757e-01   +4.125989707131802e-01   +1.711059371699993e-01   +3.240803455710105e-01   +2.113078244047213e-01   +6.313915159015474e-01   +3.299618953393925e-01   +1.966770521282362e-01   +8.008236715412156e-01   +7.128037515878541e-02   +7.878335609912600e-01   -8.498074623665124e-04   +5.992187589913401e-01   +2.989942237515054e-01   +6.655053086967522e-01; +7.209228173327669e-01   +7.251982416981219e-01   +8.092429855753740e-01   +7.090162033236621e-01   +6.602187646007677e-01   +4.681303491706331e-01   +3.582644348890289e-01   +7.214901371021799e-01   +1.685333043068125e-01   +5.427383211414096e-01   +1.529177343797249e-01   +4.027701260877403e-02   +4.422407015943929e-01   +1.312861878061110e-01   +6.736353238979321e-01   -1.890370999541870e-02; +3.542734497409246e-01   +6.038092116153048e-01   +7.074690183272894e-01   +4.879511035598796e-01   +6.872142332509421e-02   +1.828389330681961e-01   +7.749816323007002e-01   +4.353248842974912e-01   +1.663757758539892e-01   +9.922562815361306e-02   +1.585739813958331e-01   +3.606012130210129e-01   +6.801953344765180e-01   +4.100475868378886e-01   +6.471355677187258e-01   +7.896707215431206e-01; +4.094378345335943e-01   +3.775430034714224e-01   +4.531163088366078e-01   +7.525678551204815e-01   +2.721657644992186e-01   +4.819263370610460e-02   +4.103277822427671e-01   +5.422968695146693e-01   +6.629326952357417e-01   +4.238619975290397e-01   +7.715719935709372e-01   +6.007590660958033e-01   +2.748808107391397e-01   +4.309478139362224e-01   +4.142821880404333e-01   +3.143587282387749e-01; +8.236740787866351e-02   +2.118335214851899e-01   +4.822590313305105e-01   +6.568657071926156e-01   +2.496413931357694e-01   +1.504777968790217e-01   +4.780598690961173e-01   +1.037122558379646e-02   +7.527399986662847e-01   +3.296629839828176e-01   +7.603444924976646e-02   +3.945840510258338e-01   +3.136718393901920e-01   +3.641948603885580e-01   +6.394285908311927e-01   +5.532010963482562e-01; +6.278094414602188e-01   +1.471464690594290e-02   +2.301608704704157e-01   +1.501724293068565e-01   +1.982112130591412e-01   +8.461698231781399e-01   +2.312804806742278e-01   +3.184603416951142e-01   +3.965756855804617e-02   +1.657196101676346e-01   +3.575356595669991e-01   +4.172224185891829e-01   +3.741544346159418e-01   +6.287192879109109e-01   +1.424011679120747e-01   +2.344367733509022e-01; +5.382060497387312e-01   +2.160356252273386e-01   +1.802912350847596e-01   +5.160773009155137e-01   +5.466540300618122e-01   +2.427311165945290e-01   +4.046065177362324e-01   +1.019411635878573e-01   +4.149639121286468e-01   +6.635991855274774e-02   +5.537133490528190e-01   +1.186381810776648e-01   +2.466565591712817e-01   +4.698300904154156e-01   +5.978711415717242e-01   +3.755363602764016e-01; +5.257189893030173e-01   +3.690882802809745e-01   +4.211110865694227e-01   +3.747140411630474e-01   +6.839359747180950e-01   +7.785950559070539e-01   +1.562473352766297e-01   +4.483665072314272e-02   +3.000492338798346e-01   +6.355872686755740e-01   +5.406764986284088e-01   +2.240383335347622e-01   +6.962388047152566e-01   +5.362902078220028e-01   +5.679229960468708e-01   +1.318355387762165e-01; +2.742677587655022e-01   +1.385753338804766e-01   +6.261219791139723e-01   +1.037532307655941e-01   +2.375590320285040e-01   +8.154427383619972e-01   +6.010756022085088e-01   +2.049021005412332e-01   +3.533593608653786e-01   +1.834004466001121e-01   +1.060023386510578e-01   +5.238404347924764e-01   +2.219982865693550e-01   +1.677976034377466e-01   +5.064612775573498e-01   +3.276609695165523e-01; +1.212894790806155e-01   +3.166239690020415e-01   +3.014788950449684e-02   +5.265207875042109e-01   +3.477324257702524e-01   +2.377950238326108e-02   +7.896390762148555e-01   +6.822726771772445e-01   +3.909795033423715e-01   +4.755331974399969e-01   +3.891601678188380e-01   +5.600904967220250e-01   +5.508691520409886e-01   +5.132232462154765e-01   +8.162158648626591e-01   +7.154598608743455e-01; +6.694521439029261e-01   +7.976032143720598e-01   +7.829177221639062e-02   +1.310368777483128e-01   +6.263302087020131e-01   +4.594884342270878e-01   +7.242690849909247e-01   +3.118871467678117e-02   +7.812161199934489e-01   +7.230682633329572e-01   +5.973512069256083e-01   -4.617737743269661e-02   +4.064936920402080e-01   +3.776228531101914e-01   +4.132284842282560e-01   +1.665744459224364e-01; +6.882744751149429e-01   +1.965708080417325e-01   +5.660371300009184e-01   +6.852830209866432e-01   +6.691413902193800e-01   +1.353101355199208e-01   +3.009930446712441e-01   +2.575398160494737e-01   +4.743382841686052e-01   +5.808042154513436e-01   +6.192239233116450e-01   +7.612536954941455e-01   +4.330839212060263e-01   +4.985711216741301e-01   +7.999943503557237e-01   +4.347954860142868e-01; +6.541439950839580e-01   +2.125304536736290e-01   +7.426560546120827e-01   +6.246912196538841e-01   +4.404918905879852e-01   +8.873246298365368e-02   +6.995309386344332e-01   +3.792574060237266e-01   +5.000073401510290e-01   +5.574320992998960e-01   +5.176013225057825e-02   +1.089335305653459e-01   +7.552734754711117e-01   +4.503328283384075e-02   +3.739217755242256e-01   +8.203534795508682e-01; +7.343420710234621e-01   +4.054786409138140e-01   +5.744479566124278e-01   +2.016784875226172e-01   +6.705141319078592e-01   +4.813086324402396e-01   +5.779237937796484e-01   +4.080148690291898e-01   +3.820732885655923e-01   +3.348717997513176e-01   +1.802603611217543e-01   +1.541163575997964e-01   +1.490329531419122e-01   +6.100023780928787e-02   +4.508869513789265e-01   +5.045848916041323e-01];
L1E_L1I_iGABA_netcon = [+3.752054370641889e-02   +7.068029149770665e-01   +7.669012671527051e-01   +6.217934996464508e-01   +5.232223916987671e-01   +5.583636376570790e-01   +8.195546386420046e-01   +8.094449612425338e-02   +7.009434596292775e-01   +2.276842255936731e-02   +6.377404346243953e-01   +2.993511984190899e-01   +2.410652643550112e-01   +7.980353163592293e-01   +2.963042938707862e-01   +5.046186287864043e-01; +5.734619935868206e-01   +5.223046138572641e-01   +5.029543974990487e-01   +2.730794555464272e-01   +5.927979404584323e-02   +6.195533958733764e-01   +5.388014538114129e-01   +5.701153514173658e-01   +1.198971168170540e-01   +5.423601923238532e-02   +7.786711525204939e-01   +2.157801190637357e-01   +4.680340411859591e-01   +4.874384719882307e-01   +7.654860925296016e-02   +3.562048894456652e-01; +5.589830154769361e-02   +5.518727459264741e-01   +3.156234976075571e-01   +3.101002293396198e-01   +2.153480264506803e-01   +9.491305307527614e-02   +2.791607621653702e-01   +4.587649041678830e-01   +2.008537990380000e-01   +1.316171748677188e-01   +5.534154013604049e-01   +5.352722542257611e-01   +4.376783105568477e-01   +1.068971844033897e-02   +3.559467797727113e-01   +3.812641180069708e-01; +3.155234245462894e-01   +6.125573984153581e-01   +5.799983123843530e-01   +5.158416670071664e-01   +4.362979951883056e-01   +7.547398480022226e-01   +6.780157397618762e-01   +3.166865303810496e-02   +5.841978815699858e-01   +7.661365535838036e-01   +4.646455566309983e-01   +6.477477435505462e-01   +2.416177119362748e-01   +5.007606654732480e-01   +8.067379200134521e-02   +8.029757686762395e-02; +4.144231219229019e-01   +7.772164213167746e-01   +7.200078378761914e-01   +8.046055642572360e-01   +2.280037505270248e-01   +1.852235325655571e-01   +5.360900803231041e-01   +4.091392512183526e-01   +5.831871941759539e-01   +6.098159338860221e-01   +7.199738509229252e-01   +5.896988218392225e-01   +1.893682124604299e-01   +1.232903390684327e-01   +3.396401079495034e-01   +7.742273324333372e-01; +5.696122734522766e-01   +6.037882043697260e-01   +5.732194507919715e-01   +6.731884749452683e-01   +4.499067206110365e-01   +1.656215845282264e-01   +3.129950619811371e-02   +2.453821972814890e-01   +7.485980983508325e-01   +3.703510122452502e-01   +6.925118433974138e-01   -8.799373724707765e-03   +3.306877077758354e-01   +3.281407351296336e-02   +2.092965403391022e-01   +4.706721409790694e-01; +1.979271874383355e-01   +5.905338656225602e-01   +6.151698717814637e-01   +2.629826915989136e-01   +5.095909661900788e-01   +1.796126516091136e-01   +6.762987134923462e-01   +5.599137840209156e-01   +2.113359919015190e-02   +5.511454882975202e-01   +1.465152863979503e-01   +5.850100373474932e-01   +5.402327875533465e-01   +5.863983277309276e-01   +1.933110341458191e-01   +5.029240550518654e-02; +1.133829001311753e-01   +4.025387369456702e-01   +2.407301864401309e-01   +1.114006679128880e-01   +5.026666937326484e-01   +4.189361415922621e-02   +1.878600357015312e-01   +3.359330431617732e-01   +6.447297632269138e-01   +3.217005731064465e-01   +2.642300159798592e-01   +2.975386871739748e-01   +3.914474126554147e-01   +1.169173459293604e-01   +3.929713597505705e-02   +7.790375721487878e-01; +3.457281826524155e-01   +6.093558996884423e-01   +7.614331863350652e-01   +4.882902018150803e-01   +3.661696640250543e-01   +3.650908584132873e-02   +9.659819266342080e-02   +4.679463833120510e-02   +5.259359709285399e-01   +3.127347857552749e-02   +2.615464293269801e-01   +6.883941421491925e-01   +5.052367692373382e-01   +3.403663269292079e-01   +7.388115885057838e-01   +8.268093374746187e-01; +3.377260843509691e-01   +6.875698986362201e-01   +2.102970464029925e-01   +1.906455703866246e-01   +9.480793633665439e-02   +4.006078441743062e-01   +2.378110660461279e-01   +1.216435395995890e-01   +6.466112065691058e-01   +1.877008747626621e-01   +3.187030469997817e-01   +3.617703417324534e-01   +6.346958946526084e-01   +6.709409516064849e-01   +5.922584000736226e-01   +2.522309756585440e-01; +5.150163591236566e-01   +3.993426681387948e-01   +4.138213425433616e-01   +2.070676558357667e-01   +4.802079820072950e-01   +7.331909818394979e-01   +6.611054108333427e-01   +6.521037426121735e-01   +4.527009200125272e-01   +3.933349941842592e-01   +9.271863245513610e-02   +7.261180211086510e-01   +1.355530454143999e-01   +2.998496862905281e-01   +3.757141895764886e-01   +3.388703632748739e-01; +6.280917113326721e-01   +1.532233827233306e-01   +1.985866225047454e-01   +4.261999167117201e-01   +6.504612044275536e-01   +1.198210678585472e-02   +5.189067326424978e-01   +4.613097455597023e-01   +8.222135814714497e-02   +4.344024292359589e-01   +3.431832008471005e-01   +3.523673858412953e-01   +2.095834700784140e-01   +5.507520508501763e-01   +6.879675756064091e-01   +6.351478981789714e-01; +2.800575302828796e-01   +3.814913498062511e-01   +4.061624993389845e-01   +6.687248460392641e-01   +4.139762241970404e-01   +2.663590572749117e-01   +5.867527215647957e-01   +5.349764410771031e-01   +5.886568704245929e-01   +7.614961195370736e-01   +9.170474992165012e-02   +2.284709416250346e-01   +3.147701248150557e-01   +4.733097990690996e-01   +3.947072672965898e-01   +5.290913157280357e-01; +2.236705280774533e-01   +3.432707987162285e-01   +4.847906567032417e-01   +4.583448247495579e-01   +5.761558454196978e-01   +1.466550157794527e-01   +3.762001627505334e-01   +2.440736137652131e-01   +2.735566505916630e-01   +3.844047846831586e-01   +3.723654241362264e-01   +2.819146828535745e-01   +7.222340193189110e-01   +7.961398043620979e-01   +2.723458111880636e-01   +1.118610960457463e-02; +2.910755598090246e-01   +2.152019364913296e-01   +3.480613386842401e-01   +4.966905403174213e-01   +3.744436212070329e-01   +3.656328736186908e-01   +2.582525814008328e-01   +2.855337735161778e-01   +5.242512494697282e-01   +5.820617561741847e-01   +2.975669113752039e-01   +2.684161402678490e-01   +1.311024365015896e-01   +2.817731408575534e-01   +6.432167379291203e-01   +6.276549726416668e-01; +2.762096736883137e-01   +4.147466035448840e-01   +3.857348135758917e-01   +1.949198805040115e-01   +3.892458029109627e-01   +7.190340803228443e-01   +1.035929591407837e-01   +6.368186387547754e-01   +1.567963880451057e-01   +6.153900084792617e-01   +3.908470978047595e-01   +5.635167410903296e-01   +3.822544184677091e-01   +7.863511928536339e-01   +2.036999482997943e-01   +6.173070896566756e-01];
L2I_L1I_iGABA_netcon = [+6.014057415409032e-01   +7.372836317199372e-01   +5.561318251031315e-01   +3.146994659628651e-01   +1.710313966282722e-01   +4.951278760386801e-01   +3.022366460775072e-01   +7.673642072952312e-01; +7.336245408325533e-02   +3.593701489380188e-01   +1.857161330614540e-01   +6.174373102646318e-01   +4.748807706800812e-01   +6.492963201720595e-01   +5.441431946271685e-01   +5.269563330767658e-02; +1.618629704544917e-01   +3.024977491167775e-01   +5.683393094994547e-01   +4.430020194814727e-01   +6.192225276865033e-01   +8.310308730772941e-03   +4.815759747264953e-01   +7.293089582076788e-01; +2.092836421674236e-01   +6.945260212002869e-01   +3.280655351673265e-01   +4.247962184825755e-01   +2.057019816771859e-01   +5.654019419458125e-01   +3.705115539898690e-01   +7.013324704776670e-01; +6.613275602676520e-01   +3.163865016291352e-01   +3.383489321823205e-01   +2.510055747849069e-01   +6.791470542053997e-01   +7.468490454568373e-01   +3.273254297487354e-01   +4.807258394304582e-01; +5.264298755528938e-01   +4.535087450743683e-01   +7.475238970661326e-01   +4.442227007236927e-01   +6.707318504449061e-01   +4.035366119346855e-01   +2.812281660762369e-01   +5.749350115710720e-01; +8.084144355519658e-01   +3.848634747031428e-02   +4.435098395346424e-03   +6.804975117981220e-01   +8.579201317058510e-02   +2.091966440603248e-01   +3.428085807415294e-01   +2.232148984542896e-01; +4.851930440286333e-01   +2.715995056227584e-01   +2.181421408611385e-01   +7.383173209818740e-01   +2.328045684295916e-01   +5.048304119571285e-01   +2.951092810022765e-01   +1.858357787410704e-01; +5.174281090122840e-01   +4.416230405602758e-01   +1.188861678933590e-01   +2.665443348070127e-01   +4.262928205287165e-01   +5.312275758363537e-01   +6.829791911219913e-01   +2.213531181981849e-01; +4.583468611304437e-01   +6.011342313212382e-01   +3.897857222626371e-01   +7.514419369354978e-01   +6.738475305948141e-01   +1.210471467073717e-01   +2.134890465515422e-01   +1.202237700154036e-01; +6.244882696489880e-01   +4.593804723151507e-02   +4.497397714613865e-01   +3.789940478754207e-01   +5.566742834314813e-01   +7.671430613159182e-02   +5.558180458871547e-01   -2.432377759901971e-02; +4.497360810581186e-01   +7.945470356860346e-01   +2.876179573523397e-01   +5.714278966857007e-01   +7.456553631207511e-01   +2.899831420291242e-01   +3.678746988281885e-01   +3.725026008759654e-01; +3.188077881259557e-01   +5.036119589111278e-02   +1.071969553600130e-01   +6.977702261446170e-01   +2.192270507065706e-01   +8.059676675541755e-01   +4.433325392836168e-01   +4.713575448707798e-01; +6.533751578256250e-02   +6.579423091200624e-01   +8.954018708035817e-02   +1.789886584715906e-01   +2.177155381788997e-01   +3.100241895925718e-01   +7.480882271534143e-01   +1.968791497728246e-01; +4.267342602779425e-02   +2.235907194968679e-02   +4.596988758878442e-01   +4.419941366253005e-01   +3.928391285315693e-01   +5.651054074713199e-01   +6.251731763486843e-01   +2.218760236607132e-01; +2.182602354027351e-01   +6.298432994393276e-01   +1.662143037971839e-01   +7.333697143877632e-01   +2.917542281353144e-01   +4.540783869569446e-01   +3.099099526863792e-01   +2.469947501689456e-01];
L1I_L2I_iGABA_netcon = [+5.842994679420437e-02   +2.983172198270176e-01   +1.330655945690176e-01   +6.215112856719503e-02   +7.770634528139421e-01   +4.016368064259523e-01   +1.099251916134861e-01   +4.434563444948375e-01   +3.473455173571581e-01   +1.130279105577278e-01   +2.454333600960582e-01   +6.627456765913802e-01   +2.215192942056474e-01   +8.087191822182845e-01   +1.227743366990032e-01   +3.110701912086951e-01; +7.001149424755295e-01   +6.229865296369024e-02   +3.505699317291605e-01   +5.607737324208316e-01   +1.488487408449488e-01   +4.736377050384297e-01   +4.877687181149922e-01   +4.087192094966212e-01   +7.601317950312247e-01   +7.648132580410840e-01   +1.740446632604087e-01   +2.018160711621719e-01   +3.846341097305931e-01   +3.968863929929070e-01   +2.317450243451948e-01   +4.202305516381082e-01; +4.261436711390332e-01   +4.836666601062607e-01   +4.382056085221375e-01   +3.248094241877422e-02   +4.784276062313727e-01   +9.374575423221657e-02   +2.233209240104010e-01   +2.034388641780144e-01   +4.693422905586194e-01   +7.929096234276800e-01   +6.993642618884451e-01   +3.644947718242642e-01   +5.398645050502628e-01   +3.150519645776820e-01   +1.194939350483106e-01   +3.012953750330769e-01; +4.661659687510756e-01   +3.994512596559272e-01   +5.995918555462677e-01   +1.087810372102338e-02   +4.006272512234993e-01   +5.176242907558623e-02   +3.138246744425392e-01   +5.765153222573358e-01   +5.176850221342244e-01   +6.625277992157129e-01   +7.359026049910744e-01   +3.912698975006129e-01   +6.223582246958239e-01   +1.211505518538709e-01   +3.112044705586889e-02   +6.716685280583975e-01; +3.374396704900032e-01   +5.780832499450971e-01   +5.668538334510361e-01   +2.344499349422256e-01   +5.011955821093274e-01   +7.834630466288518e-01   +3.016400679513823e-01   +2.716815482880500e-01   +3.946582324734056e-01   +6.041401066552397e-01   +5.815748728319932e-01   +5.699150675086629e-01   +5.243985999413251e-01   +1.552967430675186e-01   +5.951492598784597e-01   +7.730982058686967e-01; +2.676226452215864e-01   +3.363203235349422e-01   +5.063350759272165e-01   +6.490879371273371e-01   +7.787203067076407e-01   +4.161291978450951e-02   +2.865035181378916e-02   +5.784111736840473e-01   +6.647857324900299e-01   +6.966859466433475e-01   +6.055146110255830e-01   +3.072924920208971e-01   +4.567095134901747e-01   +4.846537685166166e-01   +6.651307392410152e-01   +6.153382474795903e-01; +7.076907157152711e-01   +3.639399109798672e-01   +7.033223262504933e-01   +7.874497035382851e-01   -1.849752657072808e-02   +7.034020531583079e-01   +5.269211148549727e-01   -4.875520573597619e-03   +1.675008426191243e-01   +6.612966870058480e-01   +7.528085032892848e-01   +7.909233503500589e-01   +4.509230173908801e-01   +3.753421685527789e-02   +4.782914466723507e-01   +2.277075927096929e-01; +2.239668343700493e-01   +1.428826925449323e-01   +5.301243850260894e-01   +4.437267980196980e-01   +1.302172145825328e-01   +7.329423055856037e-01   +5.942432599759642e-01   +2.204549380640254e-01   +6.739992306699752e-01   +5.415266549961664e-01   +5.897392890591880e-01   +5.608211271120718e-01   +6.031870446920145e-01   +4.656035488424328e-01   +4.279589525585124e-01   +8.950732788680822e-02];
L2E_L1E_iAMPA_netcon = [+3.643382463637678e-01   +4.588278986195968e-01   +6.950194902637933e-01   +2.828806457785644e-01   +1.492027318099116e-02   +4.968687957931656e-01   +4.564660033697773e-02   +4.153482285739179e-01; +3.279851740506774e-01   +1.335631230675947e-01   +4.302033232261730e-01   +4.260999601026880e-01   +2.705484360433101e-01   +9.156319222432670e-02   +6.494589603510296e-01   +9.266945931788051e-02; +4.692301868649593e-01   +1.513365522622716e-01   +4.227024733735619e-01   +7.037599279992264e-01   +6.038124768710326e-01   +6.952398578222833e-01   +7.061765526860040e-01   +6.491164239174863e-02; +5.674517469942401e-01   +2.529196912484444e-01   +4.587307742693530e-02   +1.711880410330950e-01   +2.479549778365782e-02   +7.487565428732454e-01   +3.253024855351630e-01   +9.713535527782717e-02; +3.657721285592830e-01   +6.127264094781292e-01   +7.051158373061098e-01   +5.600633623022513e-01   +3.940336439206615e-01   +5.398502694170849e-01   +3.992217551730685e-02   -1.384679860798512e-03; +6.806487501939398e-01   +8.377398255063386e-01   +3.600532477256798e-02   +7.507537816211780e-01   +3.432128068028657e-02   +5.905625998922553e-01   +3.602149959481206e-01   +6.355602521481226e-01; +1.363599613468074e-01   +6.297433088138604e-01   +3.198842089592736e-01   +2.150275576437790e-02   -3.775196258549966e-03   +7.233141723394306e-01   +4.561561609369973e-01   +6.588472436785030e-01; +3.281690637457069e-01   +7.897728828114853e-01   +3.511852373590542e-01   +6.512586593814246e-01   +5.204992780842784e-01   +4.768422374412515e-01   +7.193854119548655e-01   +3.772665284372716e-01; +2.817849108545198e-01   +1.175537831773384e-01   +4.298982005730551e-01   +2.510931550433206e-01   +7.709363902158611e-01   +6.560892489660052e-01   +1.877673305180400e-01   +5.417282583922605e-01; +2.804353417665805e-01   +7.154115058295976e-01   +6.755229668533363e-01   +6.932177196438529e-01   +8.011182328943184e-01   +2.135702685683527e-01   +3.769326210486331e-01   +1.841714601751623e-01; +6.144677237653321e-01   +5.207689481050035e-01   +7.455277516758536e-02   +5.855293810524898e-02   +3.096253041398505e-01   +5.708793206692752e-01   +5.086374989009915e-01   +1.229851230669614e-01; +7.787187406961146e-01   +3.457307209420268e-01   +2.219276782015677e-01   +4.950747858599913e-01   +6.909482079258198e-01   +7.925374582693631e-01   +5.010475331587647e-01   +6.658770870199328e-01; +3.669360138934679e-01   +6.708421952761708e-01   +6.772801948355698e-01   +3.186017058063454e-01   +7.303011143431734e-01   +5.108486678954380e-02   +5.488039954668726e-01   +7.562601054905743e-01; +3.818252063450883e-01   +3.221895869765842e-01   +5.956616535371483e-01   +3.085127760717549e-01   +1.423832154667940e-01   +6.907339257017175e-01   +7.652364846601429e-01   +2.182138188399056e-01; +5.678159851331230e-01   +6.492897882489065e-01   +6.153452277592585e-02   +2.100872258391148e-01   +3.496466983531116e-01   +8.209966743836759e-01   +4.649002714731272e-01   +1.485223745858387e-01; +5.343082164003207e-01   +5.641597466933859e-01   +4.071820129723567e-01   +8.617247861299378e-02   +4.304374374698141e-01   +2.404674405583952e-01   +5.351278721744731e-01   +8.838040056256452e-02];
L1E_L2E_iAMPA_netcon = [+2.098735968576523e-01   +3.575226568501925e-01   +8.373771919043805e-01   +4.910932376472310e-01   +4.974985701916256e-01   +8.979408502664681e-02   +4.267064424576988e-01   +6.820844615367019e-01   +5.105637191413658e-01   +3.595448468936661e-01   +5.723608873422481e-01   +1.838605854848259e-02   +4.165192000723172e-01   +3.377884737759572e-01   +5.937667943568402e-01   +7.817205488775245e-01; +5.578241215202631e-01   +7.558845882704834e-01   +5.616751759400129e-01   +2.646122164743884e-01   +4.391649608878291e-01   +4.968036536443265e-01   +6.892052928192074e-01   +1.028511409014114e-01   +1.982560230555717e-01   +2.728717563261503e-02   +1.332721408690939e-01   +3.213384079832740e-01   +1.183049838403742e-01   +2.314550787063191e-01   +1.407011516159607e-01   +3.040936517741114e-01; +3.757145544340001e-01   +7.090536593966158e-01   +8.035758852754969e-01   +7.415226818938890e-01   +2.722195921171150e-01   +7.155687123908340e-01   +2.343186327360174e-02   +6.448083475831233e-01   +4.465672119364060e-01   +2.979395753632140e-01   +1.059500480782334e-01   +7.374828394463997e-01   +9.384526808905495e-02   +3.042841181469212e-02   +3.637340151349772e-01   +5.202765775872203e-01; +3.895582795272163e-01   +3.270325468465862e-01   +4.866426236772114e-01   +8.164791954401038e-01   +7.256349652106059e-02   +4.823698656519260e-02   +8.213765637586040e-02   +5.542483288241076e-01   +7.284978734660931e-01   +5.884294095562452e-01   +4.921011864533779e-01   +2.931456782572853e-03   +4.415884467738925e-01   +9.423236526591078e-02   +2.060802848668629e-01   +4.665473952495033e-01; +6.736567254767191e-01   +2.351611288549573e-01   +1.155254683360772e-01   +1.633195328554623e-02   +7.855235418733073e-01   +7.141312314057757e-01   +7.784792865863617e-01   +3.186349929810254e-01   +2.492245911705104e-01   +3.529950688480900e-01   +5.778460115734798e-01   +4.301487730239087e-02   +5.776385901364636e-01   +5.534501577813312e-01   +2.799301278532318e-01   +2.241134453774121e-01; +1.139029373589444e-01   +4.425451866951217e-01   +1.053589553830742e-01   +5.008114883433479e-02   +5.865821551804694e-01   +3.950963820207262e-01   +4.460088227489149e-01   +6.756095734058897e-01   +7.130425219521528e-01   +6.105222301854373e-01   +1.430498424992669e-01   +6.358446683054805e-01   +6.054908386949720e-01   +3.903910880987397e-01   +1.005392472778336e-01   +3.145980866191790e-01; +2.229921657613611e-01   +3.601460662245665e-01   +1.692873981603913e-01   +1.584393177954371e-01   +2.815162400683549e-01   -2.350552189846148e-02   +1.387031189751322e-02   +1.099433068422919e-01   +3.661071155547144e-01   +4.572204041724286e-01   +1.377085520367835e-01   +2.220459634011241e-01   +7.735166168248732e-01   +4.276977629561621e-01   +7.011802532059113e-01   +3.651315125746710e-01; +1.880989116379830e-01   +3.231214808823741e-01   +7.436770069576261e-01   +6.615365675346766e-01   +7.687841076608599e-01   +4.517020076344704e-01   +8.076736413489760e-01   +1.442437400364871e-01   +3.416718951100683e-01   +7.307386096772372e-01   +7.244694233624258e-01   +1.680104170217641e-01   +3.983365408988502e-01   +2.607092911332641e-01   +6.802987393309413e-01   +3.590644041438710e-01];
L2I_L2E_iAMPA_netcon = [+4.959155062035849e-01   +1.932187478194085e-01   +6.964491316730269e-02   +4.160632318476466e-01   +6.387500931742836e-01   +5.576172501124051e-01   +9.531555415751414e-02   +4.307711185922199e-01; +1.317265947865401e-01   +2.187804338317853e-01   +7.695636029482191e-01   +5.013858155139767e-02   +5.095933806963496e-01   +2.498487367103191e-01   +1.369119092615935e-01   +4.726653118171985e-01; -3.943630358787854e-03   +6.948118975740384e-01   +2.339163115454642e-01   +2.889058938871849e-01   +6.870402811553952e-01   +8.107427271733674e-01   +6.450709052208281e-01   +2.557604350982373e-01; +6.538104279899241e-01   +7.606550420208068e-01   +7.995969532348315e-01   +6.639236802677377e-01   +7.141076014293185e-01   +4.673049558574827e-01   +3.096647424356722e-02   +3.631318519887897e-01; +6.478995231593728e-01   +7.123476238430414e-01   +2.107667423974382e-01   +8.798869806749353e-02   +3.083862729950935e-01   +7.629228350122438e-01   +2.187994271367244e-01   +7.374041143463186e-01; +4.907344764159387e-01   +2.482923539797266e-01   +6.552966607515428e-01   +5.570415285894552e-01   +1.574868308124543e-01   +2.416031724291621e-01   +1.580901393319042e-01   +5.978473388980573e-01; +1.039646848307070e-01   +3.332949581888767e-01   +6.914619053692620e-01   +7.716163109515753e-02   +1.699211353564069e-02   +2.500908726110337e-01   +3.852001352495802e-01   +7.750500494747197e-01; +1.327540211114422e-02   +3.985692095018599e-01   +4.185266752455656e-01   +7.829028365639173e-01   +5.877836204737108e-01   +5.171425492602728e-01   +7.767216148743810e-01   +2.529142681672983e-01];
L2E_L2I_iGABA_netcon = [+7.120002566561131e-01   +3.655558039639477e-01   +3.675255172899979e-01   +2.605791649639203e-01   +1.006274325193899e-01   +7.866937393091131e-01   +7.348238744223273e-01   +5.552917709885311e-01; +8.054518888786621e-01   +2.914387220049254e-01   +2.245843205316128e-01   +7.827204028874105e-01   +7.075197684523457e-01   +6.154397879382863e-02   +4.432187583400250e-02   +4.817494539294447e-01; +3.047258805175936e-01   +5.166523490539163e-01   +5.974118505929407e-01   +2.941628757768149e-01   +2.016629111634834e-01   +7.144000443639189e-01   +3.619540278764934e-02   +3.533731712617558e-01; +7.965855228587109e-01   +6.895417452114630e-02   +2.431408174625503e-01   +6.458214425198013e-02   +7.303930715351956e-01   +7.913672139257135e-01   +7.448690831972418e-01   +3.893851869263800e-01; +4.154307592228548e-01   +4.345292022272995e-01   +8.313886590736453e-01   +2.734758438723672e-01   +6.974262661459460e-02   +1.263501606859017e-01   +7.498389330751253e-01   +3.616798951048548e-01; +5.204311810759250e-01   +2.914494756385670e-01   +2.556610337231609e-01   +4.100590932851830e-01   +2.462651866054633e-01   +5.088796039062840e-01   +4.513217219104831e-01   +8.476808088991060e-02; +7.205980992812434e-01   +4.954581021819635e-01   +5.837287510342003e-01   +1.716011172119728e-01   +2.314464231281477e-01   +5.882160179944068e-02   +5.475710499537754e-01   -3.867053961915432e-03; +1.483083915198815e-01   +2.872334991919407e-01   +4.596926939940198e-01   +3.685162175568192e-01   +7.265411854240617e-01   +5.248902226463695e-01   +2.731189812225904e-01   +2.084407532037685e-01];
L3E_L2E_iAMPA_netcon = [+4.088029368063355e-01   +5.040577572219649e-01   +1.921770110904905e-01   +2.673380223400130e-02   +4.628941299937674e-01   +4.675962444033586e-02   +7.473380926124199e-01   +5.086354245425466e-01   +5.866287377256115e-01   +5.644223789324726e-01   +1.730783509897126e-01   +4.224606799369436e-01; +2.324628797250179e-01   +4.540620877082662e-01   +5.525498614401232e-01   +1.130944080925300e-01   +6.201461239397000e-01   +6.886932906722261e-01   +5.759331185344755e-01   +2.929213742647281e-01   +6.841207078853989e-01   +2.417323211848297e-01   +5.487298076550775e-01   +6.361402934553142e-01; +5.341087818048169e-01   +3.664210955599281e-01   +7.096116994994439e-01   +6.872778144857568e-01   +8.875175765408753e-03   +1.980573312159887e-01   +4.234027046747612e-01   +4.034505257922602e-02   +4.658040233729274e-01   +5.745166453221539e-01   +4.107278083007951e-01   +1.927491880982537e-03; +5.372608087771568e-01   +4.174449945454036e-01   +3.047526458511807e-03   +6.709631385094438e-02   +6.244493963206516e-01   +2.793687376779622e-01   +5.268861264214027e-02   +4.442122885451589e-01   +2.279632368949396e-01   +2.474128706402275e-01   +4.747567816609060e-01   +1.317995908810056e-01; +5.654384174179047e-01   +8.264611135399276e-01   +6.890552754396119e-01   +7.164101190891425e-01   +6.408461009948800e-01   +7.115441702977507e-01   +5.132490453298444e-01   +1.202098880205320e-01   +1.130178701162612e-01   +1.747653857641135e-01   +5.901866222900223e-01   +5.035667407036321e-01; +2.019213832234596e-01   +1.426190905880992e-01   +1.344806621363996e-01   +3.183947619007398e-01   +6.075730641820587e-01   +5.705252014347240e-01   +7.784015859224643e-01   +7.431762812018864e-01   +7.655504639775036e-01   +3.087287723033978e-01   +7.515404251955127e-01   +7.102973428309933e-02; +6.026299733856073e-01   +1.058136911187600e-01   +9.296332503006141e-02   +4.652773145399827e-02   +6.361977877660077e-02   +3.982618449872720e-01   +6.015000327384146e-01   +2.548435511994294e-01   +2.963570919506950e-01   +2.556764595356504e-01   +7.054612243784547e-01   +8.003535782433382e-01; +6.987272506426571e-01   +6.546368869318268e-01   +4.990593920800221e-01   +7.270795022617585e-01   +6.305764316850293e-01   +2.423977889137487e-01   +1.955845568250235e-02   +2.535211498868852e-01   +1.419134908063316e-01   +6.334588132791751e-02   +3.686003064142964e-01   +1.351295062030931e-01];
L3I_L2I_iGABA_netcon = [+4.872189502913509e-01   +7.768393583224729e-01   +1.118132063441559e-01   +4.651206695476629e-01   +4.831453650396156e-01   +5.672755966987771e-01   +5.289043111100121e-01   +8.373988948599137e-02   +7.927265949208478e-02   +1.354760472996630e-01   +6.583092310635154e-01   +1.724642189820566e-01; +5.021718348011284e-01   +5.648252576817870e-01   +4.924909495869527e-01   +5.045056386483765e-01   +6.193518378114810e-01   +2.833126843765119e-01   +7.379406554910543e-01   +3.634795988352427e-02   +2.997922051719847e-01   +2.793857781716324e-01   +4.896625459743960e-01   +8.056351142742395e-02; +3.831226815519300e-01   +6.021590164107037e-01   +4.122882916875705e-01   +3.831460119562152e-01   +4.711105366097606e-01   +3.842512637930617e-01   +4.199195634943361e-01   +5.496010722265745e-01   +5.044259980856087e-01   +4.454661294078497e-02   +5.360405258620667e-01   +6.067390679837432e-01; +5.593420503566228e-01   +7.223425965277197e-01   +7.980038598430128e-01   +1.839484002246071e-01   +4.931775722514198e-01   +7.865825763834856e-01   +1.444507429692035e-02   +1.214744394413502e-01   +4.847537297820289e-01   +6.629063039532854e-01   +1.253128275969191e-01   +6.175224633945308e-01; +3.347975027892126e-01   +6.427451149508939e-01   +6.752199476834012e-01   +6.507277796813761e-01   +6.967287733019319e-01   +2.387303301031873e-01   +3.738346547112730e-01   +5.996392892486940e-01   +3.985473792693247e-01   +1.167034140944965e-01   +3.083375960222463e-01   +2.929006676007930e-01; +5.317498431108878e-01   +1.922302049777553e-01   +5.098714842923986e-01   +2.927080820017298e-01   +6.606236126019112e-01   +5.012955992044315e-01   +3.583219003695409e-01   +4.863578417203890e-01   +2.501540023234683e-01   +2.507082027505496e-01   +4.828694178142876e-01   +5.117558828857639e-01; +3.424799181542438e-01   +9.519681863552185e-02   +6.842499185946286e-01   +5.265627089366803e-01   +2.746515051787636e-01   +7.157327076257243e-01   +3.278436542786287e-01   +2.074299308488885e-01   +4.920367947269554e-02   +6.869857896940268e-01   +7.189675844924601e-01   +1.253084372019140e-01; +3.811395865337157e-01   +1.717685087478286e-01   +7.504737576547286e-01   +1.072536338449836e-01   +6.505612358759538e-01   +7.344745773213111e-01   +6.038034389842674e-01   +4.519112816730191e-01   +3.905577515659981e-01   +6.290650546891633e-01   +2.039276310717610e-01   +6.719904846535232e-01];
L2E_L3E_iAMPA_netcon = [+4.724703628809731e-01   +1.726558382279202e-01   +6.842855329149107e-01   +4.921169173521810e-01   +4.582967398708285e-01   +3.646686513268568e-01   +4.174331678262199e-01   +2.610683601715821e-01; +4.324167754158998e-01   +4.707046779439638e-01   +5.590199907244552e-01   +3.330903369562479e-01   +7.363196604990513e-01   +2.913300855469382e-01   +5.042718181590102e-01   +7.317723891520417e-01; +1.927399469600235e-01   +1.747016786751004e-01   +5.383321384973282e-01   +5.501201436137956e-01   +4.863786937258334e-01   +6.970872319188497e-01   +4.381703611740679e-01   +1.022004947762412e-01; +1.325138621643527e-01   +1.822261436329366e-01   +3.669069116175212e-01   +7.514976281612227e-01   +3.065688450325378e-01   +6.105700512665015e-01   +4.799014197875391e-01   +2.253660246209044e-01; +1.249392687081432e-01   +5.176279196630008e-01   +7.700871811407377e-01   +2.167774169550133e-02   +5.670352375389766e-01   +5.776050631369724e-01   +5.993705524002345e-01   +3.869491087414124e-02; +1.402880501251856e-01   +7.884019743672833e-01   +5.639467851466318e-01   -4.599575760056543e-03   +7.788890148351325e-01   +2.960861663345838e-01   +2.500464348608337e-01   +6.441548916419262e-01; +2.509157892703856e-01   +1.898166946524893e-01   +4.926965570000474e-01   +1.136303130991981e-01   +2.135780220764205e-01   +5.604351584939663e-01   +4.690483927440151e-01   +4.460850363757431e-01; +4.634041704350745e-01   +4.721513167452489e-02   +4.729006410683095e-02   +3.550574571728206e-02   +6.883544127547560e-01   +4.319705153212726e-01   +1.811839883517372e-01   +7.365767448186621e-01; +7.469174475845242e-01   +5.491928526537472e-01   +2.651894178164343e-01   +6.666989830072911e-01   +7.647260096336379e-02   +3.231754976701429e-01   +4.885420745184627e-01   +3.487770514876103e-01; +9.319528460177715e-02   +1.754653571110534e-01   +6.666365858582153e-01   +9.003071343248313e-02   +2.246050000776920e-01   +2.223415858710635e-01   +7.691160743997719e-01   +7.480963273814929e-01; +5.620357139830227e-01   +6.606610376827430e-01   +4.230970804654980e-01   +4.690818432644068e-01   +3.414785290242075e-01   +3.247865162698146e-02   +1.742371863938610e-02   +6.641195258279982e-01; +6.252093404675886e-01   -2.568509998886050e-02   +7.373350654727071e-01   +7.039493936319673e-01   +4.416573177248365e-01   +1.080875121120784e-01   +2.249267082972252e-01   +1.127511514189270e-02];
L2I_L3I_iGABA_netcon = [+2.771477448790433e-01   +3.465610149138305e-01   +2.876912500491463e-01   +5.095609057512421e-01   +3.608028662595979e-01   +3.752172792014811e-01   +4.212087529390359e-01   +4.816043138532763e-01; +3.050039092999690e-01   +6.398943206979797e-01   +1.600064139591194e-01   +7.442212642053756e-01   -2.175828499020639e-02   +4.685328311467082e-01   +3.302198074473428e-01   +3.238492308371309e-01; +2.199949281924220e-01   +5.285445623600392e-01   +6.602992213510556e-01   +4.976672318953092e-01   +3.130883199096512e-01   +3.700798828184269e-01   +5.523765472495036e-01   +7.567875441687113e-01; +5.924708815274401e-01   +2.125057102900776e-02   +6.977048108798557e-01   +2.046687709699722e-01   +4.422020273215539e-01   +4.491960285245068e-01   +6.908500295116784e-01   +1.405164691293326e-01; +4.321948856216830e-01   +8.350606730190951e-01   +5.865832195883269e-01   +4.123429634552234e-01   +2.886273191864639e-01   +6.717992441691328e-01   +7.279361264219502e-01   +4.055755197118375e-02; +6.271835014754137e-01   +4.759382648721673e-01   +1.554981425429568e-01   +7.034323912626164e-01   +2.727258322980333e-01   +2.073590071270026e-01   +2.934817030928561e-01   +7.307805646002427e-01; +2.479175137645256e-01   +6.252215807947804e-01   +2.547568461871035e-01   +6.320320119643184e-01   +2.754595276240493e-01   +2.600971411783719e-02   +3.968629293140886e-01   +5.296102473843911e-01; +1.463793849563262e-02   +2.021142301785418e-01   +4.715993153331980e-01   +7.508945278385018e-02   +5.288646225506484e-01   +5.547790505046113e-01   +1.427398687949672e-01   +9.510730325453430e-02; +3.831922398337204e-01   +5.589153010507429e-02   +6.721339020018314e-01   +7.562751171995916e-01   +5.291908059760839e-01   +8.188242726065151e-02   +2.437895982908656e-01   +6.797569703578475e-01; +3.263478430731933e-01   +1.069833312082522e-01   +7.720107215619990e-02   +4.627753607664987e-01   +7.094263973036614e-01   +4.254985029615314e-01   +6.955932298375755e-01   +4.002923396528718e-01; +5.832178152141961e-02   +3.737584433085906e-01   +1.408599579690949e-01   +3.817952157698523e-01   +2.935154495218553e-02   +4.369747051306133e-01   +4.960016041454423e-02   +1.592487755747748e-01; +5.366010073247916e-02   +3.111273961874003e-01   +6.887014266976359e-02   +2.186698237130804e-01   +4.796341074944599e-01   +7.461151877205385e-01   +3.162412030219309e-01   +2.255314085332865e-01];
L3I_L3E_iAMPA_netcon = [+3.355867438837490e-01   +3.689031453411324e-01   +5.149140276009913e-01   +7.702550076434597e-01   +2.234760055029296e-01   +5.284527065966181e-01   +2.698777599592644e-01   +1.986042823056038e-01   +2.699017719804821e-02   +6.634082464123753e-02   +5.422441751896531e-01   +5.630081103530672e-01; +6.578538723042461e-01   +2.912842337419738e-01   +3.035488748364158e-01   +7.108384337702606e-01   +6.889780600685865e-01   +3.665043431143813e-01   +7.275013763240994e-01   +7.929753267372160e-01   +3.888738397512008e-01   +1.841561160852274e-01   +5.106647327513075e-01   +6.972888346988719e-01; +2.450007809088215e-01   +5.854395214360990e-01   +2.288280552606626e-01   +2.530592397441098e-01   +5.988260624603891e-01   +6.450772538864171e-01   +6.328953278643992e-01   +6.361650159155116e-01   +1.485181710808280e-01   +6.199337171417045e-01   +2.686545766641156e-01   +6.888042183421786e-01; +7.918737807204375e-01   +4.584158202229475e-01   +4.507054325714117e-01   +6.411607230971899e-01   +2.616583739492758e-01   +3.263037473091178e-01   +3.735395754255095e-01   +6.321945144716772e-01   +6.481715624724516e-01   +7.617059144330783e-01   +3.437269283902656e-01   +6.215668952191140e-01; +8.207299821063545e-02   +6.193728342432212e-01   +3.370799146096554e-01   +8.047549398727601e-02   +2.057002014783531e-01   +1.570845008687234e-01   +1.125870510115936e-01   +2.969239684617678e-01   +4.316157040017777e-01   +1.685689576598394e-01   +7.601780121878161e-01   +5.911501355241280e-01; +3.313991874325930e-01   +6.195693621573372e-01   +3.240665549506135e-01   +7.403274546831121e-01   +1.393548854859107e-01   +7.915251330161319e-02   +2.299464515982684e-01   +8.462451894726167e-03   +1.342101193242106e-01   +8.275388088644589e-01   +6.058376451640540e-01   +7.616760490500828e-02; +5.110558842284680e-01   +6.295056728290920e-01   +6.364455358070198e-01   +4.952701998048958e-01   +4.745580367663736e-01   +3.270724421238454e-01   +2.885772872824569e-01   +7.521620865731368e-01   +5.576720729743602e-01   +1.478312454459268e-02   +1.220458814671261e-01   +1.073145226391761e-02; +7.399568895894514e-01   +7.184109706295042e-01   +4.358675591196769e-01   +5.317974609688847e-01   +6.159426419186070e-02   +2.316144765372929e-01   +4.789459153018694e-01   +7.703627656116488e-01   +5.143234930210551e-01   +6.960332022395845e-01   +1.485046604665127e-02   +3.792710398428036e-02; +1.649585405381188e-01   +2.815403876302374e-01   +2.780184192114865e-01   +3.994897884100307e-01   +2.494501091985789e-01   +3.480085439884565e-01   +6.910146907977297e-01   +1.462577282676465e-01   +5.014419126074992e-01   +6.767727235787813e-01   +5.449571821066573e-01   +7.093451756371260e-01; +5.366021028183170e-01   +3.004197834453334e-01   +4.140252501772606e-01   +3.682248980408987e-01   +1.144742725619233e-01   +4.345881332290147e-01   +4.247226715053749e-01   +8.242373858958566e-01   +6.648236780934224e-01   +2.899322440156412e-01   +2.725613991966198e-01   +2.486920522761744e-02; +5.383348349475160e-01   +5.715236795334405e-01   -1.020583802514678e-02   +8.861760964295308e-02   +1.808441214542317e-01   +5.918832167829728e-01   +2.035562892014751e-01   +4.839516713617599e-01   +1.132080797858057e-01   +1.641286215557015e-01   +3.805777300782287e-01   +5.518446652145472e-01; +2.849527335794200e-01   +1.116925643727451e-01   +3.704919864048093e-01   +7.616933919094102e-01   +9.330484160041079e-02   +1.056248674997926e-01   +4.126824832313599e-01   +5.302392444916040e-01   +3.396292801754350e-02   +1.842508655359785e-01   +2.937639165228041e-01   +7.191271880051185e-01];
L3E_L3I_iGABA_netcon = [+7.188087986080767e-02   +6.471662510711833e-01   +3.677062136600740e-01   +6.258511520759222e-01   +5.870910441320519e-01   +4.963187575661638e-01   +3.544559830779719e-02   +3.399957217103838e-01   +4.842357335476641e-01   +6.954496313351397e-01   +7.755459920027113e-01   +3.626185807408059e-01; +1.125639792200137e-01   +1.500744834013734e-01   +7.465459836859624e-01   +3.783594198747824e-01   +2.244056702825726e-01   +4.458495208386712e-01   +6.094186234840320e-01   +4.814318165046993e-01   +1.171524220143165e-02   +7.946746665232854e-01   +5.668693423232034e-01   +6.770876996241062e-01; +5.161030077806704e-01   +5.540305028054859e-01   +7.042576789805469e-01   +6.380776180238458e-01   +1.460870431816999e-01   +7.007643465399034e-01   +2.815948914965024e-01   +2.544322294115549e-01   +4.843296481676050e-01   +5.491917300048232e-01   -9.936764256460571e-03   +6.334165746532673e-02; +5.924098867784439e-01   +5.781203472976221e-01   +2.070215749668476e-01   +1.750931401620250e-01   +2.841029260122861e-01   +7.491172176679363e-01   +2.727839993814359e-01   +3.565409495214825e-01   +3.583260938903974e-02   +2.885568982372704e-02   +6.239641673784271e-01   +1.717064382701232e-01; +5.403027637432010e-01   +6.875726899180790e-01   +8.158263631866040e-01   +3.408919930596409e-01   +5.892742722203027e-01   +3.748662058251302e-02   +6.503081841937697e-01   +2.193889906145428e-01   +5.711158059843659e-02   +7.560642777348555e-01   +3.786465597914477e-01   +3.678182822410890e-01; +1.878005406404821e-01   +1.758888408058187e-02   +1.164604818747928e-01   +9.548746180159140e-02   +6.991209570388868e-02   +6.756495132644725e-01   +2.585455664043107e-01   +6.531044713879406e-01   +7.175569461313794e-01   +7.261508115013260e-01   +6.706808222647807e-01   +8.925757890014555e-02; +6.956636552956391e-01   +7.820469635827781e-01   +3.733405105297684e-01   +7.389601350671691e-02   +4.802555765247884e-01   +6.106972005782315e-01   +6.990811233991197e-01   +6.821190539728529e-01   +5.687456758517087e-01   +7.190180391001454e-01   +5.115581949573400e-01   +1.175062806271998e-01; +3.846464433908546e-01   +4.433176324478861e-01   +4.753223512247718e-01   +7.284304753446459e-01   +4.779928347290185e-01   +1.596969487410375e-01   +2.400467662162815e-01   +4.322957403072725e-01   +3.126527583266371e-01   +4.121550088598742e-01   +4.754195909444594e-01   +4.858337314859906e-01; +7.380405377738050e-01   +2.087154127621798e-01   +7.218563315328468e-01   +4.008438753465958e-01   +5.989267702354174e-01   +2.606270670027222e-01   +4.509801311231303e-01   +3.882479752711735e-01   +4.036697326338268e-01   +6.933570479917195e-01   +5.702146325504229e-01   +7.775377782059413e-01; +4.715990793089558e-01   +4.059989651414876e-01   +5.609358947368179e-01   +1.685193336205671e-01   +4.984746632342572e-02   +4.243843999613852e-01   +3.622425155102458e-01   +1.292316612550470e-01   +4.221440039618359e-01   +3.281421898803435e-01   +3.424662525891576e-01   +2.510866956642160e-01; +4.146334856457903e-01   +6.007892578460615e-01   +2.863240673937839e-01   +7.396654406045258e-01   +2.339881302792918e-01   +5.294051439986127e-02   +2.359634651984080e-01   +8.239886415909496e-02   +7.333504117663928e-02   +1.458545438766051e-02   +7.470280401832203e-01   +5.639614320617299e-01; +1.444390789102298e-01   +3.203244999892148e-01   +3.268534266816930e-01   +2.904065079343478e-01   +5.137267825422295e-01   +1.626691552949607e-01   +5.061253960251063e-01   +3.392961845363476e-01   +3.016610963809633e-01   +7.260410519852208e-02   +7.658095339590584e-02   +8.584360791692656e-02];
L2E_Input1_iAMPA_netcon = [+1.907830567419324e-01   +1.288095301157073e-01   +3.997804976120661e-01   +3.590048224556131e-01   +4.799200901233567e-01   +5.783431336995137e-01   +3.187552836953669e-02   +4.642550762390309e-01];
L2I_Input2_iAMPA_netcon = [+3.977624599111277e-01   +2.675184260064352e-01   +7.200946728907848e-01   +7.457340942121128e-01   +4.340523552899265e-01   +3.891334829880271e-01   +5.572145651268935e-01   +6.560322009172728e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
