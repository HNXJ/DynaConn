function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.127121079302040e-01   +1.234499128094970e-01   +3.909985607733599e-01   +3.955459215903629e-01   +5.977695905944471e-01   +1.751534327298885e-01   +1.362900234500904e-01   +8.747527675652143e-02   +1.430535554538981e-01   +5.673929255135826e-01   +9.441255566112052e-03   +2.190126026203079e-02   +3.866065871998787e-01   +6.646619063188702e-02   +8.196539559951840e-02   +2.675072763926170e-01; +6.161479008352484e-01   +2.374253619901597e-01   +4.374880588889040e-01   +3.670219587655112e-01   +4.906791964331002e-01   +4.379470200144108e-02   +6.123510837606940e-02   +1.832397219126392e-01   +3.067009823216162e-01   +1.407737681902337e-01   +4.578941166815724e-01   +4.390980845301049e-02   +3.678393680062533e-01   +5.767720279124078e-01   +1.570826269625712e-01   +3.715023913820427e-01; +5.309640939563719e-01   +6.392856803380078e-01   +2.403206719804588e-01   +1.034384367888697e-01   +5.730802621623805e-01   +1.442712677610657e-01   +4.762970799183503e-01   +1.697835510544347e-01   +3.117637974524927e-01   +9.247810499402642e-02   +5.144614867364624e-01   +2.897360131972572e-01   +3.983072934796933e-01   +4.988182755951161e-01   +1.688470794475939e-01   +5.374635294664364e-01; +1.564721148580461e-01   +1.580975861688159e-01   +3.999413582076134e-01   +5.447156699254702e-01   +1.151600823963274e-01   +5.923124755947751e-01   +6.196436290908961e-01   +2.867849725463044e-01   +4.262453462268937e-01   +8.288180763167875e-02   +4.302329557165309e-02   +2.790987648875820e-01   +2.519580484108587e-01   +5.738013841143351e-02   +1.134971768996508e-01   +4.450703858459242e-01; +2.094929851976584e-01   +1.495089479085320e-01   +6.080963863030474e-01   +3.563068485968470e-01   +2.493991325202612e-01   +4.709618690651877e-01   +5.377362864409085e-01   +2.456588745478521e-01   +6.351020051562062e-01   +4.951335077429612e-01   +2.434471279998177e-01   +1.378485317790124e-01   +2.468268062245522e-01   +1.649204797983300e-01   +4.262937339356764e-01   +3.728167270389163e-01; +8.945379835678510e-02   +3.785783145011008e-01   +4.125567983554762e-01   +1.562258774623717e-01   +3.970478943257149e-01   +4.966965892660395e-01   +1.582474757963959e-01   +1.871447663975325e-01   +6.297558441631000e-01   +4.384804873173800e-01   +1.364121241044244e-01   +6.001286576706928e-01   +2.052202228022796e-01   +5.494147174812961e-01   +4.463830014364687e-01   +6.242616616451967e-01; +4.369597881180166e-01   +5.845366832160170e-02   +5.272408737010500e-01   +4.156429249296822e-01   +4.202837523885973e-01   +2.754245018321307e-01   +4.431797837347087e-01   +5.612842986430876e-01   +5.429980855194803e-01   +6.070064005516247e-01   +5.743708412024285e-01   +4.094587431331970e-01   +2.981641390161152e-01   +1.339403344814521e-01   +6.986102758983712e-02   +3.041537502019832e-01; +2.315471166788388e-01   +2.531015226490969e-01   +1.350647341634304e-01   +5.778603788318812e-01   +2.344717252870538e-01   +2.048660094172271e-02   +3.645487267049786e-01   +5.905647597865025e-01   +5.501182574516524e-01   +1.335026097755971e-02   +1.054766426101836e-01   +3.164955403034563e-01   +1.874032578537427e-02   +6.313556949198481e-01   +2.975952204871289e-01   +6.204251945004063e-03; +6.506201342390747e-01   +2.570674433931796e-01   +2.899900913756375e-01   +1.669160729927726e-01   +4.103243958817729e-01   +5.555349957914012e-01   +1.429679467043821e-01   +3.936308015918448e-01   +1.115562977487223e-01   +5.562819957141522e-01   +6.721380499027459e-02   +4.257515685936191e-01   +1.099887185242515e-01   +4.724609087215340e-01   +1.907766503426046e-01   +8.094476944081057e-02; +4.777178574905634e-01   +4.789994667789617e-01   +3.300393995543984e-01   +4.123800403167750e-01   +2.138919478840982e-01   +3.482196805613447e-01   +2.225572896948897e-01   +1.769960789069885e-01   +6.463698941229234e-01   +1.558553250217686e-01   +2.650800480202715e-01   +1.397015672953838e-01   +1.063367728349528e-01   +1.236067581474744e-01   +2.358077625353398e-01   +4.956797574310383e-01; +8.443753742122917e-02   +5.727340162976421e-01   +5.576164988678445e-01   +4.959230657888158e-01   +2.207344448903266e-01   +3.976916780209717e-01   +1.788568778298000e-01   +1.524152043022426e-01   +4.160959593835057e-01   +3.960769855502064e-01   +2.123763894437667e-01   +2.537835486368000e-01   +5.272643655322924e-02   +2.624353473107237e-02   +5.554930302067583e-02   +6.315720591524336e-01; +7.560542265866178e-02   +6.475081946632317e-01   +6.348968193026033e-01   +6.563919498305328e-01   +6.482591228118422e-01   +6.408085833876070e-01   +5.611455022027080e-01   +3.346016548539579e-02   +3.509497968937142e-01   +5.759703785280118e-01   +8.753836925496025e-02   +2.073107553252589e-01   +5.328574287737868e-01   +3.316249769667333e-01   +5.682558029492614e-01   +2.149054547410195e-01; +2.826280191750877e-01   +1.071271628412736e-02   +2.374792473218341e-01   +2.030102149656697e-01   +4.817478704257564e-01   +2.277910472011780e-01   +6.401995138097661e-01   +2.599023702199764e-01   +4.503270383355130e-01   +6.302223748264210e-02   +1.914862497033689e-02   +1.399453700828492e-01   +5.969875503945945e-01   +1.339311552123721e-01   +5.431052827202206e-01   +3.203779357899267e-01; +3.342636991556924e-01   +2.418010060594335e-01   +6.448950264643513e-02   +9.159511807071517e-02   +3.184399823771910e-01   +4.190899691089164e-01   +5.076569009724478e-01   +1.005100901270379e-01   +4.861194418726509e-01   +3.320996400777147e-01   +1.934220066354633e-01   +2.501761481394553e-01   +4.947420685069431e-01   +9.732550781760013e-02   +1.731104481503103e-01   +1.304654280540182e-01; +1.732737680562427e-01   +5.734912570765308e-01   +3.539890439166624e-01   +3.728574788199169e-01   +1.683994033457470e-01   +3.447682391641601e-02   +1.340722153418964e-01   +6.212699423458330e-02   +2.030094803931554e-01   +4.917624031601880e-01   +4.646258919260507e-01   +5.121128354236710e-01   +5.009751225657596e-01   +4.702228845665334e-01   +3.678520293074922e-01   +4.090714582932610e-01; +1.348010689961288e-02   +5.957094241333255e-01   +1.545021736870582e-01   +5.229491750972233e-01   +5.056726754939884e-01   +3.138499472897277e-01   +6.401450023269456e-01   +4.964317821733291e-01   +4.052943711241824e-01   +1.017868982547540e-01   +4.906202730299912e-01   +4.362308507548164e-01   +4.962488815708611e-01   +6.538005778361520e-01   +1.985416831983913e-02   +1.770972787267353e-01];
L1E_L1I_iGABA_netcon = [+5.358168698070173e-01   +6.822803174483673e-02   +1.885791404559651e-01   +3.617856847849705e-01   +6.012568011485256e-01   +3.780904672041526e-01   +4.870540551762819e-01   +6.370989945987962e-01   +5.456047090625341e-01   +3.919850732499947e-01   +3.606580150454547e-01   +5.423221001940397e-02   +4.658829049779908e-01   +1.634810147429293e-01   +5.805169845627659e-01   +1.106806969122963e-01; +7.617544001525046e-02   +8.567320612013632e-02   +6.051888413009023e-01   +4.113900742436837e-01   +4.715528015332794e-01   +4.860533351285051e-01   +1.312163888635186e-01   +2.501264785276407e-01   +6.838267195846333e-02   +5.920515379900977e-01   +5.862410880478547e-01   +1.960369398300582e-01   +6.221437981582576e-01   +4.297208870914579e-01   +4.141591762178899e-01   +1.491420172274166e-01; +4.852869809260362e-01   +2.705156005724066e-01   +2.968019764102520e-01   +5.280000797289784e-01   +5.694747109458658e-01   +5.798225188839417e-01   +4.491745444579062e-01   +1.076506564597975e-01   +1.419067620494064e-01   +3.837598723237257e-01   +3.717079874769429e-01   +4.129294960283759e-01   +6.056606835152404e-01   +1.268236265769445e-01   +3.260938682439907e-01   +5.161767124801315e-01; +4.122025034864394e-01   +3.549630653542700e-01   +2.489828158371644e-01   +6.228214078358639e-01   +1.400987630017742e-01   +3.523048636328121e-01   +1.265362612477598e-01   +1.648623287131786e-01   +2.971323926632470e-01   +2.593592619290866e-01   +3.960003715452695e-02   +2.386118790145079e-01   +1.515648016384394e-01   +2.970683366374741e-01   +2.909217147430219e-02   +3.891744107051236e-01; +2.456254533365370e-01   +8.200279486513537e-02   +5.288447524594568e-01   +5.285755053416799e-01   +6.285689505856124e-01   +8.708572835569581e-02   +2.081104754825041e-02   +1.355280857174425e-01   +5.571661608009558e-01   +3.926983747222909e-02   +6.111603153892400e-01   +3.362980666645587e-01   +3.798685599259172e-01   +1.652868697142201e-01   +4.036284962642829e-01   +1.359090921484660e-01; +9.006579389148527e-02   +3.839336005881961e-03   +1.554476397855000e-01   +6.239862650781293e-01   +4.374178271562786e-01   +3.201291057926437e-01   +3.084729761840309e-01   +5.459891207907878e-01   +4.297168102771974e-01   +1.891366398795996e-01   +9.771083746186032e-02   +1.965819855319427e-01   +1.539127345194902e-02   +5.528206178468932e-01   +7.578511246033222e-02   +5.016005640074650e-01; +6.355476543449610e-02   +3.318550610148915e-01   +4.378637829172317e-01   +1.883583507123986e-01   +2.370173427874860e-01   +3.824553339829868e-01   +3.115046508439235e-01   +6.173243775232834e-01   +9.626074080931704e-02   +4.536901104008606e-03   +4.102415359331188e-01   +5.866124001946983e-01   +4.982655523088808e-01   +4.616693153571055e-01   +5.177236971920015e-01   +2.230430390720712e-02; +3.959477890453670e-01   +4.301153056827323e-01   +2.648458468000635e-01   +5.005585991806917e-01   +4.342127731706464e-01   +6.595553479440888e-02   +5.603512484596543e-01   +4.403289206054169e-01   +2.304533316422803e-01   +5.683169453887457e-01   +5.626325347445681e-01   +6.370535231427379e-01   +1.859766709666936e-01   +4.024127718521632e-01   +2.094064158512201e-01   +6.328275740082693e-01; +4.420803655893359e-01   +4.062082419087518e-01   +5.501757360027624e-01   +3.889292224194770e-01   +1.298488655665569e-02   +2.291880007450622e-01   +2.848951820660513e-01   +5.471718942343976e-01   +4.110766268884580e-01   +4.797957947474251e-01   +5.243523143267026e-01   +5.709151633668579e-01   +3.438565798855326e-01   +1.833292397430838e-01   +3.171255955293851e-01   +4.886976839068272e-02; +1.647868517581602e-02   +1.039295566411020e-01   +6.265403959612145e-01   +6.464833343744686e-01   +1.798788901996575e-01   +6.419563509793459e-01   +3.834099087216686e-01   +4.187339407005823e-01   +4.015907193457963e-01   +1.194353884059020e-01   +1.817230263879493e-02   +2.198897641606508e-01   +1.288680839458065e-01   +9.946046667753622e-02   +6.232229785306563e-01   +2.734708812618594e-02; +4.479037862199805e-01   +1.280229099800134e-01   +4.675986508146142e-01   +5.790159943048409e-01   +5.024112161670957e-01   +3.351233481779387e-01   +3.115167381036492e-01   +4.888610232685092e-01   +1.180101560055961e-01   +3.270531388493940e-01   +5.677862870998989e-01   +3.648551916888319e-01   +5.388597495476066e-01   +3.704310348618268e-01   +4.155747202100561e-01   +1.829088877795870e-01; +2.239639218285009e-01   +7.746981316179379e-02   +2.362848534611653e-01   +6.348711042922719e-01   +6.438692175545085e-01   +2.983598579231244e-01   +3.241324629238791e-01   +5.112371605644968e-01   +2.659930529040216e-01   +2.554314714533639e-01   +9.059685004426807e-02   +2.145069933236943e-01   +2.619814952287438e-01   +8.746775632079359e-02   +7.728218063216991e-02   +4.166750008405951e-01; +9.770265759447971e-02   +5.869697176923856e-01   +3.037416652157905e-01   +5.913266171525540e-01   +4.526694432777954e-01   +2.532649942664814e-01   +1.993384467118782e-01   +3.490007879021805e-01   +3.957352308395204e-01   +2.676487853340009e-01   +3.863969755780315e-01   +3.977240587220193e-01   +4.226868365497777e-01   +3.520894846437324e-01   +1.381804554371218e-01   +3.147582569902658e-01; +2.755235795877720e-01   +3.164567767741594e-01   +5.978616960069300e-02   +6.543383976762339e-02   +3.034483294812832e-01   +5.251071461983199e-02   +2.333259428350057e-01   +6.503757400799782e-01   +5.761607695144645e-01   +1.004896406422975e-01   +2.335914980707741e-01   +2.148452371024956e-01   +3.700532266799267e-01   +6.442899260079781e-01   +2.613083748908521e-01   +4.508545052596268e-01; +4.483124272548974e-01   +5.240801067143637e-01   +2.024839822861324e-01   +1.886245964469329e-01   +6.190480047095328e-01   +2.589165741629423e-01   +3.132034646564136e-01   +1.517422089904188e-02   +4.862184149241703e-01   +5.466328369654868e-01   +4.981886685434883e-01   +2.192782928299368e-01   +4.609077170969385e-01   +6.127799695906136e-01   +2.098838796328081e-01   +5.099761566671217e-01; +5.526125735215993e-01   +3.880103987860654e-01   +4.605054361358313e-01   +1.189385134817172e-02   +3.964549820665850e-01   +6.332709046242252e-01   +1.223854374235813e-01   +2.592229262591952e-01   +3.649309200111571e-01   +5.938715256371613e-01   +5.722162547410193e-01   +2.940474884939755e-01   +5.277939921500743e-01   +4.238751428710667e-01   +6.519654682167855e-01   +6.437750071873549e-01];
L2I_L1I_iGABA_netcon = [+8.555868559627912e-02   +1.718530809637329e-01   +6.309419688117410e-01   +1.660854693464220e-01   +2.273384122084782e-01   +4.957718090253035e-01   +6.102818115175346e-01   +5.135670531440941e-01; +2.309478816712706e-01   +9.152642741965435e-02   +5.595326604128820e-01   +3.257580924635048e-01   +2.947300686489333e-01   +6.565575957224112e-01   +1.897880922751607e-01   +1.654912848667702e-01; +2.961778648946398e-01   +5.024734611666297e-01   +6.233909168670042e-01   +3.612144561253011e-02   +1.758566611525811e-01   +7.058673081109108e-02   +5.792059313427284e-01   +2.600320075116765e-02; +2.265821014630859e-01   +3.694704167158118e-01   +2.139175568342124e-01   +1.469487382062179e-01   +1.914029665191253e-01   +1.008083223384536e-01   +1.670596247124639e-01   +2.807082914494793e-01; +4.797563676401261e-01   +6.209482862326042e-01   +3.078737050326834e-01   +1.086809053094761e-01   +1.907602824428712e-01   +5.717931702211704e-02   +5.348370899656377e-01   +4.138247476487590e-01; +6.001324988579994e-01   +3.294021513901407e-01   +5.082293303962281e-01   +2.732932123688910e-01   +2.879099013989266e-02   +4.412214498560835e-01   +3.678484613239433e-01   +4.563834880223549e-01; +4.615983083549730e-01   +6.342215678234052e-01   +6.227401682688811e-01   +4.328268791030734e-01   +2.341748381824830e-02   +6.475262869899685e-01   +2.575834648280693e-01   +3.840692528707333e-01; +5.061025951701679e-01   +3.910625240618166e-01   +6.206885541186075e-01   +6.529296923095035e-01   +5.136616867627053e-01   +8.134933026101106e-02   +1.945133671697249e-02   +6.045004776878111e-01; +6.246754674511092e-01   +3.403755005972912e-01   +3.552519656692246e-01   +3.099568677819259e-01   +5.152052686223463e-01   +6.324381002318465e-01   +7.725073667667544e-02   +1.392820109853643e-01; +2.005327440760457e-01   +2.912637157597255e-01   +8.216360171556222e-02   +1.574098455691549e-01   +1.585444458007711e-01   +5.917290089116435e-01   +4.768537771406675e-01   +1.881163079213330e-01; +4.128982504457696e-01   +1.500074916182562e-01   +6.566707870009323e-01   +1.139573469748732e-02   +2.972880797873725e-01   +5.021500771867143e-01   +2.256389864940976e-01   +3.167299874636462e-01; +3.471309307318178e-01   +2.080050741929816e-01   +4.677034559840338e-01   +2.405170890684985e-01   +3.336182013932940e-02   +4.398023774534446e-01   +2.654610085753368e-01   +5.902231928132481e-03; +2.339728579674813e-01   +6.082546828068464e-01   +3.925156489443316e-01   +7.352838579113918e-02   +3.807360792019501e-01   +2.115069739803603e-01   +4.674563473762106e-01   +1.234672339472060e-01; +6.136749447164643e-02   +3.428423973427437e-01   +5.277925897616668e-01   +2.325058607383829e-01   +5.030832741521523e-01   +1.331088646361120e-01   +1.297103150278123e-01   +3.207808971924049e-01; +4.288964396596937e-01   +3.184697119844691e-02   +3.621134032481106e-01   +6.428101340792304e-01   +3.002743799149370e-01   +4.427170070678194e-02   +1.378203754276253e-01   +3.153957358526678e-01; +5.170868411731444e-01   +4.287684439679264e-03   +5.561385773078002e-02   +5.844306653850674e-01   +2.420547513485054e-01   +4.819364836809763e-01   +7.662911770474554e-02   +1.783392237633423e-01];
L1I_L2I_iGABA_netcon = [+6.263182312845927e-01   +5.946961658550810e-01   +4.782169582203338e-01   +9.618705688100021e-02   +8.398538207930875e-02   +5.982791952173657e-01   +8.757086038071815e-02   +1.592687524999490e-01   +1.010137310693034e-01   +2.164356751096412e-01   +4.844875305558785e-01   +3.235215523299158e-01   +2.133715806318928e-01   +4.120306508522598e-01   +5.815092596584456e-01   +5.864744785320642e-01; +3.349797122588947e-01   +6.042521999863690e-01   +2.344254614208158e-01   +2.275283683538072e-01   +5.848658404594552e-01   +6.215543166259193e-01   +3.155490527588991e-01   +1.055512480358589e-01   +3.096002060425336e-01   +5.832017020408058e-01   +4.045424522835332e-01   +6.039657881138203e-01   +3.664208473874075e-01   +2.573780647697020e-01   +1.714608088418893e-01   +3.530381748123032e-01; +2.639276480825613e-01   +3.116913589194486e-01   +2.854447901459091e-01   +3.842445478422014e-01   +2.116615170195403e-01   +4.818484384297435e-01   +1.969314487483903e-02   +5.319757569745748e-01   +5.055479745617099e-01   +3.497666955199752e-01   +1.106794804948776e-01   +5.363581100119047e-01   +2.317898135832856e-01   +3.868597533583193e-01   +2.919184239150822e-01   +1.167237235425078e-01; +5.515452754465702e-01   +2.458597113153085e-01   +3.465701186950284e-02   +2.400465208036163e-01   +3.979694431291988e-01   +2.011485797505272e-01   +1.594205151699190e-01   +2.047387307862949e-01   +6.428358641800412e-01   +8.251227624626200e-03   +2.124917784878494e-01   +1.085228844276672e-01   +6.488023695225994e-01   +4.104809181517400e-01   +7.787025879541763e-02   +4.185048208073536e-01; +6.265677374472723e-01   +6.010385262827593e-01   +2.781558581986294e-01   +2.531744600410614e-01   +1.740307506938111e-01   +6.703875095136628e-03   +1.147306943310704e-01   +3.253436746468539e-01   +5.390568977154817e-01   +4.192207275488042e-02   +6.372754242511659e-01   +3.356584084430956e-01   +2.688470491123405e-01   +5.028634039734515e-01   +1.999067458429925e-01   +3.552680566541282e-01; +6.497271462672951e-01   +3.172454864503220e-01   +1.357112964949495e-01   +4.050390928514705e-01   +3.924931485402230e-01   +1.861652006029946e-01   +5.197786072109036e-01   +5.978030675673420e-01   +3.169925695301158e-01   +5.204601783626651e-01   +5.862138388415521e-01   +2.955707424660866e-01   +4.627573234908559e-02   +3.255271744422474e-01   +3.271042130675945e-01   +2.425874290952120e-01; +2.968782059589175e-01   +9.084601791824637e-02   +3.570764032136947e-01   +3.267800441334424e-01   +5.225305709296152e-02   +6.175756830784696e-01   +3.062072196270307e-01   +6.771632878035014e-02   +4.499636160322796e-02   +7.312708147234964e-02   +4.705872714085765e-01   +3.289882971133059e-01   +1.115700913642528e-01   +1.591387605662701e-01   +2.021170819126113e-01   +1.868485960730320e-01; +2.167161375168006e-01   +1.201311247279566e-02   +4.032144351575228e-01   +4.132080976870305e-01   +4.640100845617078e-01   +1.488078818075396e-01   +3.060621947522600e-01   +1.191635306656503e-01   +5.138376735415821e-01   +5.038847737519481e-01   +4.969973228880785e-01   +2.881716457545989e-01   +6.478793608298546e-02   +1.842061641379494e-01   +2.997260422249766e-01   +4.685850975463251e-01];
L2E_L1E_iAMPA_netcon = [+5.061058454945002e-01   +3.448265437221926e-01   +4.741173318984216e-01   +2.244778621982949e-02   +8.429351752533258e-02   +3.370659041315728e-01   +2.208146807302060e-01   +1.722272872712542e-01; +1.109725548338721e-02   +4.457130458943910e-01   +4.262213100541015e-01   +4.508421443226143e-01   +6.518152926592932e-01   +4.445687859689615e-01   +5.193961939866428e-01   +6.413417145033109e-01; +2.165993080565602e-01   +4.161872243611190e-01   +1.845488148193936e-01   +4.396013110722993e-01   +3.363018508909399e-01   +5.172618468465706e-02   +3.799587024127720e-01   +4.615577844967971e-01; +1.398833645266365e-01   +5.548952838820073e-01   +4.522829639984333e-01   +3.152109470705972e-01   +2.792151440368875e-01   +8.266956807463874e-02   +1.630956669819466e-02   +2.767866058122421e-02; +6.221255103857266e-01   +2.083423472458847e-01   +1.296598822773026e-02   +6.216575980629659e-01   +6.454705328315269e-01   +1.502320043544280e-01   +3.658643078781559e-02   +3.986655155788728e-01; +5.388853571195990e-01   +4.980797473616521e-01   +3.073997984679120e-02   +2.922096297685184e-01   +3.186604649570046e-01   +4.807943987178350e-01   +3.487497537750010e-01   +1.901343886630456e-01; +1.441907711934047e-01   +4.818718566629948e-01   +1.004533993217137e-01   +2.368313786432913e-01   +2.319340357501372e-01   +2.970863165870597e-01   +3.983385427641498e-01   +5.142850519211100e-01; +5.186016288358597e-01   +3.951436494902595e-02   +5.098564273555604e-01   +5.002264802502367e-01   +2.834083758265467e-01   +3.304808673070881e-01   +2.722928683145968e-01   +3.815460497293335e-01; +9.562185926377063e-02   +2.536677172509915e-01   +3.813071020988381e-01   +3.564200786243885e-01   +4.521486120659067e-01   +3.460473675340278e-01   +5.562156673051057e-01   +3.581579472970015e-01; +3.956421833682007e-01   +3.373743480768216e-01   +5.444980387524274e-01   +1.322615903293452e-01   +5.017079048256141e-01   +3.435884892997360e-01   +5.037877885372966e-01   +2.213968445817923e-01; +6.017870720010147e-02   +3.205786841119596e-01   +3.475316539964076e-01   +6.373402691241991e-01   +9.999338023328769e-02   +2.947336548448248e-01   +5.514685177051646e-01   +6.011797318007402e-01; +4.821027247666652e-01   +5.848155855845331e-01   +3.053979600810886e-01   +4.784981887654675e-01   +2.077022721099050e-01   +3.364186997640757e-02   +2.809448554752029e-01   +3.331534515721170e-01; +4.101619540146900e-02   +4.422933078777357e-01   +1.301745462857443e-01   +3.659458839654937e-01   +9.531806946950623e-02   +5.873883996437661e-02   +2.873713097692219e-01   +1.915542751385362e-01; +3.029213896076458e-01   +1.617369989461928e-01   +5.578210477651842e-01   +2.273619957826973e-01   +3.590082104094882e-02   +7.651465506906226e-02   +3.871962795343266e-01   +2.247240660164920e-01; +4.502675853473844e-01   +3.864492158391853e-01   +6.147530263039885e-01   +4.368702934769251e-01   +4.764394379969281e-01   +3.064019366986243e-01   +4.552185403185696e-02   +7.857624291358950e-02; +1.352190429085327e-01   +4.137557845487039e-01   +4.408601118884776e-01   +2.779674038635589e-01   +3.796056050582903e-01   +6.532571204993836e-01   +6.486191174993658e-01   +3.832823512115032e-01];
L1E_L2E_iAMPA_netcon = [+6.014211126125428e-01   +5.446509121258949e-01   +3.582787476871477e-01   +1.189707959808032e-01   +3.489146353207031e-01   +5.416788957128745e-01   +2.652645066297085e-01   +3.227160594462218e-01   +5.264297400811234e-01   +6.356320457540467e-01   +5.680909192477366e-01   +5.887656514529218e-02   +5.830469073320674e-01   +5.427428980634814e-02   +1.417691648345584e-01   +2.548316887064034e-01; +4.455199119811213e-01   +1.787605138786643e-01   +1.818961118399360e-01   +2.034201862722705e-01   +6.458543626577358e-01   +1.456065849186890e-01   +2.939195687721511e-01   +6.168479215951395e-01   +4.050706863250468e-01   +4.839938909659831e-01   +1.380434705257526e-01   +2.735819690778928e-01   +3.755376128696982e-01   +6.091133014163582e-01   +3.114913616070472e-01   +5.748713090640176e-03; +4.937714645745921e-01   +1.431270453517118e-01   +4.008873904107517e-02   +2.199074793481316e-01   +2.924433913057570e-01   +1.048517688626150e-01   +5.915557081793142e-01   +1.941144521064086e-01   +3.663261931508588e-01   +1.033966880974304e-01   +3.350271205473496e-02   +1.417952030437463e-01   +5.723267396236014e-01   +3.288214844443459e-01   +2.853642614538348e-01   +4.613822198375928e-01; +1.650668196725626e-01   +1.071235613923343e-01   +1.475385409223047e-02   +6.548197162979126e-01   +3.550587956026587e-01   +6.214117353944459e-01   +6.112323255412240e-01   +4.134542210210413e-01   +2.610858033155645e-01   +4.585368463349108e-02   +5.179065002708104e-01   +2.636993482533980e-01   +2.736272053975042e-02   +1.777453709241919e-01   +5.617452191540596e-01   +2.599286999909011e-01; +6.283024242276636e-01   +2.222409420723308e-01   +9.174739810354740e-02   +5.072077593653679e-01   +1.616652218567536e-02   +2.728745645159699e-01   +1.153905915446053e-01   +2.556919239862284e-01   +2.333029737732729e-01   +1.403313537374971e-01   +8.362776769709222e-02   +5.754007848813978e-01   +2.400740596279741e-02   +7.766396197761451e-02   +5.316352263892811e-01   +3.989619649621701e-01; +6.330362958183305e-01   +2.914761523267217e-01   +6.255834118113889e-01   +1.712927723523203e-01   +2.071275520223689e-01   +1.994361015253388e-01   +2.819165748335594e-02   +1.825223897656267e-01   +1.312095212700862e-01   +1.023292833193561e-01   +1.001843111134890e-01   +4.530578027011148e-01   +6.205976760225885e-01   +4.254855673589880e-01   +5.954550027083887e-02   +6.536696921983973e-01; +2.983827978893896e-01   +5.823393171950023e-02   +1.741711949287527e-01   +6.070078019816314e-01   +1.407999633110191e-01   +2.779970681354018e-01   +6.379970307669830e-01   +4.141649015151050e-01   +4.067865656811138e-01   +7.174530883484379e-02   +1.655357872697020e-02   +2.473627752504659e-01   +5.490628738308724e-02   +4.977083250794889e-01   +2.748767461380008e-01   +3.601583578954683e-01; +5.472512855180802e-01   +1.869870554095340e-01   +5.701970465163912e-01   +4.370182851288844e-01   +3.555412052299555e-01   +3.260205883973464e-01   +9.729969586517806e-02   +1.757627198925110e-01   +1.210244866616011e-01   +2.789190371190861e-01   +5.723258807714819e-01   +6.402256304771595e-01   +5.170568006505297e-01   +2.211037389440183e-01   +2.053286783015284e-02   +2.679886333616202e-01];
L2I_L2E_iAMPA_netcon = [+4.145528737682634e-01   +5.306651005055493e-01   +6.127261033017788e-01   +5.056687597750258e-02   +1.915295566959015e-01   +1.385970106453529e-01   +6.543031021982559e-01   +6.536268604954175e-01; +3.368812335378695e-01   +1.705463049778027e-01   +2.406116487489418e-01   +6.618153007418145e-02   +2.225292945368297e-01   +8.863705427798708e-02   +5.201107732906435e-01   +1.321956999282751e-01; +5.816559361645360e-01   +2.312682763994499e-01   +1.226709161318743e-01   +3.186553552857949e-02   +1.013622001914182e-01   +1.390303235392103e-01   +6.161504074794866e-01   +5.312213840997527e-01; +1.256658928692536e-01   +1.853617604673061e-02   +1.526562291043025e-01   +6.227365167913993e-01   +4.476204692508320e-02   +2.336716775476454e-01   +1.901872557164860e-01   +2.438279613642439e-01; +9.234080200216022e-02   +5.020594479967584e-01   +1.367976419101150e-01   +4.357712342137958e-01   +4.485384351079341e-01   +3.074626611332854e-01   +5.900110000388187e-01   +3.708591525036040e-01; +7.825199195336983e-02   +3.336409755878182e-01   +3.845506929467704e-01   +2.321295506869036e-01   +3.481261946340653e-01   +2.339628444849758e-01   +8.638841929997285e-03   +2.999170214409696e-01; +2.143191058783103e-01   +4.671793461878223e-01   +3.397814019086506e-01   +4.094673564269370e-01   +2.595646172637683e-01   +4.194251231246382e-01   +7.724673957665722e-02   +2.651922709067578e-01; +7.516732180829890e-02   +1.206282700516651e-01   +9.710583973009033e-02   +2.105200394788000e-01   +3.715497504508845e-01   +5.300125139449451e-01   +2.044928812009533e-01   +2.227648162200040e-01];
L2E_L2I_iGABA_netcon = [+4.371814998814649e-01   +1.325881276326163e-02   +1.177091731390062e-01   +4.364071412053788e-01   +8.124262179625726e-03   +3.202390868278356e-02   +3.668194218752185e-01   +2.232425426113182e-01; +6.139630264176368e-01   +9.539798235485446e-02   +1.785101804141651e-01   +2.539900815599673e-01   +5.073825067663977e-01   +4.718059431393570e-01   +2.822480399786211e-01   +6.516974354993864e-01; +3.692758739461263e-01   +6.899303651495199e-02   +2.542062950697380e-01   +5.304892922600406e-01   +3.546869054246936e-01   +3.853103958470127e-01   +5.658632165777246e-01   +3.198370052853255e-01; +2.102645892046796e-01   +3.322869527020286e-01   +4.321077354654965e-01   +1.625016540469803e-01   +9.794875059902140e-03   +4.342024671456024e-02   +3.666756661781082e-01   +5.730531539330548e-01; +4.619303826963430e-01   +4.635952514477011e-01   +2.756045567165604e-01   +4.868872802421669e-01   +3.292651897250970e-01   +4.661754872282495e-02   +5.560258158867422e-01   +2.520785156309429e-01; +6.190583957486143e-01   +6.642437484924267e-02   +4.979689196406131e-01   +1.459272921306479e-01   +5.713313232130782e-01   +3.439110836904375e-01   +5.092075772770502e-01   +3.580216925585212e-01; +1.683328447063569e-01   +1.534420713327193e-01   +5.028345685610859e-01   +5.268075708921707e-01   +2.267444892760709e-01   +2.169949808746133e-01   +1.359781973115681e-01   +4.719538447708619e-01; +1.652245831858679e-01   +1.035337973270543e-01   +1.814045753996529e-01   +1.780482396323743e-01   +4.671171116207958e-01   +2.354816436889850e-01   +6.297209424382809e-01   +4.234789359102085e-01];
L3E_L2E_iAMPA_netcon = [+3.915041998693897e-01   +3.607831090899619e-01   +4.362272553565761e-01   +3.800484700341280e-01   +3.032683605402328e-01   +5.834599690845136e-01   +6.375597200180040e-01   +1.137779467303093e-01   +1.270865578959738e-01   +6.552781992415403e-02   +3.821821961451724e-02   +2.133596134258197e-01; +4.483659650333016e-01   +5.491304755423176e-01   +4.104530211141134e-01   +4.129561793867897e-01   +3.059100060266258e-01   +1.284398388597655e-01   +6.088980318884373e-01   +3.095581573559369e-01   +2.725672044674332e-02   +5.712993695231887e-01   +5.051333795695483e-02   +1.624793659480250e-01; +3.361655030910735e-01   +3.898344051042220e-01   +3.482896094934999e-02   +4.221106505136414e-01   +2.926993672067743e-01   +2.266150643175238e-01   +5.076508406743591e-01   +9.686067300569447e-02   +3.297235730962746e-01   +1.147813884939662e-01   +2.284647600263028e-01   +4.707697735581735e-01; +4.815746336344963e-01   +6.247851543716376e-01   +2.589140347421232e-01   +2.249674372111817e-01   +5.716400628128491e-01   +2.766989433721151e-01   +3.590173467949959e-01   +4.163367146474233e-01   +1.428025114523373e-01   +1.124433262033659e-01   +4.675100556105117e-01   +3.709802942328914e-01; +4.624394716899861e-01   +1.717423274654764e-01   +3.747419393485678e-01   +5.294435173295925e-01   +2.655359530414084e-01   +1.573071168386505e-01   +6.546889957877872e-01   +1.807061892025555e-01   +6.923524848311600e-02   +2.669986614715373e-01   +6.196652478631458e-02   +5.287864373342127e-01; +3.878021509495744e-01   +3.739431991248161e-01   +4.615110882933763e-01   +6.490343416367164e-01   +4.965299530189110e-01   +5.536407408602109e-01   +1.889581881816501e-01   +5.198150123492101e-01   +3.764718006188947e-01   +3.942492849207911e-01   +5.477466224805280e-01   +4.255433730467907e-01; +1.181344984111081e-01   +6.066317689127902e-02   +3.296487425725739e-01   +1.096154066297214e-01   +2.443963286845438e-01   +2.181663978754440e-01   +5.309937330198291e-01   +2.417977608791025e-01   +2.241788683966205e-01   +6.315544984977732e-01   +3.131289790247077e-01   +4.462337054385520e-01; +9.851937748926444e-02   +2.750532763798401e-01   +5.045603880713330e-01   +3.475766106100882e-01   +5.818951368284352e-01   +3.597058954847888e-01   +5.235419928107325e-02   +1.984049476056416e-01   +2.384590264212979e-01   +5.159946992754059e-01   +6.040556805614556e-01   +2.347600918190514e-01];
L3I_L2I_iGABA_netcon = [+8.765067592690687e-02   +4.893536109689809e-01   +3.963739080209134e-01   +1.896206684119296e-01   +2.688582786833013e-01   +5.229925251606865e-01   +2.915594801411937e-01   +5.535327444920635e-01   +3.791859904272729e-01   +1.851416504816173e-01   +1.880766364036263e-01   +2.889001738280859e-01; +4.952004845794808e-02   +2.220450253589957e-01   +6.211064792725870e-01   +1.404604060971134e-01   +5.384907625252554e-01   +5.437583213958309e-01   +2.962251015216964e-01   +2.543843094216123e-01   +3.076922706047809e-01   +4.441464387209239e-01   +5.495090295005773e-01   +4.275039090869454e-01; +5.192881591947029e-01   +4.254818347987328e-01   +4.333744531570081e-01   +4.011218618223889e-01   +1.927085432441445e-01   +5.314769098247017e-02   +4.753356645045129e-01   +6.582083565448776e-01   +4.376219665882879e-01   +3.670273537042472e-01   +5.720380052730574e-01   +5.454087748596306e-01; +5.040825278687876e-02   +6.172156444319454e-01   +6.332897632699554e-03   +6.123620442918799e-01   +3.615792557909761e-02   +2.819605980976557e-01   +2.205181125021620e-01   +6.097045148144160e-01   +2.196946991365882e-01   +6.117669192846441e-02   +5.868204605167697e-01   +1.079345897999832e-01; +1.185586470888564e-01   +5.117030667075124e-01   +3.624683090564935e-01   +2.015603654729308e-01   +4.196869910140741e-01   +1.061340544825489e-01   +5.813988370813200e-01   +5.941790393214751e-01   +5.146660764045361e-01   +4.349858354923252e-01   +6.542817948845867e-01   +2.128362220429490e-01; +1.310100449983096e-01   +3.538404366739532e-01   +1.984710842253594e-01   +4.477131379962295e-01   +3.308713337608120e-01   +6.134680796625411e-01   +1.941407314706594e-01   +5.852212095078133e-02   +5.969652925939430e-01   +3.609073630123056e-01   +2.743458044497707e-01   +6.006548945590084e-01; +7.578969200340846e-02   +3.496445254269472e-02   +1.216736310948642e-01   +3.901759684929776e-01   +1.626691479528085e-01   +5.052705805742854e-01   +1.436128882600200e-01   +3.073439808450385e-01   +4.896359076508425e-01   +1.409016065450989e-01   +8.288443762209745e-02   +1.994896623610187e-01; +3.217047762241872e-01   +1.920689108539032e-01   +5.107996003622765e-01   +6.132127508187115e-01   +5.909507532183619e-01   +4.671259838609763e-01   +5.187672347403894e-01   +6.470282860872962e-01   +6.014364808195075e-01   +2.503337902843791e-01   +5.637060132356218e-01   +1.691158989535753e-01];
L2E_L3E_iAMPA_netcon = [+1.835818466217251e-01   +4.463431256049341e-01   +5.782403697731081e-01   +5.362912328853097e-01   +5.756494126278604e-02   +3.595246754016290e-01   +2.304614746239269e-01   +3.581689799874940e-01; +6.359398131742267e-01   +4.786458093017504e-01   +5.481316482856726e-01   +4.364053514581601e-01   +6.705134597516543e-03   +2.685955628326326e-01   +1.910573460318624e-01   +7.270563960402766e-02; +6.303398119871712e-01   +1.995729039443736e-01   +6.216065114228080e-02   +4.985070751282342e-01   +1.165128006398589e-01   +9.499717015847127e-02   +5.934753999896448e-01   +6.667800575866711e-02; +1.595583903746979e-01   +4.833473367669682e-01   +2.254759356643200e-01   +3.413471194014411e-01   +2.712089936724675e-01   +3.300699232370351e-01   +3.120325169264362e-01   +5.875990654736679e-01; +4.153913927817095e-01   +5.275572018337069e-01   +1.712924849947198e-01   +1.833999296413873e-01   +5.434863386796299e-01   +1.706804077432548e-01   +4.462633153876912e-01   +3.334998374647908e-01; +3.517000291830961e-01   +6.114850470781429e-01   +4.161331682100264e-01   +1.085400495321564e-01   +3.708975665667106e-01   +1.997814973374508e-01   +4.607486369381594e-01   +4.226643678059785e-01; +1.120859158529374e-01   +8.000966431198295e-02   +1.203427192610317e-01   +2.740556816003661e-01   +1.152176959480073e-01   +6.294082866265118e-01   +3.807602946481831e-01   +6.511783849261886e-01; +3.882733464409055e-01   +4.999692242348011e-01   +5.246275363455614e-01   +1.888782873555488e-01   +1.422393202046317e-01   +5.931892182719929e-01   +3.371340410545557e-01   +2.598199511713580e-01; +2.786079349261137e-01   +3.270405406645721e-01   +6.100783301120272e-01   +2.452259731129836e-01   +4.676988892936125e-01   +5.358052555651333e-01   +4.755488740441097e-01   +3.267782367440171e-01; +5.934683887799655e-01   +3.363537851443403e-01   +5.332637457045055e-01   +4.315046562421083e-01   +3.179353453968455e-01   +3.087854179278855e-01   +2.944002440910624e-01   +3.720253201294910e-01; +4.131195123639518e-01   +2.261818597602749e-01   +7.427268115312605e-02   +5.254483372121667e-01   +5.009508574663427e-01   +4.888659244849669e-01   +1.043385862032073e-01   +2.968994253295332e-01; +5.806506349750217e-01   +2.789581236313350e-01   +1.540895651985277e-01   +1.951327151743231e-01   +3.351557411727560e-01   +5.765243666776618e-01   +3.399431173803638e-02   +3.929134806830163e-01];
L2I_L3I_iGABA_netcon = [+1.216641925518634e-01   +2.346611430610420e-01   +3.905130862294948e-01   +2.810365974787162e-01   +4.729572947223925e-01   +4.531028601600605e-01   +1.219266574153710e-01   +5.587204623642649e-02; +1.292261302870763e-01   +2.645113680217765e-01   +5.306986418979609e-01   +5.911090722466446e-01   +2.683390119365909e-01   +4.077676762282488e-01   +1.856154239162774e-01   +5.994457634556295e-01; +4.484206993795691e-01   +5.367951029075494e-01   +3.578428862064404e-01   +4.155502696826665e-01   +3.750682833586940e-01   +5.069769134329111e-01   +3.755644299900384e-01   +1.836162922651885e-02; +5.052056817694789e-01   +1.381751211670744e-01   +4.533658481141779e-01   +5.442537038834362e-01   +2.791862638108892e-01   +9.723927466841829e-02   +6.497723691967705e-01   +3.874265320408338e-01; +3.575043501476478e-01   +8.465929338313813e-02   +4.596035378740394e-01   +2.977245703304951e-01   +2.187321217561395e-01   +4.117656066096676e-01   +2.778142193735670e-01   +2.003531689699632e-01; +4.217879025693447e-01   +5.842965766946573e-01   +3.210597595281841e-01   +8.930643043263504e-02   +5.872737765034652e-01   +2.170585483237741e-01   +6.227575491063880e-02   +6.176705945315187e-01; +6.547098422290029e-01   +1.098066166257090e-01   +2.497922251578824e-01   +2.720232565434480e-01   +2.521264012445595e-01   +3.891115858316918e-01   +3.489556746130744e-01   +6.562174976265164e-01; +3.531596727486685e-01   +1.060354021882691e-01   +1.080804024772742e-01   +4.978783235879847e-01   +1.934476364794626e-01   +3.306182812497795e-01   +1.811228515881487e-01   +1.991167650306930e-01; +5.563799016062743e-01   +1.025597882763662e-01   +3.603288533228690e-01   +9.438487638763648e-02   +3.951277744472814e-01   +5.055098230593112e-01   +3.923977510113890e-01   +3.301581497760949e-01; +6.031861708923857e-01   +5.479503749449102e-01   +2.584762804893966e-01   +4.010935045600836e-01   +1.668218380081147e-02   +4.175026591479470e-01   +2.212303011282693e-01   +2.816837784524229e-01; +3.342857139806371e-01   +3.824011374520289e-01   +3.608899607623571e-01   +4.499181195344208e-01   +2.810768700221704e-01   +1.848307537735500e-01   +5.197270048556443e-02   +9.680492373758695e-02; +2.011421424797244e-01   +4.017742073401243e-02   +2.975421930251650e-01   +3.013252633658556e-01   +4.250517364334249e-01   +4.889177112432316e-01   +5.577657566527089e-01   +2.947955471660295e-01];
L3I_L3E_iAMPA_netcon = [+5.336282192887947e-01   +2.285803045811118e-01   +4.684513284862811e-01   +1.011317849014038e-01   +6.285109156773067e-02   +4.930076682550028e-01   +3.008244908544318e-01   +1.460128668257513e-01   +2.335810973145737e-01   +1.538955907102033e-01   +6.297347048438146e-02   +4.120909065842006e-01; +5.443494370496080e-01   +4.504543389745620e-01   +5.807408464720752e-01   +8.460492439341127e-02   +3.942408529502333e-01   +1.898108703315958e-01   +3.064963753984808e-01   +1.551705206082717e-01   +4.145660148609742e-01   +5.996977902996192e-02   +2.740283823777061e-01   +5.445624135432170e-01; +2.120533875570674e-01   +1.903814110051827e-01   +1.661799772916276e-01   +5.248482982233748e-01   +4.995758572105969e-01   +5.750297248329301e-01   +2.422108234461349e-01   +5.735559074902057e-01   +6.470928492627817e-01   +1.238742426377938e-01   -6.657256861980673e-04   +4.189387004321223e-01; +1.264332367878611e-02   +3.986873735445374e-01   +1.078315354778571e-01   +5.743731015858441e-01   +5.643033789623371e-01   +9.415249366366124e-02   +5.540704609718922e-01   +2.251255714053972e-02   +4.139271820164582e-01   +1.956499463068665e-01   +3.472042337155795e-03   +5.058789473711830e-01; +1.038723801101043e-01   +4.180046135901356e-01   +3.248552313989163e-01   +5.886092948134863e-01   +5.231420704227283e-02   +1.529060655946163e-01   +1.339727991438341e-01   +9.990747051112958e-02   +2.128372759465308e-01   +2.055354115004425e-01   +3.261833845414941e-03   +2.451391942626010e-01; +5.117840857823615e-01   +1.681379963383599e-01   +1.011168345221237e-01   +3.075262903969097e-01   +2.205253591047648e-01   +3.660380289039389e-01   +2.227140078569044e-01   +4.072069838995635e-01   +8.656527415169425e-02   +4.924381297214750e-01   +8.597308917055445e-02   +1.021946104015171e-01; +5.407544891266018e-01   +6.392708708109515e-01   +4.041809867511356e-01   +4.867357587693072e-02   +3.168962768432117e-01   +5.595157960721597e-01   +3.281422994911087e-01   +5.059231888987387e-01   +2.310544899966517e-01   +3.716573496780195e-01   +3.733269117421197e-03   +3.110692617844745e-01; +2.482195579752146e-01   +3.441822565419901e-01   +3.602317341695958e-01   +1.542506431053866e-01   +5.152858303519134e-01   +5.359193237954042e-01   +5.223693415649296e-01   +5.642872247776614e-01   +4.322528740739108e-01   +2.095339742844004e-01   +5.820860838971836e-01   +3.011441163652595e-01; +8.028110440329665e-02   +1.026363484689065e-01   +6.356718087006166e-01   +4.250370062013238e-02   +4.358205624070394e-01   +2.420839146696822e-01   +5.652654977721160e-01   +3.472190398716190e-01   +5.503558964635248e-01   +5.244071652951845e-01   +2.841607710729533e-01   +4.690172846504773e-01; +5.823441687385027e-01   +1.501095993212697e-02   +8.810666001848502e-02   +6.956503733257781e-02   +1.617653155032606e-01   +6.402950557206681e-01   +6.000315820693778e-01   +2.310587121017910e-01   +5.281326420491973e-01   +4.138411559261929e-01   +2.026658940369341e-01   +3.397202962764828e-01; +8.376225984262282e-03   +5.713591329757660e-01   +5.573850491223172e-01   +4.857935071611437e-01   +6.222841964950393e-01   +3.784673448665249e-01   +4.843406207319919e-02   +5.490032506043957e-01   +4.651199313831513e-01   +2.149858263546077e-01   +4.827242631357057e-01   +5.610020512511019e-01; +2.507096060391187e-01   +2.673294786323630e-01   +1.690398849902527e-01   +3.666363222493317e-01   +2.050268016190889e-01   +3.894368029160779e-01   +2.280361595416155e-01   +1.949850737331998e-01   +2.285821036573579e-01   +5.625742192600973e-01   +3.847330688079837e-01   +2.649265861297834e-01];
L3E_L3I_iGABA_netcon = [+4.009073386090830e-01   +1.544222358226614e-01   +3.094911479486756e-01   +9.984818587458535e-02   +6.167287570013490e-01   +1.536656612215027e-01   +2.312826772701599e-01   +6.516877160173294e-01   +9.375749113245169e-02   +1.573521712624395e-01   +3.547304577490452e-01   +3.923954294269397e-01; +4.908134949611497e-01   +6.153879461385029e-01   +1.322530539536939e-01   +5.560605786521319e-02   +3.812317084806031e-01   +5.468838118534307e-02   +5.920966476644687e-02   +2.146717086148388e-01   +5.515945801188780e-02   +4.122111775301768e-03   +4.974303603270290e-01   +1.610882108876538e-01; +5.022183386777106e-01   +5.652174104821814e-01   +5.837969091128522e-01   +2.381189429202874e-01   +3.260072843336569e-01   +1.686783159989119e-01   +8.071566474122573e-02   +6.089250689726997e-01   +7.323723262445389e-02   +5.354687717581169e-01   +1.392938258571448e-01   +4.471726566520476e-01; +1.606165083304511e-02   +3.996824926283912e-01   +3.068422202815650e-01   +6.128879200272482e-01   +1.409847155132194e-01   +4.467722948498378e-01   +2.882785730993034e-02   +5.866154095127467e-01   +3.057473446131230e-01   +3.699991883228711e-02   +5.826618233231505e-01   +5.459387831802630e-01; +4.946291675623983e-01   +2.670183754994812e-01   +1.298846553431797e-01   +3.694443002902725e-01   +4.901082858701143e-01   +1.013441685002614e-01   +1.034878577970473e-01   +3.978753926070503e-01   +1.131199976350926e-01   +3.795602193162099e-01   +6.942213448044290e-02   +3.249420490832349e-01; +5.090933491372788e-01   +3.613719198382894e-01   +1.251369087099851e-01   +1.476695091086926e-01   +1.983122535846746e-01   +1.567995309038956e-01   +4.281160105301545e-01   +4.645936880843455e-01   +1.494865729955599e-01   +4.996757581378806e-01   +3.483373549046666e-01   +1.032619895381812e-01; +3.112562149895454e-01   +9.489491086256585e-02   +4.208910177622640e-01   +4.374693083255222e-01   +5.375987267268121e-01   +3.523633196164211e-01   +4.693624714650398e-01   +3.110448025128585e-01   +1.638912034495067e-01   +4.871601497230192e-01   +4.567326267414979e-01   +3.492552989430929e-01; +5.155558449624871e-01   +2.717896612020078e-01   +1.950323677563561e-02   +2.877123772104802e-01   +2.029771334764575e-01   +6.248028695455855e-01   +2.514234399520311e-01   +3.142775486807258e-01   +4.121599047432235e-01   +2.995545857827027e-01   +3.243220941369364e-01   +2.273240274919921e-01; +4.161095608836942e-01   +8.529654934463494e-02   +3.493210120021675e-01   +3.239270500824487e-01   +2.819585271913742e-01   +6.040884831164778e-01   +2.901459907489459e-02   +5.664498103316926e-01   +4.688563471524904e-01   +5.406034194139714e-01   +9.675934507543754e-02   +3.000335564009680e-01; +2.014727090863190e-01   +3.847424679519668e-01   +4.475557456292834e-01   +4.516620916564095e-02   +3.116057140337627e-01   +4.557631150502425e-01   +3.300259533826849e-01   +1.356250938767252e-01   +5.778126001679889e-01   +5.177773670770298e-02   +2.852465494424658e-01   +4.907439307856254e-01; +2.560220015597239e-01   +1.265452683486416e-01   +7.301888141948119e-02   +5.324606058433274e-02   +3.339196241293866e-01   +5.574388591128353e-02   +3.917782543154907e-01   +4.562174514004278e-01   +4.811820404312404e-01   +3.729054685682012e-01   +1.850007343758677e-01   +6.192062570106064e-01; +5.312454239429918e-01   +1.103977942635887e-01   +4.661465416154867e-01   +1.085026500689630e-01   +2.693296628780528e-01   +6.461965158390038e-01   +4.289796477712876e-01   +6.548400477406678e-01   +5.271816878583320e-01   +4.624578627767899e-01   +4.218413752597824e-02   +2.192445268456940e-03];
L2E_Input1_iAMPA_netcon = [+3.432865816306605e-01   +4.700039829216405e-01   +1.505887164796499e-01   +6.304731461419575e-01   +1.055210875418722e-01   +6.182937560833230e-01   +5.405342584709558e-01   +7.237449848290248e-02];
L2I_Input2_iAMPA_netcon = [+1.861805575664766e-01   +2.165067152444178e-01   +3.480738124581478e-01   +5.321048015958789e-01   +5.761860588361882e-01   +5.051927170586745e-01   +7.955081271678086e-02   +1.530657651965331e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  5.6 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = -10*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
