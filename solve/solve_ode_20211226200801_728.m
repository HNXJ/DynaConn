function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.679507521693088e-01   +2.754768903127634e-01   -2.224000812251531e-01   +5.793733630255916e-02   -7.721313697053926e-02   -2.686811600880330e-02   -2.106414674947523e-01   +1.933492960164146e-02   -2.250840738207736e-01   -2.395505077743301e-01   +1.034408365822146e-01   -1.032037306312906e-01   +8.071716347707081e-02   -4.229230974236374e-01   +3.119235048774487e-01   -1.418168712869430e-02; -3.241282775581649e-01   -9.041120143192266e-02   -1.198649860618801e-01   -2.599642456623033e-02   -7.980798367537392e-02   -5.416201525266671e-01   +4.091120164592188e-02   +3.145346723427311e-01   -1.792892019551376e-01   +3.565239159056211e-01   +2.841757216909746e-02   +2.020389188447451e-01   +1.609334653122024e-01   +3.062990223285635e-01   +1.794573799677497e-01   +3.924696468644527e-01; +2.027875763665206e-01   +1.640213107124828e-01   +2.503021280667692e-01   -2.121859366826199e-01   +3.861967389985788e-03   +1.797007181720643e-01   +1.133727552082394e-01   +5.787879613485103e-01   +1.851912315754083e-01   +1.030558668877878e-02   -4.870391463632662e-02   -2.078173529639904e-01   -2.838256688309373e-01   -3.125179071595416e-01   +3.250745506510436e-01   +1.497380778807222e-02; +1.591061627546343e-01   -2.096222642469827e-01   +1.660594377661802e-01   -2.594256303700503e-01   +8.421160827416260e-02   -1.851968770076895e-01   +1.037137200530349e-01   -2.858646647201448e-01   +1.582488535402255e-01   +7.572331461622601e-02   +2.610106987646719e-01   -7.121279205609773e-02   -3.871102474190198e-01   -1.146473061485956e-01   +1.157787701182774e-01   +2.626592777946670e-01; -2.819427204454627e-02   +5.209168162101308e-01   +1.781285723304494e-01   -9.723581443993308e-02   -2.217728550855143e-01   +3.853890002802815e-02   -2.848514667209192e-01   +5.360951527828669e-03   +7.134560173365831e-02   +2.545350709866470e-01   +3.719270747825599e-01   +2.556740912140033e-01   +4.091353777704046e-01   +3.115133929424860e-01   +5.236327307462098e-01   +3.369510747475314e-01; +1.164045293461226e-01   +7.893931891543035e-02   -1.731480453461974e-01   +2.192350381624438e-01   +1.588320634084281e-01   +3.254078781956798e-01   -2.777291681408550e-01   +3.099904422421792e-01   -4.443937385776447e-01   -1.335824395948053e-01   +7.352742669331191e-02   -1.965296591976073e-01   -1.714538789476681e-01   -2.241255077750642e-01   +2.202991270651543e-01   -3.517565475466592e-01; -1.617949420297946e-02   +1.396159656040320e-01   -2.473986622877996e-01   -1.754979328049940e-01   +7.552752762106417e-02   +3.072714345796466e-01   -2.267907044336306e-01   -1.653835920753143e-01   -2.703264203025303e-01   -1.919270064004668e-01   +1.612700781657611e-01   -1.489127322463981e-01   -5.044453592970549e-02   -2.268268764081686e-01   -2.364505005272102e-02   -3.298379808726448e-01; -2.430968812066028e-01   +4.789557681838265e-02   +1.472550651651721e-01   +4.643871824826292e-01   +9.811904113974715e-02   +8.413634365924098e-02   +3.573642914143306e-01   +2.931868314216397e-01   -1.663229041994178e-01   -2.312738248196395e-01   -1.818397718691830e-01   +4.244605364208563e-01   +2.724654732331146e-02   -1.840502430735266e-01   +2.645325399704820e-02   +2.918745670683590e-01; -6.338460867416917e-02   +2.197078609888716e-01   +1.704794070586762e-01   +2.808526319565051e-01   +2.139810543781941e-01   +4.216607658827846e-01   +2.970382874929954e-01   -2.725818040900782e-01   -3.043767411379196e-01   -1.110260420013854e-01   +5.808625031594869e-02   -1.232912566013450e-01   -2.393258567534923e-01   -1.897608783235735e-01   +2.486969965732496e-01   -5.029019209530481e-01; +2.083307420041801e-01   +1.804676880223146e-01   +6.391954398509564e-02   +4.634972992184831e-02   -2.583256349126429e-01   -3.982649785208499e-01   -9.999665256878025e-02   +1.803763300302142e-01   +2.861036739441302e-01   +1.220084201882921e-02   +6.693848217403553e-02   -2.451219074949462e-01   -1.611444903745303e-01   +2.797428535838080e-01   -6.811377105239928e-02   +2.626527883053018e-02; -5.011195328532486e-02   +2.210830313469189e-02   -3.685037563244790e-01   -2.754416278307259e-01   +1.034374864461117e-01   +1.368964520784638e-01   +7.689204149481446e-03   -5.799869289933773e-02   +4.220430131433655e-01   -1.168863651242459e-01   -3.695393976086792e-01   +9.865189638221949e-02   -5.449990872764127e-03   +1.667422196992337e-01   +1.565822858764807e-02   +3.118216949130746e-01; +2.414451399821144e-02   +2.329302555412150e-01   -2.358908062633295e-01   -2.327145705387467e-01   -4.247254444395261e-01   -8.351157261079380e-02   +1.783941386515545e-01   -3.917322785110583e-01   -3.829031164324751e-01   -1.809099284131894e-01   -1.067820177459156e-01   +1.707920994635875e-02   -2.961855069062506e-01   -2.237540105010333e-01   +1.133179395335784e-01   +2.921915801594397e-01; -1.047612396158156e-01   +4.289707651100149e-01   +1.638409835493826e-01   -6.826677643128047e-02   -1.741777352672733e-01   +1.174801402218715e-01   -2.819623105826646e-01   +2.963245078201383e-01   -5.032719676591539e-01   +2.413424293784626e-02   -2.168811616974587e-01   -1.781110485361588e-01   +2.095850354348882e-01   -2.456888556433430e-01   +2.701105041747281e-03   +1.935334898378739e-01; +2.932163375449557e-01   +3.599860080357719e-01   -1.884409040424334e-01   +3.421428507460803e-02   -8.664062061544545e-02   -8.041731955825424e-02   -1.692697358253305e-01   +1.585997721285411e-01   +4.338613370133917e-02   +1.012467748759083e-01   +8.894895711759909e-02   -1.832451530005652e-01   +1.997088542633101e-01   +3.235037908367092e-01   -2.446822453584825e-02   +3.024335135571612e-03; +6.843440963348536e-02   -1.534142371675051e-01   -2.385728090128418e-01   +5.439559315693626e-02   +3.335040898962675e-01   +1.580387605418096e-01   -4.731168309585357e-01   +2.322101876364210e-03   -1.696740707737952e-01   +1.476022215880530e-01   +1.262822014441460e-01   +2.407223053854897e-01   -1.809890516696827e-01   -1.032062598193882e-01   +3.636748380776157e-01   -2.474261789205152e-01; -7.963155655512766e-02   -1.875034099874258e-01   -1.377463046185581e-01   -3.873092658452412e-03   +6.634694712223524e-02   -2.445750087295220e-02   -1.612512596477398e-01   -3.633003204305473e-01   +1.743310771187652e-01   -4.378225141552547e-02   +2.501715799840214e-01   +3.121104714788122e-01   +3.442173488262195e-01   -2.847744502389677e-01   +1.561787247364154e-01   -1.447951042725915e-01];
L1E_L1I_iGABA_netcon = [+3.210288335700098e-01   -3.068540001912977e-01   -1.330515986444430e-02   +2.256605543557799e-01   +7.991479828275819e-02   -2.332880924173797e-02   -3.191087122092644e-01   +1.871639982225322e-01   -1.676104939007678e-01   +2.718735344914756e-01   -1.256612321355938e-01   -1.230842500848364e-02   -1.252759845594662e-01   +1.559448481703091e-01   +1.722592225750072e-01   +2.841587304716458e-01; +1.085239044128891e-01   +1.868853938643743e-01   +1.870662227226313e-01   -4.801284002207096e-02   -1.312450298017403e-01   -1.287347727311926e-01   +7.145877644689236e-02   +8.193700475492770e-02   +3.260212177237357e-01   -3.792890129199898e-01   +3.935230458160816e-01   +3.780476361653162e-02   -1.277187251424501e-01   +2.426087374707162e-01   -1.021701095237384e-01   +2.430448234811177e-01; +4.937814582744769e-01   +3.469959873024006e-01   +1.054341359608104e-01   +7.683634931498470e-03   -1.779122050627141e-01   -1.909766630089061e-01   -3.450662567304809e-01   +8.666093687925399e-03   -2.956278529418842e-01   +2.177882843699399e-01   -6.213793705370167e-02   +5.473006373783525e-02   +9.753623837685862e-02   +7.758887941067022e-02   -1.850759633039588e-01   +4.622071128569384e-01; -3.249764905817208e-01   +7.849493028445624e-02   -1.301549876499930e-01   +2.913322040186387e-01   -3.128980639255346e-02   +5.617567163665110e-02   -1.783021893070939e-01   -9.075013004747876e-02   -1.188518624495535e-02   -4.557975914091011e-01   -3.373817242983477e-01   +5.022887132786277e-01   -1.582743013461695e-01   +1.792852624239153e-01   -4.814928496552606e-02   -5.509262451058369e-02; +1.825399517473594e-01   -2.601339355392860e-01   +3.571783806061470e-01   +2.577752796415605e-01   +8.669966977906507e-02   -4.795050967870085e-02   -3.075936216014836e-01   +2.984367174720011e-01   +9.383075463646327e-02   +1.436267065589748e-01   +9.897243806702478e-02   -5.903372638200313e-02   +2.019984856871152e-01   +3.959243259608196e-01   +6.974217610574840e-02   +1.753330300699075e-01; -1.360437940609335e-01   -2.391782218977318e-01   +1.541491498947173e-01   +3.239301271214546e-01   -1.335911835035897e-01   -2.508820030154171e-01   +5.279391996585425e-02   +1.516553942569808e-01   +1.530201384038169e-01   +2.070517045292051e-01   +4.907094374265283e-02   +5.338914741563076e-01   -3.347461658561710e-02   -2.342971533642969e-01   -4.859651907192677e-01   +2.401480685396803e-01; +1.876124914186670e-01   +1.833903025188717e-01   +6.978837864074610e-01   +3.698886974558302e-01   -3.426115441584164e-01   +4.011701268520408e-02   +1.480355715727054e-01   -1.745653967144267e-04   -1.034152315403161e-01   -2.759514195500876e-01   +2.613212789256558e-02   +5.069620386984391e-02   -3.259643559340078e-02   -2.970317276794107e-01   -1.819039993615471e-01   -5.544330454300576e-03; -4.058136889552387e-01   -1.300281767802849e-01   +3.459996769169625e-01   +3.359970291860510e-01   +8.686478750338401e-02   -3.814471160165251e-01   +3.525486101149326e-01   -4.655565064978906e-01   +2.127793276169385e-01   +3.013239316147444e-01   +1.180417877369503e-01   -2.235932527420214e-01   -3.290126943012189e-01   +1.489542875043446e-01   +3.033130443179299e-01   +4.374986941832844e-02; +2.185312899279636e-01   -8.610951331846554e-02   +3.487200982642656e-02   -4.831533457927137e-02   +3.043548797550174e-01   +1.872611297751993e-01   +1.047504167251346e-01   +5.426731328183663e-03   -2.614770163773902e-01   +2.522767336908993e-02   +7.619462727539777e-02   +1.005812426545736e-01   +3.325514105578055e-01   +2.353185208442987e-02   +3.248102178525232e-01   +2.159219410682501e-01; -7.310559236520876e-02   -3.428833753900689e-01   -3.775452801741515e-01   +4.102394865586347e-02   +4.373908970773774e-01   +1.625785645950819e-01   +3.397127276429135e-01   -3.721844838850153e-01   +4.275050050627564e-02   +6.100449128893700e-02   -2.388123561104477e-02   +3.459886384402884e-01   -3.932246554324460e-01   +1.766955320654406e-01   -6.927198774271487e-02   -3.552808007565651e-01; +1.134621715232420e-01   +9.958094726691072e-02   +3.366131966660613e-01   +3.343491847762874e-01   +3.883486490960089e-02   -1.180435447101873e-01   -2.475213436285142e-01   +4.597131333757794e-02   -1.016255628858088e-01   +3.075092100278366e-01   +3.317041969138551e-02   +2.377040386085590e-01   -2.735193205922862e-02   -1.512439710916517e-01   -1.179720418330585e-01   +7.692617409076899e-02; +1.514306669381897e-01   -1.261797559751895e-01   +3.160657221629043e-02   +2.612846282155806e-01   +1.249596793157164e-01   +2.823255660589942e-01   +4.590243017751894e-02   +2.110492448530573e-01   +1.075234957774591e-01   -2.253753092615863e-01   +2.328366106418112e-01   +4.009477519762945e-03   +5.244360137421020e-02   +7.080196403359734e-02   -2.306693553998222e-01   +1.537390174741432e-01; +3.461134643449373e-01   -3.443133828789827e-01   -2.865729340128292e-01   +1.344574523574425e-01   -9.338138671774665e-02   +1.259630605801990e-01   +1.155729522905724e-02   -3.365681436132646e-01   -3.093774779803424e-01   -1.991103910180881e-01   +5.841677368807310e-02   +2.343008041795850e-01   +2.914354238397643e-01   +1.623453549438180e-01   -2.465946781711201e-01   +1.874842253065134e-01; +2.890503841555253e-01   -4.555416943547171e-02   -1.233835649907470e-01   -1.179613329301792e-01   +1.965265578452297e-01   -2.032393472119172e-01   -2.760007791802321e-01   +4.529067383716905e-01   +2.233039318649690e-01   +3.310871031353729e-01   -7.858991502087062e-03   +1.704500633457354e-01   -1.399860417362483e-01   -4.819863521352786e-01   +3.273557351576790e-02   -3.026226373606563e-01; -2.742896771617777e-01   -4.656040876636396e-02   +1.135379902404078e-01   +2.180031860245099e-02   +4.162166426288991e-01   +2.496459286405573e-01   +4.535515414615787e-01   -3.138812011870746e-01   -7.149769702277579e-02   -4.150330966570903e-01   -2.410800293075162e-01   -6.473739306131883e-03   +3.373547827768791e-01   +1.938802156268114e-01   -2.003277178098450e-01   +2.608259563901687e-01; -1.276022501701633e-01   +9.024430906873826e-03   -3.720031511858216e-01   +2.123760225434132e-02   +4.993086908956329e-02   -1.732241717247867e-01   -2.451329487734338e-02   +2.977363401249566e-01   +8.366470051834160e-02   +2.353848941569837e-01   +2.788047441904999e-01   -3.068000236378366e-01   -2.481686023550316e-01   -1.866561807356780e-01   +7.983997661766748e-02   -4.566125250456918e-02];
L2I_L1I_iGABA_netcon = [+1.569189918040734e-01   -1.924226660686859e-01   +1.843394508445437e-01   +2.525557764468606e-01   -7.801326717488144e-02   -2.469971663253880e-01   -1.403461883044992e-01   +1.723131093807370e-02; -1.847343233384139e-01   +2.651092335823277e-01   -6.493627682760068e-02   +5.361634992968009e-02   +4.981691364881541e-01   +3.792971277697448e-01   +1.849203079725465e-01   +1.337903106343262e-01; -2.111020488022166e-01   +3.252819068376594e-01   +7.818509011418243e-02   -6.246973491540143e-02   -2.031466441897183e-02   +6.202154290218669e-01   -3.361127540290132e-01   -1.228809414783583e-02; +7.761963371825972e-02   -9.810785398062505e-02   +1.050259356783811e-02   -1.029100741181639e-01   -1.208490606273789e-01   -3.201572637843867e-01   +8.258564528644596e-03   -1.630905116491471e-02; -1.187448475251497e-01   -1.529988183094294e-01   -1.076482375298397e-01   -2.022685728740258e-01   -1.653039646771534e-01   -1.204652069272926e-01   -1.063015367129549e-02   -1.753236420352184e-01; +3.348069942060268e-01   -3.032493581274268e-01   -7.003859367776138e-02   +3.479367084760524e-02   +4.228393573637512e-01   -1.196196050936999e-01   +1.767880778660101e-01   +2.686383839497289e-02; -1.324818699567988e-01   -2.548223432462477e-02   +1.027837294730943e-02   -2.596732172321430e-01   -1.424595523558401e-01   +7.964626618708429e-02   -9.395465177428380e-02   -5.072506121202844e-02; -1.624733820212611e-01   -4.151549189342860e-02   +1.141028774752738e-01   -4.420989639468334e-02   -1.498940241041681e-01   -9.230846618021421e-02   -3.107613004797186e-01   -5.386535264663023e-02; -1.975388979662902e-01   -1.186219239984562e-01   +3.336568562239170e-01   -1.037156146372675e-01   +2.567655465940071e-01   +5.406960321510300e-02   -6.141656765301084e-02   +1.327342825305008e-01; -1.350592785153552e-01   -1.616249861371008e-01   -1.294938365404490e-02   -4.150423314158928e-01   +1.460960600963356e-01   -1.209133242469168e-01   -3.911014968706537e-01   -3.346903484868615e-01; -1.005618531086703e-01   -8.351674311384581e-02   +1.354434686455591e-02   +4.212422734919541e-02   +4.486692693037391e-01   -1.025501307304540e-01   -3.797428769135150e-02   -1.402734433287951e-01; +1.228648438728888e-02   +9.492641439978600e-02   -2.051934092640022e-02   -5.503825292896511e-02   +2.470480453849425e-01   +3.873597132327020e-02   -4.946132272447381e-01   -6.247570951024661e-01; -3.146620063591616e-01   +8.193298029522192e-02   +3.795599984815927e-01   +4.151218294018786e-01   -2.139826761422948e-01   +7.701340569648110e-02   -1.636987276695839e-01   +2.704131594399743e-01; +4.259992146665228e-01   +4.710459549929858e-01   +1.188952167019954e-01   -2.878165106954305e-01   -3.606159258100160e-01   -3.956163262916410e-01   -1.430292989729894e-01   +3.153621968868577e-01; +2.614721103265432e-01   -3.844797305867154e-01   +3.392014187333546e-01   +2.958883473959429e-01   +1.345028666955238e-01   +2.031399917262991e-01   +2.714615655761093e-01   +1.231029083208328e-01; -4.981704057084833e-01   +4.838053162328142e-02   -3.169326095066343e-01   -2.642193894970191e-01   -1.875740538508183e-01   +2.026964847235898e-01   +3.771460195064320e-01   -1.459300538573377e-01];
L1I_L2I_iGABA_netcon = [+7.640134062463437e-03   -1.352679963609618e-01   -4.060123623114861e-03   +1.621779193115771e-01   +2.448434041856573e-01   -2.492610984242676e-01   +4.593295085245463e-01   -6.037458512290167e-02   -3.154762809783725e-02   +2.102174415652053e-01   -5.316684276953279e-02   -6.894070601275289e-02   +3.540930032449029e-01   +1.782012023991408e-01   -2.484306835224386e-01   +5.734897667347379e-02; +2.122592602581344e-02   +1.402096999516213e-01   -3.044704111661375e-01   -8.408808469104606e-03   +1.527161274286650e-02   -2.337117969348886e-01   +1.869486074412433e-01   +4.246924391494475e-01   +2.876718686386852e-01   -5.978972517308673e-02   -2.153361487037072e-01   -2.874524206672815e-01   -3.218922461889345e-01   +6.969068559263966e-02   -3.174188909675939e-01   +2.153573798246215e-01; -2.547064942382087e-01   +3.575531826017827e-01   +2.472305419621608e-01   +2.452073862901015e-01   +1.739188773679433e-01   +4.093765966540748e-01   -2.058824075378310e-02   +2.552491385213565e-01   -7.180241525469148e-03   -3.277992492931622e-01   -2.388331856938751e-01   +1.949184424259698e-02   -1.476809055539980e-01   -1.830976313753558e-01   -2.903246796603278e-01   -8.306183340093430e-02; -3.226585316004626e-01   +9.537604010114706e-02   +6.156536092815861e-02   -1.522368138175498e-01   +3.743252993485065e-02   -2.427302711495963e-02   -2.338287791159512e-01   -5.316467592970109e-03   +1.252227352304573e-01   -3.662468123842558e-02   -4.147301698775724e-01   +3.160438139114026e-01   -9.036982773399874e-02   +1.698947713571898e-01   -1.374932029875360e-01   -3.209447695789928e-01; -3.562390850111120e-02   -9.686618183417317e-02   +1.795348386848069e-01   +4.037236998044549e-01   -1.811876168840290e-01   -8.726739808294162e-02   -4.216449658089605e-01   -1.580133715835312e-01   +1.396745191581857e-01   -3.871282331060271e-01   +1.628450241127981e-01   -4.600152989796384e-01   -3.064236277218035e-01   -2.569927146364746e-01   +3.498168640578588e-01   -3.943167180200092e-01; -2.336865472105236e-01   -2.392756329103506e-01   +1.512201328311003e-02   +3.952910826333795e-01   +1.228927440502837e-01   -3.674988428555587e-01   +2.853185320985894e-01   +2.671969886440629e-01   +1.326602847831148e-01   -7.893475054970367e-02   +4.142259826238729e-01   +2.222278337844369e-01   +7.989579924629746e-02   -1.215028596793629e-01   -1.473885446819308e-02   -1.483895986601476e-01; +1.147971746873213e-01   +1.455466673454424e-01   -7.741887880287732e-02   -1.090275545998742e-01   +2.840654899307808e-01   +2.019067148704062e-03   +2.647751557792403e-01   -1.945432063947917e-01   +3.477910976682773e-01   +3.263441041707384e-01   +3.454200017468765e-01   +4.275007784813241e-02   +2.295844544938253e-02   +2.724158325310655e-01   -7.909913501511420e-02   +5.035284814714013e-01; -5.033405064455423e-01   -1.548921402280260e-01   +4.662770153509398e-01   +3.412684586831181e-01   +4.280126988853436e-01   +2.208213089315098e-02   +3.136365989889688e-01   +6.459388654736981e-02   +5.201789793354561e-02   +2.538009523452497e-01   +5.660197044291131e-02   +2.202778149911150e-01   -4.674057602379971e-01   +2.905645750846342e-01   -5.952491590203054e-02   -2.099215935440590e-01];
L2E_L1E_iAMPA_netcon = [-1.532436059721055e-01   -1.288524866487466e-01   -2.687806402323567e-01   -2.920745603681703e-01   +3.348286356868202e-02   +2.073707987893122e-01   -3.593312913289917e-01   +3.830677487851006e-01; -1.396746280798283e-01   +1.865761968457421e-01   +2.186703382213474e-01   +9.983455638492766e-02   +1.649701995678992e-01   -2.663653757589348e-01   -2.238764862668832e-01   -3.598771906581797e-01; +3.602887129794322e-02   +1.477661149083639e-01   +8.594576929279948e-02   +7.994557507884698e-02   -3.873223526327465e-01   +1.895921904782555e-01   +4.306522462396444e-01   -2.380696306234741e-01; -1.609284170756132e-01   +7.998284732260658e-02   +9.815305552699173e-02   -4.027779322903879e-01   -1.870202624541566e-01   +1.857768628325863e-01   +1.017364485050994e-01   -6.749373223190978e-02; +3.050759851012143e-01   -3.847873979944904e-01   -1.694594204491750e-01   -2.655830427348949e-02   +1.594730715578832e-01   -5.374771764379487e-01   +1.633853025568754e-02   +1.085800689418027e-01; +2.525654353153963e-01   +7.023826527725638e-03   -2.570483289406256e-01   +1.196637728309952e-02   -2.842509841657150e-01   -2.013675927924135e-01   -2.072049650417974e-01   +3.068769241017617e-01; +1.021740649970422e-01   +7.264879705191161e-02   -1.233192944066666e-01   +1.758748054033554e-01   +2.275585740609370e-01   +2.168161652915446e-01   +1.478829845347865e-01   +4.358657557156471e-01; -2.643443284380490e-01   +2.155804148796431e-03   +9.521841137206877e-02   -4.140728653808451e-02   +4.853261489145518e-02   +2.044530545933934e-01   -1.965815806991541e-01   -1.159835320882149e-01; +3.446872830833382e-01   -7.918745555586543e-02   +5.795978301936773e-01   -3.462106557112452e-02   -2.336564854307758e-01   -4.198771639312450e-01   -1.068605512900844e-01   -4.738962609065199e-01; -6.187490327765119e-02   -1.563700618808555e-01   +3.678555690564554e-01   +9.739476323784010e-02   -3.478967297053115e-02   +2.157411212202511e-02   -2.484029804769644e-01   -2.610083599816951e-01; -2.103143487165715e-01   +1.429818805086516e-01   -5.777768843463393e-02   -5.082675851383309e-01   -2.090569710271592e-01   +1.192360217100448e-02   +1.068767791873978e-01   +3.966408445831419e-02; -2.411768463983975e-01   +3.249487432458326e-01   -7.091351357112016e-02   -1.245198436944635e-01   -7.757144770081489e-02   +9.812924168045252e-02   +2.843210032695805e-01   +1.311286374809359e-01; +4.262705095513010e-01   +4.298558738516797e-01   +4.232870622999414e-01   -3.101243793806510e-02   -3.680895729220352e-02   +3.254427680483850e-01   +2.264548636802745e-01   -1.957896601141268e-01; -5.888263735468080e-02   -2.833153513870283e-01   -1.652446196234860e-01   -2.447430318442231e-02   -3.734278192784570e-01   +1.807069827804481e-01   -4.151056061974689e-02   +1.757880495593435e-02; -1.804125031642922e-01   +1.562006966688103e-01   +1.013487409436949e-01   +1.461362633590270e-01   +2.895958115132151e-01   +4.906731958973931e-02   -1.759760071035162e-01   -1.053449217784943e-01; -2.350039055399724e-01   +6.487397315624191e-02   +4.263082602731654e-01   -1.740796015492080e-02   -2.030000547828073e-01   +6.283253924981011e-02   +3.710243448159929e-01   -1.600275632065790e-01];
L1E_L2E_iAMPA_netcon = [+9.356347421796475e-02   -1.712193765320545e-01   -2.321434450068220e-01   +1.879864370118329e-01   +1.006209391071720e-01   -7.029156662845339e-02   -2.929404437333074e-02   +1.641887866204144e-01   -1.777815199685577e-01   -1.387920386993479e-01   +3.794111916312978e-01   +2.283892880716658e-01   +3.147908054380116e-01   -1.149920994039871e-01   +4.334808003387486e-01   +5.767315933066133e-02; -2.158002781649650e-01   +1.658547688422606e-01   +3.419947968467049e-01   -5.308879429756327e-01   -4.577801430528213e-01   +3.024435282005246e-01   -1.218953732021336e-01   -4.280423783773324e-01   -1.230783684022252e-01   +3.539712493480378e-01   -2.919820328360979e-01   -6.137326248311722e-02   +4.223895420065396e-01   -4.178568060253383e-01   -1.118215611436608e-01   -7.310519345466332e-02; -3.773455726405731e-02   -8.467585055878346e-02   -5.609463938579007e-02   +1.949203227866098e-01   +5.156565620468956e-02   +5.760223092066179e-02   -1.480565504681323e-01   -6.561617485616117e-02   -9.487545383988177e-02   -2.543317542685172e-01   -1.983137560244964e-01   -2.302929202159978e-02   -3.761644182245227e-01   -4.064827040322699e-01   +1.398894150239721e-01   +1.317960814114211e-02; -1.441400595190739e-03   +5.075659405581726e-02   +5.946176681883495e-01   -2.221207496181711e-01   +3.322055474216715e-01   +1.701925462483461e-01   +5.507159490042157e-02   -6.816610997833089e-02   -2.480760281677967e-01   -2.625499125387538e-01   -2.740243152925500e-02   +5.368446684126908e-02   -2.051419583204516e-01   -2.598679188610406e-01   +8.118403579652397e-02   -2.449028449767399e-01; -1.244180994516534e-01   +4.291084311751907e-01   +3.266219594270460e-01   -1.894901630899693e-01   -3.143365137615014e-02   +1.059929598864892e-01   -3.026565241274334e-02   +2.599734080543731e-03   +1.292999114257205e-01   +2.110140889860604e-02   -7.062417092164565e-02   +3.680933463594791e-01   +1.202872242735614e-01   +2.504044497073624e-01   +3.625261771538750e-01   +3.222820911565784e-01; -7.229644684108263e-03   +2.358286042057797e-01   +8.737263427941208e-02   -4.020088769218030e-01   +6.942812260160530e-02   -1.476609902814149e-01   +2.297656219833075e-01   -2.790066611426696e-01   +7.396409484284550e-03   +4.285602819670002e-02   +1.883125026970943e-01   +1.061865161620041e-01   +1.361975175470067e-01   -2.834587386032266e-01   -2.633251312327688e-02   -2.859196871648805e-01; +1.335422535861712e-01   -6.646644796841017e-02   +3.253028119067554e-01   -3.665594449573614e-02   -1.012195694781814e-01   +4.014836532115129e-01   +3.427258011766275e-01   +1.322593888321552e-01   +2.454261467113059e-02   +9.298290819449273e-02   +2.426490729665113e-01   +2.576275203161143e-01   -2.415390559193445e-01   -1.110309748809532e-02   -3.691041894232014e-02   -3.896826230992460e-02; +1.304083656111227e-01   +6.773507868122063e-02   +1.465475190605884e-01   -6.337899449969833e-02   -2.896063380935088e-02   -2.036049179781523e-01   -2.158805977272099e-01   -1.057567561202808e-01   -2.290555098749086e-01   -5.141288154470709e-02   +2.128691377392896e-01   -2.328543683363763e-01   -2.261185787899300e-01   -1.395458361534159e-01   +1.572834131106813e-01   +1.743773953752267e-01];
L2I_L2E_iAMPA_netcon = [+2.403061675656367e-01   +1.198360764129779e-01   +2.585471598468709e-01   -1.824081692934379e-01   -4.164388343413858e-02   +9.388305241067138e-02   -1.831785858280038e-01   -5.303791836146682e-02; +9.683311877316644e-02   +1.536939342010293e-01   +2.710635732386968e-01   -2.019414046834313e-01   -1.848555993636980e-02   +4.295787980017762e-01   +3.335693147425574e-01   -2.581652646133093e-01; -4.287046520341156e-01   +1.877039638704874e-01   -2.635537369861795e-01   +6.524633611577804e-02   -1.697234179701204e-01   +8.068893623780594e-02   -2.825495527389488e-01   +9.803632938241019e-02; +2.213428950893052e-01   -1.838345619333266e-01   +5.834962342916290e-02   +2.854874006529226e-01   +7.408962640651831e-02   +1.351532376273271e-01   +1.373575172208393e-01   +1.002398205829425e-01; +2.359914386880816e-01   +4.578161875332823e-01   +7.530206978081663e-02   +4.107297510505226e-01   +9.840853592174431e-03   -1.656676470433494e-01   -9.751957154511726e-02   -3.334577643434581e-01; +1.189956477047607e-01   +1.645154392244018e-01   +1.204816372887636e-01   +1.604380301504112e-01   -1.375041258647234e-01   -3.721237297609353e-02   +2.525646976080710e-01   +1.535733796711138e-01; +1.637791250514905e-01   -2.246582757890783e-01   -2.357951559396587e-01   -1.540365076209275e-01   -1.883562882663405e-01   -4.921190238746518e-01   -6.203274353944395e-02   -2.077400848573968e-01; +3.699285640104549e-01   +5.324071637212263e-02   +1.573393306076730e-01   +3.755009450521376e-01   -2.594578087719205e-01   -4.345555383779046e-02   +4.280788809174053e-01   -3.428754792211215e-01];
L2E_L2I_iGABA_netcon = [-9.332407669176429e-02   -2.849884100906993e-01   +2.353175227536272e-01   +6.942174563084036e-02   -2.078011691871763e-01   +3.002393826089954e-01   +3.830805741035044e-01   -1.662149356599465e-01; +5.468401685180060e-01   -9.593885658322658e-02   +1.902192933859157e-01   +6.293644806494661e-02   +2.019625319954133e-01   -6.277553940401670e-02   +1.997417554592248e-01   -8.518821005567730e-02; -1.680245791273488e-01   +2.350400563290452e-01   -3.662145268733802e-02   +2.520000168195555e-01   +1.928204034592361e-02   +3.074092655842440e-01   -1.528608411519642e-01   -2.781854561585922e-02; +4.854159883660490e-01   -2.443535086519741e-01   -9.309823450024377e-02   +3.247507531627114e-02   +3.701296692953963e-01   -4.412523519922470e-02   -1.795200533653626e-01   -6.625492393754612e-02; +4.076340129825028e-01   -6.932755376010183e-02   -2.728459430192209e-01   +2.372557265804140e-01   -1.153582807918123e-01   -3.147491712368370e-01   +4.069266786535668e-01   +2.595871344552427e-01; -5.860791872376730e-03   -1.323630926165791e-01   -3.272025356102599e-01   -1.737664506458497e-01   +1.075430835457739e-01   +1.755887267241504e-01   -6.439471024850572e-03   +4.506636583643028e-02; +1.363315661351180e-01   +2.773833918488379e-02   +5.981319549328363e-01   +1.143986712014686e-01   -2.817615357243703e-01   +2.236399645997699e-01   -3.086189695529450e-01   +1.359084719106419e-01; +2.376544801545650e-01   -6.099430900408339e-02   +3.510206383373118e-01   -7.781461447351025e-02   -4.658024453577218e-02   -7.937413211854190e-02   +2.261195525375216e-01   +3.498980510238143e-01];
L3E_L2E_iAMPA_netcon = [-3.332571572527991e-01   +4.062016083414110e-02   +3.682686363951239e-01   -1.872865019732278e-01   -2.052271074374479e-01   -2.019038310023730e-02   +2.912719937072945e-01   +3.152031972948945e-01   +4.235521908234119e-02   +5.790755985786777e-01   +3.332438588893993e-01   -6.955752900199957e-02; -1.280520486275105e-01   -3.273105789616463e-01   +3.049654760262622e-01   -3.854429120806850e-01   -3.719911050367589e-01   -2.938423769907427e-01   -1.995309301171645e-01   +1.638294959757476e-01   -2.098350459277158e-01   -1.833221860071086e-01   +6.374631950195481e-02   +7.034677827451150e-02; -2.329517061833118e-01   -3.579161690207855e-01   +3.992402780893968e-01   +1.324158726667364e-01   -2.316905551284529e-01   -1.375137221498666e-01   +1.375654431989713e-02   +5.845413350686347e-02   +2.263142936185490e-01   -9.414600669479770e-02   -2.505397884049602e-01   +7.844822141520753e-02; +2.827502769672730e-01   -5.155691041991090e-02   +1.625619757699399e-01   +2.287970649232669e-01   -2.019377462664468e-01   +3.843376827866338e-02   -2.855812033067553e-02   -9.163193788247205e-02   -4.963328653519985e-01   -4.027781110833856e-01   -3.039046474120646e-01   +1.940622179420521e-01; +8.404309721885772e-02   +1.140009156150986e-01   -3.868502044381267e-02   +2.549446299631956e-02   -8.810964403210605e-02   +1.891514737093559e-01   +2.106280047389049e-01   +6.049379566017588e-02   -4.471250475842340e-01   -5.025474421410232e-02   +8.969644138963906e-02   -1.803361299760420e-01; -2.801194560704102e-01   -4.476114896106653e-02   -5.440709064856625e-02   -1.386409853691737e-01   +2.915051999945895e-01   +2.336860925481616e-01   +2.751007830487833e-01   +1.856796575382897e-01   +1.240013340798783e-01   -1.797834664415601e-01   +2.634920623559561e-01   +1.767193864940951e-02; -1.976991079192615e-01   -1.801858146592298e-01   +1.524375932387564e-01   +2.333028325151930e-01   +6.471141315016436e-04   -6.270759006882907e-02   -2.934878180368377e-01   +9.737285858568373e-02   +4.330658468157396e-01   -1.551184984858840e-01   -3.023842604674287e-01   -1.684050791397572e-01; +2.447684883257964e-02   +2.045331583708289e-01   +3.187256559771466e-01   -2.087855225774957e-01   -2.733080251376643e-01   -1.382054453917325e-01   -2.792626785801665e-01   -1.958677084114065e-01   -1.244143324491066e-01   +1.164432040666862e-01   -2.229758923836223e-01   +1.710624436795560e-01];
L3I_L2I_iGABA_netcon = [-3.596499907461436e-01   +4.676838203281780e-01   +1.653101539587949e-02   +2.820267105095693e-01   +1.918299498432132e-01   -1.220693930140182e-01   +2.113617307040683e-03   +2.837581290962029e-01   -3.080747778213630e-01   +1.377486122580691e-01   -2.315676010579468e-01   +3.802278826456438e-02; -3.029820521739239e-01   -6.421359674449900e-03   +4.070534405162980e-01   +2.439048084151683e-01   +7.802270472194889e-02   -8.724414019664714e-03   +3.647180453526369e-01   -1.963982501830898e-01   +2.483659985138273e-02   -2.224236157667822e-02   +4.141346688047914e-01   -1.164520735631950e-01; +2.531794555457712e-01   -3.633359688543867e-01   -3.030945945051997e-01   -4.336911342934083e-01   -1.231694720983004e-01   -3.167197167841915e-01   +1.524424766305849e-01   +2.712951780219967e-01   -2.141042565423724e-01   -2.164526049305517e-01   -5.817883155793813e-01   +1.637082444313199e-01; +4.982503062555655e-01   -3.743810710091201e-01   +5.055270212237797e-02   -2.235855934857372e-01   +1.601295778785065e-01   +8.558870682844687e-02   -8.730757521590742e-02   +3.807254593750172e-01   +3.555691225670522e-01   -1.861781616221071e-01   +1.464607515095705e-01   +6.729258444836977e-02; +2.015466438138760e-01   +1.670580889215039e-01   -2.040932060246486e-02   -2.040259894293242e-01   -8.166027939373260e-02   +2.191007730595838e-01   +1.797983672166139e-01   -3.865355738772648e-01   -1.346630736455507e-01   -5.591875567466639e-02   +3.166811781762990e-01   +1.353649917355915e-02; +9.893383049823226e-03   +2.698753533797629e-01   +1.969359288400133e-01   -1.702603942168624e-01   +3.068003507607784e-01   +8.701606270046638e-02   -5.274963771213708e-01   -2.615048488584371e-01   -3.879255797349286e-01   -7.554590536114855e-02   -5.723595182141554e-02   -7.876668006873595e-03; +3.145210439843946e-01   +2.090247110511375e-01   +3.104492573106780e-01   -4.511626825250900e-01   -4.584600486537280e-02   +2.163865493544301e-01   +1.236992949153258e-01   +5.361224421352205e-02   -2.864812605182034e-02   -4.386319199358989e-01   +2.244116822677376e-01   +2.833856187442791e-01; +5.009479366679258e-01   +2.711100940056881e-01   -4.910053793420036e-03   +1.431670994070023e-01   -2.004062179825802e-02   +2.107154585704807e-01   +3.158948338882327e-01   +6.382593897064519e-03   -1.592889178848473e-01   -1.028567624499899e-01   +4.758681560218065e-02   -1.952245945841134e-02];
L2E_L3E_iAMPA_netcon = [-3.139366672268823e-02   +7.298357811901716e-02   -6.580916384882726e-02   +5.195895359325117e-01   +2.526165940504119e-01   +3.889589738484935e-01   -2.657148667878120e-01   -6.278044765031335e-02; +2.122402864138587e-01   +5.189800682543917e-02   +2.515997275763753e-01   -3.700542956750537e-01   +2.382248956721859e-01   +3.498178373024835e-02   -2.132841858187741e-01   +6.967741661046578e-02; -1.678126152382592e-01   +1.870592826427570e-01   -4.532653426519371e-01   -1.362655362106960e-01   +2.740701030022678e-01   -8.432500702619923e-02   -1.690831764875939e-02   -3.034122615516600e-01; +4.930218821600163e-03   -9.582146430626007e-02   +1.942780797628980e-01   -4.076677671261401e-02   -9.982910792030862e-02   +2.714950335019662e-01   -1.522197967825532e-01   +6.345818704043148e-02; -3.866238299598795e-01   -1.966891058853575e-01   -3.707916204441137e-01   -2.586120345846520e-01   -3.059419679333386e-01   +7.716263993458271e-02   +2.316582850292379e-02   +1.412717202470885e-02; -8.134700119602745e-02   -2.318233445565514e-01   +2.457179084010336e-01   -7.129709420778757e-03   +3.782322729301142e-01   -4.182031023444344e-01   -1.816443972287120e-01   -3.718377715556438e-02; -5.389314679717860e-02   -6.677722276335814e-02   +2.642372389464710e-01   +1.674658560560003e-01   +1.136380721261300e-01   -3.693694317890287e-01   -2.821708094619322e-01   +3.782388215882370e-02; -1.164786988615314e-01   +6.721845801270463e-01   -1.259936096762255e-01   +4.390480747304137e-03   +2.710175297300112e-01   +2.711762935498070e-02   -2.239268514341833e-01   -3.307482136524690e-01; +2.661145868688215e-01   +1.066606055524389e-01   +8.289556533610229e-02   -3.380447082907703e-01   +2.257352087345740e-01   -2.477974564589652e-01   -4.293978653855617e-01   -7.679372427396963e-02; +2.778638860070914e-02   -1.474420305659599e-01   +9.837041334387700e-02   +1.005176594881795e-01   -2.949203164812352e-01   +2.655794853839093e-02   -1.709783141405434e-01   +4.546055309873451e-01; +2.275945751600315e-01   -3.314290661195147e-01   -1.538671980579977e-01   -1.925814746325592e-01   -3.731015964318537e-01   -1.788975527129158e-01   +3.544479436831572e-01   -4.916829612519190e-02; -2.391548070255082e-01   -1.404793968746780e-01   -1.283400202070763e-01   +1.554419907807572e-01   +1.075478194559697e-01   -4.406855884747860e-01   +1.330710057803817e-01   -5.594033243382085e-01];
L2I_L3I_iGABA_netcon = [+4.989292121663784e-02   -8.013758268030084e-02   -3.387592380413452e-01   -3.890776320847092e-02   -1.395957238569111e-01   -2.643018919230262e-01   -1.399263662499622e-03   +1.323982833244977e-01; +3.740399756845211e-01   -3.170228463019152e-01   -2.328224662090853e-01   -5.323964251940023e-01   +2.792309725457104e-01   +6.167102285887331e-02   +4.071439990071565e-01   +2.874094803949423e-02; -2.545359020200020e-01   +3.012059219817365e-01   +1.482522167868302e-01   +6.067099007510226e-01   -3.245930149259458e-01   -3.307657403216184e-01   +1.894774796814611e-02   +5.833714764501309e-02; -3.163699278315787e-01   +1.871070882283069e-01   -1.463525185294952e-01   -1.750882604682121e-01   -3.320964394645416e-01   +1.982218405076553e-01   +1.139116047187265e-01   -2.097585584025510e-01; -1.888760382989081e-02   +1.742838438989282e-01   -3.180454489928668e-01   +1.631341265228842e-01   -7.188623760521423e-02   -1.769175452953174e-01   -3.929443700789907e-01   +4.302245720195175e-01; +1.353855125927273e-01   -1.978457873509275e-01   -1.397278494997086e-01   +6.043115541210178e-02   -2.720911877160318e-01   +3.480972505329900e-01   +4.727838443857479e-01   -2.817499249951797e-01; -2.167154153079414e-01   -5.485362443534834e-02   -1.312766252792486e-01   +1.650549810852343e-01   -1.188049519254688e-01   +1.032065305400337e-01   +3.869682180318484e-01   -2.155737156663337e-01; -3.956099595486157e-01   +2.939647880968808e-01   -2.843548859587534e-01   +3.422014705741150e-01   -9.524454269422197e-02   -3.266407415803064e-01   -1.197987895905138e-01   -1.283625737156206e-01; -1.286319358792230e-01   +1.962735443761550e-01   +2.771048498270045e-01   -3.022412320398283e-01   -2.928513427483730e-01   +1.981199496599048e-01   -7.449101168518288e-02   -1.845641604957635e-01; -3.349059400268317e-02   +3.633880373365361e-01   -2.510798932859242e-01   +5.459053507278357e-02   +1.699843216835528e-01   +6.126481792356785e-02   -1.148532270663877e-01   -1.708911562504611e-01; +3.620924497206991e-01   -4.083804434502103e-02   +2.804955345730023e-02   +2.834398831587552e-01   -8.182503398195026e-02   +1.643313731800810e-01   +1.915454948516622e-01   +2.083689024342689e-02; -3.292658035395861e-02   +1.850786167660103e-01   +1.464125609196446e-02   +1.368950279513648e-02   -9.454293821479121e-02   +3.233734972861268e-01   -1.992524202618610e-01   +1.159297746270874e-01];
L3I_L3E_iAMPA_netcon = [+3.785245822951175e-01   -1.399887979900463e-01   +1.198011281122891e-01   +4.393007268098502e-02   +1.661440037557382e-01   -3.656445439115685e-02   +2.498806720155265e-01   +2.533865160928412e-01   +2.093961096774456e-01   -1.137984047653692e-01   +7.879866383564524e-02   -6.389650305821208e-02; +1.954416027644502e-01   -2.217073678206605e-01   +6.378066588879533e-02   +2.300578628022462e-02   -2.422689592724571e-01   +5.048527509534842e-03   +1.089625890966123e-01   +4.387598519381402e-01   -2.855981690970394e-01   +1.870776028277536e-01   -3.377195156579827e-01   +2.322950203736208e-01; -1.767059424838135e-01   -2.268291484358310e-01   +2.005566177456208e-01   -6.917281914446255e-02   -4.895059801000592e-02   +1.045585090285482e-01   +3.590065364559068e-01   -1.353181302507990e-01   -2.973267550861225e-01   -3.951721244825873e-02   -1.956717276980059e-01   +2.395327656513413e-02; -9.537752856010250e-02   +4.604884399407561e-02   -1.664793489766658e-01   -1.123579764793250e-01   +6.133137676222391e-01   -1.604019840233377e-01   +2.201790107735203e-01   +4.365463422173764e-01   +2.492975644981508e-01   +5.835670904081131e-03   +2.015506009925156e-01   +2.893025299367039e-01; -3.484479374123168e-02   -1.506382876410230e-01   -2.827825579773618e-01   +2.736747749291538e-01   +6.706401770882647e-02   -1.502446765430616e-01   +2.245165427833103e-01   +2.391591854251522e-01   +2.768876386903472e-01   +2.544394831691105e-01   -6.101164864885547e-01   +1.219451370842195e-01; +1.450562073283521e-01   -1.806483918387208e-01   +3.394318914840416e-01   +3.203223842370647e-01   -1.652776848281116e-01   +1.643518312429622e-01   -2.771750605453557e-01   +1.014132886294500e-02   -1.756276519410719e-01   +1.965344466840301e-01   -4.707654371536819e-01   -1.341871467709106e-01; +9.757316931484933e-03   +8.378659214341500e-02   +3.795571840318326e-02   -6.219971268740558e-02   +1.628494597353251e-01   -1.986557015102827e-01   -2.146962708001721e-01   +1.280742176085497e-01   -7.658199082736022e-02   +2.053278677650178e-01   -1.040645186170606e-01   -9.534775525673389e-03; +3.269162034388944e-01   -2.339906726966149e-01   +5.671758195594415e-02   -4.769385639208692e-02   -3.999786137291456e-02   +3.030102971696055e-01   -2.692031763520953e-01   +1.200788143179815e-01   +4.719604797060761e-02   +5.314249620297765e-02   +2.521762872897058e-01   +2.990927227629886e-01; +3.547137573873652e-01   +1.980064000816216e-01   +5.489415972099185e-02   -9.266641087815120e-02   +2.173949402002050e-01   +4.468766641276092e-02   +1.924834149482090e-01   +2.535354866590306e-01   -2.123964436573566e-01   -7.133684977739019e-02   +4.049583289434493e-01   -1.095221657654551e-01; +8.281799351394370e-02   -4.732578500536161e-02   +7.188142854623430e-02   -2.599721800964322e-02   +5.338250021273474e-01   +2.235757463350695e-01   +2.098427322281742e-01   -1.995370134874141e-01   +2.010047853017170e-02   +1.996968745891498e-01   +6.432326638457192e-02   +2.427051820304328e-01; +5.060686599954015e-02   +1.246489498798676e-01   +3.211876395949387e-02   -2.133007663367018e-01   -2.070364042589634e-01   -1.747869312627181e-01   -1.146278708507102e-01   -1.547804797373102e-01   +3.086659850339842e-01   -7.404633127775057e-02   +2.210762854770223e-01   +3.583457826145457e-01; +1.485891809966414e-02   -3.847102067538016e-01   -1.358981749750375e-01   +5.362724079225775e-02   -8.500794900761252e-02   -1.320801526388543e-01   +4.939864640124947e-01   -2.448947257967886e-01   -2.538939582796080e-01   +5.968409737984362e-02   -2.577437083133667e-01   +2.905719995496893e-01];
L3E_L3I_iGABA_netcon = [+2.960156351688354e-01   -1.365046651141900e-01   +4.392054438582541e-02   -7.886821405840932e-02   +5.217555565851938e-01   +8.094982484387493e-02   +3.669089274367929e-01   +4.032760718237632e-02   +4.813689184939917e-01   +6.488075018389555e-01   +4.064094977114899e-01   +3.433693341430917e-01; +2.770891080255405e-01   -3.212286973966773e-01   -5.986223967009685e-02   +4.564435370539084e-02   +1.186017891301474e-01   -5.215381717669213e-01   +3.641238013083827e-01   +2.737274735816311e-01   -9.729836809272888e-02   -1.251906588857509e-01   +2.089940712455047e-01   -4.371013251163976e-02; +3.034593413246656e-01   -1.831291766849689e-01   -2.225945633070499e-01   -3.663652248463306e-01   +1.536533658542498e-02   -7.040878342940321e-02   -3.341295836743707e-01   -1.770282357904574e-01   -1.465496238705964e-01   +7.127615724333209e-01   +1.207986953216477e-01   -2.292396587411928e-01; -7.394213819969334e-02   -2.657663189966265e-01   +1.994956691901048e-01   -3.026683872871725e-01   +2.406891246012178e-01   +1.222576014426876e-01   +1.403068435662816e-01   +2.884597589084102e-01   -2.032653303015934e-01   +9.198186747063639e-02   +4.090087245632052e-01   +1.963699621805128e-01; +4.760580228699339e-01   -4.666228529595727e-01   -2.570923963710190e-01   -2.349987793949717e-01   -1.444609486825685e-01   -4.721925194589259e-01   +1.738677118139373e-01   -2.621001371268196e-01   -1.522113042019309e-01   -1.164340552151062e-01   -1.148225302303036e-01   +1.990995425515078e-01; +1.209063588776491e-01   +3.457597763783207e-02   -3.747236989132476e-01   -1.503313931088307e-01   +9.371727093752702e-02   +3.659152275499283e-01   -1.980346289317532e-01   -4.448026576065203e-02   +1.561859419098696e-01   -3.823441414141912e-03   -2.220554722163885e-01   -4.664896700919082e-01; +7.695885609927515e-02   -1.480183371856565e-01   -8.314564496855689e-02   +2.741846196068287e-01   +2.612543093400519e-01   -3.133442557829702e-02   -2.075525927608074e-01   -2.368949179503036e-01   -3.182087092472701e-01   +6.160308046446040e-01   +3.528572812927387e-01   +2.992056672651773e-01; +3.567588974123403e-01   +1.274725819795309e-01   -8.337236733240413e-02   +1.258427565809425e-01   +2.781144826824101e-01   +1.585461126982197e-01   -8.599228456439811e-02   -9.559886812872526e-02   +1.221565528317967e-02   -9.071859399927495e-02   -9.556813588046922e-02   +2.803471696767551e-02; -2.740654999507710e-01   -3.757639995335019e-01   -2.771286101739770e-02   -3.478497712752816e-01   -5.134407413422370e-02   -1.384107638230439e-01   -1.002160940961226e-01   +1.897691015569411e-01   -2.096566048880197e-01   -4.206204050877023e-01   +2.117582921691930e-01   +2.985103664120450e-01; +5.452785251385628e-02   -1.370350945881272e-01   +2.372133578623900e-01   +1.162481606442206e-01   +3.817726826544575e-01   +1.087132857248041e-01   -3.193248197374510e-01   +1.749236610941996e-01   +2.933937128948632e-01   +1.196641607154352e-01   +4.406768585925938e-01   +1.755644315704112e-01; +4.496541678685197e-01   -3.191112473387999e-01   -1.628213744662029e-01   -7.900274199034701e-04   +9.212773194811757e-02   +5.630773783348398e-01   +6.688612931573235e-02   -2.769672727039499e-01   +2.336276711264663e-01   +2.391221192583870e-01   -4.082203542745205e-02   +3.012571416549398e-02; +4.239769247498718e-02   +9.843259605550249e-02   -5.181879551684507e-01   -4.634986367546396e-01   -1.247659704836104e-01   +4.451075181240064e-01   -3.178156614095377e-01   -2.549579219239840e-01   +1.292203493626273e-01   -7.753949914378865e-02   -1.091709971196305e-01   +2.344687937226304e-01];
L2E_Input1_iAMPA_netcon = [-2.287421529738543e-01   -3.947976710006318e-01   +5.301291833766861e-02   -5.499914628208116e-02   -9.400568201051365e-02   -1.608550234698874e-01   -2.644343475309568e-01   +1.847218894366776e-01];
L2I_Input2_iAMPA_netcon = [+2.111429359901476e-01   -1.577913790988863e-01   -4.110548475934605e-01   -2.394569388820058e-01   +4.785398358877487e-01   +2.111301711888294e-01   -4.116352681860224e-01   +2.904832114073555e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
