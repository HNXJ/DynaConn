function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.031450872740809e-01   -5.704827980828777e-01   +1.384896227842260e-01   +2.217443775316873e-01   +9.154190931156414e-02   +1.798719663283955e-01   -3.628703111899589e-01   -1.621962125670576e-01   +3.932907330891704e-01   +5.891086907415806e-01   +3.094134555919184e-01   -2.842761827164712e-01   +6.670894517969030e-01   -1.226879462069833e-01   -4.100480043136292e-01   -3.230082671726794e-01; +3.752182031234140e-01   +5.048290776092685e-01   +1.214024577348114e-01   +3.660126382808159e-01   +3.315448851131697e-01   +6.555592192516945e-01   -5.080249142467185e-01   +3.064224556910725e-02   +1.678353517418142e-01   +1.188787672423176e-01   +2.885636204768726e-01   +3.773998416187950e-01   +5.056757448094655e-01   -1.270931170210860e-01   -1.956033583991565e-01   -1.070118494066030e-02; +3.726619685053545e-01   +9.014034333407554e-02   -4.178662801856519e-01   -1.074597655806454e-01   -1.802421691486052e-01   +5.202631372053842e-01   +7.034312468752034e-01   -3.062994767241026e-01   +2.379392267190806e-01   +2.394473025245279e-01   +8.039310371348564e-02   -1.629026569591851e-01   -2.311294405664624e-01   -4.007434929728546e-01   +5.745168616223180e-02   +6.550872130609167e-01; +4.640226348014703e-01   -2.681378879339519e-01   -7.632385452326534e-02   +4.126064971675951e-01   +2.964481744706829e-01   +6.574481304967955e-01   +6.545792284338430e-01   +2.266424193780485e-01   +3.228570689506742e-01   -2.214434837819496e-02   +2.952650192018520e-01   +2.730010715751929e-01   -2.986308471762826e-01   +4.526825852425244e-01   +3.325263921730521e-01   +7.820910176284191e-01; +5.757585109245487e-01   +1.827660564259484e-02   +6.897247689427363e-01   +3.272139776768582e-01   -5.733220628584570e-02   +2.444789811809597e-01   -9.064671234904521e-02   -1.596599568551445e-01   +2.899922602429012e-01   +3.303826147442983e-01   +7.037607509355580e-01   +6.325191642550157e-02   +1.930054064289339e-01   -1.436362341385116e-01   +5.843227740490867e-02   +2.137722945932795e-01; -3.194270349416511e-01   +5.702938712829589e-01   +6.587594399258523e-01   +1.048017860443351e-02   +5.007276941824336e-01   +1.384881958066642e-01   +3.762122894828070e-01   +3.141546203121595e-02   +3.067228841647149e-01   +7.717491894831358e-02   +5.670430021905945e-02   -1.341827307941079e-01   +1.285624873208108e-01   +2.007525580899415e-01   -3.743953452904805e-01   -1.348654733318103e-01; +1.484243065894766e-01   +3.348414602842252e-01   +4.045775493040585e-01   +3.292262551352071e-01   -5.048105879046203e-01   +1.137848848111416e-01   -1.279044261993076e-01   -2.290793630968792e-01   -7.913875017891188e-01   +2.569927761039926e-01   -1.679699948034390e-02   +5.093368024993071e-02   +2.867190431804313e-01   -7.902914853235966e-02   +5.942826700596753e-01   +3.236120479586199e-01; -1.751446877037325e-01   +7.715690474005150e-01   -4.434820298256539e-02   -1.626999123664462e-02   +2.518215386008126e-01   +7.035345670439257e-02   +5.354242054396553e-01   +1.549355828652948e-01   +2.180859343288215e-01   -1.457554514879189e-01   -1.936845488149411e-02   -1.446710645150469e-01   +9.219944007023456e-02   -3.030613854119707e-03   -1.804687901303939e-01   -1.068478194100139e-02; +3.032503373848767e-01   +6.221077783851149e-01   +7.050287537616733e-02   -2.632125187806430e-01   +3.326824377187442e-01   +5.551522411819806e-01   -2.155761321837006e-01   -4.052782018499415e-01   +5.881875263968906e-01   -1.740258108408217e-01   +3.204789113503355e-01   +7.746257206167727e-02   +2.353047026921631e-01   +3.578730970132769e-01   -2.707430764659478e-01   +1.415733917705457e-01; +4.220270076787233e-01   +1.168149553818690e-01   -1.258497433376596e-02   +5.892592266573989e-01   -7.309365166661277e-02   +6.255834268260968e-02   +4.067662016536553e-01   -1.454870636190028e-01   -2.004627210489861e-01   -4.191312227897531e-01   +7.249423960153129e-01   +1.362427105037332e-01   +3.356787052620904e-01   +3.080276011289660e-01   -5.449319879698975e-02   +5.195376019385378e-02; +5.129920602034860e-01   +8.011670102037420e-01   -2.681427410274043e-02   -3.149784161654726e-01   +3.360161145545951e-01   -7.290316442563184e-02   -1.376228270536466e-01   -3.267198477883854e-01   +3.691604476313100e-01   +4.910393804357240e-01   +3.215449723267518e-02   -8.664253224520191e-03   -5.093166497492501e-01   -3.933804365362040e-02   +9.806478699650296e-02   -1.986131858071121e-01; +2.728433550797163e-01   +1.727687754638190e-01   -2.579657985735310e-01   -1.269831570825936e-01   -2.780211839310287e-01   +2.730792801980983e-01   +2.452639807331519e-01   -2.309482718132602e-02   +6.454598947265039e-02   -5.408461137334183e-01   +2.247609173331248e-01   +4.259305201497710e-01   +5.741092135031765e-01   -1.698055785341038e-02   -1.435933321192973e-01   -1.076640465610172e-03; -4.098739864284354e-01   +3.316324990823912e-01   -3.120911030730067e-02   +1.251391051375072e-02   +5.403143488328442e-01   +5.964455654732086e-01   -1.282880305612963e-01   +2.812404710990434e-01   +3.437607728135696e-01   +5.933377507584801e-01   +1.135419655359937e-01   +2.470513535751787e-01   -1.034507272928465e-01   +1.537100245427581e-01   -3.577048163593993e-02   +2.311912944553107e-01; -5.623762790322161e-01   +3.592062581314489e-01   +3.089249902768487e-01   -7.136604107492497e-01   +2.484829834967400e-01   +1.228335329339254e-01   -2.114450429058500e-02   +6.949368076935029e-03   -4.875638164700510e-01   +4.468972678902708e-01   +6.266902326442226e-01   -5.437083263102618e-02   -1.746203026623934e-01   +3.943654646048231e-01   +6.475738605954093e-02   -5.421615575301955e-01; +3.427694485331974e-01   -1.110362214966921e-01   +2.762684744641360e-01   +1.940898416141000e-01   +1.855548903236236e-01   -7.316993193905619e-02   -1.017017153458760e-01   +3.083621767033790e-01   +6.563291364365349e-03   -2.276066890731153e-01   +1.999746205133450e-01   +1.716066341252102e-01   +6.755302836545971e-01   -9.443607884324323e-02   +2.143177028547206e-01   -3.583910621970868e-02; -8.657817185550363e-01   +4.010514922415553e-01   -3.528360450519020e-01   +5.936951037454486e-01   +7.871674337396877e-01   +6.109621848714903e-01   -2.057031657857673e-01   +6.690157018158001e-01   -6.209139055364190e-01   +1.644023948999778e-01   +2.688641338041773e-01   +3.462676310246862e-02   -5.256192717705416e-03   +4.053697395874276e-01   -8.460221240838701e-02   +3.433177115096275e-01];
L1E_L1I_iGABA_netcon = [-1.097681174579647e-02   +5.361099766648211e-01   -3.737391878652846e-01   -1.460345924935703e-01   +6.502710982391858e-01   -9.119357924506864e-02   +7.247911678827967e-01   +4.003077256389013e-01   -4.468941227288360e-01   -2.866993953155157e-02   -2.537534635494416e-01   +6.454058653512200e-01   +6.923218921207082e-01   -5.109819304651989e-01   +7.002093596319228e-01   +5.900280588536774e-01; -2.329548994683635e-02   +1.061607517537392e-01   +9.188311353818736e-01   -2.787068207318333e-01   +5.135481815799444e-01   -1.852388801657969e-01   +6.247767372763294e-01   +4.492797478837313e-01   +1.609775257822396e-01   +5.326043724556861e-01   +1.618085255201813e-01   -3.565536883929414e-01   +3.354513626418184e-01   +5.888422917701724e-01   +5.516175824048777e-01   +9.600602121472673e-02; +3.905126832189953e-01   +3.541895273116913e-01   -3.668482048777635e-01   +4.547532842849081e-01   -2.613938154684444e-01   -2.957194568767696e-01   -1.984577076705526e-01   -3.337406057353534e-01   +4.100868957424422e-01   +1.465816379878894e-01   -4.807548054521343e-01   +5.752447892950429e-01   -2.631686033195360e-01   -2.262674572987109e-01   +5.862354828937977e-01   +1.116076366073900e-02; +4.257870149430285e-01   -1.101569248074880e-01   -6.254310706886811e-01   +1.923994368298616e-01   +1.907804265722019e-01   -2.939484816692063e-02   -9.070091768479972e-02   +1.227010597970581e-02   +7.857475877903682e-02   +3.720875283135591e-01   +2.274271747134114e-01   +1.368248148119530e-01   -1.818089346693912e-01   +2.520033334318338e-01   +5.087320953356096e-01   -3.140898975541741e-01; -7.192961804701216e-03   +2.160143354851509e-01   +5.723866657430233e-01   +5.119165594580460e-02   +2.280952001162015e-01   -3.185458207211359e-01   -3.545364350548991e-01   -6.625411727315679e-01   +7.622879869526364e-02   +1.334919230360444e-01   +4.798868853279720e-04   +8.348641658116134e-01   +5.472196780013867e-01   +1.410632636841982e-01   -3.965410518850165e-01   +3.764061393492439e-01; +1.738089419260876e-01   -6.231965548527357e-02   -1.419248097015257e-01   -2.018151478097649e-01   -9.500918244134811e-02   +3.897818864198154e-01   -2.122135958080712e-01   -3.347924201378266e-01   +9.176993503630425e-02   +1.047293235915856e-01   -2.568769245166919e-01   +2.860021195227844e-01   +3.015079795807146e-01   -5.934865212847060e-02   +3.364217193657542e-01   -2.367845004819462e-01; -9.764944801297401e-01   -4.014494109273401e-01   -5.889058581446761e-02   -6.977820321597105e-01   +2.987529658333535e-01   -2.479900803723332e-01   -2.931959521679958e-01   -2.252511536334847e-01   +6.107296082148392e-01   +3.237684159154331e-01   +5.323279878283022e-01   +2.849975213635675e-01   -8.846336625390641e-02   +3.028462214844655e-01   +6.890182155266645e-01   +3.138723430165199e-01; +6.193954673503651e-01   +2.263315979493197e-01   -2.958808226892757e-01   -1.259257654834429e-01   -7.740029450392308e-02   -1.685022446120627e-01   +7.280970066632297e-01   +8.768107952358577e-02   +3.292066829771957e-01   +1.242124156168474e-02   -1.062213119559271e-01   -2.527717092847167e-01   +8.368385320723499e-01   +2.777819398383741e-01   +4.868609734586314e-01   +8.774521942771566e-01; +1.983191921302837e-02   +6.270312570955013e-01   +2.770666298744668e-01   -3.070595753309278e-01   -3.582393537932334e-01   +2.909518241441794e-01   -3.649626909236358e-01   +1.529687620857430e-01   +8.066162735630732e-02   -3.292720288481078e-01   -9.875938095901039e-02   -4.395721847468150e-01   -2.604609860464969e-01   +2.042414889844765e-02   +4.065368524493642e-01   +3.529043783179693e-01; +3.400946763505505e-01   +4.042592379283078e-01   -8.072047027726402e-02   -1.973167884239354e-01   -1.712063037409139e-01   +4.052170568585058e-01   -1.199826727898679e-01   +1.663725912193179e-01   +5.446866937224021e-01   +5.357597311789496e-02   -5.611485354919414e-01   +2.956088307981521e-01   +6.601273597368882e-01   +1.544989087232488e-01   -8.058356436314165e-02   -5.493988257626949e-02; +4.582708565185208e-01   -1.841661092761058e-01   +4.775152321093185e-02   +4.137270624256557e-01   +6.924373516512998e-02   -1.638676023374189e-01   +2.929987439951821e-01   -3.107200520957956e-01   +5.569054078087330e-01   +3.670942081764882e-01   -5.369528050778287e-01   +5.875191718153333e-01   +5.059372132329143e-01   +3.151755732671486e-01   +2.367851380596455e-01   -3.918468447651390e-01; -1.308800107540879e-01   +1.261961274001046e-01   +2.991180809861261e-02   -4.946434022257589e-01   +3.599212432575250e-01   -1.104072412732302e-01   -1.660405605788111e-01   +3.799202328962847e-02   +1.692693742710138e-01   -9.723186247086939e-02   +2.089073496864111e-01   -1.948097461584647e-01   +4.586275906502379e-01   +2.435331119320337e-01   +5.384930286671499e-01   -1.066082960580542e-02; +4.476280137569456e-01   +2.532084521718782e-01   -9.033492885472766e-02   +2.322870768172755e-01   -1.476302629885872e-01   -2.669591442456252e-01   +1.068548259945236e-01   +6.110236072911217e-02   +2.837636491548177e-01   +1.597817523440467e-01   -1.693281739180238e-01   -4.127531108472879e-01   +3.266358163478300e-01   +1.748398616831869e-01   -5.154565690093425e-02   +2.161734612821699e-01; +6.026028957954279e-01   -4.605193674069748e-02   -1.011801130585684e-01   +8.363153215330348e-02   -1.752579384797633e-02   -2.093284616234171e-01   +2.567707412502802e-01   -3.097643020754636e-02   +5.951082342280543e-01   +6.424095829679473e-02   -6.609236899673693e-02   +1.063270169783731e-01   -2.854338352404637e-01   +9.121547065908836e-02   -2.565925836148947e-01   +5.077308039262123e-02; +3.048088779559566e-02   +1.714169350916228e-01   -1.353892821745644e-02   +9.493296287454629e-02   -7.094353574948319e-02   +2.883092626736804e-01   +3.998229002365688e-03   +3.646538337411332e-01   +4.658232534030599e-01   +6.989817098738167e-02   +7.691432553604695e-01   +2.256468496909952e-01   -3.041312695730450e-01   -5.819628039223357e-01   +1.000000000000000e+00   +1.433077355416094e-01; -3.268537103012671e-01   +2.203385317950430e-01   -3.169531707653363e-01   -2.150925819864867e-01   -1.638103954086483e-02   -2.730973538120381e-01   -2.412383093639275e-01   +3.422250202491801e-02   +1.980753900073398e-01   +1.295113738701950e-01   -3.920835282083010e-01   -7.926217920572440e-02   +3.086486225099038e-01   +3.944216725107748e-01   -5.817719563853398e-02   +5.954054124622093e-02];
L2I_L1I_iGABA_netcon = [-3.857374665338552e-02   -1.921550352767020e-01   -8.322983863694680e-02   +8.666071622085818e-01   -2.363946858126754e-01   +4.476792098516792e-01   -2.689853292375672e-02   +6.488322731606844e-02; +5.456532936390662e-02   +6.892528700894280e-01   -1.814637836248575e-01   +5.792365701352557e-02   +3.346779077667221e-01   +7.037778475342527e-01   +2.185585684292154e-01   -4.087480212366841e-01; +3.133988594982904e-01   -6.220955176365339e-03   -7.213054069784725e-02   +3.237358646332890e-01   -1.423874749703439e-01   -2.320345693494230e-01   +7.744981663643619e-02   +3.069685162412401e-01; +6.267776591370874e-02   +6.668127741360419e-02   +6.330536762983456e-01   +4.714736252140037e-01   +9.239592688652214e-02   +4.422779754184889e-01   +2.895507428131077e-01   -1.346053082640020e-01; +6.496742568275557e-02   -1.213506817643718e-01   +6.384270312255304e-01   +7.421088782327603e-01   +8.798294743077734e-01   +2.017871145570415e-01   +4.273431660171688e-01   +3.469585198867802e-01; -3.378336848385578e-01   +1.136313285606961e-01   +7.638185374047657e-01   +4.420569758452266e-01   -2.566324853503921e-01   +7.106097904314581e-01   +6.538463208027131e-01   +7.719195239132113e-01; +1.355136139432841e-01   -8.722665202669994e-02   +2.848157505207721e-01   -1.367778764843949e-01   -8.062341528721247e-02   +8.472949135338801e-01   +4.312781368697898e-01   -1.361715956329048e-01; -2.535806831856428e-01   +3.871657601960498e-01   +3.433302873176161e-01   +2.990891599423244e-01   +5.996762868227798e-01   -3.881070380695244e-01   +4.461270550063750e-01   +7.992356978852622e-02; +1.981424255008158e-01   +8.183491524099306e-01   -6.266371020043890e-01   +5.436571433013021e-01   +3.494836412067474e-01   +8.604493737416441e-01   +2.336240577980070e-01   -6.265249082269739e-02; +1.492869144014004e-01   -2.783497617102415e-01   +6.409615999444253e-01   +2.143203735010280e-01   +3.335309359063876e-01   +4.790225838414059e-01   -7.258935784530183e-01   +8.328021660267147e-02; -1.871252717589290e-01   +2.308785304446850e-01   -6.466333856702181e-02   +2.200733819801031e-01   +6.339234395538906e-02   -4.413813278534578e-02   +2.089613684096450e-01   +4.395025535279724e-01; +3.570557082141294e-01   +4.256519845628508e-01   +3.208059540951383e-01   -3.499805431556827e-03   +1.173143245265125e-01   +1.895954532643074e-01   +8.055233038473631e-01   +5.153263372575362e-01; +2.787090026476720e-01   +2.280602788033620e-01   -2.073598322852833e-01   +1.748530927983139e-01   +1.204428890606538e-01   -5.472389763425437e-01   -2.573262002951363e-01   -3.633869758037895e-02; -3.054600936172785e-01   -2.767030965465066e-01   +6.847738569781381e-03   -4.409955173389090e-01   +3.517011448817109e-01   -4.252170965775772e-01   +5.473165559716244e-01   +5.984986937766725e-01; +6.067433462108951e-01   +5.250608737245652e-01   +5.047110608889505e-01   +4.251960020291830e-01   -4.130284812991600e-01   +7.744869827827793e-01   +6.609393347084871e-01   +2.290003310340603e-01; -6.414218120676796e-02   +1.359269181837239e-01   +4.352572850284605e-01   +4.790215343916620e-01   +5.939314505245036e-01   +2.159475292229067e-01   +2.041684228676827e-01   +1.448850001223837e-01];
L1I_L2I_iGABA_netcon = [+4.108203355892221e-01   -2.173050617000926e-01   -1.071252363131759e-02   +3.227876622207952e-01   +1.788488127418619e-01   +4.210937211395460e-02   -3.671417657343704e-01   -4.092626049917173e-01   +2.601073741619334e-03   +4.769362656550066e-01   +1.533404363172184e-01   -4.105427744748484e-02   -3.905188570422248e-01   +1.496274337358099e-01   -3.716743477209150e-02   +1.502984259542541e-01; +1.910847763510663e-01   -5.215627151014743e-01   -2.239452127247743e-02   +2.562808114836805e-01   -3.338110018784371e-01   +7.777438510385620e-04   +4.049234426981704e-01   +1.085832544963147e-01   +2.880826868042610e-01   +5.900232952807414e-01   +1.269321493734615e-01   -5.546283085169262e-02   +5.261323498805168e-02   -3.196075122988946e-01   +5.231761194010897e-01   +3.118657511345376e-01; +1.779300403570472e-01   -1.039691251350039e-01   +1.447912383317539e-01   +1.199608914323436e-01   -9.488479190390260e-02   -6.039804580114693e-01   +1.120065582792448e-01   -2.400428351860648e-01   -1.480299736282142e-01   +2.737000768740591e-01   -3.495218771748430e-01   -1.204362889425705e-01   +3.049098882425674e-02   +5.106825232509560e-01   +6.545368549039354e-01   -1.955499160137808e-02; +1.093546015575875e-01   +4.188261706768895e-01   +3.850508936245317e-01   -3.380755278264341e-01   +5.912186119618870e-01   +7.679610331004585e-01   +1.340623584364277e-01   -7.007291979089773e-02   +1.680549569139046e-01   +5.551922155851923e-01   +2.942306560914948e-01   +3.092412542496891e-01   +2.718359828367757e-02   +8.831667707426437e-01   +1.036904730521427e-01   +6.960573331919128e-01; -2.388692689408762e-01   +8.925355984281619e-02   +2.414386425686986e-01   +3.214610420914728e-01   +1.063880955988642e-02   +6.389717627023787e-01   +3.166084322534806e-01   +3.774742529660891e-01   +3.471806662261609e-01   +1.592873829326852e-01   -1.254881194746791e-01   +3.233802860847055e-01   -7.906154631516040e-01   +5.498461122874228e-01   +5.857210720243684e-01   +1.000000000000000e+00; +3.839197812570477e-02   +5.657275145512294e-01   -7.213444751497934e-01   +1.073753836916375e-01   +5.067783835950239e-02   -5.210209205298316e-02   +3.659106665292211e-01   +6.069609927789572e-01   +1.442093757980819e-01   +3.704105533182692e-01   +2.563863654943881e-01   -2.780441658392189e-01   +1.666220950725277e-01   +7.539365581714493e-01   +1.940998910692375e-01   +1.124463295299998e-01; +3.426756926013992e-02   +5.226833529478520e-01   -3.670508426367018e-01   +5.841116100634809e-01   +3.433413392137298e-01   -5.057128245915882e-01   +2.033068178034791e-01   -1.539422031861308e-01   -4.984471231650780e-01   -2.084927323351456e-01   +3.971046878294251e-01   +5.740105372860430e-01   -6.912271384360270e-02   +3.695174382616992e-01   +1.836143041287157e-02   +1.983125859838464e-01; +4.275595770441887e-01   +2.500405922654642e-01   +2.124301666053647e-01   -1.915700909290855e-01   +1.366156740238255e-02   +3.020195740745734e-01   -1.413323358726658e-01   -4.442165745161465e-01   +1.787720441655205e-01   +1.553876021291543e-01   +3.026797683720073e-01   +6.392976413579710e-01   -2.299845718973466e-01   +1.882811768887013e-01   +7.908809772855327e-02   +5.171208291148260e-01];
L2E_L1E_iAMPA_netcon = [+5.480793423204139e-02   -6.771852767626646e-01   -4.672226112984783e-02   +4.970603455448022e-01   +3.106143371082764e-01   +4.248562398533356e-01   +4.943154797915413e-01   -2.920000748850727e-01; -1.602819437342473e-01   +1.379206430199577e-01   -4.803807007769572e-01   +3.973060276523840e-01   +3.015499143404357e-01   +4.113786865049763e-01   +1.439963863643809e-01   +3.704234127779332e-01; +5.563213854852719e-01   +1.883888335071074e-01   -4.759097471493667e-04   +3.896430069360660e-01   -1.151316958114192e-01   -1.530970953100066e-01   +1.254995424466095e-02   +4.075419394250350e-01; +1.089708366220979e-01   -1.226843324401512e-01   -3.905887608144974e-01   +2.514613754060288e-01   +1.853825386859053e-01   -3.020977207571024e-01   -3.485431808039824e-01   -2.627877727306348e-01; +1.540597851735501e-01   -8.795265916177569e-02   +4.241117635483216e-01   -5.449824501904436e-01   +2.011805703092863e-01   -4.591886497402029e-01   +2.271036345411446e-01   +3.133753233622164e-01; +8.721529717689683e-01   -8.660934185087708e-02   -5.065548232946415e-02   +6.099350661452539e-01   +2.532485449447298e-01   +8.173946635080614e-01   +5.659502641274010e-01   +5.707508813067412e-01; -4.727548298517992e-01   +7.374305661602596e-01   +5.047443329646825e-02   -3.134694570125094e-01   -1.104261033417076e-01   +4.655361101505326e-01   +7.768244264945781e-01   -4.741532642568618e-01; +1.415400314407380e-01   +3.861757656215372e-01   +9.370688752403254e-01   -2.840102502740772e-01   +3.450862084349642e-01   +1.671434265895899e-01   +6.842746378679592e-01   -5.677043154544378e-02; +4.565792973910676e-02   +2.530782395667949e-01   +9.614431865905759e-01   +5.140347757569061e-01   -9.546297002418735e-01   +7.057222403731327e-01   +8.348274808061817e-01   -3.767370024757767e-01; -4.637581774343666e-01   +4.179642057032709e-01   +2.063049891749952e-01   +5.114313761248225e-01   -9.693297542428563e-02   -4.330936878432206e-01   -2.184867593294415e-01   -2.601985623899827e-01; -1.211328119022460e-01   +6.339448734206466e-01   +6.355758502119888e-01   +3.566748260398353e-01   +6.214946479756761e-02   +1.456036139382083e-01   -7.060244720815884e-02   +1.757299638606513e-01; +1.975249609567559e-01   -1.188217014939445e-01   +4.810244590796485e-01   +1.971312121478852e-01   -3.879569952838582e-01   +1.473989366550332e-02   +7.843167531865841e-03   -3.156630610142916e-01; -2.316164385998177e-01   +2.330181740247761e-01   +3.432841538377129e-02   +1.531463494440616e-01   +4.659188184918627e-01   -7.394861586584769e-01   +3.138343916040117e-01   -2.307831192597831e-01; +4.393006392940995e-01   +7.671914125721047e-01   +1.955545383391609e-01   -5.706707166495238e-02   +5.026841580436625e-01   +2.769935669955819e-01   -3.767188925423925e-01   +1.233768530644499e-01; +1.627788214005352e-01   +2.268140802066765e-01   +9.997496936356154e-03   -1.757884924958586e-01   +7.293687871241133e-02   -3.415000891143220e-01   -2.428985138594232e-01   -3.490269176481658e-01; -1.613189421150906e-01   +3.094336466455399e-01   -9.094300584419868e-01   -6.577402956952881e-02   -2.184676684701664e-02   +1.807512172561981e-01   +6.922124058656448e-01   -3.389655727470629e-01];
L1E_L2E_iAMPA_netcon = [+4.495570396647903e-01   +3.730817927536459e-01   -8.579793128346003e-03   +6.871123887475389e-02   +1.468675885619007e-01   +1.785567119002176e-01   +3.469789049073171e-01   +1.023274859716680e-01   +1.117590020193940e-01   +4.347416676076889e-02   +6.374221599883541e-01   -2.097295476473351e-01   -2.630985423192169e-01   -1.624435619943392e-01   -3.004557900409714e-02   +3.404876234490814e-02; +2.482417083629454e-01   -3.716761364708414e-02   +2.575807991074263e-01   -1.694664908522506e-01   +2.316625321465640e-01   +1.688101157013429e-01   +6.291253507619207e-01   +3.384425537791676e-01   +2.175542263775826e-01   +8.143790203724202e-02   +5.734964968330842e-01   +1.189965924816732e-01   +8.250479880386454e-01   +3.082162241344352e-01   -8.095210059778750e-02   -3.814214271541767e-01; +9.409359482948207e-01   -3.243597386871671e-01   +1.648823265337372e-01   +4.193177258056016e-01   +5.796698792727335e-01   -3.435480938252605e-03   +1.355060854999172e-01   -2.340550932415290e-01   +3.848146949863627e-01   -1.043415637375202e-01   -6.535545581403932e-01   +1.864312422112467e-01   -9.900098868465008e-02   +2.897331612257502e-01   +2.061381131891014e-01   +6.607698330130370e-02; +1.663327864929622e-01   -2.504840990707232e-01   -5.191743752781124e-01   +4.953743933735871e-01   -2.295977498058373e-01   +7.908278807620486e-01   +8.340961978977155e-01   -2.808631937984080e-01   +1.719598644847306e-01   +1.335102102771280e-01   +4.614551927152869e-01   -5.567749344639648e-02   -4.554317586738652e-01   +8.133318802647963e-01   +6.599839993707908e-01   -2.670686060670433e-01; -1.870521418956695e-01   -4.284669099337420e-01   -8.749065888164770e-02   +1.601402938925718e-01   -9.030856960809185e-02   -1.946411884168723e-02   +3.070975121321626e-01   +7.628128068058433e-01   +2.524213961471921e-01   -5.115390916662299e-03   +2.168084598955301e-01   -3.587571773678260e-01   -2.011266981428705e-01   -1.601105947294397e-01   +6.549746023224684e-02   -5.126902039042475e-01; -2.392611589728468e-01   +7.370495749348795e-01   +9.992890139827398e-02   +4.741385248763409e-01   -1.465489308538237e-01   -7.623387624273267e-02   +8.712228979295334e-01   +2.080658648808932e-01   +2.295308737903618e-01   +3.964223392080382e-01   +3.648469944251047e-01   +2.206675705126337e-01   -2.669716711580868e-01   +1.590835049710910e-01   +7.760421600248674e-03   +9.506349119468032e-01; +1.421546015192644e-01   +4.948356476896599e-01   +5.386673191065813e-02   +1.796040839708548e-01   +2.680109715146927e-01   +4.902959540580711e-02   +3.561331446824965e-01   -8.987765133590304e-01   -4.214004071507149e-01   +1.843671197634948e-01   -2.411214879473113e-01   -2.270045769779587e-01   -7.363705986804895e-01   +5.597987456209500e-01   +2.825172624583075e-01   +6.661871966329943e-01; +6.179261475150626e-01   +1.806633776126490e-01   -4.526116310570900e-02   +5.070707496512288e-01   +3.732876269897367e-01   +4.172163506503087e-01   -3.205447569166392e-01   +1.989925141838191e-01   +7.652025841413589e-02   +4.134394092746909e-01   +4.830794519984376e-02   +1.983946481842607e-01   -8.197296371935626e-01   -1.885329849618577e-01   +3.884074431671033e-01   +3.860959066509867e-01];
L2I_L2E_iAMPA_netcon = [-3.363074112712533e-02   +7.091195413346030e-01   +5.407689532671676e-01   -5.226628071497430e-02   +2.302085994553223e-01   +1.644502568569812e-01   +1.773934929822130e-01   +5.772449455897199e-01; +5.974360994043026e-01   +2.717304866730725e-01   +3.571019461742390e-01   +7.266713005224084e-01   +8.520144073125793e-02   +4.554313582695368e-01   +6.836195582000437e-02   +3.723320472184318e-01; +2.141282258854816e-01   +4.445401129522150e-01   -3.238357882067882e-01   +4.139922954416482e-01   -1.244894699836490e-01   +4.419613232302703e-01   +7.824001674536583e-01   +5.669940852660557e-02; +3.822324866008613e-01   +5.270519256880424e-01   -5.094221510271237e-01   +1.570629470558348e-01   +7.356675821766930e-01   +2.780352466535662e-01   +2.891017048147829e-01   +6.348583090663393e-01; +7.654048390305207e-01   +2.575759029749506e-01   -2.974250544806111e-01   +3.734779122023284e-01   +7.092204312431211e-01   -1.098611659281063e-01   +1.109797498743001e-01   -1.896534337185383e-01; +4.039592528789550e-01   +2.949120722923362e-01   -5.652428718557717e-01   +2.770617863355381e-01   -3.685371702425090e-01   +7.139532952990008e-02   +2.649436550408683e-01   -2.585381081222632e-01; +7.740358818536327e-01   -2.751068428644204e-01   +6.357670259711585e-01   +3.488334200979127e-01   +4.974712615006052e-03   -3.041081845998367e-02   +5.816733393608310e-01   -5.025162712272300e-01; +4.304938283052488e-01   -4.248237277776942e-02   -6.741331771595453e-01   +1.465896894518491e-01   -2.160774366030029e-01   -1.623640550508930e-01   -8.141104045252864e-02   +8.623573469601397e-01];
L2E_L2I_iGABA_netcon = [+3.157694490424179e-01   +6.799261875068972e-01   -2.104573038236376e-01   -1.871896263181008e-01   +1.298060192407602e-01   +1.111456855701206e-01   -4.778151934755631e-01   +6.343521733199174e-01; +1.453063838258663e-01   +6.124218745147753e-01   +3.217668283724780e-01   +8.157009727518799e-01   +3.090422562860773e-01   -2.734018855180674e-01   -5.335124868044822e-01   +4.309089628901408e-02; +4.549782367941492e-02   +5.544135525401580e-01   -5.017141704660015e-01   -3.995414351492054e-01   +4.415713374704570e-02   +7.994456704485990e-01   +4.109199150566326e-02   +1.436143476471126e-01; +6.532061513709174e-01   +1.525944368058645e-02   +9.264556754050896e-02   +7.319472338499672e-01   +7.226125299079074e-01   -1.787150865471550e-01   -4.860398940949042e-01   +5.989151580580666e-02; -2.478938197408485e-01   -3.076051118136552e-02   -2.002776265793538e-01   +2.173394242413497e-01   +7.420865741253134e-01   +3.212701945846873e-01   +7.392368781640259e-02   +7.824579740195611e-02; +7.697395900482074e-01   +2.039359393645544e-01   +3.607459267324786e-02   +3.584574585803484e-01   +1.291188312945922e-01   +1.045156390363698e-01   +4.816124042389443e-01   -5.296884633699777e-01; -4.374842818742175e-01   -1.011466575697913e-01   -1.289986117490081e-01   +1.124833954664481e-01   -2.041098059399348e-01   -1.319455668014027e-01   +2.037688123936795e-01   +8.684340856165037e-01; +2.125927894967740e-01   +1.682194054464289e-02   +6.493901701155222e-01   +5.718419872930605e-03   +5.104840091112841e-01   +2.413474424394316e-01   -1.370655493197777e-02   +6.748288824029678e-01];
L3E_L2E_iAMPA_netcon = [-8.579814422095598e-02   -2.328277619036566e-01   -4.203297397506656e-01   +1.176206117036471e-01   +8.702959204970686e-01   -1.215152220940806e-01   +2.384597673841494e-02   +8.819714664830407e-01   +4.207467077966525e-01   +3.518661781601404e-02   +3.879047514912303e-01   -7.389416648440182e-01; -4.031201777304635e-01   +1.539971755442357e-01   -4.042699417753879e-01   -5.311062210435527e-01   -5.067724575743754e-01   -1.841308128364212e-01   -1.339378026969064e-01   -6.391875956562304e-03   -4.164863639949869e-03   +5.563646344249339e-01   -2.652907282516490e-01   +5.790067248443955e-01; -5.414959660705269e-01   -6.733502762038959e-02   +7.112052705002686e-01   +4.750588256693629e-02   +2.101611883005885e-01   +1.389018980226716e-01   -1.633760202025183e-01   -1.710039416037403e-01   +5.527288220559401e-01   -4.757675628703047e-01   +7.233919678840440e-01   +1.067429586593233e-01; +5.989529762291038e-01   +5.587961979539269e-01   -2.835277188959463e-01   +8.131592361349688e-01   +8.700934536487986e-01   +5.124998799253948e-01   +4.739689915395592e-01   +7.715583430157500e-01   -1.851703618441124e-02   -1.617284022608598e-01   -1.013302575220393e-01   +3.376705501870054e-01; +1.980658774513189e-01   +6.538634053029186e-01   +1.000000000000000e+00   -5.392171423813052e-02   +6.165447459726515e-01   +7.512968194256429e-01   -6.105376406904225e-02   -2.140967412893290e-01   -4.563406147253094e-01   +2.353535371189801e-01   +7.048418395679630e-02   +5.807585768366778e-02; -3.069610558314090e-02   +4.115293875254830e-01   +4.412322401230021e-01   +5.534432591300727e-02   +9.565708165333875e-01   +4.025010164687113e-01   -1.581608826229994e-01   +1.830996893419580e-01   -2.158221001008673e-01   +4.675566479760655e-01   -1.779587980189780e-01   -3.201686147772331e-01; +6.273784356318310e-01   +2.508013270071631e-01   -9.907266513771651e-02   -6.832444277436452e-02   -1.482027193328563e-02   +4.113519055544643e-01   -5.686092596443134e-02   +1.638054680311823e-01   -1.116261490260320e-01   -4.177586770900843e-02   -1.560279386151331e-01   +2.029294767049884e-01; -1.421276298914687e-01   +4.776560922396461e-01   +7.286807713484657e-02   -3.432311022984100e-01   +4.384624978199748e-01   -3.190618815952644e-01   +3.543191680934710e-02   -2.356344657869137e-01   +2.430745535674151e-01   -2.298272664768908e-02   +4.942568897753956e-01   -1.939198516500659e-02];
L3I_L2I_iGABA_netcon = [+7.812303876544499e-01   +6.813248340480782e-01   +1.646092574391506e-02   +6.036935326185316e-02   -2.614550162115064e-01   -2.677539678976804e-02   +8.947844287151063e-01   +6.922737766740160e-01   +1.809883829850906e-01   +4.184187635155246e-01   +5.561713385615352e-02   +2.693891097303727e-01; -1.659685221042281e-02   -2.068076406906419e-01   -1.677729343918165e-01   -1.027078767544897e-01   +5.346932536385500e-02   +7.582333117636229e-02   +1.151284271443775e-01   +1.210023002138311e-01   +3.249248820134434e-02   -1.377967733070967e-01   -1.183074173533691e-01   +4.524500418895366e-01; +1.330360260269182e-01   -1.035260976537033e-01   +2.088662702746319e-02   +3.964580668833282e-02   -4.734809016557625e-01   +2.900639056883597e-01   +1.152962967208814e-01   +1.294852806186728e-01   -2.430348528774686e-03   -2.676932666005903e-01   -1.726778021162729e-01   +6.052335787963019e-01; +3.345647113365924e-01   +2.127323520935784e-01   +2.290606527251006e-01   -9.714636052843403e-02   +1.180772431554118e-01   +4.317979397997584e-01   +3.928635714932588e-01   +6.180046356205438e-02   +3.765383656422092e-01   +4.096267751442680e-01   +3.835647756853501e-01   +2.218017169269784e-01; +5.884047902614073e-02   +3.493646094779419e-01   +1.162057715635630e-01   -4.681850073661719e-01   +1.216731846551339e-01   +3.516873005723345e-01   +1.484899227540775e-01   -7.716970809233155e-02   +2.708364719087291e-01   +7.145873720064561e-02   +1.429350547788856e-02   +1.898682442606107e-01; -5.170784080393380e-02   +1.796077541496260e-01   +2.355824746511619e-01   -2.562619282078669e-02   +1.756709071555296e-01   +1.219862588775331e-01   -4.594698138541972e-02   -2.836458528456826e-02   +1.281970060357905e-01   -1.871544578657795e-01   -7.758062685060254e-01   -3.197132269877081e-01; +1.481918764915418e-01   +2.773469995514938e-02   +3.609840110769174e-01   +3.309080433266557e-01   +2.595903844089061e-01   +4.794056565441163e-01   +2.664222331947670e-01   -2.106794999868399e-01   +4.410381348325054e-03   +3.133121996271723e-01   +3.346998263154158e-01   -4.256847844299343e-01; +2.037257370739664e-01   +1.622828976895963e-01   +2.552602063949068e-01   -6.829745626112882e-02   -1.267494461988465e-01   +5.552536125783031e-01   +1.789986173870335e-01   +5.317681391825461e-01   +2.644310168957785e-01   +1.012027879805302e-01   +2.562408891224764e-01   +4.639593430990755e-01];
L2E_L3E_iAMPA_netcon = [+8.156592729691202e-01   +1.889403218292426e-01   +1.858168722525554e-01   -2.550986962068242e-01   +3.156097522051604e-02   +7.271749633291208e-02   +4.792110216544634e-01   +5.004022252270898e-01; +4.975964097091957e-01   -3.392970672825665e-01   -2.852762265321845e-01   -5.751129982157162e-02   +7.398551484434412e-01   -7.343588243739042e-01   -7.526840073368590e-01   -5.241829461822549e-01; +1.368804125601405e-01   +4.188900386325381e-02   +3.923795228467519e-01   +1.530232969257277e-01   +5.500776519573093e-02   +2.622806657241695e-01   -2.816370911246180e-01   -1.639994010963300e-01; +5.890667576998420e-01   +2.417459149062972e-01   +6.562072659220208e-01   +7.784481124442695e-01   +6.644562010084895e-02   +2.303952995307476e-01   -2.709510282569439e-01   -4.688508931101902e-01; -7.105787901388369e-02   -2.247940010073466e-01   +4.593173030342665e-01   +4.034993267597672e-01   -3.200942199796496e-02   -2.550003551171006e-01   -1.361581758415103e-01   -4.673589092212297e-01; +3.493048797868519e-01   +2.804329397034889e-01   -3.489777385477577e-02   +6.333053689832246e-01   -1.597809541748896e-01   +8.850360743707537e-02   +4.117131450502283e-01   +1.454498401267779e-01; +7.375542639452735e-02   +6.556397916445622e-01   +9.446215096309643e-01   -3.116514730680824e-01   +4.947358257852388e-01   +3.137611292575999e-01   +4.770991022463371e-01   -2.161399436656743e-01; +2.399571810461568e-01   +5.487856908149673e-01   -4.292681136877432e-01   +2.270238724114190e-01   -2.186244801156841e-01   +2.212369816006654e-01   +1.672929570915483e-01   +6.092034587536326e-01; -3.440373207929577e-01   +4.670717856328030e-01   +7.240440769009882e-01   +5.011157100044695e-01   -2.789325997006096e-01   -2.478347494903779e-01   +5.713496785360260e-01   -2.186200456598816e-01; -3.368203759536060e-01   +5.526223855230675e-02   +2.912792466338300e-01   -1.437841444572488e-02   +1.835648144083036e-01   -5.513942112959869e-01   +6.343988121851167e-01   +1.453646451398546e-01; +5.711107792923359e-01   +6.232516333712993e-01   +2.318588912746737e-01   +3.419139153913299e-01   +4.075416778022323e-01   +7.212633311617943e-01   -3.418244240149951e-01   +2.262145536825482e-01; -1.115653037701456e-01   +2.316118852574950e-01   +7.199582393511947e-01   -2.037376448779022e-01   -1.498143875432657e-01   -9.731355128440235e-02   +4.049769451832218e-02   +2.299139132525267e-01];
L2I_L3I_iGABA_netcon = [+3.877641687371003e-01   +1.520587179727854e-01   +4.294402473716240e-01   -6.350787215712583e-04   +2.031092263951662e-01   +6.915227716508482e-01   +7.393849138385550e-01   +2.249940815481460e-01; -2.910040317855125e-01   +3.202733607702709e-01   +4.633858543200854e-01   -1.169834653535716e-01   -4.029835120402032e-01   -2.619011921192920e-01   +5.812286855636075e-01   +6.990543946738031e-01; +1.952271949329851e-01   +7.289458703701749e-01   +4.934834021546135e-01   +1.207942401591664e-01   +4.070221501868043e-01   +2.243596940073564e-01   -6.861882357888312e-02   -2.770056656436813e-02; +9.151259526629922e-02   -4.933963258660337e-01   +2.859888303057810e-01   +2.193905527773687e-01   -2.057896330150494e-01   +1.465321372021643e-01   +3.182499590884660e-01   +2.260424873522504e-01; -2.630722137756548e-01   -7.906374454776721e-02   +2.334803197580732e-01   +1.622843095413022e-01   -2.011922803134641e-01   +2.844112925505712e-01   +2.595459049324611e-01   -5.640496863909619e-02; -3.168962841134425e-01   +8.805048456572744e-01   +2.447074428306566e-01   +4.516974099206102e-01   +3.556046381010338e-01   +1.972853501087097e-01   -4.178511134253398e-01   -2.836014590547943e-02; -7.307652552156779e-02   +6.969955452953326e-01   +3.535908683967808e-01   +2.808377970682070e-01   -1.615181967889021e-01   -1.253465151192780e-01   +5.153027455068906e-01   +4.408222965593112e-01; -3.993575510522658e-01   +5.433572114147319e-01   +3.655766338270618e-01   +3.251571227380616e-01   +1.392768679387949e-01   +7.298384173031142e-01   +1.338889699040625e-01   +7.918800761339103e-01; -5.836764504276740e-01   +4.192971130051808e-01   +1.200792072793518e-01   +2.397284560768575e-01   +1.218448548920166e-03   +3.675611617579309e-03   +2.827367410140380e-02   +2.645665228489523e-01; +7.659364829629392e-02   -3.582740067292092e-02   +5.461446502637243e-01   +2.449052166365511e-01   +3.663993034754200e-01   +3.245100008742963e-01   +2.665056245013769e-01   +1.426358446074652e-01; +2.288970814817570e-01   -3.168435480839194e-01   -5.559359024252819e-01   +4.843373586979534e-01   +1.606112495637224e-01   +1.437582752124327e-01   +1.234393886042420e-01   -3.560096454456949e-02; -4.820851258665115e-02   +6.983352890508804e-01   -1.175937265258654e-01   +1.782694615057958e-01   +6.309059794782705e-01   +5.744492881760017e-01   -3.910655596672102e-01   -3.272215650771063e-01];
L3I_L3E_iAMPA_netcon = [+2.036471387891052e-01   -7.493250876311208e-01   +3.517036902380732e-01   -1.817444016509141e-01   +1.957001621753759e-01   +4.449807953805792e-01   +2.557476043609853e-01   +3.208848340579478e-01   +5.799914334331380e-01   -1.528763843518701e-01   +1.797458899974002e-01   +5.227567592648684e-01; -1.814807596961837e-01   +4.987652031647281e-01   +4.508089652740428e-02   +4.068295615735153e-01   +3.429132500596203e-01   +1.109522127794779e-01   +6.335781379901604e-01   +1.000000000000000e+00   +4.090590920848027e-01   -1.221372102570555e-01   -8.402607440208963e-02   -2.686926852379551e-01; -1.064192181851532e-02   +1.538261959493002e-02   +2.960936811135814e-01   -6.761236893068270e-02   +7.474487591640598e-01   +1.419406987322791e-01   +2.397519409499648e-01   -3.975058980997254e-01   +3.388065821583037e-01   +3.031337890816526e-01   -2.447761438829630e-01   -2.119079105759069e-01; -2.480792802107513e-02   -1.747585945716842e-01   +1.499933698861807e-01   -1.685528271327622e-01   +3.194741681233744e-01   +1.603855962362170e-01   +1.881227115144105e-01   +3.618713626216633e-01   +3.691604304333378e-02   +1.184882222299242e-01   +2.411664027348390e-01   +2.982725819099376e-01; -3.669879446037548e-01   +3.325528291799130e-01   +7.292259522454042e-01   +5.397614021665239e-01   -4.781502033887464e-02   +2.722279862009129e-01   +1.582756216015411e-01   +2.191948266528739e-01   +1.753843535933854e-01   -2.270988410949960e-01   +5.967649138087532e-02   +4.363083139900727e-01; +1.298936335070912e-01   -1.946333522904030e-01   -3.832257446765084e-01   -4.307489220624467e-02   -7.127324692332927e-03   -1.892949943603734e-01   +5.714124731631688e-01   -7.110553862993418e-03   +2.112824872241131e-02   +4.127772614994139e-01   -3.570296429416102e-01   +6.390370719711217e-01; +1.880785491105307e-01   +2.348835263484395e-01   -8.143916893542465e-02   +3.089216483642638e-01   +4.832532342356176e-01   +2.761532922889515e-02   +1.422995723777569e-01   -7.926888127869604e-02   +1.962770841455012e-01   -1.204518850111326e-01   -3.103049725616369e-02   -1.929923535709105e-01; +4.802544288500261e-01   +2.533086615413642e-01   -7.021719550379900e-02   -9.265048978908529e-02   +3.857433614696351e-01   +4.286151663764116e-01   -3.127789944396115e-01   +1.953067270692799e-01   -1.130074796731843e-01   -1.153250218241580e-01   -3.817826402158919e-01   +3.800605773377720e-01; -3.370788778573456e-01   +5.418797439453670e-01   +2.148221441958161e-01   +6.218703877196556e-01   -1.821775069912110e-01   +4.861349087570545e-01   +3.499716339892414e-01   +5.647251381342557e-04   +3.144994826997316e-02   +4.293901325944566e-01   +2.071300362171946e-01   +3.630569715079725e-01; +8.023066306257204e-01   -3.619310394440861e-01   +2.136017176225196e-01   -3.074281739159340e-01   +1.332108349043292e-01   -9.187027575100142e-02   -1.203813364994085e-01   +3.269457400180312e-01   +1.236401016994152e-02   +1.750996748846772e-02   +5.350607026385720e-01   -3.722999933046849e-01; -8.288253353399057e-02   +5.280834256549498e-01   +5.722299555917422e-01   +2.525247044474601e-01   +3.603736232337646e-01   +1.905433099218983e-01   +2.630547886681430e-01   +1.124335564602203e-01   +2.558713427140393e-01   +2.050834294231016e-01   -3.905211900982840e-01   +4.735446599769680e-01; -1.759063596929734e-01   +3.974184927596896e-01   -2.174685762745091e-02   +5.669872881091993e-01   -5.460666563817136e-01   -3.018462972525841e-01   -1.970213153067568e-01   +4.798697471265561e-01   -2.325132826785461e-02   -4.596735333883294e-02   +1.397907142378285e-01   +9.709030135657784e-02];
L3E_L3I_iGABA_netcon = [+1.092307936608251e-01   +9.829795516126610e-02   +3.082442203748428e-01   +2.334501944041284e-01   +1.662022888458700e-01   -8.559820913158221e-02   -1.781723745430268e-01   +2.797494461232550e-01   -2.084411096285690e-01   +7.007347466039796e-01   +3.814407875524987e-01   +5.428493815892942e-01; +3.642114974587024e-01   -2.423843207249809e-01   +5.017541705528862e-02   +4.233945204511392e-01   +3.024878604356062e-01   -3.997270898240768e-01   +1.026906764277578e-01   -5.232926313516720e-03   -2.696936804437498e-01   +2.137840840959258e-01   -6.784559184614716e-01   -1.190286021139206e-01; +4.742273003513213e-01   -2.668526291288855e-01   -4.269449441900249e-01   -3.986253659171582e-01   -2.383969746520367e-01   +3.035868737137128e-01   +4.087880200789043e-01   -1.274695393757935e-01   -7.194766296526764e-02   -1.958889635703596e-01   -1.133844490740150e-01   +2.704935500215915e-01; +2.613667431637157e-01   +6.075757715834880e-02   -1.550175303798285e-01   +4.337892322319344e-01   +8.041161167762426e-01   -2.489464478902357e-01   -1.606887713230093e-01   +2.884754892662401e-01   +1.000000000000000e+00   +1.254574610072110e-01   +5.511588944466083e-01   -6.508900731481410e-02; +2.919937090401825e-01   +3.498236920154465e-01   -2.178674354446906e-01   +4.601315186341082e-01   -9.076744693692328e-02   -3.766742980179203e-04   +3.479297889156911e-01   +2.555558238884399e-01   -7.269848352363263e-02   +7.481078151446641e-01   +1.674901678987183e-01   +8.852413224629022e-02; +1.927078766593881e-01   +2.516177762914720e-01   +3.787120509037955e-02   -5.981740035535570e-03   +1.711269798582131e-01   +1.330239250371392e-01   +1.868245595478339e-01   +2.707849258530087e-01   +6.245728355082850e-02   -1.629808650845851e-01   -1.333082916343584e-01   +3.082214217378094e-02; -3.112427307975045e-01   +2.368842969761463e-01   +2.027870932422597e-01   +7.848812575293508e-01   +1.635502745970503e-01   +2.423302304949999e-01   +4.399974063533482e-01   +6.078712676825584e-01   -2.304870494495241e-01   +5.133387672159745e-01   +4.337849432538733e-01   +3.160199950269393e-01; -1.061303541055707e-01   +2.650554584217427e-01   +3.121700235625335e-01   -5.825928410980786e-02   +1.453201686755077e-01   -3.524328526765315e-01   -7.914505714923498e-01   +5.273202110368765e-01   -7.102003670999518e-02   -4.849634859481125e-01   +4.007567294092079e-01   +2.775401312711773e-01; +5.182301788945033e-02   -3.319622191577632e-01   +4.988526869343793e-01   -3.043524943866355e-01   +2.823086468542593e-01   -2.397835171775370e-01   -7.581090547551612e-01   +2.116917292229281e-01   +2.688138789660905e-01   +5.849559629323680e-01   +3.025934158995719e-02   +4.968509426731109e-01; +2.751055467091569e-01   -1.418773603506456e-01   +2.830401383719262e-01   -1.201949914349341e-01   -3.407625558324494e-01   +2.600699192656190e-01   -5.343551472765276e-01   +3.123490181861676e-01   -2.084529597077620e-03   -1.849384686393331e-01   +4.673502546074486e-01   +6.750057688560979e-02; -9.861648593103704e-02   -2.246107846220431e-02   +2.784399357389754e-01   -4.059508676703925e-01   -4.203729892826418e-01   -1.594913123312910e-01   +3.769962473856014e-01   -1.947456069998669e-02   +2.644241903023172e-01   -4.260182675458969e-01   -8.942267228239170e-02   +5.459985227665423e-01; +1.016915219953422e-01   +2.930954318324433e-02   -3.426419525437142e-01   -1.970659723442662e-01   +8.760318991407587e-01   -1.773681676717525e-01   +5.373421504421654e-01   +4.632262663194918e-01   -4.709676539706754e-03   -4.763913393092365e-01   -8.942675235014007e-02   -4.620154959801422e-01];
L2E_Input1_iAMPA_netcon = [+9.112655488274659e-01   +9.056652560669434e-01   +7.382692235092900e-01   +1.242887818138976e-02   +3.786674527370396e-01   +7.933531013531457e-02   +6.425392443106124e-01   +3.898152453276273e-01];
L2I_Input2_iAMPA_netcon = [+5.063914294217327e-01   +8.405741777483190e-01   -7.852315581695953e-02   +1.769558647512006e-01   +1.387504231943950e-01   +3.908532782800715e-01   -2.836069089121721e-01   -1.426286396762800e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
