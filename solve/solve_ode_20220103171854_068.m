function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.464008419507228e-01   +8.096294365816276e-01   +1.325796486277791e-01   +8.619167193476017e-01   +2.243176307520914e-01   +5.103748305605426e-01   +6.306810147798432e-01   +8.178312670338211e-01   +5.171993905684683e-01   +4.322528207809272e-01   +3.359361483145615e-01   +5.038058349955246e-01   +8.219997443866752e-01   +1.285161530815759e-01   -2.068574573136945e-02   +2.075937484512849e-01; +8.813067580479768e-01   +6.309296935392171e-01   +7.421734530610912e-01   +2.702884923872171e-01   +1.536007954338585e-01   +2.831559351891717e-01   +6.068241465549189e-01   +4.610763919444231e-01   +4.640319227181478e-01   +9.426527395143067e-01   +2.350138780748715e-01   +5.086204474437677e-01   +5.630011803093765e-01   +9.031724608900279e-01   +7.523832218191551e-01   +2.540940332352666e-01; +3.734675128496231e-01   +4.511296505414240e-01   +4.780982485786791e-01   +4.989354357082411e-01   +7.078022389294363e-01   +2.504061587811414e-01   +1.112013187387956e-01   +5.958872561559946e-01   +2.678019646155564e-01   +3.386817398502542e-01   +9.140673058072269e-01   +6.388360753713203e-01   +9.128642474423565e-01   +8.721798299971013e-01   +1.558465533850680e-01   +4.889426976877520e-01; +5.399435902468732e-01   +2.939763957162991e-01   +6.403011436077065e-01   +9.579142526283465e-01   +9.128230461927493e-01   +9.244608904931922e-01   +8.473437642346610e-01   +4.798468552739939e-01   +2.578404448960601e-01   +1.540620892162659e-01   +4.552628132233761e-01   +7.246995564426060e-01   +5.206408094586085e-02   +6.671343702472671e-01   +3.721079116184038e-01   +2.943655525327430e-01; +6.906152145025536e-01   +3.978769760892334e-01   +6.466150397249439e-01   +1.341566216444304e-01   +7.183395007273879e-02   +8.406985530060886e-01   +1.353428274063646e-01   +1.013897444804997e-01   +5.685534931287254e-01   +3.824853158969634e-01   +7.592467617002914e-01   +4.282209344715596e-01   +8.624662476339278e-01   +4.680866892486265e-01   +8.096141036829054e-01   +1.296223466925681e-01; +1.141126285447046e-01   +4.874214225617532e-01   +4.842681133983042e-01   +1.902466092911573e-01   +7.880626141443028e-01   +2.906737829281772e-01   +8.842028964345658e-01   +5.404522947347308e-01   +1.169326598217992e-01   +8.437523560757791e-02   +4.368920476530172e-01   +1.000000000000000e+00   +5.050618139067619e-01   +6.005087132420491e-01   +4.311806257328102e-01   +3.872752576679675e-01; +3.175145759889240e-01   +7.188707995151363e-01   +1.919625974775615e-01   +4.873764832020335e-01   +2.018014189457295e-01   +8.012371840107403e-01   +9.847174912067232e-01   +8.223506823686169e-01   +8.083590364032770e-01   +9.870094305991431e-01   +9.157972295704281e-01   +6.479625621387367e-01   +5.165329495989198e-01   -6.886227467724259e-03   +5.040610166729926e-01   -5.569220513959976e-02; +4.127350123248680e-01   +1.582462977858055e-01   +2.529115938060919e-01   +6.352120160332697e-01   +5.917317913884552e-01   +1.115825525104815e-01   +1.962932381634262e-01   +3.167384014896596e-01   +4.808426076553921e-01   +5.824647340175155e-01   +9.928153971173801e-01   +9.763492893216769e-01   +8.851670895679979e-01   +5.972419118501616e-02   +4.841377153429491e-01   -1.037752206011857e-02; +1.786284072676783e-01   +5.729243768187482e-01   +4.484408041433454e-01   +5.782985645952676e-02   +8.206510911331823e-02   +7.047920508434742e-01   +9.599871370452808e-01   +3.492623865803687e-01   +1.590401073470213e-01   +2.397473336704581e-01   +3.812989608257610e-01   +5.952499251790552e-01   +8.072284832635014e-01   +5.892670711684439e-01   +1.391733956866445e-01   +7.726536355905539e-01; +4.506361503740063e-01   +1.536852340815999e-01   +9.853627940391091e-01   +9.497783745052604e-01   +4.719047305288684e-01   +8.011668998597589e-01   +3.276321708269623e-01   +8.668531336337059e-01   +2.970771097283033e-01   +7.335620876033281e-01   +3.720378775434164e-01   +7.445881772903951e-01   +4.286490685466676e-01   +6.059331535229334e-01   +3.318430546610899e-01   +3.022849594644074e-01; +3.119895265451508e-01   +8.335174542214183e-01   +7.038127607095607e-01   +4.835029094538278e-01   +6.904834513482190e-01   +7.576519647574084e-01   +1.584275198543688e-01   -3.028569661338304e-02   +5.394821465661245e-02   +9.463121023661046e-01   +1.407842968672748e-01   +7.335910267748736e-01   +5.888474527102417e-01   +3.752909634323518e-01   +6.680554205073327e-01   -2.327056224533751e-02; +4.863031815166551e-01   +3.687917842934705e-01   +6.611791921229624e-01   +9.620396963644956e-01   +1.557675890323155e-01   +3.599373690001763e-01   +5.020101106315710e-01   +5.097468136411426e-01   +5.486964863319829e-01   +2.787215808409722e-01   +9.788825416400793e-01   +5.391010446090930e-01   +2.631893456858166e-01   +1.176578661692716e-01   +6.012244572761037e-01   +6.862368028923326e-01; +2.998549921311320e-01   +8.517510409838812e-01   +6.046414825605435e-01   +7.542350480259872e-01   +3.659305337496414e-01   +8.992054202280176e-01   +8.962167232870057e-01   +7.080964866176185e-01   +8.988048939515491e-01   +8.279820578305276e-01   +7.407283632095464e-01   +6.996240117295481e-01   +3.068796449736659e-01   +5.931127295247697e-01   +7.790059706981223e-01   +5.110362826987255e-01; +8.080787419546087e-01   +9.801709690692600e-01   +4.720583976340795e-01   +4.517625946784899e-01   +3.865395585421031e-01   -4.566396871616214e-02   +7.668644369162362e-01   +1.073923599203870e-01   +8.300974420433176e-01   +6.723226403466424e-01   +2.326298537472551e-01   +3.757670661907279e-02   +5.703787523136040e-01   +7.235308595518797e-01   +4.818407170855196e-01   +8.438358492349456e-01; +7.784722648018224e-01   +8.013681864911504e-01   +8.989647565225646e-01   +1.581452849508042e-01   +3.517950985286480e-01   +2.230916087609234e-01   +6.983476002902194e-01   +3.729056635849013e-01   -1.656018970994839e-02   +2.737891202982166e-01   +4.773697267024901e-01   +2.299754882866842e-01   +9.137560355157416e-01   +6.754836997281997e-01   +6.765152914391857e-01   +5.492705559595009e-01; +1.232157221674001e-01   +2.970011670953704e-01   +2.334395632357333e-01   -8.919195330140202e-02   +4.397811682897959e-01   +8.297247078252725e-01   +7.200239681022214e-01   +5.677558088814297e-01   +4.906546131324404e-01   +2.703962842220627e-01   +3.799956478727295e-01   +7.276748646910803e-01   +5.608735212493221e-01   +8.808615299114109e-01   +6.266291298833183e-01   +6.019113320632777e-01];
L1E_L1I_iGABA_netcon = [+6.172734992743597e-01   +6.224939693898085e-01   +5.310637309477438e-01   +6.999099495603717e-01   +6.384785497494415e-01   +5.995483848661617e-02   +2.646071757736789e-01   +5.566621902962381e-01   +2.384710193999159e-01   +1.067223849370847e-01   +3.360282135162281e-01   +8.356691037023547e-01   +7.280661439632596e-01   +2.399803985310746e-01   +1.963824313065630e-01   +8.583839676373737e-01; +1.069996623377338e-02   +2.732506209910546e-01   +7.388193389578057e-01   +5.534445735127241e-01   +4.828241248841597e-01   +6.701239553325656e-01   +8.523339650056236e-01   +7.584129163422826e-01   +2.216354897202187e-01   +2.859045227993522e-01   +6.102020136357833e-01   +9.637199642374991e-01   +1.769384202736702e-01   +8.514724872020707e-01   +5.469312300518336e-01   +6.622451887835104e-01; +1.637908727807484e-01   +1.865268922527008e-01   +5.022065485213203e-01   +9.057340431644842e-01   +5.956207619960410e-01   +4.577254467825871e-01   +3.618376151571155e-01   +8.450026991947828e-01   +7.078446231524791e-01   +3.232494662109310e-01   +3.149594728433201e-01   +1.673564976722950e-01   +7.397488283212947e-01   +6.972941885035622e-01   +5.434057278053315e-01   +8.159857937443573e-01; +1.240149465220919e-01   +5.336234504394534e-01   +8.500236923970205e-01   +5.488164266024813e-01   +1.694671995831883e-01   +3.016396787762263e-01   +6.768556993311947e-02   +5.790495042613789e-02   +7.944775985156730e-01   +3.114171184256364e-01   +9.985208902927505e-01   +3.182151344027455e-01   -4.793585910446464e-02   +6.085683741930222e-01   +2.573007510450021e-01   +3.390711286285681e-01; +6.295315559628596e-01   +3.514887980637054e-01   +1.341514638225768e-01   +5.745547489835066e-01   +5.153807676426025e-01   +3.294318582261883e-01   +2.532130549767112e-01   +9.106725995414533e-02   +6.236115521393198e-01   +5.010457197858672e-01   +7.549685801712470e-01   +7.441916372871664e-02   +3.930319362252179e-01   +7.272680174909545e-01   +5.350446720782852e-01   +6.459987612285980e-01; +4.620923205421993e-01   +4.422725966441704e-02   +7.642819883887619e-01   +6.812161145023587e-01   +4.132165357384390e-01   +7.309220637539382e-02   +8.652184299012191e-01   +1.032553926805824e-01   +7.678584889214869e-01   +6.354023574714466e-01   +7.370710849308291e-01   +7.577250919609207e-01   +7.474444650145144e-02   +2.518677490071984e-01   +7.929410345999395e-02   +8.649472186410552e-01; +2.540018029622890e-01   +6.316494163019198e-01   +6.467776881234441e-01   +6.149310096561382e-01   +6.495958658304161e-01   +2.648082983777197e-01   +2.090270006997209e-01   +3.841902059443792e-01   +9.609072994354801e-01   +1.647378182738201e-01   +6.311517572310434e-02   -3.077586209055275e-02   +8.483768360863649e-01   +8.678532857961915e-01   +5.996353426391007e-01   +4.823481272051128e-02; +9.866803876484352e-01   +3.840959275723182e-01   +5.056341448482131e-01   +5.408634936478098e-01   +1.912542073583658e-01   +5.997590514383531e-01   +3.644204518877363e-01   +7.921838309776046e-01   +2.341522586934850e-01   +8.592284549773667e-01   +6.879915286232954e-01   +2.337530411844909e-01   +6.964751248582155e-01   +5.895951837510186e-03   +8.102496964590261e-01   +5.303234919150810e-01; +6.937436170900463e-01   +5.415016736283982e-01   +7.055859040519900e-01   +2.279640462347594e-01   +4.530700556864251e-02   +6.832073925518523e-01   +5.206667515440376e-01   +4.814036533430176e-01   +1.000000000000000e+00   +1.091202315697833e-01   +6.430580176480533e-01   +3.600420739212833e-01   +6.682273604512095e-01   +8.259087555229961e-01   +1.656947991728830e-01   +7.133000180072226e-01; +5.191891264721784e-01   +4.047988440456985e-01   +5.286236318838443e-01   +7.588474686059409e-01   +2.457264605711085e-01   +7.511013956001160e-01   +2.092254570513390e-01   +4.377604565829440e-01   +5.772219796584734e-01   +9.837764528729159e-02   +8.352108131737120e-01   +2.966914877207434e-01   +8.791745895750461e-01   +7.587586485629476e-02   +1.659592398023016e-01   +1.728016867170740e-01; +2.841741371840392e-01   +1.204258896983653e-01   +5.167675228832117e-01   +5.162472509470163e-01   +2.482436680099500e-01   +1.106989583661724e-01   -2.803560775388982e-02   -2.785117394157313e-02   +1.197819666656159e-01   +9.311323275515961e-02   +1.339405780828395e-01   +4.423011546292112e-01   +7.326591919946975e-01   +5.842058846581638e-01   +4.851953801301900e-01   +8.652344324390404e-01; +2.925017940048272e-02   +9.592726458105122e-01   +5.833731982457158e-01   +7.588824131492271e-01   +5.843036935878916e-01   +8.693314519154287e-02   +8.732057742665277e-02   +4.046466291530432e-01   +7.723474261852281e-01   +6.840200208843812e-01   +4.976077438379478e-01   +7.662495980071445e-01   +1.328335552808642e-01   +7.086445862317389e-01   +8.100309799087927e-01   +2.358487582327433e-01; +6.222699689494324e-01   +5.823488097147911e-01   +9.762247755126749e-01   +2.359731461267719e-02   +5.180135306719007e-01   +4.420669507058275e-01   +7.046016840729027e-01   +7.992607342380837e-01   +2.756217608743230e-01   +2.251717141444554e-01   +2.097224240747566e-01   +6.202506963263436e-01   +4.577396631297162e-01   +2.782045896119908e-01   +2.498144571987963e-01   +8.527980308117269e-02; +4.976826564668415e-03   +2.065790011565165e-01   +5.148205644988491e-01   +2.710724193937624e-01   +3.318301473073422e-01   +7.877934192741027e-01   +7.422945902506181e-01   +4.886799730984916e-01   +1.126536203215016e-01   +9.024566516010643e-01   +8.112466932743765e-01   +2.503980518663828e-01   +3.355275705753855e-01   +5.368119611883805e-01   +1.662342675217107e-01   +6.971065217620172e-01; +7.886011565515093e-01   +8.389765113648975e-01   +8.671982942532555e-01   +9.711583338169212e-01   +1.497331877726540e-01   +5.257983391838080e-01   +7.240803745903168e-01   +8.797133595177684e-01   +3.657740756093673e-01   +4.021986537214021e-01   +8.081556926580521e-01   +5.540795296858350e-01   +8.173253003153118e-01   +6.521814952828429e-01   +7.908773967679704e-01   +7.364698604586387e-01; +3.849051256028676e-01   +3.899961595375416e-01   +6.607592922724093e-01   +1.899370034893050e-01   +4.174736681517777e-01   +6.132810034895976e-01   +3.031860308644457e-01   +4.634807774045088e-01   +4.372339289631414e-01   +6.812845899085577e-01   +5.386488770046042e-01   +3.522475170876930e-01   +1.865264767517689e-01   +5.326549243959491e-01   +5.991784575306253e-01   +3.230889639774484e-01];
L2I_L1I_iGABA_netcon = [+5.610949498102777e-01   +6.998213387048109e-01   +7.463956133163431e-01   +8.949530966915833e-01   +4.614904241615268e-02   +8.992192534473722e-02   +3.318914730630227e-01   +1.490310791099642e-01; +1.186497274148540e-02   +6.020167104814198e-01   +8.578544608347322e-01   +5.586886845971685e-01   +3.951081801069061e-01   +2.680652092848589e-01   +2.200839010547635e-01   +5.069969639794160e-01; +1.747751993061403e-01   +1.780656388308497e-02   +8.464784478180973e-01   +8.674500306303740e-01   +6.633440801993028e-01   +8.810428487606102e-02   +5.981830400877680e-01   +7.098787089571073e-01; +1.998629833081547e-02   +3.209698206153182e-01   +2.110117297294148e-01   +7.997567270365633e-01   +5.379196779687295e-01   +4.963811453458088e-01   +5.309878403679148e-03   +4.284249792907294e-01; +8.383876582390231e-01   +8.352317120355289e-01   +7.986755765390892e-01   +5.955469262317331e-01   +4.737021164903154e-01   +9.179933810239939e-01   +1.024436162195844e-01   +4.777391573946612e-01; +1.187230346394234e-01   +6.273802428393014e-01   +6.436161928031655e-01   +7.330734197295128e-01   +7.660672513417663e-01   +4.505969868541813e-01   +9.125700252700377e-01   +2.608141821534574e-01; +2.162452233772315e-01   +6.638874651210998e-01   +8.362889606694197e-01   +8.711989961430765e-01   +5.067950764425425e-02   +7.385961392374231e-01   +1.567272652454473e-01   +6.377863581114747e-01; +4.539815331810177e-01   +1.028905510253056e-01   +8.141809974777372e-01   +4.741889472270897e-01   +6.816516984582087e-01   +5.211035756259460e-02   +2.537891303381954e-01   +8.450544008124347e-01; -1.577471312485539e-02   +2.097197040480367e-01   +7.359881654905800e-01   +3.328280226002884e-01   +6.516502696102942e-01   +2.737154934917595e-01   +3.482568268802613e-01   +3.243011055077322e-01; +1.914182884797131e-01   +8.099299009618930e-01   +2.768087750846892e-01   +7.286630211910802e-02   +7.246636858150313e-01   +8.297925850428988e-01   +8.410804275212709e-01   +8.173463247914858e-01; +8.247528268417043e-01   +3.057167126627348e-01   +4.888519579636582e-01   +3.129932112284067e-01   +6.411476517336901e-01   +4.037619116719577e-01   +1.747464158929709e-01   +7.625855175955543e-01; +8.751570117727683e-01   +3.172262504524000e-01   +7.635693784446401e-01   +6.449585106191902e-01   +9.146677128146964e-01   +4.727135265523848e-01   +4.778207769220814e-01   +1.000000000000000e+00; +5.592944093999728e-01   +2.534068013102662e-01   +6.610381690610487e-01   +6.204407315580877e-01   +2.878777654514729e-01   +7.880552819563480e-01   +1.411066703891166e-01   +7.233419281490416e-01; +1.483903988295538e-01   +6.971443010633980e-01   +8.172171909842447e-01   +8.761069333853112e-01   +4.469163372838617e-01   +7.850196203986116e-02   +3.280170811314246e-01   +2.445492365381164e-01; +1.582006004051479e-01   +2.965228003191948e-01   +9.627511325165717e-01   +5.260500636357416e-01   +2.757431210264817e-02   +4.788886079032758e-01   +7.913153501691428e-01   +8.261038277409332e-01; +6.165436643298121e-02   +3.568996819901359e-01   +3.003736686295106e-01   +8.023255052097548e-01   +4.126959468097737e-02   +2.812288556833967e-01   +1.201580909499049e-01   +8.576574704275688e-01];
L1I_L2I_iGABA_netcon = [+2.099364816416510e-01   -3.144747183794010e-03   +7.822013962682876e-01   +2.848408769393076e-01   +7.750970097363959e-01   +7.110215546009486e-01   +8.139105684145375e-01   +8.146950428894885e-01   +4.320659297089491e-01   +4.442155632917397e-02   +5.233235262706092e-01   +7.115335126337474e-01   +6.181044551995428e-01   +5.781810908844266e-01   -3.718635839230205e-02   +1.661685615295575e-01; +5.974021815119684e-01   +6.145080425247944e-01   +5.201855446799820e-01   +8.993200027173023e-01   +6.351094011819461e-02   +2.250290750264018e-01   +8.082571412396637e-01   +1.354512267018347e-01   +2.093172590058905e-01   +4.997672434160210e-01   +7.585172901413434e-01   +7.963691761460524e-01   +5.335546355706420e-01   +6.423407191685184e-01   +8.684267977383456e-01   +7.900637163968516e-01; +4.690773148806501e-01   +4.202492619470232e-01   +5.688632720354363e-01   +6.340223784181026e-01   +8.285109513518667e-01   +8.078536159233927e-01   +6.138569142145385e-01   +2.542690433726066e-01   +3.997507210225655e-01   +6.369344819647146e-01   +5.413595256903310e-01   +5.196979377696154e-01   +4.036962193698802e-03   +8.310850317273825e-01   +2.907462193069073e-01   +3.334802567441061e-01; +2.590399946398487e-01   +9.019209961892776e-01   +5.506868408895785e-01   +4.005114423723692e-01   +3.335887766873966e-01   +1.445164506003112e-01   +6.817373645979878e-01   -7.516678860010359e-03   +2.897781359578490e-01   +7.132464309717650e-01   +2.791095371338329e-01   +5.943380395387807e-01   +5.706866212698153e-01   +7.614864373723492e-01   +5.897517043557408e-01   +6.593279138399892e-01; +5.397601063003321e-01   +5.153369779791400e-01   +9.190249008120988e-01   +3.023554606184701e-01   +9.390999619798968e-01   +6.000323326303562e-01   +4.760659749432163e-01   +5.191556002149502e-01   +2.520104000218182e-01   +7.629925243270416e-01   +8.028442812110667e-02   +7.296952111381183e-01   +1.023689543796283e-01   +2.319358800481582e-01   +4.556828033580650e-01   +3.769775896884394e-01; +2.592238717948874e-01   +1.289607632523285e-01   +1.826927300415818e-01   +6.512155859342323e-01   +1.000000000000000e+00   +1.585348602170114e-01   +8.252969454812012e-02   +2.626998957760764e-01   +4.698739940386841e-01   +7.176691125307247e-01   +1.505393741753923e-01   +4.210654268794379e-01   +8.153162375292233e-01   +5.165210067032345e-01   +4.326370387128113e-01   +3.785135914442983e-01; +4.853228961272352e-01   +9.214202290462514e-01   +1.629020083064935e-01   +7.773152715752837e-01   +2.334076797958601e-01   +9.663217288585687e-01   +1.245241990367829e-01   +2.688434505610027e-01   +5.165815415502281e-01   +1.519363955974089e-01   +8.940016915636368e-01   +5.028455743033837e-01   +4.287428155157503e-01   +5.212435340792202e-01   +7.559824052698813e-01   +6.550437028487165e-01; +7.011538609918290e-01   +8.386691524839791e-01   +8.658712794761606e-01   +8.390187576429146e-01   +2.213917817825816e-01   +5.960535144419696e-01   +6.466267102431378e-01   +4.688720924487301e-01   +7.964931590094237e-01   +3.329181936907961e-01   +5.597855610500136e-01   +3.202938217506112e-01   +3.661533845040656e-01   +8.281558407833592e-01   +1.224457243588002e-01   +7.040875313150018e-01];
L2E_L1E_iAMPA_netcon = [+6.773530950903986e-01   +1.686529289353808e-01   +3.048074927170421e-02   +4.816928410092599e-01   +7.985192096273060e-01   +7.615399281904454e-01   +1.270287141335772e-01   +3.264267353019337e-01; +7.914558492353296e-01   +6.832976509604460e-01   +8.279661946175476e-01   +8.268930090052763e-01   +5.116103459489415e-01   +2.978565307029232e-01   +3.093835982632843e-01   +4.706583558292634e-01; +3.913528374745892e-01   +5.104749270621972e-01   +2.904913765146221e-01   +1.000000000000000e+00   +3.213312995222881e-01   +2.637826638329285e-02   +1.160585774597496e-01   +3.993779649281589e-01; +3.911334790389333e-02   +1.473217311077608e-01   +8.563734475254962e-01   -6.127060358612157e-02   +7.095356146528025e-01   +5.092226091175295e-01   +2.477618633915128e-02   +1.751909157528172e-01; +5.805696037092103e-01   +3.916802808747639e-01   +5.912139131149887e-03   +6.751167441517216e-01   +9.185605864339480e-01   +3.967101871793625e-01   +1.963957775795580e-01   +9.996429216005945e-01; +7.888092096951167e-01   +6.000913265903971e-01   +4.823498955287397e-01   +3.042358767908955e-01   +5.291836219020274e-01   +1.645632211587088e-01   +1.565454397486243e-01   +6.348905279286143e-01; +8.621298890719320e-01   +8.021805193021280e-01   +5.274519503824006e-02   +9.765946353928556e-01   +5.568077057822005e-01   +1.890833057026151e-01   +4.320465227574714e-01   +7.851311291336495e-02; +3.900264791041811e-01   +8.086558470487234e-01   +5.674126048446594e-01   +1.568191079763444e-01   +1.907834372739706e-01   +1.838639366342522e-01   +1.527039469508414e-01   +1.704123656287772e-01; +8.731230199058783e-01   +6.885114925237895e-01   +7.879915498519200e-01   +7.944182669154101e-01   +8.828700043206875e-01   +4.571973173149080e-01   +1.524563647836063e-01   +7.186005998387304e-01; +4.429842651507344e-01   +2.527121308338652e-01   +6.003328776949272e-01   +1.708281314475271e-01   +6.309665806873349e-01   +8.570266654171763e-01   +6.415983718399205e-01   +1.115659176620912e-02; +7.015465985423514e-02   +8.808124984343222e-01   +7.233996310557526e-01   +5.108046868782806e-01   +6.138561745856396e-01   +1.842502555359427e-01   +9.882875899920637e-01   +8.087356851203306e-01; +9.268841519187700e-01   +4.704596969286038e-01   +9.018270049846348e-01   +7.457595304716987e-01   +2.851007754138099e-01   +6.426059282234640e-01   +6.046116250319017e-01   +1.437624101562809e-01; +8.042662657091493e-01   +8.460168083708036e-01   +2.027854067518117e-01   +8.891573684579306e-01   +6.312427191078648e-01   +1.650657263962086e-01   +3.115846810191727e-01   +6.990453138381035e-01; +1.255193039154929e-01   +6.812478220089076e-02   +3.102930793982686e-01   +8.863889868402445e-01   +3.264483741166134e-01   +6.606203769261046e-01   +9.092076287740140e-01   +2.407617962148868e-01; -9.238717978732106e-03   -2.972458590634982e-02   +5.325606154480778e-01   +8.739236893002558e-01   +7.639056759278154e-01   +2.459826918992301e-01   +3.112428334626391e-01   +6.587186127628067e-01; +1.394994566797065e-01   +6.580391153878651e-01   +4.384652032770784e-01   +3.642221450492648e-01   +1.888406959289833e-01   +2.606375558882858e-01   +6.730405569006455e-01   +8.036898724036345e-02];
L1E_L2E_iAMPA_netcon = [+4.194357273885724e-01   +5.755464986824592e-02   +6.415483461384865e-01   +4.640978709568219e-01   +8.842789032017567e-01   +2.076387468855172e-01   +7.227153687085366e-01   +4.996583628653424e-01   +7.893150974437370e-01   +8.069244864544758e-01   +3.742237086458318e-01   +3.802855464843414e-01   +7.373933876722853e-01   +7.372010786783063e-01   +2.937666426899410e-01   +4.915011520640131e-01; +2.636115692869396e-01   +1.000000000000000e+00   +1.006746761239528e-01   +1.784161728060675e-02   +2.863536572579716e-01   +3.821089131747584e-01   -1.502569043876772e-02   +3.739190770782840e-01   +2.373978038768738e-01   +4.976864190348020e-01   +6.548918188907892e-01   +5.697021407115637e-01   +7.631322248427077e-01   +5.576372659281941e-01   +9.762964858689075e-01   +4.471033423840209e-01; +4.114821347189029e-01   +5.150415235310256e-01   +9.315524815357117e-01   +5.836215310060350e-02   +7.985723638431357e-01   +4.782962970197268e-01   +3.045504744573919e-01   +3.708104343248372e-01   +3.503779773943074e-01   +7.926781452247947e-01   +6.652500457330061e-01   +4.847700883632713e-01   +7.393336813595167e-01   +3.651368546832686e-01   +5.858583414230930e-01   +9.485688851237426e-01; +5.646384296226755e-01   +6.991321917324496e-01   +4.232490399237164e-02   +1.636778577855778e-02   +4.852235304256125e-01   +6.240489128197978e-01   +4.272173057274984e-01   -3.202282558382916e-02   +9.193746364155557e-01   +4.527532234843480e-01   +1.431899385389475e-01   +2.626321016916494e-01   +5.352738248536789e-01   +5.957735852440358e-01   +3.693836342237159e-01   +4.436907228478756e-02; +6.765391981914610e-01   +8.068387660650653e-01   +2.893409424579746e-01   +5.709998347149727e-01   +3.358056136100969e-01   +4.265545286549300e-01   +7.591204770928982e-01   +9.016120204839192e-01   -5.233715599935949e-02   +6.022329036654885e-01   -2.430263606747396e-02   +3.464663015997684e-02   +4.201066978328200e-02   +2.781159376851349e-01   +8.027976471666947e-01   +2.905641159280138e-01; +5.973425055219542e-01   +6.857297961592177e-01   +8.627993807155544e-01   +9.982068872749402e-01   +5.644517649212335e-02   +3.569234649089490e-01   +1.946689109478664e-01   +4.566914412100904e-01   +2.604168108026231e-01   +3.704697448035159e-01   +8.608085102200469e-02   +4.225983077757553e-02   +8.823739744968762e-01   +1.678095513346366e-01   +3.096332845222254e-01   +7.663553831182617e-01; +5.090548887076191e-01   +2.746417828386087e-01   +5.676172435523194e-01   +2.267866517602694e-01   +1.980499503281744e-01   +9.199847571742399e-02   +3.618713177696520e-01   +6.718456670474515e-01   +8.733111606038957e-01   +6.299000552587074e-02   +4.917745116784757e-01   +1.023910613751083e-01   +4.560663016848610e-01   +2.120801741199950e-01   +1.679460604397321e-01   +3.807857252078825e-01; +5.480543781418009e-01   +4.595739140601769e-01   +7.285109735178853e-01   +6.893334002211624e-02   +6.522445622106774e-01   +7.357094500496826e-01   +2.782756337603314e-01   +3.493643552670879e-01   +4.436789639518676e-01   +1.837460783158464e-01   +5.078600976701089e-01   +2.074331133673571e-01   +5.319919822368411e-01   +5.459248068103445e-01   +7.031874696243903e-01   +4.448526582495724e-01];
L2I_L2E_iAMPA_netcon = [-2.684429650344451e-02   +2.804262223293874e-01   +3.001443953095374e-01   +1.645158877543943e-01   +1.000000000000000e+00   +8.527865578486821e-01   +6.621997598884620e-01   +7.247433119069061e-01; +8.181147760281078e-01   +2.138977553039926e-02   +4.885876615001167e-03   +6.497202396659532e-01   +3.440705115673663e-01   +3.176469549860442e-01   +2.861091118164949e-01   +9.961312668141952e-01; +2.051915068275647e-01   +9.025855735090573e-01   -5.810112204942601e-03   +5.639649452713273e-02   +8.406092096401226e-01   +3.896774334997277e-02   -5.178653651171259e-03   +3.337139216861696e-01; +5.390814449423434e-01   +7.916471743130268e-01   +2.123657989619048e-01   +8.468734044616323e-01   +7.824428445843689e-01   +4.630444501978717e-01   +1.730746664686839e-01   +7.175628454237933e-02; +3.062781353485322e-01   +4.003073604446599e-01   +5.714250818734784e-01   +5.268119852587585e-01   +6.875268593836542e-01   +5.114009832081663e-01   +6.861568268769059e-01   +3.842231576397218e-01; +7.210374301149873e-01   +2.464899009526247e-01   +2.173050397572200e-01   +1.623529253098912e-01   +3.398075108291553e-02   +9.561694595161737e-01   +3.320228368382769e-01   -6.070314694419254e-03; +7.172419652629075e-01   +8.362745622750360e-01   +5.054808794887986e-01   +9.154298726275664e-01   +6.441785985278703e-01   +7.448650090456867e-02   +7.329767601290348e-02   +1.537401410122199e-01; +9.729508121685251e-01   +1.598120562284201e-01   +4.907204535995278e-01   +5.066655290421113e-01   +5.419343700346237e-01   +2.034980803239521e-01   +7.087861410804299e-01   +4.419621585508593e-01];
L2E_L2I_iGABA_netcon = [+1.636230045999691e-01   +2.975795215637296e-01   +3.688971359387837e-01   +2.160422075234368e-01   +8.052220306901620e-01   +7.693197768340506e-01   +7.364741798693504e-01   +5.892022535175865e-01; +7.707473882835670e-01   +9.118247839837640e-01   +2.354425773932060e-02   +5.006719397956286e-01   +1.911074580851944e-01   +9.408832890970372e-01   +5.957996193758983e-01   +3.615344787630747e-01; +1.000000000000000e+00   +2.052967085594634e-01   +8.375171710033776e-01   +1.229917326236687e-01   +7.878004856157580e-01   +7.559466757804274e-01   +8.414885838168003e-01   +1.851167993570799e-01; +4.351848008918324e-02   +4.464268521105780e-01   +8.874251442594610e-01   +7.382144997414327e-01   +8.212627752843373e-01   +7.275641950456971e-01   +3.895630159066457e-01   +8.142248323895408e-01; +2.027610506857089e-01   +9.655008814762019e-01   +8.466084363198271e-01   +5.632794768378354e-02   +4.015701208223011e-01   -3.518907010326312e-02   +5.963368343340582e-01   +2.128695802822829e-01; +1.326703045658439e-01   +3.528602293841862e-01   +4.011984342011288e-01   +5.483738383473571e-01   +4.254755524264244e-01   +8.542760918949638e-01   +7.437342280141723e-02   +2.754841166855614e-01; +3.301152344669625e-01   +5.386083301538029e-01   +1.001105532881320e-01   +7.791060096470006e-01   +4.914230834247743e-01   +5.051959695324251e-01   +7.518555407801742e-01   +5.838751032786832e-01; +2.244119546073137e-01   -1.822257132528019e-02   +6.965420964712937e-01   +7.191171461448288e-01   +7.175746708773572e-01   +6.024379670523958e-01   +4.715250900886985e-01   +8.257941084300512e-01];
L3E_L2E_iAMPA_netcon = [+3.050803713311695e-01   +9.516019411718819e-01   +2.543591667998321e-01   +1.649877688856066e-01   +9.277888265973820e-01   +6.962017110155738e-01   +2.406352603248502e-01   +9.329727219626865e-01   +8.485257356998772e-01   +2.910386983334455e-01   +3.697072988949544e-01   +6.484759233029561e-01; +2.939860957867953e-01   +3.131772080180929e-01   +6.243515869233668e-01   +5.450149408962806e-01   +3.841151814651229e-01   +5.354870310430605e-01   +3.377868170447135e-01   +7.003229724822599e-01   +2.409526447140873e-01   +3.596216189605887e-01   +3.396594130726033e-01   +5.501975858002330e-01; +5.714333713272429e-01   +7.248949475868891e-01   +6.004219416929043e-01   +5.989589192359039e-01   +5.732819157204074e-01   +5.571635870618966e-01   +6.245351056769027e-01   +4.314197822021491e-01   +5.975655204633152e-01   +2.617341980269622e-01   +6.228187662384169e-01   +9.537947501265229e-02; +5.636748681476423e-01   +2.809637055434140e-01   +8.337667084162712e-01   +5.715113917016070e-01   +6.236055671844639e-01   +8.542545699487398e-01   +1.224525586862339e-01   +3.149981450838569e-01   +4.733968152044095e-01   +4.959792010611040e-01   +2.343716394489636e-01   +9.441844786605244e-01; +2.049441106666321e-01   +1.617018518769924e-01   +5.622413116244418e-01   +1.741709032440719e-01   +3.127987570129623e-04   +5.304453455001172e-01   +4.031218519235369e-03   +7.926341452965366e-01   +2.607102335468944e-01   +7.286453128315451e-01   +4.567717221308100e-01   +7.285573142966990e-01; +4.519121074968053e-01   +8.058704076908604e-01   +2.079921431435161e-01   +4.607152213390622e-01   -5.661210826299838e-02   +3.683936352676218e-01   +3.420908401720616e-01   +8.799807811071464e-01   +7.159333655459487e-01   +1.000000000000000e+00   +6.368148655102633e-02   +8.630381726833254e-01; +3.990825189641373e-01   +6.005252020433653e-01   +3.615053774632970e-01   +7.920401992036427e-01   +1.503864764202795e-01   +8.357322689737544e-01   +7.816372171863094e-01   -2.447223161472835e-02   +1.190246091056108e-01   +9.723475320706754e-01   +7.837353097835113e-02   +4.568586994116780e-01; +3.612918901677447e-01   +6.325287582332787e-01   +4.744087574019883e-01   +7.114552716518691e-01   +1.121757486535970e-01   +9.044860423341658e-02   +4.778288224414775e-01   +1.675666541324815e-01   +3.071450336406018e-01   +8.058091786347495e-01   +5.220880846430735e-01   +4.513781230798627e-01];
L3I_L2I_iGABA_netcon = [+5.428757491077152e-01   +7.789209166129020e-01   +4.234562564224203e-01   -9.353700451555196e-03   +6.263313538084279e-01   +7.462677876390653e-01   +5.150721776953003e-01   +5.018667433244738e-01   +7.196568072787237e-01   +1.088996261314196e-02   +5.721984690936298e-01   +7.150081908806711e-01; +5.273218129660873e-01   +4.393021909879185e-01   +1.581289524003558e-01   +8.202419706819981e-01   +4.151968448074379e-01   +3.249350710890305e-01   -1.450542987546313e-02   +2.693238317786165e-01   +9.042100879547301e-01   +2.576857568379012e-03   +1.169066867346584e-01   +6.947915635400280e-01; +1.090120327834550e-01   +9.605512539519548e-02   +2.285949684965582e-01   +2.303365108952568e-01   +6.413991959143027e-01   +9.941296667515127e-02   +5.898583844110303e-01   +9.188247728684428e-01   +2.868157741295217e-01   +4.834789826723579e-01   +8.195182311281626e-01   +6.908736252023913e-01; +8.958533355137174e-01   +1.782543264879100e-01   +6.736007446788504e-01   +5.864691198608046e-01   +1.234258204373051e-01   +8.461950632219921e-01   +2.137212775831448e-01   +9.975437636702287e-01   +5.360818386815953e-01   +8.105193700861164e-01   +7.055507966728464e-01   +6.393238731508152e-01; -4.328249508784859e-02   +5.231821203368768e-01   -3.496421071826208e-02   +5.877666915641531e-01   +1.028323034214761e-01   +5.059852127456387e-01   +1.900301428135376e-01   +1.033066685621191e-01   +1.539203846199344e-01   +8.929222364887630e-01   +8.400259701411071e-01   +1.955572105788619e-01; +5.154729356621164e-01   -2.051972301000071e-03   +6.560365737029292e-02   +7.431223925506961e-01   +5.630039817061724e-01   +8.210529913912933e-01   +9.083896221797270e-01   -7.751692083642321e-02   +1.060336513580132e-01   +5.276099239244257e-01   +2.719430148258567e-01   +5.183431258236602e-01; +2.871551792275207e-01   +2.687343174250083e-01   +5.054539524929881e-01   +3.808580010247573e-01   +8.365963105931763e-01   +6.343544359188680e-01   +5.267694371275089e-01   +3.230271725309701e-01   +6.226789531021703e-01   +3.229302084413769e-01   +9.120182229704765e-01   +8.255138788309729e-01; +5.780394794765881e-01   +4.689217385993781e-01   +4.332562760350960e-01   +4.243428454098978e-01   +4.199018734605315e-01   +4.529122558512875e-01   +6.069787417224271e-01   +5.636735505325287e-01   +4.877661009588990e-01   +4.661609990735099e-01   +1.724578171957936e-01   +1.316148299377697e-02];
L2E_L3E_iAMPA_netcon = [+9.104914930289107e-01   +1.966878061399035e-01   +2.595944698134240e-01   +2.189482093515357e-01   +8.008237665694894e-01   +4.215918013310296e-01   +4.678838301984499e-01   +2.497171982286649e-01; +3.623072545383734e-01   +7.959611958220058e-01   +3.650613076567150e-02   +7.135314187366624e-01   +2.753852554916745e-01   +1.309702533363063e-01   -3.043816524861388e-02   +6.897375974597616e-01; +7.979546700688912e-01   +3.362241351471298e-01   +2.718065316641681e-01   +8.185111548676378e-01   +8.699129437159516e-01   +4.235312248499911e-01   +4.378891054280527e-01   +4.047064440354561e-01; +4.660735675842509e-01   +5.163464928135605e-01   +8.966499531249741e-01   +7.591409364055226e-01   +6.777722911983696e-01   +3.469324995507703e-01   +4.125827229417821e-01   +6.975143132610321e-01; +8.454831939460234e-01   +6.168486070578227e-01   +1.406957285112157e-01   +4.274452765352779e-01   +3.009414339213841e-01   +8.248048510839401e-01   +1.458446999176006e-01   +4.851005762559041e-01; +6.603027163673001e-01   +4.930762757327199e-01   +8.185771319898923e-01   +7.618085600284820e-02   +9.325276523085765e-01   +1.000000000000000e+00   +7.009891435777073e-02   +8.778482005606852e-01; +6.160990150722587e-01   +4.866920642883638e-01   +4.743038476023111e-01   +4.910530095915300e-01   +7.163424101256363e-01   +5.290181866008220e-01   +2.251044922230719e-01   +7.460284675482463e-01; +5.917075359980331e-01   +5.188925310222224e-01   +4.856796297932483e-01   +5.245955238108144e-01   +8.458386445024205e-01   +1.719039288251921e-01   +8.807059337479337e-01   +9.782907473019860e-01; +5.630808436333854e-01   +4.332069040392018e-01   +7.630009358802488e-01   +3.343409005779728e-01   +2.362289621243553e-01   +8.809254265907401e-01   +5.426439111220759e-01   +4.483433979438239e-01; +1.236111165857748e-01   +1.891390748787188e-01   +7.131501682402823e-01   +5.860455705520788e-01   +4.314271101433747e-01   +8.393259743856498e-01   +5.862894774520017e-01   +6.177560834401397e-01; +9.117512122572337e-01   +1.395256908012356e-01   +7.101908694658031e-01   +1.446537476751653e-01   +3.482272738180242e-01   +1.422464653944816e-02   +4.410459828352102e-01   +5.746363124469389e-01; +5.407517583762943e-01   +2.779811439023749e-01   +4.169386529968176e-01   +2.579368443614183e-01   +8.922747927057244e-01   +3.191145363875947e-01   +9.480745212337086e-01   +9.339328380540369e-01];
L2I_L3I_iGABA_netcon = [+1.429530431535982e-01   +5.106624621215081e-01   +5.674993219497622e-01   +8.557558953751633e-01   +4.915350082116943e-01   +2.314998069398204e-01   +4.040145078794076e-01   +4.476360501423464e-01; +1.737051111599473e-01   +5.652796059971511e-01   +8.201924443085540e-01   +8.919277507307003e-01   +5.867568959741007e-01   +9.636808343216449e-01   +7.033828967356927e-02   +7.932692763484223e-01; +4.283626119015537e-01   +7.865058413137557e-01   +8.309958706248524e-01   +4.465894133723018e-01   +1.135958634457673e-01   +3.890536775439369e-01   +6.256398523445685e-01   +1.588078576402666e-01; +3.419038623719557e-01   -3.995998197750624e-02   +9.350466263118028e-01   +3.565710666236043e-01   +3.662280691721847e-01   +3.259339919352610e-01   +2.759716651009065e-01   +6.588506074001687e-01; +9.358474259622461e-01   +4.069454629505374e-01   +3.744119708621167e-01   +6.103786442654209e-01   +5.108885315831239e-01   +8.328695601990317e-01   +6.409544647617495e-02   +2.405473523992403e-02; +3.824289563516214e-01   +2.750863039807819e-01   +3.472414446114807e-01   +5.061889183280680e-01   +9.769565765477497e-01   +6.562301687109646e-01   +8.673649566873338e-01   +1.983678193353687e-01; +8.768007105933170e-01   +2.427868734548378e-01   +8.045867834140490e-01   +9.711699518270583e-01   +7.178002204671072e-01   +2.170254567868444e-01   +1.000000000000000e+00   +1.630389696908364e-01; +9.067398562862420e-01   +4.414784093312959e-01   +9.118192256274679e-01   +2.609275908254288e-01   +7.397489227015429e-01   +7.759598938173456e-01   +8.640030760736125e-01   +5.668615939412635e-02; +4.760710852909980e-01   +5.776002601184556e-01   +7.655741896555164e-01   +5.117287876071723e-01   +5.009728008146134e-01   +3.439369089467136e-01   +8.871220792403361e-01   +9.329582879911043e-01; +8.424273860840784e-01   +5.626796505556815e-01   +5.380790092721981e-01   +5.980282445161008e-01   +3.922577977593193e-01   +4.256394882330189e-01   +1.076733950252363e-02   +6.953555354503066e-01; +8.510871432095729e-01   +7.353077047963054e-01   +6.360587295874014e-02   +5.106461148683924e-01   +3.363408082926874e-01   +6.344660095510645e-01   +5.977938143887694e-02   +3.100470220127299e-01; +4.398913978217019e-03   +4.345165728443170e-01   +1.132473431672379e-01   +8.890496128610756e-01   +8.985488236328008e-01   +2.036175342360368e-01   +2.964435180665451e-02   +4.644878333239951e-01];
L3I_L3E_iAMPA_netcon = [+4.340882694439525e-01   +1.536930484957213e-02   +4.545831743277900e-02   -4.785398951597122e-02   +9.381295467372483e-02   +6.314842762896824e-01   +2.414122039767723e-01   +5.513318112679464e-01   +2.635722006438065e-01   +6.094753710084617e-01   +6.211672012916311e-01   +6.178439361174494e-01; +8.768894792099734e-01   +3.268241066674438e-01   +7.081140937662030e-01   +3.354401402377034e-01   +7.875433185053542e-01   +7.449289836687679e-01   +8.685109451746323e-01   +2.708665600077949e-01   +1.050839128934968e-01   +4.288090696264219e-01   +7.448444669888866e-01   +3.591805230743629e-01; +8.699277821054292e-01   +1.083379791034550e-01   +3.095915493942109e-01   +3.279704956402717e-01   +6.374497363986840e-02   +5.011546420011427e-01   +5.170706937194933e-01   +2.915729641011265e-01   +3.863416013203463e-01   +2.859381836949314e-01   +3.333704244018361e-01   +3.765136629774417e-01; +7.051992842154936e-01   +3.670076251392839e-01   +8.302332769382932e-01   +6.197399623368502e-01   +4.355729464960865e-01   +5.431052924101228e-01   +3.143724180610861e-01   +6.685806365188759e-01   +4.895467194102909e-01   +1.498717212102291e-01   +6.203077540110650e-01   +3.112231177239805e-01; +3.633776558940089e-01   +1.712438787135517e-01   +2.475334663689210e-01   +4.662770203081922e-01   +7.055646656999282e-01   +3.795049126540448e-01   +3.864658345119739e-01   +1.508128330903883e-01   +3.513150098899828e-01   +6.275663830750225e-01   +5.239893162829392e-01   +3.671634585742535e-01; +9.674329196860355e-02   +2.602851019288301e-01   +1.483974357219868e-01   +5.301927407998233e-01   +1.998611282293103e-01   +9.315056011983465e-02   +1.361641870257126e-01   +7.367305626809715e-01   +2.974749493996534e-01   +1.041396726104602e-01   +6.268595313619796e-01   +2.309174989843140e-01; +4.836776624984940e-02   +6.094754806219805e-01   +7.721662875641655e-01   +4.133397426184090e-01   +6.097753646118673e-01   +3.373072443971941e-01   +7.604579743547002e-01   +4.028932636146730e-01   +7.515554645892059e-02   +7.782983896344370e-01   +8.520864553544346e-01   +8.308341447737143e-01; +8.672270240661022e-01   +5.691642053509487e-01   +2.239119969743682e-02   +7.080756042551433e-01   +5.584487620434858e-01   +5.796836618066902e-01   +5.963230002844967e-03   +1.659710468940274e-01   +8.148739549891008e-01   +5.918192228703816e-01   +2.719928351653678e-01   +6.690788725765512e-01; +6.295995381117289e-01   +8.291358078282155e-01   +8.476120134234140e-01   +6.079370581084633e-01   +6.328479232152843e-01   +6.044689105340314e-01   +4.707236509610269e-01   +3.541523475963722e-01   +4.168451702991443e-01   +4.685943657724301e-01   +7.321414972087422e-01   +7.801839319576552e-01; +8.384807890087140e-03   +8.915338613826823e-01   +7.651156298096079e-01   +7.116723586624489e-01   +8.622839085132644e-01   +8.135073032963810e-01   +3.961034406898514e-01   +2.950946863377699e-01   +6.367882760946772e-02   +9.281816344110526e-01   +4.070648566094590e-01   +8.696520602115720e-01; +6.944605489888870e-01   +1.540550262985420e-01   +6.499053369750192e-01   +8.492417887093487e-01   +1.243327620282429e-01   +6.308654371534255e-01   +3.377957470428440e-02   +8.033984283488373e-01   +9.066302729040672e-01   +6.282753534717768e-02   +5.553650849806891e-01   +5.078753759567306e-01; +5.586873268677558e-01   +4.853789874263847e-01   +1.242712757320262e-01   +1.256453732254682e-01   +6.532225820662149e-01   +4.182457690461809e-01   +1.000000000000000e+00   +2.534709706517486e-01   +1.896400360392018e-01   +4.526562283998330e-01   +5.777456737529023e-01   +3.399024708792277e-02];
L3E_L3I_iGABA_netcon = [+5.555746807000683e-01   +1.212492280060319e-01   +8.312532380608797e-01   +1.663874581510832e-01   +3.135126148866505e-01   +6.536102291670997e-01   +9.313119510751676e-01   +3.866948244694717e-01   +4.130967905262853e-01   +5.176837135758474e-01   +1.967934032334755e-01   +3.870576606823570e-01; +1.815965504290089e-01   +7.192831652953574e-01   +3.918251277218643e-01   +5.263823786605117e-01   +5.869015591519106e-01   +2.379360034634771e-01   -6.630447301455589e-03   +9.590150524365659e-02   +4.950644627182040e-01   +7.992926460581324e-01   +8.219238357767235e-01   +6.118200643770901e-01; +3.935126714465472e-01   +2.705701577884469e-01   +7.038014903504851e-01   +6.105785817374765e-01   +7.115862825763971e-01   +7.705657284307437e-01   +4.545962735494318e-01   +2.530665922644704e-01   +7.105084159812762e-01   +6.904430502413493e-01   +8.557188185684544e-01   +9.557433156010355e-01; +7.789526601538510e-01   +7.059665136370120e-01   +8.397411471785504e-01   +4.029257944451948e-02   +4.254516511433024e-01   +7.410004883318615e-01   +5.258881971082244e-01   +4.605362704589696e-01   +1.438193738952220e-01   +8.545980467978378e-01   +7.385324565705750e-01   +7.897147424117033e-01; +9.934120801412831e-02   +5.130044839247899e-01   +5.889545277442633e-01   +5.155673649673477e-01   +4.760695676081641e-01   +2.393548338813368e-01   +5.353732278911740e-01   +5.612530356097257e-01   +5.321224549719848e-01   +6.846424442195045e-01   +8.552079736022530e-02   +8.642611788287191e-01; +6.022875445575259e-01   +8.413462651074096e-01   +1.150888596465896e-01   +5.816571384286107e-01   +9.494814929381383e-01   +2.314153812294850e-01   +5.714116601448079e-01   +4.312950407094922e-01   +9.256502795612767e-02   +5.767038030924199e-01   +5.065575396793837e-01   +9.328444280416588e-01; +7.538995754678687e-02   +1.952832769144276e-03   +3.741561113016306e-01   +7.098192374837780e-01   +4.347209446792545e-01   +3.365346706310212e-01   +7.127285430334236e-01   +5.379885397021088e-01   +3.901045200511403e-01   +7.760140430811693e-01   +6.028996354108632e-01   +2.281846835642223e-01; +6.351875544467638e-01   +2.270526111929297e-01   +5.804081745351380e-02   +1.832624618954070e-01   +6.604990733868149e-01   +5.939565792561550e-01   +7.851489290378937e-01   +3.325682799151693e-01   +3.343860700118227e-01   +1.391890785633990e-01   +9.181250303004728e-01   +9.912694535339936e-01; +5.657811274172158e-01   +4.544631477768093e-01   +3.213683518780301e-01   +6.634182185906440e-01   +2.321338500705309e-01   +5.985726203232129e-01   +9.851967075407090e-01   +3.991331602182981e-01   +2.038805930110951e-01   +8.619058751761963e-01   +9.167350911856629e-01   +1.527759843164582e-01; +2.188915649451222e-01   +6.305038754067682e-01   +7.227373900305178e-02   +7.792843969969370e-01   +5.668910698457512e-01   +1.830811959256825e-01   +3.768700945671881e-01   +1.000000000000000e+00   -1.248015315838189e-02   +4.121197243945988e-01   +4.492047238499929e-01   +4.367919896815444e-01; +6.857454098613972e-01   +8.700986634288814e-01   +9.237263325064136e-01   +3.470477179844187e-01   +4.492396385404931e-02   +7.098696941577445e-01   -4.122698014355790e-02   +9.165684488605452e-01   +6.484220497410428e-01   +7.439466069698079e-01   +9.163820677915082e-01   +6.379446901008141e-01; +1.161447146916678e-01   +5.444703682915720e-01   +4.795803156774807e-01   +6.912201101543217e-01   +5.726554240053807e-01   +2.590848892832208e-01   +9.687923660503253e-01   +7.838433798963470e-01   +7.385170337441913e-01   +6.814021403740080e-01   +4.574030000938812e-01   +2.701832663145443e-01];
L2E_Input1_iAMPA_netcon = [+8.427319773115195e-01   +9.168466247989383e-01   +8.240081121504570e-01   +1.000000000000000e+00   +9.229649949598132e-01   +8.627700977165819e-01   +9.598246072435188e-01   +8.975728172594728e-01];
L2I_Input2_iAMPA_netcon = [+1.000000000000000e+00   +9.931630246686585e-01   +9.757616837557833e-01   +8.537809167032505e-01   +8.573343068911242e-01   +9.966913489378323e-01   +8.883426320207437e-01   +9.926119980820317e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
