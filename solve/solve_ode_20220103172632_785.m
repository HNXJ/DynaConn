function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.756757401432246e-01   +4.396417906656409e-01   +3.411911516271027e-02   +5.067874632296346e-01   +3.814851287157844e-01   +1.184530545196889e-01   +1.670380560739137e-01   +6.987235929457843e-01   +3.678095353886864e-01   +2.970417006984539e-01   +2.608381448436735e-01   +3.646448572214364e-01   +3.811204270473421e-01   -3.920305816077968e-02   -2.251365595416309e-01   +2.349213187840504e-01; +8.789480622428177e-01   +2.120918471753719e-01   +7.188222389777340e-01   +1.785888333585613e-01   +1.751536408879197e-01   -8.081014386324979e-04   +2.034251002203265e-01   +1.661707156741790e-01   +4.479565066597923e-01   +4.741981377503858e-01   +3.014758192392305e-01   +3.886554463841967e-01   +6.784890633581424e-01   +6.326391297579510e-01   +3.560307194197010e-01   +9.295054790886155e-02; +2.238302794065227e-01   +2.424281673046293e-01   +3.646117129847674e-01   +1.813874795887432e-01   +4.997985871532769e-01   +2.746246678098458e-01   +5.098518223834142e-02   +6.583758388139516e-01   +3.022619905911797e-01   +3.815323322508525e-01   +7.672507995009951e-01   +5.424696834393318e-01   +7.209839858196098e-01   +6.438770032181438e-01   +3.183689912810553e-01   +5.500434713659321e-01; +4.558888336289451e-01   +4.400383190983106e-02   +4.458223304480122e-01   +9.795156691802712e-01   +4.881776803361038e-01   +7.131479281422696e-01   +3.934561000476108e-01   +4.191541671282366e-01   +6.936540383729208e-02   +1.307265485752753e-02   +4.502959670429171e-01   +3.169581722347494e-01   -3.441554121191296e-03   +3.094206235881862e-01   +4.874587241866447e-01   +2.082542949975433e-01; +4.339917202749765e-01   +4.570561536262716e-01   +3.420468917591513e-01   +2.352752723640651e-01   +9.025136280679427e-02   +6.918604791108837e-01   +5.752422208756800e-03   +2.294146422042229e-01   +3.476551816448607e-01   +6.032514685224267e-01   +4.273790171065016e-01   +2.841541930768064e-01   +6.358725923002060e-01   +4.040012692853960e-01   +7.597207382576943e-01   -6.591327525656006e-02; +1.231426201193922e-01   +7.159638120137315e-02   +5.571769714055248e-01   +2.409884374657449e-01   +5.099172619058667e-01   +1.800175808562250e-01   +4.154148134603670e-01   +8.553019439426925e-02   -2.374962355479713e-04   +1.781622379441608e-02   +4.335198003230396e-01   +5.684410685865288e-01   +3.087164957912152e-01   +5.820067695314192e-01   +6.688056951895301e-01   +2.098837126241605e-01; +1.511090840350583e-01   +5.200093465893868e-01   +9.744476366003009e-02   +3.230720594526789e-01   -2.140079995736053e-02   +3.365333911244416e-01   +4.781480902688570e-01   +4.723960375976787e-01   +5.439507878850549e-01   +4.629288977374354e-01   +6.191694569470174e-01   +5.121209701987260e-01   +1.477666835182115e-01   +1.402445073702756e-02   +1.797051284268676e-01   +1.768162870378585e-01; +1.861600728426289e-01   +4.054087390297815e-01   -3.181685280870344e-02   +7.058228765547625e-01   +5.089429915443197e-01   +2.550084719011877e-01   +1.156401031944787e-01   +1.731526329000843e-01   +4.430298308280153e-01   +2.759544144245920e-01   +5.839048019802962e-01   +6.840328870530133e-01   +4.320817154922803e-01   +1.379836999871634e-01   +6.098463984022823e-01   -2.717125642482396e-02; +2.753719581308720e-01   +4.324986173179158e-01   +1.456312453888251e-01   -2.057713893655899e-01   +2.338513278018299e-03   +5.816346788551716e-01   +3.222511762641812e-01   -1.203164103235599e-02   +3.067791555412589e-01   +1.451073860873614e-01   +4.443586055232291e-01   +1.831542338567679e-01   +4.754092014465263e-01   +6.112239455345854e-01   -6.854895083671682e-02   +4.916145946746562e-01; +3.973422504963078e-01   +1.696942231734667e-01   +7.458284379250342e-01   +6.766981802813610e-01   +8.774190456774281e-02   +5.519065245232674e-01   +1.402343359704715e-01   +6.591282170407915e-01   +3.864857519183280e-01   +5.232173698498360e-01   +1.019992515945504e-01   +7.032178552661040e-01   +5.175080780610268e-01   +4.388366818725979e-01   +2.496933402766438e-01   +1.509346860429290e-01; +1.398128231686366e-01   +8.046298279401379e-01   +5.705072494158675e-01   +1.721815409465704e-01   +7.155154107437262e-01   +5.382182449432881e-01   +6.441067191876088e-02   +3.695382780632759e-01   -1.626491465247026e-01   +7.765487120829080e-01   -2.206281209543999e-02   +4.853170015979283e-01   +5.409529142388252e-01   +1.856692016340684e-01   +4.460952621402581e-01   -1.214691902260569e-01; +1.199859127701796e-01   +2.874067893946698e-01   +6.610786758453666e-01   +1.000000000000000e+00   +1.565629052052824e-01   +5.851460212440356e-01   +2.530878736668588e-01   +1.075753479370622e-01   +2.748656955676644e-01   +1.036682031573982e-01   +7.778640608466653e-01   +2.843951750063488e-01   +1.958577043505643e-01   +1.681900872383445e-01   +3.255008141494177e-01   +4.404410909532190e-01; +4.785817070930383e-01   +6.076415879543309e-01   +5.738748210884621e-01   +5.425739629123889e-01   +3.474583602875717e-01   +6.534784681313039e-01   +6.871478264492126e-01   +3.472380608335969e-01   +3.139760749083958e-01   +3.393308089504619e-01   +3.679467476828248e-01   +5.892995369959210e-01   +3.392568214470517e-01   +3.821158043191585e-01   +6.559545696106265e-01   +2.135397681672092e-01; +5.518273012669350e-01   +8.054996827149670e-01   +3.534478294547960e-01   +4.347741148114965e-01   +5.032523380125453e-01   -1.655864025008501e-01   +4.098293098501806e-01   -7.712157482068444e-02   +4.045070667175957e-01   +4.100055665489901e-01   +2.016321140830537e-01   +3.416776402530142e-02   +5.111160613488059e-01   +4.369198370624988e-01   +2.234833352876961e-01   +5.286757621404509e-01; +4.799548325809855e-01   +3.339952690263009e-01   +7.211266054795710e-01   -1.026604961972512e-01   +9.666846435389659e-02   +4.163573123380064e-01   +3.360585763315944e-01   +3.544589802749770e-01   +2.116059680991283e-01   +2.952888294467089e-01   +5.409736114896518e-01   -1.057509993535488e-01   +5.811408943970425e-01   +3.553702736037851e-01   +5.541733805558899e-01   +5.200274931685626e-01; +5.328993814178529e-02   +8.936982882531279e-03   +1.001543509449397e-01   +1.829513706208210e-01   +5.899106348920052e-01   +5.640911296624858e-01   +3.410159196989237e-01   +6.546302044477625e-01   +1.977555904400715e-01   +2.589903497510965e-01   +3.623735443893895e-01   +6.150182540170124e-01   +5.487101213881097e-01   +6.563700193029784e-01   +3.697864709087690e-01   +2.061763929695823e-01];
L1E_L1I_iGABA_netcon = [+4.460731571812923e-01   +6.547706321946900e-01   +3.720960788388936e-01   +2.609039578713494e-01   +4.713187668537064e-01   +6.225491355052482e-02   +2.246306286213517e-01   +3.424025691178633e-01   -2.433976469231082e-02   +1.821279850754399e-01   +7.139527729952376e-02   +4.587592614409723e-01   +3.318594417152821e-01   +3.741985652190068e-01   +9.483917155941658e-02   +6.226426608613128e-01; +1.598711579327028e-02   +1.130295468098713e-01   +4.487752615414853e-01   +2.009633683618520e-01   +4.414778124359510e-01   +5.203296206332054e-01   +8.361076490599282e-01   +4.994990792362421e-01   +2.990759691890233e-01   +1.731695077173452e-01   +4.239262334003707e-01   +5.871588304613147e-01   -2.758918428721754e-02   +6.621736699395625e-01   +4.737770262816653e-01   +5.692092585096981e-01; -1.700005996683144e-01   +1.758758731049522e-01   +1.740936265177700e-01   +4.399429349070738e-01   +3.912884447416485e-01   +4.415309811250878e-01   +3.859899226528472e-01   +3.063640596296702e-01   +4.521146280401654e-01   +1.689338167872976e-01   +5.321009141483751e-01   +3.147363098405732e-01   +8.245512569741329e-01   +4.904921119833067e-01   +6.377141593015013e-01   +7.359805193110988e-01; +5.169473023907543e-02   +6.112644533797970e-01   +7.023761595146505e-01   +3.340129555529091e-01   +2.546790602344179e-01   +2.915347074545195e-01   +3.385839097336780e-02   +1.222766004378424e-01   +4.644129110183466e-01   +2.001969054517934e-01   +6.606018680338700e-01   +3.315418665118212e-01   -1.320941063057757e-01   +4.234490472479718e-01   -1.135287667708286e-01   +1.516626591184314e-01; +4.084420457276463e-01   +2.942237201122833e-01   +6.072517981665709e-02   +4.592977422904451e-01   +6.836205030687084e-01   +5.478699128296689e-01   -1.188356327458887e-01   +8.073729175803071e-02   +2.203818174545798e-01   +4.791482601004156e-01   +5.559281834138065e-01   -1.772402988966190e-01   +3.329669412548339e-01   +4.928159918791309e-01   +3.350780629810080e-01   +4.143907623109082e-01; +1.964739617744755e-01   -3.032898306852671e-02   +6.593225374702794e-01   +2.123862286739762e-01   -8.440766797541586e-02   +1.759244750275264e-01   +4.622747592965117e-01   +2.295821967424519e-01   +3.828179590923178e-01   +4.088574456632890e-01   +3.076912981755636e-01   +4.202570479322476e-01   +3.554054434493628e-02   +1.335055687304533e-01   -2.425078533374275e-01   +6.587462780594517e-01; +3.049304373869013e-01   +2.884006661559498e-01   +2.753632285964409e-01   +4.607871514107779e-01   +4.812327364869045e-01   +2.763266851890102e-01   +2.023150239720486e-01   +1.280799000874818e-01   +6.781297773666650e-01   +2.995373370045128e-01   -2.177763069163344e-02   +1.015117123699344e-01   +5.327841507472826e-01   +3.975495524234613e-01   +4.789528584356156e-01   -2.729715881104418e-01; +5.552133442704559e-01   +2.934765289632959e-01   +4.018687133726492e-01   +2.735677124640187e-01   +1.330160213570344e-01   +2.547652582905318e-01   +2.972575641918186e-01   +6.044245848875233e-01   +1.847088814706575e-01   +7.167251661771743e-01   +7.687271768917092e-01   +5.346031839050186e-01   +4.720014461724878e-01   -2.880948318882465e-01   +5.809986024813382e-01   +5.864202787089980e-01; +4.626030059515061e-01   +5.700151532194836e-01   +5.752362603213266e-01   +3.561202728970779e-01   +1.563242277843234e-01   +6.405242758438618e-01   +1.591244700252522e-01   +3.104953319184554e-01   +9.170604123334373e-01   -1.223057740783708e-01   +3.778024545981385e-01   +3.399797465562969e-01   +5.584863582756758e-01   +4.357634733054984e-01   +1.309123101114175e-01   +4.390515721912138e-01; +5.629481452545242e-01   +1.471897615476011e-01   +6.430277212112823e-01   +4.865092718478970e-01   +3.305276356143482e-01   +4.678672404804747e-01   +2.840563245991459e-01   +4.268008471701039e-01   +5.486312322866957e-01   -1.460403290921757e-02   +4.386775426309064e-01   +1.431516331633875e-01   +5.350703556789657e-01   -6.657320245948882e-02   -3.669994086463124e-02   +2.047796642360030e-01; +6.132227528512939e-02   -2.429398526965877e-01   +5.856955765973584e-01   +9.448926112204246e-02   +2.902731368894806e-01   +3.894413668744034e-01   -5.085457231201001e-02   +1.090099622901621e-01   +5.887002018974654e-02   +3.319231087528431e-02   +2.622368879099379e-01   +2.096972398141350e-01   +7.854419633855649e-01   +5.769835645234661e-01   +2.457473273524293e-01   +6.004208980629258e-01; -1.479979733521294e-01   +8.212181914288136e-01   +5.722648201686308e-01   +8.131817548596596e-01   +6.818612611343624e-01   -1.526903803527691e-01   +5.502284813087891e-02   +2.127531404057705e-01   +4.460191088950826e-01   +6.292902306717394e-01   +5.051542455009199e-01   +6.488362830983059e-01   +8.308147874511049e-02   +7.120865085992006e-01   +4.201388138190008e-01   +1.256597293494737e-01; +4.040465944664973e-01   +6.751858993048736e-01   +5.591904538467432e-01   +5.621689551244281e-02   +6.106403198631792e-01   +2.647074509682008e-01   +5.692124164964374e-01   +6.790883837549989e-01   -1.378396178723733e-01   +1.469466709729972e-01   +9.291158491098034e-02   +4.108023473266624e-01   +3.930252626136506e-01   +2.772506085903012e-01   +1.883514949453554e-01   -3.020216434833294e-02; +2.542000626633162e-01   +2.731060815234959e-01   +4.848271907004501e-01   +1.348821550319215e-01   +1.455513176974177e-01   +4.771247212444292e-01   +4.641156958301269e-01   +3.828786517381126e-01   +2.242750212328223e-01   +1.000000000000000e+00   +5.784704530557226e-01   -3.520586219307486e-02   +5.668484952966496e-01   +2.083002159985456e-01   +1.475754826035227e-01   +5.858841638154150e-01; +5.041612836551872e-01   +4.925816699950549e-01   +9.318837499795345e-01   +8.127098568054189e-01   +2.458033348995377e-01   +2.761764183664555e-01   +2.104892881465499e-01   +3.398599675878022e-01   +3.730875617781970e-01   +3.361017437352986e-01   +6.326291666092274e-01   +1.685480180228739e-01   +5.228959682127781e-01   +7.233122507172461e-01   +3.854168589474159e-01   +7.287423866878330e-01; +5.873870478542618e-01   +3.302952626673730e-01   +6.278098539417086e-01   -1.289527569767202e-02   +3.434524268751879e-01   +4.535216281897340e-01   +1.875580788157249e-01   +2.287746872377918e-01   +3.696078670069048e-01   +5.491816473149911e-01   +6.030531008805563e-01   +3.164288556865796e-01   +3.731049140131329e-01   +1.908660180117873e-01   +5.949539831326022e-01   +7.516318382706584e-02];
L2I_L1I_iGABA_netcon = [+3.700295061263441e-01   +5.368849548554182e-01   +5.230777782099012e-01   +9.626488084337717e-01   -9.911102211419641e-02   +3.150807942274065e-01   +5.480670699214826e-02   -8.723838505767460e-02; -1.389477868520256e-01   +2.995333001841250e-01   +3.276825051336128e-01   +5.106368952560342e-01   +3.851460652998990e-01   +4.791170067598609e-02   +9.717623405857663e-02   +2.540730537746682e-01; +1.034502618766487e-01   -1.597148339277932e-01   +7.023172890860540e-01   +5.299855595370054e-01   +3.369763401345268e-01   +8.484326379295858e-02   +4.030884357654124e-01   +7.098794206098136e-01; -1.072142088854600e-01   +4.201373882068757e-01   +1.189655852991728e-01   +6.274610334582040e-01   +4.678620906951237e-01   +3.671520072094112e-01   +4.416549979715547e-02   +4.187982203670271e-01; +6.697559552687131e-01   +6.057087157913206e-01   +3.696502398078557e-01   +3.337291859146496e-01   +2.085070786703432e-01   +7.416295673892200e-01   -1.442877857388817e-01   +6.064347301926515e-01; +1.515896958363015e-01   +3.178296639034432e-01   +3.930853898942050e-01   +8.530022687647933e-01   +3.890214346606612e-01   +4.773561344542058e-01   +6.190489087826081e-01   +4.683621416181813e-01; -9.538296542650189e-04   +4.812663892951429e-01   +6.133782846977470e-01   +1.000000000000000e+00   +2.950565338385703e-01   +7.231351053921561e-01   +3.440352391707917e-01   +3.552809618171682e-01; +6.546071158393897e-01   +2.894275177363418e-02   +6.062781885195918e-01   +7.201783595374575e-02   +4.663941258153884e-01   +4.237887051862919e-02   +3.580235671310040e-01   +5.625095278159125e-01; -6.737534870327157e-02   +2.612371121124763e-01   +3.602139844085077e-01   +3.633062953466147e-01   +7.888138303790639e-01   -5.220700194384457e-02   +3.375221704018228e-01   +3.032345025897335e-01; -7.046088730468050e-02   +6.359499957181947e-01   +3.799510350688962e-01   -6.552562489796133e-02   +4.490413515757407e-01   +5.517301461411739e-01   +7.001631999837562e-01   +6.222294894089984e-01; +4.575492498753527e-01   +8.509074412684964e-02   +2.764988708030247e-01   +4.836596576838202e-01   +5.885118825100770e-01   +4.120190785602603e-01   -7.160962346458925e-02   +5.879317071993068e-01; +5.103297430385114e-01   +3.940455171511455e-01   +8.012699942853418e-01   +2.238025792388235e-01   +6.050181114559714e-01   +8.635937724264210e-02   +3.725071200794593e-01   +8.634831382080062e-01; +3.757648704549653e-01   +2.632181216772566e-01   +5.266774918178699e-01   +6.054264575479806e-01   +3.211303221994955e-01   +5.663498976330820e-01   -1.289315086613438e-01   +6.704695989088967e-01; -8.766991686505471e-02   +5.429732716806471e-01   +6.156655028026947e-01   +5.361465077154280e-01   +2.845569302655727e-01   -5.080091866403522e-02   +1.516051049536868e-01   +4.270266602841037e-01; +1.608562588337993e-01   +3.928196399482213e-01   +5.620316170398491e-01   +1.329676219742688e-01   -3.351882008641886e-02   +6.417664438302393e-01   +7.019562049962983e-01   +6.976891236205779e-01; -2.085790118182260e-01   +2.841307164575708e-01   +2.847766042417963e-01   +6.620134590036270e-01   +1.550960705457877e-01   +9.928072466205664e-03   +6.320760405105345e-02   +4.427663048088045e-01];
L1I_L2I_iGABA_netcon = [-1.167799971415325e-01   +1.045833933293150e-01   +5.773388996293563e-01   +3.798591752812905e-01   +7.675466532710687e-01   +3.691177712690979e-01   +7.155311960288131e-01   +6.555218056480506e-01   +1.669277763528473e-01   +3.557676957974626e-01   +5.701556983369975e-01   +6.084238459946261e-01   +7.568071086907164e-01   +3.982810687595005e-01   +4.109041868718185e-02   +4.829119302784617e-01; +4.397404483347059e-01   +5.802164415057616e-01   +6.102758151523731e-01   +7.198516400101557e-01   -2.114592338595050e-01   +1.346769289042193e-01   +3.425056403353521e-01   +2.678114990830398e-01   +2.381639486397228e-01   +2.007987644897997e-01   +6.330580386725276e-01   +3.953975956050802e-01   +6.951540998983552e-01   +6.679942156395240e-01   +8.882941228328077e-01   +7.369257628440781e-01; +1.632339228094082e-01   +4.901854614203455e-01   +5.723001824074615e-01   +4.679520075518075e-01   +6.176659918443677e-01   +5.931028501283231e-01   +3.699997491625613e-01   +2.614352525772154e-01   +2.364636997837063e-01   +6.175723500226782e-01   +6.309283535389532e-01   +5.536368794249247e-01   +2.672465473004222e-01   +5.479012302975932e-01   +1.730453292387287e-01   -7.997291667104327e-02; +4.975273507625465e-01   +8.487183929827768e-01   +5.330513755410470e-01   +2.248250152287872e-01   +1.798234197028160e-01   +2.657094243919900e-01   +4.973183723848452e-01   +8.475878816032367e-02   +4.139214369318763e-01   +4.124511707794107e-01   +3.559174789010001e-01   +7.406473304315314e-01   +1.905804002265192e-01   +7.703243982047413e-01   +5.349826628541419e-01   +7.432479727576667e-01; +4.700935435867508e-01   +6.298347837814433e-01   +8.439385626300575e-01   +1.743693168934798e-01   +6.749194565353257e-01   +4.101288154447218e-01   +5.014244955932599e-01   +3.909880701644953e-01   +1.626301826321381e-02   +8.019987339513804e-01   +1.848388382211720e-03   +6.854433531714464e-01   -2.382135757871289e-01   +3.003528291186284e-02   +1.452455879081681e-01   +6.221415474589397e-01; -5.847846318170046e-02   +3.896927438895091e-01   +2.299829445401875e-01   +4.619116544468364e-01   +7.663625181447339e-01   +6.317919817153882e-02   +3.016582198974125e-01   +4.201644319723197e-01   +2.816134512502303e-01   +7.995807060362956e-01   +1.491216765404826e-01   +3.065045924555704e-01   +6.080085015728015e-01   +2.503325555127700e-01   +4.054560347334984e-01   +4.681340629616657e-01; +4.937825065674480e-01   +8.967195147364435e-01   +4.243970923006090e-01   +9.128432650190512e-01   -2.660301254035075e-02   +1.000000000000000e+00   -4.503604715096202e-02   +4.890167742156770e-01   +2.908331994561595e-01   -6.325291130391383e-02   +8.300101255958944e-01   +7.623131062563945e-01   +2.803381823013205e-01   +5.034300100256763e-01   +3.943656554927127e-01   +5.316754081139007e-01; +3.302646781815995e-01   +7.602855977902641e-01   +5.326858550047134e-01   +5.423496320468281e-01   -8.135207372944947e-02   +2.213486360178322e-01   +4.996604177820537e-01   +4.360207148191129e-01   +7.680357537434018e-01   +2.480662843605389e-01   +1.570444152718756e-01   +2.733943696636622e-01   +4.267497931267360e-01   +7.149584180045696e-01   +3.781830486706348e-01   +4.452092959753340e-01];
L2E_L1E_iAMPA_netcon = [+5.780019823661545e-01   -1.047992466771794e-01   +9.321196292774511e-02   +5.432468029930760e-01   +3.367048170970651e-01   +6.303411877503858e-01   +1.481361125627581e-01   +4.384919028203952e-01; +3.735808619962879e-01   +4.603809665080653e-01   +4.162344911490382e-01   +8.780936815714530e-01   +4.353349139056613e-01   -2.433211908531748e-02   +3.559197271313728e-01   +2.356538523721699e-01; +3.876287508542746e-01   +2.729902178630499e-01   +3.065811573311220e-01   +6.190746988705261e-01   +1.012172713704166e-01   +1.782168872079524e-01   -2.275060188156193e-02   +4.087125119979678e-01; +1.049882339630756e-01   +1.935472693221046e-01   +4.995204804317933e-01   -5.879600978514900e-02   +4.552244297462483e-01   +4.645717334286814e-01   +1.065500901149650e-02   +1.566335858099381e-01; +1.874044263563377e-01   +1.813283227440294e-01   +1.190504071610282e-01   +7.879296543522328e-01   +6.536064750025952e-01   +4.906388767975603e-01   +2.140097410614650e-01   +4.930915079760273e-01; +4.836261358413997e-01   +5.212381721394488e-01   +1.650781976651460e-01   +4.969156619102481e-01   +1.990519516634937e-01   +3.195343738444744e-01   +7.350996721377934e-02   +6.922721626572019e-02; +6.918421195713468e-01   +2.649129383489071e-01   +1.183025253759630e-01   +6.750793500761307e-01   +2.355395341987626e-01   +1.475939150526059e-01   +3.367242242386992e-01   +3.488132874323420e-01; +9.189381107661299e-02   +4.086064982630329e-01   +3.830791646547270e-01   +2.632520895332980e-01   +9.404779262122064e-02   +1.410229352271432e-01   +2.984974516439418e-02   +2.420335377843003e-01; +6.381384050055132e-01   +5.470590652880094e-01   +3.994458821928829e-01   +3.704032115925950e-01   +3.480687190387842e-01   +2.760177483678559e-01   +7.099985042473064e-02   +5.033701722039401e-01; +1.007992108811976e-01   +1.940690456301967e-01   +3.270100067823298e-01   -4.788500336621983e-02   +2.717830789864915e-01   +4.353224735170527e-01   +5.229150476232004e-01   -1.867032646266013e-02; +6.808821231297883e-02   +6.012916724828089e-01   +8.296465097936095e-01   +4.364678843288353e-02   +5.325808055795495e-01   -3.444730321756324e-02   +1.000000000000000e+00   +4.024556082419967e-01; +7.808156120878267e-01   +3.077523954795419e-01   +4.514846819937242e-01   +4.702669800916688e-01   +1.052960549917573e-01   +3.134780498213539e-01   +2.558754448633587e-01   +3.832662969460506e-01; +4.002694510815504e-01   +3.430844981121536e-01   +2.060865127599396e-01   +6.445073658287356e-01   +5.459859825166696e-01   +3.456473542169190e-02   +1.235841083568513e-02   +3.374816677847512e-01; +1.611488387648080e-01   +2.783188163231342e-01   +3.011483354963774e-01   +3.800292987747844e-01   +1.040629496847372e-01   +4.942744257150093e-01   +9.333520434853146e-01   +4.955081527226650e-01; +2.240404571054832e-01   +1.034900020963471e-01   +3.934701126306359e-01   +7.068312562240732e-01   +4.512133632130825e-01   +1.688474205553084e-01   +3.208049701423880e-01   +4.563779615583905e-01; +1.050880914036406e-01   +5.736276152450587e-01   +6.914337648497337e-02   +2.677256222318372e-01   +1.144730908515871e-01   -8.387389108658921e-02   +4.899260276722739e-01   -1.454567345687545e-01];
L1E_L2E_iAMPA_netcon = [+2.857365179284713e-01   +4.289938544226941e-02   +5.907248229902481e-01   +6.061760431807626e-01   +8.109911772940315e-01   +4.547825264022823e-01   +6.689413538965630e-01   +1.774031314946655e-01   +4.485832470071839e-01   +8.209704418625693e-01   +2.303142156114146e-01   +3.188129834624160e-01   +6.699405924036546e-01   +5.892884001512678e-01   +3.576345725760797e-01   +6.142812595334194e-01; +2.974611789125463e-01   +5.572093164577502e-01   +1.002636569149877e-01   +2.953994949087301e-01   +3.502288880595479e-01   +5.258927896177468e-01   +7.049151104603366e-02   +3.922724290416630e-01   +4.391627985839087e-01   +5.276837629834022e-01   +5.350725859533816e-01   +4.159145459635770e-01   +3.637974492613031e-01   +9.911294280592216e-02   +7.510307329461934e-01   -2.976581213899005e-02; +4.336126725354164e-01   +4.270860404408275e-01   +7.936831978109991e-01   -1.455099034398004e-01   +5.036962175269555e-01   +1.776228409277235e-01   +2.791441665137580e-01   +5.502790297247652e-01   +3.602905618072224e-01   +3.796727730752281e-01   +5.215885548230333e-01   +7.472225239128008e-01   +8.365489440319527e-01   +3.066969738240731e-01   +5.295697916100458e-01   +9.264991486405619e-01; +4.047185188102418e-01   +7.707866362580932e-01   -7.535313368668128e-03   -6.031754556485362e-03   +4.413892042140945e-01   +5.200997411927668e-01   +3.268462068674026e-01   -2.000587356600977e-01   +9.228918008984305e-01   +3.780451037789249e-01   +1.744444918673748e-01   +3.589234109959841e-02   +4.222047562828208e-01   +5.647964074955969e-01   +2.723568756734860e-02   -1.843870375506385e-01; +4.659517307534396e-01   +4.648568723936645e-01   +1.788881993929494e-01   +1.572928274496461e-01   +2.319473720797598e-01   +9.730072504409155e-02   +6.984688508754319e-01   +8.212875168857948e-01   -1.194064959875268e-01   +4.781869741719237e-01   +9.292916644350810e-05   +7.229089279639861e-02   -4.656767739060139e-02   +1.137532444823467e-01   +4.862327877384169e-01   +2.909255102305415e-01; +5.238959534975041e-01   +5.691139993069247e-01   +6.086678644367246e-01   +1.000000000000000e+00   -1.953866161590311e-01   +1.634429000448740e-01   +2.051195733256058e-01   +3.427348772953862e-01   +3.169308715933302e-01   +2.031020377624446e-02   +3.328474038757126e-01   +1.661209689843990e-01   +9.259006264450962e-01   +1.562425722322272e-01   +2.109235419577145e-01   +6.457229365953819e-01; +3.905208239462281e-01   +5.849712579975080e-02   +1.380383483997902e-01   +5.392418254830079e-02   +3.042663280282925e-01   +2.178462219462013e-01   +1.910457415346302e-01   +7.983581562496690e-01   +4.753794596136937e-01   +3.485470127675452e-02   +4.503320076439961e-01   -3.939426483084360e-03   +1.223517104921221e-01   -1.175445539158710e-02   -1.573532378050911e-01   +1.053979166214404e-01; +4.490852419423116e-01   -2.796812059826867e-02   +7.788738622187761e-01   +6.388794625712614e-02   +6.108054161556459e-01   +8.858063800933259e-01   +2.810710846528601e-01   +1.705410988932887e-01   +4.441983096836464e-01   +4.438746004899404e-01   +3.725260856424208e-01   +1.883487991003334e-01   +1.039690232634635e-01   +7.767857068077214e-01   +6.953135836700997e-01   +2.927476431468407e-01];
L2I_L2E_iAMPA_netcon = [-9.575656475244355e-02   +5.092455896497180e-01   +2.874580383220684e-01   +2.193510018727161e-01   +9.748779691717429e-01   +5.565349462680502e-01   +2.979271110888236e-01   +7.597619609208579e-01; +4.818646084162106e-01   +8.296903871247377e-02   -3.003922940380621e-02   +5.130217341762355e-01   +1.883985092781495e-01   +3.720434534998489e-01   +2.123027444839485e-01   +8.877115603225852e-01; +1.585273008246255e-01   +4.818289062884126e-01   -1.003495577815613e-01   -1.139946558729856e-01   +7.159354718714789e-01   -9.299499186524122e-02   -8.072690887271071e-02   +2.888207241824415e-01; +5.743417125528362e-01   +6.758974772385068e-01   +1.208480088482013e-01   +1.000000000000000e+00   +6.103890825311350e-01   +5.731845320464893e-01   +1.231421971950723e-01   -1.673018259330702e-01; -3.993495822258684e-02   +4.641053986285366e-01   +2.218804028255971e-01   +6.164905395356037e-01   +7.397512947606746e-01   +4.725486796419931e-01   +5.659410643616392e-01   +2.066201817285990e-01; +8.870388424481389e-01   +1.662455337684316e-01   +1.956989874917871e-01   +2.321128631382607e-01   +1.385469572032756e-01   +8.368910997433057e-01   -2.239647387734043e-02   -4.134674542448365e-02; +3.900597538697699e-01   +7.883370797838789e-01   +5.974375780615701e-01   +7.730642652403814e-01   +7.328867773238926e-01   -1.624677943763677e-01   +1.362373852343015e-01   +1.058672291938706e-01; +9.836017022502580e-01   +5.749406181040188e-01   +5.240889785183484e-02   +1.563944277914383e-01   +7.046868604201103e-01   +2.457651280495247e-01   +6.341596543403439e-01   +4.090963092633575e-01];
L2E_L2I_iGABA_netcon = [+8.921222140286150e-03   +1.983908397097603e-01   +3.630393985824704e-01   -5.468691453418356e-02   +7.834105812135858e-01   +8.375414327876057e-01   +3.442727265982576e-01   +5.239778052935204e-01; +9.178727343476193e-01   +7.673165228991813e-01   +2.022080709755038e-01   +1.398942360413578e-01   -1.687506288941003e-01   +9.264037200579237e-01   +5.610097217142410e-01   +3.440717279052816e-01; +9.539517870065498e-01   -1.243518539058627e-01   +8.502517452521214e-01   +1.557727748274211e-01   +7.459881662033840e-01   +8.081443132848583e-01   +9.157178388022433e-01   +2.364915499948596e-01; +1.238338521293674e-01   +4.163258282267990e-02   +7.444451571300598e-01   +6.769744563132626e-01   +6.390577067456009e-01   +7.725179844537869e-01   +1.746748689017810e-02   +7.080890666153686e-01; +5.376949719137109e-02   +7.761700001864303e-01   +8.370903394125939e-01   +6.900899846952918e-02   +4.220419852354474e-01   -1.062783626746891e-02   +6.620201560593186e-01   +1.671013019603788e-01; +4.435362258561870e-02   +6.847087341231289e-01   +5.821316235828690e-01   +2.858697989313119e-01   +1.887389143746936e-01   +9.128893560596223e-01   -2.736003853230917e-02   +6.383133124057198e-02; +1.946196123042816e-01   +7.124482306105615e-01   +1.224145713808761e-01   +9.559045219728608e-01   +3.494695042187136e-01   +8.044906870249771e-01   +6.437649096450904e-01   +6.749254228608343e-01; +1.411472085993545e-01   -1.232251674279671e-01   +6.421908733699283e-01   +6.578197422792781e-01   +7.130075276558644e-01   +1.902478657324974e-01   +4.618416285155836e-01   +7.596331259908689e-01];
L3E_L2E_iAMPA_netcon = [+2.004993873162517e-01   +1.000000000000000e+00   +7.384344626708582e-02   +2.802245832362981e-03   +6.019189411278396e-01   +4.099788097293416e-01   +4.473219166423844e-02   +7.772774831926700e-01   +6.020012453924322e-01   +1.041829670554094e-01   +4.167917064903753e-01   +6.702799632037130e-01; +3.397916292418502e-01   +1.824077862476652e-01   +4.081300521476416e-01   +2.315534439618965e-01   +3.191958881787858e-01   +4.432167787579571e-01   +1.886000149396647e-01   +6.151459183238038e-01   +3.540848510218899e-01   +2.177762660344315e-01   +5.052598066070237e-02   +6.633301140083506e-01; +3.025347876272729e-01   +5.489239613293773e-01   +4.120074387203805e-01   +4.705809199596777e-01   +7.109822698671481e-01   +3.838606269407048e-01   +6.520122972201157e-01   +3.004647124826997e-01   +5.266306700551417e-01   +3.312826411898303e-01   +2.586609671061681e-01   -3.509608122779877e-02; +7.082026935536219e-01   +8.134706507959431e-02   +6.941064356981991e-01   +2.549136817950163e-01   +5.864924202296783e-01   +4.273223888105191e-01   +2.347259179516011e-01   +3.660871500986760e-01   +3.439273283715111e-01   +4.260726184403358e-01   +4.147171571830427e-01   +7.512022485008882e-01; +2.418182920109948e-01   +1.052750432015414e-01   +4.420735466920167e-01   +2.447636048048750e-01   +2.013422404021658e-02   +5.180511368303564e-01   +1.777423346359706e-02   +6.076155378410343e-01   +9.995397468704105e-02   +7.612001939705654e-01   +1.164984146103344e-01   +6.465153379190611e-01; +1.472614750143593e-01   +3.861343757449343e-01   +2.234060507648235e-01   +2.694314281103435e-01   -1.736759312149040e-01   +3.553362213814854e-01   +3.049377961152026e-01   +6.250981576254904e-01   +5.168575155093775e-01   +8.185103013311286e-01   -2.717812154148520e-02   +4.857688077788787e-01; +4.254986160931880e-01   +3.822037354086437e-01   +1.313904569690788e-01   +7.967878251198716e-01   +2.309004939556063e-01   +4.364214630848902e-01   +5.092692460537183e-01   -3.226039698266245e-01   +4.404172403760578e-02   +6.403322370730549e-01   -1.225767487402143e-01   +3.308760553665615e-01; +8.584839404166028e-02   +2.922229233682138e-01   +1.762277617329321e-01   +4.477339954178161e-01   +1.472530043754030e-01   +2.310309219974309e-01   +3.149324619015846e-01   +2.991012653786369e-01   +1.499169381406811e-01   +6.486224524562531e-01   +5.334847993181365e-01   -4.600937917780662e-02];
L3I_L2I_iGABA_netcon = [+7.112615814751332e-01   +6.609246390979358e-01   +4.007516410894015e-01   +1.955152005299363e-01   +5.351123330801797e-01   +9.375395306452892e-01   +5.260278216099191e-01   +3.610684958295794e-01   +6.634051687338323e-01   -1.853998091529781e-01   +4.545901568729110e-01   +6.434493818688362e-01; +7.349420838536822e-01   +3.235702943186543e-01   -5.079589709405881e-02   +8.347075931179877e-01   +5.535582922021676e-01   -8.881961875461161e-02   -5.256988935399401e-02   +2.138356012550892e-01   +4.097268602040329e-01   -2.115574276718208e-01   -1.681292740623574e-01   +6.002842118204469e-01; +2.902465341008478e-01   +4.168539879234934e-02   +1.082084038723408e-01   +7.985112034843911e-02   +4.603693607830728e-01   +2.593671401509337e-01   +5.424185335205316e-01   +6.682979934945242e-01   +1.764635112768079e-01   +4.914335727651179e-01   +5.236585004176384e-01   +5.327229193173630e-01; +8.563622450241860e-01   +2.439364897502771e-01   +4.095060281628647e-01   +5.166400109387929e-01   +1.150537354909947e-01   +7.779769017989907e-01   +5.795426362870079e-01   +9.235662970690686e-01   +5.522574376811595e-01   +6.017361700660712e-01   +6.408542634298360e-01   +6.172581389086840e-01; -1.694105881042134e-01   +3.860751742457240e-01   -7.386787130087245e-02   +6.175878701259958e-01   +2.633425654989998e-01   +4.021869559240439e-01   -1.526054399599212e-02   +2.002830907879694e-01   +3.804836745246730e-01   +5.564048626551782e-01   +4.883027632254711e-01   -4.076320940878984e-03; +3.297074250121029e-01   -2.229867575802696e-01   -5.934410311718241e-03   +6.332465347829112e-01   +7.238935127636149e-01   +1.000000000000000e+00   +6.437844939267399e-01   -1.575858867675882e-01   +1.049818944314688e-02   +7.598411575907784e-01   +3.081424165497254e-01   +3.361956331804647e-01; +4.592954590538997e-01   +2.629437363639428e-01   +2.257544936645708e-01   +2.164780512593499e-01   +5.897882127306425e-01   +6.189140036573511e-01   +1.975654662804821e-01   +1.095367999972180e-01   +7.129246505191028e-01   +3.148723802336389e-01   +5.411979249952105e-01   +7.565277882810560e-01; +3.431940099360438e-01   +6.431656100999626e-01   +3.448962190472282e-01   +3.535529806593910e-01   +4.342110583708327e-01   +3.909764798807277e-01   +6.842853667306914e-01   +6.535458308142076e-01   +4.235162850733336e-01   +1.985503084739052e-01   +3.640768049438343e-01   -3.162665567098503e-01];
L2E_L3E_iAMPA_netcon = [+8.436000675547144e-01   -1.897665614559399e-01   +1.452073534312719e-01   -1.070197561339723e-01   +6.138450334635416e-01   +5.202923558397003e-01   +4.484723837148525e-01   +3.025943721319269e-01; +3.403066766950827e-01   +7.572560339187616e-01   -8.646869277078023e-02   +6.207188735901907e-01   +3.204151320542176e-01   +1.976859322108213e-01   -2.456667657777904e-02   +4.526464913734108e-01; +4.809465925824781e-01   +6.488429695411319e-01   +4.909495930394651e-01   +8.964615077100266e-01   +6.898491212555262e-01   +6.853525265397798e-01   +4.056026616189780e-01   +1.892686176679085e-01; +3.930387971474774e-01   +3.085932739707114e-01   +7.483650665467281e-01   +6.177491121506699e-01   +7.915374375959767e-01   +1.533806139797307e-01   +4.981556403153214e-01   +4.252935206921270e-01; +8.725598159136149e-01   +7.869289727607651e-01   +4.344495978407222e-01   +2.043690210559394e-01   +1.346790534606809e-01   +7.078210129815302e-01   -1.189124672076848e-01   +6.145440352277151e-01; +6.520084220491532e-01   +3.117810563047185e-01   +7.668300271520043e-01   +3.760709618465015e-01   +1.000000000000000e+00   +7.361189071732882e-01   +1.989930440228399e-01   +9.618430460820745e-01; +8.272673551307207e-01   +3.340268943762386e-01   +8.051326670254939e-02   +5.991834496970154e-01   +6.385774586582933e-01   +2.941407858664927e-01   +3.976008971318264e-01   +4.904374722941332e-01; +2.245375521854273e-01   +2.539341785930984e-01   +2.198710346553970e-01   +2.823071028140428e-01   +4.673494632963155e-01   -9.346101471477594e-02   +4.114965317847186e-01   +8.676165050349592e-01; +5.283528655615261e-01   +4.956109356897768e-01   +6.163071802929944e-01   +4.932429704997793e-01   -2.830194813005244e-02   +7.916934370738489e-01   +3.369270537342994e-01   +4.505416460013518e-01; +7.896350908264259e-02   +1.620706880171313e-01   +4.546981004944209e-01   +4.181398669534265e-01   +3.181942206623813e-01   +8.412046999067242e-01   +7.180718780185096e-01   +5.431123047434596e-01; +4.517047442370646e-01   -2.236577821095031e-01   +8.321656194875134e-01   +1.345239598889182e-01   +3.387935045311712e-01   +1.819911347882825e-01   +2.186802270340627e-01   +5.914389740332044e-01; +3.075175492164289e-01   +2.229883331232525e-01   +2.254907502149941e-01   +2.095086908446100e-01   +7.496310910517618e-01   +1.958331515327748e-01   +8.882053607565510e-01   +6.305983358013153e-01];
L2I_L3I_iGABA_netcon = [+4.435102379103115e-01   +2.524482618963836e-01   +6.247917110473376e-01   +6.931778639751685e-01   +3.925933515029055e-01   -1.831989338893212e-02   +3.835207325656058e-01   +4.952683924253932e-01; +3.507144149007613e-01   +5.829410900280760e-01   +6.829953755106878e-01   +9.041134388477834e-01   +2.404734850523559e-01   +8.828332741383292e-01   -1.035796747741347e-01   +5.753457985886575e-01; +2.607212849903423e-01   +9.324837536531374e-01   +6.392695471114613e-01   +3.363865617803793e-01   -1.654750878201195e-02   +1.917322423430321e-01   +6.078757993631543e-01   +4.551990644780497e-02; +2.039154285733413e-01   -2.764284402199654e-01   +7.068225328200319e-01   +1.118742201892850e-01   +3.563511197957971e-01   +2.230777864350683e-01   +5.489468042059045e-01   +8.522249268417130e-01; +7.228520670624675e-01   +6.016233955306862e-01   +4.014688554353443e-01   +3.935453132544803e-01   +3.524640855542464e-01   +9.978204047577068e-01   +2.586391559162139e-01   +1.007338303516073e-01; +5.667530206957083e-02   +1.417011156837531e-01   +3.863415424149061e-01   +1.072695927756493e-01   +6.777773010578648e-01   +8.066837223268024e-01   +9.083427729288763e-01   +1.265778445771727e-01; +9.400871568354381e-01   +2.484629529695196e-01   +7.972530392127033e-01   +7.993694137488734e-01   +5.351878806241074e-01   +1.628474909249194e-01   +9.195546223095306e-01   -1.134466340176221e-01; +6.301100290169667e-01   +5.111485787100357e-01   +8.040208306647978e-01   +4.579028260878109e-01   +8.671075001359355e-01   +7.634602423307366e-01   +4.954073272795482e-01   +1.777590053148912e-01; +3.486498443709529e-01   +8.113608284124358e-01   +7.527956730895381e-01   +5.072452870479930e-01   +6.986656291244083e-01   +4.718907120025455e-01   +1.000000000000000e+00   +7.250424046855254e-01; +9.876873368724377e-01   +4.175813319840386e-01   +6.443024578209812e-01   +5.149442486300476e-01   +3.467400661238762e-01   +2.681789446451028e-01   -4.057641590118728e-02   +3.796191519408410e-01; +5.781596809075726e-01   +7.151351438291874e-01   +1.825208810585238e-01   +4.580362776214778e-01   +4.051463744590940e-01   +3.924012884814204e-01   -2.797502342333016e-01   +3.503942660443478e-01; -3.831339041451700e-02   +4.965028175970345e-01   +1.843150014579792e-01   +3.959484405163624e-01   +6.108260410990730e-01   +1.447306572168851e-01   +3.206146432597800e-01   +6.071654358716665e-01];
L3I_L3E_iAMPA_netcon = [+1.746110624513861e-01   -8.464813990039025e-02   +2.077355685203161e-02   -1.890929409032877e-01   -2.957422539363813e-02   +4.190942055795347e-01   +1.278376577538025e-01   +1.041053005422208e-01   +3.875538604116747e-01   +8.192404124941094e-01   +6.324048800136445e-01   +4.395658675831506e-01; +7.070905597148909e-01   +2.493660600021673e-01   +7.875903952740888e-01   -7.818632943435312e-02   +5.255624812034715e-01   +7.185597609469705e-01   +5.001464048188003e-01   +2.871226037841462e-01   +1.918261878708062e-03   +3.022035680263889e-01   +6.073782020767999e-01   +2.583728627910281e-01; +8.388583187381232e-01   -1.413301286248589e-01   +3.480029902678422e-01   +5.840757417019089e-01   +6.538883499045316e-02   +3.897530502516224e-01   +7.380019970846905e-01   +3.409626587085993e-01   +4.842317026871305e-01   +3.428876528135068e-01   +5.099046730823102e-01   +5.984414807396454e-02; +7.967940271323534e-01   +2.641329175751590e-01   +8.062828632556167e-01   +7.837561975883874e-01   +1.550565819404462e-01   +7.143216499655448e-01   -6.671495866697351e-02   +6.206328112920773e-01   +6.209247216331918e-01   +1.825174196271197e-02   +7.546850425109550e-01   -1.150766283759550e-01; +6.645269722815850e-02   +2.806961394013857e-01   +2.410238863744025e-01   +3.608531479545192e-01   +6.229539671196832e-01   +6.275274285986565e-02   +3.199333080433595e-01   +2.203200704052189e-01   +6.873685131639736e-01   +5.006618043856136e-01   +4.868537886383049e-01   +5.888241041397524e-01; +3.052169476728393e-01   +1.247027068063465e-01   +1.414664853383811e-01   +5.445568956630640e-01   +2.074807331461691e-01   +6.815385552118143e-02   +1.519080581014760e-01   +8.540911194919752e-01   +2.156158989747673e-01   +3.464262320701558e-01   +5.430495501457363e-01   +1.478988375647028e-01; +1.973297156997541e-01   +7.158130647466457e-01   +7.058767241181417e-01   +3.753246369482582e-01   +4.418852227925639e-01   +2.277183964869742e-01   +2.634673383760365e-01   +3.611767975301362e-01   +1.278519893866152e-01   +5.175996337533048e-01   +4.029032014061116e-01   +6.600853949051494e-01; +4.995275470572095e-01   +7.540372240084594e-01   +3.042791257809976e-01   +6.177361901378904e-01   +6.495137834077388e-01   +3.493726484084816e-01   +6.511596722989110e-02   +1.921122906160573e-01   +6.541210493697883e-01   +6.411162541167139e-01   -2.237332485133187e-02   +6.928689986053970e-01; +4.617977931550957e-01   +9.283720776484364e-01   +7.640216968861449e-01   +5.163946189902078e-01   +5.199406260263746e-01   +7.164515269339483e-01   +3.139275954758276e-01   +5.937491621967237e-01   -4.179683566650651e-02   +2.790715243462643e-01   +7.541880319877727e-01   +4.264692975359300e-01; +1.093907457258035e-01   +4.615978841390289e-01   +3.558401816075217e-01   +7.155890853578565e-01   +4.358415339277452e-01   +5.162614635389369e-01   +6.459101263521044e-01   +2.142651768762057e-01   +1.804756292195808e-01   +6.336090224165926e-01   +4.845911872353845e-01   +6.554474394965850e-01; +8.093357972861184e-01   +1.095893206098291e-01   +7.496960158513968e-01   +8.458253047686803e-01   +2.367731409054670e-01   +4.009021994272412e-01   +7.928643770014314e-02   +9.610547201895822e-01   +8.227079940731649e-01   -5.215565231649922e-02   +6.598889922970250e-01   +6.893313765447024e-01; +3.973380969963385e-01   +6.496077471441412e-01   +4.985196509488986e-02   +1.046574472850916e-01   +2.924394174701047e-01   +4.236029576170020e-01   +1.000000000000000e+00   +2.060548493602595e-01   -5.919359182232277e-02   +1.721324341386588e-01   +3.723597067675384e-01   -1.541600380402295e-01];
L3E_L3I_iGABA_netcon = [+1.716288847373815e-01   -2.177823178282083e-02   +7.886739053736332e-01   -2.686020748080710e-02   +2.517243169693248e-01   +4.528852670899475e-01   +5.523152642011043e-01   +3.571114529812756e-01   +2.231259594756759e-02   +3.988306326657443e-01   +1.793001929069841e-01   +3.411998928268023e-01; +3.329415424587018e-01   +2.349082358928212e-01   +3.958463293722901e-01   +7.580653726480255e-01   +6.935806429709693e-01   +1.239860116362301e-01   +1.919426882900405e-02   +1.973353752766277e-01   +2.397524161547925e-01   +6.493742658086474e-01   +8.198975069157444e-01   +3.745218001175089e-01; +3.898532116956952e-01   -3.356429308672743e-02   +5.115372935953859e-01   +3.957610146228878e-01   +6.059582260817675e-01   +6.172182713550886e-01   +4.880667428386082e-01   +2.788214454722290e-01   +3.663468849534605e-01   +3.250265558509564e-01   +7.158950773064539e-01   +8.991278580913910e-01; +4.434781658055479e-01   +5.059493137912161e-01   +9.459042923726692e-01   +1.102529274818000e-01   +3.034401959495759e-01   +3.830440644838992e-01   +4.964148053813308e-01   +4.209135014311169e-01   +2.194175059995696e-01   +4.834890583792960e-01   +6.662421350340740e-01   +3.090497706288901e-01; +1.455853863103879e-01   +3.333019992142108e-01   +3.784136621155871e-01   +2.721676148363162e-01   +6.055921987130278e-01   +3.358097257321678e-01   +4.981349387362794e-01   +5.652887643065315e-01   +3.598550524942351e-01   +2.677883213927388e-01   -2.617449829042181e-01   +4.763000431548139e-01; +5.390207687529611e-01   +3.873596495348084e-01   -2.264054465712164e-01   +5.542353882715275e-01   +7.677519695385636e-01   +8.342576583269044e-02   +3.610892380094425e-01   +1.443791485212655e-01   -9.549539387484231e-02   +4.137561601312041e-01   +2.238417644043109e-01   +6.328275307691239e-01; +2.424140085526187e-01   +6.601084747195556e-02   +1.016074260793682e-01   +3.557695526856869e-01   +4.442986564952013e-01   +7.973835234466232e-02   +2.167258302763111e-01   +5.415456669049407e-01   +5.117885310247841e-01   +4.769591223388279e-01   +5.059200420929675e-01   +3.258928726523111e-01; +3.115494023455854e-01   -3.277245530927286e-02   +1.744969827950630e-01   +4.097505634785682e-02   +5.573647455424769e-01   +6.463929070281835e-01   +3.902773117442221e-01   +1.482465518257416e-01   +2.805829115343423e-01   -1.391662128569861e-01   +5.281709516316657e-01   +5.884242092253641e-01; +3.942151414042810e-01   +1.020671119324410e-01   +1.285431216046289e-01   +4.202714104023108e-01   -4.508636713341990e-02   +5.552357402179428e-01   +7.278548897264876e-01   +2.346345297495254e-01   +2.073012441952312e-01   +3.755984228076084e-01   +7.470029974867508e-01   +1.304437078182517e-01; +1.462591900958769e-03   +2.978744145620303e-01   +3.626932438056887e-01   +5.161980370013795e-01   +2.239987222489219e-01   +2.422926497266898e-01   +4.577089713370691e-01   +7.114752003241591e-01   +7.649826536913829e-02   +2.824960788959804e-01   +1.471087937738473e-01   +4.554316299956736e-01; +6.114341171426221e-01   +5.659245625759018e-01   +6.749834754109358e-01   +1.891569598956187e-01   +1.723960466609457e-02   +2.659515080794264e-01   -3.288022851486881e-02   +6.944602473036997e-01   +3.811836977646283e-01   +5.262362919902861e-01   +8.210776221619825e-01   +4.154272789635381e-01; +2.628931363456466e-01   +5.111115344234446e-01   +1.288863820845815e-01   +5.001996684172164e-01   +2.179183653129391e-01   +1.980968056334102e-01   +1.000000000000000e+00   +4.821963284899113e-01   +7.376033470876548e-01   +5.197049250603383e-01   +3.185970067585593e-01   +8.501650082902866e-02];
L2E_Input1_iAMPA_netcon = [+7.913293399856285e-01   +8.407719306975300e-01   +8.515767167640540e-01   +1.000000000000000e+00   +8.279053442003615e-01   +8.416454962999996e-01   +7.544761104763613e-01   +8.209034682047374e-01];
L2I_Input2_iAMPA_netcon = [+1.000000000000000e+00   +5.245678165107489e-01   +8.741333679535108e-01   +5.982485607048341e-01   +3.407475446938652e-01   +9.356632925665470e-01   +4.465439776203586e-01   +5.891543002173515e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
