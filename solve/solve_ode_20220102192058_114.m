function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.949075138197123e-01   +1.759508965869707e-01   +8.521590618473369e-01   +4.599924291623447e-01   +2.917694205261019e-01   +7.485573995549020e-01   -3.842611921130737e-01   +5.160404633744821e-01   +3.008367345323475e-01   +8.397603587427210e-01   +7.501261605003468e-02   -1.108803329472305e-01   +3.182533582536015e-01   +5.920620525949749e-01   -8.733641331309389e-02   -1.088281323070932e-01; +4.098295105939354e-01   +4.209835493549414e-01   +2.479047076153185e-01   +7.356284931277672e-01   +4.388852111586417e-01   +4.211012562998559e-01   +2.621565466747432e-01   +4.785550446875443e-01   +7.614035904095510e-01   +6.127602000389234e-01   +5.738401135843304e-01   +5.267548233224675e-01   +3.276359165548593e-01   +9.075376538973450e-01   +4.532120216111337e-01   +3.674478260465754e-02; +7.914307557522130e-01   +2.815043333961010e-01   -6.072421727239261e-02   +2.101617388612795e-01   +3.725484497641514e-01   -1.964484374816149e-02   +6.426467311698709e-01   +4.271888511466062e-01   +4.381001111343084e-01   +4.279611501998647e-01   +2.177552418372897e-01   +1.266112136358137e-01   +3.420983841278328e-01   -2.881532021199381e-01   +3.431069133770766e-01   +2.915410863142406e-01; +4.256663729150405e-01   -1.069897492167965e-01   +2.572908309687867e-01   +5.791937527512522e-01   +2.370010841929302e-01   +3.395879665605294e-01   +8.174381513460640e-01   +9.253810650707861e-01   +4.173109718204971e-01   +3.784049065312899e-01   +6.771156009104282e-01   +5.876226097739488e-01   +3.581212591821388e-01   +3.987868953379314e-01   +2.503940650681074e-01   +5.668401008805014e-01; +8.048372883502125e-01   -9.877384180225744e-03   +6.082387519118615e-01   +9.079537176950168e-01   +1.858669466739112e-02   +2.749811890038247e-01   +2.703648103120637e-01   +7.572931086361202e-01   +3.003031289808746e-01   +5.717813916045423e-01   +7.148906163257425e-01   +6.803974797451120e-03   +2.521502006744752e-01   +1.896607682069339e-01   +4.785649640289948e-01   +3.393363289311653e-01; +1.844077687173880e-01   +4.857507149386378e-01   +4.446436353870568e-01   +1.522334308867705e-01   +9.645859915488346e-01   +2.591323955480583e-01   +9.474975474149229e-01   +8.622427664023975e-02   +2.400886008019536e-01   +1.047761108014983e-01   +2.782333496020450e-01   +3.276668506488108e-01   +6.989227875197735e-01   +1.320105744167523e-02   +1.419421376377614e-01   +1.725740839336581e-02; +7.090339830391053e-01   +6.519340822083342e-01   +4.629910043453185e-01   +4.326517014409851e-01   +1.746351310787659e-01   +2.905368955538735e-01   +9.958653672624111e-02   -1.828627036478629e-01   +8.185802810793336e-01   +3.679952132898230e-01   +3.670351007162591e-01   +4.926498265420859e-01   +1.570682642923190e-01   +4.076058135053148e-01   +5.446441701373064e-01   +5.027206012243490e-01; +5.071316486320113e-01   +5.790071334009348e-01   +8.295338106144551e-02   +7.971339848131873e-01   -1.918903090780079e-01   -2.535905884216152e-01   +4.170522916785679e-01   +7.073923234126961e-01   +6.343604508021178e-01   +4.768347902656569e-01   +4.565712528000412e-01   +4.438474391985819e-01   +4.184902280870926e-01   +4.541898500503748e-01   +6.668474192871595e-01   +4.680150845839379e-01; -4.391425528522155e-02   +5.127079761093764e-01   -1.914966291706563e-02   +6.343306784767011e-01   +5.491992510593360e-01   +8.567039440821791e-01   +7.921987342166541e-01   +1.058408308333858e-01   +3.449661376754045e-01   +4.958433896433500e-01   +7.629603448486231e-01   -1.028310971779734e-01   +5.586046533342329e-01   +3.791043211264478e-01   +9.069672069356306e-03   -1.030339988075321e-01; +7.646482166271526e-02   +3.195289744064070e-01   +9.634682000977386e-01   +7.114707314521866e-01   +6.588868598448443e-01   +2.808134829208290e-01   +4.112235813820334e-01   +4.272549646151217e-01   +2.237407953998767e-01   +4.453742448304090e-01   +1.463831830845159e-01   +5.129587499438645e-01   +8.282719996743939e-01   +5.826291147581599e-02   +4.426779268412359e-01   +7.134257784780675e-01; +6.514780465462727e-02   +5.457276300813070e-01   +5.272055230295901e-01   +3.038940808829196e-01   +7.459174070151773e-01   +5.864980460782763e-01   +6.682276563926504e-01   +3.170263322520841e-01   +3.999549965637824e-01   +5.559903907661884e-01   +3.623825285912571e-01   +5.521930759116899e-01   -1.049804885309714e-01   +5.592030923881929e-01   +4.646878104994880e-01   +6.818702389893903e-01; +6.015615440522568e-01   +1.500686467175552e-01   +1.109572553977159e-01   +1.470475665667810e-01   +2.392749185294213e-01   +6.123279582775886e-01   +3.206687614933941e-01   +2.520706364102336e-01   +8.123019381747603e-01   -1.931380116033230e-01   +2.255487478179443e-01   +7.509826968407103e-01   +1.821502249494590e-01   +2.510545723705765e-01   +2.976319085545538e-03   +7.687097695195363e-01; -2.514109713175695e-01   +3.033509728144521e-01   +6.144646995807428e-01   +6.062449824609573e-01   +6.813754580288802e-01   +3.941031719819217e-01   +1.294166458556336e-01   +4.665650582382204e-01   +7.465673705095297e-01   +5.536652187955488e-01   +6.736885701921848e-02   +1.592791715846649e-01   -1.155958546233440e-03   +2.494329274086208e-01   +3.691219556626654e-01   +2.057596297551732e-01; +3.758983229181159e-01   +6.768236186485703e-01   +6.584194616402839e-01   +4.329726483073910e-02   +3.110577419982238e-01   +4.984333139973801e-01   +3.433513303029420e-01   +5.886037760113039e-01   -6.094690200226793e-02   +4.705391316743915e-01   +4.924675049695855e-01   +3.663930680353370e-01   +7.523921007388529e-01   +4.365729562731872e-01   +6.042330691398180e-01   +3.457881541598859e-01; +5.101532538253468e-01   -5.185748544544397e-02   +3.689181382299585e-01   +7.321939350155263e-01   +2.533442628208683e-01   +6.040999652013073e-01   +5.152683195587401e-01   +3.392755386942942e-02   +6.524712066416898e-02   +3.805169399418426e-01   +3.226740517315572e-01   +6.076788224964929e-01   +5.631835825298971e-01   +4.785537538952002e-01   +6.567445993817270e-01   +1.022485269474883e-01; -1.235078179506796e-01   +5.311068370403360e-01   +5.797171308822937e-01   +5.312943583180229e-01   +7.007203105552000e-01   +6.214287013680482e-01   -4.712535904981244e-02   +9.846604237753045e-01   +4.372794929808206e-02   +7.058469783626728e-01   +3.938191082472913e-01   +4.743655487829072e-01   +1.958389663645057e-01   +5.653357106714511e-01   +4.623640804520986e-01   +2.902929737325215e-01];
L1E_L1I_iGABA_netcon = [+8.067143298438181e-01   +5.139630044566970e-01   +3.917237370399623e-01   +3.709231474731743e-01   +3.896664944505929e-01   +1.663613372831620e-01   +5.043966586596631e-01   +2.878617717938347e-01   -5.141108415402922e-02   +9.637388466325961e-03   +4.371485093516055e-01   +2.362728232696929e-01   +5.597680966196622e-01   +1.225316520492278e-02   -2.668310208848815e-01   +1.000000000000000e+00; +1.461739894878815e-01   +2.327762357089206e-01   +7.045865733036182e-01   -9.855527540224566e-03   +4.735696308328280e-01   +7.243625590481361e-01   +4.774629023047954e-01   +6.459543481998283e-01   +4.145856783420380e-01   +2.034090647805681e-01   +3.983742419329044e-01   +2.257974905856634e-02   +8.473655590663782e-01   +4.351882514818460e-01   -1.450894783982996e-01   +1.533077234066004e-02; +8.588836512133816e-02   +3.690077325552234e-01   +5.570669357024497e-01   +2.188938217885399e-01   +4.931104950360483e-01   +3.509967243232480e-01   +3.385488947524996e-01   -1.309629133687250e-02   +7.898326713720753e-02   +9.151530212388997e-01   +5.422695651141257e-01   +2.721826119018284e-01   +2.742216950506667e-01   -1.725348409307375e-01   +1.370516905312315e-01   +7.502196567484110e-01; +7.930979069903572e-01   +1.048231841437479e-01   +1.349664414779167e-01   +3.028529865022858e-01   +6.090777588980265e-02   +1.935153935824176e-02   +2.564310144490593e-01   -7.119984483361294e-02   +1.933087573637123e-01   +1.911416445046262e-01   +2.176106714487327e-01   +9.078689326781783e-01   +2.800520027836821e-01   +4.493718436450461e-01   -1.514386696411584e-04   +1.951634197964597e-01; +4.596587849809329e-01   +2.418694824394782e-01   +2.944914128616540e-01   +1.926605663174958e-01   +5.335125105010488e-01   +1.605107758015297e-01   +4.028267889689359e-01   +5.961429110367392e-02   +4.454193212221491e-01   +8.267227965091763e-02   +2.232732828514850e-01   +4.497846442926572e-01   +2.928445809701910e-01   -1.563778668084744e-01   +1.138883561544779e-01   +5.082832148515883e-01; +2.700424432942811e-01   +3.667090489268164e-01   +7.385395955541362e-01   +2.568061256064987e-01   +6.752635665599384e-01   +2.971784492519249e-01   +2.305699829202794e-01   -1.469168866996578e-02   +4.175543154602298e-02   -7.062992786865248e-02   +3.460881603415090e-01   +7.273252195318102e-01   +2.087508461571689e-01   -2.946874820024601e-01   +5.868801011842945e-01   +4.194801238430552e-01; +3.679334908332298e-01   +2.153733140004442e-01   +2.809741115865246e-01   +1.524349689041735e-01   +4.511592125282986e-02   +3.054876652460262e-01   +3.089531020925418e-01   +7.300614489932215e-02   +1.939734203158832e-01   +4.062062006262294e-02   +4.130071681411934e-01   +4.417319784750069e-01   +7.726435728634083e-01   +9.390411687911331e-02   +3.369667381284387e-01   +2.568857746199422e-01; +5.039114229370663e-01   +5.590038742007996e-01   +3.785192105077515e-01   +6.036444442116767e-01   +3.043600537289426e-01   +1.508341079839586e-01   +1.967756265561608e-01   +1.144532520700609e-01   +8.709405548800641e-01   +7.719990135600299e-02   +5.340399615297214e-01   +1.665472114556198e-01   +2.343575270829567e-01   +2.408990029385237e-01   +2.614223329704519e-01   +4.355776792307625e-01; +4.270546287120913e-01   +3.009518879842976e-01   +3.311747599748651e-01   +1.174544382517728e-01   +3.244069050154338e-01   +8.023054649547914e-01   +4.301038423057240e-01   +2.964072695881171e-01   +5.044551661896629e-01   +4.959656092123532e-01   +4.052473430776336e-01   +5.058752665978484e-01   +1.000681563353280e-01   +1.455153921511436e-01   +5.158410059440851e-01   +3.937550922529389e-01; -1.276770838114471e-02   +7.875721172817822e-01   +1.181040929817236e-02   +5.476360115235235e-01   +1.104842111810743e-01   +5.134162796444076e-01   +2.640116256061412e-01   +3.078506013017297e-01   +5.672766708464680e-01   -1.524286975818650e-01   +3.677272594644723e-02   +4.721546923270283e-01   +6.378465222980326e-01   +6.363820467447305e-01   +3.393141580788659e-01   +5.337062263670062e-01; +3.629562280442529e-01   +1.799537756887485e-01   +3.394478761862745e-01   +2.275329647996027e-01   +3.499280126544074e-01   +1.981834494324026e-01   +4.542998453494270e-01   -5.813956351388056e-02   +7.571616893466796e-01   +2.252525821796847e-01   +2.061154042113331e-01   +3.040454418737315e-01   +3.556559143996088e-01   +3.488475830354409e-01   +3.601197121302881e-01   +1.411933587557813e-01; +5.635248986617997e-01   +3.874170900327947e-01   +1.148879818167261e-01   -5.849954197951755e-02   +1.467822661166299e-01   +7.234528529120886e-02   +2.635635473631019e-01   +6.221274223381712e-01   +1.402161289953729e-01   +5.035930520746735e-01   +5.664883774879297e-01   +7.471812051879021e-01   +8.756644449394591e-02   +1.018360990763706e-01   +4.245269474444127e-01   +5.590362217722913e-01; +6.101820674932315e-01   +2.322067777354032e-01   +1.020653036784966e-01   +6.352025838046119e-01   +7.115113461706784e-03   +1.687260269525793e-01   +2.549676373319954e-01   +2.399521938226343e-01   +1.339225316881282e-01   +1.874038202511234e-02   +5.288337984648175e-01   +1.331020062634371e-01   -7.263047099458186e-02   +2.087544643190885e-01   +5.266949411122945e-01   +3.658151591206845e-01; +4.237443307366923e-01   +5.748265354011468e-01   +3.145840191322803e-01   +6.117489718386009e-01   +8.142255987399422e-02   +4.319798746369399e-01   +4.320379287497593e-01   +2.161954534828353e-01   +8.340967635664460e-01   +2.935722974947188e-01   +4.430520919203413e-01   -1.953619405370150e-01   +4.226754659902589e-01   -1.105849211962762e-01   +6.293106620515114e-02   +3.800603057508262e-02; +6.061445761510343e-01   +2.072116231255637e-01   +2.623610454323656e-01   +8.050469620050228e-02   -6.595492864564212e-02   +1.824638705209651e-01   +2.135147125359502e-01   +6.037627964630773e-01   +4.839022220238772e-01   +3.297605264776442e-01   +6.598369277996275e-01   +2.451024116196291e-01   -9.667029986829194e-02   +8.700394727174396e-02   +2.991229334583209e-01   +4.884802695898731e-01; +3.318595381489470e-01   +2.424580385284539e-01   +7.808939454783026e-01   +2.050675952351738e-01   +6.722438429627300e-01   +3.049517273848316e-01   +6.131387077080198e-01   +4.107515537127004e-01   -1.725360635423189e-01   +2.738694898123599e-01   +8.035136513470664e-03   +3.993685336954914e-01   +3.760718141364877e-01   +2.913423235454934e-01   +1.043705521692015e-01   +4.451377097570047e-01];
L2I_L1I_iGABA_netcon = [+5.766303185018021e-01   +2.547837017454043e-01   +4.635814940997212e-01   +5.514359325641902e-01   +1.883466372730964e-01   +2.997834218212284e-01   +7.722475918240210e-02   +4.822312745476319e-01; +4.478142865865306e-01   +8.057517209980475e-01   +3.743266974710359e-01   +4.166278071788567e-01   +4.887888316289882e-01   +1.667810527901352e-01   +5.616199571561223e-01   -2.071243219455470e-01; +2.875087449723341e-01   +3.986569517611918e-01   +6.077921236370648e-01   +1.424443098748868e-01   +6.511895359963812e-01   +5.251098874375158e-03   +2.012362983482829e-01   +5.286930310383506e-03; +5.528700524779918e-01   +1.769506462752558e-01   +1.868975578160874e-02   +1.904666120766688e-02   +5.820337367278721e-01   +4.773420475486310e-01   +5.255144148583242e-01   +4.193588999077201e-01; +3.142587117717406e-01   +6.420451587205811e-01   +3.724018253361794e-01   +6.314256605693369e-01   +3.577184085975699e-01   +7.885387261759259e-02   +3.607453895407082e-01   +2.409736763882595e-01; +4.782030235107227e-01   +1.581338620542964e-01   +5.408064461574359e-01   +4.690480749235529e-01   +1.779602625270088e-01   +4.495681991367430e-01   +4.026288957246130e-01   +5.865224730958420e-01; +6.558867657257103e-01   +8.989612784494245e-01   +6.981509616981518e-01   -2.000933444067446e-01   +5.189479498633939e-01   +3.208314863470078e-01   +3.691521096255230e-01   +1.353855733513974e-01; +4.888049747676826e-01   +2.089007978993500e-01   +1.899275579125649e-01   +1.852816200092667e-01   +3.391581297386623e-01   +2.064961256636674e-01   +3.377238834793003e-01   +2.288165505976468e-01; +6.904754205148467e-01   +9.581152272484198e-01   -3.126205849675464e-02   +7.692136632754326e-01   -9.907016290613928e-02   +2.062332798624855e-01   +1.813801285861547e-01   +3.554230591411783e-01; -7.075467488216636e-02   +1.572692130915033e-01   +1.192073736845422e-01   +7.131048460217886e-01   +8.017151700768506e-01   +1.631138573004163e-01   +2.182128948823078e-01   +7.196158574775682e-01; +2.582570369218026e-01   +6.951826424008750e-01   +3.772694549247029e-01   +6.096965050513004e-01   +1.521099010525313e-01   +1.265688911274109e-01   +2.985276868009962e-01   +1.258562379652485e-01; +3.955997702188809e-01   +1.682744096460599e-01   +6.297320901877114e-01   +1.406067827225645e-01   -4.450119579653596e-02   +5.622985585984003e-01   +2.605686323148702e-01   +3.972957230602112e-01; +2.852867133244740e-01   +4.594313478185185e-01   +8.542914884036537e-01   -4.866946191372666e-02   +1.353978250213735e-01   -5.502369913315541e-03   -1.868181131977176e-01   -2.580010208199212e-01; +1.722624154713703e-01   +1.829430786919833e-01   +9.628694102591198e-02   -1.828929452150156e-01   +5.409947164739590e-01   +3.208999922850759e-01   +3.695054304804790e-01   +1.017272242080107e-01; +8.257137173084524e-01   +7.596185379466727e-01   +6.097963768303668e-01   +8.553212037633381e-01   +5.442260046114377e-01   +7.901690055590164e-01   +3.781781985561341e-01   +6.303659000116535e-01; +3.564930253593419e-02   +2.117920006480498e-01   +6.591514569315127e-01   +3.172128287804096e-01   -2.654327796362196e-02   +3.392879116917404e-01   +5.457742649527516e-01   +6.918431048499201e-01];
L1I_L2I_iGABA_netcon = [+6.255518858409085e-01   +6.010540723716303e-01   +1.232591368572675e-01   +5.466220955779650e-01   +4.852555871300118e-01   +2.203159003301272e-01   +6.035075472056477e-01   +2.441874919318768e-01   -1.885710910830553e-01   +5.981752738144839e-01   +2.152849934792306e-01   +2.801826944173549e-02   +6.637189261748586e-01   +3.347587055732072e-01   +2.691175187446769e-01   +3.306230676324049e-01; +4.635766522983428e-01   +6.535887610317869e-01   +6.046339542156036e-02   +1.157700804565827e-01   +1.131602502173083e-01   +5.149051894679276e-01   +8.997575534805408e-01   +2.373954024464053e-01   +8.429743373743371e-01   +6.507464214640204e-01   +2.656048623330659e-01   +9.514124803884202e-02   +2.557729987978108e-01   -1.299721875225009e-01   -3.867739112246198e-02   +4.675119969105306e-01; +1.248817554687687e-01   +1.747024961075174e-01   +4.091238783998367e-01   +4.531082069471570e-01   +3.462261369621807e-01   +7.046109706395254e-01   +2.284454920420941e-01   +5.986868262886247e-01   -7.881260951679226e-03   +3.432284737284175e-01   +2.913719546035167e-02   +4.292387924174825e-01   +3.929769138313760e-01   +7.430570360601755e-01   +3.357822914926096e-01   +5.099468473399270e-02; +2.962588750284550e-01   +3.284509511231820e-01   +1.499013360599038e-01   +1.098661258446336e-01   +6.326536453332783e-01   +2.374517106544864e-01   +6.573596455249139e-01   +7.391331009236064e-01   +6.949632685643130e-02   +3.563409543556616e-01   +1.144241717662696e-01   +1.899509411545609e-01   +3.505128092685510e-01   +2.914217843765755e-02   +4.126393434558459e-01   +7.807476993895127e-02; +3.557181452324252e-01   +2.624854940624859e-02   +6.135121643851122e-01   +6.924834470698449e-01   +1.680238966934241e-01   +9.835040400545680e-01   +7.410021026148785e-01   +1.329437204857080e-01   +3.323932124228881e-01   +2.426948982657515e-01   +1.250657195110514e-01   +2.588971912289150e-01   -1.065964205862387e-01   +3.605671735548727e-01   +5.619232228096842e-01   +4.897665275065624e-01; +8.423995101505920e-02   +3.070622671511760e-01   +1.272972068640414e-01   +6.771788612944518e-01   +1.652459391209090e-01   +5.033080730564520e-01   +5.131244887060395e-01   +1.954103912287021e-01   +1.568812327313814e-01   -3.428306757778549e-02   +5.252668463163510e-01   +2.114079966610351e-01   +6.064662000668001e-01   +6.917451416444863e-01   +1.206094380010358e-01   +3.382894954797960e-01; +4.612584141360465e-01   +6.763970731795863e-01   +1.782598166168161e-01   +6.627894352073589e-01   +7.788376987903756e-01   +2.042043083150514e-01   +6.859615597562554e-01   +5.442893405126618e-02   +1.262640655088395e-01   +7.905849067847933e-01   +3.212846213514452e-01   +4.602863569133320e-01   +2.947567587007467e-01   +2.096926060939089e-01   +2.525858622641262e-01   +6.302865033384644e-01; +6.112025419333670e-01   +1.716930356363301e-01   +1.329984227184038e-02   +3.553259509694879e-01   +7.987021727189888e-01   +5.017436237733837e-01   +3.252184144887851e-01   +1.226965778998853e-01   -6.991558189292048e-02   +3.145648985548347e-02   +9.477358785909081e-01   +4.252203935766575e-01   +6.390848288708179e-01   +1.934204802036978e-01   +7.737764232183534e-01   +1.425606608141728e-01];
L2E_L1E_iAMPA_netcon = [+6.330218578604697e-01   +5.595410488169755e-01   -1.134651061339903e-01   +3.469381551848470e-01   +7.389664316784068e-01   +2.851810993417345e-01   +2.071576979816379e-01   +4.111467674391546e-01; -5.360430504362736e-02   +4.818671943833949e-01   -4.034296307970936e-02   +3.978646188856379e-02   +1.975461378246017e-01   -5.009681590461198e-03   +3.146341897001227e-01   +5.012869641938469e-01; +3.578017535650493e-01   +6.753798827888560e-01   +3.914376587795516e-01   +7.654462749023844e-02   -2.132194581252565e-01   +5.347511401346372e-01   +3.616618320882365e-01   +5.179137817712477e-01; +4.209914556388744e-01   +4.879349564931172e-02   +3.517547824813515e-02   +7.915545683251062e-01   +1.298570987277536e-01   +7.121319642500006e-02   +4.225887490879079e-01   +1.304973221930714e-01; +1.321610844576628e-01   +4.183519995684358e-01   +1.929850444182814e-01   +2.677968352653334e-01   +5.457171435554905e-01   +5.924900983826601e-01   +1.000000000000000e+00   +7.923201913471164e-01; +5.402039349844510e-01   +1.707932505152829e-02   +6.160095470805307e-01   -5.705093899294177e-02   +4.164250720789648e-01   +4.464413697205885e-01   +6.222640907523032e-01   +2.616188160496942e-01; +3.091216729767550e-01   +4.642740002413784e-01   -1.303591992494796e-02   +2.373067726520318e-01   -6.854301106303452e-02   +1.895112269543975e-01   +6.427816325012020e-01   -1.194269004558842e-01; +1.676455443887895e-01   +5.356758508206038e-01   +8.049670110271646e-01   +2.847412931589486e-01   +2.750438133291466e-01   +3.128795058949906e-01   +4.025319561422406e-01   +4.631395240650104e-02; +6.168049557550492e-01   +2.755884042921137e-01   +2.552250005963269e-02   +6.056925438891694e-01   +1.109131810135505e-01   +4.537714139745626e-01   +1.916426885903900e-01   +3.403232595599047e-01; +4.460206841898566e-01   +5.152364373431310e-01   +3.897067570531839e-01   +3.329902364177109e-01   +3.520368740851892e-01   +1.154158050888202e-01   +5.039003811673348e-01   +6.740406788685012e-01; +6.904621631179947e-02   +4.376281420127898e-01   +3.408616917174109e-01   +4.019309509661109e-01   +3.194739547498113e-01   +2.648676726486364e-01   -1.256892269471693e-01   +5.445403086184538e-01; +5.484381291001247e-02   +2.924516681268108e-01   +4.731937762017014e-01   +4.998440535565440e-02   +3.428448855619080e-01   +2.550046860222474e-01   -3.190713238011120e-01   +2.681849496316402e-01; +1.434669759288218e-01   +3.901180312225130e-01   +1.637228631198087e-02   +4.059999607492646e-01   +4.905026977044590e-01   +5.424241807175833e-03   +4.111320586468003e-01   -1.888665940148046e-01; +1.869896958132772e-01   +3.744929251418244e-01   +3.132428412582606e-01   +7.851041415952678e-01   +2.328176711402660e-01   +3.226529856630882e-02   +5.394640020955229e-01   +3.711565078623145e-01; +2.796971791178424e-01   +2.060671633490155e-01   +8.167629345994030e-01   +4.129179647384719e-01   +1.080660696628438e-01   +6.289171220845885e-01   +2.210423154980710e-01   +3.547924224442847e-01; +3.682603349012052e-01   -3.560504959786329e-03   +1.561342070617435e-01   +1.306022215153787e-01   +5.639053502587471e-01   +1.716587199855352e-01   +2.317687129156317e-01   +7.396313850315750e-01];
L1E_L2E_iAMPA_netcon = [+3.355200921666187e-01   +2.321813643816402e-01   -5.242893325853167e-02   +5.445266852599644e-01   +4.401274264780480e-01   +3.851081563863373e-01   +5.659429789780814e-01   +2.029777517564565e-01   +6.048166168554990e-01   +6.215294682047643e-01   +5.900956818403562e-01   +7.335058673211112e-01   +6.641175657441167e-01   +2.130192676908718e-01   -1.058163358031404e-01   +2.311310007886289e-01; +4.932715981363831e-01   -5.877436544495779e-02   +1.405045835866248e-01   +2.997008273756741e-01   +2.698215052144306e-01   -3.230691383687637e-02   +8.186938587633073e-02   +3.355872430308542e-01   +1.361870792692811e-01   +2.034384588565678e-01   +3.106518622214470e-01   +4.719898661497676e-01   +2.569338407055802e-01   +2.866008669997493e-01   +1.591247273943603e-01   +2.723654571445472e-01; +8.411434771555764e-01   +4.353670831067715e-01   -1.655388075234098e-02   -6.510203814972240e-02   +6.028987235548722e-01   +5.000974765522113e-01   +2.186338291839931e-01   +6.673211423130199e-01   +3.699797458499105e-01   +4.463509813374653e-01   +3.098719294560877e-01   +3.179175891162578e-01   +1.636303029378115e-01   +4.111142227642253e-01   +4.130590706878389e-01   -4.757070589170279e-03; +2.421755830114927e-01   +3.686355052294106e-01   +6.288251398050693e-01   -8.584121935539023e-02   +1.830710742166543e-01   +2.327726426091418e-01   +7.911775103403302e-01   +9.803023882450100e-02   +3.373290654665774e-01   +2.677607670692235e-01   +7.337926194302192e-01   +3.191875335622001e-01   +1.155240213199391e-01   +3.004742249945666e-01   +4.580042819130974e-01   -3.574104174874985e-02; +3.485656775030337e-01   +1.755058240152599e-01   +8.678542368877376e-01   +4.938965602643575e-01   +2.498319713546297e-01   +6.734790055183719e-01   +4.074838778906202e-01   +2.250848868451064e-01   +8.099976694977528e-01   +3.064423242096276e-01   +2.776471219793531e-01   +6.901527251838188e-02   +4.206781943941067e-01   +6.019815821137848e-01   +8.964232900789414e-01   +2.370271695866153e-01; +2.171805488701724e-01   +6.233766047450408e-01   +2.192782212374386e-01   +2.325763158167884e-01   +1.922209386457511e-01   +2.108705263008246e-02   +6.237174786724987e-01   +3.387544459886631e-01   +6.608059831619953e-01   +4.403011327096236e-01   +6.736104398349896e-01   +3.217192288226364e-02   +2.021764837650420e-01   -2.144075972364039e-01   -4.436333889942023e-02   +1.406823998546891e-01; -3.799734042048475e-03   +3.688458287303469e-02   +5.382299905649286e-01   +9.066260417886843e-01   +2.288176770558973e-01   +1.130206300013950e-01   +7.269473934760129e-01   +5.676476622585185e-01   -1.860619605959517e-01   +1.183572724375365e-01   +1.959833154426953e-01   +4.722466767102714e-02   -1.060060085563301e-01   +2.226223783506735e-01   +1.844528842488780e-01   +1.738895340599310e-01; +3.421887599816054e-01   +1.984623402785126e-01   +5.190916664325452e-01   +5.663707449426312e-01   +8.315961563310674e-01   +1.000000000000000e+00   +7.031149027662128e-01   +2.209723399606821e-01   -1.606069774224519e-01   +4.035477408825852e-01   +6.643983258078860e-01   +3.588799851342050e-01   +3.381012478699360e-01   -2.620750606958213e-02   +4.448475425961386e-01   +4.211491280475564e-01];
L2I_L2E_iAMPA_netcon = [+6.381035895287590e-01   +7.890819756053277e-01   +4.365405132025177e-01   +3.890694251210756e-01   +1.368816266835734e-01   +9.915588002630485e-01   +4.876333785032797e-01   +4.283576530785162e-01; +6.775007136143640e-01   +1.875378554948252e-01   +8.993805251554736e-01   +8.173934021022173e-01   +6.777701275015930e-01   +1.803438445675196e-01   +4.964919649268372e-01   +3.975222166727135e-01; +8.000174400421878e-01   +2.773195738442192e-01   +3.495634963452096e-01   -1.867864853118714e-02   +2.376282539597294e-01   +6.222028815462982e-01   +5.790691924678154e-01   +3.131720268317056e-01; +4.167877266388588e-01   +5.821137107938220e-01   +4.470033359917831e-01   +9.685342958722900e-01   +3.329321397268998e-01   +3.051877918783364e-01   +3.280785140799877e-01   +4.395512865118884e-01; +8.639290061345739e-01   +4.408475996908178e-01   +3.721993655302847e-01   +7.921820420151275e-01   +8.323301520483346e-01   +8.529626702442089e-01   +9.572526719539359e-01   +2.389694772998825e-01; +3.737129541829395e-01   +4.479864053159460e-01   +2.212457778938486e-01   +8.379525556702522e-01   +2.677993896459534e-01   +3.558339698042958e-01   +5.190765131288779e-01   +5.509163137590003e-01; +6.576857444978697e-01   +2.389142458728410e-01   +1.385703680140343e-02   +7.086342992429171e-01   +7.488071599569771e-01   +2.987891149696036e-01   +8.846274747088216e-01   +2.327808694686086e-02; +8.680710216942102e-01   +1.708488994482081e-01   -5.497241506700363e-02   +4.768746462503700e-01   +2.033264306002790e-01   +7.089329304488674e-01   -4.895305597185859e-01   +8.025835508282092e-01];
L2E_L2I_iGABA_netcon = [+2.581933809671986e-01   +3.391186652195480e-01   +3.477479288015664e-01   +2.615458639023904e-01   +1.561202117663738e-01   +6.129416193409104e-01   +2.392534547481391e-01   +6.801132567837012e-01; +5.075117044151762e-01   +7.976282541292734e-01   +4.905664774168267e-01   +5.307326876970688e-01   +6.271368607974942e-01   +4.351559093087320e-01   -1.710308872816810e-01   +4.393785520428896e-01; +2.039090814645438e-01   +9.971549592470049e-01   -1.215893933112936e-01   -3.571876583414026e-02   +6.280444684188207e-01   +9.476571898613826e-01   +2.674861272920312e-01   +7.143045785413639e-01; +1.484175007299716e-01   +7.777558219839998e-01   +7.755116206345232e-01   +6.170588628776703e-01   +1.000000000000000e+00   +5.344522160733798e-01   -2.973741860819722e-02   +1.086549418041076e-01; +1.349257134374730e-01   -2.779055593600321e-01   +2.022528714132455e-01   +8.138839742205604e-01   +6.001438482704149e-01   +2.653433409364489e-01   +3.921894164190867e-01   -1.039998620364973e-01; -9.493605450803013e-03   +4.125005486040177e-01   +3.898912273008074e-01   +1.881947960163908e-01   +5.792367377757950e-01   -2.192624287532669e-02   +6.479982628934143e-01   +1.365181938624245e-01; +9.169545903794382e-01   +2.193009964708820e-01   -8.556632880560495e-02   +4.518708978457298e-01   +2.814073075570181e-02   +2.945560453616313e-02   +6.232245433300952e-01   +6.939554761172601e-01; +3.859164423565874e-01   +7.537152199374141e-01   +6.102793449922156e-01   -3.460776896193083e-01   +7.954256400534311e-01   +6.372395376321619e-01   +6.465273872570195e-01   +4.990379382146279e-01];
L3E_L2E_iAMPA_netcon = [+1.537582454458500e-01   -7.404183847022860e-02   +1.672413915601069e-01   +6.143318323692631e-01   +3.602441066243289e-01   +2.579541672510650e-01   +4.626121071252687e-01   +5.381789525028303e-01   +5.187451932681504e-01   +3.309631632318294e-01   +1.186992845859291e-01   +5.501265610879547e-01; +2.849341628545385e-01   +7.461101825566067e-01   +2.167146563136796e-01   +2.419188745461099e-01   +9.991378204253785e-02   -1.611541220653515e-01   +3.287849370834893e-01   -4.688262393571047e-02   +5.105044992308962e-01   -2.302306679182653e-02   +4.199745199353185e-01   +3.685605147488631e-01; +1.748364645326930e-01   +2.685256673141933e-01   +6.270551842084793e-01   +4.484757801913667e-01   +7.998192299938907e-01   +5.209318230076007e-01   +6.588973730730860e-01   +3.789291702432477e-01   +6.711666788840045e-01   +2.256667608310379e-01   +3.623550099170405e-02   +6.105438434516103e-01; +2.436627808087783e-01   +4.206836360653692e-01   +5.136240143634462e-01   +1.819646955217529e-01   +2.960623798035921e-01   +2.664411354579754e-01   +1.982662721280118e-01   +4.343160019059072e-01   +3.139382784526989e-01   +5.502041606335273e-01   +4.031278718149076e-02   +8.452068410663953e-02; +5.296093635992700e-01   +4.145473887760659e-01   +1.125511996790594e-01   +1.173538581042825e-01   +6.827331999612605e-01   +4.799954095603511e-01   -1.769122766288076e-02   +2.311019665415671e-01   +5.455242228071422e-01   +3.355674441333562e-01   +7.340220095125377e-01   +7.765081776801053e-01; +4.327308543534888e-01   +6.197185257698048e-01   +5.772294617876270e-01   -5.866336300305170e-02   +5.675149469563582e-01   +8.207329818966358e-01   +2.018400650156792e-01   +1.004455139634619e-01   -6.752775621733091e-02   +4.553617530095861e-01   +4.778120181213441e-03   +3.106171617965112e-01; +2.205893948558280e-01   +4.585692063272903e-01   +6.778641631356529e-01   +1.500753754546010e-01   +1.211588804133278e-01   +6.113097344694756e-01   +3.380103301492101e-01   +4.049072013034713e-01   +4.827529659634066e-01   +3.696099585301087e-01   -6.180320710107495e-02   +8.403347611440029e-03; -6.278306042571240e-02   +3.223839565596673e-01   +1.428381153601862e-01   -7.409368819815852e-02   +3.211506489705113e-01   -2.214222610377883e-02   +3.567823161779480e-01   +2.478557645730723e-01   +1.000000000000000e+00   +6.552645274539184e-01   -5.686081896519810e-02   +2.356914232785712e-01];
L3I_L2I_iGABA_netcon = [+8.031220456322767e-01   +3.734180343763505e-01   +4.317680412355502e-01   +7.028140317568730e-01   -7.402670829483753e-02   +3.428285477528861e-01   +7.295504527988204e-01   +4.751358841491288e-01   +6.549239925974929e-01   +5.725291881476813e-02   +3.533678286238823e-01   +6.540019826141965e-01; +4.750470200942584e-01   +1.444833519206048e-01   +1.568775973934143e-01   +2.965652108132015e-01   +7.533149883993351e-01   +1.742724196733631e-01   +4.496110294336987e-01   -2.935551855282311e-02   +4.843845004959861e-01   +1.530747472072017e-01   +4.465685162788687e-01   -1.862860321771879e-01; +4.000537662223207e-01   +5.094912008452509e-01   +6.637876381011447e-01   +3.644393248795964e-01   -3.658084953914703e-02   -9.718801364652888e-02   +4.548713664926244e-01   +7.465690883312949e-01   +6.051117007281997e-02   +1.924403107569283e-01   +2.366381340527091e-01   +5.762917033775603e-01; +2.407526354875053e-01   +7.976369661739678e-01   +3.723380368887779e-01   +3.758869419210983e-02   +1.171221171012653e-01   +6.733335582214672e-01   +4.862935653284388e-02   +1.519787908248509e-01   +4.717174827495159e-01   +1.952259866313606e-01   +4.506577963525616e-01   +5.685628057134599e-01; +6.792196343962707e-02   +2.643631672240166e-01   +3.919780385248945e-01   +3.998815859063612e-01   +5.804302070379314e-01   +7.355909780203576e-01   +9.758719005683808e-02   +8.522954261699133e-01   +6.505046007807992e-01   +2.644940589841865e-01   +2.331248121540683e-01   +7.992407989966006e-01; -1.939713748668547e-01   +6.752679094334126e-01   +1.437309295259745e-01   +6.112321441236108e-01   +9.101252031454963e-01   -1.712890093809942e-01   +1.302966379247446e-01   +6.952990283404087e-01   +3.442007464331653e-01   +2.404625893145168e-01   +2.928683098355829e-01   +6.824857533249246e-01; +6.322691522575646e-01   +3.837078581908837e-01   +6.589854971969037e-01   +2.615076399258063e-01   +1.963966297970429e-01   +3.826451455599557e-01   +9.649914543236515e-01   +2.048524504671200e-01   -1.030298016884842e-01   +4.654255383848514e-01   +5.103742899443628e-01   +3.207311835612999e-01; -2.407753294229160e-01   +3.673990403230083e-01   +8.703070134444304e-01   +6.527244658549496e-01   -1.482808450871895e-01   +7.811888074860374e-01   +4.228983378676312e-01   +9.819767844606984e-02   +5.210404293754318e-01   +2.856670551226467e-01   +3.489085677019904e-01   +5.198845613475448e-01];
L2E_L3E_iAMPA_netcon = [+3.640513446357612e-01   -3.636256299711717e-02   +4.935310164016551e-02   +3.215296699915369e-01   +1.900647189440058e-01   -7.057112227012527e-02   +2.216068724697581e-01   -3.161764582596935e-01; +2.396019113593140e-01   +6.701025227659695e-01   +4.229325263681054e-01   +1.622156543417664e-01   +6.658505091967187e-01   +3.717412098806157e-01   -1.976338739465106e-01   -2.029911924845501e-01; +3.782638629498281e-01   +2.613590725620587e-02   +4.015245808497833e-01   +7.416699660944529e-01   +4.727143580186762e-01   +4.049890855978459e-01   -1.542529243188199e-02   +3.980107582188476e-01; +8.388391652026313e-02   +5.804076052784973e-01   +5.677877577245236e-01   +7.605095897857271e-01   +6.282301458195595e-01   +4.753945566082727e-01   +9.144747801170333e-02   -4.898103211046605e-02; +1.396921147911892e-01   +6.079047998292909e-01   +3.987563360395975e-01   +9.610390508393610e-01   +8.604538601577119e-01   +3.087146068818765e-01   +1.405639740383504e-01   +5.440327174599586e-01; +5.018521063277487e-01   +7.704615389482559e-01   +1.000000000000000e+00   +7.984625099971355e-01   +4.519636182700146e-01   +5.654377010420317e-01   +9.251901246904218e-01   +4.618760481131555e-01; -1.059113406254736e-01   +3.953086258974196e-01   +8.495911741761223e-01   +8.078547624211532e-01   +4.069244195399205e-01   +2.857818214354754e-01   +4.055119575035602e-01   +3.645059722437883e-01; +4.932109286881012e-01   +3.731682823269958e-01   +2.065987826373766e-01   +2.034610402275045e-01   +5.303312959515741e-01   +4.889462392633604e-01   +6.843641776225835e-01   +7.662248770701011e-01; +6.297798274552566e-01   +1.662881753413215e-01   +4.537403863980694e-01   +1.540788142835439e-01   +1.203041299315187e-01   +8.013538901600975e-02   +6.547857169829377e-01   +3.462423768682235e-01; -5.934214464019025e-02   +4.377062618450768e-01   +2.542274659087890e-01   +6.900133172739931e-01   +2.395009621367649e-01   +4.346933134612594e-02   +9.789123189985688e-01   +4.743337205693825e-01; +5.946010587081780e-01   +1.412108520756317e-02   -1.309932414059566e-01   +6.903045267923225e-01   +8.109722170478803e-01   +7.775347743297752e-01   -5.521613899077326e-02   +5.592964071818787e-01; -2.808841071246664e-01   +7.905640480553479e-01   +7.476505096985092e-01   +4.506816968136030e-01   -2.977398343877388e-01   +5.132236125990400e-02   +3.017268485316156e-01   +4.130928139355863e-01];
L2I_L3I_iGABA_netcon = [+1.523850417581167e-01   +1.131531254009484e-01   +8.568491400722507e-01   +8.530845779830861e-01   -9.479316382168020e-02   +3.643006444054511e-01   +3.140251860623708e-01   -8.768588116574637e-02; +9.857673496954492e-02   +3.826029775255202e-01   +1.604449594351258e-01   -4.844336946528568e-03   +3.089808073240217e-01   +1.549375181654112e-01   +2.611649751410799e-01   +1.786154153338113e-01; +7.571934400321528e-01   +3.796278739943479e-01   +2.930017674905355e-01   +2.714487020324796e-01   +5.685188050570030e-01   +9.478372135028251e-01   +2.177470710993158e-01   +4.561070538839773e-01; +3.218239606627918e-01   +3.573568451142235e-01   +6.240815391458328e-01   -1.566238410571710e-01   +5.694721895201266e-01   +5.006142572125380e-01   +3.442147539425010e-01   +6.275440383312189e-01; +8.927069738334190e-01   +8.128094253749550e-01   +1.852232180875635e-01   +2.099548319148664e-01   +4.191755132941194e-01   +5.637228019542234e-01   +3.531322025012392e-01   -2.035671231173926e-01; +4.444948583718921e-01   +3.523162059862547e-01   +8.572411360036153e-01   -3.439516979661562e-01   +1.552893809468118e-01   +4.957327834243571e-01   +3.995775182729556e-01   -1.491777438957371e-01; +6.916975205822398e-01   +6.034902576189570e-01   +2.714119705716215e-01   +8.568250904576028e-01   +1.986164920829621e-01   +4.600895962866591e-01   +7.530580267798017e-01   +3.791027140511239e-01; +2.923996657770870e-02   +3.342395489733679e-01   +5.305563488499917e-03   +1.027626176453233e-01   +6.899077142992314e-01   -1.306374373568214e-01   +1.529941945689294e-01   +5.175935603263164e-01; -1.900685993426953e-01   +4.216450000046735e-01   +5.834964390477806e-01   +4.566875997157720e-02   +1.415952830446039e-01   +5.763634412950478e-01   +5.822149320640025e-01   +3.652589632235704e-01; +4.973037126201141e-01   -3.959306693502854e-01   +3.019745152442616e-01   +3.486815093594789e-01   +5.403049906957607e-01   +6.623538945399602e-01   +9.854771042726257e-02   +4.116540715087749e-01; +3.196156435045730e-01   +3.343475155572028e-01   +2.240748952107205e-01   -1.437584603305616e-01   +5.882976131556582e-01   +7.740380908198395e-02   +2.077956009040742e-01   +1.000000000000000e+00; +9.450140230361770e-02   +4.770186478481814e-01   -1.478420868449160e-01   +2.284435061140518e-01   +9.795686142246525e-01   +3.168798305035859e-01   +2.600162150826626e-01   +2.450809706882611e-01];
L3I_L3E_iAMPA_netcon = [+6.794240587637196e-01   +5.673904641610281e-01   -6.493865337353356e-02   +7.609149538357959e-01   +9.120887104513026e-02   +1.979713003685403e-02   +2.522257222089415e-01   +1.313395197493735e-01   +3.356574852460324e-01   +4.176124713553934e-01   +2.383722974377276e-01   +4.536495609885265e-01; +5.091125057035958e-01   +6.302550285050538e-01   +6.216711344540153e-01   +4.258511569606141e-01   +9.866530439732761e-01   +3.569305524739970e-01   +5.426695953197179e-02   +7.277923616858468e-01   +8.231515744668028e-01   +1.237057590448838e-01   +2.018350337107962e-01   +3.594158946684754e-01; +5.436638747335750e-01   +7.192094395700138e-01   +9.662935240954030e-01   +4.716085757592384e-01   +6.429063282548133e-01   +6.505507142501441e-01   +6.080359318272281e-01   +1.638471408304488e-01   +4.841435346836749e-01   +7.271020259484637e-01   +1.947032195987697e-01   +8.353912677620706e-01; +4.773638154436954e-01   +4.754653359427374e-01   +1.256759048758621e-01   +1.308286255364434e-01   +5.464118945968077e-01   +4.275809370879972e-01   -1.690377325186140e-01   +1.015879116695686e-01   +3.108155155231822e-01   +4.015162932574165e-01   +4.447113778795242e-01   +2.933900301623073e-01; +4.544733972559188e-01   +2.928624846438156e-01   +6.913765339764871e-01   -7.392458051720018e-02   +4.511245187662922e-01   +3.321885097076191e-01   -3.172033208705392e-02   +4.905993566785783e-01   +5.816212665694833e-01   +6.544340148500765e-01   +6.746005037915018e-01   +1.300649950264025e-01; +2.689345406204702e-01   +6.386729178249403e-01   +5.121625237625503e-01   -6.894905432455639e-02   +1.487767813639103e-01   +2.285854219531074e-01   +5.187267214511461e-01   -8.930749337055931e-04   +3.342807102764486e-01   +3.899711410893277e-02   +5.403341279576070e-01   +2.345516589262246e-01; -9.596064417715270e-03   +2.447383112263869e-01   +4.309702349001144e-02   +1.296317617899439e-01   +3.332091204979684e-01   -1.435989377099611e-01   +4.958907333826962e-01   +2.391911943853403e-01   -1.273108430862185e-01   -9.714346605813937e-02   +6.170554952576962e-01   +2.869875402033154e-01; +9.249031711356684e-01   +5.495995679059212e-01   +4.054542177274927e-01   +4.307098689160364e-01   -1.481869055519814e-01   +4.285660315383246e-01   +3.041243195288023e-01   +5.817159039356135e-01   +1.428449576767271e-01   -1.976378499087314e-01   +1.482175506003325e-01   +5.223182521065562e-01; +1.878844121668117e-01   +8.213319249383034e-01   +6.618657783720133e-02   +7.260434963058313e-01   +5.136427195326225e-01   +3.593649323511751e-01   -1.339333278182499e-01   +4.716365039629203e-01   +5.228258922393912e-01   +7.312933107749230e-01   +3.553457430204356e-01   +8.238676910740943e-01; +7.867973187390168e-01   +4.053502559045960e-03   +7.403298769964727e-01   -4.244346863109313e-02   +7.168184580114089e-01   +1.530036440803507e-01   +6.311647079659808e-01   +1.583421805579886e-01   +4.136838335365933e-01   +4.872170614903860e-02   +6.999692511860885e-01   +3.756212864036794e-03; +8.822694194161716e-02   +3.640586691255312e-01   +4.453383655870963e-01   +3.831671448174471e-01   +7.654545710826441e-01   +3.292143352172146e-01   +5.029389348327840e-01   +7.794364012980642e-01   +9.379584790166038e-01   +3.943558539293985e-01   +5.575086145166398e-01   +1.000000000000000e+00; +5.377917401637878e-01   +2.551503928130619e-01   +2.090803158880559e-01   +3.533691420761589e-01   +1.497558765681691e-01   +1.550505387964317e-01   +2.949789725922742e-01   +2.364710112234176e-01   +8.527085409673222e-01   -3.367864877107850e-02   +6.533568056273251e-01   +3.276899708851197e-01];
L3E_L3I_iGABA_netcon = [-2.909578175028824e-02   +8.164080277335738e-01   +4.365231091115412e-01   +3.002819075865346e-01   +2.993482573177577e-01   -9.330949619258251e-02   +1.527863386000484e-02   +4.834637157313184e-01   +1.847858108942174e-02   +5.176403846356282e-01   +2.024901924886577e-01   +9.546089128240880e-02; +7.628931820379226e-01   +4.007036618353785e-01   +1.000406213027154e-01   +1.535584570407679e-01   +4.301517190777772e-01   +2.310859536871392e-01   +5.464995593655442e-02   +4.694419130722871e-01   +8.777266168198461e-02   +9.100450042124668e-02   +8.646086103443705e-02   +2.560551063886502e-01; +6.649288029775724e-01   -8.669406571594375e-02   -2.211153326545937e-02   +4.049264771061432e-01   +5.749445389861866e-01   +4.133336957368221e-01   +4.967577316760496e-01   +2.793978641037193e-01   -7.711615860288824e-02   +4.674471250310838e-01   -1.405466277313297e-01   -1.107043305022862e-01; +4.364593112077439e-01   +6.278916424670599e-01   +2.285980311090432e-01   +4.949066506499445e-01   +6.605592368426306e-01   +4.461957153806085e-01   +4.182632847848471e-02   +4.267628523018063e-01   +5.445685325196987e-01   +5.245119480033892e-01   +3.414729669373381e-01   +5.347043364448923e-01; +5.253466878120595e-01   +2.641149281989359e-01   +3.863056204678367e-01   +8.809044143125402e-01   +2.432249167182986e-01   +4.928578178800307e-01   -1.012035340737128e-01   +5.683304458104924e-01   +4.994897534605925e-01   +4.970994161457073e-01   +3.722474766874686e-01   +2.455673161767999e-01; +1.482496129966333e-01   +4.160293583748130e-01   -1.938071062367102e-02   -1.172502669291461e-01   +5.257818462625430e-01   +7.095291518835422e-01   +2.401424001043438e-01   +2.692904568549476e-01   +6.392271353126011e-01   +4.367118623104783e-01   +4.484713632936251e-01   +2.775493542624962e-01; +2.585363591932753e-01   +1.154372315396419e-01   +3.434501159954683e-01   +9.069318792552200e-01   +5.419898488503367e-01   +1.080756708300530e-01   +8.158189117206055e-01   +6.237443330352538e-01   +2.027211554176106e-01   +5.188358586215752e-01   +6.386775645941819e-01   -2.244249514857600e-02; +3.268505952098034e-01   +2.101297057917210e-01   +5.465869421804619e-01   +5.563835844341996e-01   +7.027533298924158e-01   +2.263322350822871e-01   +4.217140474222921e-01   +1.213292202254275e-01   +4.375153566505201e-01   +4.387829454081006e-01   +3.053703970423258e-01   +2.643945968335104e-01; +4.182516230793657e-01   +7.569460899425183e-01   +4.049673240559193e-01   +1.796071110590889e-01   +5.506674852714512e-01   +2.916677458033041e-01   +2.206689356405512e-01   +2.441089748366992e-01   +6.076072069713890e-01   +6.356071396979789e-01   +6.439387395459271e-01   +5.415322063604405e-01; -7.047786201218795e-02   -5.520680214087099e-02   +6.444260220444598e-01   +2.066839823543460e-01   +4.558471052579410e-02   +3.988308993688534e-01   +4.478311759125969e-01   +5.692921015285284e-01   +2.682576804426146e-01   +3.016180616623289e-01   +4.661035205567450e-01   +9.858957421476532e-01; +6.087783360541769e-01   +9.513066410855626e-02   +3.462314579337969e-01   +1.596352490676840e-01   +3.676912276981618e-01   +1.101443040889906e-01   +2.247046168347595e-01   +5.109551705983834e-01   +1.196814900353438e-01   +6.415679077181167e-01   +1.696239134698364e-01   +2.110614880385819e-01; +3.726601114912840e-01   +4.861199391609587e-01   +4.480217295613838e-02   +7.903140439228363e-01   +7.693100083644583e-01   +4.905129836111231e-01   +5.592619334071804e-01   +8.136066892833699e-02   -1.114611105203864e-03   +1.611832918882801e-01   +4.196029741811820e-01   +8.226730272721033e-02];
L2E_Input1_iAMPA_netcon = [+7.178169155555402e-01   +6.185540432046396e-01   +9.074110322533797e-01   +8.880056332213064e-01   +8.416437555623864e-01   +9.595589024441612e-01   +8.073604379510511e-01   +7.790771184516254e-01];
L2I_Input2_iAMPA_netcon = [+8.406718713612026e-01   +6.277444513440611e-01   +1.000000000000000e+00   +6.389633921162342e-01   +5.226415484008612e-01   +9.069108357491571e-01   +7.497452225396662e-01   +7.200715808523118e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
