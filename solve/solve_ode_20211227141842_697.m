function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.099855366201851e-02   +3.024875663727751e-02   +8.544405883044671e-02   +5.454393124280731e-02   -2.181228337758377e-02   -1.275316800734899e-01   +1.939677840125976e-02   -8.437496607488748e-02   +8.213964679950800e-02   -8.083677477461761e-02   +9.422748149326461e-02   +1.528582714658428e-01   +7.115385423903677e-02   -5.036258571261344e-02   -8.948051667372081e-03   +5.440873133116040e-02; -5.611015703649185e-02   +7.217574935162305e-02   -4.588336738208108e-02   +8.753896464399352e-02   -4.561232628459813e-02   +5.459411028764522e-02   -4.102068634419318e-03   +6.809610558557422e-03   -1.157643048008379e-01   -2.810273019862221e-02   -5.995701857825599e-02   +6.489486468614532e-02   +4.596699251351671e-02   +9.396486780576289e-04   -6.007112023938631e-02   +6.968821424970430e-02; +1.712294870960519e-02   -1.234304497301561e-01   +7.956441851800977e-02   +8.836104386171183e-02   -2.591871043498479e-02   -7.565707553088269e-02   -1.422876806863418e-01   -1.663591915529875e-01   -1.600175534624825e-01   +1.911425191133108e-02   +1.252961581108857e-01   -3.621123361080221e-02   +1.369343837764998e-01   -1.213700172753231e-01   +2.043870421506416e-01   +5.593521023328087e-02; +2.429766853341934e-02   -2.810097463592452e-02   +1.009335760569958e-02   +7.674267236258480e-03   +8.830060064602043e-03   +1.424036682105185e-03   +5.142522383146073e-02   +2.303384412529468e-02   -1.538823800072664e-01   -1.214517180155207e-01   +1.736560439136891e-02   +8.766836710486237e-02   +1.114663432378085e-01   +4.851716670439083e-02   +9.373144859426560e-02   +9.488584891668712e-03; -3.645927187514660e-03   -2.742778147269277e-02   -1.520580586098578e-01   +2.195858323602330e-02   -1.517455835119965e-01   -1.424456541309089e-04   +1.052567481898509e-01   +9.987849509110638e-02   +1.195583161731798e-01   -1.302206856557331e-01   +1.952063728386092e-02   +9.757953996795773e-02   -2.836118266346985e-02   +9.548057123692617e-02   -4.449398439219802e-02   -2.402588211128448e-02; -1.194724901969332e-01   +1.371626402499030e-01   +1.268947413364931e-01   -1.048507250132556e-01   +8.315136751694283e-02   +1.073428951615337e-01   -2.586795957564279e-02   -7.379933281497802e-02   +1.590573811589684e-02   -3.984107028006262e-02   -1.173015066561445e-02   -7.495739486073003e-02   +1.309524575809443e-01   -8.782359990816851e-02   -1.287135221555355e-01   +1.030749146732239e-01; +1.622006908803570e-02   +1.201015385068704e-01   -1.682991491118552e-01   -1.360045878899885e-01   -1.292850496460038e-01   -6.018505128913926e-02   +7.552563308440834e-03   -4.164523379505408e-02   +9.438700783736101e-02   -1.245546014920086e-02   +6.445245180727796e-02   +8.147037809072905e-02   +8.004712941707785e-02   -6.349720908954727e-02   +1.202013741221831e-01   +9.164947217520003e-02; -4.854282186296507e-02   +1.423536634430863e-01   +1.273650599035336e-01   -1.034905279374770e-01   +2.905776727221768e-04   -5.517245762746527e-02   +9.434468643375502e-02   +1.001417836889669e-01   -7.276449855184661e-02   +3.284651756792792e-02   +7.835202606719179e-02   -7.828173642952289e-02   +7.604481534785626e-02   +5.939387700482146e-02   +4.678056045521409e-02   +7.665821366417401e-02; -1.024836009669360e-01   -9.148582786408475e-02   +1.695419368017427e-01   +6.190435674582363e-02   -4.955062704665185e-02   -4.012122745415206e-02   +1.391857757346576e-01   -5.085227725209310e-02   -1.277810076138131e-01   +3.893463095441498e-03   +5.861061851658547e-03   -4.168342186340804e-02   +1.828481302850323e-01   +1.359605874991315e-01   +2.851433944233402e-03   +4.882151088611381e-02; +4.136798350208859e-02   -5.683905233537052e-02   -4.689529226311483e-02   +1.684521286125712e-01   +1.827632974551693e-01   -6.121824348598886e-02   -4.989414580923766e-02   -8.106656109071644e-02   +2.242564935319150e-02   -3.133219270764024e-02   -7.358308513573326e-02   +3.618705402983927e-02   +1.319161755958227e-01   +1.557483004346253e-01   -9.913147075620861e-02   -1.924045556706075e-01; +1.557886882256977e-01   +1.597274836936626e-02   -1.030896170470749e-02   +5.941733232545551e-02   +2.436577503848385e-02   +1.993734602681358e-01   -5.334080499147228e-02   -1.040702210456164e-01   +1.385596553991228e-01   -8.626239159183724e-02   +2.558911162789430e-02   -4.335841296096743e-02   -9.988637479679724e-02   -1.139629022079247e-01   -1.833040947014568e-01   +4.282841653125910e-02; +2.794683613518957e-02   -1.576774689317728e-01   -2.303803147196684e-02   -5.298286646604008e-02   -9.727644039302777e-02   -3.841640219177003e-02   +7.804559888899495e-02   +1.081738890591700e-01   -1.054740041527523e-01   +7.336337752409741e-02   +5.347729343989840e-02   +5.986752396996296e-02   -1.122402528851145e-01   -2.726232569348247e-02   +8.227793674444592e-02   +3.035730442348164e-02; +2.315568540486056e-02   -3.778763237520233e-02   +1.307344829399696e-02   -4.540320749415499e-03   -4.506707790596686e-02   -1.052347354174184e-01   +1.146063567970617e-01   -1.196699214230560e-01   +6.092077106523355e-02   -1.827215701245769e-01   +4.300406801682995e-02   +1.840733722466606e-02   +6.813255054038986e-02   +1.042239472665007e-01   -3.945081578030213e-02   -3.925065650129553e-02; -2.149419093302267e-02   -1.161039479547896e-02   -5.870750504744392e-03   +3.069848121931822e-02   +1.173416151188901e-01   -1.219601626755083e-01   +8.064049042731769e-02   +6.968312529917102e-02   +1.106057663260346e-01   -4.058317026001153e-02   -5.514726669126772e-02   -8.589887186123882e-02   -2.102741022063514e-02   -1.360798400564465e-01   +1.634800139918278e-01   -2.860232986798466e-02; +6.812163591305961e-02   -4.454424728609045e-02   +2.223538458857008e-02   +2.037730682209708e-02   +1.506590419018279e-01   -1.239951612771999e-01   +1.184320185616809e-01   +8.071757256284250e-02   -1.078843896303552e-02   +5.182040142430706e-02   +6.979881285182028e-03   +6.040009463828126e-03   +7.217712094477710e-02   -1.589188532228520e-01   -2.080149967527863e-01   -2.389977838536279e-01; -6.816167094899675e-02   +4.626806723159081e-02   +3.711121767495319e-03   -1.097247632703258e-01   -1.141746843982648e-01   -4.606443332096995e-02   -7.752997667703475e-02   -1.647214358242506e-01   -6.403415662521721e-02   -2.018834956429248e-02   -1.542851358989751e-01   +9.995107604268769e-02   -3.404330004886456e-02   -5.533966192637169e-02   -9.627656588291027e-02   +5.972053805161069e-02];
L1E_L1I_iGABA_netcon = [-3.772131797441509e-02   +1.477233456398571e-02   -7.615724460281423e-02   +1.997494489207903e-01   -6.481885242565263e-02   -1.222070928935531e-01   -1.412864367650781e-01   -2.266780434003305e-02   +8.658363378076142e-02   -1.003005075751858e-01   -3.993257566418308e-02   -1.206090063215554e-01   +3.260755363176557e-02   -9.784231793063181e-02   -1.979906884591295e-02   -1.056982437934804e-01; -3.180277025273473e-02   +5.119991853384771e-03   -3.522395308219652e-02   +4.610680558195773e-02   +2.239563046657762e-01   -1.285887239459781e-01   -8.032045994741022e-02   -3.780688440677735e-02   +3.477248557627676e-02   -4.486603365247815e-02   -1.103573130311149e-01   +5.307106012957764e-02   +2.087880194350451e-02   +2.676523896640472e-02   -3.706916770611629e-02   -2.610443210917920e-02; +3.225186904428800e-02   +1.948811509629156e-01   -2.186503026677882e-02   +6.230582922019205e-02   -4.353267480446232e-02   +1.000318708692206e-01   -5.962025636922614e-02   +1.397719617439238e-01   -1.419468214157503e-01   -6.789343370455436e-02   +8.386935415490997e-02   -2.304964040240837e-01   +4.262430312945766e-02   +2.639415310822181e-03   +5.999892714396618e-02   +2.943193383511719e-02; +2.506722139442108e-02   -3.207969689476548e-02   -1.077086324978670e-02   -3.725244036059332e-02   -6.457246274414854e-04   -5.257255226869564e-02   +6.311639252483474e-03   +8.462568331960360e-02   -8.608193966431579e-02   -5.267966532489143e-02   +1.902676437787567e-01   -7.084396486012097e-03   -1.814419736667733e-01   -2.343076769945876e-02   +1.759916038838653e-02   -8.007143473010650e-02; -2.236613068418509e-01   -1.525084898474288e-02   -1.522350691394392e-01   -9.523547226555282e-02   +3.703948601421989e-02   +2.826553638749199e-02   +1.390119771999191e-01   +2.194874602363858e-01   +1.616473123250136e-01   +4.915149578899628e-02   -1.205994549162023e-01   +3.158429784296179e-03   +1.118289004586463e-01   +6.094686253563892e-02   -3.345635721512893e-02   +1.341659672217481e-02; +1.606220416084835e-01   +7.028669107792031e-02   +8.539002094678870e-02   +5.010221737807541e-02   -9.285329256672949e-03   -2.580874253127240e-03   +4.471554035761952e-02   -6.306055168648284e-02   -6.001290435490491e-02   -1.787528639882816e-01   +2.085747286392347e-02   -5.247179779063580e-02   +1.589718316788009e-03   +4.323175867586578e-02   +1.183311129264182e-01   +1.723923612343700e-02; +7.614846521545881e-03   +1.599859619151419e-02   -1.330619116460931e-01   +1.312060267373796e-01   -1.201363375703033e-01   +2.300785496289675e-01   -4.228598881444887e-02   +5.666750225585135e-02   -8.622639775017563e-02   +1.116172626443932e-01   -3.492406779652622e-02   +5.435043855122035e-02   -5.155252206934294e-02   -1.045803906173331e-01   -5.056465741146341e-02   +6.604831275069128e-02; +6.414546122328903e-02   -7.608715744062450e-02   -7.493165220567474e-02   -9.216787416674804e-02   -1.100529001237789e-01   -7.941518893140626e-02   +1.122564560192062e-01   +2.167188420349752e-02   -6.580772645119267e-03   +5.039519895364293e-03   -1.716576304235870e-02   +5.488429361931563e-03   -3.311421533493730e-02   +7.075084272479927e-02   +5.278999854118892e-02   +1.657203951770582e-01; -9.674181445780777e-02   -3.431622912971803e-02   +1.072718352858560e-01   +7.523521625359834e-02   +9.814050097048109e-02   -6.783526891715100e-02   +8.038970592845229e-02   +9.447754451878623e-02   -1.353713622434453e-01   -1.134686712931625e-01   -6.934724076332804e-02   +6.771308163786511e-03   +5.885794865327074e-02   +1.248980104405358e-01   +1.808311485650827e-01   -7.872682174418309e-04; -4.543101919591871e-02   -8.263956833392963e-02   -7.917561204667813e-02   +2.263333805930932e-01   -9.990716112685566e-02   +1.819885318472593e-01   -4.790052344747360e-02   +1.441200608339565e-03   -9.858074250404986e-02   -3.803483385438599e-02   -1.022564887140399e-01   -3.476043265210974e-02   +1.134624508286604e-02   +1.037122505011567e-01   -3.328540439295914e-02   -1.050823117668030e-01; -1.760902463710171e-01   -1.704970025765133e-01   -1.685172104031255e-02   -1.333758105458522e-01   -9.775395698377679e-02   -2.089276061333795e-01   -1.181095330516452e-02   -9.440074411035798e-02   -1.192976216969581e-02   -8.762322141565702e-02   -1.312274580981338e-02   -1.054763578700879e-01   -3.867539360840035e-02   +4.324129910417386e-02   -2.600290811368103e-02   -3.700134240666981e-03; -9.207556541741065e-02   +1.674029333440527e-01   -9.168602635069860e-02   -4.962126218891093e-02   +8.156207853841362e-02   -3.129390411013078e-02   -8.121267609827683e-02   -9.580587246503072e-02   +1.204292211250119e-01   +1.756268872856903e-03   -1.292348395085428e-01   -1.224766473602714e-01   +5.024826018839934e-02   -6.142223338707024e-02   -1.328020731080500e-02   +1.081704645918977e-01; -6.179935796552118e-02   -3.221658827352903e-02   +5.822592065407613e-03   +1.022927092839966e-01   +8.616096313635346e-02   +1.110061380953279e-01   -1.598487292283143e-01   -2.963784581645635e-02   -1.220384788577249e-01   -1.206596432378148e-02   +6.756901700334975e-02   -4.092373692839536e-03   -1.578108936541056e-01   -1.142035684615731e-01   -1.119728862863285e-01   -7.078910120411125e-02; -3.187386054278224e-02   -9.497903134195822e-02   +3.892033183169740e-02   +5.551901317658216e-02   -1.429233775013919e-01   -1.202417623834401e-01   -2.970423764728948e-02   -9.928526845808715e-02   +1.073203193874752e-01   -7.324535032977066e-02   -1.385590909051346e-01   +7.006905447319635e-02   +9.117792126758092e-02   -9.022639603582672e-03   -6.923605350266650e-03   +9.458966618133313e-02; -6.394284833969711e-02   -1.340847966858454e-01   +5.797799493698456e-02   +8.318424087398997e-02   +2.689110201593548e-02   +4.905774419385225e-02   +9.869415224304037e-02   -5.514374752479952e-02   +1.183573973119866e-01   +2.001536513571955e-02   -3.673629620371064e-02   +2.720250224959852e-02   +1.127724356675191e-01   -1.531116233684216e-01   -4.394563237252250e-02   -1.653245693867418e-01; +4.907284215511921e-02   +1.479687965559813e-01   +2.003924768367682e-01   -1.369531333128667e-01   +6.711243975521769e-02   -1.498754469504824e-01   -2.007407863204814e-03   -5.013334182110359e-02   -4.024294406564700e-02   -6.161516039024484e-02   -2.316412802255736e-02   -8.929567956403123e-02   -3.143237334814913e-02   -3.066607669355454e-02   -1.633104098879185e-02   -1.218192442582034e-02];
L2I_L1I_iGABA_netcon = [-4.407889807986019e-02   -7.001862065663092e-02   -9.893790929886834e-02   -1.282353194497741e-01   -7.428628950498439e-02   -3.150069239472063e-02   +1.012365491262052e-01   -1.178709147267821e-01; -8.096105449412208e-02   -4.130947689826035e-02   -7.232103141322788e-02   -3.179881085380841e-02   +2.414725806625589e-02   -1.577710062469754e-02   +3.386980244506667e-02   -6.012674784038744e-02; -1.402953530568576e-01   +6.095516848140483e-02   -6.108956570122029e-02   -1.042135592213252e-01   +2.330925622004483e-01   -6.474890859772391e-02   -7.697039098162152e-02   -1.440498788438140e-01; -1.844674991931496e-01   +5.753598088883296e-02   -2.508661604920507e-01   +5.901163728586104e-03   -2.597677347518767e-02   -2.146278103143839e-02   -3.445514797434457e-02   -1.053272992797454e-01; -7.454604921583736e-02   -3.532475567725699e-02   -8.248714868218752e-02   +1.353009843471170e-01   +3.386031522027778e-02   +9.439934554166315e-02   -6.532379188703759e-02   +1.241168514894453e-01; +1.302403434051383e-01   +1.770042999570724e-02   +3.461835221819751e-02   -2.380534324655315e-02   +1.797483535546105e-01   +9.544969308929048e-02   -1.388067456979645e-01   -1.996096185246629e-02; -9.198663376444767e-02   +1.034864166830663e-01   -1.787939268039909e-01   +1.061065120870883e-02   -5.068598384167038e-02   +1.266650623343042e-02   +7.930160844546917e-02   +2.923378063255568e-02; +3.966612746845419e-02   -6.421135008662208e-02   -1.604803716766546e-01   +2.312346409532623e-02   +3.595758103223043e-02   +7.315960740767175e-02   -1.157072188714060e-01   +9.949641316948953e-02; -1.552961135669901e-01   -1.021240653315278e-01   +1.074876422420957e-01   +1.198087323135367e-01   +1.341629223709459e-02   -1.459418236604553e-02   +1.123130141718168e-01   +1.520022247653401e-01; -5.127340055097424e-02   -3.467351728690907e-02   +2.718764979872090e-02   -4.562003165139083e-02   -9.443178912215780e-02   +1.744141757885744e-01   +7.738747642755971e-02   -1.363027899087516e-01; -1.279289423435629e-01   +7.873998495706676e-02   +3.842323735196095e-02   +2.057933167393796e-01   -1.499296553241087e-01   -1.367391291075761e-01   +1.960205140991678e-03   +1.304758142410027e-01; +1.052084109270633e-01   +9.275719228642534e-02   -5.817068018208396e-02   -3.669672005856908e-02   -9.715989644019279e-02   +1.471383788987173e-01   -3.478073244167953e-02   +5.692482148266099e-02; -5.941498891369204e-02   +1.914913283640802e-02   -6.670358167464321e-02   +2.337679745920017e-02   -1.511298889424350e-02   +1.762827672805327e-01   -1.228039317597559e-02   -7.768797615390147e-02; +1.576565065798440e-01   -9.141344408731070e-02   +5.381040926570523e-02   +1.180996835255599e-01   -1.507442105926348e-01   +8.694510389890873e-02   -9.471862466400147e-02   +8.589688121642700e-02; -1.561560968280541e-02   -1.310289671098222e-01   +5.711323892191193e-02   -8.885464582227175e-02   +5.663553854727109e-03   +1.671350849226862e-01   -6.015085894010160e-02   +1.160746603748306e-02; -1.727411517358538e-01   -1.540415275859651e-04   -4.682765603588891e-02   -7.138775442847473e-02   -3.581317330880516e-02   +1.451844334456406e-02   +4.109508385361706e-02   -1.002160373093253e-03];
L1I_L2I_iGABA_netcon = [-4.141022152135704e-02   -8.295557014042267e-02   +7.196337671529271e-02   -3.870035462235305e-02   -1.484268053017023e-01   -4.114036096989560e-03   -3.853953290864854e-02   +2.196275700281355e-01   +8.885432425286166e-02   +9.049698699302311e-03   +3.623980722817191e-02   +6.337604546116216e-02   -6.584982338214247e-02   +3.999955269585637e-02   -1.063953175314645e-01   +1.037337706980154e-02; -1.615420009486639e-01   +3.296552176629532e-02   -8.799740497962276e-02   -2.690619582783486e-02   -1.024531511426368e-01   -1.544141187724735e-01   -6.312730712747087e-02   +1.944923726365312e-01   -7.468378670898965e-02   +5.585979989689075e-02   -1.254640500734591e-01   -2.104728792916438e-01   +4.027866958227534e-02   +2.603020453286383e-02   -3.620759070863159e-02   +8.944025194130513e-02; +2.849467406412371e-03   +8.596436277330208e-02   +1.801585029454747e-02   -8.993457804664982e-02   +1.338656518781957e-01   +4.946074071327469e-02   -1.261086916577771e-02   +1.952304980871772e-02   +3.812111981808514e-02   -9.439919044721350e-02   -1.370416065900648e-02   +7.992039477295868e-02   -9.777140436053575e-03   +1.556920020302628e-01   -7.611847636821234e-02   -2.308930209012919e-03; -4.567356142600488e-02   -1.048192624462010e-01   +4.857394575726372e-03   +6.507636979655775e-02   -1.930632332562968e-01   +6.282831994821554e-02   -7.226091877237978e-02   +8.002962584348218e-03   +4.777374478049307e-02   -1.366384890164192e-01   -4.971584563882122e-02   +8.265619738699460e-02   -7.199951778919442e-02   -2.480599149738865e-03   +8.426109443509799e-02   -2.314139340717086e-01; +1.090542508087432e-01   -3.485944139986033e-02   +7.771358979980772e-02   -4.025207534550122e-02   +5.105364252831043e-02   +1.149011557857862e-01   -1.444084613921861e-02   -1.079864276738217e-01   -1.077156693055390e-01   +4.776530411980823e-02   -1.221171850112462e-02   -5.138044492036026e-02   +4.670711728354243e-02   +3.657166624754071e-02   -1.117600420417441e-02   -1.438354072580074e-02; -1.940437303282496e-01   -6.169160973909418e-02   -7.135835461704379e-03   +6.659299682115005e-02   -4.473387677133612e-02   +1.135826110203711e-01   +1.754040072429395e-02   +1.201742169989316e-01   -9.189349236707130e-02   +3.200180775428413e-02   +3.662710049814145e-02   -4.010055127896446e-02   +6.107692618577998e-02   +9.040019995517729e-02   -9.474916534095826e-02   -1.910788289852858e-01; -1.081053202311985e-01   +3.754335272005702e-02   -2.872122183010083e-02   -8.376784690278630e-02   +1.974636827244159e-01   +1.243489129164089e-01   +3.123815700770354e-02   +2.085240863225433e-01   -1.072262366027483e-01   -1.493847333193473e-01   -9.526793795782323e-02   +1.144485436053922e-01   +6.456353238194978e-02   -2.037167037443685e-02   +1.432622943953272e-01   +3.059527540326979e-02; +5.016802822141723e-02   -1.487485124023724e-01   +2.779928377457380e-02   +1.680791139008880e-02   -8.302953333869771e-02   -1.328744247002621e-02   +7.585647472650492e-02   -7.477243167578593e-02   +2.566850476238118e-02   +1.191223789185574e-01   -3.870183657823469e-02   -1.245387936196858e-03   -6.710835974571003e-02   -5.244833445813352e-02   +2.353898523555041e-02   -1.095159374184309e-01];
L2E_L1E_iAMPA_netcon = [-1.650029855289784e-01   +6.969206215901431e-02   -4.173169495112262e-02   +1.166355606325577e-01   +2.352718540069159e-02   -1.675881243964360e-01   +5.469346809344518e-02   +6.820243280370265e-02; -1.128247792454006e-02   -7.929502738807645e-02   -5.497640062656917e-02   +3.068502539382016e-02   -3.883658609326258e-02   -9.537040743022246e-02   +8.599716633548087e-02   +1.350694680646007e-02; +1.571045927240726e-01   -1.365487211949790e-01   -1.152470124047871e-01   +4.150280771275609e-02   -9.215160710672775e-02   -8.536859406878891e-02   +1.065263200684540e-01   +4.593592906338987e-02; +9.860366611413113e-02   +1.243694660716019e-01   +6.489260345945845e-02   -5.310149271265377e-03   -7.461702095306984e-02   +1.241946875902417e-01   -4.870040277485756e-03   +3.160111911234731e-02; +6.813576759119425e-02   +9.232755594126324e-02   +8.791766666783468e-04   -3.726489425894056e-02   -1.298219351500963e-01   -3.514573239393870e-02   +1.559188545687009e-01   -3.120770807851657e-02; +1.209826280903920e-01   -1.330599933119141e-01   +1.698000952927572e-02   -1.090004820432218e-01   -8.689670079618293e-02   -3.510442468709327e-02   -3.093253631092361e-02   +1.607494977454651e-01; +1.374012765853919e-02   -4.036813648283887e-02   -8.177266341562982e-02   -3.739141223431769e-02   +2.886170129951558e-02   -8.010189219519037e-02   -1.908508394128984e-02   +1.580696711213623e-01; +1.368769674566888e-01   +5.057537797599015e-02   +6.050363924339137e-02   +2.502635350297241e-02   +1.243674772460702e-01   -5.566862568286120e-02   +1.146753000293424e-01   +5.491939193252252e-02; -6.734941111552682e-03   -2.836561182409688e-01   -7.447432608381879e-02   +1.444024733349147e-02   +1.300445672723927e-01   +1.017612430967386e-02   +8.103658140039662e-02   -1.963080660090215e-01; +1.058934698472229e-01   -1.578532059565678e-01   -7.731976406996911e-02   -1.255026933022156e-02   +3.707397137502166e-02   -4.072382579335580e-02   +2.361050974337636e-02   -6.302727313681311e-02; +1.493836222437789e-01   -1.720664459350572e-02   -9.140330299029749e-03   -5.926704347281622e-02   +2.023591256385082e-01   -1.194163887285983e-01   -1.345374776827898e-02   +6.337920589468221e-02; -3.350329831086754e-02   -1.417684707862867e-02   -2.292748863909634e-02   -9.843223659274933e-02   -1.759000484264309e-01   +4.867065513013791e-02   -2.313352252776302e-02   -1.330779879509209e-01; +6.029567475339878e-02   +2.947250004755804e-02   -1.571004614723790e-02   -1.552467687545198e-01   -4.005307411646992e-02   -3.745408415682072e-02   -4.085154876343618e-02   +1.331754658915983e-01; -1.063673566267330e-01   +6.848586954992950e-02   -9.852260643130929e-02   -8.217548107836485e-02   +5.561336133053191e-02   -6.280662495366003e-02   -2.998998075144686e-03   -9.930289163704192e-02; +1.922826416531500e-02   +5.328871822274314e-02   +4.596212608527565e-02   +9.226386614284567e-02   +2.781347777734609e-02   -8.884870306584938e-02   -1.161614591817294e-02   +3.411248497579441e-03; -1.400948611845592e-01   -5.787706345030809e-03   -4.062486724183684e-02   +5.696361856562013e-02   -1.862195210700230e-02   +2.050244481152026e-01   +7.976272816722939e-02   -1.367285102790176e-01];
L1E_L2E_iAMPA_netcon = [-7.451058814005188e-02   +9.106923998236299e-02   -1.214997482203086e-01   -1.342341064869804e-02   +5.474406405617452e-02   +1.105531422072158e-01   -3.949054793787737e-02   -5.511056278643172e-02   -9.696321174641595e-02   +2.008191165453475e-02   +1.961784563232206e-01   -6.365068451286759e-02   -1.648907694562431e-02   -4.844992739845819e-02   +8.060915494285088e-02   -1.280208366442366e-01; -3.219552150973002e-02   -8.601174339614825e-03   -5.772793402925592e-02   +9.585688673717656e-02   +1.660767456311682e-01   -5.431855349716587e-03   +4.934744309865156e-03   +1.145441410267263e-01   +1.029185865864033e-01   -8.835568701623080e-02   +7.355019010173217e-03   +2.206623416298231e-02   +1.683316204818681e-02   -7.725780148769934e-02   -1.099282337425217e-01   -1.668074003755843e-01; -5.779062881645735e-02   +1.450670081447567e-02   +8.420849647961172e-02   +1.316868223430141e-02   -6.377352940681720e-02   +3.245335582241339e-02   -1.535669083450026e-02   -5.052054264462481e-03   -1.797595494871840e-01   -6.158028529388648e-02   +8.734972551765344e-02   -4.593381623700654e-02   +7.771062354028177e-03   +2.248152674792208e-01   -1.698769514529558e-02   -1.365749514298912e-01; +1.016892174575935e-01   -5.421803152830625e-02   -4.190609277982665e-02   +1.247087010581096e-01   -4.314397834812637e-02   -1.414399519063441e-02   +1.223280858102775e-02   -1.776654350673842e-01   -1.968813204058097e-02   -1.281693531439398e-01   -5.707397314830316e-02   +6.704665003764716e-02   +2.427349663902577e-02   +2.201436734209308e-02   -1.270797273824665e-01   +2.997201645722377e-02; +2.297875466573692e-01   -1.012991240749311e-01   -1.017073182788035e-02   -2.142062081831381e-02   +1.386310151574426e-02   +1.027715832682495e-02   -1.100485690745243e-01   +1.494880977056725e-03   +7.437433792276031e-03   +1.012942881462946e-02   +1.247351478048766e-01   -1.195954693130567e-01   -5.261394451686322e-02   +2.418584334061436e-02   +1.289581085028200e-01   -1.084749618383896e-01; +1.030430135465166e-01   -4.895291336199236e-02   +7.342322871659687e-02   +8.991521497301525e-02   -2.608732716214401e-02   +1.572800292494193e-01   +3.023350048559586e-02   -7.980669032994753e-02   -1.978710601955998e-01   -4.541910864457498e-02   -1.426755978940062e-01   +5.329429438195352e-02   +9.828656206819124e-02   +1.066563647638146e-02   +1.564001030601694e-01   -1.788268133386536e-02; -8.249986229312546e-02   +4.656816317024191e-02   +1.076609242577384e-01   +6.969613919268154e-03   -8.601936796497259e-02   +7.113997181396779e-02   -1.118942646238097e-01   -9.023172201553446e-02   -4.127164963450863e-02   -1.310972029876542e-01   +1.038879861944597e-01   -2.834400995455556e-02   +2.288406452737258e-02   +7.955838589988595e-02   -4.756623488326327e-02   -2.112068452338206e-03; -1.089228439770994e-01   -1.025838595306950e-01   +4.778750693507518e-02   -3.237564302406166e-02   -4.166498356543110e-02   -7.032133748334858e-02   +1.773003030252185e-02   +2.268083620063789e-02   -8.383232778108159e-02   +3.422171652940520e-02   +1.361391717246266e-01   +1.066578384688256e-01   +9.900803785405150e-02   -1.159944179129318e-01   +2.498648657665615e-03   +1.375637920638880e-01];
L2I_L2E_iAMPA_netcon = [+2.003554779441153e-01   -1.064282249400864e-01   -4.927764529883154e-03   -7.310969425126848e-02   +4.892939812310339e-02   +3.956525241125838e-02   +1.625887358235165e-02   -9.635519174435303e-02; -1.541569098292051e-03   +1.441355845292561e-02   -9.996842651439919e-02   +1.090961534628668e-01   -1.298852040258606e-01   -1.903788241331346e-02   +2.124604148856191e-02   +1.800486956924326e-02; -2.473368331378813e-02   +6.106782759159468e-02   -9.412543647267964e-02   -2.601520414989945e-02   -1.603614194733468e-01   +9.388656252948488e-02   +3.606716337675014e-02   -3.532721624458162e-02; +9.998584385348992e-02   -8.717584430789656e-02   -7.629380997568005e-03   +8.580226567423885e-02   -6.958169519585744e-02   +1.103118547774194e-01   +2.449456496932105e-02   -9.409848672972121e-02; -6.599472616775415e-02   +9.292033277516396e-02   +2.584621294602715e-02   +7.793681853735075e-03   +2.682613646614751e-02   +9.289301812186150e-02   +2.104522804142500e-01   +1.671474403125217e-01; +5.078892869775996e-02   -1.245285623728532e-01   -6.261924232775286e-02   +1.578582162905547e-01   +6.168915971564413e-02   -1.242598003530167e-01   -8.875074034114418e-02   -3.372482679505211e-02; -1.135341237389293e-01   +3.680609326462668e-02   +7.161829122078911e-02   -1.995486821296910e-02   -9.707956342791410e-02   +8.537147694986182e-02   -2.217809284381230e-02   +3.212471630164047e-02; -1.201447722372382e-01   -6.528805097091406e-02   +9.206728918210184e-02   +2.639355043679275e-03   +9.849727612623123e-02   -5.546929545871972e-02   -7.843216508703718e-02   -3.939842441656902e-02];
L2E_L2I_iGABA_netcon = [-1.773649038121532e-02   -7.450713791418651e-02   +1.358768927578314e-02   +1.415338477625415e-01   -4.363109609875216e-02   -5.102847187015566e-02   +4.225316329341822e-02   -2.824900144190045e-02; +1.624484881441650e-01   -1.613148170321387e-01   +1.582839666473107e-01   -2.193308685401443e-02   +6.020537623972487e-02   -4.775273179203711e-02   -4.053256597294846e-03   +1.273787719234978e-01; -1.831241108764191e-01   +2.316070468308032e-01   -1.912803322928779e-02   +9.894614613130509e-02   +1.033777483922999e-01   -1.100553118199211e-01   +1.017662506958663e-01   -4.365404517249991e-02; +7.325008372037949e-02   +2.878084210158873e-02   +1.049443697375158e-01   -1.322890972069437e-01   +3.361882953998054e-02   -1.259768035377612e-01   +5.116337864297692e-02   -3.161333333684204e-02; -1.183037464134801e-01   -1.066630275018988e-01   -7.459281144307370e-02   +2.143351671709355e-02   -9.849247498077278e-03   -1.899934928258204e-02   -2.279120648677629e-02   +6.830949103665179e-02; -2.454349925545842e-02   -1.445216852602492e-01   +7.501108497547088e-02   +3.735329146183909e-02   -1.298277658688969e-02   +4.767179773422971e-02   -5.184989782609570e-02   -1.964355628064513e-03; +4.635211335163075e-02   -2.324557750863114e-02   +1.188713825069820e-01   +1.495420529909723e-01   +4.725399061859975e-02   +1.123352342047156e-01   +9.770176235880863e-02   +6.808919683388326e-02; -6.390341707278679e-02   +1.888367468150889e-01   +4.678995583956890e-03   +4.010027786766790e-02   -1.260070344021244e-01   -4.615646229436293e-02   -6.797625857002111e-02   +1.503051177347029e-02];
L3E_L2E_iAMPA_netcon = [-8.511302259064331e-02   +1.725625287276620e-02   +5.197335841073586e-02   -6.029194538007531e-02   +1.389090960126124e-01   +2.264927004023724e-02   -3.362552282094469e-02   -4.092016125706600e-02   -1.339987736347396e-01   -5.853551074125424e-02   +1.150855482338213e-01   +7.737110953862926e-02; +3.129373989034921e-02   -5.738351239028679e-02   +1.081158176407415e-01   -5.331195048413766e-02   +9.506989995128021e-02   -1.389890006804986e-01   +1.692782429011843e-02   -2.985177009771179e-02   +1.188499595249996e-01   +3.357202173370894e-02   -1.089617218303043e-01   -1.249900823434090e-01; +9.841882555387288e-02   +2.420447957825406e-02   -9.070829444093918e-02   -1.562160345810592e-02   +1.379392363192372e-01   +1.142123638322619e-02   -4.119128314122251e-02   -7.094226892492397e-02   -1.451066395630826e-01   -7.337698102632645e-02   -1.311469632339350e-01   -8.182962122601856e-02; +5.534701383451435e-02   -3.888901713258461e-02   +6.647710119376027e-02   -7.279924072850943e-02   +6.333723443513697e-03   +1.445701826308054e-01   -1.676407712515821e-03   +1.501671659050332e-01   -1.216738668108307e-02   +9.031235911450450e-02   -2.137170209421126e-02   +1.967939054623769e-02; +1.352323882812742e-01   +3.558153675843185e-02   -1.208061809334304e-01   -1.088699284197259e-01   +1.418194279843801e-02   +3.464922298948475e-02   -1.578010788901096e-02   -1.278606086476344e-01   +1.064223010375642e-01   +1.056814092911992e-02   +5.679725467136015e-02   +2.828820574036842e-02; -1.809011207057732e-01   +1.254752130441006e-01   -2.693728596226047e-02   +6.154537843394155e-02   +7.019614505513605e-02   +1.215641609199777e-01   -1.230010346290077e-02   -1.117807274889852e-02   +4.761077300075928e-02   +3.871995937634704e-02   +1.135240290970616e-01   -9.862406345607590e-02; -5.570884260193180e-02   -9.408036355373117e-02   +5.383439442633132e-02   -1.223385564360063e-01   +1.659698590206211e-01   -9.404385846943841e-02   +9.240008878456298e-02   -1.801189025182799e-02   -6.023073248204378e-02   +7.757050341662144e-02   -2.064190523657828e-03   +3.407149962432497e-02; -2.066052333405865e-01   -1.134637184694322e-01   +2.769576591248197e-02   +9.429029018716954e-03   +5.353415827964281e-03   -2.536748301610336e-02   +1.072908734726122e-01   +1.412696369877786e-01   -4.150210505681524e-03   +7.757902909784573e-03   -5.474159984953876e-03   -1.606125259127181e-01];
L3I_L2I_iGABA_netcon = [+9.277950732058017e-02   -8.378137339171644e-02   -3.003144378398459e-02   -1.589778461024948e-02   -5.858639668106413e-02   +5.609503496353635e-02   +8.171348648186033e-02   -3.265787745283913e-02   +3.428745402314371e-02   -9.335263345236854e-02   +9.475512619311642e-02   +7.784465025548276e-03; +1.340088822037397e-01   +1.041396562137307e-01   +3.578587291345263e-02   -7.908802209275290e-02   -3.277704217772939e-02   -5.238746717803985e-02   +4.846506194146295e-02   +9.730227978765278e-02   +6.715661357370772e-02   +3.317831860427645e-02   +1.056040107168423e-01   -1.570860294404153e-02; -1.523265234006410e-01   -1.583639489860212e-01   +6.472729191869871e-02   +1.490358105846666e-01   +9.646226565879820e-02   -2.157409892404160e-02   +1.141881105207859e-01   -5.614911167272992e-02   +4.771180724519487e-02   -1.400618071320369e-01   +1.043893824204786e-01   +8.068993330071647e-02; -7.827146930756279e-02   +1.387034029519081e-01   +2.674413667091802e-02   -3.065661800717294e-02   +7.681546550478655e-02   -7.432849074911085e-02   +1.532766078598531e-01   +9.354451916889518e-02   +6.125961077541841e-02   -1.301562277543003e-01   +5.254843337087147e-02   +2.344004279249400e-02; +5.173945458661839e-02   +3.168231425246000e-02   +1.633664516524378e-01   -4.305107641331936e-02   -3.449196213677094e-02   +1.620187262010183e-01   -8.501318514028221e-02   +2.660651288667023e-03   -1.193699889205113e-01   +9.290064980646864e-02   +8.146708330245452e-03   +5.363788634171291e-02; +7.450299011936055e-02   -1.174091789263263e-01   -1.720832377927287e-01   +5.003542669426529e-02   -1.398230713770528e-01   -1.264833736404136e-01   -2.634208973065211e-02   +5.300514319285859e-02   -1.399525823850219e-01   -1.159134699995955e-01   -5.515390973312074e-03   +1.312317643595066e-01; +2.866954584234745e-02   +1.081198423904226e-01   -9.036947824128913e-02   -4.507441603030395e-02   -1.289467194049453e-01   +2.035322665264273e-02   -1.232528377560618e-01   -7.754368591295233e-02   -3.401195495219009e-02   -9.421300793650836e-02   -1.723730294688341e-01   +7.415315178882999e-02; -3.045920664368732e-02   +1.114802934923376e-01   -2.438948507253988e-02   -7.786538731435574e-02   -3.571160239903440e-02   +5.437104483853746e-02   +2.850124258840557e-02   +1.256148603262261e-01   -1.306424705248227e-01   -1.109981250899791e-01   +1.579272934067702e-01   -3.367686107630555e-02];
L2E_L3E_iAMPA_netcon = [+1.016811159321956e-01   -1.152829632208336e-02   -1.677661950750270e-01   +4.408481122971340e-02   +2.529171427532665e-02   -6.057207747371478e-02   -1.911365007440398e-01   +4.372211866726933e-02; +3.490258630557712e-02   -1.142341108829357e-01   -8.289631897444977e-02   -1.408768855806612e-01   -4.625602461913556e-03   -1.912016530701031e-02   -6.436459733601105e-02   +2.012226293560032e-01; -1.081939784956819e-01   +1.673607952658794e-01   -2.506994757288828e-02   -5.311996126989347e-02   +6.421378531085402e-02   -2.158850076761046e-02   +8.263510745022332e-02   +6.530203442301448e-02; +1.957086510528613e-01   +2.026270390259367e-01   -2.722297607213679e-02   -4.204846876104956e-02   +6.217608455314175e-02   -4.238619883235158e-02   +6.070158752784078e-02   +7.818598249724089e-02; -4.926334171777447e-02   +1.157521913128489e-01   -3.158954756357970e-02   +8.535110764954773e-02   +2.807955356168322e-02   -6.439710237393098e-02   -1.305543480705054e-01   +1.417182608966110e-02; -1.691347603309965e-02   -7.869422056742108e-02   +1.114342794288753e-01   +9.766043781005046e-02   +1.028895686080397e-01   +5.531328314537770e-02   -4.276999191876071e-02   +9.809271905489551e-02; -4.367262411796036e-02   -1.239197573068506e-01   +1.261251338829311e-01   +6.592450467404981e-02   +7.724238747059723e-03   -2.729710374669155e-02   -9.006812232385485e-02   +7.715803926540438e-02; -7.397189968137234e-02   +7.829148906204805e-02   -7.039205968056464e-02   +1.830221107171776e-02   +1.873303575530701e-03   -6.434681713974909e-02   +1.364475138398751e-02   +1.068837121440167e-01; +2.204246010639664e-02   -9.410799907557472e-02   +1.127795913213493e-01   +8.867216278358164e-02   +9.217562275137457e-02   +1.903989908887606e-02   +7.060760962415927e-02   -6.835444990070408e-03; -1.629138234141462e-01   -9.799076998345294e-02   -2.178579585963193e-02   -4.794207674471054e-02   +4.640045558175761e-03   -7.080381948340886e-02   +8.181081564163868e-03   +4.274449325364865e-02; +1.696502581776634e-02   +3.068496298820160e-02   -1.275323842735713e-01   -5.769524741277027e-03   -8.202080206975078e-03   +8.133311938841428e-02   -2.979601355338875e-02   -2.713926241546008e-02; -9.143365697544850e-02   -3.391768030862047e-02   +3.343864830532365e-03   +5.912343717305936e-02   -4.979961177901816e-02   -1.218425119592140e-01   -6.366725710309180e-02   -1.287639249139942e-01];
L2I_L3I_iGABA_netcon = [-5.426808852315708e-02   +5.604972123414010e-02   +1.301216378361502e-01   -1.081110071283403e-01   -1.624293744435781e-02   -2.532891717838034e-02   +8.133063470167463e-02   -2.104293121511841e-02; -4.921447384051399e-02   +3.523191751647692e-02   -4.272710218502951e-02   +3.253676371677786e-02   -5.334609006798196e-02   +1.520379520998729e-02   +2.280588706929583e-01   +1.819687576277939e-02; +1.083821097466058e-01   -2.205007374696333e-03   -9.497918434800127e-03   -1.220613261981103e-01   +1.323475011195004e-02   +5.392640636583301e-03   +2.952435765946613e-02   +8.979497438354996e-02; +2.495410091204585e-02   +1.120798083841071e-01   +5.972547204406752e-02   -4.332257975588072e-02   +6.068072884359967e-02   -9.892381693262542e-02   +1.302024370447581e-01   -1.305633852439687e-01; -6.934181133238466e-02   -6.410547216231209e-02   -1.122369710384882e-01   -4.177489618863270e-02   +5.837442777179303e-02   +6.914218424858264e-02   -1.870757965623242e-02   +2.424169889629208e-02; +2.091730064518706e-02   -2.836754258442426e-02   -2.638653850605113e-02   +2.114028951876809e-02   +6.764860630766445e-02   +1.039030303871483e-01   +1.192333876739965e-01   +6.643017737778577e-02; +6.810610683509692e-02   +2.296575991001760e-04   +6.054061867410043e-02   -8.164074957726354e-02   +1.962589395153624e-02   +8.792781239787091e-03   -3.957444958770745e-03   +5.286716190096744e-03; -1.684815227200516e-02   +1.769304860509585e-01   +3.156366543452464e-02   +4.835488385459915e-03   -7.420185468878931e-02   +1.161307695153403e-02   -1.388735078190155e-01   -7.132256510232601e-02; +1.677729063476469e-01   +8.785583815852811e-02   +9.903184372653175e-03   +9.865362639551782e-02   +4.120835886474290e-02   -2.433193871451998e-02   +1.612164322369156e-01   -1.072403641542335e-01; -1.310635992787823e-02   -3.701816330148631e-02   -2.297297638050381e-02   +8.031294263525704e-02   -8.365562154538730e-02   -1.770604372126721e-01   +8.030545147252457e-03   +9.278617734117174e-03; -6.226398878740827e-02   -2.432008150878640e-02   -1.946719560224879e-02   +2.184428440998014e-02   +1.160558718052245e-01   +7.454527409881369e-02   -6.442251237674267e-02   -9.439715693493955e-03; -8.407395320528378e-02   +1.593533478544821e-01   -7.816821578806237e-03   +1.213901890725644e-01   -3.383634810876392e-02   -1.192229601182258e-03   +1.612260856701054e-02   -3.214877419944581e-02];
L3I_L3E_iAMPA_netcon = [+9.237759590576282e-02   +2.905743483521814e-03   +2.099328850449430e-01   +2.514741174727621e-02   +7.020566129711437e-03   +9.548694121185065e-02   -1.446854462807250e-01   -1.044574590681014e-01   -4.887324581438630e-02   +3.012207288297118e-02   -8.059530546331008e-02   +1.383473052577987e-02; -4.199181672792295e-02   -4.663682417667515e-02   +1.899751297206153e-01   +2.450189062833574e-02   +1.175313644423873e-02   -2.567249236061904e-01   +3.017286737658123e-02   +1.996871844856274e-01   +1.787901607061578e-01   -7.244610466164758e-02   -8.700873278426993e-02   +3.884213937928326e-02; -2.759773182378345e-03   -1.322968116857862e-01   -1.544798961351799e-01   +3.047072854756757e-02   +1.178246429553570e-01   +1.071721817731856e-02   +4.787988810753669e-02   +8.407026480671619e-02   +2.667663292349206e-02   -4.022198276267566e-02   -5.673936319140459e-02   +1.320752290138159e-01; +4.804182964163298e-02   -1.348529067080433e-02   +2.055786010665916e-01   +6.109661354614035e-04   -9.986338029849097e-02   +8.665881679558449e-02   -1.435345270713721e-01   +7.761515839747017e-02   +6.662102103414214e-02   -4.700344783037142e-02   -3.540597041704250e-02   +1.617227520530826e-01; -5.225904127785613e-02   -2.415758687124038e-01   -1.071804186792877e-01   -1.449795189844717e-01   -2.241078309312006e-02   -1.147211280647562e-01   +1.113596555583219e-01   +3.948989531849858e-03   -1.002082426809256e-01   -1.805175410519873e-01   -8.253809515449684e-02   -1.000163650969750e-01; +1.131771649813838e-01   +9.284219578881968e-02   +2.291145102203670e-02   -1.646080601197392e-01   -1.646850088829475e-01   +4.635643119312698e-02   -1.624561543074184e-02   -4.475501512757669e-02   -3.714605066931871e-02   +1.173495413096531e-01   +5.548656662954170e-02   -4.219942869338589e-02; +9.395565540214316e-03   -1.153543212781734e-01   -7.298838134967794e-02   +1.036671917726620e-01   +1.116229739778838e-01   -7.680277762822417e-02   +9.621033289012265e-02   +5.249003543190486e-02   +7.100628100672737e-03   +3.405148156044480e-03   +9.390279516004700e-02   +1.041336575970325e-01; +5.635953370834772e-02   -4.192151043837137e-02   +8.967293694056709e-02   +4.586046423994505e-02   +1.878826132731155e-01   +1.131383869448595e-01   +6.614662046508664e-02   -9.218511701143628e-03   +4.076923630795623e-02   -2.692866019718609e-02   +3.345354792859613e-02   +8.533140548552701e-02; +1.801489918902540e-01   -1.040648074004927e-01   +9.635919021202086e-02   -1.253687867642252e-01   +3.060214885455862e-02   +1.555211747413976e-01   +1.499126082364730e-01   +8.042922923349534e-02   -9.010003432120450e-02   +3.964490439377653e-02   +4.064615274529551e-02   -2.168925874583509e-01; +7.687766068015940e-02   -3.775289682954529e-02   -9.035506874255815e-02   -2.027661288897248e-02   +1.870041803799648e-04   -2.325939112300745e-02   -9.888244712697744e-02   -4.482845712744756e-02   -3.476875862313501e-03   +3.046905325342896e-02   +9.921313922434227e-02   -9.327356170924953e-03; +9.757788144876692e-02   +2.642123248114905e-02   -1.479951778730704e-01   -1.170259686399878e-01   +1.273555076283509e-01   -1.675296177390074e-01   -6.725601682891809e-03   +1.168054803623028e-01   +6.198687342314141e-02   -2.554872710770674e-02   +1.110486048957763e-01   +2.414384970486539e-02; -9.941945180970610e-02   +1.724369977743426e-01   +1.960009573680073e-03   -2.835814458254386e-02   +9.946187464682099e-02   -1.232512606927090e-01   +3.583741924678691e-02   -1.413001637141283e-01   -6.729437009035955e-02   +1.824256638755797e-01   +1.479911319775657e-01   +1.098512995083457e-01];
L3E_L3I_iGABA_netcon = [-4.418982226755507e-02   +2.145190526549615e-03   +1.226352277121343e-01   -8.254004675181585e-02   -1.154796222343361e-01   -1.196955061525906e-01   +6.111514337650355e-02   -7.753427278803222e-02   -9.216935977864382e-02   +1.661609510400869e-02   -3.436561872479221e-02   +7.029940178813315e-02; -6.133806125135970e-02   -5.029838907572220e-02   -7.321314941848421e-02   -1.012539863357937e-01   +2.173476796478370e-01   -2.801603305540319e-02   -1.470866980902159e-02   +3.155060078389781e-02   -6.227978395588785e-02   -1.223368173232458e-01   +2.082048729148641e-01   +3.517371818055567e-02; -1.033885455241850e-01   -1.668357544621950e-03   +6.693991724940923e-02   +2.065879225257489e-02   +7.645348790059812e-02   +3.119024403717511e-02   +1.260870835120710e-02   +2.086200090536395e-02   -6.154292008581225e-02   -8.459132787713980e-02   -7.661535399115786e-02   -4.064072581390337e-03; -7.039681283131245e-02   -4.984161698790091e-02   -8.238383631017687e-02   -1.492173587871174e-02   -4.231521645164286e-02   +1.645392992246818e-01   +8.530857436185642e-03   -2.325478465158629e-02   +4.215399768008187e-02   -2.559025789189797e-03   -1.362446936081729e-01   +1.186434407544792e-02; +4.919505694063938e-02   -1.831143889531840e-03   +9.474853210898262e-04   +8.253547002323955e-02   +5.921029073601944e-02   -9.621246478990955e-03   -2.039443991314282e-02   -1.560861829856387e-01   -6.763500751956900e-03   +5.314964444827953e-02   -1.675696412364157e-01   +2.006876309247300e-01; -3.768418838205207e-02   -5.283497789310843e-02   +8.820408081372214e-02   +1.517409101195902e-02   -1.196060240510366e-02   +3.024991524778495e-02   +3.173666267160904e-02   -9.829963493296394e-02   -1.287256659676224e-01   -1.748258120939240e-02   -8.910078252476672e-02   -3.401974851818949e-02; -1.142783628121215e-01   +2.425040255637668e-03   +5.018695139161636e-02   -1.319233032023244e-01   -1.512489607943469e-01   -9.641175941063511e-02   -6.874505119385893e-02   +7.872588267281830e-03   +4.204377785642597e-03   +1.968650541732138e-01   +1.696244580210612e-02   -4.082937657869493e-02; +6.291221936717026e-02   +2.748240801466172e-02   -9.699245513391030e-02   -1.392433118350962e-01   -2.162870632245379e-02   +2.926456265430748e-02   +1.006934124569629e-02   +4.482840707300988e-02   +2.031620123875076e-02   +6.827641427355806e-02   -9.099770175500634e-02   -7.289312556128742e-02; -6.889986990488582e-02   +1.823885625728442e-01   +7.915791218508421e-02   -1.119403601943602e-01   -2.101642786622667e-01   -1.919229797345748e-01   -1.479718001844323e-01   +1.092060722843784e-01   +1.108172647235673e-01   +1.141719621339672e-01   +1.759062174192457e-02   +7.091577510440672e-02; -8.123572916970608e-02   -2.001670838840094e-02   -2.280379122887291e-02   -8.447164058521139e-03   +1.145814360231330e-01   -8.285698894633789e-02   -3.825916433969043e-02   -1.750379102341739e-02   +5.108993526724417e-03   -7.431353734353929e-02   -3.215213012395165e-02   -8.831157234073063e-02; +1.164962092255384e-01   +1.327681919796473e-02   -6.360475524500099e-03   +2.217042826343627e-02   -1.677622471242158e-02   +1.385544972199656e-01   +4.264726485315248e-02   -3.351053832178991e-02   +6.648719147133299e-02   +5.355239828245838e-02   -1.033219027512390e-01   -3.271389155741627e-02; -3.864062814052029e-02   +1.007650742197604e-01   +9.953726748086522e-02   +2.454244067745767e-02   +1.649483940577429e-01   -9.625051275877216e-03   -2.258558830019699e-03   +4.848764935944123e-02   +1.853489439897156e-02   +1.491457862367998e-01   +1.072955943334664e-01   -4.868931350941450e-02];
L2E_Input1_iAMPA_netcon = [-2.801496858236534e-02   -9.628307822995312e-02   +1.697791859974098e-01   -2.701863954458934e-02   +3.516753219134397e-02   -4.742601649471850e-03   +2.194562566975072e-02   +9.999766375582063e-02];
L2I_Input2_iAMPA_netcon = [-1.076866159169971e-01   +2.721890093275223e-02   -9.268782965677665e-02   -1.984236551466693e-01   +1.122916387775157e-01   -6.969823751014553e-02   +1.759416925687906e-01   -1.115404075682235e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
