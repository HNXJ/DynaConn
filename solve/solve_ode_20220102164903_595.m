function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.499743373525468e-02   +1.833089690604975e-01   +3.231830272842617e-01   +2.446725121383096e-01   +2.192042789725643e-01   +3.418841367679613e-01   +1.754519705842034e-01   +6.781408320823817e-02   +6.844521034708601e-02   +1.600448216884338e-01   +2.044088021129378e-01   +7.062575648503325e-02   +1.420292749319177e-01   +2.336200843726158e-01   +1.508559611343039e-01   +2.827469490336432e-02; +1.312410586498899e-01   +5.690938375510472e-03   +1.841274278058946e-01   +2.237162894324321e-01   +1.017029236446688e-01   +1.130776097545862e-01   +3.204164342334355e-01   +3.469168274722544e-01   +2.408467633743425e-01   +7.223621525023444e-02   +3.468861841297300e-01   +7.673088935032375e-02   +7.215701719722535e-02   +8.424562799613620e-03   +1.836123497006621e-01   +1.052203843273017e-02; +2.355053232101141e-01   +2.474257585532392e-01   +2.967985540845756e-01   +1.634921569386042e-01   +3.919038857818358e-02   +2.947161967604892e-01   +3.085094552233738e-01   +1.533976309397771e-01   +1.675086668012659e-01   +1.450823436756483e-01   +1.571531154549625e-01   +5.203340540246305e-02   +2.206912801397675e-02   +5.164344295029118e-02   +2.866580756841571e-01   +2.085942437927597e-01; -8.491855035372122e-04   +1.231463912275581e-02   +1.594913062358700e-01   +2.179430832508799e-01   +6.941210152360371e-02   +2.761971575389137e-01   +1.568011132738484e-01   +3.361857748640836e-01   +1.690225466669878e-01   +1.047638666801537e-01   +3.163724139859297e-01   +3.130347019592954e-01   +4.403442068880467e-02   +3.231214897237246e-01   +8.052377941372463e-02   +1.111033249705722e-01; +1.681319677640683e-01   +2.251762527660823e-01   +2.185659389217120e-01   +2.454888563364943e-01   +1.345440982519075e-01   +2.871980038025581e-01   +1.726735750684436e-01   +9.376608700959274e-02   +1.968671139899618e-01   +2.959559599865829e-01   +1.267982442378901e-01   +2.406707569160201e-01   +8.739132810364680e-02   +1.143725093950092e-01   +3.119431804160532e-01   +5.567439250502441e-02; +1.719468147069616e-01   +5.007369793700106e-02   +2.959169714183995e-01   +5.809836864463786e-02   +2.222515433957299e-01   +1.094019166268195e-01   +1.546031569633485e-01   +6.430270378760788e-02   +1.705560627894723e-01   +1.716103131560464e-01   +2.601972555377184e-01   +8.493159753167510e-02   +1.716175034728730e-01   +1.866682640801225e-01   +1.661229639746941e-01   +2.487694868813788e-01; +1.142522655610702e-01   +2.295534638735263e-01   +3.312168686089157e-01   +2.266765336720336e-01   +1.348112938093378e-01   +2.126307832935843e-01   +1.294667565219893e-01   +2.931915242270395e-01   +3.340064515702243e-01   +1.422712365878584e-01   +5.340760451028950e-02   +5.809801719241249e-02   +1.488150439459528e-01   +3.263074702151696e-01   +1.606669135270631e-02   +8.320967885994718e-02; +1.996669665296300e-01   +1.241812815072972e-01   +2.692887299297123e-01   +2.158564371017961e-01   +2.057698163820276e-01   +5.183125262370419e-02   +2.501865634278677e-02   +1.538997644141124e-01   +2.670296878968265e-01   +2.340950501058733e-01   +1.011937155305320e-01   +2.656419907213199e-01   +1.107428853258771e-01   +3.635462710029156e-02   +2.518827332279425e-01   +2.142675840329599e-01; +5.990907232740666e-03   +2.311486950849219e-01   +2.333004961713841e-01   +2.415086030553114e-01   +3.533294808826262e-02   +3.172128244090427e-01   +1.559493068043173e-01   +1.581488916371300e-01   +1.711897931040560e-01   +1.678620510715362e-01   +5.819285604107607e-02   +3.138171351964981e-01   +7.541921052977267e-03   +2.724610463090356e-01   +1.328116093898113e-01   +1.748643180381257e-01; +2.476954840772451e-01   +3.950971167317729e-02   +3.070600199871005e-01   +2.875023111830529e-01   +2.162986631469121e-01   +6.447113434944331e-02   +3.255453323289190e-02   +7.490779123116110e-03   +2.624659100012043e-01   +1.389930160960401e-01   +3.723213964183547e-02   +1.963123529262375e-01   +2.889167504515361e-01   +9.180104957319407e-02   +3.026996558754279e-01   +2.314052661633942e-01; +1.377984650806709e-01   +1.707038489177453e-01   +1.780235235478807e-01   +2.764729980141342e-01   +3.135605140946129e-01   +6.610079282164730e-02   +2.208928164628371e-01   +2.054013243079237e-01   +8.363974887097290e-02   +1.032451755411900e-01   +2.553049056531391e-01   +3.329147266032219e-01   +4.344016630797883e-02   +2.479704905242210e-01   +2.699848050764609e-01   +6.604479981169951e-02; +1.861424265939644e-01   +1.051295921491151e-01   +3.660030906662127e-02   -7.409531401113821e-05   +3.387814385069173e-01   +3.166776876436841e-01   +1.461580456982556e-02   +2.431320427327419e-01   +2.422359200173748e-01   +1.051054642023015e-01   +4.157685069051591e-02   +8.662308728350139e-03   +3.224572312367406e-01   +2.876190558178262e-02   +1.867516953877771e-01   +1.430321802098568e-01; +2.269447353098544e-01   +2.582490250955927e-01   +3.073622672704505e-01   +5.424375185897948e-02   +2.293755168359476e-01   +2.472410066947515e-01   +2.473712911307266e-01   +2.228203433145317e-01   +3.121943201908535e-01   +1.515251980465596e-01   +1.447217455052757e-01   +3.081951501065966e-01   +2.937396731742776e-01   +2.472512166495588e-01   +1.564461449853606e-01   +3.163971939484571e-01; +2.954498591311126e-01   +2.356153619031714e-01   +1.078699473220737e-01   +2.151410047275554e-01   +3.695959382145095e-02   +8.464012599985270e-02   +2.209737955011478e-02   +8.315655695168239e-02   +1.194013419689590e-01   +2.451776784285473e-01   +6.965364332857790e-02   +2.779640982843268e-01   +1.985172359998525e-01   +2.170383628552126e-01   +1.400395607849842e-01   +1.129145390151277e-01; +1.741087005168852e-02   +1.856017324504471e-01   +2.932339591338004e-01   +1.865649277094673e-01   +9.612791559672337e-02   +6.608897558246536e-02   +9.543046034451325e-02   +1.392929105834172e-01   +8.346143037106486e-02   +3.494223632726854e-01   +1.238940844878416e-01   +1.855638417663978e-02   +6.916669219622866e-02   +2.569938708256975e-01   +1.325801581941110e-02   +2.360824218946713e-01; +2.750986954939055e-01   +1.286029661378979e-01   +7.710036959369077e-02   +3.342867716079952e-01   +3.869768189833748e-02   +4.850423677983635e-02   +3.085184589513423e-01   +5.251806743119020e-02   +2.099796806590812e-01   +2.637407670758530e-01   +2.272961958551647e-01   +5.475767536724869e-02   +2.612451696751457e-01   +2.744630764937332e-01   +3.306028830869079e-01   +3.099614549399617e-01];
L1E_L1I_iGABA_netcon = [+1.805294528141253e-01   +2.278571140170446e-01   +2.270333907289676e-02   +1.124684594666513e-01   +2.895397120409647e-01   +1.352365611550845e-01   +1.264996771235447e-01   +8.018536033153865e-02   +3.253270125348219e-02   +1.295809814188382e-01   +1.287628287340835e-01   +2.013498293695620e-01   +1.088113512408483e-01   +3.158523742332239e-01   +7.915586981086004e-02   +1.766118353456824e-01; +4.860985206246481e-02   +3.201990916279273e-01   +1.773877808987337e-01   +3.064327830812825e-01   +1.566794914206763e-01   +1.456292664752234e-01   +5.644378785126637e-02   +1.771640447140599e-01   +1.637049992524107e-01   +5.268018863291944e-02   +6.865216271826349e-02   +2.472346915305693e-01   +1.690794915840758e-01   +2.529317426099312e-01   +1.749593151099618e-01   +2.496036400940356e-01; +2.227379879893559e-01   +3.483234742080494e-01   +2.718125380553711e-01   +2.262672564392609e-01   +3.506798281777584e-02   +2.049384957364336e-01   +2.293658712228967e-01   +3.024722363379773e-01   +3.069567366628697e-01   +3.302202132092550e-01   +2.319465707954806e-01   +1.764269095342250e-01   +3.383540517531077e-01   +2.884261811061737e-01   +1.514461503933407e-01   +1.977815952593365e-01; +2.087950689772431e-02   +4.980500713818535e-02   +3.184478972140511e-01   +1.573710182891827e-02   +6.522749601296118e-02   +2.474138035204539e-01   +2.484697204071649e-01   +1.958753413428463e-01   +1.764389915377101e-01   +3.374463646973962e-01   +2.223780170005582e-01   +2.913208398132144e-02   +1.237770696710193e-01   +6.689145305427233e-02   +3.638453118323723e-02   +3.382284722425644e-01; +5.898616112090318e-03   +3.071590147692201e-01   +1.821055939482597e-01   +3.512357003445229e-02   +1.444209923574076e-01   +2.942715923524505e-01   +2.497288429059988e-01   +1.411187498650725e-01   +2.757098535443149e-03   +5.420150801319931e-02   +2.476475903870192e-01   +4.027866352071893e-02   +2.859791838452338e-01   +1.608393333427311e-01   +2.312417317346492e-01   +1.906137438917978e-01; +2.668593017953157e-01   +3.258235480532212e-01   +5.252608944900519e-02   +2.349312315620378e-01   +1.220432655389407e-01   +5.980960372557412e-04   +2.390472719205178e-01   +1.054372330456708e-01   +2.899767578358355e-01   +5.920345610909568e-02   +3.315882890375453e-01   +4.895670077374821e-02   +1.278904325566607e-01   +4.953763338543175e-02   +1.875491279323168e-01   +5.215162278107623e-02; +1.709937212166514e-01   +7.575047982454597e-02   +4.992638684996895e-02   +9.082832580506270e-02   +6.760105454433395e-02   +1.337166385532204e-01   +1.061483347032865e-01   +1.835618690746242e-01   +3.062096177777232e-01   +5.783948401618845e-02   +2.638456172940113e-01   +3.461203205455120e-01   +3.468049561908399e-01   +1.798840397400492e-01   +1.775432981179682e-01   +1.002896451648969e-01; +9.744813062514529e-02   +7.796795791669642e-02   +6.238234088574842e-03   +5.238837277624896e-02   +2.530349198479550e-01   +1.798501231867189e-01   +1.712944774888772e-01   +2.152364388762810e-01   +6.913455743333949e-02   +1.459652457357660e-01   +2.881312706912891e-01   +3.293410678368303e-01   +1.841701617855372e-01   +1.592580481567418e-01   +6.748961049942723e-02   +2.468837166557561e-01; +1.048312488493619e-01   +2.164839919632668e-01   +1.066319619969918e-01   +2.887053266712602e-03   +6.408785857566919e-02   +2.443427067840320e-01   +2.779466208883606e-01   +3.130756937513426e-01   +1.271363033325714e-01   +3.842606977556975e-02   +2.646729686594048e-01   +1.242566475974638e-01   +3.075654895580389e-01   +3.283472364557998e-01   +2.110989170612945e-01   +2.521226273516888e-02; +1.533942192968722e-02   +1.402530078662572e-01   +5.379030744246812e-02   +2.013962180534329e-01   +1.399096949762144e-01   +2.924808695009712e-01   +1.101211283599293e-01   +7.698860659642820e-02   +3.253091514901642e-01   +2.652692256512318e-01   +8.343524544126144e-02   +2.137085666808375e-01   +2.666397281465622e-01   +6.616518460128606e-02   +2.744910315566763e-01   +7.205673642125966e-02; +3.018818590554000e-01   +3.412046138688288e-02   +1.054600880027774e-01   +1.429963903277854e-01   +1.838167358945116e-01   +2.318851303595724e-01   +1.564919490067740e-01   +3.380801699153478e-01   +1.103297753783218e-01   +1.442044675085590e-01   +2.030763009689165e-01   +1.688019951926135e-01   +9.065471799667224e-02   +3.387694335096162e-01   +3.107513502995317e-01   +1.175138376328593e-01; +6.051473266594690e-02   +3.145931698397668e-01   +1.909535120476108e-01   +3.220378393835484e-01   +3.429246391647043e-01   +2.282017742248361e-01   +1.659225141428878e-01   +4.862364017665099e-02   +2.492873063826748e-01   +1.617659922784573e-01   +1.167785877303937e-01   +2.913985099183491e-01   +2.352092501396184e-01   +1.715106356946823e-01   +2.762848813233993e-01   +8.373264254664904e-02; +2.532514627437809e-01   +2.893879664991595e-02   +1.872068121471185e-01   +3.968023283797956e-02   +1.922591730662065e-01   +1.984398471810027e-01   +2.056334994652492e-01   +7.099334132476119e-02   +2.608243772789991e-01   +3.104963669691621e-01   +6.558542274963737e-02   +2.731058158553146e-01   +3.388272256115119e-01   +2.165248743419287e-01   +1.276591600243892e-01   +4.603159925254811e-02; +9.046025899095735e-02   +9.268482270524192e-02   +8.392634357602316e-02   +3.665926091870029e-02   +6.745852294830544e-02   +3.050869478377877e-01   +3.224830321525474e-01   +2.661725896583867e-01   +1.534707524653693e-01   +2.246391196142854e-01   +3.453317695760006e-01   +2.579537984797242e-01   +2.198308803125671e-01   +2.996295137186139e-01   +2.267733010685448e-01   +2.565514097466070e-01; +1.456145755998270e-01   +6.360049999970725e-02   +1.564325218467287e-01   +3.049463738560582e-01   +2.159594918651183e-01   +1.763933605067137e-01   +4.311502543589029e-02   +1.210161611404320e-01   +6.280705833757830e-02   +1.792258694108198e-01   +8.841284547335196e-02   +1.533877122256788e-01   +1.310916195364773e-01   +7.669363969390654e-02   +6.262290883855549e-02   +1.028974934316826e-01; +1.562887144636270e-01   +2.457014619422566e-02   +6.171159658099604e-02   +3.226455931286281e-01   +3.269036205472245e-01   +2.128438025222155e-02   +7.349606351100259e-02   +2.845395161087198e-01   +2.746732129291107e-01   +4.503846888218951e-02   +1.550759758695513e-02   +2.179335553361013e-01   +2.284712693736432e-01   +1.798112919547345e-01   +1.402038147138146e-01   +1.565773748739496e-01];
L2I_L1I_iGABA_netcon = [+3.448908828042049e-01   +1.677291322027950e-01   +9.981766784807522e-02   +3.087194502372220e-01   +3.208155032235754e-01   +3.217493338807500e-01   +1.247189187594519e-01   +2.771339709138835e-01; +2.747809683598332e-01   +3.058801607371608e-01   +2.480796475862298e-01   +9.570011319269206e-02   +1.499543305277683e-01   +2.361832409797954e-01   +3.129657821016631e-01   +7.787269477002376e-02; +7.444586782914796e-02   +8.085484469961339e-02   +9.399715929945715e-02   +1.286114043294586e-02   +2.788778225186902e-01   +3.372905019815750e-01   +3.780934042772634e-02   +2.116355736960419e-01; +1.334077256518571e-01   +2.750553245426004e-01   +2.340974591557356e-01   +2.161961288488747e-01   +2.088989211459192e-01   +2.122601718327269e-01   +1.735218646356508e-01   +2.781739189529479e-01; +1.121533806980400e-01   +6.347455482955032e-02   +2.085226323011120e-01   +2.020705033417056e-01   +1.584327476370623e-01   +2.693653914249805e-01   +1.738195493995241e-01   +2.060664960482511e-01; +2.709823844799353e-01   +2.523761606427048e-01   +3.177483390761022e-01   +1.461944770730629e-01   +1.039646380187027e-01   +2.422458483609377e-01   -8.227882570874896e-04   +2.350189859229247e-01; +4.622358126107080e-02   +1.254689262890980e-01   +1.293953961158691e-01   +8.445579305321389e-02   +2.401458761161251e-01   +9.880474084843735e-02   +8.009511114635137e-02   +2.318001197120627e-01; +1.991846833494554e-01   +1.220764325616900e-01   +2.770509509875746e-01   +1.337426545626675e-01   +1.004820094190579e-01   +2.416795457573256e-01   +1.576105049093826e-01   +1.031182791854188e-01; +1.408210323805675e-01   +2.453589976444819e-01   +6.866685873051254e-02   +8.522433210056286e-02   +1.089871148893735e-01   +5.714366676684999e-02   +1.476866418857568e-01   +3.334156009297086e-01; +1.823232713874671e-01   +2.345443459600663e-01   +7.525527135959378e-02   +1.905069695217853e-01   +1.116875484115937e-02   +2.480515107998003e-01   +3.127932558838921e-01   +2.421335601346433e-01; +1.824232915447582e-01   +2.758199542931198e-01   +2.917276962705938e-01   +1.306024585727002e-01   +2.457151007821224e-01   +3.424902857041552e-01   +6.324295130748815e-02   +9.604471215532615e-02; +2.727290160505008e-01   +1.836803358289286e-01   +2.099730587407063e-01   +1.468007316896381e-01   +3.383137257155737e-01   +9.478314437801073e-02   +2.177137354215054e-01   +1.131312432528353e-01; +1.066597060574670e-01   +3.329341071578480e-01   +3.229224548511047e-01   +6.750702450603228e-02   +1.929372321582183e-01   +1.019809096313212e-01   +1.105576700384479e-01   +1.754557361389648e-01; +2.376622861602039e-01   +8.920195248357149e-02   +3.485246545710447e-01   +1.801335175961995e-01   +2.900666569898745e-01   +6.349136642367048e-02   +3.319378232748398e-01   +7.691674551150443e-02; +3.335712312094646e-01   +7.218730155442266e-02   +9.148557035700933e-02   +3.191480828306520e-01   +2.314311713181157e-01   +4.993321367813198e-02   +1.349210640515921e-01   +2.416959833401830e-01; +7.120657767567511e-02   +2.430505666486618e-01   +2.460103646138512e-01   +2.140270701639917e-01   +2.864223139655668e-01   +4.509934514330339e-02   +3.410101500729776e-01   +1.037787544871724e-01];
L1I_L2I_iGABA_netcon = [+1.970605437225162e-01   +2.377322992463478e-01   +1.065586525241440e-01   +2.664386213199389e-02   +1.810774865098779e-01   +1.329924518014965e-01   +3.408578676357523e-01   +2.427883397697504e-01   +1.447181277999330e-01   +2.680236335615653e-01   +4.870728400378727e-02   +1.103439421847660e-01   +4.045419565751229e-02   +5.300510264250675e-04   +7.093897638340613e-02   +2.751766293347183e-01; +2.781436539487036e-01   +2.096003090385649e-01   +1.355472216096085e-01   +1.619270678365655e-01   +3.212911499611822e-01   +1.554044946554319e-01   +2.343800072035074e-01   +3.372840952799155e-01   +1.491998049568217e-01   +3.404104791384378e-01   +2.281021112457080e-01   +1.239210339812607e-01   +1.746333779148882e-01   +2.373330237760811e-02   +1.615086865375589e-02   +3.095247688212915e-01; +2.986541668409644e-01   +2.009361762939767e-01   +7.753488015037627e-02   +2.881633998095975e-01   +1.162866238406554e-01   +3.003800944836526e-01   +2.625409203809043e-01   +2.277534428677286e-01   +1.307976782463883e-01   +1.259327194327875e-01   +2.368333612267155e-01   +1.349733403295431e-01   +1.125874571310190e-01   +5.892959269835495e-02   +2.112299850891142e-01   +4.944191102297212e-02; +1.414349113248189e-01   +1.455092623232705e-02   +2.069253829765916e-01   +3.027730440113696e-01   +3.614841560792729e-02   +2.008036657270218e-03   +1.244012158355017e-01   +1.197264787058451e-01   +2.367118072059069e-02   +2.257501285789189e-01   +1.949642037694144e-01   +1.663781397623397e-01   +8.431097215868934e-02   +2.175614296504010e-02   +2.747056208831188e-01   +1.791306631639251e-01; +2.894620127723930e-02   +2.815125659516147e-01   +2.730554178989320e-01   +2.294861996096014e-01   +2.187789142234901e-01   +1.731448854250380e-01   +2.165080473120773e-01   +2.938232941346526e-01   +2.131948759327953e-01   +1.294118783919744e-02   +1.111775009258633e-01   +3.508131690782595e-03   +8.790095297750242e-02   +3.097871143588887e-01   +7.144407840672501e-02   +1.633276355728253e-01; +2.157625909825225e-01   +2.476996261006331e-01   +4.509154488455211e-02   +3.110596223315206e-01   +1.985994519313606e-01   +3.375911917792632e-01   +2.519926393051832e-01   +2.881392935175238e-01   +1.902348067807582e-01   +2.019436139008585e-01   +3.532907976080869e-01   +2.870256857745532e-01   +4.753288200463833e-02   +3.177081030569207e-01   +2.499329273005070e-01   +3.135047009332457e-01; +2.698133070675697e-01   +4.521723101941201e-02   +3.018748863234604e-01   +3.400761114103545e-01   +1.330272655010167e-01   +3.408618981082635e-01   +1.796833568007989e-01   +1.638800878173021e-01   +4.241829831166478e-04   +2.019594205929900e-01   +1.036954602592124e-01   +1.227878062459641e-01   +2.734303067842907e-01   +1.438317484325345e-01   +2.898642540280137e-01   +1.999589491736589e-01; +2.574983298973698e-01   +3.138847170576898e-02   +3.150343231741343e-01   +2.502309027462898e-01   +3.673996799948979e-02   +2.736468866090723e-01   +2.060808189514024e-01   +2.705590858870547e-01   +1.251333123149562e-01   +3.011997073060722e-01   +9.489357605282563e-02   +1.730864963677523e-01   +1.758762905145141e-01   +1.930471925977376e-02   +3.189669808105048e-01   +9.073197883564237e-04];
L2E_L1E_iAMPA_netcon = [+2.732922871847214e-01   +1.014591281708882e-01   +5.116083192497420e-02   +3.471066209847949e-01   +1.948681418131543e-03   +1.692833836348331e-01   +2.308005957027601e-01   +2.685152439223726e-02; +3.214848606683903e-01   +3.001455746625039e-01   +1.849312698622417e-01   +1.288810528593171e-01   +1.772224964584181e-01   +5.987163053995872e-02   +3.197037524719205e-01   +1.402940932461011e-01; +3.440585917762280e-02   +4.247607646332440e-02   +1.110490141182312e-01   +5.249716497568986e-02   +2.218291738443047e-01   +2.938257566529101e-01   +1.146056632508907e-01   +1.098496010846190e-01; +9.279260529330115e-02   +2.559466302233447e-01   +7.164107589373103e-02   +2.325021464564623e-01   +2.611510200184111e-01   +1.096716216277267e-01   +3.081485748318956e-01   +2.878479306649421e-01; +6.745455428310236e-02   +3.430376196801159e-01   +5.091537450130063e-02   +1.016489076565521e-02   +3.266759749443069e-01   +3.324873052805793e-01   +2.411477280153758e-01   +1.624510859340104e-01; +2.429873399693702e-01   +1.825380341411114e-01   +3.282000948551574e-01   +2.720718725030028e-01   +2.441357484878870e-01   +8.039626231324130e-02   +2.746005602807873e-01   +2.380349990943642e-01; +3.619413017418917e-02   +1.182663270578924e-01   +9.626437366195144e-02   +1.576829453978663e-01   +3.187065807547460e-01   +1.645080051606463e-01   +5.876022227829029e-02   +1.201474305551421e-01; +2.310250480611642e-02   +4.800690965734603e-02   +1.881759268584960e-01   +2.334411470619147e-01   +1.359275305289378e-01   +3.195762829719403e-01   +3.376689343796264e-01   +3.165876748333144e-01; +1.240200197777905e-01   +3.086735321273164e-01   +1.829102474951921e-02   +8.972808666544194e-02   +5.367856080532560e-02   +3.368703906463597e-01   +1.886418074445406e-01   +2.323898346135605e-02; +1.024495783135606e-01   +1.002816262355600e-01   +2.975437838541549e-01   +1.387245795666850e-01   +2.862789688646358e-01   +3.067401170914546e-02   +4.573618664197673e-02   +3.334948440245410e-01; +2.012864063061169e-01   +1.681845267842953e-01   +6.654775272647703e-02   +2.130485471589424e-01   +1.439146556621780e-01   +1.463473547872480e-01   +2.066134759971566e-01   +3.128596347504652e-01; +9.186423650734783e-02   +1.586951395864824e-01   +2.864121690797932e-01   +2.575613404945816e-01   +2.242740593146706e-01   +6.843235795961210e-02   +3.461230791844142e-01   +8.484843473348525e-02; +2.082069841672953e-01   +2.929235587734279e-01   +8.615198142175370e-02   +1.818338739480491e-02   +3.417789284514449e-01   +2.301962130874711e-01   +1.568815691867216e-01   +2.816052203412800e-01; +1.467180698590698e-01   +1.367040968611318e-02   +3.816795433131118e-02   +2.337072832498638e-01   +3.376341417605778e-02   +1.027668568503784e-01   +2.712954801391846e-02   +2.576987954628564e-01; +9.877205997913040e-02   +7.159233604544329e-02   +2.473812361017464e-02   +2.714778215317242e-01   +3.801828447583338e-02   +3.359095762200796e-02   +1.429412721470517e-01   +7.849517829798167e-02; +4.884797983321103e-02   +1.597994776031194e-01   +4.801950111209023e-02   +1.880217163597256e-01   +8.697454402494095e-02   +1.922399879950889e-01   +3.617814399702184e-02   +2.883434265506959e-01];
L1E_L2E_iAMPA_netcon = [+1.285052904927053e-01   +5.326085921878881e-02   +3.263161131613543e-01   +3.320252784862712e-01   +1.178942993222811e-01   +3.293967810746711e-01   +1.789879440984831e-01   +3.443772621380796e-01   +4.765240616445453e-02   +2.274658928959599e-01   +2.232102158630660e-01   +2.652010785097823e-01   +1.295723122775806e-01   +2.334256007249692e-01   +1.984768110396908e-01   +1.740325098052055e-01; +1.302445622084466e-01   +1.811533201123081e-01   +7.672590284998383e-02   +2.799891609381373e-02   +1.943159381347885e-02   +2.369825330517568e-01   +2.844516926664688e-02   +1.096039449238499e-01   +7.561019611256334e-02   +1.129694095322351e-01   +9.335371554378738e-02   +3.292381772497929e-01   +5.068632516674595e-02   +9.468029650610937e-02   +2.067377758237271e-01   +8.635353777193172e-02; +1.144383734979378e-01   +2.034303032069118e-01   +3.138896939296667e-01   +3.199090130856652e-01   +3.341387777976055e-01   +4.069864563877068e-02   +1.055696853897031e-01   +2.049948202952261e-02   +1.546540901676280e-01   +2.007530095412187e-01   +1.189222152866358e-01   +3.660644760027920e-02   +2.582908640635450e-01   +2.099128333627090e-01   +3.070860320969014e-01   +2.174164388343755e-02; +2.715423265279523e-01   +8.272563254844262e-03   +7.345831740860038e-02   +7.481924811045534e-02   +2.494941077211064e-01   +1.115265388873622e-01   +3.162575711178768e-01   +3.095641889831167e-01   +2.739518687577162e-01   +2.686155740728400e-01   +1.598913566319915e-01   +1.955125683569869e-01   +3.202623329519624e-01   +1.195440102425420e-01   +3.179408847530752e-01   +3.410725573962489e-01; +4.914939146848692e-02   +2.993933256783660e-01   +3.016626543649912e-01   +7.928360583341943e-03   +5.593431387996056e-02   +2.868900707693552e-01   +3.213614840671246e-01   +6.043040227204726e-02   +2.026621005292137e-01   +1.497432256099443e-01   +1.969426605263364e-01   +2.679837745620245e-01   +8.201679715982811e-02   +1.861986182695724e-01   +3.466522286971126e-01   +2.067747273625334e-02; +1.333866672056197e-02   +3.008812178702913e-01   +9.247814991055847e-02   +2.824064863669291e-01   +3.400211032163210e-01   +2.999294018649385e-01   +1.800995727584971e-01   +3.197486908336268e-01   +1.142241479926205e-01   +1.373171159936779e-01   +2.977291697620970e-01   +3.200729208433797e-01   +2.941027709289221e-01   +2.201422350140870e-01   +6.842125036394857e-02   +1.972541083799556e-01; +1.075358304998719e-01   +7.574604862400992e-02   +2.008276023814612e-01   +2.788127717598473e-03   +1.341034375740222e-01   +1.834490148626144e-01   +2.598228826887368e-01   +2.078451056736678e-01   +2.036015473609902e-01   +2.754565072509352e-01   +2.202844001306703e-01   +4.310221596162066e-02   +1.243906001969885e-01   +1.947704049434216e-01   +8.358117975322035e-02   +1.227493109330683e-01; +3.063643031499226e-02   +1.883068276160512e-01   +1.729594600048652e-01   +1.380354861927809e-01   +2.563939477446517e-01   +3.405858594851807e-01   +3.418084893501745e-01   +2.260986388046010e-01   +3.058355806578145e-01   +1.382280225857168e-01   +1.199558095033473e-01   +3.411088391975146e-01   +2.301221151605308e-01   +3.173695387466351e-01   +1.143025107565388e-01   +3.501177982963897e-02];
L2I_L2E_iAMPA_netcon = [+2.176396047205926e-01   +7.994380777124435e-02   +3.177587250307876e-01   +1.664829151918427e-01   +2.686456609060835e-01   +1.464197541185839e-02   +8.237426105392713e-03   +3.176839258190534e-01; +5.530356065948544e-02   +4.503350659522932e-02   +6.097243337625130e-02   +2.959109891837308e-01   +2.669423730666860e-01   +1.369780422448136e-01   +2.452100295054325e-01   +1.695417495369944e-01; +2.955295963944853e-01   +2.619650949592312e-01   +2.890380474387012e-01   +2.620726365216023e-01   +1.823279793447344e-01   +1.772793877107489e-01   +1.717938495887959e-01   +2.517615990344124e-01; +1.390861950303470e-01   +5.735401918034489e-02   +3.135149393460469e-01   +1.492072046377614e-01   +3.355351642321711e-01   +5.152077183324608e-02   +1.546675578956649e-01   +2.983593113992393e-01; +2.424239185383010e-01   +2.974765983773640e-01   +2.245746130613715e-01   +2.136217497458424e-01   +3.203790032421172e-01   +2.569514589640755e-01   +1.385189487121558e-01   +2.580966066004758e-01; +2.153668411782030e-01   +1.183429191323797e-02   +3.059592054514635e-01   +2.563534799845192e-01   +1.836822362663099e-01   +6.850236496688566e-02   +3.938766411554488e-02   +2.499187150503023e-01; +3.314144473571864e-01   +1.622872970068967e-01   +5.766200376819050e-02   +1.653581943778822e-02   +4.270262673076113e-02   +7.593111626802716e-02   +5.338686145486130e-02   +5.996845892808976e-02; +3.194060345592590e-01   +1.139077913877289e-01   +1.915771725122963e-01   +1.739459353596038e-01   +3.045007567004472e-01   +8.323265733078025e-02   +4.076517563828931e-02   +1.098605569881024e-02];
L2E_L2I_iGABA_netcon = [+3.262458920646605e-01   +8.290943018875652e-02   +7.238640014874122e-02   +6.484944986020248e-02   +2.357837292441639e-01   +1.270599272274742e-01   +2.910231768010860e-01   +3.292134732561742e-01; +8.691473746452617e-02   +1.453205793613233e-01   +4.718247021083670e-02   +9.080734446240089e-04   +3.482448131724710e-01   +2.440421097396289e-01   +2.655540752479936e-01   +2.546738663447732e-02; +2.287468389632870e-01   +1.201696538856280e-01   +1.938952973523451e-01   +1.958791629480341e-02   +1.364083748272872e-01   +2.956986481296984e-02   +3.410634124467787e-01   +2.886489520054076e-01; +3.007556253900799e-01   +2.632722648728716e-02   +9.231372260169057e-02   +2.554451209409409e-01   +3.197683544625070e-01   +2.236931575062591e-01   +1.552284893077091e-01   +2.314850137409777e-01; +5.761011054027362e-02   +3.167608210696040e-01   +2.458682540861933e-02   +2.919626646349707e-01   +1.049187800007928e-01   +1.291853638828414e-01   +1.556043180062559e-02   +9.591160848287689e-02; +2.637729725203297e-01   +8.965825012099828e-03   +1.882008306189012e-01   +2.763310994080110e-01   +3.074778823723325e-01   +9.413951814819302e-02   +3.323683220917349e-01   +2.701967081645789e-01; +5.596800068285060e-02   +3.431982666133716e-01   +1.055699459812895e-01   +1.063879115257473e-02   +2.514480574903760e-01   +1.813387752313748e-01   +2.083458174124111e-01   +2.173857958497623e-01; +3.038693085525101e-01   +1.076770633724631e-01   +1.786114551152629e-01   +7.058165534593674e-02   +1.562501423983342e-01   +2.742550291736824e-01   +3.305495722907545e-01   +2.181552987602416e-01];
L3E_L2E_iAMPA_netcon = [+1.224007212325863e-01   +2.250045843079868e-01   +5.305389393114896e-02   +2.413011353078639e-02   +1.924949602937133e-03   +3.434944798682266e-01   +1.346042094922728e-01   +2.993804343213408e-01   +3.995852920462284e-02   +9.921317975902409e-02   +9.739524424853244e-02   +2.116373514713921e-02; +9.450275289690946e-02   +3.109142501982984e-01   +1.050071904387002e-01   +1.314336863032378e-01   +1.586322585341416e-01   +1.923864609009370e-01   +3.186738619097019e-01   +3.438232578365049e-01   +1.985926348522462e-01   +3.347788436118821e-01   +1.196542107427995e-01   +9.033797263637179e-02; +3.391258847057915e-02   +2.605595457031822e-01   +3.929193980581161e-02   +2.543092660670660e-01   +6.670648599937841e-04   +3.096227155147489e-03   +1.855559576496628e-01   +3.401085566558901e-01   +2.070990597814532e-01   +2.135066458516013e-01   +8.505756656521526e-02   +2.461977212126589e-01; +1.536922816757510e-02   +6.875870841611358e-02   +2.833086132785838e-01   +8.654313092686879e-02   +1.001974623630330e-01   +1.160429289844455e-03   +1.209353881944523e-01   +2.440077651965922e-02   +7.580649382848319e-02   +1.128961826022355e-01   +6.842721273795664e-02   +1.161069301669397e-01; +3.153310927870146e-01   +1.292535092448519e-01   +1.200958333210435e-01   +3.446643606384840e-01   +2.375261977612408e-01   +1.255498174735514e-01   +3.402807660533567e-01   +5.706513840764645e-02   +2.944560292485954e-01   +1.679126425751022e-01   +2.411240200789904e-01   +1.416086507106546e-01; +3.028856492876033e-01   +2.121617318941462e-01   +3.651749829246460e-02   +1.722085935828938e-01   +2.228045828792775e-01   +3.169392124517106e-01   +3.075564303451459e-01   +1.313296481788680e-01   +1.620952172696322e-01   +1.168009802950998e-04   +2.193893932496197e-01   +8.793005473699463e-02; +2.191467459599584e-01   +1.769832086482027e-01   +2.198724592830049e-01   +7.239338786945693e-02   +2.366135736041699e-02   +1.251929948169671e-01   +8.866064259503876e-04   +1.268729640513041e-01   +1.016802300637407e-01   +3.347130893437299e-02   +6.347218323609397e-04   +1.627099269421823e-01; +2.973479502623593e-01   +3.646928647394555e-02   +2.948904353327400e-03   +9.117765568446944e-02   +1.901752194285662e-01   +3.728798383643172e-02   +6.885388357908975e-03   +1.676959813891383e-01   +1.730781840399673e-01   +2.973519495402671e-01   +3.253998235629148e-02   +2.085578338908484e-01];
L3I_L2I_iGABA_netcon = [+3.418769288331557e-01   +1.726066899412572e-01   +2.297799297810410e-01   +9.750843474455875e-02   +3.309843685226453e-01   +1.507748997075619e-01   +1.655669551019797e-02   +7.261489572269339e-03   +3.025352108829003e-01   +1.561398782565756e-01   +3.761136940078796e-02   +2.590864668945966e-01; +3.143600121669549e-01   +3.386616681731799e-01   +3.074463959954306e-01   +5.212702020225667e-02   +1.769754813122353e-01   +2.885351312638103e-01   +2.275850725756990e-02   +7.510141344245000e-02   +1.717512162981246e-01   +2.355962289365800e-01   +4.052223279183377e-02   +2.213466359594859e-01; +3.425835085569229e-02   +3.004108106317177e-01   +3.138059946578208e-01   +5.339679621546195e-03   +2.486515641569763e-01   -1.823444590557288e-05   +2.173578319050438e-01   +3.294957759568429e-01   +2.483591118968115e-01   +9.476904446440032e-03   +2.133891565194417e-01   +3.917004853634933e-02; +3.354841863550369e-01   +1.461498211929774e-02   +1.535404886884278e-02   +2.263829931473804e-01   +3.091332254789645e-01   +1.928466814597629e-01   +5.492625087167070e-03   +4.028736733660363e-03   +3.023893036367551e-01   +2.891948909476897e-01   +3.464712154718524e-01   +1.915381438805840e-01; +5.463911479306095e-02   +3.359646597133361e-01   +1.480482592617619e-01   +1.520085506064780e-01   +2.025194741565423e-01   +3.242547945155516e-01   +1.388768618219007e-01   +5.954747567634345e-02   +3.546688990117761e-01   +1.753035566066617e-01   +7.483296041228586e-02   +6.632903879432633e-02; +1.184615122355554e-02   +2.375722906744458e-01   +7.090862175737829e-02   -2.432168415792105e-03   +5.681371597171705e-02   +2.245912323748893e-01   +2.423118012561922e-01   +8.262174291114240e-02   +1.947960287735463e-02   +2.642236143101087e-01   +3.055895356446625e-01   +2.422888543857541e-02; +2.168897891541886e-01   +3.066024818451454e-01   +2.010047587038964e-01   +2.287161721246670e-01   +1.506596507349940e-01   +1.064644922402267e-01   +2.413968519036782e-01   +1.267004388873664e-03   +2.968979828822428e-01   +1.334198441737386e-01   +1.719729458425868e-01   +2.496141441721497e-01; +1.757029082794645e-01   +7.661467863212623e-02   +1.091478231888854e-01   +2.060295529076272e-01   +1.200785286795667e-01   +4.475615047340109e-02   +8.068461983326343e-02   +9.691166568994532e-02   +1.942064986841148e-01   +3.387625920406553e-01   +9.815650252123645e-02   +1.027195922890037e-01];
L2E_L3E_iAMPA_netcon = [+2.344333479096134e-01   +2.291876705312763e-01   +7.672992144834570e-02   +3.035657863598835e-01   +1.971120978762368e-02   +1.811088933922615e-01   +2.373566138590140e-01   +3.269567391501446e-01; +1.906026593829897e-01   +2.552102957047475e-01   +2.572410157945192e-01   +2.787191410493465e-01   +3.690601404486116e-02   +1.782943477865042e-01   +2.998366243137973e-01   +2.401388076677352e-01; +2.939525571536987e-01   +3.087788635463156e-01   +2.915063079056389e-01   +3.183630666928610e-01   +2.037032192811392e-01   +2.289075201542357e-01   +3.078313060119662e-01   +2.027192439083638e-01; +1.395407842925754e-01   +3.338390808061542e-01   +3.002752596434182e-01   +2.120779102504622e-01   +1.827677949618714e-01   +1.784195050598569e-01   +9.454618465901368e-02   +6.372962144336948e-02; +4.887261009375010e-02   +1.973826780668133e-01   +8.817037082449843e-02   +3.144652319713660e-02   +6.141247349608292e-02   +1.906187412400075e-01   +3.120032182694628e-01   +2.665284059266733e-01; +1.736515238704684e-01   +3.453299568022742e-01   +3.130641641590857e-01   +1.917954359314361e-01   +1.783028377310682e-01   +3.372703883958947e-01   +2.518335808207164e-01   +3.415027327368180e-01; +1.695339451200960e-01   +3.970859579516429e-02   +1.811912975435351e-01   +8.912446027731008e-03   +1.245000557888697e-01   +2.817413426986540e-01   +1.222531003229983e-01   +2.679680504557513e-01; +3.268268846760648e-01   +2.400193935503603e-01   +1.529718362049894e-01   +2.746124107244100e-01   +1.215975216541256e-01   +2.661587012045071e-01   +1.795853626834781e-01   +1.484362174259639e-01; +1.610417958059962e-01   +1.946350045729432e-01   +3.082615133402737e-01   +2.170121588039259e-01   +1.992848519562079e-01   +1.198726536106251e-01   +2.110325101456255e-01   +2.344355613734162e-01; +9.775757869552620e-02   +5.455677504395489e-02   +2.732404499626936e-01   +3.040112803699700e-01   +3.122867936260214e-01   +5.492674196783913e-03   +4.750550991734744e-02   +2.242753457192196e-01; +1.999246124560429e-01   +1.151324327450704e-01   +2.584514126403815e-01   +2.851815274374681e-01   +3.291191251978581e-01   +3.371550219900779e-01   +8.955686171796909e-02   +1.289248323091977e-01; +3.903463272826669e-02   +2.071802081787382e-01   +1.472932343000930e-01   +3.009452524289262e-01   +1.721296373273832e-01   +6.999442822747697e-02   +2.287317867566653e-01   +2.993569574523033e-01];
L2I_L3I_iGABA_netcon = [+3.316394202480985e-01   +1.447689585923623e-01   +9.737012404934485e-02   +2.468582787767964e-01   +2.582522284674715e-01   +2.942004404600793e-01   +1.161398325301133e-02   +1.859682812477576e-01; +1.890786383712519e-01   +1.647534439265843e-01   +2.462223264326235e-01   +6.288511753640383e-02   +3.098639424203278e-01   +2.839969589674560e-01   +1.605051916095906e-01   +8.671484446629077e-02; +2.744724085430376e-01   +2.526427618776785e-01   +3.294658090993551e-01   +2.139169845756505e-01   +1.234505180401840e-01   +2.108804820235384e-01   +1.395012406588678e-01   +5.999630151050504e-02; +7.415419661923585e-02   +2.892306992522980e-01   +7.839320947161203e-02   +1.698608842837526e-01   +1.353577763009597e-02   +1.216726676801955e-01   +1.326654601523138e-01   +3.402837356829041e-01; +1.072591319340464e-01   +1.361859125575409e-01   +1.824018773693087e-01   +1.652690546160070e-01   +1.263214669902665e-01   +2.227655371585062e-01   +3.515388139045080e-02   +4.963528449365107e-02; +7.292158580048200e-03   +9.065798898357161e-02   +1.481013530975089e-01   +6.245550662139331e-02   +1.226696446380994e-01   +1.397037184391245e-01   +1.832274882610386e-01   +2.443644296729583e-01; +1.218148280228966e-01   +1.612977687500727e-01   +3.255999148524711e-01   +2.279562358718061e-01   +2.537399446281837e-01   +1.065129806861847e-01   +1.138403108873513e-01   +1.080699614175397e-01; +1.120271070858350e-02   +3.421676216392159e-01   +1.110831529171119e-01   +3.061133746978194e-01   -4.367330076297276e-03   +2.624732070588762e-01   +1.996655485613264e-01   +2.670207830666594e-01; +3.101531550279321e-01   +1.014847550826539e-01   +2.909468349869075e-01   +2.185528096371122e-02   +1.745747484911034e-01   +9.687447422939988e-02   +1.437164752572535e-01   +1.584959564659609e-01; +2.651613707878954e-01   +1.747119886549049e-01   +8.943613250971216e-02   +1.751516406863821e-01   +2.163107908027994e-01   +1.179630752151601e-01   +7.205961742298163e-02   +1.036969052880147e-01; +2.520036643219219e-01   +3.374728976636043e-01   +1.893601956704684e-01   +2.396637353385694e-01   +1.004955040752645e-01   +1.276436935007099e-01   +3.288684757021935e-01   +4.501479954274188e-02; +2.632804795477200e-01   +1.054379859129985e-03   +1.193055702057406e-01   +4.860832760271859e-02   +5.047923395102930e-02   +3.381343757788944e-01   +1.721303762444974e-01   +1.918150151364015e-01];
L3I_L3E_iAMPA_netcon = [+1.524392658233225e-01   +3.466701775750884e-01   +9.070452849641225e-02   +2.157416624321827e-01   +2.695190384466282e-01   +1.122420093600791e-01   +1.025793669863616e-01   +8.199148815748127e-02   +1.168543024497061e-01   +9.577782310510013e-02   +9.535367248809427e-02   +1.866696674312373e-02; +1.373587789474749e-01   +2.966016995550186e-01   +7.791009175938508e-02   +4.872330024992343e-02   +2.861814827456827e-02   +1.883484748577437e-01   +1.902251023028743e-01   +1.951267661966001e-01   +8.101875404291593e-02   +1.710492555529344e-01   +2.621154402112465e-01   +1.967131555728846e-01; +1.159533102076389e-02   +2.170253289012563e-01   +1.644165227095406e-01   +2.040222330662661e-01   +1.693754024591794e-01   +1.583028968442424e-01   +1.772837551519315e-01   +1.574708650227176e-01   +1.259326330037811e-01   +1.967785795231779e-01   +1.599199805561831e-01   +1.935745082882985e-01; +1.386833468542866e-01   +2.588401930114096e-01   +2.208573654044692e-01   +1.513861304379841e-01   +1.546991371662220e-01   +3.089166087333473e-01   +2.648887769648969e-01   +4.484969967111745e-02   +3.238803486001221e-01   +3.161989949391959e-01   +5.744528130671323e-02   +2.591898390256468e-01; +3.828341283303139e-02   +1.191941249793238e-01   +1.023222407107097e-02   +2.964684979576776e-01   +2.677081461082536e-01   +1.920947046407624e-01   +3.354958713470896e-01   +2.313308261737753e-02   +3.094735840164167e-01   +1.998572805769480e-01   +1.309105133121088e-01   +4.234986876355418e-02; +1.192549698966399e-01   +2.369890907570693e-01   +2.894747231026217e-01   +1.481170845488820e-01   +3.455820597423977e-01   +5.051691405318982e-03   +3.143159415084363e-01   +9.111051208102053e-02   +2.367183947738642e-01   +8.293383507668790e-03   +1.197098344444691e-01   +5.447225016781613e-02; +2.827812331612604e-01   +1.275089017079585e-01   +1.369898398809467e-01   +9.927610100160558e-02   +2.316228640637121e-01   +7.185120762557511e-02   +1.944150981214114e-01   +3.227962618938847e-01   +2.912398093111149e-01   +3.399443227330546e-01   +1.819994735479893e-01   +2.512593949594600e-01; +2.565276156078749e-01   +7.603790636104441e-02   +2.521849103680523e-01   +2.060303973247044e-01   +3.429639275518452e-01   +2.077542377753847e-01   +3.508856597599842e-02   +1.737713454641795e-01   +1.531139628423112e-01   +1.057441624351109e-01   +8.474721609506418e-02   +3.271310683477398e-01; +3.406986971347926e-02   +2.963881801062087e-01   +2.528802807999391e-01   +2.833941970802787e-01   +1.303653605446039e-01   +2.556191399673103e-01   +6.113379615611279e-02   +2.770847001694628e-01   +2.889936351832354e-01   +1.626144678732025e-01   +7.079002778212003e-02   +7.997637925106518e-02; +3.209996268227678e-01   +2.738364352293592e-01   +1.373652285807569e-01   +8.028254891202780e-02   +1.988487497124781e-01   +2.702001148857580e-01   +1.767173897913006e-01   +3.043336393472170e-01   +2.327565987222742e-01   +1.167875016062432e-01   +3.108953599741354e-01   +7.666604129178438e-02; +1.539589930370495e-01   +1.218824260584703e-01   +3.435786879094638e-01   +3.314013846513578e-01   +6.051751466857064e-03   +2.172878204175719e-01   +2.667861648264528e-02   +8.369231294998089e-02   +1.675742880929665e-02   +3.357682189165022e-01   +2.615975496388870e-01   +1.262536024449844e-01; +3.693756576152975e-02   +6.221964090118660e-02   +1.688257757183815e-02   +1.567845331767158e-01   +1.511478474715081e-01   +8.036009139063456e-02   +2.754957928901971e-01   +6.450623289244005e-02   +1.142977371177838e-01   +8.206969755572885e-02   +2.677090179708613e-01   +9.726432910483815e-02];
L3E_L3I_iGABA_netcon = [+6.587263836312919e-02   +1.603588397994478e-01   +1.135916068136733e-01   +3.180689949755721e-01   +2.875373000361929e-01   +1.889427628099218e-01   +1.111736218248162e-01   +2.633157054636386e-01   +2.207871157587349e-01   +2.544654612192810e-01   +2.105002659623965e-01   +8.086428743440005e-02; +2.707079015273696e-01   +2.248087653260479e-01   +1.048964126587095e-01   +7.487934100407844e-03   +1.291775450077913e-01   +2.483608004208067e-01   +2.254246685144667e-01   +3.419393391458687e-01   +2.972683140573920e-01   +1.570500781703912e-01   +3.799672293528838e-02   +1.655260241047050e-03; +2.042111775755018e-01   +3.351488195722789e-01   +3.316608837303214e-01   +2.931426724618360e-01   +8.076658812897305e-03   +2.605819709185436e-01   +2.021410720846037e-01   +2.451904508589915e-01   +1.423885766123716e-01   +1.440526306993365e-01   +9.607402091531154e-02   +5.125259820038663e-02; +1.465075002626975e-01   +4.571340491751934e-03   +5.163286385113967e-02   +2.510472939731985e-01   +2.521862800432275e-01   +9.259511742399525e-02   +1.437656254295818e-01   +1.325398524634328e-01   +3.459013646586432e-01   +1.607495753389810e-01   +1.597402752609208e-02   +2.074519511963892e-01; +1.509857490641151e-01   +1.359595245646498e-01   +3.466419590233185e-01   +9.810634111933707e-02   +1.881902930949091e-01   +2.694201220399396e-01   +3.394656413851402e-01   +3.226879944222323e-01   +9.060053430456234e-02   +1.988611043648267e-01   +2.918337699609334e-01   +2.149893122756601e-02; +2.400097729333716e-01   +1.660660334052956e-01   +2.920070809214811e-01   +3.531128210063125e-02   +1.415305621429541e-02   +3.454723570360622e-01   +3.326981880098177e-02   +2.473713710817907e-02   +2.843303524763799e-01   +2.140859746488007e-01   +9.160864714120011e-02   +7.613170740014606e-02; +2.024141826205018e-01   +1.255085393365795e-01   +1.690332552002915e-01   +2.060021755376818e-01   +2.377767748802513e-01   +1.664038207755258e-01   +1.174876380067951e-01   +8.426661152129802e-03   +1.191473439301615e-01   +6.072420031929118e-02   +1.093389566279508e-01   +2.496491673863666e-01; +1.057058954668663e-01   +5.686954451379835e-02   +4.601001862026535e-02   +3.180627123012082e-01   +1.529304817017786e-01   +2.628939298683302e-01   +1.817485937645768e-01   +2.659110097859681e-01   +2.666517169682888e-01   +2.961859594677380e-01   +5.863098580738627e-02   +2.013533483304551e-01; +9.753080073714920e-02   +6.415836932389737e-02   +2.719722572200294e-01   +1.491121565228984e-02   +3.271719207161117e-01   +3.155748073296424e-01   +6.516302989725799e-02   +2.471853344676693e-01   +8.179306316770674e-02   +1.458561324755362e-01   +1.462496658885683e-01   +2.168262243315841e-01; +2.864795635118103e-01   +1.098802731652841e-01   +2.924672809631050e-01   +1.151037657267036e-01   +1.266082565049947e-01   +3.425940159865528e-01   +2.645649598451715e-01   +1.963549720084272e-01   +3.259656024954929e-01   +3.356968584865510e-01   +6.028315336121926e-02   +1.336930486147117e-02; +1.971528762912825e-01   +4.893932660064024e-02   +6.987298195009919e-02   +6.575809804799651e-02   +2.733508314834523e-01   +1.781985453028650e-01   +3.028437285447702e-01   +2.135547840963139e-01   +1.972115242444524e-01   +6.118611327671922e-02   +3.261282092070916e-02   +2.839019779119163e-01; +2.181084977994235e-01   +1.756865330594108e-01   +3.485986971623619e-01   +2.512861097616302e-01   +9.029483755388363e-03   +1.772371826722467e-01   +3.402129310081450e-01   +2.318345579264574e-02   +2.734361068085420e-01   +1.403192903900789e-01   +1.628456666791470e-01   +1.534940105446314e-01];
L2E_Input1_iAMPA_netcon = [+3.465593575519623e-01   +3.479726432969220e-01   +3.464715385427212e-01   +3.505593512200942e-01   +3.519761451253817e-01   +3.527209488701588e-01   +3.523384803168950e-01   +3.452306242654201e-01];
L2I_Input2_iAMPA_netcon = [+3.499928924485196e-01   +3.513413767135938e-01   +3.504597031871743e-01   +3.472938284094720e-01   +3.497717612334341e-01   +3.467455113660278e-01   +3.502627843484541e-01   +3.487640287122286e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
