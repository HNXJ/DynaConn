function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.468060818359290e-01   +4.261124858471504e-02   -7.198165552846202e-02   +9.566243435427474e-02   +1.816147689846506e-01   +8.178568872709044e-02   +1.381077792794044e-01   -2.001114391050385e-02   -2.570097094933078e-02   +2.590086536164287e-02   +1.606018628594666e-01   +1.177161970084812e-02   +9.166365877749551e-02   +1.360609991020158e-01   +1.079188664420572e-01   +6.538026149268221e-02; +1.460898790968235e-01   +9.051026123900277e-02   +6.331505347171140e-02   +9.847998811195349e-02   +3.629090887143181e-02   +8.328992888888027e-02   +1.244861239924577e-01   +1.186020537754952e-02   +1.390844297418457e-02   +4.700201442260085e-02   +4.472561011354560e-02   +9.256829685454623e-02   -2.485286291863984e-02   +1.786128402894233e-01   -5.101868566679776e-02   +1.583057391330090e-01; +1.208452213843029e-01   +2.828852580363225e-02   +1.544998275649317e-01   +9.303881235480974e-02   +1.052552244027191e-01   -4.745180307177877e-03   +1.773040407876545e-01   +4.317643853133191e-02   +8.088923999712472e-02   -5.162060943955042e-02   +6.322150229684288e-03   +1.081455030162119e-01   +2.751187432141068e-02   -2.197002797418501e-02   +1.598102609242598e-01   +4.197960326772988e-03; +9.817914273195577e-02   +5.663728524862825e-02   +4.351962943990455e-02   +6.046845134900840e-02   -1.013772282505497e-02   +1.307162824051372e-01   +1.321736190864758e-01   +4.062020199703350e-02   +1.621961533791583e-01   +2.476660976383520e-02   +1.162581344335638e-01   +1.357533238136241e-01   +1.466538707951735e-01   +1.402136902251859e-01   -2.144996088644271e-02   +3.191063421806201e-02; +5.339535103745805e-03   +1.031135970492615e-01   +6.849080764787801e-03   +1.692801687114970e-02   +2.493990352165468e-02   +8.861149521184188e-02   +5.510798408977839e-02   +2.211336647809030e-03   +1.091194813133024e-01   +8.445746487560531e-02   +5.806361382955589e-02   +1.553507964874336e-01   +9.243320905528191e-02   +1.008988084157719e-01   +4.685889193376766e-02   +1.208645505594019e-01; -2.924161939406342e-03   +7.904738013450602e-02   +9.146384053482098e-02   -5.016151862968739e-02   +1.589685456222071e-01   +1.458095707233771e-01   +8.300279665882811e-02   +1.000908956303608e-01   +4.874656841637545e-02   +1.487732342274651e-02   +6.534326965592840e-02   +3.381836814716749e-02   +6.950843587979100e-02   +1.092256752271272e-01   +9.728614694984167e-02   +1.986003783987828e-01; +1.249243719059274e-01   +2.503634836910639e-02   +1.262072226670101e-01   +8.672317506205798e-02   +8.377023101019541e-02   +1.772795718686976e-01   +1.259749590273918e-01   +2.452892596595835e-02   +5.235751756219265e-02   +1.640398824287058e-01   -7.066790914054372e-03   +6.322373236167253e-02   +6.744317652893840e-02   +3.896938413008891e-02   +1.042313381027569e-01   -5.282414376522018e-03; +1.864477994899661e-02   +1.100601780805580e-01   +7.225358021864783e-02   +6.371677688392072e-02   +9.489393482790102e-02   +9.376409629560238e-02   +6.657934715934162e-02   +4.930878624976533e-02   +1.313069630154205e-01   +3.459280998985437e-02   +5.427322934259731e-03   +6.750352216082468e-02   +6.532021463796137e-02   +1.870509147039448e-02   +4.804809501884490e-02   +8.140344097618664e-03; +1.441019027918979e-01   +1.457366564200510e-01   +7.933481736719218e-02   +2.095236057118715e-01   +2.954972819394371e-02   +9.813545577075278e-03   -1.988301804427313e-02   +4.188448375919492e-02   +1.042416968351938e-01   -1.816979309495291e-02   +3.292230228503422e-02   +5.022268023111798e-02   -4.802576905368552e-02   +1.637004101501982e-01   +4.054406024430842e-02   +6.187379609222381e-02; -2.465444229897863e-02   -2.849530909111546e-05   +1.584691015311739e-01   -6.270112054482443e-02   +8.682380490928975e-02   +1.362413929799144e-01   +8.781744973637921e-03   +9.148098013413131e-02   +3.364357897982641e-02   +8.087679642270282e-02   +1.763689170464915e-01   +5.381948143461516e-02   +5.827367849559367e-02   +6.320767806031899e-02   +8.532582436082455e-02   +1.033531137987711e-01; +7.026893157809097e-02   +3.761746684246170e-02   +3.500596249815564e-02   +9.488971728567124e-02   +1.125513872504275e-01   +1.328397706793719e-02   +1.035171733108385e-01   +9.543261744507961e-02   -1.746894658857308e-02   +9.919207088433293e-02   +2.212263886482103e-02   +1.247968446440900e-01   +1.050447253735427e-01   +7.713714301408083e-02   -2.823793622141116e-02   +6.198772715182149e-02; +8.154392621598872e-02   +6.370517322058736e-02   +1.091866316356508e-01   +5.012423365321023e-02   +1.454364050987509e-01   +7.567401113229573e-02   +8.892127942425561e-02   -1.114032071753829e-02   +1.342578246292607e-01   -5.127106986702219e-05   +9.654103194481119e-02   +8.565639434771784e-02   -1.923029456282098e-02   +4.133772725678594e-03   +9.508476016244133e-02   +5.511448915660788e-02; +1.573951164472572e-01   +1.042130339619061e-01   +8.097794477471577e-02   +6.263629570367868e-02   -2.693686959470466e-02   -4.873064938645096e-03   +8.484365936598538e-02   +3.750579300425566e-02   +7.809606608710074e-02   +7.998369341910274e-03   +7.288392466451728e-02   +5.653118177268226e-02   -4.947387050957797e-03   +1.300483862311395e-02   +1.574682770946553e-01   +8.529792321596677e-02; +3.162447563866549e-02   +3.841024847452500e-02   +7.244424852735372e-02   +6.049649693345092e-02   +4.291820277870421e-02   +4.582336719594315e-02   +1.623257686596889e-01   +1.505275295420164e-01   -6.831710161399261e-03   +2.767282212659596e-02   +1.705051453202984e-01   -2.600757842798717e-02   +4.386141922211585e-02   +1.682640097753177e-02   +9.797255269549759e-02   +1.162438494773301e-01; +1.076447198033413e-01   +9.394564970603046e-02   +3.136850838181101e-02   +1.309439452592402e-01   +3.076727977805906e-02   -2.039488998749270e-02   +1.104613197308999e-01   +1.263822873665263e-01   +2.925887513643837e-02   +1.013761353502655e-01   +2.708994763237814e-02   +2.429072090522228e-02   +6.708715614948697e-02   +9.681544781320753e-02   +9.548337603451461e-02   +1.070470552173837e-01; +7.439928414043903e-02   +6.206822680071824e-02   +4.982140478157768e-02   +1.179310742150775e-01   +1.741924346833872e-01   +7.406818324139673e-02   +5.323926557068425e-03   +1.057176321851874e-03   +3.081730353462093e-02   -5.897466792573821e-02   +6.740593947287130e-02   +1.207560634757986e-01   +1.406471372157458e-01   +3.843625992562572e-02   +5.347721174000808e-02   +1.066386636392282e-01];
L1E_L1I_iGABA_netcon = [+2.849401104260827e-02   +1.875139827347344e-02   +8.166826078735885e-02   +8.594572600226101e-02   +7.132406039333279e-02   +9.959544042693620e-02   +5.449819136524048e-02   +1.064769401921528e-01   -1.622334635629781e-02   +1.323826562396535e-01   -5.193726934351339e-02   -3.421661202787016e-03   +1.372178055804146e-01   +6.003843716635845e-02   +1.359976707127227e-02   +1.147389370791195e-01; +6.868235552931144e-02   -2.639333932412067e-02   +1.848391370254512e-02   +7.031324735025860e-02   -1.669385375578399e-02   +6.396998292489625e-02   +2.175028202238553e-02   +6.970577826790954e-02   +1.182008634472546e-01   +1.055117305194330e-01   +8.152291721847038e-02   +3.830956883826489e-02   +2.603644792325930e-02   +9.090058975337402e-02   +1.017384568364457e-01   +7.573483455727728e-02; +3.145105160617775e-02   +1.277676843831118e-01   +5.366072930184636e-02   +1.407445847860857e-01   +6.203004553081196e-02   +4.856966524275200e-02   +2.628457804223156e-02   +1.944196101688029e-02   +3.254620007491885e-02   +1.154154328902406e-01   +6.705744696915103e-02   +5.706719032859521e-02   +1.390117651519137e-01   +3.801952767618784e-03   -1.030770875411657e-02   -8.999294779299848e-03; +1.847800288757109e-02   +6.005984192806493e-02   +1.271309776179149e-02   +4.519399342963029e-02   +1.135288779868800e-01   +2.215449829680680e-02   +1.073655976822212e-01   +1.599099582532802e-01   +4.908118491331516e-02   -2.290554642119336e-02   -2.905824939330912e-02   -3.829769393524847e-02   +1.490179678792466e-03   +1.474797029347648e-01   +6.643059686595755e-02   +9.386881850940978e-02; +1.890436513855271e-01   +3.614714682869256e-02   +6.652125971438379e-02   +4.961530304649449e-02   +1.279702912859719e-01   +2.590003901995130e-02   -4.641045106653995e-02   +9.108422693756616e-03   +5.712001118570189e-02   +8.224382211874343e-02   -1.224633688590748e-02   +6.971621506710242e-02   +1.690483553254204e-01   +1.242417912999237e-02   +6.168240228575912e-02   -9.896000243515357e-03; +4.587388059991269e-02   +1.450707232320935e-01   +8.809730641360981e-02   +3.414411004996622e-02   +1.401008823665679e-02   +3.909140032909844e-02   +7.850457136132602e-02   +9.965884828047314e-02   +8.498215591007734e-02   +8.368745324293647e-02   +8.296507320229184e-02   +1.160519734620788e-01   +2.293908195490670e-02   +5.281636953656643e-02   +4.848112759773806e-02   +1.668294616669631e-01; +3.551062971251168e-02   +1.712522895880887e-02   +1.003974978671340e-01   +1.291871565107484e-01   +1.422281971174970e-01   +4.646795974800897e-02   +8.775518531498080e-02   +1.190645854292244e-01   +2.446258173368799e-02   +8.087869252399199e-02   +6.850722809772895e-02   +2.866325996510429e-02   +9.451375851433584e-02   +6.724003838610354e-02   +1.559027042348364e-03   +3.242042609417966e-02; -3.228745448003405e-02   +7.867876714212757e-02   +3.557372140482757e-04   +3.358999848370099e-02   -9.315324766424883e-03   +1.020646665807631e-01   +1.278717817009302e-01   +3.730532335462985e-02   +6.729603070138594e-02   +5.350974831270386e-02   -1.395612817913193e-02   +8.004403779614080e-02   +4.527464547489073e-02   -5.506050792107513e-03   +1.532397294128933e-02   +1.948726903612937e-02; +5.308753872432844e-02   +1.163459145273149e-01   +2.551100479587682e-02   +7.906906897676969e-02   +5.384578725151455e-02   +1.274414311249912e-01   +1.369993307569709e-01   +8.481095069858105e-02   +8.763965246448094e-02   +6.121353239402910e-02   +1.494143450487306e-01   +3.500653232745485e-02   +4.797602700935470e-02   +3.439226788725482e-02   +8.087515856426157e-02   +1.836903684663843e-01; +4.607025710198946e-02   -6.542913030284318e-02   +1.041459959120282e-01   +4.045806105943889e-02   +3.969053652416422e-02   +8.273602045163406e-02   +6.703306143695908e-02   +1.067235561057600e-01   +1.299793748965869e-02   +1.306830303082573e-01   +9.617784353848986e-03   +4.246296912679440e-03   +8.971816302298896e-02   +4.374822753182982e-02   +4.253952939872777e-02   +6.274547952463047e-02; +8.613906028966090e-02   +4.025908783366459e-02   -4.721997141679393e-02   +9.970486998877356e-02   +7.094626358065348e-02   +1.591734885139155e-01   +5.215395668839881e-02   +1.970752191490330e-01   +7.363878067898853e-02   +1.796020453521797e-01   +1.148430582466481e-01   +1.783197561846847e-01   +1.356561416417357e-01   +1.378973316768516e-02   +1.814078275031726e-01   +7.642143223569614e-02; -3.992184929520733e-02   +1.148899626248993e-01   +8.986936491008235e-02   -1.634419751206787e-02   -2.717901566104104e-02   +8.927335048755258e-02   +6.151399293616383e-02   +1.131484872176781e-01   +3.555787995450928e-02   -1.877389887822133e-02   -3.445286775694154e-02   +3.021897178558326e-02   +8.639599230257919e-02   +7.138512722993176e-02   +3.535768530553164e-02   +2.248865342827793e-02; +4.265247465052392e-02   +1.709172255807482e-01   +6.108454632554992e-02   -4.420760710258423e-02   -1.209722922326586e-02   +9.087729618776492e-02   +6.623482891825672e-02   +1.300159774662148e-01   +7.050702451053517e-02   +7.236139084453702e-02   +8.841291639417131e-02   +1.011323348008814e-01   +6.321253311795011e-02   +1.403623162249731e-01   +3.430414037445202e-02   -1.053017966072989e-02; +1.267530276677526e-01   +7.854670418391607e-03   +8.318788239420390e-02   +5.598175197072300e-02   +5.736019573824427e-02   +6.029124021434023e-03   +1.612067627122782e-01   -1.299213803271459e-03   +8.296938447517642e-02   +1.241322479870789e-01   +6.244567484643544e-02   +1.080861300305113e-01   -4.885688819309462e-02   +7.266318488350088e-02   +8.178198222700400e-02   +9.780465239929811e-02; +7.749489716178945e-02   -1.455428483876802e-03   +4.462537518638320e-02   +1.186274781119477e-02   +8.601700668471304e-02   +7.836258938082888e-02   -2.557505972720895e-02   +3.736601293762415e-02   +1.134699999157119e-02   +3.857357659140798e-02   +4.688622811143822e-02   +1.607685341066721e-02   +9.565984374528011e-02   +1.278521414490682e-01   +3.039962498643926e-02   +1.203834752556477e-01; +6.395330341183669e-02   -7.214144604512128e-04   +6.503761552244471e-03   +1.186170480039224e-02   +3.089650870019594e-02   +1.474394397494607e-01   +5.839110342661239e-02   +1.280945702211113e-02   +2.448563282022686e-02   +1.623039153457020e-01   +2.839229218676873e-02   +2.689702003998614e-02   -2.206874237289926e-02   +1.290183773530328e-01   +1.013183261175812e-01   -1.296324291401390e-02];
L2I_L1I_iGABA_netcon = [+5.148503885557502e-02   +7.469906731776461e-02   +1.172777890958211e-01   +4.679976290981828e-02   +1.321144032310720e-02   +5.566388319255414e-02   +1.576283095555703e-02   +1.139563391117307e-01; +1.003100162225096e-01   +8.118730708563386e-02   +1.426488777602574e-02   -1.601726493455099e-02   +1.197553648823184e-01   +1.643355867512989e-01   +8.321249305821543e-02   +6.545353505018368e-02; +7.448681621845717e-02   +6.501553474154967e-02   +5.207075595674740e-02   +3.077403993699782e-02   +8.801352203175848e-02   +2.565213644510046e-02   +1.264963535953098e-01   +9.425950922635412e-02; +4.489461106663164e-02   +7.678693671390303e-02   +1.807971631795048e-02   +1.776993223430129e-02   +5.979474330774187e-02   +1.176300016355934e-01   +1.202424911733917e-01   +1.508129459775450e-01; +1.192163268820737e-02   +1.610621236201146e-02   +1.480112051851463e-01   -1.251491720147402e-02   -1.817543574206517e-02   +1.414419651208969e-01   +1.475981703105005e-01   +1.192852893125758e-01; +7.296027717940061e-02   +9.326631877058768e-02   +1.395048081132960e-01   +1.238091873213930e-01   +6.698575056436819e-02   +8.569010511147387e-02   +5.587011855210682e-02   +1.240225091239022e-01; +2.067172097952870e-01   +7.324621080107691e-02   +6.395500277482358e-02   +6.497326681491500e-02   -5.413089432490008e-03   +2.098042336848144e-01   +3.641207106971435e-02   +1.224623654516741e-01; +3.267853897467507e-02   +1.125148158209615e-01   +4.607591896268629e-03   +1.554908222132758e-01   +1.197568050504983e-01   +7.911021264140682e-02   +1.016034916256820e-01   +4.907063808742890e-02; +1.555552441138496e-02   +2.461166609195737e-02   +1.646875408740275e-01   +1.252678950094418e-01   +6.114753087677457e-02   +4.752026019604565e-02   +2.242334925920108e-02   +1.051022734127681e-01; +1.136267629164755e-01   +4.762113201893753e-02   -1.319724516875002e-02   +1.184833617446697e-02   +1.658401103822713e-01   +1.212902991098613e-01   +5.842997201918599e-02   +9.164076081552286e-02; -2.335774367993405e-03   +2.340641171316815e-02   +1.242038519455202e-01   +4.860252564312553e-03   +1.002790155219939e-01   +6.859886288547877e-02   +1.304163560827139e-01   +4.374565052495295e-02; +3.346816433088145e-02   +1.024319528955289e-01   +4.120202980999454e-02   +1.193733550546972e-03   +9.003609232210995e-02   -2.141581735071753e-02   +1.450463710208717e-01   +1.213320622295550e-01; +4.633477725429393e-02   +3.851226828433010e-02   +2.512115579648367e-02   +1.022321471071003e-01   +6.991617227906688e-02   +8.763637143966412e-02   +6.243508561143962e-02   +1.545704039110860e-02; +6.055344246749993e-02   +1.561504617305257e-01   +2.690749155682436e-02   +3.292182512150250e-02   +8.063203799497692e-03   +9.258842139069340e-02   +1.369111389493735e-01   +4.833477745732997e-02; -2.172252726873339e-02   +9.199151293055542e-02   +3.365930884876106e-02   +6.091897395128748e-02   +1.821344786953915e-02   +6.191686685107614e-02   +7.898352656185097e-02   +1.292991891812721e-01; +2.056022873188385e-01   +4.812883517173352e-02   +2.992475583727534e-02   +1.663670554298791e-01   +1.960115816652009e-01   +1.366044464671450e-01   +6.376858404564635e-02   +1.323440442246073e-01];
L1I_L2I_iGABA_netcon = [+8.991177188337146e-02   +9.359465319320769e-02   -4.840967628063139e-02   +9.690732749700919e-02   +9.496028793929950e-02   +6.376777258149073e-02   +7.885891127055129e-02   +3.305201903577028e-02   +2.275075824613326e-02   +1.423253001486758e-01   +8.938416083062488e-02   +4.521758935134049e-02   -3.274249458647986e-02   +1.141044113613286e-01   +5.643240862338474e-02   -9.107578377972989e-02; +1.375845481676811e-01   +1.479473954619281e-01   +4.369452527478263e-02   +1.061006679934744e-01   +6.547179509468702e-03   +1.371880129700172e-01   +3.552064452081859e-02   +1.826421810527400e-01   +1.243465155062824e-01   +1.349225227373355e-01   +3.138074945265892e-02   +3.325876450298836e-02   +9.742993532096025e-02   +1.318709560266820e-01   +1.688520407644042e-01   -7.036336416177435e-03; +3.260365958303822e-02   +6.267365150497753e-02   -8.586639435373288e-03   -9.023943894255333e-03   +1.035662932282065e-01   +1.098635024203799e-01   +7.744700673193097e-02   +9.225513312828212e-02   +7.484069741528634e-02   +4.077760168758144e-02   -1.104337139296158e-02   +8.638199835558531e-03   +8.120436689688215e-02   +1.527575084665471e-01   +5.966991339322845e-03   +1.400516531946815e-02; +7.815759960289723e-02   +1.248293884422710e-01   +1.353054103191469e-01   +5.217034883278034e-02   +5.686595302830551e-02   +1.702104158363213e-01   +8.067528616339970e-02   +9.087849604079032e-02   +1.419824467643168e-01   +8.966523475963006e-02   +2.155327588704511e-01   -5.924730029763674e-03   +7.021310519695709e-02   +6.406271519033402e-02   +4.406559320402398e-02   +5.682357766626443e-02; +7.448725684251589e-02   -5.582219906228960e-02   +1.048874024859486e-01   +6.532526903839185e-02   +8.653591369361552e-03   +3.874652678571019e-02   +1.696348896208545e-01   +4.325618238416898e-03   +8.567665243073709e-02   +3.919853237768884e-02   +6.900458437061772e-02   +7.905686366471550e-02   +1.987096768495905e-02   +3.780489445446924e-02   +1.098081216781979e-03   -2.543594556468675e-02; +1.627532029106522e-02   +4.134049492492316e-02   +6.836556711800559e-03   +1.319716506200829e-02   +1.299975816724445e-01   +1.585929757365395e-01   -1.689101379960302e-02   +3.018943811435900e-02   +7.326661735693504e-02   +3.007901497810362e-02   +8.890017886136841e-03   +7.139366146458834e-02   +1.111861252795604e-01   +1.062217269170341e-01   +1.318793988073998e-01   -7.192509951287078e-03; +1.329820440916613e-01   +1.400979471570296e-01   +2.282848343335233e-02   -5.412244545639504e-02   +4.341871811355690e-02   +8.613433331249688e-02   +2.758788971963735e-02   +1.270322480810945e-02   +1.048185161221601e-01   +3.156524309592706e-02   +1.281907978826077e-01   +6.485119977274675e-02   +5.137900623343306e-02   +7.054418180733293e-02   +3.552160995279252e-02   +1.206233979911751e-01; +1.154981844820615e-01   +5.942463571910727e-02   +1.296933522439908e-02   +7.800463169963442e-02   +1.904187408515955e-01   +7.572963573302920e-02   +8.629157238682732e-02   +9.988444123463655e-02   +1.443360657819015e-01   +4.065777704565404e-02   +4.620233751261589e-02   +1.021617681046426e-01   +9.302912198356671e-02   +1.507749005136772e-01   +1.172447323585010e-01   +3.587610708513506e-02];
L2E_L1E_iAMPA_netcon = [-1.703497553433475e-02   +1.053746438096851e-01   +1.061823619657506e-01   +3.535317652357909e-02   +3.530450477499004e-02   +6.781152253693087e-02   +7.159398261046744e-02   -4.326401875692754e-02; +5.902776117810446e-03   +1.020150175452400e-02   +1.410735552166780e-02   +1.701525490873557e-01   +7.147767897075445e-02   +5.991273326610283e-03   +8.704026952463437e-02   +1.957679406997632e-01; -7.095306138809605e-03   -1.645126108487524e-02   +1.873530986574604e-01   +7.769836830992138e-02   +7.382004890215785e-02   +9.762230251082891e-02   +1.312639033372804e-01   +3.098760549305212e-02; +6.210520679105217e-03   +7.230203193811542e-02   +7.745368358876023e-02   +1.639493870268295e-02   +1.270112044377670e-01   +5.586119181254177e-02   +1.256613586261180e-01   -1.318081604927531e-02; +1.456113932058987e-01   +1.235736467435764e-01   +1.185996838861233e-01   +1.188639589676859e-01   -4.896909864385152e-02   -3.513625261604615e-02   +1.898630873872042e-02   +1.824475070720675e-01; +1.611198006948012e-01   +1.390985619063962e-01   +3.397506306282186e-02   +5.668200953579827e-02   +8.212146961663572e-02   +1.161567094707009e-01   +9.581035922016530e-02   +9.389153345309950e-02; +5.440084769181479e-02   +9.165103455730184e-02   +5.288041158149927e-02   +1.000296381641793e-01   +6.361439241974595e-02   +1.685492739060118e-01   +2.134287842760953e-01   -4.427985431770377e-03; +5.753984733749412e-02   -2.489600387330607e-02   +1.757510522895158e-02   +1.579027442990596e-01   +8.298288476134527e-02   +4.570890300401812e-02   +4.502310024457978e-02   +4.791325741598632e-02; +2.224484550807309e-01   +4.075985546354480e-02   +1.220860447190767e-01   +8.279148966859061e-02   +6.990201497022097e-02   +8.147585192961515e-02   +7.220449468567694e-02   +1.293128017327079e-01; +9.119791777932280e-02   +7.263902561553273e-02   +1.135563035539498e-01   -2.061407835129994e-03   +1.336289857290661e-01   +4.846153619442713e-02   +1.023849030749677e-01   +4.006928082736803e-02; +1.829562757449925e-02   +1.180197584587255e-01   +8.287928181975681e-03   +3.063181626658732e-02   +1.928857268903966e-01   +1.215807747414016e-01   -3.866094768671749e-03   +3.229134292911091e-02; +9.618109120014086e-02   +1.463740385891634e-02   +3.187974199121893e-02   +8.173931888812427e-02   -3.471120767461490e-03   +3.028942738729174e-02   +1.118397095014486e-01   +7.210660901103971e-02; +1.119836006490874e-01   +5.104238730422398e-02   +1.171492512856959e-01   -2.396192919660610e-03   +9.453377102126236e-02   +1.247552028467933e-02   +1.025549209700759e-01   +4.453533733687864e-02; +1.284440854478805e-01   +1.101267955967738e-01   +1.334474459495855e-01   +4.308668999010434e-02   +9.281677622579175e-02   +1.326537942861401e-01   +1.041114501565159e-01   +8.088169833996185e-02; -9.173494959229259e-03   +1.239675826793674e-01   +5.069436174827417e-02   +1.586396771705681e-02   +6.884539633856405e-03   +1.642823864981433e-01   +1.850290074317292e-02   +7.627096160590997e-02; +9.351180906905511e-02   +1.348804456090986e-01   +3.161034526817195e-02   +6.555877135976779e-02   +4.817442355981272e-02   +7.384248102772953e-02   +6.366379011766446e-02   +5.418760178884297e-02];
L1E_L2E_iAMPA_netcon = [+7.963882332748876e-02   +6.877951251797021e-02   +8.657371272931381e-02   +1.771993351319433e-04   +8.667976853868817e-02   +1.404722651164641e-01   +7.967092566309275e-02   +2.014821649248389e-01   +5.562865224063841e-02   +7.432275505448861e-02   +5.397273327467189e-02   +9.308013055766202e-02   +3.531010257711589e-02   +1.366650333239840e-02   +8.641642073244435e-02   +5.462275669509592e-02; +1.417038150180983e-01   +2.163585225878606e-01   +7.052322068319312e-02   +1.338730321173905e-01   +5.665093056145999e-02   +1.118629934600786e-01   +8.181350599764312e-02   +2.826592029111363e-02   -6.849333892475604e-03   -3.274602687629573e-02   +8.134018836936316e-02   +9.954295869992051e-02   -3.616151122215969e-03   +3.592779115522642e-02   +1.699605039794920e-01   +7.978134109928876e-02; +1.507854813937521e-02   +1.663055219430977e-01   +1.165135530206985e-02   +8.849897938583930e-02   +2.951929507484182e-02   +8.111273328888594e-02   -7.340605073243001e-02   +1.411705085897711e-01   +6.369782374496501e-03   +1.158509960388144e-01   +9.608655902683830e-02   +1.286577563050478e-03   +8.199049743755277e-02   +1.221486814350620e-01   +1.403429366600839e-01   +1.409883595552652e-01; +1.382352865699222e-01   -3.128975160811501e-02   +7.598905482217096e-02   +3.846449575038855e-02   +1.372205726027050e-01   +3.679894459218117e-02   +1.023273887533074e-01   +1.268222118202647e-01   +6.302027274119040e-02   +1.874858488513002e-01   +9.158040276169861e-02   +2.317065976565531e-02   +1.345783554489236e-01   +7.971787114519110e-02   +6.179594191754834e-02   +2.136932556783323e-02; +8.116482872346571e-02   -1.117251469890132e-02   +3.354624958245463e-02   +1.213735174210176e-01   +9.616201541536376e-02   +8.767765242887296e-02   +3.614370146536286e-02   +2.028934344893485e-01   +2.888226854442963e-02   +1.145947722788787e-01   +2.291295339011173e-02   +1.394471917696893e-01   +1.079851378092789e-01   +5.013594017080762e-02   +4.983329022455472e-02   +1.293945274843939e-01; +1.093626100816660e-01   +1.800326268419155e-01   -1.146920370703998e-02   +1.481225751075012e-01   -1.333816388051489e-02   +6.486344821512169e-02   +1.149782225567306e-01   +9.821750735495131e-02   +6.746484571864075e-02   +4.395323713278692e-02   -2.671711997472061e-02   +4.020437394027931e-02   -5.126479936583256e-03   +7.670626478499487e-02   +1.008801578861371e-01   +4.314599931041048e-02; +1.161333820199128e-01   +7.153093119403420e-02   +6.114920602622818e-03   -8.193700724796030e-02   +1.270940321004300e-01   +1.703942963018334e-01   +1.053854678061359e-01   -1.603417342663259e-02   +1.856201210741013e-02   +1.475427378822560e-02   +1.386010062600216e-01   +4.602861643742757e-02   -3.048362311396220e-02   +1.673126802191547e-02   +1.073705646510752e-01   +3.559919942250504e-02; +8.184991749891703e-03   +7.067363199290803e-02   +1.672606759603915e-03   +8.595312202314626e-02   +5.987917642272587e-02   +1.364228847622048e-01   +9.969572417346644e-02   -2.652764519019782e-02   +1.105732845384114e-01   +6.288232243380314e-02   +7.820058859083764e-02   +3.768391176330013e-02   +1.204932291494202e-01   +7.131635971827881e-02   +9.434628731768653e-02   +1.027444007617645e-01];
L2I_L2E_iAMPA_netcon = [+1.211326914455456e-01   +5.724858448533417e-02   +1.048635326128621e-01   +8.662579392330612e-02   +1.448034393756152e-01   +8.788645007683560e-03   +5.085214959542163e-02   +3.960882984249742e-02; +1.098624993629239e-01   +8.997181798988346e-02   +3.117127376356675e-02   +7.248595449459713e-02   +1.321094764917950e-01   -6.878488962885955e-03   +7.115362219310728e-02   +9.253337230744726e-02; +1.493472174750361e-01   +3.411229079160549e-02   +2.151479219318192e-02   +5.287739005369304e-02   +1.056856307616669e-01   +1.013573708316301e-01   +1.008591348198839e-01   +1.070340990860041e-01; +3.235351224043108e-02   +9.890267171327459e-02   -5.339760392725955e-02   +2.870666789798441e-02   +1.840365905527717e-01   +1.444016730406374e-01   +4.021290659371714e-02   -8.111385841164789e-03; +5.678256340157432e-02   +8.105930350703350e-02   +4.952318160549338e-02   +3.650484708838175e-02   +1.109426599943849e-01   +2.873788919788536e-02   +3.354187581367900e-02   +5.223164920436153e-02; +1.359959325736677e-01   +9.010693679528371e-02   +5.139685682871754e-02   +7.092999895047387e-02   +1.535325561295932e-01   +1.444449963901450e-01   +1.239088242104874e-01   +4.720146687846973e-02; +4.019724036829306e-02   +1.932025683877827e-02   +1.219842269017287e-01   +6.218654914086021e-02   +5.984826907864046e-02   +9.741697786680864e-02   +1.642806820973399e-01   +1.593315992070275e-02; +1.193144114818354e-01   +2.039213504704754e-01   +5.924856294050612e-02   +7.160844083528668e-02   -5.600598458773946e-02   -2.075751828564395e-03   +6.085848973269183e-02   +1.194192344818059e-01];
L2E_L2I_iGABA_netcon = [+1.473343655621970e-01   +6.207961686995406e-02   +1.422049190547996e-01   +1.182710033972977e-01   -5.806746573270680e-02   +1.428317679953129e-01   +7.133287074573044e-02   -1.484704900260294e-02; +1.409702383228618e-01   +1.671790432951664e-01   +1.113756666459168e-01   +3.995787105141876e-02   +1.066191447928839e-01   +7.446369496950420e-02   +3.871815166199346e-02   -1.032827002416116e-01; +1.195609439158030e-01   +3.355322126319968e-02   +9.975954206515958e-02   +1.271674352174346e-01   +1.374278269624161e-01   +4.773404700170979e-02   +1.006623001991712e-01   +1.214032806996383e-01; -6.241763782977589e-02   +1.179676998006494e-01   +6.623045953356416e-02   +3.846704726372948e-02   +8.176658916182891e-02   +4.948760985982488e-02   +1.193522777599603e-01   +1.215953656658812e-01; +8.300814512496264e-02   +2.515310148738028e-02   +1.155385269244708e-01   +7.329930899797331e-02   +5.255268521604358e-02   +3.288989927948849e-02   +6.786003448072271e-02   +1.037350503792325e-01; -8.398311756667504e-02   +1.573140621784190e-03   +1.117883425385287e-01   +1.145849210917044e-01   +1.138697665864137e-01   +1.446457064441492e-01   +1.090858741060438e-01   +7.303933559099826e-02; +1.763190732373612e-01   -4.133199510689477e-02   +7.046160938515036e-02   +7.908084836833677e-02   +1.292943253141004e-01   -5.374842459273398e-02   +7.435692651093821e-02   +5.190020288640945e-02; -7.153870697789293e-03   -4.233816686548024e-03   +1.176506265522398e-01   +1.015154979027252e-01   +5.128988197489690e-02   +1.750810160772789e-02   -2.663803622550066e-02   +7.172852849240581e-02];
L3E_L2E_iAMPA_netcon = [+9.587109286198425e-02   +1.298795977053133e-01   +9.860790621480028e-02   +4.261830417725720e-02   +1.572793910483121e-01   +7.210313440827477e-02   +1.354313771032195e-01   +2.597038270569675e-02   +6.756107884643360e-02   -6.274214982428474e-03   +3.197834187691438e-02   +9.078797167627564e-02; +1.152260270239908e-02   +5.762152657016888e-02   +6.926516854146630e-03   -3.037391197548535e-04   +1.005890365616487e-01   -5.507021092688445e-03   +1.395783448622631e-01   -3.559137276061194e-02   +2.632324850077822e-02   +7.104558858258818e-02   -6.239237687310248e-03   +9.198974005748049e-02; -1.940649852224013e-02   -5.658362086252750e-02   +5.642606586958736e-02   -1.239084251815778e-03   -5.530935866307911e-02   +4.190672671397074e-02   +9.930805066099981e-02   +7.254022026528875e-02   +3.552393705095984e-02   +7.671132115917159e-02   +1.169481866472667e-01   +8.839598385455795e-02; +7.206680360413548e-02   +1.104571856647053e-01   +7.505182354688271e-02   +1.249730455069981e-01   +6.342259931506063e-02   +1.610479199963580e-02   +8.087498311704880e-02   +1.808320713259703e-01   +1.053988327399599e-01   +1.243461143957116e-01   +7.434604794276772e-02   +7.599282383683387e-02; +1.291569237467585e-01   +7.524460276385181e-02   +1.392155448826474e-01   +9.063190023282226e-02   +5.124226792398447e-02   +1.123307146610397e-01   -3.012584364006211e-02   -2.843821501408142e-03   -4.470470878625299e-03   +5.270516183512223e-02   +7.542764921942655e-02   +9.674532376482277e-02; +2.315766192286390e-02   +7.595748874517937e-02   +2.823448673146055e-02   +1.524722151618565e-01   +1.061968512771434e-01   +2.509467164692885e-02   +7.007066851786925e-02   +1.280671527935001e-01   +4.404614761469475e-02   +5.747274487435912e-02   +1.032897873437400e-01   -9.528046066416693e-03; +1.025912738546244e-01   +1.065856373912294e-01   +1.012976869307802e-01   -3.255675982741402e-02   +1.134086908366282e-01   -1.447835412717935e-02   +6.651290792736653e-03   +8.837954686998897e-02   +1.291150313561876e-01   +8.465562914907607e-02   +2.880888624746816e-02   +1.075431414862515e-01; +9.983828219985763e-02   +1.080577716574447e-01   +6.007490933666853e-02   +8.804911886778459e-02   +9.962144521401066e-02   +1.211136826880381e-01   +4.682183545929017e-02   +5.656160041671743e-02   +8.126005394315619e-02   +1.002206042918475e-01   +4.805088737528756e-02   +1.087729066398003e-01];
L3I_L2I_iGABA_netcon = [+4.929986112549034e-02   +5.198749909635880e-02   +8.941554848234612e-02   +3.762864711134677e-02   +1.209992506017366e-01   +3.981077602012834e-02   +1.282933756502836e-01   +2.835275585771936e-04   -9.029643583392904e-03   +8.326464448775762e-02   +3.670410084831140e-02   +1.365198059712735e-01; +7.374900219408689e-02   +6.789184703753706e-02   +3.543881047843798e-02   +4.736398300413133e-02   +5.652351082093829e-02   +5.334169033430182e-02   +7.705086057313339e-03   +3.321188834139059e-03   +7.323734928602441e-02   +6.143420662535530e-02   +8.590948907566232e-02   +9.835370297373512e-02; -7.933403386984521e-03   +4.461219169948023e-02   +7.613328586380477e-02   -1.502492033281812e-02   +1.066893098496964e-01   -5.708276804438722e-02   +7.107202375879328e-02   +1.300542514327252e-01   -1.101006322295204e-02   +4.398105901256005e-02   +6.209489845307954e-02   +1.471818872654938e-01; +8.825941310344122e-02   +9.586550219160125e-02   +1.520541396025448e-01   +8.892466493945757e-02   +5.027302859636976e-02   +1.329081959750994e-01   +3.678104181839549e-02   -1.808619606542318e-02   +1.293666399477826e-01   +3.083487027800931e-02   +6.875666850000769e-02   -3.898487468484994e-03; +1.686382270879454e-02   +5.999547057391352e-02   -7.433894836795222e-03   +1.817852437289377e-01   +4.677905944160361e-02   +3.552776457653917e-02   +9.206410930146550e-02   +4.690998671264403e-03   +1.739616262672051e-01   +3.681709581607827e-02   +1.056063750079450e-01   +4.888920871825324e-02; -2.415141346847822e-02   +1.758426366061939e-02   +1.339310369913318e-01   +1.224909588241011e-01   +6.348041849594172e-02   +6.165241216202717e-02   +6.411435156599703e-02   +5.235132068097471e-02   +1.122861536161706e-01   +7.754064577557901e-02   +7.046974217669197e-02   +4.108443925276484e-02; +1.188011405587878e-01   -3.237314279821292e-02   +6.037845688982414e-02   +6.033068902721586e-02   +5.207821335981420e-02   +3.156133592262052e-02   +1.588608922331749e-01   +1.325462661650982e-01   +8.092445278181495e-03   +4.232541847650942e-02   +1.505948416363030e-01   +6.269553860323722e-02; +9.870551945475947e-02   +7.854942382872464e-02   +4.079228684947504e-02   +9.146332060722866e-02   +4.118641003588847e-02   -4.514118781848613e-02   +1.565634682916405e-02   +4.891810659907588e-02   +2.644111110187606e-02   -1.075455764153357e-01   +6.190195319651868e-02   +1.345609437465194e-02];
L2E_L3E_iAMPA_netcon = [+1.095996610378503e-01   -7.045377087377170e-03   +1.021548949024766e-01   -3.170431440635636e-02   -1.299860318172451e-03   +1.166394512118897e-01   +5.020030499081414e-02   -3.565580387508356e-02; +6.225007559356619e-02   +9.280761420064045e-02   +1.647213015769253e-01   +8.313930062848500e-04   +1.423761232145836e-01   +9.515099544873561e-02   +1.125961927965421e-01   +1.388813899191774e-01; +1.113329376020841e-01   +1.199816127544480e-01   +1.250710445701486e-01   +3.662314656074694e-02   -5.358734133167812e-03   +1.202329329998745e-01   +9.580211460932114e-02   +1.397061625051658e-01; +5.207584710916327e-02   +8.057450283949867e-02   +1.237307058525824e-02   +5.619726675471980e-02   +1.920616870803427e-02   +1.052056490582642e-02   +9.355218170073754e-02   +1.456180749651320e-01; +9.003382350345268e-02   +2.216315068975280e-02   -2.616939137564213e-02   -1.692347169602015e-02   +4.523671882564604e-02   +9.802071741625479e-02   +9.214328249882699e-02   +1.344947072180507e-01; +4.917432684761558e-02   +1.554340746062102e-01   +1.558499002150192e-01   +4.208510564479546e-02   +7.416717952307895e-02   -5.304810811814159e-02   +1.175347730202682e-01   +3.502054196320692e-02; +9.924306542842024e-02   +3.358940077422141e-02   +8.343688827468423e-02   +3.163500268936438e-02   +6.597819631321646e-02   +7.302640405979346e-02   +6.150434257878366e-02   +7.344227656215516e-02; +5.607267831714318e-02   +3.256172378847678e-02   +4.465600304929545e-02   +1.581892805734203e-02   +1.714480159214950e-02   +7.613619741501129e-02   +7.268534055944351e-02   +8.812422419709866e-02; +1.478622262603354e-01   +1.067814990681124e-01   +1.028992566442265e-01   +1.434992995735505e-01   +1.427104682729734e-01   +7.882602410112105e-02   +1.449712867424042e-01   -1.566786690457193e-02; +1.162804425347288e-01   +1.461816950925182e-01   +6.940749391224581e-02   +1.116961398007090e-01   +1.238699220004711e-01   +3.012465063215990e-02   +2.176047315267671e-02   +3.511234709334186e-02; +7.270402220305017e-02   +7.319137751586718e-02   +1.291425203051579e-02   +1.848309273910526e-02   -4.524573296923972e-02   +1.335136009275970e-01   +1.159097580775678e-01   +1.369905207358101e-01; +1.447786354077404e-01   +1.604658588877734e-01   +4.704308134069480e-02   +1.293152540785561e-02   +9.893434126242431e-02   +1.374784186142986e-01   +6.446871163644748e-02   -2.149857833081546e-02];
L2I_L3I_iGABA_netcon = [+5.242445772577427e-02   +3.121501339209385e-02   +4.374393673360280e-02   +1.460873335743636e-01   +9.411186091781215e-03   +2.945227398626897e-02   +3.716835054581945e-02   -1.905991560918040e-02; +1.543985677580298e-01   +9.475230853607146e-02   +6.640157275398566e-02   +2.715070000513106e-02   +1.380984375000476e-01   +4.702963682773722e-02   +7.743656610122841e-03   +3.816715969776341e-02; +7.970117529095769e-02   +2.073969825666658e-02   +5.775353720898846e-04   +3.156558635024789e-02   +4.692051204703233e-02   +1.527075716683636e-01   +5.090097407890573e-02   +9.497395981048197e-02; -6.670640844034878e-03   +7.022021056236219e-02   +1.374457418203273e-01   +1.019438103789308e-01   -8.614116041133478e-03   +1.000181216146972e-01   +1.873901475312310e-02   +1.272449155499606e-01; +4.524697976299723e-02   +3.270823024375515e-02   +3.118862063153998e-02   +3.710265569297162e-02   +6.480794535575778e-02   +8.268468191575315e-02   -4.924132304399911e-02   +8.800452303983412e-02; -6.327046176253031e-03   +1.059769332352060e-01   +1.087849778218930e-01   -3.309873829954450e-02   +6.122068949689950e-03   +3.145363770052222e-02   +2.310464751874427e-04   +1.303753106231326e-01; -1.772197308215607e-02   +9.286079303317131e-02   +1.297417629858812e-01   +7.626003397573056e-02   +4.551212158441745e-02   +4.772070291209381e-02   +9.632468142618500e-02   +3.884673792414543e-02; +9.645017082446491e-02   +1.368316437682170e-02   +2.899964613750030e-02   +9.554922875589775e-02   +1.704894431708705e-02   +2.500413571220154e-02   +1.404266340375061e-02   +8.853996201568594e-02; +1.047359997196584e-01   +3.681381993652723e-03   +7.678297257940096e-02   +5.099976134872942e-02   -2.089446648404271e-02   +6.761860320197374e-03   +4.921382050150447e-02   +8.185279887271776e-02; +1.161299667837303e-01   +1.324190038872933e-02   +1.525893951880642e-01   +9.240218586606593e-02   +1.301449601079864e-01   +1.508619180909021e-01   +1.323047947027837e-01   +8.600745277079658e-02; +7.360354721735654e-02   -2.347451722123819e-02   +6.979956926924286e-02   +7.863849789149516e-02   +7.834860935254699e-02   +4.620010268039094e-02   -5.449885890216576e-02   +7.153227860640954e-02; +1.443698050066764e-01   +1.006358542888210e-01   -2.483315450449135e-02   +6.077144965631950e-02   +9.195140496010262e-04   +7.884911151960358e-02   +1.344220044179235e-01   +7.756981405038103e-02];
L3I_L3E_iAMPA_netcon = [+1.110751498619761e-01   +9.974988846508941e-02   +4.011227288076185e-02   -3.431853257391745e-04   +1.490290912617431e-01   +5.441911423537301e-02   +1.559686545881507e-01   +1.178243019053677e-01   +6.211482433251598e-02   -1.426396717854275e-02   +4.052419643760502e-02   +2.538798343463198e-02; +4.721571226421863e-02   +5.891687290166720e-02   +5.993280323951442e-02   +1.102642973857850e-01   +1.303759860583354e-01   +3.660159900948067e-02   +5.279468292517819e-02   +2.856838399807272e-02   +6.636734080013190e-02   +6.458488784718772e-02   +1.545432029301595e-01   +8.199892507762357e-02; +7.658204368851289e-02   +8.906728197147921e-02   +1.111053807112770e-04   +1.080267245392138e-01   +2.555883702432866e-02   +1.444648934951308e-01   +1.209843892339647e-01   +1.098132247303066e-01   +5.645126398244352e-03   -4.588982571012627e-02   +1.058465160698807e-01   +3.572233372403873e-02; +5.994964013579368e-02   +8.861192180055605e-02   +1.445752790821548e-01   -1.993900634305668e-02   +2.206909690474057e-02   +7.906861267603633e-02   +1.529643785707698e-01   +8.323445778037541e-02   +7.162182415738295e-02   +2.223058798865635e-02   -1.948400583164172e-02   +5.109024312733591e-02; +5.618025201104861e-02   +1.380430071883564e-01   +2.032432021905053e-02   +1.285274929129997e-01   +8.576280481253729e-02   +6.588489886963507e-02   +1.051695941475760e-01   +7.833355987072459e-02   +1.199923167826167e-01   +8.071108807649084e-02   +2.024047824242314e-02   +1.118051142310942e-01; +3.990303237203931e-02   +4.037570975423603e-02   +1.539146040174749e-01   +1.227676520243750e-01   +1.104239836702780e-01   +1.476644860890607e-02   +9.211792266233079e-02   +1.794363258912323e-02   -1.541752442080843e-02   +8.775843687012362e-03   +6.870652172149380e-02   +1.353265076098275e-02; +7.170449184906319e-02   +6.942827043238599e-02   -6.017388827814842e-03   +9.806796042047455e-02   +1.566204129164899e-01   +1.160211097612996e-01   +3.220668776181052e-02   +2.782673430069817e-03   +1.455856748897837e-01   +5.177901743102354e-02   +4.786948033302887e-02   +3.719946286405146e-02; +2.624364325065227e-02   -1.533529833246617e-02   +1.253195671145657e-01   +9.786842873666997e-02   +6.500494569318310e-02   +1.006362992068508e-01   -1.418507228701617e-03   -3.988199754314309e-02   +1.133585806441672e-01   +9.651960061266640e-02   +1.382416881781970e-02   +6.867792104432482e-02; +7.461909809844322e-02   +7.011361126585401e-02   -1.258916421594566e-02   +5.985780294210253e-02   +1.290056562349619e-01   +8.558969481759410e-03   +1.316006477859973e-01   +1.113533322091544e-01   +4.170140562828001e-02   +8.233597459383950e-02   -6.668904123199916e-02   +8.379495546727621e-02; +7.860679071932147e-02   -3.924711426525948e-02   -4.636424268823837e-02   +1.841976293094219e-02   +2.587375348782379e-02   +3.594186752806498e-02   +6.320240276614657e-02   -1.005765707873093e-02   +9.904178241711564e-03   +9.898524629608398e-02   +1.225522497688019e-01   -6.638906058032409e-02; +1.070170602603639e-01   +8.159872391800731e-02   -2.844196521710561e-02   +1.448771664032001e-01   +6.752692605495349e-02   +5.602770113100394e-02   +3.789436778032273e-02   +1.141157974805417e-01   +7.513047579706751e-02   +5.380558258576731e-02   +2.935434693111630e-02   +9.898041243123137e-02; -1.876953043446569e-02   +3.004462610293183e-02   +1.688530431151605e-02   +7.118361594654089e-03   +5.602210527912840e-02   +6.219433556865215e-02   +4.040007578383668e-02   +9.078635228668393e-02   +3.936424083900394e-02   +1.783947599892667e-02   +3.559027829982081e-02   +4.352055561473828e-02];
L3E_L3I_iGABA_netcon = [+8.384444491661733e-02   +2.441611119481303e-02   +7.453173568683713e-02   +4.025452262423698e-02   +3.085618193167144e-02   +1.144295615094461e-01   +1.183999879569757e-02   +2.501034202503310e-02   -3.665829963402854e-02   +1.232208763640802e-01   +7.356801927130299e-02   +8.137255752666017e-02; +7.897624871707520e-02   +2.187895949604268e-02   -1.189506635521254e-02   +1.689028553171962e-03   +8.218839209230633e-02   +1.530749231467276e-01   +1.345046733359924e-01   +7.484409913703063e-02   +1.937715518011874e-01   +7.468870868467008e-02   +1.469422258590040e-01   +1.121480553178916e-01; +1.194104671001592e-01   +4.372711413606140e-02   +1.540062624218547e-01   +8.597212739231780e-02   +1.320613719208774e-01   -1.302536432310484e-03   +3.843939450299592e-02   +1.217544735727340e-01   +1.265116561048278e-01   +1.157020152207492e-01   -2.156454167466336e-02   +4.904495766810447e-02; +9.691713607212188e-02   +1.824567836974318e-01   +1.631493916338083e-01   +9.557607251030167e-02   +1.130192448532959e-01   +8.081598364769423e-02   +1.654313808756344e-01   +5.000144925560038e-02   +7.819637083461643e-02   +8.666496125484645e-02   +8.266285639973943e-02   +1.482250462066950e-02; -1.632812317551941e-02   +1.532887355915774e-01   +1.204777980199594e-01   +4.188834888984391e-02   +1.186585178675908e-01   +1.146490184239953e-01   +5.463631506994587e-03   +7.502816866503276e-02   +2.532117339473600e-02   +6.577398424698251e-02   +1.484828525552609e-01   +2.520940675229442e-02; +1.944858934743807e-02   -1.909939615787627e-02   +1.008368022577427e-01   +2.086201321924895e-01   +1.436987562836535e-01   +2.900021746587175e-02   -4.370518039385059e-02   +1.506662588215503e-01   -3.099125078764611e-03   +5.535702131272946e-03   +5.161569828152923e-02   +2.797205076851537e-02; +1.510769898779858e-01   +6.622176692577568e-02   +1.201742074047787e-01   +2.652754450401943e-02   +1.236835191842522e-01   -1.795553671829118e-02   +1.416887053030722e-01   -9.809933592208605e-03   +3.838335873778991e-02   +5.351769159241924e-02   +7.967226440101947e-02   +1.283052004179065e-01; +8.998330266764516e-02   -4.188482818456980e-03   +3.654076808273694e-02   -1.668014557183585e-02   +4.130715396524896e-02   +1.743495959301082e-01   +6.958473192947134e-02   +1.000735043308204e-01   +7.465890303115230e-02   +1.752383204085460e-01   +1.532366081684864e-01   +2.267282878009722e-02; +2.125886070949538e-02   +1.566428070291105e-01   +5.827842366846056e-02   +7.858328366616632e-02   +3.856559517524750e-03   +3.201397971050845e-02   -2.250696499628100e-02   -7.023175653809349e-03   +8.593158577484274e-02   +1.248214595689755e-01   +8.870751674539203e-02   +5.357613268895430e-02; +6.926205670407969e-02   +1.693664791093077e-01   +6.775608374040332e-02   +2.403095940479660e-02   -3.969395308900120e-03   +5.037042693875526e-02   +1.420813556312078e-01   +8.126330888367460e-02   +1.212976005835409e-01   +1.005701870729800e-01   +3.084843408408590e-02   +1.764943416504918e-01; +6.699434903150017e-02   +1.383292151762452e-01   +6.640385314643656e-02   +9.238965630604727e-02   +3.438772160268411e-02   -2.325584305261526e-02   +3.946511760310536e-02   -8.911241104486088e-03   -2.060406548949394e-02   -1.772509188206201e-02   +1.574892426883567e-01   +2.690039449091483e-02; -2.815645650624181e-02   +1.094205905231749e-01   +8.688994561727389e-02   +1.157276742381026e-01   +9.637176227532933e-02   +1.144448876671959e-01   +4.016066312593347e-02   +6.436011590189136e-02   +1.174430331007059e-01   +1.555021245469173e-01   +2.344601184850905e-02   +3.583812189764146e-02];
L2E_Input1_iAMPA_netcon = [+1.283473077392735e-01   +5.729914721721006e-02   +4.651296272727203e-02   +1.050644140454109e-01   +3.363508840562635e-02   +8.453032794657839e-02   -5.080852389710794e-02   +1.764728042108680e-02];
L2I_Input2_iAMPA_netcon = [+9.205829044806317e-02   +5.175477458791919e-02   +1.098686020050862e-01   +1.345219493326841e-02   +1.013040589705588e-01   +1.476480971676096e-01   +5.981134505941352e-02   +9.783199988167564e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
