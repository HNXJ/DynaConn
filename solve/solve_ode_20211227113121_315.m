function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.289467371034000e-01   -8.095575320831816e-02   +2.595694681614421e-01   -1.923061061922635e-01   -2.070329113777761e-02   +1.137860252815636e-02   +1.887734160058355e-01   -2.751932535462462e-01   +3.044383297778500e-01   +4.237719750236426e-01   +4.204965982050374e-02   +6.692399653126078e-02   -1.760624054908187e-01   +1.165492651969215e-02   +3.037972559996200e-02   +1.529493921999866e-01; +9.069387445119395e-02   +9.562868875702592e-02   +2.525372618086206e-01   -2.972629513036357e-01   +1.925636471379182e-01   -1.723157756447716e-01   -9.769658753571313e-02   +6.375331419330708e-02   -7.059802635956983e-02   +9.311031833666249e-02   +1.002826649786305e-01   -1.838961616004069e-01   +1.013834341540363e-01   +1.371532982637677e-01   -1.629253004800712e-01   +1.216220949444417e-02; +4.484494174175628e-01   +2.881699796965343e-01   -2.285809012516918e-01   +2.782431997623214e-01   +6.702682177471708e-02   +1.602107995253783e-01   -2.987484381567517e-01   -2.299781477179993e-02   +1.881401284352581e-01   -2.801510447416685e-01   -9.972389722001709e-02   -1.460342337931719e-01   -4.402559673175166e-01   -3.461219132724124e-02   +6.522212881723338e-02   +2.264669368783061e-01; -1.371544863368518e-01   -1.179901323823215e-01   +8.905831831801689e-03   +5.865589697729574e-02   +1.866472960691776e-01   -1.281752856589417e-01   -4.295244904192268e-02   -2.597415369261004e-02   +2.111907368018247e-01   +3.008292045891019e-01   +4.392750238137448e-01   +1.171236149434117e-01   +2.117069824896737e-01   +1.082703576644421e-01   +6.380591898844282e-03   +4.509550320640808e-01; +5.543315545922610e-02   -1.320808161789923e-01   +1.522617132058974e-01   +1.779424116565716e-01   +2.106267083677783e-01   -3.517000047516095e-03   +5.857859346021349e-02   -5.388125493650072e-02   +1.475410273083221e-01   +4.140469710552508e-01   -1.732247853916591e-02   +3.658301622197817e-01   +2.094993669033175e-02   +4.173311327001429e-01   -3.020568882146017e-01   +4.745694491833834e-02; -2.579361010261066e-02   +2.152597137992284e-01   +9.224274966114586e-02   -1.256680015101708e-01   +1.915707128783483e-01   -1.120650245302791e-01   +2.079231567048550e-01   +1.461357721264069e-01   -1.602465914224220e-01   -9.719461800348947e-02   +2.319458649679677e-02   +8.293979548925853e-02   +1.721929078931363e-01   -3.598148511717877e-02   -1.353366151727606e-01   -1.254108024396129e-01; +2.019952608986149e-01   +2.396122384910497e-01   +2.230734375882114e-01   -1.690138706080915e-02   -3.206694903615365e-01   -2.095428268120756e-01   -3.622806847444869e-01   -8.335726671415122e-02   +8.248793209546076e-02   +8.706149160092362e-02   +1.843655224297953e-01   +6.288671657016184e-02   +1.102330122188618e-01   -2.625111810868370e-01   -4.569595670218424e-02   +7.575680790172409e-02; +4.578376511393183e-02   +1.551230886742569e-01   -1.055976769702803e-02   +1.849474971576918e-02   +1.594293237467777e-01   -1.266573144088348e-01   +1.266805959489590e-01   +5.827985854567466e-03   -5.215748250720864e-02   -1.042092374364084e-01   +4.036382701526555e-01   +9.882677220973900e-02   -1.351530263014781e-01   +1.748641035422338e-01   -3.123614041874055e-01   -1.517904365788126e-01; +2.233606504018970e-02   +9.195908414388952e-02   +2.260795596687996e-01   -3.600829634502099e-02   -2.905518511526672e-01   -1.156482756944400e-01   -1.891321588440295e-02   -5.527853235741122e-02   -2.172590939244959e-01   -1.885316513199756e-02   +2.425223232035408e-01   -6.303229849221378e-02   +8.081491890200627e-02   +4.972966725184651e-03   +1.234119415332463e-01   -2.801062950223527e-01; -1.172298614102280e-01   -1.032884621127914e-01   -1.203888005355348e-02   -4.282914312314674e-02   +7.602717029809344e-02   +8.697456309379503e-02   +3.309465609814509e-02   -1.526518471274053e-01   -2.653716462332184e-01   -1.491621314763776e-01   +6.498590233060193e-02   -1.253928659565183e-01   +1.072638493236967e-01   +4.377559077928246e-02   -4.668139627221967e-01   -8.776555603550244e-02; -4.005079335569272e-01   +5.104043607083292e-02   -8.803413420406754e-02   -1.460041815864057e-01   +1.189639487138882e-01   +2.214733869393702e-01   -8.374299691398578e-02   -3.004794685202612e-01   +2.339332347320082e-02   -3.737834998969096e-01   -1.710002036357005e-01   -1.066776768068101e-03   +2.503453389647403e-01   -4.840795227013629e-02   -1.950160069846210e-01   +2.735012524432299e-01; -3.772707781895672e-02   -2.295385622405895e-01   +5.889827332471463e-02   -9.166208751834182e-02   -2.899323924231089e-01   +4.439384279736234e-02   -5.133466319038676e-02   +1.594286399059797e-01   -1.722203693215518e-03   -3.517872449015540e-03   -8.958379635262022e-02   -7.209650882364152e-02   +1.807953062319143e-01   +3.085583124162513e-01   +4.466267373863847e-02   +1.607471325581117e-01; -2.890242634321320e-02   -3.494305565372139e-01   -2.603091428012603e-02   -3.849088771479527e-01   +1.319021564905976e-01   -5.702677897894916e-02   +6.397844170302307e-02   -4.348060088565705e-01   -2.292136313903827e-01   -1.406802530017741e-01   -2.350670730312688e-01   +1.352199245500444e-01   -1.309440360431098e-01   +3.033585494924311e-01   +1.822238734776366e-01   -9.471448735473384e-03; +6.469016103660405e-02   -1.666872015597984e-01   -2.804996854650613e-02   +3.415884540525549e-01   +9.736156221419391e-02   -2.179925738108094e-02   -4.942208963818505e-01   +3.320491093899159e-01   -2.910618950376417e-01   -2.503355392786202e-01   -3.024581953755951e-01   +9.269086605546084e-02   +5.242058744183947e-02   -7.135665919346579e-02   -8.122913686670619e-02   +1.556190666727273e-03; +3.838042759946013e-01   -1.332177498490346e-01   -4.050474320201103e-01   -1.208592701814070e-01   -7.996747358433881e-02   +2.888943192137822e-02   +3.845167383534710e-01   +5.327960500690457e-02   -8.518100197777569e-02   -1.321495896076957e-01   -7.072785437192204e-02   -1.738681036686180e-02   +1.354963587435833e-01   +1.665618922360801e-01   +2.123210879142249e-01   -1.525936352808057e-01; +1.317462304254616e-01   -1.408545544838019e-01   +1.509201413674383e-01   -3.839552698128520e-01   +1.164026258945466e-01   +8.179290447375656e-03   -1.969904973192731e-01   -9.890287469130701e-02   +4.712274108146335e-02   -7.749935046325870e-02   +2.104372942269523e-01   -2.706584106453018e-01   +5.766092906610572e-03   +1.121659202201932e-01   -1.007791678560019e-01   -1.886329695438606e-01];
L1E_L1I_iGABA_netcon = [-6.094926065755540e-02   -1.283569324375026e-02   -3.089653319750372e-01   +1.336243418889072e-02   +2.785311626557175e-01   +3.793071338110593e-01   -1.411809234338597e-01   -5.740574669299961e-02   +1.607598158925155e-02   +5.407266500251074e-01   +3.378712579040574e-02   -4.532111748286974e-01   -3.786829678618295e-01   -3.239324615207519e-01   -1.692107996399841e-01   -1.586758524701379e-01; -1.806855340710390e-01   +1.475528027541548e-01   -1.030237371550049e-01   +1.479038203864852e-01   -1.095917761169326e-01   -5.219145581958981e-02   -2.821323740171207e-01   +4.421230332956005e-02   +1.512338292232596e-02   -4.314491646959425e-01   -1.521011768139329e-01   -1.541759090763592e-01   -5.755511751114071e-02   +1.993495387150023e-01   -2.171819922254073e-01   -2.001458879869401e-01; -5.633450635934973e-02   +2.935663985256496e-01   -1.217606685192910e-01   -1.332218557641591e-01   +1.557403706364094e-01   +9.208346392575972e-02   -3.370974474283149e-01   +4.407753559339618e-01   +3.386932694871876e-01   -2.231732545032461e-01   +9.031005994973669e-02   -5.084142682685966e-02   +1.945038894536261e-01   -2.729856224525682e-01   +1.608289662473838e-01   -1.810877224574158e-01; -1.203886244936605e-01   -1.483597658263016e-01   +5.332835985409024e-02   -7.005590111126236e-02   -3.990685943871852e-01   -3.112274299884266e-02   +2.541708708000049e-01   +7.221915977770345e-02   -1.638318109191662e-01   -3.112640277192407e-01   -1.012687345210810e-01   +9.324049104682369e-02   -4.190663370222203e-02   -1.425923026197353e-02   -5.265741129701423e-02   -3.009539232751273e-01; -2.051734240650607e-02   +2.345159646608319e-01   -1.362990183090015e-01   -6.930499027671608e-02   +1.135284512325896e-01   +7.769502087861022e-02   +3.113828005052902e-01   -9.393703740051405e-03   -9.283725137191760e-02   +1.214425856485305e-01   -1.082534340928700e-02   -8.498667816551370e-03   +6.750487429965306e-02   -2.125713558199821e-03   -2.985955726756705e-02   -2.357836462112138e-01; +2.952071849451390e-02   +9.210060360705466e-02   +1.625983596356572e-01   +1.439971877970666e-01   -3.374856455688388e-02   +1.740256826218001e-01   -2.698602529006900e-01   +1.987386307285977e-01   -2.327180855747022e-01   +2.234392645368321e-01   +5.322602982657618e-02   -4.934510195500582e-01   +3.092758471000687e-02   -3.166912437617599e-01   +2.333568520563291e-01   -1.529255152113947e-01; -8.675815393625143e-02   +2.893847227878498e-01   -1.251663987658526e-01   -5.297157263353701e-02   -1.885215986904277e-01   -5.822243952539859e-02   -8.082449806301301e-02   -5.854606814986717e-02   +1.735798255968078e-01   +8.835019714748391e-02   -3.811300081784926e-01   +4.678012577077020e-02   -2.147303147369752e-01   +4.612654189406477e-03   +8.184292687472078e-02   +2.754541121043737e-01; -3.928454722943432e-01   +2.503933597485605e-01   +9.551246846083147e-02   -5.788396918879332e-02   -5.622685493125646e-02   -2.751124787277041e-01   +1.003455117631415e-01   +3.859381278555550e-01   +3.797211425122490e-02   -1.604913466638334e-01   -3.686447117994539e-02   +9.115666263982208e-02   -5.200736786623895e-01   +1.201454856982533e-01   -3.281364738320757e-02   +1.243157468726388e-01; -2.530760562480602e-01   +1.203764722546504e-01   -2.218023603713547e-01   -1.515608864474430e-02   +2.303897473224689e-01   +4.388075905284236e-01   +7.250242737769683e-02   +1.350412456835497e-01   +8.093004782802336e-02   +2.733325515819418e-01   -2.310273151889868e-01   -2.714995390714799e-01   -4.028983390488308e-03   +3.918665928956263e-02   -3.135886655088509e-01   +4.485326130177722e-01; -1.139606477403167e-01   -1.776424055610802e-01   +3.255054758919885e-02   -1.842156442993960e-01   +3.360506575194358e-01   +7.073764569574120e-02   +7.722676983848839e-02   -7.356391124682551e-02   +1.190119448225993e-01   -1.214534978919705e-01   -3.081574570091210e-01   +5.091358182586279e-01   +3.516093604209306e-03   -8.451849018872010e-02   +1.334303159801550e-01   +2.086862268238937e-01; +5.099112839661150e-02   -1.583838135370541e-01   -1.496885086455891e-01   +2.418744684028203e-01   +7.766438245230949e-02   -2.471637732641691e-01   -6.064367534845949e-02   -3.054159904951203e-01   -2.465334613190550e-01   -2.062762474468122e-01   -6.641485404191491e-02   +1.063663444087896e-01   +2.527996328123386e-01   -1.894480499900961e-02   -3.787114575079840e-01   +2.661385402636192e-01; +1.059183139419477e-01   +1.974452995566774e-01   -2.114784610754003e-01   +1.182482841378689e-01   +1.413937501453951e-01   +2.802298329064559e-01   -3.119320207524561e-01   +2.679398529648193e-01   +1.023089533950289e-01   +7.140409801538805e-02   +1.968946549156436e-01   +1.999797502671204e-02   -1.307703321326600e-01   -7.484946742562840e-02   +1.754361457890908e-01   -3.188478506596215e-02; +2.412216857910743e-01   -7.639413862803558e-02   +3.890527859057966e-01   -2.801503660262099e-02   -2.696868686810972e-01   -1.155620175390775e-01   -1.039459773527956e-01   +2.659446409989741e-01   -3.807216228766918e-01   +9.717041827166692e-02   +1.961026555262183e-01   +1.329740021687172e-01   -1.003830901350020e-01   +1.033194839210788e-01   -2.570612012230744e-01   -2.858463171749909e-01; +6.616196957801374e-02   +3.179382244716043e-02   +5.548093887196150e-02   +3.054014656294973e-01   +2.624758957079947e-01   -3.837970026180369e-01   -2.361013788606670e-02   -2.358965771809631e-01   +3.185127696371418e-01   -4.740343047319158e-02   +2.773617855588208e-01   -3.341394176888370e-01   +2.903854979498466e-01   -4.234466758069673e-02   -7.661554880449675e-02   -3.819029019545635e-01; +2.286188648364857e-01   -3.387532301179461e-01   -1.375738343049575e-01   +2.107344438424344e-01   -8.597800871538264e-02   +1.956511846546308e-01   +1.888839807028793e-01   -2.093591879565315e-01   +1.053456031580645e-01   -2.408261312928219e-01   -1.574700380654432e-01   -5.406604514179993e-01   -4.274041189308574e-01   +3.380736794293779e-01   -2.195994162255489e-01   -1.361416445181381e-01; -2.739027321715539e-01   -3.254454736913802e-02   -7.606355975761311e-02   +3.331625379477947e-01   -3.988628928903403e-02   +4.271190776742222e-02   -5.499657614150598e-02   +9.990756059659156e-02   +2.352622004472774e-01   +2.390696087900394e-01   -2.020706274434584e-01   +4.817175010543461e-01   +2.183611039895828e-01   -2.733965821724378e-01   -1.874002747902756e-01   -2.641296862328510e-01];
L2I_L1I_iGABA_netcon = [+1.310390699731914e-02   +6.557220828249036e-02   -1.404822629972575e-01   -3.835790455228726e-01   -5.823731574577848e-02   -1.612638921871955e-01   -4.854308632390640e-01   -5.193492417844213e-02; -4.770141197637463e-02   -1.598230613644441e-01   -8.557274097090596e-03   +1.255283316992213e-01   -1.666940403314859e-01   +2.020952729528567e-01   -5.329857292803283e-02   +2.028187189173936e-01; +4.691010496106310e-02   -3.236182083964627e-01   +4.255951773698822e-02   +1.467177950655937e-01   +2.864046349342817e-01   -2.001125300777425e-01   -5.074294238265102e-02   +6.061336023865768e-02; +5.660553169642261e-02   +2.709488430561662e-01   +6.527514297047041e-02   +9.580094052560537e-02   -2.056637298079726e-01   +2.167875925274955e-02   +1.525060946352860e-02   -1.655026682409054e-01; -1.173322010596401e-01   -1.063239071628788e-02   +2.564778121061468e-01   -1.353589690202192e-01   -3.780958501289936e-02   +3.463064745589318e-01   -1.008310270002440e-01   +3.529472300364302e-01; -4.959332701144013e-02   +1.297465596692230e-01   -2.108301721664729e-02   -4.681433231330485e-01   -1.206246752238127e-01   +1.825243618502081e-02   +9.289058355309529e-02   -1.641335038678365e-01; +1.725641207686140e-01   -7.733942434312215e-02   -2.388149631957154e-01   +3.018475945533828e-01   -9.758010108559154e-02   +7.995052876317232e-02   -1.239795409348094e-01   -8.038660665618792e-02; -1.473431136007335e-01   +9.371221079316609e-02   -1.546272964214034e-01   -1.987611366858938e-01   +1.263149137494366e-01   +2.877045736027871e-01   -2.039670697571018e-01   +3.656239672655610e-02; +2.947164538993723e-02   +1.177402921997742e-01   +2.702303831732602e-01   -3.472903676205119e-01   -2.152430022457261e-01   -8.417541917900212e-02   -1.130555508519883e-01   -9.853637365104555e-02; +4.041817739198684e-01   -1.165145377830069e-01   -1.409274698861663e-01   -2.988484817640273e-02   -9.788660911528566e-02   -3.301425101106095e-02   -2.819777238914191e-01   -3.235450735607177e-01; -1.023254265421300e-01   +1.444737292421860e-01   -3.191235881466148e-01   +3.032712920559091e-01   +1.532777770049275e-01   -5.291721350667000e-01   +1.880708289500069e-02   -5.715723160329203e-02; -4.219987242294828e-01   -2.791296157284952e-01   -2.271137861810806e-02   -9.862925522355986e-03   -7.868035984224152e-02   -8.953342819804284e-02   -3.702878446844166e-04   +1.175813529560730e-01; +9.168360886563189e-02   +3.398626451313877e-03   -1.775658691671395e-01   +2.374997958357856e-02   +4.585420792252148e-02   +2.511922839751608e-01   +2.477743498055655e-01   -2.057473952253216e-01; -5.613929771341251e-03   +2.350687196238125e-01   -1.888567336893278e-01   -1.328082077283898e-01   -1.248591115202206e-01   -1.434677912278576e-01   -2.114312721853133e-01   -1.021702154280676e-01; +1.986016913790591e-01   +2.440448818438833e-02   -2.825130263596486e-01   -4.872167473722090e-02   +8.522552034073275e-02   +2.363056855853605e-01   +9.150953037126239e-02   +1.040433877112112e-01; +2.039320673869831e-01   +6.024002596800389e-02   +2.377324016246519e-01   -7.694293111871688e-02   -4.056404660901091e-01   +2.370648405816674e-01   +1.230079719884859e-01   +1.383129137551679e-01];
L1I_L2I_iGABA_netcon = [-1.044132324259786e-01   +3.727466053359772e-02   +2.638289344925682e-02   +1.027682752087516e-01   +1.382068537337701e-01   -1.872857953275846e-02   +2.208133601064020e-02   +2.653740255033245e-01   -7.919889635778429e-03   +4.992578043622463e-02   -6.363412879701325e-02   -1.080668585373055e-01   +1.718680405875422e-01   +8.456682806996045e-02   +3.156468452438776e-04   -5.229623753175011e-03; -4.457790112048887e-01   -4.876508058118555e-02   +3.843409811132575e-01   +1.722936403224302e-01   +2.603834365558334e-01   +1.347855296349320e-01   +7.219070071636788e-03   -9.406859487947035e-02   -2.563748693690988e-01   -1.172776217533533e-02   +2.253515042896553e-01   -3.300702532566912e-02   -1.030568652916353e-01   -2.811755186582141e-01   -1.917334506681272e-01   -4.657840909526120e-02; -2.575998964472274e-01   -3.325286582808269e-01   +4.238603240418299e-02   +1.014767566312331e-01   +4.390374316170126e-02   -1.427041633363637e-01   +2.261724976538185e-01   -1.751875938814664e-01   -1.287166137611746e-02   -1.425550777710167e-01   -2.140911047757308e-01   +1.129159031882610e-01   -2.690570708572737e-02   -3.480174551189514e-01   +1.673629419433047e-01   +8.468013345639983e-02; -1.119683037199403e-01   +1.946611039990826e-01   -1.360487396778137e-01   +2.388370820237752e-01   -1.701808170073948e-01   -1.036527815748528e-01   +2.914384573294442e-01   -2.310386787491186e-02   -4.777556038525443e-02   +2.256740678983026e-02   -1.131937567520468e-02   +2.689613314173571e-01   +2.518658203450966e-01   +2.039809380742540e-01   +1.181441275449017e-01   +3.626879000216632e-01; -5.456837920259965e-02   +2.521426576218839e-01   -3.349939773828393e-03   -1.122820587204612e-01   -1.351803348379831e-01   -2.607432234745139e-01   -9.311700760119949e-02   +9.388595862393792e-02   +7.792209706324119e-02   -8.175791592524045e-03   +3.103338289119544e-01   +1.241409461726342e-01   -1.508790075355791e-01   +2.064045725963471e-01   +3.904890139418743e-01   -1.323330629205489e-02; +2.017918266335141e-01   +6.664857487254841e-02   +2.885318276209539e-01   -2.895989491609163e-01   -1.560869797694235e-02   +3.392474971177623e-01   +6.575455218497152e-02   -3.035623976443839e-02   +2.306212201918028e-01   +1.577886218407002e-01   +3.211204709276804e-01   +8.920904780559709e-02   +1.656999810967031e-01   +6.635110412780618e-03   -6.115370798603529e-02   -1.612258935261407e-01; +1.652011280089463e-01   +2.171763556181777e-01   -2.379684660059656e-02   +5.432164231517847e-02   +3.228657744173619e-02   +1.538271335961948e-01   +5.874773797013389e-02   -3.034710853962433e-01   +2.896861487337639e-01   +9.584691494526054e-02   +6.055262937256642e-02   +4.773525187188769e-02   -4.317196176096251e-01   -4.426647982122281e-02   +8.953606458756752e-02   +3.259135581336012e-02; +4.267072696591582e-01   -6.096794206476980e-02   -1.751863171943137e-01   -9.181069052222657e-02   +3.721533758292836e-01   -1.081179542381084e-01   +2.450674104264925e-01   +1.954025201360866e-01   +2.602791950183222e-01   +9.605316819256887e-02   +3.581525982940284e-02   -1.328270493250698e-01   -2.178461642256538e-01   -1.611144822624850e-01   +3.623986769110262e-02   -1.119612615732028e-01];
L2E_L1E_iAMPA_netcon = [-2.453957067620148e-02   +1.658069812315472e-01   -4.172373238666294e-01   -1.499573699291546e-01   -1.677384610246074e-01   +2.502966825091518e-01   +2.493874440795081e-01   -1.417977072827808e-01; -1.018693463511382e-01   +1.952960078974509e-01   -2.178382845713107e-01   +1.247421716923996e-01   -4.299520124503747e-02   -3.370304612054137e-01   +7.020565355467939e-03   -1.132977158028880e-01; -1.647899840815250e-01   +1.988956818987054e-01   -1.884746038846621e-01   +5.345878109139675e-03   +1.089077853174723e-01   -1.329993214701468e-01   +2.277999261766964e-02   +9.077062524820104e-02; +1.269092055396402e-01   +1.984271016243135e-01   -3.139447924628427e-01   -4.654148856366856e-01   -1.836830882317148e-02   -8.616925386007733e-02   -2.926622016661585e-01   -1.262062409735180e-01; -6.849279036302279e-02   +9.554873688224856e-02   +1.718046938001752e-01   -2.250640132554129e-01   -1.487867345763012e-01   -8.964565265179109e-02   -2.197376820029615e-02   +1.122339986764676e-01; -5.477760985212624e-02   +3.122493663283827e-02   +2.046758262127518e-01   -1.320644734002988e-01   -7.124218661381813e-02   +9.818706967281100e-02   -1.852081503705276e-01   -2.364131936857991e-01; -2.969344960124406e-02   +1.682567666557650e-01   +2.416167602997306e-01   -2.280540729634216e-01   -9.070252529718599e-02   +1.548388408495618e-01   -1.472373808509465e-01   -1.142332533544064e-01; -1.818739991991123e-01   +1.952198350840277e-01   -7.185847333533124e-02   -5.183736518379421e-03   -1.130850423016826e-02   -2.960896756737179e-01   -2.176295505568172e-01   +3.289798371896482e-01; +1.234562264240760e-02   -2.285723327691192e-02   +9.409520710671135e-02   +5.099100907161640e-02   +1.824085009403182e-01   +7.237901554305139e-02   -1.165269227193544e-01   -8.746413745104194e-02; -6.456050030815626e-02   -1.695754099621735e-01   -1.987746238305600e-01   +1.306934346799639e-01   -2.356196994524227e-01   -3.997198266701282e-01   +1.993408885607251e-01   -6.313829579239069e-02; -1.449360095660833e-01   +5.524936500637263e-01   +1.068635110689874e-01   +2.123359132564834e-01   +2.206888192021934e-01   -7.460193957242331e-02   -2.808270988511480e-01   -2.858929764911039e-01; +5.105612073319131e-02   -1.499945704549572e-01   +3.427324072782190e-01   -1.386877723268123e-01   -1.414857119624331e-01   +9.718802280303210e-02   +1.093483634647024e-01   -4.020927331889972e-01; -2.474273222174612e-01   +2.464976404457948e-01   -3.460196143567513e-01   -3.275424774022406e-01   -3.060570486442438e-01   -1.335799516846007e-01   +1.443741475313866e-01   -1.704552582281005e-01; -1.950769559404483e-01   -2.048527349096582e-02   +1.412084820599169e-01   -5.184185979652443e-02   +1.315525520330068e-01   +1.484550702033452e-01   -1.593621930531896e-01   +2.644277492480702e-01; -3.685004954875420e-02   -1.411166442740977e-01   -2.486086642386821e-01   -1.154954793711250e-01   +6.756916921545350e-02   +2.336224605850278e-04   +2.711993974600217e-02   +1.746533233836486e-01; +1.809102886425955e-01   +2.029775356256503e-01   +4.792566346772004e-02   -4.910800871386754e-02   +4.601217252083130e-01   -1.853259582739200e-01   +2.529938054553656e-04   -2.141958285603662e-01];
L1E_L2E_iAMPA_netcon = [-2.920802207130974e-02   +2.527382042554842e-01   +4.606675747465325e-01   -3.776766388780413e-02   -1.727190115839564e-01   -2.554028591222007e-01   +3.125031494049365e-01   -2.148063852911091e-01   +1.849947125661581e-01   -2.313331522512518e-02   -3.676028189276789e-02   -1.123145953584194e-01   +2.330834767970042e-01   -6.825812919550420e-02   -8.476114913683816e-02   -1.123075038443055e-03; -7.967336546900877e-02   +1.412666763985465e-01   +3.274471290779516e-01   -3.621656077879284e-01   -8.480417388232363e-02   +1.147826210309837e-01   -9.289250786197592e-02   -1.075911855054926e-01   +1.999124796344937e-01   -2.197764767691717e-01   -1.343554958804637e-01   +7.115146249842830e-03   -1.165812970091884e-01   -9.083288166647085e-02   +2.372619401275450e-01   -2.653620027486257e-01; +2.533668450205238e-02   +1.582165074663047e-01   +2.901779891362827e-01   -5.210034929458464e-03   -1.312900805430531e-01   -2.739711366260618e-01   +3.643809247652014e-01   +1.124799444865737e-01   +2.077655203817683e-02   -1.792371253370732e-02   +1.788555057057951e-01   +1.930085505928801e-01   -1.998126077065400e-01   +3.894874383190121e-01   +1.261022028310546e-02   +6.144574401289103e-02; +3.633472528798343e-01   +2.608016443049179e-01   -5.565982210266260e-02   +2.748491219339398e-02   -1.381712118811042e-01   -1.184406019959682e-01   -2.366223170244087e-01   +1.871925105577930e-01   +1.573571921247807e-01   +2.142818684095093e-02   -8.606940664220372e-02   -1.321719497227279e-01   +3.182043490015506e-01   -4.711602105458238e-02   +4.323962570991996e-02   -7.737470291201226e-02; -1.793021148670084e-01   -1.196163017816007e-01   -4.231264534074270e-01   +1.835640550399064e-01   +1.147776321445996e-01   -9.726514836019357e-02   -7.460205268776801e-02   +8.359794663144823e-02   -9.131469514444934e-02   +1.376601687292398e-01   -4.246901203936602e-02   -3.711374206159525e-01   +9.288743469138447e-02   -1.740046217688623e-01   -6.888907242972873e-02   -8.624842030084977e-02; +7.300706120610873e-02   -2.172326233367905e-02   +2.536352206237154e-01   +4.517202624479377e-02   +2.282150479627782e-01   -2.452367804033544e-01   -1.643692262363577e-01   -1.487345497039367e-01   +2.213753874802488e-01   +1.175106230210300e-01   -1.988152505233435e-01   +1.008504829444942e-01   -2.794720666372160e-01   +2.084922450273876e-01   +2.575521502467809e-01   +1.762849579964763e-01; -2.900444271418984e-01   +1.825893679504807e-01   +9.097618241360569e-02   -8.703049298119302e-02   -1.191645810837172e-01   +6.018791073222966e-02   -8.120636771856596e-02   -2.095757099601396e-01   -2.456674423254862e-01   +2.918756919795615e-01   -1.195523562551283e-01   -3.410293181094127e-01   +1.196642142207759e-01   -6.501283198287822e-02   +1.334226613729602e-01   -2.215283133423668e-01; +3.303345384777421e-01   +1.789833921056520e-03   -1.686255787497398e-02   +4.130209042356462e-02   +1.590773837817601e-01   +3.805173408841871e-01   -1.021919438239702e-01   +8.085091850396092e-02   +3.270747295191225e-01   -3.266146414532336e-02   -2.545743113459385e-01   -1.121230823346271e-01   +3.857686014979558e-01   -3.216740508280784e-01   +5.852907279578976e-02   -4.146848954546046e-01];
L2I_L2E_iAMPA_netcon = [+3.173374005123554e-01   -1.105272783656844e-01   +3.686298515322530e-01   -1.922804490138615e-01   +7.522004476037925e-02   +4.424070375125478e-01   +4.937864472162667e-02   -1.493953856528117e-02; +2.665853689291809e-01   -4.561994978276249e-02   +1.350901332586590e-01   +5.469151840865504e-01   -2.484369367211179e-01   +2.309965787258553e-01   +1.855468159639764e-01   +8.949754602069085e-02; -4.910919462588633e-02   +2.543756341968499e-01   -6.538746028457293e-02   +1.657765439963876e-01   -3.620376914614065e-01   +2.130623842424169e-01   +6.257082364971402e-02   +1.479172472260973e-01; +1.690229929287427e-01   -4.187548291409826e-01   +3.547922012677764e-02   +1.442886530902878e-01   +3.306928494045916e-03   -1.650297456441712e-01   +1.215658584080166e-01   -6.733519694892441e-02; -1.813453286780675e-01   +7.984992873390356e-04   -1.988076866066446e-01   -7.528825011195969e-02   -2.129842212992904e-01   +5.951680149748378e-02   +2.095230193678301e-01   +1.243211550292563e-01; +5.043580593334068e-02   +5.754566886680475e-03   -9.587096188459590e-02   -3.089661804820882e-01   +1.046290078363787e-01   +3.012501702422408e-01   -4.365548513954269e-02   +2.140961083269366e-01; +1.555085025451192e-01   +3.312175540984317e-01   -2.237249668127954e-01   +1.612412765032356e-01   +1.762949725417855e-02   -2.883384116072526e-01   +9.889099472446090e-02   -2.530713198343130e-01; +1.512935503712459e-01   +1.030284243012436e-01   -8.907324232966188e-02   -1.444999028600829e-01   -2.969206413561086e-01   +1.032982617474089e-01   +1.370644617930218e-01   -2.186394866345997e-01];
L2E_L2I_iGABA_netcon = [+4.267121355474263e-01   +3.271382022924614e-01   +7.753495036364302e-02   +4.077021773137975e-02   -2.750151727108422e-01   -1.925567174768490e-01   -1.168196341283717e-01   -4.333633781208447e-02; +1.546144261683305e-01   -3.922988323684101e-02   +2.312672825509492e-01   -8.196139704921790e-02   +2.684893047982909e-01   +8.161179743596211e-02   -5.550780682613512e-02   +2.848285193815803e-01; -2.401185565770719e-01   +1.503828771344118e-01   -4.408014283800064e-01   -2.809495287352115e-02   -2.537290614776518e-01   +3.006213919762413e-02   -1.788677547612278e-01   -1.316465937343556e-01; -9.234677983943743e-02   +2.539915786968152e-01   +1.014372728552801e-01   +2.392983152051381e-01   +2.283188996762109e-01   +2.299393824578556e-02   +1.147009155890342e-01   +1.872101069472199e-01; +3.032979287504006e-02   -1.483778024063463e-01   +3.907369652780233e-01   +1.233214394705841e-01   +9.172522973177159e-02   +2.040831618470004e-03   -9.085729458030968e-03   -3.571232276155388e-01; +1.768280856424254e-01   +1.475433243166034e-02   -1.777846778812886e-01   -1.808898318410602e-01   -9.536875652870666e-02   +2.331284599926863e-01   -1.508324950322506e-01   -1.433645260172290e-01; -7.454248751400948e-02   -9.774165878286305e-02   -2.497899154851407e-02   -1.151362800326627e-01   -5.946794054682861e-02   -1.499122369158271e-01   -2.002640052270062e-01   -1.642742918616314e-01; -9.035806990721916e-02   -3.466374308242469e-01   -1.602744678894978e-01   -1.077070876139073e-01   +1.710579091011633e-01   -1.487813468307284e-01   -2.158273164018768e-01   -1.017938558504275e-01];
L3E_L2E_iAMPA_netcon = [-1.400559268196903e-01   +2.979860030234203e-01   +1.503879322598670e-01   +3.312324521559434e-01   -1.763158380392647e-01   +1.945348769313012e-01   +2.130197586068530e-01   +1.267473873511870e-01   -3.228941819685032e-01   -2.625305987519053e-01   -2.239280669949910e-01   -3.283304032800838e-01; -1.828761906203594e-01   -3.469166150399819e-01   -4.594464956776791e-02   +7.461037162870657e-02   +3.598004570913622e-01   +3.423474879911676e-01   -9.462267530755950e-03   -2.455799953086620e-02   -3.042713923871196e-01   -4.449826765849674e-02   -2.501338589911897e-02   -1.814864104732748e-01; +2.533650028106164e-02   -1.058217356729859e-01   -3.287883976635345e-01   +2.319965622227953e-01   +1.759305496223160e-01   -7.822749770523993e-02   +9.429072399123901e-02   +2.020581146250632e-01   +1.460161129622903e-02   +8.177408032227365e-02   -1.178213765406886e-01   +6.899608520184113e-03; +1.101815092173128e-01   +1.239437067192797e-01   +2.639343139151047e-01   -1.012409775075504e-01   -3.486800534281547e-01   +5.172081333419040e-01   +4.130255679763574e-02   +1.000381856892780e-01   -7.296990068573127e-02   +1.403877889190981e-02   +8.190965349481816e-02   -1.327667729659801e-01; -2.046801099343667e-01   +2.324791760206268e-01   +1.701639654565139e-01   -2.381051833884858e-01   -1.095352612092748e-01   -2.780962100313221e-02   -2.975334346427351e-01   -1.946801593550914e-01   -2.007687430977669e-01   -1.310676909711318e-02   +1.070867767567699e-01   +3.667448415883805e-02; +1.301563521765975e-01   +3.062174574489377e-01   +1.164741735332205e-01   -3.806427394997636e-02   +2.883869324278543e-01   -4.143325235772669e-02   +1.968540392327278e-02   +1.719378001450162e-02   -2.521505942067589e-01   +2.009810721811459e-02   -1.733903291833517e-01   -1.039157757024855e-01; +3.752772529166340e-01   +2.928537054913424e-02   -9.870312481186641e-02   -1.514601095318289e-01   +2.876935595354697e-02   -2.659659930131263e-01   +1.647223461821515e-01   +1.598649978849742e-01   +1.637014293740565e-01   -3.398534955194299e-02   +2.207519693784256e-01   -1.068781953251892e-01; -4.693392040995121e-02   -1.267270912658363e-01   -7.504490921880227e-02   -1.042634836306984e-01   -3.297927375689578e-02   +9.216876088112783e-02   -6.826229312569580e-02   -2.604621747411561e-01   +4.422398376709163e-02   -7.954270468196598e-02   -7.988875934638129e-02   +4.146660078548530e-01];
L3I_L2I_iGABA_netcon = [+1.230937505780303e-01   +5.741945407311766e-03   +9.425890814296316e-02   +2.757297839275373e-01   -2.949159478401226e-02   -9.889578938616209e-02   +5.476857233786320e-02   +1.512412792336868e-01   +2.716921828832634e-01   -5.794594539900931e-02   -2.071210518470940e-01   +3.204380002288091e-01; -1.028355984999201e-01   -3.611462006499450e-01   -1.447042176028753e-01   -2.872853022519711e-02   +2.888918745334358e-01   +2.875954590715642e-01   +1.823522777795398e-01   +2.362025218924583e-01   -3.446823238877442e-02   -1.642936130626673e-01   -2.915216388501636e-01   -3.090201821062654e-01; +5.400190757825174e-02   -3.797495247420293e-01   -5.187074002142115e-02   -9.182345659033594e-02   +2.033844189721712e-01   +1.209550027177936e-01   +1.310924145752682e-01   +2.814707896984400e-01   +1.296779215705059e-01   +1.381135340177944e-01   +6.802380923044261e-02   +2.755306313096951e-01; +4.655979749271409e-02   +6.340062265131871e-02   -4.259268374096545e-02   +5.972371605137725e-02   -1.281546744238326e-01   +5.476430195331718e-02   +3.300002863846487e-01   +4.192758719723410e-01   -1.553742140176820e-02   -2.029781990846186e-01   +8.139968783983430e-02   +1.041665577313590e-02; +8.741009097885830e-02   +3.308666728760106e-02   +1.453969997764846e-01   +2.518110027202927e-01   +1.148628992087608e-01   +3.824958990955252e-01   -2.554088132690038e-01   -3.742246557507275e-01   -6.111431625055985e-02   +1.109156288707560e-01   +4.375845484756835e-03   -1.561660156416013e-01; -6.468477826795321e-02   -8.948416869617556e-02   +4.086086342698718e-01   +8.691911417680313e-02   -1.097649125978731e-01   -2.325497236586473e-01   -1.401747098706270e-01   +1.565833970609620e-01   -5.810336747808924e-02   -2.801386666195872e-01   -9.204133519938160e-02   +4.858900903976143e-03; -1.999341676327425e-01   -5.819085462632007e-02   +2.574605139293666e-01   -2.087979818531273e-01   +3.214288412360996e-01   +1.526736687412569e-01   +2.943273445826611e-01   +2.172917045230093e-01   +1.465287264843026e-01   -4.288581998738311e-02   +7.848610701428976e-02   -1.089549402914507e-02; +2.186386523770103e-01   -7.740587650736827e-02   -2.248488587516422e-01   -3.122148276241247e-01   +2.111425577111978e-01   +1.958812624440066e-01   -5.696743428855369e-02   -9.520778488115224e-02   +7.466910202259129e-02   +3.430821578665534e-01   +4.052364579653630e-02   -1.161936114464033e-01];
L2E_L3E_iAMPA_netcon = [+2.104073333962507e-03   -1.690041857475162e-01   +9.847019249680419e-02   -2.710411793498471e-01   +1.628728921265506e-01   -4.161328215865066e-02   +1.860169003706488e-01   +8.030559016101568e-02; -1.418832090328012e-01   -2.242573729908442e-01   +4.480919476835722e-01   -3.524768789927865e-01   -1.827576212609347e-01   +3.357813535338036e-02   -3.687362074606929e-02   +1.439644799577692e-01; +5.085058581254219e-02   +1.602946449009288e-01   -6.187657627633877e-02   -2.755752490635946e-02   +1.896060032158710e-02   -2.538343872887282e-01   +1.736837576874971e-01   -2.810625132087464e-02; -2.157944928683668e-01   +3.087904035752839e-01   -3.314778892217580e-01   -1.812827070074275e-01   +1.313266692825604e-01   -2.984286665894060e-01   -1.251051571026100e-01   +1.289304046870420e-01; +1.546963148708089e-01   -1.606364666188811e-02   +3.853937750711044e-03   +5.392319127166090e-03   +1.766584068621544e-01   -3.754709749677548e-02   +1.741241271591468e-02   +1.536380958747566e-01; +4.260244596358160e-02   +1.568233370128767e-02   -4.463287843258053e-02   -1.767555758485508e-01   -1.169360385816681e-01   +2.953439974345852e-02   +1.287144524159445e-01   +3.525562856064634e-01; +6.137374634757127e-02   +4.211152775955550e-01   +7.543899035090287e-02   +2.399453544887010e-01   +2.936500668933781e-01   -4.110321769727560e-02   -1.552831019547981e-01   +1.232221194316293e-01; -1.778761838909990e-01   +3.511645540679420e-01   -7.966659185501385e-02   +2.081225976446223e-01   -3.025554774879242e-01   -1.246843565902243e-02   +1.448234770745599e-02   +1.377117634287728e-01; -7.166791788994273e-02   +5.709246586367159e-02   +1.934921040973309e-01   +3.963479731691361e-01   -1.122922617111609e-01   +4.213552833703187e-02   +1.223441104719681e-01   -1.145770858252238e-01; -1.392100524103799e-01   +3.156980521804700e-01   -2.418543628680294e-01   -9.155795947456914e-02   +1.519411807585401e-01   +9.507773261818873e-02   +5.231288881064219e-01   -3.896150178384296e-02; +1.304678336134918e-01   +2.709317049558189e-01   -6.009095064599033e-03   -1.788806230065718e-01   +2.907459868231382e-01   -1.087330852311795e-01   -1.218514076309338e-01   -1.708988826613765e-01; +2.181698243073270e-01   +5.163662852427878e-03   +1.425462392713356e-01   -4.555935248275143e-01   +2.566066169879535e-01   +1.670629138872856e-01   -8.895244539360216e-02   +9.753475649467439e-02];
L2I_L3I_iGABA_netcon = [+5.417848643452162e-03   -1.750416302781730e-01   -2.692219982483460e-01   +1.732870977187214e-01   -3.740883630404789e-01   -1.033829536501352e-01   +3.511603718827017e-02   -4.682303757812464e-02; -1.528954467176655e-01   +2.741071069850679e-01   +2.603055393534509e-01   +1.623004093527708e-01   +1.924438040473373e-01   +1.931409342446540e-02   -2.494057323367162e-01   -1.605170889216309e-01; +1.462552792810959e-01   -6.565434454417193e-02   +2.171398764535448e-01   -1.874103578576615e-02   +2.106382721062365e-01   +3.282461015962296e-01   +2.455224088305526e-01   -1.115267821977053e-01; +2.046042249064415e-01   +2.128096721211407e-01   -6.788247919542877e-02   +1.416934428532248e-01   -2.465954404851387e-02   -1.132748625513359e-01   +4.607197821089370e-02   +1.445300973814022e-01; -1.989237567611125e-02   -5.058292052060830e-02   +2.957601324107518e-01   +2.328016957681220e-01   +3.184525839684844e-02   +2.662380508743961e-01   -2.086679485225321e-01   -1.491273227775753e-02; +8.064579589133267e-02   +2.270390408035099e-01   -9.617200536805044e-02   +1.084613033624247e-01   -1.423767090899550e-01   +1.155807509508244e-01   -1.646003918272706e-01   -3.846082311359283e-02; +6.731070193555751e-02   +7.246927989212354e-02   -6.325661427634541e-02   -5.397679957100134e-02   -2.203551595168568e-01   -1.748963122744747e-01   +2.620986041051157e-02   +4.319395804667144e-01; +2.199733533025632e-01   -3.901763584733335e-01   +1.724103212200720e-01   +8.002126418135683e-02   -6.756948034260474e-02   +1.296955178167965e-01   +1.551218802735322e-01   +1.007234226313603e-01; -3.123798929082561e-01   +1.931328687351122e-01   -6.212557505915121e-02   +1.700017620196897e-01   -3.997008619548365e-02   -1.035513327282911e-01   -3.744730339256944e-01   +2.837256392052891e-01; -6.208576575167859e-02   +9.503927023484034e-02   +3.041887188776210e-01   +5.809191167806169e-02   -2.323585393124690e-01   -2.028109207258122e-01   +1.649709390283252e-01   +5.572677651631552e-04; +1.060007558472150e-01   -2.592880365311202e-01   +5.384779050243016e-01   -5.204885781179806e-02   +3.955093359140682e-03   +6.825885803688336e-02   -2.025429419830641e-01   -1.062073754903618e-01; +3.007301303463851e-01   +2.162040041363549e-02   -2.070282335534203e-01   +2.782102633360410e-01   +7.798304345591207e-02   +5.104964403355580e-02   -8.683711692130866e-02   -6.204662409906429e-02];
L3I_L3E_iAMPA_netcon = [-1.101465745900838e-01   +6.863894507078713e-03   -1.708127713769706e-01   -8.547648892182234e-02   +2.481578972012843e-04   +1.798839433883120e-01   +1.234651418651844e-01   -1.263899596071081e-01   -1.313740033421642e-01   +7.174867841948276e-03   +9.849817036396855e-03   +4.429538276970153e-02; -6.215754884645478e-02   -2.943029693967610e-01   +4.863637299741617e-02   -1.455391996103114e-02   +2.095695450773869e-01   +5.445753608497211e-02   -2.507892817777786e-01   +1.096226281540501e-01   -1.372218007975413e-01   -1.584429638288346e-01   -2.955637264567234e-01   -2.386297271338755e-01; -3.382833472442281e-01   -1.207805479977325e-02   -2.996131370506543e-01   -1.555524469959391e-01   +2.313367777955262e-01   -2.607708839337988e-02   +2.812288615385510e-01   +3.105261778714311e-01   +1.913095729263230e-01   -1.466855407013330e-01   -1.640137840872927e-01   -2.462448299349730e-02; -1.009446520601233e-01   +2.507285065724127e-01   -7.376254656073060e-02   -1.989789497249023e-01   +1.519858684070604e-01   -1.094301890706515e-02   -5.595567481189967e-02   -2.374899573174459e-01   -4.747411142434977e-01   -5.365717074567442e-03   +1.334328065838329e-01   +4.764922277218267e-03; -1.156626834604160e-01   +1.648232460964474e-02   -8.263251291757656e-02   +3.040577161394737e-01   +8.086067395020387e-02   +4.186593909816257e-01   -9.202797577545808e-03   +2.115309172167333e-01   -1.822072474145364e-02   +2.800197402654179e-01   +2.634291524662750e-01   +1.283839905292725e-02; -1.046315400643577e-01   -1.186979626760320e-01   -1.545879213925136e-01   -5.485777011702335e-02   +4.778415095749574e-01   -1.766526715294274e-01   +1.809461973832720e-01   +1.522527656439814e-01   -2.375989794963637e-01   +8.285207910019965e-02   -3.916180615763391e-01   -2.919018759737307e-02; -1.581668537495146e-01   +4.666725988882715e-02   -1.305447924173365e-01   +1.127048702651195e-02   +1.362959059554116e-02   +2.465849076931193e-01   +2.378991304708394e-03   -2.428929465226025e-01   +7.106341637388733e-02   -3.022354392093480e-02   +1.922453547991709e-02   -6.904602368858728e-02; +3.749095703986277e-01   +1.797260989792569e-01   -2.054892272140675e-01   +2.337697195376410e-01   +8.684677152430384e-02   +1.610877319464588e-01   -1.314400711460618e-01   -1.311543394473792e-01   -3.942933830497192e-01   +7.164999506561023e-02   -1.115969660578807e-01   -1.952741969510237e-01; +1.457005852419913e-01   +2.545939085813755e-01   -1.491783777548644e-01   -6.725753884594175e-02   -1.463099876824243e-02   +8.264069331196296e-02   +1.720536513209319e-01   +1.908466915385316e-01   +2.354329565129544e-01   -2.113024432837320e-01   -9.393108910761454e-02   -1.892631815781983e-01; -1.161896110604456e-02   +3.848089612913408e-01   +2.109646003769586e-01   +6.719782135777461e-02   +1.417835435894040e-01   -3.130816058913029e-01   +1.381333251833309e-01   -2.307062507613391e-01   -1.360477063324393e-01   +2.121426117360399e-02   -2.894175770193447e-01   -6.424014450083934e-02; +1.534647794123314e-01   -1.324030760338560e-01   -2.408146212697710e-01   +2.014627377369632e-01   -1.944247838115088e-01   -3.379827396152966e-01   -9.225553105503009e-02   +5.630183338009710e-02   -1.983696293824736e-01   -5.019744707822626e-03   -1.065423725555542e-01   +1.908770353256808e-01; -1.626968441570445e-02   -2.192884341968722e-01   +1.586244332946847e-01   +2.172871047523372e-01   +1.558171168874934e-01   -2.422177409803236e-02   -4.260825649947896e-02   -1.471069734863977e-01   +7.618782297318771e-03   +3.050686551750376e-01   -2.557630517891077e-01   +4.398292906648715e-02];
L3E_L3I_iGABA_netcon = [+2.855761748283570e-01   -1.187110673559668e-01   +3.684518251176331e-01   +1.649746117370510e-02   +2.413051093535565e-02   +1.678563946092683e-01   +1.631485565118782e-01   +2.832613345026740e-01   +1.507927458377953e-01   -2.478600382205062e-01   -1.043069513870151e-01   -1.867273606368853e-01; -3.094391535390834e-01   -3.247779608400473e-01   +1.438215726106620e-02   +2.143086334638895e-01   -2.096430411536052e-01   -2.179003986889140e-01   +3.785685874028556e-01   +8.574774520225265e-02   +4.869420893223180e-01   -1.734766855778502e-01   +2.644312409043628e-01   -1.162997496169828e-01; -5.426007146904028e-01   -3.254270147815975e-01   -1.457752433031974e-01   +2.644031842467178e-02   -3.529410828582533e-03   +6.376643874821231e-03   -3.291692114181175e-02   +6.156992637835969e-02   -2.329925909449633e-01   -4.771895430437754e-02   -4.960913783473390e-02   +2.245055990313332e-01; -4.474937291590145e-01   -2.758704890394097e-01   -1.196050805957296e-01   +2.592582074938712e-01   +2.428570231126757e-01   +6.530064753136897e-02   -2.886854180783989e-01   -1.418886809307833e-01   -8.364715079190096e-02   -3.863588722420307e-01   +1.512092072131382e-01   -1.778177271410555e-01; +1.187022807589988e-01   +3.947508842357011e-01   +4.035178750727620e-01   +2.616844862542346e-01   +9.941214496023386e-02   -1.879767209539201e-01   -1.542494691514502e-01   -2.393296494773953e-01   +3.054080742070970e-01   -3.241489421579289e-01   -2.710905124675633e-01   +8.728446737655068e-02; -1.489560361882906e-01   +1.938834635197552e-01   -5.011843848515466e-02   -1.960589846120520e-01   +1.397861761326938e-01   -2.172900367308996e-02   -1.521931685537943e-01   +1.317737882536474e-03   +1.566513301102079e-01   +4.105001600073455e-01   +2.894678385045139e-01   +2.488400910323706e-01; -6.478191581610618e-02   +2.301624491980125e-01   +1.432094086483007e-01   -2.504851659234106e-01   +3.213364202665044e-02   +9.086406772747047e-02   +1.580094644247421e-02   +1.579529134890734e-01   -3.397614192765434e-01   -9.538656462835604e-02   +4.557833325487507e-02   +3.976494132383728e-01; +1.560025850808154e-01   -1.857532705248369e-02   +2.023742116678935e-01   +1.854431036743615e-01   -5.376206196472766e-02   +1.203212078016189e-01   -2.329037569428842e-02   +6.066563102615129e-02   -1.281344980893268e-01   +2.302664142216359e-01   -2.929924155362629e-02   -3.138629856630700e-01; +3.234778518707900e-02   -8.606191269983049e-02   +2.137808725818829e-01   +7.328992039664262e-02   -2.582970110081973e-01   -3.234447766247309e-01   +2.207080708340274e-01   +2.872199992910487e-01   -1.346650414080520e-01   -2.725822129685477e-01   -4.680960490905540e-01   -2.352663410708441e-01; +2.549475337778087e-01   +8.938342977831686e-02   -2.277266198049944e-01   +2.272067457686695e-01   -5.980970139182015e-03   +1.945131805556808e-01   -2.233129376389921e-01   -1.294020488745444e-01   -1.854526495001468e-01   +7.621795884414548e-02   -1.059322212930034e-01   +2.172858917820171e-01; -8.548803640925300e-03   +1.249953909800049e-02   -1.279762744160315e-01   -1.568562128509913e-01   -3.507332513757876e-02   +1.121868547234460e-01   -6.780385172828167e-02   +4.019352350125577e-02   +1.182932793494454e-01   -1.315710126844531e-01   +2.601550797483436e-02   +1.313651047758054e-01; +2.598012476998696e-01   +2.559505812540427e-01   -2.497528103654920e-01   +2.805578877655057e-01   -9.674910974323880e-02   +1.532962079107201e-01   -7.579748458904452e-02   +2.794510976053076e-01   -3.111452784161843e-01   +1.837054492417406e-01   +1.266090465811541e-01   -1.974369621810300e-01];
L2E_Input1_iAMPA_netcon = [-1.928269151471262e-01   +2.936804806095348e-01   -1.541821782218022e-02   +2.296904788108581e-01   -3.207582511663197e-02   -3.121248159412661e-01   -1.476148617213592e-01   +1.060802648477626e-01];
L2I_Input2_iAMPA_netcon = [+4.787560712843350e-03   -2.830674936628490e-01   +2.651312853522104e-02   -2.832006516221730e-01   -3.314444656840029e-01   +1.106512970188164e-01   +6.380403620156018e-02   -3.979027098219500e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
