function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.140325529405497e-01   +9.506680712991566e-01   +7.032535396844170e-01   +1.645616818527604e-01   +9.209734159477829e-01   +2.129592782338552e-01   +7.400829502654285e-01   +3.029328937044656e-01   +5.360737299401183e-01   +8.359307319495763e-01   +9.728539383414003e-01   +9.703814201945886e-01   +6.972912077278470e-01   +3.675774947837755e-01   +2.976291586198399e-01   +3.834003569266928e-01; +3.520223773396540e-01   +7.863402725485545e-03   +1.409723037999175e-01   +1.673059639355247e-01   +7.813610379791992e-02   +8.119640585018405e-01   +7.987691596596171e-01   +7.526638692376935e-01   +7.927565705985800e-01   +1.911713408790252e-01   +4.774808275709434e-01   +6.632791234982877e-01   +3.667583036422777e-01   +2.754345050459017e-01   +6.881189859901006e-01   +9.605488612739004e-01; +2.005102558244009e-01   +4.768534402253006e-01   +8.382839887188241e-02   +7.098258217160561e-01   +3.163446908114380e-01   +3.825123097390203e-01   +6.600141320530549e-01   +9.541214816618847e-01   +4.959966932836519e-02   +9.263729466341231e-01   +8.714994118580577e-01   +1.997467819351264e-01   +5.455582926303769e-01   +7.237633724863750e-02   +7.796630797682215e-01   +8.095960511782804e-01; +2.459870237977300e-02   +4.901186627282615e-01   +4.290760237446676e-01   +8.377068557126990e-01   +6.329810232604682e-01   +8.610682485703230e-01   +4.405111402971209e-01   +6.672757646181789e-03   +4.600301991169555e-01   +4.200428937910812e-01   +9.421833819019981e-01   +9.006496836456076e-01   +5.141082434951780e-01   +1.571993139912525e-01   +7.149144877379370e-01   +8.948402053442791e-01; +7.664791332467900e-01   +5.159396239706631e-01   +9.017756942295411e-01   +8.225525949758457e-02   +9.058663739554722e-01   +3.224278597023043e-01   +5.787329539446951e-01   +4.033233891914880e-01   +9.404170532678690e-01   +2.993673274629527e-01   +2.421095451995752e-01   +4.824081605071781e-01   +7.687059843431986e-01   +3.645763774349308e-01   +2.728707783172465e-01   +6.700654644958820e-02; +5.726480663813233e-01   +2.865268394016675e-01   +7.207270173120417e-01   +8.371272890971087e-01   +7.980619991231729e-01   +3.815052924297381e-01   +5.163649583914003e-01   +1.571058331848970e-01   +4.749546104938311e-01   +3.567025738794075e-01   +9.190824590854126e-01   +6.663527251743214e-01   +7.392035750559414e-02   +7.126970391120523e-01   +1.905154863410011e-02   +9.019687836550837e-01; +5.810160290519765e-01   +5.619310679786816e-01   +6.838273237168058e-01   +5.506117770656616e-01   +6.484123114600059e-01   +6.444883144411552e-01   +7.288828866651196e-01   +8.300067032477925e-01   +7.766739259726382e-01   +9.772920989842993e-01   +6.333419825203733e-01   +5.308004691569064e-01   +5.134511561125236e-03   +5.430141488044604e-01   +1.785376799340701e-02   +6.748603186650003e-01; +3.860258891852992e-01   +5.177008802394745e-01   +2.066168087416097e-01   +9.680786561993592e-01   +4.407921165453937e-01   +3.912830861529292e-01   +2.213606395244205e-01   +2.891769617135957e-01   +1.094824224230042e-01   +5.364857191499696e-01   +2.878748661780546e-01   +7.043804248807928e-01   +4.036500901019350e-01   +2.318786000716312e-01   +9.290185410279388e-01   +3.461153628182457e-01; +5.529985175101794e-01   +6.717596795269676e-01   +5.271659755445952e-01   +6.718651649610847e-01   +7.499256274287093e-01   +7.369669460133405e-02   +9.996196901835386e-01   +9.813454948861630e-01   +5.191869624424960e-01   +7.941890392170937e-01   +8.495464664379712e-01   +7.154664302492287e-01   +6.639649647603947e-01   +4.697726647902317e-01   +9.357913489364474e-01   +8.437280125669464e-01; +1.863164234653596e-01   +6.173186142667594e-01   +8.241652437632122e-01   +3.356775338704768e-01   +8.318894497008680e-01   +1.753566115580734e-02   +6.216282623404548e-01   +6.221796760466634e-01   +6.405947501777697e-01   +8.003627491329462e-01   +1.634802945333890e-01   +2.963299007146726e-01   +3.717409171314122e-01   +7.179975097767380e-01   +3.761540912665417e-01   +1.971138207623414e-01; +1.172089144647266e-01   +5.672536921524065e-01   +1.824697584911000e-01   +2.163007335339999e-01   +3.496673794061030e-01   +8.741629248030879e-01   +9.905927483417354e-01   +7.481195058476007e-01   +5.787933631899015e-01   +1.392486457838120e-01   +8.261502600371400e-01   +1.126972605749194e-01   +3.955103178032575e-01   +5.207617174171707e-01   +1.054038801802074e-01   +8.438238279969122e-01; +5.410499298832459e-02   +5.092479113242288e-01   +5.170216548187530e-01   +5.698846188111499e-01   +1.524210522843092e-01   +1.594755497937958e-01   +4.913537208883311e-01   +8.860849047457552e-01   +8.406745453577734e-01   +4.550317601137399e-01   +2.193430563234887e-01   +3.306082207865726e-01   +1.351136250986021e-01   +5.158478018055938e-01   +7.244233552229268e-01   +4.276383846841027e-01; +9.356032024140962e-01   +6.692000732654313e-01   +3.568797915668081e-01   +6.659817793482407e-03   +5.032631553773894e-01   +9.212997624242506e-01   +5.276708021856508e-01   +3.343103837783127e-01   +1.177613781095414e-01   +4.540656335051121e-01   +2.736441647408456e-01   +4.625564334885923e-01   +3.383160469354831e-01   +3.914636386495075e-01   +4.557226964736228e-01   +5.567608886121083e-01; +7.423455669332378e-01   +6.399195455426228e-01   +6.536659743369403e-01   +5.942700304770265e-01   +4.128946488915015e-01   +5.668715848678012e-01   +8.540478918455020e-01   +9.438037241390614e-02   +5.248556523359584e-02   +9.579465132376557e-01   +9.251629796143214e-02   +7.152731101968853e-01   +1.211389424048706e-01   +4.827389781370090e-01   +1.378416443166473e-02   +4.454315275630972e-01; +2.389729491258090e-01   +1.417739228667306e-01   +2.803661993499481e-01   +8.955110768705338e-01   +1.750145632290404e-01   +9.219131528477211e-01   +2.554581994439246e-01   +4.464092900414257e-01   +5.207735831671317e-01   +4.915532187252653e-02   +9.148096913910544e-01   +3.998650107759389e-01   +3.704083981150558e-01   +7.430783652459380e-01   +1.161802760169393e-01   +7.614773442180668e-01; +2.019942766613003e-01   +1.813774546329902e-01   +4.361241011314994e-01   +2.595552763473489e-01   +4.932858929946588e-01   +5.948579158778428e-01   +5.766905357334539e-01   +2.381908130800912e-01   +7.032729794271620e-01   +3.917056730202927e-02   +7.315294612452385e-01   +2.391675473041772e-01   +2.477424444305450e-01   +7.055928113623268e-01   +6.640851793694046e-01   +9.380466926625312e-02];
L1E_L1I_iGABA_netcon = [+8.402023819284999e-01   +7.483400738456070e-01   +8.730602872912449e-01   +4.349841973764381e-01   +9.212335693982456e-01   +7.695942619838917e-01   +3.222608635784731e-01   +6.433351871165999e-01   +9.437180477129029e-02   +2.732938166394842e-02   +1.276072779388576e-01   +5.174850316671171e-01   +8.760902159006859e-01   +5.717060479958468e-01   +1.708490754536880e-01   +6.342944157252457e-01; +6.167630066128698e-01   +9.940864566003872e-01   +3.125813844983621e-01   +1.440417281152002e-01   +8.894791641601328e-01   +2.737015633219487e-01   +9.638544718049513e-01   +4.367723103488958e-01   +2.951353288926842e-01   +5.137718522555812e-01   +4.337601615322865e-01   +2.060496614037398e-01   +8.056751261356483e-01   +2.934351174973414e-01   +5.561692853363352e-02   +3.398037747656230e-01; +6.626946896129779e-01   +3.724721106919530e-01   +4.324884965360780e-01   +6.508069745393420e-01   +5.922662741953708e-01   +5.226413481428058e-01   +3.514111166468384e-01   +4.819328786263793e-01   +3.294804243940077e-01   +8.680944821337057e-01   +4.798864534138146e-01   +7.708150547616256e-01   +6.460745724944467e-01   +1.394949077467266e-01   +2.195885920419744e-01   +1.527015282701826e-01; +7.788006833314495e-01   +5.095111711238469e-01   +3.771436963844965e-01   +7.259198661752744e-01   +8.347140809291123e-01   +4.113710534680577e-01   +3.152862188588378e-01   +9.661541263565368e-02   +4.763850743298325e-01   +5.784671492645261e-01   +6.750630838905002e-01   +3.891006620945899e-01   +7.372381166932518e-01   +4.320274176079856e-02   +2.053423817669089e-01   +3.999016846658784e-01; +3.168161780251588e-01   +7.547039435239286e-01   +6.530037603481904e-01   +1.704818569504495e-01   +7.820154102388258e-01   +7.849285102166643e-01   +9.126257990754820e-01   +8.026902506077473e-01   +2.394755177625245e-01   +4.256482234065073e-01   +3.523008745117603e-01   +6.997891186976073e-02   +6.641046199496076e-01   +6.228381069923139e-01   +2.147935382426645e-01   +9.140591624845605e-01; +3.257752252881422e-01   +1.328030229542661e-01   +2.481324735586556e-01   +3.408204364297153e-01   +7.889735087300302e-01   +2.759974570552030e-02   +8.841781907419586e-01   +6.189269463955148e-02   +4.576079435006771e-01   +7.173525461711122e-01   +4.208660532944138e-02   +7.493404262167090e-01   +8.843855272164384e-01   +6.059390345971538e-01   +5.796427615057280e-01   +1.543387784525497e-01; +6.297813020144940e-01   +5.201945712903684e-01   +6.897121366755303e-01   +1.024846632668673e-01   +6.970712904336162e-01   +4.103381822535848e-01   +3.610342370727589e-01   +9.561401937775953e-01   +7.567546909740295e-01   +2.314925519533262e-01   +2.912335328086090e-01   +4.566560833607614e-01   +8.532437611396451e-01   +3.709558049271667e-01   +3.692439392008219e-02   +4.696041992276323e-01; +9.008356732112149e-01   +9.090554824753434e-01   +3.295084694431710e-01   +4.695640809920493e-02   +1.994573502514423e-02   +8.293781626824274e-01   +7.402048061723411e-01   +7.719330469958549e-01   +7.167560372437685e-01   +5.906415229417929e-02   +8.010053513671047e-01   +3.145202396015719e-01   +4.056922390726903e-01   +8.342037616559421e-01   +7.989822982553124e-01   +8.211823386652041e-02; +3.698703501811639e-01   +1.009629547522278e-01   +8.717335854900152e-01   +4.748686447681309e-01   +3.247737147352019e-01   +5.936617781213288e-01   +1.256123457351436e-01   +4.483373464418770e-01   +2.331298585004109e-01   +9.733361066055217e-01   +6.507642761050697e-01   +2.746449639365189e-01   +1.099453903643018e-01   +5.193020076854018e-01   +1.369626804938430e-01   +3.350050890836869e-01; +8.826115943005862e-01   +1.821745425773850e-01   +9.976920527032754e-01   +4.782145836588078e-01   +9.464334975586262e-01   +2.103422017158892e-01   +5.908694729957614e-01   +1.689355493613621e-01   +7.020175661098808e-01   +9.696118611825071e-01   +7.102823432377892e-01   +5.728831159176802e-01   +4.074785752669627e-01   +8.126987216036611e-01   +5.787465333940941e-01   +4.902282033927794e-01; +1.176348756787214e-01   +1.811253282994311e-01   +6.885465133623537e-01   +5.516971353868347e-01   +4.055459861009112e-01   +2.911686645969046e-01   +4.380138939905767e-01   +8.088323303285198e-02   +3.040778095062339e-01   +1.311996860412938e-01   +7.561726926150015e-01   +9.125497600477210e-01   +3.348112049230763e-01   +5.782491847935181e-01   +8.285600785711351e-02   +5.027398472773771e-01; +9.364557475000883e-02   +5.366858198566087e-01   +3.479119673524271e-01   +6.465651649041400e-01   +6.252844415357997e-01   +2.687267274473429e-01   +9.655476979082872e-01   +7.432571787636444e-01   +4.698343285118557e-01   +3.702688826978304e-03   +3.891943448026681e-01   +4.501509839755232e-01   +1.091403983351832e-01   +7.120858213844036e-01   +2.258906268740855e-01   +1.321474363239091e-01; +5.439054261168509e-01   +9.739838521853900e-01   +5.610064045349896e-01   +3.493471169643141e-01   +8.504241601343676e-01   +9.332723085622635e-01   +9.739032941378083e-01   +5.352725284387435e-01   +4.385636732582074e-01   +9.336884770863532e-01   +3.640633463320222e-01   +9.808514372816698e-01   +8.600700135277726e-01   +7.309280953254662e-01   +4.445998048919234e-01   +7.529284183869325e-02; +6.023009825420242e-01   +8.412121714719186e-01   +8.930980475558072e-01   +2.524750756195513e-01   +3.677939395812130e-01   +5.553844680036759e-01   +2.496908755239655e-01   +4.850609387363350e-01   +7.303167636880983e-01   +7.408951084900496e-01   +8.112523450888498e-01   +1.045008676207660e-01   +8.989289765790911e-01   +4.472506385207640e-01   +1.770901630594688e-01   +6.749630090520874e-01; +7.232656386124433e-01   +6.699199748666640e-01   +6.480856625120778e-01   +1.791237786464327e-01   +2.036907153684120e-01   +4.305127537510071e-01   +7.740815098775172e-01   +8.844400258586361e-01   +8.759766407292341e-01   +4.280081774433751e-01   +3.877884482682085e-01   +4.191693532933868e-01   +6.905282658549150e-01   +2.804859460985558e-01   +4.150657838762968e-01   +1.174678760001916e-01; +9.942987473136269e-01   +1.255027677856472e-02   +3.805812237168495e-01   +4.762466399065603e-01   +9.097431369303179e-01   +3.270743703302604e-01   +7.103819423376174e-01   +5.878782969858665e-01   +9.122351596759022e-01   +9.440353726123687e-01   +8.692715764208524e-01   +3.883329776082302e-01   +7.483507886454613e-01   +1.555893762793045e-01   +9.628302905158819e-01   +9.871475706269328e-01];
L2I_L1I_iGABA_netcon = [+5.695749666012578e-01   +5.654539884501348e-01   +1.077197962865083e-01   +4.539144410357395e-01   +8.001493570329099e-01   +9.749776593099112e-01   +2.236921643704007e-01   +7.589870216399596e-01; +5.640843205070249e-01   +9.505011969403453e-01   +1.306020375763630e-01   +5.682558848850480e-01   +5.434136979655835e-01   +4.244465772596488e-01   +6.328094743455816e-02   +4.991740184261826e-01; +6.056257961100915e-01   +1.285033051970785e-02   +4.361032894669252e-01   +8.210066014290287e-01   +2.576973461850306e-01   +3.897380394238162e-01   +8.273069616345882e-01   +8.259225417778496e-01; +4.660101290979551e-01   +1.235643168001360e-01   +9.297480285282322e-01   +3.614746804046033e-01   +7.791185250846392e-01   +4.605621717608507e-01   +4.153498232894810e-02   +9.185542304705736e-01; +4.371734179665231e-01   +8.553165247330997e-01   +1.386710272644000e-01   +2.413107547221672e-01   +7.794087810977604e-01   +1.299941374330635e-01   +9.112504410432901e-01   +7.091535338720291e-01; +6.918291702983903e-02   +2.207125635707301e-01   +8.195823563190631e-01   +7.649673792877147e-01   +1.462727092000193e-01   +4.636428014779261e-01   +4.525664332312268e-01   +8.023249465923007e-01; +6.405289388662341e-01   +7.028750114707119e-01   +9.327494467386145e-01   +2.755678508112029e-03   +8.285802075718193e-01   +2.663978302825989e-01   +2.811967452752516e-01   +9.593908948356017e-01; +4.240328724033912e-01   +7.772260664324355e-01   +5.737327697901152e-01   +2.805442816536147e-01   +6.235038615665073e-01   +1.035820301676997e-01   +7.558694876445163e-01   +9.514998133666911e-01; +7.536737578419092e-01   +4.261450278810917e-01   +4.989176655199666e-01   +3.360005690855798e-02   +4.634989340395719e-01   +6.578485663428986e-01   +9.269916810923163e-01   +2.974096729862727e-01; +3.042885517062845e-01   +7.302999476657137e-01   +9.276240592316324e-01   +6.681638960619005e-01   +4.861739212557543e-01   +9.407038422242326e-01   +1.407390220350463e-01   +3.530353313477203e-01; +5.993794805990310e-01   +4.517921747818210e-01   +8.634183238100320e-01   +9.723543537255543e-01   +2.208843557322820e-01   +7.665731145043921e-01   +9.448212946572289e-01   +5.455739299901289e-01; +3.282839864639203e-01   +8.032724057016152e-01   +2.537844557767184e-01   +9.463873186063406e-01   +8.531870316558038e-01   +4.193212581191333e-02   +3.158560587281176e-01   +2.113526605842093e-01; +6.445149693243760e-01   +4.300146232996047e-01   +4.560862761543664e-01   +4.742864406594573e-02   +8.783401650305013e-01   +2.608032242654126e-01   +2.079646269253488e-01   +7.938859173372316e-02; +3.413731007341878e-03   +1.510224925390677e-01   +7.376007663535363e-01   +2.874546812397860e-01   +8.384258956912300e-01   +6.406722855073863e-01   +4.620445720447847e-01   +5.096561485222272e-01; +1.485044451988184e-01   +8.027347675990468e-01   +7.513576713659512e-01   +4.808385174771124e-01   +4.427310898964237e-01   +8.728786811678903e-02   +5.942725984833394e-01   +1.957466697677539e-01; +2.463917985980989e-01   +3.753261378901037e-01   +2.384898815534971e-01   +8.849830119993164e-01   +5.421949171526110e-01   +7.441860035669297e-02   +5.483726736901950e-01   +1.444643577339521e-01];
L1I_L2I_iGABA_netcon = [+7.124523739634225e-01   +8.693892390719841e-01   +6.157316337108293e-01   +4.872778050292596e-02   +1.475764694326460e-01   +2.348888199187610e-01   +8.414993111471202e-01   +3.665060348605132e-01   +7.123024887040139e-01   +3.905651758347031e-01   +2.441762404272896e-01   +6.750550531572508e-01   +1.617039603534751e-01   +5.704154665577502e-01   +4.516113413823740e-02   +4.677135986369286e-02; +6.076775385455642e-01   +8.018921942524672e-01   +6.188556367520264e-01   +5.209250999680861e-02   +7.463049321079791e-01   +5.519381063979706e-01   +1.984126142148666e-01   +5.610214621308941e-01   +1.895810140608586e-01   +7.256985229847845e-01   +5.078329659748912e-01   +3.388529702307663e-01   +1.075491348464884e-01   +8.133380945638530e-01   +4.355206157760348e-01   +9.226010127555030e-01; +1.613552120211617e-01   +6.215005567388201e-01   +3.080204055811387e-01   +5.998993981509076e-01   +9.503171999244954e-01   +1.122603947566397e-01   +6.148736915769925e-01   +8.369045906496522e-01   +2.326093429005457e-01   +6.348924307891620e-01   +7.350908997596283e-01   +5.480376672653290e-01   +7.452966449494652e-01   +6.757310663622942e-01   +9.253435575351946e-01   +1.752458885261874e-01; +4.801616464322896e-01   +4.791501085191744e-01   +1.337233363276888e-01   +6.608944379759570e-01   +2.618436622504074e-01   +8.240923153493552e-01   +1.595506553729122e-01   +7.150579562639069e-01   +1.000000000000000e+00   +9.667923402090355e-02   +7.823203168216127e-01   +5.341349963536461e-01   +2.177807635180783e-01   +4.416156405701718e-01   +8.848175799059228e-01   +7.462563105108960e-01; +2.912713255726024e-01   +2.054799615518326e-02   +6.021878926766336e-01   +4.868527274571816e-01   +9.335139070710784e-02   +6.580518746247876e-01   +5.870386679062218e-01   +1.158289273345401e-01   +9.025453117669573e-01   +4.953105922559891e-01   +6.829779035787915e-01   +9.078157344165197e-01   +4.860254603463704e-01   +8.891827275559921e-01   +9.454599365773837e-02   +4.698430387784097e-01; +4.026281483193071e-01   +1.215504636161565e-01   +8.943168642453941e-01   +9.812147566648186e-01   +2.329335853557416e-01   +2.341535661480799e-01   +5.428248424635669e-01   +7.419408112264252e-01   +1.186433307226733e-02   +5.540996778049151e-01   +8.133123422499067e-01   +2.874877826896542e-01   +4.912885244305736e-02   +7.881816096107641e-01   +6.836092193925414e-01   +2.516555691398952e-01; +4.877482124980131e-01   +7.242037225370569e-01   +5.660378700066766e-01   +8.661031236646353e-01   +8.894822369919450e-01   +3.042015716910518e-01   +6.887625760759942e-01   +9.225584276753138e-01   +8.364159591261012e-01   +5.470111077565168e-02   +4.220571727700644e-01   +1.372315489107970e-01   +5.791106910617281e-01   +5.882464462157931e-01   +1.406445572656826e-02   +6.646836795909939e-01; +8.641713546241298e-01   +6.685226388603992e-01   +6.351112929158502e-01   +9.583090545565602e-01   +1.996500917222940e-01   +3.245871130350730e-01   +6.988186422620494e-01   +9.211267960357904e-01   +2.517892443939305e-01   +8.218978861497812e-02   +4.957177339732096e-01   +9.560163758632626e-01   +4.951423800756324e-01   +6.196404205732186e-01   +1.261596341486125e-01   +6.101244140043826e-01];
L2E_L1E_iAMPA_netcon = [+3.719693332387259e-01   +5.636210677029125e-01   +2.023913880034880e-01   +5.168124579160258e-01   +2.943345973600126e-01   +6.995338800822262e-02   +2.809971434720782e-01   +2.639335728126728e-01; +4.339853987216136e-01   +1.867690870065056e-01   +1.405399797222916e-01   +6.819020129049339e-01   +6.173172540071578e-01   +5.907357016155601e-01   +9.304222103158735e-01   +8.991904541150562e-01; +7.187646703814332e-01   +6.065227357063169e-01   +7.946931046801592e-02   +2.109698096755862e-01   +8.715360265350115e-01   +7.848187092195148e-02   +7.601501158474007e-01   +1.555007912396764e-01; +1.962755896172513e-01   +7.315401405120870e-01   +9.155082673987454e-02   +9.716701360038799e-01   +8.150168849144257e-01   +3.965871666620209e-01   +2.603705092993472e-01   +5.509506009115567e-01; +4.741697316930914e-02   +8.364518748386823e-01   +5.508562088956663e-01   +3.492279965764382e-01   +2.108673456683173e-01   +5.276099457320167e-02   +2.454288581629176e-01   +4.237289827123917e-01; +3.123619238191699e-01   +2.733390049965241e-01   +7.287123015805481e-01   +1.822761904536297e-01   +7.494664906714558e-01   +1.261713195643293e-01   +1.629124561340745e-01   +5.477352590638540e-01; +7.937555124776559e-01   +6.065753884534425e-01   +5.463441269445443e-01   +2.459199268592105e-01   +2.005438537767943e-01   +2.415747362907360e-01   +2.911032075423638e-01   +7.461127963634983e-01; +4.043952694000329e-02   +5.472085703405396e-01   +4.781053316968525e-02   +2.566051880014049e-01   +5.826814789741938e-01   +9.422368927302260e-01   +5.647924801496093e-01   +1.488524236774998e-02; +2.157904057286220e-01   +2.780909008874202e-01   +6.367019536095775e-01   +2.186255465856509e-01   +8.773597426934292e-01   +2.075276176803986e-01   +3.985233360085384e-01   +8.379220346722989e-05; +2.686217567335420e-01   +3.386968080364422e-01   +9.915896192083689e-01   +3.914936911498466e-02   +7.157859196493653e-01   +3.287564914397810e-01   +9.869802397640168e-01   +2.001907835166486e-02; +7.936694529552114e-01   +5.714787060192752e-01   +9.142083415488926e-01   +3.529034109970390e-01   +6.986805030244118e-01   +8.671940830310502e-01   +5.462740955011531e-01   +3.516453015764173e-01; +9.833342276685456e-01   +7.436918377012768e-01   +7.723474242608350e-01   +8.976851713968015e-01   +4.596657901782521e-01   +9.220492273779409e-01   +9.337924374780724e-01   +4.278661201873741e-01; +9.450060765189038e-02   +7.650020264730510e-01   +1.940090852111381e-01   +1.343921570151280e-01   +5.044994571992817e-01   +2.061293304866098e-02   +9.877390810409634e-01   +5.453547657687057e-01; +2.009059584250317e-01   +4.042261818030581e-01   +2.807345840092625e-02   +9.521885793037341e-01   +8.001675816049292e-01   +3.608439404717951e-01   +8.314176447496990e-01   +4.828147520951978e-01; +1.191745426971580e-01   +1.549120318886933e-01   +3.767686132444284e-01   +9.067951889301361e-01   +9.348440268674350e-01   +5.323131909973275e-01   +1.804751511711005e-01   +9.148756750231357e-01; +6.407686473310756e-01   +2.069254382539967e-01   +5.772514670893726e-01   +4.101133636998609e-01   +7.909141927189099e-01   +4.068270523957366e-01   +3.125110218064808e-01   +4.164250283291552e-01];
L1E_L2E_iAMPA_netcon = [+4.971874618580960e-01   +4.564215475081636e-01   +6.162029774904030e-01   +4.914871188725619e-01   +2.339732671128991e-01   +7.154664220095286e-01   +6.861166375293775e-01   +6.370483288436145e-01   +5.215686190078727e-01   +2.419725811662627e-01   +8.724237273609251e-01   +1.770154040582747e-01   +1.376720155214493e-01   +2.471409262449076e-01   +1.837814520590874e-01   +3.057064158482361e-02; +8.331022811800509e-01   +3.620528705290380e-01   +1.036307577070364e-01   +6.647763131812326e-01   +8.367807515699754e-01   +3.801913768970819e-01   +9.726551168034898e-01   +6.231061658970648e-01   +6.713479847918844e-01   +7.288173835471307e-01   +6.630687522933553e-01   +2.982895574576161e-01   +2.866337788463129e-01   +7.457897039157491e-01   +1.495324123126469e-01   +2.515300206629882e-01; +1.834585155416503e-01   +2.944213685473081e-01   +7.569942573269248e-01   +1.801806501172076e-01   +7.334314563350718e-01   +3.770770527532503e-01   +7.562652308371295e-01   +4.110445674552752e-01   +7.722842541472873e-01   +1.267484412649444e-01   +5.448853162738720e-01   +1.058283644380226e-01   +5.048706050007793e-03   +9.331026732665576e-01   +1.343951499882578e-01   +9.899724906282841e-01; +3.382370694986837e-01   +2.397269682539587e-01   +5.420814111661724e-01   +4.752881491350486e-01   +4.891795398618821e-01   +7.179304352659613e-01   +5.528445663825683e-01   +4.314304642204376e-01   +4.638708219360285e-01   +4.013077582271541e-02   +2.461405646845972e-01   +4.518215790818992e-01   +3.068735805389555e-01   +3.202843746910020e-02   +1.657474395047181e-01   +6.316124159891067e-01; +6.927154775044422e-01   +1.360862092262773e-01   +4.458591461877693e-01   +4.999940363891099e-01   +8.505516961235134e-01   +8.307030334845258e-01   +2.954733638668935e-02   +5.117023260191733e-01   +9.061675443170056e-01   +6.512446746248652e-01   +1.105996293453353e-01   +5.859771225998069e-01   +9.086483883934011e-01   +4.310726239596805e-01   +9.233080867265444e-01   +3.598717810482993e-01; +6.926366483335831e-01   +1.001185320060747e-01   +7.430755832088390e-01   +6.034372952616545e-01   +7.213919216615876e-01   +6.711077069570831e-01   +1.889986909358896e-01   +2.599309916313395e-01   +2.145907332401767e-02   +1.986699315904856e-01   +9.704878016306280e-01   +2.207706027440658e-01   +2.938063050037455e-01   +8.278971846583133e-01   +2.618949283001699e-01   +1.002720232381870e-01; +3.693611867631448e-01   +2.336537270042665e-01   +3.895172043331497e-01   +2.447157061287632e-01   +5.222834563397754e-01   +6.468664658422217e-01   +9.379285890581227e-01   +4.228007911879076e-01   +4.844549140812995e-01   +9.711015461918658e-01   +5.878291543001618e-01   +1.048764296170147e-01   +8.271836653470612e-01   +9.979775512670304e-01   +2.051467391839660e-01   +4.153752132003916e-01; +3.250239241361434e-02   +3.495921255373274e-01   +5.321280902547966e-01   +5.194928142205427e-01   +9.402318856427245e-01   +5.625311020316180e-01   +3.933183974140553e-01   +5.215302454848693e-01   +2.718915497146777e-01   +8.218904752450474e-01   +8.178390006422861e-01   +5.615608725979947e-01   +7.391883814060650e-01   +9.227658286793520e-01   +6.176111285067467e-01   +9.264510614034844e-01];
L2I_L2E_iAMPA_netcon = [+6.772109270707487e-01   +6.114963124311698e-01   +4.044328325945742e-02   +7.982338962509986e-01   +5.229826201621021e-01   +8.230804458168919e-01   +6.465707874921016e-01   +3.883566522655348e-01; +2.320220420079415e-02   +9.432018591868255e-01   +5.362046007615554e-02   +9.351624258194695e-01   +6.642500680284540e-02   +1.097301531349988e-01   +3.395359119306914e-02   +1.709622398099852e-01; +7.342904506872882e-01   +9.609693064444419e-01   +4.068366775507122e-01   +9.402287979866785e-01   +2.867725185185814e-01   +2.478572100276166e-02   +5.649937565165841e-01   +4.435374691292890e-01; +2.166267410422834e-01   +3.649196549200385e-01   +9.793439620552734e-01   +1.456117730542198e-01   +7.177720873181730e-01   +6.898990259370917e-03   +3.090006827674683e-01   +8.776957033355516e-01; +8.538920808960090e-01   +7.985730291340117e-01   +7.102975373018088e-01   +3.247772806709045e-01   +8.883484373214761e-01   +3.371222497142721e-01   +2.629501744670680e-01   +4.067410880244837e-01; +1.580552882959109e-01   +7.225509728984527e-01   +9.894144508292564e-01   +4.255363741108869e-01   +3.644949590934879e-01   +6.644606765249693e-01   +7.199956942498996e-01   +1.667037253110376e-01; +6.703261471838015e-01   +9.499885738325625e-01   +6.464050306897619e-01   +7.063593411708324e-01   +5.662718278213906e-01   +5.902736223815376e-01   +3.081281548064057e-01   +6.668787848109968e-01; +9.324460456488006e-01   +1.431565448220914e-02   +5.000028893139292e-01   +6.181824182358486e-01   +8.822342442420130e-01   +7.818501701163198e-02   +9.016569592646589e-01   +9.319474928312674e-01];
L2E_L2I_iGABA_netcon = [+6.146965025539330e-02   +5.221078221709359e-01   +3.469520849987905e-01   +2.574887759751113e-01   +4.431899618970864e-02   +9.039941964741185e-01   +3.432461462099479e-01   +4.530246345996992e-01; +3.519314507931592e-01   +6.367002939234671e-02   +5.559672362253496e-01   +9.835134100049092e-01   +3.619119521188754e-01   +5.516835002796691e-01   +9.327397173046681e-01   +6.712934503719590e-01; +9.299826294865171e-01   +1.840613835938346e-01   +6.912073870036739e-01   +3.497539964070225e-01   +3.973277369953815e-02   +7.108666453318199e-01   +9.130266903681640e-01   +7.720050046479711e-01; +2.398832960381050e-01   +3.153278506965637e-01   +4.979389353311886e-03   +3.922405144237370e-01   +4.906698035398846e-01   +7.161933208664192e-01   +7.285360262667296e-01   +9.252654707957325e-01; +1.097844069737905e-01   +2.474483623692557e-01   +4.791810672867715e-02   +7.541676796686789e-01   +7.286199631577643e-01   +1.719601362907680e-01   +4.439528343355839e-01   +6.530338309651462e-01; +7.083308474370110e-01   +3.207119477813682e-01   +3.032939272774281e-01   +1.079116392696153e-01   +1.739060390773605e-02   +3.518707080682087e-01   +1.488530823887093e-01   +5.033233620640462e-01; +5.058766721427526e-03   +8.723760937066712e-01   +8.737111118324330e-01   +5.978987159009707e-01   +5.090270801456587e-01   +3.770500771381617e-01   +8.313034663189792e-01   +3.449106952523981e-01; +1.771313528861143e-01   +3.046845648774094e-01   +6.250383277800704e-01   +1.210586008171565e-01   +2.459526959787725e-01   +7.590777779080103e-01   +2.490399386095346e-01   +9.429078571506438e-01];
L3E_L2E_iAMPA_netcon = [+7.654126640619346e-02   +1.551239811847356e-02   +3.699188065120632e-01   +4.937498629548218e-01   +2.159333839109381e-02   +9.618186056263598e-01   +3.570692426576234e-01   +2.266499963864566e-02   +2.060952386642851e-01   +7.134353009485571e-02   +2.417362586828177e-01   +1.000000000000000e+00; +9.526166403420839e-01   +9.811519786476739e-01   +1.194004323292252e-01   +6.681419185168255e-02   +8.092646144126225e-01   +3.908139089363271e-01   +2.265888660067099e-01   +1.302998765709384e-01   +3.546758585392130e-01   +7.488357910751331e-01   +5.390741702567400e-01   +3.420779223829787e-01; +6.627438289354102e-01   +7.191313114314629e-01   +5.114649006669882e-01   +8.714236323941952e-01   +7.973388115912848e-01   +6.645786807620238e-01   +7.243207419259031e-01   +6.675723099336787e-01   +8.904459840506662e-01   +9.915911518867823e-01   +3.374790900911400e-01   +8.277652293990277e-01; +1.661161545821677e-01   +8.773545698854016e-01   +5.158445834928170e-03   +9.985478883015950e-01   +4.163859885230260e-01   +5.819652906716791e-01   +7.716779266026339e-01   +5.070698620043941e-01   +8.174465107006076e-01   +7.694452066009213e-01   +6.716788666916694e-01   +1.088848760866367e-01; +1.973680029219770e-01   +8.161201740014965e-01   +8.685194190964329e-01   +1.170421093939596e-01   +6.347937868114096e-01   +5.111045074321545e-02   +3.375747616450244e-01   +7.416602339702498e-02   +3.160328713302523e-01   +8.904581855164226e-01   +8.774704770932097e-01   +7.803458425176869e-01; +9.899457710303659e-01   +3.523293331140601e-02   +9.066017297033054e-01   +1.052511107694219e-01   +5.683732796407402e-01   +7.368594148534090e-02   +5.717820674992689e-01   +5.363895087417816e-01   +5.974687145014527e-01   +4.222083598203798e-02   +9.788966972361605e-01   +1.536085419913731e-01; +9.334124909184933e-01   +9.275981149916376e-02   +1.098715392833012e-01   +1.468298665289928e-01   +9.070440025306650e-01   +2.299397528297496e-01   +6.363990092731758e-01   +6.854702138732826e-01   +7.015272267788216e-01   +7.977712671648159e-01   +1.373652952973667e-01   +7.332109076066967e-01; +9.788015587962716e-01   +9.775949237519606e-02   +4.074741530124629e-02   +1.293074636147307e-01   +7.512963706790410e-01   +4.138723030383995e-01   +3.674347302805925e-01   +5.883958295167249e-01   +1.812103227064794e-01   +7.133665500554078e-01   +8.827665069730484e-01   +1.181464432285670e-01];
L3I_L2I_iGABA_netcon = [+7.685419951564453e-01   +5.383715997192163e-01   +5.990177935603773e-01   +3.060027991987518e-01   +9.635727949148997e-01   +1.132741395036673e-01   +2.925131127279457e-01   +7.950646114417752e-01   +9.225821691821444e-01   +9.972437649612934e-01   +3.075822416669584e-01   +9.931615831091422e-01; +6.370871443168393e-01   +4.481431103324863e-01   +5.611011488675359e-01   +7.578183719976280e-01   +5.481237773948182e-01   +6.454986201766091e-02   +1.685223817402565e-01   +5.114692101357990e-02   +3.881939236715551e-01   +2.932544423723664e-01   +4.463201756361769e-01   +9.176719463157069e-01; +7.970393763245979e-01   +1.145969856037569e-01   +7.536137971213315e-02   +6.500470928018370e-01   +9.786801183255164e-01   +4.606223756696578e-02   +7.240837964773749e-01   +1.801334578232535e-01   +7.499968510466098e-01   +5.258076084223035e-01   +2.022910978218053e-01   +6.892187558139653e-01; +9.646978080790205e-01   +7.173567593613843e-01   +7.671279742732239e-01   +3.320632708530378e-01   +1.239996766979913e-01   +1.311841929792776e-01   +2.997616177413279e-01   +2.474791577352112e-01   +8.812400696881527e-01   +3.605158138565998e-01   +9.440657226062252e-01   +2.167231229423164e-01; +7.112950278596437e-01   +1.856322392218722e-01   +8.659121913650940e-01   +9.764605238087257e-01   +1.631647146873610e-01   +4.909698698588625e-01   +6.781176582096314e-01   +2.585800516585718e-01   +3.963186828220198e-01   +5.219934769176341e-01   +2.897251547748408e-01   +3.097479142211355e-01; +6.436977011896680e-01   +3.275399390025199e-01   +7.019145623207319e-01   +5.320884318624389e-01   +3.356548202627062e-01   +4.691446578643296e-01   +7.509502277766290e-01   +6.488041833651008e-01   +1.720420068242168e-01   +4.937686971762086e-01   +1.157200399185323e-01   +2.280691321340909e-01; +5.180105990754698e-01   +9.670914834554861e-01   +1.114685647674975e-01   +7.516123948855942e-01   +5.317982149251220e-01   +1.545803108563137e-01   +7.453210894108693e-01   +9.972232925472753e-02   +4.404401435835321e-01   +1.828433087844855e-01   +6.544696616953440e-02   +7.048127226809826e-01; +9.545916237059935e-01   +6.952903009805292e-01   +6.584780641028045e-01   +2.630599252044703e-01   +6.884009078983977e-01   +1.348787705380203e-01   +7.817786976497529e-01   +4.690598749932494e-01   +8.534479440428234e-01   +4.819478585394286e-01   +7.263207676860228e-01   +3.741571219709801e-01];
L2E_L3E_iAMPA_netcon = [+6.519328234668779e-01   +3.826262611163653e-01   +2.326523245449024e-01   +4.685682403718200e-01   +9.083263019036365e-01   +9.540808327277941e-01   +7.640838066589203e-01   +3.565180132738106e-01; +3.815777729755270e-01   +2.432710332404452e-02   +9.149227507465698e-01   +2.880605134012800e-01   +6.826008704369838e-01   +2.051453281728762e-02   +8.974465327377471e-01   +6.621150921926410e-01; +3.032755770846398e-01   +3.293974383922381e-01   +4.851506404673658e-01   +2.752488491794308e-01   +8.455907804135124e-01   +4.988203009982379e-01   +7.928006147549513e-01   +5.947276466969429e-01; +1.560714244410875e-01   +4.911592156677562e-01   +5.896618478721891e-01   +1.463265248691799e-01   +9.444552931724676e-02   +3.359090145962254e-01   +9.471083279341161e-01   +5.457564971937212e-02; +7.790922961662137e-01   +2.657770716758321e-01   +9.562606622179640e-01   +1.436652839976142e-01   +7.381997901478482e-01   +6.654322027668926e-01   +5.370947836939661e-01   +2.122500613988859e-01; +7.126877123811217e-01   +5.310654482508262e-01   +8.437785435907599e-02   +2.648980017310017e-01   +5.501299479094977e-01   +1.636706045086391e-01   +1.606270144898580e-01   +5.995782085382610e-01; +1.743944195122506e-01   +4.150591841151556e-01   +2.188378827695636e-01   +6.060486696565793e-01   +2.521330413877534e-01   +2.260195128056485e-01   +1.371483936866936e-01   +2.687686367345031e-01; +4.503380295384636e-01   +4.187891992547261e-03   +1.620450213328989e-01   +1.043781737450328e-01   +7.184267896892367e-01   +1.141240399630850e-01   +2.682957759754762e-02   +1.140035152497955e-01; +8.408277621121117e-01   +8.929706257523975e-01   +3.917504927111684e-01   +4.919930657438162e-01   +3.636715118977158e-01   +9.900793851010622e-01   +6.893574424279624e-01   +2.210301075016467e-01; +6.989042445537086e-01   +2.405767180983141e-01   +1.885513547780937e-01   +8.947868771206201e-01   +8.470099373052445e-01   +1.442904249341335e-01   +5.828228901643988e-01   +8.774919219395373e-01; +7.633856960315322e-01   +8.008891103243201e-01   +7.588932723627195e-01   +1.896278593667024e-01   +8.216489323425984e-01   +7.690010984883137e-01   +2.987340859890766e-01   +4.616147378953726e-01; +9.788039951710371e-01   +5.785578355682680e-01   +2.317388564887830e-01   +5.489916160114997e-02   +6.174041144486786e-01   +6.281922756247459e-01   +7.383325795860156e-02   +7.297890202787610e-01];
L2I_L3I_iGABA_netcon = [+5.917324480402004e-01   +1.412488420865143e-01   +3.461381467747264e-01   +3.740685292346719e-01   +5.943574597796553e-01   +5.130863380156960e-01   +7.769331903456868e-01   +2.694135383845276e-01; +8.421991449273316e-01   +9.908917768739930e-01   +4.353155624377024e-02   +5.355565735338838e-01   +4.775611115822549e-01   +2.404711968990600e-01   +1.795110043876377e-01   +5.968371306248489e-01; +6.063929855353832e-01   +4.810718538383628e-01   +9.452797049746932e-01   +9.747050891758590e-01   +3.764577446355796e-01   +2.688996849463444e-01   +4.500217767079154e-01   +6.858588751067861e-01; +7.439159435587329e-01   +4.187039804401781e-02   +8.614622696914291e-01   +9.959308443047687e-01   +9.823129933757935e-01   +4.104171498781746e-01   +3.057520481928836e-01   +4.146434051038795e-01; +8.545940352465997e-01   +2.667167873728370e-01   +1.377569624410454e-01   +4.114397402181313e-01   +1.420027104429472e-01   +2.664585216394963e-01   +3.824668905472342e-01   +5.121202094971791e-01; +1.455046716069433e-01   +6.717117891336508e-01   +5.846463051877736e-01   +4.476290732738295e-01   +2.685338324661495e-01   +8.538225596727363e-01   +7.977673170975883e-01   +8.156279930544722e-01; +7.418844565513621e-01   +1.449286728867036e-01   +6.193644250783794e-02   +2.421680189015802e-01   +2.272593463868033e-01   +4.807200654979485e-01   +7.798949352899521e-01   +5.387779778855492e-01; +1.630495976385249e-02   +7.757373849378012e-01   +9.532883891164600e-01   +5.976349328783788e-01   +7.953145865031805e-01   +3.358686590769352e-01   +6.455913501284680e-01   +5.911427239130431e-01; +2.291556322910733e-01   +2.663631934363422e-01   +4.959639095421380e-01   +7.559291506220688e-02   +8.206737089456380e-01   +6.324469753036372e-01   +2.425990809214550e-01   +5.395199143715714e-01; +5.361019945685681e-01   +8.798785360850186e-01   +2.496584409419664e-02   +9.082674891656161e-01   +8.005929246301957e-01   +4.185231761070822e-01   +6.052313862268862e-01   +5.411268850716319e-01; +7.141509352909330e-01   +3.620628831666825e-01   +5.208070688695721e-02   +4.768372587094965e-01   +1.156632463744965e-01   +5.437852061509245e-01   +4.169298618917560e-01   +1.538749621030368e-01; +4.336040747991721e-01   +1.296372306838542e-02   +3.063323620565592e-01   +5.052747352307633e-01   +6.408145074341368e-01   +3.355736522017372e-01   +2.980017462341414e-01   +6.986309369418111e-01];
L3I_L3E_iAMPA_netcon = [+6.029140424573420e-02   +7.743089811298713e-01   +5.572388452283834e-01   +5.677374921643306e-01   +9.149824497548646e-01   +8.345833279092317e-01   +8.482428531176420e-01   +8.644920822299328e-01   +5.274590618861514e-01   +9.927704917508682e-01   +4.783858635865313e-01   +3.518960004022708e-01; +9.236202367037840e-01   +8.326688251439925e-01   +8.466577397795738e-01   +9.320857736115168e-01   +5.891187983760570e-01   +4.007175154828871e-01   +6.294787747269394e-01   +8.543099925590518e-01   +5.687395381531636e-01   +6.995452455766430e-01   +7.394235856823348e-01   +3.965650555859159e-01; +1.852417045154833e-01   +5.927604447150840e-01   +9.689744985397986e-01   +7.792435258426248e-01   +5.788920552967234e-01   +6.957498338023990e-02   +4.392995919794749e-01   +9.491703171019948e-01   +9.811672297145858e-01   +8.367083358000944e-01   +5.924519251339205e-01   +9.910701299466942e-01; +5.369807030891982e-01   +7.598303300149182e-01   +4.690205485043324e-01   +5.991823477449330e-01   +6.538002585532278e-01   +3.792368722522446e-01   +2.298166349475722e-01   +6.984091097733796e-01   +9.605121838552539e-01   +7.340539037668902e-01   +2.531667422248790e-01   +2.930425593877902e-01; +4.025391795921223e-01   +6.618099822210329e-01   +7.714991374655116e-01   +6.650808505371412e-02   +4.298026746046444e-01   +8.579563717163052e-01   +5.286130838243577e-02   +3.572635475616309e-01   +5.567197686501517e-01   +9.963698932234090e-01   +6.089772379356524e-01   +2.323906389090628e-01; +9.997526136118196e-03   +5.851756626146534e-01   +2.362651848753209e-02   +5.351973950051582e-01   +9.377339893231006e-01   +2.837908180251091e-02   +7.028305670391338e-01   +3.801489411901035e-01   +5.220169541619326e-01   +5.021623290601616e-01   +2.328338777275485e-01   +3.307225069836734e-01; +1.072764524060584e-01   +2.513377354098592e-02   +6.766680108724293e-01   +8.624105637068519e-01   +1.014696461552057e-01   +4.216223132635338e-01   +8.490332790173114e-01   +8.497959054824115e-01   +4.707227899455655e-01   +1.925988657869768e-01   +1.932398769329006e-01   +1.662021204163133e-01; +8.539782259199560e-01   +6.847746292831224e-01   +8.403804588921401e-01   +3.400026148122106e-01   +4.092348957823088e-01   +2.512704127527174e-01   +4.016555959874021e-01   +3.880872239696611e-01   +8.968844403105645e-01   +9.524355345003979e-01   +4.936077240175455e-03   +3.825857840783087e-01; +3.336649394803479e-01   +3.229893937200574e-01   +6.895503902508505e-01   +1.807088544466137e-01   +8.929377338472382e-01   +7.148454485431809e-02   +2.907110900813500e-01   +7.691041668505737e-01   +4.794586077351374e-01   +4.523681283555533e-01   +6.519667354064423e-01   +5.299566310039604e-01; +1.443172543945277e-01   +8.531111944021463e-02   +8.977902045290376e-01   +8.798904045524921e-01   +7.360499524953598e-01   +9.152995658139919e-01   +2.596270055135836e-01   +7.795003517651774e-01   +4.909630217094815e-01   +6.030675500481143e-01   +3.993052638881835e-01   +5.908065945584717e-01; +7.987226168221591e-01   +7.469665318193166e-01   +9.213531257400659e-02   +8.423030621116629e-01   +9.593657327446019e-01   +2.658070300073466e-01   +5.087624415375246e-01   +4.288181455618810e-01   +3.132979743916595e-01   +6.453776312787121e-01   +2.677654086902623e-01   +1.678384899054685e-01; +6.525084800880940e-01   +9.662307552413327e-01   +7.556157014031514e-02   +8.269276420641730e-01   +9.747033306975915e-01   +1.066246118302145e-01   +1.174582512589761e-01   +4.872932813399841e-01   +8.537932008156142e-01   +7.595225578890191e-01   +6.741632517304968e-03   +6.533157138673945e-02];
L3E_L3I_iGABA_netcon = [+4.425820406568502e-01   +6.270219991342749e-02   +6.441143468626799e-03   +4.979638892275258e-01   +5.413525771887739e-01   +2.531563111816262e-01   +7.176063445821218e-01   +7.571579677170067e-01   +3.806788050335820e-01   +4.501266940019041e-01   +2.024089586580482e-01   +6.582639400411336e-01; +6.001376854440655e-02   +8.076967352263029e-01   +1.270155369615426e-01   +1.930650291890094e-01   +2.174471479014148e-01   +3.346427878201719e-01   +2.260882115771095e-01   +8.892624571779483e-01   +6.058871638039132e-01   +3.936796450021681e-01   +8.290363644840487e-01   +9.059092585587246e-01; +6.271133379565614e-01   +9.144465888253925e-01   +3.077641881868504e-01   +6.420470451413820e-01   +2.670130943269109e-01   +5.990620413977967e-01   +4.957859140258905e-01   +7.318211673518779e-01   +1.637423656779413e-01   +6.753046007812114e-01   +4.396788059633012e-01   +8.390903290648444e-01; +8.064389243033496e-01   +4.269599591297149e-01   +2.371132735960487e-01   +2.569030256782558e-01   +1.346151509913386e-01   +4.796225912936106e-01   +4.767142281828350e-01   +6.908419184896287e-01   +1.021695390478594e-01   +3.598478496241763e-02   +4.459225979253328e-02   +1.675805354094447e-01; +4.042823195332326e-01   +1.907978782666750e-01   +6.515916591043910e-01   +9.414745759228845e-01   +1.444197692089853e-02   +9.001278737109603e-01   +4.339467663962123e-01   +6.461710864074098e-01   +6.187700707500556e-01   +7.836647253252682e-01   +7.660717825824781e-01   +1.604490938069561e-01; +8.860223675882325e-01   +1.850190099092529e-01   +8.089438663485051e-01   +2.912435126400477e-01   +1.430842866743072e-02   +2.855199435203333e-01   +5.551044982449318e-01   +6.175972963912671e-01   +9.622895629138797e-01   +3.756109929971753e-01   +9.279277851818558e-02   +1.386818738837931e-01; +7.186744457364018e-01   +6.698362830383213e-01   +7.386541371629621e-01   +1.430919488661377e-01   +9.864015817492970e-01   +7.478622078564837e-02   +2.022701294833295e-01   +7.563424197738963e-02   +6.711881664072834e-01   +6.408518403365686e-01   +6.554528987329690e-01   +1.567847023780587e-01; +1.990470206939317e-01   +5.254801196854966e-01   +1.229564490064762e-01   +8.645539833956681e-01   +6.461342116494084e-01   +3.856349042401708e-01   +2.748566730803268e-01   +5.480710406836444e-01   +4.692413524323769e-01   +4.936832388228491e-01   +2.687295872054894e-01   +3.997844221572625e-01; +3.714035123319721e-01   +7.769469306614110e-01   +1.775090290709714e-01   +8.843337601710298e-01   +8.116002072180861e-01   +1.866910098174483e-01   +8.074772154549116e-01   +8.768043007001112e-01   +3.340329757733624e-01   +2.246350892638388e-01   +4.393189674770357e-01   +6.595622920753234e-01; +2.098610409629832e-01   +3.010407365530413e-01   +2.659405145030592e-01   +6.603710356185644e-01   +2.791519269083401e-01   +7.291021690839226e-01   +1.002707440979655e-01   +9.837846758978506e-01   +5.871574201420432e-01   +2.137592860038933e-01   +8.508785437570432e-01   +2.211686580292406e-01; +2.607911990185598e-01   +4.704117288279043e-01   +8.145464164259063e-01   +9.983679186545525e-01   +1.335830046437844e-02   +4.247513555318420e-01   +3.631680001132048e-02   +6.701315816143522e-02   +5.457740232564238e-01   +4.523903996614910e-01   +9.031183899647544e-01   +6.425361783077149e-01; +9.941256340181805e-01   +7.102570914011876e-01   +5.923612675630731e-01   +2.641609908426870e-01   +1.048393079746171e-01   +2.677042266865828e-01   +7.265291499719062e-02   +2.807014424520651e-02   +3.980663816958586e-02   +6.310401583287615e-01   +2.851669630540852e-01   +6.088106398519743e-01];
L2E_Input1_iAMPA_netcon = [+9.977304982283763e-01   +9.930275750789230e-01   +9.947419923831646e-01   +9.908163841543524e-01   +9.927056441109698e-01   +1.000000000000000e+00   +9.862779838687449e-01   +9.965790998903634e-01];
L2I_Input2_iAMPA_netcon = [+9.984624962539155e-01   +9.933845680495496e-01   +9.948198721648487e-01   +9.887987606051586e-01   +9.924516023068612e-01   +9.887066295062925e-01   +9.937872640749373e-01   +1.000000000000000e+00];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
