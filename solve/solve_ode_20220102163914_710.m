function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.280261506467565e-01   +3.515121343220466e-01   +4.459639693956639e-01   +2.797475564584318e-01   +7.097705531986089e-01   +2.989331626522934e-01   +5.855173539183927e-01   +4.227655861755922e-01   +6.381679626149692e-01   +4.957634931627236e-01   +2.691759649619879e-02   +6.266572491775032e-01   +9.213634788936585e-02   +3.330170716727860e-01   +5.658934326834399e-01   +4.496792349695678e-01; +6.516241632460872e-01   +8.966263473523663e-01   +2.100770808722347e-01   +1.924794321834907e-01   +3.172136089684169e-01   +3.290391197450828e-01   +1.589640678470775e-01   +5.914975260417021e-01   +2.710031384020608e-01   +2.345602697854443e-02   +5.939357271828692e-01   +4.634478656532208e-01   +4.794482934490804e-01   +5.788297076784273e-01   +6.936607311347075e-01   +2.768360330448324e-01; +7.238614633723394e-01   +2.669204427113090e-01   +5.745452806657107e-02   +3.931820235286223e-01   +8.650782973664111e-01   +5.311468524377221e-01   +4.106775770235703e-01   +8.049478520798413e-01   +2.224296492178098e-01   +6.861736696826038e-01   +6.763632238581122e-01   +5.335477629008559e-02   +2.211104009029267e-01   +5.963992754519438e-01   +8.649393705409444e-01   +8.083524579525930e-01; +1.304195628759677e-01   +1.627989954000389e-01   +8.034098195576700e-01   +3.381710968070582e-01   +1.336758626932151e-01   +1.166554952458432e-01   +1.107476401763745e-01   +7.319498570054497e-02   +3.917530524719050e-01   +3.274302616658363e-01   +4.877509974764655e-01   +3.587542898727801e-01   +2.672729357558085e-01   +8.868147992792510e-01   +9.599198637132679e-02   +5.343262233222971e-01; +3.022480515887507e-02   +2.410893383754114e-01   +8.776187939504193e-01   +4.169053176479441e-01   +4.814915103708028e-01   +1.475813606909923e-01   +8.137666333146930e-01   +4.012240307718541e-01   +3.214397858246974e-01   +8.498462705467243e-01   +2.640641242609101e-01   +5.893270468789622e-02   +1.127453830567629e-01   +8.861495385080371e-01   +6.360025274713780e-01   +2.597073756005633e-01; +7.776622878739378e-01   +1.017067512007812e-01   +3.548474172804019e-01   +7.996847971778943e-01   +1.227831269750539e-01   +4.263749839834033e-01   +3.979372470510451e-01   +4.944455544377258e-01   +6.009405986358537e-02   +5.995218283409330e-01   +5.290698790983703e-01   +5.219076946137201e-01   +5.014354373145664e-04   +3.056143468362054e-01   +1.298808054495199e-01   +6.814429240941133e-01; +5.859663720783350e-01   +8.064506386687642e-01   +1.458169887187713e-01   +4.730321071125290e-01   +2.989897596365105e-01   +3.039630002935620e-01   +5.058239405899324e-01   +4.544617769892170e-01   +1.884580534881803e-02   +3.633840670909210e-01   +4.692309814514784e-01   +3.384904670607426e-01   +3.017371499621532e-01   +9.376700976833433e-02   +2.363753078290201e-01   +3.444213220091926e-01; +2.553779511760285e-01   +2.818886385677206e-01   +8.934882730660375e-01   +2.516316248062258e-01   +4.778585949844498e-01   +7.417643407546075e-02   +4.852682866382496e-01   +6.924611561815787e-01   +4.405238801828871e-01   +4.966252665779897e-01   +8.545345956550886e-01   +4.439356116497299e-02   +3.749183769611368e-01   +4.016545822378191e-01   +1.668615831391636e-01   +5.038504960345080e-01; +8.435757625572686e-01   +5.786204244124962e-01   +3.625036954976241e-01   +3.463111268874273e-01   +3.675443475988862e-01   +1.099157265368371e-01   +8.836121799117906e-01   +8.357241488337070e-01   +8.219914233840644e-01   +1.835373511613397e-01   +3.435642043579755e-01   +5.382866938704165e-01   +5.284095127581353e-01   +7.505613607702037e-01   +4.471481623552122e-01   +1.102060319041011e-01; +3.578395152630665e-02   +7.682074178750797e-01   +8.179314240155017e-01   +3.726794868166091e-01   +2.818734092058768e-01   +3.539653037753671e-02   +4.510180070684129e-01   +8.273906966549454e-01   +2.927151901439147e-01   +2.559031202161963e-01   +4.778707529850126e-01   +4.918339375286391e-01   +4.989836705458611e-01   +2.763526840755327e-01   +8.108702164942584e-01   +2.770796767537888e-01; +8.241681599712384e-01   +2.017689675851331e-01   +6.090610124817146e-01   +1.892474676723430e-01   +3.768388969426203e-02   +2.485585595636550e-01   +4.273650590355753e-01   +3.343857390813496e-01   +8.022170103708739e-01   +1.087518599902041e-01   +3.040666954489794e-01   +5.806656936821700e-02   +7.384064785919953e-01   +9.122171490367907e-02   +1.142543042445890e-01   +3.740404953333482e-01; +8.117160488013051e-01   +7.967924399354946e-01   +8.706770119980409e-01   +4.502643979498605e-01   +7.147636874420999e-01   +6.090812569037447e-01   +4.956573443381740e-01   +1.721393068460268e-01   +8.638968476589641e-01   +3.252554527454267e-01   +1.006302961260068e-01   +3.348678311549849e-01   +2.318181505694000e-01   +3.236903125325549e-01   +7.871683792710938e-01   +3.649863813410829e-01; +6.556173464022345e-01   +6.468947714259532e-01   +1.587670781312809e-01   +7.028144475954936e-01   +3.260787778594388e-01   +5.588050479218085e-01   +2.233985515782295e-01   +4.153340604459999e-01   +2.869332312435703e-01   +9.404726280049571e-03   +7.858285875460247e-01   +2.428400206776082e-01   +4.848992528798819e-01   +9.436718562771473e-02   +2.322185378677601e-01   +2.178252274681001e-01; +7.865419259965372e-01   +6.413745238216830e-01   +7.250941047370747e-01   +4.134606895596053e-02   +2.066305953747298e-01   +5.111671867236195e-01   +6.923951540796603e-01   +3.274834234872236e-01   +8.024154519810235e-01   +8.706640821298444e-01   +5.687891375727526e-01   +3.219274164981653e-01   +2.736974995863835e-01   +3.319518096359874e-01   +4.704601700281253e-01   +2.176184134567761e-01; +8.111027710155114e-01   +1.084447392325020e-01   +8.128482070756290e-01   +6.225466160751966e-01   +3.918317137843904e-01   +7.330116696054106e-03   +7.026190576667645e-01   +4.142740231336001e-01   +6.528085942613484e-01   +5.599826911318047e-01   +4.705899694962518e-01   +7.443858573371820e-01   +8.592564315037077e-01   +5.338819364626262e-01   +5.925223739728291e-02   +6.482915379156107e-01; +3.123820745361651e-01   +2.368745798870995e-01   +7.661297652565138e-02   +1.802011369745992e-01   +6.153514246445843e-02   +4.037557057506168e-01   +6.116339101677974e-01   +3.411677324764770e-01   +9.978872259391457e-02   +7.435922577432694e-01   +4.399817064544998e-01   +4.527007548211232e-01   +8.539391797321113e-01   +5.458289269309685e-01   +7.242303018334492e-01   +3.575192479292837e-02];
L1E_L1I_iGABA_netcon = [+6.973281609267834e-01   +6.200807716794592e-01   +4.391294639451836e-02   +8.042881348006953e-01   +1.530623390064074e-01   +8.170707906938504e-01   +1.416616386572727e-01   +5.030610645503770e-01   +8.291799290617653e-01   +5.119714301306639e-01   +5.958016701075433e-01   +7.000286174219685e-01   +8.754534964536841e-01   +9.600668070916666e-03   +2.792285210813279e-02   +4.357403503535806e-01; +3.495248866357720e-01   +4.419846597231049e-01   +6.846629505320942e-01   +1.345468701026636e-01   +2.880757948029217e-01   +8.780033061778242e-01   +8.380605401650266e-01   +3.072107665456804e-01   +2.175274794753256e-01   +6.336414305052823e-01   +8.136759442778725e-01   +6.496192822200330e-01   +8.533381644663952e-01   +3.054628540480586e-01   +2.588536995576923e-01   +7.772152318966341e-01; +1.630545034701596e-01   +8.313222984110585e-01   +6.886478883132847e-01   +6.363708710765982e-01   +3.710193567483942e-01   +5.879426017180399e-01   +3.089359382707862e-01   +6.650828706942596e-01   +8.490295164401226e-01   +3.350881027600176e-01   +3.484260152555405e-01   +6.278507788533487e-01   +7.740964606517503e-01   +7.099171511198713e-01   +7.543561711220260e-01   +3.026047286672017e-01; +1.160632652991093e-01   +5.115354406583469e-01   +8.043395773385672e-01   +6.507273230786892e-01   +7.263060492980555e-01   +6.227850045833869e-01   +1.505483281803985e-01   +5.491019511980900e-02   +1.091246145515029e-01   +2.957401117552919e-01   +2.440191383716906e-02   +8.399460913430133e-01   +5.013896227980411e-01   +6.946554097828773e-01   +4.870987102235943e-01   +7.994777094637825e-01; +8.469624591588006e-01   +3.028917381628832e-01   +9.005851158302434e-01   +2.831544670582544e-01   +2.466359350254495e-01   +2.342103074017040e-01   +2.106833601371503e-01   +7.938234638637196e-01   +8.079256404970389e-01   +2.870342633961254e-02   +9.365631733064418e-02   +7.632156727239879e-01   +6.408168651352086e-01   +6.978667900515438e-01   +7.240915410997826e-01   +2.972657570716826e-01; +6.609931130247723e-01   +2.182938987276713e-01   +2.751439766885099e-01   +2.858638703524120e-01   +6.579869013324700e-01   +3.622632245261744e-01   +3.092839666045430e-01   +6.837416659139395e-01   +4.890523815429388e-01   +3.026391752033673e-01   +1.581805516580126e-01   +6.538984357184894e-01   +5.518306829993836e-01   +5.800542412784072e-01   +3.186428047208642e-01   +6.484177539804853e-01; +3.306269520374434e-01   +7.296548505658598e-01   +4.006070317745967e-01   +3.818880950836177e-01   +1.757104947061038e-02   +6.103188790740162e-01   +5.863586575962360e-01   +5.066676788801346e-01   +1.271000981508956e-01   +1.803469663804644e-01   +1.724000554868371e-01   +2.563017261374873e-01   +4.150578177336494e-01   +4.678248589457087e-01   +1.262952304984314e-01   +4.759591759688597e-01; +6.675250281080856e-01   +7.064828368255818e-01   +4.268811835322735e-01   +8.644992020300191e-01   +8.641703903497252e-01   +2.057738918550525e-01   +1.067993440250923e-01   +1.815857151239745e-01   +7.152232188053316e-01   +2.436692137668595e-01   +4.166866613663675e-02   +8.216394501040445e-01   +5.551664979845115e-02   +2.003797144802752e-01   +6.677073260082462e-01   +6.422035707961100e-01; +2.285287289371832e-02   +1.194600446498894e-01   +2.373089048560948e-01   +8.212487912947967e-01   +7.737549098069734e-01   +2.452223261213894e-01   +8.640382983810292e-01   +5.343042994445765e-01   +6.134454309381792e-02   +5.773389721094357e-01   +6.400889995194443e-01   +4.835067246226722e-01   +8.730661414774900e-01   +3.109638164191987e-01   +5.523527561287934e-01   +4.536155761203275e-01; +3.105609201745927e-01   +7.642597907669785e-01   +3.018689001248083e-01   +5.699489625835679e-01   +4.041001881990091e-01   +8.600679200166783e-01   +2.007624932878275e-02   +6.599509469123360e-01   +6.491818705935901e-01   +2.203456116132426e-01   +3.264321526774747e-01   +8.983875653848574e-01   +2.046944936743500e-01   +8.351645133963700e-01   +8.230353134896984e-01   +7.769805593610910e-01; +5.614220745549298e-01   +5.905500713602471e-01   +8.296611837424468e-02   +7.366973217170388e-01   +2.926804479168615e-01   +5.150081979721581e-01   +7.442603752329870e-01   +6.609962367052954e-01   +4.220544204458820e-01   +1.820421364285117e-01   +6.360316021793574e-01   +6.591128657504343e-01   +8.865373224767290e-01   +8.624036524942073e-02   +4.095035839454739e-01   +2.259052300686752e-01; +1.701479824232659e-01   +4.247408403765136e-01   +4.197817953279159e-01   +4.132560004518361e-02   +3.762958430259564e-01   +6.398377798653672e-02   +3.472301682869215e-01   +1.155892949687576e-01   +4.359022458471254e-01   +5.494787410936189e-01   +2.855803019980237e-02   +6.261791605089606e-01   +7.941336800312900e-01   +3.563436492247277e-01   +5.382568589618927e-01   +8.819330059866620e-01; +3.880879372970090e-01   +1.195909555457645e-01   +2.347226057649497e-01   +8.215460970504969e-01   +8.251616710869601e-01   +7.733806726189947e-01   +6.509618017112700e-02   +3.454245187160875e-01   +2.477531806678997e-01   +1.525491474981460e-02   +9.707764213058216e-02   +8.332774949252733e-01   +4.132458968296306e-01   +6.745468756673283e-01   +5.580506671404095e-01   +1.417066891031245e-01; +7.528683481384950e-01   +3.065069153894266e-01   +8.293503717153060e-02   +2.478618557769964e-02   +2.896331219209392e-01   +3.236129040975583e-01   +8.230148800321507e-01   +5.462881737952595e-01   +5.051194793101024e-01   +3.390783800294640e-01   +8.676834813881825e-01   +6.028363716215062e-01   +8.369884647105923e-01   +2.980342973222431e-01   +2.759765122557002e-01   +1.452464036906973e-01; +6.212389532073745e-01   +4.662654398797149e-01   +6.351870752092587e-01   +5.935967457111335e-01   +4.184677740954349e-01   +8.426830287905920e-01   +2.647669364597399e-01   +6.271259918519575e-01   +2.747571966681214e-01   +2.497689194297094e-01   +8.399965281836147e-01   +8.659132361386677e-01   +5.693766591611547e-01   +3.977238507673220e-01   +6.900981572131744e-01   +3.287892225919069e-01; +2.799868336783174e-01   +3.706879313614638e-01   +7.230928381184035e-01   +8.021937901880858e-01   +2.860614236232038e-01   +4.512615112461089e-01   +4.293810134447753e-01   +6.050003758234341e-01   +7.865319725082980e-01   +2.569111965929617e-01   +3.398646810103776e-01   +8.570488746638492e-01   +2.102431844210215e-01   +1.675080034453779e-01   +2.584951093559996e-01   +3.485925458258379e-01];
L2I_L1I_iGABA_netcon = [+6.788180525856158e-02   +2.040185500993126e-01   +5.453186079839126e-01   +5.400903091512654e-01   +2.662281365850651e-01   +4.515135486124432e-01   +6.497714353032377e-02   +8.566674376306406e-01; +7.172552526828037e-01   +4.143652510771410e-01   +2.569620075394637e-01   +3.021635331922674e-01   +7.670500986682935e-01   +7.462838696550738e-01   +2.906777662835759e-01   +4.495374952104653e-01; +7.785217985944876e-01   +5.134475738284265e-01   +5.859336538479356e-01   +8.621523955023447e-01   +5.417010274622417e-01   +8.607586774535744e-01   +6.045386248197115e-01   +7.701196683221118e-01; +6.605058542935879e-01   +3.393297683869528e-02   +3.203992179855535e-01   +3.554666942476067e-01   +5.247508256300415e-01   +3.711675781376688e-01   +5.782819454269925e-01   +8.575520854133314e-01; +1.802902921502047e-01   +4.411269386286903e-01   +5.403184184427233e-01   +1.528457482907661e-01   +5.732231042863050e-01   +6.895171699544391e-01   +2.215221819422357e-01   +3.741890074136698e-01; +7.009054147617083e-01   +7.439965547600906e-01   +3.365604875848773e-01   +6.374603743328203e-01   +8.820104930383051e-01   +2.530382353547339e-01   +2.008104978794634e-01   +2.699090660368185e-02; +4.747932394117124e-01   +6.516945615241480e-01   +3.223387963950078e-01   +7.130221281291237e-01   +1.676164825424117e-01   +5.216957568365644e-01   +8.969282920922828e-01   +3.523735160550080e-01; +3.993231538715338e-01   +5.733884420905418e-01   +1.994341399554344e-01   +2.907225618505664e-01   +3.344378607011058e-01   +7.145706710701897e-01   +3.298468577367193e-02   +3.399837573522078e-02; +5.891864872666040e-02   +2.730192471297184e-01   +7.251363183803592e-01   +8.920068758539510e-01   +3.480086198828303e-01   +3.652127874203669e-01   +5.663777923769863e-01   +3.268842366492954e-01; +4.911252101466925e-01   +4.256464740077952e-01   +2.291326169021580e-02   +4.350228190823187e-01   +7.826279953161546e-01   +3.378234042017614e-01   +2.485988836720875e-01   +2.300778991434962e-01; +3.457001966608723e-01   +2.386686901141410e-01   +1.624093991979578e-01   +4.240105777530035e-01   +4.712080309281113e-01   +7.695892194071472e-01   +3.791232650250837e-02   +8.354315063556601e-01; +7.025598881576431e-01   +4.868535431586565e-02   +2.960666271533328e-01   +4.409607654393606e-01   +1.147976915313116e-01   +3.983483210697370e-01   +8.682487469795042e-02   +7.109920897030095e-01; +8.792669462755703e-01   +3.339764028545258e-01   +8.345505541536453e-01   +1.402922189442241e-01   +3.226489991572164e-02   +7.981781450636956e-01   +2.830901664447855e-01   +4.696991238340868e-02; +9.281559288236253e-02   +3.336588492780053e-01   +7.800162438177158e-01   +3.254273653705565e-01   +5.821957844170583e-01   +2.928877454517175e-01   +1.052100133022096e-01   +5.100515150026772e-01; +2.544207087627297e-01   +4.345663819134882e-01   +3.463423737335561e-01   +3.430146781814628e-01   +6.418686841515955e-01   +4.136975557538015e-01   +7.060374236246476e-01   +2.372304056154989e-01; +3.071522147125811e-01   +8.995858075786107e-01   +6.804740885299796e-01   +2.783937054804331e-02   +3.478942588311332e-01   +6.682591349659800e-01   +5.859516431166094e-01   +3.987665846903428e-01];
L1I_L2I_iGABA_netcon = [+7.025808436364307e-01   +6.475589556897960e-01   +6.967840561682023e-01   +7.614113568590857e-01   +4.279639573224437e-01   +4.198222171988257e-01   +6.324061011280990e-01   +6.963672227590236e-01   +3.279834857292424e-01   +3.094082780941121e-02   +2.455985341885016e-01   +3.824913068500964e-01   +9.551083832353541e-02   +8.227060408266544e-01   +8.753198558168045e-01   +7.423290063821787e-01; +4.213651638898919e-01   +7.764419751450106e-01   +7.119497303990157e-01   +2.988687228752150e-02   +1.289096103629555e-01   +6.459056187422585e-01   +6.934707848058603e-01   +3.723028788586765e-01   +3.672036044561412e-01   +7.612224591474338e-01   +1.286420566779997e-01   +1.221091824971510e-01   +8.557921179501517e-02   +4.950374360797551e-02   +6.096475191351416e-01   +7.475036943625606e-01; +5.104914756567381e-02   +3.443179103289425e-01   +1.241300469997934e-01   +4.140964419373726e-02   +2.436331227603627e-01   +7.144090882153714e-02   +7.325837294851200e-01   +3.388212152093375e-01   +2.539919092567952e-01   +2.072227575584020e-01   +1.389063322732410e-01   +2.278709715994093e-01   +2.462405915671084e-01   +7.613967627617422e-01   +8.996610621831379e-01   +6.809305923884686e-01; +5.910785552645367e-01   +8.107798052754843e-01   +2.344289307002562e-01   +3.602856795149931e-01   +8.220963928558696e-01   +2.137834128327820e-01   +4.514686363916726e-01   +7.546927050998828e-01   +2.471104790777806e-01   +2.100501530841733e-02   +1.604577613334251e-01   +3.281235497723316e-01   +3.788044874202989e-02   +6.838858292441803e-01   +4.096905092551037e-01   +1.775175343262583e-01; +6.340963508606332e-01   +5.856219588249718e-01   +3.078241629591927e-01   +3.577598535683789e-01   +8.839763951236098e-01   +2.254562882156373e-01   +7.672101120223478e-01   +7.222332890045613e-01   +6.120229151537503e-01   +4.909333274146187e-01   +9.578681975954949e-02   +2.460664879841377e-03   +7.459983491989106e-01   +5.329600706981621e-01   +8.522230676081194e-01   +6.397085145561097e-01; +7.436073643543093e-01   +3.038992666693716e-01   +9.080039763070830e-03   +3.351487549618588e-01   +8.341528786403479e-01   +2.538807870231006e-01   +1.123614245766425e-01   +2.910930168264524e-01   +7.394519714146244e-01   +7.979723056165910e-01   +1.102030027705217e-01   +3.113802126093742e-01   +8.395821756646820e-01   +3.082322538886683e-01   +3.931775780955381e-02   +2.950180255307769e-01; +8.178879599048032e-01   +3.677324429768643e-01   +3.679903254197059e-01   +6.636937563404144e-01   +6.552434985257294e-01   +3.716305474532638e-01   +8.895824493761805e-01   +5.423482742803353e-02   +6.254724491679623e-01   +3.266677128539474e-01   +5.463099113589159e-01   +5.228303775173548e-01   +2.801065510092955e-01   +1.627442242089510e-01   +4.531892846113652e-01   +4.197004317603897e-01; +1.037554615548253e-01   +4.121828298652536e-01   +9.067313558458048e-02   +2.689139313759711e-01   +3.361339331719143e-01   +7.524318861104308e-01   +8.385416741730264e-01   +4.634039193001559e-01   +4.120913354272771e-01   +6.277115512217714e-02   +2.253595983601053e-01   +7.295024611507300e-01   +1.834412348986491e-01   +2.532689749412349e-01   +7.878718680567930e-01   +5.615417147837173e-01];
L2E_L1E_iAMPA_netcon = [+1.090341807938874e-01   +1.830229861687664e-01   +3.717668530136388e-01   +7.888972734100704e-01   +4.901455035938274e-01   +6.940095332857722e-01   +4.364961709877712e-01   +8.022476729816087e-01; +6.461566923705246e-01   +6.193223019422929e-01   +2.655788311114741e-01   +8.820364025876712e-01   +2.237585004460755e-01   +5.973332142411319e-02   +8.724406912008906e-01   +1.646726262227409e-01; +7.966695524693665e-01   +7.961357034379545e-01   +8.090594350978415e-01   +4.442529691681646e-02   +4.491108338076433e-01   +5.285321226588336e-01   +1.737086726239868e-01   +4.042148875111347e-01; +3.016243519832187e-01   +1.263259778488828e-01   +2.900432212226006e-01   +6.165954155301635e-01   +3.122373419900218e-01   +5.939170856517568e-01   +8.940105455427242e-01   +8.126377249699624e-01; +6.536050291588146e-01   +7.203954380377874e-01   +4.716766135292754e-01   +2.900101934593566e-01   +3.908167468847263e-01   +4.737303073416098e-02   +3.474505132524437e-01   +2.585568904043058e-01; +6.754990046593635e-01   +4.021751267052364e-01   +8.724953829938684e-01   +2.684450380326592e-01   +8.087192077652141e-01   +4.103048005418706e-01   +7.195812666151920e-01   +3.055243785601472e-01; +3.329083281097462e-01   +7.681695443677092e-01   +7.524723516643075e-01   +4.559997853121552e-01   +7.425916247364042e-01   +2.180975844491559e-01   +3.672006204396004e-01   +1.681970963961652e-01; +1.987856640794900e-01   +3.435662004510361e-01   +8.256186329529075e-02   +7.394853011544248e-01   +5.880179644451838e-01   +3.496698119505874e-01   +8.408677845187494e-01   +1.249405846419409e-01; +7.964646083498793e-01   +1.349216452501625e-01   +8.186694381339650e-01   +8.147608843612553e-01   +4.027053616231334e-01   +4.947401996812371e-02   +4.630396984814747e-01   +3.360331866945181e-01; +4.350883717343992e-01   +4.056903857164160e-01   +1.275674877924223e-01   +4.830438774332703e-01   +8.200284302357975e-01   +3.133582366767490e-01   +7.436197661408381e-01   +7.386388905963316e-02; +3.557725940653809e-01   +6.206828395353073e-01   +3.829367659146892e-01   +5.399139509552864e-01   +1.176020477039284e-02   +2.363379627352684e-01   +2.295626313258618e-01   +8.157559999535439e-01; +2.317136488074675e-02   +6.978849111739157e-01   +1.703501645968406e-01   +8.808121117439268e-01   +7.380492499407795e-01   +2.670538308064455e-02   +2.711145570198000e-01   +1.320476462284079e-01; +8.429223042833427e-01   +8.550611017375481e-01   +3.805100886800961e-02   +7.532729219283547e-01   +3.686180375941158e-01   +3.331845600488316e-01   +8.516963923347449e-01   +3.179791641278216e-01; +4.378440174257093e-01   +7.304273670542577e-01   +3.700043703394976e-02   +4.141151514235533e-02   +4.228370298705129e-01   +1.098439475043243e-01   +8.490494209926081e-01   +2.470514329140465e-01; +3.139409876470282e-01   +1.247477725051790e-01   +1.039346814292617e-01   +2.726593603153651e-01   +2.948482270220794e-01   +8.713947503803893e-01   +1.264538691139181e-01   +7.620769250161072e-01; +8.443361337777356e-01   +4.356856244645911e-02   +6.725189235690902e-01   +1.923865983794405e-01   +7.229963412931061e-01   +8.977455021478293e-01   +4.633001919666298e-02   +5.038481251010898e-01];
L1E_L2E_iAMPA_netcon = [+8.326901613384623e-01   +2.139214213858896e-01   +1.997793936528018e-01   +4.440306778611443e-01   +2.939293595746643e-01   +3.564818513176284e-01   +4.685619522853727e-01   +4.100389933919755e-01   +6.905341148438758e-02   +5.237274523552029e-01   +8.730637359727315e-01   +1.197193208508966e-01   +5.337579019080330e-01   +7.484234203284177e-01   +5.945109687945693e-01   +3.840457341518398e-01; +6.709083065559817e-01   +8.288080457408494e-01   +1.127641683458209e-01   +1.864221110084474e-01   +6.902623312110888e-01   +5.545692149163107e-01   +3.571326921246109e-01   +2.187331256656285e-01   +8.082041096325120e-01   +3.678987160881916e-01   +1.034724082885109e-01   +8.197593113593910e-01   +5.004239383933216e-01   +8.985959899792865e-01   +5.783862940045568e-01   +4.151790680533249e-01; +2.783272341355092e-01   +1.553541212383865e-01   +6.230468250592385e-02   +6.093169308709235e-01   +6.350342102443631e-01   +3.136999709248678e-01   +5.041508689283131e-01   +6.818393311633283e-01   +4.090992178947213e-01   +1.737400649965553e-01   +5.392135011569480e-01   +6.892278851859143e-01   +4.786658826134607e-01   +7.634144615565949e-02   +6.891123796768571e-01   +9.426573483671591e-02; +1.915964650147349e-01   +6.564901246066607e-01   +2.605042399380654e-01   +5.131090983317069e-01   +7.286653607847232e-01   +2.661829130960583e-01   +6.663302421706945e-01   +6.019227621397069e-01   +7.518955897935249e-01   +1.940820545180259e-01   +3.622452840302652e-01   +3.392804421768819e-01   +6.421912576207409e-02   +4.187656063100349e-01   +1.798376497374730e-01   +7.399889055931094e-01; +1.381105116017717e-01   +4.085450508365000e-01   +4.417310798982292e-01   +1.297120928837470e-02   +2.342011170863330e-01   +3.608751486747374e-01   +2.575414876430012e-03   +5.593785207436481e-01   +2.729894227276640e-01   +2.222663450401630e-01   +1.295925229976963e-01   +4.770878266384187e-01   +7.591644047652905e-01   +8.917727185551025e-01   +6.652145656517977e-01   +1.980483455263363e-01; +1.467936038835767e-01   +3.290611549490404e-01   +3.200912187847024e-02   +4.771621494421913e-01   +2.945602372405390e-01   +6.691634835813239e-01   +4.377421313474928e-01   +7.251092418697701e-01   +5.641698931863413e-01   +6.211535973220147e-01   +5.889243662272818e-01   +6.724180021324504e-01   +3.879461350239515e-01   +7.418430905752162e-01   +3.300667453875589e-01   +8.224366418034317e-01; +2.504210692019737e-01   +8.346430089242268e-01   +1.746052408501978e-01   +7.453117521064008e-01   +4.353551722231266e-01   +9.230863371010875e-02   +5.459495492283640e-01   +7.338158996797221e-01   +4.643191533621378e-02   +3.876482593748439e-01   +8.604134732903626e-01   +4.991739649873020e-01   +6.098594155399720e-04   +6.283226861145710e-01   +5.465053617820306e-01   +6.005290657474274e-01; +6.197148174657036e-01   +4.651231377564330e-01   +3.932320762376631e-01   +7.953193523206472e-01   +3.435174832064654e-01   +2.150990082717036e-01   +3.668798046431220e-01   +1.224198830960326e-01   +6.242814190675419e-01   +7.464699568954769e-01   +5.508797832131008e-01   +8.774146958118263e-01   +8.167595727617770e-01   +7.059410289379625e-01   +2.933685837192253e-01   +5.019303256451686e-01];
L2I_L2E_iAMPA_netcon = [+6.332495588122224e-01   +4.632966897831413e-01   +4.166903179356116e-01   +1.377834523006960e-01   +8.506101536222799e-01   +2.969453904393984e-02   +8.847425505786002e-01   +3.880312861980700e-01; +8.104590252940184e-01   +2.281820376400058e-02   +4.031433430540528e-01   +5.525604199557097e-01   +1.690221804102933e-01   +7.722232589641526e-01   +2.488151918072127e-01   +4.474414287649544e-02; +3.212621583816772e-01   +3.106187092865847e-02   +7.615811475308311e-01   +3.927251358340979e-01   +6.903057592134078e-02   +8.949106173453247e-01   +7.136030787915156e-01   +2.746540853777642e-02; +5.399968583830164e-01   +1.656234559399671e-01   +3.960765084559492e-01   +4.866662364813760e-01   +8.786816119419303e-01   +7.286635086079425e-01   +4.487650215360837e-01   +3.128787946676991e-01; +3.619395897542408e-01   +4.703635846555301e-01   +3.314002434585400e-01   +1.733253691588788e-01   +6.047917325995603e-01   +7.890088229765543e-01   +2.411244196620773e-01   +5.422428800420414e-01; +7.647948375780113e-02   +3.387873446639271e-01   +4.468568305723192e-01   +1.009597343115843e-01   +2.518908357643639e-01   +2.906494980782780e-01   +6.290066794178294e-01   +8.179327269433796e-02; +3.341438268345875e-01   +1.175363114617246e-01   +8.477246327931172e-01   +7.132798565938817e-01   +7.468897907392098e-02   +5.378269965641248e-02   +1.546856212678802e-01   +3.814883592397722e-01; +2.342811054093081e-01   +7.051592922477821e-01   +7.108098049902112e-01   +2.890877625395105e-01   +5.436460969211339e-01   +4.199503839431793e-01   +8.728236428030338e-02   +6.954729766578083e-01];
L2E_L2I_iGABA_netcon = [+2.110044794092668e-01   +4.313354820856027e-01   +8.952649388151970e-01   +5.419660277472652e-01   +4.298965077940469e-01   +3.455979198357900e-01   +7.006115843661458e-01   +5.518978704536672e-01; +8.534309966461502e-02   +6.311363038217458e-01   +6.412256829180765e-01   +3.638071551214527e-01   +7.366728295853020e-01   +4.269237297255104e-01   +5.895093843332601e-01   +5.605089105863121e-01; +8.665012973590958e-01   +2.899420357101613e-01   +8.317190748276595e-01   +6.878786882337077e-01   +8.251544781984538e-01   +1.816408373476292e-01   +8.496372073660156e-01   +5.384740936467888e-01; +5.768676490729556e-01   +5.618992950979804e-01   +2.491849535558475e-02   +1.687895824760459e-01   +4.865731348647375e-01   +7.267879952784102e-02   +8.138451342657517e-01   +3.894939698774638e-01; +7.082111889843369e-02   +3.752814670613947e-01   +5.318958564186715e-03   +8.126554257669679e-01   +3.214462307772614e-01   +5.180827211868687e-01   +9.700318854040396e-02   +8.295115271322719e-01; +3.486232400696317e-02   +3.798883270308661e-01   +1.419901583672724e-01   +6.690217573426293e-01   +7.048179060091236e-02   +6.746261540793419e-02   +5.960381874565092e-02   +2.922887268402912e-02; +6.766986181296100e-01   +8.873963190084263e-01   +4.794013378752721e-01   +4.196494923136679e-01   +4.349153489425580e-01   +8.207785501752001e-01   +1.174861590454456e-01   +2.470302365582033e-01; +7.551244549979164e-01   +8.971324074254839e-01   +1.323663143228270e-01   +7.587338482502795e-01   +7.682591010800965e-01   +3.523505076965642e-01   +3.625732735996248e-01   +2.772560563707357e-02];
L3E_L2E_iAMPA_netcon = [+3.166693538370101e-01   +6.687916252921761e-01   +3.126830166363264e-01   +3.421557152421373e-02   +8.588442787816908e-01   +1.187837039665448e-01   +4.629917964828931e-01   +7.483983607648459e-02   +3.393357682990472e-01   +3.890798358046884e-01   +6.047491065288819e-01   +6.911738570861642e-02; +2.553976771345715e-01   +4.951697297892637e-01   +5.283972041735420e-01   +3.983979047930726e-01   +1.847879622851779e-01   +1.098890832273994e-01   +6.698223094024240e-01   +7.319118513480362e-02   +6.493816827238583e-01   +7.243568212763998e-01   +5.431640032215805e-01   +4.617715471422226e-01; +6.108858321744046e-01   +7.331797890677301e-01   +8.044961920297141e-01   +8.787203626323047e-01   +6.539907245549738e-01   +3.084757781802130e-01   +4.666254597209167e-02   +6.239025570840870e-01   +3.461415575856723e-01   +8.222690684993772e-01   +1.416475057930467e-01   +6.077049191608445e-01; +3.485213644805693e-01   +8.680532070892797e-01   +8.032807470180597e-01   +6.091074263484964e-01   +1.858620865424348e-01   +1.008312457649259e-01   +5.762997194836074e-01   +4.280483467626201e-01   +1.112021548987193e-01   +7.840765955633915e-01   +6.393131926483682e-01   +5.405072778483406e-01; +2.428900862635418e-01   +2.707854942089579e-01   +2.735795446802598e-01   +5.465044092389284e-01   +7.427820294152202e-01   +5.726656269711519e-01   +8.386465385871013e-01   +1.771964943668757e-01   +4.223781190255278e-01   +6.703203520231674e-01   +7.582078328524517e-01   +1.580623090298195e-01; +9.054323922246203e-02   +7.505143367126181e-01   +4.825868146607522e-01   +6.120498632798308e-03   +5.771060415655171e-02   +3.894627878124821e-02   +4.451675229570273e-01   +1.877442049925665e-01   +2.505133875074586e-01   +7.703843424605983e-01   +5.265058330070721e-01   +8.093477191886046e-01; +3.277139268343192e-01   +7.232259104469749e-01   +8.930355141865887e-01   +5.514071565588444e-01   +8.102131354682387e-01   +4.862430366850222e-01   +3.339935165591101e-01   +8.007489119543928e-01   +8.299441657099644e-01   +7.208581237527650e-01   +4.059539096248006e-02   +2.213371796532455e-01; +7.441649045323505e-01   +4.531626654724050e-01   +8.831312234698565e-01   +9.962249240009473e-02   +8.312398260130189e-01   +1.045840393468248e-02   +6.911993760063473e-01   +3.631913507077810e-01   +8.988747457187691e-01   +1.918077559001074e-01   +5.220113510332306e-01   +2.882010888391587e-01];
L3I_L2I_iGABA_netcon = [+1.882893618735542e-01   +7.843640914673371e-01   +1.120024468511900e-01   +6.769095636547282e-02   +3.244406909116696e-01   +7.603078077106720e-01   +1.285658378117317e-01   +2.442579203374417e-01   +7.851167169413148e-02   +3.082560696833734e-02   +1.430584542640399e-01   +1.830657211964744e-02; +2.909512107226102e-01   +2.122575009919186e-01   +3.795925090284548e-01   +4.118717753588663e-01   +6.551999337386605e-01   +8.363674154035657e-01   +6.282823614127591e-01   +6.553853643033096e-03   +6.067619654931422e-01   +3.742355193496379e-01   +6.828060355253559e-01   +9.198866140966262e-02; +8.796717459250115e-01   +1.069089864365297e-01   +1.643504679845223e-01   +4.386113175143602e-01   +8.739149136868968e-01   +5.375519972366670e-02   +5.453169245076865e-01   +5.553267445563111e-01   +8.199104266368458e-01   +8.572105588064682e-02   +5.661696920313831e-01   +5.542934705487429e-01; +5.336843332929668e-01   +1.647451097328084e-01   +3.334373408394606e-01   +5.891240934637305e-01   +3.998075003753275e-01   +4.650584758415389e-01   +5.905080479083126e-01   +7.906843818991626e-01   +4.449203746469420e-01   +4.239526580722534e-01   +8.744455796523113e-01   +4.178487933181652e-01; +1.970719510728932e-01   +7.128221042847325e-01   +4.107267815028343e-01   +1.659668811008232e-01   +6.022023001532940e-01   +7.899812838406562e-01   +2.526681426538007e-01   +7.360892459007619e-01   +3.992955281281936e-01   +2.839536012862063e-01   +5.701956997574924e-01   +8.269981529418615e-01; +9.028861077367648e-02   +6.832459422461609e-01   +1.834072105314289e-01   +6.170228728122465e-01   +5.375273085498973e-01   +4.107009902454924e-02   +4.275632907001502e-01   +6.227963550585474e-01   +8.383110265225964e-01   +7.775186201978123e-01   +3.641085536469824e-01   +7.904869896971652e-01; +6.890268694018860e-01   +2.959443746887959e-01   +2.548052447719794e-01   +3.277353464732085e-01   +6.290073689693816e-01   +1.217609230528333e-01   +6.503368997390757e-01   +3.487120345378346e-01   +3.866517092159290e-01   +3.366857518786275e-01   +6.631828506239964e-01   +5.999539693846428e-01; +7.425474841675849e-01   +6.218842098213624e-01   +3.432330505152218e-01   +6.048223132051104e-01   +8.921046427580306e-01   +2.893296687450929e-01   +4.499612994010497e-01   +5.305199830210212e-01   +5.610552577039651e-01   +3.426401811680553e-01   +8.517926524343274e-01   +3.089070357157263e-02];
L2E_L3E_iAMPA_netcon = [+1.093225868424270e-01   +3.371087543907522e-01   +9.289800333122314e-02   +2.427736003528001e-01   +2.477662110671250e-01   +1.683840625772694e-01   +8.235627369978253e-01   +4.144477070200776e-01; +5.759263062994414e-01   +8.714316460946697e-01   +5.430909052749899e-01   +4.544076462818801e-01   +3.487785734640919e-01   +7.046907894076903e-01   +7.361849362169635e-01   +8.191642862961565e-02; +6.708412300628670e-01   +7.686390142013979e-01   +2.146262975573602e-01   +3.118234115962210e-01   +4.466887400400524e-01   +8.760755535234094e-01   +7.081078564958784e-01   +6.283994564301695e-02; +1.644670260911353e-01   +4.082432776434535e-01   +3.320707185509159e-01   +6.764606190480937e-01   +8.164006102472838e-01   +7.575898344610682e-01   +1.261721380605203e-01   +3.151636662462849e-01; +3.093785390210305e-01   +7.272519487843806e-01   +2.298988992623083e-01   +2.051781102130581e-01   +1.680551338846590e-01   +3.400062490854970e-01   +5.853578565089340e-01   +5.659324454936759e-01; +2.704540107485164e-01   +6.038795139347076e-01   +1.096668464079213e-01   +6.992430982055307e-01   +5.980197093433171e-01   +1.912459710029144e-01   +3.888180064382379e-01   +2.565624018457244e-01; +5.150114640141245e-01   +3.339176456691999e-01   +4.902703602820945e-01   +6.167309624987659e-01   +4.815452966378872e-01   +8.163072862773268e-01   +7.705004889481757e-01   +2.695328457375430e-01; +4.559138049965193e-02   +8.866793804132669e-01   +4.914726081189532e-01   +3.533173654052321e-01   +2.463724209349972e-01   +4.303147552740041e-01   +2.560931863207475e-01   +6.954418253810294e-01; +1.319598596899596e-01   +3.115253570882641e-01   +7.759996842604733e-01   +8.231051540303684e-02   +4.834690901783631e-01   +4.235113610638954e-01   +2.612774165200127e-01   +6.426128848475742e-01; +8.583548429035792e-01   +4.890414363451189e-01   +7.116552697444318e-01   +2.296377221156136e-01   +7.554674579496271e-02   +4.014657427287902e-01   +1.028449590995735e-01   +1.484873176177527e-01; +4.103316813600458e-01   +3.896481289525930e-01   +6.265192563898018e-01   +1.643576321159503e-01   +5.317643668355472e-01   +8.967932573426770e-01   +4.459443131207425e-01   +6.848096380626097e-02; +1.947695142091480e-01   +5.921712564596239e-01   +4.130089976454311e-01   +4.881025557391936e-01   +2.619199743317570e-01   +1.262751522361849e-01   +6.129636600315075e-01   +3.419599069461824e-01];
L2I_L3I_iGABA_netcon = [+3.531097961842691e-01   +1.618455520645873e-01   +4.662818756405903e-01   +2.096252963772469e-01   +6.833382613425184e-01   +6.674505314654671e-01   +7.162337122133203e-02   +4.684387476750754e-01; +8.714484962701692e-01   +6.623304943485472e-01   +8.237137660398830e-01   +5.789759131806166e-01   +7.457921916224953e-01   +6.566862398096266e-01   +7.063693044773383e-01   +4.323554583186636e-01; +3.451313143480009e-01   +1.996654812200669e-01   +8.217931319052890e-01   +8.220750571626569e-01   +5.141523118085999e-01   +3.520277875778304e-01   +2.356049233663694e-01   +7.651241389263166e-01; +7.442322281735019e-01   +8.319412099501263e-01   +7.811635363700143e-01   +4.146904148048843e-01   +4.280816100745677e-01   +4.185331715473414e-02   +7.207168899414123e-01   +1.842065699131888e-01; +5.286907309035820e-01   +4.187401157519570e-01   +6.052864874101215e-02   +8.204204577409738e-02   +5.707185505263516e-01   +7.284890207874239e-01   +1.312721216423719e-01   +5.817763243393962e-01; +4.165386211675116e-01   +2.000641624545583e-02   +3.387524077058313e-01   +1.863588371896526e-01   +7.104767818127706e-01   +5.959419389648321e-01   +2.991416477126477e-01   +2.475801472146045e-01; +6.407075000358747e-01   +9.390891612657602e-02   +3.091379895990081e-01   +4.859279302435984e-01   +2.756949809051733e-01   +5.584653625920286e-01   +3.297202219647422e-01   +5.027754222163071e-01; +3.857088809680403e-01   +2.983600113218738e-01   +6.289239975144796e-01   +1.132805532374171e-01   +5.108289084020220e-01   +4.402581981095622e-01   +4.528598243759049e-01   +3.780349734648127e-01; +1.980132926915319e-01   +5.808943750412668e-01   +1.106649332951993e-01   +5.255941421521312e-02   +5.655162805772505e-01   +6.338257319389902e-01   +5.537551668475964e-01   +5.300910388043760e-01; +4.846379214867271e-01   +8.616197633546069e-01   +6.079743508143526e-01   +5.114550403996136e-01   +4.836508631199153e-01   +9.991205147319859e-02   +8.489623303344891e-01   +2.942051021149666e-01; +8.723937300586352e-01   +4.181279643530899e-01   +1.487965865418442e-02   +6.268611839275721e-01   +4.488940125600458e-01   +4.352603137760755e-01   +4.254905683091944e-01   +4.047678747215145e-01; +4.089456059656943e-01   +4.609822887792433e-01   +3.423856328138784e-02   +8.071236276043777e-01   +1.697333334596966e-03   +8.202208269937212e-01   +7.756536973706186e-01   +8.056621560413090e-01];
L3I_L3E_iAMPA_netcon = [+4.183406740888616e-01   +7.033445962508587e-01   +6.752697348102401e-01   +5.041525583627381e-01   +2.214636073823326e-01   +9.495753779417750e-03   +4.837768177220557e-01   +5.323870224293713e-01   +2.597644397179991e-01   +4.908709257480388e-01   +2.659413373692900e-01   +7.935139375712471e-01; +8.411688689141710e-01   +3.156494544109803e-01   +3.479860942957083e-01   +5.755703692527323e-01   +7.953563860293983e-01   +2.142194525748637e-01   +1.461803963074210e-01   +6.487879428646290e-01   +4.616338486037621e-02   +4.890494529990769e-01   +1.987679026520368e-01   +6.756657753971175e-01; +7.573025237585703e-01   +4.337286011960773e-01   +7.398618766307261e-01   +7.700477678881485e-01   +7.411454358493138e-01   +4.095933099800730e-01   +5.914026311524376e-01   +5.309743639435429e-02   +8.615147714172070e-01   +4.853249447951036e-01   +8.789374237300663e-01   +5.848592859673927e-01; +7.193853239857603e-01   +8.050825746649400e-01   +3.886566594735520e-01   +4.522206519980885e-01   +5.201653310477027e-02   +3.369407280849691e-01   +8.070516768452192e-01   +4.050689604781998e-02   +3.281725625937838e-02   +8.992975248321046e-01   +4.577323801205314e-01   +2.264432335893205e-01; +3.499312369642598e-01   +8.359880959800090e-01   +1.649420807209555e-01   +3.830461456732593e-01   +1.795912339936326e-01   +3.434002818932818e-01   +4.012243891458402e-01   +1.486962938802960e-01   +5.204461370835093e-01   +2.454431490045498e-01   +2.254855870435768e-01   +8.170239806878625e-01; +1.899430509899988e-01   +1.624393704713632e-01   +7.688850237281597e-01   +8.534580399965526e-01   +3.533175927836131e-01   +4.134895029833403e-01   +1.844532563853082e-01   +5.962977092109720e-01   +4.431604031106353e-01   +7.221713745136626e-01   +1.591870662231148e-02   +5.043309662925396e-01; +8.714853220155467e-01   +3.151911807250630e-01   +8.226401544230362e-01   +3.245779073059568e-01   +2.940550361158794e-01   +1.420024151285089e-01   +1.925676335533756e-01   +3.033581512835187e-01   +5.829515581516790e-01   +7.965270193417140e-01   +3.677128384219631e-01   +4.168799221538181e-01; +4.360599590326496e-01   +7.314006864691692e-01   +2.222384179638902e-01   +3.769316496849009e-01   +5.141374101901920e-01   +6.687414450982282e-01   +3.574416409867613e-01   +1.601991307314464e-01   +2.657294232345716e-01   +8.682535428694874e-01   +2.842193754685455e-01   +3.909241549634625e-01; +2.743935844450223e-01   +4.687864258569382e-01   +4.039482998039615e-01   +5.590822845361051e-01   +5.584956181937735e-01   +1.891554092426969e-01   +1.962775767086203e-01   +4.840664745566812e-01   +1.384732857800813e-01   +8.365738979090670e-02   +1.699239483653517e-01   +3.341311146876923e-02; +7.502628302860223e-01   +2.291431687895792e-01   +2.851230448620280e-01   +4.185462624120104e-01   +8.397876269791845e-01   +1.717285992828348e-01   +8.472722995010026e-01   +5.063102840101351e-01   +2.861858362630336e-01   +1.140050502793147e-01   +3.750400514428580e-01   +1.809542820159804e-01; +7.629116776823808e-01   +1.367181740883381e-01   +8.034486363679837e-01   +3.853065586466841e-01   +6.244486948856118e-01   +6.723876850377351e-01   +4.083100783151276e-01   +8.623134675755106e-01   +2.876425991841512e-01   +5.828843493453831e-02   +1.690838100064123e-01   +8.337675976886693e-01; +8.047666771484281e-01   +7.538356404167637e-01   +8.367085499131198e-01   +8.842381490384151e-01   +6.061879797804191e-01   +7.868785401245546e-01   +7.404555757744720e-02   +5.240790835867776e-01   +1.582993142017805e-01   +8.444119140894887e-01   +1.891762814978359e-01   +2.569347866489175e-01];
L3E_L3I_iGABA_netcon = [+1.192478858796196e-01   +8.025533715788981e-02   +8.334706903024640e-02   +1.777067031915219e-01   +1.358009345488912e-01   +3.912730027763052e-01   +3.963088529496610e-01   +5.114020992572392e-01   +5.693522065489027e-01   +8.911033022434494e-01   +4.879398025200446e-01   +3.021476048282036e-01; +1.449412412097495e-01   +1.628577780354127e-01   +8.673042718661726e-01   +6.893963236663976e-01   +6.013456761393501e-01   +6.866431625677917e-01   +5.832406303583343e-01   +4.243490158348897e-01   +4.099426691210686e-01   +3.633202654462069e-01   +4.359176417822376e-01   +8.009803768027922e-01; +6.153409223415089e-01   +3.697667772187146e-01   +1.387725462763282e-03   +2.098064603599208e-01   +3.444075896001615e-01   +5.063733872830724e-01   +6.122287595627453e-02   +8.838097943119155e-01   +6.384066342320462e-01   +7.007897283405141e-01   +8.697757717891046e-01   +2.880203385698411e-02; +3.377963596323990e-01   +1.519514910637675e-02   +5.982400003294209e-01   +3.955311146408795e-01   +2.364821299036734e-01   +2.243896479530482e-01   +3.202285278330753e-01   +4.742017790218130e-01   +1.274172313389375e-01   +3.505250347697511e-01   +8.569024904816966e-01   +2.314653499025578e-01; +7.297478738132804e-01   +1.302981888521977e-01   +4.785826417325921e-01   +3.856375341117858e-01   +6.140634417914844e-01   +4.287995202495843e-01   +8.791814936153955e-03   +7.847080694126570e-01   +6.825554966362497e-01   +8.890139039974488e-01   +2.617761095990495e-01   +5.043708638257348e-01; +4.644731383856455e-01   +9.937002455088079e-02   +4.472970445916735e-01   +4.452916660453805e-01   +3.494720267245565e-01   +9.171779772569996e-03   +4.865278684031094e-01   +4.582536013370955e-01   +3.073575819863049e-01   +9.392637605102715e-02   +2.809456239465854e-02   +4.511464181081471e-01; +3.522688865734565e-01   +7.521133502448195e-01   +8.470599046239925e-01   +5.105459819204912e-01   +6.511598663015741e-01   +2.487012856366949e-01   +3.958763830247364e-01   +2.307914752213577e-01   +8.460064437384072e-01   +4.779918058187617e-01   +1.449822294089608e-01   +5.139223924761582e-01; +5.670157655679732e-01   +5.074100132512801e-01   +6.114205484334352e-01   +3.170227971350838e-02   +6.756330154410558e-01   +8.365193525006458e-02   +1.758826837283488e-01   +5.132459691896717e-01   +4.169313106586794e-01   +3.938345080949801e-01   +1.127277342077046e-01   +2.331130863408745e-01; +4.124716351709943e-01   +3.353174710976401e-02   +8.553195026191492e-01   +5.138666155791395e-02   +5.803521673613152e-01   +1.217633241805726e-01   +3.206301666842201e-01   +8.088484663271907e-01   +6.476204703918420e-01   +3.597554747481829e-01   +3.191044277882211e-01   +8.722293610628587e-03; +3.799216803283340e-01   +7.666698364993408e-01   +4.112473995574975e-01   +1.242028155027764e-01   +5.732840417701078e-02   +3.118664904219169e-01   +2.583130542995640e-01   +8.784327287785982e-01   +3.061416040898995e-01   +5.422012915975549e-01   +7.483855648800208e-01   +3.153177079656200e-02; +8.943462608810769e-01   +7.089220197157691e-01   +3.886510825673939e-01   +2.784152987424748e-01   +4.901968054469834e-01   +8.482829312983423e-01   +4.526227003563405e-01   +8.875016639325218e-01   +5.840116099845688e-01   +4.111188617161146e-01   +5.442530563046930e-01   +3.845174308834003e-01; +4.843666988232807e-01   +8.394463543630702e-01   +4.388861515196110e-02   +6.807780011118723e-01   +2.441806053228186e-01   +8.926795424284893e-01   +2.870297150663591e-01   +1.441774452825530e-01   +1.967800920378602e-01   +5.415030827335392e-01   +1.865179595758971e-01   +7.260531979041585e-01];
L2E_Input1_iAMPA_netcon = [+8.988803792924055e-01   +9.005392438491032e-01   +9.005825610067092e-01   +8.997626626943814e-01   +8.994358747424792e-01   +9.009435195505585e-01   +9.008767649264239e-01   +8.990013753955709e-01];
L2I_Input2_iAMPA_netcon = [+8.989469451893103e-01   +8.989639127222457e-01   +9.001548383244665e-01   +8.997312012881193e-01   +9.009929341302051e-01   +9.006346817028410e-01   +8.992931289158562e-01   +8.998480544171374e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
