function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.233458375645488e-01   +4.231350160795956e-01   +5.307987296632080e-01   +6.366260473659935e-01   +6.010854472026632e-01   +3.409268890719317e-01   +6.479819911214448e-01   +8.405929700016824e-01   +5.445784599617022e-01   +1.924101616630197e-01   +4.383847856682763e-02   +8.221021687413371e-01   +7.672050507086586e-01   +1.102908613612272e-01   +4.541864360124473e-04   +8.415678649033886e-02; +9.838254087986544e-01   +9.453898462949667e-02   +3.242785389336499e-01   +9.573385518211526e-01   +3.875415039793189e-01   +6.064193889046990e-01   +6.781748617739136e-01   +8.319264430906220e-01   +7.221475236573839e-01   +1.384198631322756e-01   +7.537762939471355e-01   +4.301900998771326e-01   +1.674923693516714e-01   +1.353639103633688e-01   +8.657443806187496e-01   +6.268468921582134e-01; +7.310300762968083e-01   +5.982216487775186e-01   +1.051828160251633e-01   +2.420057806752512e-01   +9.161339446474499e-01   +1.908257107682328e-01   +6.351361463614357e-01   +2.563439539602025e-01   +5.219544174791856e-01   +6.958525524463490e-01   +2.422805496403685e-01   +8.875688681010053e-01   +8.635857598204976e-01   +6.787902419736233e-01   +6.128155576254306e-01   +6.616447552818040e-01; +3.438504530049879e-01   +4.720149989332073e-01   +6.116004304408933e-01   +6.758281224288496e-01   +1.047239446646538e-03   +7.391651811934289e-01   +9.449434056313321e-01   +6.126496353272368e-01   +9.929790155984849e-01   +9.263445972906477e-02   +4.432040895109660e-01   +3.912536867348456e-01   +9.907598363390570e-01   +4.944971276559319e-01   +9.896488564216903e-01   +7.296612814471812e-01; +5.850332027447617e-01   +6.966073867987403e-01   +7.795846640608902e-01   +2.880001686965715e-01   +4.616560430818637e-01   +2.431361648278091e-01   +2.086468704529483e-01   +5.830132180288303e-01   +2.203004496822973e-01   +5.245245889760083e-01   +6.874656516500428e-01   +7.697475555464648e-01   +5.154734027738996e-01   +1.892290269844574e-01   +5.266388560889746e-01   +8.922712762571292e-01; +1.088660598472025e-01   +7.005639058560083e-01   +4.239311108933544e-01   +6.710313697392508e-01   +4.254153989726381e-01   +9.181194604524535e-01   +7.103885025026599e-01   +5.406862469130040e-01   +1.053457542875751e-01   +5.309584277383894e-01   +3.587601479595811e-01   +3.970383667579510e-01   +8.841609004162626e-01   +4.944420454374164e-01   +4.801293326289707e-01   +9.828738575729670e-01; +9.056114346930696e-01   +6.396206279567109e-01   +9.098544688107933e-02   +6.954118560462208e-01   +4.616195656974494e-01   +2.698565125207618e-01   +2.364971636514007e-01   +8.704142959832933e-01   +1.110940770898984e-01   +8.621997647516961e-01   +7.363230171007101e-01   +8.092909254711681e-01   +5.875320625736863e-01   +1.482956212966736e-01   +8.019110472834144e-01   +7.694704378352674e-01; +8.805355969123604e-01   +3.368769425190381e-02   +2.663246798116575e-01   +6.765680403560441e-02   +7.699311741143110e-01   +7.650874519535258e-01   +1.195981697793367e-01   +2.641484550307018e-01   +6.508153605205300e-02   +4.849303781525559e-01   +3.945645744357935e-01   +7.554345564904585e-01   +1.544178991299019e-01   +5.407961292465725e-02   +2.290921607847292e-01   +5.826204702564650e-01; +8.169509091481948e-01   +6.862418501650647e-02   +1.532361472803724e-01   +2.542785770090483e-01   +3.230297325503732e-01   +1.889213806591200e-01   +6.080334415780297e-01   +3.173038916216023e-01   +4.037141921594905e-01   +3.930390091966302e-01   +6.843626120302775e-01   +3.771718378061865e-01   +2.000223584943691e-01   +8.512609618730380e-01   +4.968698516524928e-01   +9.270283741358064e-01; +2.602390866749458e-01   +3.195126269010636e-01   +2.808573326542658e-01   +2.224019984571725e-01   +7.852110244783279e-01   +2.864845179805858e-01   +4.514160566420818e-01   +1.188915071184628e-01   +4.478702455954993e-01   +6.724131403702857e-01   +7.040177359845314e-01   +2.163380157714095e-01   +4.066208977479176e-01   +5.616161000292477e-01   +8.994768667324186e-01   +5.804548136080431e-01; +5.943910570584076e-01   +5.302873350928053e-01   +4.414437711018828e-01   +6.685771253260293e-01   +4.708759268208836e-01   +9.091190831550092e-02   +4.589296065926584e-01   +9.403555417120605e-01   +3.651531463086246e-01   +7.426498711423309e-01   +4.430460360031608e-01   +7.907656422144669e-01   +7.479504291062342e-01   +9.297112643682929e-01   +5.751410899571634e-01   +1.641056002469254e-02; +2.211456034717625e-02   +6.539426065225628e-01   +5.259799025349239e-01   +8.444248082170114e-01   +3.595320121034672e-02   +5.775735734591496e-01   +6.623860699149725e-01   +6.464897697049936e-01   +7.624794740841019e-01   +5.191448990550037e-01   +1.836057536340037e-02   +9.497514523657848e-01   +8.244623166283778e-01   +6.977934701108681e-01   +8.450988374260071e-01   +1.219703044566094e-01; +4.259186587980108e-01   +4.080624281924144e-01   +4.580158563133584e-01   +3.455645702238219e-01   +1.766398254669058e-01   +6.837060350518575e-01   +7.703402051266621e-01   +4.801368579253964e-01   +6.264590573972705e-01   +3.461556724269987e-01   +3.303888505589664e-01   +3.290866199212431e-01   +7.907530297197196e-01   +5.840974700880923e-01   +7.384383440322079e-01   +8.625820746792903e-01; +3.128664572831838e-01   +8.193134579572160e-01   +8.750412929459802e-01   +7.817368033607980e-01   +7.203787258014978e-01   +5.468214524593501e-01   +3.504208679231651e-01   +6.396326539574021e-01   +7.718906388287426e-01   +1.497654452256237e-01   +4.239567190310314e-01   +6.723159657420059e-01   +3.193966909322164e-01   +8.156849253903208e-01   +5.854723837280317e-01   +4.831299162553284e-01; +1.608300502815702e-01   +7.195680601760907e-01   +5.189726389076774e-01   +6.758791259113111e-01   +4.740389402825643e-01   +4.251330301791853e-01   +6.620078884800946e-01   +5.443143265359341e-01   +9.336333401388469e-01   +5.871913455656729e-01   +2.689667072384430e-01   +4.399860673259356e-01   +5.339909156034863e-01   +8.799760348243575e-01   +2.455577819120099e-01   +8.449989732019788e-01; +1.773653651478736e-01   +9.680832127250352e-01   +9.444608411333021e-01   +8.110705160854046e-03   +1.528470026394071e-01   +6.436416738620396e-01   +4.156386668196063e-01   +6.467707316406588e-01   +9.727581911370919e-01   +2.617238642459702e-01   +1.963330242761998e-01   +8.325785958873718e-01   +9.073256262619596e-02   +9.896107612855130e-01   +6.657642746239052e-01   +2.095906392873585e-01];
L1E_L1I_iGABA_netcon = [+5.514109893622148e-01   +6.940638755591105e-01   +1.049822240478652e-01   +1.770747334671767e-01   +5.564170419358554e-02   +1.789099546053458e-01   +5.960132300127445e-01   +9.961264112765186e-01   +3.387710902027315e-01   +7.794061938606351e-01   +6.830735736373917e-01   +3.654858282213329e-01   +7.823251453922302e-01   +4.322663763607468e-01   +5.989229618883202e-02   +9.805671426018678e-02; +6.307541056634535e-01   +4.985461640541300e-01   +1.415172709264514e-01   +3.989844912437964e-01   +1.780076336623388e-01   +3.609272038271964e-01   +2.999906768921116e-01   +3.308316713571905e-01   +2.938700439830384e-01   +3.377875261814708e-01   +1.313343995030961e-01   +3.686035799399804e-01   +1.003486380175700e-01   +6.553495035709983e-01   +3.148194011277536e-01   +1.424163610512153e-01; +3.304812195958364e-02   +5.349494399888775e-01   +1.661506479406866e-01   +1.327696022006286e-01   +6.618615086583479e-01   +5.609258388167732e-02   +1.340662896015347e-01   +2.971035131839862e-01   +7.450722824546122e-01   +6.071912050930902e-01   +7.224712908023834e-01   +6.847218012644828e-01   +2.934561014527389e-01   +1.111014668810972e-01   +7.722770189390354e-01   +1.690375905631885e-01; +6.147374754183506e-01   +4.441472138022584e-01   +6.214126650716327e-01   +3.000978190203843e-02   +3.318948200701759e-01   +5.220677259189092e-01   +2.117787914817549e-01   +6.255143603918630e-02   +1.070939297639948e-02   +7.412135343114655e-01   +1.099523478518257e-01   +5.976626469480841e-01   +2.360988325127933e-01   +9.328075293864702e-01   +6.960133026207509e-01   +1.948556394907616e-01; +3.633189483311888e-01   +1.237471393481151e-01   +5.736579916282433e-01   +9.381512240582063e-01   +8.982573061510853e-01   +3.350763670124928e-01   +8.955593930018069e-01   +2.973060994482134e-01   +4.799286724027241e-02   +1.051992771985032e-01   +1.166153978093755e-01   +7.886331295545590e-01   +5.305039547405136e-01   +1.862596037933492e-01   +1.243631747060346e-01   +3.178283592921308e-01; +4.926018255389730e-02   +4.912455219968667e-01   +5.250519608887751e-02   +3.012928429190324e-01   +1.175529019277907e-01   +1.745786873836913e-01   +7.208393617736865e-02   +4.487832494834355e-02   +6.672379339666349e-01   +1.270774469273443e-01   +6.403926671994092e-01   +3.683736108424562e-01   +9.206264820182612e-02   +2.666997966879109e-01   +1.284622338440218e-01   +3.175437063372081e-01; +4.882739763199304e-01   +8.523594008605606e-01   +9.322478921913759e-01   +2.963012607208551e-01   +9.891025676198600e-01   +2.101140438453230e-01   +2.434063990727946e-01   +5.049739091122812e-01   +6.046800654694976e-01   +5.488275770755954e-01   +3.290741066335229e-01   +2.063776375492385e-01   +4.061044284470809e-01   +7.976414971164882e-01   +9.198835099312484e-02   +2.173737566890180e-01; +1.927007871681395e-01   +8.744536103372909e-01   +7.280643425538262e-01   +3.340765735030651e-01   +5.416417155086839e-01   +9.056982301882606e-01   +5.455016647535801e-02   +7.615623889984319e-01   +5.261221281090758e-01   +4.848677966250013e-01   +6.542282389831306e-01   +8.735918641555482e-02   +1.040258795824609e-01   +4.881285307939884e-01   +8.947975906027691e-03   +2.511941818012451e-01; +1.224574970039382e-01   +2.708899318021621e-01   +7.376280170717135e-01   +4.678769971144094e-01   +7.055801781093174e-01   +6.749422382237473e-01   +4.404775231513178e-01   +6.320857397917673e-01   +7.294405843230255e-01   +8.910320127491408e-01   +7.503410840776884e-01   +7.726214787181940e-01   +1.114121866108467e-01   +7.693646884433131e-01   +4.235805854488289e-01   +8.933748704407913e-01; +2.061434618355045e-01   +2.089670449786483e-01   +6.328138033557783e-02   +6.472873740128331e-01   +9.993793842896488e-01   +4.680502907173650e-01   +1.385452771965682e-02   +9.037626709260214e-02   +7.072755555596428e-01   +7.990709389599028e-01   +5.844412289255626e-01   +2.069307546256786e-01   +7.853117828121859e-01   +3.971078041385681e-01   +6.552544289884400e-01   +7.030298344420136e-01; +1.463471105441668e-01   +5.642484451589869e-01   +8.594825269972355e-01   +2.407914974164161e-02   +2.885262431717269e-01   +9.125625122838849e-01   +8.971427545243046e-01   +8.044634718689998e-02   +7.806733894199026e-01   +7.345779950259522e-01   +7.409241984860422e-01   +3.885827722209749e-01   +2.918403479369895e-01   +2.727230853687396e-01   +7.234192080805250e-01   +5.554426241389381e-01; +1.892918564746240e-01   +6.393872992862665e-01   +9.336626096315965e-01   +8.423687621949323e-01   +4.135202682443884e-01   +1.030929435290725e-01   +1.951918305650583e-01   +7.758904002068282e-01   +2.880497230756874e-01   +5.251933016896512e-02   +2.342118915823619e-01   +5.517055162388882e-01   +6.040974401607369e-01   +3.735560490755978e-02   +5.300076201193776e-01   +1.848496366921707e-01; +4.306241069096883e-02   +4.164113355156577e-01   +9.832150404182667e-01   +5.580369481575106e-01   +4.659772462932721e-01   +7.444016370475941e-01   +9.344061528106584e-02   +9.059269478654187e-01   +6.910381812641335e-01   +7.223261942385462e-02   +7.341647492039283e-01   +2.289037101631905e-01   +9.637816782340703e-01   +6.735449444254118e-01   +1.080228517669619e-01   +2.109656285220652e-01; +6.360418971332362e-01   +2.060347794691285e-01   +8.578168230318789e-01   +8.542743622665447e-01   +7.644538696713959e-01   +7.369894924860598e-01   +3.079000586269716e-01   +5.334362380441766e-01   +5.561288471751098e-01   +8.728427589110190e-02   +9.711050148786228e-01   +6.415790976010362e-01   +4.321112042655082e-01   +4.291738610915034e-01   +6.328603190546579e-01   +7.673803666523135e-02; +2.815489400243508e-01   +9.479370254773295e-01   +7.853368496201851e-01   +3.482762356140415e-01   +8.173513833493760e-01   +5.613542565745033e-01   +4.555612266724090e-01   +1.087928240144320e-01   +3.960284804130855e-01   +7.970112805471775e-01   +8.668948125860250e-01   +4.839040079301690e-01   +6.954954991755712e-01   +4.511367860932733e-01   +1.277560561298102e-01   +9.143663807046589e-01; +5.380684367543859e-01   +8.081059004532332e-02   +5.140114675287003e-01   +4.463173680567482e-01   +1.000188496361858e-01   +1.848325386615369e-01   +1.017317110510412e-01   +8.272721975993546e-01   +6.165825740906047e-02   +9.424857822045202e-01   +8.666676955438418e-02   +1.512982732847923e-01   +7.571652773951754e-01   +6.081361201157238e-01   +1.343795257128015e-01   +7.061061226266314e-01];
L2I_L1I_iGABA_netcon = [+5.586457644806644e-01   +1.600755300228032e-01   +4.241803046552571e-01   +6.821297738388307e-01   +8.084657871058983e-01   +7.947313534157722e-01   +7.882755096919666e-01   +2.649549538244148e-02; +3.130970393741013e-01   +7.580045307148873e-01   +4.295504977453158e-01   +4.636207242602639e-01   +7.488465638043141e-01   +5.784545927054969e-01   +8.521403428629004e-01   +4.218917287280356e-01; +1.657687492173892e-01   +8.705728696771924e-01   +1.248449022890862e-01   +2.135300620020553e-01   +1.187138221162990e-01   +4.409512018682968e-01   +5.065156944641795e-01   +1.827689337010127e-01; +6.217505520743241e-01   +3.509551877168509e-01   +2.357221201500105e-02   +9.884976164080510e-02   +5.247566729359119e-01   +2.582558495397367e-01   +6.359194061572120e-01   +7.263118735594580e-01; +9.876837157094304e-01   +6.863929528110007e-01   +2.909916149106235e-01   +8.232817797659882e-01   +3.258610122898807e-01   +7.515985865438803e-01   +9.512874868502107e-01   +3.698442752473921e-01; +1.706978849651237e-01   +2.937770320854712e-01   +3.188085630855603e-01   +1.759299691873073e-01   +5.461334178288509e-01   +2.288951141498400e-01   +4.438591753051139e-01   +8.415399939174142e-01; +2.583088374088693e-01   +5.304666743204405e-01   +6.529437118034354e-01   +1.646753522754479e-01   +3.996593050172267e-01   +6.556858269349392e-02   +5.893624091491344e-02   +7.337032777580779e-01; +3.971535088481127e-01   +8.332472650215110e-01   +9.574557069719719e-01   +6.673842760087596e-01   +4.154655000743632e-01   +7.666640273282397e-01   +8.671208006154572e-01   +5.705498024314497e-01; +7.480580125652553e-02   +5.979274679148173e-01   +9.365786639609640e-01   +8.939509352030219e-01   +1.798626835605961e-01   +6.720770276920306e-01   +6.312850833306879e-01   +1.776112446847152e-01; +6.845375800807555e-01   +3.353064472094665e-01   +4.578892163798586e-01   +5.169352332576074e-01   +2.550529048784533e-01   +7.145197254067844e-01   +3.540286179114085e-01   +9.590235930114368e-01; +4.033645250466446e-01   +2.992347761035215e-01   +2.393871199060117e-01   +7.030283786125999e-01   +1.981214263637299e-02   +6.421205960255481e-01   +9.971821998743932e-01   +2.652567950736644e-01; +9.827097494618255e-01   +4.528390800006420e-01   +7.641013471196945e-01   +1.526808510715527e-01   +9.235566475650528e-01   +4.191049068161995e-01   +2.239274209748325e-01   +9.247372547924776e-01; +4.014303554665442e-01   +4.231967688641084e-01   +7.592115449224938e-01   +9.528910114634533e-01   +6.535438751466884e-01   +3.913027713689605e-01   +6.520667436148753e-01   +2.230541746393653e-01; +6.212766879177298e-01   +3.592901743196742e-01   +7.393875504024446e-01   +5.407992912554359e-01   +9.328652358632048e-01   +8.165143563712126e-01   +6.043742176773848e-01   +3.734178565191750e-01; +1.545196786909985e-01   +5.595732649310007e-01   +7.446179052780113e-01   +6.808658965822357e-01   +1.641096749291152e-01   +3.160488483796929e-01   +3.873420458053888e-01   +8.725573511257131e-02; +3.828252623657830e-01   +7.435606192562101e-01   +1.076130100100804e-01   +3.703482633622131e-02   +9.218385532596153e-01   +8.155388824280991e-01   +1.405736975458355e-01   +6.408622043647593e-01];
L1I_L2I_iGABA_netcon = [+1.811592798887400e-01   +9.109396253512951e-01   +2.758229784455875e-01   +8.636885455352333e-02   +5.336040839871207e-01   +1.071687824154763e-01   +9.882460536837127e-01   +4.114369491807473e-01   +7.202512207613864e-01   +2.176974111860809e-01   +9.226211077346637e-01   +6.738143441791393e-01   +1.069688201331301e-01   +5.569985969528592e-01   +6.299513373345488e-01   +4.841947886283292e-01; +4.584500094737208e-02   +8.006596012292908e-01   +2.474198704604982e-01   +8.023898523765323e-01   +8.864988199658546e-01   +6.153217124310951e-01   +7.672963530761632e-01   +6.015854968257011e-01   +9.963463894522447e-01   +1.264155813625896e-01   +7.708070636118735e-01   +4.781082027019242e-01   +1.818238464142043e-01   +7.717077000114463e-01   +1.015411435234658e-01   +8.943692974877544e-01; +7.231616036922920e-01   +7.445377082794787e-01   +4.518479833823301e-01   +9.897727650234108e-01   +8.982811261227815e-01   +9.405716108628424e-01   +3.364187605709366e-01   +7.500604707125059e-01   +3.545332837039972e-01   +3.086411492149947e-01   +4.321989735588783e-02   +6.243582505186236e-01   +9.916446075960005e-02   +3.122596221473976e-01   +3.912071280294174e-01   +1.379431001237875e-01; +3.477628364689797e-01   +8.134561136584324e-01   +2.272064594100778e-01   +6.701015832052455e-02   +6.250942953930188e-01   +3.534057667198515e-01   +6.628442379084086e-01   +5.838928641695966e-01   +9.717280322441677e-01   +7.259302557027989e-01   +3.787720940353471e-01   +2.366785098306070e-01   +4.899807503287720e-01   +1.788973201465135e-01   +5.538529198235095e-02   +3.893547144717104e-01; +6.601973051059390e-01   +3.831078875463898e-01   +8.051460184780429e-01   +9.399872274159743e-01   +1.369598208228060e-01   +4.110222728540391e-01   +2.453190230954879e-01   +5.520747856336002e-01   +3.477695050092093e-01   +7.828649549140456e-01   +7.043895444538985e-01   +1.778067116612814e-01   +1.924101601327994e-01   +3.386986021931072e-01   +5.011352043291617e-01   +9.281546489889415e-01; +3.845130804431161e-01   +6.173915897373869e-01   +9.856808520328318e-01   +1.727702342687081e-02   +2.182543974557121e-01   +9.836157275172868e-01   +2.950120236131506e-01   +5.820555682378732e-01   +8.859148851933537e-01   +6.927417212300507e-01   +7.281907620455363e-01   +8.294310965752937e-01   +8.944946275358826e-01   +2.095230229036493e-01   +4.317317547680860e-01   +9.185726683243975e-01; +6.283786135483517e-01   +5.763374505673216e-01   +2.899784189994726e-02   +6.840926239231142e-01   +1.814462502744438e-01   +9.445565004311468e-01   +6.795757630266644e-01   +5.110783574411721e-01   +4.551060546373568e-01   +9.480344132193197e-03   +2.254555285056939e-01   +7.659541243643618e-01   +1.000236984172514e-01   +5.100957556054948e-01   +9.973016128558703e-01   +7.140063006271808e-01; +2.238075116411639e-02   +5.284901060688022e-01   +5.363401044685171e-01   +7.829156386532975e-01   +4.305288591628913e-02   +6.766390042770076e-01   +5.271464821972678e-01   +8.230963971708700e-02   +4.141327950484131e-01   +8.440413766154050e-01   +2.688052857432160e-01   +9.343908520166393e-01   +4.477729057950434e-02   +9.058954900220294e-01   +8.100362510438583e-01   +6.176826261376271e-01];
L2E_L1E_iAMPA_netcon = [+3.432629945213644e-01   +7.578773421291324e-01   +5.895728968146184e-01   +5.022587894066000e-01   +8.545160882352587e-02   +4.716467404335536e-02   +9.232836997716543e-01   +4.760888874794750e-01; +9.358647742284707e-01   +4.134584535905420e-01   +6.608482794224254e-01   +4.891143932899051e-01   +9.743262500853901e-01   +3.431105139548238e-01   +8.009975260809379e-01   +3.638065359197866e-01; +1.240037056993252e-01   +4.931231294059722e-01   +4.861841387532402e-02   +8.776856541719549e-01   +6.514827402244003e-01   +7.364496464639113e-01   +2.870088305683516e-01   +7.882119451447371e-01; +7.310155315238325e-01   +6.952349844149027e-01   +3.483618615161219e-01   +3.529896273168678e-01   +2.308536652300582e-01   +7.954064597062519e-01   +5.441173739577869e-01   +7.806287355646837e-01; +6.463310862706512e-01   +9.742637482863750e-01   +4.499529632448168e-01   +4.496740094892951e-01   +4.028503760490735e-01   +5.445371899540513e-01   +9.838475178042302e-01   +6.677647460823053e-01; +8.328976308081963e-01   +3.282737248916840e-01   +2.397127528235450e-01   +9.642586203809035e-01   +1.211970608476858e-01   +6.868774642918252e-01   +7.146920901140162e-01   +1.330649282894199e-01; +3.975990680908102e-01   +8.378950604504597e-01   +7.145802820338907e-01   +4.279604915752871e-02   +2.687598334626045e-01   +8.942138458480168e-01   +8.390285299250759e-01   +2.079741855846621e-02; +7.495630363107986e-01   +7.397998996759195e-01   +8.558667628956463e-01   +9.738672943365381e-01   +2.563890000356499e-01   +5.406859634267569e-02   +4.342242263523989e-01   +5.600413915933690e-01; +8.345033526636874e-01   +9.536535866534110e-01   +2.819855618846089e-01   +1.876056451346691e-01   +3.329263714442687e-01   +3.039053243750541e-01   +4.709047293839553e-01   +3.013777510809267e-01; +3.236484928129816e-01   +3.254749973322522e-02   +7.303779844628450e-01   +6.668603176619812e-01   +1.510476889516468e-01   +4.602014866931747e-02   +5.613235429218114e-01   +9.392305394048979e-01; +5.516243731835241e-01   +3.559031765634985e-01   +1.388183956569425e-01   +5.875759815576800e-01   +3.481961689170172e-01   +1.953942443321789e-01   +2.697590933580951e-01   +9.821600935748760e-01; +9.804322331889977e-01   +6.616135074108170e-01   +8.379448598055860e-01   +6.752748755357800e-01   +1.206744629440861e-01   +7.187840619275498e-01   +7.488239427520610e-01   +2.874483844450482e-01; +5.488850562045641e-01   +2.820856470541624e-01   +1.387553731078443e-01   +3.595256170876308e-01   +8.827652851242903e-01   +7.221535916228095e-01   +5.043294915804730e-01   +8.000195993020398e-01; +3.307107770207773e-01   +2.308095995820554e-01   +5.876238771642454e-01   +6.203440827174773e-01   +9.502707576931055e-02   +8.777399252014519e-01   +6.473241286146922e-01   +8.949982871264243e-01; +6.195237796793394e-01   +7.105048690550173e-01   +3.671553171731912e-01   +8.116236545707977e-01   +9.310614220208525e-01   +5.811095730040584e-01   +3.078130526350538e-01   +5.977304382888685e-01; +3.610945401952151e-01   +6.235385906475109e-01   +8.058595605684344e-01   +2.079755388843044e-02   +3.998231529579721e-01   +7.183137018895501e-02   +1.389815916956015e-01   +8.836805819156048e-01];
L1E_L2E_iAMPA_netcon = [+9.439441979431016e-01   +3.716744477393450e-01   +6.684568667285188e-01   +4.850437594889013e-01   +2.472591407647428e-01   +4.513718834065635e-01   +1.229313746261185e-01   +4.969496695906604e-01   +8.834909985596933e-01   +3.248704494136336e-01   +5.137744787802641e-01   +8.531517629859593e-02   +6.311398221949662e-01   +4.298006747399346e-01   +6.126463427675706e-01   +5.043978128126303e-01; +5.491723766034587e-01   +9.370281163612781e-01   +2.083905483363421e-01   +7.569589209504912e-01   +7.847872757973273e-01   +2.052839899817606e-01   +4.071173677045291e-01   +6.936225234999019e-01   +7.202321360908834e-01   +2.461568852191351e-01   +6.572541159923398e-01   +1.635819156519409e-01   +8.594388994449559e-01   +4.923409714679282e-01   +8.197801976481152e-01   +6.124226233874938e-01; +7.279797379198970e-01   +8.299484259585581e-01   +6.534401782296071e-01   +4.167205014744301e-01   +8.832426934098730e-01   +8.991031436572056e-01   +2.759244321850208e-01   +8.338436723826564e-01   +1.928863208229284e-02   +3.427696420603769e-01   +9.518604009668585e-01   +3.235140935040903e-01   +9.752178326320891e-01   +7.053172115793281e-02   +8.868435033855127e-01   +8.199654267805356e-01; +5.766097878088440e-01   +8.490390811176568e-01   +7.161109468871690e-02   +9.718443564556126e-01   +9.133844842430301e-01   +7.628373811301516e-01   +7.168087539277258e-01   +6.110829962699756e-01   +6.745657248400923e-01   +3.745196610434466e-01   +7.227016955999030e-01   +3.020419476867179e-01   +5.696968798834311e-01   +8.874705801425420e-01   +9.299966563693627e-01   +5.318380418160199e-01; +2.580960432302183e-02   +3.712175828967658e-01   +4.065683373540586e-01   +9.892964284615281e-01   +5.581969734269892e-01   +8.836281456974949e-01   +2.817488625819953e-01   +5.745774710052791e-01   +4.380790631080410e-01   +5.456478745293031e-01   +3.999501017129968e-01   +1.139412738982003e-02   +9.971171151252669e-01   +6.413440316353873e-02   +1.912199293668387e-01   +2.025092739124346e-01; +4.479625920874820e-01   +5.925109654645955e-01   +6.670127892486235e-01   +8.639523134579022e-01   +5.987443071639283e-01   +2.860034963284996e-01   +8.958241382280285e-01   +3.248256832241191e-01   +4.363700334662245e-01   +5.626436561055447e-01   +8.331656105426458e-01   +5.407701228318104e-01   +5.535920165532433e-01   +4.367101002310220e-01   +2.584916998420926e-01   +4.543846396760068e-01; +6.466669600826253e-01   +8.735737279975423e-01   +9.353818484431590e-01   +3.882859697407603e-01   +1.480715044560633e-01   +6.723021264511764e-01   +8.262708517765355e-01   +4.561753830196850e-01   +1.158362364877935e-01   +3.959173113332026e-01   +1.347679873517629e-01   +9.621545954021271e-02   +5.150812093189342e-01   +8.259721995172998e-01   +8.973403047364351e-01   +4.288013689056656e-01; +5.218682854612747e-01   +9.337598987670742e-01   +8.098739048126625e-01   +4.543351832698441e-01   +9.006782334574542e-01   +6.637050338223656e-01   +3.904105628202378e-01   +7.149434942413520e-01   +8.139297555351531e-01   +3.980012245563943e-01   +6.054732598166290e-02   +1.477009407028718e-01   +3.316826796925511e-01   +3.935584258956629e-01   +5.939172973926522e-01   +9.661085350833546e-01];
L2I_L2E_iAMPA_netcon = [+6.190046802982297e-01   +6.954537420031129e-01   +7.339742935832942e-01   +5.904352705867155e-01   +6.695125438800851e-01   +5.504755037516533e-02   +9.894484873902591e-02   +8.488596424203189e-01; +6.962676950940403e-01   +4.263082584646537e-01   +4.295948273620801e-01   +4.594337311961262e-01   +5.002872235286124e-01   +1.527892395200035e-01   +9.079934801402865e-01   +9.168217765282761e-01; +7.211654314946204e-01   +8.368327960063142e-01   +6.940363255974700e-01   +5.150970067025508e-02   +2.187209335552407e-01   +2.016539389304425e-02   +1.094575007691758e-01   +9.869432591210613e-01; +3.470931142552396e-01   +7.310833696424259e-01   +9.450518363779394e-01   +2.284649414221809e-01   +5.725404480281724e-01   +4.349347607181334e-01   +5.170075865603800e-01   +5.040677314115148e-01; +5.180453778877091e-01   +3.604260797339472e-01   +7.830294912294370e-01   +8.344707655963916e-01   +1.218974407986927e-01   +8.317467405901947e-01   +1.435805980664016e-01   +2.705096954505626e-01; +5.567213492752138e-01   +4.542375629898143e-01   +7.058302248137504e-01   +1.546493627540368e-02   +6.715411351231404e-01   +6.163250324790338e-01   +5.598582884804962e-01   +1.013728609620360e-01; +1.572865874778000e-01   +3.869838128134928e-01   +1.096926733629249e-01   +8.641567883487142e-01   +5.996122341491082e-01   +5.199732653509448e-01   +4.752448976461237e-03   +5.083662609522015e-01; +5.633770847052287e-01   +7.755665802518577e-01   +3.897971731381969e-01   +7.852353054735899e-02   +5.594573133025965e-02   +8.638411869378793e-01   +7.673065272957886e-01   +5.841796915205029e-01];
L2E_L2I_iGABA_netcon = [+7.639700830090240e-01   +9.419503573081480e-01   +2.391123775829160e-01   +8.346443637126792e-01   +2.578061520548567e-01   +7.495028146829469e-02   +1.741580027617769e-01   +5.238935827833646e-01; +8.322927617587345e-02   +6.573676184826156e-01   +5.792243498950039e-01   +4.027294849241389e-01   +2.980164768624578e-01   +3.941240049907181e-01   +1.388209078436663e-01   +2.646027774997087e-01; +6.609890750322959e-01   +4.522744652899695e-01   +8.671769587276996e-01   +3.908557798489331e-01   +4.253093644457979e-01   +3.281124825327573e-03   +5.992232579320568e-01   +6.842062003823184e-02; +5.168488353584806e-01   +8.393976464173242e-01   +4.060868278372651e-01   +3.615537200408869e-01   +1.184928944942263e-01   +2.198960622260330e-01   +8.995837281052698e-01   +4.365718452719849e-01; +1.716878065447151e-01   +5.332971333825886e-01   +1.118960500544150e-01   +1.394234236190693e-01   +4.963865190911003e-01   +1.622521907320032e-03   +9.387246286089872e-01   +1.728987720629343e-01; +9.393768956383146e-01   +5.541294114140733e-01   +4.441255590863321e-01   +2.586617717490637e-01   +7.065453117746000e-01   +1.899297397099713e-01   +2.202319086411259e-01   +2.754363265721999e-02; +5.908036908936682e-01   +6.803690834125750e-01   +2.990871377439276e-01   +8.656288525526232e-02   +2.440380394728589e-01   +1.425831464894348e-01   +4.812706276208033e-01   +9.540759053500819e-01; +4.412251721025898e-01   +3.673709462556030e-01   +3.997847125916915e-01   +4.298052701259807e-01   +7.849887726539658e-01   +2.677685627964768e-01   +3.763170206807958e-01   +4.308501709849481e-01];
L3E_L2E_iAMPA_netcon = [+9.624352635454664e-01   +7.730559702770731e-01   +9.110881841991347e-01   +5.312224599798637e-01   +4.823492450566352e-02   +8.194946912153979e-01   +6.248182874327478e-01   +7.487531772806747e-01   +6.736154808959752e-01   +9.048606203081635e-01   +5.825579720373010e-01   +5.900547233328592e-02; +7.619028340989333e-01   +2.273872320292383e-01   +9.079008372558838e-01   +7.165261078095151e-01   +5.525380344258836e-01   +7.270196242533624e-01   +5.424348581252596e-01   +6.464859796352912e-01   +4.315487728014348e-01   +3.935087855849339e-01   +6.870977679440385e-01   +9.798236844597729e-01; +7.343131294232801e-03   +3.702057912739169e-01   +5.909522356271837e-01   +1.801759203993719e-01   +2.743178701185733e-01   +1.772325063917805e-01   +4.375117569317744e-01   +1.226112117816712e-01   +6.934311841936303e-01   +2.548147941378183e-02   +7.202632298189191e-01   +2.849841468854966e-01; +6.796429620304675e-01   +8.911849212905447e-01   +3.316069828714128e-01   +3.355798014842403e-01   +2.422659841597581e-01   +3.609227243443356e-01   +2.872656267563281e-01   +5.057962163283307e-01   +2.566656366321383e-01   +6.710342504474883e-01   +6.495705637766079e-01   +5.945236155055672e-01; +7.051470042986102e-01   +8.562296721156765e-01   +8.534487050255901e-01   +1.864578855351554e-01   +2.417417225831509e-01   +1.872514631746702e-01   +5.009771398529188e-01   +3.469154980069046e-01   +1.126037441196999e-02   +8.373170685886199e-01   +7.262618486838278e-01   +9.611821884941385e-01; +6.452328224368078e-01   +4.017679441446360e-01   +4.421187421362052e-01   +3.211089556052363e-01   +1.548937745423516e-01   +9.563968016432966e-04   +7.629334056522366e-01   +9.165284011416833e-02   +5.315271428473205e-01   +9.719956610670537e-01   +3.745530747790660e-01   +1.861369541298744e-01; +5.528768055842550e-01   +3.186349707295846e-01   +9.033353357206753e-01   +4.045143364713212e-01   +9.578620789642984e-01   +3.147226365879217e-01   +7.613176215708679e-01   +1.481249832872097e-01   +2.794069614078981e-01   +5.660822707740756e-02   +5.810702732522450e-01   +1.926500108614493e-01; +2.184021307982453e-01   +6.098306458608981e-01   +3.373490611438151e-02   +5.498077439983939e-01   +9.367713312785069e-01   +6.988283667730572e-01   +5.767209780360703e-01   +1.988414983950950e-01   +9.455838287492286e-01   +4.493854764076839e-01   +1.148480460758873e-01   +3.410550970704703e-01];
L3I_L2I_iGABA_netcon = [+9.337880573232491e-01   +9.234478998916458e-02   +6.169852826478923e-02   +2.780367470715674e-01   +2.547951296993146e-01   +4.035271671294204e-01   +5.298340473772269e-01   +1.092123944245369e-01   +9.122434629523738e-01   +5.851580425435065e-01   +2.081998325298627e-01   +9.087813027577131e-01; +3.898894914253780e-01   +6.159044257709123e-01   +4.953459729165037e-01   +7.459119120228176e-01   +8.579918798996157e-01   +9.888997304872496e-01   +8.294421461787834e-01   +2.705851255004760e-01   +6.395080292780845e-01   +2.840047618075573e-01   +3.171716666604851e-01   +5.515481410685950e-01; +2.730680431229563e-01   +1.169598889512240e-02   +6.427976736550396e-01   +2.381397393826805e-01   +9.112256530291261e-01   +9.015988672949286e-02   +8.571995716893742e-01   +5.238115896374909e-01   +2.551364320173135e-01   +8.278573140538442e-01   +1.337046354520114e-01   +3.363337437187554e-02; +1.526576753141480e-01   +5.737689424283942e-01   +2.216512015425299e-01   +9.573571384460069e-01   +6.993826817891383e-01   +3.214000072349040e-01   +7.882797697429036e-01   +9.728565986146674e-01   +8.978793984066533e-02   +1.915077939040732e-01   +6.726031242596270e-01   +5.436465174965491e-02; +3.967528137602832e-01   +7.886165312913345e-01   +8.379149519303888e-01   +6.207987548685066e-01   +7.263460898645036e-01   +5.123519332308158e-01   +3.191973560309550e-01   +7.091869856545714e-01   +8.386989194317606e-01   +4.418002925720310e-01   +5.703871909714553e-01   +8.050425336267681e-01; +3.755796228594193e-01   +2.360470372847826e-01   +9.706952091403487e-01   +6.009496807408163e-01   +2.288715739432164e-01   +5.971916380794022e-02   +4.520801392121727e-01   +3.107502077462023e-01   +5.840295493282343e-01   +3.933918954087672e-01   +1.703499210095530e-01   +4.515196876735955e-01; +1.293962599583414e-01   +4.480110057034801e-01   +8.463434138593919e-01   +1.733318629982382e-01   +5.748319569285525e-01   +7.259829636687938e-01   +7.517888240230218e-01   +2.926459461701210e-01   +9.483853443408047e-01   +8.266896411624605e-01   +1.482636724194163e-01   +3.816115096317624e-01; +4.351717871134042e-01   +5.688927198890827e-01   +5.066171749641443e-01   +9.019124214543374e-02   +8.102806070763177e-01   +5.579896387056327e-01   +1.109347422715046e-01   +8.490609413515060e-01   +6.094344685597164e-02   +6.773808757305767e-01   +4.758447560535003e-01   +7.901013185361002e-01];
L2E_L3E_iAMPA_netcon = [+3.646258505053803e-01   +7.571432881243156e-01   +7.422210325239997e-02   +5.179636656163481e-01   +7.567657666630941e-01   +4.329995800036539e-01   +1.996306686424488e-01   +8.761877282407792e-01; +5.309442051536347e-01   +9.968538988291993e-01   +5.920102565046833e-01   +9.956227172617894e-01   +9.952665502909985e-01   +5.437581868411399e-01   +1.936892350893676e-01   +7.863748935426845e-01; +7.125130043104165e-01   +1.871738754713151e-01   +9.114821673155191e-01   +8.561270105050192e-01   +9.623293626740179e-01   +7.125305194564330e-01   +3.265641998668466e-01   +4.654813367427117e-01; +8.713192171239581e-01   +7.811207587649448e-01   +1.921166658363186e-01   +9.615904966875619e-01   +5.353165904308350e-01   +1.568364105239511e-02   +8.796447451955857e-01   +8.134572193166894e-01; +3.280143477055427e-01   +1.953534918497752e-01   +4.324315282484564e-01   +6.787898392921146e-01   +9.651268741276485e-01   +8.007040365015234e-01   +4.705475519542621e-01   +8.976710286133404e-01; +6.495724434210518e-01   +9.927404267165917e-01   +7.494969343944322e-01   +4.026978352733960e-01   +1.169393971201661e-01   +1.421979487527968e-01   +4.041746330862160e-01   +4.278710441016732e-01; +9.761919303340511e-01   +8.019434843391872e-01   +3.934417788576093e-02   +9.337446079938994e-01   +5.051198557127331e-02   +4.786533993209607e-01   +1.795918937207362e-01   +3.338821287068112e-01; +7.665064613550811e-02   +4.248652714467686e-01   +9.468217648447623e-01   +4.802559466568468e-01   +3.032001044019706e-01   +2.554104700732814e-01   +9.684152962953843e-01   +5.965825391966925e-01; +5.879731546574071e-01   +7.281909726469061e-01   +7.631993126985253e-01   +2.311146535485319e-01   +5.808807605936004e-01   +3.691971521226917e-01   +4.079535885660574e-01   +9.005525007594277e-01; +4.130924099637930e-01   +4.977949947738033e-01   +5.575497076238934e-01   +3.958972318983037e-01   +5.320499089663980e-01   +6.613676180149192e-01   +8.435372431474316e-01   +7.018335413625438e-01; +3.086202662144433e-01   +8.092298230560058e-01   +1.838604020300920e-01   +7.053887731268477e-01   +9.004659134856520e-01   +1.684830671316061e-01   +6.166149176124354e-01   +3.777903556571023e-01; +2.631105293578639e-01   +3.563226719705590e-01   +4.995909237085907e-01   +5.587062375879748e-01   +5.395390132305637e-01   +2.800933914212065e-01   +3.752447509789498e-01   +7.345988151262852e-01];
L2I_L3I_iGABA_netcon = [+9.541866540819894e-01   +3.114182510227259e-02   +9.061049851214090e-02   +4.598828810348638e-01   +3.270877468039095e-01   +3.679529898022595e-01   +6.853079302002079e-01   +8.044049916305444e-01; +5.428419356604262e-01   +2.087529542485371e-01   +5.927323859633670e-01   +6.386816070548569e-01   +8.038274930992250e-01   +2.089924407275598e-01   +9.095190406155392e-01   +6.621190200255363e-02; +5.391035114665109e-01   +4.549521774404361e-01   +2.416668370633764e-01   +9.162556401004538e-01   +1.000000000000000e+00   +4.408009266136282e-01   +6.107943187563530e-01   +9.495399445515770e-01; +3.100264306749634e-01   +1.273769797123714e-01   +8.395244387526546e-01   +1.615590385346609e-01   +9.799409643743253e-01   +9.551090319361879e-01   +8.996935836608583e-01   +4.967581401895788e-01; +6.988386648630214e-02   +9.970116857575949e-03   +8.582260781579570e-01   +7.146111380151792e-01   +1.261605562482878e-01   +1.248451698751610e-01   +1.940445568447681e-01   +7.533744822698843e-01; +1.820364388875699e-01   +7.271420127566895e-01   +9.617220009617149e-01   +5.773284648951607e-01   +2.305402345286920e-01   +4.697163970288857e-01   +7.533167109205399e-01   +7.413709015098316e-01; +9.237736475392197e-02   +3.527912677607232e-01   +4.889644904037898e-01   +4.330593838061642e-01   +2.403463072052998e-02   +8.558780432598317e-01   +3.469456470719979e-01   +8.306700888129555e-01; +4.630291875146481e-01   +7.790441415396880e-01   +2.187769304174871e-01   +8.827720422884807e-01   +6.080336870490530e-01   +4.272759865285035e-02   +4.189626272803731e-01   +1.563606543648454e-01; +1.031925642832737e-02   +4.359811288511048e-01   +2.266897625323730e-01   +3.923481312871289e-01   +1.093183599767885e-01   +6.901834607255832e-01   +1.552290924950819e-01   +4.576861975233553e-01; +9.136282987336389e-01   +4.373140332311448e-01   +5.365905620684922e-01   +1.781179368981929e-01   +4.071787584205182e-01   +9.784159327733105e-01   +8.189957454608329e-01   +6.182288248669230e-01; +6.425475922230629e-01   +5.071438516727876e-02   +7.609508318661971e-01   +6.318482363878730e-01   +8.838241114360660e-01   +2.837026913923155e-01   +6.233366914100273e-01   +9.307752919817035e-01; +7.666767040077077e-04   +4.846335861976746e-02   +3.465595333698588e-01   +6.239295789542759e-01   +5.484011308684643e-01   +1.335077238532162e-01   +7.396602305280721e-01   +8.342073575771844e-01];
L3I_L3E_iAMPA_netcon = [+8.956266857945352e-01   +2.546636154404870e-01   +7.408040317242959e-01   +6.809956102736113e-01   +6.012994245327061e-01   +7.481687553004523e-01   +7.457634451005116e-01   +2.240455318610244e-01   +4.561941865496616e-02   +8.014431355746494e-01   +2.905280220446985e-01   +8.010600755136921e-01; +5.821425351312791e-01   +3.230922162771156e-01   +6.938188535101879e-01   +2.351523442433618e-01   +8.565564206661356e-01   +5.426841196867969e-01   +1.269324302967981e-01   +3.511005966764322e-01   +2.146751460828206e-01   +2.333395439881396e-01   +4.032325508355586e-01   +1.039051900792058e-01; +5.831884919672544e-01   +4.032729298495747e-01   +8.232371275537860e-01   +4.550486520766196e-01   +9.887414334436824e-01   +3.391799928820344e-01   +8.218140254852370e-01   +2.862118938570197e-01   +3.970334400889062e-01   +9.320902880724654e-01   +8.622613711846390e-01   +8.212508528150273e-01; +8.550565610809276e-01   +4.047217857461508e-01   +8.294153844546395e-01   +3.830941620730726e-01   +9.289219603644843e-01   +8.326060837339785e-01   +2.601444171865078e-02   +9.266371177615957e-01   +3.336078130583943e-01   +7.637637421852062e-01   +6.141361256457810e-01   +8.403965308938619e-01; +3.450702610201027e-02   +3.860402470265148e-01   +2.944252027438312e-01   +5.379991298252044e-01   +4.098647493590976e-01   +5.512356502031237e-01   +4.156035026848706e-01   +5.105039943260449e-02   +2.298311512948078e-01   +8.269257522381271e-01   +9.917344995618244e-01   +3.552828153472326e-01; +8.843611301535579e-01   +6.086114296897579e-01   +3.098529687157879e-01   +9.910726571691776e-01   +1.034692757919196e-03   +9.580420382838365e-01   +7.300858961657360e-01   +5.939133023347760e-01   +9.358229290880847e-01   +5.731281403867039e-01   +2.035739806168820e-01   +4.305928542407673e-01; +4.070037421690121e-01   +1.657420710629174e-01   +5.238354562049412e-01   +7.560806689843198e-01   +5.418862171292845e-01   +8.929856661760383e-01   +7.817987811345323e-01   +1.616849479238528e-01   +6.826898170193069e-01   +7.925611618881720e-01   +8.283338691921074e-01   +5.714649438689187e-01; +3.671856632876746e-02   +1.884404167882511e-01   +3.265647138627260e-01   +9.817022508879425e-01   +2.074910950690222e-01   +3.572603827843752e-01   +3.680347417606117e-01   +8.385709054106976e-01   +9.635854488260638e-01   +3.291018890294702e-01   +6.765777006184018e-01   +7.001899252501705e-01; +7.460414112840771e-01   +9.526887895179660e-02   +8.330753886174452e-01   +2.359499237642042e-01   +2.198784467801223e-01   +5.480461177854269e-01   +7.461349694510760e-01   +1.688443301962647e-01   +4.392890132423970e-01   +2.235693121237766e-01   +2.490081616453675e-01   +7.422394760525358e-01; +1.552436246101353e-01   +3.221539333115612e-01   +8.096314019061822e-01   +5.275067070719456e-01   +3.270135560347243e-01   +3.456315833502587e-01   +8.930864216383230e-01   +5.022401605094853e-01   +9.394491003506116e-01   +3.110910662612914e-01   +4.771780036117856e-01   +7.568238038238264e-01; +1.442632266882725e-01   +7.707611703419829e-01   +5.579513715208158e-01   +5.279486834216388e-02   +9.587730018636607e-02   +6.232865268252846e-01   +2.433656133504143e-01   +9.990714936171569e-01   +6.100450578771221e-03   +5.849890123541182e-01   +3.993825017795212e-01   +3.897754716629663e-01; +6.067299080672182e-01   +2.346831089234283e-01   +2.628778268224808e-01   +7.583186803316273e-01   +7.481165162021787e-01   +7.977426583325390e-01   +1.287769431433304e-01   +3.549597527926842e-01   +6.114187502709779e-01   +8.302886445120143e-01   +5.994548540299833e-01   +4.277265582313009e-01];
L3E_L3I_iGABA_netcon = [+9.555547182331458e-01   +8.846444946193786e-01   +8.000679705118763e-01   +9.858443887628815e-01   +9.019120448824179e-01   +9.606447969162688e-01   +6.528658971562740e-01   +5.002668991111532e-02   +1.073111073589487e-01   +4.516554310134084e-01   +8.293772558130910e-01   +5.807141777183982e-01; +5.723249223372769e-01   +4.380121161869664e-01   +9.874436672331729e-01   +5.597562257903957e-01   +9.950045549300284e-01   +5.414663214219498e-01   +6.694548870590390e-02   +4.664942053308855e-01   +4.608528812333844e-01   +3.338604118624935e-01   +6.253455894772679e-01   +6.362326099340312e-01; +8.503038031047732e-01   +7.825146939772308e-01   +1.587893223134894e-01   +9.334381372209581e-01   +6.529419217658928e-01   +3.168476442878414e-02   +2.750555928453589e-01   +3.247980518517954e-01   +4.512455305847299e-01   +5.862836589178954e-02   +5.395589348175062e-01   +6.512963372207542e-01; +2.759190946010043e-01   +1.488437925968712e-01   +2.366386445995526e-01   +7.200324882299814e-01   +1.079054464918939e-01   +6.959424678821542e-01   +2.814608839216766e-01   +6.308839051743377e-01   +5.511658596657807e-01   +7.408838866035709e-01   +6.504806429262593e-01   +8.641510286391051e-01; +6.233517611198747e-01   +6.206774449512980e-01   +7.015798394679981e-01   +4.844347838967337e-01   +3.704603051563369e-02   +5.192922595254188e-01   +8.794589031455443e-01   +2.294993159292624e-01   +8.059527372782312e-01   +5.072718948675271e-01   +7.263216462866207e-01   +5.619701522637040e-02; +5.895046682897060e-01   +2.600612435674297e-01   +3.762179856664040e-01   +6.393292648746732e-01   +6.182449159540796e-01   +6.026521151873709e-02   +4.449033031296200e-01   +5.799678274520080e-01   +7.016136067322525e-01   +2.010704496840938e-01   +9.403243171641634e-02   +8.176171646381709e-01; +9.646333345772963e-01   +4.455465424122073e-01   +9.742406751657999e-01   +8.880511793943412e-01   +5.660273595204556e-01   +8.888564259581404e-01   +7.567988048310943e-01   +6.041141873731194e-01   +8.720156333628404e-01   +4.272793643591965e-01   +8.782069546749732e-01   +5.289585185079156e-01; +8.640584523408421e-02   +8.449083048835692e-01   +9.715811378214428e-01   +1.984977414695752e-01   +9.618562140057262e-01   +3.297055469147050e-01   +6.020633166194873e-01   +5.995360658081575e-01   +5.180366339898882e-02   +1.675601376044102e-01   +1.338568177511296e-02   +6.947148008164117e-01; +5.010652451174492e-01   +1.965093680417113e-01   +6.433676370969427e-01   +3.962133375637746e-01   +7.477926639630670e-01   +2.283122931104176e-01   +7.831496497641390e-01   +4.484040155081251e-01   +2.189185452250667e-01   +7.512950986557685e-01   +2.927251938780524e-01   +2.127623204897179e-01; +5.216881142462197e-01   +3.035552109498632e-01   +8.593483683372535e-01   +9.922194802636155e-01   +6.627743239084921e-01   +1.134624116219555e-01   +1.138638827288175e-01   +3.429041405454129e-02   +4.590088431881495e-01   +3.676787952514740e-01   +1.788789973308378e-01   +5.435380284058784e-01; +9.048515424115479e-02   +4.817191417295531e-01   +4.014299460877930e-01   +4.020863296356819e-01   +5.240772029626641e-01   +3.122101714066414e-01   +9.775558627762765e-01   +5.134169018803116e-01   +9.585189593471282e-01   +9.422419803093262e-01   +9.261621681932485e-01   +7.031094565389953e-01; +9.058899674854559e-01   +3.374049976587448e-01   +6.311454856509635e-01   +6.582472397705653e-01   +2.597806659428137e-01   +2.277886421988924e-01   +8.480681194814121e-01   +4.068505167539520e-01   +7.909917448371534e-01   +1.579242016900131e-02   +6.810365400413802e-02   +9.554840253995857e-01];
L2E_Input1_iAMPA_netcon = [+9.989485983075997e-01   +1.000000000000000e+00   +9.981792065457760e-01   +9.986397448360282e-01   +9.974207978195836e-01   +9.990635449289051e-01   +9.982070877794189e-01   +9.979002269842052e-01];
L2I_Input2_iAMPA_netcon = [+9.987463476221824e-01   +9.987051906800474e-01   +9.997650640639693e-01   +1.000000000000000e+00   +9.999961856915207e-01   +9.980947651873369e-01   +9.994267242267053e-01   +9.985980019298022e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
