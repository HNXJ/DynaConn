function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.540997187061883e-01   -1.115329198311709e-01   +5.466991461033054e-01   +3.268276032070105e-01   +3.194971313772216e-02   +2.857415729958131e-01   -7.019484529761409e-02   +4.774925454941754e-01   +8.156268506122866e-02   -2.310225002131274e-01   -3.463819250482527e-01   -5.280477530768644e-01   +3.282249863325521e-01   +9.009665394476757e-02   -3.667686351345695e-01   +5.549250977217562e-03; -6.943761331521908e-02   -2.235506569787046e-01   -3.422299952637322e-01   -3.293900761057811e-01   -2.067016166722127e-02   +4.199750180707186e-01   +7.197867323183721e-02   -5.059663150341061e-01   +3.415854152592149e-01   -8.286885331860526e-02   +2.038678886242199e-01   -4.341941214689370e-01   -6.934019939824637e-01   +3.600870194295536e-01   +3.210911916439656e-01   -2.337691672038807e-01; -2.626174742347720e-01   -3.725754854685931e-01   -2.523525022937734e-01   +6.206581073223098e-02   +3.390906249081108e-02   -3.054889937255159e-01   -5.498725946212063e-03   +1.188715114383257e-02   +6.319899884886443e-02   +3.806847887027343e-04   -2.178149540896865e-01   -2.138452788345396e-01   +6.088794566358173e-01   +1.741995395407828e-01   +1.185618954211452e-03   +2.321300752704418e-01; -9.461115767925360e-02   -3.320172994997442e-01   +3.677040884672544e-01   -1.101572881164159e-01   +3.351498942118167e-02   +4.709070989483433e-02   +1.297869550496927e-01   +6.269924842887759e-02   -5.787554225903740e-03   +5.317234602862991e-02   -4.465624310985483e-02   -4.023080891122874e-01   -4.724174140196971e-01   +1.036932753544760e-01   +2.238215255718752e-01   +3.476880213088077e-01; +2.547716086407351e-01   -2.418135036605678e-01   -3.694260696763763e-01   -1.698270722299774e-01   +1.125746806260420e-01   -1.609601021278005e-01   -1.735579462517002e-01   +1.568488227442066e-01   +3.495214806007488e-01   +2.265996380317040e-01   +3.284607016211195e-01   +7.218613510553699e-02   -3.152609694464258e-01   -3.476036275001277e-01   +3.694053676873860e-01   +1.320910659193787e-01; +3.045737452162544e-01   -1.695238553230019e-01   -3.572095097837064e-02   +4.612393872050909e-01   +3.010866478832401e-01   +3.492235647962246e-01   +4.924492042953594e-01   +4.812664726250306e-01   +2.112517424083316e-01   +2.100345182821081e-01   +5.341801157985492e-01   -1.790497093176563e-01   -1.541281930165761e-01   -1.152563388946105e-01   +7.122974527744448e-01   +3.569414175186577e-01; -3.171384685889929e-01   +4.908260312421813e-01   -3.530231942596376e-01   -4.038653496979481e-01   -4.644798940855457e-01   +4.959356309917868e-01   +3.974695838272723e-01   +2.070364874143837e-02   -3.060567587396472e-03   -2.359300809163490e-01   -5.552442788281571e-01   -3.201863159025952e-01   -2.237712366664859e-01   +1.696669945101169e-01   +3.458605048105078e-01   +6.520006725845187e-01; -1.199945618331646e-01   +1.791826040435443e-01   -6.171747198441419e-01   +2.823187925264277e-01   +1.705819276879435e-01   +5.812168444327876e-01   +1.569203481876131e-01   -2.430554703340438e-01   +3.644316677709835e-01   -5.206497165753663e-01   +3.317746196995590e-01   -3.234927203761612e-02   -3.270659832928802e-01   +3.044751206851299e-01   +3.268321498015671e-01   +2.213125855673178e-01; -2.820942544117203e-02   -9.606663586323685e-02   -7.532224871244636e-02   +3.581941049694188e-01   +4.983902157232619e-01   +6.585434095234464e-01   -4.795447895831331e-01   +6.082972624310290e-01   -3.569186980657595e-01   -2.776603219215362e-02   +8.128136420413866e-03   -2.478884865680329e-01   +4.232696892669444e-02   +2.993836699521875e-01   +3.937568453468205e-01   +2.078140599023108e-01; -7.667119480314884e-02   +3.307531911700331e-01   -5.265772981564109e-01   +2.775531615224313e-01   +3.284078494635471e-01   +6.447680922530163e-02   +2.922240407620164e-01   -2.846786077063875e-01   -2.468866327018027e-01   -3.138673524533981e-01   +1.687958391224004e-01   +1.843641889956756e-01   -1.519958491827877e-02   +2.793169674327332e-01   +7.007168875661199e-02   -7.650980073217627e-02; -2.444189771514374e-02   +8.786985156364580e-02   +3.813036505960984e-01   +1.089316312409029e-01   -1.356962491042568e-01   +2.651581493414637e-02   -1.392776867474487e-01   -1.749125832340966e-01   -4.081441266012822e-01   +5.457770614703075e-01   -5.134701156425354e-01   -5.018118341667524e-02   -2.728062896838881e-01   +2.948849897757236e-01   +5.189819830387608e-01   +9.618959124287985e-02; -1.100297651667639e-02   +4.639965054139255e-01   -1.655508293997672e-01   +1.119341929022683e-01   -3.546193142767525e-01   +6.789518575495997e-02   -2.198060503767623e-01   -2.547559762387457e-01   -4.582471428814388e-01   -3.183560025640547e-01   -3.591574222812150e-01   -4.705932302878682e-02   -7.500779962385322e-02   -1.389985652233172e-01   -3.404756045190646e-01   +4.993104581646285e-01; -6.371820480292879e-02   +2.870118543396498e-01   +2.760112033804375e-01   +6.856486218201625e-03   +9.771306451169855e-02   +4.635590080492346e-01   +1.858813776251919e-01   -3.705283691763265e-01   -6.827564297522697e-01   -8.854799048409656e-02   -1.922379647314885e-01   +6.955886882417800e-02   -2.776674220752198e-01   -9.138391301076584e-02   -3.936108292319745e-03   -2.382660201068609e-01; -1.276838856626251e-01   +1.579490742307898e-01   -1.097378745130220e-01   +4.151854399593735e-01   +4.667738490657986e-01   -3.322692117383738e-01   +4.731888929837091e-01   -4.768910641184648e-03   -3.114690557981354e-01   +6.441189319711185e-01   +1.137932368233039e-01   +3.634796574701936e-01   +8.916347858909086e-02   -4.300196945645237e-01   -3.137237223272166e-03   -1.058560833695971e-01; +2.170875917406815e-01   -2.752516239312339e-01   +2.544235397329555e-01   -3.466005885327788e-01   -3.515167935583249e-02   +4.899574962559334e-01   -8.330314531141590e-02   +1.907654322518977e-01   -9.251994304991601e-02   -6.696374404484534e-02   +4.894748285899095e-01   -2.074181854961567e-02   -4.809247891077900e-02   +2.783319949012801e-01   -1.749963520219478e-01   -1.664681161655253e-01; -6.935095027341968e-02   +1.205951517975226e-01   -2.899011820345597e-01   +1.671343370290413e-01   -7.302688864172958e-02   -2.318377306188699e-01   +3.053850219324044e-01   -1.000654032543368e-01   +2.378474811731389e-01   -5.545918809871830e-02   +9.056525844658027e-02   +4.149528509640947e-01   -5.090566611460371e-01   -9.142393900417727e-02   +3.994369372268327e-01   +2.251980196291481e-01];
L1E_L1I_iGABA_netcon = [-1.533174755619232e-03   +2.758196565320278e-01   +6.289123107115273e-01   +4.790124749560163e-01   -5.027097035506454e-02   +1.090381854791893e-01   +3.518367766094342e-01   +1.270622619936648e-02   -1.910046865929386e-01   +5.201020706824566e-02   -3.054541088344659e-01   +4.651242429972197e-01   -3.463478583705084e-01   +4.470628220218112e-01   +8.338268939487321e-01   +3.205646929251680e-01; +1.968158300275154e-01   +7.832711200532355e-01   -1.498531356581436e-02   -4.380567746377579e-01   -3.701243886920726e-01   +1.276379929991593e-01   -1.220976913605270e-01   -3.615004895811241e-01   -1.307275920871701e-01   -3.004306099774312e-01   -2.563798504809719e-01   +3.997842359115996e-01   -4.831274047867137e-02   +2.348738136361175e-03   -1.520789135752578e-01   -3.930964220029187e-01; +1.398268744615213e-01   -3.638868070195968e-01   -1.868019435164884e-01   -4.101850074279376e-02   +5.701346022730054e-01   -3.480308671133907e-01   -1.066859387565916e-01   +3.402240551382593e-02   -8.470927163766227e-02   -4.031619850785846e-01   +2.780774155649367e-02   -1.561536328559029e-01   -1.044082546523400e-02   -4.973183260761116e-02   +4.728133018754136e-01   +1.814834234669747e-01; +2.048010675810372e-01   -4.403312184462419e-01   +8.197833477714314e-02   +3.765804014850731e-02   -2.732380061204896e-01   +1.659376965980466e-01   -5.538825978161246e-01   +3.410292246108559e-01   -2.024045262029111e-01   -3.256168728997028e-01   +2.001496637670799e-01   +7.054160186712659e-01   -1.896931564545812e-01   -1.027024946245890e-01   -4.361907134707630e-01   +4.141654365872680e-01; -7.132100664601740e-01   -8.482916226102482e-03   -8.001954929291588e-02   +2.303534320371780e-01   -1.685114472288238e-01   +6.495759935612558e-02   -3.060915155836583e-02   -1.728398838492117e-01   +1.630405026291708e-01   -9.003904867300733e-02   -1.654538373348721e-01   +1.785468090439440e-01   +6.082596646901522e-02   +1.078661868792178e-01   -2.946304731144803e-01   +1.252685017307533e-01; -4.420497166667104e-01   +3.852046566588619e-01   +3.493126051943297e-01   -4.697117294640714e-01   -6.203737525327918e-02   +2.326706205591536e-01   +8.594571056626629e-03   -3.516621410968390e-01   -1.110198950002999e-01   -8.508617625879292e-02   +1.358020969753684e-01   -5.935462022504696e-02   -1.450991682502245e-01   -7.701120476606582e-02   -1.599906341336325e-01   -3.647776953419308e-01; -1.654003104525062e-02   -4.128454669595916e-01   +5.505769841706118e-02   +2.397042800352380e-01   +1.791417642861149e-01   +2.265120332440085e-02   -1.610078674774186e-01   -6.282879087560711e-01   -9.182330625060312e-02   -7.770947259315267e-02   -7.121138787252423e-01   +1.417711271413211e-01   +2.197031514364297e-01   +2.117312451249975e-01   -4.513935628787104e-01   -3.402234528655926e-02; +1.883607168975821e-01   +3.141501622820705e-01   -1.465856058678853e-01   +7.042658853877674e-02   -1.196317512655184e-01   -4.032507369262867e-01   -1.085689437382829e-01   -3.778921152325021e-01   +8.880999661797253e-01   -9.714251798803883e-02   +1.146342894560330e-02   -3.809529837377696e-01   +2.976973761167598e-01   +3.798428561857761e-01   -2.356950717075701e-01   -2.321260041476825e-01; +3.754519734299653e-01   -4.650855200194395e-01   -2.194179939560652e-01   +7.543375952169226e-01   -1.285921822454939e-01   +3.269748631601377e-01   -5.096547593183141e-01   -3.204901931311688e-02   +3.318013936062828e-01   -2.411194085264075e-01   +4.493153616647331e-01   -4.723035192151834e-02   +4.701411929509353e-01   +3.700204464792605e-01   -7.767293151619667e-02   +3.598586158531550e-02; +1.763271286590299e-01   +1.519759094735648e-01   +4.942491323506631e-02   +4.456437562213794e-01   +7.882150251870973e-02   -1.258201409207553e-01   +1.757240294349038e-01   -2.324579869071465e-01   +4.117229489502342e-02   -9.383681226331429e-02   +1.888022240167420e-02   +4.276507149598883e-01   +2.271032349480178e-01   -6.197977459630979e-01   +4.348196338972832e-01   -5.669634326192712e-01; -3.900432239909951e-02   -1.354424342068069e-01   -2.960296036260688e-01   -1.875461746333660e-01   +2.224982317347743e-01   -5.107466126143456e-01   +7.742481116728793e-01   +2.900064366305628e-01   +1.257651372660713e-01   +5.096003901324011e-01   -2.919544130983281e-01   +3.458276527957686e-01   +1.079275453721149e-01   -1.221454959771246e-01   +3.350685819390887e-01   +7.072759183600545e-02; -4.173230887025486e-02   +8.980335135149836e-02   -6.206650881056969e-02   +1.132793654572228e-01   +3.993624664766740e-02   -3.279051122200687e-01   +2.797505993231997e-01   -2.405489509582296e-01   +9.571944815531389e-02   -5.134375981972322e-01   -6.227346304609640e-01   +2.141323839871166e-01   -1.050091546124743e-01   -1.938763541141266e-01   +5.367079460088478e-02   +7.076978295488029e-01; +3.515750790550268e-01   -5.204634791613541e-02   +1.931845324363318e-02   +1.039737653658603e-01   +2.787329031249422e-01   +2.769159276437912e-01   +2.862392242655395e-01   +4.166857201970128e-01   -4.984638101610164e-02   +3.022140069274788e-01   +7.085218736225879e-02   +2.154224499868563e-01   +9.321895493464209e-02   -3.899309313610069e-02   +9.116850854305419e-02   -5.789565202243709e-01; +7.966713340396125e-01   -2.092110469609902e-01   -1.039072816762878e-01   +3.395894034934336e-01   -1.327655345276892e-02   +3.796420331004505e-01   +3.779117341042150e-01   +3.343436236477357e-01   +3.391464567743592e-01   +4.974380074913356e-01   +2.272763958335663e-01   +3.897468626326123e-01   +1.981718211593164e-01   +4.930237640470540e-01   -6.715997251427613e-02   -2.110862448189756e-02; +1.778677152803984e-01   -5.473313811523663e-01   -5.950359728018970e-02   -5.766228789456389e-01   -4.354876513013797e-02   +1.318616803718719e-01   +2.130546230090443e-01   -1.130015209292612e-01   +5.204252255811591e-01   +2.538230519160377e-01   +6.380150966810319e-02   +2.888966030630434e-02   -5.869423730757108e-02   -2.714710687144753e-01   -2.963955838474116e-01   +1.923396110208957e-01; -2.336684313105701e-01   +8.702190360218873e-02   +1.916537873911297e-01   +3.191484270580304e-01   -4.623543874551505e-01   -3.845503987911510e-01   -1.372216027649382e-01   +2.164734775959155e-01   +6.483692147364971e-02   -1.483888435040320e-01   -3.348773736301559e-01   -1.055065210606321e-02   -6.499276831759287e-02   -4.212313228669549e-01   -1.511500615012507e-02   -2.773672153840371e-01];
L2I_L1I_iGABA_netcon = [+2.148743772937434e-01   +4.049914013448633e-01   +2.030460167232373e-01   +5.837141981445262e-02   -4.069091112308014e-01   -2.406494954802113e-01   +5.997939665077012e-01   +4.963179523447337e-01; +1.337990425372944e-01   -9.818789624284069e-02   -2.225415368884074e-01   -3.580574423118067e-01   +3.547653909725983e-01   -1.040719645733567e-01   +1.664105706903495e-01   +3.163804823436366e-01; -1.250208788273494e-01   +8.615873015981038e-02   -4.014070126555058e-02   +1.053971271220938e-01   +2.601625466497705e-01   -1.230289999905342e-01   -2.545700939506228e-01   +2.949633871683088e-01; -8.312403512963328e-02   +7.188513919822848e-02   +2.619896217504359e-01   -1.279884173195928e-01   +2.401623298761338e-01   +4.800613493706903e-02   -3.926794884799893e-01   +3.797565471611619e-01; -5.153186212771357e-02   +4.324669450026910e-01   -1.270957749486304e-01   -2.313608484346858e-01   -3.146087259797818e-01   +2.646497562877168e-01   +2.784826281641340e-02   -9.194699342625778e-02; +2.639274006712319e-01   +6.436451956983137e-02   +7.757792580043923e-02   -1.192664116269657e-01   +3.464439989466277e-01   -4.554512057694537e-01   +2.756257801840118e-01   +1.202985832455977e-01; +2.181372573143020e-03   -3.199915856101598e-01   +1.803870548949610e-01   +2.194468474366298e-01   +1.921753855052328e-01   +3.933612120633637e-01   +1.326784449221384e-01   +2.438754270128960e-01; +1.633711270299445e-01   -3.656551197431034e-01   +4.664098435987172e-01   +7.259658159748352e-01   -3.847413372293012e-01   -1.782915708174938e-01   +2.102058741023838e-01   -2.861716434282410e-02; +2.290513605901517e-01   +6.257910184930218e-02   -2.194631771595685e-01   +1.817478426675814e-01   -2.257094783723254e-01   +3.821917501846403e-02   -8.019886931014819e-02   -1.965300751472479e-01; -7.501043777492353e-02   +2.470512028523864e-02   +6.005171057228240e-02   -3.772394501507218e-01   +3.808081386656706e-01   +1.749199324562591e-01   -1.758758536858129e-01   +2.257240858549625e-01; -2.179247079877709e-01   -1.271725714568363e-01   +5.197065339065876e-01   -4.065133944835846e-01   -4.028022517948333e-01   -3.156809939437815e-01   +2.166435221407280e-01   +3.087433978104880e-01; -1.095668909417442e-01   +3.117944558451768e-03   +1.335340398787887e-01   -5.328330722788996e-01   +1.773478733866735e-02   -7.460002772554426e-02   -3.046149265094494e-01   -3.836020825461942e-01; -1.154191080860983e-01   -3.720303398120420e-01   +4.727622092296270e-01   -2.133450383062263e-01   -2.870405790559165e-01   -7.966276315522161e-02   -3.242785079342649e-01   -1.851419635824750e-01; +3.334739093329087e-01   -3.683843047191928e-01   +4.224237938406800e-01   +2.625523809475839e-01   +3.596936622773740e-01   -6.493010265369747e-03   -5.381779751882548e-01   -1.035846827802189e-01; +4.200176067067172e-01   +1.041431415730106e-01   +6.228647205232396e-01   +5.223664766043132e-02   +4.198237496553693e-01   +8.568866265098335e-02   -1.794481517629623e-01   -1.098735628375663e-01; +1.776181623930735e-01   +1.794493634464698e-01   +3.568166690534154e-01   -2.085109446002272e-01   -1.795977678726433e-01   -3.689345729715562e-01   +8.962667658376766e-02   -3.704298023073646e-01];
L1I_L2I_iGABA_netcon = [-3.309878052527641e-01   -3.554823911275332e-03   +3.513699291967046e-01   +9.137651016015372e-02   +2.473752996534454e-01   -7.412169962319698e-02   +3.075168765087770e-01   +4.398686071246672e-01   -9.280935127768483e-02   +3.879243011968070e-01   -1.979765549401107e-01   +2.040669274472532e-01   -5.118534189931809e-01   -1.110617832152563e-01   +2.234283120440148e-02   +5.083650197641126e-02; +3.496509948050901e-01   -1.957987069723606e-01   +5.931494510986671e-01   +2.926180298979936e-02   +8.120042197200099e-02   +2.415949224296952e-01   +3.232182243419091e-03   -2.932683982405178e-01   -1.005604061353945e-01   -1.877859456943308e-01   +3.628679691764136e-01   +4.153022575082133e-01   +6.251047029337015e-02   -3.214523996088429e-01   +1.413083122733939e-01   +1.667916790193215e-01; -2.299983421369343e-01   +4.581806068681593e-01   +3.819709155228820e-01   -6.341201332677963e-01   -2.515878218223903e-01   -2.107172578043364e-01   -1.056751243891335e-01   +1.905762916144139e-01   +1.572012558970940e-01   +3.756974660198301e-01   +2.436935538840754e-01   +1.217043564746087e-01   -3.271665392996864e-02   -1.177479606520076e-01   -6.408558828624117e-01   -1.989620553774482e-01; -3.657419422444131e-01   +9.895773158855715e-02   -3.758901411738116e-01   +2.522319439030403e-01   -2.405301910884039e-01   -1.145699325895632e-01   +1.371174673712425e-01   +1.172336428011723e-01   -4.467071469781310e-01   -8.675576791758188e-02   +5.184264723786838e-01   +8.146925741120237e-02   +2.071394058049645e-01   -2.852449191598517e-01   +6.413601465316969e-01   -4.274387548425427e-01; +7.301473967553608e-01   +5.616135755433589e-01   +4.006035900299121e-01   +6.117854940253600e-01   +6.515231820296441e-02   -1.102708118876903e-01   -8.321063586497240e-02   -6.173709612178079e-02   +8.848441999244036e-02   -2.276268252578345e-01   +3.376528490051199e-01   -1.363420198394655e-01   -3.320467416474661e-02   +3.918386268677911e-02   -1.135921094762654e-01   +3.090746789222248e-01; -8.021591232129544e-02   +3.507637915430326e-01   +5.778032251463389e-02   -5.741106736158378e-01   +1.045918630268456e-01   -1.253646579673267e-01   -4.989039485310557e-01   +4.174834204573440e-01   -3.779767848151208e-01   -3.271066320816515e-01   -3.517717538789895e-01   +2.626279311080920e-03   +1.604522962773115e-01   +3.048486986594054e-01   -4.331435823164070e-02   -1.810108636016981e-01; +1.276605857297823e-02   -2.710645594425197e-01   -5.749394063463435e-02   +5.401711022774218e-02   +6.015439929741735e-01   +3.840688013739232e-01   +2.342464826636695e-01   -9.967656684356174e-02   +3.452633314765093e-01   -4.064536530950374e-01   +3.522911874975356e-01   -6.816221214695375e-02   +3.029670638574679e-01   -3.085936331943349e-02   -4.315588295033855e-01   +1.282731737367332e-01; -1.609490643412690e-01   +9.224536083134857e-02   -5.041576627283875e-01   +3.787957761779406e-01   -1.164747159503109e-01   -3.244702023556539e-02   -1.627707598809983e-01   -4.247983146522812e-01   -5.924751838087830e-02   +3.019414305425236e-01   +6.496013470149378e-01   +3.753494956389442e-01   +4.124201321417462e-02   -1.098401757402333e-01   -7.026009060909544e-02   -1.411663604970568e-01];
L2E_L1E_iAMPA_netcon = [-1.430313151990487e-01   -1.829389118765509e-01   +2.647038910213781e-01   -3.495321887296045e-01   -3.216961058367155e-01   +2.172212794508020e-01   -5.879873021277791e-01   +4.978736033189776e-02; +1.106301738519303e-01   -3.223222391294035e-01   -4.074326407735122e-01   -6.483225283488077e-01   +7.555809964153662e-02   -2.340318741201624e-01   -2.519496800606614e-02   -5.691597280156837e-01; -2.025004964039204e-01   +9.407339471510426e-02   -1.238392003458781e-01   -6.231144221063060e-02   +2.283474363962856e-01   -3.335714224980405e-01   -2.536454360169190e-01   +8.831255536487348e-02; +4.364298704889165e-01   +2.920576545131709e-01   +3.485403317984300e-01   +3.873675352632093e-01   +6.340901449951146e-01   -5.678411687692257e-01   -3.584369989329181e-01   -8.672981747417549e-02; +1.468490942244810e-01   +5.147296613131452e-01   -8.994125273102116e-02   -1.034371769900208e-02   -4.572557161788030e-01   +1.900310074187486e-01   -1.872417915497211e-01   +3.766857790125192e-01; +1.346435540433277e-01   -1.526031748351156e-01   +1.919113356551784e-01   -1.404772541950916e-01   +4.878693203535727e-01   -1.953345805202286e-01   +3.193651671238910e-01   +5.724854417468678e-02; +3.347683633242603e-01   -2.000122505650404e-01   -9.559034817285877e-02   -1.344064830743031e-01   +4.661001042065555e-01   -2.794019845435275e-01   +7.380177774740648e-04   +2.667731626721903e-03; -3.465820963522262e-01   -3.263095983126622e-01   -5.108159559512627e-02   +2.630659317291162e-01   +3.062923596916640e-01   -6.739670052687841e-02   +4.485427773493956e-01   -5.048460287962542e-02; -5.390052935924520e-01   +3.474663220717058e-01   +6.650852462781459e-02   -7.897747318722356e-02   -2.709647061407428e-02   +2.241061369455642e-01   +2.291674851542909e-01   -7.764659205985333e-02; +5.266489915508759e-01   +3.054000721936137e-01   -1.646735493271905e-01   +1.688429319358135e-01   -1.265380683271399e-01   +1.235878219124351e-02   +1.279094606408904e-01   -1.105372693141308e-01; -2.656206209140927e-02   -2.321812881616186e-01   +3.787459343294388e-01   -1.157789474271748e-02   -6.748048183004358e-01   +7.285411938674236e-02   -1.789523725202598e-01   -4.491549150617429e-01; +3.295944082206858e-02   -2.540127047885047e-01   +8.245517329608834e-02   +2.062387001133522e-01   +1.605872809048409e-01   -1.529894820115840e-01   +3.665574593952470e-01   -2.016728609989298e-01; +3.427498188805539e-01   +2.138151521848272e-01   -9.347311254054425e-02   +3.547107237259787e-01   +2.505022026822472e-01   +2.389687969957743e-01   +6.281541312306579e-02   -2.975921894875831e-01; +1.721779953710294e-01   -2.801459026665103e-01   -3.087856427254746e-01   -2.754599775328436e-01   +7.677350102628336e-02   -5.706304362008048e-01   +2.532463922294708e-01   -4.483420315764454e-02; -6.708093792702023e-01   +2.396035888809700e-01   -1.172639161059391e-01   -1.823952612348927e-01   +5.731846947100707e-01   +1.937416312310425e-01   +1.504301859725263e-01   -4.216634729730064e-01; +1.015104960010024e-01   -3.415782766604580e-02   +3.607787303981173e-01   +3.447169265064950e-02   +1.277347491735792e-01   +2.271569729095802e-01   +2.846922575191726e-01   +4.201416264194729e-01];
L1E_L2E_iAMPA_netcon = [+3.710990821398557e-01   +3.896914266754590e-01   +2.585875399835104e-01   -2.048613412834386e-01   -3.147890158831961e-01   +1.921065219623113e-01   +1.334322262308030e-01   +8.587581466606464e-02   +7.564630300754285e-02   -2.613190720094633e-01   +6.419986323494595e-02   +5.998981848362066e-02   -5.648567633701196e-03   -7.234354552995190e-02   -8.905034495090033e-02   +2.344793733251929e-02; -1.940984643272206e-01   +4.299043724756496e-01   -3.574300707473024e-01   +4.555148969968151e-01   +3.729587192972825e-02   -3.078770376165894e-01   -8.383852108580911e-02   -2.394034573711791e-01   +2.439188825898842e-01   -3.037960113790415e-01   +3.994148144397079e-01   +2.904749118621433e-01   -8.989299173909390e-02   -4.777866327167916e-01   -6.285175299577211e-02   -1.544193938247323e-01; -9.538279565176233e-02   -8.234806819908183e-02   -2.839965822877485e-01   +5.982400170327230e-02   -1.291656765265784e-01   -4.396699047513360e-01   +2.418377223313432e-01   +2.328554103343428e-01   +4.431053123025425e-01   -2.923508188473479e-01   -2.503075290164014e-01   +1.230761851423820e-01   -2.300794410024588e-01   -1.183397086178728e-02   -3.430538884385181e-01   -2.704993057097657e-01; +3.953894417671777e-01   +6.636618997906572e-01   -3.168037178665103e-02   +2.218812673691424e-01   -1.160755106213675e-01   -3.474885228089312e-01   -1.243989116931031e-01   +9.043582874196517e-02   +4.208793987793670e-01   +1.443752605106445e-01   -1.502612137807514e-02   -8.284189245409657e-02   +1.970611303666324e-01   +4.093951055006934e-01   -3.175619476626708e-01   -4.445777634986183e-01; -1.524920565565113e-01   -3.615067763232151e-01   +2.000550306212242e-01   -4.517368032371671e-02   -4.101451677292171e-01   +2.184572841830716e-02   -7.005431513667845e-02   -1.208817050879147e-01   +1.736796107923098e-01   +5.079604871213952e-01   +5.819838088862745e-01   -1.367576336050740e-01   +3.535584091027013e-01   -2.507205387577961e-01   -1.471613586537830e-01   -6.916857204707921e-02; -6.070902714909099e-02   -5.205818973725767e-01   +5.254394754468403e-02   +4.260315170556881e-01   +4.869846873908202e-01   -2.376890190729969e-02   +1.848836368955905e-01   -9.442788926326967e-02   +1.223566329227796e-01   -3.380055231036485e-01   -4.862176579374883e-01   +2.228068171003276e-01   -2.058724558389495e-01   -1.906045905721602e-01   +4.112953049280559e-01   +1.546852837980040e-01; +1.374768602849204e-01   -1.347245570003465e-01   -2.230333507260375e-01   -1.664445680738470e-01   +1.571889839993645e-01   +1.064530801309746e-01   +4.769329506813009e-01   -1.529473488546418e-01   -1.078014646659386e-01   -6.270237640888170e-01   +2.123701614573157e-01   -1.680459564110852e-01   -1.020431008403647e-01   -7.658259473835433e-02   +9.135406093681531e-02   +1.391235278945994e-01; +2.102864307392008e-01   +3.687420955633602e-01   -1.364700949831690e-01   +2.907773458239370e-01   +2.125712826642408e-01   -2.059679581273073e-02   -2.548071152412546e-02   -1.954577979213664e-01   -9.829298534665498e-02   -2.963803152393729e-02   +3.958086624249308e-01   -4.091178921330597e-01   -1.844468692013813e-01   -6.256834059376351e-01   +1.996702411659065e-02   -3.640862098698655e-02];
L2I_L2E_iAMPA_netcon = [-5.908198215841090e-02   -2.554146472452471e-01   -1.223624068061965e-01   -4.187267340578259e-01   -6.283496655702422e-03   -4.912188576774609e-02   -1.251240032815753e-01   -3.192113735714289e-01; -1.718648334005786e-01   +3.326235071689219e-01   +3.102660444403883e-02   -4.371538119847989e-01   +1.140814589844724e-01   +1.655186965470516e-01   +1.033131719220054e-01   -2.065161853585789e-01; -3.848887841378591e-01   -1.857638044561563e-01   +2.601996673603832e-02   -2.336264061822436e-01   +2.740303122663503e-01   +5.437280692270524e-02   -1.897177928991738e-01   +2.089794773348709e-01; -4.702951834835500e-02   +1.319707349816249e-01   +1.020382185279389e-02   +4.058703886207374e-01   -2.147402883559058e-01   +1.536051621949248e-01   +3.307840616296528e-02   +1.037613152145037e-01; -1.154982336890228e-01   +3.355738145535250e-01   -5.135297745159554e-01   -4.560580354138374e-01   +2.428483064224119e-01   -3.239937066301635e-01   -5.421474400742615e-04   +5.900130791989759e-01; -5.305235030338191e-01   -1.064426999875466e-01   +7.782155027434415e-02   -5.258838909901391e-01   -2.096275418980569e-01   +5.611324801174637e-01   -3.483985055814115e-01   +4.154869095952726e-01; +7.530057527049344e-02   +6.613062879153866e-01   +1.477052662599371e-01   +1.501738103450626e-01   -2.634135356238027e-02   -3.753237048332311e-01   -3.363110473081901e-01   +4.256505561185762e-01; +1.703622671833377e-01   +1.819224897594979e-01   -1.000409914332398e-01   -3.663058721204426e-01   +3.083505704236572e-02   -9.953970564222359e-02   -7.044636377536264e-01   -4.617258859845319e-01];
L2E_L2I_iGABA_netcon = [+1.605598371576006e-01   -1.640123114134633e-01   +3.607487815667475e-02   -3.995306423375897e-01   +2.136034227021380e-01   +5.498777080118156e-02   +3.622129886186574e-03   +8.017343372312111e-02; +3.349769087681965e-01   -1.125007107887247e-01   -3.509514853081380e-01   +3.885172192844961e-01   -3.950371091680583e-01   -2.155829074987194e-01   -1.464960258864811e-01   +3.297581035492555e-01; +4.276297995731978e-01   -4.389156686322958e-01   -1.382711373044539e-01   +2.972554906763643e-01   +4.592695635194902e-02   +4.083914874634615e-01   +1.354039167316384e-03   -2.498386835549918e-01; -3.486629249790497e-01   +6.938543723921790e-02   +3.666636468207355e-01   +3.588977729053580e-01   +1.068656844776558e-01   +3.048845412116562e-01   +1.223819351343226e-01   -2.537868862495434e-01; -1.665458333599698e-01   +4.421638269924037e-01   -1.795680094989243e-01   -3.586634720148540e-01   +4.422506790569994e-02   +1.972509334353140e-02   +5.497321169576509e-02   +2.953264165873573e-01; +3.305124832325665e-01   +2.619958563545614e-01   -5.404754689987669e-02   +1.774913155169520e-01   -3.594184002512900e-01   +8.476945102666772e-02   +3.813453744165660e-01   -2.735721721107691e-01; +2.154670851923713e-01   -1.810112072437262e-01   -1.756568490834072e-01   -1.536129510065069e-01   +6.699761982349217e-01   +3.271870233969490e-02   -1.983176862271599e-01   +1.915120290194438e-01; +1.695136070561387e-01   -1.089251590490989e-01   +1.953390378738719e-01   +1.256819392612182e-01   +2.720192998511462e-01   -3.174182072618058e-01   +1.806381764978119e-01   +2.878541100722637e-02];
L3E_L2E_iAMPA_netcon = [-3.754854434896315e-01   -3.916305483668808e-01   -1.191166602868506e-01   +1.278158022079064e-01   +6.173668433223822e-01   +3.111525560265124e-01   +1.846586300381873e-01   +2.962118228090034e-02   +5.668989508248969e-01   +4.640747490760117e-02   -2.464671276327799e-01   -9.924137375559816e-02; +2.481818005501902e-01   -4.147141135973977e-02   +2.628096680622229e-01   +2.970947604904602e-01   +3.489850829637592e-01   -2.976397628358455e-01   -2.268195569542295e-01   +3.107748029359579e-01   +5.570291707509725e-01   +8.651323529938290e-02   +4.077060365161738e-01   +9.568429767685115e-02; +5.951349536566342e-03   +5.827212069507945e-02   +8.733362416385118e-02   -2.565618901144648e-02   +5.869251480569779e-01   +2.222984904130426e-02   +1.681669580892987e-02   +1.080307299130618e-01   -1.627543388160052e-02   +3.639694421494045e-02   +5.928760957415493e-01   -1.516597674281429e-01; -4.263532825320801e-01   +3.538063624033512e-01   +2.439053444558557e-01   +6.461695348545152e-02   +1.311620798117547e-01   +3.205754353344725e-02   +1.661498375789786e-01   +2.442210127787338e-02   +5.702868874351547e-02   -4.720298791313865e-01   +4.086742056884307e-01   -6.342434409576934e-02; -1.210896198866008e-02   +8.326244193741436e-02   -1.570880607719678e-01   -2.851463562933839e-01   -1.608215557346516e-01   +1.158114534070152e-01   +7.905216042375006e-02   -6.027329755334007e-02   +3.119115479068825e-01   -1.421678697017534e-01   +3.269212474585581e-01   +2.328050811545274e-01; -1.229458890789042e-02   +6.744066084979047e-02   -1.496623814229554e-01   -1.362445105302074e-01   -4.818752141211280e-01   -7.255607084990930e-02   -5.191598146662280e-02   -8.907997459717046e-02   +2.827112087351873e-01   +1.696855413043930e-02   +2.878755393146129e-02   +3.966404646343774e-02; +1.908439140619346e-01   -5.715457484686139e-01   -2.816692075951770e-01   +2.392315233153021e-01   +1.890215844246812e-02   -4.037466822421170e-01   +1.400497416244911e-02   -1.776340107871075e-01   +3.240401413003434e-01   -4.086792481937769e-01   -8.956725941782938e-02   +1.449459613028967e-01; +5.743202783533181e-02   +1.965116459103792e-01   +1.814718235105360e-01   +2.153457221578345e-01   +1.289155025739602e-01   -2.174309146745637e-01   +8.738179435345285e-02   +8.562990035741772e-02   +3.725440521163963e-02   +2.096072746258805e-01   +1.361823305680803e-01   +1.359623235513887e-01];
L3I_L2I_iGABA_netcon = [-1.859288831778734e-01   +9.365851157131203e-02   -2.553707756008177e-01   +1.245602021658803e-01   -3.986590764182449e-01   +4.013966383796775e-01   -4.818115967070160e-01   +1.770341838218666e-01   +3.240897776855913e-01   +2.261848623739207e-01   +4.026701180621564e-01   -2.001814321620488e-01; +3.821344718328684e-01   -6.571462358257807e-01   -5.084185894956699e-01   +2.802239118211164e-01   +9.642631261590896e-02   +1.000618931642251e-01   -3.444484349546320e-01   -2.172781337216382e-01   -2.518514489225285e-02   -7.352590612577183e-01   -1.264219607648262e-01   -1.271302304634539e-01; +4.782273392428265e-01   +2.438667396965067e-01   -2.744844044522229e-01   +1.600226504437393e-01   -1.626494644995784e-02   -4.403165797482206e-01   -2.057091338824138e-01   +2.402675377895301e-01   -3.838395592290482e-01   -7.167177707351195e-02   +6.070505090643405e-01   +5.152247151509938e-01; +6.802002663031390e-02   +2.970159395336373e-01   -2.603988601045767e-01   +2.627397335663104e-01   -9.750886117335750e-02   -1.056258361200074e-03   +1.759055886768891e-01   -5.619655716264178e-01   +8.484188363033407e-02   -5.813324237820577e-01   +6.361919557169764e-01   +5.274983621612340e-01; +1.191488549489695e-01   +1.420034573236871e-01   -6.334577056860910e-02   -7.833344340836187e-02   +9.356559890565050e-02   -1.672902222886486e-01   -4.388126361943929e-01   -3.677503297234909e-02   +1.509735285727721e-01   -1.230715448218588e-01   -6.075054265505309e-03   +1.928220774237467e-01; +2.619990976655692e-01   +2.111341924533046e-01   +4.476432277513492e-01   +2.321910460339173e-01   +1.944176701739196e-01   -1.898662252442052e-01   +4.547831301784138e-01   -3.021345516625340e-01   +3.520945930468714e-01   -2.102683079790617e-01   +2.532102866238178e-01   +9.976370009287516e-02; +2.986592937483336e-01   +1.531449710390536e-01   -1.114577230565727e-01   +2.719204229301458e-02   -6.858031504313369e-02   -2.897872283970322e-02   +6.281812570065487e-02   +1.716504671377104e-01   +1.905249224114981e-01   +2.399022551124914e-01   +3.019268011835966e-02   +1.609967826430992e-01; +1.598471438953290e-02   +1.392864762301270e-01   +1.053008010013830e-01   -1.879724539444783e-01   -6.200451728603196e-01   +3.681222090559456e-01   -3.662400861138078e-01   -6.140844058516464e-01   +1.187611687103907e-01   +1.231699100495651e-02   -2.732050235214217e-01   -1.423998142511341e-01];
L2E_L3E_iAMPA_netcon = [+1.008926833842488e-01   +1.742698284856090e-01   -2.569098723297376e-01   +4.453137214203018e-02   -1.386238430995828e-01   +7.370859049147971e-02   -5.675053549546560e-03   +3.192172323682266e-01; +2.177351717090976e-01   +5.542261292344013e-01   -1.204031047046180e-01   +4.226517402606079e-01   -2.297371818128541e-02   +2.064692414871609e-01   +2.992986205658574e-02   -5.327328580845008e-01; -7.251700909617928e-02   +2.788387429386017e-01   +6.115264866720344e-01   -1.909207674263676e-01   -1.618650396616958e-01   +2.977200631309473e-01   +2.081789490988496e-02   +4.345215355163702e-01; -1.981634814423015e-01   -1.136861965520525e-01   -6.082339565290749e-01   -9.490976270833987e-02   -2.264356579336174e-01   +4.175551724009241e-02   +2.830041847805123e-01   +2.063665948639099e-01; +6.267574977761895e-01   +2.680029986335676e-02   -2.690290951707208e-01   +3.254180852054961e-02   +4.385974305753002e-01   -2.345498842887031e-01   +4.824696634055194e-01   -5.025329682732329e-01; +7.935654632309347e-02   +7.413692281751225e-02   +5.183956476326688e-01   -2.969875837290583e-01   +1.097275961897942e-01   -7.677527795324188e-02   -3.997973138159209e-01   -1.333568749554258e-01; -8.963952721618466e-02   +2.610769003017180e-01   +2.366200586805001e-01   -2.013955866660490e-01   +2.745375578519213e-01   +1.229778225735817e-01   -8.943012815449765e-02   -1.556016584511239e-01; +1.300153979135867e-01   -7.504198313472638e-02   +3.591670626890400e-02   +7.144312091132279e-02   +4.335917486052358e-02   -4.848432324999520e-02   +2.107602729886543e-01   -4.715187332575597e-01; -5.252537403035162e-03   +3.773615106169581e-01   -2.416555878627212e-01   +1.321172371468468e-01   -2.417607966965153e-01   -3.612192452562546e-01   -5.074902343933793e-01   +2.287652673697584e-01; +1.268456324859058e-01   -2.336198295655767e-01   -1.068474048755935e-01   -1.657721917095460e-01   -5.405256549708276e-01   +3.282311332606612e-01   +1.038936079567420e-01   -2.705744472951329e-01; +3.560948469565954e-01   -3.661252831534950e-01   -4.571041383190586e-02   -1.976876195748224e-01   -2.872488561000650e-01   +5.251505888480049e-01   +7.873950488463971e-02   +4.501393397115955e-01; +1.490876484920562e-01   +6.055515780745204e-01   +5.866159879087653e-02   -6.063297799323886e-01   +5.793460432832588e-01   -1.897415247118623e-01   -2.028604340503792e-01   +2.563511698385445e-01];
L2I_L3I_iGABA_netcon = [+5.550451224665065e-01   +3.792654305376943e-01   +2.563656846201078e-01   -2.288243281979161e-01   -2.794855900278669e-01   +7.954959970329745e-03   +1.899578964704327e-01   +2.856845490450818e-01; -5.505263247919313e-01   +2.704010938124315e-01   +1.882129310800781e-01   +1.545005481816802e-01   +1.784153120205240e-01   -4.958518904449077e-02   -5.542736066800357e-01   +1.323212837636175e-01; -2.825869140377902e-01   -2.629615879577576e-01   +4.156997963591704e-01   +1.374921163129411e-01   -1.103210224828800e-01   +3.489770274004752e-01   -3.441622598999746e-01   +6.225706013234950e-02; -4.024091942824702e-01   -3.449955524969853e-01   +8.982919433255614e-02   -3.293887602036353e-01   +6.907653332054187e-02   -3.806297029698265e-01   -1.976507263573610e-01   -6.341435447987744e-01; +4.144103241065090e-01   +6.682892883068519e-01   +1.319956739417509e-02   -1.811541677996425e-01   +5.330419791158869e-01   +2.538672930593416e-01   +4.682808081438859e-02   +1.259385851782503e-01; -9.038861047097602e-02   +5.617701456839885e-02   -1.150099493434175e-01   -5.412087448324778e-01   -3.299108918400462e-01   +4.301091361057409e-01   +1.036437842060803e-02   +1.300491442644026e-01; -3.243595783917383e-01   +3.435753108021329e-01   -1.961239203969292e-01   +1.142106153909243e-02   -1.684063725953837e-01   -3.159907469651707e-02   +4.414043285057968e-01   +4.887967359650994e-01; +4.103207333034180e-01   +1.302338012731223e-01   +4.661369532822608e-02   -1.922556900156318e-01   -2.761834821160281e-01   +4.477057185259752e-01   -4.554108517022246e-02   -2.589997418932838e-01; -4.126061863872687e-01   +4.854196245261029e-01   +3.585665690946105e-01   +1.273063564821122e-01   -1.355443174116066e-01   +1.235137399115726e-01   -1.536357810633440e-01   +7.131196454195821e-01; -4.204973193646864e-01   -2.842037069048406e-01   +2.559227243132324e-01   +1.067871283945565e-01   +2.863336509888022e-03   +1.304324802402594e-01   +1.698200155405946e-01   -1.374479351084523e-01; +4.583874372265944e-01   -3.937830399926036e-02   -1.787373298175543e-02   -2.501069357916532e-01   -3.473445461420871e-01   +1.905201836028717e-01   -1.018453196291522e-01   +2.989258618074391e-01; +5.462519206606011e-01   -2.834879810913992e-01   +9.429110525528717e-02   +3.374759533183887e-01   +4.801055621601158e-03   +3.993862299384907e-02   +1.650670207875487e-01   +5.754828398603377e-02];
L3I_L3E_iAMPA_netcon = [+2.285903087374221e-01   -2.646979159185358e-01   +7.457565297637442e-02   -1.565330639144633e-01   +1.806880864880414e-01   +3.593496911408623e-01   -3.571058033981040e-01   +3.167143209960265e-01   -1.730210281553231e-01   -3.406123538205286e-02   -9.617363425425407e-04   -4.914396511139105e-02; -3.457540075526299e-01   +2.101822414603137e-01   +6.381232091941231e-01   +1.824043805385880e-01   +2.926324688367732e-03   +1.465291931057593e-01   -1.920212465890027e-01   +4.995681952692763e-02   +4.350782085949808e-01   +3.019236727794322e-01   +2.747819608493513e-01   -5.461267374313368e-02; +4.250211938156659e-01   -1.312872461448725e-01   -8.370218008217553e-02   -1.071045032775387e-01   +1.954833713725836e-01   -3.395196381445880e-01   -2.465750687015363e-01   +1.685044143865816e-01   +3.002118811375448e-01   -2.600120221867991e-01   +1.899619015138500e-01   +7.616586978728232e-02; +3.200836526083720e-01   +2.182362644647994e-01   +3.905842104997337e-01   +8.475148887068715e-02   +3.315615178361261e-01   -1.328536549879554e-01   +7.240470464285248e-03   +1.538313074509916e-01   +3.863782949095061e-01   +3.072857457522674e-02   -3.493529654719799e-01   +2.820490654673259e-01; +2.015917694420503e-01   +1.673839363329013e-01   -1.970045890192188e-01   +1.760217544632501e-01   +2.090134707629854e-01   +2.627145342718032e-01   -7.917832958173049e-02   +3.273378220858567e-01   -1.225887686606773e-01   -4.912196066892757e-02   -1.187698700327681e-01   -4.558109765146070e-01; +4.182079186843962e-01   +4.708353356526455e-01   -2.495117381771347e-01   -4.308950333374489e-02   -1.736270886372680e-01   -4.258982016115909e-01   -1.366201263888618e-01   +3.281694408996578e-01   +3.176431302069070e-01   +5.273424966473783e-01   -4.096393565883966e-02   -6.509535696494037e-02; +5.173778301311843e-01   +9.795378714819483e-02   -5.289473335119280e-02   -3.042342171916946e-01   +3.590873134175072e-01   +2.014439901684389e-01   -2.251460257537108e-01   +3.328069698576372e-01   +3.798787732072455e-02   +1.706898293670168e-01   +7.723034504815116e-02   -1.981541474257794e-01; -3.256736849523010e-01   +4.661088296870530e-01   +3.373987986211014e-01   -2.995571172028150e-01   -6.574657167100546e-02   +1.369166225524915e-01   +3.055974488031075e-01   -1.688263357704529e-01   -2.955371492843289e-01   +2.622528753115417e-01   +4.240207199215999e-01   +4.630363079569193e-01; +4.541454445535374e-02   +2.680192207053220e-01   +6.209965189155222e-01   -5.983589520165072e-03   +3.564172721672320e-01   +5.033129660446503e-01   +5.296428607826540e-01   +2.424839945318312e-01   -1.795040458450290e-01   -1.858477135867787e-01   -4.217376585763271e-01   +9.089524945027302e-02; -2.973302667548929e-01   +2.464554359168489e-02   +3.184314754862654e-01   +8.901516191351697e-02   -3.672815303628104e-01   -3.197206637809679e-01   -1.943306677117134e-01   +8.152577266084804e-02   -1.645378643765497e-01   -2.080083254593280e-01   +5.658493173715539e-01   +4.408804391250036e-01; +1.645271403027767e-01   +1.318259712158409e-01   +6.151208394353748e-02   +4.630359416734339e-01   -2.305198279227334e-01   +4.047168035585601e-01   +1.078766083133279e-01   +5.573934617899151e-04   -1.705207215492498e-01   +2.147626121987417e-01   -7.243483908293685e-02   +8.984529583866702e-02; +2.356854970614025e-01   +6.375557377775329e-01   -2.148500039265990e-01   -8.923021900110746e-02   +2.371267094832693e-01   +5.039281758226807e-02   -1.486773268725781e-01   +2.686246792930851e-01   +3.629703115179986e-01   -6.646568174108722e-02   +1.991557012292216e-01   -2.066866351032537e-03];
L3E_L3I_iGABA_netcon = [+6.205066093048739e-01   +5.784039635173864e-01   +2.679815469336048e-01   +1.620683668802618e-02   -2.945581498122701e-01   +1.796933170894227e-01   +3.721253622770825e-01   +1.286323107766057e-01   -9.362778630031143e-02   +1.375484199683527e-01   +3.998745272142595e-02   -7.552012389602300e-02; +6.124823897877387e-01   +3.698769506760990e-01   +8.464115600670997e-02   +1.023040947133365e-01   +4.118886745293232e-01   -4.711648421538855e-01   -9.701261331960634e-02   +2.061304411591640e-01   +5.679149280861535e-01   +4.355929747087651e-01   +6.301659178165475e-02   +1.515127500951716e-01; +1.530242325829142e-01   -1.369319124539974e-02   -2.027982903488760e-01   -6.878229235039097e-02   -3.503844868450370e-01   +1.080786949338271e-01   +2.942488093151684e-01   -4.333449218456049e-01   -7.340172082283872e-02   +1.467598097229025e-01   -2.960178749627581e-01   +1.110148200680565e-01; +3.824802986905470e-01   +4.970715885243242e-01   -2.655474929357796e-01   -4.931294669117177e-01   +1.691309185082294e-01   -4.928789819138951e-02   -5.009562007291783e-01   -3.018497983831033e-01   -2.166745025436478e-01   +3.144070731337770e-02   -3.221278943334051e-01   -2.705319988324992e-01; -2.773819986489699e-01   -2.833729126186233e-02   -1.064718288144955e-01   -6.556723877971948e-02   +1.807586127808619e-01   -2.005397513813995e-01   +8.270948362187341e-02   -2.955539612014993e-01   +4.235774726859484e-02   +6.228124897147330e-03   +2.603125410513653e-01   +4.931472847787988e-01; +7.853486046032497e-01   +2.832245983455899e-01   -1.220815186872207e-01   -4.309905856763265e-01   +1.655725380112210e-01   +2.635774485107140e-01   +3.053719209217664e-01   -4.773189409127065e-02   -7.899933267341885e-02   +2.959197039192761e-01   +2.464510154344612e-01   +2.725137542284559e-02; -2.385643715277461e-01   -5.822154250202050e-03   -5.698178635352243e-01   +1.195674680632094e-01   -4.050446123790818e-02   +3.308379246325068e-01   +2.004934757249143e-01   -1.768102122209196e-01   -5.437573432300304e-01   -3.446937867296432e-01   -3.252296517802378e-01   +1.991608908164934e-01; +2.800869938977004e-01   +8.355015454871659e-02   +1.075021266142971e-02   -1.658658751484823e-01   -5.374951497466138e-02   +4.329730522053410e-01   +3.129860050041683e-01   +3.834211290012728e-02   -6.979136630739942e-01   -3.682662879565956e-01   +3.551727237549994e-01   +1.213153184692811e-01; +2.790346340855587e-02   +3.368940925370744e-01   +9.162510101752157e-02   +2.827716968603097e-01   -1.236784887666598e-01   -2.249037503879914e-01   +3.171975035996594e-02   +4.840923618424341e-01   -3.648248794747697e-01   +3.572979673211075e-01   +3.277577486838942e-01   -6.834078780721402e-02; +2.664694617469191e-01   +2.172158032674926e-01   +3.271286093646623e-01   +1.062766436886514e-02   +1.185261676237584e-02   -4.151935935248985e-01   +1.760761269990831e-01   -2.321537674340322e-01   -5.674870176623883e-02   +1.560780809751554e-01   +1.639767103678724e-01   +2.084013373720867e-01; -1.933956039750255e-01   -7.156158420108583e-03   -2.299524173949730e-02   -5.229383760776812e-02   -1.913655125535332e-01   +6.207612609952473e-02   +3.297589289281442e-01   -1.101961440513040e-01   -2.142419193617957e-01   +1.617356886900683e-01   +1.273579027387739e-01   +4.067804532977920e-01; +2.617185944834431e-01   +3.309582897969608e-01   -5.491662580191656e-02   -2.880232426765745e-01   -3.851825715999334e-01   -2.485707159098781e-01   +2.669908132872208e-01   -6.896387822205763e-02   +3.299298073668050e-02   -4.413824781897955e-01   +2.921053777416021e-01   +3.036718882510505e-01];
L2E_Input1_iAMPA_netcon = [-7.937668111508686e-02   -4.398877908876589e-01   -8.875194819444089e-02   +2.597103442883731e-01   +3.837918134752052e-01   +3.654112040272864e-02   +1.365515997703261e-01   +7.055844094758043e-02];
L2I_Input2_iAMPA_netcon = [+2.602305065364039e-01   -1.721943503183907e-01   -2.364232846035892e-01   +2.545781771251203e-01   +1.714819638907566e-01   +2.037806274803851e-01   +1.524292185178711e-01   +3.194685252816020e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
