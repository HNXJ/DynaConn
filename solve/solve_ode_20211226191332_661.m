function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.555703961627362e-01   -1.492011230499240e-02   +1.225867386412758e-01   +2.066813985608497e-01   -4.697092171058294e-02   -1.487065006788704e-01   +9.781833491492245e-02   +5.376481635995795e-02   -1.675720542354160e-01   -1.419239831956894e-01   +6.560851079452191e-03   -1.645928811254310e-01   +1.191193619576508e-01   -5.513511064198460e-03   +7.785690913778950e-02   +8.445089315765041e-02; +1.800623500740749e-02   +6.508672260213055e-02   +1.752960559172178e-01   -3.196111278472201e-02   -1.751220473907893e-01   -9.027991206498348e-02   +2.787797460790652e-02   +3.020252924165445e-02   -2.680496768097989e-01   +3.253722807555699e-01   -2.891995206911026e-02   -2.485356447174246e-02   +1.140540365600690e-01   +1.400853743428674e-02   +7.844700730886785e-02   +8.002087890664809e-02; +1.756229264554459e-01   -1.464399744073275e-01   -4.671146122254351e-02   +6.673462501009454e-02   +1.197869471466334e-01   -1.230153059552811e-01   -2.864736165182724e-01   -8.322015575261901e-02   -1.745803677765456e-01   -3.815434181700293e-03   -4.611086566470201e-02   -1.963062011315713e-01   -2.473584190234968e-01   +2.269957043876930e-01   +1.967678487952101e-01   +1.693475984886192e-01; +2.179717618778254e-01   -2.362340612489084e-01   -9.473800372056153e-02   -1.222078655087127e-01   -4.259661444289192e-02   +2.562683541315257e-01   -7.252710633618381e-02   -2.653692875300894e-01   +1.554900853496212e-01   -2.660279265124214e-02   -2.389454369728227e-01   -1.199348792175933e-01   +1.448374641260924e-01   -6.335329609850000e-02   -1.387597895530374e-01   +1.255093565494567e-01; -1.206078123335707e-01   -5.782120440656241e-02   +7.908321558645140e-02   -8.297921685583300e-02   +1.244811084092615e-02   -2.082721379298079e-01   +1.048723546145553e-01   +4.029182881296185e-02   -8.992544287941658e-02   -2.410214043486197e-01   +6.868871882190246e-02   +6.653176457097178e-03   +2.223541693545958e-01   +1.212813843468203e-01   +2.281526979169504e-01   +1.052483941398955e-01; +2.919457053556507e-01   +1.697867159559844e-02   -9.010120878803296e-02   +6.897072444731654e-02   -1.338440087453115e-01   -1.587929861805170e-01   -8.471747365761557e-02   +7.863250088216528e-02   +1.611052812830364e-01   -1.067238750045664e-01   +1.868057493221800e-01   -2.307091319361244e-01   +2.060776549539747e-01   -2.846364389074321e-01   +2.118541298303455e-01   +5.605027225166974e-02; +7.911922215355500e-02   +2.726890220405178e-02   -3.107837425901886e-02   +9.169191519501563e-02   -5.919588750066376e-02   +3.932653688785123e-02   +6.357249905875897e-02   +1.473185662328524e-01   -2.595210182717818e-01   -1.725992530727299e-01   -5.504680782874335e-02   +1.122077775350616e-01   -2.018092722388725e-01   +1.949665800221806e-01   +4.825032717225660e-02   +8.150466740161293e-02; +2.419095530940641e-02   -1.396837002683713e-01   +1.996443465697683e-01   +5.227075766748771e-03   -3.338940791715302e-02   -1.966683050796909e-01   +1.758692303939478e-01   +1.450354167596318e-01   +6.702566694189660e-02   -1.650998921799084e-02   +1.835026463452400e-02   -4.011790228439767e-02   +1.602670785951394e-01   -1.444206187021715e-02   -1.200835796547442e-01   -1.219051574219814e-01; -6.536618668788212e-02   -2.003169076990862e-02   +3.118157613601799e-02   +1.362725053314551e-01   -1.189245729159392e-01   -9.635679181726466e-02   +3.688991252435778e-03   +7.107594240625711e-02   -1.401623818415202e-01   -2.154041057872782e-02   -2.778324998554647e-02   +2.288145286269540e-01   -1.664017320383942e-01   -2.013042994539521e-01   +1.733315901596271e-01   +2.153683732420832e-01; -2.180798561206894e-01   +9.832505429998666e-02   -4.210484955455648e-02   +2.089078478354030e-01   +1.175720250263152e-02   +2.725101115400476e-01   +4.172652547750199e-02   -1.853013784120016e-01   -2.242211014656167e-01   +1.245357942405253e-01   -5.802379597236793e-02   +5.512368198054389e-02   -1.685210949826198e-01   -1.109144158552509e-01   -2.737793614394502e-02   -5.537859176260879e-02; +2.045115845840893e-02   -2.062920242378793e-01   -1.203624817499136e-01   -3.492252243441061e-01   +1.528096077353782e-01   +2.023430633950160e-01   -1.850396623197528e-01   -5.626414818205145e-02   -1.897498728353202e-01   +1.674158571957569e-02   -8.708025048808245e-03   +1.119536126442272e-01   +8.446024974881779e-03   -1.045008281400370e-01   +7.381546724625895e-02   +1.535127871147755e-02; -2.167540416638928e-01   -5.861299429242763e-02   +2.158306840843930e-01   -1.881594881278909e-01   +2.781708709701816e-01   -1.754529439021068e-01   +8.353843111662076e-02   -1.624023434344729e-01   +5.388874393135280e-02   +2.545524028742392e-01   +1.041531512906675e-01   -5.713844832103277e-02   +1.816543744537080e-02   +1.581487976008353e-01   -3.720434726975821e-02   +1.133476141327991e-01; +3.236699468010005e-01   -1.087794170572867e-01   +2.143206496691944e-01   -1.238353882229553e-01   +8.681723143735523e-02   +1.490620293680658e-01   +4.832099269072918e-02   +7.031048260696833e-02   -3.271065819483653e-01   -1.907846736749962e-01   +2.928828908394732e-01   -1.697217169557052e-01   -2.609237962976883e-02   -1.453323127284959e-01   +1.350926715024595e-01   +2.656604180981920e-01; +7.799532970285865e-02   +2.633755390820064e-02   -2.321842851448504e-02   +1.592835606064834e-01   +1.282887731043813e-01   +7.354424992001461e-02   -1.015120728792855e-01   +6.100683795662688e-02   +9.520424693398213e-02   -1.320779494582101e-01   -3.243375865654408e-02   -5.561325368810396e-02   -2.210207247546434e-01   +3.110390847879347e-02   +2.061439670312024e-02   -8.503106461294303e-02; -6.544704100908670e-02   +1.100201438007293e-02   -1.237257246974975e-03   -1.585053855795721e-01   +1.341742165642475e-01   -8.832851817089676e-02   +7.953266281609699e-02   +1.221917885636652e-01   +5.199477786608656e-02   -8.882962553414077e-02   -4.140600893214933e-02   +3.852368941973973e-04   -5.819635473684224e-02   +2.744884232281341e-01   -1.901223910604475e-01   +7.714955817855525e-02; +1.328570560244874e-01   +8.659831739654775e-02   +8.411935988722970e-02   +6.828154376129761e-02   -1.964665782319753e-01   -1.188221471685305e-02   -1.533913617964391e-01   +1.688437825590768e-01   -2.265926259364494e-01   -1.395379671119322e-01   -1.270630020591791e-01   +4.723766890468017e-02   +7.983078740502181e-02   -8.671874121970571e-02   +7.116596803578656e-03   +1.247804703925502e-01];
L1E_L1I_iGABA_netcon = [-1.756917703883172e-01   -2.007262959414221e-01   +3.103776465633831e-02   +6.405130335727731e-02   -1.034681350538987e-01   +5.368570483661828e-02   +1.950580058551947e-01   +8.430298297074428e-02   -2.139091002223457e-02   +3.411312965508843e-02   -1.808893453284607e-01   +2.092250021489946e-01   -2.018009750765665e-01   +2.395608297065239e-01   +1.525031815545013e-01   -6.488069014254950e-02; +6.386830186413868e-02   -2.240506447116454e-02   -2.064550846389233e-01   -2.266521016563813e-02   +1.252033221465823e-01   +1.767207801127191e-02   -2.519407612399218e-01   +1.555330071316751e-01   -1.117028130673162e-01   -2.316234254260116e-01   -1.706357940842045e-02   +2.881506313149417e-01   +2.500478482636751e-02   -2.789735074437545e-02   -8.243602323078283e-02   -7.031834723318306e-02; -1.292191120410096e-01   -5.554923311822652e-02   +8.759506250252720e-02   +5.991842814853671e-02   -1.072984971701826e-01   +1.348843570162727e-02   +4.190959829316966e-02   -1.470532334880156e-01   -1.863052497286693e-01   -2.734580218977065e-01   +7.864928334693239e-02   +4.410366921778663e-02   -1.021512382346548e-01   -6.469714295165477e-02   -1.313522131567962e-01   +2.690912642188860e-01; +1.181202668565921e-01   -5.723616246009975e-02   -5.137428924208020e-02   +1.309207302207402e-02   +4.329165252370473e-02   -2.155809635221132e-01   -1.312739524101428e-02   -1.413016121475713e-01   -1.247253271448592e-01   +1.084615350340034e-01   -2.586868664492369e-01   +1.368950073852841e-02   -8.012422363605641e-02   -1.769378323005602e-01   -1.704398418481510e-02   +1.268028927504544e-02; +2.589067717617010e-02   +1.838513786096753e-01   -1.136672125600983e-02   +1.191902732439549e-01   +1.819350763121685e-01   +2.353005757065263e-02   -2.388539188888868e-01   +4.023275683440430e-02   +8.012091168027533e-02   -1.414961994329254e-01   +3.627252075025696e-02   -2.455569209905337e-01   -1.324730666383786e-01   -1.982230280770904e-01   -1.492122449821268e-01   +2.711995426807117e-01; +7.129000708837259e-02   -7.225378392784688e-02   -1.502058830386209e-02   +7.095650331366214e-02   +8.808651122816372e-03   +6.419409704886689e-02   -3.749519955285789e-02   -7.480049100463027e-02   +1.142135886770990e-01   +6.843733434197569e-02   -2.005151730504905e-01   -9.253766934384129e-02   +1.816775969274764e-01   +1.692115625740001e-02   +8.135477601369448e-02   -5.987791790713938e-02; -2.065584992034087e-02   +2.579243281998023e-02   +1.699061531156201e-02   -3.302834274679401e-01   -1.590508795266267e-01   +1.911429097783948e-01   -4.259831679153601e-02   +8.255602244183344e-02   +1.443542635283825e-01   -9.501806019571785e-02   +1.935566337941694e-01   -8.539002302984040e-02   -2.097965123347336e-01   +1.245660622469845e-01   -7.047858083308185e-02   -4.957106833568403e-02; +2.736441182009596e-02   -1.071921364426654e-01   -5.015966792334552e-02   +1.437736093098368e-01   +5.246057352537708e-02   +1.186946324210491e-01   -1.215089716804774e-01   +1.808696521209576e-03   +3.543136154286960e-02   +1.182064565980459e-01   +2.705831503273031e-01   +1.049572823099851e-01   -2.012520107032498e-02   +1.989344847519445e-01   -3.778214001899926e-01   +2.104222963508606e-01; -7.313679820535018e-02   +1.570563042777285e-01   +3.531959160246415e-02   +1.533208595208128e-01   -5.961830183639617e-02   -1.898611860765744e-01   -1.332226065036516e-01   -1.909903224226394e-01   +2.031997920923848e-01   -2.195435931134541e-01   -1.236276996722853e-01   +9.085267428461816e-02   +2.444239500430694e-01   +1.777474155172673e-01   +3.605224480506383e-02   +1.358704043418120e-01; +1.039566347901562e-01   +3.106614851028466e-02   -4.096762844760569e-01   +3.980674231540547e-02   -2.880615597910097e-01   +2.032104641112414e-01   -1.784585770178885e-01   +1.279772128056013e-01   -1.059602586942429e-01   -1.355440150406576e-02   -4.020609515831086e-01   -5.765254759470618e-03   -8.381899916625195e-02   -1.037183892479779e-01   +1.015673753816275e-02   +5.868493315200322e-02; -1.836779348315466e-01   +2.254162914559718e-01   -5.741794765686589e-02   -4.750207866789281e-02   +3.784382407210330e-02   -1.582424930725361e-01   -1.334243048016072e-01   +9.814226450575170e-02   -7.008826671132075e-02   +5.649369989357884e-02   +8.467725860060112e-03   +1.750008553850287e-02   -8.929835010609986e-02   -3.487831335580022e-03   +2.224930751424985e-01   -1.366693503867302e-01; +9.141899980258918e-02   -1.499177480305560e-01   +4.622042572808316e-02   -2.272552787130499e-01   -1.584309137444714e-01   +4.590613716335790e-02   +1.590877533517069e-01   -1.752830051238523e-01   +3.737773696341466e-02   +4.346695985486342e-02   +1.555180058399740e-01   +9.662781219654167e-02   -1.402534361084344e-02   +1.264011578629383e-01   -2.342544599461987e-01   -2.585352816138041e-02; +9.569412558449723e-02   +7.571321539020372e-03   +1.519658952219493e-01   +1.888908328378273e-01   +2.189614759815979e-02   +1.136110958171607e-01   +2.710666903371076e-01   +6.446410770332350e-02   +7.302129926235180e-02   -1.301766739041914e-02   -2.341174533984963e-02   -5.021839210008329e-02   +2.570054403680565e-02   -2.485167753062214e-01   -1.353871612334190e-02   -1.379230387817116e-02; -1.018324908237034e-03   -2.896564847625028e-01   +1.335628176339112e-01   +3.349202429099681e-02   -3.240545322765656e-02   +2.646858463595558e-01   +2.659929922532179e-01   +1.883043851198039e-01   -3.905929278372094e-02   +6.122763102627655e-02   -5.117333358841167e-02   +1.134298150333626e-01   -3.215211164725543e-02   +1.935696752089405e-01   -1.248251786812936e-01   +2.440763384738549e-01; -1.829660388822555e-01   +9.377085299965024e-02   +2.005247877757237e-01   -1.791349454112814e-04   -1.773272105314211e-01   +1.875966234854650e-02   +2.256779596025300e-01   -1.636757936846081e-01   +3.240978788669153e-01   +1.222840303637449e-01   -2.028466667791667e-01   -3.492349895018766e-01   +3.013538548923370e-02   +1.398891623695767e-01   +1.142456106954271e-01   -2.553174042531400e-02; +2.303537245094836e-01   +1.429464345962486e-01   +3.061053089764336e-01   -4.133269310147735e-02   +2.671749318821481e-01   +7.774795410087924e-02   +1.886175041088262e-01   -9.039913172579356e-02   +1.699023219370827e-01   -1.218038185375129e-02   -1.778331386442439e-02   -5.635928896294615e-02   +8.466111649192773e-02   -1.941136184965559e-02   +1.241567551745047e-01   -7.882314856344294e-02];
L2I_L1I_iGABA_netcon = [+5.022673725831875e-02   +2.772005100886121e-01   +1.897358996359122e-01   +4.307281261225599e-02   +1.072744889159786e-01   +9.401400456315781e-02   -2.114034851466064e-01   -1.633296883604068e-01; -2.256544399920724e-03   +6.596134041338364e-02   -6.838233745166479e-02   +1.228212195263516e-01   -2.045802578124085e-01   -7.797284475421452e-03   +2.476546257412454e-01   -1.560946116569794e-01; -2.329543314696695e-02   -8.735297523791209e-02   +1.042499074029472e-01   -1.687087439451494e-01   +2.613580012494848e-01   -3.479413180345102e-02   +1.812676299430646e-01   +1.150874602522135e-01; +8.938972801030463e-02   +7.633694214548419e-02   -7.841709303961505e-02   -1.590771295282454e-01   +1.572112619190170e-01   -3.979140620511645e-02   -1.297006836932401e-02   -1.713724584803969e-01; -2.530057701744192e-01   -1.411801190632777e-01   -7.777914835083194e-02   -2.840557857191233e-02   +1.795028156139223e-01   +2.027110536135719e-01   +4.238375099885300e-02   -1.052651848739299e-01; +7.258001246998717e-02   +1.244147796920019e-01   -1.134691548975966e-01   +3.984607895425162e-02   +1.124652730355653e-01   +2.436310786374663e-01   -1.530719253551867e-01   +1.333910772321869e-01; -6.381118542839909e-02   -1.892623328303564e-01   -5.498813673192145e-02   +5.298590772944771e-03   -1.781568521942819e-01   -1.266489579908895e-01   -1.063879013001285e-01   +1.253810079107025e-02; +1.385380270766901e-01   +1.313544566043902e-01   -1.036786183197802e-01   +1.652304957182746e-01   +1.504687577373369e-01   +1.472031042549832e-01   +1.299630624634598e-01   -2.588091536856672e-02; -1.286338944660680e-01   -2.453163257086592e-01   -8.952752979178724e-02   -8.479531466809480e-03   +1.351970801473481e-01   +9.094400047172452e-02   +2.699564058871764e-02   +2.149044639710717e-01; +1.857551347255310e-01   +2.792088857315084e-01   -6.635977844076747e-02   +7.971186887883480e-02   -2.035627221036671e-01   -9.669697283031101e-02   -1.577442421955631e-01   -1.595176075463993e-01; +3.214822544623687e-01   -3.094104047571664e-01   +2.647714059349931e-02   -5.556366646316670e-02   -1.704964493753858e-01   -1.678812095074778e-01   +2.286791409474303e-02   +3.293796291336556e-02; +4.070850778123487e-02   +7.202752301137226e-02   +8.468621969861501e-02   +2.370457599547161e-01   +3.332520563365868e-02   -6.920242401300851e-02   +3.936536731205616e-02   +1.004022954526353e-01; +2.184986096326243e-02   +9.468019837854330e-02   -8.536708797547667e-02   +1.190988954645376e-01   +1.254163363474118e-01   -2.485374280657920e-01   +1.960599187211073e-01   -1.887129995915238e-01; -1.254312172568640e-01   +7.400379351163881e-02   -2.114307481566479e-01   +8.343216391728568e-02   +1.771101944790661e-01   +1.463451350745144e-01   -4.342682695641338e-02   -7.167258437663768e-02; -3.348616184195603e-02   -1.656077754415010e-02   +1.114851356515986e-03   +1.135993085492409e-02   -2.729736242557496e-01   -7.928060482006949e-03   -1.176080516191521e-01   -1.602213528164103e-01; +2.539532155068714e-01   +1.435175977157560e-01   -8.018964512426853e-02   -5.677144822034375e-02   -3.737143595192667e-02   +1.449446111186920e-01   -2.546480750135932e-02   +1.127305238259021e-02];
L1I_L2I_iGABA_netcon = [-1.666079384609831e-02   -1.653940045402371e-02   -3.342644690937170e-02   -7.550850578165347e-02   -1.649457406769495e-01   -4.211077292060945e-02   -1.665660091237124e-01   +1.044915420073873e-01   +2.503921153246659e-01   +1.449949166376160e-01   +1.383424793984634e-01   +1.710563024779653e-01   +1.815573561815514e-01   +6.551954095951756e-03   +6.355101063791314e-02   +7.255084045083659e-03; +8.054093159252121e-02   -8.478182388319003e-02   -1.599117607243082e-01   -2.494228357935412e-02   +8.089192831961781e-02   +4.844433821944336e-02   -4.143498060791297e-02   +2.259516812883706e-01   +1.274155238134124e-02   -6.365608231568259e-02   +7.068063707835856e-02   +7.342736209049615e-02   +1.099493848534528e-01   +5.589052631776205e-02   -1.066649766255705e-02   +6.996053823995327e-02; -8.617030733158916e-02   -1.448355713393629e-01   -4.559236842698359e-02   +1.048501000487515e-01   +9.760297898411825e-02   +1.747467638052128e-01   -2.878841196726035e-01   -3.917810609849137e-02   +1.576749186614126e-01   -1.241326178848354e-01   -1.210398031500743e-01   +2.310262481432225e-01   -3.164672339023904e-02   -7.243721966562026e-02   +1.347568665544549e-01   +9.272867847443272e-02; -3.534944324677365e-02   +1.583820115182570e-01   +2.072798349491407e-02   +2.993120340819238e-01   +1.304858380672869e-01   -8.985016650379962e-02   +1.257826249816086e-01   +1.517181296056207e-01   -1.666173932730233e-02   -4.586146283677189e-02   +1.399709383342461e-01   -2.184294928198613e-01   -1.112020486869533e-02   +1.615869309490449e-02   -7.972993630924380e-02   +4.113734967217819e-03; -2.250915467144464e-01   -4.593628795909441e-02   -5.536021644444045e-02   -2.575477984479622e-01   -2.505927667772340e-01   -4.386845598853538e-02   -1.689350586098110e-01   +9.579670309367655e-02   +4.100585557516977e-02   -1.056761646974849e-01   -1.878737744978447e-01   +5.671304068462422e-02   -1.484800218868419e-01   +1.087731637742098e-01   +1.961248540364568e-01   -4.399137331791484e-02; -2.225679205387901e-02   +1.480921257276692e-01   +7.912765108286120e-02   +1.288340505539278e-01   +2.363804118875702e-01   -1.803637930364520e-01   -5.372838492049479e-02   +1.139815228706591e-01   +2.335638554743263e-01   -1.665154503140708e-01   -5.203146682081323e-02   +1.939264628100329e-01   -1.049898382903823e-01   -9.064490270175951e-03   +4.223940781521528e-02   +2.524909028542215e-02; +1.807294193786072e-01   -3.158156984035784e-01   +2.633698664821930e-02   +1.671491171532048e-01   +4.299331900493623e-02   +1.527758416275058e-01   +6.322500438844995e-02   -1.074523383595394e-01   -7.141847991655589e-02   +2.115685531410220e-02   +2.784339792336671e-01   +2.344692346892801e-01   -9.278707010606312e-02   +1.738303384345377e-01   -8.878292873465882e-02   -3.040141692362077e-03; +1.537965554107283e-01   -2.954599278511768e-01   +1.221804397979080e-01   -3.732197501222925e-02   +3.680801910270393e-02   -2.141870902089143e-01   +1.419343494877701e-01   -1.382773168290276e-01   -2.062965122155842e-02   +8.156581133876864e-02   -8.324124901966858e-02   +1.128227181855465e-01   +1.121077445911307e-01   -2.203067298190680e-01   -1.877922977756870e-01   -5.050818211869440e-02];
L2E_L1E_iAMPA_netcon = [-1.538052104867235e-01   +4.405275669279283e-02   -1.816324045544862e-01   -7.351674860138926e-02   -9.478052816751324e-02   -1.026822807249058e-02   +1.132475020961327e-02   -1.274775360842006e-01; +1.080528051757180e-01   +1.218226584192593e-01   +7.957521619582898e-02   +1.210559107392468e-01   -6.690376746198665e-02   +4.244495174849887e-02   -2.732203926202156e-01   -1.680499200947166e-01; +1.419060561642450e-01   +1.468193995006783e-01   -3.067097613519884e-01   +5.317013137268194e-02   +7.495134857810053e-02   -1.861695577545303e-01   -1.800293141137362e-01   -2.690354023297749e-02; +2.246794616579940e-01   +4.225881177591949e-03   +1.601865311758174e-01   -6.575706135398725e-02   +7.102855657403803e-02   -1.115965614607559e-02   -1.013695996965453e-01   +2.071453265382482e-01; +2.116766914299300e-01   +4.691934683048811e-02   -1.140537675974349e-02   +1.871217215148643e-02   +7.635591701280939e-02   -1.174933423950071e-01   -2.029067679924470e-02   +7.216840522245549e-02; +5.927812515410881e-02   -1.876112745319007e-01   +2.248375938985369e-02   -1.310781571273897e-01   +1.461103175735565e-01   +1.987847494438117e-01   +1.791564062022055e-01   -3.073319076719445e-02; +1.696277651715123e-01   -8.329945199242444e-02   -2.207547312541577e-02   +1.756149622272504e-02   +2.789496636665676e-01   +1.608129844462013e-01   -7.438080959899199e-02   -2.811884693459290e-01; +1.544929999520920e-01   +1.375470874720819e-01   +2.055046219894887e-01   -8.699721591111201e-02   -3.182856578931166e-03   +1.299003385206436e-01   -4.508867705249030e-02   -1.640775766623981e-01; +1.061733711558255e-01   -2.848185676808049e-02   +3.533182175173011e-02   +1.168846067115805e-02   +1.301526017907368e-01   -1.217746407880806e-02   +4.332124548256673e-02   +4.861977279094024e-02; +2.986070386937498e-02   +1.792583731283359e-01   +4.820421831273024e-02   +1.688334495207712e-01   -1.346767952465106e-01   +4.773233329732540e-02   +5.804632812816915e-02   -2.979967133870277e-02; +1.839412495495243e-01   +1.486823744912941e-01   -2.619710875301889e-01   -4.538711262020788e-02   +1.008134866198763e-01   +3.160657719198804e-01   -4.202836336791737e-02   +2.298029541973841e-01; +1.851767147285634e-01   -5.825547808088794e-03   -6.563408259438459e-02   -1.330244625449523e-01   +8.599047586301123e-02   +2.698255665430209e-01   -1.049644730264284e-02   +6.981042334799685e-02; +9.204190979259748e-02   +4.059328791405119e-02   -1.065028866382953e-01   -4.986439824357947e-02   +1.948532814235990e-01   -9.873460061872008e-02   +4.113215108910178e-02   -2.260848044460260e-02; -7.014825049591684e-02   -3.311466226813686e-01   -3.344231197136441e-02   -2.584222556475492e-01   -2.364885405022203e-01   -1.471521532842359e-02   -1.304557356095294e-01   -8.083848428453734e-02; -1.590238163714846e-01   +1.253849442506598e-01   +3.757781008425835e-02   -2.176743399960432e-01   -3.186091111023469e-02   -1.786491726752181e-02   +9.058282853916258e-03   -1.310749615301989e-01; -2.804550484943694e-01   +1.189882558732987e-01   -4.092031463373209e-02   -1.008991448194926e-01   -2.324524074307543e-01   +5.288473065642359e-02   +8.186822353499623e-02   -1.213413147700286e-01];
L1E_L2E_iAMPA_netcon = [+7.751041524526951e-02   +5.720978809485136e-02   -1.679318525245122e-01   -1.724562751794377e-01   -1.701811742199785e-01   -3.843089858339496e-02   +4.281124775364890e-02   +1.082977722908243e-01   +5.653942126760033e-02   +1.176046493882173e-01   -1.208052965897550e-01   -2.489385782632594e-02   +1.643807600685674e-01   +1.789308657346164e-01   +1.583314460399272e-01   -3.618848403480353e-02; -3.906997699302067e-02   +1.742505808728139e-02   -1.484375032727776e-01   +2.189283691083941e-01   +1.710075381215235e-01   -1.818536244137413e-02   -1.376019798334443e-01   -2.015532021847098e-01   +6.211094526967740e-02   +4.703999165827844e-02   -2.263653302920913e-02   +2.303155244988778e-01   +1.741576089022624e-01   -1.155507272769127e-01   -1.529299769769809e-02   +1.341105799993647e-01; -4.256342881714408e-02   +5.666755981147500e-02   +1.059920063939683e-01   -6.713813020238775e-02   -5.881151659809608e-02   -1.575104829773348e-01   +2.398564528134254e-02   +4.972858025717596e-02   -9.494060463203000e-02   -3.819998784682420e-02   -7.201430065456078e-03   -4.254076909745664e-02   -1.830537195098981e-01   +3.118167249580588e-02   +2.513381835694095e-01   -8.364057762377269e-02; -5.320843436334920e-02   -3.529489784331283e-02   +1.881148109475630e-01   -1.755101588224694e-01   -1.386749280262360e-01   -1.636448406785252e-02   +2.194582853698459e-01   -8.727934948181909e-02   -1.197940849592075e-01   +3.535443621583280e-02   -1.694627163168914e-01   +2.181962472607773e-01   -1.024404612511048e-01   +1.712189949421971e-01   +1.134936169180084e-01   -1.237800801078539e-01; +4.761253649227763e-02   -1.327690547557155e-01   +7.231915314301857e-02   +1.391237775936783e-01   +4.153269154332810e-03   +1.541730638835104e-01   +1.340996356525493e-02   +2.849714724588908e-01   -1.298650577470156e-01   +1.146912956063591e-01   +1.490649751483034e-01   +1.983037461613838e-01   +4.805546807685494e-03   -9.429252389914441e-02   +8.800677070188118e-02   +2.848872359344747e-01; -2.019133802030365e-01   +8.788826171543494e-02   +8.685082826285000e-02   -6.813748279615518e-02   -2.395382038486601e-01   -2.044125211716492e-01   +2.447486875779817e-01   +4.828343232802804e-02   -1.140965571689907e-01   +3.170335795319000e-01   +1.454778431484510e-01   +1.831500492241530e-01   +1.598263858205117e-01   -1.362047108883299e-01   +9.926002872719486e-02   -3.263215566742145e-02; -1.481766724740456e-01   -3.114759166100274e-01   -1.654957658650026e-01   -2.342528048878426e-01   +1.590846154838396e-01   -1.815076596672306e-01   -1.654347119217409e-03   +8.783476470218773e-02   +2.425653293888596e-02   -1.175579006791804e-01   +1.476302444799541e-01   -4.717717730420675e-02   -5.203525259287006e-02   -2.706279706101612e-03   -1.496095949624125e-01   +1.186056244818039e-01; +2.815426346751761e-02   -1.266698132430916e-01   -6.646376161601955e-02   +3.724543842126245e-02   +2.394234596139283e-02   +1.267174396137289e-01   -1.100515278018196e-01   +2.060597044585500e-01   +5.516039330542276e-02   +1.930228646786041e-01   +1.898828843574157e-01   +6.987326491752981e-02   +7.065326054513846e-02   -1.100931836975912e-01   +5.721131850293706e-03   -1.424964575489573e-01];
L2I_L2E_iAMPA_netcon = [+3.255833965581525e-01   -9.018960993394082e-02   +1.482546453307706e-01   -6.750517999502829e-02   +1.415243689731362e-01   +5.243168352063075e-03   -1.635433326875632e-02   +3.440541151162036e-02; -2.561592550203491e-01   +2.646214994703647e-01   +5.034309034212390e-02   -6.296705550580539e-02   +1.428531234312830e-01   +2.103031563078014e-01   +1.420043739017575e-01   +2.287354995483766e-01; +3.295575384154382e-01   +4.833703426984666e-02   -3.419982352579181e-01   +4.633534462286903e-02   +1.090623171974700e-01   +1.112656065351116e-01   -9.446784468293479e-02   -4.860448363826925e-02; +1.026105625609374e-02   +7.801427851158793e-02   -2.515643983624418e-01   -6.367737972658515e-02   -1.259933254752283e-01   +1.663062610578858e-01   -6.607452749599051e-02   +1.802144141509225e-01; -2.874117625397212e-01   -2.087910886707543e-01   -1.768038200619593e-02   +1.639070144097728e-01   +1.220820924554552e-01   -2.086674079394802e-01   -1.258864990858296e-01   -1.139515434800976e-01; -7.130845364571911e-02   -2.426376014231749e-02   +1.194824215406313e-01   +1.091217133520883e-02   +6.600750315865660e-02   -3.092149093197680e-02   +1.972885134520132e-01   -3.312562345661302e-01; -3.386847002412342e-01   -1.695596068212385e-01   -1.043232239657414e-01   -1.508126847759158e-01   +5.077160728864964e-02   +6.494660120645072e-02   -1.844075093546084e-01   -2.725357425101001e-02; -1.763511069598004e-01   -2.590980622526506e-01   -7.084794923969354e-02   +2.163854252884587e-01   +1.445781278616416e-01   -1.436428315500039e-01   -2.630473582459060e-01   +2.457680270680958e-01];
L2E_L2I_iGABA_netcon = [-1.631561425609503e-01   -1.476965451264383e-01   +1.277024577295057e-02   +1.738111722839379e-01   +3.489309482924320e-02   -2.046145762326059e-01   +1.264551746799897e-01   -2.776653362927158e-02; +1.900692013610547e-01   +1.527862443587747e-01   +1.659228878603076e-02   +8.690504527745427e-02   -1.149430697048595e-02   +8.140990943583822e-02   +1.179898027215373e-01   -3.015644406204786e-02; +1.078897145328412e-01   -9.815921239355925e-02   +5.596729070135469e-02   +1.296700832782642e-01   -2.931853980253914e-02   -4.483766473223611e-02   -1.914366160429581e-01   -1.657907864224233e-01; -1.477373996411650e-01   +1.520421693933055e-02   -1.976695406679514e-01   -2.035911558639438e-01   -1.982189060717671e-01   +1.362873982218193e-01   -2.563487605687041e-01   +7.274651338642339e-02; -9.433077557946744e-02   +4.702956390378369e-02   +1.871872479166677e-01   -1.760246326232782e-01   +5.700154976073766e-02   +1.087335651039525e-01   +5.202668229559874e-02   +2.071448864411748e-01; -1.364939013533531e-01   -1.663006045894752e-01   +2.470675146984238e-01   -1.145534237040954e-01   +1.117785297091731e-01   +1.193191324642172e-02   -1.757968822387733e-01   -5.375931042174960e-02; -2.071930302906127e-01   +1.028215998165163e-01   +2.674655209398899e-01   -1.992120284165897e-01   +1.702426440473293e-01   -2.474950621102253e-01   -5.777255688869638e-02   -1.447478738222208e-01; +2.277524641989731e-01   +1.196740207733363e-01   +1.134184582446891e-01   +8.433067110771963e-02   -9.893677058905391e-03   +1.495837497273950e-01   +2.144160239891961e-02   -8.985076288608566e-03];
L3E_L2E_iAMPA_netcon = [+1.856718590274757e-02   -9.640970341707671e-02   +2.037452682231409e-01   +2.089989952854892e-01   -3.941247046970793e-02   -1.401463363900957e-01   -1.798355008877418e-01   +1.588833969132751e-01   +1.627980695674853e-01   -1.470992745125501e-01   +1.347100595442511e-01   -1.021339227393311e-01; +1.542962007896397e-01   -5.595584853068272e-02   +4.996300693104960e-02   -4.585058777758117e-02   -7.375040722645518e-02   +1.470654516471254e-01   -1.852373163265700e-01   -7.549338564604073e-02   -9.088884871265782e-02   -1.213477686792365e-02   +2.129515019441153e-02   +1.171326125374078e-01; -2.259477107127840e-01   +9.560413201338175e-02   +2.574372304262731e-01   +2.200850465749536e-01   +1.359807028757265e-01   +1.742017239867676e-01   +3.080828610228609e-01   -7.619299084516327e-02   -1.861846287846496e-01   -5.081643034023199e-02   +1.391046865772307e-01   -2.394867214653093e-02; +2.391070086394049e-01   -1.736720154845793e-01   -2.146164381895389e-01   -3.156043199787642e-02   +9.003222435634098e-02   +1.084978669985874e-02   -1.850349277820131e-02   -4.010013548604924e-02   +7.156527150835801e-02   -2.442066257026602e-02   -3.422948786996929e-02   +1.641832526794835e-01; -6.047858281563800e-02   +2.219492240280553e-01   +8.881114924007857e-03   +2.431959866094555e-01   -5.214356178627511e-02   +1.611852888423103e-02   +6.714418718617728e-02   +1.706520864425666e-01   +2.164644726267772e-01   +9.870483427889903e-02   +1.454628067503240e-01   +1.377837296116942e-01; -1.033960387466449e-01   -1.115130506100974e-01   +1.508024845146659e-01   +2.160320933243152e-01   +3.475971523620596e-01   +6.486609372484286e-03   +5.465375625039496e-02   -9.578624966128488e-02   -2.497569726313239e-02   -5.834157263740346e-02   -6.698311546228741e-02   -5.458576115748847e-02; +8.260365640960365e-02   -1.533955709067173e-01   +8.064227394878912e-02   -1.719521971742162e-01   -1.040283985917491e-01   +3.640448449413467e-02   -1.301669707872009e-01   +4.500106654916692e-02   -1.300914170346001e-02   -8.524747184459161e-02   -8.281737653866736e-02   +9.010841344373280e-02; -2.909100918849324e-02   +1.446341503037199e-01   -7.540513281396895e-02   -2.481804996783667e-01   +1.284315924930925e-01   -3.169172634841594e-01   -1.165338374024661e-02   +2.039276117015486e-01   +9.035140212412038e-02   +1.528286641648851e-01   -7.872818718794770e-02   -4.253640674126334e-03];
L3I_L2I_iGABA_netcon = [+2.210563634573740e-01   -2.551923946310850e-01   +2.618319339539970e-01   -1.183493472373459e-01   -6.122369521898455e-02   +5.630786092706877e-02   +1.822882846541100e-01   -8.616240326330349e-02   -1.571383620875898e-01   -2.246401656442598e-02   +2.898222941542634e-01   +6.156251251828439e-02; +1.536565489985771e-01   -2.910255609210376e-01   -6.578891699377448e-03   -3.755306292433368e-02   +4.365841873014757e-02   -6.052263367981579e-02   +1.574797176733689e-01   -8.294398443156101e-02   +1.918889498592846e-01   -2.310221213221375e-01   -1.324828144716066e-01   +2.252674158296308e-01; +7.206103695996749e-02   -2.478037292697341e-01   +2.632803512021512e-01   +1.395564986117212e-01   +1.749592572885165e-01   +1.232194765076105e-01   -1.213923831826572e-01   -3.107057551657672e-02   +3.135616288748979e-01   -2.642289082472938e-01   -6.291942162101920e-02   +9.076661003057580e-02; -1.072856191795092e-01   +6.685323055921104e-02   -5.072158821302550e-02   -3.509568123975146e-01   +2.862132022993179e-01   +2.052511625809156e-01   -3.088594579732050e-01   +1.617936736456734e-01   -1.118238899969827e-01   -9.731109351820165e-03   -1.934677939130050e-01   -2.400026733626958e-01; -1.031798274502824e-01   -1.197656862076818e-01   -1.431067276007447e-01   -2.354115114077885e-01   -4.514793101066483e-02   +2.388014264728471e-02   +1.122471391172840e-01   +8.028588455908385e-02   -1.041180438908090e-01   -5.329281936677108e-02   +1.397899929469498e-02   -3.078436754534936e-02; -6.588758286558982e-02   -1.473946155494850e-01   -1.822723382171310e-01   +1.627980190066932e-01   -1.569142744836046e-01   -2.662581741220530e-01   +1.859971751064246e-01   +2.144213145168976e-01   -1.629553650045227e-02   +4.030529159585952e-02   -4.491118677222863e-02   -7.118899361649424e-03; +1.029344181054453e-01   +1.027549715141629e-02   +7.867494111894949e-02   -2.195982260090967e-02   +1.620153336638942e-01   +2.629931292524063e-03   -5.493151017628319e-03   -7.894928575589720e-02   -2.753159244077949e-02   +2.504545955488924e-01   -1.410369583223300e-01   -2.825208513369752e-01; -2.578435783243835e-01   +1.454007249710633e-01   +1.102892862221774e-01   -7.501193461949412e-03   -3.609849743790462e-02   -1.120138090134128e-01   -1.608094290265400e-02   +7.638047214012674e-03   +4.928695042674256e-02   +1.248418251077282e-01   -3.536752331028120e-02   +8.325612926101017e-02];
L2E_L3E_iAMPA_netcon = [-1.591146098587708e-01   -1.556405297191112e-01   -1.677977457177655e-01   +1.321097808899284e-01   +1.140567338285543e-01   +1.576919218046563e-01   +1.348004367231568e-02   -6.544364142499853e-02; -7.959139636054836e-02   -6.052147850019184e-02   -1.395872674278400e-01   +7.663519469115648e-02   -1.522483205537307e-02   -2.423913720601653e-01   +1.658954846284515e-02   +3.647170066184252e-02; +2.813912934546463e-01   +5.040687208840765e-02   +7.485507088368983e-03   +1.844800550292333e-02   +1.395438654276027e-01   -2.872639891261564e-01   -1.110030900318870e-01   +1.696315268552629e-01; -1.280131559391408e-01   -1.294990421057829e-02   +1.464824602680385e-01   +1.597207786871857e-01   +2.067692849926122e-01   -2.111956855374809e-01   -1.289885720433390e-02   +2.039384228026652e-01; +1.076688037051448e-01   -1.017059623598367e-01   +1.913097177969043e-01   +1.959427036126730e-01   -1.149385532886206e-01   -3.463243573881387e-02   +1.556134024308198e-01   +2.030858824238684e-01; -1.243099444563829e-01   +7.148494580569109e-02   +2.776128317168369e-02   -3.027004598701951e-01   +1.484511342611681e-01   -7.458757743322809e-02   +2.175484951938939e-03   +7.885778002919230e-02; -4.015211591182100e-02   -3.312851312043451e-02   -1.187678839158611e-01   +6.566178215283348e-02   -2.508366515181562e-02   +2.416208457687750e-01   -1.021506322015406e-01   -2.424108399460527e-01; +3.940193771600077e-02   -3.752175748861895e-01   -1.224114302531724e-02   -1.364467939134268e-01   -3.462481925534366e-02   -9.343096437022150e-03   +2.240453921239609e-02   +8.772656627742623e-02; +1.209722448648355e-01   -3.077912085213869e-02   -9.416404385126921e-02   +3.596200849711915e-02   +3.973728863148560e-01   +4.477113166564448e-02   +2.258923648980660e-01   +9.229547879395342e-02; -1.993971744024748e-01   -1.775346500412467e-01   +4.026940870123961e-02   +2.081510427659770e-01   +1.324415271504531e-01   +1.808259433787967e-01   +1.104800834618867e-01   +6.532365115818779e-03; -2.376442360548228e-01   -1.571145852625267e-01   -1.508657678000592e-01   +2.033881717653532e-03   -9.950547156417366e-02   +1.419138598399650e-01   +9.011447755225326e-02   -3.185834557905483e-02; -3.655019269934554e-02   +1.252554412462516e-01   -9.562193752831792e-03   -1.266209615314558e-01   +6.461919982773354e-03   -4.413125548433210e-02   -9.124705415323994e-02   +1.052618553001908e-01];
L2I_L3I_iGABA_netcon = [-1.450580285735309e-01   -1.040320081113630e-01   +1.003802342087549e-01   -1.030058960039828e-01   -5.185819686385391e-03   -6.764348022206895e-02   -1.422349535674301e-01   -8.674259179996346e-02; -1.259167665525056e-01   -1.515035270368022e-01   +1.033324499630978e-01   -1.135925943638746e-01   +6.910994984152373e-02   +1.886538060095025e-01   -1.984810230586476e-01   -1.081906823654381e-01; +7.509841880811104e-02   +8.487113182669907e-02   -1.331759626636606e-01   +2.068467887632048e-01   -3.413070617780693e-02   +7.329693132944032e-03   +1.208463317414362e-01   +7.817982916593247e-03; -8.522552784239617e-03   -7.325011378394426e-02   +1.384990469708043e-01   -2.302302013742907e-01   +1.071169171317464e-01   -1.816298466326479e-01   -1.450774916815324e-01   +1.502929940700832e-01; +8.855276046107047e-02   -4.402226473834032e-02   +2.041923094306076e-01   -9.229657612496393e-02   +3.624100639519000e-02   +2.944920376607374e-01   -9.926625164982683e-02   -8.068155772601474e-02; +6.793573672312865e-02   -4.654265126392519e-02   +1.235230520211909e-03   -5.966712166526346e-02   +2.547685221024238e-03   -1.280559088049545e-01   -1.477628896160221e-01   -6.445341168507968e-02; -1.021264052996099e-01   -6.225264837482539e-02   -1.924699593032954e-01   +6.238791555366972e-03   +1.925094638072251e-02   +2.444487181066290e-01   -8.396990878532062e-02   +1.376354759593053e-01; -1.106306250872793e-02   +6.537532854312431e-02   +9.860007344276103e-02   -7.478495538044274e-03   -2.696417537426765e-01   +8.725308185514266e-02   +1.561492058136540e-01   +7.812307778131213e-02; -2.333733906188759e-02   -1.863651186228998e-01   -9.706448907411845e-03   +1.683224390699007e-01   +5.786190444621462e-02   +8.937533130673775e-02   +1.779988122258831e-02   +1.916193644968150e-01; +2.177464719255129e-01   -2.276644917679052e-01   +1.513957651840165e-01   +1.620724379459225e-01   -1.088467968081364e-01   -1.123281264365974e-01   -4.895906971891116e-02   +3.926047317690269e-02; -6.388977307478566e-02   -4.218864582134457e-02   +7.837898439967142e-02   -1.636398617851608e-02   +2.759980572164952e-02   +1.434446509344118e-01   +1.510782559289739e-01   +2.930593700390153e-01; +1.040969188165968e-01   +3.294013923742900e-03   -1.657345963425310e-02   -1.264879259280434e-01   +4.861345197225088e-02   +4.746822462012896e-02   +3.390342754048747e-01   -3.073044552618909e-01];
L3I_L3E_iAMPA_netcon = [+2.297529894838989e-01   +5.643797598342898e-02   +2.001850987774999e-01   +1.754740695575642e-01   -1.663268983259524e-01   -6.100475092993678e-02   -1.908960617416164e-01   +2.096992368936185e-01   -1.080563856139492e-01   -2.437505077832186e-02   +8.422834155506945e-02   +1.081300141825024e-02; -7.065014556764776e-02   +7.282346693663766e-02   -2.478230311038436e-01   -5.137844714379597e-02   -5.844987927246897e-02   -4.597459284604848e-02   -1.357968410200220e-01   +2.472604125061960e-01   +8.404999971860339e-03   +5.412573983164064e-02   +3.658360471947031e-01   +3.041315321959823e-01; -2.672725334523248e-01   -6.645260157688082e-02   +1.078196181335797e-01   +1.810255466444481e-01   +8.630627345270511e-02   -8.829359595338288e-02   +3.054924490659706e-02   +2.111061173423079e-01   +1.459028655445118e-01   +1.356287296065825e-01   +6.497169833640506e-04   -2.228704229387265e-01; -1.011864445296664e-01   -8.688466473219209e-02   -6.367889318538404e-02   -3.556097656686172e-02   -1.503201163177995e-01   -2.216537691112561e-01   +1.831420038689374e-02   -9.072316339501603e-02   -2.686585787832568e-02   -9.021103084088140e-02   +1.220737207312913e-01   +1.534228888608837e-01; -3.660650910837124e-02   +1.705647587422864e-01   +1.789855073924462e-01   +1.031339077448926e-01   +1.412207210760018e-01   -1.615001328890049e-01   +1.462612815222091e-01   -1.370008585561759e-01   +2.579528381886340e-01   +1.229733383536751e-01   -1.591161268505369e-01   +5.641510054138583e-02; +4.669587356046142e-02   -8.822220741813172e-02   -2.784253691401539e-01   +1.172968395097130e-01   -7.253313397047557e-02   +1.708197401023431e-01   -9.086731067188854e-02   +6.811761715940876e-02   -6.360416203200801e-02   +2.368873422613988e-02   -1.257909406983669e-01   +2.360193346115345e-01; -4.129377618679923e-02   +1.279390513290077e-01   +6.404276626076741e-02   -2.645165870528132e-02   -1.604648644489635e-01   -6.349831163672098e-02   -2.304749991924154e-02   +1.235478605733714e-01   +5.063976645266727e-02   -1.637991475572615e-01   +1.430929205384636e-01   -2.348623613698595e-01; +1.171922856604255e-01   -4.320103236772116e-02   -5.016533339366988e-02   -2.343800438596954e-02   -1.869051369581271e-01   +2.749948138193871e-02   -1.012336302163885e-01   -1.515524238973077e-01   -9.591887806979761e-02   -1.435571396741654e-02   +2.646668102839771e-02   +1.401568565055872e-02; -1.486425341709888e-01   -1.734972775605832e-01   +1.333193803612862e-01   -4.674660836798172e-02   -9.888881368318832e-02   +1.354147105321511e-01   +4.362365236691695e-02   -1.233592984175108e-01   +2.124392286918961e-01   -2.237778378488966e-01   -1.670129168911135e-01   -6.287268319700137e-02; +1.167366212725742e-01   -9.991141565258452e-02   -4.740617002185102e-02   +1.135674232607258e-01   -1.771957540742350e-01   -4.971489202833644e-02   -1.467621001564187e-01   +6.156363456664904e-02   +3.919885059500196e-02   +4.393663843439215e-02   +5.447446072882140e-02   +3.727185779590177e-02; +6.829736535068015e-02   -1.754825479498228e-01   -1.138034280891906e-01   -1.301803515735495e-01   +1.589300864128631e-01   -3.031901367692772e-02   -8.763828775162977e-02   +7.151479779897428e-02   -3.865609429791579e-02   +2.137071983408182e-01   +1.146856965548942e-01   -2.638861069967695e-02; -3.612138065029197e-02   -1.495673856898889e-01   -2.749062241165869e-01   +3.246221856704231e-01   -7.010488564766279e-02   +1.665663044547247e-01   -9.985884635616429e-02   -2.077374843294752e-01   -2.486661077991661e-01   -3.028448066024149e-01   -1.481699196647295e-03   -1.935064274865171e-01];
L3E_L3I_iGABA_netcon = [+2.182173475193538e-01   -2.575257426429668e-01   +2.748528712338696e-01   -7.622847419612881e-02   -7.536573031979807e-02   -1.003044018203362e-01   -1.427921917280164e-01   +4.434384360400542e-02   +1.446223375403258e-01   -9.355418230722351e-02   +6.690759651581528e-02   +7.163528752394076e-02; -9.041698337181583e-02   -1.452337527425587e-01   +1.058969222947472e-01   +3.638761701152241e-02   -1.649839196254448e-01   +1.380719718657785e-01   +1.129543916230022e-01   +1.850231528431545e-01   -1.791228866585992e-01   -2.740513150192410e-01   +5.194924348000969e-02   +9.901262476670834e-02; +1.457412182568278e-01   -2.090128300309214e-01   +2.558399243155877e-03   -8.127831303921555e-02   -1.470617942651065e-01   +1.340594924286701e-01   -9.206618423210029e-02   +8.905024429540880e-04   -1.143404948541488e-01   +1.587706124324911e-01   +1.176679138479706e-01   -2.368194305459467e-01; +9.492710317064447e-02   +2.537995297786274e-02   +2.911125338790062e-01   +8.303937996728637e-02   -5.901984169781000e-02   -1.656520846909975e-01   +1.545959606874518e-01   +1.603630345530713e-01   +4.557133667843095e-03   -4.842386847580114e-03   +5.306650949601741e-02   +1.463307706845181e-01; +3.911124984318344e-02   +1.101977550479090e-01   -7.384221404272832e-02   -1.905764892456789e-01   -2.146722222044486e-01   +1.731295680644589e-01   -2.369478587006102e-01   -1.171455182058172e-01   +1.317111865640670e-01   +9.169806965221683e-02   -2.306163415922561e-02   +5.560406783409075e-02; +3.957018375107011e-03   +1.582746908676325e-01   +1.259428740490698e-01   +2.375922169583066e-01   +2.708135961972517e-02   +9.342563084262916e-02   -6.948855888211612e-04   +8.511238053295790e-02   +2.062016056609388e-02   +1.276858175369826e-01   +3.057144932736373e-03   +3.020628402170340e-01; +1.344746199496857e-01   -2.225351561147008e-01   +1.104481160333618e-01   -9.324255388742400e-02   +4.682996470174949e-02   -8.657397733729920e-02   +1.807016487568793e-01   -6.226629853909934e-02   +4.267787959858640e-02   -9.683335190210951e-02   -8.081865103242854e-02   -7.221052351241261e-02; -3.677245380607674e-02   -1.308164694685750e-01   -9.178801303482113e-02   +1.546294202243316e-01   -2.008538891958210e-01   -2.370139751236803e-02   +1.741642225140890e-01   +5.934641813064412e-02   -1.733427467142888e-01   -1.617004960244564e-01   -6.884914080282578e-02   +1.162695717739877e-01; -1.761395944510417e-01   -1.137844077957136e-01   +1.108812073080817e-01   +1.519101907100435e-01   +3.613866464056206e-02   -2.523351063154014e-02   +7.642136543997011e-02   +7.822479487221995e-02   -2.552416287231623e-02   +1.618459572835746e-01   +1.759770255812600e-01   +8.370862989086550e-02; -2.022814537226596e-01   +5.900646323216453e-02   +7.824731971779533e-02   +3.722764624286475e-02   -9.547078676872618e-02   -1.466354342080634e-01   -1.328644776334691e-01   +1.887785177179619e-01   -3.380228555532776e-02   -1.718389113405724e-01   -1.763125997004792e-01   +1.689621582744441e-02; -4.236122374230780e-02   -1.473854372576696e-01   +1.403198880425015e-01   +1.451434566783622e-01   -3.393809552079657e-02   -3.470829056817972e-01   +7.890115996191967e-02   -2.478928892349647e-01   -4.058701461863872e-02   -2.233532937280156e-02   -4.478531915849134e-02   -1.106573012288992e-03; +2.549322793403806e-02   +4.766603804122520e-02   -1.405838660005477e-02   -2.322361811475440e-02   -2.329008002376758e-01   +2.592561005107062e-01   +6.060529711473864e-03   -1.641377475862171e-01   +1.139785505739940e-01   -2.172434944365568e-01   -1.571353085584953e-01   +2.060572553312413e-03];
L2E_Input1_iAMPA_netcon = [+3.240681008400934e-02   +1.106791410448837e-01   +8.247632280801470e-02   -7.641809751655737e-02   -1.988005636695663e-01   +1.101287090375085e-02   +2.388840232141868e-01   -2.019862225135061e-02];
L2I_Input2_iAMPA_netcon = [+1.406699328599244e-01   +1.336323604422957e-01   +9.214771998790072e-03   -1.513175989217568e-01   +5.938343224755135e-02   +5.755240241504139e-02   -1.941803451645462e-01   +3.140029893287307e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
