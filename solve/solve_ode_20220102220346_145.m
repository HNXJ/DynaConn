function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.289800447554346e-01   -5.935528286226666e-01   +1.755366445827776e-01   +2.340597980391869e-01   +1.143586919441321e-01   +1.641325263644926e-01   -3.605028014508112e-01   -1.082799116745686e-01   +3.483856814957369e-01   +6.048643114281324e-01   +3.222669280719758e-01   -2.858610735957100e-01   +6.236129570607030e-01   -1.727437547255097e-01   -4.582227637152146e-01   -3.404021312343669e-01; +3.691809097324126e-01   +4.976240698746544e-01   +8.524788008060688e-02   +3.480117151052552e-01   +3.524247861723507e-01   +6.757752165111715e-01   -5.229697934030262e-01   +2.691445058444131e-02   +1.524643221361435e-01   +1.124340867995169e-01   +2.918521236732718e-01   +3.757789478626104e-01   +4.622406846551540e-01   -1.739473254251888e-01   -1.686134594361346e-01   +3.427928625784785e-03; +3.302607357596867e-01   +1.038752216844896e-01   -4.697125125968051e-01   -1.567844469918287e-01   -2.217712048658639e-01   +4.709026223300896e-01   +7.244791417241901e-01   -2.689843963914499e-01   +2.394570020269909e-01   +1.856057423436312e-01   +8.132637323909066e-02   -1.654537078713522e-01   -2.199905492296075e-01   -3.984755377826541e-01   +7.708734882261700e-02   +6.236939296000775e-01; +4.651512278651463e-01   -2.746200102739126e-01   -1.072264552531234e-01   +3.891521591037989e-01   +3.211873616729138e-01   +6.629547784753635e-01   +6.895772993023855e-01   +1.743997358069260e-01   +2.728029286746591e-01   -5.839266439493740e-02   +2.645445883336066e-01   +2.499529501165173e-01   -3.257403641711875e-01   +4.697166039180128e-01   +3.836721110182998e-01   +7.871103291608589e-01; +6.089725273069360e-01   +8.114300106266438e-03   +6.882309068768045e-01   +2.881905810286156e-01   -6.436764331482756e-03   +2.783775462618761e-01   -1.040880416899052e-01   -2.098016354551677e-01   +2.865213321928392e-01   +3.014107948260769e-01   +7.247488832322804e-01   +6.764698684761337e-02   +1.436342102078718e-01   -1.486229453062385e-01   +6.882637086897483e-02   +2.593843407397685e-01; -3.649250532463088e-01   +5.291297199596546e-01   +7.119181127189814e-01   +5.107796859395163e-03   +5.213388290612755e-01   +1.581862488979256e-01   +3.314328945424987e-01   +6.631469626141147e-02   +3.005219403405289e-01   +9.489903925823218e-02   +4.263461343913410e-02   -1.007490691505717e-01   +1.011021251017660e-01   +1.476671437646419e-01   -3.372373663112688e-01   -1.210384869301951e-01; +1.063213173115692e-01   +3.522802023478896e-01   +4.207064157897336e-01   +2.772066515920215e-01   -4.634957649449959e-01   +1.031492924104507e-01   -1.265960516709480e-01   -2.175337841090976e-01   -7.467075144655650e-01   +3.105203098984592e-01   -7.007371599687688e-02   +8.891155130149503e-02   +3.224324690337772e-01   -2.498006314408827e-02   +6.233921743296708e-01   +2.976677214148619e-01; -1.796852322423152e-01   +7.908492133844205e-01   -7.352566346915615e-02   -2.860095246104462e-02   +2.110815901214967e-01   +1.668339572864119e-02   +5.730442864366287e-01   +1.831672659446144e-01   +2.324637522597562e-01   -1.545240076198090e-01   +2.442070845501230e-02   -9.061153401912461e-02   +1.184407923515794e-01   -7.171513950624323e-03   -1.451909580047640e-01   -5.993209357371296e-02; +2.948718987757388e-01   +5.815452381159949e-01   +2.795382850757425e-02   -2.864807224940475e-01   +3.716888557001532e-01   +5.853705043479597e-01   -1.861712156358661e-01   -4.217703157545446e-01   +5.515368001810915e-01   -2.144500237043409e-01   +2.734150047619668e-01   +1.101683824414157e-01   +2.246862670627372e-01   +3.798958495322188e-01   -2.547048416984337e-01   +1.906062250985660e-01; +4.108709834518148e-01   +9.362482606206098e-02   +2.406992783682003e-02   +5.485262989963305e-01   -2.796204014245111e-02   +3.816565604002731e-02   +3.584612099005043e-01   -1.552358474987105e-01   -1.513451039959186e-01   -4.267715077284934e-01   +6.743257349470857e-01   +1.695637706252582e-01   +3.608329880935611e-01   +3.313450083616689e-01   -9.919494213330812e-02   +3.469758769515291e-02; +4.836771693997445e-01   +7.716282193111382e-01   -2.771932461157623e-02   -3.478711394735291e-01   +3.750436421346354e-01   -1.047232194267980e-01   -1.817877645009913e-01   -3.209583767129801e-01   +3.955670480434432e-01   +4.688883070623236e-01   +7.971156550850882e-02   -5.649005894351176e-02   -4.760031357160893e-01   -6.637147042550071e-02   +1.373192663052767e-01   -2.072739360029081e-01; +3.066762629727680e-01   +1.286838125660631e-01   -2.913857367404890e-01   -1.140114071820032e-01   -2.270912797470536e-01   +2.373916505226134e-01   +2.388676057979587e-01   -6.292958533171472e-02   +9.815913356592795e-02   -5.901234784632806e-01   +2.010869565800190e-01   +3.920594854519037e-01   +5.963493386647225e-01   -3.926443832595032e-02   -1.814203701752222e-01   -2.560341771883006e-02; -4.087455644393279e-01   +2.989566184311689e-01   -1.101918333164104e-02   -3.069032763471099e-02   +5.260728571593511e-01   +6.405708303378183e-01   -1.786204936928275e-01   +2.722872615090806e-01   +3.418468926607420e-01   +6.247199770557044e-01   +1.524627946014934e-01   +2.353639582015230e-01   -1.428630040651685e-01   +1.411351167839604e-01   +9.877420965278862e-03   +2.483538474056546e-01; -5.678825384585032e-01   +3.786500399854309e-01   +2.919720926500276e-01   -7.096956297957009e-01   +3.019176946266136e-01   +9.565415380417301e-02   +2.777916055196965e-02   +9.075699986560271e-03   -5.177552724235639e-01   +4.160695981666199e-01   +6.368327262154766e-01   -5.828081741837486e-03   -2.179465255455288e-01   +4.436170105615787e-01   +4.760409162682799e-02   -5.398780867631339e-01; +3.261690833957354e-01   -8.781705447264518e-02   +2.698620867611228e-01   +2.410601834748449e-01   +1.804254132937218e-01   -4.490664772643672e-02   -1.292943848114406e-01   +2.994308937747439e-01   +5.712503972623234e-03   -2.339944536065793e-01   +2.456779169650626e-01   +1.356846029911322e-01   +6.478949892951117e-01   -1.037138190753473e-01   +2.235302408403718e-01   -5.856143499518521e-02; -8.181336801708539e-01   +4.130041487213461e-01   -3.929065044437311e-01   +5.997751505485475e-01   +7.773672118337095e-01   +5.592607764161202e-01   -2.461396359226121e-01   +7.079207190779356e-01   -6.184328154557069e-01   +1.857382982645032e-01   +2.240004605097832e-01   +1.863641675385286e-02   -1.969308772457553e-02   +3.749037511712457e-01   -1.260756671939862e-01   +3.397300556481508e-01];
L1E_L1I_iGABA_netcon = [+1.616517728237811e-02   +5.535022266472542e-01   -3.313738609251844e-01   -1.546599641946809e-01   +6.735219909098452e-01   -1.035571475443947e-01   +7.312899957031137e-01   +3.701927211953303e-01   -4.302262000114123e-01   -5.512187065747293e-02   -2.932725484670481e-01   +5.959804729027121e-01   +7.008223423743499e-01   -4.976967545334732e-01   +6.891977347506061e-01   +5.483976250879137e-01; -3.877870841074803e-02   +9.623919683969094e-02   +8.759895484795611e-01   -2.550885129589208e-01   +5.372643584792505e-01   -1.336751511753208e-01   +5.852724170056780e-01   +4.790451732848760e-01   +1.711159200431569e-01   +5.497773295196214e-01   +1.871244387267494e-01   -3.259169170663259e-01   +3.764745369471123e-01   +5.904536937832711e-01   +5.785157177655488e-01   +9.545092623064344e-02; +3.728812996931740e-01   +3.589100029602854e-01   -3.252729591520499e-01   +4.104749435199167e-01   -2.996198046861540e-01   -3.000890795429775e-01   -1.601532158063260e-01   -3.190439475175643e-01   +4.630154978682132e-01   +1.409642983353746e-01   -4.944936072738109e-01   +5.682140179924208e-01   -2.906380039626880e-01   -2.526517441898413e-01   +5.633250651120937e-01   +1.008117224898613e-02; +4.674430054504038e-01   -1.394372041399425e-01   -5.715363728270896e-01   +2.018745506893681e-01   +1.408836153651808e-01   -6.337424478352299e-02   -1.118078296001616e-01   -2.385874631440007e-02   +1.178134145079604e-01   +3.546215811033704e-01   +2.021800177264102e-01   +1.721092277567008e-01   -2.256533988876350e-01   +3.055196563657760e-01   +5.536867200105299e-01   -3.583511327863916e-01; -5.951446421635911e-02   +2.637686181130787e-01   +5.875691293054561e-01   +1.089512432423508e-02   +2.714521690365856e-01   -2.730211005263761e-01   -4.045282059893623e-01   -6.655093633392172e-01   +1.021400063404439e-01   +1.000907773938390e-01   +3.816543398128567e-02   +8.296184895862845e-01   +5.272275961129503e-01   +1.549160189672436e-01   -3.915033921460260e-01   +3.891929430550134e-01; +1.979005957192864e-01   -1.107285982944378e-01   -9.775250546998604e-02   -2.068492936326802e-01   -1.442424289146650e-01   +3.969843543068262e-01   -1.770782460548713e-01   -3.698044397551937e-01   +1.085732604049123e-01   +1.430857898968318e-01   -2.042829470878429e-01   +2.702794233623259e-01   +3.324103883161020e-01   -3.349163139405212e-02   +3.759191425024911e-01   -1.936852504789585e-01; -9.236207509299674e-01   -3.949972924650612e-01   -7.263038167400308e-03   -7.356652258456365e-01   +2.809367745792591e-01   -2.124030346403742e-01   -3.152552164465457e-01   -1.716791302232014e-01   +6.011225591435937e-01   +2.944015989008426e-01   +5.140899210934889e-01   +3.233113803175034e-01   -1.178220187960928e-01   +3.157683407480948e-01   +7.192453913561589e-01   +3.632005441682586e-01; +6.045386401133399e-01   +2.280688487304066e-01   -2.731085923959374e-01   -1.682562430993844e-01   -5.016578386763335e-02   -2.139318764284741e-01   +7.624710199366004e-01   +9.549745795627382e-02   +3.768931752828394e-01   +1.857571597472551e-02   -1.442127343909083e-01   -2.989094098263381e-01   +8.908863228581498e-01   +2.352221937023664e-01   +5.151529917928289e-01   +9.264867887582650e-01; +1.581953322430503e-02   +6.068469066100649e-01   +2.621787973291709e-01   -3.475431342348158e-01   -4.038008822718552e-01   +3.137155698605799e-01   -3.229084076618582e-01   +1.108087244964670e-01   +3.372720717935160e-02   -3.022287268069836e-01   -1.392451763694621e-01   -4.726466687493225e-01   -2.105476733670541e-01   +3.151013151565380e-02   +4.396605113359952e-01   +3.734027307328870e-01; +3.207142142320861e-01   +4.296835323852641e-01   -9.613109472535276e-02   -2.136547324002618e-01   -1.840707326468485e-01   +3.882142130312077e-01   -1.092856245554819e-01   +1.893094203647155e-01   +5.382504719045483e-01   +5.248092658205462e-02   -6.103112866233893e-01   +2.815930178666466e-01   +7.068534349660619e-01   +1.396932375046697e-01   -8.977633633053468e-02   -1.873618263659858e-02; +4.073735801569883e-01   -1.409635315228492e-01   +1.123102090040146e-02   +3.741810797274352e-01   +6.142263733558923e-02   -2.108883716063254e-01   +3.258585243881113e-01   -2.876928814930456e-01   +5.490758702778027e-01   +3.690592954606947e-01   -5.169032479368765e-01   +5.445012043191663e-01   +4.948615606798650e-01   +2.983533652486510e-01   +2.360312976393142e-01   -4.392476349300696e-01; -1.588334004355520e-01   +1.695743782384763e-01   +7.359842573855638e-03   -4.498200029005297e-01   +4.034382544260982e-01   -1.171993521167175e-01   -2.053202590443469e-01   +4.349377418557529e-02   +1.378738848602735e-01   -9.265703609203051e-02   +2.080577687379278e-01   -2.169001663638755e-01   +4.797711551521440e-01   +2.270070931074523e-01   +5.911925651027418e-01   -3.935796314921326e-02; +3.990721953458036e-01   +2.300049500510299e-01   -8.374190201172073e-02   +2.748111341368578e-01   -9.967760956614383e-02   -2.354886395292131e-01   +5.526156066266647e-02   +5.118306487963969e-02   +2.626491251013995e-01   +1.847924962074100e-01   -1.805495365310592e-01   -4.275368379127962e-01   +3.615167690108320e-01   +1.494702860522110e-01   -5.808844245894010e-02   +2.212723043733270e-01; +5.533655615561863e-01   -8.071581308705508e-02   -1.457749891904589e-01   +9.343248118197767e-02   +8.826400933031799e-03   -2.066289817466651e-01   +2.787516788207638e-01   -2.481139001409862e-03   +6.208329292694690e-01   +1.112982493029838e-01   -9.954047885227560e-02   +1.057475634785217e-01   -2.429079854610016e-01   +1.281025869155157e-01   -2.668409526452767e-01   +3.587966703542167e-02; +1.934766265089141e-02   +1.643112154092872e-01   -3.630836306016431e-02   +1.302514883272757e-01   -3.971142264093741e-02   +2.675880353814475e-01   +4.056445719601391e-02   +3.334756501684531e-01   +4.490102396534488e-01   +1.129806579456241e-01   +7.515742758893865e-01   +2.186979981791222e-01   -2.905278192631487e-01   -5.665907234799414e-01   +9.518932901865709e-01   +1.154966755767528e-01; -3.618064382558496e-01   +2.673026530478531e-01   -3.170513090182216e-01   -1.718372566866692e-01   -6.457288394918453e-02   -2.303412555197153e-01   -2.093412380277793e-01   +6.322843951877870e-02   +2.328290064970493e-01   +1.415735007047364e-01   -3.879608034606725e-01   -1.025267116188378e-01   +2.712870597648901e-01   +3.872126839398212e-01   -1.111567283496218e-01   +8.802659347422014e-02];
L2I_L1I_iGABA_netcon = [-6.246012558874699e-03   -2.353481262802384e-01   -3.916378589406790e-02   +9.026423500638524e-01   -2.196525955737387e-01   +4.824097532935643e-01   +6.488809994857299e-03   +9.836412160140715e-02; +2.338752309651637e-02   +6.645613109373106e-01   -1.946396479750809e-01   +1.197062011092487e-02   +3.406232085859419e-01   +7.146965963422797e-01   +2.311493946750457e-01   -4.118464572876309e-01; +2.971482097280618e-01   +1.922953369871138e-02   -7.118957140352780e-02   +3.504411918863576e-01   -9.886354186164095e-02   -2.149466646566731e-01   +8.460224754620767e-02   +2.737033875528883e-01; +8.915544710157776e-02   +8.283063373327536e-02   +6.841704377394798e-01   +5.160340992920398e-01   +6.889137867378985e-02   +4.013570353168650e-01   +2.973803448624332e-01   -1.796792755579677e-01; +2.216453313409478e-02   -7.848258304947998e-02   +6.779591344046774e-01   +7.751040085441556e-01   +9.334205380726370e-01   +2.469143238602296e-01   +4.167163922289767e-01   +3.698840393360604e-01; -3.134317909167066e-01   +1.308655462826095e-01   +7.382435195339406e-01   +4.313136914042605e-01   -2.390779556143482e-01   +6.869162690292586e-01   +6.030087759665219e-01   +7.397343590273293e-01; +1.365981397653608e-01   -1.400047578936628e-01   +2.417871313514406e-01   -1.275472034725946e-01   -9.536148999587209e-02   +8.691228720895632e-01   +3.886347098735068e-01   -1.891739124492036e-01; -2.935317516448484e-01   +4.338785353504475e-01   +3.815205317400768e-01   +2.871556912069460e-01   +5.749072057607628e-01   -3.531378371275656e-01   +4.939256697310908e-01   +6.452307757879780e-02; +1.729858790772401e-01   +7.834136680910571e-01   -6.704658819028493e-01   +4.968290089578160e-01   +3.277033330941611e-01   +8.240788113808550e-01   +1.798855811939751e-01   -1.065153067202359e-01; +1.518852513073362e-01   -2.449174573448408e-01   +5.899622009661944e-01   +1.653664269454392e-01   +3.626494802026310e-01   +5.165934406903133e-01   -7.077987151413097e-01   +6.523492540443732e-02; -2.246412640611176e-01   +2.324164525052104e-01   -1.068987004511837e-01   +1.998500009026023e-01   +9.619475535089837e-02   -5.647556073080628e-02   +2.160935560221617e-01   +4.785034306819655e-01; +3.407481022174698e-01   +4.483248231324263e-01   +3.433329472206035e-01   +2.792360994322372e-02   +1.114114004720570e-01   +2.319902049388189e-01   +8.041055788360202e-01   +4.769612052001427e-01; +2.285293836305769e-01   +1.959351477069017e-01   -2.463007391440774e-01   +1.324249310699710e-01   +1.598745491244674e-01   -5.397905399725473e-01   -2.288339623546403e-01   -1.889435227799635e-02; -3.213837127403508e-01   -2.232332085026503e-01   +1.566836812391845e-02   -4.829064319346952e-01   +3.747040889125300e-01   -3.979383455604386e-01   +5.031908122594277e-01   +5.820246113360047e-01; +6.050168687988778e-01   +4.983731068730509e-01   +5.174425646305157e-01   +3.822935278237131e-01   -4.208811479522703e-01   +7.914730589826613e-01   +6.973239118652844e-01   +2.761798384384156e-01; -5.080675085198710e-02   +1.722391437791743e-01   +4.813569778501159e-01   +4.456995387675209e-01   +5.710060219244969e-01   +2.602701428960674e-01   +2.114768330775715e-01   +1.603922328260229e-01];
L1I_L2I_iGABA_netcon = [+4.331862113460410e-01   -1.635636645177045e-01   +3.834277165772671e-02   +3.059681725505963e-01   +1.418206187696826e-01   -6.499816091128771e-03   -3.554788696177434e-01   -4.058429932544417e-01   +1.767802012458374e-02   +4.684326495025486e-01   +1.103695453205881e-01   -4.649569258979656e-02   -3.958328125047941e-01   +1.668754692058168e-01   -3.509733179054551e-02   +1.479457271572916e-01; +1.828368467158062e-01   -4.839260554632809e-01   +1.980271986381454e-02   +2.971929447158428e-01   -3.340638859600986e-01   -2.973742302030402e-02   +4.149848764215813e-01   +7.894784535233910e-02   +2.433489244932361e-01   +5.472539528104675e-01   +7.188817447005777e-02   -4.764512371634692e-02   +6.488993610322398e-02   -3.094280777718995e-01   +4.975844613946395e-01   +2.795604690810049e-01; +1.776054208251871e-01   -6.309554214462050e-02   +1.054210627102278e-01   +1.448223548893976e-01   -1.237116638197519e-01   -6.195243324285032e-01   +1.085263261701909e-01   -2.642831381320096e-01   -1.170609726909309e-01   +2.677508319049716e-01   -3.830510457641764e-01   -7.269583097994044e-02   +5.473918365517867e-02   +5.481410561294157e-01   +6.498881905162259e-01   -2.571727861359372e-02; +1.488744390424926e-01   +4.286718509053685e-01   +3.776769788833558e-01   -3.073704987853602e-01   +5.904158041935671e-01   +7.933177248325126e-01   +9.375072391119584e-02   -7.506131516131045e-02   +1.769494087068845e-01   +5.888461465119285e-01   +2.870815311095568e-01   +3.006821551027097e-01   +4.687289708465447e-03   +8.483189513345136e-01   +1.486262892688621e-01   +6.674475372228934e-01; -2.693660305792955e-01   +1.002717037349820e-01   +2.778236581047393e-01   +3.331715747905525e-01   +2.655764393360654e-02   +6.047321822429755e-01   +3.400338510756420e-01   +4.117654977611528e-01   +2.953663035513912e-01   +1.884948135545822e-01   -1.496229402407347e-01   +3.365279139436048e-01   -8.156215459314510e-01   +5.207424456452919e-01   +5.436528502741158e-01   +1.000000000000000e+00; +4.470654133506887e-02   +5.285692555656859e-01   -7.301958221173923e-01   +1.313009989502033e-01   +9.077106953541007e-02   -7.106859576026964e-02   +4.107988029860928e-01   +5.633714048767359e-01   +1.615535552469452e-01   +3.256544731016930e-01   +2.478816645907558e-01   -2.502218836831516e-01   +1.583074030174775e-01   +7.629670751117297e-01   +1.977811055025048e-01   +1.137410643561720e-01; +2.427642841116320e-02   +4.967949935937112e-01   -3.704765878132791e-01   +6.065335163687121e-01   +3.845245130543680e-01   -4.950429495064962e-01   +2.095624537180851e-01   -1.979302537029153e-01   -4.961824314676881e-01   -1.744509143169156e-01   +3.803807523614962e-01   +5.876232029387799e-01   -1.034538357049887e-01   +3.973147401638753e-01   +2.099249645623825e-03   +1.885722689762288e-01; +4.416354118609014e-01   +2.746154214522863e-01   +2.505155351359275e-01   -2.047762239323135e-01   +3.624584995414667e-02   +3.484606206261014e-01   -1.569098275777237e-01   -3.995669612536174e-01   +1.659997808231876e-01   +1.434912248804830e-01   +2.766486291500375e-01   +6.177249655091283e-01   -2.299329338945822e-01   +1.953465993957498e-01   +6.184498018640957e-02   +5.301532847257224e-01];
L2E_L1E_iAMPA_netcon = [+6.545981475494743e-02   -7.251726598102467e-01   -1.298623162413687e-02   +4.700811143256761e-01   +3.068271829012253e-01   +4.520323131048437e-01   +4.517257093861250e-01   -3.235294228928346e-01; -1.690168114686301e-01   +1.644003984879306e-01   -5.054047902726200e-01   +3.897602610208005e-01   +3.069914875613263e-01   +3.948334446027644e-01   +1.478851450753379e-01   +3.639098171110849e-01; +5.434007153247943e-01   +1.516369047845604e-01   +4.399990479046439e-03   +3.799896710033465e-01   -6.405263642725871e-02   -1.835959534198952e-01   +6.124413597393610e-02   +3.835950544758258e-01; +1.034335817032514e-01   -1.700612975166769e-01   -4.055767826906531e-01   +2.400595398072825e-01   +1.361287532726202e-01   -3.196815552395667e-01   -3.680372214692804e-01   -2.832322648397606e-01; +2.034342815146490e-01   -5.839881537856730e-02   +4.256655731817114e-01   -5.487907953082591e-01   +2.420438043764241e-01   -4.711851831631125e-01   +2.145279036529292e-01   +2.998261971445860e-01; +8.185823443846670e-01   -1.225357107499723e-01   -1.520577245610359e-02   +6.059726501677236e-01   +2.397487534218862e-01   +8.371377979210767e-01   +5.274996491204229e-01   +5.640671321578707e-01; -4.891072395894458e-01   +7.524249471734249e-01   +3.969735308871187e-02   -2.771342833738443e-01   -1.325531262714688e-01   +4.466033144555413e-01   +7.941973172048761e-01   -4.450956876723335e-01; +1.182123988467466e-01   +4.090537694881830e-01   +9.816440714679877e-01   -3.209419102663681e-01   +3.585388924767487e-01   +1.905092685151118e-01   +6.577443256472368e-01   -4.748064322787136e-02; +8.632415257533863e-02   +2.880866221455017e-01   +1.000000000000000e+00   +5.358200982476664e-01   -9.387645218645473e-01   +7.253086472703050e-01   +7.913845717691878e-01   -3.621039177614955e-01; -4.483569097657470e-01   +4.330834780535945e-01   +2.229349171142030e-01   +5.438670134344075e-01   -1.497082954557688e-01   -4.540457081899861e-01   -2.229323564341601e-01   -2.553762598337019e-01; -1.420783657756065e-01   +6.383115660184644e-01   +6.472323722006720e-01   +3.984853246389612e-01   +9.823435314625684e-02   +1.036147877891113e-01   -1.122879718301429e-01   +1.893158829907671e-01; +1.962046753892644e-01   -1.207518058193487e-01   +4.851366097439535e-01   +1.552311635492672e-01   -3.743735380594833e-01   +2.710029547597622e-03   +3.349791255246443e-02   -2.935067472611196e-01; -2.382669609008606e-01   +2.737413618055906e-01   +8.526847060750281e-02   +1.323323774780137e-01   +4.934741849969003e-01   -7.741207227861654e-01   +3.209909812220974e-01   -2.385460696531242e-01; +4.237926342894038e-01   +7.396268967419465e-01   +1.834618545138484e-01   -4.254141356964831e-02   +5.386483708335602e-01   +2.610247112824331e-01   -3.565247630768922e-01   +1.364454955761521e-01; +1.581945414695999e-01   +2.144798979802183e-01   +1.878792650830358e-02   -1.818002618936539e-01   +7.020556725185469e-02   -3.038588581113153e-01   -2.151475880771225e-01   -3.911320488262229e-01; -1.205632775282272e-01   +2.884579896647257e-01   -8.553242881571471e-01   -3.945197375552779e-02   -7.041789574196755e-02   +1.957374721258442e-01   +6.656822727957863e-01   -3.825204250355501e-01];
L1E_L2E_iAMPA_netcon = [+4.735118233997097e-01   +4.135203441799591e-01   -1.491107004907016e-02   +6.808042339701817e-02   +1.072732240589699e-01   +2.124920324233083e-01   +3.554881361207506e-01   +5.182288937913643e-02   +7.193393163964065e-02   +2.332810395087015e-02   +6.170239417322231e-01   -2.081196024922550e-01   -2.732600153496226e-01   -1.637073707301379e-01   -2.549005331025279e-02   +4.366052617182765e-02; +2.524676701251882e-01   -1.024073791351327e-02   +2.881367242958759e-01   -2.196621748494997e-01   +1.839562343741040e-01   +1.330631657990194e-01   +6.481652855069898e-01   +3.777670961190129e-01   +1.997792033701863e-01   +7.242124307719236e-02   +5.831296215976816e-01   +9.454081922090712e-02   +8.322955669229819e-01   +2.983397619227179e-01   -6.011684978756231e-02   -3.515607128723333e-01; +9.715870647863200e-01   -2.858429300216068e-01   +1.935631045149106e-01   +4.444038063815545e-01   +6.005869713163350e-01   -2.156045130462818e-03   +1.101298347687022e-01   -2.501184128669936e-01   +3.466672610989011e-01   -1.283628288744197e-01   -6.486145889631838e-01   +2.033890312631160e-01   -1.364542137092916e-01   +2.876017796927121e-01   +1.890907076525666e-01   +6.173322270613782e-02; +1.642480073298203e-01   -2.480729024637951e-01   -5.018702167125252e-01   +5.144175938493440e-01   -2.662709508219830e-01   +8.332951976227627e-01   +7.892922028664093e-01   -2.285145130666968e-01   +2.190032066776072e-01   +1.611775586833757e-01   +4.805260173043314e-01   -2.303698879028673e-02   -4.985597241055967e-01   +8.200743598679017e-01   +6.078329474630740e-01   -2.378352711128369e-01; -1.845106369648384e-01   -4.066472308337160e-01   -6.986250130265878e-02   +1.327075708564432e-01   -8.072361236388736e-02   -6.769041814714107e-02   +3.071320971556017e-01   +7.535411048083743e-01   +2.535657736972495e-01   -3.782625526403997e-02   +2.643574538057846e-01   -3.649982595348297e-01   -2.260564635809303e-01   -1.861110665663031e-01   +4.110304056876783e-02   -4.794465932171953e-01; -2.291171263826740e-01   +7.198359696170119e-01   +1.135054398964542e-01   +4.483364535891921e-01   -1.786110037763578e-01   -6.019001942849132e-02   +8.215387149959233e-01   +1.648869212714003e-01   +2.620195243981151e-01   +3.898839121801416e-01   +3.360804310968663e-01   +1.966849753536001e-01   -3.075777274963695e-01   +2.099428670187954e-01   +2.817475532955516e-02   +9.164942913382033e-01; +1.247737003615826e-01   +5.046360671206095e-01   +1.117455908299633e-03   +1.399722512643411e-01   +3.131330668458130e-01   +3.679164411201218e-02   +3.176165155298616e-01   -9.185202115854695e-01   -4.063835471527984e-01   +1.841331504871626e-01   -2.638805260510607e-01   -2.042742318169745e-01   -7.744028033332301e-01   +5.755384965026684e-01   +3.095847086079729e-01   +6.444187530996873e-01; +5.995207288345156e-01   +1.759588573186404e-01   -5.167167687485556e-02   +4.696163795132342e-01   +3.387498089767559e-01   +4.029953046880020e-01   -3.356392220756737e-01   +1.788445044661959e-01   +5.824248709642559e-02   +3.934652807058989e-01   +6.486607400557082e-02   +2.065308962455861e-01   -7.968066035120729e-01   -2.304052779015529e-01   +3.426038623201034e-01   +4.294919839140581e-01];
L2I_L2E_iAMPA_netcon = [-8.116698046302401e-03   +6.966532099278321e-01   +5.740082431503805e-01   -9.263783299373865e-02   +2.599468931322295e-01   +1.927295304214380e-01   +1.269962682897499e-01   +5.980855520281458e-01; +5.776202825544834e-01   +2.392959285603240e-01   +3.994938940382356e-01   +7.216220931417949e-01   +1.059763527054643e-01   +4.044289545723566e-01   +1.071022807858021e-01   +4.199627521456353e-01; +1.794400317435268e-01   +4.817080871944860e-01   -3.285461849367570e-01   +3.686894637909923e-01   -1.140104137154313e-01   +4.846919573837322e-01   +8.204545580663828e-01   +1.419734249005206e-02; +3.386953838800772e-01   +5.708484466172850e-01   -5.192973757482768e-01   +1.253141160977861e-01   +6.882057864154163e-01   +2.606576204051994e-01   +2.349414151087466e-01   +6.747645580276052e-01; +8.185892523093106e-01   +2.558642072635536e-01   -3.297163015648299e-01   +4.151340027091031e-01   +7.274360540716251e-01   -6.115303887725676e-02   +1.369893111845156e-01   -1.494356380795916e-01; +4.459478397249813e-01   +3.300725412346873e-01   -5.528991240072508e-01   +3.070440986374877e-01   -3.403962523155240e-01   +6.260082102471311e-02   +3.076502557036853e-01   -2.260112571762838e-01; +7.559361638886399e-01   -2.550787953974673e-01   +6.290616105237649e-01   +3.141673798831097e-01   +4.923440375927927e-02   -3.077456900380727e-02   +6.208416988848265e-01   -4.846054684830801e-01; +3.857563652917114e-01   -7.148490742429797e-02   -6.563887597338263e-01   +1.507357046973511e-01   -1.810980932456807e-01   -2.087500602701347e-01   -1.010155660358464e-01   +8.088117497210925e-01];
L2E_L2I_iGABA_netcon = [+2.782023962544261e-01   +6.609591245384595e-01   -2.205304953337630e-01   -2.202725218550985e-01   +1.524185762493881e-01   +1.139372800278267e-01   -5.027141057108729e-01   +5.873048284637098e-01; +1.128684800491343e-01   +6.413277854267783e-01   +3.732470782247337e-01   +8.003538899437255e-01   +2.875535735666962e-01   -2.543638361471298e-01   -5.584720041102563e-01   +1.450137197173361e-02; +2.330597179974454e-02   +5.616927875691458e-01   -4.628431343400664e-01   -4.293791967602704e-01   +5.290834658623270e-02   +8.136620527539408e-01   +2.389207081910294e-02   +1.274410778646077e-01; +6.442033523241599e-01   +6.363328360305243e-02   +6.470257360682694e-02   +6.862302379351727e-01   +7.132345407809659e-01   -1.562035971301543e-01   -4.389089301677865e-01   +5.639706380494307e-02; -2.993962362199588e-01   +2.203975521791451e-02   -1.668536483949026e-01   +2.198900729308976e-01   +7.947242379666553e-01   +3.379114942257833e-01   +6.733837441236624e-02   +8.657715529982890e-02; +8.036637377051651e-01   +1.949602546745081e-01   +1.155116400759068e-02   +4.036197384599727e-01   +9.387170003310025e-02   +1.184967086277987e-01   +5.134370933644913e-01   -5.562833151946579e-01; -4.535350748423747e-01   -6.791125551095931e-02   -8.619768343759682e-02   +1.213200028534196e-01   -1.764166661458433e-01   -1.425817171486759e-01   +1.805269081831266e-01   +8.321567498728232e-01; +2.403223089023687e-01   -3.692048247924554e-02   +6.945497334246056e-01   +7.007675219207326e-03   +5.622291960170006e-01   +2.252954098122860e-01   -5.402364114502108e-02   +6.213439911176437e-01];
L3E_L2E_iAMPA_netcon = [-7.306184673415460e-02   -2.362343473732827e-01   -3.882626640101013e-01   +1.571178635751804e-01   +9.084813304234636e-01   -1.694332975946375e-01   +2.294500231991198e-03   +9.223465970336350e-01   +3.782195516626684e-01   +2.100341590437678e-02   +4.374664059763099e-01   -7.033799065158903e-01; -3.807915335552987e-01   +1.157866635422683e-01   -3.611797317647955e-01   -5.138065785011808e-01   -4.749499324866206e-01   -1.680131259532616e-01   -1.438662739814423e-01   -2.926407734624750e-02   -5.155560615749524e-02   +5.726988146847345e-01   -2.228191546171725e-01   +5.873133547443702e-01; -5.020069384467906e-01   -1.896861318561151e-02   +6.910522046369141e-01   +7.874807059168099e-03   +1.765453791837119e-01   +1.053182089731097e-01   -2.030434890652868e-01   -1.789840296051794e-01   +5.011955905836953e-01   -4.371417642952234e-01   +7.517222935410693e-01   +1.517213941757003e-01; +5.866785368261180e-01   +5.074579426045649e-01   -2.865342490123906e-01   +8.519270643079754e-01   +8.853424099395985e-01   +5.026059606877150e-01   +5.222152769538536e-01   +7.264027861958651e-01   +1.396025460607572e-02   -1.212357100295537e-01   -9.694718057150938e-02   +3.807697530661865e-01; +1.512628445643553e-01   +6.566232803748749e-01   +9.737223078310829e-01   -5.464212427955553e-02   +6.092936298686981e-01   +7.317420531897021e-01   -7.338538577019044e-02   -2.502417329325448e-01   -4.678585870942409e-01   +2.157795430215084e-01   +1.128882668386547e-01   +3.821561817576044e-02; -2.700005537689332e-02   +4.183653200358300e-01   +4.783253439480730e-01   +9.513719625335580e-02   +9.678944706935649e-01   +4.115812155599643e-01   -1.364267735385424e-01   +1.940690393186067e-01   -2.126476658569041e-01   +5.195135339917744e-01   -1.939774193472023e-01   -3.184340893777954e-01; +6.259547971997395e-01   +2.252339733155734e-01   -1.049463211947517e-01   -4.703107691040922e-02   -3.811095729165736e-02   +4.014171891782748e-01   -3.133090191159745e-02   +1.309417581231926e-01   -1.498036171794703e-01   -5.782627968227237e-02   -1.032171643935147e-01   +1.620449857128539e-01; -1.362452860228171e-01   +4.784666543034908e-01   +5.270097762287179e-02   -3.007534909669478e-01   +4.176324750555631e-01   -3.472813245662290e-01   +5.128970464553277e-02   -2.779568940611212e-01   +2.915887369602534e-01   -3.119763758448241e-02   +5.377359456762056e-01   +2.615315769309750e-02];
L3I_L2I_iGABA_netcon = [+7.870031825983349e-01   +6.630735980460963e-01   +1.228382239077527e-02   +8.529651383429547e-02   -2.239522057983773e-01   +4.683409792182642e-03   +8.727318529292178e-01   +7.294925522628235e-01   +1.619244240785768e-01   +4.157851786239469e-01   +3.257254436030634e-02   +2.357257056200505e-01; -5.177765467290010e-02   -1.591565133639302e-01   -1.999715118849569e-01   -1.116090389709643e-01   +4.170513448911991e-02   +1.214663111716761e-01   +1.229096448682773e-01   +1.116503106125910e-01   +6.626518677044881e-02   -8.367365196804226e-02   -6.481174502462664e-02   +4.625420589740845e-01; +1.558018890877642e-01   -1.163500561233044e-01   +3.375068716083168e-02   +7.382494460334368e-02   -5.180108454863654e-01   +3.242815102825796e-01   +6.864524217066380e-02   +9.707555493253534e-02   +5.035459136579282e-02   -3.180409027118884e-01   -1.261821505642063e-01   +6.464322588698947e-01; +2.861595008521137e-01   +1.773035880490362e-01   +2.574859773355946e-01   -1.200924802288375e-01   +9.084512352324665e-02   +4.310918451349504e-01   +3.643947217577777e-01   +1.948723536529894e-02   +4.178276550293686e-01   +3.757243213538986e-01   +3.473113533498648e-01   +2.711935061442968e-01; +3.547414693960615e-02   +3.720841613693282e-01   +1.489459238953127e-01   -4.459577851124000e-01   +9.269129004437365e-02   +3.737457486150082e-01   +1.600619365811274e-01   -1.102246200627434e-01   +2.319127382526555e-01   +1.200057810674795e-01   -3.890655130229650e-02   +1.628318017681976e-01; -5.962011364798734e-02   +1.679820711616858e-01   +2.388722284908552e-01   +2.140614661146010e-02   +1.283444894426244e-01   +1.595646845862041e-01   -4.141174741176585e-02   -8.251838109795268e-02   +7.639339564879867e-02   -1.773305959265269e-01   -7.856770692669877e-01   -3.403481613869447e-01; +1.512625601076693e-01   -2.488891497418629e-02   +4.102925656382511e-01   +2.945899983394697e-01   +2.155586664075273e-01   +5.289309926337755e-01   +2.866933383793429e-01   -1.868987700843359e-01   -4.227601911640277e-02   +2.701459273383234e-01   +3.377090480354775e-01   -4.265467037908868e-01; +2.378354261434796e-01   +1.276869270715191e-01   +2.087682117035691e-01   -6.897181887798041e-02   -1.187088574873586e-01   +5.381239926387870e-01   +1.672112674191983e-01   +5.209024779703424e-01   +2.777769711766603e-01   +8.973889442953110e-02   +2.986637263358252e-01   +5.097624861891432e-01];
L2E_L3E_iAMPA_netcon = [+7.630970169269478e-01   +2.335473693458681e-01   +1.480656179553280e-01   -2.489196543757360e-01   +1.162728678681436e-03   +5.582177771678698e-02   +5.029528270840037e-01   +4.986180339263196e-01; +5.101896255081676e-01   -3.659308089115558e-01   -3.379778036723223e-01   -9.558620367583329e-02   +6.961595089469860e-01   -7.513157004336267e-01   -7.389093322238250e-01   -5.179697842591451e-01; +8.275765356092657e-02   +1.576709884538407e-02   +4.345273321769757e-01   +1.629061901230296e-01   +5.476930391809236e-02   +3.065882228281190e-01   -2.783312191450438e-01   -1.674622431840580e-01; +6.399511148555715e-01   +2.787362321505764e-01   +6.129431675677722e-01   +7.259421248477882e-01   +4.869024730038469e-02   +2.300400761235514e-01   -2.220091766893758e-01   -5.214285454241416e-01; -3.069594990619000e-02   -2.723186271218528e-01   +4.153200658565581e-01   +3.576835179978493e-01   -4.066075270179920e-02   -2.357292479072503e-01   -1.399183361420544e-01   -4.892205824549193e-01; +3.215435399475877e-01   +3.048981035616481e-01   +3.478584089570677e-03   +6.081264603130763e-01   -1.549362208027978e-01   +9.329992032585228e-02   +3.619616143877240e-01   +1.949039278735030e-01; +6.261514017968815e-02   +6.923030203236141e-01   +9.515917917650472e-01   -2.903026261207793e-01   +4.469267556685450e-01   +3.631699491647427e-01   +4.322470894800389e-01   -2.506753570162301e-01; +2.480757226809556e-01   +5.419740733644105e-01   -4.266817236199443e-01   +1.744441622118914e-01   -2.111179435845351e-01   +2.151242551952242e-01   +1.643602485855053e-01   +6.276546566399568e-01; -3.674350680255853e-01   +4.426257670446281e-01   +6.870445535103420e-01   +5.449010290211327e-01   -2.974463548111952e-01   -2.079344292037056e-01   +5.410321918474912e-01   -2.614043640094915e-01; -3.900271408137203e-01   +7.297312444832638e-02   +3.295336080123574e-01   -1.457135327583388e-02   +2.312573586807560e-01   -5.572050636801601e-01   +6.423660856292903e-01   +1.539135570964106e-01; +5.367610340860541e-01   +6.660875238631006e-01   +1.853663569630248e-01   +3.228067703091439e-01   +4.307670040808839e-01   +7.284521194789504e-01   -3.826657704563666e-01   +1.812424500168879e-01; -1.112879146974600e-01   +2.624804611057676e-01   +6.694968744620308e-01   -2.326801672559007e-01   -1.819844898618270e-01   -1.237559542475082e-01   +8.543828120279000e-02   +2.770902513776827e-01];
L2I_L3I_iGABA_netcon = [+3.905928138780845e-01   +2.024309005023690e-01   +3.852567445879899e-01   -4.425877707720870e-02   +1.667637532171989e-01   +7.397591420146595e-01   +7.268184127179965e-01   +2.398144509101399e-01; -2.856108960098419e-01   +3.603473322440762e-01   +4.885832755692061e-01   -1.348978256686519e-01   -3.892535067700046e-01   -2.085702049741149e-01   +5.854948411179566e-01   +6.814016920050794e-01; +1.900284428831534e-01   +7.717954406604773e-01   +4.903116453068697e-01   +1.391644689113430e-01   +4.056269312147030e-01   +2.602001615921282e-01   -2.569107018308892e-02   -4.836868931164601e-03; +9.168866660598529e-02   -4.458185440843996e-01   +3.308394677576253e-01   +2.121945620709924e-01   -1.868969435356601e-01   +1.588088301243863e-01   +2.651278932458579e-01   +2.172558070194853e-01; -2.251870787595333e-01   -8.688325073504381e-02   +2.092124203967165e-01   +1.862612280368849e-01   -2.441313447447975e-01   +2.596594684599054e-01   +3.131417426226225e-01   -8.947063898875701e-02; -2.727035916714893e-01   +8.391014183852197e-01   +2.734399517525085e-01   +4.425894664221672e-01   +3.475104442540733e-01   +2.288702700268783e-01   -4.088063650315000e-01   -2.568586225052351e-02; -1.067442523075633e-01   +7.150721137155439e-01   +3.179397519820509e-01   +3.349972801125753e-01   -1.146218455814724e-01   -1.692408329344738e-01   +5.321457044087896e-01   +4.454046962192448e-01; -3.594582766827795e-01   +5.276981798189299e-01   +3.478432004561274e-01   +3.040885641561080e-01   +1.498809076856646e-01   +7.374026169541614e-01   +1.689468729154924e-01   +8.233469951011345e-01; -5.679647338013517e-01   +4.363282380908363e-01   +1.601347713196810e-01   +2.919990567584027e-01   +4.559995230901830e-02   +5.761879854775549e-02   +3.966748001708641e-02   +2.163407021876939e-01; +2.262606019749798e-02   +1.278406010593744e-02   +5.977155789326497e-01   +1.977148471243674e-01   +3.389229758405261e-01   +2.784263349809630e-01   +2.303037920547022e-01   +1.129450844482742e-01; +2.680295938403439e-01   -2.803601163540808e-01   -5.600321370743485e-01   +4.942870549059380e-01   +1.130220439037637e-01   +1.157789343253705e-01   +1.356089743289341e-01   +4.915028088982601e-03; -3.884105482317282e-02   +7.265208371821489e-01   -1.061517903476582e-01   +1.777364942053538e-01   +6.499630912436527e-01   +6.219351763172692e-01   -3.678016619093076e-01   -3.050175312442178e-01];
L3I_L3E_iAMPA_netcon = [+1.731435302620530e-01   -7.297506934830416e-01   +3.654275497298728e-01   -2.110267786102887e-01   +1.686200359661980e-01   +4.707310521401391e-01   +2.051107615425418e-01   +3.014631983593665e-01   +6.008649284707098e-01   -1.214371581590596e-01   +2.010105986155410e-01   +5.765850704183415e-01; -1.477450886427721e-01   +4.522262849258776e-01   -5.712922733245661e-03   +3.902038594247227e-01   +3.084245253573835e-01   +6.509290215503630e-02   +6.490982291746459e-01   +9.914213358298487e-01   +4.403003578724776e-01   -1.230036604469493e-01   -1.154535468286286e-01   -3.046326989170181e-01; -4.570026402165132e-03   +9.405664775973717e-04   +3.378525880486162e-01   -4.746034538692474e-02   +7.663496466235035e-01   +8.812829796587274e-02   +2.576655160599678e-01   -3.559492184357901e-01   +3.084131223461569e-01   +3.087641568924996e-01   -2.809867932099684e-01   -2.457893672830870e-01; -6.474314857335442e-02   -2.092710321285939e-01   +1.129315940027284e-01   -2.011451039088610e-01   +2.751633610994397e-01   +1.610515586963698e-01   +1.426502007386344e-01   +3.207632038138119e-01   -1.316793138129335e-02   +7.705924693710586e-02   +2.428950682060460e-01   +2.642492715284710e-01; -3.152240122591551e-01   +3.389566265102075e-01   +7.152361701835535e-01   +5.761937127513784e-01   -3.123539366222606e-02   +3.260773463434898e-01   +1.701217549422480e-01   +2.317385053758148e-01   +1.768464601920997e-01   -2.432143898481435e-01   +7.020710129676079e-02   +4.467610246249584e-01; +8.897774442609364e-02   -2.322563492558388e-01   -3.692448212810940e-01   -6.567393407246991e-02   -1.756351435963555e-02   -1.831896430029442e-01   +6.109251209744880e-01   -2.588865058665538e-02   +3.503376864150268e-02   +4.433605593292689e-01   -3.955254942536067e-01   +6.259481034360995e-01; +1.580255719824298e-01   +2.524147090425701e-01   -7.949248034958485e-02   +3.491809333765440e-01   +5.245400334233867e-01   +4.692238562410737e-02   +1.123004441862897e-01   -3.266330874486599e-02   +2.285309443662095e-01   -1.115115768850146e-01   -6.704954414280667e-02   -1.987447041181439e-01; +5.001553777480948e-01   +2.922477084703377e-01   -8.355036015553856e-02   -4.708094757319536e-02   +4.047507321400776e-01   +4.697011789350615e-01   -2.965814843551722e-01   +2.037198700948360e-01   -1.450862023026813e-01   -1.486564939133201e-01   -3.799551374492688e-01   +3.951630192997715e-01; -3.386405822017126e-01   +5.237587244731701e-01   +2.466811684315132e-01   +6.644147821518703e-01   -1.558084604575385e-01   +4.556185936934389e-01   +3.487125688634891e-01   -9.790596867606267e-04   +2.228626079017455e-02   +4.362384928735669e-01   +1.907065233796314e-01   +3.264035125301606e-01; +8.250461252228954e-01   -3.468197487656425e-01   +2.623878141107673e-01   -3.417796704170296e-01   +1.146753777413783e-01   -1.017114460565055e-01   -8.305373310862713e-02   +3.249087901548777e-01   +2.735878408182093e-02   -1.542390382540109e-02   +5.259990114108161e-01   -3.714797002283558e-01; -1.074173268871778e-01   +5.279260918084372e-01   +5.279701200081844e-01   +2.218531508692432e-01   +3.950247411223905e-01   +2.282950710061188e-01   +2.603999644994168e-01   +9.562592835530787e-02   +2.138976546212691e-01   +1.967596262884290e-01   -3.845795171319967e-01   +5.172448154957190e-01; -1.969226950906964e-01   +4.468385830461515e-01   -7.154380439367412e-02   +6.034471490664823e-01   -5.822444534275570e-01   -3.184160401131535e-01   -2.069038625249745e-01   +4.875050457006757e-01   -4.715784215089920e-02   -9.512137939964908e-03   +1.203183981040893e-01   +8.305676580663798e-02];
L3E_L3I_iGABA_netcon = [+6.884953641978211e-02   +5.590273118158712e-02   +2.786472452390429e-01   +2.142861870282700e-01   +2.083317337500385e-01   -1.326344745836150e-01   -1.455792039178292e-01   +2.600446890465449e-01   -2.122732506025107e-01   +7.524161283535068e-01   +3.707949623816014e-01   +5.024680414031923e-01; +3.921597154894135e-01   -2.557628817232026e-01   +1.992974687612592e-02   +3.808635331978346e-01   +3.398954947621520e-01   -3.918661287829514e-01   +1.415246269601397e-01   -5.742927753919727e-02   -2.459146707446809e-01   +1.749652171379992e-01   -7.313615442935225e-01   -6.825391827301866e-02; +4.346080994176465e-01   -2.890747019662908e-01   -3.846728806670514e-01   -4.459173222116562e-01   -2.529485557587903e-01   +3.406589387303899e-01   +3.883248469131481e-01   -1.647809459254156e-01   -4.311992851068759e-02   -1.811015263502374e-01   -9.095750625888482e-02   +2.722517461608120e-01; +2.249012621950417e-01   +6.503647559005944e-02   -1.122404040219586e-01   +3.921615376289425e-01   +8.304010337911031e-01   -2.825865448416209e-01   -1.663921896819633e-01   +2.594625600709570e-01   +9.997382804274438e-01   +1.398573516247370e-01   +5.719689025426273e-01   -6.510402270725327e-02; +2.869621925078008e-01   +3.294907762076638e-01   -1.805815238601050e-01   +5.080818965771617e-01   -1.136138428425422e-01   +5.057003582556370e-02   +3.843968301656235e-01   +2.510525204687026e-01   -4.109514721528629e-02   +7.326136838865105e-01   +1.913915553519297e-01   +5.131828745308897e-02; +2.118232832749777e-01   +2.861942803157622e-01   +2.308572392302432e-02   -3.145361850279657e-02   +1.966139603040169e-01   +8.555574067894162e-02   +1.414753231863281e-01   +2.303360474035843e-01   +8.965391744157093e-02   -2.093339683078099e-01   -9.342875175190463e-02   +1.130776316870974e-02; -3.256345502511604e-01   +2.252743850553467e-01   +1.920174445036016e-01   +7.564109162693646e-01   +1.720311151030345e-01   +2.644123782058992e-01   +4.840599045034649e-01   +6.469375617500889e-01   -2.258095042028088e-01   +5.180810179526005e-01   +4.079746548932418e-01   +2.684623944340104e-01; -7.664150132602343e-02   +2.525351639373069e-01   +3.251080504851907e-01   -6.976627151766514e-02   +1.981713436884704e-01   -3.165008949104084e-01   -7.604799558090242e-01   +4.789891819734872e-01   -1.212104268700892e-01   -5.047537068542277e-01   +3.527534797059998e-01   +3.093408129186005e-01; +4.399438970217791e-02   -3.357805277119861e-01   +4.812096856927043e-01   -3.000948131343075e-01   +3.099507266366586e-01   -2.701414249949959e-01   -7.620691833499365e-01   +1.985652294597565e-01   +3.225951856408112e-01   +5.717915353858475e-01   +6.363523986040620e-02   +5.143266534001192e-01; +2.842104522465678e-01   -1.707589907728603e-01   +2.638941985361844e-01   -1.586541852671740e-01   -3.515988643880068e-01   +2.186128384304656e-01   -5.616218076203161e-01   +3.623323124024329e-01   +2.018542845766488e-02   -2.361579284001955e-01   +4.467357942078510e-01   +1.215226601071158e-01; -5.130643481771111e-02   -6.150182273644962e-02   +3.306163550698575e-01   -4.523112905343340e-01   -4.518097764121871e-01   -1.911637448058421e-01   +3.761986883215265e-01   -9.126772252328602e-03   +2.628714401689970e-01   -4.651938780806678e-01   -1.187131579342376e-01   +5.698499086223376e-01; +1.080301069981417e-01   +1.924455166513009e-02   -2.891759498999394e-01   -1.585280056650631e-01   +9.164417192888566e-01   -1.553551993732078e-01   +5.064410686830265e-01   +4.819676651460879e-01   -1.583995543047168e-03   -4.318454079395411e-01   -7.677919682640297e-02   -4.889245298248876e-01];
L2E_Input1_iAMPA_netcon = [+8.677422231534518e-01   +9.144112627082052e-01   +7.002500837888278e-01   +4.963670961397584e-02   +3.976336495343883e-01   +1.051668982109969e-01   +6.229739412556259e-01   +4.202313739312726e-01];
L2I_Input2_iAMPA_netcon = [+5.100219552071706e-01   +8.427261007734310e-01   -4.023335674331929e-02   +1.364358411416925e-01   +1.725428580408846e-01   +4.124305372123329e-01   -2.381312624280211e-01   -1.140396323232284e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
