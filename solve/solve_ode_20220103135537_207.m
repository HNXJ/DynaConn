function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.686538582762294e-01   +7.563595466559002e-01   +8.596308931725980e-01   +2.392474529636392e-01   +2.730727330594014e-01   +6.768144832415619e-01   -7.413745471869937e-02   +3.747183928864648e-01   +2.477937510147558e-01   +1.728083944108593e-01   +3.844134122283100e-01   +1.694217746537386e-01   +4.597269648362632e-01   +2.544083775848587e-01   +2.222148724834166e-01   +2.596665570690606e-02; +8.742527768654418e-02   +8.934321811076250e-01   +7.880192142759002e-01   +7.204745327841841e-01   +2.957490507429623e-01   +6.582242195390278e-01   +6.652704607778946e-01   +1.808575736894900e-01   +1.185985603413254e-01   +7.126248737358994e-01   +5.250428482814916e-01   +6.157630122071917e-01   +3.922136972211711e-01   +2.522154859878046e-01   +5.689558127774225e-01   +2.781192483043458e-01; +2.424687142306318e-01   +2.823286555702966e-01   +3.973453252718618e-01   +4.589807087193856e-01   +6.258911257045856e-01   +4.146117209411594e-01   +4.159980685828691e-03   +6.137601726878665e-01   +2.922039087174514e-01   +4.978681529911246e-01   +7.479453514313130e-01   +2.622103899430027e-01   +3.763772533377402e-01   -3.890670457456794e-02   +3.230623990934629e-01   +8.565606696621182e-01; +2.155837628118362e-01   +6.182782759512444e-01   +1.088613058933434e-01   +2.300874149881107e-01   +7.868368317311262e-01   +7.996523480047912e-01   +2.083220467341146e-01   +5.624239091528406e-01   +6.763599113697537e-01   +1.990649909286786e-02   +1.756306111605730e-01   +7.925591352909562e-01   +4.890907198875831e-01   +2.218391477894743e-01   +5.397255569805161e-01   +4.374949217880876e-01; +8.343502725910459e-02   +6.807783711982868e-01   +7.649564557193116e-01   +7.428280949260626e-01   +4.719990264384299e-01   +3.332973953817169e-01   +4.633186854924495e-01   +3.286361592110891e-01   +3.408081339242510e-01   +4.662458998827709e-01   +1.942820248221960e-01   +6.272601090688789e-01   +3.511001215860125e-01   +7.356088825861984e-01   +1.983650165746219e-01   +8.469636544880724e-01; +1.429918332300916e-01   +1.711392573125443e-01   +7.068763732717946e-01   +7.636581500408103e-01   +5.373985574446407e-01   +7.977993512689349e-01   +2.722100776489224e-01   +3.926915091842442e-01   +8.159966378856611e-01   +8.389558111151457e-01   +8.085060883294984e-01   +1.148736783580814e-01   +3.952399979535439e-01   +1.299200825250833e-01   +8.499788852192870e-01   +3.747212695467910e-01; +3.169258844327544e-01   +6.589336192793991e-01   +6.238061221004614e-02   +3.346869237247608e-01   +7.442458420137575e-01   +5.038860086842271e-01   +4.243172181081284e-01   +5.261017314765877e-01   +8.730119862800262e-01   +8.508830078548010e-01   +5.872024411252117e-01   +1.391672581224986e-01   +3.297721691982952e-01   +4.058338009243552e-01   +6.620260801106328e-01   +8.055603565881678e-01; +6.181109579195797e-01   +6.740428707054069e-01   +7.393429730888593e-01   +3.508361726191062e-01   +5.529442928495619e-01   +5.368160746233072e-01   +1.065525446046227e-01   +4.241712557295177e-01   +1.000000000000000e+00   +7.976418929046126e-01   +1.307385801044579e-02   +6.853094469997074e-01   +7.367568769504571e-01   +5.418900388078476e-01   +2.599079796455918e-01   +8.100636370224071e-01; +4.381234116984711e-01   +2.928734958491943e-03   +2.152620918161217e-01   +3.149201865566111e-02   +3.950857293626054e-01   +1.259298754225822e-01   +1.108972519241245e-02   +5.031202558288964e-01   +4.771566798902939e-01   +7.292608394645120e-01   +7.071879119911432e-01   +4.725432862944611e-01   +2.129250201390575e-01   +1.722090497613769e-01   +8.948548010597613e-01   +7.805162816207488e-01; +6.176745818142882e-01   +4.977660680433486e-01   +5.416145192956873e-01   +2.500548704780685e-01   +4.352897387125433e-01   +2.293014484957356e-01   +2.460942104195295e-03   +2.198119366394802e-01   +5.874663014499436e-02   +7.278196116236392e-01   +1.921647571334796e-02   +1.169661713445670e-01   +3.242877914818595e-01   +7.335080103564342e-01   +3.027200066491320e-01   +6.966565823328760e-01; +3.307890156725735e-01   +4.268877906174093e-02   -8.964148334101760e-03   +1.947542166951931e-01   +8.271581881965442e-01   +5.581326192390775e-01   +2.049281061866970e-01   +1.594450529521658e-01   +1.756152889725905e-01   +8.205614452002733e-01   +1.184507348655115e-01   +7.219081203159426e-01   +5.018763481279359e-01   +7.499164184423953e-01   -2.176214250510804e-02   +5.078106913246916e-02; +1.321664422964387e-01   +2.981870083919952e-02   +8.823632365592217e-01   +4.716336136943828e-01   +6.014702730755802e-01   +4.745167732716983e-01   +6.325047789421077e-01   +3.284409716055894e-01   +6.178350958910180e-01   +1.032417052830525e-01   +2.533436591450421e-01   +7.261770421300087e-01   +2.760766069109578e-02   +5.119418311121774e-01   +3.548968132862448e-01   +4.704880859753575e-02; +3.658906234071044e-01   +3.188867953789702e-01   +6.040082822952517e-01   +2.503347947355560e-01   +8.531197577630660e-02   +4.551606830379555e-01   +3.683599831654914e-01   +6.314529062833516e-01   +2.924603387806064e-01   +8.904295448771783e-01   +2.002057111895768e-01   +4.243923930295988e-01   +2.249903407686484e-01   +2.152242918743880e-01   +2.729477258586147e-01   +1.691814995016932e-01; +1.509768731741954e-01   +8.650906096056746e-01   +6.705933048931760e-01   +6.507223090568822e-01   +7.403209703743430e-01   +5.295156203834152e-01   +2.231207602092630e-01   +7.471164786096963e-01   +3.749424335434666e-01   +4.456759842263744e-01   +7.293802715794817e-01   +6.027756897847022e-01   +5.153293067535890e-01   +4.601067079024024e-01   +8.149413334026760e-02   +3.770672259174679e-01; +1.432387411416749e-01   +2.158982127143610e-01   +9.540045242508635e-02   +3.825310683505171e-01   +2.935200153713924e-01   -9.776378085913378e-03   +6.044195629036601e-01   +2.574349708285050e-01   +7.523543997731688e-01   +4.224695572688950e-01   +7.543324722470184e-02   +7.157921069472044e-01   +5.445916210092502e-01   +1.641973701938566e-01   +6.491785455636044e-01   +1.345689738494962e-01; +5.224745539822778e-01   +1.796696889120013e-01   +3.239022975859470e-01   +5.819381203609071e-01   +4.926060325089919e-01   +5.606899539585811e-01   +1.989815023782624e-01   +7.432956974570597e-02   +5.563967552866731e-01   +3.976017294654617e-01   -4.009989851104982e-02   +3.598251663173688e-01   +1.702360476492088e-01   +8.676706563000094e-01   +8.576631627649763e-01   -1.033889081740533e-02];
L1E_L1I_iGABA_netcon = [-1.231275316691901e-03   +2.736629976809064e-01   +9.047066137622158e-01   +1.541035261642985e-01   +4.333164903940855e-01   +1.151269853429363e-01   +2.613323449003452e-01   +3.366416412807152e-02   +1.914728390093189e-01   +9.817769445251628e-02   +4.155083638934200e-01   +9.381256800535398e-01   +1.989409524074171e-01   +7.445885169052000e-01   +1.022902928400841e-01   +3.688465468063773e-01; +7.906048210697293e-01   +7.582678223281780e-01   +5.463413817154221e-01   +8.258424977974559e-01   +6.561408942441319e-01   +7.724427733425342e-01   +5.811928176937132e-01   +7.829711446230295e-01   +8.597534532800940e-01   +9.421205739682739e-01   +1.803957329732342e-01   +1.290266859975541e-01   +5.747480033363461e-01   +8.609632874701330e-01   +9.836483214851640e-01   +2.307019733278053e-01; +2.372444445812479e-01   +8.115447114952993e-01   +1.055228049322110e-01   +8.915470948946903e-02   +1.447400988788859e-01   +2.569705696962429e-01   +5.578299110040003e-01   +4.340377581688883e-02   +3.110353013404526e-02   +1.198838976191160e-01   +5.176300237900823e-01   +4.156227690623854e-01   +7.448420582262201e-01   +7.643080377315515e-01   +7.621502487305036e-01   +7.621640122085115e-01; +3.542321294142581e-01   +5.523016342223996e-01   +6.132511224535563e-01   +7.171597121159560e-01   +6.740715341376678e-01   +6.077074514677334e-01   +5.723982571177056e-01   +8.504041260417952e-01   +1.160304627120489e-01   +2.760148307955305e-01   +4.810293459534931e-01   +3.184125281614712e-01   +7.788407126351513e-01   +4.341706279205605e-01   +8.938384606090910e-01   +5.080096806668806e-01; +7.014929733813804e-01   +5.848106219847088e-01   +8.516980736055803e-01   +3.526192285153341e-01   +9.095326813988501e-01   +5.061491832518400e-01   +3.674419930414591e-01   +4.658570692925296e-01   +3.048803378495063e-01   +1.913080280618465e-02   +5.551059335056203e-02   +5.695828574754327e-01   +8.765677573250499e-01   +7.943085980501509e-01   +2.524845422678592e-02   +1.198250051708299e-01; +2.281773343441723e-01   +5.770173489336569e-02   +3.330140669903274e-01   +1.829020724731920e-01   +5.966257587015936e-02   +4.526343756203702e-01   +8.135745545738110e-01   +3.207302604116004e-01   +5.444917497319423e-01   +4.361280824516294e-01   +8.716343807749604e-01   +1.646626793569898e-01   +2.332440250796158e-01   +2.179887137828132e-01   +6.938830784478481e-01   +3.148180897571335e-01; +6.643571781180073e-01   +5.157787673048837e-01   +2.893507545336145e-01   +7.625366056969697e-01   +3.007835816935508e-01   +8.259317403208050e-01   +6.291156893417796e-01   +5.219326736672960e-01   +7.743285689507655e-01   +5.922015809860226e-01   +8.162216240760964e-01   +2.415864014961172e-01   +8.053701664150894e-01   +5.777223321758777e-01   +9.314790364679739e-01   +7.637678224609665e-01; +9.330231988804525e-01   +1.274094671566480e-01   +5.998118146687137e-01   +4.741025965618484e-01   +6.908791523002712e-01   +1.888108843716509e-01   +3.562501887370575e-01   +5.543219919428766e-01   +1.781933088341066e-01   +8.145244056086516e-01   +7.036594229146422e-01   +8.020500451048163e-01   +2.585272880833762e-01   +6.572832890100130e-01   +4.925073360721113e-01   +5.771874663320412e-01; +5.559577209235990e-01   +9.621998049079304e-01   +3.898242818317464e-01   +9.009311076317137e-01   +2.207875040815072e-01   +6.660848082842202e-01   +5.704886273480737e-01   +8.909208052895710e-01   +8.670266404828521e-01   +8.904156309420450e-02   +1.576756678200519e-01   +1.749725417104482e-01   +8.722609144914599e-01   +3.304033643054986e-02   +6.587065911107737e-02   +4.470942727731215e-01; +1.872862572529075e-01   +3.394068235059488e-01   +5.147326099793044e-01   +2.219175656544721e-01   +9.031697924776126e-01   +3.889211462921359e-01   +3.030822307240072e-01   +8.887454990925550e-01   +8.599582826720640e-01   +8.604323290914772e-01   +8.090580810860029e-01   +9.427870838175078e-01   +4.901824430191195e-01   +3.797808770960528e-01   +3.164732996296338e-01   +7.578698092363083e-01; +1.614394497283027e-01   +2.140302135610685e-01   +7.313816334472503e-01   +8.305214519293777e-01   +1.997429407629965e-01   +6.152903083402679e-01   +4.184337733154541e-02   +4.613099339298624e-01   +3.979888123262642e-01   +6.325878112652797e-01   +3.624929429753266e-01   +8.729504310839481e-01   +8.652257219118104e-02   +4.762062953552359e-01   +4.609226399375320e-01   +3.982144740361606e-01; +1.769861245268672e-01   +9.166295988357319e-01   +7.211552522927440e-01   +5.261377092570115e-01   +4.420023977464562e-01   +8.379119734417609e-02   +1.731940368467469e-01   +3.692409245717214e-01   +1.657940277310373e-01   +5.105980764827902e-01   +2.023769579577658e-01   +3.713215872864508e-01   +3.597905885034897e-01   +8.678112073114292e-01   +3.427208043096231e-02   +4.789904561873654e-01; +8.864698597784572e-01   +1.424644284751300e-01   +4.850879882953181e-01   +5.015094782282438e-01   +6.002924730008000e-01   +5.701529483350206e-01   +1.855042579702962e-01   +4.665228254066452e-01   +4.270584109147300e-01   +3.444607534372899e-01   +9.022511098582575e-01   +9.259997498989357e-01   +7.899813028045918e-01   +5.494952229473059e-01   +2.267967363435258e-01   +7.227648504164421e-01; +4.514338188332102e-01   +8.193416304543396e-01   +3.334459562151574e-01   +3.838319349634329e-01   +6.951637881749750e-01   +2.039794963033980e-01   +2.778432193452374e-01   +5.628805637619840e-01   +3.328757284803717e-01   +4.595511877199197e-01   +2.060271888452227e-01   +1.613820722706052e-01   +2.755653310006114e-01   +2.369691503916650e-01   +5.329172371665907e-01   +8.869589133944468e-01; +5.567733919856545e-01   +5.887548532753659e-01   +6.886646771488724e-01   +6.348167002727886e-01   +6.676662971997790e-01   +1.066306408144444e-01   +8.313674347544024e-01   +2.497566609421349e-01   +8.247219293743021e-01   +4.945224331767539e-01   +7.091810998028081e-01   +5.226923829708747e-01   +3.009553869445013e-01   +4.868623275340885e-01   +8.298014069535253e-01   +4.355549905980565e-01; +3.392697073879057e-01   +5.980600059792055e-01   +5.911535869744334e-01   +2.303791684848392e-01   +4.312499626200178e-01   +3.090358990827315e-01   +5.134732701987342e-01   +2.080210849517500e-01   +8.350911862722283e-01   +2.495825360719262e-01   +2.617978230091212e-01   +1.604950864738917e-01   +3.819972234867463e-02   +4.261296151673052e-01   +9.519515104040978e-01   +9.301412904425317e-01];
L2I_L1I_iGABA_netcon = [+6.615371471884979e-01   +4.461548416782432e-01   +6.892347938268184e-01   +5.754171434441188e-01   +9.628585034889225e-01   +6.320007251415211e-01   +9.241352701493133e-01   +9.584385492016063e-02; +4.512521746243963e-01   +1.517753495027109e-01   +2.183968912514720e-01   +9.495165714163067e-01   +2.275444579319246e-01   +4.836035879883847e-02   +8.353230549672606e-01   +6.548043891190689e-01; +1.000000000000000e+00   +5.262741389636257e-01   +6.264569228533940e-01   +6.850146594911534e-01   +7.547964681232886e-01   +6.413588859550732e-01   +2.683615912888824e-01   +2.564457863529344e-01; +3.720574128553980e-01   +1.852534942820011e-01   +8.818451912848813e-01   +4.404902723240731e-01   +7.557704023864625e-01   +3.566457285800883e-01   +9.530737952541416e-01   +1.684593921353070e-01; +6.916032038812756e-01   +4.755308192269130e-01   +6.419850794752634e-01   +2.181826398538823e-01   +9.302179555305565e-01   +3.550426192933996e-01   +5.504924368915601e-01   +2.336425179279956e-01; +5.939919054306090e-01   +5.686255940646449e-01   +7.436935751148239e-01   +1.557678157655812e-01   +2.319403815253671e-01   +8.075042966263338e-01   +8.713753751736615e-01   +5.038767422393136e-01; +7.947736948744946e-01   +4.806560033656141e-01   +2.173795513852701e-01   +2.748776099082018e-01   +7.270510325797105e-01   +1.696392406736165e-01   +6.603406051396963e-01   +3.620302329183421e-01; +9.630727012685308e-01   +4.209895162220242e-01   +6.322118549584835e-01   +8.500721068117395e-01   +1.061645166827227e-01   +4.603204554557164e-01   +4.487642297000852e-01   +2.617651468306731e-01; +7.775765297971534e-01   +1.452251847639036e-01   +4.434155407161967e-01   +1.833655367705407e-02   +7.359526413318196e-01   +3.667866336807950e-01   +7.119857726487668e-01   +7.141880864958523e-01; +4.540441036348110e-01   +7.730867192351761e-01   +5.942773858964435e-01   +7.808663082938351e-01   +3.659423218821612e-01   +8.215809651665578e-01   +8.208997251444997e-01   +2.427990858513395e-01; +5.522473454076873e-01   +5.478174456686993e-01   +5.384345180342071e-01   +3.390190815589326e-01   +7.016151399180036e-02   +8.734353176082694e-01   +5.840736781657125e-01   +4.633179579222095e-01; +6.530191671367885e-02   +3.816146772123798e-01   +4.067756730170716e-01   +4.310857156839850e-01   +3.694639774016809e-01   +4.502133449053993e-01   +2.774942119417385e-01   +5.349251307173266e-01; +3.759560600374153e-01   +1.518930431145428e-01   +6.729668369747051e-01   +7.414210853600058e-01   +1.872245644575390e-01   +6.757440642560213e-01   +3.617881333955993e-01   +6.979279152960325e-01; +5.103729577632152e-01   +4.716541011202467e-01   +6.480466589467869e-01   +3.560011402347624e-01   +7.891045625319536e-01   +3.716588346346715e-01   +3.769224701335371e-01   +3.074050692016039e-01; +5.604762734702733e-01   +1.506613699444894e-01   +2.212478250261457e-01   +2.300462487142044e-01   +6.114734043804082e-01   +5.557418313550400e-01   +2.427908656583180e-01   +7.191761625205136e-01; +7.508164241088241e-01   +7.368108219358827e-02   +6.811834219811413e-01   +3.707542338154317e-01   +3.674556108651237e-01   +5.260308872351235e-01   +1.741945971787130e-01   +3.343134983010474e-01];
L1I_L2I_iGABA_netcon = [+4.901557496932212e-01   +1.845299175570805e-01   +8.382985991704441e-01   +2.946701352247744e-01   +5.036237139642883e-01   +2.591705907251562e-01   +8.376604151912376e-01   +2.251847768388014e-01   +4.760369274057509e-01   +8.163899298359638e-01   +3.687034239805569e-01   +3.867356155041898e-01   -6.332744568722005e-02   +6.812271330807751e-01   +6.136613750684228e-01   +4.601256985447615e-01; +5.532829598201126e-02   -5.245158299964112e-03   +3.174586652183899e-01   +2.782313029737657e-01   +8.794580753725726e-01   +3.951167977403423e-01   +3.013473427826754e-01   +1.660148772946521e-01   +4.628589908836525e-01   +2.168634663911485e-01   +3.157045726453335e-01   +2.473928678252098e-01   +9.779401784586422e-01   +2.116891699051014e-01   +7.654332404743373e-01   +2.594761427583482e-01; +3.630415642816077e-01   +6.187974367447791e-01   +2.860756848427670e-01   +6.786335781863906e-01   +2.620844264880917e-01   +5.805079024243067e-01   +7.551350411631724e-01   +8.577914229070105e-02   +7.379564430826027e-01   +4.833199569125777e-01   +5.720355885260524e-01   +8.757170087929421e-01   +9.807532939858997e-01   +6.542991585921538e-01   +3.788538379091789e-01   +2.032826934964823e-01; +8.475537423658267e-01   +8.191693896724027e-02   +6.650762581311362e-01   +9.288580220035099e-01   +4.441172831598768e-01   +8.731191425611118e-01   +6.428819491996096e-01   -3.787507982250760e-02   +7.810891891587637e-04   +3.127478560750667e-01   +3.765565348735819e-01   +4.321082083901115e-01   +3.093356572673022e-01   +4.884682446523690e-01   +1.914919591743499e-01   +1.160352831154208e-02; +9.059936765915494e-01   +8.190744642565051e-01   +7.682067081533642e-01   +5.776759065694456e-01   +3.001737530693621e-01   +6.500011863720844e-01   +6.433041271762477e-01   +5.869737061970718e-01   +1.117577407002504e-01   +6.656914781291907e-01   +2.088861164267740e-01   +4.815970067017378e-01   +6.052760755790909e-02   +2.210852496292769e-01   +6.863522894692594e-01   +9.401558571295670e-01; +5.541986978291691e-01   +4.662164516272027e-01   +1.318097691341301e-01   +3.167067014826646e-01   +8.733301242831101e-01   +1.738420925305319e-01   +7.159104246254924e-01   +6.128054235483796e-01   +4.829034591125608e-01   +7.246061563257512e-01   +2.888347278864873e-01   +4.935080160813993e-01   +9.046088363540812e-01   +1.034271871236737e-01   +2.216071096775313e-01   +5.223286051512823e-02; +8.785067851619812e-01   +1.110116428731052e-01   +4.064320062034947e-01   +3.398466339286519e-01   +5.463306490502658e-01   +8.429843770898343e-01   +7.221320584839945e-02   +2.719780214407351e-01   +7.540424268570143e-01   +9.261877511303371e-01   +8.677762042069884e-01   +8.290777928190554e-01   +1.346999315272189e-01   +2.343599313780608e-01   +3.532861609695875e-03   +5.582040188242293e-01; +9.177373919881190e-01   +3.692709918995899e-01   +1.485179514795431e-02   +8.853973328188257e-01   +1.687355119875103e-01   +9.612340431826660e-01   +7.612150698317852e-01   +7.280059056929569e-02   +7.631244293392857e-01   +1.914044725539312e-02   +8.801090071978888e-01   +1.011167904403600e-02   +8.271613514297074e-01   +8.297854928328421e-02   +9.564353946431212e-01   +6.974990185001879e-01];
L2E_L1E_iAMPA_netcon = [+3.182156350915487e-01   +9.345395615365604e-01   +6.553979828446189e-01   +1.809180556623118e-02   +3.381531417370814e-01   +3.450801812557020e-01   +5.749782822661376e-02   +5.864870123801056e-01; +2.082530113521087e-01   +1.367100663692345e-01   +7.675954649863687e-01   +8.722823231400058e-01   +3.607211715987484e-01   +5.169113105376988e-01   +2.105578253782883e-01   +1.030349255051005e-01; +4.717943419526972e-01   +8.720943689378066e-01   +7.481460263277001e-01   +2.423620321116234e-02   +6.558413902078106e-01   +3.271579187863436e-02   +4.209452696664270e-01   +8.401518990806329e-01; +4.410062031961482e-01   +6.551380690553497e-01   +5.311624826654907e-02   +5.737271601422542e-01   +2.639784444787963e-01   +5.876134283885465e-01   +1.410936897149292e-01   +4.704150978861872e-01; +8.420038935929048e-01   +6.800968652944605e-01   +7.557567622419962e-01   +5.251936965022753e-01   +7.247209606392557e-01   +3.940059526457009e-01   +4.026648092099029e-01   +5.413701178866512e-01; +4.921918011388645e-01   +6.495608107831149e-01   +5.450642855539738e-03   +6.436724158544052e-01   +6.493945148426280e-01   +8.357912167980230e-01   +3.179573772171275e-01   +9.067777563138596e-02; +4.093999648027516e-01   +3.240147419466854e-01   +2.451400273233756e-01   +3.879475717346043e-01   +4.157778449208633e-01   +2.345231965224883e-01   +5.606295635121441e-01   +2.544719444914276e-01; +7.337119876499884e-01   +1.934342282425145e-01   -6.692737325988812e-02   +9.634705076031164e-01   +5.430897867041096e-01   +3.888494371438249e-01   +5.957972241188602e-01   +6.379314562482686e-01; +7.870321071065254e-01   +5.809618839587585e-01   +6.723930346949576e-01   +1.304840642667845e-01   +3.786838568554321e-01   +2.524554150571118e-01   +7.512693163251399e-02   +9.925065832562855e-01; +1.781073394612700e-02   +1.789975801938316e-01   +1.596336702231389e-01   +1.917354836689524e-01   +1.528626261253126e-01   +5.450128489947760e-01   +8.461157960310801e-01   +8.726190626661157e-01; -1.671882291871858e-02   +2.445448052116438e-01   +5.540617985038258e-01   +4.025738853928806e-01   +1.717269445715034e-01   +4.668916171394873e-01   +2.357279303510113e-01   +6.997026725922990e-01; +3.350543469859344e-01   +5.927121884815159e-01   +5.979279550927246e-01   +4.514958550900072e-01   +6.749667359662023e-01   +2.881120436691334e-01   +6.970719160239630e-01   +4.889252592466019e-01; +6.955584317216318e-01   +7.237509278388804e-01   +5.607791804130945e-01   +1.781624584003911e-01   +2.106806670645054e-01   +1.228846248005763e-01   +6.433162918676934e-02   +5.245911483770080e-01; +7.008185956719650e-01   +8.081277159968193e-01   +6.001560150760188e-02   +9.179128549902382e-01   +5.215017484932583e-01   +7.925315043635724e-01   -1.102467319265397e-02   +1.750370388077292e-01; +9.670840271938315e-01   +2.049829318422644e-01   +5.103417121556287e-01   +6.124499648055410e-01   +3.117424156233162e-01   +2.013126844335911e-01   +6.439700353252288e-01   +4.560141916662251e-01; +7.831210193197451e-01   +6.072841191729453e-01   +7.384225994902203e-01   +3.883557710271355e-01   +4.856852410191961e-01   +8.240298267101089e-01   +7.004941166972726e-01   +1.568593455416167e-01];
L1E_L2E_iAMPA_netcon = [+8.349618708165631e-01   +4.361751186511963e-01   +5.744894170643409e-01   +2.060188544278606e-01   +9.649332197618051e-01   +2.253415814767608e-01   +5.245192366256924e-01   +4.545789548902498e-01   +9.663593777836306e-01   +4.992202360111094e-01   +6.055974069439884e-01   +4.639006889217548e-01   +5.533125264897927e-01   +3.531110062864184e-01   +5.819676164390220e-01   +3.074198688033518e-01; +8.028866905767069e-01   +1.575908980536417e-01   +1.761721877591632e-01   +5.439946776460214e-01   +8.069138020543933e-01   +5.646446853780954e-01   +9.188082757835914e-01   +2.631224018307302e-01   +3.524097312931958e-01   +3.369927105069851e-01   +6.340955061333980e-01   +6.692096508170208e-01   +6.688025879376212e-01   +8.784780723316871e-01   +3.673304484867353e-01   +5.514121735190666e-01; +7.523371451077978e-01   +1.114083215257821e-01   +1.612340070296539e-01   +9.850816872923222e-01   +2.191788948248281e-01   +3.670064813540603e-01   +8.688097897833701e-01   +3.406037867821984e-01   +1.841234790329795e-01   +6.267170033082201e-01   +7.955522578659016e-01   +4.880174226554965e-01   +7.872641198736251e-01   +9.399842517903076e-01   +8.092800201422723e-01   +6.417008600849234e-01; +6.535129851609918e-01   +8.952009512871864e-02   +5.418413189515598e-01   +3.400200931309755e-01   +3.673255300002514e-01   +7.751686464862694e-01   +2.133635017180235e-01   +1.695466870576779e-01   +6.061673313860738e-01   +5.082147495502148e-01   +4.223627989262333e-01   +9.643160933812943e-01   +7.135044652816646e-01   -2.533254343387610e-03   +7.881089458082531e-01   +8.075211411872613e-01; -1.283938502952876e-02   +2.287210640660820e-01   +1.232185854408642e-01   +7.358759733013447e-01   +1.557818545206778e-01   +4.415045340963714e-01   +9.362670328446789e-01   +3.354710875151770e-01   +1.171941587368452e-01   +7.759323519729697e-01   +9.373559457919116e-02   +5.439287495444960e-01   +5.989684008523886e-02   +6.341594180879719e-01   +4.576524119892140e-01   +1.634000756871699e-01; +6.708453063379793e-01   +3.756384070228891e-01   +4.169475251362787e-01   -1.653957198241484e-01   +8.997786707507154e-01   +1.114694452070184e-01   +4.879491047518388e-01   +1.956109721574141e-01   +7.357576425376271e-01   -1.444566870734159e-02   +7.482647170814815e-01   +1.248487391723583e-02   +7.548696288863090e-01   +5.424498841511692e-01   +6.871393060624170e-01   +3.362410092026733e-01; +2.668833763903719e-01   +7.371369834062087e-01   +3.175379601745066e-01   +4.130800065275119e-01   +2.543230159339471e-01   +8.692710270578478e-01   +9.684847004003546e-01   +4.200168897470670e-01   +6.600363782301093e-01   +7.414611310819268e-01   +1.363891707018631e-01   +1.297534344798198e-01   +1.033709145963433e-01   +3.380715591931028e-01   +3.108490774654835e-01   +7.671510067396020e-01; +1.520204144981172e-01   +4.040644656972260e-01   +2.624484068139291e-01   +4.623025198941486e-01   +9.942054308667195e-01   +4.623522533353269e-01   +9.438145432199017e-01   +7.990827150428270e-01   +4.187994642267679e-01   +3.231104785977925e-02   +3.864900842588072e-01   +4.249493260510717e-01   +3.246613634764174e-01   +6.800562407648693e-01   +2.573062315247153e-02   +5.281952688029993e-01];
L2I_L2E_iAMPA_netcon = [+3.459847168235248e-01   +2.782950297275972e-01   +3.246868698955223e-01   +5.716339197757914e-01   +1.704318567067946e-01   +8.274420320612761e-01   +6.822948479564397e-01   +2.125281795887083e-01; +4.752664563777063e-01   +1.418681323845158e-01   +6.755678131763766e-01   +2.622252709566910e-01   +6.642590474070446e-01   +8.655490252851131e-01   +8.201275726186376e-02   +4.942566218569507e-01; +6.340832006478669e-01   -6.898396005554962e-02   +7.109615125418992e-01   +5.727030437164676e-01   +1.657484191092974e-01   +5.987646852130799e-01   +7.739407685679792e-01   +1.913727924407659e-01; +4.987993228377632e-01   +2.383260309088235e-01   +2.391346678957706e-02   +9.476541901502065e-01   +3.621797600857272e-01   +6.390285784769969e-01   +9.496176430216696e-01   +1.728304263896231e-01; +1.113441894802934e-01   +3.982863535721738e-01   +5.137747289459031e-01   +8.235820843167035e-01   +8.457947862478218e-01   +5.498598417996203e-01   +7.002616149115354e-01   +2.280011524166097e-01; +8.246755875825585e-01   +4.605786643917506e-01   +9.171430616940272e-01   +8.978250451276656e-01   +6.658696252923879e-01   +8.077240301269555e-01   +8.269971826010685e-01   +4.768653055739118e-01; +8.151783003820842e-02   +5.650170168808110e-01   +8.720077003368512e-01   +8.162355800718971e-01   +9.467302744073432e-02   +7.007935479097155e-01   +2.091947605702650e-01   +1.029958534481177e-01; +5.748982822985501e-01   +4.101183368357131e-01   +1.392046188805758e-01   +2.999986395904012e-01   +6.808428806877580e-01   +4.036804396147315e-01   +9.855669089455426e-01   +6.733286782198160e-01];
L2E_L2I_iGABA_netcon = [+4.523922747132622e-01   +6.214243043357454e-01   +5.655904362523417e-01   +4.123508637961346e-02   +4.394399206106773e-01   +4.998299607126064e-01   +2.587813662803038e-01   +6.920721607499631e-01; +5.000183422067442e-01   +3.157278151395176e-01   +5.306894445401963e-02   +4.933247477547542e-01   +4.292254815822063e-01   +6.463117633641564e-01   +5.325946867500599e-01   +4.115791738885192e-01; +5.713638503958068e-01   +5.613851214792137e-01   +4.224182444060318e-01   +6.465269962713350e-01   +3.172418182708037e-01   +2.965557208594933e-01   +1.515681381966416e-01   +9.199097848938105e-01; +7.015783351917109e-01   +5.651040994062625e-01   +3.866523157630211e-01   +8.405953727152193e-01   +2.104273481905238e-01   +7.159571107674426e-02   +1.637810250355767e-01   +4.217219856520772e-01; +4.726763234719353e-01   +7.890517133702215e-01   +4.830772196990273e-01   +7.276151560000524e-01   +4.070447817837827e-01   +7.622663723667444e-01   +6.090616968370715e-01   +4.057578084151129e-01; +3.644504743346932e-01   +2.561240180977568e-01   +4.247437315469916e-01   +4.083478178328981e-01   +7.633486037779709e-01   +7.807694841879982e-01   -1.432801756552336e-02   +4.319444665578939e-01; +7.751937210159908e-02   +4.479739698540032e-01   +7.906986644195627e-01   +5.220533232154101e-01   +5.058820970262702e-01   +4.422908506047925e-01   +8.991756814421012e-01   -6.465272275902496e-02; +8.852202892027001e-01   +5.606861163304827e-01   +8.442266737187692e-01   +4.675450069297764e-01   +8.850178616477257e-01   +5.210436548257195e-01   +3.051525565133560e-01   +3.132857544388567e-01];
L3E_L2E_iAMPA_netcon = [+2.465884832778487e-01   +9.215299160720375e-01   +4.611987775618436e-01   +7.292250884376262e-01   +2.006726104577838e-01   +4.017691795251904e-01   +3.075291972671164e-01   +1.033423482698574e-01   +1.355881231061988e-01   +5.243485872609259e-01   +1.481262973821771e-01   +4.754080198307278e-01; +2.563552664309214e-01   +4.438416372512501e-01   +1.721038300302089e-01   +2.029443562604969e-01   +5.092661248722175e-01   +9.332211954979690e-01   +7.119586878056833e-01   +5.482837424705467e-01   +2.338098809737356e-01   +4.462735440903189e-02   -2.383300134626404e-02   +7.781869126328964e-02; +8.045031638227926e-01   +3.656511967139794e-01   +5.561584821327175e-01   +1.531417453471729e-01   +8.162243257671752e-01   +8.901821847721532e-01   +5.534048786591513e-01   +6.436562429570825e-01   +7.334405808012385e-01   +3.201256630045353e-01   +3.700922086693341e-01   +9.074169133873938e-01; +1.228412623051656e-01   +4.584738935249749e-01   +1.996318765994034e-01   +7.745972111467181e-01   +4.768991300779488e-01   +5.361726717214168e-01   +8.482070539572240e-01   +3.028082583433286e-01   +8.019767025002406e-01   +7.750285993152025e-01   +4.318680772619943e-01   +1.450252478637381e-01; +1.945366329658889e-01   +7.237525027922296e-01   +4.421643573054510e-01   +2.206466240590734e-02   +1.490716181446112e-01   +9.177752658385838e-01   -2.394904551971426e-02   +6.706716566020858e-01   +9.223000991718426e-02   +8.482730513792377e-01   +2.627884331075837e-01   +1.944412410798176e-01; +3.223879791678243e-01   +3.861659567232345e-01   +8.314867205685643e-01   +1.000000000000000e+00   +3.858062237054194e-01   +8.623714641294280e-01   +4.467411115879975e-02   +3.495969070734607e-01   +5.058781862635198e-01   +7.800785315939835e-01   +5.823333797346069e-01   +8.219805208974257e-01; +2.628639392540293e-01   +4.616860829868975e-01   +5.553599287525933e-01   +1.450939867632056e-01   +6.462204586419368e-01   +4.964753984847089e-01   +7.082306699676730e-01   +1.325505398291944e-01   +4.182759772866365e-01   +4.175526421392379e-01   +9.588953003277042e-01   +7.320634779206922e-01; +5.545244187350168e-01   -4.082735903374387e-02   +3.530156030485262e-01   +1.191472237765317e-01   +2.313075240700295e-02   +8.946622982920210e-01   +4.075360538893921e-01   +4.559095646271549e-01   +8.779149558183610e-01   +9.885874757447760e-01   +8.819703198359219e-01   +2.780027206580344e-01];
L3I_L2I_iGABA_netcon = [-1.344942111208585e-02   +1.471109383920714e-02   +1.079021085802846e-01   +6.308272370138173e-01   +6.449832897617951e-03   +5.022414502187837e-01   +7.790096169303035e-01   +4.199001071583043e-01   +3.797403008187630e-01   +8.789972063342484e-01   +8.364021552908270e-01   +6.608999380502228e-01; +4.528411152091923e-01   +4.161974782205751e-01   +2.608375815076172e-01   -7.498054152717039e-02   +4.701561976068925e-01   +6.176905574112883e-01   +4.876196317650398e-01   +8.946360787923702e-01   +1.514593438044513e-01   +9.233389468066571e-01   +2.398992875506819e-01   +6.118156576101489e-01; +3.427705577684736e-01   +6.395768993819212e-01   +2.870231504876543e-01   +7.868293901467163e-01   +3.390189641567323e-01   +8.306493980154782e-01   +9.128293108100446e-01   +8.584108814231448e-02   +6.603178421075431e-01   +4.386183433733825e-01   +1.277753685974616e-01   +5.633442237968748e-01; +5.997051803112888e-01   +9.968738371340613e-01   +2.768258303664799e-01   +1.937393077777320e-01   +1.496548705064767e-01   +5.876367350698642e-01   +2.016095428842376e-01   +2.290049941602570e-01   +3.332359213233289e-02   +3.588341444426850e-01   +5.582168094849138e-01   +7.727894973304759e-01; +9.406094797321920e-01   +1.035807821803632e-01   +4.491036514619805e-01   +8.780205793596004e-01   +4.731669992958585e-01   +8.575351293083137e-01   +9.115933073002969e-02   +5.212936578073516e-01   +5.459667219802787e-01   +7.212987902613682e-01   +7.167463814553671e-01   +4.748163124501537e-01; +8.532977316869729e-01   +2.032155776085933e-01   +1.665216486015370e-01   +7.226216871851721e-01   +8.920680594992467e-01   +7.941102284555978e-01   +9.565699600204853e-01   +5.989148401334555e-01   +1.021717595038508e-01   +8.260268016788367e-01   +3.438352312002010e-01   +5.724424325714214e-01; +9.192135872743828e-02   +4.706793815577550e-01   +8.844768153964359e-01   +5.859755595322630e-01   +9.784270672009737e-01   +7.475428409798741e-01   +8.310931056864188e-01   +6.976366576853957e-01   +5.750458886133522e-01   +3.574661778613904e-01   +3.452571771765527e-01   +4.969336388907616e-01; +4.159465110210915e-01   +5.604521841956481e-02   +7.206212039770360e-01   +1.941427840579204e-01   +4.227971108751410e-01   -3.623746349000138e-03   -2.493689399824324e-02   +8.981978080953698e-01   +4.587866367093836e-01   +1.056751624437666e-01   +7.174769736459217e-01   +7.014291603336626e-03];
L2E_L3E_iAMPA_netcon = [+9.556436541009474e-01   +2.165830865828585e-01   +5.063408093806135e-01   +7.122145848102600e-01   -5.222885549786363e-02   +6.859375975290410e-01   +7.957578082011477e-01   +1.185254575278646e-01; +3.484590607358559e-01   +5.119808002122328e-01   +6.835894809612236e-01   +6.419264887184927e-01   +2.795694573208813e-01   +1.741737042584401e-01   +8.613532519158850e-01   +1.050268248083161e-01; +6.030588971198813e-01   +5.127489952601380e-01   +8.730888688923003e-01   +5.408915396801566e-01   +9.162592759320686e-01   +4.715765310321864e-01   +9.598079608367122e-01   +4.010662949746598e-01; +2.148484060769067e-01   +8.941794050542388e-01   +8.739836547024195e-01   +4.062107684757343e-01   +3.347039998328862e-01   +9.682901347398336e-01   +2.671376866585644e-01   +4.738856511665835e-01; +5.842058428267357e-02   +1.926457891644987e-01   +7.090539656070360e-01   -6.694944076377145e-03   +2.401915542669019e-01   +5.054603426599839e-01   +4.497864062047236e-01   +5.881767278722293e-01; +3.718798629523156e-01   +8.143784947896984e-01   +1.911391710961280e-01   +7.633481861506051e-01   +8.102616784357036e-02   -2.918385092252553e-02   +5.001065472688148e-01   +1.974726972331804e-01; +4.242137716841053e-01   +7.427623961304238e-01   +7.249950630709069e-01   +2.225080024562482e-01   +7.457034592569696e-01   +1.859326616609305e-01   +6.883813270047352e-01   +9.419489401477082e-01; +2.160407859665903e-02   +5.077384306448088e-01   +8.834564116174799e-01   +4.169813701746013e-01   +1.205913505179828e-01   +7.440740120464803e-01   +9.386406996849235e-02   +3.233747063430463e-01; +1.000000000000000e+00   +9.040942108070887e-01   +9.900213260444427e-02   +1.348739397319939e-01   +8.710000879108021e-02   +9.145626544270880e-01   +2.670929833332786e-01   +8.770486797470343e-01; +1.546422286307462e-01   +3.884067117142032e-01   +8.410597452270634e-01   +3.132545463331750e-01   +4.153560315951127e-01   +8.740736457882365e-01   +5.238846254924064e-02   +8.668158176533621e-01; +6.383525336197730e-01   +3.538458402039696e-01   +2.997787544766835e-01   +2.957552497471347e-01   +1.636124646058917e-01   +3.194424654435307e-01   +1.890226482674270e-01   +1.413657959028053e-01; +1.384112779008469e-01   +6.132211915224405e-01   +8.139490370422912e-01   +4.334421732941960e-01   -4.263421385046687e-02   +7.196046272054583e-01   +7.883206495424239e-01   +7.459851022318579e-01];
L2I_L3I_iGABA_netcon = [+3.671555578334201e-01   +6.779519451241593e-01   +2.964463560112385e-01   +6.364321600963423e-01   +5.140052833759015e-01   +3.755686441389872e-01   +4.032498342133536e-01   +4.445948463810765e-01; +3.424581950531491e-01   +6.485278520398956e-02   +1.903037861670690e-02   +7.914180589161782e-01   +7.039081765993926e-01   -5.648259707751417e-03   +7.675166227408875e-02   +6.452736046711998e-01; +3.196812666648883e-01   +6.006320146371846e-01   +3.603286163345025e-01   +6.106139190860697e-02   +8.032875523719927e-01   +6.545180546767797e-01   +2.245632044691629e-01   +1.133882069609439e-01; +5.928445263503657e-01   +8.404144218322442e-01   +5.522232256736243e-01   +4.890240090412883e-01   +5.348006262317625e-01   +6.487981619214980e-01   +3.991036324064116e-01   +6.861969521404642e-01; +6.438524609959043e-02   -3.149537948577756e-02   +3.751180999222208e-02   +7.121263648321891e-01   +2.182888023199324e-01   +6.252562584818883e-01   +4.427791649026839e-01   +2.654907998501148e-01; +5.744311329411186e-01   +3.793121749513763e-01   +4.417079416290978e-01   +7.074327841041710e-01   +2.548030151290890e-01   +7.816950880210584e-01   +4.910162501081313e-01   +1.161598994385189e-01; +2.456161807897250e-01   -2.572135355814936e-02   +3.976299435730575e-01   +9.776929539837450e-01   +7.220622782886060e-01   +6.341435679730849e-02   +2.544156514434935e-01   +8.327766660620880e-01; +2.147142781348329e-01   +9.009566213746046e-01   +8.804267137934982e-01   +8.858882372297588e-01   +5.107886235570531e-01   +1.206452195220673e-01   +6.201611030362552e-01   +1.100608538148324e-01; +3.106079762259140e-01   +5.226624961559870e-01   +2.327503027073252e-01   +1.582979289897274e-01   +4.124967227658466e-01   +3.297372118901116e-01   +6.086501809819564e-01   +5.044109788175274e-01; +4.306821906049393e-01   +1.548425385019547e-01   +1.937314266289074e-01   +4.100128359496389e-01   +9.492475582959088e-01   +5.246207175066389e-01   +4.765023689872250e-01   +9.585194864637415e-01; +5.669135444340594e-01   +9.704486011505031e-02   +2.581910048514209e-01   +6.026154071380821e-01   +5.106057101052413e-01   +6.827058174550172e-01   +9.246483381439063e-01   +6.054324101541240e-01; +3.533002968627125e-01   +1.821393940223277e-01   +6.339887231511933e-01   +3.299653008527003e-01   +1.250522839866345e-01   +1.145408943281336e-02   +3.307450978160454e-01   +6.225759513383221e-01];
L3I_L3E_iAMPA_netcon = [+1.157541813836774e-01   +5.908761812947324e-01   +4.441478399392929e-02   +1.634353814866464e-01   +1.961968723468334e-01   +6.478599817305859e-01   +2.052515711431737e-02   +3.581874145704219e-01   +4.893455935768538e-01   +2.971367977293026e-01   +5.406970942622591e-01   +8.463236756106803e-01; +3.540460393898224e-01   +7.476477558788359e-01   +2.691052039350371e-01   +3.148129064764518e-01   +6.952112571253886e-01   +4.302032535442646e-01   +3.771451425665997e-01   +3.560264085457122e-01   +6.083390420539123e-01   +2.360172786887192e-01   +6.529855992377607e-01   +2.334563311039168e-01; +4.296160242639273e-01   +2.874189159106219e-01   +7.064558719518512e-01   +8.488156983372621e-01   +5.297781879499338e-01   +5.977685737595873e-01   +9.728108671462066e-01   +4.491536997140601e-01   +2.645462744900072e-01   +3.429833890240286e-01   +8.382330723088918e-01   +8.308093780571882e-01; +4.724905859699084e-01   +1.036506437563489e-01   +5.396433978563686e-01   +6.854533918692727e-01   +3.973338242698319e-01   +5.867054451086851e-01   +5.526218336483343e-01   +6.495078785716812e-01   +5.185347226068028e-01   +2.076784663272550e-01   +3.667718897065502e-01   +4.781211643405517e-01; +8.819450928697375e-01   +7.434256316488960e-01   +5.144056722011918e-01   +4.228243867978990e-01   +1.889013704899714e-01   +2.737694071430002e-01   -3.769348241568239e-02   +2.547984715186856e-01   +8.938900058224671e-03   +2.097166610947386e-01   +2.916599668218058e-02   +4.295821025573490e-01; +3.595270513493395e-01   +1.568742469869013e-01   +6.182848481481255e-01   +4.395153680200138e-01   +9.727903155207176e-01   +5.932805691627649e-01   +2.518606271807464e-01   +1.301052541905300e-01   +1.683541037669012e-01   +5.458624121483026e-01   +2.808095351868684e-01   +1.011555190682412e-01; +4.810536248289370e-01   +2.341080696616871e-01   +8.211555069937118e-01   +8.192749799247385e-01   +1.445930908676457e-01   +1.562576223415545e-01   +3.862947321193280e-01   +9.145467827041120e-02   +9.008567286290444e-01   +7.079339514513012e-01   +3.494893185288207e-01   -2.916520636429516e-03; +3.567046589269669e-01   +4.187613975396273e-01   +3.373333757180936e-01   +5.981747170877002e-01   +7.987751106880410e-01   +2.180849278092628e-01   +3.426815731459646e-01   +2.675982585972234e-01   +2.939952739750584e-01   +2.632122121706971e-01   +6.258965314448317e-01   +4.896858171214162e-01; +3.435521248213588e-01   +4.473641262780916e-01   +3.904897538645224e-01   +5.710254646940611e-01   +5.433038247690882e-01   -7.590771759062202e-02   +8.444536697887151e-02   +1.098870899052079e-02   +3.249198540619893e-01   +2.207465058204794e-01   +8.150830590831259e-01   +9.019677651672781e-01; +6.940695697282435e-01   +6.018308586030759e-01   +5.845597219628816e-01   +3.859412898256390e-01   +4.894447493287409e-01   +3.803092405823541e-01   +4.036695991505192e-02   +6.727831310949459e-01   +3.898544899163575e-02   +8.256048501212210e-01   +3.851308589711583e-01   +1.184991530228985e-01; +1.162535451276532e-01   +2.645392604721354e-01   +6.063686553316880e-01   +2.240615594545915e-01   +3.259339702861250e-02   +4.980247899872507e-01   +3.143499657476401e-02   +7.057313520706229e-01   +6.543348305520966e-01   +1.965928266292371e-01   +6.269173824090196e-01   +3.074341806069298e-01; +6.292700682931442e-01   +6.746165947419109e-01   +3.977280599705638e-01   +5.872120569310519e-01   +6.319938962142736e-01   +3.422859916283062e-01   +3.103021463234403e-01   +8.467465978051385e-01   +5.497931890335270e-01   +3.365940275027680e-01   +4.775019156450212e-01   +4.169638652960602e-01];
L3E_L3I_iGABA_netcon = [+3.491822268876315e-01   +7.279435848420787e-01   +6.632821427437443e-01   +9.191247710122153e-01   +4.902826187233408e-01   +5.127290577625619e-02   +2.909211415386934e-01   +6.809730214748299e-01   +6.863015909167890e-01   +3.152792347338310e-01   +4.665493400049188e-01   +2.744921098118852e-01; +8.653044110849933e-01   +3.656997692666970e-01   +5.790038186266006e-01   +7.213254626853530e-02   +8.155362976683875e-01   +3.792361879772236e-01   +8.608849552959446e-01   +6.540795017125756e-01   +5.537495952275324e-01   +7.430143569262971e-01   +2.568799480882368e-01   +4.631750705345838e-01; +7.627140007465527e-01   +4.118974222860567e-01   +4.558303450629875e-01   +5.459073586380264e-01   +5.677246756755602e-01   +5.249680424126899e-01   +2.898381982223837e-01   +8.482741232640254e-01   +4.828417203945635e-01   +1.928420825530360e-01   +7.665870521130532e-01   +8.650230442564053e-01; +1.415722056563071e-01   +6.435046715079655e-01   +3.125325007818321e-01   +3.284597384543987e-01   +7.833817734589038e-02   +5.951998616811688e-01   +2.921859890383861e-01   +8.509661348139821e-02   +2.956143013711512e-01   +5.187472156544539e-01   +7.743493688069656e-01   +6.174383155245645e-01; +2.835875115210655e-01   +6.223856346896425e-01   +6.035900452369565e-01   +3.141238856857279e-01   +8.502107284248406e-02   +6.709096224528175e-01   +8.212042863476995e-01   +2.885652512132551e-01   +2.359665787804951e-01   +7.848010967431587e-01   +5.607515389599914e-01   +2.045691314858988e-01; +4.087484908669908e-01   +7.958808641380188e-01   +6.981207298832685e-01   +4.658712341396273e-01   +7.162874232605593e-01   +7.225186254798852e-02   +2.977825540959826e-01   +1.969141360209452e-01   +8.740751750967183e-01   +8.877247370342989e-01   +8.357146712424960e-01   +2.418653154826632e-01; +5.858059951992587e-01   +7.507295004438320e-01   +2.356902664233620e-01   +6.854519582203858e-02   +4.314193320817791e-01   +5.676316840757867e-01   +5.968454258937591e-01   +1.909525651750928e-01   +9.218468759489099e-01   +5.780128641489974e-01   -4.000384658624222e-02   +3.271273483161897e-01; +5.141970931573163e-01   +3.575408288550876e-01   +8.736317474750599e-01   +3.944597662248488e-01   +1.250430624458856e-01   +7.818273031875655e-02   +5.713430220275794e-01   +1.410915205473173e-02   +5.834709656942010e-01   +7.836567534545548e-01   +2.302810501169752e-01   +1.000000000000000e+00; +2.539645272074038e-01   +5.330014961321498e-01   +2.662469572283833e-01   +7.900774790764258e-01   +7.694488818433338e-01   +9.689459237246606e-02   +3.808583625896086e-01   +6.083702178258877e-01   +5.618843699137750e-01   +7.953439911227086e-01   +6.917396011414473e-01   +6.356398895903667e-01; +6.692556945402367e-02   +7.439735255373321e-02   +3.059986089099753e-01   +5.620266965452066e-01   +7.162179759806813e-01   +2.143698652396604e-01   +4.161028782213944e-02   +2.966619436212229e-01   +7.227922351808248e-01   +2.484319639924900e-01   +5.904357212421201e-01   +6.832052729354936e-02; +8.916033831236619e-01   +9.488071106934920e-02   +7.139756872416807e-01   +5.102110236200091e-01   +3.869774400421728e-01   +8.340060838431214e-01   +1.804028389750265e-01   +7.965075772964250e-01   +3.091522949767248e-01   +8.748946820155066e-01   +5.250224459391318e-01   +7.180272451295009e-01; +6.606777865073081e-01   +8.099166005749512e-01   +4.906081399986843e-01   +8.177929577839060e-01   +8.100122646712319e-01   +5.432956785294208e-01   +8.869304566462449e-01   +8.597848888307199e-01   +5.074916900525687e-01   +8.085260111309694e-01   +4.927920230085552e-01   +8.896318009438242e-01];
L2E_Input1_iAMPA_netcon = [+9.505028630148571e-01   +9.775160441595053e-01   +8.975456035539024e-01   +9.266440584365836e-01   +8.548924917223341e-01   +9.899023010760545e-01   +8.851629519230886e-01   +9.209231156695025e-01];
L2I_Input2_iAMPA_netcon = [+9.316408010128150e-01   +9.326124411252005e-01   +9.474997412439824e-01   +9.281739442922901e-01   +8.336452396016976e-01   +8.849383594943061e-01   +9.270587184555679e-01   +9.374462052896044e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
