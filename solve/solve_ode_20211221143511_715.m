function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+9.753430198596280e-02   -3.674020004583691e-01   -2.259026320110354e-01   -5.308968117196247e-02   +2.021334389458345e-01   +3.835673731494915e-01   +3.366928604623349e-01   -7.806844908344556e-01   +6.734720264912303e-01   -5.300653244198190e-01   -4.592940917639471e-01   -1.962698697458680e-01   +8.249193884601959e-02   +4.756587103460109e-01   +8.496558006483405e-05   +4.911977558328149e-01; +3.602535857958540e-01   +1.335136337305070e-01   +3.156831697037499e-01   -3.485174814424287e-01   +2.148100390918254e-01   -6.211370218998662e-01   +6.598355404108872e-02   -3.848182565322446e-02   -5.990393976026798e-01   +9.940438261555685e-02   +4.083227016969585e-01   -3.099511346287273e-01   -2.109584811442865e-03   +1.302765791886314e-01   +7.026191438783606e-01   -1.835147821158443e-02; +5.335127086221112e-01   +7.830522903039694e-01   +2.545029003609974e-01   -3.494812461797470e-01   +1.297744355287521e-01   +1.964909391963705e-01   +2.880502856660237e-02   +2.094073515961178e-01   +3.615972371237552e-01   -2.907482581959916e-01   -4.070688723757473e-01   +5.141243419495904e-01   +2.683656139328464e-01   +3.378156100035491e-01   -1.362835196143782e-01   -8.479142464588815e-02; -2.179882139945453e-01   -2.831234813879737e-01   +5.935975162429659e-01   +3.592259731667477e-03   -1.336865833464511e-01   -2.558888818885594e-01   -1.683843352718613e-01   +1.141669092233547e-01   -2.132369115138512e-01   +5.606584412047954e-02   -3.296458042688502e-01   -2.432649261635356e-01   -5.128688471326703e-02   +3.313375677135750e-01   +1.251988481063374e-01   -4.877345998985152e-01; +2.642308048348368e-01   +3.319443119436060e-01   +3.423119484434597e-01   +5.199903899637452e-02   -4.573650826947352e-01   +1.914218801603118e-01   -4.977130471019985e-02   +1.043021993537581e-01   +3.978720899053276e-01   +4.679223309988843e-01   -5.684539966319700e-01   +1.272845813482693e-01   -4.138785868187399e-02   -8.178262259158496e-02   -6.220021498708281e-01   -1.549708699081429e-01; +4.420875884904159e-01   -4.290125779703000e-02   -2.338286540588276e-02   -1.836094215055460e-01   -1.359885157987452e-01   +1.670123844871635e-01   -3.267629695776030e-01   +2.840062237991381e-01   -3.874060478924808e-02   -2.272377072768424e-01   -2.783151078477488e-01   -5.664545061354560e-02   -2.700049322208480e-02   +2.090681935200565e-01   +8.837312561227770e-02   +7.680817915280903e-01; -1.686189520989469e-01   -1.847623874531996e-01   +4.302583335621515e-01   +6.688410117204905e-01   -2.654760209717438e-01   +3.742681820097257e-01   -5.495361804800529e-01   +1.753523910894358e-02   -3.534258440892540e-01   +3.701597492644824e-01   -6.038278529477640e-01   +1.429402371394312e-02   -4.565370635002445e-01   -3.190795667228769e-01   -3.134250319451546e-01   -3.842221286239841e-02; -1.376373403182249e-01   -2.535691727879320e-01   -6.160967901288690e-01   -2.338233562868892e-01   +6.606910993914140e-02   +3.459663972864719e-01   +1.550518890594141e-01   +4.452685520766929e-01   +2.719674406724386e-01   +6.139514232720378e-02   +2.642607614577026e-01   -3.556632554596051e-01   +7.303678493391035e-01   +2.217237682817312e-01   -1.819040582373332e-01   +1.954761924482895e-01; -4.606409432403373e-02   +6.787169529575142e-02   +5.607684749826101e-02   -5.783678598984353e-02   +2.140539160227783e-01   +3.130580668722378e-01   -6.292822397152781e-02   +1.267651733347476e-01   -7.296818602708028e-01   -1.696013649623791e-01   +1.495421978527384e-01   +1.149857502608328e-01   +3.702432502320629e-01   -3.755367352164841e-01   -2.109609558223693e-01   -3.655838069202750e-01; -5.165672718486300e-01   +1.413439396281504e-01   -2.656162221071927e-01   +4.475570534606378e-01   -1.090996287107467e-01   -1.756867732022517e-01   -5.702841838726283e-02   -6.505036571783180e-01   +2.332770072098655e-01   +1.998315959858896e-02   +1.284818609633946e-02   -5.584245259148531e-01   +1.225119006391638e-01   -2.265470508109876e-02   +1.336021703076275e-01   -7.503045478398427e-01; -5.026079449354168e-02   +1.729875192300136e-02   +2.893800154038433e-02   -6.739701534582828e-01   -3.686841273905574e-01   +2.904617602386501e-01   -1.847282909681291e-01   -5.936000745626679e-02   +3.822151867542789e-01   -4.548583479644079e-01   +4.556258672437043e-01   -8.886009597253057e-01   -2.069091575272201e-01   +2.270580999734408e-02   +2.045217670653119e-01   -4.469235528642985e-01; +4.372255753057003e-01   +1.396993256541186e-01   -1.281389975573892e-01   -6.004381225950097e-02   -6.989541270550834e-02   +4.410684143109475e-01   +2.794137868028763e-01   -4.438589736253836e-01   -1.383567923379324e-01   +3.449923284318154e-01   -3.001331360672956e-01   -5.071997544242071e-01   +4.365985728357222e-01   -3.820818360341927e-04   -4.035670260436372e-01   -8.795983093409615e-02; +2.863578084976358e-01   +4.753226281649555e-01   +4.338036701862700e-01   +5.039832456018235e-02   -6.514704347678931e-01   +4.899940687113455e-01   +1.364894741781149e-01   +3.095317765358170e-01   +4.828156486850153e-02   +4.202713658239574e-01   -1.508359127268717e-01   +2.782176626357410e-01   +2.106912197693363e-01   -3.455351094410393e-01   +5.084031452758317e-01   +2.084352469879885e-01; -4.211560799139832e-01   +3.231838147486987e-01   -1.792119270217831e-01   +2.629659193669031e-01   -3.134229224770499e-01   +1.777043157639729e-01   +1.281537129413583e-03   -1.905358836009724e-02   +5.523510039878672e-01   -2.831897222475538e-03   -4.565452325124845e-01   +1.372268997865538e-01   -4.630361800641872e-02   -5.644664393419079e-03   -4.578984638779748e-02   -6.644017656965617e-01; -2.054492855800005e-01   +8.585924103022753e-02   +1.817352928807826e-01   +3.568605294443893e-02   +3.896439135279547e-01   -3.490595297343477e-02   +6.818108287512954e-01   -1.304905929875566e-01   +2.130148460922242e-01   -1.692210755307307e-02   -7.199699510060494e-01   -3.670465855373343e-01   +5.254330443586459e-01   +1.414909172991620e-01   +1.969567003414919e-01   -2.156623705107144e-02; +8.547193547328364e-01   -1.537684314980377e-01   +4.359954102840894e-02   +2.559424672769675e-02   +5.822088881194469e-01   +3.202834045232986e-01   -6.033064168480284e-02   -4.664714833587709e-01   +1.573918851657440e-01   -3.445558080205815e-01   -1.939389458315867e-02   +1.953692924578553e-01   -3.725678237684442e-01   -2.126429401663423e-01   -1.483313967451362e-01   +4.755519190941111e-01];
L1E_L1I_iGABA_netcon = [-2.210535623089071e-01   +4.084925729921199e-01   -3.085918197948133e-01   +1.379559492512189e-01   -1.441210124849077e-01   -2.900882295470233e-01   -9.652164504741932e-02   -3.445382107258047e-02   +3.145334433283783e-02   -1.520752772232771e-01   +2.937847098609478e-01   +3.033875225086148e-01   +2.254116983117670e-01   +2.734917662030538e-01   -3.306157945738074e-01   +1.373010425004186e-01; -4.669746879750274e-02   -1.256226275539738e-01   -2.440346146127967e-02   -9.891292635943233e-02   +3.789589870687782e-01   +1.320754086295486e-01   +6.590321814402739e-02   -2.818947783131865e-01   +4.407906891253335e-01   -4.599871833982703e-01   +4.530090097514184e-01   +7.320420355794781e-02   +1.839572950127397e-01   +2.955158675886539e-01   -1.091495976727793e-01   +2.268790930284358e-01; +6.145108545502094e-01   -1.495660672340117e-01   +1.909600042543554e-01   -2.223902365973986e-01   +2.343819478212734e-01   -3.316841824874630e-02   +3.377145379264539e-01   -1.784019868081468e-01   -1.788423327842547e-01   -5.299652669515982e-01   -3.539254055259770e-02   -4.766250398823283e-01   -2.427575285699131e-01   +2.210872950932660e-01   +4.737443547777718e-01   +1.710996346812400e-02; -1.974597741165794e-01   -8.955342903108604e-02   +8.210741526916560e-02   +3.741897058887529e-01   -1.347725045721083e-01   +4.688990361884982e-01   -8.553467772752642e-03   -4.457026896495329e-01   +1.464130911239530e-01   +7.292956993107545e-02   -2.024170330169398e-01   +5.830665658081284e-01   +1.452414065862752e-01   -4.900888231467291e-01   -4.759019426395895e-01   +2.135612640516589e-01; +5.866033473090208e-02   +2.762849604415748e-01   -1.479776697811210e-01   +2.932916841957870e-01   -1.778286566758204e-01   +1.914987551679884e-01   +4.953880110693674e-01   +1.006142025443995e-01   +3.094810937275958e-01   +2.745928882902777e-01   -2.774507654249534e-01   -2.053385730781908e-01   +1.583142792386275e-01   +2.940429272927529e-01   +4.580185923432791e-01   -1.070702691875651e-01; -4.518287278330069e-01   -2.154242867316213e-01   +2.204163383779543e-01   +3.679726276847495e-01   +3.926736942676416e-01   -1.510187222561400e-01   -3.931673581594179e-01   +4.592769191486445e-01   +1.469871406329971e-01   +3.173475158338908e-01   +4.225632657994013e-01   -2.579306082628964e-01   +2.344919727526205e-01   +2.002595587139703e-01   +1.749434212351237e-01   +6.001186746940131e-01; -8.531500156090878e-02   -3.670854135760401e-01   -6.364831148671761e-02   -3.155142866666659e-01   +1.659826839668328e-01   -4.702529198790220e-01   -6.378826452635401e-02   +4.197573764883352e-01   -1.415286280165369e-01   -2.305487354783372e-01   -4.182933825011623e-01   +2.601838008136313e-01   -2.763217893524417e-01   -2.769839639412371e-01   -1.373250805359451e-01   -1.058471868220850e-01; -3.361904801565655e-01   -4.452130877916138e-01   -5.994193438451094e-02   -3.531225139260465e-02   +6.922056303502026e-02   +2.724665602212201e-01   +3.289702900577006e-01   +5.376968868566141e-01   +5.477377911436943e-01   +1.085564298481566e-01   -2.876573004176863e-01   +2.763250050937475e-01   +2.832097989420387e-01   -1.258333070654512e-02   +3.256724210361459e-01   -2.567642858642896e-01; -2.157450462119216e-01   +1.224793758160059e-02   -1.954528463959295e-01   -2.104286929530662e-01   +3.642815104167323e-01   -4.960134930020313e-01   +1.278970670477660e-01   +2.509396324598706e-01   +9.963844331468066e-02   +1.966059561322991e-01   -3.743062831690721e-01   +2.048117704785731e-01   -2.245371872566372e-01   +7.133338447899444e-01   -8.713974939994297e-03   -6.675244902789065e-01; -1.412359673045473e-01   -4.948263617180661e-02   +1.008017694924496e-02   +3.672802810614453e-01   -2.935235860945881e-01   +4.631279815116708e-01   -8.618130273568116e-02   -8.846531096828306e-02   +6.184371018929262e-01   +2.128577621609796e-01   +5.175489248828131e-01   +1.775279546886498e-01   -4.064540439357208e-01   -7.406264008027943e-01   -3.802076363003100e-01   -5.556749220236734e-01; +4.625931776510559e-01   -5.638059933425533e-01   +8.535159281783980e-02   -1.742959688130916e-01   +8.152400246163599e-02   +1.290868620805379e-01   +3.128012857354670e-01   +1.021640936844884e-01   -8.018995865153222e-02   +5.551508213965086e-01   -3.263932732550053e-01   -5.322375431349541e-01   +3.245466783542955e-01   -3.065790859475153e-01   -4.965571613104585e-01   +4.143952809795157e-02; +2.774935319257941e-01   +3.775980598229945e-01   -4.634933650320472e-02   +1.721713089852761e-01   +4.012676167925813e-01   -5.697765458247015e-01   -3.456903035715655e-01   +3.121410098838875e-01   -2.782827675709614e-01   -1.490568406067999e-02   -4.574173974880414e-01   +4.624560125055296e-01   +3.116816961649772e-01   -5.109895437152271e-02   +5.018014174677087e-01   -5.868865577198825e-01; +3.889296802046965e-02   -2.552650464573877e-01   +7.531046426865559e-02   +3.125673922144688e-01   -2.848565245163434e-01   +4.334333236151213e-02   +3.706413960285461e-01   +3.129112432076434e-02   -2.406480828237148e-01   -1.677825180907396e-02   +1.641296051221549e-01   -1.549870298082047e-01   -1.802353030897450e-02   +3.220565237465256e-02   -6.102758983616178e-01   -2.322093727807889e-01; +6.212504126475543e-01   -3.307229616437284e-01   +3.685013362935222e-01   -4.066046411719394e-01   -2.260009554377667e-01   -2.171692049585463e-01   +1.221382561768063e-01   +5.452745528731850e-01   -3.266047761356896e-01   +1.804750049217267e-01   +7.688752246036948e-03   -3.053666769170197e-01   +3.145400941154565e-01   -3.364701062218285e-01   +3.112197561482452e-01   +8.034613677810683e-02; -2.829361180003320e-01   -2.859025235705454e-01   +1.898255203808827e-01   -2.734452622290470e-01   +3.379635083165072e-01   -3.346850663138013e-01   -9.626677814062631e-02   +5.015639586399168e-03   +5.305764385584837e-01   -3.969878856753785e-01   -2.586959704520222e-01   -8.088885763593324e-01   +2.760084698589939e-01   -2.034570482508269e-01   -2.017616108656591e-01   +4.186888664964729e-01; +6.896271054914099e-02   +2.939636301599057e-01   -1.697607250835370e-01   +1.222591830235688e-01   +1.010828714264690e-01   -7.267425203019993e-02   -1.535758223306524e-01   +4.255145426644015e-01   +5.375511460542201e-01   +4.040919430622978e-01   -6.580080091426527e-01   +4.143356921529649e-02   -7.811682032510350e-01   +7.011152999526700e-01   +1.727532811856508e-01   +5.102041238925717e-01];
L2I_L1I_iGABA_netcon = [+8.901135293504045e-02   +2.396234290376094e-01   +4.439330700970064e-02   +2.577044603064497e-01   -1.000565293114722e-01   -6.575798400494626e-02   -2.457904103652144e-01   +7.729389942995237e-04; -3.403926604469683e-01   -2.833032058306582e-01   -1.393188858376604e-01   -6.761496822295646e-02   +2.547967920565113e-01   -6.560840025384193e-02   +5.693038588966620e-01   -1.209683746575109e-01; -1.435519903889691e-01   -3.917414913431247e-01   -6.893184082996853e-01   +3.594449027045183e-01   +1.437683420898212e-01   +2.105484696555204e-01   +4.058820883862954e-01   +5.690981291623232e-01; -3.678975761514127e-01   -2.205056446997064e-01   +8.297726137547815e-02   +9.974070255604017e-02   -1.138302800302707e-01   +1.987241833758640e-01   -9.074714936165473e-02   -2.641872506817783e-01; +2.419490432277250e-01   +1.059082292024440e-01   +4.851113472214616e-01   +9.914191254169379e-02   +3.861928414642456e-01   +5.577840941836529e-01   -6.708961898073398e-02   +8.093102147302957e-02; -5.866612138367855e-01   -1.072902445229982e-01   +4.816682949777239e-01   +1.008149370197320e-01   -2.024235041199823e-01   +1.989607125802800e-01   -1.562348185125651e-01   -1.007315403085188e-01; -7.905790828055298e-02   +2.015642137094325e-01   -4.740812490669528e-01   -8.597636234784313e-01   +3.131445214907675e-01   +4.040061920087913e-01   -6.965711250891929e-02   +3.867596121495627e-01; +3.734958478413863e-01   +3.117763628496858e-01   -2.070571404971235e-01   +2.478730520558685e-01   +2.158052638917777e-01   -4.935221204508035e-01   -1.221870447902346e-01   +1.112161122768339e-01; -6.720308997825977e-02   -3.369311816767430e-01   -1.981543481638323e-02   +2.818318895646482e-01   -1.692256725581847e-01   +3.724374655730189e-01   -4.279591460137047e-01   +5.253637376736964e-01; +1.471665093588380e-02   +3.605724686896560e-01   +2.731300843889868e-01   -1.155585110524661e-01   +5.608877583542539e-01   -2.103196232243130e-01   -1.205395828194664e-01   +3.280827366734811e-02; -2.361979272063233e-01   +3.559891587554159e-01   -3.019051133941868e-01   +3.141536929573473e-01   -1.283141779978340e-01   -3.880858673237316e-01   +4.197411516884095e-01   +1.055025040500104e-01; -2.817234658447846e-01   +4.951633449253281e-02   -2.496828558283658e-01   -7.639326770311020e-01   +4.869133862054922e-01   -3.230530297960076e-01   -4.735518667309226e-02   -1.106010956559270e-01; -4.114371776218226e-01   +6.232902081340386e-01   -3.731872411531864e-01   -2.808729730246241e-01   -3.730509511604077e-01   -1.591272434989378e-01   -9.549213085248162e-02   +1.847983022104899e-01; +3.069015607204313e-01   -1.348776605977009e-02   +2.985666919163409e-01   -5.049005094176483e-01   -3.446601112262453e-01   +1.595681292472510e-02   +8.698048101090960e-02   +1.965668394397954e-01; +1.260742215992566e-02   +1.969752685877941e-01   +1.785926158243526e-01   -7.978995865707073e-02   -1.638037830353560e-01   -2.423312165076242e-01   +6.557552012565399e-02   +3.905189331771547e-02; -5.547872923578570e-01   -2.642610381490222e-01   -5.872019276511522e-02   -2.814543051276195e-01   +3.808702463185177e-01   -2.675377360368874e-01   +2.889180309124613e-01   +2.977934845533512e-01];
L1I_L2I_iGABA_netcon = [+5.059389619520919e-02   +2.666729639413105e-01   +3.256768896411678e-01   -8.258360544042351e-02   +1.385786325987492e-01   +5.228033502301783e-02   +1.479317243826523e-01   -5.894716273349423e-02   +4.435259322195882e-01   -4.071592976563984e-01   +1.279004162511555e-01   -2.065295282674958e-01   +1.503137630466340e-01   -2.091038131599927e-01   +4.230019545610025e-02   -2.078825770836181e-01; +2.865610950843853e-01   -4.316706878799016e-01   +2.871248139461488e-01   -3.725106204672777e-01   +1.656339461552334e-01   -8.177044117630403e-02   +6.648452998517480e-01   +4.050344448839241e-01   +3.084821696976561e-02   +3.202878489342724e-01   -5.394418983910942e-01   +2.946085078967865e-01   -5.756068056248319e-01   -8.622086237104756e-02   +1.971611560179035e-01   -3.225394671295890e-01; +1.285407801976342e-01   +3.344142668874565e-01   +4.598072026558028e-01   +5.102113546784630e-01   -3.081995305311154e-01   -5.822074579710952e-01   +3.378184799276946e-01   +4.165246897884813e-01   +7.366413389199600e-02   +3.660382498899316e-01   -1.779988927326353e-01   +1.718423838933800e-02   +4.216513732260044e-01   +5.772326191850662e-02   +4.685535110270448e-01   -2.927617053050012e-01; -1.645180041387946e-01   -4.018056872537455e-01   -1.960338765124918e-01   -3.104102256178105e-01   +3.327615881492275e-01   +4.659829138141930e-01   +4.792377570893166e-01   -1.212853156897407e-01   +4.836741587264450e-01   +6.198053131704304e-02   -2.587232193244464e-03   -5.673005841651621e-02   +2.123997990444839e-02   +4.989259828093756e-01   -2.090727983561326e-01   -2.184205862005082e-02; +2.423427914105789e-01   +5.061044523623188e-01   -9.240824581401919e-02   -5.831054002820009e-02   -5.156090555978392e-01   +1.742237379860044e-02   -5.163276301397425e-01   +7.330180985677143e-03   -2.350045811230388e-01   +1.500621211450129e-01   -2.582003482456923e-01   -3.189492158082470e-01   -2.535223137098331e-01   +1.858182584495104e-01   +2.039543782540060e-01   +6.553841223456890e-01; -3.682761822072567e-01   +1.991656640436543e-01   +1.273416880694760e-01   +2.623101828499318e-01   -1.020429716624678e-01   +2.524924995635555e-02   +2.377278342769659e-01   +3.636263832328267e-01   +2.048966863993072e-01   -1.695158333937481e-01   -2.212727275373411e-01   +1.771443683580933e-01   +2.225567307284618e-01   -4.471044367905310e-01   -7.435613114172465e-02   -6.121066972750466e-01; -6.842860742965537e-02   +8.085100601308598e-03   -8.557025736325828e-02   -3.977138130877251e-01   +2.430124779609633e-01   +5.633229622941677e-01   +3.323517828156767e-01   -1.341549788567085e-01   -3.853886829922446e-01   +3.793985164432956e-01   -6.296609787584697e-01   +2.404271866629958e-01   -1.963104981201892e-01   -6.965930110238389e-01   +1.036650751306211e-01   +6.759482557800898e-01; +8.362362670898682e-04   +5.606462268532992e-01   -2.759801274699646e-01   -4.359635936784663e-01   -5.933548237692436e-01   +6.018784890567352e-02   +1.788373438809580e-01   +5.718894284503240e-01   +2.991061928093428e-01   -9.471626821503817e-02   -5.788107033090945e-01   -3.142919737490475e-01   -6.363942042484442e-01   +3.114528889762621e-01   +5.292833344186433e-01   +4.876992087034007e-02];
L2E_L1E_iAMPA_netcon = [+1.821501293767189e-01   +2.311332509384928e-01   +1.530642977426343e-02   -1.400684325457386e-01   +1.377841127088580e-01   +8.652024161801306e-02   -8.559716538440454e-02   -2.065478450427040e-01; -6.577625242291841e-01   +3.884169898445575e-01   +2.575827914259622e-02   +1.216519811063321e-01   -5.666093642204418e-01   +5.863448417500671e-01   -5.186152983818706e-02   -5.197786533763197e-01; -5.189342231221115e-02   +2.689303097852558e-01   +4.314681441544752e-02   -4.391325352711500e-01   -4.246530467507321e-01   +3.487739764047121e-01   -3.948966495142224e-01   +5.354919539260713e-01; -2.609160458160810e-01   -7.679982412243380e-02   +5.872902453203543e-02   -4.870987588477090e-01   -2.804991025512175e-01   +2.331008495598898e-01   -4.808169206466528e-01   +1.268441448140106e-01; -1.176059586363095e-01   +1.791288142067466e-01   +2.520034193180150e-01   +5.453859913128670e-02   +3.208915193470926e-01   +6.364092629284023e-01   -3.053708623093123e-01   +1.408871869287322e-01; -6.072798816992246e-01   -5.276977247268390e-01   -6.691071516566433e-01   -4.645693311638836e-01   -1.112185685159136e-01   -6.090387153928195e-01   +8.009862218720916e-02   +3.288731851261151e-02; -1.225773297051160e-01   +3.405059074100156e-01   +1.346747959702062e-01   +2.083559310895190e-01   -1.198444100795835e-01   +4.331685862574856e-02   +5.745208973001577e-03   +4.271520839697346e-01; +3.321763268718113e-01   -1.252710754288221e-01   -3.565352963816190e-01   +6.003262345782592e-01   +1.392503468406196e-01   -4.272842105589986e-01   -1.155778156265901e-01   -2.826639272548670e-01; -3.298213811471311e-01   -1.110559973498494e-01   +5.638646790427265e-01   +2.466274515207952e-01   +5.560280838643349e-01   -4.739385205125332e-01   -1.798937731525269e-01   +6.294518271311866e-01; -1.036501957993231e-01   -1.007018645629523e-02   +5.891885800945903e-01   +3.269198069452064e-01   +1.838317718265308e-01   +4.291126143281164e-01   -1.719591713391253e-01   +3.033027423291339e-01; +2.449288270727513e-01   +5.921531037672599e-02   -1.470612818337746e-01   +1.108932954667850e-01   +1.449700444671879e-01   +5.142051502579609e-01   -1.803501609438197e-01   +1.151696847478168e-01; +4.241382850383295e-01   +2.343598349879886e-02   -3.408718849184313e-01   -2.012487107312588e-01   +1.751497051668986e-01   -3.831714565713142e-01   +1.505138829183507e-01   -3.221558283620714e-01; -4.536511669018253e-01   -3.221226544216196e-01   +7.069061735992102e-01   +4.742830948813959e-02   -3.696679417801163e-03   +2.409972402973708e-01   +2.382372216513171e-01   -4.246960431520744e-01; +1.933704532787792e-01   +1.408686484755479e-01   -7.389663062719730e-01   +1.289193515603588e-01   -1.189561088514425e-01   -4.268223916798877e-01   -3.703407145100395e-01   +5.623757718223358e-01; +2.990811537034486e-01   -4.221235439801453e-01   -8.142636519280824e-02   -2.118939390939862e-01   -1.310387399997556e-01   +4.675699366737802e-01   -2.965962311136042e-01   -1.049784244698689e-01; +2.419715226586808e-01   +1.639842529407495e-01   +1.491569118649648e-02   -5.605329150586000e-02   +6.783143183814818e-01   -3.475317912554678e-01   +7.108843280291938e-01   +5.860700562407627e-02];
L1E_L2E_iAMPA_netcon = [-4.966532745536604e-02   +1.402174194118771e-01   -1.783848659073484e-01   -3.797434292055463e-01   -5.310796389560221e-01   +6.997529311613769e-02   -2.298420748993039e-01   -6.820643329973766e-02   +4.552898159258078e-01   -3.313170915239494e-01   -4.006491082065043e-01   +1.142986232129286e-01   +2.354368239972987e-01   +1.648878449049534e-01   -3.420678148756026e-01   -5.078226226987206e-01; +3.763025198910442e-01   +3.513056577625625e-01   -2.264806319066852e-01   -1.313528117591560e-01   +2.842473440347895e-01   -2.387248501480667e-01   +8.021123006011768e-02   -1.343181646155586e-01   +9.445659325999167e-02   -6.388675955828268e-01   +2.129546464772522e-01   -5.138981231811094e-01   +3.527286291291146e-01   -1.702363568581049e-02   +7.614331069889255e-01   +8.425843790778353e-02; +1.434493215136632e-01   -4.445414232856975e-01   -3.620780732675362e-01   +8.488605694040104e-01   -3.306186274977062e-01   -1.222225370269207e-01   -1.210154636856417e-01   -1.755034154263833e-01   -4.167654243527825e-01   -1.205321867293199e-01   +3.095309045843357e-02   +2.622883322842866e-01   +5.325794497549403e-01   +7.732958540976084e-01   +2.962179902852018e-02   +1.057373137046366e-01; +1.227490706305387e-01   +1.373272160196802e-01   -1.533339643883136e-01   -8.198603797139810e-01   -2.610929113803894e-01   -6.135229971073822e-01   -1.675682583616455e-01   -7.596741092103679e-01   -1.098773547784304e-01   -1.027687980163234e-01   +5.542606283126423e-01   +2.236848645310578e-01   +1.193583706253108e-02   +6.677492808478926e-02   +3.163219985126305e-01   +4.491100710816098e-01; -2.466885769167808e-01   -3.303227739187156e-01   -2.856332651068812e-01   +8.338078577213306e-01   -6.441638840259328e-01   -3.442657967832014e-01   -1.510163445079851e-01   +1.951832980529229e-01   +4.397340921493723e-01   +5.139044576271691e-01   -2.915004318765599e-01   +1.826116808849574e-01   -4.026313057006029e-01   -3.233662302104101e-01   +4.700264325666167e-01   +6.948248839323737e-01; +4.967225909664334e-01   +5.778326585962972e-01   +2.902833904531305e-01   +3.746505678308781e-01   +3.022377739172597e-02   -6.399449162127608e-03   -2.501960122702115e-01   +4.665051625605744e-01   -1.064684939310479e-01   +6.070230880901283e-01   -5.889065598176827e-01   -6.554997098338308e-02   +3.266231854469815e-01   +7.565898998151075e-01   +2.021514790987503e-01   -2.322707016235078e-01; +1.005219480636164e-01   +3.742811174239147e-01   +4.776249283774644e-01   +1.497997212201746e-01   -5.915903836556470e-01   -1.219442835571907e-01   -4.365808453823793e-01   +5.657530569853875e-02   -1.660368902400926e-01   -5.756111085155686e-01   +8.167648036997334e-02   -5.409071580493721e-01   -5.576801079857059e-01   -3.897478908838042e-01   -7.320315387251065e-02   +3.712339775226332e-01; +4.321195580861635e-01   -1.844167183039869e-01   -4.710891260596805e-01   +2.181873543413809e-01   -5.085030620687854e-01   +3.381365502481492e-01   -9.432713688291884e-02   +3.781012295205808e-01   +7.427248166102296e-02   +4.131506055629278e-01   +2.554941859394785e-01   -2.140186795153036e-01   +8.806267564386910e-02   -2.173033354928008e-01   -1.494872420808684e-01   +3.742764409818388e-01];
L2I_L2E_iAMPA_netcon = [+7.131817762930116e-02   +1.547094170025124e-01   +6.455224289926532e-01   +5.124621548653664e-01   -1.124408982253665e-01   +1.007654106541528e-01   +4.917072568184426e-01   -4.836721896930614e-01; -3.857913082323451e-01   +6.979656093608059e-01   -6.096756711700629e-02   -6.343882701446065e-01   -1.411671603541319e-01   +3.664330738890933e-01   +4.734901630824813e-01   +1.427999071828206e-01; +4.178794886096153e-01   +4.075504721903563e-01   +4.681182773478564e-01   -1.358937589110711e-01   +1.242438793150204e-02   -1.087629281473307e-01   -1.474374582949612e-01   -4.559704976365887e-01; +6.895204392172739e-01   -2.051326447154490e-01   -5.635380104051735e-01   -8.390442369497630e-01   -1.450103240496445e-01   +3.407553525095800e-01   -1.521439774925451e-01   -1.872346982240282e-01; -1.428125364105596e-01   +3.359283214897192e-01   +2.925409222484568e-01   -3.900429890378748e-01   +1.454490790610773e-01   -5.920524760746395e-01   +1.056044757832849e-01   +1.825656973524431e-01; -3.427043695138148e-01   -1.153926480540294e-01   -5.379157313748250e-01   -4.418198984741229e-01   +3.282778181477757e-01   +2.798119388805148e-01   -5.868427786261984e-01   -3.183412143819818e-01; -6.224162733951739e-01   -3.175041974544148e-01   -1.246569087838021e-02   +1.041980649519691e-01   -2.784260227166135e-01   -8.238962055964898e-02   -6.397141855026238e-01   -4.835270477141078e-01; -2.051270878865694e-01   +4.400517042241908e-01   +9.846855265077472e-03   -6.204700920785941e-02   +1.550917761656061e-01   -4.711200199882238e-01   +7.149358660384668e-02   +1.430618093270506e-01];
L2E_L2I_iGABA_netcon = [-4.190455595011099e-01   -6.547018685087646e-01   -5.071868883579750e-01   -5.027493747842705e-01   -2.808684946197619e-01   +1.857189648857369e-01   -9.153452651316493e-01   +1.126370245825881e-01; +6.390064299050150e-01   -2.201324797789953e-01   -4.442099800020407e-01   +1.799000881880684e-01   -5.068480722434311e-01   -2.450202885863748e-02   -1.534448698697012e-01   +3.418165161027852e-01; -3.263931538971507e-02   +2.995993892616240e-01   +5.718668617187160e-01   +6.934004521779480e-01   -3.413779631123789e-01   +1.806613525948145e-01   -5.398743312943913e-01   -4.459272534150269e-01; -1.924536997564526e-01   +5.025617529013223e-01   -7.055617544701777e-01   -1.481885752364402e-02   +7.776544669700504e-02   -3.248572545008742e-01   +6.994574699595048e-01   -4.370202249372170e-01; +6.207541212313274e-01   +2.594199945793725e-01   -5.503567271583758e-01   -1.101013956370009e-01   +2.345112578142432e-02   -3.208315522133943e-01   -6.763430890141828e-01   -8.026084290920987e-02; -2.757837782730714e-01   -7.866242499138451e-01   -1.905941206695798e-01   +1.148255999145868e-01   -4.645690360349942e-01   +6.939584075752656e-02   +3.392416094341894e-01   -2.265027390378943e-01; +7.033621207177652e-02   +7.022368828313273e-02   +2.501143640229415e-01   +7.680883066342120e-02   -5.783650191484955e-01   -1.900320222258980e-01   +4.586655704468168e-01   -3.753555961212146e-01; -6.634298611562006e-02   +2.405231842829025e-02   +6.214489482117860e-01   +3.146297610469874e-02   -9.810249815965848e-02   -1.721087976382811e-01   -2.494407794802432e-02   +6.176931259930495e-01];
L3E_L2E_iAMPA_netcon = [-4.225613506177016e-01   -8.602008565683973e-03   +1.188765159896920e-01   +6.218125728404549e-01   +2.133708312882941e-02   +4.202194873433004e-01   -3.282915685618405e-02   -9.262575311734850e-02   +4.258872127912531e-01   +4.669905459408225e-01   -1.379983618582543e-01   +6.136265245806971e-01; +1.525353911850619e-01   -3.917309967113924e-02   +1.154332489154148e-01   +5.438252316347931e-01   -5.601005854262562e-01   +6.298717248332794e-01   +6.216793011092262e-01   +3.108509343420136e-01   +4.323618973852206e-01   -1.169287049541480e-01   -3.211807397976938e-01   +4.727204526947409e-01; -4.824195998067483e-01   -2.280958753417263e-01   +3.206336808172929e-01   +4.380949640804303e-02   -6.686938626231987e-01   -2.033358995812207e-01   -3.286562042071671e-01   +2.079185213204006e-01   -2.048967535198573e-01   +1.535134672842235e-01   +2.140121309096793e-01   -6.420213660668493e-01; +9.162851300037900e-01   +3.344369765126264e-01   -2.191754808838813e-01   +1.944757589894656e-01   -1.192417722999911e-01   +2.993793930392847e-01   -2.845708461871981e-02   -1.710329878536854e-01   -3.395957843756903e-01   -2.882319214894714e-01   -1.952725955365502e-01   +1.248287799286924e-01; +1.443072069541657e-01   +1.664939821941372e-01   -6.565991960755102e-02   +1.693731153446972e-01   -2.917963073059922e-01   -7.182411878291911e-04   -6.795811849089978e-01   +7.284363133525540e-01   -4.300356988782348e-01   +7.562297418541963e-02   +4.038938142658647e-01   -3.476269163000560e-01; +4.950979135743899e-01   -9.251430075500534e-02   +3.240193290595832e-02   +5.491054048917582e-02   -1.543313797457778e-01   -4.020124243708222e-01   -1.589896778893523e-01   -6.783600985991802e-01   -2.711686739688182e-01   +5.287689866362925e-01   -7.549994414298335e-02   +1.042955383112975e-01; +7.256687963350227e-02   -2.215996939775319e-01   +2.498299238661196e-02   -3.686123433980986e-01   -6.113682473691744e-02   +3.905589906766624e-01   -2.421515477243313e-01   +2.939960330459691e-01   -2.265542548825173e-01   -2.937072939132146e-01   -5.688837814109994e-01   +4.529119877591636e-01; -3.404313299953047e-01   +3.034797439673596e-01   -7.255069966026618e-01   +3.853831085597196e-01   -2.017914082926965e-01   +4.323416846649643e-01   -2.406963119452786e-01   -1.480666970939476e-01   +2.196323722097825e-01   -4.993938812074053e-01   -1.315357836503226e-01   +4.873901334536749e-01];
L3I_L2I_iGABA_netcon = [-1.148868906415298e-01   -4.338647201081215e-01   -3.262300387993332e-01   -1.606283348169910e-01   -4.281296697846924e-01   +1.787558996421704e-01   -3.897336163791427e-01   +6.283535751119573e-02   +6.160911080200225e-01   -4.304074279830600e-01   +2.412413422364034e-01   -2.403027651977539e-01; -3.877229497493610e-01   -3.967618675003209e-01   -4.037712902423092e-01   +5.255495215697086e-01   -7.372279759185127e-03   +1.761384826900193e-02   -4.282454697078951e-01   +7.540475619465352e-01   +2.215253860740599e-01   +4.597974364247321e-01   +1.565986526549734e-01   -9.234922112725580e-03; +3.955024884003154e-01   -1.856879015053822e-02   +5.155187550571834e-01   -3.628171213812730e-01   -1.144481807456309e-01   +5.415364352961888e-01   -1.679557094934729e-01   -5.082637799025871e-01   -5.493827741566556e-01   -3.229197292472766e-01   -2.858569118910204e-01   +8.447460562240667e-01; -4.509270233886503e-01   -1.786604479650380e-02   +6.147311876977108e-03   +2.320148231491758e-02   +5.950059849278662e-01   +9.768633304253950e-02   -2.634982891762689e-02   -3.638783404120973e-01   -9.105854453401683e-01   +9.730206660501760e-02   +2.013076379730051e-02   -6.116471532607191e-02; +1.649868835591551e-01   -2.792725076736043e-01   -2.118416176268317e-02   +4.011936864334348e-01   +1.728002767684757e-01   -3.221260509365668e-01   -1.358405998757380e-01   -4.585030537448024e-01   -5.119209587816504e-01   -6.558654662107496e-01   +3.780730449690579e-01   +9.687552738186718e-02; -2.013180327004394e-01   +2.396958073684151e-01   +3.937168399244615e-01   +4.668027016303322e-01   +1.550588639506625e-01   -2.242120333592648e-01   +2.287964275342672e-01   +3.638354956511207e-01   -3.017260438412643e-01   -1.053556601970592e-01   +2.525026127868875e-01   +3.442844694330719e-01; -2.811363338834003e-01   -1.823495182948232e-02   -1.608610932506940e-01   -6.231527077187533e-01   +1.934669023826656e-01   +1.877547719279096e-02   -2.063991691533201e-01   +2.452684896001483e-01   -5.285099712732513e-01   -8.246911342347549e-02   -2.950672047733873e-01   +2.423853370550362e-01; +1.908090921856119e-01   +7.988205300618760e-01   -5.237938306575092e-01   +4.056246099750511e-01   -8.781448758536366e-02   +1.171578164321775e-01   -4.894862079763630e-01   +1.572286245806231e-01   +2.098070828547694e-02   -1.802480794840853e-01   +7.572003435590252e-02   -5.903892988978025e-01];
L2E_L3E_iAMPA_netcon = [-8.871587171716122e-02   +3.119860416610530e-01   +5.589507535603785e-01   -7.255638799609325e-01   +1.310445941898470e-01   -1.484904571954271e-02   +7.009422892259137e-02   -8.954250463814130e-03; -1.108363304927241e-01   +7.065486215530771e-02   +6.334960147063766e-01   +1.379630649641417e-01   +2.224733117493280e-02   -3.264672418835130e-01   -3.142695942145500e-01   -8.243318602144492e-01; -2.000993154845063e-01   +2.687159503350262e-03   +1.235685347676465e-01   +7.293406653494141e-01   -3.542402573552856e-01   +6.619633311544725e-01   +5.423801379108244e-01   +9.939561710169313e-02; -7.077806285714374e-01   -2.389895512299857e-01   -8.442056159253375e-02   +2.390562133811512e-01   -8.340526635737956e-02   -1.080711083987684e-01   +3.498457414995597e-01   +7.399780177969992e-02; +4.511680126252096e-01   +1.406073970821107e-01   -3.576478380016346e-01   -3.243200436708072e-01   +5.069434549500661e-01   +3.998314876487113e-02   +1.249577829809625e-01   -2.133886555480044e-01; -4.611171652811695e-01   -6.459309926958274e-01   -3.111140961081148e-01   +2.635380381035476e-01   +5.697861087272302e-01   -5.307516549151301e-01   -4.089602365745466e-01   +2.201350799401910e-01; +3.724051135717354e-01   -6.730180308664346e-02   +5.241721033207516e-02   -3.624934777631653e-02   +4.837441853755158e-01   -1.819221263200548e-01   +2.100982648313331e-01   -3.773420172370782e-02; +2.701335201954778e-01   -1.003177341872494e-01   +7.423559556446808e-01   +9.590318472534054e-03   +1.955829969310743e-01   +2.893134639226017e-01   -5.990961519547620e-01   +1.384938691207602e-01; +1.914649400917369e-01   -5.680177804172432e-01   +2.221602416278188e-01   -2.239410036871967e-01   -3.847381604174654e-01   +3.943697729546982e-01   -7.519711792433326e-02   +7.469501785689103e-01; +1.493282370326228e-01   +4.361743328464309e-01   +9.820273149173524e-02   +2.888669543875764e-01   -9.926334768979468e-02   +8.293685401694864e-02   -9.292921064152541e-02   +6.723162680407173e-01; +5.688812904118808e-02   -1.171249055656583e-01   -4.885357071519785e-01   -6.326499159929468e-01   +4.037991816996988e-01   +1.349662781566537e-01   +1.059209087072498e-01   +9.010057268599050e-02; +1.044854506688844e-01   +1.404127540888717e-01   +2.430607896405578e-01   -6.066939050198021e-01   +6.380279985956784e-02   +1.435708756111000e-02   -8.796848876659400e-01   +4.426294176474534e-01];
L2I_L3I_iGABA_netcon = [-1.644876329306891e-01   -2.089261396577255e-01   +3.482144217591608e-01   +3.348164741328160e-01   -5.993161387044241e-02   +3.326122680705131e-01   +2.687915352054155e-01   +4.289791478958929e-01; +3.132403411023615e-01   +4.203068466327211e-01   -6.786455656435789e-01   -2.315421674736984e-01   -6.683494710977357e-01   +3.493727405985407e-02   -1.988333075683556e-01   -7.407666355791444e-02; +6.129572562499016e-01   -6.058132509361173e-01   +2.787696902731041e-01   -4.748103697259087e-02   -5.706813038212670e-01   +5.411233739820499e-01   +2.638755136633312e-01   +2.360675803239037e-02; +1.715302505303991e-01   +9.029001640814574e-02   -4.335865837466424e-01   -5.092526791872095e-01   -5.660957428848404e-02   -1.068079971949650e-01   -1.156950403552654e-01   -6.361740642344990e-01; -2.330837071400325e-01   -3.365467773565194e-01   +5.650627623351804e-01   +6.308617551958334e-02   +3.238162972634835e-01   +6.910850614410895e-01   +1.168992541818260e-01   +2.623664865070275e-01; -6.824303958733462e-01   -1.409675044036660e-01   -8.863350480037879e-02   +2.460133894153836e-01   -3.248902797404231e-01   -2.511495031481170e-01   -6.389308119075475e-01   -5.933405622819300e-01; +8.204788038294430e-01   +1.437627232669421e-01   -7.797017919109697e-02   -6.605526318813617e-01   +4.325801964088523e-01   -3.167867221851786e-01   +4.080313197476426e-03   +3.662182753206631e-01; -1.741589334922611e-01   +4.401742001166535e-02   -1.156214247980504e-01   +6.032716898567709e-01   +1.523224554175247e-01   +1.159815233975064e-01   -4.449849166288957e-01   +1.232974310320933e-01; -5.579419188897586e-01   -7.839588811928843e-01   +3.434986628793599e-01   -7.921492289138229e-03   +1.720523391500078e-01   +2.383479677282969e-01   -1.299106198710876e-01   +3.806328992292531e-01; -6.594778512812868e-01   -3.253416117961424e-01   +1.148849452634888e-01   +7.235679340331730e-01   -8.007265027086935e-01   -3.358670290988370e-01   -4.320977293259411e-01   -3.047023804435939e-01; +2.818434796481105e-01   -5.229063665714424e-01   +3.229664523665292e-01   -1.178030405335464e-01   +9.470059007070450e-02   +2.977023535628259e-03   +6.255808719136589e-01   +7.476023356864332e-01; -3.341717132352535e-01   -3.831906057071213e-01   +8.400013414280870e-02   -9.693228861420033e-02   +2.800968108643371e-01   +1.902379182698888e-02   +2.971491281482394e-02   +3.228416764532927e-01];
L3I_L3E_iAMPA_netcon = [+6.436205305364673e-02   +1.098444596487635e-01   +1.625592245032265e-01   +5.727272174152113e-01   -1.285993975530038e-01   -1.645756137481804e-01   -2.244215876127278e-01   +1.556489180458435e-01   -9.496221775608077e-02   +5.583309481149643e-01   +3.480312639366690e-01   +1.080353791571127e-01; +1.073795039619262e-01   -1.113968877501010e-01   +4.855782366045429e-01   +7.447816964759904e-01   +1.874351394946650e-01   +5.518335939775318e-01   -5.296436679440067e-01   -2.542672967350185e-01   -7.204455927919504e-01   -4.230309367266867e-01   -2.241869739885600e-01   -1.059265913511234e-01; +2.563530628256021e-01   -3.662164906420013e-01   +5.346268916446610e-01   +1.950258042752487e-01   -5.122582800357914e-01   -5.187547521577646e-01   +1.560249369873906e-01   +5.228912168346875e-01   +3.256548121809810e-02   +5.778665285043363e-01   +2.817771270064028e-01   +3.547845158312592e-01; +1.220182313723300e-01   -4.768755378122406e-01   +3.785290869090805e-01   -1.458575471628717e-01   -5.029670796560395e-01   -6.955836652552971e-01   +2.579471760869989e-01   -5.062788807607227e-01   +2.042033335644403e-01   +1.866651400492079e-01   +1.985552807514087e-01   -5.450815856353983e-01; +6.179733166612337e-01   -1.186982996462642e-01   +4.766727332330760e-01   +5.674919411866984e-01   -5.655933339176307e-02   -8.587609275306854e-02   +4.276249910079226e-01   -2.548245417619187e-01   -6.908225421508531e-01   -2.371700583061876e-01   -7.187994084144855e-02   +2.510213425681676e-01; -3.857985669437103e-01   -2.613202017000286e-01   +4.154735857057886e-01   -3.808949032014267e-01   +2.333255403394178e-01   +1.813816094714701e-02   -1.534009568072063e-01   -1.870867555511275e-01   -7.216333106657564e-03   -3.170514825492621e-01   +1.996477440697452e-01   +2.314959673432062e-01; +3.909307172950106e-01   -4.239385473738513e-01   -4.855608628352283e-01   -5.102344934110209e-01   -9.203420277358200e-02   +5.039512922617820e-01   -7.048202110120488e-02   -4.939460397071095e-01   +7.953418265723020e-01   +4.819704476423925e-02   +3.396475495277173e-01   -6.912561334863478e-01; +1.619482064326881e-01   +4.800593163451571e-01   +5.851047869731666e-01   +1.876672658765873e-01   +1.352391711227990e-02   -6.632503197266654e-01   +1.309943232216922e-01   +6.349287032231361e-01   -8.323456280715680e-03   +1.288030668919062e-01   -2.883969864578183e-01   +1.301093597607966e-01; -1.151210469717708e-02   -2.228908855310584e-01   +1.223306949640196e-01   -3.158572528040693e-01   -1.832519664866070e-01   -6.366578758822909e-01   -1.699031206070949e-02   +5.295185242245880e-01   -3.141004974040443e-01   +5.483886355127682e-01   -9.160487228962541e-02   -5.263915482283577e-02; +4.782572007138607e-02   -4.264896153200893e-01   -4.346905520129262e-03   -2.574661121446291e-02   -3.820261942523777e-01   -6.672048536877105e-03   +6.625026822180340e-02   -7.778249419434861e-02   -2.022602923878097e-02   -1.056857468613630e-01   +4.647858868936714e-01   -1.091058071114374e-02; +4.826381907703586e-01   -1.984566098576360e-01   +3.878625471413685e-01   -3.399651941230151e-02   +1.606884798292358e-01   +1.529404678950302e-01   +5.337071724451716e-01   -2.093183501513545e-01   -9.348029224188675e-03   -4.679099627634625e-02   -1.570312626749379e-01   +8.954505585980553e-02; -1.366141265245097e-01   +5.513816360581949e-01   -6.556736116901367e-01   -2.430149195148146e-01   +9.559303529348495e-02   +9.555696453877771e-02   -1.556045004531680e-02   -5.523498475362274e-01   +8.768541825642144e-02   -2.794946064062266e-01   +3.585617011217294e-01   +2.442526426088640e-01];
L3E_L3I_iGABA_netcon = [-2.177101846771461e-01   +5.651797782858554e-02   +5.869374117306508e-03   -3.333267985186921e-01   +2.381198134483002e-01   +4.396055131129595e-01   -3.247181621703743e-01   -3.864789162199629e-01   +2.649339154174778e-01   -3.688538592480755e-01   +1.469229058243854e-01   -2.134226822600793e-01; +2.552135406398844e-01   -2.403531580753057e-01   -2.981548038907650e-01   +8.133980057973184e-02   +1.382242133718972e-01   -3.759819068207849e-01   -2.539742529126917e-01   +3.361517939295849e-01   -2.715010493121048e-01   +2.333763063229901e-01   +1.091389782053959e-02   +7.068515231523911e-01; -7.231876125873082e-02   +3.721790489977894e-01   +5.622565939178648e-01   -2.446846973387629e-01   -2.205403773423596e-01   +1.518912466042373e-01   +9.049105101165535e-02   -4.133789412520141e-02   +5.267763371774018e-01   -5.577332085456207e-01   +3.665625910679998e-01   -3.654274014853987e-02; -2.271868351426967e-01   -1.034765831263843e-01   +2.500240080983370e-01   -1.289435326123087e-01   -4.901886214352882e-02   +2.442541662051566e-01   +1.831454559505828e-01   +4.867078410029591e-01   +4.089456952946084e-01   +2.556050413011361e-01   +6.708422682300940e-01   -1.492455312952010e-01; -4.693871762134678e-02   +2.023353046584075e-03   -2.759111702248636e-01   -3.901197394511106e-01   +5.052068432179623e-01   +6.286248511189867e-01   -5.398550533514559e-01   +9.744467483673021e-02   -2.103128180590947e-01   -1.231868864135973e-01   -3.185765849654976e-01   +4.068072875356260e-02; +2.567126823556721e-01   +1.501330088736597e-01   +2.656503565964221e-01   -3.413890486845096e-01   +8.168866504645539e-02   +5.010524139884678e-01   -5.467088704435064e-02   -1.398690159286662e-01   +5.173148706922170e-01   -1.261542639342741e-01   +1.544118234905587e-01   -3.628843915061624e-01; +1.276353683388819e-01   +3.085913926660789e-01   +5.730417456127501e-02   +2.954093568970707e-01   -5.903442298266172e-01   -6.938809434273009e-02   +1.653098203062162e-01   -1.075398391309445e-01   +1.896975925623972e-01   -5.035508973207997e-02   +1.112112195862107e-01   -1.548027106890156e-01; -6.236021166499558e-01   +1.950702294397067e-01   +2.972898493581370e-02   -2.414397431927251e-01   +3.219888064225190e-01   -3.749670752642367e-01   -1.614255912812006e-01   -2.758516121201405e-01   +5.571536368567921e-01   +7.652754633077925e-02   +5.954824315551792e-02   -4.684827225159961e-02; +7.863701498051054e-01   +1.488258473175033e-01   -1.024991520454849e-01   +1.751953180084755e-01   +2.725087633853114e-01   +2.216106420519559e-01   -1.733597546771604e-02   +1.053489202167488e-01   -3.582619023160548e-01   +3.186002497186189e-01   -5.604496846463514e-01   -3.379597591295288e-01; -1.043849883370215e-01   -2.353904502154854e-02   +2.811280971978984e-01   -2.210891625798285e-01   +4.690299153599842e-01   -3.673271597219472e-01   -3.549191766006476e-01   +2.626960611364922e-01   +7.141190063094930e-01   +5.453924692868741e-01   -8.836714104589735e-02   -2.838362906989556e-01; -9.598498343331753e-02   -1.463390258765605e-01   -7.061261652366141e-02   -1.895787687954577e-02   -8.374834371284917e-02   +1.170105319490023e-01   +2.646158457469676e-01   +8.032511961890358e-01   +3.128046669742388e-01   -1.839984651133557e-01   -2.020084780087732e-01   +2.368850554467829e-01; -4.633415607285634e-01   +2.389893323524803e-01   -1.448039458467117e-01   +1.410275130882032e-01   -7.910855497705423e-03   +4.221473527917025e-02   +3.528648836473438e-01   +7.066745242283233e-01   -6.942263548320591e-01   -2.624965066251154e-01   -3.172731887938922e-01   -5.765809071686363e-01];
L2E_Input1_iAMPA_netcon = [-2.999617325415552e-01   +2.162781786771476e-01   -1.873881557999929e-01   +6.505385398827508e-01   -5.133720002842384e-01   +5.598648934013232e-01   +4.188286750058368e-01   +3.645436568007557e-01];
L2I_Input2_iAMPA_netcon = [-1.972188611613255e-01   +7.321536121060472e-01   -2.520788081451000e-01   -1.798989337663525e-01   +4.778517340597672e-01   +5.290323915795754e-01   +1.217582204573718e-01   -9.007536131782885e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
