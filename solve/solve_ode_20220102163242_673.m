function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.644998234490493e-01   +1.718672671591900e-02   +3.575035625005396e-01   +3.655605428921692e-01   +7.211596551314751e-02   +4.514242992635208e-01   +7.943660380154639e-01   +1.816954858347787e-01   +3.447268607580601e-01   +6.803251642513476e-01   +3.448584245070426e-01   +7.311177065787543e-01   +3.888966244684769e-01   +8.100132299397503e-01   +4.252903422350185e-01   +3.144255820642499e-01; +1.584071079104686e-01   +4.809929346406234e-01   +3.337545181764779e-01   +1.258265727625556e-01   +2.610473676035546e-01   +7.087738263885291e-01   +1.411069252543425e-01   +3.627788144244810e-01   +5.640814036780516e-01   +8.417145480805897e-01   +2.515924611809888e-01   +5.452750848073019e-01   +5.832757101708498e-01   +2.886603728877141e-01   +7.722948951156607e-01   +4.803174288253420e-02; +8.120573330413766e-01   +4.068083386521015e-01   +8.894139779695496e-01   +2.440771345495730e-01   +8.037282385711775e-01   +7.705576891642675e-03   +5.869724700088097e-01   +9.346524571521812e-02   +5.755146573173328e-01   +6.459638606416632e-01   +8.451712316005939e-01   +4.017143998788393e-01   +1.284982920970093e-01   +5.836126557003858e-01   +4.388543242125894e-01   +5.988902505604201e-01; +7.648363322886099e-02   +2.898813210452351e-01   +6.630857837249259e-01   +8.086943334792280e-01   +7.263544562488912e-01   +3.261231282543882e-01   +2.488714607404831e-01   +2.700006132975789e-02   +6.787374956434247e-01   +1.175167898794885e-01   +4.470382056885447e-02   +1.983861293512504e-01   +8.970096745083698e-01   +7.737748904249637e-01   +8.175092624295186e-01   +2.670462020550435e-01; +4.918902638253297e-01   +4.475885340243494e-01   +4.296468918492459e-01   +6.777694481472966e-01   +5.899248424185585e-01   +6.429058842089820e-01   +7.935044821570999e-01   +6.543453394314164e-01   +3.219913569870525e-01   +1.853761948313862e-01   +2.951128183777662e-01   +1.422946678513065e-01   +7.757916323285587e-01   +2.301336275273851e-01   +7.675238235814906e-01   +3.442690301101394e-01; +8.363322014737999e-01   +3.651168463409212e-01   +5.671010147812854e-01   +1.362465528828172e-01   +8.011315824314479e-01   +5.367922901809716e-01   +2.851815190071884e-01   +5.546279946845710e-01   +6.775644026658452e-01   +4.833571284357278e-01   +4.123436687128972e-01   +8.662608185771549e-01   +1.822431743502003e-01   +1.862808815559228e-01   +6.915393100893712e-02   +4.547700176659243e-01; +7.111715954005184e-01   +5.726008118885877e-01   +5.479396919686025e-01   +2.019755041450419e-01   +5.308154422715103e-01   +5.733529803268925e-01   +5.759776113934717e-01   +8.217583552943992e-01   +6.496000765092401e-01   +4.901486221942717e-01   +4.306627442631265e-01   +8.995787680015813e-01   +2.764809324194598e-01   +1.399741576367053e-01   +5.311699149456311e-01   +2.806060668900464e-02; +3.104991678209165e-01   -1.797411478054650e-04   +3.733433287878521e-01   +5.590871090806526e-01   +5.180546268021262e-01   +3.611476923107505e-01   +2.682402953638882e-01   +5.816292735510222e-02   +6.465424666639663e-01   +1.660972356853626e-01   +3.510176074620034e-01   +1.593182383400664e-02   +8.323590603112612e-01   +7.454719350945307e-01   +6.037924348490164e-02   +7.474706163572753e-01; +1.644621304984306e-01   +1.671026791556576e-03   +2.371555712034141e-01   +3.723929994510930e-01   +7.637075557768208e-01   +3.800596066162928e-01   +6.815522488807653e-01   +5.660102039568309e-03   +5.901663146272158e-01   +6.641247456759493e-01   +9.655622258946886e-02   +7.842814696070999e-02   +4.766556518545942e-01   +7.155447490200598e-01   +1.371771917000363e-01   +2.838475302978662e-01; +6.926135277722968e-01   +2.770691982292014e-01   +7.622486988211715e-01   +4.295940746827553e-01   +6.551625394303533e-01   +8.069016257570999e-01   +4.547703092020556e-01   +5.346022412235339e-01   +6.533902158687568e-01   +9.501672976266982e-02   +1.236423954104427e-01   +2.710411833768784e-01   +7.741977864998364e-01   +7.073243970169475e-01   +5.907952432009353e-02   +1.258655690673577e-01; +4.014600460612606e-01   +5.856105151568026e-01   +5.300269078677334e-01   +2.569580035116443e-01   +7.220442436386997e-01   +8.127193904480379e-01   +8.530212763004636e-01   +2.004526832631480e-01   +5.213387767276618e-01   +6.335366202784549e-01   +7.559623006360009e-01   +1.526140826101587e-01   +6.152999695801284e-01   +2.668464053064670e-01   +4.506434152865970e-01   +2.986898176273692e-01; +6.388398195446868e-01   +1.371460407669458e-01   +4.665085943675172e-01   +8.075917684351382e-01   +7.976222234092611e-01   +4.364876827136290e-01   +3.020433418020735e-01   +4.154704595693218e-01   +7.720909201683239e-01   +4.519944520566265e-01   +1.958929360776283e-01   +1.959325193541658e-01   +1.429631070856651e-01   +4.221164259918699e-01   +4.809619609050060e-01   +3.341009577112383e-01; +7.100572251997149e-01   +2.856935515706686e-01   +7.671824538416893e-01   +3.501051036684545e-02   +4.587588439300142e-01   +3.219815697491678e-02   +1.978853670411142e-01   +4.043697549007024e-01   +8.391037209205253e-01   +8.879034667369967e-01   +7.641944474675726e-01   +5.627134184648234e-01   +7.359513674462106e-01   +3.142663645188461e-02   +3.645149441285547e-01   +8.886430948576327e-01; +9.165644464623731e-03   +1.662856921584610e-01   +1.660649515225450e-01   +7.927862114729224e-01   +1.689240790684680e-01   +7.505729618420398e-01   +6.553939906425031e-01   +5.955745846812496e-01   +7.259066770508527e-01   +7.569624692789112e-01   +4.426052997703091e-01   +4.779247197682000e-02   +2.817233717292706e-04   +7.125492080109965e-01   +7.701945593750471e-01   +6.399013716061810e-01; +2.705836361900914e-01   +6.009802197556364e-01   +4.599341702649064e-01   +4.625725750249856e-01   +7.560808000533463e-01   +8.296620096164939e-01   +2.382042219992437e-01   +1.038101517441076e-01   +7.029002310215992e-01   +2.762860363226980e-01   +5.203127019016413e-01   +2.172964083917899e-01   +5.198442535930862e-01   +2.261742532508167e-02   +7.772758329255369e-01   +5.965071072726654e-01; +7.624617761881155e-01   +8.741273024863136e-02   +2.238138556718524e-03   +2.179455389481715e-01   +5.702450727987707e-01   +3.357039614437144e-01   +4.799449897495491e-01   +2.677546444761869e-01   +4.324609309077980e-01   +7.021965213290976e-01   +1.128164144958147e-01   +7.508466966450184e-01   +2.067197739675088e-01   +1.506363486901847e-01   +2.258809323861897e-01   +8.397451748938727e-02];
L1E_L1I_iGABA_netcon = [+1.525918201074394e-01   +5.096166461448478e-01   +6.506999534679307e-01   +6.061477322385135e-01   +6.525690185627466e-01   +7.644914646404118e-01   +1.659702759061291e-01   +1.724135458196024e-01   +6.924704297836739e-01   +8.452238353986570e-01   +4.024546927212458e-01   +8.982952240277403e-01   +2.067891749852528e-01   +3.021631485223342e-02   +3.108123973468883e-01   +8.590114777649427e-01; +8.681763185440492e-01   +4.646302540286397e-01   +2.920568161664441e-01   +5.876438906575431e-01   +2.239032459644088e-01   +5.969698409152868e-01   +9.928346198035971e-02   +7.385793283612425e-01   +8.220878487600132e-01   +7.134897190721831e-01   +6.058083517706234e-02   +3.915552636855629e-01   +2.012186672038267e-01   +2.050271308365228e-01   +7.838034639402893e-01   +2.034201082101634e-01; +2.573447898967466e-01   +6.513656764890455e-01   +7.879884935682069e-01   +5.329188932356652e-01   +1.735043074693794e-01   +6.115626927323951e-01   +5.749778478437394e-01   +3.286113571506971e-01   +7.969266559226633e-01   +1.693392796960890e-01   +8.481206866600552e-01   +5.081467843544675e-01   +7.814001343329273e-01   +5.326724638751287e-01   +2.371563298733590e-02   +5.062709581735200e-01; +6.712328160468702e-01   +3.977790159603317e-01   +5.561403903452414e-01   +8.042680626228658e-01   +2.845404007653636e-01   +1.781544327602662e-01   +4.557178012953453e-01   +5.607032018632883e-01   +5.979429475462625e-01   +5.777774209842188e-02   +4.721326481747331e-01   +2.214232446182356e-01   +5.948959405284586e-01   +3.566775084788079e-01   +7.154001351685697e-01   +6.090501622053152e-01; +7.722686398851106e-01   +5.673125638501691e-01   +5.318380059145364e-01   +3.197811042334342e-01   +3.254054375511960e-01   +2.444821748035128e-01   +5.068539318641480e-01   +7.145771017346507e-02   +4.248413392574770e-01   +7.251198155398468e-02   +5.580818966318726e-01   +4.522098361472893e-01   +7.122463768449954e-01   +5.096734196189211e-01   +3.769407461225653e-02   +8.034254495378492e-01; +8.739711021231898e-01   +1.314749614565593e-01   +1.979958066596171e-01   +2.793580609069527e-01   +6.445501590178907e-01   +1.680931402010688e-01   +8.776456040375962e-01   +3.348609155908681e-01   +3.714477741852546e-01   +8.949913913540082e-01   +1.381166570694771e-01   +1.290370831848495e-01   +6.955518324338434e-01   +1.910747705933031e-01   +7.881691260195620e-01   +4.941188576471350e-01; +7.730310240388146e-01   +1.035953882276580e-01   +3.206056322135901e-01   +1.997564869483885e-01   +1.584101724485829e-01   +3.115672287768870e-01   +7.355129582101323e-02   +1.247732482819920e-01   +8.155882307025033e-01   +5.468736320894290e-01   +8.766713435340636e-01   +1.729409403514965e-01   +3.906090407549721e-01   +2.232573187037304e-01   +5.349566673902281e-01   +5.951803494113282e-01; +2.745817882335453e-01   +8.923643047012993e-01   +1.726428336099299e-01   +9.001213684029535e-01   +2.073254226862629e-01   +5.328796179994331e-01   +3.641046856144144e-01   +7.092447905223628e-01   +1.176826027570101e-01   +8.138348562213408e-01   +8.733812254468560e-01   +7.252018643726226e-01   +3.981634307339079e-03   +3.234238382863362e-01   +3.764154633419396e-01   +1.142924743290382e-02; +3.405851376196015e-01   +7.956559426534884e-01   +6.591261559979880e-02   +3.175309942593864e-01   +2.924570359296085e-01   +7.889032400082094e-01   +3.101607399366418e-01   +7.934415423743434e-01   +8.537029577883438e-01   +4.180319120876673e-01   +6.716465478571492e-01   +8.682031300707556e-02   +7.584866588154210e-01   +5.535657921889444e-01   +3.942396517303227e-01   +5.899163188395155e-01; +7.953138953193397e-01   +7.057027709201134e-01   +7.575137715729792e-02   +7.138155157649569e-01   +1.999415951178872e-01   +6.315831197081428e-01   +8.050495319521398e-01   +7.730289045690668e-01   +8.318949240626978e-01   +2.169982623237813e-01   +6.238010098860166e-01   +8.669181942363539e-01   +5.789576216142780e-01   +4.886582486463221e-01   +3.434730256178471e-02   +7.194347518083562e-03; +8.476736333024628e-01   +6.015765973871378e-01   +2.696489186290798e-01   +7.872646695789599e-01   +3.922687435064650e-01   +4.898098590632379e-01   +2.398760395749539e-01   +1.335652098925512e-01   +1.261747183166625e-01   +3.286601072523807e-01   +8.003893929991209e-01   +6.793233928443225e-01   +4.809704320127076e-01   +6.357213717114751e-02   +1.774836661485245e-02   +8.976967251565686e-01; +3.491740136822943e-01   +2.040805858275035e-01   +1.898558744369692e-01   +7.803226789623650e-01   +4.159988500285293e-01   +5.499260239745355e-01   +3.927651165839430e-01   +8.359061752217892e-01   +8.256572317672095e-01   +7.831937378696184e-01   +5.078054109272779e-01   +7.911922078636998e-01   +7.231440405062713e-01   +1.111324526470450e-01   +7.582852765762426e-01   +2.365752906600961e-02; +5.744374334705585e-01   +5.928108839272725e-02   +4.900833394900861e-01   +6.819028028712595e-01   +4.040839012369065e-01   +3.603301292084301e-01   +2.746310033123226e-01   +1.567995610502813e-01   +6.730990937248799e-01   +7.621845684846694e-01   +6.934757245045245e-01   +6.685563730714533e-02   +5.705572140551693e-01   +3.818120447795597e-01   +6.645787956548199e-01   +3.081062958727283e-01; +7.613467857417719e-01   +1.600975688328416e-01   +6.196859371652889e-01   +1.158535619783170e-01   +2.431776941265817e-01   +5.718562901452346e-01   +3.673014199140841e-01   +6.408027215253246e-01   +8.870744099409695e-01   +4.208836072599589e-02   +2.526030732614530e-01   +1.496484654643345e-01   +5.320108868201070e-01   +5.631545000656083e-01   +8.792693453780618e-01   +5.614904257748704e-01; +6.830543553435922e-01   +5.110924120485250e-01   +1.455368010832155e-01   +1.603411081260145e-01   +7.944571152942951e-01   +2.256997870927668e-01   +8.959244946907091e-01   +3.835966925869329e-01   +5.271020004220252e-01   +5.662325249965062e-01   +8.283836371535065e-01   +1.112974872202627e-02   +3.696221800185575e-01   +2.701315357007273e-01   +7.425245394172507e-01   +2.842330063585315e-01; +5.462012276662846e-01   +4.093867488261712e-01   +9.025671755705668e-02   +5.499169961405782e-01   +8.041531616201754e-01   +8.145198045829555e-01   +2.571681587394973e-01   +3.957295810429730e-01   +8.188402270803204e-01   +3.778269357581011e-01   +7.579759449876705e-02   +5.270283190148966e-01   +4.762796554384671e-01   +3.621139743563720e-02   +3.544772542157105e-01   +1.275283505252350e-01];
L2I_L1I_iGABA_netcon = [+2.657643340721496e-01   +3.530315967306114e-01   +4.660376360464478e-01   +4.065089056778671e-01   +5.766869051075981e-01   +5.817851553371789e-01   +3.304580057527173e-01   +3.825476121755847e-01; +1.890899972537065e-01   +6.322663451055641e-02   +2.283472450001898e-02   +1.417466760891510e-01   +7.258186504757163e-01   +3.512579074343343e-01   +2.237263677060313e-01   +7.070869071318459e-01; +1.926794938899163e-02   +1.892229332623135e-01   +9.503142232279968e-02   +6.600280001950095e-01   +6.215255535484543e-01   +7.484220346512113e-01   +3.765913295288697e-01   +4.647522786124782e-02; +5.386098085159055e-01   +6.810031091993152e-01   +7.097488904309918e-01   +8.057052896481643e-01   +1.733352693159251e-01   +1.927564596062882e-01   +2.109456590724909e-01   +3.082682346801686e-01; +1.189701728503019e-01   +3.955657425066412e-01   +2.097709363294281e-01   +3.986441100143255e-01   +8.576354216049055e-01   +3.919740535925886e-01   +8.825402875633663e-01   +1.989849943011828e-01; +3.236685218295327e-02   +4.331409036357119e-01   +2.152690388504164e-01   +8.719328150767076e-01   +7.424835469426785e-01   +4.975246399494305e-01   +3.135089143984500e-01   +7.726101674682343e-01; +2.046924415875175e-01   +1.913150221108918e-01   +6.594196889130935e-01   +4.699975103748962e-01   +5.950579351119194e-01   +1.494553404342751e-01   +2.215563040865258e-01   +4.128684591299988e-01; +4.998720056576489e-01   +3.936402335639111e-01   +8.505685586052937e-01   +2.414244195581749e-01   +7.052816616406454e-01   +7.058779801932485e-01   +6.900874135605846e-01   +1.891699200817002e-02; +1.839027684562272e-01   +5.302193028941932e-01   +3.468792728817929e-01   +3.973385128369242e-01   +7.439440830351354e-01   +2.851530925526766e-01   +7.659325761572469e-01   +2.255432830137833e-01; +4.307007377513262e-01   +8.923264075492640e-01   +7.072362975332865e-01   +8.835799116529525e-01   +5.996250650377071e-01   +8.305107428272829e-01   +7.097175108027057e-01   +8.554039564685511e-01; +5.427509365870423e-01   +2.482084235428734e-01   +2.428739582815234e-01   +5.557774646683706e-01   +1.886408553330429e-01   +5.536882623189039e-01   +1.966735573767667e-01   +8.423317791056103e-01; +5.152303355352811e-01   +5.487843718490008e-01   +2.181452806864070e-01   +5.950730501078889e-01   +1.464621744063389e-01   +8.487138566073116e-01   +2.561379970668938e-01   +7.377490524399838e-02; +4.837099880682589e-01   +5.850058003493834e-01   +2.333617244496411e-01   +6.736158387833295e-01   +2.451057574516977e-01   +7.572845123750707e-01   +3.363136843831032e-01   +8.914980519187811e-01; +6.880413049874426e-01   +5.591516669537662e-01   +5.990372154410159e-02   +5.771232229850074e-01   +3.464537438904290e-01   +5.955938560860318e-01   +1.896372384252634e-01   +4.514547548993759e-01; +4.919218415665191e-01   +5.686262201467981e-01   +7.910292404320763e-01   +2.498961076155586e-01   +4.363882236327279e-02   +5.775218850062286e-02   +2.087443765032300e-01   +8.601190821134157e-01; +5.837261885261960e-01   +5.747801087283040e-01   +8.539152977994392e-01   +9.958065115741212e-02   +4.272884226032382e-01   +6.732680606801311e-01   +6.454761899331344e-01   +5.739959048492952e-01];
L1I_L2I_iGABA_netcon = [+2.004879738406966e-01   +6.968071580817351e-01   +1.888822371598931e-02   +2.095155616195427e-01   +1.482071525197932e-01   +3.094922497342857e-01   +3.807981972526051e-01   +6.292139973857275e-01   +3.758916663847397e-01   +8.165115654873892e-01   +1.059113759612234e-01   +7.527851397017165e-01   +3.791516942977827e-01   +9.697231059155142e-02   +7.178424322762504e-01   +7.616992888954631e-01; +6.475788659555567e-01   +8.286944492863850e-01   +2.882237299221576e-01   +4.834692933406215e-01   +2.595723776506428e-01   +3.368460890993838e-01   +2.680212877779654e-02   +5.764860170613539e-01   +3.149514692294620e-01   +6.374037707483501e-01   +7.800635898945291e-01   +7.615947660221484e-01   +8.107432935157868e-02   +3.628412689886870e-01   +1.360072814612037e-01   +8.388469173860331e-01; +2.544180868869174e-01   +2.777641410360314e-01   +3.116208104517809e-01   +7.791735914640655e-01   +4.354658889804601e-01   +1.940152652361642e-01   +6.136153731515797e-01   +6.929901106617511e-01   +3.490938592161849e-01   +1.840254871565166e-01   +1.278967721046228e-01   +2.783406155703293e-02   +4.892232335667304e-02   +4.268148803349190e-01   +7.472264930167878e-01   +5.140213416150509e-01; +7.266743527121481e-01   +6.671922514204786e-01   +1.096293364757070e-02   +5.828891735513959e-02   +5.719776352931918e-01   +3.077918415706898e-01   +3.016526637277979e-01   +1.803397105605515e-02   +5.408701533509688e-01   +7.210974355587575e-01   +2.390613211248724e-01   +7.293447453771326e-01   +7.577498405602233e-02   +7.222060724435625e-01   +2.437207872081731e-01   +1.242488766501310e-01; +2.124486810348181e-01   +8.739523390392534e-01   +2.668948920572095e-01   +3.818083451252714e-02   +8.865549948592068e-02   +7.441191600955404e-01   +5.085467134737184e-01   +6.912057810086677e-01   +7.194417963109897e-01   +8.336562485916915e-01   +6.948470012020549e-01   +7.831025650966560e-02   +6.521766363292513e-01   +4.368963204135741e-01   +4.547850929922565e-01   +4.171821913857290e-02; +5.094503367426311e-01   +6.027271927544771e-02   +4.575725703323669e-01   +8.354701907212684e-01   +4.223854167897825e-01   +7.239271324930241e-01   +6.767776366520990e-01   +2.446478398914982e-01   +8.216330621452175e-01   +3.637741402781713e-01   +3.952608102103096e-01   +3.375903245360973e-01   +4.281538309198633e-02   +4.536692009063072e-01   +8.544135396651336e-01   +7.789765667259400e-02; +5.017761511479674e-01   +4.038555884742983e-01   +7.135516706207869e-01   +4.512140530049827e-01   +8.429211537495254e-02   +5.543563700695705e-01   +8.047206528613160e-01   +6.880425866219775e-03   +4.329130580149975e-01   +1.838321336479603e-01   +8.926130285795959e-01   +7.610401854799632e-01   +1.172820460967452e-01   +4.944673746298217e-01   +4.189232246727307e-01   +1.439963417301450e-01; +1.854468657542932e-02   +2.204929208119324e-01   +2.133287132313203e-01   +5.470225178855690e-01   +3.538773687867413e-01   +1.769532891624416e-01   +7.415361729693944e-01   +6.456753015952180e-01   +7.470063968856572e-01   +5.853938095339950e-01   +4.718036391548159e-01   +8.360124993593095e-01   +5.886889704372010e-01   +2.787714808856336e-03   +8.961761300717670e-01   +8.757095728148342e-01];
L2E_L1E_iAMPA_netcon = [+8.743425824712671e-01   +1.659743906020014e-01   +8.415854603365474e-01   +6.607319727832019e-01   +8.263600521905441e-02   +1.625541635008177e-02   +9.688072663854819e-03   +1.978926089210278e-01; +2.471262869405033e-01   +6.193248444121718e-01   +1.311056661902659e-01   +1.673519735055068e-01   +5.090633893916828e-01   +8.332637300283237e-01   +3.971670976923942e-01   +7.977658992567611e-01; +7.757776489297540e-01   +3.625850906454480e-01   +6.460172479668767e-01   +5.077918239439685e-02   +8.349683364269618e-01   +4.720624119839735e-01   +7.214590988389209e-01   +7.274653648883285e-01; +5.939066858129696e-01   +8.362962973636602e-01   +7.074714578590202e-01   +5.307962677557942e-02   +7.189216283659366e-01   +2.834500828701842e-01   +1.458232813639300e-01   +5.581764851853717e-01; +1.173692120484287e-01   +1.253439493104581e-01   +5.090396413427890e-01   +3.700421582497916e-01   +4.910448960952239e-01   +2.441945536540822e-01   +4.870535761264034e-02   +4.261959710585123e-01; +7.249352763719893e-01   +8.695505858400215e-01   +8.233322231625146e-01   +3.425498173131543e-01   +6.195547813915360e-01   +6.408869820525195e-01   +3.873411211053353e-01   +1.363445771487224e-01; +4.299202055414428e-01   +1.266294747470903e-01   +2.900343832410982e-02   +8.091134949998835e-01   +2.985508490384717e-02   +3.051795351917489e-02   +1.611847797861531e-01   +5.432748785094497e-01; +2.650739246618264e-01   +5.769193305438816e-01   +1.212366632737365e-01   +5.272656196840220e-01   +8.530834133552009e-02   +8.608095347080320e-01   +7.912978024269784e-01   +8.076064282880230e-01; +4.601097577131932e-01   +2.928074989000301e-01   +4.314443605152249e-01   +6.628286533690642e-01   +8.455027312125565e-01   +8.060461526775696e-01   +6.760246926887786e-01   +3.307740541641204e-01; +8.641283276518423e-01   +2.817826889790760e-03   +1.382691974474512e-01   +3.943410804093292e-01   +8.366454003503085e-01   +1.941517285556567e-01   +6.849278373183120e-01   +7.761214689562032e-01; +5.851700658167389e-01   +1.890370620023280e-01   +9.910626407962010e-02   +8.960007510239805e-01   +4.051198471304211e-01   +7.127930051022149e-01   +4.953168813423554e-01   +7.195440311417445e-01; +8.790774782117681e-01   +5.175810075745562e-01   +8.143492237675939e-01   +5.403698759738447e-01   +8.791229740020742e-01   +3.742928652018433e-02   +6.849613559920290e-01   +8.735727902286249e-01; +1.736315940454524e-01   +4.412263108382873e-01   +1.351329938101838e-01   +8.218550352072238e-01   +6.724709547687302e-01   +2.613155980243420e-01   +2.483975105908696e-01   +8.711208002327956e-01; +2.831527641668219e-01   +4.197555692378255e-01   +5.738912616982014e-01   +9.002083121909484e-01   +6.465955315707546e-01   +2.553756366061307e-01   +6.260423390607615e-01   +3.574293196296455e-01; +1.246462796714215e-01   +8.050849817947641e-03   +7.995920287741132e-01   +7.324470125576540e-01   +8.470567749386415e-01   +3.039263386422734e-01   +7.254312146872695e-01   +2.311900022465009e-01; +2.420691727427884e-01   +5.374752117278038e-01   +4.085669537952079e-01   +6.174299494600700e-01   +2.141730259808036e-01   +4.536641087039122e-01   +6.751651051200239e-01   +5.338654504954853e-01];
L1E_L2E_iAMPA_netcon = [+6.580007453894311e-02   +1.970874142752730e-02   +2.111843056718601e-01   +1.059707758370454e-01   +4.808325816131139e-01   +3.875112055644308e-02   +1.768977919484140e-01   +7.300105595928360e-01   +9.679729467388383e-03   +3.175903573069830e-01   +6.516677280399226e-01   +9.128805494238394e-02   +7.433448759934373e-01   +1.748681516792546e-01   +1.535015809208145e-02   +3.876158666426091e-01; +6.702682980392117e-01   +6.571886409511802e-01   +6.921186894542909e-02   +4.665686735316373e-02   +4.819945630184886e-01   +6.203806520172844e-01   +7.119133082215371e-04   +3.460898938358280e-01   +5.885083464021958e-01   +5.576292292167245e-01   +8.100133267664354e-01   +2.527360881631762e-01   +2.533275379060266e-01   +3.855352524816565e-01   +4.418117210143513e-01   +9.570083612441535e-02; +3.877908938153393e-01   +1.920852930706616e-01   +3.489198590429262e-01   +3.229993551229806e-01   +1.873141391388670e-01   +5.705367935394474e-01   +3.911911831436810e-01   +5.342360777269934e-01   +1.231362321357788e-02   +6.212648243937703e-01   +7.900047509914614e-01   +3.801676710214508e-01   +8.959582373134195e-02   +8.446856561058897e-01   +2.348644255261221e-01   +3.791846931814017e-01; +5.241560398804969e-02   +3.184028753713725e-01   +7.190635207184978e-01   +1.100778053777281e-01   +1.956021827066172e-01   +8.557299541299435e-01   +7.335554614805403e-01   +2.177091055989302e-02   +3.257321681854729e-01   +3.880071970127706e-01   +3.333818819323743e-01   +1.930327090800981e-01   +1.168506846698376e-01   +4.371929741719667e-01   +3.976543527471144e-01   +3.230281965191538e-01; +8.417539208764012e-01   +7.499361083637701e-01   +5.327713367847119e-01   +6.942014405594640e-02   +4.595357357895710e-01   +1.102187260949296e-01   +5.367137888706350e-01   +4.045908480215457e-01   +7.148747329839346e-01   +5.148482625281110e-02   +3.349359919482613e-01   +7.491750302100216e-01   +5.374070926904886e-01   +4.692293086392946e-01   +2.591392546121369e-01   +7.321667020664183e-01; +6.518700404586744e-01   +4.387627742438679e-01   +8.826737323375824e-01   +5.055918610340746e-01   +3.778839242987301e-01   +5.520424955375240e-01   +3.062118964856641e-01   +1.462299961471600e-02   +7.448189605910798e-01   +7.421892841320993e-01   +6.084502862468214e-01   +6.520346434154271e-01   +1.778325416022930e-01   +7.380445688692837e-01   +5.256015264231140e-01   +1.175119759460569e-01; +9.128861039283213e-02   +7.045983024580820e-01   +7.365104178225661e-01   +7.421376451009852e-01   +8.687737478774420e-01   +2.215563832125527e-01   +2.216567128832482e-01   +2.888716334343579e-01   +3.338194502124036e-01   +8.407427662069060e-01   +4.355793776798775e-01   +4.961022936022951e-01   +8.257478977763598e-01   +7.149730516987772e-01   +7.547415800031217e-01   +2.746816804261838e-01; +7.717593707472261e-01   +1.835704112516919e-01   +4.064115245373478e-01   +4.500946485938357e-01   +6.900977008947451e-01   +2.557351183410626e-01   +8.634708396561996e-01   +7.414153860801401e-01   +5.072343059317944e-01   +4.438471892845576e-01   +4.849706372548372e-01   +7.568730204451302e-01   +5.322031838438566e-01   +8.669763525140954e-01   +8.042077978241080e-01   +7.854755772301454e-01];
L2I_L2E_iAMPA_netcon = [+6.031084596154008e-01   +2.681939933757325e-01   +5.576792374054260e-01   +4.896380767927349e-01   +3.493559644178676e-01   +2.938456642035629e-01   +1.191767663303792e-01   +2.790191348441240e-01; +5.613770593129324e-01   +7.219825592678584e-01   +3.369497843539700e-01   +3.569147794350963e-01   +5.901406276013786e-01   +2.667383047743204e-01   +6.083035159467473e-01   +8.122829442899079e-01; +2.817159060021442e-01   +8.018204491927613e-01   +7.728730784027140e-01   +9.028378992923478e-02   +8.534398196737000e-01   +7.623743095574911e-01   +8.301699537092766e-01   +7.415955303727741e-01; +5.213484145867920e-01   +7.698018700909794e-01   +2.721048764363032e-01   +7.572663387530847e-01   +2.694709353513005e-01   +2.915779759424046e-01   +4.728787524753513e-01   +6.838853590220979e-01; +2.081906840577221e-01   +8.299285607185093e-01   +4.091325620953947e-01   +7.088370321601873e-01   +2.230372562000977e-03   +6.879594689751461e-02   +2.536877782131488e-01   +1.522747005327049e-01; +2.558469108837035e-01   +1.337861333434009e-01   +7.070292645234170e-01   +4.690942546901201e-01   +8.613150884500879e-01   +2.472967488920024e-01   +6.070596050576615e-01   +7.530009054949178e-01; +6.337125139657758e-01   +5.208976444391721e-02   +3.751880000681491e-01   +4.368168145399992e-01   +6.251951407795694e-01   +2.185397242574532e-01   +1.378691722194352e-01   +1.218505559191249e-01; +7.322520634610283e-03   +5.411981240874904e-01   +7.546442642778799e-01   +6.835436880217377e-01   +3.061106245276609e-01   +4.142849650091581e-01   +6.634769234182040e-01   +7.242799107318454e-01];
L2E_L2I_iGABA_netcon = [+7.027812614844499e-01   +1.432956843491350e-01   +7.181283433520846e-01   +7.769021256923550e-01   +6.564802187038665e-01   +5.356694183566458e-01   +9.819117021675743e-02   +4.438957688181368e-02; +3.729935586639126e-01   +1.819141437736164e-02   +4.553200660901630e-02   +1.192225286097941e-01   +7.807118471759887e-01   +1.379471936503387e-01   +7.080792181918209e-02   +2.110664842582272e-01; +5.651656511555986e-01   +7.380575145836968e-01   +3.210349535594268e-01   +3.325381513301879e-01   +6.499814597845007e-01   +3.130504326661998e-01   +1.081666641735626e-01   +1.865522830983348e-01; +6.724725226677064e-01   +2.242767540457269e-01   +8.998069878788555e-01   +6.926701896671278e-01   +5.996235589446423e-01   +3.370655410918161e-02   +5.665050486108862e-01   +2.057854274601227e-01; +5.243148190508554e-02   +8.794797964779153e-01   +5.214284315337253e-01   +2.490638043425359e-01   +3.850533490358693e-02   +8.783771613088689e-01   +4.556953750106558e-01   +6.474901749181471e-01; +9.776575359686755e-02   +7.767057648197515e-01   +3.522294000444659e-01   +4.368894141567138e-01   +2.455624763613611e-01   +1.221665872962753e-01   +5.211461167775644e-02   +8.124844768147128e-01; +5.224543484083958e-01   +4.891604086036339e-01   +8.021272681081718e-01   +2.070124880859119e-02   +8.833202995033860e-01   +3.213632080858119e-01   +8.953998493624498e-01   +3.453932804412507e-01; +1.225897610635286e-02   +2.773505479222440e-01   +5.919269460255142e-01   +2.863583885801591e-01   +1.283502823353906e-03   +6.790782247576541e-02   +8.265842350621920e-01   +5.676870177490670e-01];
L3E_L2E_iAMPA_netcon = [+5.452081423991293e-01   +2.171028432454712e-01   +2.598161882012145e-01   +7.694800479418410e-01   +2.070679764725424e-01   +8.486561892707734e-01   +7.459544973236537e-01   +2.073852445614335e-02   +5.616937032305487e-01   +1.847342649092812e-01   +6.462646110599386e-01   +7.428282971369375e-01; +6.371369338705763e-01   +8.571674500018628e-01   +1.502923501602589e-01   +6.877657218280617e-01   +7.028789464494353e-01   +2.528193307528155e-01   +4.814581808569221e-01   +7.830469648273423e-01   +7.768269623083394e-01   +3.775196067681169e-01   +7.267870643396166e-01   +2.633934929432613e-01; +1.479822314447157e-01   +7.084919370657142e-01   +2.286715184858902e-01   +8.346915672496354e-01   +2.418977867395798e-01   +4.326288361099653e-01   +7.685344822784587e-02   +7.883865474068593e-01   +1.624650520686677e-01   +3.948051330321353e-01   +3.374681736015708e-01   +2.592599583245028e-01; +5.542992983924032e-01   +5.825989667123027e-01   +2.997350593348562e-01   +1.588987017392231e-01   +1.963950624129878e-01   +1.199281751858094e-01   +7.930232685823135e-01   +2.214360510986796e-01   +1.259952979820565e-01   +7.540659733659828e-02   +3.553423358297996e-01   +6.851110963669654e-01; +2.875308944691062e-01   +5.578742249921373e-01   +6.378909723991348e-01   +7.639079185907850e-01   +2.875517117527358e-01   +5.282735203245724e-01   +2.338973551853674e-01   +4.572227724546761e-01   +3.788112508812773e-01   +6.408420822481582e-01   +8.820122435642384e-01   +7.629676175913916e-01; +2.326130589955101e-01   +6.052776201407438e-01   +6.563456575118202e-01   +4.685315232363306e-01   +8.872009277356923e-01   +7.386877429829791e-01   +5.238696213820607e-01   +6.723664908261572e-02   +5.733016924015495e-01   +7.075342919188160e-01   +5.255379090987849e-01   +2.480645017118194e-01; +1.678697149158989e-01   +8.348667613245041e-01   +3.367701456237772e-01   +4.277911132109261e-01   +1.583591748644231e-01   +3.981103685206953e-01   +2.057600434551812e-01   +7.654472385177257e-01   +5.860105761373354e-01   +7.830939849864462e-01   +4.870024688522158e-01   +4.379478491994258e-01; +6.654061982209560e-01   +7.418472573783371e-01   +4.456739255666625e-01   +7.064160331618302e-01   +3.771242196299718e-01   +2.770094352375578e-01   +5.083442312872986e-01   +6.050176582349512e-01   +8.114839865171188e-02   +3.525629986440603e-01   +7.355925526988136e-01   +3.943530027629911e-01];
L3I_L2I_iGABA_netcon = [+7.087930523116985e-01   +7.937700365651030e-01   +2.973138848796583e-01   +8.661975821862622e-01   +1.902146523432506e-02   +6.177288527261340e-02   +3.585806296715299e-01   +8.453063469321028e-01   +7.554730217378530e-01   +4.740390385583906e-01   +8.435926854004153e-01   +6.308018652723275e-01; +2.101145920854161e-01   +9.448805471955517e-02   +7.371731082371556e-01   +5.305926401202093e-01   +1.838573328951368e-01   +1.582411769282303e-02   +5.726205532234108e-02   +4.231850324344655e-01   +8.897954228523481e-01   +7.195689019256553e-02   +7.824134507551366e-01   +8.510089363451943e-01; +6.892163344968910e-02   +7.792986164800779e-01   +4.992979289951147e-02   +2.698659444148584e-01   +6.300297446496610e-01   +3.993243103921331e-01   +1.414398838322694e-01   +4.644101965625230e-01   +3.367269374010035e-01   +4.340011345317679e-01   +3.244699135018408e-01   +5.017267773129021e-01; +3.400132548066445e-01   +7.717118865329400e-01   +2.275462268704253e-01   +1.836455536910608e-01   +2.558651167470891e-01   +5.455232464076401e-01   +8.419770707880888e-01   +3.171610596266002e-01   +2.567119387087079e-01   +7.907497369434732e-01   +2.564775091100985e-01   +3.805683719346788e-01; +6.700018274128902e-01   +8.790096617780638e-02   +2.482401279385115e-01   +5.600027946045770e-01   +8.527021417313743e-01   +1.994160397560485e-01   +6.483614786632764e-01   +2.858048472981505e-01   +8.392079998572339e-01   +4.899775639344420e-01   +2.093670542640887e-01   +7.908192973668838e-01; +4.243147164913883e-01   +6.905771583081691e-01   +3.552732904943287e-01   +8.099703641890911e-01   +8.272316157050210e-01   +2.478397562622781e-01   +5.406237058880502e-01   +4.800642552574536e-01   +2.307934563634331e-01   +3.112457912252000e-01   +2.765209789047932e-01   +8.467834440084334e-01; +3.203491931293255e-01   +5.305662111491336e-01   +8.004305130281885e-01   +4.886418961061851e-01   +8.638859028743056e-01   +1.524628933308848e-01   +3.199358304790440e-01   +7.138868819977008e-01   +8.796696967813442e-01   +6.085844138453849e-01   +7.358505755142680e-01   +5.742569512062865e-01; +2.285049036068365e-01   +3.565164769131562e-01   +4.106886808623049e-01   +8.675923390945223e-03   +2.480559215032487e-01   +8.818392770265524e-01   +4.801924806990367e-01   +7.467256066805711e-01   +5.362833502039887e-01   +6.205604804701174e-01   +5.384470849921564e-01   +4.663083298125090e-01];
L2E_L3E_iAMPA_netcon = [+6.847761314131140e-01   +2.222539977644228e-01   +7.336039309131719e-01   +4.586020167310885e-01   +1.796902287041229e-01   +1.508204331158398e-01   +7.474970167781405e-01   +8.745857613295728e-01; +6.631023285312197e-02   +5.518525461304344e-01   +7.292946227802536e-01   +1.107074287670140e-01   +7.331872251808129e-01   +9.107327548767714e-02   +3.675178861485909e-01   +8.105872529129889e-02; +1.009429608061282e-01   +8.377566710715032e-01   +8.215047320180819e-01   +5.104967003045466e-01   +8.052521862085945e-01   +1.804387306597466e-02   +1.586182764648811e-01   +3.560854164336411e-02; +3.901633035881417e-01   +2.923524595481760e-01   +3.716788926011009e-01   +6.794034631035072e-01   +1.038956144981022e-01   +8.709560994890034e-01   +7.430800559807975e-01   +8.702919884207942e-01; +1.436845427941818e-02   +6.241545797327291e-01   +4.408374574528347e-01   +1.385345912096473e-01   +3.940136322496163e-02   +6.556295349429067e-01   +8.442412934230573e-01   +1.262726875826766e-01; +3.524409356873617e-01   +8.058825654955407e-01   +9.975256108238166e-02   +6.472959911267810e-01   +3.616018449358908e-01   +4.799328498903623e-01   +7.920159295651312e-01   +6.713750969089490e-01; +1.843018280795827e-01   +4.546131865359092e-01   +4.858902358887945e-01   +2.399551449389604e-02   +8.963809550898839e-01   +9.762190279992655e-02   +1.693340609746877e-01   +4.800726623668622e-01; +4.522671651820829e-01   +6.129421720159567e-01   +2.084405179746515e-01   +7.581410114314248e-01   +3.860019485093511e-02   +6.644778220790579e-01   +4.846469792929881e-01   +3.465999047212551e-01; +2.179097656580966e-01   +6.545299488246120e-01   +5.408145349962704e-02   +8.587059689547357e-01   +6.854547385454752e-01   +5.956341874638249e-01   +2.196790578245458e-02   +5.063072975775156e-01; +6.068381786602047e-01   +8.873253278406701e-02   +7.160865213539281e-01   +2.695958162213997e-01   +8.171088277516522e-01   +6.063926520648902e-01   +2.435733055633571e-01   +3.792980721483628e-01; +8.635373731468111e-01   +5.420964588661932e-01   +1.822642417909050e-01   +4.804296543867229e-03   +9.613538829135087e-03   +4.245099532328745e-01   +6.324548016247883e-01   +1.239096043131331e-01; +1.332659036158795e-01   +1.665364456038076e-02   +3.262184081740767e-01   +8.399186603198152e-01   +8.730916852527075e-01   +1.728000092387119e-01   +5.474792404173352e-01   +7.097433237768764e-01];
L2I_L3I_iGABA_netcon = [+5.934491814052730e-01   +3.124236609488052e-01   +5.288825172210226e-01   +1.440177275376174e-01   +4.181113635201453e-01   +4.086758357364841e-01   +8.969426754513683e-02   +8.466323930006452e-01; +8.262715687137498e-01   +2.676018818553036e-01   +6.726175240390889e-01   +3.091488028368831e-01   +2.309559669612485e-01   +2.953577194704386e-01   +8.222573036698863e-01   +4.845016645274587e-01; +8.383747667076970e-01   +1.513799710727967e-01   +7.739534304991064e-01   +6.388617847116707e-02   +6.299462378653211e-01   +8.725233108992944e-01   +2.294718837311213e-01   +3.204049409898248e-01; +2.559660987839802e-01   +7.122551316849377e-01   +4.317585620320496e-01   +7.375919199290516e-01   +8.874555861242305e-01   +8.448164890179635e-02   +2.196108935186845e-01   +3.388872321406569e-01; +6.226940118372424e-01   +4.761521397040699e-01   +6.633982890547439e-02   +7.885650557335049e-01   +3.726958408795644e-01   +7.831113108873591e-01   +8.767226488454100e-01   +6.199688837747167e-01; +9.896655133730933e-02   +6.598248050055998e-01   +5.408554029598164e-01   +5.356115382119789e-02   +8.065486411151275e-01   +8.573287704357440e-01   +7.610852144420339e-01   +3.962596684656809e-02; +2.809675389174342e-01   +4.544592220209830e-01   +5.015557171724142e-01   +3.057711940895570e-02   +7.887045257194004e-01   +4.610739372638933e-01   +4.637490630240025e-01   +5.804936316777141e-01; +5.324060076183613e-01   +1.730574519596590e-01   +7.872353244007115e-01   +1.012737607721175e-01   +8.903851417728342e-01   +3.767937765128361e-01   +2.339668020910957e-01   +4.099525451263791e-01; +3.803519768106111e-01   +6.982175805955987e-01   +6.339634899956819e-01   +4.181399413361831e-01   +8.347827507655815e-01   +6.079996831458474e-01   +8.842742434190112e-02   +5.051726250311089e-01; +1.807748894416783e-01   +6.061773202776369e-01   +4.661497830954441e-01   +7.558373871699275e-01   +5.983534764090623e-01   +1.745973351811505e-01   +8.803810542241598e-01   +1.797781244396065e-01; +1.237763549457715e-01   +4.705783711841404e-01   +3.903414538024587e-01   +4.889941132127301e-01   +6.077295842442471e-01   +2.810329723823780e-01   +5.894891739174940e-01   +4.869049907187890e-02; +7.055855158974401e-01   +5.466072853049395e-01   +1.111502415633462e-01   +4.542439505443115e-01   +3.549391371835722e-01   +4.307932682665301e-01   +4.640191021450149e-01   +3.837098425148553e-01];
L3I_L3E_iAMPA_netcon = [+4.853261465097281e-01   +2.763780423246042e-01   +1.043397682025470e-02   +8.038096827050849e-01   +7.261058397078126e-01   +1.369797177588122e-01   +7.994839052804227e-01   +6.582248476162139e-01   +7.967751702617193e-01   +7.300417778731468e-01   +7.551782090348970e-01   +8.801837405818845e-01; +1.104582605156198e-01   +4.995809383968638e-01   +5.063806650839928e-01   +2.440601216874218e-02   +4.693569952002490e-01   +7.380174256163587e-01   +4.009230746294704e-01   +8.339553985210363e-01   +7.412228266809234e-01   +8.524447864532009e-01   +7.685640173409075e-01   +2.918642941411747e-01; +8.812754933266523e-01   +8.269937185722974e-01   +2.781486703813920e-01   +2.919389503638393e-01   +1.186143884985343e-02   +2.129742802808242e-01   +1.746735722276047e-01   +5.795974187080495e-01   +1.391628054863288e-01   +7.804247690653928e-01   +5.583627239468296e-01   +9.954083626596352e-02; +5.084527118561128e-01   +3.389752381605899e-01   +8.112888449656385e-01   +7.948202989082432e-01   +5.370941826083154e-01   +1.165227211639847e-01   +4.891971875832354e-01   +7.832952929177379e-01   +7.575512762810259e-01   +7.663938548014063e-02   +5.212702911937100e-01   +1.475294885125855e-01; +5.357804322459615e-01   +1.685229785717257e-01   +7.072500954448181e-01   +8.001877314013350e-01   +7.333428635677656e-01   +4.000106558723818e-01   +4.148543205318835e-01   +7.391576126113119e-01   +7.084216517451576e-01   +6.789597393312670e-01   +1.497176286132623e-01   +6.814461910555368e-01; +5.917396866738479e-01   +3.376622768780207e-01   +5.855851766856746e-01   +8.089241725642523e-01   +7.299687174966952e-01   +5.100471405909520e-01   +8.686814005100482e-01   +7.504914561222849e-01   +7.720531294988561e-01   +4.336670436289611e-01   +5.822002518913618e-02   +2.233416676708823e-01; +5.810341037487035e-01   +2.170198606498047e-01   +1.454100023313578e-01   +6.671881682339446e-01   +4.875753057136024e-01   +7.834593976643660e-01   +3.588403663931481e-01   +4.835016927560709e-01   +5.997330717837631e-01   +8.438903949058003e-01   +8.778972764019908e-01   +7.068849292103171e-02; +1.502182180269411e-01   +1.412666271187163e-01   +7.669118689963779e-01   +4.427445942091590e-01   +7.905719455926860e-01   +3.948650830407675e-01   +2.812119462844227e-01   +4.707544740303263e-01   +7.810945145918511e-01   +6.233220996618679e-03   +4.962775607688779e-01   +2.495433572558587e-01; +2.704286077508357e-02   +3.101127402889056e-01   +8.654450095747162e-01   +1.924862034639289e-01   +1.493685460529103e-01   +2.999107375968395e-03   +4.222032382135423e-01   +1.519960246326819e-01   +2.958262836353973e-01   +3.656976695853929e-01   +4.717074035825838e-01   +3.999596182865102e-02; +6.421561785910771e-01   +4.571942380624189e-01   +6.539232142207878e-01   +4.542745994358959e-01   +7.869053346805333e-01   +2.060369293640169e-01   +6.539333564457916e-02   +5.544560209262039e-01   +4.305874629834182e-01   +3.297976028545899e-01   +3.643400189461790e-01   +4.629198117728080e-01; +4.579600928162548e-01   +1.043707042519491e-01   +6.572284198443125e-01   +3.644831759883601e-01   +3.706355135481156e-01   +8.385563518425018e-01   +7.427119802325518e-01   +7.307326558282177e-01   +4.877836532944952e-01   +4.571220988697772e-01   +5.938566441451976e-01   +2.313942842735668e-02; +7.261846087485547e-01   +7.199333500263868e-01   +2.139766627580811e-01   +6.503020818073793e-01   +6.481852205612448e-01   +5.926280524678520e-01   +2.982798424253441e-01   +8.212456624022717e-01   +8.480104476890022e-01   +1.798154349486763e-01   +3.393865697132277e-01   +3.721526727018938e-01];
L3E_L3I_iGABA_netcon = [+8.826590458423418e-01   +6.242311489647362e-01   +4.143421138810391e-01   +3.713617087119138e-01   +5.535661795635944e-01   +2.072710843612480e-01   +2.413581752111735e-02   +7.068030651607100e-01   +8.427362400396823e-01   +4.220256395585603e-01   +2.748997353673486e-01   +3.376973364189356e-01; +3.962016028225011e-01   +1.372367658523161e-01   +1.242469335296877e-01   +8.075311132838084e-01   +8.609476071379724e-01   +6.366527286309162e-01   +4.682660974008466e-01   +4.194448404419208e-01   +3.335365009079923e-01   +6.096068601125815e-01   +2.031086832801426e-01   +7.609600429446746e-01; +6.535006299885689e-01   +3.271144360397722e-01   +7.014763563702585e-02   +5.295482772429089e-01   +1.177140757131265e-01   +8.347069374983519e-01   +2.590492522062681e-01   +5.757568614701357e-01   +8.666706558473584e-01   +9.114863015358807e-02   +8.772857837910624e-01   +7.504876064018732e-01; +4.432036029304705e-01   +7.809025396248658e-01   +8.883805152552340e-01   +5.173919201318288e-01   +5.819801594578820e-01   +7.327246380477845e-01   +4.570217236832552e-01   +8.554104710861380e-01   +8.563574106471474e-01   +6.769258402874752e-01   +8.935870567974372e-01   +5.063096043641866e-01; +5.030952728200818e-01   +5.190078957630053e-01   +8.785557422445600e-01   +7.769500009593006e-01   +4.698729595840309e-01   +5.645268327497195e-01   +8.001130574172218e-01   +3.658181354487889e-01   +6.424686022823622e-01   +7.437438496371968e-01   +3.455526509135102e-01   +2.656302127121372e-01; +6.980868056949221e-01   +2.785487645437131e-01   +6.217348164382588e-01   +8.055406407387893e-01   +7.230804742726209e-01   +1.230335365359162e-01   +3.349188680123303e-01   +1.925378472755063e-01   +5.350822694741968e-01   +7.426201840688439e-01   +4.314886451044028e-01   +5.831279571284539e-01; +8.719789439507127e-01   +6.851428563217234e-01   +3.924564437331171e-01   +5.682079592530669e-01   +2.481537555541483e-01   +1.639567687796358e-01   +4.484547398810943e-01   +7.603229665002824e-01   +3.140528516905577e-01   +1.508281897162068e-01   +3.696038806847297e-01   +3.579486463107104e-01; +6.384099019515809e-01   +1.761188545549675e-01   +4.969585431663044e-01   +3.911346317084172e-01   +2.669046223810770e-01   +8.543170059468305e-01   +6.753479473080104e-01   +3.976282268542558e-01   +1.611478983898622e-01   +3.281814509325619e-01   +8.324949440956754e-01   +1.010629067133217e-01; +3.969511206798118e-01   +7.296385595997099e-01   +3.003883762635956e-01   +5.788259462913691e-01   +7.814387887037802e-02   +6.904563609032173e-01   +3.878541502924636e-01   +4.253019565369477e-01   +7.774407303227681e-01   +5.268596296660406e-01   +4.356302363718719e-01   +5.309015323814810e-01; +6.018676797732583e-01   +8.192321137498831e-01   +3.372836319267599e-01   +1.920665550777585e-01   +4.915107402123098e-01   +2.608394212348674e-01   +2.091477106686352e-01   +2.848816373306014e-01   +4.821540116302651e-01   +2.304749095618784e-01   +8.119653116342211e-01   +1.278797084112968e-01; +5.399132912812312e-01   +2.254387352018785e-01   +6.394378239192002e-01   +4.307204020732824e-01   +7.444663459090839e-01   +2.451417099585909e-01   +1.079837426826254e-01   +3.451297743315559e-01   +3.700737158723074e-01   +8.815810800290343e-01   +7.595767506780194e-01   +1.889155522229364e-01; +3.040671556665260e-01   +8.291150426398161e-01   +5.074048257232067e-01   +6.733076208737504e-01   +3.246408410867867e-02   +5.840822216880898e-01   +6.931473326136341e-01   +6.473376927413433e-01   +5.919178731894640e-01   +2.368398665621928e-01   +3.231654177374352e-01   +9.068071651687942e-02];
L2E_Input1_iAMPA_netcon = [+9.001059666073356e-01   +8.999423505596258e-01   +9.002136533662667e-01   +8.997375920286353e-01   +9.004105859354544e-01   +8.998437710384278e-01   +8.996928716219060e-01   +9.000357158057433e-01];
L2I_Input2_iAMPA_netcon = [+9.002639258345033e-01   +9.001110062748895e-01   +9.003137902762764e-01   +8.995787584638140e-01   +9.000014413705761e-01   +8.999603031026837e-01   +9.002085255408063e-01   +8.995833046101335e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = -20*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
