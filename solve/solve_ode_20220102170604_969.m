function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.830118771752557e-03   +1.392863880231532e-02   +1.765266003566091e-02   +1.928048956937074e-02   +1.544389651902555e-02   +2.831506007415312e-02   +6.268025540537035e-03   +2.893757164550630e-03   +6.389786382198131e-03   +1.001918761398616e-02   +1.269187147084027e-02   +5.599830979589286e-03   +1.622314307885324e-02   +2.103099618920056e-02   +1.261398464496733e-02   +4.174117801939113e-04; +1.178815920832568e-02   -2.797353960623049e-03   +1.399807328965158e-02   +1.826306985364375e-02   +4.583860897267145e-03   +1.871561228784219e-03   +2.442982128720238e-02   +2.270644095327071e-02   +1.916981832344160e-02   +1.239914603266359e-02   +2.538907277882751e-02   +7.771686214248535e-03   -9.064755096346497e-04   -4.579163226931252e-03   +8.183442225526683e-03   +1.386681997218098e-03; +1.212571241118627e-02   +1.541395218185260e-02   +1.871886974020776e-02   +9.983440726363566e-03   -2.043203617542348e-03   +2.228058738915880e-02   +2.269781835261456e-02   +1.233807749998683e-02   +8.739961863983473e-03   +1.637805534605783e-03   +1.274669520147482e-02   +8.205255455796954e-03   +4.913609657445285e-03   +8.588538318726885e-03   +2.191800317240600e-02   +1.558709077297228e-02; -5.866097302759184e-04   -1.264950277619354e-03   +8.610825898212918e-03   +1.584902855288468e-02   +3.427277078166213e-03   +1.493435353813211e-02   +1.621637721845192e-02   +2.030905019951297e-02   +1.223924053422341e-02   +4.046084229985472e-03   +2.564334523231871e-02   +1.773932045432067e-02   +8.614236881142000e-03   +2.622814244524669e-02   +9.775080482322561e-03   +5.263815412366838e-03; +1.115332321184119e-02   +1.195384689514757e-02   +1.516359751852191e-02   +1.601818822227739e-02   +1.328812715649444e-02   +2.638153491259205e-02   +5.241294065489375e-03   +6.327170638592673e-03   +1.869056273316587e-02   +2.805300442180156e-02   +1.558114851645327e-02   +1.602982576306696e-02   +5.313779370779893e-03   +6.331924549318074e-03   +3.026193133609332e-02   +1.907408662714882e-03; +1.198241149442466e-02   +2.022248976462196e-03   +1.642140511305808e-02   +5.336888750364834e-03   +1.142200360854208e-02   +1.298524451415390e-02   +1.091013457007652e-02   +6.522266899264148e-03   +1.099779520857743e-02   +1.717546210036903e-02   +1.835858714845212e-02   +9.390838044962156e-03   +1.310726505028180e-02   +6.956509652071825e-03   +8.637887990606830e-03   +1.754000353536843e-02; +5.229735980592400e-03   +1.468422994322885e-02   +2.273051781614124e-02   +1.847475528786608e-02   +1.457428466338292e-02   +1.402830547489806e-02   +5.745755277825831e-03   +2.340219337623074e-02   +2.659462589976620e-02   +3.717844794057556e-03   -2.745556395818983e-04   +3.733370089790272e-03   +6.724947131991397e-03   +2.029670419035582e-02   -3.880990865728364e-03   +7.932157708120317e-04; +1.926046332053538e-02   +7.338782199724106e-03   +2.215968396803033e-02   +1.925536081512244e-02   +1.344935875965913e-02   -1.361965177858777e-03   +4.316573384606446e-03   +1.347772871125750e-02   +2.184143227048717e-02   +2.062903469772168e-02   +4.818528134540536e-03   +1.535420301051473e-02   +8.796934072835241e-03   +2.415898713503863e-03   +1.911600467807733e-02   +1.945034785189739e-02; +5.632415235616719e-03   +2.015856530564518e-02   +1.627669271692350e-02   +1.341036518641258e-02   +1.352339746945682e-03   +2.114554798338537e-02   +8.772924879249846e-03   +1.091053558735837e-02   +8.859528591513822e-03   +1.335339918844891e-02   +7.871167699602864e-03   +2.419451090896324e-02   +2.586398652138583e-03   +2.240518144682304e-02   +4.552965263858178e-03   +7.840023276841943e-03; +9.217077446554808e-03   +1.967797739146655e-03   +2.299562035883862e-02   +1.405182755814088e-02   +1.294997353970366e-02   +3.543671112346170e-03   +4.386837924320681e-03   +4.829461190226903e-04   +1.245845420816511e-02   +8.233406284480998e-03   +5.955414222546066e-03   +1.457571828382171e-02   +2.601434125897061e-02   +1.697357592560536e-02   +2.345636111753426e-02   +1.415695031427153e-02; +5.352058216404795e-03   +6.605688164518830e-03   +1.731570318058224e-02   +2.192962918464310e-02   +1.652950847379049e-02   +8.048201397546816e-03   +1.837962790963575e-02   +1.761678051427813e-02   +7.776217186999737e-03   +7.935857273894540e-03   +1.867081926128889e-02   +2.022739625589123e-02   +4.487632474727898e-03   +1.135494996246598e-02   +1.844411788724301e-02   +9.372175994025487e-03; +1.807134974272767e-02   +4.580228140181176e-03   +2.206648132309317e-03   +2.001830606175853e-03   +1.803951090338020e-02   +2.664434460080192e-02   +2.643045504478258e-03   +1.769261465337024e-02   +1.443334633405922e-02   +5.372256942932193e-03   -3.177785530593818e-04   -4.060898599547925e-03   +2.500874368883443e-02   +3.666954718541346e-03   +1.562486296255368e-02   +1.256290072989950e-02; +1.910279214810334e-02   +1.770824438474515e-02   +1.509716082035285e-02   +5.751778100943598e-03   +2.100651799889655e-02   +1.282344954181075e-02   +1.501877234821702e-02   +1.974500449169045e-02   +2.373457714634240e-02   +9.081154248452173e-03   +4.517498708894444e-03   +2.545677808159121e-02   +1.357638085037114e-02   +1.533361880404789e-02   +1.686477266505534e-02   +2.332257363283752e-02; +1.953975712044151e-02   +1.904961291384746e-02   +8.013278543740022e-03   +1.327121209867882e-02   +5.539067545937445e-04   +7.066399664461593e-03   +2.662863720289064e-03   +2.960225882080738e-03   +2.510514869042883e-03   +2.010905252809132e-02   +5.237154038431948e-03   +2.674786626045487e-02   +1.735484704106427e-02   +1.256720148838936e-02   +7.394679291446221e-03   +1.025474524222502e-02; +3.636651405065787e-03   +1.768247091973837e-02   +2.293578905985480e-02   +1.120171581794896e-02   +1.595986749806128e-02   +6.722644729301152e-03   +9.274633608403674e-03   +1.203493770785101e-02   +4.672906642389316e-03   +2.375644065900869e-02   +1.539725303541879e-02   +2.233786773986517e-04   +2.251435491965921e-03   +2.260430754498340e-02   -1.375639816081356e-03   +1.444787076517615e-02; +2.151151420858950e-02   +2.730555881121578e-03   +4.995063223683425e-03   +2.760700525153673e-02   -2.226855555383014e-04   +4.437516300260406e-03   +1.807018583179031e-02   +4.728687050848338e-04   +9.346499677601348e-03   +2.037535917154493e-02   +1.848725251299040e-02   +7.181612577453833e-04   +2.163821063528632e-02   +1.929545731119702e-02   +2.331413650094766e-02   +2.319144381230152e-02];
L1E_L1I_iGABA_netcon = [+1.190538140362916e-02   +1.723461743728831e-02   +2.120896188027256e-03   +1.261096995543437e-02   +1.906542924576115e-02   +1.115667580767696e-02   +1.552143390375280e-02   +4.084699828374468e-03   +5.750297477780072e-04   +7.140971540962048e-03   +5.778428571205842e-03   +1.192994385158498e-02   +1.082909890173915e-02   +2.307404776888128e-02   +3.540903779604883e-04   +7.871727651587874e-03; +5.208844979046274e-03   +1.700081546719845e-02   +1.188585761974921e-02   +2.088092171806074e-02   +1.368601387330821e-02   +1.073316882621534e-02   +1.794281221150263e-03   +1.725707500354449e-02   +1.602059229320486e-02   +4.335128339502717e-04   +1.253199703710514e-03   +2.014054642583487e-02   +6.409702170222980e-03   +1.315241442215319e-02   +9.600142576887566e-03   +2.426920217111156e-02; +1.153510380543891e-02   +2.973724361943462e-02   +2.393762927226104e-02   +1.772693604864709e-02   +1.226441532281227e-03   +1.506347016984930e-02   +1.875587307782562e-02   +1.752223035161754e-02   +2.687030082121824e-02   +2.128703394160617e-02   +2.012197841295543e-02   +1.379477108277933e-02   +2.467372962946506e-02   +1.941197270588602e-02   +7.477488318611563e-03   +1.514074169225319e-02; +1.428435054260929e-04   +1.009627200204092e-02   +2.368329062442632e-02   +7.102214441429430e-03   -2.634956852149223e-03   +1.256749073869701e-02   +2.010139645656870e-02   +1.281162136339033e-02   +1.351075024924600e-02   +2.446605831577146e-02   +1.433713871289796e-02   +3.066983329679470e-03   +1.195457984769937e-02   +1.080913893804098e-02   +5.186641894403407e-03   +2.247688807462299e-02; -1.124259874619168e-04   +2.259517420701777e-02   +1.137914114114106e-02   +4.726409765573244e-03   +1.445716103012163e-02   +2.105659766642929e-02   +1.478749086799429e-02   +1.016568309708668e-02   +2.781253033402381e-03   +3.363408341775660e-03   +2.091097320331164e-02   +3.604620965556447e-03   +1.520382678362659e-02   +7.630784187684010e-03   +1.260062770610660e-02   +8.825662774521176e-03; +1.838392182960172e-02   +1.901780353593653e-02   +6.495682129391972e-04   +1.646256746541228e-02   +6.037788559808295e-03   +4.053108219773042e-04   +1.786088374102764e-02   +6.424193476632577e-03   +2.248678598079338e-02   +2.502208438323909e-03   +1.524197026276227e-02   +7.329375969744294e-03   +8.775120952819449e-03   -9.283737759408820e-04   +1.745750860520972e-02   +1.559403464240079e-03; +1.365875489343472e-02   +5.030126682289397e-03   +2.658152306404335e-03   +7.764919353253817e-03   +7.389980829264182e-03   +1.176065915066452e-02   +1.060068365351912e-02   +1.150905634158202e-02   +2.496644612711803e-02   +5.714450682476713e-03   +2.320439419231298e-02   +2.380917151589115e-02   +3.038393076185610e-02   +1.652581423766373e-02   +1.035310197571142e-02   +8.370169164648101e-03; +2.767959334219498e-03   +4.073059005244954e-03   +1.904091559233208e-03   +3.659678781540734e-03   +1.433544070284668e-02   +1.042957098114584e-02   +1.272895852062339e-02   +1.618796573874384e-02   +3.935108903767952e-03   +1.247959329674090e-02   +1.682575843760362e-02   +3.375334003600482e-02   +1.240088338088641e-02   +1.379621339308458e-02   +1.699165359908668e-03   +2.103850292666805e-02; +6.163026073286488e-03   +1.224038376705079e-02   +6.267943397929454e-03   -1.853109997873515e-03   +9.454123636654228e-03   +1.712998612243870e-02   +2.498336133898978e-02   +2.595554295513759e-02   +8.963539620163767e-03   +5.139573947959225e-03   +1.899671376147553e-02   +1.018965102514812e-02   +2.417326506118265e-02   +2.865316829970144e-02   +9.181405218253362e-03   +6.849655187130930e-03; +2.270299268314077e-03   +8.490606862273334e-03   -3.690828405020490e-04   +1.994478222484475e-02   +3.500303339370643e-03   +1.920770286615849e-02   +1.089984522787408e-02   +1.263481680056411e-03   +2.409459754772397e-02   +1.863578611204134e-02   +9.193680299422798e-04   +1.863073973005791e-02   +2.479222350150400e-02   +1.450607050263670e-02   +1.302420406265211e-02   +6.627769399277948e-03; +2.448434415329030e-02   +4.423429452991234e-03   +9.784882661593948e-03   +1.110610825001956e-02   +1.790632167959978e-02   +1.240083433744268e-02   +1.439196777582255e-02   +2.290736894973119e-02   +1.072665634388892e-02   +1.035631149266116e-02   +1.666839875116835e-02   +1.525177112700419e-02   +6.718433587748387e-03   +2.675539004864786e-02   +1.993090485247882e-02   +7.690919071389749e-03; +1.259362757051610e-02   +2.166415988613347e-02   +1.287169579236848e-02   +2.560299081233048e-02   +2.709100598900173e-02   +1.600952854804187e-02   +1.360209601053717e-02   -1.727432962390094e-06   +1.822535453520376e-02   +1.260634875736075e-02   -2.359194652996312e-04   +2.057484048713092e-02   +1.186496813365221e-02   +2.075028891312184e-02   +1.737992580374231e-02   +7.921941412144980e-03; +2.254300236551850e-02   +1.116287405894658e-03   +1.286138953557199e-02   +1.096310505958454e-03   +8.760651412801078e-03   +1.654532333470869e-02   +7.488033603291222e-03   +6.804669813071495e-03   +1.896813305141603e-02   +2.317950764367737e-02   +8.174913256174074e-03   +1.984371778097828e-02   +2.885994306724191e-02   +1.851892915144201e-02   +7.122550210869326e-03   +4.637389023296734e-03; +8.514168969413777e-03   +2.792593088588122e-04   +1.473388859927775e-03   -1.944831811576613e-03   +4.014978319708254e-03   +2.027002375363975e-02   +2.992100039651208e-02   +1.788985421538820e-02   +6.808129489445006e-03   +1.363503386371923e-02   +1.652154026261450e-02   +1.458149146417041e-02   +1.347053836582143e-02   +2.234139706701799e-02   +1.991269567044221e-02   +1.965549288537635e-02; +1.610482491245613e-02   +2.055485259474679e-03   +1.055232665097930e-02   +1.841691362369929e-02   +1.330501325039302e-02   +9.220492752584897e-03   +2.350458585031394e-03   +1.012200563821948e-02   +5.465822309622327e-03   +1.715064399081631e-02   +7.475701144784776e-03   +1.141164438317929e-02   +6.488307499797417e-03   +2.400118709328223e-04   +3.520697737674059e-03   +1.163807798660792e-02; +1.355812090066840e-02   +4.135850158398433e-03   +9.992379053717965e-03   +2.181133126606002e-02   +2.575022638190280e-02   +7.647864100645791e-03   +5.754412212673879e-03   +2.311972561661380e-02   +1.921560949648480e-02   +1.050538458122605e-03   -3.883777523921133e-04   +1.215996642283467e-02   +2.233597491771022e-02   +1.857619240293425e-02   +7.595932156215618e-03   +1.345516631536576e-02];
L2I_L1I_iGABA_netcon = [+2.984523126168418e-02   +8.506487925825668e-03   +5.791942646706446e-03   +2.284907939418671e-02   +2.619908193587606e-02   +2.068207333874812e-02   +5.471528847566716e-03   +2.397312027576145e-02; +1.947105299724888e-02   +2.117246125143026e-02   +1.377637167992735e-02   +9.335069212563272e-03   +1.293998777912281e-02   +1.706495618056863e-02   +1.851588624345324e-02   +2.655710633439779e-03; +2.664916420023322e-03   +7.916108297535380e-03   +2.370777696581143e-03   +7.541738602432582e-03   +2.651534786520836e-02   +2.417771171127200e-02   +6.143606902641825e-03   +1.457326583232594e-02; +4.443105462678593e-03   +2.426479324831308e-02   +1.697667475338935e-02   +1.764223454003824e-02   +1.676391453577382e-02   +1.507901100900124e-02   +1.119289446947518e-02   +2.708457583980090e-02; +9.463046270047210e-03   +3.859643912556036e-03   +2.016011413548686e-02   +1.258489071246012e-02   +9.988041702982628e-03   +2.239576271319637e-02   +1.214490520377676e-02   +1.975628077903841e-02; +2.091351071616846e-02   +1.841208197896215e-02   +2.056534933153079e-02   +1.512662473343742e-02   +9.297672975892478e-03   +1.461578982666083e-02   -2.633927277247138e-03   +1.539031013269994e-02; +1.751067431239922e-03   +9.416343028909036e-03   +9.043624400006688e-03   +1.206382007927422e-02   +1.674624958782549e-02   +4.364870782123487e-03   +7.007284365411211e-03   +2.411535298544205e-02; +1.248584115441049e-02   +9.226802025596472e-03   +2.071966407928712e-02   +1.008771957256607e-02   +4.220887258686364e-03   +2.093655922549422e-02   +1.652747786142196e-02   +4.771726188501049e-03; +1.465014665999127e-02   +1.283501452333728e-02   +1.228884848076590e-02   +1.016502831323183e-02   +5.639731154129714e-03   +6.740788035047994e-03   +1.074588515893568e-02   +2.487909372042548e-02; +5.980503971408441e-03   +1.323145241013932e-02   -6.182387018092726e-03   +1.027629597552227e-02   +5.169043943817629e-03   +1.488817781568225e-02   +2.381728299819260e-02   +1.326902126292537e-02; +5.527435076048848e-03   +2.020124822887047e-02   +2.274980798811618e-02   +6.063049664566044e-03   +1.692715654187555e-02   +2.226156017478139e-02   +3.467005098307174e-03   +9.165319604597547e-03; +1.959294814380639e-02   +1.237516935198955e-02   +1.557710478972757e-02   +6.493914057339826e-03   +2.501402556814786e-02   +4.408512450356193e-03   +1.657017262425348e-02   +4.611473923350411e-03; +3.990750002572943e-03   +2.386074568021026e-02   +2.295970511147756e-02   +1.000701690004703e-03   +1.514034720548037e-02   +3.845091511455127e-03   +1.108795256696856e-02   +1.695831442477207e-02; +2.354722421038458e-02   +1.126826593310757e-03   +2.510731583253672e-02   +1.350817495637588e-02   +2.225205775978537e-02   +7.253055440438143e-03   +2.551039532063357e-02   +7.290705984118928e-03; +2.553352081345406e-02   +1.208728548075135e-02   +4.881701624404132e-03   +2.488262051618943e-02   +1.813600416511180e-02   +6.711226607465730e-04   +9.101514516038706e-03   +1.974609653020319e-02; +1.943446507082133e-03   +1.605980078185995e-02   +1.351570314063286e-02   +1.517537209602644e-02   +2.363623682580150e-02   -1.184282658803143e-03   +2.365850253763519e-02   +9.863887765726994e-03];
L1I_L2I_iGABA_netcon = [+2.001178280559635e-02   +1.603037652785740e-02   +4.551281031663244e-03   +5.092114136317590e-03   +1.138433657786282e-02   +9.268269327093476e-03   +2.405417122055869e-02   +1.721443692053597e-02   +1.044060760891752e-02   +2.500248552507249e-02   +8.193980799377110e-04   +5.318338500919886e-03   +6.382610342135091e-03   +1.824962399626783e-03   +4.632823407140474e-03   +2.851001103117680e-02; +2.222483830997557e-02   +1.690939864795603e-02   +1.018686017536044e-02   +1.222903513746878e-02   +1.773378561325521e-02   +1.754307911458376e-02   +1.148851708558794e-02   +2.374693435576585e-02   +1.313000168884617e-02   +2.794224607224153e-02   +1.563506737569298e-02   +5.140035810662048e-03   +1.162628717726811e-02   +2.762480617865435e-03   +4.235284462312090e-03   +2.440869553551042e-02; +1.715226797385950e-02   +1.451492290475602e-02   -1.060061065653395e-03   +1.978894957215478e-02   +1.254906352239946e-02   +2.403802947174970e-02   +1.890324663547289e-02   +1.592725090949657e-02   +1.112881903804601e-02   +1.383750025514819e-02   +1.678584220126682e-02   +1.335911232480454e-02   +1.308653779499131e-02   +2.943293348269689e-03   +1.749077007560220e-02   +6.190922456494137e-03; +1.373237441985928e-02   -1.468683412978921e-03   +1.559012267989491e-02   +2.822328887180598e-02   +3.625212480706328e-03   +1.879240552510031e-03   +1.308382379976324e-02   +7.479519269053264e-03   +6.941424217896112e-03   +1.491252560627956e-02   +1.210335156381301e-02   +6.966530499560888e-03   +6.743450219106935e-03   +6.269639865918539e-04   +1.809172775003557e-02   +1.361794807796006e-02; +5.151576330047705e-03   +2.466309461322827e-02   +2.161694293250420e-02   +1.940341109278501e-02   +1.896468291130359e-02   +1.804718488621961e-02   +1.489832670029007e-02   +2.698879693873281e-02   +1.092669655596987e-02   +4.100229902975918e-03   +1.096781940454202e-02   -5.789967963999802e-05   +4.494902267519378e-03   +2.508768217489655e-02   +9.173972531498025e-03   +1.916324983228307e-02; +1.395174545314975e-02   +1.581367138755107e-02   +1.121944489483759e-03   +2.358647874108804e-02   +1.091676292654954e-02   +2.287756075213426e-02   +1.947010056170124e-02   +2.227496844696398e-02   +1.698199148951554e-02   +1.295402987399263e-02   +1.789374372632691e-02   +1.594269106715460e-02   +2.687084456355616e-03   +2.238203773286394e-02   +2.098330261325567e-02   +2.030682507731496e-02; +2.167572804398302e-02   +7.176521471743470e-03   +1.895372796413853e-02   +2.484340158616928e-02   +1.233298830637336e-02   +3.033200790382467e-02   +1.574232462180514e-02   +1.079457830859716e-02   -6.747954813103465e-03   +1.915294793154505e-02   +1.565724104247190e-02   +5.302501291431599e-03   +2.293739690151689e-02   +9.128059500616872e-03   +2.178510714932409e-02   +1.094564364177542e-02; +2.178986242400051e-02   -1.983392273830866e-03   +1.963069185805680e-02   +2.243967527661289e-02   +9.543031821628142e-04   +1.924640914086032e-02   +1.655899966552667e-02   +1.924391968542293e-02   +8.927175040064099e-03   +1.824689006815913e-02   +5.514770000561824e-03   +1.053594718682401e-02   +1.301577413659679e-02   -7.568712993599625e-04   +2.049137222785492e-02   +3.119074248014296e-03];
L2E_L1E_iAMPA_netcon = [+1.850222049403870e-02   +7.121873741037823e-03   +1.147369250518451e-03   +2.826294282876313e-02   -2.232965497443765e-03   +8.218245396664577e-03   +1.488814036014758e-02   +6.197363393917210e-03; +1.993366642526937e-02   +2.288482238106157e-02   +1.404149462425097e-02   +4.534968456017380e-03   +1.790524191652879e-02   +9.957759220158156e-03   +2.511126080327725e-02   +9.598717153517771e-03; -2.811758327807721e-03   +2.296082968237616e-03   +3.573245270615476e-04   +1.167437806763537e-02   +1.506471170768137e-02   +2.741134043632530e-02   +6.889350804643410e-03   +8.871502713698284e-03; +8.054817493707846e-03   +2.047912403882465e-02   +4.645789574885347e-03   +2.054348403725008e-02   +2.395714771150675e-02   +7.110035331402691e-03   +2.090019470759730e-02   +2.794338504150750e-02; +2.480844795928344e-03   +2.516962430109404e-02   +3.206189080713102e-03   -6.285350743482197e-03   +2.395583465924478e-02   +2.364764900209205e-02   +2.121002835738078e-02   +1.002390755364301e-02; +1.302484443731808e-02   +7.499852602156730e-03   +2.303737956348330e-02   +2.037690821992468e-02   +1.609983565299665e-02   +3.549456105054629e-03   +1.413981460140763e-02   +1.786176546850443e-02; +4.374870450486874e-03   +8.703183038583705e-03   +7.595199949863699e-03   +1.263652571917621e-02   +2.059816414473399e-02   +1.064133985903339e-02   +1.324235375441241e-03   +9.172756765597246e-03; +1.290513169790085e-03   -2.147145600569419e-03   +9.534157525045890e-03   +1.628479727725372e-02   +9.090280942848441e-03   +2.633106434273960e-02   +2.284443163829954e-02   +1.749415019974185e-02; +5.775036863346213e-03   +2.291086925207537e-02   +4.637337716521779e-03   +3.583033725864586e-03   +1.484857422159594e-03   +2.859941745412743e-02   +1.047451298138543e-02   +5.940385918295684e-03; +8.215378474417685e-03   +4.595501717443627e-03   +2.751617431006772e-02   +1.417934605738879e-02   +2.813964960569301e-02   +3.107156068242033e-03   +5.867033007822773e-03   +1.693228599689980e-02; +1.710076859197641e-02   +6.031329815884527e-03   -9.020948311510172e-04   +1.499688608789803e-02   +1.072600071309293e-02   +4.435105874663441e-03   +1.928495913004246e-02   +2.288592905026720e-02; +5.698337826478330e-03   +9.104264646387623e-03   +1.904342095434220e-02   +1.522055108503582e-02   +1.432258649488271e-02   +5.448004081662145e-03   +2.454560769438432e-02   +1.232272961847526e-03; +1.342112842962343e-02   +1.591205826559770e-02   -3.896572210965979e-05   +5.158488059968535e-03   +2.294109717249964e-02   +1.036144005601757e-02   +1.506252780788497e-02   +1.916952568162015e-02; +8.463205634425727e-03   +3.249293139043332e-03   +1.995058875106897e-03   +2.371698295698292e-02   +5.516977110307420e-03   +6.553456334502730e-03   +6.587925097529016e-03   +2.316632452163245e-02; +8.896830470927873e-03   +7.823936942243530e-03   +2.514590629424262e-03   +2.470273533688002e-02   +2.315293103989541e-03   +3.467700057570797e-03   +1.521035916378872e-02   +3.104848104354564e-04; +7.247482392031723e-03   +1.266010835757682e-02   +1.577691558959444e-04   +1.287453871209061e-02   -9.715481646785342e-04   +1.597830339635539e-02   +4.611168436542871e-03   +2.251838742378401e-02];
L1E_L2E_iAMPA_netcon = [-2.365323873828170e-03   +4.162976948993396e-03   +2.250350225458266e-02   +2.171721314966239e-02   +1.229903011630771e-02   +2.139632059588646e-02   +1.256083072927523e-02   +2.386030780537753e-02   +5.719160135628922e-03   +9.583600987824698e-03   +1.344948592328563e-02   +1.294395907539400e-02   +1.092773268372094e-02   +1.862903969785164e-02   +1.948006773481949e-02   +1.897404092629378e-02; +5.887274516917440e-03   +2.145523419133867e-02   -2.674127643000134e-03   +7.562843944863482e-03   +3.757063695877366e-03   +1.540937593489609e-02   -2.258918382325738e-03   +3.540332261878172e-03   +3.939588666167502e-03   +7.688305832616108e-03   +1.154963238069750e-02   +2.144425550329837e-02   +1.574591114091065e-04   +5.318385180688414e-03   +1.279242680532011e-02   +7.833977622020354e-03; +6.892221261133816e-03   +1.599796399742841e-02   +2.325016022638507e-02   +2.132181218163411e-02   +2.756876847410055e-02   +6.182073701818654e-03   +1.162757995495638e-02   -4.050528522009341e-03   +7.649812207116780e-03   +1.606251848229717e-02   +7.983962053766789e-03   +5.848392178200522e-03   +1.487780366862242e-02   +1.085299833289484e-02   +2.430410874475389e-02   -3.937531339838990e-03; +1.292026206055768e-02   -3.238556345824420e-03   +2.951633939830866e-03   +1.387898169162960e-03   +1.833517854934741e-02   +1.090951319282724e-02   +2.346672062365885e-02   +2.668888324336273e-02   +1.938296716466449e-02   +2.173994565021275e-02   +5.833160750210755e-03   +1.347675667576278e-02   +2.834215005318461e-02   +7.145791883288040e-03   +2.258732086691420e-02   +2.377395915207905e-02; +4.082208309298748e-03   +2.846399746672709e-02   +1.633618216680917e-02   -3.792657048652117e-03   +5.067540964259522e-03   +1.504353883732916e-02   +1.667644925662742e-02   +4.775643178481501e-04   +1.861860777936149e-02   +9.637083046692271e-03   +1.045613240346292e-02   +2.161558439624422e-02   +6.183915869984300e-03   +1.322130512250008e-02   +2.607014721306425e-02   +3.789792772476675e-03; -6.167546571498345e-04   +2.379252482202526e-02   +4.184241637428747e-03   +2.615578716087728e-02   +2.093319413068209e-02   +2.017406615344930e-02   +8.722792088123087e-03   +1.827023729123969e-02   +1.576829392883133e-02   +1.034184093697797e-02   +2.006457241362135e-02   +2.572247686138094e-02   +2.201619186717501e-02   +1.565045534125974e-02   +2.163853746508235e-03   +1.836750038429181e-02; +8.349732963712143e-03   +3.560460396111790e-03   +2.060933349601064e-02   +3.381827521677330e-03   +9.920432531247959e-03   +1.555821662485659e-02   +1.163385886549338e-02   +1.723827531336163e-02   +1.497476668170615e-02   +1.903963185283284e-02   +1.423611322196383e-02   -2.714912704086146e-03   +1.159224503538271e-02   +1.476227606021480e-02   +5.691328848657906e-03   +8.053657640960292e-03; +9.087098163822627e-06   +9.302660083706648e-03   +1.037799691507758e-02   +1.023705661648611e-02   +1.439540438598532e-02   +2.319936695512096e-02   +1.774593325307285e-02   +1.338181189591168e-02   +2.102229133512340e-02   +1.062499803646071e-02   +9.272078139150352e-03   +2.466050564860749e-02   +1.768984216639040e-02   +1.972004415293350e-02   +7.369051098118325e-03   +9.951266093079668e-04];
L2I_L2E_iAMPA_netcon = [+1.167122735771353e-02   +1.018418262182339e-02   +1.860241746543151e-02   +1.538960321445250e-02   +2.302190768940531e-02   +6.539802473028197e-03   +2.413557939238567e-04   +1.830768509196138e-02; +2.696587990179490e-03   +1.312788374284227e-03   +8.231751335342782e-03   +2.180108930123935e-02   +2.207459289175443e-02   +9.813123428079568e-03   +1.826098732473294e-02   +1.381456418406843e-02; +1.953117063517951e-02   +2.035612505576967e-02   +1.759731282388146e-02   +1.861240332071489e-02   +1.809001708819932e-02   +9.949621849130412e-03   +1.333328035983864e-02   +1.842680295080048e-02; +7.980663403884097e-03   +5.650929718557065e-03   +2.636045067424290e-02   +1.138767654383502e-02   +2.564525828507209e-02   +2.296747256374385e-03   +2.845095974281708e-03   +2.420313531336754e-02; +1.236888177358877e-02   +2.068503181407676e-02   +5.111483851219826e-03   +1.332931236697220e-02   +2.062005320217005e-02   +1.414851944232749e-02   +1.013187595451481e-02   +1.801397717574850e-02; +2.112482762839660e-02   +7.136831141370881e-04   +2.116106915834501e-02   +2.000596147936225e-02   +1.450143230176549e-02   +4.907791350725547e-03   +2.904498618532493e-03   +1.902103408654699e-02; +2.563675023694929e-02   +6.749791167193920e-03   -4.792215809777184e-03   +2.176992994234792e-03   +3.206786580544136e-03   +9.008036020135406e-03   +4.145425924020706e-03   +8.921801114009109e-03; +1.913505569549163e-02   +3.446997280299281e-03   +8.589149077115653e-03   +1.358899426232908e-02   +1.706596324955610e-02   +8.228099866816503e-03   +5.704935483988355e-03   +2.269764315186681e-03];
L2E_L2I_iGABA_netcon = [+2.366857776109866e-02   +5.922891927103199e-03   +3.634275468490525e-03   +7.764516992503132e-03   +2.545130165105672e-02   +9.722780845975514e-03   +1.604611716272029e-02   +2.500798858207814e-02; +6.283423622612765e-03   +1.569091073240728e-02   +7.173652097954455e-03   +2.251931102408232e-03   +2.600966057642405e-02   +1.722774861334862e-02   +1.786971006064783e-02   -5.431467105621876e-03; +1.292092565194724e-02   +7.502500430153029e-03   +9.334833352905214e-03   +5.015981035274608e-03   +6.186418443976604e-03   -6.258205548866861e-03   +2.690586038521307e-02   +1.913450752098877e-02; +1.884273321629751e-02   -5.668396487159700e-04   -5.380639015928885e-04   +1.669301845558203e-02   +1.938896072484334e-02   +2.274571302001844e-02   +1.077843362644017e-02   +9.446424420168690e-03; +3.591850811465150e-03   +1.389749321129890e-02   +6.720956365694994e-03   +1.876184335522383e-02   +1.278512230822097e-02   +9.834544839708578e-03   +3.930809659198859e-03   +2.215980109216937e-03; +1.589949889476206e-02   -3.293677646995815e-03   +1.555567217200821e-02   +2.248025105883023e-02   +1.957360819017863e-02   +1.229390680925228e-02   +2.751376739951610e-02   +2.160875194040629e-02; +2.694650935517723e-03   +2.945182135475052e-02   +6.675657835355554e-03   -4.213755371948155e-03   +2.094551936668155e-02   +6.073795130623288e-03   +1.140615678461768e-02   +1.260517477873203e-02; +2.121819442135070e-02   +8.412472313773733e-03   +1.251470112967682e-02   +7.472644862245354e-03   +1.029857668782661e-02   +1.943342815728260e-02   +2.094270899649527e-02   +2.128905037829855e-02];
L3E_L2E_iAMPA_netcon = [+9.648245201377940e-03   +1.792777904274535e-02   +4.008423801717992e-03   -1.909811316227408e-03   -4.097059866299551e-03   +2.538664652980381e-02   +1.119339980921370e-02   +2.332274189849923e-02   +2.599855919096819e-03   +7.392146353378041e-03   +9.806520181442456e-03   +3.007175028357692e-03; +1.038534185430121e-02   +2.354957236268914e-02   +8.298463384990766e-03   +1.325948099215146e-02   +1.645629988828054e-02   +1.207851078814313e-02   +2.351935387203436e-02   +2.515626487880112e-02   +1.753928996880785e-02   +2.184819433310010e-02   +1.481614764880043e-02   +7.705552204713624e-03; -6.256521814922702e-04   +1.962856348309137e-02   +4.677389156130948e-04   +2.183129280591912e-02   -2.318232117539693e-03   -3.451397478165690e-03   +1.167066101649057e-02   +2.607685912001815e-02   +1.407902712973820e-02   +8.124211058997199e-03   +6.693116216740017e-03   +1.221849077255355e-02; +2.926700083935196e-03   +9.893013142692114e-03   +2.017454658640710e-02   +1.353180769983328e-02   +5.392603118807737e-03   +1.918987353466198e-03   +7.181750176111192e-03   +3.254568105297327e-03   +3.021845463568863e-03   +1.242630486697823e-02   +8.418364047191403e-03   +1.184038201852677e-02; +2.278435473495908e-02   +4.431468682572887e-03   +1.112172971863938e-02   +2.528466637882165e-02   +1.639449252443026e-02   +8.412259788661954e-03   +1.874973167079803e-02   +4.863787554262562e-03   +1.754810018236084e-02   +1.769377830564057e-02   +1.944533078852818e-02   +9.658079959062021e-03; +1.840184483253412e-02   +1.354176280861491e-02   +4.910208172821470e-03   +5.193085581237210e-03   +9.215830436280869e-03   +2.750790956128891e-02   +3.109324960362687e-02   +7.447014100384454e-03   +1.294525650535287e-02   +1.913029777003565e-03   +2.027309968856381e-02   +1.027063452187536e-03; +1.739079825924846e-02   +1.092784658392961e-02   +1.410833347447627e-02   +1.040666078917718e-02   -3.228266296007737e-03   +1.281653193233716e-02   +1.984155358483203e-03   +1.370780768079643e-02   +8.390536069016774e-03   +1.209416471696049e-04   +8.612150420758551e-04   +6.981824492776083e-03; +2.278934564843071e-02   +3.964273834015525e-03   -2.953718664213557e-03   +1.088503700482493e-02   +6.220178834214961e-03   +3.644787442944222e-03   +2.987781645170358e-03   +8.793350456261166e-03   +7.394688887399307e-03   +2.640101095507788e-02   +8.474215271256601e-04   +1.483857687724867e-02];
L3I_L2I_iGABA_netcon = [+2.617201398507863e-02   +1.712598794495545e-02   +1.383388889783766e-02   +1.468246612738797e-02   +2.190411562121504e-02   +1.333280295245265e-02   +3.082953254449041e-03   -3.936550205133316e-03   +2.868439325536008e-02   +1.152430333333857e-02   +1.624950511382147e-03   +2.159377684874936e-02; +2.328178057924348e-02   +2.938713241565444e-02   +2.265207889424290e-02   +7.597473427418977e-03   +7.588092354400515e-03   +1.473498051886640e-02   -6.547900005600195e-04   +2.982075855782693e-03   +1.555587777604810e-02   +1.547204879194962e-02   -2.383902794352493e-03   +1.615358069098903e-02; -2.753286228668991e-03   +1.447815993618394e-02   +2.085239208342993e-02   +1.872531497464808e-03   +2.267144112898089e-02   -1.874977254757465e-04   +1.531360617664675e-02   +2.302585187141252e-02   +1.851787890912084e-02   +1.490872286882131e-03   +1.479267666933773e-02   -1.371099884629290e-03; +2.257741782367558e-02   +1.987686822048483e-03   -1.414312507084750e-03   +1.572167738891036e-02   +2.511041547772140e-02   +1.625306784906013e-02   +7.781222555940105e-04   +7.086817433884210e-03   +2.416085353004986e-02   +1.340133824992114e-02   +1.937623176016057e-02   +1.899193263333619e-02; +5.158174916933916e-03   +3.208753050353072e-02   +3.870626106774689e-03   +8.660532798317917e-03   +1.597643311317694e-02   +2.265347300254251e-02   +4.145692885423083e-03   -2.946593447657750e-03   +2.200346445572663e-02   +1.694936543073284e-02   -9.678145949774304e-04   +8.771427754179655e-03; -5.376614467638382e-04   +2.223371483522728e-02   +1.052408976961533e-02   +2.653832019242574e-03   -6.151793180796599e-04   +1.532714598042213e-02   +2.192521422183693e-02   +7.341389957798975e-04   +6.503084248963205e-04   +1.509780479726649e-02   +1.591653286611586e-02   +5.187323448425844e-03; +1.716529728702132e-02   +1.741106912583711e-02   +1.715057816362490e-02   +2.105928402239958e-02   +1.043655483444483e-02   +5.888987198896468e-03   +1.191253197294287e-02   +5.601654271933120e-03   +1.616280894085156e-02   +8.439743553576816e-03   +1.176390209047256e-02   +1.455546701454295e-02; +1.067243047594576e-02   -5.515613993506852e-04   +1.089025490499353e-02   +1.505456405614955e-02   +1.140896593214655e-02   +3.335427633154831e-03   -2.775408424866761e-04   +3.360800592573536e-03   +1.494137247591178e-02   +1.609644275070756e-02   +6.678039290887824e-03   +1.118222510978077e-02];
L2E_L3E_iAMPA_netcon = [+2.072714031270629e-02   +1.005023945242617e-02   +1.245409071468033e-02   +2.162904098326475e-02   -1.194858328713104e-03   +1.731970145981679e-02   +2.105977949136864e-02   +2.880350171736534e-02; +1.872350821602259e-02   +1.806777101721890e-02   +1.999294373548758e-02   +1.243004944888341e-02   +2.144688019095858e-03   +1.634582716164250e-02   +2.522414058336977e-02   +1.567896638934754e-02; +2.043729444658686e-02   +2.138860164401635e-02   +3.008423816945964e-02   +2.375620486483205e-02   +2.121221091524560e-02   +1.968797403630245e-02   +1.590669981352110e-02   +2.182108222493159e-02; +1.392529628885722e-02   +2.001474231957658e-02   +1.793385583822686e-02   +9.140778556612621e-03   +1.222735896950784e-02   +1.498617433774287e-02   +5.555692943260341e-03   +6.166389566526131e-03; +2.159080553105327e-03   +1.178205525763670e-02   +4.403827399574681e-03   +1.919654442368349e-03   +3.596983028313544e-03   +1.188694729321661e-02   +2.028315024419653e-02   +2.072908601587220e-02; +1.587252424891271e-02   +2.487807126130673e-02   +2.056043498258171e-02   +1.299092641980375e-02   +1.657911840173404e-02   +2.877393874839908e-02   +1.523149674377625e-02   +1.874009284359261e-02; +9.995382821331172e-03   -1.131796495301302e-03   +1.129602806087586e-02   +2.281405178575937e-03   +6.680438658211253e-03   +2.462452293177594e-02   +3.333618097924049e-04   +1.811277467865282e-02; +2.465723159888752e-02   +1.785331003662326e-02   +1.769959326926960e-02   +2.481914184025074e-02   +8.325758246997675e-03   +1.886005142644681e-02   +1.652214728893898e-02   +1.354080773751474e-02; +8.459181499444621e-03   +1.476993435519808e-02   +2.703818087972570e-02   +1.457925943570908e-02   +1.269909316113075e-02   +6.977665095660191e-03   +2.171227412425508e-02   +1.881980488610659e-02; +3.385276803797012e-03   +8.192024034534425e-03   +1.747181817933455e-02   +2.235277075322977e-02   +2.382142381852779e-02   +1.725583468684569e-04   -1.944772395297566e-03   +1.866774914270069e-02; +1.641486939716308e-02   +9.549704309625427e-03   +1.716257156483313e-02   +1.966944922789967e-02   +2.878263661179022e-02   +2.743314864122212e-02   +2.671961659924918e-03   +3.474426334372561e-03; -2.690897745142250e-03   +1.746109013199130e-02   +6.768655292941359e-03   +1.926275862800390e-02   +1.417132624684440e-02   +3.777837691143427e-03   +1.945411534166463e-02   +2.425435272441073e-02];
L2I_L3I_iGABA_netcon = [+2.466231170954653e-02   +1.188581372747959e-02   +5.820391161903466e-03   +1.258917636676613e-02   +1.878460412007214e-02   +2.667467645499650e-02   -3.824769484778480e-03   +1.210749302872510e-02; +1.186645548164637e-02   +1.013773254534258e-02   +2.132642354189446e-02   +3.141001029324185e-03   +2.200458167841995e-02   +1.739383170835332e-02   +1.668759841628016e-02   +1.004967784061809e-02; +1.820883886410378e-02   +1.938797810357705e-02   +1.875675380940714e-02   +1.452903905421230e-02   +1.061497051084691e-02   +1.242235528835186e-02   +9.572866133536782e-03   -1.232385489126485e-04; +4.217794521789233e-03   +2.488938725849517e-02   -1.395363914958776e-03   +8.431533849906558e-03   +6.748095645144664e-04   +9.397312929183506e-03   +1.227670808847249e-02   +2.161955716787993e-02; +9.296497859074066e-03   +1.286496563725463e-02   +1.639314044523029e-02   +9.978492490264904e-03   +1.005420784887589e-02   +1.367188486702807e-02   +7.525035016736998e-04   +6.504443487154964e-03; -2.875190055967602e-05   -2.866809734416817e-04   +1.108072865457575e-02   +5.721020590810606e-03   +1.120213957792454e-02   +1.193385876367822e-02   +1.010900596976056e-02   +2.057245159624338e-02; +7.551112151345111e-03   +9.249458164901808e-03   +2.251450801492685e-02   +1.670574729632496e-02   +1.710408635513910e-02   +1.005363378519710e-02   +1.044570025107190e-02   +1.283104707714451e-02; -4.122314036908926e-03   +2.944758256440597e-02   +2.921542110349895e-03   +1.757623726367880e-02   +6.692492354010019e-03   +2.214341859842320e-02   +1.667778913875809e-02   +1.128262064473065e-02; +1.822181839149261e-02   +1.351112716921563e-02   +1.855997330765478e-02   +4.247461180515479e-03   +1.171822210818295e-02   +1.502953376689700e-03   +7.321015908555443e-03   +1.461140427272274e-02; +1.763539382293578e-02   +1.495177301900492e-02   +2.310771922121900e-03   +7.931309265388563e-03   +1.010253377971080e-02   +2.474589414660438e-03   +8.274684635331325e-03   +1.102885562112282e-02; +1.789994203347956e-02   +2.796913328862314e-02   +1.224836820871708e-02   +1.994154806721793e-02   +9.138684241586483e-03   +9.324578889409461e-03   +2.019244793352996e-02   +2.833802503972474e-03; +1.507292792101258e-02   -7.065934746607376e-03   +4.089031332012279e-03   +6.892804099541411e-03   +5.554899604915574e-03   +2.196286812971538e-02   +1.389229269141438e-02   +1.530529480351033e-02];
L3I_L3E_iAMPA_netcon = [+1.188207587891705e-02   +2.233025461634693e-02   +8.355096737338287e-03   +1.545674211792755e-02   +2.034873710975024e-02   +1.500036680873485e-02   +6.181053646717788e-03   -2.301079145220044e-03   +1.563065282658476e-02   +9.990331109878603e-03   +8.854738286668291e-03   +3.721063298282205e-03; +8.194744684317735e-03   +1.779070351219790e-02   +7.279517872595309e-03   +4.357809659594945e-03   -3.136724508460293e-03   +1.397807515682363e-02   +1.692875245464993e-02   +9.302059873222293e-03   +6.777313283848558e-03   +1.297569013991583e-02   +2.078346742446772e-02   +1.467387402903972e-02; +8.088930575861598e-04   +1.538039411678860e-02   +1.128734136958985e-02   +1.920240116885606e-02   +1.558420863943172e-02   +1.340989978416423e-02   +1.066360716979333e-02   +6.283688907481243e-03   +1.588263205501825e-02   +1.626721658675448e-02   +9.162634861816409e-03   +1.603481866582171e-02; +1.071286767082430e-02   +2.027419333190965e-02   +1.656182280051153e-02   +1.143201047842346e-02   +1.914971473510210e-02   +2.214196755173169e-02   +1.912232104642727e-02   +5.882439838644600e-03   +2.387777904090806e-02   +2.588415820047523e-02   +1.179447129518451e-02   +1.727638851287672e-02; +6.835274193235137e-03   +6.712330014873012e-03   +6.575489183676462e-03   +1.767757519645008e-02   +1.924093160361422e-02   +1.081064719079186e-02   +2.421467963219253e-02   -1.844921699284819e-03   +2.014145423386345e-02   +7.987226106146612e-03   +1.088214600491772e-02   +4.267615476887632e-03; +4.474052658639198e-03   +1.374227415511656e-02   +2.351365186850390e-02   +1.489073938123052e-02   +2.380747733777735e-02   +3.819134536225179e-03   +1.823190709136169e-02   +5.486017803568813e-03   +1.613650834095457e-02   +2.500088458544762e-03   +4.389600850846753e-03   +4.720755797397823e-03; +2.460588821018235e-02   +1.350539559693344e-02   +1.030611868127820e-02   +7.994168118633833e-03   +9.865240058526695e-03   +6.932657630968836e-03   +1.395766189405758e-02   +2.439836956273014e-02   +2.131011437055214e-02   +2.684939628929676e-02   +6.536734400766496e-03   +1.845283384072170e-02; +1.750619049096418e-02   +4.962858986885399e-03   +1.807555817042697e-02   +1.583418401740198e-02   +2.693446953477721e-02   +1.254618637187439e-02   -1.104139952999234e-03   +1.768212706672925e-02   +1.198942603087200e-02   +4.990032243293904e-03   +7.337515768777680e-03   +2.798621354198213e-02; +2.605309453853062e-03   +1.815698601861629e-02   +1.690166572538337e-02   +1.685289147007564e-02   +9.942687908147931e-03   +2.066399232391335e-02   +5.184039769675164e-03   +2.354612471123177e-02   +1.753862425969392e-02   +1.056318462700487e-02   +5.365210334478818e-03   +4.026751315396034e-03; +1.887771950856729e-02   +2.142830238011078e-02   +1.465506361384546e-02   +4.328886191837245e-03   +1.115381064056447e-02   +2.136545078650654e-02   +1.293121725314514e-02   +2.679628759147208e-02   +2.211738714950135e-02   +4.777795448494567e-03   +1.900673080782628e-02   +8.469316520885532e-03; +1.443810320876451e-02   +1.319437094323479e-02   +2.548786806293541e-02   +2.632305214790763e-02   +1.708816346252988e-04   +1.626595523092053e-02   -2.546183322239138e-04   +5.049876374439464e-03   -6.927069707796454e-04   +2.353831123051283e-02   +1.446682617919316e-02   +8.727756890527402e-03; -4.631618707219255e-03   +5.029087262378759e-03   +3.210652619934119e-03   +2.026061728664086e-02   +1.095682888136783e-02   +9.396701252199709e-03   +2.010087647952637e-02   -1.980307334800401e-03   +6.564385033836722e-03   +2.180727198812990e-03   +2.041820619606448e-02   +1.251328136085968e-02];
L3E_L3I_iGABA_netcon = [-5.288167404911380e-03   +1.263673454578609e-02   +7.750186752868104e-03   +2.561945989081692e-02   +1.744362569249106e-02   +1.429643543936651e-02   +1.490228209794324e-02   +1.662684195265072e-02   +1.284620367565631e-02   +1.626927723672951e-02   +1.394155083117857e-02   +2.519629251092008e-03; +1.673419184182643e-02   +1.715471307138037e-02   +6.228943887459372e-03   +5.505474919187346e-03   +7.821756498545508e-03   +1.904164699671825e-02   +1.959782150831637e-02   +3.044092011294983e-02   +2.193504658195065e-02   +1.074927933484834e-02   +4.286755696866994e-03   -4.888968829858757e-03; +1.009128580405769e-02   +2.590807562197767e-02   +1.706206549018785e-02   +1.859546542376829e-02   -1.515948601818099e-03   +2.091091503769537e-02   +1.770925115602739e-02   +2.187368932198925e-02   +7.413185434863903e-03   +1.038029124986218e-02   +9.183551723969450e-03   +1.755785336345288e-03; +9.680763544252294e-03   -2.168479064323847e-03   -1.057147188235618e-03   +2.344812235192848e-02   +1.848007951546591e-02   +4.240262455726999e-03   +3.286700095199130e-03   +1.137223097000521e-02   +2.397089118098806e-02   +3.710718687459966e-03   +2.202958510361227e-04   +1.465784782501990e-02; +6.943603073424604e-03   +8.881645407691532e-03   +2.876077310264483e-02   +2.755608674852316e-03   +6.008371713648277e-03   +1.567710574303599e-02   +2.924178386712291e-02   +2.311337184429050e-02   +5.973908066361570e-03   +1.809933303187435e-02   +2.789940390049422e-02   +2.074514987387443e-03; +1.968670645425491e-02   +7.832770963790049e-03   +1.563554856515324e-02   +7.451752384017960e-03   +2.811447107470318e-03   +2.982465828711900e-02   +3.121026954794369e-03   -4.060342807596357e-03   +1.875103918216956e-02   +1.813505256343003e-02   +5.510180588509768e-03   +2.989185258875194e-03; +1.023057447246904e-02   +1.269505968108465e-02   +1.214532127837533e-02   +1.692530965240896e-02   +1.381809607519830e-02   +9.935640675323635e-03   +4.671386229523996e-03   +3.288864262700507e-03   +1.257893717859997e-02   +3.209066993550359e-03   +1.033169755545555e-03   +1.428328348981981e-02; +3.632454025640019e-03   -1.396214219427578e-03   +5.536967981110502e-03   +2.520381344782677e-02   +8.455086099906249e-03   +1.770718453483039e-02   +1.233089902070613e-02   +2.006590089322864e-02   +2.302477629879802e-02   +1.866176157212124e-02   +6.641137783625991e-03   +1.844777187170343e-02; +8.993214740429618e-03   +3.552635481211207e-04   +2.265360831609300e-02   +3.516406566611416e-03   +2.573047475573032e-02   +2.096115274369723e-02   +1.030210971735721e-02   +2.298929043761005e-02   +3.193669334998695e-03   +3.908922848852530e-03   +7.822263581958094e-03   +1.357148538526512e-02; +2.041003415201189e-02   +1.052480359075128e-02   +2.483515096544883e-02   +1.541393462567034e-03   +6.464478822779032e-07   +3.001487765534475e-02   +1.764430126277613e-02   +9.840533784159881e-03   +2.650824931055789e-02   +2.325155307100090e-02   +7.133742684893909e-03   -2.195784236232428e-03; +1.000850212293386e-02   +2.672286474190782e-03   +7.555280442084932e-03   +4.578855693769528e-03   +1.376607439753140e-02   +1.386927788428912e-02   +2.664502183891423e-02   +2.051377537901324e-02   +1.584791417333337e-02   +7.888745947508130e-03   -5.052009519486029e-03   +2.178398076433743e-02; +1.253146380321325e-02   +1.074497469964767e-02   +2.189380236632222e-02   +1.733573453598475e-02   +4.262548649430068e-03   +6.592727677694213e-03   +2.355229316527431e-02   -3.575128654320518e-03   +2.207002871669794e-02   +1.363798401773496e-02   +9.927411019699286e-03   +1.381285129109166e-02];
L2E_Input1_iAMPA_netcon = [+2.490326689916724e-02   +2.813955538896141e-02   +1.834148722805184e-02   +2.444431250217273e-02   +2.480621561541053e-02   +3.032456296193932e-02   +2.416994003927071e-02   +1.901788209987311e-02];
L2I_Input2_iAMPA_netcon = [+2.142058161382342e-02   +2.178648923510139e-02   +3.163304859294952e-02   +1.972758496648151e-02   +1.999963058574362e-02   +3.055819768866096e-02   +2.340403175144476e-02   +2.371110290164406e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
