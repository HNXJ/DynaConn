function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.599115737928232e-01   -2.342344763948413e-01   +6.807510032480371e-01   +5.974241332394823e-01   +4.542164176711855e-01   +6.806277834274027e-01   -4.151936996859274e-01   +1.000000000000000e+00   -1.148713999424357e-01   +1.131284207517112e-01   -9.195135123849660e-03   +1.639339082493008e-02   +3.223698303895108e-01   -4.655667386621875e-01   +3.428668816895081e-01   +6.144380413087671e-01; +2.296509385637018e-01   +5.172603477582408e-01   +6.829046350821386e-01   +6.085125744606178e-01   +2.355936177951811e-01   +4.040106102441451e-01   +3.968450481086450e-01   -3.573542211467214e-01   +6.798288987085201e-01   -5.274677169935397e-02   -2.076613791902362e-01   +5.078393760765728e-01   -1.956192359359986e-01   -3.916600609025787e-02   +9.632705699636800e-02   +8.138403912211642e-01; -1.220341739467134e-01   +4.829407475955154e-01   +3.758278890574824e-01   +3.972389731880293e-01   +3.037888509364354e-01   +5.768233443672006e-01   -1.390284090363193e-01   +1.081401455082051e-01   +3.120428165779389e-01   +2.442440654817000e-01   +6.564469115722681e-01   +6.278464273240371e-01   +2.748277793538544e-01   -1.945360675777945e-01   +2.414617503172296e-01   +2.389312890922820e-01; -4.162404049057341e-01   +1.572842791452114e-01   -5.486251860940110e-02   +5.328520847195245e-01   +1.182889958388953e-01   +3.682466930471662e-01   -3.236944373869849e-01   +9.576598823364727e-01   -5.570158747838063e-02   +4.851911342798429e-01   +8.531536474858249e-01   +7.819897138185232e-01   -1.858206045344915e-01   -5.126550172465969e-01   +9.393339028133763e-01   +5.080455006222414e-01; -3.956406022730802e-02   +2.920967527722639e-01   -3.226134243097927e-01   +8.260901404550873e-02   +3.577234393085713e-01   +3.436478719378140e-01   -3.269183383777604e-01   -3.984522000317697e-01   -3.417551174698488e-01   +5.344566336877932e-01   -1.461855683170181e-01   +1.886689324901726e-01   -4.072718963383155e-01   +2.863940485463484e-01   +9.207205447600084e-02   +6.825537114632007e-01; +5.316959586767809e-01   -4.794722108395773e-02   +4.569162000553446e-01   +2.345760385452556e-01   +7.707197605405348e-01   +6.470671287191626e-01   -3.393811701802992e-01   -4.532865328637244e-01   -3.562590993465550e-01   +2.665466921772222e-02   +6.086862236489775e-01   -4.587094155884530e-01   +3.408716161645189e-01   +3.599683555931046e-02   +7.170444481250536e-01   -3.782729339395475e-01; +5.150003547053839e-01   +1.805473200391645e-02   +2.228014220501612e-01   -8.979081396750960e-03   -1.193792939976150e-01   +5.609727528401613e-01   +7.277875795350698e-01   +2.449787861741768e-01   +6.008687563395809e-01   -3.656867128445309e-01   +1.506370974218786e-01   +6.169096197544277e-02   +4.656966396449083e-01   -2.448949710992462e-01   -3.888587099963230e-01   +4.575873086213934e-01; -9.206190460405640e-02   +2.996435835012845e-01   -1.639152609103131e-01   +2.860238752362927e-02   +2.341118513469181e-01   +2.100496199304378e-01   +3.265864215591978e-01   +6.974073226259360e-02   +6.484671121673685e-01   +8.498107715902075e-01   +9.001291116019178e-02   +6.396671763033913e-01   +6.161912092687911e-01   +7.272164606280622e-01   +5.819842960463396e-01   +8.211791383172973e-01; +4.523095456787978e-01   -2.144333248228956e-01   +4.825651324854489e-01   +7.259341617970266e-02   +6.104313677417700e-01   +4.027907724906260e-01   -2.504819888160870e-01   -1.011182230619488e-01   +2.557163808838189e-03   +3.170049010619023e-01   +7.103302757851722e-01   +5.027681249391319e-02   +1.304803829326487e-01   +2.524106448088921e-02   +1.126180060568651e-02   +9.682307594166796e-01; +3.340635118538007e-01   -3.897225594058050e-02   -1.523800733431668e-01   -1.582514627472602e-02   +4.240468118262189e-01   +7.306534424315699e-01   -4.094213984117736e-01   +1.509270088751210e-01   +4.897631036822265e-01   +3.478539984452721e-01   -2.363946003658300e-01   +3.707009633499800e-01   +1.017734941281585e-01   +1.611856537059934e-01   +3.355952122980108e-01   +2.560996678048291e-01; -6.816125487228861e-02   -2.279487446520298e-01   +2.187911568348147e-01   +4.440626664699600e-01   +5.291669722590212e-03   +7.515218137379112e-02   +7.823312164359548e-01   -1.475463031470752e-01   -1.128469705038948e-01   -2.087533716613208e-02   +7.647153613531292e-01   -1.187383555372874e-01   +2.663876062853014e-01   +3.409232129560072e-01   -2.717117099160090e-01   +4.502223905012216e-02; +5.298381145050289e-01   -2.288218631788243e-01   +7.815383649244519e-02   +3.710183462915903e-01   +4.639048990754260e-01   +1.062435890250870e-01   +7.307374886291448e-01   +6.530512438872033e-01   -2.906466052768466e-01   +5.682833639767209e-01   +4.805120130008137e-01   -1.247308368810299e-01   +4.796582845209443e-01   +8.235365206112397e-01   +2.592823346076625e-01   -1.754808175165281e-01; +4.344177022342308e-01   +3.871375545888659e-01   +8.439742596321333e-02   +1.401287472117957e-01   -8.464803866128418e-02   +3.709002116582625e-01   +5.769531943094032e-01   -1.310613293061366e-01   -4.069162642041578e-01   -2.043603910178289e-02   -1.929257665264264e-01   +7.069699086345502e-01   +3.414486510652512e-01   +2.361462227429011e-02   +5.641111701222634e-01   +4.113515646002582e-01; -2.999277247487729e-01   -1.794483762288925e-01   -3.594606592891078e-01   +1.176850596401900e-01   +4.772503165349111e-01   +4.790904227527641e-01   +4.392945083177802e-01   +4.389483337315134e-01   +3.831536896298635e-01   +8.751412572548566e-01   +5.910214558827954e-01   +4.465014538331072e-01   -1.639102354873905e-01   -3.051398322746780e-02   +6.473436586199881e-01   -3.507662413021549e-01; +5.796229038377597e-01   -6.537235139241171e-02   +4.611725879436794e-01   +7.212499891667508e-01   -1.176143511720184e-01   -1.506176611020493e-01   +1.786140155242211e-01   +1.545284045362356e-01   +5.059354082341926e-01   +5.152281383704767e-01   +4.401238301343987e-01   +2.487968758060433e-01   -1.216444629242842e-01   +9.386401012718322e-01   +8.597726753224247e-01   +2.735465605203940e-01; +7.363945517282497e-01   +1.410279571091206e-01   -2.312071854261433e-01   +7.397288841596120e-01   -3.991502092600074e-01   -1.178714738232098e-01   -1.340902390365699e-01   +6.605062146833229e-01   +5.436565959916878e-01   +4.856120225688630e-01   +2.692060655573057e-01   -1.102693094523432e-01   -3.644058223305008e-01   +3.322675628519243e-01   +7.338434615512464e-01   +3.998388550156771e-01];
L1E_L1I_iGABA_netcon = [+5.607403229920329e-01   +5.711906767776954e-01   +6.476072772481336e-01   +8.762583535427977e-01   +2.260789758581437e-01   +5.528453825548666e-01   +9.657359170220243e-01   +4.615734905033150e-01   +6.556538678744805e-02   +1.947268286357234e-01   +6.252992270206278e-01   +8.241860367565059e-01   +8.631927320544158e-01   +9.350064240750826e-01   +6.098382581484560e-01   +6.938234297830889e-01; -2.911121743948329e-01   -3.738671358248601e-01   +5.848476055749990e-01   -3.698050973571937e-01   +8.884162241378710e-01   +6.507372281965819e-02   +8.827915513444639e-01   +2.043861770132555e-01   +1.564492982263125e-01   +5.254564358714628e-01   +4.742998347011404e-01   -1.981398118101577e-01   +3.243988341917782e-01   -3.918237192517995e-01   +6.053732778643247e-01   +6.975921730044438e-02; +4.925339622971761e-01   +7.412382593779192e-01   +6.216122302326689e-01   +3.782235787849401e-01   +3.447385971092018e-01   +2.441784770272542e-01   -1.762456323366917e-01   +5.927562953106414e-01   +6.940803584504447e-01   +4.448672639440499e-01   -2.700820489877720e-01   +5.131814179371219e-01   -3.761389711955537e-01   +7.030881320858552e-01   -2.904497388196910e-01   +8.726371922592092e-01; +3.369425165540495e-01   +1.338934140485362e-02   +3.523658507100673e-01   -5.058762787749800e-01   +9.397566309429595e-02   -1.388823605029628e-01   -3.225765142101963e-01   -1.997294671477959e-01   +5.501470988334546e-01   +8.783706071584043e-01   +2.771730316524812e-01   +1.760708922025941e-01   -1.829808320123048e-01   +3.388229651298464e-03   +9.481585939947995e-01   -5.255894745268962e-01; -2.757020599286063e-01   +4.152041290938586e-01   -2.666266601588758e-01   -2.827380581784785e-02   -4.023167033676230e-02   -3.365857482929966e-04   +6.542291677349507e-01   +8.667414378010477e-01   +6.904553186115513e-01   +5.356163009137761e-01   +5.890840675130590e-01   -1.403063846737975e-01   +7.255359663572679e-01   +2.077322234637568e-01   +6.837012978156831e-01   +5.238714622459538e-01; +3.596665676974848e-01   -1.044771616852448e-01   -3.440211602309150e-01   +7.270406253094284e-01   +4.780166662921952e-02   +1.052709720265941e-01   +4.898353514551670e-01   +2.637579503242612e-02   -3.666478369985634e-01   +4.520463942294949e-01   -2.197244693910318e-02   +5.991769677919181e-01   +9.354596272822564e-01   +4.534904451435915e-01   +3.449263607088806e-01   +3.483592359256445e-01; -1.964092084512439e-01   -1.264979954064467e-01   +8.548349988995137e-02   +6.419619743067144e-02   -4.533291473119113e-01   +1.501288419986432e-02   +3.902793395870026e-01   +1.423026603070505e-01   -1.225424338495286e-01   -1.553538009523182e-01   -6.455947663406071e-02   +6.654666021697788e-01   +4.298525516106144e-01   -5.789971438115253e-02   +3.334157514104169e-01   +4.837340269798750e-01; -3.680102215615508e-02   +1.528277182847229e-01   -4.190190732354871e-01   -8.579214194930783e-02   +2.793301205335374e-01   +2.831638722049921e-01   +4.769688627380639e-01   -3.411129656476690e-02   -2.468256872764580e-01   +9.503312167227831e-01   -6.803575240963643e-02   +3.650582955646239e-01   +2.362214466391984e-01   -6.784903601262519e-02   +7.752067427341658e-01   +4.678840688029917e-01; +7.474892025932212e-01   -8.579399237437414e-02   +4.890115860167314e-01   +4.756986986883815e-01   +9.286459782035409e-01   +2.107426636703462e-01   +2.346467778768141e-02   +3.113304206868718e-01   +6.337608578398893e-01   +3.173250410755362e-01   +7.622288356282324e-01   +4.928332518722158e-01   +7.565789061321263e-01   +4.468357033542920e-01   +6.056751468673212e-01   +2.598142469788379e-01; +6.709418583096752e-01   -4.090760319404095e-01   +5.327169794102253e-01   -1.058145969743157e-01   +6.271175063547557e-01   +1.082572048371223e-01   +1.062686849574822e-01   +8.491523473026139e-02   +5.339531809276200e-02   +2.052713816319206e-01   +4.861583666421979e-01   -4.277016834891676e-01   -4.913208297320436e-01   +1.100257703220937e-01   +7.236715737148688e-01   +3.599122028961118e-01; +3.179551136713742e-01   -2.903900310009493e-01   +4.254364361427913e-01   +4.462007137540835e-01   -1.214970948725082e-01   +2.613728100226025e-01   -2.492161120960897e-01   +6.320012683507773e-01   -3.472726461414445e-01   -3.209165716468591e-02   -1.993317662995049e-01   -2.169251856447599e-01   +5.348832804895729e-01   +3.473625369820110e-01   +3.181945016635362e-01   -3.146834997857959e-02; -4.269950202626569e-01   -1.843141025159588e-01   +6.803560974615727e-01   -2.506318275594611e-01   -2.277900166930736e-01   +3.137105566986960e-01   -2.314645476821585e-02   +5.796164801828670e-01   +9.105446047609282e-02   +3.679286650580182e-01   +4.489203811976518e-01   -1.474242531061364e-01   -1.343765124062873e-01   +8.371884270856124e-02   +3.105849282121446e-01   -2.744223031383971e-01; +4.035832032537470e-01   +2.758608691153387e-01   -1.374302313389366e-01   -3.113948298870979e-01   +7.414239506804841e-01   +1.678898094757413e-01   -3.749502945085224e-01   +6.757672283404418e-01   +2.287685966795901e-01   -1.886600311320680e-01   +4.129312214620063e-01   +7.743570686724816e-01   -3.267884953023280e-02   +3.677120703757578e-01   +6.597729835195357e-01   -2.852276892160520e-01; +2.237938126197125e-01   +4.307521732947944e-01   +2.391278488899617e-01   +3.734941523680638e-01   +3.662830188236672e-01   +8.646916575053495e-01   -8.441779187929749e-02   +1.189403153502532e-01   +4.841569358653630e-01   -2.043581794588941e-01   -9.058964432312805e-02   +3.869168445499314e-01   -2.585093612448159e-01   +4.461833947721677e-01   -3.470363770613312e-01   -2.817623207382179e-01; +1.000000000000000e+00   +1.673405918113148e-01   +6.810922439272827e-01   +3.047257352568948e-01   +1.577492585719190e-02   +5.130618013949129e-01   +6.246816006603624e-01   +3.238910921890887e-01   -6.037965636220034e-02   -7.948312709937349e-05   +7.710673168085148e-01   +5.288995769082103e-02   +3.723448704462500e-01   +9.269059850415038e-01   +1.253938726093396e-01   +8.763474054390979e-01; +1.215222035472115e-01   +8.071155758729350e-01   +1.310978956640139e-01   +6.568119755577223e-01   +7.703782642557370e-02   +5.257806682704270e-01   +2.299759528783404e-01   +4.889501252987815e-01   +8.134673247993976e-03   +6.839311044851750e-01   +3.558480243694704e-01   +5.720720814493080e-01   -2.670766911181688e-01   -4.723091565440757e-02   +4.956575889637775e-01   +1.539762836573513e-01];
L2I_L1I_iGABA_netcon = [+2.714638870942691e-01   +3.902836631904983e-01   -1.572032278834593e-01   +1.242554746430133e-01   +4.883859704559603e-01   +1.000917913448452e-01   +5.469276813075435e-01   +1.581705655175580e-01; +7.443366645193698e-01   +4.780525056583455e-01   -1.348675657686312e-01   -5.346877201975072e-01   +3.060416394124697e-01   +1.511424206745407e-02   +6.330985579539954e-02   +5.127602398379516e-01; +4.713415234820943e-01   +9.339303191757686e-02   -1.843833970802378e-01   -8.874979731432008e-02   +3.938579984655266e-01   +3.467148184482017e-02   -4.363220696589402e-02   +3.186249332084320e-01; +5.512957899933878e-01   +4.354642526300145e-01   +4.697133800940540e-01   +5.825472681927267e-01   +4.564646928896270e-01   +7.672598537633764e-01   +6.619406013821591e-02   +4.172898897072929e-01; +3.294717499498376e-02   +3.753202170590168e-01   -1.004167836316948e-01   -4.105760821882091e-01   -2.203424471566549e-01   -3.397589557839285e-01   +4.817087393613747e-02   +4.801338152969063e-01; +7.907757875784019e-01   +2.350439119420585e-01   +3.886699379396099e-01   +1.951114597620062e-01   +1.000000000000000e+00   +5.504857829822342e-02   -4.434971109733224e-01   +6.334211930327837e-01; +1.887576416961597e-02   +5.924755846626766e-01   +5.087094855988458e-02   -5.697536392881201e-02   +8.524027744747399e-01   -3.244501869799229e-01   +8.877648953133751e-01   -3.630329665632942e-01; +5.592468771860589e-01   -2.027339198494326e-01   +4.503757081876414e-01   +3.490625919785661e-01   -4.993362901264899e-02   +2.502004121147611e-02   +2.516245465096151e-01   +3.832928004075052e-01; -7.887107111296836e-02   +5.223332602283447e-01   -2.317765277735264e-01   +1.475722303857308e-01   +2.784006538660999e-01   +5.683757431689559e-01   -1.209929642497910e-01   +2.219173370743203e-01; +2.726840050007824e-01   +4.622237495955448e-01   +4.930589446648422e-01   -3.423277868729570e-01   +4.558933115725409e-01   +2.298438835056544e-01   -2.283526336031942e-01   +3.717075590390925e-01; +2.743574510563241e-01   +2.103307591916458e-01   +5.306103550382322e-02   +4.461238528189779e-01   +2.619740692824790e-01   +6.159364258566329e-01   +2.833983715404678e-01   +6.501417674843645e-01; +2.580985176709056e-01   +7.684321505772945e-02   -3.486611638348480e-01   +6.318549016775553e-01   +7.487191773666855e-01   -2.927857575874666e-01   +8.471628932570557e-01   +1.900819584033702e-01; +8.908118959221428e-01   -3.445395997628588e-01   -4.633736900158366e-01   +7.454326630006319e-01   +8.091850920949598e-01   -3.222453559168444e-01   +1.934475765679154e-01   +8.294998827152662e-01; -3.121271471487863e-01   +4.559817954518042e-01   -2.374613723805645e-01   -2.113858209076245e-01   +7.006182830349555e-01   +2.149021963906190e-01   -1.786006744383087e-01   +1.337589537916586e-01; +7.037726574003313e-01   -5.844303210820465e-02   +1.786544402667183e-01   +2.553013710931438e-02   +1.817083647013945e-02   +2.462286403390107e-01   +9.415501152797180e-01   +7.819382615193340e-02; +6.497366280698339e-01   -3.087934999303725e-01   +7.529854260961102e-01   -4.933292733201246e-02   +8.349451110969160e-01   +4.134418298074755e-01   -6.294538332451464e-02   +3.660231174998566e-01];
L1I_L2I_iGABA_netcon = [+5.421984131216463e-01   +3.385952562295909e-02   +6.419195191943143e-02   +9.342423354261631e-01   +4.394013467146624e-01   -1.207801623473709e-01   +9.476440150988145e-02   +7.903857701669572e-01   +1.931351888654645e-01   +6.152696939075056e-01   +2.151036797171668e-01   +5.820203286022343e-01   -1.469575857065957e-01   +4.768206086919616e-01   -1.496826627912503e-01   +3.590097264519117e-01; +5.484499727655706e-01   +3.791761424112227e-01   +3.041973542379015e-01   -3.855943387277594e-01   -1.465747243069488e-01   +1.362127972498579e-01   +3.848329181997146e-01   +7.486510482548873e-01   +4.982977038074999e-01   +6.087164715661754e-01   +3.149904761322278e-01   -2.207812499952129e-02   +1.701025599217312e-01   -2.208553101336177e-01   +2.595928544796085e-01   +2.262452784067579e-01; +4.967041958720338e-01   -2.327844851212642e-02   +7.756108978965586e-01   +8.379852657947091e-02   +6.917206492492275e-01   -2.678698671400276e-01   +7.584021744974261e-01   +7.131693754312389e-01   -2.201957936884002e-01   +5.034550777573586e-01   -1.541301758349728e-01   +2.555996740600794e-01   -5.955738771617283e-02   -5.633300241178819e-02   -1.960597604032063e-02   +2.157475653509392e-01; -1.421573173613827e-01   +5.336102377897527e-01   -1.471979579678512e-01   -4.812450550891885e-01   +3.065347602551999e-01   +4.438955518123973e-01   +5.861828906431290e-01   +5.231420391676357e-01   +9.328981819209662e-01   +8.323531765016504e-01   -1.825360743368766e-01   +7.730471335948312e-01   +4.017857711484167e-02   -5.700273849067071e-03   +1.683047934016846e-01   +8.157665619548454e-01; -2.019866393540414e-01   +2.827470336687734e-01   +5.876988082814448e-01   -1.333228492518110e-01   -2.659121898251220e-01   +4.785433960603821e-01   +2.996220038345986e-01   +3.968704788281417e-01   +6.901222278639775e-01   +3.119544420754511e-01   +5.014259702172101e-01   +2.749149106782154e-01   +5.713330734936073e-01   +4.509368169484819e-01   +4.223053170230131e-01   +5.573022984031719e-01; +5.364869470959974e-01   +3.589630664077666e-01   +6.650729426747138e-01   +8.341988141126619e-01   +1.289933808432013e-01   +6.802133128329195e-02   -4.383847109415402e-01   +4.343556130900226e-02   -1.659836383489720e-01   +4.859706790222579e-01   +1.020700955490701e-01   +1.764750393015640e-01   +1.832702596903674e-01   +7.230113178482682e-01   +5.414535528307615e-01   +2.672685263044983e-01; -7.340362083787025e-02   +2.715454862580901e-01   +4.084623480064370e-01   +1.000000000000000e+00   +1.498882579031717e-01   +6.445369386399644e-01   +6.675339075972371e-01   +1.462800923186282e-01   +6.521208673167501e-01   +5.904622297982375e-01   -1.956841960593116e-02   +6.506864640597091e-01   +5.536479533040503e-01   +6.431027086715293e-01   +5.997994211918918e-01   +3.614632122314327e-01; -2.672658822512940e-01   +2.435764263167267e-02   -3.859772843974473e-01   +7.387923774745598e-01   +7.939337741675981e-01   +4.869630339962369e-01   +2.603618164314491e-01   -4.602015579976626e-02   +8.014924421219724e-02   +1.853136774460420e-01   -1.618321267201654e-01   +1.298328812851646e-01   -2.532462212928305e-02   +9.152435733475981e-01   -4.761681091429384e-03   +5.819468844892701e-02];
L2E_L1E_iAMPA_netcon = [+4.515237754860539e-01   +5.931602547969450e-01   -2.043084088246243e-01   +1.414521131425134e-01   +1.613484475665142e-01   +6.516664710159906e-02   +3.732858032007958e-01   +1.962243341049883e-01; +3.528735007456643e-01   +9.906533395493436e-02   -4.035785717401659e-01   +4.882437187806249e-01   +5.855242785971208e-01   +7.376844780246440e-01   +1.940078986010747e-01   +7.998500136687062e-02; +3.095366880633948e-01   -8.914723497513526e-02   +3.423744274681438e-01   +5.396345775024209e-01   +1.042645062796522e-01   +8.695568793107759e-01   +1.053855369935820e-01   +9.173872465539955e-01; -8.236555118532154e-02   +5.288846772700473e-01   +3.847022304818322e-01   +1.452125869326170e-01   +5.704569739547778e-01   -7.919582917269696e-02   -4.195571384051288e-01   +7.239907608986128e-01; +4.747454687952858e-01   -5.499806206223874e-02   +8.376383491851558e-01   +6.209109252800868e-01   +1.000000000000000e+00   +2.389916933120325e-01   +2.536800244420926e-03   +5.356118287082108e-01; +7.820208565259744e-01   +1.454405242523207e-01   +6.017734629629582e-01   -1.733568609249616e-01   +4.652097506026531e-01   -4.754956290214036e-02   -1.136570095317791e-01   +4.925335459510625e-01; +5.636385921615417e-01   +9.076738658436646e-01   +9.047785359722375e-01   +6.217034105529835e-01   -1.748559353951724e-01   -3.916287451249540e-01   +6.405407526448036e-01   -5.475277250802766e-01; +5.231804482201924e-01   +4.395124015584319e-01   -6.853263311139708e-03   +2.053987097353005e-01   -1.530624536459289e-01   -3.932572570690316e-01   +4.648217487063700e-01   -3.498059650490707e-01; -1.477913668311892e-01   +8.559328580282969e-01   -2.585335673454313e-01   +2.218729515545097e-01   -2.346699629555062e-01   +1.126193715738219e-01   -6.203741105711234e-02   +8.984451848862540e-01; -3.600386550937525e-01   +4.354697616242961e-01   +2.343545922921617e-01   +4.100805779641278e-01   +1.466220256196593e-01   +4.069927423934778e-01   +6.234861229435916e-01   +5.952059284555027e-01; +3.736976219421483e-01   +5.663655471735716e-01   -2.401441058445595e-02   -2.799749401735311e-01   +1.993669209705067e-01   +2.444597307202699e-01   -2.503513418455529e-01   +3.558878043538363e-01; +3.588813090024077e-01   +3.460055538855709e-01   +5.290374385346355e-01   +2.400503917309201e-01   -5.732443205079039e-02   +2.250160661285368e-01   -1.827626179583749e-01   -7.090678128743501e-02; -2.513098139059421e-01   +6.645162469188300e-01   -4.563186877264382e-01   -3.741833667858849e-01   +1.676551723875238e-01   +6.874769198048860e-01   +3.602132776700150e-01   -2.707767585092368e-01; +2.018075914761229e-01   +4.845105297251746e-02   +5.064484372852052e-02   +8.386562161481597e-01   +3.556382580750495e-01   +2.793152441016342e-01   -1.513943313616108e-01   +3.837954807651415e-03; -7.496112965622643e-03   +9.034780136334453e-02   +1.226091524527062e-01   +3.684010207722201e-01   +1.877291414523331e-01   +4.828776533791354e-01   +6.172298267233925e-01   +7.102677065451045e-01; +4.155201679157595e-01   +9.044391363010713e-02   +7.324931700309623e-01   +5.604774333030836e-01   +3.901555842412813e-01   +8.600553031058452e-01   -1.950633149786587e-01   +7.446189533769977e-01];
L1E_L2E_iAMPA_netcon = [+3.012166179664238e-01   -2.306372782554768e-01   -2.834847990549242e-01   +5.298726831203730e-02   +3.553416962934969e-01   -6.881361457478820e-02   -8.263654879429480e-02   -2.402804011276734e-01   -3.939995541186300e-01   +7.320115160606744e-02   +1.866792254148469e-01   -1.481013968166563e-01   +1.186851957128592e-02   +1.099200983543280e-01   +3.184619016669337e-01   -2.270270119910347e-01; -2.272746657484402e-01   -2.471540109698079e-01   +1.850781659589309e-01   -4.172807445890322e-02   +1.490911673517804e-01   -1.362547904268621e-01   +5.766628632546442e-02   +9.581262273440823e-01   -4.780696590214890e-02   +7.552970168761334e-01   +3.306095632591645e-01   +3.281276912162663e-01   +6.113780021413391e-01   -2.737821003268322e-01   +8.937030343445003e-02   +2.800863204311804e-02; +1.538532874224452e-01   +6.310556692172178e-01   +1.461181897596664e-01   +1.545937623734894e-01   +7.379219585631537e-02   +9.869135133710338e-01   +6.795843773133429e-01   -3.779239589211385e-01   +4.644309091183781e-01   -4.931708323161594e-01   +7.978570458988632e-01   +1.207612290010508e-01   +2.281503656937216e-01   -1.587329167530849e-01   +5.272381059943921e-01   +9.590070826064701e-01; +1.921046242161893e-01   -9.697306844460897e-02   +4.002637888056337e-01   +4.906655045446270e-01   +1.000000000000000e+00   +4.462430325717635e-03   -4.956241500128592e-01   +9.443096346073592e-01   +7.610283705789247e-01   -3.953472535911119e-02   +4.247178332383271e-01   +2.044944544753601e-01   +6.017266170407820e-01   +2.327513757384282e-01   +1.054851431087862e-01   +2.884708532470784e-01; -3.978751965058735e-02   +6.628918655041287e-01   +4.558744067446802e-01   +4.453669530756295e-02   +6.559723095217679e-01   +7.560953542407431e-01   +4.583184874949456e-01   -5.818275607601987e-02   +5.630373295900840e-01   +3.588904084821304e-01   -3.518492158307363e-01   +9.435007125570242e-01   -1.730554885672634e-01   -1.804486156375338e-01   +2.977041964992601e-01   -3.417528048265663e-02; +2.771707585221493e-01   +2.429838512413730e-01   -1.788399853224961e-02   +4.665058082515662e-01   +1.136304700726956e-01   +3.211272941389472e-02   +4.156970618165778e-01   +2.425776113340905e-01   +2.695607839424058e-01   +8.140035780279086e-01   +6.868850339807824e-03   +3.482583108351308e-01   +7.223450479837237e-01   +4.820553926224238e-01   +2.441237068047241e-02   +5.141949082348398e-01; +1.973028109030897e-01   +7.564821745456580e-01   +4.113840113943050e-01   +4.647544661852811e-01   +5.835327546513100e-01   +2.013471962772709e-01   +9.226202776343777e-01   +3.419473361509957e-01   -4.465889297232765e-02   +4.192432509080766e-01   +7.049476376606193e-01   +7.660888040337424e-02   -3.843336657459765e-01   +5.986936404418471e-02   -6.312377477226419e-02   +6.979330006687317e-01; +3.503679852780702e-01   +1.851051900040071e-01   +4.917002487036841e-01   +4.776864841880292e-01   +2.815535795062096e-01   +1.637734666847926e-01   +5.137720715295904e-01   +8.006432664737664e-01   +2.497108025718529e-01   +5.846076792652618e-01   +3.236700780022050e-01   +4.307553173189542e-01   -3.884008551883190e-02   +6.130900087136796e-01   -2.769110496035193e-01   +6.189440723002717e-01];
L2I_L2E_iAMPA_netcon = [+5.931252438825336e-01   +2.342389920677413e-01   -3.570370037655564e-01   +7.246255791542158e-01   +3.485728304332070e-01   +2.359974824568105e-01   +4.661762465343408e-01   +1.866495051607890e-01; -1.286074038640078e-01   +1.031205430384311e-01   +4.700382476298026e-01   +2.992981263803504e-01   +8.336588936502974e-01   +7.137636683423357e-01   +9.982422606452644e-01   +7.670531546352930e-01; +5.138963099302321e-01   -6.409313846063734e-02   +9.647148380522812e-01   +2.967248494419125e-01   +8.561652305740344e-01   -1.648836661992859e-01   -2.328854033367074e-01   +5.516793386032247e-01; -2.521755768294004e-01   +1.917623356784825e-01   -1.057010535823428e-01   -9.239087407606285e-02   +4.268690430924491e-01   -3.729111832126457e-01   +5.818451234690191e-01   -8.064516678801291e-02; +6.471938672617182e-01   +6.434849159623206e-01   -4.334900813962073e-01   +4.631989724620840e-01   -4.565433449939565e-01   -4.882575609810194e-01   +1.000000000000000e+00   +5.037574139142639e-01; +7.113488510279112e-01   +5.149249885738791e-01   +5.906273036949912e-01   +3.817949074655944e-01   +3.253876937226249e-01   +2.155490425134426e-01   +3.781174358987417e-01   +5.614512692543135e-01; -4.923761632191637e-01   +6.137044334982092e-01   -1.135074068805995e-01   +2.103375565001456e-01   +2.817409802400833e-01   +7.560232026264151e-01   +9.520810193465190e-02   +9.790731082787635e-02; +6.714481370773020e-01   +8.980406371468863e-01   +9.052904452014920e-02   +2.755921348078607e-01   +6.810844052980615e-02   +2.609647674663199e-01   +7.640582479919852e-01   +1.682645863132851e-01];
L2E_L2I_iGABA_netcon = [+2.467255746788878e-01   +2.200609966217139e-01   +4.655715921584554e-01   +3.990728269346194e-01   +6.422478379474728e-02   +5.398287924358751e-01   -4.467752686989481e-01   -1.906820511267972e-01; +5.731661031161860e-01   -2.113535333841683e-01   -1.819911544255615e-02   +4.622788180121310e-01   +1.105609375442921e-01   -3.408392983089222e-01   -3.824510759677120e-02   +9.067427296299668e-01; -4.788332869839816e-01   +8.482049072501097e-03   -1.682277705879126e-01   +9.125767099244977e-01   +4.127503719358955e-01   +8.398734868160107e-01   +2.179836185313007e-01   +3.731974268273819e-01; +9.032326576407923e-02   -3.473117424827000e-01   -2.230820317915148e-01   +6.437805448183169e-01   +5.072654305426804e-01   +6.201258564137609e-01   +1.802122609311153e-01   +7.521722273184704e-01; +6.975997776100830e-01   +3.873922132958724e-02   +1.000000000000000e+00   +5.078989524810826e-01   +2.897117478533867e-01   +5.633752623783306e-01   +4.561725342391080e-02   +5.773576512242757e-01; +2.970900747035964e-01   +7.340036685792721e-01   +6.576112632677940e-01   +2.626601233650380e-01   +8.742952796117107e-01   +3.615614405650148e-01   +1.616205460916569e-01   +6.334247776859582e-01; +4.341544839610155e-01   +4.535786715942215e-01   -2.721873980454549e-01   -2.355267100998699e-01   +5.515372050901568e-01   +3.110949853790527e-01   +4.718228514882680e-01   +3.999265335891476e-01; -3.677828173870056e-01   -8.023134796704268e-02   +4.075777807165384e-01   +2.588372352692921e-01   +2.722629310441965e-01   -1.317832945567672e-01   +3.378161223860442e-01   -2.400843880730862e-01];
L3E_L2E_iAMPA_netcon = [+8.358848590786765e-01   -8.828598378684657e-02   -6.078466104551954e-02   +1.114291723679418e-01   +9.185524372913597e-01   +2.139389872944383e-01   +1.000000000000000e+00   +7.424792960841771e-02   +2.723404098624558e-01   +5.773320854255978e-02   +1.312120808211437e-01   +1.252106982345094e-01; -5.156264008654640e-01   +2.790926752147313e-02   -3.558551219068569e-01   +2.984227313721141e-01   -1.081736259008484e-01   +1.285470712652671e-03   +4.208286280325793e-01   -2.455164829957295e-01   -2.934530024510001e-02   -7.027759845400781e-02   -5.588504770107297e-01   +2.706452193081096e-01; +2.532098020715566e-01   +7.741016347340335e-01   +7.243768624766274e-02   +8.229214512141031e-01   +2.581113583192112e-01   +2.329187985384790e-01   +5.838010868037505e-01   -4.531427861738671e-02   +2.938725219904759e-01   -1.437295022573008e-01   +2.065424769008112e-01   +1.918504592197727e-01; +5.578812511383028e-01   -2.997526503987364e-02   +3.549775251751521e-01   +1.888045864317319e-01   -3.073985994688666e-02   +3.542590788692567e-01   +1.863527556359461e-01   +6.030182775685239e-01   -1.837711293563389e-01   -7.828166034489266e-02   +6.233455460340102e-01   +4.759738051923718e-01; -2.490026696525051e-01   +8.389112056404538e-01   -9.507989039813794e-02   +4.062404007254778e-01   +1.037130923234528e-01   -3.128501503129523e-01   +8.125718178905522e-02   +8.080268098137436e-01   +6.069945902657285e-02   +3.237105207930985e-01   +1.386354180925726e-01   +1.169819401817878e-01; +3.660067900106453e-01   +7.896297875366969e-01   -1.880197142179681e-01   -1.518470204208631e-01   +5.675480951362110e-01   -7.117315051330970e-02   +2.680157761623245e-01   +2.902384841462718e-01   +7.205854885569815e-01   +7.176897521950305e-02   +1.147770605473459e-01   +7.044339179946165e-01; -3.613026135548559e-01   -1.615063335492855e-01   +2.806011965498308e-01   -4.187997998522018e-01   -2.051587636556037e-01   +8.583575623531736e-02   +3.805483559448321e-01   +8.650025612434135e-02   -6.507241644669905e-03   +6.688935100339117e-01   +1.079108758300491e-01   +9.833412024853412e-01; +9.192776938648264e-01   +5.117293701344590e-02   +3.058659245591386e-01   +5.707702445121490e-01   +5.598091643578275e-01   -3.640209817076400e-01   -8.343988729214241e-02   +8.448568076805451e-01   +9.272814053800175e-01   -2.572410435898886e-02   +3.721424870450140e-01   -3.110472371213049e-01];
L3I_L2I_iGABA_netcon = [+7.154933430204541e-01   +4.638198747321353e-01   -1.194333919824762e-01   -4.667600608656099e-01   -1.613452410179623e-01   +3.453371651754432e-01   -2.031057527630882e-02   +4.241005164302781e-01   -2.781560774610941e-01   +1.103595205207494e-02   +6.894780494157078e-01   +5.827748648954731e-01; +5.939981548396258e-01   -9.615672088389360e-02   +2.394849881297438e-01   +5.352109247958161e-01   +4.318047810151391e-01   +2.370941459127564e-01   +6.669086905002514e-01   +7.701375887476298e-01   +2.292411640883254e-01   +1.455466002066770e-02   +7.495512036601298e-01   -6.172652914135644e-02; +9.973148962337496e-01   +6.260148246107350e-01   +3.441057934224505e-01   +2.998470591771333e-01   +9.621969960211355e-01   +6.957758508526848e-01   +7.492832900474342e-01   +9.603650625725995e-01   +3.466128350407340e-01   -1.169619721609730e-01   +1.485885946515938e-01   -7.197104506399839e-02; +4.620330427200135e-02   +2.289509816033932e-01   -9.877767602412400e-02   -1.154829954560418e-01   +7.072661126857209e-01   +2.427040702671386e-01   +2.361034713123742e-01   -1.868328542024334e-01   +6.535038921360710e-02   +9.099694942394266e-01   -4.960314423044555e-02   -6.765396424018627e-02; +1.002565246445448e-01   +7.118672710399996e-01   -2.652336572917048e-01   +8.001360199292356e-01   +4.511104370742974e-01   +3.685377825274802e-01   -1.757748713562913e-02   +5.517920980018330e-01   +4.604191179574348e-02   +6.036476079271954e-01   +6.668860606321829e-01   -2.553334333148872e-01; +7.126224322963252e-01   -8.596622998325643e-02   +3.459121814570032e-01   +4.204919578933682e-01   +3.319553001873607e-01   +1.551973292961794e-01   +5.318798067748082e-01   +5.744502399914512e-01   -2.880940605303403e-01   -4.129731989276492e-02   +2.489061348639585e-01   +5.971559956736314e-01; +6.102525266030201e-02   -2.061220165719201e-01   +5.504728168529547e-01   +2.661771465003397e-01   +2.881192662507414e-01   +3.236626284465025e-01   +7.682586942923422e-01   +4.192320119604825e-01   +5.378553241483222e-01   +2.806998294140749e-01   +2.492515360112734e-01   +5.013517448954095e-01; +2.555544303324642e-01   -2.207694200430963e-01   +6.292577197622985e-01   +1.000000000000000e+00   +5.655740962698883e-01   -2.964813698946060e-01   +7.267378270583210e-01   +1.265211761109042e-01   +9.191125811665568e-01   +8.127927727406942e-02   +7.335700597436206e-01   +4.579492654639937e-01];
L2E_L3E_iAMPA_netcon = [+1.550629621114828e-02   -1.379214120211454e-01   +7.442523954917831e-01   +8.525920559825232e-01   +2.130205764242769e-02   -1.436471458459874e-01   -1.692272111906848e-01   +5.998307236307512e-01; +5.684252618935478e-01   -2.999089871320373e-01   +3.227831049861074e-01   +8.316730505301838e-01   +2.093365289897612e-01   +9.443599788500210e-01   +1.194146712873091e-01   -6.364378492172908e-02; +9.495022585711197e-01   +3.881585341370019e-01   -2.133958308633535e-01   +2.808547558455705e-01   +3.721489384789806e-01   +5.418041055670206e-01   +1.690538680635007e-01   +4.393100609665867e-01; -8.926651115188247e-02   +4.113530939429325e-01   +5.668871472988750e-01   +3.694654324410864e-01   +7.936749036835511e-01   +4.825597722670227e-02   +1.433457235359398e-01   +2.251758511610642e-01; +6.259255352296558e-01   +1.236355556217295e-01   +2.134844332907149e-01   +3.973696866900286e-01   -3.808569886904016e-01   +3.908633084176587e-02   +1.000000000000000e+00   +7.936011493731049e-01; -5.461119657336296e-02   +6.325693966296276e-01   +3.112770975100960e-01   -1.751032257346261e-01   +3.407560744168962e-01   -1.014818914449538e-01   -1.031806875594448e-01   -1.332565420314570e-01; +1.498865751584141e-01   +5.955861738213997e-01   +5.389561331303777e-01   -7.190776936087752e-02   +6.651741902058581e-01   +8.610251069394388e-01   +4.911770122862879e-01   +1.082255244013569e-02; +6.097069132079567e-01   +5.535782362494548e-01   -2.477680370287725e-01   +2.385340212240488e-01   +7.320810720761071e-01   +6.372515151371998e-02   +8.065300200407004e-01   +9.618115608117298e-03; +4.706711124158725e-01   -1.528303367223496e-01   -1.658826611367585e-01   +1.866388887140316e-01   +6.239425832975356e-01   +4.085127417857128e-01   -3.191534850311867e-01   -3.346735533166383e-02; +5.572394329412929e-01   +5.168442925722193e-01   -3.579258861780032e-01   +4.525103239353176e-01   +7.022648514891933e-01   +9.590199803259311e-01   -1.071061844570245e-01   +5.332700386498819e-01; -3.030421786987570e-01   +5.780031427433422e-01   -3.606046036473366e-01   +9.007655906859752e-02   -3.575811458952109e-01   -3.585125554204180e-01   -3.471507775864466e-01   -1.641137673695964e-01; +5.993612645125134e-01   +5.737857284193422e-01   -3.052408537953741e-01   -3.385274284136905e-01   -7.229007436600152e-02   -2.798686595375523e-02   +6.585698038125700e-01   +8.703211427178050e-01];
L2I_L3I_iGABA_netcon = [+4.437144090903143e-01   +3.227003517773481e-01   -2.501800931775555e-01   +1.592634097994718e-01   +1.050964012387116e-01   +5.610830614016532e-01   +1.311784574200867e-01   +8.048088515480258e-01; -2.114485857374887e-01   +3.311006620201242e-01   -1.610123623231708e-01   +3.430298949714044e-01   +8.484998781268673e-01   -6.708530362264238e-02   +1.246398974671956e-01   -6.326589166390890e-02; +7.360527841863520e-01   +8.316916969888229e-01   +7.179310416465943e-01   -4.731707354548662e-01   +1.258765753282583e-01   +5.023712398010836e-01   +5.284117753792492e-01   +5.688801408340698e-01; +8.188220428780509e-01   -1.057827820215672e-01   +7.522299185584731e-01   +8.466191793234209e-01   +3.921503061423079e-01   -3.530865682243860e-01   +4.865770614505531e-01   -3.088549863145028e-01; +6.112568855623391e-01   +1.743799972079899e-01   +3.006766738432594e-01   +1.949002705803782e-01   +7.181888639380448e-01   -2.634104209229642e-02   +5.342313286158987e-01   -2.556192105659522e-01; +3.499161095107706e-02   +7.974880274536044e-01   -4.492123634779303e-02   +3.752740372008329e-01   +1.905817708314268e-01   +6.977756086072393e-01   -1.932028809244851e-01   +5.046360894524190e-01; +6.737455970629166e-01   +2.647615354428168e-01   +1.086420634484923e-02   +1.726743777588181e-01   +3.785164278903986e-01   -1.711706695639321e-02   +6.766426442496744e-01   +8.418750047097657e-01; +3.238172748701386e-01   -1.351206258987881e-02   +2.855824382176027e-01   +9.658787263682146e-01   +6.326547202684166e-01   +1.562244754192048e-01   +7.815683850240664e-02   +4.908356546284450e-01; +1.597013336517578e-01   +8.685307391790396e-01   -1.461490926669932e-01   +4.603857476754332e-01   +6.591465402837664e-01   +1.422288445772132e-01   +1.000000000000000e+00   +8.421238465379213e-01; +7.165623916445691e-01   +5.884375488972308e-01   -2.296566547864119e-01   +5.995298358225233e-01   -5.124928273089338e-01   +1.794550264475646e-01   +2.280171672121649e-02   +7.063766616628591e-01; -1.691050882186568e-01   +2.248367167459235e-01   -4.550299240948996e-01   +7.159818055357933e-01   +4.335208243426620e-01   +2.162160451035593e-01   +2.243285674301550e-01   +3.208011436096973e-02; -3.022640276091227e-01   -1.281462460451682e-01   -2.400516191181195e-01   +4.795174571775014e-01   +5.749492291701253e-01   +5.180693206574266e-01   +1.063697855650448e-01   +8.928729648187399e-01];
L3I_L3E_iAMPA_netcon = [-1.206004524778621e-01   +1.305420183004740e-01   +5.053378381024295e-01   -2.239641515689895e-01   +4.919436531070170e-01   -3.322758574339567e-01   +8.531180506041797e-02   +6.922412900745251e-01   -4.090709941273908e-01   +6.001154194553545e-01   +7.414467774303997e-03   -1.524562905394357e-01; -1.215284325247630e-01   -7.823276153447492e-02   +5.692100641991877e-01   +7.840166531312819e-02   +5.991186868902579e-01   +1.994000172614305e-01   +4.964789160197964e-01   -3.586454896412125e-01   +4.306197433824862e-01   +6.449236011655103e-02   +6.382597532365482e-01   -4.095607786047850e-01; +6.610875694235149e-01   +3.171942162117824e-01   -1.600288856389118e-01   +1.001182554376050e-01   +1.347921024827447e-01   +6.663612080831705e-01   +2.188831142755755e-01   +6.783568334518940e-01   +1.492539196941698e-01   +4.566564673571363e-01   +6.533776753398619e-01   +3.203951138198911e-01; +6.560744769786798e-01   -2.145736419531115e-02   +5.680688158439683e-01   -1.135091594259370e-01   +3.100911358160695e-01   -5.384698291474197e-02   +2.997538106558944e-02   +1.903188723732266e-01   +1.285118890986161e-03   +7.726332174583428e-01   +9.118182022540222e-01   +1.384626937979422e-01; +4.268903735060651e-01   +4.849225247602390e-01   -2.233531990000281e-02   -2.324780226594017e-01   -1.732524856653180e-01   +4.859813778670417e-02   +1.972096902430685e-01   +6.346247803298188e-01   +9.558114136046298e-01   +3.487796299919966e-01   -2.023269914451468e-01   -7.634477846550489e-02; -7.416841358820091e-02   +1.594736630696673e-01   +8.168617981659881e-01   +3.739241277678347e-01   +3.010609511110692e-01   +4.707438850159614e-01   +1.845211881917659e-01   +6.399480273174646e-01   +4.756086502387549e-01   +4.010554597544438e-01   +4.804572787825559e-01   +4.137522126284147e-01; -2.701065274689212e-01   +5.025868540097310e-01   +5.510131113682214e-02   +1.202947053111042e-01   +8.294774189414930e-02   -2.128639421665449e-01   +8.209391000277522e-01   +2.671448959507056e-01   +7.552835548377679e-01   -1.034260959139130e-01   +3.972037615830782e-01   +3.094835975535579e-01; +7.458668861808987e-01   -5.088679879808654e-01   +4.169387706887069e-01   +7.445297732111358e-01   -2.335651248605964e-01   +2.736367506860127e-01   +8.550545733728782e-01   -3.720299983266384e-01   -1.167301113470022e-01   -3.065557492065942e-01   -1.290936908363652e-01   +5.998495337561546e-01; +6.407853054768369e-01   -6.516808994482134e-02   +4.378912665213750e-01   +5.553077098459154e-01   +2.620725902455373e-01   +2.708273425547922e-01   +1.179058109913454e-01   +3.679394667038048e-01   +1.136193077805918e-01   +6.479334698188514e-02   +4.785276183355467e-01   +1.000000000000000e+00; +5.369575616263758e-01   +1.043364958055342e-01   +6.506157761533620e-01   +4.200779351407096e-01   +7.163214755800238e-01   +4.534323192148598e-01   +7.025799701718287e-02   +6.789917021166770e-01   +2.966158076757422e-01   +3.616153337874419e-01   +3.850183760985344e-01   +6.630327901671221e-01; +8.115191211910137e-01   +2.204056348086704e-01   -4.890841871515931e-01   -6.405774456064148e-02   +3.663504893511670e-01   +5.490650917195745e-01   +9.689900563778735e-02   -9.723492128559204e-02   -6.613462150536152e-02   +4.257418532172419e-01   +9.734654092072633e-01   +3.649686053367846e-01; +2.214365786136901e-02   -1.830693957527314e-02   +1.959866223368531e-01   +2.498724025849408e-01   +4.740462357204466e-01   +2.140641512997322e-01   +3.867858308635899e-01   +4.148596881200822e-01   -1.965361307285987e-01   +8.281567210279005e-01   +3.031349626427379e-01   +2.505344623703608e-01];
L3E_L3I_iGABA_netcon = [-3.005359518480289e-01   +4.177844663460330e-01   -2.117604008953568e-01   +4.020385464747183e-01   +5.255588609502694e-01   +5.083167328512751e-01   +2.094283824271132e-01   +5.846126063686895e-01   +8.435392423845210e-01   +2.654827432113455e-01   +5.751375633380308e-01   +4.613830931211062e-01; +8.759307618608647e-01   -5.128477289965292e-03   -1.964088757957991e-01   +1.905278649126842e-01   -3.698994636154666e-01   -3.455263293326373e-01   -1.062798595939904e-01   +7.302389019089375e-01   +5.382808314873393e-01   -3.472231348161048e-01   -1.297317098948415e-01   -2.218440708631048e-01; +4.954227194009520e-02   +2.634204339909692e-01   +6.680296327712959e-01   -3.292602932797410e-02   +5.752312614584664e-01   -2.147004766724716e-01   +2.832795388048842e-01   +1.876507266353385e-02   +4.015254373092382e-01   -2.361391186855686e-01   +6.453950735485537e-01   +5.493241352545274e-02; +6.124680859249351e-02   +8.771832925648355e-03   -2.144633596116048e-01   +4.883622312946121e-01   +5.836040247424590e-01   +3.890798354502408e-01   +8.731809176833849e-01   -2.364532844105901e-01   +4.719094617213463e-01   +1.758005258471473e-01   +3.604820407709657e-01   +5.802788157775779e-01; +3.133033747493435e-01   -1.761879283797830e-01   +1.633893582614067e-01   +4.482404156910066e-01   +1.394447068386880e-01   +7.710661846111125e-01   +1.673283092937646e-02   +3.332915166141544e-01   -3.153269324922955e-01   +6.255087494502199e-01   -3.795788543432637e-01   +2.743004879859607e-01; +7.678324009747959e-01   +8.428480117348318e-01   +3.313781643100218e-03   +7.404503417456095e-01   +5.964718842771628e-01   +1.480034184167392e-01   +4.019805362871137e-02   -2.427485760012028e-01   +1.710839371101493e-01   +2.577168572843144e-01   +7.651964542210341e-01   +3.707293435548768e-01; +4.403238310015226e-01   +5.242223293357143e-01   +5.452096576855400e-01   +9.088567650671635e-01   +4.092509053310737e-01   +2.452332923950887e-01   -7.360515540286927e-02   +4.594771987993172e-01   +5.070795252700314e-01   -2.851692573918792e-01   +7.077147161717546e-01   +4.286180591098701e-01; -1.951974638943289e-01   +2.995256844340506e-01   -1.004444381376542e-01   +8.280851114133425e-01   +5.229706994910609e-01   +3.764365625124833e-01   +4.996578481994042e-01   +5.716869582137162e-01   -4.141428889557319e-01   +1.382383165282109e-01   -1.520322057815912e-01   -9.576374198977401e-02; +9.231922954070634e-01   +6.719077166460352e-01   -3.319748024645132e-01   -4.928445680318734e-01   +5.153024128336697e-01   -9.287923841023650e-02   -1.100215141791384e-01   +6.448273749371558e-01   +1.216657178281920e-01   +2.030506621990779e-01   +5.423359247686010e-02   +5.939376587951463e-01; +1.971510065045191e-01   +7.839801186813316e-01   +3.363164660537178e-01   +6.376907932465870e-01   -5.182520702898312e-01   +3.075008501777844e-01   +2.838659761851211e-02   +3.552549523345379e-01   +3.641468161964038e-01   -3.397503429035449e-01   +7.497511627442462e-01   +8.853317495997756e-01; +5.997631480743280e-01   +3.048394990182928e-01   +5.971433508526059e-01   -3.364692194803405e-01   +4.753390466070510e-01   +4.487283364995160e-01   +8.680814971911771e-02   +4.749798862881007e-01   +1.580873680269713e-03   +5.394025856702439e-01   +3.395831405526827e-01   +5.959232941220578e-01; +3.614534349675393e-01   +7.274971840240945e-01   +1.495805193526089e-01   -3.883768054732800e-01   +6.396515370592494e-03   +3.059724436672485e-01   +2.218651949667597e-01   +4.263017506080790e-01   +1.409217329118169e-01   -3.891876139139388e-01   +1.000000000000000e+00   -1.064498187386030e-02];
L2E_Input1_iAMPA_netcon = [-3.178250430366779e-01   +1.000000000000000e+00   +1.027097728958588e-01   +6.223305793410169e-01   -2.957567044860844e-01   +3.797260322793544e-01   +1.664471674971408e-01   -2.321924375571996e-01];
L2I_Input2_iAMPA_netcon = [+5.302591859377966e-01   +8.184132712225431e-01   +7.609833811822193e-01   -3.300789571535426e-01   +3.694287422786893e-01   +1.000000000000000e+00   -3.861697419742935e-01   -5.766763804721287e-03];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
