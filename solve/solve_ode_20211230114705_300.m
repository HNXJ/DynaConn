function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.939069429305359e-01   +1.277253411748733e-01   +2.352522402768205e-01   -4.916105164353089e-02   +2.644451349946271e-01   +2.779619344343546e-01   +1.992076243395496e-01   +1.782990695418738e-01   +2.568427382592213e-02   +2.467753772838940e-01   +1.826941265879059e-01   +7.635173199602963e-02   +5.848706634695083e-03   +2.584273951983875e-01   +1.347491413283333e-01   +2.509869909764708e-01; +2.892591513904418e-01   +3.450996979049056e-01   +1.575334082016685e-01   +2.016326761654358e-01   +2.573457923233682e-01   +7.899707405184214e-02   +2.034759127241158e-01   +8.816723745160734e-02   +1.673128002570847e-01   +2.646860770521495e-01   +2.200555168391898e-01   +1.987711376893948e-01   +2.524413423739115e-01   +1.990888929715760e-01   +1.574311994714460e-01   +3.803878928974830e-02; +1.753667344932444e-01   +2.528335264346655e-02   +2.294434773284554e-01   +8.783867144730777e-03   +1.064411442094139e-01   +3.169779725657084e-01   +7.783996379811717e-02   -1.785345214723913e-02   +3.293428100386358e-01   +7.832612493098025e-02   +1.799332544745547e-01   +3.372486275048389e-01   +1.086406281616376e-01   +2.082187214299310e-01   +2.167037787406795e-01   +1.145858856955012e-01; +2.770865297352218e-01   +2.468484460922927e-02   +2.465449928320094e-01   +2.626096979299309e-01   +1.934504171764344e-01   +4.689969306908693e-02   +7.172651182492576e-02   +8.945496301405546e-02   +2.184604715332785e-01   +1.846511217716418e-01   +1.132644917112736e-01   +1.100621156760755e-01   +3.279964584395905e-02   +8.112208979338814e-02   +2.414167906329014e-01   +3.263437016082464e-01; +2.095157440687456e-01   +1.328098632383659e-01   +2.510666890470630e-01   +7.750348180501966e-02   +8.098701655649915e-02   -3.754263378434384e-02   +1.758793572350373e-01   +3.414714711793880e-01   +1.833456103568866e-01   +2.879068689449580e-01   +3.627946461931188e-01   +1.670212401192955e-01   +2.431167478582804e-02   +3.979145857675716e-02   +3.207044324941521e-01   +1.310566230225386e-01; -9.486520120132651e-02   +1.407397744103165e-01   +3.320807938072153e-01   +1.121872562383930e-01   +8.009888960451321e-02   +9.163543601007663e-03   +1.933233896790863e-01   +1.826157354669764e-01   +4.100920130304932e-02   +2.363752909379196e-02   +4.883107657845574e-03   +1.553017736596931e-01   +3.214651316457406e-01   +1.065150038002435e-01   +3.349900419945009e-01   +2.347067838089695e-01; +3.816761091944290e-01   +2.209257600340526e-01   +3.013410899306957e-01   +3.268191370531298e-01   +1.421793097499785e-01   -8.287328358864113e-02   +6.663394136900327e-02   +8.957435633211033e-02   +2.626866957372689e-01   +8.211944660436871e-02   +1.435901149707872e-01   +1.031555061807378e-01   -2.243574983543675e-02   +2.690292406143060e-01   +2.051086562063384e-01   +2.440521098334396e-01; +2.795801604837338e-01   -6.091356448829514e-02   +1.224574361525972e-01   +2.523759640323095e-01   +3.946987695547940e-01   +2.246951127125572e-01   +1.227465951046749e-01   +9.063945670862326e-02   +9.801424450012780e-02   +2.588750137386820e-01   +5.452355885446937e-02   +1.901852232788512e-01   +2.524947048929939e-01   +1.563230324555108e-01   +3.324360576640207e-02   +1.316104862020686e-02; +1.815501157950198e-01   +2.107038512843796e-01   +3.093653389145878e-01   +4.296537588427583e-02   +4.310813641179562e-02   +9.026470944150167e-02   +2.069465222811753e-01   +5.626463400480759e-02   +2.502880732761125e-01   +3.811132173144736e-02   +3.057406587463759e-01   +1.834771493664440e-01   +1.462970123605710e-01   +3.598488245689665e-02   +3.256398875096007e-01   +1.148567860116166e-01; +2.637280155117883e-01   +3.779460031783134e-01   +2.408458821185069e-01   +1.651002343213887e-01   +2.040629415640968e-01   +1.703208459630162e-01   +3.337218214286394e-01   +3.345882671609971e-01   +3.235636359701014e-01   +1.655052273346008e-01   +2.673248740645378e-01   +2.786702775174809e-01   +1.881153895628930e-01   +2.426055417579003e-01   +2.995303924681445e-01   +1.752068082964092e-01; +8.771395865986020e-02   +7.271961127102954e-04   +5.074857068187146e-02   +2.983418567815597e-01   +3.050694584372343e-01   +8.456825370626506e-02   +4.254151675662579e-04   +1.578975844872703e-01   +1.983687793417768e-01   +1.536301987286091e-01   +1.787929255431294e-01   +2.848203435074340e-01   +1.201185228621626e-01   +1.053717777906922e-01   +9.913244378914837e-02   +1.500628476143381e-01; +2.359718774140100e-01   +2.028222620833020e-01   +6.193603378878623e-02   +1.613139564066489e-01   -1.479185005961633e-02   +1.609105376015399e-01   +1.422556913162758e-01   +6.746826116662938e-02   +1.944024447210299e-01   +6.698008101424409e-02   +1.725480396524889e-02   +1.394957227494233e-01   -3.268918949539852e-02   +3.383627185952018e-01   -1.803555823512172e-02   +3.835040118730200e-01; -3.564444823183015e-03   -1.456128810916898e-02   +2.267356646363772e-01   +2.832532443997707e-01   -8.003603815191618e-02   +2.878468408519805e-01   +1.347064398004566e-01   +1.456676423629197e-01   +1.327034329280831e-01   +9.426104930668149e-02   +2.223558084755320e-01   +1.365509947092158e-01   +2.762901900984278e-01   +2.504304540424138e-03   +1.241418038177166e-01   +2.060878300525872e-01; +1.678139872358287e-01   +3.075654908331584e-01   +7.787883784297460e-02   +2.945966347934822e-01   +2.633945137384565e-01   -6.682747129008164e-02   +2.056720893604767e-01   +2.586700282190736e-01   +2.474685817493826e-01   +2.910794889568661e-01   +2.734427124058804e-01   +1.523231092268159e-01   +7.346658198513314e-02   +1.879840305819082e-02   +1.847075604489535e-01   +1.684018805688614e-01; +2.175992028643096e-01   +8.960657293106070e-02   +2.976702280643257e-01   +2.744033500691941e-01   +1.320570492861176e-01   +1.667134641516060e-01   +1.395535353813499e-01   +1.810397532410554e-01   +2.825529434676549e-01   +3.278618513151966e-01   -2.289003777027194e-03   -2.870395694648662e-02   +9.176691759920910e-02   +2.109902474250924e-01   +3.400726580543201e-01   -8.797661478421627e-03; +1.629089142251853e-01   +2.391492432964249e-01   +8.607818390043709e-02   +1.441735603839392e-01   +1.350433162739092e-01   +2.225097118027060e-01   +2.133513561282660e-01   -1.963210375363030e-02   +8.250153934836310e-03   +1.272749605466452e-01   +4.014817585067693e-02   -6.742976059732479e-02   +1.090164706183894e-01   +3.031330769586206e-01   +2.634286638688805e-01   +2.654832248705803e-01];
L1E_L1I_iGABA_netcon = [+1.551384464927776e-01   +1.610903088095658e-01   +5.602893338843055e-02   +6.039511056183883e-02   +1.760760271646859e-01   +1.346076370551917e-01   +1.593741644174507e-01   +1.011395312695346e-01   +2.263572994220861e-01   +1.194564735898065e-01   +1.095122888675202e-01   -3.683155397246770e-02   +1.061866380243298e-01   +1.027797890253835e-01   +3.244993513084844e-02   +1.013817727545710e-01; +1.162672214676542e-01   +1.138378298712070e-01   +3.020014211503005e-01   +4.435091991233215e-02   +1.986840839488153e-01   -1.198854445444845e-02   +1.767761195378514e-02   +7.070669433280674e-02   +1.393135706409004e-01   +2.210379740789838e-01   +2.957616008347186e-01   +1.915622237507738e-01   -2.303837900222682e-02   +1.621744976675331e-01   +4.367311013880400e-02   +2.846474722125760e-01; +2.321531229982457e-01   +2.593337206002149e-01   +2.220106444728659e-01   +2.565265653759594e-01   +3.593425937989810e-01   +3.845031263557390e-01   -7.722194769362763e-03   +1.873466284469689e-01   +1.733560055690820e-01   +3.758076218975949e-01   +1.663035896182543e-01   +2.914388109631630e-01   +1.326802955165199e-01   +3.316387932391054e-01   +3.456084894131899e-01   +1.109269144155363e-01; +1.496496333593534e-01   -1.738334468883107e-02   +3.662996649647224e-02   +2.547366040286818e-02   +1.235211975111426e-01   +2.422875676932733e-01   +2.270525646922642e-01   +2.362770982012354e-01   +4.723740969493256e-02   +5.858358301696873e-02   +7.820555290908299e-02   +1.915337621791885e-01   +2.695420162023685e-01   +1.070719964295051e-01   +1.326047333395370e-01   +7.744290664352022e-02; +5.923825943176825e-02   +3.735067683594157e-01   -2.507799126668001e-02   +2.375299624984806e-01   +1.431412773072068e-01   +2.404357877378941e-01   +4.694239001438807e-03   +8.485442483693753e-03   +3.419972312077468e-01   +2.305852767073505e-01   -9.116850498179677e-02   +2.764429902831192e-01   +6.774607134692291e-02   -9.899848614278613e-03   +2.107309370610659e-01   +1.394828444947211e-01; +2.827160538384580e-01   +1.391427870526655e-01   -5.622565811987446e-02   -8.794559906408067e-04   +1.077112657017541e-01   +2.054321476354235e-01   +1.708527226042334e-01   +2.211516144536319e-01   +2.052977393858723e-01   +1.990928563049918e-01   +1.968176751431524e-01   -5.276857537423554e-02   +1.653219261864039e-02   +2.572487398293973e-01   +3.219873703835692e-01   +1.838066029933787e-01; +1.142747405347581e-02   +3.317695374338772e-01   +1.263466590304387e-01   +3.898792245771148e-01   +2.969710485144963e-01   +2.371993087365631e-01   +3.982088860316387e-01   +1.852926013332088e-01   +5.179384917997207e-02   +5.973305257579666e-02   +3.163195724702825e-01   +1.752169124701145e-01   +1.214375741365611e-01   +8.503168986719138e-02   -5.404717157768169e-02   +2.972367102651358e-01; +2.328587254926012e-01   +1.068805064224255e-01   +2.813993868532492e-01   +2.015148640741395e-01   +1.227566968159963e-01   +1.820560199071883e-01   +2.188564052465901e-01   +1.377221512861780e-01   +1.918752023999049e-01   +1.035515936011737e-01   +1.040655774139475e-01   +1.977972566275506e-01   -5.487790415196581e-02   +3.997239257861098e-01   +1.529532160161780e-01   +2.765943497989711e-01; +6.545217460700661e-02   +2.564804074631303e-01   +3.022861748825377e-01   +2.873939271986860e-01   +2.432001830025724e-01   +1.194921720762125e-01   +4.863531504989188e-02   +1.641125216603477e-01   -2.665973043047538e-02   +2.565589352837315e-02   +2.606618902802438e-01   +2.375818014858352e-01   +2.040714753239333e-01   +1.536151108905929e-01   +8.612166748952688e-02   +5.141801121008435e-02; +6.258900883583622e-02   +3.523283615123229e-01   +2.406781329374102e-02   +3.304202125637440e-01   +1.995007469535535e-01   +1.498868249959073e-01   +7.510754729751308e-02   +1.124678684643857e-01   +9.419865891307860e-02   -3.668411397147722e-02   +4.239948000138189e-02   +1.124753211199551e-01   +8.325524848869792e-02   -7.111040435348523e-02   +1.031985076850953e-01   +1.205888853064132e-01; +2.495894444660212e-01   +3.208482237891302e-01   +3.280843361498360e-01   +4.188913075243087e-02   +3.354533372385561e-01   +3.337288712036589e-02   +2.533059472008109e-01   +1.026782788489823e-01   +9.391566088260450e-02   +6.683071466687776e-02   +2.936934078051167e-01   +2.695091179240788e-01   +2.644208294388834e-01   +1.659145875317449e-01   +1.497018664501434e-01   +1.444074542631732e-01; +2.646622639453372e-01   +5.918177857043697e-02   +1.477632007409714e-01   +1.651141520521874e-01   +2.332211150708482e-01   +2.252089918765817e-01   +3.145224084730803e-01   +4.385111701924866e-02   +2.206712842553424e-01   +6.350318085696903e-02   +3.006881321955900e-01   +3.032130556675404e-01   +2.667470307184893e-01   +1.974898670493637e-01   +9.691622789260763e-03   +3.506993581791421e-01; +8.357482336621297e-02   +2.026016422007181e-02   +4.576998768841582e-02   +7.079893211188718e-02   +4.797822298127204e-02   -1.147712947988255e-02   +9.256069350897551e-02   +3.762384346944501e-01   +2.472376515667066e-02   +2.379227806914948e-01   +1.319480113919171e-01   +1.424567751849914e-01   +6.468470088694131e-02   +1.232621306116337e-01   +1.666941500252805e-01   +1.704414783691607e-01; +1.238647313987306e-01   +2.217671845864891e-01   +3.034172312330098e-01   +8.596576335473761e-02   +2.674796176306408e-01   +8.845975189289491e-02   +3.222271876387732e-01   +9.607024473337672e-02   +9.588794831538926e-02   +1.356167783895899e-01   -2.528568504837542e-02   +3.714713379765696e-01   +8.802714613944843e-02   +3.265562622700637e-02   +2.253094225394154e-02   +3.054966306319882e-02; +3.501929022570646e-01   +2.702722861025981e-01   +1.250229343896307e-01   +4.259415216372675e-02   +1.290098285847596e-01   +1.723111352855174e-01   +3.579338863238156e-02   +1.095990340274078e-01   +1.493295802281182e-02   +4.442865603139796e-02   +1.570998672117165e-01   +1.709193351102972e-01   +2.623922000607871e-01   +1.724865693134369e-02   +2.683266445549102e-02   +4.155462317063005e-02; +2.898607116444818e-01   +2.045581108908287e-01   +2.981595318911600e-01   +5.609841015410716e-02   +4.109867467050485e-03   +4.218392685853956e-02   -4.790841710248415e-02   +2.295268665167653e-01   +1.146602692354325e-02   +1.647891738669255e-01   +1.570621627789192e-01   +3.036850408329129e-01   +8.339373229844262e-02   +2.192249754768759e-01   +2.674798193971141e-01   +4.498545690174334e-04];
L2I_L1I_iGABA_netcon = [+3.077964689978371e-01   +1.134613533751831e-01   +1.167523539173583e-01   +2.299391550829120e-01   +9.947720111482949e-02   +1.645248050685184e-01   +6.134136779444775e-02   +3.329894185325268e-01; +7.838904899799001e-02   -1.544990640484971e-02   +6.292255092422593e-02   +1.641713836664022e-01   +1.514836946354431e-01   -2.345373758380475e-02   +1.656175848277146e-01   +1.348868374837183e-01; +1.496337783318606e-01   +1.945667754141370e-01   +1.828087008022764e-01   +5.332885881633526e-03   +2.315963775977392e-01   +2.928810005774261e-01   +1.831241885344518e-01   +3.239498378453094e-02; +1.697447563866599e-02   +3.071081930113201e-01   +1.363684437837573e-01   +3.173569740934596e-01   +1.181709230986889e-02   +2.107137711811695e-01   +2.587656404366010e-01   +2.073658719424318e-02; +3.582331331987132e-02   +5.729675303710229e-02   +2.130403613769463e-01   -7.111349227179045e-02   +2.065578526906598e-01   +1.733572211842531e-01   +2.768098028226732e-01   +1.490595563730064e-01; +1.542579521379057e-01   +1.986146292537261e-01   +2.512524532091484e-03   +1.440120856855184e-02   +2.632301726256991e-01   +9.014751637973084e-02   +3.658414893304517e-01   +1.406321077709731e-01; +8.409430044540134e-02   +5.642683261599087e-02   +1.425420227888437e-01   +8.906219807473338e-03   +2.995660019222329e-03   +2.665213908584234e-01   +2.073307493751931e-01   +9.725133994650022e-03; +3.027410759096040e-01   +1.159656811453504e-01   +3.131465990632919e-01   +2.379201133008421e-01   +1.777575887484800e-01   +5.737666580107981e-02   +2.057564648275189e-01   +1.514116976837074e-01; +3.528813605711978e-02   +2.661368007406561e-01   +7.013700108406312e-02   +3.657358047547719e-02   +2.871677902597964e-02   +2.336245729422110e-01   +2.203001678812205e-01   -2.000498177225335e-03; +5.588025968851502e-02   +2.889919290809047e-01   +2.804724772853963e-01   -4.204221352192222e-02   +2.169894312222777e-01   +6.042005717376774e-02   +1.101006056380984e-01   +2.102320610001137e-01; +2.816976978076188e-03   +2.595306539896235e-01   +2.344850362444811e-01   -3.208403595970991e-02   +2.606857942510595e-01   +9.914750441539651e-02   +1.182118067734318e-01   +1.948421611261169e-01; +2.246676623548791e-01   +1.010304777730998e-01   +1.112392917281005e-02   -5.100691913404717e-02   +1.031311564095484e-01   +1.239016009586309e-01   +1.929990917350127e-01   -4.170625990828406e-03; +2.988487222609885e-01   +3.061775681249522e-01   +8.053466758944830e-02   +1.213170667654310e-01   +1.658286854253119e-01   +2.036047301596716e-01   +7.587390188364762e-02   -1.850331478518389e-02; +1.886199287962457e-01   +7.759424934823878e-02   +6.761859609556820e-02   +1.695385377128824e-01   +2.216341809554319e-01   +1.089885013769816e-01   +2.765896213583340e-01   +9.626051813660855e-02; +2.071944467957949e-01   +1.048467160926800e-01   +2.696653021329011e-01   +2.868440704276261e-01   +2.325195796726134e-01   +1.807379040406634e-01   +8.383657721439516e-02   +1.293337360859480e-01; -2.142987354981147e-02   +3.125787400672284e-01   +2.079966663633182e-01   +2.000714630903715e-01   +1.758445683908413e-01   +2.806534861137201e-01   +1.846362887207977e-01   +2.646112295548080e-01];
L1I_L2I_iGABA_netcon = [+2.575374988928347e-01   +5.308168550236025e-03   +2.910068376711260e-01   +5.228957711047280e-02   +1.716327018990562e-01   +1.294092559903517e-02   +7.521018815859131e-03   +8.966035358007846e-02   +2.507764035407858e-02   +1.858143883685247e-01   -8.807974903852116e-02   +7.544040755466065e-02   +1.022247160950760e-01   +4.992101877611377e-02   +2.538638039813643e-01   +2.939996066432894e-02; +1.442457321896922e-01   +3.097233045670507e-01   +9.670633235196069e-02   +2.324166563338149e-02   +2.062196328280097e-01   +7.870784381659481e-02   +2.763434879197800e-01   +2.450202389115630e-01   -1.332499221902904e-02   +1.022913042938157e-01   +1.468488956425997e-01   +5.148443800849645e-02   +1.969937074142422e-01   +1.756491012769150e-01   +5.823179442611910e-02   +6.140794142636356e-02; +5.445757222159071e-02   +8.191310910152297e-02   +1.031717023596057e-01   +3.587446501781328e-01   +5.665914334796585e-02   +2.590018283109919e-01   +1.179896996245348e-01   +1.828312126407286e-01   +3.534719980565992e-01   +4.710904233757651e-02   +1.175766448221008e-01   +2.053123425990602e-01   +3.648752034427905e-02   +1.585828634154351e-01   +1.149447752653693e-01   +2.339374284915767e-01; +1.488483258356951e-01   -1.050911415750633e-02   +3.233776902196608e-01   +2.092518665828836e-01   +4.174968779109374e-02   +2.923835658986589e-01   +1.244753252930576e-01   +2.110945979680465e-01   +2.030264821282933e-01   +8.932427506209620e-02   +3.152402806174031e-01   +7.874000005916509e-02   +2.455996603659224e-01   +2.450085409028573e-01   +1.056746240936295e-01   +1.263054628570316e-01; +7.149436286754822e-02   +2.693874629327642e-01   +1.099571429887118e-01   +2.455906321407795e-01   -4.513708871754345e-02   +2.113150676360334e-01   +2.521773355023517e-01   -1.892375280149136e-02   +1.640750526638361e-01   +1.630135859640797e-01   +1.218407996557903e-01   +1.322395585582076e-01   +2.576559479694602e-01   +6.758666648934004e-02   +1.340131600412518e-01   +1.465091046756360e-01; +2.153949213353836e-01   +2.347382034910055e-01   +1.621973927669374e-01   +2.857082490115885e-01   +7.189204365792456e-02   +1.130761329159999e-01   +3.232782932181930e-02   +8.559507374921460e-02   +3.546151118771554e-01   +3.127155380553019e-01   +3.198315545479826e-01   +1.176884454695220e-01   +2.124157081516784e-01   +1.881158448486800e-01   +1.763646791628455e-01   +3.222635206066831e-01; +2.530075705585621e-01   +1.736533670876362e-01   +2.601096173208070e-01   +2.560004164263925e-01   +2.973279692172989e-01   +2.775159548827263e-01   +2.262793926873987e-01   +2.217541512292205e-01   +1.667341733666846e-01   +2.735472322856084e-01   +3.567618041233830e-03   +7.130779893889178e-02   +2.878389720209072e-02   +1.264063124106632e-01   +2.336212774026302e-01   +1.767119606244174e-02; +2.592729637526170e-01   +1.289442411526180e-01   +2.769416063958274e-01   +2.600030665359297e-02   +1.036335096252237e-01   +3.838473232435202e-01   +7.842225403180969e-02   +2.543710152342953e-01   +1.267351932816568e-01   +3.196205741652647e-01   +1.834756106381774e-01   +3.242195434080563e-02   +1.337737080635603e-01   +5.138852884875898e-02   +3.084966735470508e-02   +8.751982775451163e-02];
L2E_L1E_iAMPA_netcon = [+8.331131005025166e-02   +1.080522955655650e-01   +3.691680941530828e-01   +7.407364322418672e-02   +8.162163090161241e-02   +1.226496358219016e-01   +5.926580411207586e-02   +2.599874999672125e-01; +1.799065604672429e-01   +2.011740228037472e-02   +2.900796728792621e-01   +2.623970099832020e-01   +2.894790295401307e-01   +1.917413281420650e-01   +9.793784229603250e-02   +1.212743721881713e-01; +2.237753797692126e-01   -5.119233077254658e-02   +5.669465890280851e-02   +1.846372442209397e-01   +1.026287341122824e-01   +2.037761067960942e-01   +1.268308585614538e-01   +3.895788522400615e-02; +2.423298392638953e-01   +1.505165833064095e-01   -3.455463586109245e-02   +2.986011367799025e-02   +1.071953899267236e-01   +8.001338860331252e-02   +7.950004612720867e-02   +2.550350910579233e-01; +6.613829355258539e-02   -4.390338043370545e-02   +9.659830082623301e-02   +2.475520113187576e-01   +9.832289002098829e-02   +1.434376859108542e-01   +1.644591010231863e-02   +1.018064310971253e-01; +1.088333529535458e-01   +1.939279520895650e-01   +1.308547518964575e-01   +3.675995576437797e-01   +3.643267698417474e-01   +1.714031437921148e-01   +2.296722617764020e-01   +2.814229861377543e-01; +2.174514676475890e-01   +1.412995981129983e-01   +1.093321034918488e-02   +2.337447779912483e-01   +3.362492492007852e-01   +1.494896680090727e-01   +1.695818042259154e-01   +1.078687870878968e-01; +5.689587327627289e-02   +1.113310590642323e-01   +1.330945006862847e-02   +3.376044748083016e-01   +4.473262929163055e-02   +2.282887180426444e-01   +1.588264124768456e-01   +2.957147194805643e-01; +2.478531331029754e-02   +1.713670136056325e-01   +1.850019020602455e-01   +3.109209764815007e-01   +2.549883854577942e-02   +2.284580700106278e-01   +2.069250430527994e-01   +3.231441784996001e-01; +1.465145816530882e-01   +2.998479201344463e-01   +1.370129996789079e-01   +1.467656002573069e-01   +2.752327938786390e-02   +5.411343475977311e-02   +1.831628955159906e-02   +1.127087749846300e-01; +1.333529459451474e-01   +2.664394198755169e-02   +7.909333309600558e-03   +2.896072616412302e-01   +5.422555683275704e-02   -5.731086639939890e-02   +2.485054349155427e-01   +7.556017540378734e-02; +1.555878547806835e-01   +2.173800975136793e-01   +2.584777685471811e-01   +2.430141333055039e-01   +1.321717101176709e-01   +2.342306936209733e-01   +3.254962139284997e-03   +5.212604829116947e-02; +9.953072887819192e-02   +2.411104813265061e-01   +3.442983725972618e-01   +1.818239228280551e-01   +2.197778729091687e-01   +2.922798148429795e-02   +1.704568538455475e-01   +3.437335847651901e-01; +2.876243760733723e-01   +2.275613255937469e-01   +2.705524533348779e-01   +3.807029414248468e-02   +5.959876247758680e-02   +4.625536765887748e-02   +1.977523351493684e-01   +2.971715947289487e-01; +1.962625078523988e-01   +2.113744877128611e-02   +5.561709315619565e-02   +2.361701601284206e-01   +2.997446913382449e-01   +2.629962743975522e-01   +7.858127475661938e-02   +8.740629452099462e-02; +1.505740076360391e-01   +2.731479042012145e-01   +1.737766426130641e-02   +2.186604645034906e-01   +2.097637290196626e-01   +3.053231117628334e-01   +7.416049892976966e-02   +2.080563999426025e-01];
L1E_L2E_iAMPA_netcon = [+1.877221016782809e-01   -6.732155548387292e-02   +2.854799710517532e-03   +1.413064485596347e-01   +2.547224990654512e-01   +1.852408974056130e-02   +6.891774377795265e-02   +2.536952943714822e-01   +4.507599105307927e-01   +1.073707937477438e-01   +3.187301219796493e-01   +2.525171449200834e-01   +6.250776317503273e-02   +1.256221273986422e-01   +1.501463248623556e-01   +1.138644736325113e-01; +2.539369637232579e-01   +1.440376957464419e-01   +6.891345462107960e-02   +5.848747938051958e-02   -5.451523724100400e-02   +9.407919432175882e-02   +7.699056081676529e-03   +3.040189275502643e-01   +2.792017045346441e-01   +3.315265877388598e-01   -1.031414276193321e-01   -1.152539921453588e-03   +2.634024921914681e-01   +2.255527245336322e-01   +2.361330669660701e-02   +4.389999390276145e-02; +3.574434042686772e-01   +3.054701953957059e-01   +1.738689582015024e-01   +1.874555450673130e-01   +1.494699003915428e-01   -5.254054530053953e-03   +1.295548243948693e-01   +1.057024145852141e-01   -3.739594243274431e-02   +1.312278216735258e-01   +1.442109488977705e-01   +2.664905881045306e-01   +7.302464196279043e-02   +3.092410791905314e-01   +2.263837934441890e-01   +3.356775363248332e-01; +1.798683625565432e-01   +2.088708783476786e-01   -8.198407719988015e-03   -3.119192627158088e-02   +1.751460342940639e-01   -6.981665781474504e-02   +1.577840027618206e-01   -4.809771016024394e-02   +1.600270375737179e-01   +3.125055165777391e-01   +2.388898967812209e-01   +1.729884907782855e-01   +9.997986605830618e-02   +3.074459465833849e-01   +1.812068920440774e-01   +1.144151229885904e-01; +4.653721283297291e-02   +1.481894048418729e-01   +2.640809260782286e-01   +5.475538322423614e-02   +1.017378482304929e-01   +3.737752268458322e-01   +2.851891840940731e-02   +3.474456701555684e-01   +1.973920224936610e-01   +2.553512024258785e-01   +6.310311309773056e-02   +1.225971280800491e-01   +2.641484063692255e-01   +2.050859610008483e-01   -6.245328315464220e-02   +6.833811043682395e-02; +8.918144934613208e-02   +2.740700353055721e-01   +1.287717149605522e-01   +3.015849014277802e-01   +9.520270615481929e-02   -9.214201747912057e-03   +3.015805223542823e-01   +6.866038022491566e-02   +2.304556981800896e-01   +1.217328148641084e-01   +1.396990594182262e-01   +1.711150052349751e-01   +2.308710013272905e-02   +2.605029385935247e-01   +1.875743561258293e-01   +4.124380862657855e-02; +2.748514558297850e-01   +3.528251919670861e-01   +2.165604998716351e-01   +2.111712707951282e-01   +2.858535442216600e-01   +3.083644315753482e-01   +1.470479446078949e-02   +2.083001207243292e-01   +4.693208684558573e-02   +2.982535844294194e-01   +1.148664626660102e-01   +4.338845882662237e-01   +1.879139883634756e-02   +8.709661215707681e-02   +1.729772246510955e-01   +1.481793995791182e-01; -4.093900427353965e-02   +1.044282537862172e-01   +1.942342411699705e-01   +2.032387010301730e-01   +1.066630259341766e-01   +1.964197282911805e-02   -7.901080888170785e-02   +1.032189942174038e-01   +1.400465860691045e-01   +3.126132076628083e-01   +2.016164164980742e-02   +2.105930617178455e-01   +1.773305638014483e-01   +1.421063994716760e-01   +9.478722277414878e-04   +1.310254555738958e-02];
L2I_L2E_iAMPA_netcon = [+9.666238008118574e-02   +2.103280424308436e-01   -8.590637826790481e-02   +3.696932933892327e-01   +2.525342636972314e-02   +2.016653448592906e-01   +5.746056689968675e-02   +2.473151514541103e-01; -3.690308974644038e-02   +2.726428706814720e-01   +1.090287682383599e-01   +1.342186294383596e-01   +8.367376745442995e-03   +2.058094763224118e-01   +2.388635782845535e-01   +1.703049822764362e-01; +1.838895650269622e-01   +1.096044782219166e-01   +2.946761784794623e-01   +5.170187732395815e-02   +3.684968617819355e-02   +2.283263724044282e-01   +1.879029305576761e-01   +2.234640259584711e-01; +2.198611019140030e-01   +4.419359009643821e-02   +1.567283138090624e-01   +2.062250593555507e-01   +6.720040405580369e-02   +1.766611698212434e-01   +5.936134651693445e-02   +1.347776463541948e-01; +2.265909076446628e-01   +2.451339224392395e-01   +1.033436223181409e-01   +2.217608769008826e-01   +6.614978654956720e-02   +2.666931781427808e-01   +2.380129523994286e-01   +1.309272108820994e-01; +3.140465600162314e-01   +4.279212210086390e-02   +1.412367034234675e-01   +3.859031879736106e-02   +4.716696404419361e-02   +9.251121728284500e-03   +2.462600999578042e-02   +2.157271689472493e-01; +2.073855142681823e-01   +2.391205406366682e-01   +7.151955050704654e-02   +2.097767787278627e-01   +3.094657117487729e-01   +1.515984941039115e-01   +3.138267883827381e-01   +2.779744433461632e-01; +2.077911536516144e-01   +3.452539887107197e-01   -2.421331629710655e-02   +7.294407543829641e-02   +3.693713084774298e-01   +9.621407217589811e-02   +2.765062952192642e-01   +1.891514282835773e-01];
L2E_L2I_iGABA_netcon = [+2.606993785793701e-01   +1.922871622379158e-01   +1.496137958735459e-01   +2.821447056446501e-01   +1.960209072627591e-02   +3.063504923507058e-01   +3.385505612589275e-01   +1.040150128195057e-02; +1.942271358447798e-03   +5.680868565277859e-02   +2.407999308059310e-01   +1.944601760155740e-01   +3.167578107629623e-02   +1.361243413709883e-01   +3.623875505379463e-01   +3.235955475806790e-01; +2.492896412172554e-01   +6.156485402243454e-02   +2.231939222385508e-01   +1.689544404897243e-01   +2.323649514562300e-01   +1.114345563913722e-01   +2.687169470512728e-01   +8.428625455833000e-02; +1.644976087199470e-01   +2.530509664319017e-01   +2.920655256229854e-02   -1.591818456145139e-02   -3.874756398113029e-02   +2.336434992876439e-01   +2.024176663179717e-01   +6.759710708209862e-02; +2.544552336982625e-01   +1.335138400036691e-01   +8.218593485469404e-02   +5.218717052349420e-02   +2.980660304566870e-01   +2.719991903080712e-01   +1.293217172840172e-01   +1.865295983242233e-01; +3.847111531057674e-01   +1.922647346619924e-01   +9.258171442548267e-02   +1.109498865683058e-01   +2.987230724779472e-01   +1.645310631424763e-01   +9.790277538729153e-02   +2.617619925405466e-01; +7.215391003789906e-02   +1.614306344428028e-01   +2.802195330266823e-01   +6.501449222488681e-02   +3.213941553113775e-01   +1.217797118523190e-01   +6.056620485198493e-02   +1.887652056338236e-02; +1.796847965554063e-01   +9.369472784528361e-02   +4.266101622278816e-01   +1.383278009397299e-01   +3.514671892432584e-01   +2.750519193900473e-01   +2.181029200027707e-01   -1.892566673079772e-02];
L3E_L2E_iAMPA_netcon = [+2.976984048597645e-01   -1.872972633105440e-02   +9.377763850306153e-02   +1.303575269150766e-01   +3.995442115999897e-01   +2.301394026479650e-01   +1.286212849297330e-01   +3.566823809506433e-01   +1.319122411100583e-01   +1.099597256988249e-01   +2.637258891721019e-01   +2.677073220051632e-01; +2.756795046095872e-01   +4.058578661169075e-01   +2.003565953357930e-01   +2.330206736647639e-01   +8.327597461765639e-02   +1.298667631951170e-01   +1.343498661572271e-01   +7.197668108019738e-02   +8.074633900197629e-03   +1.604115428920545e-01   +1.293071534003763e-02   +4.814578812004943e-02; +3.846675148559021e-01   +2.060917556119016e-01   +2.674121852500055e-01   +2.995790685053264e-01   +2.543364550740521e-01   +4.112502391088091e-02   +2.767666876113450e-01   +7.705241082251342e-02   +2.181768815877984e-01   +1.905891923638684e-01   +1.606712494096945e-01   +1.266835273772383e-01; +1.388720333990342e-01   +1.734529372390343e-01   +5.108035608836790e-02   +6.497200492172003e-02   +2.271138931188370e-01   +2.332864294254702e-01   +2.162102284307617e-01   +2.061078548243905e-01   +2.429487216662273e-01   +4.140053266670141e-02   +7.844043116606010e-02   +1.065119491938162e-01; +2.544480271330410e-01   +1.716213424703915e-01   +1.180857551181546e-01   +9.576495579304990e-03   +2.143671714572498e-01   +3.249295153636450e-01   +3.316983165655715e-01   +4.956576488810727e-02   -2.352673213653757e-02   -2.789146654082925e-02   +3.701548650077960e-01   +2.479179455577604e-01; +1.619607913819703e-01   +3.312477316282724e-01   +2.471964447695551e-01   -2.983333368470968e-02   -5.983069580056712e-02   +2.452230183603789e-01   +2.055158487953883e-01   +2.509288526468675e-01   +8.070910731732873e-02   +5.193806373067027e-02   +1.703689953159040e-01   +1.031065698689241e-01; +2.046910952042863e-01   +1.619082175088991e-01   +2.520287753928226e-01   +3.057154820191432e-01   +5.418578847394541e-02   +1.513000356408914e-02   +2.356649927023614e-01   +7.772344522485675e-02   +8.638576659803102e-02   +9.778176487036146e-02   +7.501246117343924e-02   -3.641926765070150e-02; +1.289899141294787e-01   +1.973988418217127e-01   +2.826031587295398e-01   +3.090503913645751e-02   +2.304503963228348e-01   +1.394544813602341e-01   +3.193017684562767e-01   +1.764292446006274e-01   +6.001735214702270e-02   +1.001835229791695e-01   +3.601958316051973e-01   +1.481015969538754e-01];
L3I_L2I_iGABA_netcon = [+2.824389784920644e-01   +2.661476504624474e-01   +2.391433258500147e-01   +1.828372739238611e-01   +1.561577688514525e-01   +2.076816103428551e-01   +2.329880833083677e-01   +2.259964355217415e-01   -1.675230517172526e-02   +1.520196555980034e-01   +1.410070627081697e-01   +2.235061104813676e-01; -1.365716140802159e-02   +2.334980188429447e-01   +2.476378723595002e-01   +2.072472945206908e-01   +3.767671995126456e-01   +3.023155278101892e-01   +2.872366772442795e-02   +3.264176052971036e-01   +1.456988130243517e-01   +1.679107108549959e-01   +7.072086732694954e-02   +5.875769644902151e-02; +1.417518709336292e-01   +2.753593909005575e-01   +3.268154392267403e-01   +2.891665704746000e-01   +1.830931291200457e-01   +1.344959492534362e-01   +2.436196243467262e-01   +7.575079688132685e-02   +3.489929829406371e-01   +2.333600186219788e-01   -2.188939648636091e-02   +2.864889646556024e-03; +2.773024746844781e-01   +1.572777355484660e-01   +1.829268880143494e-01   +1.037054982072153e-01   +3.250409894434304e-01   -6.359977152373585e-03   -4.114454200898222e-02   +1.789141332964294e-02   +2.517525264558035e-01   +2.491007308359064e-01   +1.381190789880642e-01   +7.297068820620090e-02; +1.720044325177930e-01   +9.513333363047430e-02   +2.730341338934368e-01   +8.262642998629247e-02   +1.624052863767879e-01   +7.564639988090244e-02   +1.106057369732275e-01   +4.705486424861194e-02   +3.450365944973728e-01   +8.647598296073133e-02   +3.224015975250791e-01   +2.435978160765518e-02; +2.823500794406015e-01   +1.419788707543876e-01   +2.227281262761923e-01   +9.144327613946726e-02   +1.584220378578428e-01   +1.364164024385032e-01   +3.742880333498966e-01   +1.817960878191169e-01   +2.705988164570382e-01   +7.994526215503939e-02   +6.445797679501777e-02   +8.060916548500009e-02; +7.821492223989622e-02   +2.310643526365828e-01   +9.566549377138864e-02   +4.015059507362131e-02   +2.700625926293351e-01   +2.706400277306822e-01   +1.820979226197293e-01   +2.756629529503092e-02   +2.228023257836105e-01   +1.417425163438451e-01   +8.565022525236488e-02   +8.851718568028530e-02; +1.750268791802559e-01   +2.004478159778343e-01   +2.483957034184882e-01   +1.871727382595555e-01   +1.364837866844340e-01   +1.235928948392813e-01   +3.247688652486205e-02   +1.667074814681470e-01   +1.569900802589431e-01   +1.038143693764025e-01   +7.477664063035934e-02   -3.937509419326276e-02];
L2E_L3E_iAMPA_netcon = [+1.185807088590843e-01   +2.629988214016730e-01   +2.695431852067229e-01   +3.877594507831978e-02   +9.270173761932883e-02   +2.101317079692303e-01   +1.841609081072506e-01   +3.917139813587821e-01; +2.992304061723526e-01   +2.223861464386497e-01   +2.503171927425590e-01   +2.176744347802335e-02   -1.096428239323492e-02   +2.735876799215414e-01   +2.231030662810561e-01   +2.531607147484524e-01; +2.202995008472259e-02   +9.898107204219818e-02   +7.591206206744311e-02   +2.817916631176533e-01   +1.695990078502137e-01   +4.602332701404727e-02   +2.789489313616635e-01   +3.621022358874537e-01; +7.986322764114055e-02   +3.940429126166949e-02   +1.067586305454770e-01   +1.562894440537892e-01   +7.954105727293648e-02   +2.270853671744680e-01   +1.096211919473034e-01   +3.164175500064747e-01; +1.949314133873363e-01   +1.879097939894768e-01   -2.008199229555190e-04   +2.824141332313397e-01   +8.452617925159796e-02   +9.333562307417737e-02   -4.613420375473647e-02   +2.250662785726889e-01; +1.772509479254578e-01   +6.543362483139542e-02   +1.596331473125532e-01   +1.554133892370197e-01   +6.317845754032031e-02   +2.118041974313459e-01   +2.762523036789918e-01   +2.186885322414442e-01; +1.900594262431340e-01   +2.726164090902390e-01   +1.856506799847077e-01   +1.490537008472287e-01   +9.871532545570681e-02   +2.884621069354565e-02   +1.723622074453851e-01   +2.619120686492789e-01; +2.320554900582811e-01   +9.644858565102157e-02   +2.500895376931646e-01   +2.657357537208798e-01   +1.688482512417053e-01   +2.293943778073689e-01   +1.657610143690754e-01   +9.673066682721858e-02; +1.247173941513430e-01   +1.951392700346948e-01   +1.765076548801689e-01   +1.690028979734529e-01   +1.825696524888150e-01   +2.183292130991124e-01   +8.244203634367465e-02   +3.611674173480481e-01; +1.088199053573526e-01   +1.120712319326525e-01   -1.435485292088727e-02   +1.072996129461763e-01   +4.601695861915613e-02   +1.924452793009385e-01   +2.965901515864171e-01   +2.544258347263488e-01; +2.031920938270894e-01   +7.543180975812699e-02   +2.688685739257484e-01   +1.952963335384009e-01   +3.469846313149337e-01   +8.810902706084880e-02   +2.508457635589978e-01   +7.633319277650119e-02; +2.808767055255540e-01   +1.462682734464003e-01   +7.879820348176619e-02   +1.076717714842509e-01   +2.422233463530495e-01   +1.605725252162400e-01   +1.669332120574485e-01   +2.196379270492411e-01];
L2I_L3I_iGABA_netcon = [+9.516513901474313e-02   +2.796957090551557e-01   +1.914453858467720e-02   +1.946127015341297e-01   +3.979974888941350e-01   +3.061771845044294e-01   +2.495049230585467e-01   +2.625335749875657e-01; +2.703201776089485e-01   +2.547816899809536e-01   +6.172535145119751e-02   +1.841722867837293e-01   +2.355617395316501e-01   +2.489450857591275e-02   +1.471536560004440e-01   +2.931633801949625e-01; +2.849830754528399e-01   +2.422697683734771e-01   +2.820055038000105e-01   +1.681691400825606e-01   +3.423745797097948e-02   +2.068434794759150e-01   +2.342523323477774e-01   +3.075768112847250e-01; +1.980034412148862e-01   -3.778528823769369e-02   +1.416905427422049e-01   +9.112708832159679e-04   +1.169540352878529e-01   +2.320305186952010e-01   +2.666430076306106e-02   +1.563147697807113e-01; +4.628580927989170e-02   +2.249427663560054e-01   +1.030966461348555e-01   +1.357342066011644e-01   +1.534923253361282e-01   +2.422084702375490e-01   +1.669765301084365e-01   +2.414175011105769e-01; -8.710877895975484e-03   +8.726110679728619e-02   +1.879552948022779e-01   +2.110083116080372e-01   +7.977362017943707e-02   +8.063956365481684e-03   +2.484937751125992e-01   +6.010743011438991e-02; +1.035086675247391e-01   +1.351802948574421e-01   +2.787435592734903e-01   +6.930539465830235e-02   +1.348954142033834e-01   +6.460557795852048e-02   +3.988210939171107e-01   -7.382613746939570e-02; +7.640470753791115e-02   +2.540827529253481e-01   +2.005129251023643e-02   +1.807590169245594e-01   -3.835644579624889e-03   +5.960682885482187e-02   +2.007787296984167e-01   +2.277576589702721e-01; +1.793580609950501e-01   +1.170015987938653e-01   +1.205396616914128e-01   +2.435664314956661e-01   +2.241226960564994e-01   +3.496199675020008e-01   +8.506814673531422e-02   -3.805090992179658e-03; -4.534274487830957e-02   +5.098673490990516e-02   +7.912060517916822e-02   +2.176375146523866e-01   +2.040235874675227e-01   +7.996572211275454e-02   +2.373990477920758e-02   +8.475428365362736e-02; +2.009848575876428e-01   +2.581490517854897e-01   +1.278913772384165e-01   +3.245892412460823e-01   -6.146114588385502e-02   +2.811255074333794e-01   +3.389379062914554e-02   +3.669357017989701e-01; +2.939599742265178e-01   +1.080412752520919e-01   +1.916589899966708e-01   +9.850305493505516e-02   +3.007473603705635e-01   +2.601430737453737e-01   +1.242075376524455e-02   +1.882262544323817e-01];
L3I_L3E_iAMPA_netcon = [+3.132276738771849e-01   +8.839778351431420e-02   +2.484582162190623e-01   +1.506810668279172e-01   +2.557054662509573e-01   +1.244387228987276e-01   +1.427814087986995e-01   +1.423267709453198e-02   +2.229142553947912e-01   +1.277325669324997e-01   +1.071221413615176e-02   +1.313089486526330e-01; +3.347633735784768e-01   +1.346290300441730e-02   +1.571832173217360e-01   +9.986584780463485e-02   +3.194427080248034e-02   +5.396960134216131e-02   +9.057194219954401e-02   +3.233938565438678e-01   +1.987534126856129e-01   +3.121823055850339e-01   +4.310867536799707e-01   +2.400065925797368e-01; +2.741864920186451e-01   +4.175917296132138e-02   +2.613637645688877e-01   +6.534640086276575e-02   +5.582262700526927e-02   +2.644215646257926e-01   +9.706366794132308e-02   +2.061807281394044e-01   +1.257036946468695e-01   +1.256952493887587e-01   +2.998594102965240e-01   +2.143232228277447e-01; +2.313830370890554e-01   -8.944182674126000e-03   +1.703605578727924e-01   +3.187172915712335e-01   +4.415459549820573e-02   +1.093419316825308e-01   +2.498384745049504e-01   +1.313381525163838e-01   +1.260031614610783e-01   +1.696348580645698e-02   -8.257341696058344e-03   +9.772517981001906e-02; +3.042930258785590e-01   +1.470746183982529e-01   +1.684857410772607e-01   +2.160768359379653e-01   +1.384953478695447e-01   +1.123346764385250e-01   +5.228022579310537e-02   +1.421611308300266e-01   +2.377098094758483e-03   +2.727582476291399e-01   +1.809214201982234e-01   +1.686666110837104e-01; +3.906867141269770e-01   +2.526641371417044e-01   +7.794774229626042e-02   +2.036782453093976e-01   +2.730857832966744e-01   +1.684297287896378e-01   +8.959208005125732e-02   +5.026006013653353e-02   +2.100503769685827e-01   +1.611270312890795e-01   +2.291101683682696e-01   +3.573069632614227e-01; +1.312738511133546e-01   +1.647158055847951e-01   +1.285950931036393e-01   +1.609665968774974e-01   +9.507582166041517e-02   +2.128187564506809e-01   +2.200102498277097e-01   +1.555679060392581e-01   +3.318999781495537e-01   +2.716762690164474e-01   +7.736997128791692e-02   +2.306195194346184e-01; +1.995802846391166e-01   +2.932688416742482e-01   +6.688342807655795e-02   -1.038900258276103e-02   +3.406616567197560e-01   +2.395663894317636e-02   +1.269791608611347e-01   +3.169495184325823e-01   +1.830301384151747e-01   +2.912201405898696e-01   +2.086463148521478e-01   +2.689666556047054e-01; +4.750742434480518e-02   +2.990093551581303e-01   +1.084340701488304e-01   +1.975468313371220e-01   +1.908781037215162e-01   +2.364494747257450e-01   +3.173777473741303e-02   +2.629828739077231e-01   +3.130667625808572e-02   +2.044673695455752e-01   +2.016113431641971e-01   -5.125715905805583e-02; +1.130283418316163e-01   +3.693913558439547e-02   +4.288914964369554e-02   +2.117890450064052e-01   +1.241726405653110e-01   +3.266546702131748e-01   +1.172232290194698e-01   -1.731313040187329e-02   +1.991503336277008e-01   +2.662750521226591e-01   +3.331774217489302e-01   +1.622296133862547e-01; +2.192618649099795e-01   +2.667597309087278e-02   +3.276314623133607e-01   +6.704249647456068e-02   +2.022312880762475e-01   +2.018454604183640e-01   +1.419030723003546e-01   +2.859635031751194e-02   +9.903362139258529e-02   +1.743832891002950e-02   +2.386368294904126e-01   +3.054846675153131e-02; +1.726025779936289e-01   -1.118516219586863e-01   +1.046419559625204e-01   +2.130623883176556e-01   +9.438011501869384e-02   -4.666809396925881e-02   -3.537013958081347e-02   +2.056214070713125e-01   +5.550272430253878e-02   +2.108665164860968e-01   -3.963489844784730e-02   +1.367485813790529e-01];
L3E_L3I_iGABA_netcon = [+2.574794712040454e-01   +8.009842420677328e-02   +1.827360241534123e-01   +2.317102711796860e-01   +2.406067088832004e-01   +3.511700338088852e-01   -6.778028393170567e-02   +1.894184260425957e-01   +3.253215469448807e-01   +2.092028031359984e-01   +3.604599635788096e-01   +2.671004248704541e-01; +2.275173107683593e-01   +2.192893701120485e-01   +9.157598428492074e-02   +2.142655358879652e-01   +5.080043628081538e-02   +3.352718585440481e-01   +3.266077838831778e-02   +1.789051029680865e-01   +1.335461689038021e-01   +9.150020655545979e-02   +2.233339147431535e-01   +2.277549570913220e-01; +7.467304501570699e-03   +2.304642155475061e-01   +2.027662352958497e-01   +3.107051694503135e-03   +1.966211807552317e-01   +1.149882898140535e-01   +2.904097454454109e-02   +2.347304740559842e-02   +3.346478935961094e-01   +1.556969690416611e-01   +1.178497016284951e-01   +2.153630720733026e-02; +1.670868132599254e-01   +2.734966523103366e-02   +2.541540254600733e-01   +1.545849937454770e-01   +3.342473420553636e-01   +4.048483799539665e-02   +6.822792280122952e-02   +1.670762328588379e-01   +3.125974727225307e-01   +2.990426314849330e-01   +1.622460898905106e-01   +2.275268373915072e-01; +2.943888948326798e-01   +2.273517832310553e-01   +3.393246382762226e-01   +3.079918359153452e-01   +3.069439775296098e-01   +1.568472819094062e-01   +2.262141566579162e-01   +1.717640193093715e-01   +1.203312327982700e-01   +2.732532977489016e-01   +6.211958484636090e-02   +2.593147404935918e-01; +1.626868634685740e-01   +3.305838762469622e-01   +1.661788858657458e-01   +4.290668548621149e-03   +2.272332213343692e-01   +1.703795736630766e-01   +1.838140770472509e-01   +2.966286230807346e-01   +1.121345914307818e-01   +2.040165568118391e-01   +1.436240563223123e-01   +3.336291521697080e-01; +2.990519948483799e-01   +1.062120384075159e-01   +8.715681496598943e-02   +5.266274600824428e-02   +9.502889964574537e-02   +1.831871942092396e-01   +2.466638669082131e-01   +2.236832267511710e-01   +3.344906922508079e-01   +1.719660335837973e-01   +1.035387036415123e-02   +3.976981575671630e-02; +7.019348948388078e-03   +6.561877538325356e-02   +2.109433971372651e-01   +2.012812960433705e-01   -5.686700681075636e-02   +2.065571919304242e-01   +1.105289377293295e-01   +2.116231148123560e-01   -2.054237458777516e-04   +1.325761198927061e-01   +2.017610739958842e-01   +5.336781218529989e-02; -3.550739820685166e-03   +5.179388694583684e-02   +2.796465392842589e-01   -8.453006821350487e-02   +3.214210848882635e-02   +2.771892342052448e-01   +3.921788533507528e-01   +5.517126259476060e-02   -5.627268562495551e-02   +1.643801897417863e-01   +1.887349602711454e-01   +8.431626422756011e-02; +3.920301358956312e-01   +2.906187906379592e-02   +1.160356809276253e-01   +1.923465521838184e-01   +2.214315362357535e-01   +2.386661995611433e-01   +2.265309421503785e-01   +2.283281961893911e-01   +8.352828848336405e-02   +9.803706455412554e-03   +1.449691511078207e-01   +9.690843529812221e-02; +2.945427148233986e-01   +1.812267417152638e-01   +1.369567737038554e-01   +6.710227705654757e-02   +2.345216628463623e-01   +8.837063132896250e-02   +2.753769856909727e-01   +2.929399628533376e-01   +1.403994912707026e-01   +1.858048815400270e-02   -7.121445383429972e-03   -2.553094182659897e-02; +3.147177470316062e-02   +2.229763079964777e-01   +4.101192615647685e-02   +3.179629311653335e-01   +2.719286282379537e-01   +6.327597280591193e-02   +1.604731409663654e-01   +3.035085162227203e-01   +2.310530963225121e-01   +6.342195417806497e-02   +1.958387919535632e-01   +4.558699551787335e-02];
L2E_Input1_iAMPA_netcon = [+1.386455560283555e-01   +9.676195401013743e-02   -6.376810638819391e-02   +2.484351928546304e-01   +1.293748095012431e-01   +1.030394466525819e-01   +6.723676713222983e-02   +2.171121645086928e-01];
L2I_Input2_iAMPA_netcon = [+3.687035967462139e-02   +7.113461125959991e-02   +7.597611675933664e-03   +1.250370582998890e-01   +1.609621927394251e-02   +1.250866315552837e-02   +1.230520141860274e-01   +6.035574970264260e-03];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.8*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.8*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
