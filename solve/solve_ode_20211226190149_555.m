function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.174523095600435e-02   -9.443056258360301e-02   -4.398143810098008e-03   +2.628697520758458e-02   +1.177205887825251e-02   -3.541343372763310e-03   +6.225836509023860e-02   -8.525387552085779e-02   +2.274139044535517e-02   -8.122217277293414e-02   +2.156641876662261e-03   +3.832498224682047e-02   -6.000035864608468e-02   +6.489448746030131e-02   +1.748599352426840e-02   +8.145110273267066e-02; -9.179149224984567e-03   +4.296622918979347e-03   -4.546341130226222e-02   +5.929865615669656e-02   -1.435533897763547e-02   -5.462320608706813e-02   +5.530622580330333e-02   +4.303828087826443e-02   +1.575075417007511e-02   -5.524730652907168e-02   +1.272150785168805e-03   +1.029502721764721e-02   -1.412613724809065e-02   +5.234718249024910e-02   +7.230659919978524e-02   +6.563708299829368e-02; +4.898123207149714e-02   +1.027931742939801e-01   +3.695530659390521e-02   +3.589990367114872e-02   +5.968965020471044e-02   +2.367138285502033e-03   -7.338084841894223e-03   -5.064342732856014e-02   -1.767656405104799e-02   -1.848223803036573e-02   +2.163462310801263e-02   +2.248576084565275e-02   +6.731007886983102e-03   +6.063324356551752e-02   +7.315296267043807e-02   +3.966092634215407e-04; -7.917186744787481e-03   +1.460318874308616e-02   +2.808354972058987e-03   +8.665837529899605e-02   -1.162722880623520e-03   +7.741361578289203e-02   +8.015174525403815e-02   -4.954884138238651e-02   +3.066948245814096e-02   +2.856833543650469e-02   +1.658604383565631e-02   +9.579157818074086e-03   -3.231560533670379e-02   +4.989410251291656e-02   -1.697252762991655e-03   +2.411012675655660e-02; -4.036201639282537e-02   +8.117233557952501e-02   -6.177349135384946e-03   -3.245008761345620e-02   +2.217544877629601e-02   -5.969677170268403e-02   -1.618187843830067e-02   -1.285058110639912e-03   +3.232960258687870e-02   -7.367458960409173e-02   +4.730779744342059e-02   -3.722208445309065e-02   -4.352721459521661e-02   -3.470027544482759e-02   +2.158065181102992e-02   -1.097395925975824e-02; +6.377270111179707e-03   -6.807566738780805e-03   -1.300430268729728e-02   +7.270616477982758e-02   +1.029197914016905e-01   +1.106106158404933e-01   -7.514146041381131e-02   +2.406765230170741e-02   -3.987550500009389e-02   -1.243364941863344e-02   +4.699963835279478e-02   +3.389166116398258e-02   -2.600633735726169e-02   -3.332624788428645e-03   -1.008092372789415e-01   +4.245395260765531e-02; +8.995462678670751e-02   +6.590531984350147e-04   +5.516925155030979e-02   -2.390394765046023e-02   +1.071322092455361e-02   +8.697897749005799e-02   +4.337381142668147e-02   -2.853112603566463e-02   +7.965020038658477e-02   +3.048983101398366e-02   +7.718588786602407e-02   +8.543557259124820e-02   +1.007976124601578e-01   -5.021139141951107e-02   +1.022484285810323e-01   -1.821297884621217e-02; +2.739876599454036e-02   +1.673016042666344e-02   +7.782864878072475e-02   +5.465649027290116e-02   +9.427967333443016e-02   +4.240481666529223e-02   +1.124379135334243e-02   +9.155775534484713e-02   +6.061662212304383e-02   -1.244734477996429e-02   -1.216421028307512e-01   +1.963995784873761e-02   -4.894916015244659e-02   +9.580241812714171e-02   -5.343732507600778e-02   +1.503806652053317e-02; +1.172491182980526e-02   +1.293463138062605e-02   -1.992670770279399e-02   +1.858225887624244e-02   +3.957645972282129e-02   +4.216819012460726e-02   +3.045847953162940e-02   +5.064523886026059e-03   +4.842063407565021e-02   -2.878711983498976e-02   +8.441736199852880e-02   +1.083159932386210e-01   -2.376775538322130e-02   +1.410982038354977e-02   -9.344773699819452e-02   -2.494544031841301e-02; -4.006408986610777e-02   -4.857310849230011e-02   +2.625241692481809e-02   -1.057016394012448e-01   -1.856639138281498e-02   -5.898002933996772e-02   +3.227561330829709e-02   +3.958266981825213e-02   -4.314961888531649e-02   +9.440790925836492e-02   +1.159896249631894e-01   +6.919031190508337e-02   -7.122782841528794e-02   +4.659661703497335e-02   +5.534633964601411e-02   -5.355698925503687e-03; +3.933214875511219e-02   +7.005117143056840e-02   -1.357208910438222e-03   -3.489879868064084e-02   +9.369835368438841e-02   +5.470471893796053e-02   +1.590701644004584e-01   +2.423967721749282e-02   +4.859277063379663e-02   -2.792232704466226e-02   +7.090245985517973e-02   +4.473622230475676e-02   +2.276656987589427e-02   +4.217111789265447e-02   +5.648257232599875e-03   +1.816884467233801e-02; +6.235837275727518e-02   +4.827448153039468e-02   -4.012924574819308e-02   +3.284451290090653e-02   -3.446390684791567e-02   +8.293984115262308e-02   +7.242740407143594e-02   -8.751491933239177e-03   +7.972200043064193e-03   -3.146938604643842e-02   -3.113554772061686e-02   +2.011624078336487e-03   -2.484766317001672e-02   +4.287361109619209e-02   +7.229632225806162e-02   +6.882840246031674e-02; +1.026456099932922e-01   +7.501487354469788e-02   -5.015074826472220e-02   -2.161267400883548e-02   -1.823979815554239e-02   -1.766218915007686e-02   +7.387326868539164e-02   -1.803329764344284e-02   +6.100692881275981e-02   +2.015681737606972e-02   -1.796008348844041e-02   -3.647584796448619e-02   +2.775847081764648e-02   -1.360582933670958e-02   +4.969939697936539e-02   +8.526397602153370e-02; +7.673431814981511e-02   -2.827691785793977e-02   -1.978397293231057e-02   -6.599378844058057e-02   +3.264863450977526e-02   +6.381884669418383e-02   +6.812945128527144e-02   +8.879289530538204e-02   -7.395332196053800e-02   +4.746764102669360e-02   +9.255249289915619e-03   -5.106678414880573e-02   -6.568646686345928e-02   -1.806505442263662e-02   +5.723428423161768e-02   +8.895932462372372e-02; -1.305458619861701e-02   +3.746206619055787e-02   +3.673743080080429e-03   +1.246949369922660e-01   +6.667116614488566e-02   -1.759523720951813e-02   -9.422356063939723e-03   -4.907342114334398e-04   -1.080929628382064e-01   +3.552228454641391e-02   +2.492123108827897e-03   +5.679628911385267e-02   -8.849082749484063e-02   +4.560542100777071e-02   +3.061930588865014e-02   +2.113595832130183e-02; +6.140479539505884e-02   +4.818017588523384e-02   +8.931759360596384e-02   +1.174607187062714e-01   +6.386558412689933e-02   +8.283569545477729e-02   +7.548348377324302e-02   +3.590746677364684e-03   +3.646867513708460e-03   -6.924568898001748e-02   -3.273894542016095e-02   +4.814912911262048e-02   -3.825413187561927e-02   -5.662326554731881e-02   -1.376201246809163e-02   +6.095292217721407e-02];
L1E_L1I_iGABA_netcon = [-8.551634436474001e-02   +2.675765853885354e-02   +6.774237849950966e-02   +1.326496106567256e-02   -6.664531806610041e-02   +7.057368396596075e-02   +3.033909069285588e-02   +5.395094608237347e-02   -5.817895751024818e-02   +4.798663373370649e-02   -3.772643984330300e-03   +3.403675798500871e-03   +7.993135814386779e-02   +8.361533261018976e-02   -5.747030206745985e-03   +9.565986798361920e-03; +9.635914846003057e-02   -2.919736098189880e-02   -3.849784176918036e-03   -4.612031545195665e-02   -5.656372660773103e-02   -5.555530209733149e-02   +8.365271482427315e-02   +3.538477263503324e-02   +2.524576823478151e-02   +2.750109152462842e-02   +9.940047452871234e-03   -4.100717721123326e-02   +1.511997058797644e-02   -5.719067815484085e-02   +4.360357111977994e-02   -3.428055325867620e-02; +3.443128458261523e-02   +1.378641030304200e-02   +1.955553805655555e-02   +4.083312292685699e-02   -5.139962302657586e-02   +3.789426613078758e-02   +1.059422186818802e-02   -1.312118377316664e-02   +8.662896766028137e-03   +6.243927077253054e-03   +2.970285590779104e-02   +1.691849184142008e-01   +9.542884882995337e-02   +4.370840648139931e-02   -4.398102764970609e-02   -2.445884763958475e-02; +1.171995339604840e-01   +1.316221231970495e-02   +5.680876579186368e-02   -4.424934842108649e-02   +6.842934941118201e-02   +1.743606957712290e-02   -5.963032573836853e-03   +4.195067081222045e-02   +4.751558151318729e-02   +2.881384248127424e-02   +8.921939540629874e-03   -7.137807628971506e-02   -4.206996647346822e-02   +4.794430484496449e-02   +7.364391272228009e-02   +1.843332791729467e-02; +4.445421667885145e-03   -1.439893301570891e-03   +5.166651876463201e-02   +4.003788227707432e-02   +1.107242838814665e-04   +3.102680309015320e-03   +6.937258766408602e-02   +6.519389880056108e-04   +4.832467890902817e-03   -3.247789122299460e-02   -2.643653170445177e-02   -6.325250480081927e-02   +7.527872047217764e-02   +3.412137972433221e-02   +1.005894189782712e-02   -7.144556474744553e-02; +3.773701032225518e-02   -5.162327311618575e-02   +6.008090170203375e-02   -1.112624517969545e-01   +3.180774078308354e-02   -2.281184860191683e-02   +7.421583743181545e-02   +2.953579112182624e-03   +3.942941678847789e-02   -8.145800265515556e-02   +5.114414626721605e-03   +8.544419109011809e-03   -7.130229581802927e-03   +1.405359697127889e-02   -3.942275675211983e-02   +3.196123307506163e-02; +2.692592331084835e-02   +4.520860170978780e-02   -3.205023612728368e-02   +6.255819294247800e-02   +1.097797166790388e-01   -6.433462377403276e-03   +2.885731038286921e-02   -2.869417263828398e-02   -2.711800007452863e-02   +6.775601969036903e-02   -2.441300537703266e-02   -4.294278383480615e-02   +8.948073773878568e-02   -4.484256041315871e-02   +1.465346174162416e-02   +2.463422104545106e-02; +1.039205580582677e-03   -1.326549189702250e-02   +1.599514058312549e-02   -1.735922741324620e-02   -4.016179662839868e-04   +1.382457068452007e-02   +1.026242917201223e-01   +1.363475969091864e-02   +2.752406184836883e-02   +5.695488039545368e-02   -2.540158197551345e-02   +4.375356660108193e-02   -3.128598750092271e-02   +2.267700787784918e-03   -3.326450224334787e-02   +8.301047883860511e-03; +1.189776433093688e-02   -1.256833727355134e-02   -2.787298722853616e-03   +5.366511932854213e-02   -2.343191114967758e-02   +6.500157645218463e-03   +8.993089393325487e-02   +1.143920035599062e-02   +4.475004705841026e-02   -1.218132450269136e-02   +1.562823604991040e-03   -5.796934530319990e-02   +6.443087719499760e-02   +4.329885720699615e-02   +8.326599590486725e-02   +7.148742829955237e-02; -6.838528610398927e-02   -4.143326897392123e-02   +2.733371798322162e-02   +8.002623966103044e-02   -3.804006672603323e-02   +1.027710956148800e-02   -1.623766031513254e-02   +4.532663343520650e-02   -8.352253680890587e-03   +3.909523117925719e-02   +5.158356844117284e-02   +1.079886419916482e-02   +4.919659830143543e-02   -1.077693452057633e-02   +6.580519766487050e-02   +3.838253010102277e-02; -1.633896227390556e-02   -3.084437218584328e-02   -4.590315193367951e-03   +4.798252630611184e-03   +6.958667375781335e-03   +7.482537325014931e-03   -1.959370663501784e-02   -3.272818022364637e-02   +6.226815741971298e-02   -1.263626771568951e-03   +5.446433779213775e-02   -2.508727104936083e-03   +1.395299710894717e-02   -8.737425293177135e-03   +6.749258509790355e-02   -4.025728827860765e-02; -2.467761440202071e-02   -8.261570930373411e-03   +1.712180053109835e-02   +2.737473990199125e-02   -5.950194883128884e-02   +5.564778730951166e-02   +2.350508019831843e-02   +9.302953285221183e-03   +3.222704273396774e-03   +6.551689844902665e-02   -6.185055052631738e-03   -3.767543356882308e-02   +8.641378694537181e-02   +7.710455165622199e-02   +6.262443344903338e-03   +4.031073166454943e-02; +7.028921187177921e-02   +3.695355338124839e-02   -2.985315052492429e-03   -1.645287072831539e-02   +6.023765920353173e-02   +2.659840997815388e-02   +6.775315500338359e-02   +8.829145977439730e-02   +1.073366426651542e-01   -8.715945468541968e-02   -3.069238483973915e-02   +5.192574123365864e-02   +1.251778092139731e-02   +2.807258889685528e-02   -4.866484382238061e-02   -3.248983895015198e-03; +1.474480486810189e-01   +5.238400969621015e-02   +3.561011017892147e-03   -3.929344643491222e-03   -2.984702209888896e-02   +4.047444471862023e-02   +9.255866242349071e-02   -2.336084469509295e-02   -6.066733661459682e-02   -5.766253368848137e-02   +2.278616602725293e-02   -4.378965000513353e-02   +3.209199474155471e-02   -6.473921158651123e-02   -3.611485103572560e-02   -9.270678499037649e-03; +1.670302136072255e-02   -3.860290687831366e-02   +2.918188283086628e-02   -5.448177425434473e-02   +8.713483364840357e-03   -5.430009798535425e-03   +1.597144800192506e-02   +1.474777698853894e-02   -2.406011585933957e-02   +9.533687618445114e-02   +4.472475929306145e-03   +8.562720880166860e-02   +6.738181146187104e-02   -1.208869481754030e-02   +7.722503195562010e-03   +4.574249007988768e-02; -4.589252022199335e-02   -1.154098991269212e-02   +4.663080092092758e-02   -5.351163222578795e-02   -4.735640069923261e-05   +1.114636459500715e-01   +2.314178356660543e-02   -2.622522557643996e-03   +1.353950586134291e-02   +8.391624008956371e-02   +1.164759465256119e-02   -1.265773846037716e-02   +2.336019653323592e-02   -5.542941389369218e-02   +3.754489714056127e-02   +7.797837752325194e-03];
L2I_L1I_iGABA_netcon = [+5.285409589332125e-02   +1.719716191001425e-02   +1.242488398389291e-01   +5.385521486700037e-02   -4.901605823544791e-02   -7.909058898614654e-02   +6.102955025287004e-02   +6.132337318676129e-02; +7.197981803775981e-02   -4.235980167824477e-04   +6.942569241298815e-02   -5.908892527443885e-02   +7.612097390790057e-02   +3.044412605734136e-02   +3.218796010344624e-03   +2.486922454406868e-02; -4.763637812313212e-02   +2.402335561865467e-02   -6.884749783065877e-02   +6.575026586665778e-02   -3.442423359869326e-02   +2.951895736750191e-02   -1.081096451529200e-03   -1.880676656747841e-03; +1.959422444439441e-02   -6.575222592007195e-02   +6.553740324046023e-02   -5.294560257390085e-02   -9.977533773728372e-03   +5.819516656572220e-02   +4.942632707846153e-02   +1.380448587512988e-01; -5.903932355464823e-02   +3.435025447913685e-02   +6.441140389460949e-02   -3.072883204293532e-02   -4.237914315568678e-02   -2.265364514491920e-02   -4.660323194100224e-02   -7.134341359347346e-04; +1.655100337684519e-02   +7.760989762084772e-03   +4.982953590934557e-02   +7.114705065622534e-02   +2.266163685409947e-02   +4.395011765497386e-02   -5.579709099756318e-02   -3.106602845425446e-02; +5.961442931226141e-02   -5.367116596181293e-03   -3.615483331873616e-02   +4.513908615468002e-02   +5.735671597671563e-02   +2.474620534973879e-02   +5.657399652337691e-02   +3.206570498470238e-02; +6.740580009330530e-02   -1.784119345284090e-02   +1.842424997923901e-02   +1.109512842322740e-01   +9.592123024971413e-02   +2.375171832403637e-02   +6.608951307087396e-02   +7.368847434094969e-02; -1.109859792433992e-02   +2.029044172590835e-04   +1.473018824467925e-02   -2.081041865291015e-02   +4.763998510697932e-02   -1.213441104483749e-02   -1.858810394917337e-03   +1.304247610741781e-01; +1.786937793876685e-02   +2.302470168859524e-02   +1.775064285114077e-02   +4.513832478904718e-02   +3.019087307950695e-02   -2.179122572872074e-02   -7.423091042551183e-03   +1.320528795109306e-03; +1.141299380759891e-03   -4.132658159826845e-02   +2.294859777068491e-02   +4.831411164429773e-02   +1.800654133579641e-02   -3.150382121744803e-02   +3.115977260722114e-02   +4.666267431118182e-02; +7.815270873050709e-02   +7.640299633996267e-02   -3.029230900755854e-02   -4.756328285283028e-02   -3.502800180905295e-02   +1.918412774249477e-02   -8.476409714026561e-03   +1.668652688671986e-02; -3.254154908444624e-02   +2.539145264383473e-02   +1.051005195224699e-01   +5.781496443492262e-02   +4.592731293036025e-02   -2.424691105079880e-02   +8.369992909161805e-02   -2.298998368507145e-02; +1.062328212436973e-02   +1.275229132266954e-01   -5.885614036855993e-02   +3.880328141798656e-02   +3.134336311394723e-02   -2.916409076562971e-02   -5.066054699058860e-03   -4.396232674981787e-02; +3.204850373228986e-02   +5.120559514973654e-03   +4.838049526993975e-02   -1.673950894710982e-02   -3.157615698733426e-02   +2.877660090751737e-03   -4.132739310249578e-02   +1.013561503536933e-02; +4.381322528600647e-02   -3.894694004252217e-02   +7.477013064889871e-03   +3.794325945250313e-02   +1.320840160178630e-01   +4.226850139531278e-02   +5.683271331252560e-02   +7.888443485772417e-02];
L1I_L2I_iGABA_netcon = [-2.473360225691217e-02   +6.679032539150451e-02   -5.819122863964987e-02   -4.473410700416728e-02   -5.797711006021403e-03   -6.553183968037547e-02   -1.999172705023480e-02   +5.613396267902873e-03   +5.490523363828226e-02   +4.189398881636298e-02   +5.969548031734001e-02   +3.249628816520796e-02   -5.669055600225682e-02   +5.069232824237357e-03   -8.669376120183165e-03   -1.537572613279262e-02; +1.828743652678922e-03   +2.897967992294306e-02   +9.940816361442086e-02   +1.008755130448482e-01   -1.071399575881726e-02   +2.163046552962462e-02   +1.370083897189157e-03   +6.884835347826510e-02   +6.521936601501042e-02   +3.674805311396409e-02   +2.442484700476452e-02   -5.748875222829250e-02   +2.976767361973887e-02   +2.561126166352802e-02   +5.042906256289563e-02   +7.712364210557569e-02; +1.186931316421399e-02   +1.912093325755413e-02   +6.261126774584959e-02   +6.029012820236643e-05   +8.354856622970341e-02   -4.533128834112552e-03   +3.331513609129742e-02   +1.760124966816812e-02   -2.171882337739326e-02   +2.938694492550520e-02   +1.235469346312852e-02   +6.227624927569220e-03   -3.055846038040943e-03   +3.423801272960219e-03   +1.694566290832015e-02   +5.107181967777841e-03; -3.439984985644455e-02   -1.729085691426170e-02   -7.978741261818396e-02   +2.292876927380523e-03   +2.236916043765317e-02   +1.025768930896827e-01   +4.822382888830562e-02   +4.903295659767229e-02   +4.486979474242143e-02   +4.098621275208007e-02   +5.632457522372480e-02   -1.332935850451037e-02   +4.830900878689953e-02   +2.676106441093796e-02   +5.783207488837998e-02   +9.098314677439129e-03; -1.085247807224406e-02   -4.024777159845339e-03   +6.733074504673008e-02   -5.688112547874440e-02   -5.275124391783962e-02   +2.931971879654348e-03   -6.672661446521692e-02   +2.757080114982754e-02   -8.054511420633046e-03   +2.222368046337058e-02   +5.290203603384794e-02   -1.163648296200456e-02   +6.711891957972992e-02   +4.916652617321705e-02   +6.466488772415685e-02   +7.585180276029871e-02; +5.031160998956222e-04   -3.454787014130174e-02   -5.357106842798763e-02   +8.630689420083154e-02   +7.736281856747086e-02   +6.858589289175814e-03   +3.095324700674754e-02   +1.826514544123797e-02   -2.169263243460339e-02   +6.905677195399468e-02   -1.823690336364308e-02   -1.945341920570144e-02   +6.999734673123256e-02   +1.099368051093921e-01   -5.987384813167713e-02   +6.455175541543352e-02; +1.185485848277776e-02   +1.822562233704544e-02   +4.048076016309229e-02   -5.490046677825035e-02   +5.287099883686742e-03   -2.844550372804554e-02   +1.960758669953462e-02   -1.006072829349541e-02   -6.816083819362430e-02   -9.236757794633707e-02   +1.083384428924131e-01   -1.842105948344748e-03   +9.320905699905499e-03   +2.180940254919267e-02   +2.983397480759001e-03   -3.481704389812017e-02; -2.831652256620755e-02   +8.440306531212992e-02   -2.202859673775417e-02   +3.650940544620153e-03   +6.682396875797132e-02   -4.537907711615280e-02   +7.432562487064814e-02   +6.999001166972366e-02   +9.066956450336372e-02   +3.365577312234438e-02   +1.066437081098479e-02   +1.501777602819113e-02   +3.256851824878020e-02   +7.250241446259395e-02   +2.051152261314751e-02   +5.968065674134043e-02];
L2E_L1E_iAMPA_netcon = [-3.424690554349046e-02   +7.139056430062443e-02   +7.215046946546982e-03   +1.322519904412549e-02   -6.223495736361001e-02   -6.283138134925080e-02   -1.993464505502174e-02   -6.098835991405931e-02; +4.052606848120489e-02   +1.211675337990305e-01   -9.166675350904757e-02   +2.016978541567280e-02   -1.560055268173364e-02   +1.930849238147374e-02   +4.448367229431819e-02   +2.680770251013375e-02; +4.866364231962615e-02   -3.261232629292585e-02   +1.471800522318197e-01   +8.954435553242059e-02   +6.395402812168317e-03   +6.733998651716364e-02   -2.110918729504799e-02   -5.863592743171175e-02; +7.120878359814023e-02   +3.962803228686358e-02   +7.499367280739656e-02   +4.324356840892189e-02   +4.978664896253246e-02   +1.409001854401293e-03   +4.475318723609832e-02   -4.243287482023105e-02; +1.311430043368855e-01   +5.675756915745508e-02   +7.939992079802674e-02   -4.195234380168392e-02   +2.682799672706562e-02   -2.587680143781458e-02   -1.947698544637119e-02   +6.052861977097338e-02; +3.767813661551527e-03   +1.013790165620106e-01   -1.004991794739923e-02   -3.965356909222277e-02   -5.071700294821064e-02   +1.058584769782046e-01   +9.667610475197684e-02   -5.273019383629492e-02; +1.169945128225738e-01   -5.295933254330667e-02   -6.035673420967425e-02   +6.430368930835092e-03   -1.223459656187637e-02   +2.722298706257778e-02   +8.616151654400156e-02   +1.133449162553767e-04; +7.226822128129862e-02   +4.366972327592502e-02   -5.514684295371315e-02   +2.111849573094899e-02   +6.557691443666959e-02   +1.601102909671221e-02   +3.115084245746248e-02   -5.165839370092923e-02; +6.820435228497543e-02   +1.196268798168150e-03   +5.940138535252419e-02   +3.161562229232451e-02   -4.430081646166042e-03   +6.255153734730788e-03   -2.154052389970468e-02   +1.438874465427684e-01; +2.381959065585705e-02   +7.726364890757029e-02   +2.075884683984090e-02   +7.177410935060757e-02   +1.206017815734199e-01   -6.887947751759721e-02   -4.119432540375913e-02   +5.885060233554992e-03; +4.127975986326528e-02   +6.536044350956262e-02   +2.543333050598583e-02   +8.738359306252675e-03   +1.522362017304979e-01   +2.208045449321581e-02   -2.829035465415182e-02   -6.518899026870759e-02; +2.683453161450464e-02   +1.219712685414297e-02   -6.436854607374837e-02   +5.496156774643333e-02   -2.920826592929839e-02   -2.195037659540647e-02   +1.155110044491434e-02   -2.134278321315808e-02; +8.943233231701159e-02   +1.123653031809863e-03   +2.885664429878576e-02   -1.818767128307303e-02   +6.293839950768902e-02   -6.317874921719811e-02   -3.567547814163702e-02   -1.448290751595530e-02; +8.306099603574400e-02   +4.602125265445658e-02   -7.469159753127799e-02   -3.750515923662386e-02   +4.741458884128617e-02   +7.242480315559376e-02   +1.714274221332055e-02   +1.774049279058916e-02; -6.518836828643582e-02   +7.194546759848816e-02   +3.033343575115646e-02   +1.150596099002866e-02   +1.442631934927234e-02   +7.046009260580171e-03   -3.132755363795029e-02   +5.365738335199516e-02; +2.677595051648973e-02   +4.408499207296327e-02   +1.702826121987003e-02   -6.294014942112369e-02   +4.898665808237248e-02   +5.700529271239455e-02   +1.893852847499326e-02   +8.401910878134730e-03];
L1E_L2E_iAMPA_netcon = [-7.955577094796905e-03   -2.335764494670031e-03   +1.192262262709781e-02   -8.260530466719226e-02   +4.209577836246645e-02   +6.573994697198074e-02   +5.982957824744316e-02   +6.521923620905182e-02   +3.977486887996895e-02   +1.769350335127689e-02   -1.971318611102576e-02   -7.130732106228088e-02   +7.285736685020570e-02   -5.667633520538887e-02   +1.451266948143841e-01   +3.777833097366887e-02; +7.679604386770676e-02   +1.184100189804472e-02   -4.211355369226628e-02   -4.728145461524117e-03   -1.337754925678428e-02   -6.923176373186626e-02   +4.742615875546770e-02   -9.919146533995695e-03   +2.499994635743217e-03   -4.613067815593896e-03   +2.542559181188307e-03   +4.119829858068158e-02   -2.059698290877704e-02   +5.801587580327595e-02   -2.903528163659661e-03   +2.079444440762552e-02; -1.715795324174587e-02   +3.712766965811762e-02   +2.217964217568921e-02   -4.559654934791382e-02   -9.534864626753210e-02   +2.208717871952473e-02   -7.299283622933189e-02   +4.583426529403770e-02   -6.060281598309937e-03   +1.031871098622273e-02   +9.108391521001942e-02   -1.974617589263605e-02   -4.248436670510868e-02   -3.240259659157484e-03   +6.461760371768152e-02   +8.042786706558501e-03; +3.347315278758219e-02   +8.442070967467832e-02   -2.940009510215150e-02   +6.087116713829072e-03   +7.840056743983945e-02   -6.073808324171626e-02   -2.041139131309093e-02   +1.490700540663040e-02   +7.917821623566182e-02   +9.469324962431555e-02   +5.759689480344413e-02   -6.374087504410100e-02   +1.224263976222573e-01   +4.651164235533627e-02   -1.359610131860925e-02   -2.982127677783367e-02; -1.557108595930115e-02   +1.401654307772033e-02   +2.634786364910702e-02   +3.202800408575912e-02   +1.335451711601828e-02   -1.491917374368395e-02   +2.918402995573466e-02   +3.582029164446522e-02   -2.613943634762018e-02   +5.364666064565259e-02   +2.354014189185035e-02   +9.500133713666897e-02   +3.363131338251017e-02   +1.329892652995200e-02   +3.373540329523975e-03   +3.342201448488485e-02; +2.490342349848204e-03   +1.512965940021339e-02   -1.175781393734465e-02   +3.005856689724138e-02   +2.780299142002912e-02   +5.194408196533574e-02   +3.633305212696859e-02   -4.668070250764305e-03   +8.184822173611779e-02   +3.164175723854671e-02   +5.622607006173930e-02   +4.556541336086394e-02   -1.797312446008343e-02   +3.150433938025687e-02   +1.132281477756396e-03   +3.554542944435286e-02; +8.514809428269909e-02   +4.845769229741972e-02   -5.385115692880714e-02   -4.796780558277958e-02   +3.243523336236748e-02   +1.025237586976206e-01   +3.616699305712405e-02   +4.040560917196868e-02   -1.463484167741508e-02   -2.989664545612969e-02   -9.822120589194025e-03   +1.465543913953694e-02   +1.499143032925747e-02   -8.973293236458935e-02   +4.822234222924961e-02   +6.135508551216091e-03; +7.262676045138901e-02   +6.894137313359046e-02   +5.619588941035004e-02   +1.036826220222360e-02   +5.548412681824082e-02   -1.374046101404199e-02   +3.056660616903630e-02   +1.353925677738969e-02   +1.194327256501636e-02   +4.893664921997215e-02   +1.366233554569146e-01   -6.230126243153785e-02   +1.835079115269146e-02   -2.544670826937488e-03   +4.679958304571675e-02   +9.554613027857294e-02];
L2I_L2E_iAMPA_netcon = [+1.734613007063154e-02   +1.309065086683391e-02   +6.127153944492841e-02   +2.767484798693499e-02   +3.683674798350420e-02   -3.312230482083973e-02   +6.629806886100299e-04   +7.146216319713108e-02; +4.223415602848025e-02   +6.833037173039638e-02   +3.987368500355723e-02   -4.955007299655855e-02   +5.473923282167344e-02   -3.052596029812151e-02   +5.338243600445510e-02   +9.464547025087311e-02; +3.556720067888315e-02   +2.191342858946746e-02   +2.557471168403410e-02   -5.072371099625247e-02   +2.788668967972011e-02   +6.657120416435780e-03   +4.900730491553777e-02   -1.163270084241878e-02; -7.888669060070685e-03   +5.023451250971715e-02   -5.342898739513289e-02   +5.290232112245540e-02   -1.038891553056198e-03   -3.519970871787410e-02   -4.681894692661392e-02   +6.989049546614229e-02; +1.581688451546607e-01   +9.539794278275998e-02   +1.474006454372415e-02   +3.278420905445938e-02   +8.558019587942606e-02   +8.749851849281029e-02   -9.728794106149029e-03   +8.075592008378718e-02; +3.015146924760743e-02   +3.417043870395639e-02   +2.838635586961742e-02   +1.446052287553526e-02   +1.433532896492064e-02   +5.626664530706406e-02   -2.599199590270902e-02   +3.881038759617288e-02; +7.014925845112957e-02   +7.732721150507618e-02   +2.490252627932510e-02   +4.792286151733791e-02   -5.957280245004835e-02   +6.865252921601149e-02   +1.191436842823685e-01   +1.802110974620185e-02; +1.025763446214612e-01   +8.011352808401422e-02   +8.396210961980437e-02   -4.943103936707690e-02   +1.385654374816806e-02   -4.715126085030440e-02   +3.908504166572612e-02   +6.747601285916520e-02];
L2E_L2I_iGABA_netcon = [+7.648211417827003e-02   -1.586823286787292e-02   +9.226503325806942e-02   +4.244519190874063e-02   -8.239650338272130e-02   +4.468271538096679e-02   -2.793866290212660e-02   +7.143665121606740e-02; +3.580096390203218e-02   +8.005249370702827e-02   +1.628815799305901e-03   +2.523231823955006e-02   +2.478025053599889e-02   +8.121395788145741e-02   -2.829840471249471e-02   -3.247001370263601e-02; +3.526196366085640e-02   +4.674920654792351e-02   -3.697162708626584e-02   +5.851115180290430e-02   +3.486297761690288e-02   -3.346544896572408e-02   +3.673590048407277e-02   -1.002075524215281e-02; -9.122138862791571e-02   +2.758588362757537e-02   -4.936531031480809e-02   -1.681938698293692e-02   -5.372025552519102e-02   +4.497019276088417e-02   +1.403415237384997e-02   +7.729171090183069e-02; +1.910005844586911e-02   +6.847314419808495e-02   +2.450145963266941e-02   +2.059875955485775e-02   +1.175428838315703e-01   +5.783795514798142e-02   +5.170208007194892e-02   +9.124341766102156e-02; -3.196979964073871e-02   +1.417524096535748e-03   +4.475936823313854e-03   +6.543012690596341e-03   +1.151435261640636e-02   -2.230973746311465e-02   +4.921608097926225e-02   +8.583023511253568e-02; +1.074070593203964e-01   -1.189372863708637e-01   +2.248540170310773e-02   +3.316064091105209e-02   -1.574870810311126e-02   -1.326820859838644e-03   +8.587929191563759e-03   +1.215395277411013e-02; +5.694399286429819e-02   -2.461124215666389e-02   +3.641311807184663e-02   +5.663020686735008e-02   +2.473885093318052e-02   +8.050587697831779e-02   -1.563233480123650e-02   +3.563026183112357e-02];
L3E_L2E_iAMPA_netcon = [+3.142959422926567e-02   +1.962058120874709e-02   +2.998081399395044e-02   +2.850863944170485e-02   +5.823458203311166e-02   +6.243568340303569e-02   +7.317683377428510e-02   +8.655459467513084e-02   -1.251871536992521e-02   +2.460898427717471e-02   +1.147180055253724e-02   +3.139231388552403e-02; +8.895426477823744e-03   +3.246746971066396e-02   -6.781073498878207e-02   -6.050904678334776e-02   +5.077852358356781e-03   +4.382668015553325e-03   -2.601131319178669e-02   +3.515834627740089e-02   +3.606149192958504e-02   -4.298053336318236e-02   +4.662838715070439e-02   -2.218780310154083e-02; -7.776321608633034e-03   +1.782481620049382e-02   +1.744746272360690e-02   +8.270585235892310e-03   -1.823976956631827e-02   -4.962707643653593e-02   +5.687730939638812e-02   -5.839294075073310e-02   +2.702190071662586e-02   +1.272421344005412e-02   +6.567148684161785e-02   +2.317875814912426e-02; +3.723451871060440e-02   +1.358165865336133e-02   -5.914140542220683e-02   +1.175016762837990e-01   +6.974634382945376e-02   -6.217937543075435e-02   +2.162160597119202e-02   +7.788595743581178e-02   +1.707091431507020e-02   +5.132502046287786e-02   +1.234391669214657e-02   -2.961650472128151e-02; -1.853942540232618e-02   +3.415210856969179e-02   -1.540571661464379e-02   +7.166292483884767e-02   -4.277075651043073e-03   +2.708551729639461e-02   -1.428256022360071e-02   -1.009938868540643e-01   +4.381320976536720e-02   -4.048711515811982e-02   +2.919276987818734e-02   -7.729697880244434e-03; +2.290938463146144e-02   +4.553826578976566e-02   -5.726217874014896e-02   +2.400943858354536e-03   +8.059651420971489e-02   +2.265721832987742e-02   +6.209734627524632e-02   -3.746591915411712e-02   +5.032782048196988e-02   +3.220016196288685e-02   -1.637097602566191e-02   -8.567214848540641e-03; +6.686070560274672e-02   +7.281216600093116e-02   +3.175949624624377e-03   -4.318151184802294e-02   -7.017287121118124e-02   -1.526810642113794e-02   -1.601128060800410e-02   +9.970202444471088e-02   +6.427249067726407e-02   -3.678017728485758e-02   +4.899696585809861e-02   -7.372993996034841e-03; +9.491876781657702e-02   +7.265903664107592e-03   +8.522300380426697e-03   +5.851427650819901e-03   -3.872556190103940e-02   +5.659910930984865e-02   +2.931974576147726e-02   +7.463010940580109e-03   +2.352562128997942e-02   +1.423396899876475e-02   -6.576882889481845e-03   +6.466908321348157e-02];
L3I_L2I_iGABA_netcon = [+2.896989861069121e-03   -7.482873880743101e-03   +3.036098085498379e-02   +8.519103596314057e-02   -2.391912075455663e-02   -3.139483021488778e-03   -5.087496157103018e-02   +1.001754537060368e-02   +3.081330095270975e-02   +3.121338628279056e-02   +4.048181544636527e-02   +6.327733598713606e-02; +8.767074299422349e-02   +3.513365170533984e-02   +7.389554701628881e-02   +5.371265359770304e-02   +2.453378511043135e-02   +2.211960554588941e-02   +1.255531956150954e-02   +3.912143001417779e-02   -8.490906760607768e-02   +1.317177224399053e-02   +1.127452416148454e-02   +1.242063455439824e-02; -1.845132752797724e-02   +3.024689060487914e-02   -4.537359570104824e-02   +6.011469554776146e-02   +5.923419745215480e-02   +3.170202748755305e-02   +3.473729658774268e-02   +2.081791058584747e-02   -1.253573550251055e-02   +6.112626819689036e-02   +2.954768791037002e-02   +1.527858150288416e-01; +5.738758924845537e-02   +5.147545730003225e-02   -3.616096395011188e-02   +4.905454566401336e-03   -1.253054659420390e-03   +7.271405691520640e-02   +7.929903155277404e-02   +4.527277340276125e-02   +2.606217942571007e-02   +1.467482432831620e-02   +1.443055608209528e-03   +5.218994978829821e-02; -2.643156097273038e-03   +6.259923532964501e-02   +4.439861784515489e-02   +1.186922666076389e-01   -4.071052305238404e-02   -4.900935989560908e-02   -3.370870531562646e-03   -1.042452159716465e-02   +1.720991762102822e-02   -8.378695498518328e-02   -2.772057558645130e-02   -1.304103053041088e-02; -8.703924221842657e-02   +3.363278579045324e-02   -1.821542692425803e-02   +5.120168379833440e-02   -6.693501012254570e-03   +1.849793518645570e-02   -3.847197944715151e-02   -4.434849450133116e-02   +5.493393787975762e-02   +7.004984851933436e-03   -1.008156494581558e-02   -6.624062436987715e-02; -2.067158702465679e-02   -1.637266669391501e-02   -6.531857574787227e-02   +6.917171256436666e-02   -9.668186156082453e-03   -2.065247491587237e-02   +7.819236674846823e-02   +8.244176373945429e-02   +9.753329178022230e-02   +8.183511073334546e-02   +1.123049523929447e-01   -2.355414047417443e-02; +1.538102806562100e-02   +2.034416873139934e-02   -3.281940287103213e-02   -5.524755396438065e-02   +4.622538097488637e-03   +3.304513847910889e-02   -3.661877738693871e-02   +8.640687367025862e-03   -6.279154230815931e-03   -9.531981775344772e-02   -9.663248397480159e-03   +4.811250638821740e-02];
L2E_L3E_iAMPA_netcon = [+4.436694403202262e-02   -1.814710177733601e-02   +7.350881588705774e-02   -2.936411868267735e-02   -8.714897911245731e-02   +2.745691553694756e-02   -2.389144340363923e-02   -4.969753959322636e-02; +3.067574859682166e-02   +7.986813449322464e-02   +4.494537446897963e-02   +1.135716693942728e-02   +5.259734230844970e-04   +1.551853750924581e-02   +2.600412210194693e-02   +1.899711776528721e-02; -2.461486741516428e-02   +3.121773322558972e-02   -9.235863628213548e-03   +3.290176366537553e-02   +2.812296163850926e-02   -9.065356035337228e-03   -4.404008559972397e-02   +4.562449060420250e-02; +6.096649468427951e-02   +8.332595037286641e-02   -1.188214322554328e-02   -3.873658748065979e-02   -5.603048901865472e-02   -4.363457992224039e-02   +1.116097804613879e-02   +2.743487679724503e-02; -6.366907522675740e-02   +6.594743265569572e-02   -1.565621510069187e-02   +1.861814492780255e-02   -2.944488257217557e-02   -2.289310016393682e-02   -2.141966692977871e-02   -1.936496993923968e-02; +5.819758854651857e-02   +4.612373726327608e-02   +1.497987010771757e-02   +4.377794442282708e-02   +1.103130256168284e-02   -1.007674499093995e-01   +2.981234198652546e-02   -1.563657829137005e-03; -1.954627908946510e-02   +3.800869614421700e-02   +6.487794334196113e-02   +2.439821488958720e-02   +1.113148746775012e-02   -6.755232558226944e-03   +1.632965672918131e-02   +7.089234554497562e-02; -2.117744531530325e-02   +9.488227314479239e-02   -4.803783848524339e-02   -5.513660162989424e-03   -3.597421911812540e-02   +5.280858777031844e-02   +5.980423207127823e-02   +3.730735327772117e-03; +1.358608721801267e-02   -2.806023266276156e-02   +1.077372640005740e-02   +7.471909006331789e-02   -3.434503210781522e-02   -6.507913186072018e-03   +7.374000512976896e-02   -2.237606407874024e-02; +8.632577074249033e-03   -5.301687833804887e-03   -2.942943256600699e-02   -5.397372588893944e-02   +3.406129033675982e-02   +4.506241064891744e-02   +2.375575864653999e-02   +1.321306461321601e-01; +1.348956795476340e-02   +2.944205429862091e-02   +1.397262370270473e-02   -4.664913246851794e-02   -8.062068074521922e-02   +1.511614466825410e-02   +1.252529371891555e-02   +4.985093107234434e-02; +8.299783967609391e-02   +3.656135718769740e-02   -5.953435643482962e-02   +3.094619527002154e-02   -2.404808225069971e-03   +7.533416858541726e-02   -1.822533077201678e-02   -5.448385164442715e-02];
L2I_L3I_iGABA_netcon = [+1.059219850410877e-01   -5.728735772951087e-03   +1.553000010748694e-02   +6.414546475306332e-02   +5.963820817340541e-02   -1.819284521547714e-02   +4.358087184333784e-03   -4.799031869082590e-02; +4.739855737645082e-02   +1.093280524905778e-01   +8.081497359011652e-02   +9.304823444124642e-02   +1.934049761930345e-03   +1.546809135876355e-02   -6.921564305226542e-03   +6.876460292731285e-02; -1.402380684679141e-02   +1.212123416137238e-01   -6.161956090809425e-02   -1.901498568136304e-02   +4.142964149572422e-02   +3.456265792986239e-02   +4.143498845151410e-02   +1.704187901724611e-02; +1.368487187128544e-02   -5.915974013573747e-02   +2.960770406395863e-02   +3.621810640048276e-02   -1.038821640503091e-02   +2.820519571434879e-02   +5.528448664982390e-02   +5.339778922451073e-02; -9.137789205997930e-02   +2.828392935423697e-02   +5.364767956769592e-02   +3.987186425705390e-02   -6.283254833975283e-03   -1.774529316287284e-02   +3.359539642972142e-02   +4.775399162624375e-03; -7.957649800697825e-02   +7.810634798769127e-02   +2.824197658794268e-03   +5.434813751165461e-02   +5.009792983927502e-02   +4.652233473522611e-02   -5.639285561052663e-03   +6.906634275726770e-02; +4.253896203065945e-02   +4.228009345759965e-02   -2.173702079006697e-02   +6.369611733928429e-02   +8.105680533211537e-02   +3.776593595290996e-02   +1.496892544342747e-02   -1.800756248079773e-02; +5.218515523724507e-02   +3.454688783328679e-02   -3.865427389282833e-03   +9.079888897162232e-02   -3.693390230130635e-03   +4.379471234078341e-02   +4.776942409857905e-02   +1.060099608942191e-01; +7.758408629082447e-03   +1.623061644341491e-02   +6.111816520016891e-02   +4.904495120252057e-03   +4.320477844117018e-02   -2.677373555859352e-02   -2.984341951453229e-02   +6.401921593173668e-02; +4.078779124088453e-02   -1.350390079273391e-03   +6.979888076925131e-02   +3.076679897836949e-03   +6.728035632579378e-03   +1.886045897304402e-02   +2.262748675964599e-02   -1.098428211732714e-02; -5.479769162771259e-02   -6.504362972567121e-02   +3.061110341139233e-03   +7.360439456955811e-02   +3.879823353844662e-02   +4.465593510678909e-02   -3.522599305972716e-02   -1.308603789066513e-02; +7.365189441786585e-02   -3.294750161101708e-02   +7.140985384284573e-02   +9.082948109911063e-02   +2.577118700024085e-02   +1.982005201142054e-02   +8.154791642937805e-02   +4.728350458809608e-02];
L3I_L3E_iAMPA_netcon = [-5.337172651641850e-02   +3.835184464783502e-03   -5.847047306886013e-02   +8.320845732794784e-03   -3.417253264315333e-02   -9.144704256897257e-03   +6.311516854632973e-02   +8.592870892626008e-02   +2.118674856423302e-02   -5.546095593989656e-02   -1.192999576648718e-02   +2.333909774073518e-02; +2.666207182317637e-02   -7.676615778624539e-02   -2.165785669186557e-02   -6.190423642002425e-02   +6.402490187137351e-02   +3.868358619493173e-02   -7.565746835957093e-02   +1.995476157564165e-02   +1.131997286755712e-01   +9.837039290121995e-03   +3.521579932079318e-02   -2.736534574743492e-02; +3.306353148589536e-02   +1.540684627186412e-01   +9.559596852576448e-02   +3.832277265870598e-03   +6.715924149310963e-02   +9.581011509104559e-02   +4.407222193792858e-02   +4.291600513460701e-02   +6.252323681976152e-03   -3.266356081833804e-02   +5.000096524633735e-03   -6.413348402322541e-02; +1.790642449853808e-02   -9.146774276084674e-02   -1.087117884213093e-02   -2.690256849211901e-02   +1.241828948541145e-02   +8.435963547069138e-03   +7.738999479654826e-02   -3.427517500300067e-02   -2.111913222196268e-02   -2.302840257857115e-03   +4.453304995610145e-03   -3.203462919672857e-02; +2.356286870043960e-02   +9.783196078257256e-03   -7.691373917354617e-03   +2.778243002545827e-02   -1.892356317437883e-02   -4.316826412606400e-02   +8.205486223975901e-02   -6.401091318145380e-02   -1.393245833982246e-02   +1.021749353344803e-03   +7.685968975124896e-02   +5.564439349560447e-02; +1.232922909343700e-01   -4.656275760768067e-02   +1.259122296363712e-01   +5.926366400318634e-02   +9.706297469866804e-02   -6.373251428667469e-02   +1.115181491473502e-02   +7.352190431277664e-02   +5.835480806683548e-02   +1.558978326651084e-02   +5.667429743968930e-02   -1.883897403204729e-02; -1.878633507470685e-02   +1.045997344385169e-02   -1.741889140553457e-02   -1.785202974288079e-02   +7.122844430818281e-02   +3.812068356462707e-03   +7.843287183100098e-03   +7.059484811927588e-02   -2.484921880600048e-02   -4.921341714889169e-03   +5.938959360073584e-03   +1.504531785323799e-04; -1.282968285039555e-02   +6.602774938864468e-03   -2.131830429050775e-02   -3.124425300675292e-02   +5.388650185560305e-03   +7.838377824752205e-02   -3.020518781647485e-02   -6.574816645258945e-02   +3.749724483161545e-02   +1.738764441416544e-02   +1.538306897719514e-02   -7.932975662719841e-02; +2.226186190604936e-02   +4.208701582724664e-03   -4.823032944206341e-02   +3.198655232376345e-04   +1.499541861939475e-02   -2.724034763730104e-02   +2.097957492594889e-02   +6.052881360080926e-02   -3.537186319964283e-02   +6.607220900019155e-02   -6.536088787741816e-02   +4.557615988920655e-02; +1.347430682334025e-02   -6.429501308142500e-02   +1.621905150535993e-02   -8.225121776206815e-02   -4.211602950529009e-02   +3.494099496758343e-02   +3.890891832842233e-04   +2.402143354693083e-02   +2.112278904822283e-02   -5.706331398041986e-02   -3.276835472673167e-02   +3.741016040093012e-02; +1.889009967961450e-02   +7.695595755671242e-02   -4.425585558887870e-02   +9.124238711611110e-02   +4.792334444276908e-02   +5.802359259869607e-02   +3.812917125746634e-02   +1.025043803113282e-01   +4.139707752614026e-02   -4.687695144418817e-02   -5.641054485710829e-02   +4.129249423082564e-02; -4.688656865525623e-02   +8.853485759932139e-03   +1.505444257359971e-02   +1.000181739121248e-02   -3.461141414222302e-02   +3.275830962547233e-02   +7.455535777237079e-02   -5.822603865917871e-02   +6.663796847403956e-03   +8.545600058648853e-02   +3.593566386059752e-02   +2.044925289373591e-02];
L3E_L3I_iGABA_netcon = [+5.328198030784535e-02   -2.180021068014152e-02   +4.395660796412389e-02   +1.975114815982025e-03   +1.430847008180653e-03   +6.991782926784007e-02   -9.945509538459614e-03   +3.415731578370316e-02   +7.568145707930843e-02   +3.913195087821728e-02   +4.029874797671774e-02   +1.706817182892589e-02; +1.852615245785330e-02   +3.831378237211042e-02   -2.838351150520546e-02   +1.489231591668921e-02   +6.528484587749382e-02   +4.229484564933302e-03   -1.976460031805119e-02   +5.237528008885042e-02   +5.417433232691384e-02   +9.772506519037838e-02   -2.636810341634926e-02   +5.251643939140510e-02; +2.080891232308553e-02   +1.412267586284890e-01   +8.231380216125200e-02   -6.124119412228957e-03   +2.897071345457967e-02   -9.142228819281051e-02   -8.736680242959349e-03   +1.239838013779334e-01   +1.094733446787081e-01   -6.938968884923829e-03   -4.243156838124627e-02   +3.812567650181212e-02; +2.528628995245377e-02   +5.850145880080931e-02   +3.532666730101712e-03   -7.021316513968424e-02   +6.988257946176991e-02   +5.017328747656437e-02   +8.918110652797370e-02   +6.062350317638559e-03   -7.725136901120912e-02   +1.787328322780267e-02   +2.569491575496947e-02   +3.570311506971127e-02; +3.865413643560267e-02   +5.617398798839790e-02   +1.006439266348627e-01   -9.595297724797480e-02   +1.129428822508719e-03   +4.715117422042883e-02   -6.168915696169767e-02   +2.327864530956624e-02   +7.472790342027107e-02   +4.527684618300207e-02   +8.900588631993420e-02   -7.190422796975721e-02; +3.926634077288207e-02   -8.246452034444395e-02   +4.298645549471545e-02   +7.854584498517890e-02   +3.276433209420174e-02   +8.533955688659202e-02   +8.004089504836971e-02   +9.222257656162637e-02   +2.132292171474568e-02   -2.966108683547913e-02   +1.062264705715060e-01   -3.342843855826073e-02; +9.759704624464793e-02   -3.368391303058458e-02   +4.116179690325530e-03   +5.556856687721060e-03   -8.018172293176688e-03   +3.872314668369549e-02   +9.021518288393518e-02   +1.079305269737941e-01   -5.616500069442611e-02   +1.581369230684202e-02   +4.478405944204478e-02   -3.993667101147742e-02; +4.676166446704425e-02   -3.882575854913909e-02   -5.841861820282778e-02   +1.320594790380470e-02   -7.193384872335926e-02   +7.304959456957738e-02   -2.737699744097453e-03   -7.679880536151248e-03   +5.146093025697356e-02   -4.260010079484289e-03   -1.899047959755128e-02   -1.690962183442123e-02; -2.923425407458616e-02   -2.999018506280468e-03   -2.096728086641380e-02   +1.570281974478662e-02   -2.323593570078697e-02   +8.943988107445246e-02   -9.080447676065137e-02   -1.112060436560557e-02   -4.722063332745922e-02   +2.702637780145114e-03   -1.013463492161408e-02   -3.065907891822948e-03; +4.928218709860770e-02   +1.195129567938775e-01   +1.359843344457677e-02   -2.207606394713844e-02   +3.340661897926643e-02   +1.319262132233933e-02   +9.090070156975145e-02   +9.455874748262690e-02   +6.721159410907031e-02   +2.419734840191739e-03   +2.469455574948631e-02   +6.123669753101760e-03; +1.033232759954656e-01   +5.896889051233720e-02   +1.066808896245345e-02   -4.031511430913279e-02   +3.921065682325379e-02   +3.626956896297810e-02   +1.980627274814326e-02   -1.005979047717831e-01   +1.389551295260861e-02   -7.513679969113911e-02   +3.190768528931624e-02   -7.913228731485016e-02; -2.804145902734096e-02   +1.111566258746403e-02   +3.000724586694466e-02   +4.092279518583733e-02   -2.531884513131410e-04   +6.507418889916715e-02   -1.932635135824371e-02   +4.107391144259830e-02   -2.689132274350664e-05   +7.534656990620099e-02   +1.294151223293464e-02   -6.529748177604296e-02];
L2E_Input1_iAMPA_netcon = [+6.861682649875418e-02   -3.087716898764575e-02   -1.675396777624606e-02   +1.366901830273982e-02   +6.854145829741592e-02   -2.117986161568184e-02   +3.346877389371622e-02   -3.551243164221715e-04];
L2I_Input2_iAMPA_netcon = [+9.697327075098389e-02   -4.176434828659070e-02   +7.997452363743197e-02   +3.137449993226676e-02   +6.487058027409341e-02   +6.351646569822525e-02   -3.632497401008400e-02   +7.705488376735797e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
