function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.702368780886720e-02   +1.803473385880619e-01   +2.965305366594689e-01   +2.153085196530665e-01   -4.510404914070708e-02   -1.221889203611452e-01   -2.956645413539616e-01   -2.505835702788992e-01   -2.757892110917844e-01   +1.028854321594914e-02   -1.445501851993190e-01   +1.040236165567879e-01   +3.255122932621019e-01   -3.322541580539687e-01   -1.378945953697051e-01   +6.394697049551390e-01; +2.334880703733322e-01   -3.783284570360291e-02   +2.842618237231488e-02   -1.257837803738113e-01   -1.112385323718596e-01   -4.197375768417514e-01   -4.772384710300570e-02   +1.282206707905497e-01   -1.001509670271355e-01   +8.171520890144340e-02   +1.942467041584436e-01   +1.523744694114392e-01   +6.157488814506146e-02   +2.400831469709928e-01   +3.628188673621924e-01   +2.739803903923260e-01; +1.876172953488285e-02   +1.665015720277857e-04   +1.283467929836354e-01   -1.976036090311460e-01   +4.536337990030123e-02   +7.270223636096210e-02   -4.196104459972810e-02   +5.262656939972560e-01   +3.459645916384924e-01   -2.215253304625942e-01   -1.060007546955380e-01   -2.409630313821390e-02   -2.538352649757888e-02   +3.329245381556660e-01   -1.313998365085989e-01   +1.988449323867184e-01; +1.843024278903063e-02   -1.953303779777438e-01   +4.064952204537536e-03   +1.469250772860087e-01   +1.016963372645400e-01   -4.488241056418781e-01   -1.921155717094312e-01   -1.142127731963157e-01   +1.925928709872828e-01   +1.743923618986014e-01   +3.477240806085457e-01   -1.308305439846237e-01   -2.929162316778441e-01   -2.001470285022133e-01   +4.546090188387447e-03   -8.409464002987792e-02; -4.220553439844580e-01   +3.070477926454182e-01   +5.883413843758731e-02   +1.507027966230156e-01   -3.475161747818498e-01   +1.712011423036549e-01   -4.404247363246805e-01   +3.552771275047846e-01   -1.015536571507703e-01   +9.272345387315085e-02   +2.958197777717032e-01   -1.225770246387727e-01   +2.067782984445433e-01   +2.389830655193654e-01   -7.750743817254163e-02   -1.069289053426671e-01; -2.413747306533161e-02   -4.764002739856630e-01   +2.728164218371787e-01   -1.500935575573467e-01   +1.897711498044663e-01   +3.033408555806512e-01   +1.397925145988096e-01   +2.038547428563512e-01   -3.351989474372138e-01   -1.298728784433366e-01   -3.465589715864666e-01   -1.898132276388716e-01   -5.593757941420265e-01   -2.631257091746185e-01   -8.276550156288015e-02   -3.434625702301039e-02; +3.826298031157660e-02   +1.068095405368026e-01   -2.357755642608195e-01   -2.188242397192628e-01   -2.968033980618695e-01   +1.444064076060986e-01   +2.446975141445428e-01   +5.260037202765494e-03   +1.285355188562653e-01   -1.242543041325830e-01   -3.026045719528329e-02   -4.040480124988385e-02   +2.972455436338321e-01   -5.093559757671587e-02   -1.920165000671742e-02   -1.463010601383259e-01; +2.153746225300508e-02   -3.114342870720457e-01   -8.689277543949775e-02   -1.926112491489066e-01   +2.160115392571646e-01   -1.986605310036609e-01   +8.987453498105952e-02   +6.868495045600308e-02   -5.219361119312557e-02   -4.479134673384375e-02   -1.647916539212477e-01   +1.150876380176945e-01   +1.540484025586496e-01   -1.362679957366612e-01   +7.483817334199191e-02   +2.298823490206780e-01; +1.330272700524994e-01   +1.133474992830026e-01   -2.975249411776286e-03   +3.406246743891937e-02   +7.734602438115583e-02   +3.717694925990810e-01   -5.475499803685832e-02   -5.647445740590029e-02   +4.312909842062723e-02   -1.159136371988022e-01   -6.998189765640694e-02   -2.956051060491955e-01   -4.731430603304811e-02   +3.850234365329100e-02   +6.861036034425783e-02   -2.881084537608073e-01; +1.480624539009892e-01   +8.711028926733454e-02   -1.865239192624522e-01   +1.032799769788438e-02   -5.717456928323057e-02   +9.177959968616219e-02   +2.258267086605299e-01   +1.419899651157011e-01   -2.349058191955122e-01   +2.501264347605383e-01   +6.010496847089457e-01   -2.881921514949889e-02   +2.810181701216581e-01   -2.773489564841357e-01   -2.210118995669098e-02   +1.315199693803438e-01; -1.372190209550353e-01   -1.940516016246748e-01   -4.491967414182916e-01   -3.546089816349838e-01   +1.450606442107948e-01   +3.304820399330402e-01   +1.761052162578599e-01   +1.557890451942311e-01   +1.115146080523247e-01   -1.144333619740706e-02   +3.381612589595239e-02   -1.910161453505275e-01   -3.358297115789560e-02   +4.414846501833361e-02   +4.699041965367424e-01   -3.870291184176894e-03; -3.837914707523988e-01   +2.363503400059999e-01   -3.716988683746823e-01   -1.147624560036275e-01   -2.440043140405002e-01   +4.806719449191573e-01   +8.810912238666706e-02   +7.751786791811896e-02   +2.255963244982936e-02   -4.170625298541017e-01   -2.551449445401404e-02   +3.638285290203085e-01   -6.090586345566984e-02   -2.973744632504970e-01   +1.308920355209231e-01   +4.673502837907020e-01; +6.749195801211764e-02   +2.743375576391722e-01   -5.608206471289406e-02   +2.850379810147677e-01   -2.086104507607182e-01   -1.773969492121635e-02   +9.500856381130895e-02   +2.611745494590144e-01   -1.537935997901331e-01   +4.380605211285374e-01   -4.240223824857891e-01   -2.629747502116147e-01   -2.389836337764089e-01   -3.821991140930769e-02   -2.808434273502303e-01   -2.552082169872527e-01; +4.232118026402965e-01   -1.021848509856958e-01   -4.343217607672861e-02   +2.220295368495602e-01   -7.708535039556554e-02   -1.949088482231756e-01   +2.145963744735663e-01   -4.129351052951163e-01   +3.755711639296560e-01   -1.194920836642199e-01   -1.696471706917819e-01   +1.213948956612775e-01   +2.854225940011333e-01   -2.857645059145926e-02   +1.225213632391295e-01   -9.306066646954711e-02; -2.565950457701913e-01   -2.143849843972413e-01   -4.142181703437647e-01   -2.001567694227180e-01   -1.017240204419066e-01   +4.136000256299057e-01   -4.241123437593373e-01   +3.105693201483881e-01   +1.583664188517254e-01   +7.979464026968970e-02   -5.833787147924005e-02   +1.159030518241649e-03   +6.834907451551171e-01   -7.909721835901565e-02   -1.363827481780782e-02   -5.308678681026543e-02; -2.381365803953404e-01   +1.351404353031119e-02   +2.024822910338906e-01   -2.219598843185485e-02   -2.910181400182898e-01   +8.980828032700386e-02   +1.013970108378959e-01   -3.049786247134566e-01   +5.573112358533212e-01   +1.055882505235957e-01   +3.121978119659983e-01   +3.610299779957281e-01   -2.689962943793404e-01   +2.550713340716758e-01   +1.898432492739872e-02   +6.211950534883829e-02];
L1E_L1I_iGABA_netcon = [+1.065372575701984e-01   -1.946190088867152e-01   +1.328251138743084e-01   +3.112606031693684e-01   +9.649079494491578e-02   -1.134904774864961e-01   -4.178769886907768e-01   +1.907995525439883e-01   +2.793710422920228e-01   -3.402006713988208e-01   -1.448575757206303e-01   +2.415278720812436e-01   +2.844979517841199e-01   +4.383825586400234e-01   -1.658322107273986e-01   +4.685849233594976e-02; -1.631554125107701e-01   +2.233424740549096e-02   +1.219144888652009e-01   -4.402536472971557e-01   -1.304310619134588e-01   +3.432067061739889e-01   -1.192248394309776e-01   +2.354852788539344e-01   +1.084563462019603e-01   -1.639523096567571e-01   -6.920334160488562e-02   +5.861016565183595e-01   -2.112906227786465e-01   +2.102452204323437e-01   +2.295217364874109e-01   +1.482092754573382e-01; +2.251163147464217e-01   +4.700006829673118e-01   -3.368983669235416e-02   -2.637769920930466e-01   +1.422466144977669e-01   +9.244208167915990e-02   +1.919600355522701e-02   -1.395578422555918e-01   -3.999477581389901e-02   +2.936053358607304e-01   -6.982272600438101e-02   +3.455043964792183e-01   +2.099942260978971e-01   -2.641132973473168e-01   -1.236718012713277e-01   +1.521288737561816e-01; -1.755638642169323e-01   +1.235068114182741e-01   -3.707241217583069e-01   +1.949905645625588e-01   +6.140337127651916e-02   +4.164705372051372e-01   -1.497352275063679e-01   +7.124066451253092e-02   -4.165408540040902e-01   -2.688482465384052e-01   -3.224689040508490e-01   -1.360238825640530e-01   -1.923928654227797e-02   -3.054341008472439e-01   +2.399803088503094e-02   +1.806650723375713e-01; +4.662634952867566e-01   +1.188986121260410e-01   +2.054375314256334e-01   -1.872091050404046e-01   +1.480391295532992e-01   +4.666004805796846e-01   -3.025781799657341e-01   +4.405900133923151e-01   +3.865387122791562e-01   -3.174817967492688e-02   -2.729524383431462e-01   +1.989557171794549e-01   -4.266999791108303e-03   +1.569259652525302e-01   -2.683997798274045e-02   +2.318533276730636e-01; -1.631011081210970e-01   +6.987634730531628e-02   +2.628047214433492e-01   -2.245436768757575e-04   -2.161589832981767e-01   +1.250656793492975e-01   +1.967985236158713e-01   -1.014548512512350e-01   +7.426364548197519e-02   +4.420541194321462e-01   +3.554629625983439e-01   +2.690796484501338e-01   -3.348568260839131e-01   +8.586156950770335e-02   -3.477840041301247e-01   -5.071914056924173e-01; +2.463937048030984e-02   -3.524196146071861e-01   +4.796217377372005e-01   +3.171490472925037e-01   -1.414970552965172e-01   +3.083006667547734e-01   +2.703873657613894e-01   +2.386592484350308e-01   -1.603312200708213e-01   -3.316788152449429e-01   -1.211051128626686e-01   -1.411288140602258e-01   +2.309976421094643e-01   -2.153445952346231e-01   -3.222815381386852e-01   +1.308587542897215e-01; +2.732742070900211e-01   +3.862290139921712e-01   +4.500398890314748e-01   +1.688201440495599e-01   -8.310151141682452e-02   -3.164164569355979e-01   +8.420113163846973e-02   -2.016260482261820e-01   +2.688211066631957e-01   -6.835940806896909e-02   -2.240657641483775e-01   +1.523842026817480e-01   +1.955760521814297e-01   +4.336398368388412e-01   +1.427597137297983e-01   +1.200000105285551e-01; +3.114509959389772e-01   -6.522625652052089e-02   +6.550177422369685e-03   -6.933783447327460e-02   +3.464656310752671e-01   +1.598071518594405e-01   +2.789609860984368e-01   -2.398225870635202e-01   -4.392301919899087e-02   -2.747360614970636e-02   -3.878164970486537e-01   +3.310325647915259e-01   +8.138773902584132e-02   +3.767883734080975e-01   +4.527204177247180e-01   +3.845526654282678e-01; +3.636450512364956e-01   -2.485852413053795e-01   +2.519177250479390e-02   +2.285833957805196e-01   +3.429501807096608e-01   -4.089091126473774e-02   +1.382366270806420e-01   +2.362654456404409e-01   +1.090305905841451e-01   -2.189239421966915e-03   +5.494269142132163e-03   -7.931199865907511e-02   -3.349087453699688e-01   -3.641238708324665e-02   +5.171157051890599e-01   +2.082104901545408e-01; +1.648121918107811e-01   +1.983332964159763e-01   +8.825350471469653e-02   +3.703344037949967e-03   +2.724986851446644e-01   -2.483390350868230e-01   -4.072718994102772e-02   -1.868555646738775e-02   +8.828429744381507e-02   +1.033464736857834e-01   +3.146024885231718e-01   -7.110354890133952e-03   +1.446759538358315e-01   +4.350465384016386e-01   +4.054478954668249e-01   +1.998202850531909e-01; -2.568374634767774e-01   +1.729573867916821e-01   +1.487715930780776e-01   +2.072270198079167e-01   -1.178957997946535e-01   -2.243784758085363e-01   +2.159593074192867e-01   -7.958194589376308e-02   +1.631649468375673e-01   +1.810026971469630e-01   +1.134648063177168e-01   -6.903546913654274e-04   -2.700312068275071e-01   -1.772801384522047e-01   +2.602481852842758e-01   +2.881641794927808e-01; -2.065738671391806e-02   -2.071247284491117e-01   -1.838302059560069e-01   -4.689215435831290e-01   +4.829094506668908e-01   -1.719393302507246e-01   -9.151508636207777e-02   -1.676446906501197e-01   -1.341463192040794e-01   -3.505655193528332e-01   +5.724917234419868e-01   -2.256049060253881e-01   -2.198823082393885e-01   +1.786814074238697e-01   -2.580091128061144e-01   -1.346253729311901e-01; +2.676791144604009e-01   -3.732925590272833e-01   -1.602174970304582e-01   +2.457282232962978e-01   -2.501275086660821e-02   +1.488616021711013e-01   -5.156290839926150e-02   +1.093974184400625e-01   +2.012123803812658e-01   +2.728758387645079e-01   -2.268107859473324e-01   +1.119368378710196e-01   -3.201963032438601e-01   -3.411201458893125e-01   +5.190508470392681e-02   +7.769599407670871e-03; -6.278160373077386e-02   +1.407020988552702e-01   -2.293966961956907e-01   +2.939454784292607e-01   -9.348944701373942e-02   +3.614228159847664e-02   +4.922028362757902e-03   +1.700950978380003e-01   -9.803155138463004e-02   -1.698537413911684e-01   +1.491205235214500e-01   +7.232082737336683e-02   +1.814184182010241e-01   -2.308119917422925e-01   +2.058073205039498e-01   +4.191660624034267e-01; -1.302256467387954e-01   +3.302131515601092e-01   -3.427378503434099e-01   +1.090154967736514e-01   -8.340294634019278e-02   +2.741084846814033e-01   -9.850691659983390e-02   +3.330359806779482e-01   +2.392568817549903e-02   +1.499111987894969e-01   +3.298725261530062e-01   +3.189673162493333e-01   -2.437098434001819e-02   -1.893166764212687e-01   +2.117514804706691e-01   +1.938263750325374e-01];
L2I_L1I_iGABA_netcon = [-1.428140376063391e-01   -1.228098576863580e-02   -8.705614150147953e-02   -2.073716532678993e-02   +3.880499263890805e-01   -1.205451287527994e-02   -4.534676320905752e-01   -1.409670002202548e-01; -1.470259050262244e-01   +4.079434098685880e-01   -8.202115907256513e-02   +1.010372406355690e-01   +2.880164065203372e-01   +1.347933386502585e-02   +3.042018018565557e-01   +1.138943164449922e-01; +3.800428957947687e-01   +2.028654837144254e-01   +2.301432289296293e-01   -4.028129064752083e-01   +1.649840016230141e-01   +4.597961934839280e-01   -6.016553344131890e-01   -1.509269910470821e-01; -1.572172957992395e-01   +1.333661970379237e-01   -9.293869580591814e-03   +8.128503083509042e-03   +1.240527011907369e-01   +4.578836111480901e-01   +5.299214604146679e-01   -3.519315873835123e-01; -1.822537432281768e-02   -2.843878854516728e-01   -2.568635030111631e-01   -3.240736001078426e-01   +1.359774493273315e-01   +7.173341000011849e-02   -3.156089673239538e-01   +1.237697875215164e-01; -4.518503322239453e-02   +5.668447125584186e-02   +3.742307851205245e-02   -1.371495474707178e-01   +1.426541818957326e-01   -1.640528550770435e-01   +1.437213441142290e-01   +1.779143236326933e-02; -7.791410165218560e-03   +9.393696218563466e-02   +3.130081786394677e-02   +8.412092192471211e-02   +4.996038120174569e-02   +2.342499727114967e-02   +2.427815808557643e-01   -1.331719216167495e-01; -2.033243925565308e-02   +1.755281374467519e-01   +8.113741710617878e-02   -1.526458337160599e-01   -1.575579343620492e-02   -7.095381293989050e-02   -2.539788096532569e-01   +1.466291044556029e-01; -2.888850144418343e-01   +1.802136818404529e-01   -6.639965681318416e-03   +9.824777985121316e-02   +1.326168281734572e-01   -2.600672027121143e-01   +2.287154595117839e-01   -1.306149275683661e-01; +1.249509583463984e-01   -3.237993198906398e-01   +4.717599285757366e-02   -3.122930265441746e-01   -2.181319076359520e-03   +4.661808965293344e-02   -2.014289343082572e-01   -3.436437817786091e-01; +1.842908481692666e-01   -5.700173170265370e-02   +3.946489947961809e-01   +8.730391790796065e-02   +2.601550645715921e-01   +6.798979576629713e-02   -1.845108219336821e-01   -1.469398435121596e-01; +9.078805624096618e-02   -1.046412857449132e-01   +1.040575780856186e-01   -1.250018897028665e-01   +2.512972300158873e-01   -8.864885130200928e-02   -3.192996230921133e-01   -2.746403899718968e-01; -2.436516132946101e-01   +6.589422319379848e-02   +8.742671410163569e-02   +3.211113622905598e-01   +1.744269770936264e-01   +1.314511333332491e-01   -1.942136945723923e-01   +1.785221898236363e-01; +1.194673968411067e-01   +2.687065158449009e-01   +8.823293461519745e-02   -2.359309975426325e-01   -1.117377710826007e-01   +3.072909789121698e-01   -1.357875221428551e-04   +6.125070316116192e-02; -2.902904693542156e-01   -2.374201441279422e-01   +2.778025609125794e-01   +1.713656969765242e-01   +1.682092897936063e-01   +2.247274675660946e-01   +3.404397974268377e-01   -2.917946508666281e-02; -3.083581709713809e-01   -1.569281763075569e-01   +2.555889365141032e-01   +5.804965393384999e-02   -3.504442684571599e-01   -5.248954868680598e-02   +2.396604183962044e-01   -4.602749449840328e-01];
L1I_L2I_iGABA_netcon = [-3.962642323108956e-02   -3.134706641641202e-01   +2.310309462830156e-01   -4.240844164841080e-02   +1.380944400862637e-01   -1.723171156244062e-01   +2.903160128743180e-01   -1.813370531579750e-01   -1.770399149245845e-01   +2.170272992620697e-01   +2.966553410785646e-01   +3.123866365748292e-01   +3.624550552833277e-01   +6.026269911164557e-01   -4.220578563037686e-01   +1.686244813412638e-01; -1.944470160726985e-01   -3.480931587597075e-02   -4.237614141015916e-01   +5.518147816161170e-02   -3.407374253641391e-01   -3.469692380253971e-01   -1.433228874302686e-02   -6.595535741620810e-02   +1.865703813186460e-01   -1.364468891156512e-01   -2.328387151291124e-01   -1.487651390421773e-01   +1.471731802012974e-01   +1.953813325567272e-01   -1.563551825887746e-01   -2.425915708976023e-01; -6.126393505348499e-02   +1.940568997201358e-01   +2.498057494301967e-01   -2.151584087943433e-01   +4.914454242639252e-01   +9.634731903019754e-02   -4.062204915176018e-01   +9.502922194543077e-02   +1.012007537372449e-01   -2.724481415742264e-01   -6.902473311704341e-02   +2.325953143724962e-01   -2.045540666045240e-02   -4.537446738150538e-02   -1.203674235860977e-01   +7.445924732396078e-02; -1.054873494427479e-01   +5.960535596643687e-01   +3.250978982366085e-01   -2.567357150748247e-01   +2.167552332768122e-01   -3.099532252378873e-02   -8.724956212847368e-02   -3.262232282268785e-01   -4.476224983065673e-01   +2.338668194782285e-01   -1.141770961534681e-01   -2.218297254033959e-01   +5.213042764995306e-02   +1.913607522896192e-01   +9.555378962105313e-02   +4.192839924681298e-02; -1.068269254070834e-01   -2.595871628594226e-02   -1.239631244533836e-01   -1.800398590435007e-01   -2.590867848337705e-02   -5.016493796789762e-01   -2.653451844270967e-01   -8.102751388649712e-02   +2.297237898109951e-01   -5.110991997223933e-01   +6.114429439351474e-01   +9.373986485683244e-03   -1.354330522227428e-01   -8.346030989396569e-03   +3.309616851620639e-01   -2.806945128821520e-02; -1.043402322127930e-02   -2.606212828544540e-01   -1.901778951743809e-01   +3.125855072892549e-01   +2.657610156630454e-01   -4.558215670024176e-01   +2.921822288033188e-01   +4.354502628857052e-02   -7.670305326602012e-02   -1.817697067908291e-01   +4.899896607551967e-01   +6.061131866485654e-02   +2.061616653293311e-01   +1.672426277984368e-01   -1.616126558550602e-01   -2.146603371642130e-01; -6.282358366155982e-02   +2.735672332732079e-02   -1.727222827079534e-01   +2.891039196561410e-01   +2.040151722415003e-01   +5.420553778154318e-02   +7.991673257140508e-02   -1.145863662563473e-01   +3.405517417277142e-01   +3.045630467107009e-01   +1.567710804848018e-01   -2.033296075779878e-01   +3.011231796174705e-01   +2.674856145175513e-01   +2.138509697553012e-01   -1.028413881809606e-01; +5.889605749476126e-03   -1.799419972841854e-01   +5.613366954882741e-02   +1.201323318053387e-01   -2.094709591318943e-01   -2.698165176997918e-01   +2.129872162243901e-02   -2.535812796990714e-01   +9.609121965682385e-02   +2.392376500790578e-01   +4.724554877593704e-01   +2.878015011010892e-01   -1.146139640823990e-01   +3.206551326652238e-01   -1.311287381782257e-01   +1.308447851194547e-01];
L2E_L1E_iAMPA_netcon = [+3.817491021498195e-01   +2.838765936130019e-01   -2.652247425491204e-01   -3.326907914079242e-01   +5.750336841831925e-01   -5.297871938763174e-03   +1.060109712703904e-02   +6.817665384508906e-02; -6.127163530785240e-03   -3.484754050885786e-01   -7.161969679836547e-02   +1.627415464681458e-01   +4.263297394859611e-01   -2.538391325879169e-01   +1.437958017334611e-01   -5.227407938081102e-02; +4.275116820240455e-01   +1.989179175690142e-01   +2.082743200179542e-01   -2.286818290759060e-01   +1.150428832345674e-02   +1.626349855984792e-01   +4.092643393615122e-01   +1.399939686112060e-01; +2.072079442373852e-02   -5.295719928706172e-03   -2.223100883111284e-01   +1.276915922995525e-01   +1.013086020503481e-01   +2.181449095203599e-01   -2.697431021371579e-01   -3.544621764556823e-01; +1.661947646366070e-01   +2.995773256286108e-01   -2.428585329639169e-01   +3.627832318674840e-01   +2.591662412257973e-01   -4.440061492728869e-01   +3.249945023100652e-01   +6.268985682908325e-02; +1.334878283627503e-01   -9.339315960894851e-02   +3.021793780988616e-01   +1.803732326982436e-01   +8.993973276459723e-02   -3.183519675519024e-02   -7.845195392683556e-02   +8.637187094651652e-02; +6.044346997002081e-02   +1.649970175735381e-01   +2.117755722687749e-01   +3.614748559693706e-01   -1.735643207531316e-01   -1.404330337869312e-01   +1.757947636453960e-01   +4.267929254740701e-01; -1.553322659975774e-01   +2.468161082289235e-01   +1.554629498134232e-02   -1.622189747993053e-01   -1.155705777814581e-02   -2.499099950889526e-01   -3.913849394591375e-01   +6.744544600396718e-02; +2.485789068398421e-01   +7.091400812796987e-02   +7.712159291385487e-02   +2.165605107633644e-02   -1.485111602257376e-02   -1.297044168928586e-01   -3.554999232013412e-01   -3.400755550981948e-01; +1.499156566393558e-01   +2.481650452282365e-01   -9.195247060552249e-02   +2.607798511696923e-01   -3.288942517482728e-01   +1.979820373341118e-01   +1.086453361090211e-01   -6.113845308580279e-02; -3.546072153688430e-01   -2.919915538172488e-03   +1.349196645740562e-01   -4.887376276877377e-01   -1.835155529533649e-01   +2.211313827078647e-01   +3.212686019152838e-02   -3.344713242740805e-02; -3.508475770502112e-02   -1.695662970167726e-01   +9.850667166061387e-02   +1.792576548669162e-01   -4.890889867575047e-01   +1.051683006170734e-01   +3.168935960315731e-01   +2.475019215463696e-01; +4.038759489722108e-02   +1.601157030577358e-01   -1.008853901132139e-01   +1.297415532519139e-01   +5.019439297481628e-01   +2.778431286174904e-01   -8.952005019915221e-03   -2.570402593795452e-01; +1.462479317906904e-01   +5.937361911162954e-02   -3.617825893002258e-01   +4.173946137394476e-01   -5.023108847941954e-02   +2.250283842725416e-01   -1.259012933202995e-01   -3.156372397414842e-01; +2.687710029531153e-02   -1.606941932902494e-01   -2.628943177919764e-01   +5.982277803952413e-03   +2.567602917574195e-01   +2.902736047019898e-01   -1.186431756116980e-01   +1.998411778852637e-01; +1.728438253667558e-02   +3.820937413331706e-02   +2.204420441485850e-01   -1.192508474450344e-01   -2.419415423474993e-01   +3.598420181880063e-01   +4.894090312855157e-02   -1.191079814580211e-02];
L1E_L2E_iAMPA_netcon = [+3.042788536306298e-01   -6.773336266836245e-02   -1.794250120939791e-01   -3.574652192941668e-01   +1.295780239886953e-01   +4.149606325735785e-01   -1.667960941489756e-01   -7.263090123119356e-02   +1.308781705284816e-01   +3.512745184412949e-01   +5.966344710224500e-02   -3.097136604823079e-02   +5.938757726006411e-01   -4.879362560931324e-01   +1.579558307352869e-01   -1.568987580174840e-01; +1.615042922099336e-01   -1.520865627408714e-01   +1.048302385515761e-01   -1.224831153953205e-01   -4.173093681677135e-01   +2.713822494797404e-01   +3.028007612184996e-01   -3.324124859140278e-01   +1.771152774174927e-01   +5.080050432159176e-01   +1.631470787085926e-01   +2.819119172130953e-01   +5.943676221377963e-01   -7.880145867437466e-02   +2.027391823877377e-01   -5.422929766591367e-01; -1.655832474763906e-01   +7.905107119756705e-02   -1.849148776891918e-01   +3.447462108400078e-02   -7.448396676291658e-03   +1.288782732406742e-01   +8.708720885231686e-02   -1.842765021587917e-01   +2.823640506275175e-01   -7.178412495070990e-02   -1.232497584853480e-01   -3.642386284986052e-01   +8.892627210255226e-02   -4.463203016935081e-01   +1.636960201482781e-01   +5.179464200416910e-01; +4.574493669591871e-01   +1.310524241890668e-01   +4.705800472186790e-01   -4.222662647047267e-01   +1.468310039134044e-01   +2.174628825400237e-01   -1.270085986952102e-01   -2.445633305387115e-01   -4.546180055914437e-01   +1.953534669719923e-02   +4.110447672315478e-02   +1.011136390688189e-01   -9.243164506985993e-02   -1.336908363895390e-02   +1.108535837656827e-01   +4.638759563534064e-02; +2.807346238613354e-04   -1.141792421640990e-01   -5.915926603666861e-02   -2.513916122348052e-01   -6.993362662631175e-02   +2.703534842230028e-02   +2.709934004267252e-01   -3.061400080140161e-01   +1.798234388252498e-01   +1.863417356783309e-01   +2.014752077067718e-01   +1.411118617370625e-01   -2.433315089416205e-01   +2.853922746592554e-01   +1.782442848737014e-01   +2.056066676340895e-01; +3.411722411524029e-01   +4.014018556456239e-02   +7.783623412795096e-02   -4.607899549211560e-02   +1.531790207046807e-01   -6.788238014945286e-02   -1.370254305514770e-01   -4.062941239729998e-01   +1.875615754753640e-01   -1.447377014405562e-03   +1.389436966654107e-01   -2.449948027557444e-01   +7.174854603079470e-01   +1.130827934697662e-01   +8.617233218746931e-02   +1.148317633230214e-01; +4.071172585850453e-01   +5.940326339892887e-02   +8.356721509298751e-02   -5.067931840240178e-02   -2.470439892840444e-01   +1.246776687905280e-01   -2.066024187636596e-01   -4.681382533553893e-01   -1.256944850032507e-02   -1.560256747216222e-01   -7.249958429763516e-02   +1.007518224877981e-01   -2.643712892563982e-02   +4.437497461927419e-01   -1.526992275065183e-01   -4.671569956835923e-02; +4.208838738208492e-01   -4.023498013460092e-01   +1.610583248105739e-01   -1.144594106705580e-01   +3.139999083373786e-01   -2.357153653954544e-01   +6.443184488682219e-02   +2.454800357732271e-01   -2.035168419373480e-01   -1.723855383997674e-01   -2.410572075972495e-01   -1.597577563381960e-01   +1.943454983295338e-01   +8.539003663371013e-02   -1.382505929385094e-01   +3.834424043279300e-01];
L2I_L2E_iAMPA_netcon = [+1.208042307024526e-01   +2.518864490825406e-01   +2.640572765591071e-01   +1.999109404930854e-01   -2.680319818388228e-02   -6.650119503009309e-02   +6.527098933039904e-02   -7.326007944426927e-02; +9.813341566241360e-02   +4.093475127474725e-01   +1.145965022018442e-01   -6.743205841582584e-02   -4.362482644668001e-01   +1.316048180337881e-01   +2.527054768217148e-01   +3.248862485266455e-01; -2.119270517142058e-03   +4.464234637675424e-01   +1.074894273122844e-01   +4.469136457126700e-01   -2.822327445055860e-01   -3.351367344010027e-02   -9.143826597959494e-02   -6.582136630184757e-02; -2.106295323633044e-01   -5.113425154888485e-02   -3.449381310051479e-02   +6.350660247939485e-02   -5.780227110742206e-02   +1.109540829525720e-01   +3.106001991292482e-01   +1.538299453469788e-01; -6.805907652220611e-03   +2.178221753352063e-01   -1.834005730603447e-02   -1.359312925345116e-01   +2.228939866565060e-01   +1.250780153161310e-04   -7.447291494257091e-02   -1.053303222296837e-01; -4.099603667033894e-02   -7.311894093951313e-02   +9.425877237370731e-02   -1.684147373868357e-01   -9.537363237042135e-02   +3.502171090972981e-01   +2.762948293684930e-01   -7.058292990691774e-02; -1.283831386376812e-01   +1.667194948122728e-01   +1.925686475095526e-01   +1.876556996649586e-01   -1.381530821913214e-02   -3.304937029775269e-01   +1.737831955310704e-01   +8.395463110038059e-02; +4.848876706953097e-01   +3.026356600653366e-01   -1.942337834905562e-01   -2.476857116181508e-03   -6.218257374862792e-02   +1.379584498122980e-01   -1.602779757704214e-01   -9.915150479888096e-02];
L2E_L2I_iGABA_netcon = [+1.651442786054347e-01   -5.161344327158181e-02   +4.770798081283434e-01   -7.119735874382536e-02   +2.535693637655099e-01   +6.889804991062401e-02   +2.465779951945126e-01   -3.162581289705100e-01; +2.086719388905008e-01   -2.071191986135640e-01   -4.352306025867830e-02   -1.620173490437828e-01   -4.981212392073203e-02   +7.179219787529348e-03   -1.667922204155928e-02   -1.640799091145822e-01; -2.147202881545828e-01   -1.083242764843234e-01   -1.912062006394740e-01   +5.136507811282003e-01   -3.391163856070106e-01   +4.870614969063520e-01   +3.196951915581984e-01   -1.604451327545021e-01; +2.875990272729988e-01   +2.686191948003137e-01   +2.623864989690415e-01   -2.107228552871614e-01   +1.818519561917933e-01   +1.324765135106859e-02   -1.771860046115707e-01   -1.156279505997244e-01; +4.180489482615720e-01   -1.976803760964100e-01   +1.758330921198797e-01   +1.823622063723738e-01   +1.851938605129755e-01   -2.425155867532783e-02   +5.984414041735822e-01   +3.483179852525337e-01; +6.757955118366551e-02   -3.199912013847959e-01   -4.511225285228954e-01   -1.158007627028487e-01   +5.365770926847459e-02   +9.980847694878749e-02   -2.366062516064382e-01   -8.782473910444198e-03; +3.671665939411238e-01   -2.123369172786045e-01   +4.491455450156934e-01   +2.687102695379530e-01   -8.079248629563254e-02   -5.415471727062177e-02   -2.820107901592235e-01   -1.893868768821992e-01; -6.193293045502249e-02   +2.714010847309750e-01   -1.378696079353520e-01   +2.531834326760310e-03   +1.831026089954307e-01   -8.482308689175651e-02   +2.279533099679776e-01   +2.345380923110965e-01];
L3E_L2E_iAMPA_netcon = [-2.462225327890287e-01   -4.631029074106605e-02   +8.560242181546704e-03   +6.487585313317915e-02   +5.852911668707014e-02   +1.247982926790883e-01   +3.283803237392817e-01   +4.197146420707512e-01   +9.280654278793687e-02   +3.438077140790152e-01   +1.079608361363259e-01   +1.355323361479056e-01; +3.399635274990159e-02   +2.988542159938391e-01   +4.457762588010190e-01   -2.274067713517400e-01   +1.485672056258505e-01   -4.491261804754682e-02   -1.142566906815749e-01   -1.170387121658377e-01   +8.324241794887807e-02   +3.901481680855087e-01   +1.703414960359911e-01   -2.266067037861416e-01; -1.773481927785891e-01   +6.636665037181567e-02   +2.114750397043147e-01   +2.369272024276510e-01   -4.079892622028841e-02   -2.394820917438066e-01   +3.698996828126291e-01   -2.966423624854692e-03   -4.208338963083809e-02   -2.791954799781154e-01   -2.642414311278776e-01   -3.120060306915647e-01; +1.219482325548670e-01   +3.949588814518304e-02   -7.571136925826627e-02   -2.244425853946875e-01   +1.330211312003510e-01   -1.899337787301606e-01   +2.390758889787241e-01   -1.592091780945845e-01   -1.803145145463444e-01   -1.239298886732730e-01   -7.300917825321249e-02   +2.763977776310530e-01; -1.222969927031080e-02   +1.133138875989797e-01   +2.550775726832611e-01   -1.767993370135229e-02   -1.410619721541878e-01   +2.863554227305888e-01   +1.530641170850784e-01   +3.133585658316020e-01   +4.766537527215703e-03   -9.441158412019104e-02   +1.564933458872268e-01   -8.217409470656786e-02; -1.137556460044432e-02   -5.180031526080985e-02   +3.405205367131763e-01   +3.014471468991758e-01   +3.430337031528773e-01   +5.996281416476921e-01   +3.560518062851502e-01   +4.999088052353465e-02   -4.278789054104805e-01   -2.047549211317169e-01   -9.190934464424586e-02   -1.683616854693595e-01; -2.250270113052919e-01   +3.365306269523714e-02   +2.275768196987669e-01   +1.852246122878480e-01   +3.270706275968902e-02   +1.005166552158929e-01   +2.174662872579840e-02   -1.528248348087159e-01   +2.507941335701682e-01   -1.385508523279078e-02   +3.637416510107839e-01   -2.629346300420716e-01; -1.231171977361137e-01   -6.849765587102317e-02   -3.301244113630727e-02   -2.121903888235425e-01   -2.507312995022354e-01   +1.610272305224368e-01   -2.159245030740481e-01   -1.414709246217472e-01   -2.078535898085959e-01   +2.073442021255156e-01   +1.400041516980578e-01   -1.763674960322329e-01];
L3I_L2I_iGABA_netcon = [-1.414110120759250e-01   +6.439217822978315e-01   +1.963613826210407e-01   -3.731067806506146e-01   +1.183701396950993e-01   +1.446524133185615e-01   +1.383368259476759e-01   -1.842868814815657e-01   +1.698985765693410e-01   +3.727111252345989e-01   -2.428169410331372e-01   +9.318245952100726e-02; -3.384118190316502e-01   +4.796236491109140e-02   -1.538293736114304e-01   +2.161986003938386e-01   +8.764820031725917e-02   -4.010559248942429e-01   -1.907363936378102e-01   +1.254246165812192e-02   +2.338083651384298e-01   -8.496621958796037e-02   -1.699126566896597e-01   -1.636324049985758e-01; +5.117378152714530e-01   -1.957266860744628e-01   -1.279884426966506e-01   +1.652372033710029e-01   -4.612616193176177e-01   -3.567654040296468e-02   +1.025668306766378e-02   -7.612206331349750e-03   +2.629669632194616e-01   -2.942757362884401e-01   -4.954822958628005e-02   -2.882101888724836e-01; +5.317082353527841e-01   +4.098058742821670e-02   -3.588555656837876e-01   -3.974539202989188e-01   -3.720470001478558e-01   +3.316438951780638e-01   +1.585187364689040e-01   +4.482091935186276e-02   +3.691008023047568e-01   -2.108305476321214e-01   -1.914241358118089e-02   +3.436208672116738e-01; +1.468509013622070e-01   +2.050075796489789e-01   -7.853563635083023e-02   +4.281693364146257e-02   -2.472878776871043e-02   -1.142221370105443e-01   -4.057745610147803e-02   -1.181011560573715e-01   +1.026441349489891e-01   +8.925357183399180e-03   -5.880586169105928e-02   +3.439403443242596e-01; +1.604591441124977e-01   +8.913603206268779e-02   +7.318771717008524e-02   +4.682631393855234e-02   +3.155814437764032e-01   +1.613837649658776e-01   -2.268312150118657e-01   -4.377371624119928e-01   +4.509263522187278e-01   -9.853017344034679e-02   +1.679086614985264e-01   +2.168014521622534e-01; +4.665497741535671e-03   -1.079282969292947e-01   +1.026264948863817e-02   -3.039538976680468e-01   +2.716327117404509e-01   -1.672546408936595e-01   +1.677602240609862e-01   +2.255582904812711e-01   +1.106941000410699e-01   -3.451640804362051e-01   +3.085705674553500e-01   -2.939279196210403e-01; +3.889545424921126e-01   +3.650505190695945e-02   -2.130127456539835e-01   +9.694033923768561e-02   -3.579638127751152e-01   +6.179210340880169e-02   -8.158095165073243e-02   -3.239482559047766e-02   -2.597645529098193e-01   +8.674733153407495e-02   -1.846430770923659e-01   -2.600352009914255e-01];
L2E_L3E_iAMPA_netcon = [-1.008176585001972e-01   -2.064177451510136e-01   -3.283544182253851e-02   +4.217768179143687e-01   -3.157293660007109e-02   +1.864896055627148e-01   -1.481271493322013e-01   -5.561720690254870e-01; +1.230950605345963e-01   +1.279735831481192e-01   +4.438056088465618e-01   -4.430797526201933e-03   -1.305404108742036e-01   +5.368038487891069e-02   -3.069187317771051e-02   +1.170131012957238e-01; +1.274754039333380e-01   +3.651085561309637e-01   -1.859870513604516e-01   +9.351082771102862e-02   -1.059184333690172e-02   +1.978180268701650e-01   -1.469201550017874e-01   -6.938164189710830e-02; -1.307368947954793e-01   +2.265020705469739e-01   +2.633470583054012e-02   -3.540452157769332e-01   +1.710027055841909e-02   +4.316353766134775e-01   -2.684623753375902e-01   +3.026073910754903e-02; -4.162702946399418e-01   +3.605545034594710e-01   +2.636596395986842e-02   -3.477404459040713e-01   -2.930637558900466e-01   +1.071890526081279e-01   -9.855513507023056e-02   -2.392562559206561e-01; +2.827210164080917e-01   +1.161837261089179e-01   +1.586907630611288e-01   -1.031356872880960e-01   +4.497488383113111e-01   -2.438252987816469e-01   -1.170958718071486e-01   -1.695097325454814e-01; +8.772019947487865e-03   +1.752715629153799e-01   -2.633220610113271e-01   +8.036716087814873e-02   +3.302814040504147e-01   +8.693091819019241e-02   -2.951166851128418e-01   -1.688627380252586e-01; -2.575708004755563e-01   +2.689508682533618e-01   -2.264442452090702e-01   +2.172704052046552e-01   +1.004940223008391e-01   +1.836483564902383e-01   -4.468097590073827e-02   +2.664994475289071e-01; +2.391393916033436e-01   -3.029435530444000e-01   +2.283738844084525e-01   +1.259054214837332e-01   -8.665105866698516e-02   +1.055252412555618e-01   -3.692055998506997e-01   -1.246376166133853e-01; +3.868948488351525e-01   -7.947905088279750e-03   -2.012016479438662e-01   +2.134200463708461e-01   +2.251219347247424e-01   -5.299828611834219e-02   -5.994672668509698e-03   +3.410832342881037e-01; -2.361588906451923e-01   -2.476580522731572e-01   -1.016308795732135e-01   -2.663727753874577e-02   +1.623619783682978e-01   +2.846335867664690e-01   -6.503175978963016e-02   -8.600649743079163e-02; -2.801563463258846e-01   -1.401728139336884e-01   -7.705761988542066e-02   +3.878300775904745e-01   +2.650767537253126e-01   -5.234367756167460e-01   +4.852178207478272e-01   -4.188854905648588e-01];
L2I_L3I_iGABA_netcon = [-5.723044269748401e-03   +1.734961362558518e-01   +2.495884077975830e-02   -7.989230821369109e-02   +6.315974526053821e-02   +5.453248221816139e-01   -1.674314232046553e-01   -5.583662123698828e-02; -1.263771772169939e-01   +4.582789106989522e-02   -2.079610685626614e-01   -3.268770743443978e-01   -1.393967747006206e-01   +3.980907635122731e-01   +3.528569440479263e-01   -1.927666345367102e-02; +9.941973468109615e-02   +2.947156533043890e-01   -2.428792429779977e-01   +2.305303680943958e-01   -1.263953177266026e-01   -1.279735411369112e-01   +1.160664990972238e-01   -7.439363480254649e-02; -6.167088068622288e-02   +3.755021738737786e-02   +1.906921985186227e-01   +1.232641093069835e-01   -3.262876437171432e-01   +5.122363052858350e-01   +1.503120554790193e-01   +4.378732039349921e-01; -9.149235224015907e-02   +1.689031865558906e-01   -1.415339279685114e-01   -9.463741950279675e-02   +1.501648892850221e-01   -2.882406247562049e-01   -1.768339375627717e-01   -1.989266589400829e-02; +2.899780538692235e-01   -1.560287687390168e-01   +1.503865803143036e-02   +4.075441497740720e-02   -1.740411040769461e-01   +3.431004403622863e-01   +2.500620200032477e-01   -5.111868028966320e-02; -4.345330138354366e-01   +9.932633303030794e-02   -4.677155042604540e-01   +1.048514195528603e-01   -1.188247977878324e-01   -5.915227898533784e-02   +2.083883022593106e-01   -1.653531149373516e-01; -4.151396107537520e-01   -1.742668979678470e-02   -8.414894836160025e-02   +1.636367832586713e-01   -3.972357757104022e-01   -6.601350302580845e-02   -2.062971594828208e-01   +1.391561712539621e-02; -1.440184040647494e-01   +3.045005483507747e-01   -7.959754547725927e-02   -3.163860902488206e-01   +5.464436562399430e-02   +3.209381701133507e-01   +7.253289207562408e-03   -2.783140651424676e-01; +2.295428746087094e-01   +3.329617719206183e-01   +2.418545534661859e-01   +3.121073761852960e-01   +8.365150019926960e-02   -4.078134305315062e-03   -3.537231381116198e-01   +4.640364657777529e-01; +1.160928193700164e-02   +9.179258661739975e-02   -2.540962737720174e-01   -2.956696600166107e-01   +6.577986934547532e-02   -3.143518882652105e-01   +2.452151993463842e-01   -1.313392913199107e-02; -1.610415881959706e-01   -1.365184888441980e-01   -3.543764639304444e-01   +9.536459110605255e-02   -2.640808876192744e-01   -3.152288055670188e-01   -4.746385294611867e-02   +7.575451197179163e-02];
L3I_L3E_iAMPA_netcon = [+1.531879590293829e-02   -1.840924778434795e-01   -2.754341369081484e-01   -2.246913246770202e-01   +2.844866763631834e-01   +1.740655017509162e-01   +7.200935614515187e-03   +2.637925590122331e-01   +1.377906288931853e-01   +1.970944562483524e-01   -1.965967080668466e-01   +5.972211795568443e-02; -4.279125843008039e-02   -9.534565927595745e-03   +2.928603550121614e-01   -1.042256637299553e-01   +5.485486891083649e-02   -1.360906129575503e-01   +1.505657998462252e-01   +1.015851430537049e-01   -1.687316796253885e-01   +7.447577263216273e-02   +1.687400795495035e-01   +1.807635583727765e-01; +2.795899024482742e-01   -2.414240450274856e-01   +6.653807499107214e-02   -1.079441209399528e-01   +2.498744038345293e-01   -1.494024718340534e-01   +1.362081516407666e-01   -1.912974526831882e-01   -9.907219891458763e-03   +3.410193884481046e-02   +2.082119253909963e-01   +2.520339813390439e-01; -7.706580290342918e-02   -4.245541066842648e-02   -3.904623709265381e-01   +3.233570733664763e-01   +2.494392236073213e-01   -1.042246482134775e-01   +4.599569476933519e-01   -2.314847570879308e-01   +2.683528866439163e-01   -3.141931753188257e-01   +1.996130147310874e-01   +6.089606181699750e-02; +1.913795218593800e-01   -2.319857687682912e-01   +1.222969356187228e-01   +2.071913848899363e-01   +8.630436028219962e-02   -1.621851561278207e-01   +2.953283422950037e-01   +4.180349242052354e-01   +3.328505467496488e-01   +1.198243160990509e-01   -3.902553327355291e-01   +1.341500239461238e-01; +3.179446312208476e-01   -2.630674750962302e-01   +2.368251814000752e-01   +1.763891062309000e-01   -7.245124934367433e-02   -2.021651921515970e-01   -5.215405453084176e-02   +1.004142492719709e-01   +1.194309175284878e-01   +6.631143753558001e-01   -3.339439307912399e-01   +3.108095651372831e-01; -1.587813336103987e-01   -1.005367855688969e-01   +6.676370365048852e-02   +1.747188380967983e-01   +2.670291010485501e-01   +2.553174361984527e-01   -1.586292227494168e-01   -2.206810040157033e-01   +1.340759097040727e-01   +1.129126672227087e-01   +3.539122512233903e-01   +2.123275834826780e-01; +1.384713975695995e-01   -1.516913963539979e-01   +2.455978424275368e-01   +6.344375931503946e-02   +1.943334767637065e-01   +1.086231737720295e-03   -1.152695955936507e-01   +4.622720877285668e-01   -9.911256320646687e-03   -2.107550139740366e-01   -4.128612035091284e-02   +5.413146481984379e-01; +1.880048018539070e-01   -3.139993872052590e-01   -3.253072794750461e-02   +3.931011271293797e-01   +1.825815308423534e-01   +1.889367931000033e-02   -8.338108397889213e-02   -4.508222200689641e-02   -1.034709768653123e-01   +1.093087477148063e-01   +1.559191773280170e-01   +2.349688464726622e-01; +1.745479433629845e-01   -2.160521253261918e-01   +1.517895879057768e-01   -2.507467238770278e-01   +2.364105859716746e-01   +2.714148281638786e-01   +2.376913472907005e-01   -1.018700025148059e-02   +6.200553488391584e-02   +4.967322406716254e-02   -1.359634953827173e-01   +1.729560378982323e-01; +8.310060130896654e-02   -2.548622123902796e-02   -1.740236684831559e-01   +2.235391540051958e-01   -1.555106062151204e-01   +1.853105508869560e-01   +3.580214288632844e-01   -2.834274315507569e-01   +2.832944949089420e-01   -2.973282004207921e-01   -9.802862611937810e-02   +3.065224837566267e-01; +5.343950819947583e-01   -2.641038460201344e-01   +6.302347516315296e-02   +1.408868101140028e-02   +2.130777752704538e-03   -1.870685081762423e-01   +1.924320709330606e-01   -3.033139110814533e-01   +1.753488153846067e-02   -4.829368694294579e-01   +2.608355638789508e-02   +2.852169339982012e-01];
L3E_L3I_iGABA_netcon = [+9.180537078737259e-02   +1.230328743478140e-01   +5.660086132211389e-03   +2.023306761328016e-01   +2.200442961614554e-01   +1.483969950642142e-01   +3.405358013958956e-01   +2.518357315066795e-01   +3.774335426154684e-01   +3.314815443047969e-01   +9.431600936089661e-02   +6.071054231766793e-02; -1.193738221299411e-01   -3.543563791638158e-01   +3.156016420650498e-02   -7.277265995263091e-02   +7.051818698253620e-02   -4.099025566470445e-01   +1.192599882004943e-01   +2.858303023264877e-01   +2.873747253704168e-02   +2.494779709011859e-01   +1.008645336516501e-01   +7.735040335485166e-02; +7.370968193700585e-02   +2.249023360738531e-01   -2.417494788011130e-01   +6.501796795189921e-02   +3.617323445665052e-02   +6.000466604526521e-01   -3.576535371992029e-01   +1.876836747312399e-03   -3.342316012060308e-01   +4.408973421119788e-01   -8.434710021206168e-02   -2.902348514172775e-01; +4.188579619770010e-02   -1.087338084509466e-01   +3.104461915384157e-01   -4.229043531007167e-01   -5.481905766544583e-01   -3.091468726003483e-01   +8.972320638869784e-02   +5.190038460019972e-01   +1.762642734288784e-02   +2.911499815132077e-01   +1.631618644114081e-01   +1.738590226870727e-01; +2.265455492081548e-01   -3.690859882053585e-01   +2.647253018993170e-01   -5.929210596442751e-01   -1.634702594472350e-02   -1.034879654245702e-01   +3.358680041470782e-02   +2.940163081598376e-01   +3.063265762666491e-01   -1.587871756595462e-01   -2.175720944493526e-01   +2.913939058757602e-01; +3.094479892226549e-01   +1.067499974676576e-01   +1.179129245207415e-01   -1.876527241363082e-02   -9.048800634478163e-02   +1.543769038733320e-01   -2.421149264242420e-02   -4.594549766921049e-01   +2.107885497850837e-01   -3.580276782968550e-02   -1.413899173438531e-01   +1.257207247960171e-02; -7.696251643861789e-02   +3.725102737970032e-01   -2.008187410102277e-01   -3.878526016358658e-01   +3.590796757695944e-01   +5.284513851983828e-01   +1.713007947475337e-02   +2.201015572460359e-01   +9.233682780972539e-02   +2.476125963413407e-01   +2.827267632991883e-01   -1.611152080618350e-01; +3.361827310677409e-01   -2.445957175885217e-01   +1.604725235984597e-01   -3.563079319346747e-02   +3.001926648134958e-01   -3.485789714428339e-03   +1.658374827808057e-01   +3.177154195290660e-01   -1.597691685613873e-01   -2.701305554973500e-01   -3.681876395155784e-01   -2.812059037887444e-01; -1.307747803689432e-01   -7.734777059143455e-02   -4.967499927154594e-01   +1.738186618551726e-02   -2.678567411141938e-02   -2.764306655813366e-01   +4.052189838847376e-01   -3.177014510434784e-01   +1.984148489781458e-01   -2.010740208879983e-01   +2.410088433891257e-01   +7.673959752462044e-02; -1.301006880085430e-01   -1.735038741939705e-01   +1.581749603818428e-01   +6.044961799654175e-02   -8.616637716687275e-05   +1.862503790525925e-01   -1.685688838796766e-01   -1.486101761270414e-01   -2.584338429063641e-01   +1.327746202530092e-01   +9.550787513602230e-02   +4.550960887054206e-01; +4.203966867993995e-01   -1.052784338188802e-01   -9.605704405694142e-02   -1.369540256607042e-01   +3.469235009513818e-01   +1.997597939890011e-01   +2.353294788008002e-01   +8.799240443562339e-02   +5.721295719988581e-02   -1.870103251433598e-01   +4.128631352051513e-01   +1.353956184437914e-01; -4.864862755690168e-03   +3.314191634691442e-02   -2.391155749071678e-01   -1.120440747048714e-01   +6.957478580699433e-02   +4.651325280786003e-02   -3.275923103752451e-02   -9.612053913958776e-02   +2.465150652959716e-01   -2.723513946696275e-01   +1.654966933817658e-01   +5.599299586393999e-02];
L2E_Input1_iAMPA_netcon = [+1.188402061353126e-01   -4.115856387042653e-01   -2.573631441731441e-01   +3.514607346629163e-01   -1.727284434343603e-02   -1.529253868342046e-01   +3.643957236886062e-01   +1.104798388088077e-02];
L2I_Input2_iAMPA_netcon = [+6.045015812294921e-02   +9.254536579723081e-02   -3.220152775148576e-01   -4.491910746476734e-01   +3.881960892743655e-01   +9.628838004212406e-02   -4.028007695101973e-01   +7.488377465091789e-03];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
