function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.562297733818848e-01   +7.508038990160754e-02   +2.799823524114590e-01   +3.201188377321110e-01   +9.972070060998197e-01   +2.484806023601665e-01   -8.531965576120208e-01   +2.216033553650943e-01   -1.336575117150891e-01   +2.040250228870383e-01   -2.003155404935185e-01   -2.933833124419102e-01   -1.076810586224465e-01   -4.500186865825559e-01   -5.821449878700576e-01   +1.208446018192785e-01; +1.186235895531097e-03   -1.066586098284361e-01   +2.121587406743381e-01   -3.287734327426684e-01   +2.727972991383207e-01   +3.393753647752762e-01   +1.072990320846588e-02   +5.526116457127782e-01   +5.122955168390763e-01   -2.175703709728896e-01   -4.859116470251699e-02   +1.180715775007464e-01   +3.517439694856533e-01   +3.821927052992536e-01   -1.245405514121889e-01   -3.445297868075886e-01; +3.350768081400513e-02   -3.707150259552783e-01   +2.468469699323785e-01   -4.286389674160729e-01   -1.795036697361939e-01   -1.486625987121650e-01   +1.090320692401468e-01   +2.005863447500042e-01   -5.636077948779716e-01   +4.161640144107014e-01   +1.884486345337067e-01   +1.190560657681246e-01   -4.538760695927875e-01   -8.284190725327336e-01   -1.983499072985425e-01   -8.105305635978469e-01; -3.824285742872567e-01   +6.714768226534460e-01   +7.066511130725761e-02   +2.092380362584748e-01   +1.730717505828887e-02   -3.529503585763485e-01   +4.852419356052414e-01   +2.112887239960274e-01   +9.292501450385006e-02   +2.713347653083667e-02   -2.870462866139865e-02   -6.192782254326046e-02   +8.094072858714337e-02   +1.199752152347912e-01   +2.038793387156928e-02   +6.713397221034042e-01; +1.953078223970942e-01   +4.293746667646049e-01   +2.127680437093696e-02   +2.751726667655180e-02   +3.039063595200255e-01   +5.945947285873346e-01   +3.541057070115017e-01   +5.260413353471319e-01   +2.482776418912198e-01   -3.818367947478591e-01   +2.821984831621558e-01   -3.058895041045481e-01   -5.910031320885185e-01   +6.428597690181291e-02   +4.653533209931420e-01   -2.446887099937525e-01; -3.107788613326030e-01   +6.555466382485010e-01   +2.422286236612903e-01   +5.807911158141792e-01   +5.434071675818040e-01   -3.967190949850208e-01   +1.801536368608271e-01   -4.487162734353366e-02   -1.850510273585178e-01   +9.386488012270727e-02   +2.538112791461859e-01   -2.037553190804878e-01   +2.946417473327516e-01   +4.491701684157137e-01   +4.629675382972687e-01   -3.017925664163654e-01; -4.991772600080746e-01   +6.841506058553749e-02   -5.835176594953200e-01   +3.122802520882940e-01   +3.516736514434251e-01   +7.878297352804630e-01   -4.936788003990057e-01   +8.293723915506437e-01   -1.256522315985666e-01   -1.125429367323683e-01   -4.085243368275315e-01   -2.209856715494814e-01   -9.510396380051481e-01   -9.904783627127278e-02   -1.535586309826450e-01   +1.225714717651926e-01; +6.978564869765985e-01   -7.966308170199466e-01   -7.793518112548312e-02   +4.619341053291625e-01   +4.244343911264513e-01   -2.512027733815809e-01   +7.973502152786603e-02   -1.557424287237637e-01   +7.791946745311504e-02   +1.032191732114640e-01   -4.325539831308643e-01   -1.703543899560508e-01   +3.594553753122354e-02   -4.497789661039560e-01   -3.827564896374604e-02   -4.910355048359201e-01; +6.871936133458131e-02   -8.549103465550073e-02   -2.003066531446452e-01   +2.858667569971631e-01   +3.227145366466942e-01   +3.305579797613621e-01   +2.595410732921323e-01   +8.125047013276439e-02   +8.088959434307664e-01   +9.563626661368994e-02   -1.457749022791761e-01   +3.732057920266219e-01   +8.880061874646100e-02   +6.991615693308731e-01   +9.025738312833080e-02   +5.282290234571138e-03; -1.624995527578917e-02   +7.715849559782116e-01   +6.051986555904522e-01   +8.688517332389523e-01   +7.910821010918021e-01   -3.319461102782839e-01   +4.141413935372492e-02   -6.883529869633166e-01   +6.577390650415234e-02   -1.395403041910871e-02   +5.203744306848047e-01   -3.223997556015153e-01   -1.536219799370339e-01   +5.911610973806715e-02   -2.066678506914620e-01   +2.957015563812525e-01; +4.192497974748245e-01   -3.982113593616707e-01   -2.849269462551139e-01   -4.982659867949763e-02   -1.171022826890379e-01   +2.725829966841941e-01   +6.952930516456213e-02   -5.131804081033797e-01   +5.820738670411429e-02   +5.882348751177018e-01   +3.575601581417794e-01   +6.398561799078676e-01   +4.301290623096466e-01   -5.950338574250945e-01   -2.053656221042064e-01   +5.355547746836621e-01; -1.300076854630754e-01   -8.091295595774763e-01   -3.903744985159281e-01   -2.895618898519339e-02   -1.395721213310688e-01   -4.660388133421744e-01   -7.335569360541416e-01   -2.651740938896219e-01   +3.636968771960851e-01   +1.084019842542824e-01   +9.912421143352373e-01   +1.708399832503791e-01   -3.376533354110186e-01   -4.428248132661215e-01   -1.281660970019583e-01   +2.605409826701107e-01; -7.379168381020168e-02   +2.344513889403036e-01   -6.040405799358807e-01   +2.998469455978434e-01   +1.132089055155648e-01   -5.411230030375016e-01   -1.069015553132071e-01   -2.846315367625336e-02   +1.261699334063965e-01   +1.707528661702026e-01   -4.816622611085158e-02   -4.384966585647532e-01   -3.374835018934854e-02   +4.469837029344857e-01   +4.422082096507818e-01   +4.512266947451484e-01; +2.336655293964060e-01   -1.364834456641945e-01   -2.081872350399627e-02   -7.483283060314986e-01   -6.534171454618281e-01   +9.012967649666233e-02   +4.013466621684301e-01   -5.126525616600500e-01   -3.774943333530270e-01   -4.747218736183751e-02   -1.472739201376748e-01   +1.128815225071301e-01   -7.400896517392988e-02   +4.205314631215601e-02   -1.000000000000000e+00   +4.176417154914935e-02; -2.917884775964844e-01   -2.047490709402479e-01   -5.179113976453762e-01   +3.838532085152969e-01   -2.148407548965826e-01   -2.180587332044599e-01   +4.615272041648123e-01   +7.578575683293262e-02   +1.261798246089320e-01   -4.935053515842901e-03   +1.656088510881062e-01   -1.425093403015876e-01   +7.851552428477238e-01   +1.771236858041139e-01   +5.302936161434504e-01   -4.220754562790168e-01; -5.985014321015069e-01   +1.393638214758607e-01   +4.162179339408217e-01   +1.568398640554309e-01   +9.847465099824153e-02   +4.444400514289827e-01   +5.173921478117793e-01   -5.881263181703295e-02   +4.432888033148538e-01   -3.444987207848538e-01   -1.402696084115893e-01   +1.513780947449536e-01   +8.964809832907783e-02   +5.033079322649036e-01   +3.097763208919407e-01   -2.002258395634987e-01];
L1E_L1I_iGABA_netcon = [-2.820254005803657e-02   +2.565150512082733e-01   -2.444585871008488e-01   +1.346838896449179e-01   +5.602120972400416e-01   +4.882719143015640e-01   -4.380100990477216e-01   -1.847295937760768e-01   +5.189915762828572e-02   -4.324745567076845e-01   -6.426206144979854e-01   +1.608835517013852e-01   +2.788813023992187e-01   +5.952698227978610e-01   -6.390666045241459e-01   +1.885287527637836e-01; +1.369013483402780e-01   -1.493954990610077e-01   -4.879337845309094e-01   +1.493520546373000e-01   -3.396721806113492e-01   +1.739263955392385e-01   +7.295540181236677e-01   -5.357727414565234e-01   -6.145985585610348e-01   -4.077854591174425e-02   +3.377542283363426e-01   -5.197972141069887e-02   -1.115443365964843e-01   -3.652112706669408e-01   -3.822758529152827e-01   -6.461209912567542e-01; +4.994401315316421e-01   -4.242812560931387e-01   +8.365999556395525e-01   -9.760053879581598e-02   +1.176605177945352e-01   -5.315063027186263e-01   +2.972709822900266e-01   -1.707375597009783e-01   +7.946109919308443e-03   +3.889300882332497e-01   -1.895417840847183e-01   -2.556007820317203e-01   +6.495244575155786e-01   +2.933465764605154e-01   +7.849560813747767e-01   +4.482579316787502e-01; +1.045570642891897e-01   -4.965211234481188e-02   +2.099864707201110e-01   +2.143237701341655e-01   +6.114992085678682e-01   -2.914401127203474e-01   +7.059562660059757e-02   -3.206497035407542e-01   -5.063000088866149e-01   -3.131032053138277e-01   +1.319850257106865e-01   -1.656234568456921e-02   -9.105811801431948e-02   -7.785151724585495e-01   -1.116714239045951e-01   +6.853591057205131e-01; -3.384158756185018e-01   +2.422076311199818e-01   -2.063887803678182e-01   -2.902473936034851e-01   +3.592874619096486e-01   -2.135647925125087e-01   +4.378973348947884e-01   +4.098311510342850e-01   -2.493625695360541e-01   +2.315637717870229e-01   -3.914722056893734e-01   +2.001064048419819e-03   -3.228638018078592e-02   +8.091375379908929e-01   +1.490586566938869e-01   -9.581020240702260e-01; +4.710425809546858e-01   +5.102626933504794e-01   +2.835636447886697e-01   +5.379695371480802e-01   +2.399473568343529e-01   +6.094906267351421e-01   -1.055800528560542e-01   +2.431616933118581e-01   -6.671956828090107e-02   -5.437745585812710e-02   +5.872829527023412e-02   -2.666065444430944e-01   -3.595227710691911e-01   +6.167957483245825e-01   -1.004462045392974e-01   +9.554675487759209e-02; +1.091974852612863e-01   -4.963722491849900e-01   -2.746968804850924e-02   -4.321057631654310e-02   -5.281701078396237e-01   -1.604091169561986e-01   -2.239432550647652e-01   +7.083168819400881e-01   -4.705391711348440e-01   -9.377934198578632e-02   +5.370890736415952e-01   -1.678310642099684e-03   +4.998407513580424e-01   +2.051776872469411e-01   -2.070203171920403e-01   +6.907903094627990e-01; +3.011406903020040e-02   -1.994305211860594e-01   +3.387117202187360e-01   +3.593827812347949e-01   -4.215413553155490e-01   -7.810024278074154e-02   +1.030760523113805e-01   +3.030429413314744e-01   +2.586973240792962e-01   -2.385530260779647e-01   +2.685999187063153e-03   -4.994230024799091e-01   +4.148457858192992e-01   -3.464318372193442e-01   -2.099300909609697e-01   +7.751475998947804e-01; +9.736091447190801e-02   -3.132937362000833e-01   -1.318665402944991e-01   +3.374008034251489e-01   -3.385786662614536e-01   +2.891732808365672e-01   +4.228266588553730e-01   +2.137646591982940e-01   -7.017588317529753e-01   -5.992142037990809e-02   +1.541461646751038e-02   +1.645978745244749e-01   -7.363584819123257e-01   +5.555234732133555e-01   +7.425365101163912e-01   +1.267853764229297e-01; -1.328809853448870e-01   -2.954860653432356e-01   -2.524228342984360e-01   +2.919907618471506e-01   +2.263096993443145e-01   +1.925525363603188e-01   +6.403554640105425e-03   +4.955347965766812e-01   -3.159319271907585e-01   +5.381256402139589e-01   -4.598633023603598e-02   -2.267314440645471e-01   -2.675171317463997e-01   -2.281429580148840e-01   -2.305567345457253e-01   -2.789584738844264e-01; +3.379170444049493e-02   +1.086189534505217e-02   -5.487845560673501e-01   +1.793074859121262e-01   -4.667535937591754e-01   +6.748242801028282e-01   -4.743618860182654e-01   -4.597203992952150e-01   +3.996483634485853e-01   -2.568792329605638e-01   -5.234410586670415e-01   +6.083921556879769e-01   +3.588846062867572e-01   -1.224589942880016e-01   -1.024982844912186e-01   +4.109137445334752e-01; -5.891645438059730e-02   +3.030139689688532e-01   -3.733695655447046e-01   -8.547770780168565e-01   -3.760243269689311e-02   +3.861879460631287e-01   +1.676246506941443e-01   -2.431094681259490e-01   +7.429679113850804e-02   +4.089578345664518e-01   -3.391252092072970e-01   -3.172066762765003e-01   -2.213118732918637e-01   +6.350377674271157e-01   -4.743114824249561e-03   +1.481629936858128e-01; -1.163875879334959e-01   +4.255583693542443e-01   -1.907968436975694e-03   -1.061119449987702e-01   +8.063529704947914e-02   +6.099979585940923e-01   -1.915299462430215e-01   +1.303678693866356e-01   +5.383799341789084e-01   +3.110731328850866e-01   -2.501746560576328e-02   +1.774264565225822e-01   -1.887214280488491e-01   +1.133278085142799e-01   -1.000000000000000e+00   +1.651891772406630e-01; -1.403911993107432e-01   +2.863293123143293e-01   -7.049613774646485e-02   -3.436289204386039e-01   +3.242608957158721e-02   +2.761254793761448e-02   +3.397812400730860e-01   -6.215590654228395e-01   +2.009301186393395e-01   +2.808784859771696e-01   +1.060102768850986e-01   +7.347223845186390e-01   +1.372458560899225e-01   +2.947350568614099e-01   -6.904595019297316e-02   +1.340925622069002e-01; -1.564059449747294e-01   +1.353553650167220e-01   -5.159143625714556e-01   -7.377341810957988e-01   -7.148603381555688e-01   -2.916966028987306e-01   -2.704786543600953e-01   -2.890561638180126e-01   -2.048004134926896e-01   -2.043743204992258e-01   -4.167756209563578e-01   +2.150698498061978e-01   +1.312656300312033e-01   -2.829088006317544e-01   +3.319557496596070e-01   +2.298724243161880e-02; -4.459609112106018e-01   -4.947597419886264e-02   +6.353534058880915e-01   +2.867653940153705e-01   -5.248167724018354e-01   +3.989230373611672e-01   +2.477000831291691e-01   -5.380883610754875e-01   -4.779138023106402e-01   -3.858757767990236e-01   -8.878987478681816e-02   -6.011143698187569e-01   -2.976896434870055e-02   +1.867784480768821e-01   -2.268045567242373e-01   -4.084617226523127e-01];
L2I_L1I_iGABA_netcon = [-3.285839515678242e-01   -8.130045274694729e-01   -5.923364093579230e-01   +2.994014476208604e-01   -4.306666960306139e-01   -8.831726082113976e-01   +8.934129261050755e-01   -1.161730468730913e-01; -6.776399517763434e-01   +5.452595406566930e-01   -5.760587228953242e-01   -5.942380765851791e-02   -1.114270092722430e-01   +6.195299325098707e-01   +1.529424579401172e-01   -2.560796847316029e-01; -4.773802913297566e-01   +1.907654593200386e-01   +2.532501917822265e-01   +8.848012563169138e-01   -2.043939529114139e-01   -3.071789747410691e-01   -2.615729680111556e-01   +7.756287063475692e-02; -3.794143403888164e-01   +4.037491303007713e-01   -1.941192111543837e-01   +4.353890165905078e-01   +2.683478091819562e-01   -5.638482319774142e-01   +2.649512325452776e-02   -5.669551925213384e-01; -1.781070996786779e-01   -1.228898846879716e-01   -2.098893617972930e-02   -2.387915361492036e-01   +2.993614045899213e-01   -6.117491374626447e-03   -1.635870848444818e-01   -1.522030504772076e-01; -1.153539200446609e-01   -5.903603602828938e-01   -1.911398382256070e-01   -2.807015276491326e-01   -4.449118941189663e-01   -3.891852461068028e-01   +1.825179535125710e-02   -3.493170477299774e-01; -1.551593397046943e-01   -2.012497621307198e-01   -3.792453180461757e-01   +2.280164878584825e-01   -1.206213371493059e-01   +4.610463055967672e-01   +4.019562629295982e-01   +3.707591709802921e-01; +1.878576441249812e-01   -3.489971132438471e-01   -4.577495037188880e-01   -5.614723139665533e-01   +2.006102942631097e-01   +8.094854123936125e-01   -3.410554398577294e-01   -8.026582490109349e-02; -7.216565110457548e-01   -3.517097671593558e-01   -7.623884463361482e-01   +2.040258591212065e-01   -5.241242232992235e-02   -4.203531006168894e-01   +2.860868734594318e-02   +4.846272515214986e-01; +3.749587341863022e-01   -1.653441902103781e-01   -1.448666106720811e-01   -2.835081826797095e-01   -4.912903859695891e-02   -9.733486507697985e-02   -1.060499140997578e-01   +5.569707088612887e-02; +2.285316429852770e-01   -7.422107714949944e-01   +5.109084952180795e-01   +3.079269973638775e-01   -4.536050131882545e-02   +4.642774578686685e-01   -7.332053335662526e-03   +8.234008759812554e-03; +2.528378188550139e-01   -4.223647695730343e-01   -6.282195705863509e-01   +1.821368810500896e-01   +1.927513143948596e-01   -3.098042738553541e-01   -3.062670113388118e-02   -8.501597063444358e-02; +2.292703874862246e-01   -8.900400824578892e-01   +5.832722747418676e-01   +5.767295518767805e-01   +5.687566406766796e-01   -2.326451066972248e-01   -7.265751604191339e-01   +4.470044519118272e-01; -2.301247628940422e-01   +1.987613422922362e-01   +2.992660565505426e-01   +3.974658117704093e-01   +4.281026194505740e-01   -4.561730265429774e-01   +1.467197707845776e-01   +2.017792734765888e-02; -1.749723218826515e-01   -7.401321617397826e-01   -1.280963018570003e-01   -4.027393239091082e-01   +7.230615639840707e-02   +1.755812932339250e-01   +3.878459615896510e-02   -5.027994287871700e-01; -1.000000000000000e+00   -4.624187518383692e-02   -2.592841157195295e-01   -2.566479560554723e-01   +2.233600878584225e-02   +4.768848095284984e-01   +3.861530890385907e-01   +9.949896170177572e-02];
L1I_L2I_iGABA_netcon = [+8.239169437019982e-01   -1.790714966591643e-01   -6.573803073353857e-01   +5.938845485858387e-01   -3.509038134242235e-01   -6.364270789911874e-01   -5.864796488968663e-02   -7.642182436247809e-01   +7.376669222238585e-02   +3.465041612512310e-01   -4.050550822449333e-01   +4.133731819706757e-01   -1.650112753229714e-02   +1.214427831683563e-01   -1.942033943109617e-01   +4.391267296514509e-01; +5.117736305139140e-01   -2.377040631381937e-01   +9.236608445163906e-01   -1.677855679938223e-01   -1.908871919496496e-02   -6.305243911907800e-01   -2.110132137134603e-01   +4.030949683346819e-01   -7.535287558807254e-01   -3.392694490779108e-01   -2.868873342496726e-01   +3.918110076870940e-01   +5.334908978426650e-01   +2.288841980918232e-01   +1.083908647807137e-01   +1.567879475122359e-01; +2.527391925468270e-02   +8.354562675905363e-01   -6.901980107013014e-01   -9.835057618868437e-02   -7.080643675133902e-02   +1.812057513236252e-01   -4.051634869073608e-01   +2.320095855102957e-01   -1.897189838409967e-01   +7.490312289379627e-01   +5.493409184162340e-01   -1.774265538631743e-01   -1.547953583845324e-02   +9.445970599182921e-02   +1.989537576028478e-01   +4.130929171802450e-01; +3.579822913994179e-01   -5.081534342470250e-01   +1.656353609041143e-01   +2.364712295297222e-01   -1.004473869169140e-01   -1.544131292490941e-01   -4.508187038373940e-01   +2.533645234770298e-01   +2.650255717850498e-01   +3.424333850032388e-01   -1.507506096276159e-01   +2.189466682578343e-01   +4.361767412773541e-01   -1.489565775794580e-01   -2.913085957236812e-01   +8.874314009966020e-01; -5.017806538525809e-01   +3.995299238853771e-01   -6.757415368119860e-01   -7.043334753475875e-01   +4.587231252012242e-03   -5.284972840296552e-01   +4.694252632665433e-01   -1.663330911081706e-01   -6.837453481478257e-01   +7.730335706570187e-01   +5.857822216148056e-01   -5.264163449825838e-01   +2.243832853323199e-01   -4.682744275391189e-01   +5.864004788931617e-01   -4.344087215594883e-01; -1.194419983331283e-01   -5.308538299621673e-02   -6.173175631822789e-01   -4.007410517959366e-01   +7.503447277277453e-01   -3.218706485860216e-01   -7.926050547067412e-02   +4.886470250074776e-01   +2.217946465006255e-01   -3.666207970594767e-01   +1.606827243102010e-01   +7.095662009052564e-01   -4.229047864529108e-01   -6.554735118802234e-01   -6.199806010333400e-02   -3.554297070558788e-02; -3.239594452914025e-01   +3.797163237301479e-01   -2.950319570942821e-01   -6.938523696664038e-01   -6.671708694619063e-01   +2.194360792068997e-01   +4.397408924827466e-01   -3.843045600455044e-01   -1.841068576710714e-01   +2.950003538893585e-01   +1.959965252662532e-02   +3.669810250671779e-01   +1.155254499517367e-01   +9.912686450818365e-01   +6.286394336437144e-01   +6.319118641099867e-01; -3.116927135157654e-03   -5.320037553768451e-01   +9.594735939908738e-02   +1.627580011049839e-01   -6.020592005287790e-01   +3.697271576319172e-01   +4.161568379401926e-01   -1.847794776973932e-02   +9.015546240221547e-02   +5.334807276018125e-01   +3.284774591929567e-01   -7.604442052370439e-01   +9.996572084412209e-02   -6.976772738203860e-01   -4.080797188315387e-01   -3.960944871563973e-01];
L2E_L1E_iAMPA_netcon = [-2.104081705396729e-01   -1.547676950618797e-01   +4.072065585152297e-01   -2.801264734071696e-01   +4.079853650213340e-01   -2.114869988282154e-01   -2.917234184302364e-01   +6.255739749977884e-01; +1.543561107126709e-01   -5.130199274643162e-01   -5.120115147694531e-01   +1.758122224668885e-01   +2.370210890325101e-01   -4.544099818897131e-01   -2.555810981324722e-01   +1.250302034212222e-01; +3.431727806788309e-01   +1.986448942522359e-01   -4.709346209679658e-01   +4.417533647720599e-01   -1.459091070287588e-02   -7.503383670124352e-01   +3.965303219027297e-01   -1.561130641995202e-01; +2.173486374052154e-01   -3.843435583121220e-01   +3.376036035908356e-01   -5.596784639260700e-02   -4.614470062437984e-02   -2.119722838243859e-01   -5.182197154709820e-01   -2.125735002335909e-01; -3.804012474468824e-01   +3.898047696151274e-02   -1.828467454139058e-01   -2.190774509792501e-01   -7.010649890699618e-01   -2.120984599928451e-01   -1.185865119732323e-01   +1.744013247774142e-01; +2.270871395067946e-01   -1.975627433359626e-01   -9.502702019556160e-02   -3.342245578846989e-01   +3.411033778375511e-01   -5.859548669077631e-01   -2.136463633013022e-01   +2.208491355345341e-01; -7.170005966917661e-01   -3.110200564639264e-01   -8.223281026533698e-01   -7.436032634818569e-01   +1.903245911221415e-01   +5.565893821954285e-01   -5.390712079488442e-01   -5.025497328455455e-01; +7.020829768020073e-01   +1.157032338149130e-03   -2.155952774931428e-01   +3.254019758208210e-01   +2.704149381780309e-01   -3.252791274001435e-01   -5.775811170772516e-01   +4.157863544962787e-01; +7.292067364041517e-01   +7.060202600959281e-02   -3.325810767670108e-01   +5.373851324088174e-01   +7.257253275687511e-01   +6.793012083852933e-01   +1.125730479214142e-02   +9.390211865549997e-03; -4.174464129483213e-01   -3.251946017286222e-01   +4.353028837539950e-02   +4.152331662042909e-01   +3.213408954813285e-01   -5.632297081968144e-01   -2.430775200341200e-01   -3.220420346673771e-01; +4.851551506581407e-01   +7.056886822367571e-01   +1.938986362937051e-01   -6.545279963618422e-04   -1.403230890943497e-02   -3.151688413085336e-01   -2.152778960458566e-01   -6.472347633279139e-01; +3.220176225734608e-01   -4.918531771850675e-01   +3.954588233935575e-01   +6.083827353196748e-02   -4.378049698406928e-01   -5.314078617686464e-01   +3.369756020923669e-01   -7.612912357146464e-01; -2.028309475544030e-01   +2.868093315748328e-01   +1.000000000000000e+00   -3.349186536229550e-01   +1.653843568858550e-01   +5.974293481922951e-01   +3.210953429668741e-02   +3.649906863106163e-01; -5.751599997487995e-01   +2.190407359362019e-01   +2.405923000240690e-01   -6.075378269391377e-02   -5.361879957355451e-02   +5.017565502739967e-02   -1.327676607314427e-01   +1.773079403990822e-01; -1.668719536161678e-01   -9.869162940447772e-02   -2.840026603763243e-01   +1.282623284819584e-01   -1.119713094312142e-01   -9.588047754401556e-01   +3.325528365195163e-04   +4.274310260321903e-01; +2.408700309649336e-01   +4.799066389810575e-01   -3.148517871155126e-01   -3.552967416158893e-01   -5.341471618078116e-01   -7.950924165271157e-01   +6.958230132782264e-01   -1.646973391323593e-01];
L1E_L2E_iAMPA_netcon = [-3.165081533676712e-01   +5.401239228576351e-01   +8.008847931372982e-01   -2.636311192596834e-01   -1.756987095439346e-01   +3.745390677745092e-02   -3.406998164703692e-01   -1.363957707885783e-01   +1.554115722247321e-01   +5.271473747088310e-01   -8.253973664429050e-02   +3.854918900721503e-01   -7.785544324117250e-01   +1.730295311256436e-02   +3.245881223772921e-01   +6.149500477990345e-01; +5.679541029276662e-01   +3.250298308884580e-01   +6.525312060727104e-01   -8.613439976551266e-01   +5.778580517065628e-01   +5.500587889994630e-01   -5.464012085713931e-01   +2.489077794858439e-01   +2.489849608613906e-01   +3.282377482938663e-01   -3.064844027946790e-01   +1.822704324133473e-01   -3.795907755913766e-01   -7.788306693076463e-02   +4.657830990843074e-01   -2.024905789309007e-01; +1.069856904764645e-01   -2.525902352715804e-01   -4.366211409314040e-01   -1.654729397991457e-01   +4.836530597504793e-01   +5.070561970099402e-01   -4.836126740121130e-01   +5.032492778836228e-01   -4.899882013523068e-01   +1.511385103412148e-01   -2.063292601800557e-01   -1.042317438944051e-01   +1.475660263331388e-01   -7.899218022300070e-02   -9.649203890840680e-01   +4.268071355279902e-01; +7.196240662638933e-01   +6.651667420892172e-02   +3.585197238584854e-01   +1.039351996267783e-01   -1.312934103641623e-01   +2.349773867048985e-01   +2.109350520591942e-01   +2.198903444940716e-01   +3.094331176832688e-02   +2.274216525815145e-02   -4.817795906585849e-01   -9.190967051945035e-01   -5.380371146605007e-01   +3.040883610976711e-01   -8.189898325794707e-01   +8.201901875347907e-01; -2.369573766595525e-01   +3.249068175151170e-01   +3.317326528801438e-01   -1.427899637139431e-01   +1.951160654269242e-01   +1.985141084535903e-01   +2.983996332215387e-01   -3.358473721944578e-01   -9.854260945976587e-02   -1.530296305341694e-01   +5.860668851688070e-01   -2.445731469510068e-02   -2.976832763608085e-01   +5.761692572979041e-01   +2.856684581970984e-01   -2.003385510018962e-01; +3.956060542169917e-01   +9.761412988206846e-01   +6.085604542758849e-02   -3.358797034454205e-02   +6.367030199696538e-01   +3.893322360405904e-01   +9.101679366242155e-02   +1.017741952496654e-02   +1.875724396098008e-01   -3.184998806868564e-01   +3.151933490949833e-01   -4.063792169520949e-01   +8.283897225184006e-02   +4.417291764433418e-01   +1.554484927995861e-01   +6.605076072551963e-01; +2.696804172672054e-02   +3.392627985264122e-01   -8.421409864087752e-02   -2.321768636315554e-01   +3.301885306419535e-01   +2.914937144876195e-02   -7.058134112411752e-01   -6.478208097967908e-01   +4.238583888808516e-01   -7.392030668045285e-02   +9.670895178788222e-02   +2.304438175287142e-01   -6.159507839265629e-01   -5.778388453663299e-01   -2.371953096483775e-01   +3.155321933825097e-01; -1.888564363807820e-01   +2.022934744802933e-01   -6.823049415760660e-02   -4.867597468153653e-01   -6.138303592909667e-02   +3.027908439231149e-01   +4.810272628262574e-01   -4.839044990886332e-01   +5.343757401894408e-02   -5.614178770655290e-01   +4.053993681933518e-01   +1.317781736337825e-02   +2.013755019509940e-01   -2.061900569191485e-01   +1.973279828702675e-02   +4.682757316131297e-01];
L2I_L2E_iAMPA_netcon = [-2.086561788085301e-01   -7.353834245959604e-01   -1.845042879363103e-01   +1.753967375276077e-01   +1.538195228791559e-01   +2.884191783424866e-01   +4.123298220425838e-01   -3.389620499858209e-01; -7.336812491331430e-01   -2.218639922926965e-01   +5.422296552333932e-01   -3.204874661924916e-02   +5.503691852689500e-02   -3.003360460370681e-01   -3.480953994872995e-01   -3.112715179805120e-01; -4.211740233474222e-01   +2.848151105765603e-02   -4.956718983012701e-01   +4.437476269322126e-01   +2.865972694230040e-01   +1.227380160082130e-01   +7.714871557034840e-02   +3.125785035466944e-01; +5.555264094313588e-01   +4.067995347451497e-01   -3.670633492381974e-01   -4.529066937425572e-01   -4.495871778393147e-01   +2.168780021623409e-01   +5.886492153442339e-01   +3.235801934138801e-01; +1.000000000000000e+00   +5.912243649123777e-02   -2.948792320914366e-01   -1.487606550350811e-02   +3.543777452879888e-01   -1.300118042859994e-01   -4.480060008710937e-04   -4.248833609154441e-01; +3.744616994205973e-02   +4.815852254132865e-02   -5.459752595746727e-01   +2.000176325655355e-01   -1.551468997814764e-01   -6.284391239267493e-01   +4.872970829229420e-01   +1.563841552402192e-01; +5.467215020662820e-01   -7.471530731046542e-01   +2.669610304785681e-01   +1.418649796466895e-01   +2.263454853926216e-01   -3.773166455003858e-02   -1.925945175996046e-01   -1.458214054034791e-01; +9.369432922552083e-02   +3.606785878798486e-01   -4.939249164131395e-01   -5.021305275658327e-01   -5.168821543173162e-01   +1.576200051348669e-01   +6.340956774531094e-01   +1.552143308415863e-01];
L2E_L2I_iGABA_netcon = [+1.238379788138572e-01   -9.336460593726411e-01   +2.677111945247921e-01   +6.984523511401945e-01   +4.918572925868756e-01   +5.470057315173601e-02   -5.145763103195905e-02   -3.737946928797013e-01; +3.736156315814633e-01   -4.655063142608117e-01   +3.317124204949420e-02   +6.809940243632521e-01   +1.606673469757538e-02   -3.991705798616103e-01   -3.405248835012379e-01   +3.410386157735145e-01; +4.576416126719408e-01   -2.990335487498251e-01   +1.838620814904773e-01   +1.791325177962053e-02   -7.429781796981881e-01   -6.072319054364325e-01   -3.167655708089719e-01   -2.881428370056375e-01; -7.289702069355976e-03   +2.104428348528920e-01   -1.540101361281833e-01   -6.902411600098321e-02   +8.076706936986763e-02   +2.779364900087031e-01   +1.310705370819681e-01   +5.449840595420084e-02; +3.628688232214454e-01   -1.438301768465165e-01   -2.458333945643640e-01   +1.486695859988470e-01   +6.397027191818493e-01   +5.575085437013206e-01   +3.121220737506263e-01   +4.131075036849066e-01; -3.993345040290718e-01   -2.285599342590986e-01   -3.893992302127572e-01   -1.000000000000000e+00   -8.268173043821291e-01   -2.151029927753605e-01   -3.284502291358461e-01   -1.696382737631655e-01; -7.597936157064600e-02   -6.714106882117953e-01   +2.637524070555295e-01   +5.791475239889553e-01   +2.956854232460266e-01   +5.252495571172762e-01   -7.088587061763765e-01   -4.190158536015942e-01; +4.778343537482998e-01   +3.727590179969895e-01   -1.057020676939020e-01   +1.567225233632178e-02   -3.099523033334100e-01   -7.239814681849955e-01   -3.325299221430121e-01   +1.234959569942767e-01];
L3E_L2E_iAMPA_netcon = [-3.747414080795634e-01   +1.000000000000000e+00   +3.185994769558407e-01   -2.279899069474126e-01   -1.093427792204896e-01   +4.080547330469547e-01   +4.262931722377521e-01   -4.783305732928563e-01   +4.569045809993870e-01   -2.647487990413869e-01   -2.465999657469900e-01   +5.792586494408569e-01; +2.793794626623973e-01   +3.504344843134142e-01   +6.488256382974944e-01   +6.517189168145071e-01   +1.509004114674748e-01   +6.286585705515724e-02   +5.278223134780608e-02   +3.978162388491236e-01   +3.841274477197639e-01   -5.837648816100253e-02   -4.192629335053793e-01   -2.237566122226223e-01; +3.086744668965765e-01   +1.373394341250661e-01   -4.687414782607608e-02   +7.476184591549254e-02   -1.797136011489592e-02   -1.818787339477077e-01   -4.850528349674743e-01   -6.698592084511603e-01   -3.832240080765935e-01   +2.203592986823731e-01   -4.132920790524560e-01   +1.656487299549598e-02; -4.036703654873022e-02   -2.837562470904191e-01   +2.079434454265084e-01   -2.817704591608312e-01   -4.484358263250644e-01   -3.230766247802097e-04   -7.896238871909468e-01   +3.200402960637003e-01   -5.015466618262694e-01   +6.343154085327117e-01   +5.810791848246674e-01   -2.146336301185931e-01; -8.975109286194860e-03   +4.915858392479035e-01   +5.492022470285545e-01   +7.726387545841208e-02   -9.571010250714941e-02   -7.537319652500088e-02   +9.848696535653921e-02   -1.324565852916026e-01   -1.457717401086696e-01   +4.634524826800354e-01   -4.847770952990864e-01   +5.409307149440811e-01; -2.229076065496157e-01   -3.456350710681192e-01   -6.757613103715806e-01   +1.319252803736017e-01   +3.446511037872493e-01   +7.188999237207524e-01   -1.821331024344358e-01   -7.029649232040004e-02   +2.782589627574034e-01   -6.448158718775669e-02   +6.767621774955795e-01   -5.533143405334667e-01; +8.306056430559089e-01   -6.242838191922687e-01   -4.226659488348643e-01   -1.818175069130429e-01   -5.144259031607680e-01   -1.974446693550075e-01   -6.559494433914204e-01   -1.462986920032871e-01   -5.994891776757747e-01   +3.190024491403042e-01   -5.088765033491650e-01   +3.182819469380181e-01; -3.848678203066634e-01   +6.945573392683476e-01   -1.785092538289106e-01   +3.706772008649960e-01   +1.312462295903323e-01   +3.444714190013963e-01   +3.569078470523868e-01   -6.379186452870842e-01   +3.864349497632497e-01   -8.679185387177454e-01   -6.404867382898213e-01   -2.442645438675610e-01];
L3I_L2I_iGABA_netcon = [+9.305539897791777e-02   +2.792929152899696e-02   -1.999825085241931e-01   -1.000000000000000e+00   +8.739178902308691e-01   -4.153450015833391e-01   -3.130387072767113e-01   +2.455923390090354e-02   +6.099028707782315e-01   +7.493727273594348e-03   -5.522259288833704e-01   -7.901515600592577e-03; +2.926431139330944e-01   -6.658244271066158e-01   -1.784834886339446e-01   -4.630580424799466e-01   +7.662592231501013e-02   -7.830624026248751e-03   -1.421507877961792e-01   -4.291521461968095e-01   +9.613035714003657e-02   +1.764216040586666e-01   +4.119858729916867e-01   -5.173424752496824e-01; -4.810740163538695e-01   -5.114133776912326e-01   +6.720987150549191e-01   +1.185314395332766e-01   -2.999149905840209e-01   -6.174958957364111e-01   -6.602972763966168e-02   -1.937796122181590e-01   +2.428735032552093e-02   +6.907623733263465e-01   +3.769890233643293e-01   +5.957229032687950e-01; +6.696573235985254e-01   -4.263555854486502e-01   -4.624248215272465e-01   +6.400119121549348e-01   +3.617283339645788e-01   +9.818147476642568e-02   +6.406618948492078e-03   +8.320030195689920e-01   +5.361870613689019e-01   -1.151252297075844e-01   +2.655540908190820e-01   -5.040367977174504e-01; -5.958441428075586e-01   -1.902399845318526e-01   +6.289555188342230e-01   +5.478253898749390e-02   -3.061332157498232e-01   -2.981000241266512e-03   +1.039552873292910e-01   +3.206283814601574e-02   -3.630197857789854e-01   +7.965276909330347e-01   +1.714711523041344e-01   -8.013140858921611e-01; -2.081461467342329e-02   +8.527967484828841e-01   +1.371095464997805e-01   -9.690773854279021e-01   -4.604777525404093e-01   +7.304396023185310e-01   -8.178237685100376e-01   -4.305157026528464e-01   -6.005737393131485e-01   +2.750783798218312e-01   -2.069538174031675e-01   -2.425919391820599e-01; +4.796942083704296e-01   +8.890420010099453e-02   +6.581744776403686e-04   -4.811330751020552e-01   +5.366074159677140e-01   -7.945934078509360e-02   -3.883688930536154e-01   -5.151443647695466e-01   -1.099321727162172e-01   -2.057596674554807e-01   -3.062081539383947e-01   +1.218651664274241e-02; -7.203712988661755e-03   -2.763368131955680e-01   -4.458641638458385e-01   +1.386969536881568e-01   +4.156224684688040e-01   +1.479045517163204e-01   +6.756292191212924e-01   -2.609616704590005e-02   +7.335376205259138e-01   +1.458671261315805e-01   +5.216782316661422e-02   +3.778857916502097e-01];
L2E_L3E_iAMPA_netcon = [-7.503091476451090e-02   +5.053027962931180e-01   +1.060125310170527e-01   +6.073642855644014e-01   -3.922854175136243e-01   -6.222903346976827e-01   -1.037982113036717e-01   -2.324028211727902e-02; -6.812674451529777e-01   -3.318566355538887e-01   -7.493083460774531e-01   -6.177144379756799e-02   +3.661777622364920e-02   +1.642393860674042e-01   -3.253385860932672e-01   -7.129009220860064e-01; +5.281906111951966e-01   -1.864413285735494e-02   +6.791812519360051e-01   -1.050157839445237e-02   -3.560576869147044e-01   -9.171836120959374e-01   -4.281800547788934e-01   -1.086533975329290e-02; -4.156559966736873e-01   +1.968193752581300e-01   -1.781141589400668e-01   +3.555948242577313e-01   -1.169736114294149e-01   -8.815572280617219e-01   -4.935956921747857e-01   +9.654658842135283e-02; +4.044112019342521e-01   +1.338625938353187e-01   +6.888840900863772e-01   -2.499978263822445e-01   +1.990608657369405e-01   +3.461099696715040e-01   -2.882417330826133e-01   -6.671879290044210e-01; +1.797715739918481e-01   +3.158539300333493e-02   -1.632552272362287e-01   -2.326466399405380e-01   -4.412223224057092e-01   -3.685560259956772e-02   +2.732018208063991e-02   +2.833652785835125e-01; -5.278311599421539e-01   +3.361227963286625e-01   +6.796975474313396e-02   +1.128809867531289e-01   +2.708378678195770e-01   +4.136093662786472e-03   -6.649731563688506e-02   -7.190155134101082e-01; +5.905083234892952e-01   -5.382216981891803e-01   -3.272743510515740e-01   +2.297055783925407e-01   -1.724144613813051e-02   +1.851756203812473e-01   +4.850747908600179e-01   -3.190272418729929e-01; -1.298572696819071e-01   +3.012085287452249e-01   -3.543902291927078e-01   +1.168725782702727e-01   -7.556156304711474e-01   -8.257058627874834e-01   -8.524692357027973e-01   +4.204036057053234e-01; +4.620123555715924e-02   +1.534808383751344e-02   +1.368103955908011e-01   -6.243290391278435e-01   -2.719083488366993e-01   +9.135725987587981e-01   +1.568045177051951e-01   +2.487339268892247e-01; -2.503532342769702e-01   +3.589147271332580e-01   +1.032586039082049e-02   +6.081138555398301e-01   -1.322731458245971e-01   -8.535067520925366e-03   +8.375605784400959e-01   -2.814553925611601e-01; -7.611498897230422e-01   -1.136514546620100e-01   -2.219455620048466e-01   +3.207864226894748e-01   +4.338877558093363e-01   -9.432785260489962e-03   +1.808090024327568e-01   -3.703343605817873e-01];
L2I_L3I_iGABA_netcon = [-2.872547656771735e-01   -1.000000000000000e+00   +7.756427543993308e-02   +9.155913821938209e-02   -5.646292233311802e-01   -6.093008450226666e-01   -3.595500938765272e-01   +1.608635383339573e-01; -2.958654974825161e-02   +4.531703790591454e-01   +4.198774415686309e-01   +5.603729824631919e-01   -1.450837181967410e-01   +3.569859476463029e-01   -6.484504697789030e-01   +7.352221930394232e-01; +2.254791050413541e-01   -4.330035750561690e-01   -3.884521729418634e-02   -4.905483301159058e-01   +1.933500511346923e-01   -1.702962902795913e-01   +4.331212102220872e-01   -6.613424699367735e-01; +5.436776969752226e-01   -3.586352782244595e-01   -6.162692263046182e-01   -5.210490598795895e-01   -3.113601021596556e-01   +3.493007839966790e-01   +1.902619473531401e-01   -2.629338508244657e-01; +2.127643186064915e-01   +1.419565071027454e-01   +4.642432511489291e-01   -4.563270234343164e-01   -6.710349726257722e-01   +1.566048865811782e-01   +6.994217636766853e-02   -8.305165454482262e-02; -1.476949128121494e-02   +1.542406774526596e-01   -4.405786566530742e-01   +5.091405353295985e-02   +3.728734194777163e-01   -9.215099915050512e-02   -2.187648510189872e-01   -1.261285176908058e-01; +3.909934827279803e-01   +2.829744298459019e-01   +6.571581833315536e-02   +4.109491629131145e-02   +1.990161621031416e-01   +2.833904074998833e-01   -1.423849213667112e-02   +4.851145843608746e-01; +3.358694452749934e-01   -3.330722446126846e-02   +1.976548699613288e-01   -8.088743914625955e-02   +5.146312980732479e-02   +4.614560184359329e-02   +3.361717233660025e-01   +4.958489367841579e-01; +2.426687297097793e-01   +3.912729316305667e-01   +2.483721378448051e-01   +3.686845230769507e-01   +6.852744737823727e-01   +4.862377210119218e-02   -3.980686008500955e-01   -3.954180188678897e-01; -6.487026804573517e-01   -3.792839236796317e-01   +1.389888932192032e-01   -3.754798728734646e-01   -5.121006124580825e-01   +6.128482017656643e-01   -3.757304983383547e-01   -2.392760609952583e-01; +3.291006675676831e-01   +2.419864396188416e-01   +6.236609347932415e-01   +7.592623130181136e-01   +9.496920413002342e-02   +3.918694722915220e-01   -1.762610416083142e-01   -6.450627649480158e-01; +1.641090326173777e-02   -1.113466462790854e-01   +1.907617062874054e-01   -1.875529009881935e-01   +5.043038086240236e-01   -6.051968238169099e-01   +5.376474525919543e-01   -3.729512876253304e-01];
L3I_L3E_iAMPA_netcon = [-1.571895759889386e-01   +4.907671520411176e-01   +2.678441780491725e-02   -2.962125601997042e-01   -8.444971020361907e-01   -2.290904418098821e-01   +6.205787773302813e-01   +4.684759328609039e-03   -4.044712213213579e-01   +7.043290427165569e-01   -3.137253816492105e-01   -8.888039408013799e-02; -2.670480730557140e-01   -3.688445419002616e-01   +1.524592536901749e-01   +2.427897625794602e-01   -4.648736773440060e-01   +6.233552644471345e-01   -3.556358966908532e-02   +8.560014329790322e-02   -1.430190282854640e-01   +5.887082875995755e-01   -5.586291466576869e-01   +5.382628235650020e-01; +6.669107544062657e-01   -1.812395542553046e-01   +2.571973474080419e-01   +1.779252429727772e-01   +4.486668200517524e-01   +1.212149612093022e-02   +3.092204374235750e-01   +2.223698850614663e-01   +1.909012534804835e-01   -9.165535083744336e-02   +8.544566748105190e-02   -1.689225965688229e-01; +1.053199939465791e-01   +2.735887862792036e-01   +6.222061466286523e-01   +9.026379681898169e-01   +1.112331016486467e-02   +1.153208841263875e-01   +8.446062769722473e-01   -4.979812091673784e-01   -6.126364540859280e-02   +3.832563733598096e-01   -2.591723382181159e-01   +4.557124435254888e-01; +8.109421155015589e-03   +9.685419753123128e-02   +4.393328010944838e-01   +5.080414124172636e-01   +5.078153124584577e-01   -1.084507744684478e-01   -3.249036433769864e-01   +6.973145126170094e-01   +4.200497322613218e-01   +3.056457846523233e-02   +2.960431996953365e-01   -2.987098514469790e-01; +2.794708992486893e-01   +7.140787939310791e-01   -1.828569696335642e-01   -2.585197718384099e-01   +3.818813502156506e-01   -5.247837239702324e-02   +3.305246508598406e-01   -7.215260708160174e-01   -1.907781488388615e-01   -2.887301614312269e-01   +5.103886565596629e-01   -7.853184086551096e-02; +3.015020736580803e-01   -4.318425274851379e-03   -8.012540551644820e-01   +9.310381037754205e-01   +7.046692663856635e-02   +4.698949143352297e-01   +3.104468508140528e-01   +9.150495570996858e-02   -6.659611406200079e-01   +7.347961070923950e-01   -5.328685981939747e-01   +4.332550814401989e-01; -7.053351486785424e-01   +7.985081672192362e-01   -2.986059061141727e-02   +8.254936793094525e-02   +9.250936670373904e-01   -6.947767870120731e-01   +1.023494305903429e-01   -4.871979314824423e-01   -5.463590491386556e-01   +5.298114160956452e-01   +6.913513854174038e-01   +1.290304185462210e-01; -1.849846274258118e-02   +1.398578241287710e-01   +6.933619370228492e-01   -7.354513767984169e-02   -2.679283724408703e-01   +1.644610039226687e-01   -7.210495007394409e-01   +3.031078500468579e-01   +3.843892594159448e-01   -1.240582307837975e-01   +7.226156120487923e-01   -3.445192089317038e-01; +7.250528549847929e-02   -1.913134224662283e-01   -8.078040865555113e-01   +2.191771849248431e-01   -2.137427987332500e-01   +2.173909381274319e-03   -4.457967072816730e-01   +3.692010283690215e-01   -2.884266806410226e-01   -3.480218586154588e-02   -7.971244086410931e-01   +1.049221520917165e-02; -6.786991206235623e-01   -6.264547592572339e-02   -3.658167692369385e-01   +5.117340507161149e-01   +3.208702045708296e-02   -8.152985528979571e-01   +3.058826807741030e-01   +9.220180612372562e-01   +1.226552713881952e-01   +4.336187950963256e-01   -6.330292346808384e-01   +6.470585334162451e-01; +2.513359240308978e-01   +4.670296016569923e-01   -2.031039090375584e-01   +5.709555381013759e-01   -1.205850164788233e-01   +8.029352741956779e-01   -2.384409990859428e-02   +4.629857192955206e-02   -3.827491683475504e-01   +2.730235204933559e-01   +8.765295713011209e-01   -6.832843784219929e-01];
L3E_L3I_iGABA_netcon = [+5.965942492149902e-01   -5.694697832734338e-01   -7.426436451503736e-01   -5.612609832502401e-01   -5.714764881973423e-02   -6.911412470887021e-01   -2.096274663333725e-01   +4.778812929689531e-01   -7.935458065282860e-02   -2.345583300130991e-01   -5.078950384555238e-01   +2.224757196983366e-01; +8.162029692180541e-01   -5.067733886268154e-01   +1.906284991515256e-01   +6.951869526920876e-01   -4.750784171823134e-01   -2.881233683823639e-02   +4.617317124775313e-01   -1.844609367308417e-01   +1.884921822074388e-01   -6.142722534815241e-02   -4.153373619065731e-01   +4.277271354702603e-01; -6.836056508080740e-01   -3.151625312468501e-01   +5.721462758531227e-02   -1.774412858871363e-02   -2.553741362204783e-02   +6.712167116467116e-01   +6.566178529112167e-01   -4.783534186471963e-01   -3.386745490969653e-01   +1.276994433129770e-01   +1.179752184491189e-02   -2.485480647130286e-01; +1.404022376993461e-01   -2.639438778485451e-01   -2.331228070903919e-01   -4.116947365210073e-01   -5.544335843195636e-01   -3.189122134961495e-01   +1.972161497534411e-01   -1.796169295403973e-01   -1.392815970213942e-01   +7.563178496360047e-02   +3.071527293786000e-01   -2.429975931865789e-01; +9.545518487368475e-02   +7.765323832159146e-01   -6.158055177012519e-01   -3.011370122008526e-01   +5.612362733812067e-02   +2.658396319024330e-01   -7.504852945239082e-01   +1.609707495644075e-02   -4.458968520448991e-01   +3.247381434488091e-01   -1.703242158209232e-01   +5.632774728647710e-02; -2.981746004330740e-01   -2.088529278874589e-01   -4.069374606933359e-01   -7.262169752787366e-01   -5.372513024280026e-01   +4.379218650429895e-01   +2.634818689306671e-01   +5.180401998969565e-01   -4.335393690625828e-01   -7.402911927418173e-01   +8.535821049885556e-02   -9.417180606255636e-02; +7.573287942388603e-01   -6.876574757048545e-01   -3.610281137925739e-01   +4.527001164413748e-01   -2.754133997095520e-01   -3.412476007855398e-01   -9.314928821733132e-01   -3.744557310611427e-01   +1.443906141759127e-01   -5.005337753713811e-01   -2.642741128689789e-01   -7.708947416353057e-01; -5.723765432362958e-01   +7.165648506267531e-01   +1.177506052430097e-01   -8.698275499111722e-01   +5.672503588865047e-01   -6.558914383444233e-01   +8.872347153749323e-01   -1.226142513874139e-01   -5.962391113709495e-01   +6.389016376920620e-01   -3.846246265747064e-01   -1.632507648501836e-01; +2.306119759191099e-01   +4.549859906155611e-01   -5.227094761881492e-01   +5.679898373857826e-01   -1.060513330844001e-01   +5.081417978646775e-01   -7.597712498502306e-01   -1.329371102230054e-01   +5.269417305086077e-01   -4.182639386150674e-01   +5.603378820622260e-02   +2.661976298865159e-01; -4.307941034956892e-01   -3.092549081532408e-01   -8.305854974189290e-02   +9.696013302488602e-01   +6.199498038056761e-01   -8.968473370184376e-01   +1.968755473286571e-01   -5.951925136615014e-01   -1.308774645475981e-01   -2.976622542382985e-01   +8.459981801440868e-02   -2.360407557980657e-01; +6.442979823776847e-02   +4.073913145070832e-03   -3.597174469792479e-01   +5.045956710213909e-01   -1.771472032096941e-01   -4.940891718392501e-01   -5.906855656348426e-01   +1.000000000000000e+00   +3.444984914922727e-01   -5.417173869410471e-01   +2.577404602427188e-01   -3.857917140914907e-01; +2.591936401519428e-02   -4.607138520795463e-01   -3.634229457556611e-01   -3.535208685120485e-01   +6.243296385903740e-02   -8.562188680861754e-01   +6.156348813366391e-02   +6.499364558211060e-01   +4.649035264407209e-01   +7.875995988142372e-01   -6.483448814668660e-01   +6.572627126884421e-01];
L2E_Input1_iAMPA_netcon = [+3.671062414592990e-01   -1.618559046744904e-01   -9.281469511979845e-02   +7.418103545949175e-01   -1.185418980347071e-01   +4.652377972451688e-01   -2.119372286259213e-01   +6.717539780039659e-01];
L2I_Input2_iAMPA_netcon = [-7.500408671582734e-01   -2.037856460950282e-01   -1.651295032844594e-01   -7.640147824020413e-03   -3.872188485563132e-01   +7.413131160990315e-01   -5.383322059338825e-01   +1.000000000000000e+00];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
