function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.772607123588443e-01   +7.258219417933998e-01   +8.830013850690924e-01   +2.022188534765820e-01   +2.427410538703067e-01   +6.944829383115414e-01   -4.452991001344502e-02   +3.660253067182790e-01   +2.357224506749514e-01   +1.977259284330386e-01   +3.808759978987575e-01   +1.901063010219029e-01   +4.920665422090584e-01   +2.698457356513473e-01   +2.382091003455854e-01   +2.297656180904123e-02; +7.469090398611665e-02   +9.030545650804489e-01   +8.442706252910140e-01   +7.326456050369129e-01   +3.106090436065141e-01   +6.867244951400134e-01   +7.145607112809164e-01   +1.658846988391513e-01   +1.359309934549088e-01   +7.420062227734719e-01   +5.488997432193412e-01   +6.274858223433672e-01   +4.266669930096668e-01   +2.590995674763588e-01   +6.527943013656780e-01   +2.553874643990208e-01; +2.164589513918722e-01   +3.447521565828106e-01   +3.923751029948330e-01   +5.039171777022589e-01   +5.958688308374489e-01   +4.345367268170164e-01   +4.329941578233246e-03   +6.375361087385744e-01   +2.948403265620897e-01   +5.212600038731626e-01   +7.563102098741291e-01   +2.441980676993211e-01   +4.104407636144074e-01   -1.009813725987607e-02   +3.214595903877555e-01   +9.389803394737495e-01; +2.058198307717996e-01   +6.372003300216464e-01   +7.228502695432838e-02   +2.671146929273656e-01   +8.285791198591146e-01   +7.846342382051150e-01   +2.022160595948891e-01   +5.583577004569086e-01   +6.963628773844227e-01   +4.187973045073309e-02   +2.105440288325459e-01   +8.289008917713339e-01   +5.078825554521977e-01   +2.059073841438775e-01   +5.583839259324397e-01   +4.737708862509303e-01; +6.621193102961886e-02   +7.065588427284013e-01   +7.793979718964316e-01   +7.508944737658879e-01   +4.941385996959637e-01   +3.156918519064353e-01   +4.776817917346192e-01   +2.970583155819674e-01   +3.118909295456404e-01   +4.644455761989698e-01   +1.945208714770853e-01   +6.416310372809949e-01   +3.881707997422372e-01   +7.607560121894517e-01   +2.356014127207162e-01   +8.492341415766923e-01; +1.287817337151766e-01   +1.757292913146371e-01   +6.926852511114856e-01   +7.515587387360921e-01   +5.669546051578582e-01   +8.582355763543587e-01   +2.718074949720729e-01   +4.114489624482816e-01   +8.526490110187028e-01   +8.975798022463168e-01   +8.580354031870595e-01   +1.809280846071112e-01   +4.144307616761745e-01   +1.418329193863795e-01   +8.409682852691381e-01   +3.894507101475596e-01; +3.064569634932375e-01   +7.005801885620917e-01   +6.694585159042403e-02   +3.446334753498056e-01   +7.900183738357527e-01   +5.129353873130023e-01   +4.152696544436256e-01   +5.492375665023985e-01   +9.014235826670868e-01   +9.088978623133602e-01   +6.717882859763954e-01   +1.060217124692919e-01   +3.218718187945199e-01   +3.544715784335407e-01   +6.579527218600599e-01   +8.605431916296556e-01; +6.611489511019821e-01   +6.981553585430132e-01   +7.168705426101176e-01   +2.976029812440252e-01   +6.269445283616705e-01   +5.139852981659587e-01   +4.862430098936746e-02   +3.858613843128311e-01   +1.000000000000000e+00   +8.330071341618246e-01   +4.003119858418628e-02   +6.921097588609288e-01   +7.759764338275743e-01   +5.410720308251170e-01   +2.772888894350654e-01   +8.127699828785854e-01; +4.762725143210950e-01   +7.110312048409147e-02   +2.341119296286376e-01   +3.134850174349153e-02   +4.378319624502360e-01   +1.578136137887619e-01   +3.911441422683443e-02   +5.651081286817706e-01   +4.711181229914577e-01   +7.481562001991321e-01   +7.318134117560181e-01   +5.063140566271432e-01   +2.597614257643333e-01   +1.840795983700980e-01   +9.435733134230053e-01   +7.653251454272654e-01; +6.317018013875485e-01   +5.357425159446997e-01   +5.506956315873599e-01   +2.331268071829982e-01   +4.177293944366151e-01   +3.106105085411280e-01   +5.263434957696113e-02   +2.164794265539368e-01   +9.025886589595546e-02   +7.512376229836581e-01   +7.513709239822507e-03   +9.167163111934531e-02   +3.335928582704369e-01   +7.412247921107480e-01   +3.200267006528475e-01   +7.419855199187251e-01; +3.732390243474820e-01   +5.728534359221181e-02   +7.179439622001804e-03   +1.788898914072465e-01   +8.932305672130332e-01   +5.661207843930240e-01   +2.526389768597484e-01   +2.044957603592478e-01   +2.087330234095635e-01   +8.523129021047907e-01   +1.241707289078672e-01   +7.305997603722895e-01   +5.231109759318332e-01   +7.948933581488042e-01   -1.033443996875700e-02   +1.047770739698923e-01; +1.381980823556785e-01   +3.523029855769387e-02   +8.872166133228837e-01   +4.504891563457054e-01   +6.362662775978777e-01   +5.098761441083413e-01   +6.720121940903289e-01   +3.709170536739560e-01   +6.543092603953750e-01   +1.110303152276867e-01   +2.989455236197587e-01   +7.649570961688807e-01   +5.083937364438061e-02   +5.151023748042893e-01   +3.853047304343705e-01   +8.724237993888266e-02; +4.162787539351534e-01   +3.295090933461814e-01   +6.369965551615162e-01   +2.213491038763352e-01   +9.018455090746244e-02   +4.582316951693798e-01   +4.173254187105871e-01   +7.108243621162842e-01   +2.865153613042294e-01   +8.864680178093270e-01   +1.535847507699720e-01   +4.156160132452039e-01   +2.246104019813172e-01   +2.196477545580197e-01   +2.757199059609594e-01   +2.172026693517991e-01; +1.540954663986151e-01   +8.676258843322416e-01   +7.039465480476776e-01   +7.007382708685657e-01   +7.465021007597727e-01   +5.599981823535939e-01   +2.550043128581379e-01   +7.439641869502168e-01   +3.498223136211578e-01   +4.362707829845932e-01   +8.432017499811133e-01   +6.093239894656503e-01   +5.597175300677860e-01   +5.333811497173537e-01   +1.133658918123366e-01   +3.710087698145848e-01; +1.114535965887705e-01   +1.823876788742743e-01   +8.712736180555666e-02   +3.490990970128225e-01   +3.602139375965362e-01   +4.310153852983942e-02   +6.562686561518651e-01   +2.930304989910054e-01   +7.931404676735930e-01   +4.852665666830882e-01   +1.222529079762474e-01   +7.803855200975464e-01   +6.091334648858173e-01   +1.821175391631112e-01   +6.905475573389808e-01   +1.522551427313062e-01; +5.546497046212745e-01   +2.144071665280882e-01   +3.104047234484689e-01   +6.155320366378642e-01   +5.345422207208630e-01   +5.260195439892045e-01   +2.371889772121754e-01   +1.007939233870185e-01   +5.597536785821974e-01   +4.629416794614727e-01   -7.611683262545052e-02   +3.519822378786534e-01   +2.161001258335746e-01   +8.850300526651779e-01   +8.947510027659035e-01   -1.502432369806528e-02];
L1E_L1I_iGABA_netcon = [-2.941175443943009e-02   +2.665035665242591e-01   +8.872061577272481e-01   +1.949843917719302e-01   +4.054464957834388e-01   +1.077521468029191e-01   +2.635255104286565e-01   +3.988592996271267e-02   +2.175354633305227e-01   +4.800685379500969e-02   +3.905746529119730e-01   +9.131936609999407e-01   +1.924460806221223e-01   +7.756051168067956e-01   +9.062966734251415e-02   +3.882253310381065e-01; +7.572618621331381e-01   +7.403974941675527e-01   +5.410835384625506e-01   +8.176923621727040e-01   +6.978331033681001e-01   +8.154990936582620e-01   +6.059083021028939e-01   +8.018770455829144e-01   +8.772656629940156e-01   +9.447355974094965e-01   +1.559357472899914e-01   +1.366003422007536e-01   +6.008426054421069e-01   +9.217404930704010e-01   +9.884763715978677e-01   +2.837929670202888e-01; +2.975116091922138e-01   +8.070185798440543e-01   +9.335714421228369e-02   +1.189981945944840e-01   +8.794987433982189e-02   +2.153841000491377e-01   +5.884878504805964e-01   +7.376974606211529e-03   -2.519794504474660e-02   +1.074865758037706e-01   +5.085448023842640e-01   +3.867463103377224e-01   +7.582737682800295e-01   +8.008136514055860e-01   +7.919553893477629e-01   +7.686792213850352e-01; +3.857984835099290e-01   +5.361412187593677e-01   +5.593254934819470e-01   +7.440803286230020e-01   +6.602741910605505e-01   +5.911343298164717e-01   +5.350943655581593e-01   +8.852814788047016e-01   +9.513007867385036e-02   +2.888186211589758e-01   +5.363363868836455e-01   +2.563601989076793e-01   +8.165838327950710e-01   +3.970859337221160e-01   +8.986323540792179e-01   +5.032842728989679e-01; +6.560594856397910e-01   +5.819715937535996e-01   +8.339984213706807e-01   +3.832967083035528e-01   +8.953953862979295e-01   +5.196977208525373e-01   +3.523688071815191e-01   +4.502776039083132e-01   +3.042141232418827e-01   +3.601323319248009e-02   +3.106534828749052e-02   +5.747191470420674e-01   +9.366145110684990e-01   +7.873113563948114e-01   +2.683506776254612e-02   +1.386148618742041e-01; +1.993168276905359e-01   -3.921300474230114e-03   +3.242497207302031e-01   +1.996779208064156e-01   +4.916540669693945e-02   +4.675804596007016e-01   +8.494562640389182e-01   +2.923997463355650e-01   +5.202651799363230e-01   +4.159551071659223e-01   +8.834381590550263e-01   +1.646594339749472e-01   +2.486049752779265e-01   +1.966348306231317e-01   +7.003673302091906e-01   +3.603451838921636e-01; +6.770609856534848e-01   +5.431319711749275e-01   +3.177163894355843e-01   +7.954535039494663e-01   +2.869963214320779e-01   +8.229953548374238e-01   +5.969227453652264e-01   +5.379471077975995e-01   +8.080242113143365e-01   +6.127385931049462e-01   +8.398337758905252e-01   +2.369498818953736e-01   +8.172658894905936e-01   +5.762158746605385e-01   +9.382253510805423e-01   +7.221161705153992e-01; +9.317784628971983e-01   +1.477284950140733e-01   +5.791697091303932e-01   +4.863869519452071e-01   +6.704571375459376e-01   +1.752450252829918e-01   +3.344132076732127e-01   +5.771436330986184e-01   +2.134458103392453e-01   +8.307851742402975e-01   +7.530257879179555e-01   +8.637005856081249e-01   +2.459048800072606e-01   +6.939108869359804e-01   +4.947692902008328e-01   +5.892706888582029e-01; +5.109600841068745e-01   +9.150379403074560e-01   +3.796714580968165e-01   +9.287068139816893e-01   +2.426479351726463e-01   +6.626618787981948e-01   +5.471392773915431e-01   +9.254347793664439e-01   +8.608867150525812e-01   +7.710481179912952e-02   +1.841294228072812e-01   +2.076012691420351e-01   +8.247521469301472e-01   +4.817930527845557e-02   +7.155426235062727e-02   +4.856437480413314e-01; +2.190679390962084e-01   +3.591104310607672e-01   +5.477963511548651e-01   +2.563937497119566e-01   +8.644764418979173e-01   +4.123664427123591e-01   +2.870604752734315e-01   +8.515338712180139e-01   +9.195451208277748e-01   +8.406162086946070e-01   +7.929105815261537e-01   +9.363240628328758e-01   +5.094811284448765e-01   +3.714067479287219e-01   +3.180905509999725e-01   +7.666925695056592e-01; +1.389824644687430e-01   +2.238363026128753e-01   +7.586203536867103e-01   +8.595926159993135e-01   +1.669867531756349e-01   +6.350800562656593e-01   +7.865814770762886e-02   +4.657011281403838e-01   +4.149600816059451e-01   +6.194669953823585e-01   +3.391567320043900e-01   +8.945798471769334e-01   +9.045091920353755e-02   +4.812414202610836e-01   +4.403674033851059e-01   +4.283885546000575e-01; +1.824996683674489e-01   +9.092483852749599e-01   +7.395563168119569e-01   +4.882772541537615e-01   +4.513934259587908e-01   +5.141860723471577e-02   +2.145213769551184e-01   +3.748233150221209e-01   +1.302768829745539e-01   +5.162389478381008e-01   +1.875503328926203e-01   +4.170356689869863e-01   +3.677608424369416e-01   +9.014348282843129e-01   +3.675917448186461e-02   +4.805800466950127e-01; +9.111707846718714e-01   +1.655662048011061e-01   +4.649897543749962e-01   +5.246888276200102e-01   +6.149272230948404e-01   +5.779950911081521e-01   +2.268785775945008e-01   +4.656689897489300e-01   +4.243765478311375e-01   +3.428632321135178e-01   +9.343642175516802e-01   +9.617207052673200e-01   +8.014628712887012e-01   +5.990285922964190e-01   +2.757443103381021e-01   +7.642629626618919e-01; +4.364974995248689e-01   +8.153289954216623e-01   +3.142419596442262e-01   +4.146435657474453e-01   +7.283856973761568e-01   +1.773487045004445e-01   +3.127839286621928e-01   +5.730369430358929e-01   +3.645029863531886e-01   +4.451609463885706e-01   +1.833156257791259e-01   +1.766010247862979e-01   +2.858225411655965e-01   +2.744954933513213e-01   +5.649655713883989e-01   +8.921722769592895e-01; +5.675538514545474e-01   +6.017074275514175e-01   +7.142328295018320e-01   +6.820483854919028e-01   +7.194350737939582e-01   +9.044938004739575e-02   +8.097902249558098e-01   +2.779262127497374e-01   +8.136929065698573e-01   +4.801451054854050e-01   +7.024225878458418e-01   +5.343467564879480e-01   +2.918636383593985e-01   +4.832314138071779e-01   +8.618433067983419e-01   +4.585771941470277e-01; +3.847837765222168e-01   +5.820149330397915e-01   +6.323195432657187e-01   +2.288800834684285e-01   +4.633439001568408e-01   +3.023592800739645e-01   +5.327521774941550e-01   +2.251305487715403e-01   +7.970254885670423e-01   +3.070325231939967e-01   +2.800714191066592e-01   +1.201499265452108e-01   +4.635652979162254e-02   +4.603943143601266e-01   +9.037683377803485e-01   +9.329473505248871e-01];
L2I_L1I_iGABA_netcon = [+6.541095432587091e-01   +4.724079558949668e-01   +7.370509339971317e-01   +5.586454886875845e-01   +9.157668603891588e-01   +6.656027405122236e-01   +8.893519122440439e-01   +7.474566835374898e-02; +4.931912688964425e-01   +1.235695629169593e-01   +2.050384636587067e-01   +9.445735099855193e-01   +1.615259272511305e-01   +5.964588040541313e-02   +8.237959036728768e-01   +6.737895657093060e-01; +1.000000000000000e+00   +5.012939452921085e-01   +6.332529668622764e-01   +6.669742737148324e-01   +7.738251597174587e-01   +6.651011681936470e-01   +3.125421854041875e-01   +2.438234655879284e-01; +3.279516553151616e-01   +1.562435533308495e-01   +8.786453120832678e-01   +4.121593313401427e-01   +7.375889576112989e-01   +3.305407186217781e-01   +8.906202605877250e-01   +1.904904792746586e-01; +6.961883840120502e-01   +4.730033692137531e-01   +6.478555607885462e-01   +2.535740223142751e-01   +8.895373566136446e-01   +3.301165222103175e-01   +5.261658054320226e-01   +2.181393138556634e-01; +5.859456220788436e-01   +5.680702023017085e-01   +7.578119544511545e-01   +1.789924205557673e-01   +1.993886494249281e-01   +7.994307647265705e-01   +8.685579889666235e-01   +5.452924900579726e-01; +8.529649916614319e-01   +4.713351168263381e-01   +2.312119965765246e-01   +2.612284418544422e-01   +7.237294282721946e-01   +1.603924425104722e-01   +6.513586283457979e-01   +3.277665669286313e-01; +9.950142123214339e-01   +4.019810759183023e-01   +6.137225993458915e-01   +9.025639124977102e-01   +1.135436907909472e-01   +4.003169279666420e-01   +4.509650192026602e-01   +2.245121314535587e-01; +7.237365454324278e-01   +1.443122836199646e-01   +4.632592877479456e-01   +3.321455438397556e-02   +7.443357561500925e-01   +3.697633709685417e-01   +7.220924572905271e-01   +6.863780001551207e-01; +4.663329445333962e-01   +8.333564301415171e-01   +6.265298033051688e-01   +8.041935253427475e-01   +3.796477289835032e-01   +8.370686464192965e-01   +8.573547374132018e-01   +2.614563492390006e-01; +5.280069151687243e-01   +6.097309333639090e-01   +4.985526212106147e-01   +3.776001235142014e-01   +3.915204306971149e-02   +8.675518329873583e-01   +6.143607934083575e-01   +4.243943207996945e-01; +1.986233677628450e-02   +3.949397903946644e-01   +3.631474159662054e-01   +4.371073894046891e-01   +3.552124924756600e-01   +5.047182009579901e-01   +2.562117157717421e-01   +5.425607537001613e-01; +3.823055348668703e-01   +1.681942603266827e-01   +6.324175389094435e-01   +7.416799484662159e-01   +1.945343900829811e-01   +6.835544486561861e-01   +3.374946204602218e-01   +7.005138590158528e-01; +4.942639493636794e-01   +4.711683108576323e-01   +6.601048899302666e-01   +3.457058695917294e-01   +8.176644550991129e-01   +4.050362073764350e-01   +3.272290018311877e-01   +3.073322152332232e-01; +5.545431884717303e-01   +1.745635788198804e-01   +2.180327065499148e-01   +2.189383002336670e-01   +6.021096524423776e-01   +5.408756657255733e-01   +2.572553415423477e-01   +7.330787709052913e-01; +7.652420961098503e-01   +6.924900714666445e-02   +6.871459413197677e-01   +3.238426835876139e-01   +3.728268734625232e-01   +5.635323731668285e-01   +1.206644174030603e-01   +2.874090390239258e-01];
L1I_L2I_iGABA_netcon = [+5.057183049605278e-01   +1.990946772063252e-01   +7.924045940831016e-01   +3.378982388822244e-01   +5.262714898063908e-01   +2.860998680741579e-01   +8.717159250366390e-01   +2.241643438468428e-01   +5.368523638004419e-01   +8.437251353085979e-01   +3.949728880976127e-01   +3.902898292859724e-01   -6.734037326092128e-02   +7.347168208745151e-01   +6.202432962530935e-01   +5.095199147047367e-01; +2.448073540255544e-02   -1.025580252752983e-02   +3.122002029852843e-01   +2.846848745846629e-01   +8.843824982888809e-01   +3.731065258443915e-01   +3.260614392213651e-01   +1.409306358519087e-01   +4.634201379604599e-01   +2.308053511646170e-01   +3.122832953947268e-01   +2.766439678670071e-01   +9.392256195513330e-01   +1.804644444517637e-01   +7.835112355461974e-01   +2.165404507184261e-01; +3.919525567981454e-01   +6.632999046759525e-01   +3.089049861074592e-01   +6.822876778268878e-01   +2.584310567965532e-01   +5.362542962146210e-01   +7.461104246275783e-01   +1.277896842637705e-01   +7.451423690067629e-01   +4.550436876117001e-01   +6.207158026818264e-01   +8.717493139019638e-01   +9.475488181131370e-01   +6.559390241155129e-01   +3.622566060477798e-01   +1.860773356729041e-01; +8.183025458289711e-01   +6.728788664422850e-02   +6.640723116624507e-01   +9.131586389856302e-01   +4.744271472204047e-01   +8.927803411411289e-01   +6.590855842785257e-01   +2.697635503885615e-02   +1.683267692588308e-02   +3.322565531160387e-01   +4.312940089246020e-01   +4.431192391109435e-01   +3.276698531283184e-01   +5.297164657070592e-01   +1.391443092930597e-01   +4.928841182720869e-02; +9.315831639500654e-01   +7.751388689290469e-01   +7.278226004375000e-01   +6.282295927959509e-01   +2.783883203373154e-01   +6.595782041027193e-01   +6.334548338823358e-01   +6.304175124202124e-01   +1.005386722943587e-01   +6.711130271875592e-01   +1.832527469942950e-01   +4.654448809417400e-01   +6.227737051841365e-02   +1.990908249357146e-01   +6.639705360962164e-01   +9.457519600514877e-01; +5.294156122155448e-01   +4.298444944933693e-01   +1.160174812868305e-01   +3.572006530087732e-01   +8.860208730332145e-01   +1.429093859652008e-01   +7.085758978580980e-01   +6.344774796281137e-01   +4.933990521635736e-01   +7.516661996738492e-01   +3.020667466196658e-01   +5.538226748959936e-01   +8.933806908785447e-01   +9.337733577336864e-02   +2.206944876486200e-01   +4.134149637690546e-02; +8.732568671722879e-01   +1.106729229938251e-01   +3.676178525871522e-01   +3.229995637201659e-01   +5.348258068872669e-01   +8.395445137200711e-01   +3.827405201808148e-02   +2.498236364942004e-01   +7.061551580761359e-01   +9.025794512790956e-01   +8.988567137183842e-01   +8.490827168564831e-01   +1.230692944393933e-01   +2.609174387337689e-01   +1.299043984658748e-02   +5.933094244131473e-01; +8.990685221116195e-01   +4.006991266871231e-01   +4.082270648788839e-02   +9.019506803383199e-01   +1.772898815182014e-01   +9.673421574485842e-01   +7.748566959188816e-01   +4.614321423276733e-02   +7.785641657652893e-01   +4.656589573499809e-02   +8.584823972441262e-01   -1.547877481947826e-02   +8.342601360623279e-01   +9.826703071272666e-02   +9.841506242032316e-01   +6.853736451191246e-01];
L2E_L1E_iAMPA_netcon = [+2.821827519835883e-01   +9.209842694956591e-01   +6.444448551056033e-01   +4.918936152576994e-02   +3.179726016221278e-01   +3.679734279501676e-01   +8.531900367951668e-02   +6.202009469934586e-01; +1.930361098384665e-01   +1.457766049031203e-01   +7.813899907185947e-01   +8.505443774492227e-01   +3.403643825382652e-01   +5.207827382298286e-01   +2.567480839087737e-01   +1.278543721145591e-01; +4.590429122852122e-01   +8.780260727476686e-01   +7.940698305381817e-01   +2.110936227997245e-02   +6.612703384409986e-01   +1.996986017097397e-02   +4.391112581425561e-01   +8.284002199567356e-01; +4.976296705568135e-01   +6.198733866093926e-01   +9.556093249576209e-02   +5.599680861173867e-01   +2.720848528473137e-01   +5.309981723721154e-01   +1.817482466846287e-01   +4.615597068056583e-01; +8.652545691212994e-01   +6.808883306534682e-01   +7.705375269714004e-01   +5.038372011278902e-01   +7.576394102266762e-01   +3.751891318591293e-01   +4.297951548610897e-01   +4.942869241208797e-01; +4.882542322286849e-01   +6.383181750158383e-01   +3.430602740450303e-02   +6.093613930269888e-01   +6.432392114281797e-01   +8.239944814925857e-01   +2.952256016321472e-01   +9.780706329415111e-02; +4.463237959104864e-01   +3.229154096683253e-01   +2.365143938340634e-01   +4.211811708518224e-01   +4.088341508310941e-01   +2.336619791170122e-01   +6.111042096967962e-01   +2.860058583552874e-01; +6.935749653889391e-01   +1.586754586219195e-01   -6.064271408501062e-02   +9.674501230932842e-01   +5.229398875688660e-01   +3.799548551612533e-01   +5.923925693816908e-01   +6.125494162515214e-01; +7.819666721584616e-01   +5.853806194538145e-01   +6.541303353414639e-01   +1.244195929098061e-01   +3.909267843133546e-01   +2.473467248316532e-01   +5.965690440069263e-02   +9.882488502059840e-01; -3.215708339149870e-02   +1.390714266449335e-01   +1.833657437153067e-01   +1.609434098255909e-01   +1.523032339324775e-01   +5.627172410003805e-01   +8.165589912406522e-01   +8.333581011809641e-01; -1.866461351273267e-02   +1.931121559561651e-01   +5.277986832172361e-01   +4.384340480345382e-01   +1.308984650455551e-01   +4.227031477327446e-01   +1.925464798948159e-01   +7.142205332325215e-01; +3.496192501016683e-01   +5.385122222496332e-01   +6.412534322141489e-01   +4.852540649961196e-01   +6.853201870970295e-01   +2.977468484066133e-01   +6.986917024582232e-01   +4.375656455125362e-01; +6.751024587296623e-01   +7.251397556994877e-01   +5.718368222646796e-01   +2.333471716182969e-01   +2.120500627294339e-01   +1.161211889584489e-01   +5.927906436944940e-02   +4.940654724628967e-01; +7.124395405933527e-01   +7.997686100922727e-01   +2.556608288555244e-02   +8.891035304183077e-01   +5.115841749696902e-01   +7.959327627183072e-01   -6.433731954038911e-03   +1.821706365983535e-01; +9.246797187568613e-01   +1.972019331091489e-01   +4.633296864522742e-01   +5.554725986612166e-01   +3.256706453726589e-01   +2.210115735346008e-01   +6.060662820588488e-01   +3.971095622762833e-01; +8.141970498731399e-01   +6.135855324883037e-01   +6.843219637556277e-01   +3.741731653157108e-01   +4.932616699463134e-01   +8.066695912566941e-01   +7.412915884272960e-01   +1.650219344606955e-01];
L1E_L2E_iAMPA_netcon = [+8.349991568835381e-01   +4.600675948318342e-01   +6.110431111778283e-01   +1.693366965276739e-01   +9.280251564217711e-01   +2.601876296163808e-01   +5.009177629033279e-01   +4.906707245103831e-01   +9.111429000400448e-01   +5.123764335455633e-01   +6.396236377758781e-01   +4.461683812811673e-01   +4.988535364512706e-01   +3.311159410371977e-01   +6.205199101957054e-01   +2.862995299555682e-01; +7.868896694901897e-01   +1.511886461892337e-01   +1.297012580663378e-01   +5.200167323074297e-01   +7.939067272014693e-01   +5.682880022268217e-01   +8.968253745417510e-01   +2.279509409326422e-01   +3.679843081033232e-01   +3.228069508531813e-01   +6.506760973425557e-01   +6.362023615163466e-01   +6.542420120982732e-01   +8.576754689349139e-01   +3.681847203223879e-01   +5.567323818990029e-01; +7.477490478352269e-01   +1.470032026454499e-01   +1.644649979279462e-01   +1.000000000000000e+00   +2.200661880385076e-01   +3.782466343570512e-01   +8.550330325341277e-01   +2.909612410389913e-01   +1.845029862746349e-01   +6.237394288879651e-01   +7.574252684586394e-01   +4.855888665970179e-01   +7.957851767220564e-01   +9.626253084568013e-01   +8.207566807960726e-01   +6.137861319687540e-01; +6.649223411909749e-01   +5.955705235603831e-02   +5.404028351791748e-01   +3.331864146662960e-01   +4.132458799163556e-01   +7.910825637934250e-01   +1.645899159970673e-01   +1.681449945940092e-01   +5.755561198892641e-01   +4.627421215745690e-01   +3.962636541426038e-01   +9.235385899250869e-01   +7.457679392078578e-01   +8.666054657331911e-03   +7.472724615667592e-01   +8.049342956693752e-01; +8.601235863314908e-03   +2.129611406775460e-01   +1.410976397364867e-01   +7.402912987158189e-01   +1.857818555585749e-01   +4.395620089688824e-01   +9.378777896030119e-01   +3.234773624055128e-01   +1.050466500911164e-01   +7.145077715524046e-01   +1.140201201244481e-01   +5.463253842871264e-01   +4.522044769541642e-02   +6.474772907965922e-01   +4.543206221995343e-01   +1.454929091356096e-01; +6.211005479118170e-01   +4.289349611145551e-01   +3.941299047250641e-01   -1.421402435326413e-01   +8.740265995651139e-01   +1.075677741077385e-01   +4.811901361085251e-01   +1.696205909458089e-01   +7.547223132852471e-01   -3.779598872294558e-03   +7.598800072780161e-01   -2.458213035357665e-02   +7.235518712267058e-01   +5.380416504494698e-01   +6.824729788240872e-01   +3.389326607255545e-01; +2.861355210025746e-01   +7.084252197558373e-01   +3.387275686344478e-01   +3.713878189461310e-01   +2.912298503133638e-01   +8.882831308016051e-01   +9.174722715853750e-01   +4.478214999074157e-01   +6.757526669425659e-01   +7.404903890142566e-01   +7.596457492128381e-02   +1.115222106877566e-01   +9.178494363400902e-02   +3.637560822123340e-01   +2.802686992153343e-01   +7.370423959291271e-01; +1.579491815028390e-01   +4.557635835102720e-01   +2.848086060069671e-01   +4.930541934855871e-01   +9.499214306988166e-01   +4.988845933890362e-01   +9.174739713231916e-01   +8.206257391664414e-01   +3.831070053805299e-01   +6.080317410076430e-02   +4.200931576875221e-01   +4.282734025221175e-01   +3.523119634848054e-01   +6.594438430677134e-01   +4.774302041231192e-02   +5.381517246547440e-01];
L2I_L2E_iAMPA_netcon = [+3.222390307933416e-01   +3.032004312320975e-01   +3.327898181599902e-01   +5.439558860851486e-01   +1.789350147695778e-01   +8.175641425188905e-01   +6.906095711085395e-01   +1.988178066310409e-01; +4.745204748009913e-01   +1.305093272076852e-01   +6.760744606286333e-01   +2.808686940355690e-01   +6.773468460242860e-01   +8.224330471791640e-01   +9.944120385063279e-02   +5.182347841251829e-01; +6.477286065031136e-01   -3.712844436703695e-02   +7.031250187691596e-01   +5.901789360036582e-01   +1.519827784727129e-01   +6.362505986793019e-01   +7.460143862263613e-01   +1.068352820120819e-01; +5.526092557616941e-01   +2.478159461439478e-01   +4.804360081368601e-02   +9.595665790347396e-01   +3.580629019564934e-01   +6.148511771293970e-01   +9.699743225082861e-01   +1.687790279593373e-01; +1.355709303195630e-01   +4.526744293635483e-01   +4.716520445599151e-01   +8.636344285281861e-01   +8.646425134765005e-01   +5.301552734329861e-01   +7.031856508413926e-01   +2.663002095582169e-01; +9.043867987700900e-01   +5.165297706050536e-01   +9.138023446247587e-01   +9.179929773300228e-01   +6.874337294718227e-01   +8.677737132067643e-01   +8.497727692361771e-01   +4.868691980682117e-01; +1.147073858701804e-01   +5.632440435890660e-01   +9.070739052452703e-01   +8.410667124511595e-01   +1.034863454496998e-01   +7.263520160507416e-01   +2.420113176436785e-01   +1.526275105458370e-01; +5.822328529695862e-01   +3.921775945553450e-01   +1.448654991310723e-01   +3.045599399858803e-01   +7.001846200138921e-01   +4.142744815805680e-01   +9.727827326439419e-01   +6.658731598424390e-01];
L2E_L2I_iGABA_netcon = [+4.390051153076157e-01   +6.164309711214415e-01   +5.792944098493864e-01   +4.359268831458762e-02   +4.209202736502682e-01   +5.004519685774409e-01   +2.879529627195380e-01   +7.118246915572854e-01; +4.303492117302080e-01   +3.546401587830926e-01   +3.154444508133705e-02   +4.907104103312102e-01   +4.211112287604993e-01   +6.610741449945673e-01   +4.940731105649244e-01   +3.991595303305292e-01; +5.779195727172485e-01   +5.751528589688812e-01   +4.013984522514348e-01   +5.903531345097902e-01   +2.779277316942969e-01   +2.890332405252726e-01   +2.071625309573048e-01   +9.486551697604104e-01; +7.396875208012516e-01   +5.500905187743707e-01   +3.696114243032315e-01   +8.694861997283623e-01   +2.368899342653179e-01   +5.451481311399435e-02   +1.643720831572961e-01   +3.941917166720235e-01; +5.095069578396244e-01   +7.486035819521670e-01   +4.515905987993997e-01   +7.846627288961064e-01   +3.657319851149521e-01   +7.153837544534211e-01   +6.144708066195652e-01   +3.852781750669186e-01; +4.103938322825650e-01   +2.292587266684425e-01   +4.107716282399592e-01   +4.088337450647762e-01   +7.945016782415915e-01   +8.125479319769081e-01   +1.772837020092759e-02   +4.489169022291821e-01; +7.045214563708829e-02   +4.617174972633779e-01   +8.394435843156099e-01   +5.847618850060444e-01   +5.238053837279112e-01   +4.083243074367970e-01   +9.065432139190706e-01   -3.104626082108324e-02; +8.922146605937116e-01   +5.548466905434032e-01   +9.021065896952071e-01   +4.903705946847780e-01   +8.811065400865117e-01   +5.226553509871508e-01   +3.343657467324608e-01   +3.587735195844350e-01];
L3E_L2E_iAMPA_netcon = [+2.590632681978154e-01   +9.003696333968703e-01   +4.603780353135981e-01   +7.502087663675479e-01   +1.786957974755730e-01   +4.075216922632207e-01   +3.658338542242529e-01   +9.131828906477051e-02   +1.439055076294430e-01   +5.470851302814593e-01   +1.578008694864026e-01   +4.943333939436450e-01; +2.814901342397882e-01   +4.579959678751643e-01   +1.492294949828681e-01   +1.966782312636447e-01   +5.423488947023211e-01   +9.310497358065432e-01   +6.913153474447992e-01   +5.551175726449461e-01   +2.244694828240360e-01   +7.658471384849273e-02   -2.638668177537849e-02   +1.069554345981761e-01; +7.550988770066965e-01   +3.519570822347013e-01   +5.159172540391861e-01   +1.255479138169052e-01   +8.114931563839616e-01   +8.905783276544773e-01   +5.289491201070368e-01   +5.843479495792022e-01   +7.002181860363449e-01   +3.217099061936213e-01   +3.667656170917519e-01   +8.766535231114453e-01; +1.782194526280073e-01   +4.806982432999891e-01   +1.845155884004469e-01   +7.611000181782783e-01   +4.650691106290356e-01   +5.422741754287793e-01   +8.298150482521518e-01   +2.723037931760318e-01   +8.067331299190980e-01   +8.071433573886054e-01   +4.302781271896760e-01   +1.669892504525358e-01; +2.133018511109940e-01   +7.662269324969503e-01   +4.329569672548965e-01   +2.435489811165523e-02   +1.891283159093353e-01   +9.372643725616162e-01   -3.070158568991753e-02   +6.658214082752998e-01   +8.801089845057394e-02   +8.424993659491196e-01   +2.657004351623056e-01   +2.014734432928234e-01; +3.314784311017726e-01   +3.944924653286123e-01   +8.182104441676956e-01   +9.457081521288374e-01   +3.614728469304163e-01   +8.985067451912846e-01   +6.092710585381685e-02   +3.413195495958635e-01   +4.864642161949693e-01   +8.191993574132965e-01   +5.754480869608882e-01   +8.460314903375621e-01; +2.293829697911357e-01   +4.713432095989267e-01   +5.433949378599570e-01   +1.149874782742350e-01   +6.369190948062884e-01   +4.570327082553265e-01   +7.347940682061223e-01   +9.823170047544939e-02   +4.211975466072567e-01   +4.134369426550216e-01   +9.782268621226542e-01   +7.002109260501843e-01; +5.764692719994468e-01   -7.577762349361167e-03   +3.866545250647660e-01   +1.522126432641033e-01   +1.188468026336355e-02   +8.575394376008955e-01   +3.782988267235789e-01   +4.671921362012537e-01   +8.254207864652765e-01   +9.973232494852911e-01   +9.062931184256017e-01   +2.894023569097391e-01];
L3I_L2I_iGABA_netcon = [+2.249312578559285e-03   +3.697004084328215e-02   +1.511822278215879e-01   +6.461385138063089e-01   +3.298037649114188e-02   +4.840500007514477e-01   +8.020839628112172e-01   +3.824786918125050e-01   +4.119708334028085e-01   +9.016897728425165e-01   +8.093493986225445e-01   +6.424178024291911e-01; +4.045254767697575e-01   +4.341525194144479e-01   +2.829751921017433e-01   -4.807597745438105e-02   +4.792657811230865e-01   +6.288862801411469e-01   +4.405920317321082e-01   +9.134277556172602e-01   +1.372124305583622e-01   +8.900031448226783e-01   +2.439053490292248e-01   +6.409798986774538e-01; +3.903790123707854e-01   +6.595485411368971e-01   +2.642113154239065e-01   +7.825031500476284e-01   +3.313395782283672e-01   +8.541100800995942e-01   +9.635944987337265e-01   +3.585734292730041e-02   +6.774430601389345e-01   +4.499825486224521e-01   +1.209574252566269e-01   +5.798257080788471e-01; +5.971729074510395e-01   +9.638112368286110e-01   +3.108991553924864e-01   +2.620315946196946e-01   +1.878834708332106e-01   +5.754545289819754e-01   +1.807926713280663e-01   +2.260649454779715e-01   +7.062820518454097e-02   +3.439405591418833e-01   +5.303256309777087e-01   +8.351059241385080e-01; +9.706799358786554e-01   +1.216860591923282e-01   +4.643059611169906e-01   +8.769785787565885e-01   +4.943196633663089e-01   +8.709780248595225e-01   +6.485877766338290e-02   +5.014929749898238e-01   +5.619573908281869e-01   +7.974105124660615e-01   +7.135817786566052e-01   +5.097944393828197e-01; +9.272979242655829e-01   +2.125128784464370e-01   +1.659456499241804e-01   +7.486818819623029e-01   +9.040736597495072e-01   +7.591534725633406e-01   +9.596139572727883e-01   +5.821733356744226e-01   +1.026786390838950e-01   +8.344300382490741e-01   +2.980526732882939e-01   +5.568687375070940e-01; +8.259113131539528e-02   +5.117523335680346e-01   +9.127774834430635e-01   +5.765087473267086e-01   +9.942122487253505e-01   +7.802857701602390e-01   +8.546598179169455e-01   +7.589496431350830e-01   +5.744772475845612e-01   +4.011087870408963e-01   +3.330296193378661e-01   +5.330979298942257e-01; +3.863380242164038e-01   +2.885347193789011e-02   +7.601646553200001e-01   +1.623176513201137e-01   +4.238956602752673e-01   -2.758036035504503e-03   -4.729280502300624e-02   +9.223970572197996e-01   +4.614117138164646e-01   +9.677716146010196e-02   +7.088695354439543e-01   +4.138322437278259e-02];
L2E_L3E_iAMPA_netcon = [+9.471412722402772e-01   +2.311008075294868e-01   +5.559805615306657e-01   +7.197604562759189e-01   -2.105860491551251e-02   +7.021819982054590e-01   +8.200787715998901e-01   +8.607395004268016e-02; +3.333300442100843e-01   +5.199828299962147e-01   +6.751170555748346e-01   +6.787575745812415e-01   +2.651015509017245e-01   +2.002967383254755e-01   +8.213538360434828e-01   +8.659219871358073e-02; +6.417638505343507e-01   +5.128689542150756e-01   +8.401473571020858e-01   +6.086920876392706e-01   +9.368424653910175e-01   +4.587345962180837e-01   +9.883047581289190e-01   +4.298411910002327e-01; +2.076892761347408e-01   +9.154914698720887e-01   +8.813255549573940e-01   +4.179042292942989e-01   +3.829137272461512e-01   +9.396268070343743e-01   +2.270603860126722e-01   +4.870944689556713e-01; +5.428998613745261e-02   +2.002336422524706e-01   +7.116848437153687e-01   -7.302621432758874e-03   +2.175854239941406e-01   +5.478610054210074e-01   +4.579765384224951e-01   +5.982776004957662e-01; +3.969166533316015e-01   +7.932711744963744e-01   +1.633204137070686e-01   +7.700353876250700e-01   +9.283461136021498e-02   -6.374892126820492e-02   +5.096666834349222e-01   +2.367833469695295e-01; +4.558995552784780e-01   +7.799355228800361e-01   +7.954965041564348e-01   +2.606966772323627e-01   +8.092113134012680e-01   +1.736330566749948e-01   +7.114480038984184e-01   +9.425515681924178e-01; +1.302680779948773e-03   +5.376264220045733e-01   +8.841830757312762e-01   +4.677050368799274e-01   +7.490195136665921e-02   +7.787477512978646e-01   +6.614331359732085e-02   +3.212672904909845e-01; +9.666296320240293e-01   +9.238369092937196e-01   +1.216898887467299e-01   +1.699195772653278e-01   +9.614824228665349e-02   +9.112794428072327e-01   +2.742400221748286e-01   +9.143237852310830e-01; +1.339598225828464e-01   +3.956050085331477e-01   +8.188613003903502e-01   +3.235828252677945e-01   +4.256919011463844e-01   +8.937861217465356e-01   +4.516196127362367e-02   +9.127199166076150e-01; +6.845105623980696e-01   +3.493642394946389e-01   +2.822899303094848e-01   +2.679216986994709e-01   +2.068439125587664e-01   +3.338470275271408e-01   +1.946821086634698e-01   +1.375369311564896e-01; +1.411725719753044e-01   +6.451396746483758e-01   +8.286833809890305e-01   +4.223891629159649e-01   +6.238043108093931e-03   +7.042489715365116e-01   +7.920138113866043e-01   +7.609507461600574e-01];
L2I_L3I_iGABA_netcon = [+3.250520221662471e-01   +6.730491175348132e-01   +2.660083027216216e-01   +6.452250959853640e-01   +4.907418088907014e-01   +4.136484759298977e-01   +4.346094463601811e-01   +4.982213306465146e-01; +3.464096284323375e-01   +8.502547615873646e-02   +2.189016256567173e-02   +8.137941154435998e-01   +6.716124896598494e-01   +3.074965387894706e-02   +8.988794196601407e-02   +6.116584417567594e-01; +3.291741789790861e-01   +6.278701196291391e-01   +3.816806926498443e-01   +1.021294534541669e-01   +8.292671071947152e-01   +6.354431486907804e-01   +2.226160564403300e-01   +1.576891047942567e-01; +5.887494879605296e-01   +8.306883590506295e-01   +5.546566618456226e-01   +4.486863743529539e-01   +5.449237684058726e-01   +6.780956221792543e-01   +3.758052601092036e-01   +6.363723717657356e-01; +7.232174631995129e-03   -3.171340406267659e-02   +5.503400899635655e-02   +6.996406900422566e-01   +2.284174090487648e-01   +6.164831754709310e-01   +4.361947831773484e-01   +2.692863910291532e-01; +5.652527465512859e-01   +3.993001151797121e-01   +4.301277281827834e-01   +7.059993728693335e-01   +2.211920932174676e-01   +8.003846624227713e-01   +4.352203831956540e-01   +8.429323279510818e-02; +2.065763350632337e-01   -9.085605341433059e-03   +3.965661209190158e-01   +9.828344654479659e-01   +6.661096256002734e-01   +3.752997879370235e-02   +2.477736331423278e-01   +8.500456826022438e-01; +1.779208271225133e-01   +8.822789500445035e-01   +9.059378752090769e-01   +9.078438517165320e-01   +4.802205571415283e-01   +1.200352474329559e-01   +6.849039786872024e-01   +9.030392821896852e-02; +3.271202537048797e-01   +5.379352941000282e-01   +2.475249685136089e-01   +1.656854880069263e-01   +3.832968109050833e-01   +2.768359803423113e-01   +5.952720081108362e-01   +4.694472510718033e-01; +3.932982433095085e-01   +2.035745980219079e-01   +2.032161031752915e-01   +3.988136271215310e-01   +9.731944175097412e-01   +5.017391833741083e-01   +4.704004558412417e-01   +9.209748902095380e-01; +6.131731278537460e-01   +7.521588705547705e-02   +3.345977728475925e-01   +5.826279253617132e-01   +5.371022644039256e-01   +6.455209753121947e-01   +8.807873662556277e-01   +6.359330723231612e-01; +3.651104739877735e-01   +1.788270255330842e-01   +6.104700021196832e-01   +3.597095256066802e-01   +1.257061973690698e-01   +1.799296896611324e-02   +3.029842188098349e-01   +6.563201462741715e-01];
L3I_L3E_iAMPA_netcon = [+1.022604119384104e-01   +6.538170243767689e-01   +7.905419899739012e-02   +1.840676508029406e-01   +2.379385912322858e-01   +6.241723758039258e-01   +7.986231210677143e-02   +3.510144778246465e-01   +4.878945781188562e-01   +3.619652540967441e-01   +6.008027542977148e-01   +8.763402133110458e-01; +3.549409019113209e-01   +8.104945440639134e-01   +2.595177108831163e-01   +3.217481583199025e-01   +6.907160419354317e-01   +4.372651013588029e-01   +4.265180809045327e-01   +3.635345432929260e-01   +6.248511579302515e-01   +2.833690073696196e-01   +6.669851929672480e-01   +1.931450974956042e-01; +4.284375173267861e-01   +3.171619283169420e-01   +6.951008673436105e-01   +8.599697753731592e-01   +5.501754563545526e-01   +6.255721063620013e-01   +9.917522699215505e-01   +4.455710298106601e-01   +2.285495435860681e-01   +3.282973131943284e-01   +8.972809655609574e-01   +8.285923633162484e-01; +4.828444133569441e-01   +1.145889443945306e-01   +5.673249494325927e-01   +7.132629584091903e-01   +4.099002606302787e-01   +5.930536906872014e-01   +5.386431478866534e-01   +6.978403531101537e-01   +5.102566154308715e-01   +2.325111625863110e-01   +3.955703848093709e-01   +4.957764966142949e-01; +9.131902755684700e-01   +7.716487192884036e-01   +5.623278947416248e-01   +4.843732013185017e-01   +2.344306003456602e-01   +2.981089322970405e-01   +1.375977464364719e-02   +2.421741274808690e-01   -1.905117194822280e-02   +2.485659245362707e-01   +2.632780951597175e-02   +5.036274477996161e-01; +3.725710969210849e-01   +1.601443473902607e-01   +6.283343985787126e-01   +4.162924316918427e-01   +9.701979095894834e-01   +5.851772548179301e-01   +2.972068450155512e-01   +8.449109625128236e-02   +1.856738903572000e-01   +5.538370506003005e-01   +3.063041101079622e-01   +9.473440078326548e-02; +4.871942923104842e-01   +2.473537858732392e-01   +8.251656782936476e-01   +8.322965250095883e-01   +1.210350448000990e-01   +2.241494374334698e-01   +4.201550743414086e-01   +1.273579503005766e-01   +8.936080693697751e-01   +7.329812853435813e-01   +2.828355979350591e-01   +2.581737496354544e-02; +3.731177259703870e-01   +4.006272513217605e-01   +3.193127159366930e-01   +5.941089206870172e-01   +8.142090429228445e-01   +2.308209435145935e-01   +3.880911296160218e-01   +2.940750448512904e-01   +3.250265601838472e-01   +2.347920548936135e-01   +6.462866771229295e-01   +5.275255734997832e-01; +2.972496220419225e-01   +4.632616293758910e-01   +3.713551079248378e-01   +5.656772640235981e-01   +5.700359749951076e-01   -6.406979743074925e-02   +1.011447101534141e-01   +2.336794234623066e-02   +2.999598891592726e-01   +2.067933918263101e-01   +8.301387455297815e-01   +8.871467153528767e-01; +7.138424321637367e-01   +5.754835153135516e-01   +5.943708416090456e-01   +3.955633521316421e-01   +4.794569794928076e-01   +4.007182982754401e-01   -1.512427414036150e-02   +6.527286723691006e-01   +5.784612194961544e-02   +8.419810310545801e-01   +4.396194956251162e-01   +1.453100828779763e-01; +5.632112653644671e-02   +3.015985521330912e-01   +6.213226491400997e-01   +2.531588012137294e-01   +2.222786146820471e-02   +5.327017973815791e-01   +7.975953151995743e-02   +7.219777625740872e-01   +6.913148473113621e-01   +1.458535981631464e-01   +6.313398300910776e-01   +3.046286259424922e-01; +6.273476391437344e-01   +6.848853567537238e-01   +4.141443289136449e-01   +6.119784417441251e-01   +6.394330528495061e-01   +3.330414782537427e-01   +2.874268094657188e-01   +7.997180705591850e-01   +5.659441687815622e-01   +3.783219482205277e-01   +4.954726444465615e-01   +3.641866005225415e-01];
L3E_L3I_iGABA_netcon = [+3.126873162432522e-01   +7.305067514080804e-01   +6.418177491060584e-01   +8.985670261500501e-01   +4.733237819732675e-01   +4.851947880834425e-02   +2.538404829948075e-01   +6.908121496975475e-01   +7.001236551814870e-01   +2.875704770813606e-01   +4.876621299720061e-01   +2.779102630749622e-01; +8.663179033582807e-01   +3.627970894182314e-01   +5.733983349498782e-01   +1.136548848660855e-01   +8.411250708909940e-01   +3.956909344755570e-01   +8.015496050288690e-01   +6.700645323659669e-01   +5.759416387493056e-01   +7.426712568484402e-01   +2.660103174088226e-01   +4.517697056500828e-01; +7.654404144706287e-01   +3.986140097818784e-01   +4.215081792527414e-01   +4.941595210806370e-01   +5.582501750629445e-01   +5.451599119369863e-01   +2.381426575636869e-01   +8.281332915105992e-01   +5.080602170967233e-01   +1.897559463103908e-01   +7.882413310165436e-01   +8.846725552978508e-01; +1.653873156590263e-01   +6.669158441603915e-01   +3.232349637708047e-01   +3.154286355027798e-01   +9.947658096876792e-02   +6.337313563300514e-01   +2.617940106679644e-01   +5.336720439800547e-02   +3.512990332478327e-01   +4.980482944646820e-01   +7.314492149889846e-01   +6.004059332248313e-01; +2.563059658350875e-01   +6.415622816631801e-01   +5.788667278442752e-01   +2.746457975613967e-01   +9.694082262318558e-02   +6.457876613513562e-01   +8.751222553592662e-01   +3.046064614927559e-01   +2.481695490858842e-01   +8.440859939250940e-01   +6.096622747668938e-01   +1.972545680401691e-01; +4.559356311826898e-01   +8.070780995482834e-01   +7.019554720841086e-01   +4.694350318733870e-01   +7.179675346448323e-01   +8.942175199324601e-02   +3.321376153470613e-01   +2.424533704584849e-01   +9.012398475395446e-01   +8.765363742552454e-01   +8.104505886084704e-01   +2.247373102093503e-01; +5.746559866310527e-01   +7.986421211874821e-01   +2.142393283224192e-01   +2.056812700310934e-02   +3.953496267790287e-01   +5.696687689768570e-01   +6.205713473945076e-01   +1.727721821905461e-01   +9.436035451499932e-01   +5.559781505562834e-01   -4.933224430190999e-02   +3.244360155076634e-01; +4.814530866127582e-01   +3.860156330072577e-01   +8.750477792344736e-01   +4.115716243645441e-01   +1.011808881671575e-01   +9.065528265781699e-02   +5.759751426827817e-01   +6.228856834097864e-02   +5.789105899012152e-01   +7.677118316080725e-01   +1.912759686754072e-01   +9.843645209866293e-01; +2.897383536190416e-01   +5.309820141330491e-01   +2.688275910718476e-01   +7.416167490094013e-01   +7.962620886844263e-01   +9.292947466193126e-02   +3.817916161335334e-01   +6.024480533621706e-01   +5.829676792107306e-01   +8.319723242421535e-01   +6.562384187096784e-01   +6.459349857334001e-01; +6.465109433526155e-02   +2.782913823237156e-02   +3.113493258410297e-01   +5.792921382686774e-01   +7.741877838866273e-01   +1.777481318480901e-01   +4.087892285909456e-02   +3.092099014485212e-01   +6.844637026377718e-01   +2.744502382302347e-01   +6.163461648738676e-01   +3.503927074384864e-02; +8.589381974713521e-01   +3.491122082419214e-02   +7.191740775913086e-01   +5.157006971551898e-01   +3.609095731433846e-01   +8.506995157110152e-01   +1.543039183443826e-01   +8.038968368074287e-01   +3.329892037859137e-01   +8.954021713553664e-01   +5.210673810644462e-01   +6.968384467769386e-01; +6.610213225967156e-01   +8.514563565272331e-01   +4.695119489330437e-01   +8.583539593362878e-01   +8.087735810433564e-01   +4.940920607842295e-01   +8.949090392559809e-01   +8.925625016556370e-01   +4.610340180547833e-01   +8.552124791347459e-01   +4.903926868235956e-01   +8.625245619250715e-01];
L2E_Input1_iAMPA_netcon = [+9.570716204565356e-01   +9.253990790230485e-01   +9.131134019083620e-01   +9.453602816243321e-01   +8.850090926544072e-01   +9.982994747850841e-01   +9.043293637823683e-01   +9.326366459912211e-01];
L2I_Input2_iAMPA_netcon = [+9.413494987576846e-01   +9.567836246814690e-01   +9.527273018061588e-01   +8.823194869600128e-01   +8.691214294521202e-01   +8.960500922355152e-01   +9.453812749253226e-01   +9.296229095492993e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
