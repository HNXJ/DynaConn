function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+9.415200774836584e-01   -9.525723186326926e-01   +6.950748526491899e-01   +1.492347103350107e-01   -5.441512796079633e-01   -4.720911772229386e-02   +5.148785814073450e-01   +5.169949743949052e-01   +3.801915167968288e-01   +4.328738156411228e-01   +3.060030717309673e-01   +4.850201333404003e-01   +1.959185223686462e-01   +1.667572376526310e-01   -2.483380713417441e-01   +2.631898477778704e-01; -3.826727464722604e-01   +2.097820439045907e-01   -5.889085958741448e-01   +2.941355378236215e-01   +4.830634558021731e-01   -2.450160300595621e-01   +3.728649448530498e-01   -1.127925493656500e-01   -3.774273336311007e-01   +7.366106283117388e-01   +5.379122193603925e-04   +9.613447789397764e-01   -2.374062987023828e-01   -3.677013424409344e-01   +3.380839920467961e-01   -2.959000559160724e-02; -1.766041920825917e-01   -7.294804407653752e-01   -3.774217858158221e-01   +6.759001384844597e-01   -1.667641921702956e-01   +2.850563482244625e-01   -1.094052949181883e-01   -2.435042768635866e-01   -4.671942052211122e-01   -1.444046637570918e-01   +1.151664836648902e-01   +4.448954937965890e-03   -1.530297986337008e-01   -4.050691050521598e-01   -9.604226073411670e-02   +8.452072193580365e-02; -6.057935191789074e-01   +7.192022980019801e-01   +2.172853462463964e-01   +7.526519090205013e-01   -1.821907501958097e-01   -4.282354636284681e-01   -4.212954272951250e-02   -4.396067828020767e-02   +5.359732332373329e-01   -2.386111669711602e-01   -4.657278835947564e-01   +5.699421646819850e-01   +1.345050751485000e-01   -7.731878878728976e-02   -2.383953922050337e-01   +2.446280303323248e-01; +2.066792587935645e-01   +2.387029224275941e-01   +9.371600773403138e-01   +7.912847460423061e-01   +1.335408842323456e-01   -4.572137131007245e-01   +1.847695356551205e-01   +3.184388317803787e-01   +1.162827033198918e-02   +6.122257399898674e-01   +3.787590133248917e-01   -1.211337374548865e-01   +3.375074305259277e-01   -3.852250974432193e-01   -2.162132719271671e-01   +7.240683899500650e-01; +4.317316132097155e-01   -1.818682943145405e-01   -4.679892801799662e-02   +5.694004968822313e-01   +3.675387843559632e-01   +3.300454124451934e-01   +5.558765185297416e-01   -5.858495667695666e-01   +6.496248030755714e-01   +1.501229201434609e-01   +1.933669140483556e-01   -7.094700426613919e-01   +4.980013508208370e-01   -2.693143875636689e-01   -6.577238980773067e-02   +6.368696881426475e-01; -6.239596660698921e-01   -1.015829349481899e-01   -1.247803609947374e-01   +4.664022371531108e-01   +9.033283040563340e-01   -3.028799243856789e-01   +3.475172309020246e-01   +5.833101652861550e-01   +1.310449751872581e-01   +3.301442168777585e-01   +8.678883482899171e-01   -2.965387549811204e-01   +4.577469459420008e-01   -7.021586963622861e-01   +8.762826452624001e-02   -7.375588230724281e-01; +6.098817239126880e-02   +3.328262409575379e-01   -1.225763087201581e-01   +2.805523215701701e-01   +9.253745232018512e-02   -5.092141241940665e-01   +3.712981117957840e-01   +4.965126129207840e-01   +1.208248780717508e-01   -5.125353056564187e-01   -1.924213794277055e-02   +2.427547105144482e-01   +8.457289520052379e-01   +6.785399142492496e-01   +3.455679896794533e-01   +2.743577229111395e-01; +5.381461008855654e-01   +7.314771654250405e-01   -4.826403137474737e-01   +5.658169800795481e-01   +2.613960882313366e-01   +2.841774398018183e-01   +3.829755631541464e-01   +5.811861783737982e-02   -3.136628582748996e-01   +3.966095235004702e-01   -2.613229711865267e-02   -1.869838682764996e-01   +5.179716208513476e-01   -4.121426116125216e-01   -3.485390079914540e-01   +4.439176834687043e-01; -2.153258154672349e-01   -1.901175699954324e-02   -3.407528711658638e-01   +3.933795014856761e-02   -5.302132485510636e-02   -4.931748841766390e-01   -1.258461983616752e-01   -4.878522875689812e-01   +1.306763122684297e-01   +6.064442300428445e-01   +1.362569209498428e-01   -2.746335284114481e-01   -4.287288234917168e-01   -4.482500915367595e-01   +7.762049160676326e-03   +2.369822437887782e-01; +4.291341342326365e-01   -5.775904039509235e-01   +2.189132405983134e-01   +2.506404718166813e-01   +4.601063622353375e-01   -2.025856614127177e-01   -2.133905394809358e-01   -5.199021545882760e-01   +2.016166928144324e-01   -5.530375367238336e-01   +1.997966088654324e-04   -2.498155674750361e-01   +5.756849280973731e-01   -2.986456416323026e-01   +2.640366431126578e-01   -2.653172248494328e-02; -4.802580012388461e-01   -6.485509147113792e-01   -5.694831713471726e-02   -2.803047742284019e-01   +3.475831482131191e-01   -1.069609929229087e-02   -5.310011230404094e-02   -4.260716664661106e-01   -4.440757532418594e-01   +1.633575396088147e-01   -1.666065713353615e-01   +5.420503271012225e-01   +5.475748448484811e-01   +7.920261355194805e-01   +7.606630179424478e-02   +1.052213784349132e-02; -2.854312308190320e-01   +6.317285180523866e-01   -3.784333088224454e-01   -3.422452107096348e-01   -4.955892795900714e-01   +5.462439986640412e-01   +7.225624300368579e-01   -1.227219653603973e-01   +2.840448353134080e-01   -1.735809859078223e-01   -8.106380916585400e-02   +7.622024538931391e-01   +3.229804616221698e-01   -2.472486772509940e-01   +2.944358887265455e-01   +1.930438007281404e-02; +5.116253116173685e-01   +7.407047174086085e-01   -4.932006841109504e-02   -1.881219452613748e-01   -1.139222934516129e-01   +4.195386645790359e-01   -5.148324089802385e-01   +2.456413053660773e-01   +7.133666249281738e-01   +5.693805960683089e-01   +5.065200125840461e-01   -3.648583929116055e-01   +1.321832871932548e-01   +2.962390634779139e-01   +5.083956972264814e-01   -2.838772791879077e-01; +6.417246287058569e-01   +3.817823374141469e-01   +5.282255606797002e-01   -2.488663691478458e-01   -5.141971873260965e-01   +2.039795735752231e-01   -2.735165265323622e-01   +3.222059426822479e-02   +4.659067866590234e-01   -4.826770142825267e-01   +3.344345534880835e-02   -3.668125029599548e-01   +8.341443985839857e-01   +1.453190842506642e-01   -4.885045121485312e-01   +1.636730309260981e-01; +5.258218609528393e-01   -9.414735182202669e-02   +4.291534560188372e-01   -2.734262722858666e-01   -7.236394366205674e-01   -2.701442233951738e-01   -2.847237311760694e-01   +2.148318573133878e-01   +7.898269857221267e-01   +8.394262969770794e-02   +1.770721175062478e-01   -1.758770711774862e-01   -1.557705282481089e-02   +4.437711915257855e-01   +5.682727101903859e-01   -4.891998767045010e-01];
L1E_L1I_iGABA_netcon = [+6.509694937558694e-02   +4.823840010246599e-01   +4.861431826380064e-01   -1.149282983159109e-01   +5.518077752504863e-01   +6.074662153492759e-01   +2.013581776875308e-01   +7.920206596958290e-01   -7.785088664184062e-03   -5.190741703377678e-01   -3.496743552545845e-01   -1.790563327052045e-01   +7.001726991640127e-01   +3.715828740172026e-01   +4.077466447152510e-01   -5.809997187907240e-01; +1.248877603022593e-01   -2.039762046740884e-01   -1.939487489246285e-01   -1.713369685266668e-01   +2.976617446887136e-01   +5.120930268104941e-01   -5.632991571587703e-01   -4.867029767501272e-01   +4.176904962221480e-01   -6.927948507234137e-02   -5.829315148434643e-01   +2.993823976386050e-01   +4.133497128495130e-01   +3.964462105337903e-01   +5.222033469047942e-01   +8.635592755560695e-01; -4.911279966487680e-01   +2.669248361816862e-01   +9.690645182083350e-02   -7.336056993536818e-01   +1.454394920815562e-01   +1.422165316517450e-01   +2.758182830716019e-01   +1.000000000000000e+00   -2.584278048664319e-01   -7.554709305152286e-01   -2.856389958150917e-01   +1.679312686236474e-01   +6.603089977153618e-01   +1.710233680448994e-02   -7.807821305183693e-02   -2.449236872944495e-01; -1.906847228333186e-01   +5.652891907666810e-01   +4.589533873939466e-01   -6.398370965074540e-01   +1.042579051123484e-01   -1.454727603667830e-01   +4.143404185180793e-01   +4.918749678648804e-01   -3.646018039870228e-01   -3.954569080847816e-01   +4.336985739046227e-01   +5.309757329935435e-01   -1.170455104613786e-01   +1.555468567857857e-02   -2.797503690505925e-01   -3.749207341759928e-01; +4.379970177140167e-01   +1.016524917082680e-01   -4.079557856268436e-01   +1.039844121540851e-01   -3.090608377946211e-01   +3.015393935595680e-01   +5.226333540035637e-02   +5.033014201868646e-01   -4.069893466800237e-01   +2.690194986382711e-01   -2.074482385249166e-01   -2.132793241974340e-01   -6.450723097079649e-03   -2.565588576324809e-01   -3.941502515386175e-01   +1.408289043730471e-01; -2.883517304565715e-01   +4.013811581146248e-01   -1.060559553747032e-01   +1.603327525353100e-01   +2.130929974334028e-01   +1.377178787309692e-01   +2.641923981620334e-01   -4.291327879542292e-03   +3.213083684088678e-01   +5.818425185071432e-01   +3.986179342282571e-01   +2.437436645672297e-01   +3.961964491820295e-01   -6.526755331729051e-02   +4.664715021330091e-01   +1.118310104457789e-02; +3.661336691277720e-01   -4.712164274801346e-01   -5.621065628232165e-01   -1.489190726648744e-01   +4.081536863548279e-01   -2.449654671088705e-01   +3.958870650794379e-02   +3.128804928864715e-01   +2.480399243094464e-01   +3.455065352820360e-01   +2.731990664212947e-02   +2.231232372200678e-01   +4.008609205050615e-01   +1.617290662901787e-02   -1.194309528620058e-01   +5.530019327094999e-01; -5.218946448499868e-01   -5.944454824447419e-01   -2.452915833407337e-01   +4.465883472604972e-01   +3.701374684929025e-01   +4.188221498705777e-01   -1.702819869929847e-01   +1.048626601497283e-01   -3.668568628548127e-01   +4.051901150856078e-02   +4.563330553796665e-01   -3.610447961001781e-01   +1.254421056247576e-01   +3.198880685474099e-01   +1.118206523443156e-01   +4.427758508966909e-01; -6.017401789375444e-01   -2.056239416169506e-01   -6.593268087398070e-01   -1.544358298374504e-01   -5.415381009786385e-01   +3.671922912540759e-01   -4.097328272307776e-02   +4.071732639403886e-01   +1.076297701144739e-02   -3.439896356051232e-02   +3.878360952249374e-01   +1.824337381092166e-04   -5.017178600051438e-01   -1.698498523450988e-01   +4.697809836948127e-02   -6.816670020864951e-02; +4.804330860015046e-01   +7.309327648231762e-02   -1.856283751598977e-01   -1.567742711481783e-01   +5.389865349600644e-01   +7.075392511693383e-02   +6.160677102570653e-01   +1.684374258401282e-02   -1.677679915684981e-01   +1.887365072243530e-01   +8.044492475500628e-01   -2.483980996430438e-01   +2.486370265026211e-01   +5.565900495812269e-02   +6.756246603838253e-01   +4.797384314816865e-01; +5.737551058685991e-02   +7.838156682099963e-02   +1.667841032759853e-01   -6.728351475017658e-02   -1.354112252040764e-01   +5.433977425722450e-01   -5.442841375097944e-01   +5.643782336042971e-03   +4.057289653247720e-01   -2.876917273230299e-01   +2.254444200078926e-02   +5.251039691158569e-02   +4.294782194576715e-01   -6.323025269339496e-01   -3.460896941929997e-02   -2.293937678592844e-01; -1.015835512277457e-01   -1.825736402159862e-01   -3.379166242954902e-01   +3.861213619989427e-01   -7.464529146473411e-02   -7.164540489983648e-01   +2.264502991714796e-01   +4.860667587061299e-01   -1.004099369124709e-01   -4.615887824450938e-01   -3.427104963418017e-01   +4.855336343806478e-01   -2.166510636864058e-01   +4.583090282673234e-01   -1.106829523663893e-01   +2.101568328641171e-01; -1.058679491499842e-01   +3.271796628573744e-01   -3.266153770998118e-01   +4.699230186846180e-02   -3.421447280208006e-02   -1.912979559721591e-01   -1.405637502213965e-01   +2.319105557556004e-01   -3.405435017262597e-01   -3.973066860112625e-01   +5.390507426555567e-01   +5.289450186622158e-01   +1.039658957826646e-01   -3.683633104603521e-01   -5.359449649250590e-02   -6.301807424172839e-02; +3.076937170596502e-01   -7.645822720260352e-01   +5.924527999571418e-01   +2.885879826941684e-01   +1.281941489657154e-01   +2.046803333450435e-01   -3.352766337549611e-01   +6.580383380348934e-01   +1.837386473702354e-02   -5.448552451558608e-01   -2.217519795181175e-01   +6.387642522335583e-01   -7.687361415801827e-02   +3.132337183598702e-01   -8.213438051435495e-01   -3.596824644198303e-02; -5.252177842732597e-01   +7.065947914282329e-01   +3.228154934196606e-01   +6.473448399199405e-01   -4.303107913335120e-02   +1.612602491998935e-01   -5.132165407639472e-01   +1.147706626056847e-01   +4.378662104633221e-01   +2.118524793908786e-01   -1.591694932851919e-01   -2.921536820433915e-01   +1.768925177236278e-01   +1.105840469633374e-01   +2.955949687244924e-01   -5.330698803449835e-01; -3.535254559971873e-01   -1.416792598998619e-01   -3.860448326457866e-01   -2.214316222707320e-01   +3.087906506678580e-01   -7.301591065741332e-02   -5.337343445167690e-01   -4.320329928716526e-01   +1.795213983353206e-01   -1.430785770145341e-01   +3.813710617183722e-01   -3.676845822831905e-01   -2.540513855809439e-01   +2.566459019963742e-01   +8.337461035101658e-02   +4.618265603398566e-01];
L2I_L1I_iGABA_netcon = [+4.003450535927112e-02   -1.253668410089080e-01   +1.334630652013323e-01   +2.745765183778792e-01   +6.957663628201853e-01   +3.095021369290048e-01   +4.840096703966393e-01   +1.077672674441083e-01; +1.247055705236293e-01   -4.616367989846456e-01   +3.364502221938737e-02   +1.917099256993630e-01   +6.476921914002625e-01   +4.474287303188534e-01   -1.644378165568592e-02   +3.126037362705020e-01; -2.080617368512329e-01   -1.046160268869425e-02   -7.545853340659403e-01   +4.887461229341639e-03   -2.560404628737927e-01   +2.178271586583344e-01   +3.079058097420900e-01   -1.012642371146170e-01; -5.021600698750588e-01   +7.771636116316814e-02   +3.121760146780146e-01   +1.886145064427311e-01   -2.908995682232185e-01   -2.305242285308261e-02   -2.605213238385554e-01   -1.057080634509110e-01; -3.439401232044343e-01   +5.774241210041633e-02   +1.924969292095372e-01   -2.072637240389924e-01   -4.411427956216202e-01   +6.449830298111128e-01   -8.190581480079365e-02   -1.210814830106592e-01; -4.266697911841592e-01   -8.824040811283362e-02   +3.266448945469910e-02   +1.438603950953974e-01   +8.833742095475958e-02   +5.210612731038053e-01   -1.501403581814194e-01   -1.825295987155120e-01; +3.846117870532128e-01   +1.200866667766583e-01   +7.196849718888675e-02   -9.268092603808741e-02   +5.628100298576390e-02   +2.644388646947832e-01   +4.189106234569843e-01   +6.384937951401414e-01; -3.634366247191518e-01   -6.289429778401372e-01   +9.095555317221710e-02   +4.058994353899679e-01   -6.940483090112999e-02   +4.565243154455485e-01   +1.147723125065431e-01   -5.583594965454468e-01; -7.063370541823020e-03   -4.717734157070669e-03   +4.715165878706808e-01   +2.905432092092176e-01   +1.000000000000000e+00   +6.260963985294529e-02   +1.649204771658523e-01   +3.668223492929603e-01; +6.493664313072217e-01   -2.805716109684089e-01   +5.483009247599346e-01   +1.084652457140789e-01   -4.128065410121565e-01   +2.822887453818240e-01   -3.309779923896113e-02   -1.384733248148484e-01; -5.695576157605015e-02   -3.632140362929384e-01   +4.898032111139547e-01   +2.368120601231227e-01   -3.088299285066748e-01   -3.955002974475576e-01   -3.033945138456413e-01   -5.010035210116680e-01; -3.441671188698033e-01   +2.717081492435879e-01   +5.767740519549254e-01   -4.417883263356460e-02   +2.599519159204308e-01   +3.252691436041579e-01   +6.668932670525809e-01   +2.579816189060817e-01; +3.901808406387362e-01   -3.909963656824298e-01   -1.630966468400927e-02   -7.031709802688016e-01   -3.059059036941564e-01   -1.253819049539754e-01   -5.213735379130423e-01   +9.650746748384999e-02; +4.585263075461555e-01   +6.741662413396021e-01   -3.449833960067744e-01   -9.598810150023006e-02   +3.770855613515473e-01   +6.602853501387766e-03   -3.793733106569118e-01   +1.063157191862081e-01; -5.143551872800523e-02   +2.331364674403472e-01   -1.419869768812068e-01   -1.954128892952878e-01   -2.440559348883805e-01   -2.937390084583891e-01   -1.259157992951893e-01   -5.698891410977605e-01; -4.608516911452648e-01   +2.526351452870172e-01   -3.138074756678081e-01   -7.089870222108183e-01   +5.011541629241667e-01   +5.154184616526190e-01   -5.118998882303929e-01   +1.598030092650378e-01];
L1I_L2I_iGABA_netcon = [-5.033277771361274e-01   -4.751141643979973e-01   +1.266454210442169e-01   +2.445601585676695e-01   +8.150142763979001e-02   -2.959924931909884e-01   +4.237096566534091e-01   +2.839432027580422e-01   +5.478299669075208e-01   +1.944568664969448e-01   -2.605828403482956e-01   -3.683156808532431e-01   +7.389558637780861e-01   +1.175397641709862e-01   -4.434780472155964e-02   +9.549622007042049e-01; +3.516766299990530e-01   +8.475906418995408e-01   -3.122049796845793e-01   +8.010468512161030e-01   -7.238135509410023e-01   +7.806369287047226e-01   -9.933088167351339e-02   +3.080763186647900e-01   -7.334050292360659e-01   +2.932851226352122e-01   +3.693828313337723e-01   +2.667822142128147e-01   -1.842053906025874e-01   +4.301442451766881e-01   -5.725419214763983e-01   +9.851591718239844e-02; +2.855442951824069e-01   +2.058252710870062e-01   +8.880312056202608e-01   +5.709319734268158e-01   +4.899136035132107e-01   +6.263881165989232e-01   +3.586125904187690e-01   +7.510120365430546e-01   -2.929417221622040e-01   +2.958294634655624e-01   +6.601038632209927e-02   -5.920679535906689e-01   +1.645589486423033e-01   -3.159898128962937e-01   -8.463657329212464e-01   +9.667855262703606e-02; +9.969330081851802e-02   +9.522319539349602e-02   -8.848947759426127e-01   -7.539712076873889e-02   +1.171774454668818e-01   -2.258862369990179e-01   +1.474563994553120e-01   -9.037933755781011e-02   +3.539180710128900e-01   -1.147345050129751e-01   +2.748005597421946e-01   -6.778365218889757e-01   -2.693608168554062e-02   +2.136661837964863e-01   +1.644355982683534e-01   -5.763264595538302e-01; +1.207240477483368e-02   +1.315398259512146e-02   -3.021496696878700e-01   +2.284339343933156e-03   +1.611013981927528e-01   +6.267832812797469e-03   -2.865755991566733e-03   +4.916136951737980e-01   -9.584784317959311e-04   -3.325817127077783e-01   +4.109629840393336e-01   +8.153380680453862e-01   -9.158453029064936e-01   -2.585525675054805e-02   +2.975049512199949e-01   +2.957720367028484e-01; +4.082918722775486e-01   -1.622289294830409e-01   +4.991023404035305e-01   +4.913567077431488e-01   -1.931082178186055e-01   -9.930713624532184e-02   +3.059250060036528e-01   +3.426851776247687e-01   -4.159943185141876e-01   -3.614968925629815e-01   +3.035536309350539e-01   +5.934012673948957e-01   -5.592228886774007e-01   -5.803004936054712e-01   +2.246457999832588e-01   -1.928647069176866e-01; -3.247525155069695e-01   +2.160517541396977e-01   -6.884346570300258e-01   -1.683464903615399e-02   -4.404536196046671e-01   +3.671556382451465e-01   -1.665520714016249e-01   -7.390851426463163e-01   +6.183530528585994e-01   -7.421685483865910e-01   -1.334750487273403e-01   -5.045700287835643e-01   -1.187313624256265e-01   +2.207970945428855e-02   +6.885749320442269e-02   +1.618686089588232e-02; +3.443617385083620e-01   +3.827898944438276e-01   -5.948649702996522e-01   -4.840751319771303e-02   +3.127755374653758e-01   -3.522126743631339e-01   +5.729690724542609e-01   +4.679306194185623e-01   -2.674547246317976e-01   +3.167398218477390e-01   -1.211702597399671e-01   +3.825743267005332e-01   +8.934607055980856e-02   -1.560103195764500e-01   -6.935084404506220e-02   -2.025222423221691e-01];
L2E_L1E_iAMPA_netcon = [-1.343109269998022e-01   +4.632044420206942e-01   -1.957903501915476e-01   -2.006227340533951e-01   +7.927041079778246e-01   +6.468533675576346e-01   -2.013280357937517e-01   +2.186240896815795e-01; -2.898010275404809e-01   +7.941743262918382e-01   -2.692395209998530e-01   -3.976739944709145e-01   +9.101756568057483e-01   +2.673454132982512e-01   -5.298134896312524e-01   -3.807808477501305e-03; +2.316249320137761e-01   -1.685804861155548e-01   +2.909769121305369e-01   -1.651777216399510e-01   -4.659918918904742e-01   -2.421640256763552e-01   -1.123219331566184e-01   +2.194279637485353e-01; +8.425063717208678e-01   -1.892440580890588e-01   +4.777496362001659e-01   -2.489738150911779e-02   +3.474789360938816e-02   +4.205046688764578e-01   +5.620662219608796e-02   -8.584752805763196e-02; -3.541186640416583e-01   +4.451428216137814e-01   +3.361184717136539e-01   +5.891833113898348e-02   -9.493774048565123e-02   -3.477031825370110e-01   +5.333733080700797e-01   +4.886914079434352e-01; +1.901400550173293e-01   +3.378585535881886e-01   +6.823973233256444e-01   +2.005760293572861e-01   -1.753139182204465e-01   -4.245605140816702e-01   +2.549910850314301e-01   -2.690645273362037e-01; +6.471295917728362e-01   -4.699693998897046e-01   -5.542959528989225e-01   -8.059251517211784e-01   +7.063884722870912e-01   +1.685696638981854e-01   -2.783515194487902e-01   +6.381943623674222e-01; +3.297949407919200e-01   -2.116101386267695e-02   +2.921073522708948e-02   -6.638369104512649e-02   +2.135538055853842e-01   -5.575522837695807e-01   +6.641001933799603e-01   -5.383635474500569e-01; +1.761575628782004e-02   -3.628336509346627e-01   +4.485419608618467e-01   -1.967182270223868e-01   -7.693732955136763e-02   -4.445494675754701e-02   -9.017247688404617e-02   -1.601791782764532e-01; +1.000000000000000e+00   +2.640858622710934e-01   -1.303828723370003e-01   -4.834163773509188e-01   -3.796663360691858e-01   +2.983989946147162e-02   +3.572176517879653e-01   -2.461298438420849e-01; +1.886576905378619e-01   -1.791880697408545e-01   -1.478249385578333e-01   +7.308006136528613e-01   -1.468237612450824e-02   +2.430630301202875e-01   -7.571089123258637e-01   -1.869354238708030e-01; +3.896016302655378e-01   -1.374927488812196e-01   -4.916378000609284e-01   -5.468876224836601e-03   +6.832923740060148e-01   -2.879454671745807e-01   -1.522866280106275e-01   -7.371048162845495e-02; -7.108983801985360e-01   +3.514575237933389e-01   +1.956452097154757e-01   +2.877309295536498e-01   +7.687179949095203e-01   -1.889552229275084e-01   +4.364119445345263e-01   -1.027938103048507e-01; +4.336378491893278e-02   -2.221164901004951e-01   -6.728066803318203e-01   +6.626427738724459e-01   -3.307696377227472e-01   -4.371471846077930e-01   -1.229912165573341e-01   -7.830269581951144e-02; -7.992088832599470e-01   +5.135626592274949e-02   +1.683055115257478e-01   -7.178843064964554e-03   -5.182951110337365e-01   +4.321472644777893e-01   +9.632233037445780e-02   -6.684150375108151e-01; -3.292094080480847e-01   -1.133648397176649e-01   -5.822371183846056e-01   -1.382746855150130e-02   +2.768992810416754e-01   -1.628370725559590e-01   +3.015116728050797e-01   +1.563035270093460e-01];
L1E_L2E_iAMPA_netcon = [+2.472236373632193e-01   +6.182030885544334e-01   +4.961462295051851e-01   -1.500255399290398e-01   -4.942560382529910e-01   +2.002480923033438e-01   -4.164683632397965e-01   -4.048680586371888e-01   -2.350222703764928e-01   +2.306317045865626e-01   +6.290599835113325e-01   -5.824976701646267e-01   +6.249922544616416e-01   +3.881177190789363e-01   +5.965636265090436e-01   -3.978799527625187e-01; -1.255884253110200e-02   -7.091986993620002e-02   +1.875346473518728e-01   +2.328215825588045e-01   +1.628996815300602e-01   -4.532367372253754e-01   +6.512422129664602e-02   -2.728161252816784e-02   -2.067167595071981e-01   -5.941935048545697e-01   -5.663530738253052e-01   +1.798105701495332e-01   +3.490611490240683e-02   +5.740298973684506e-01   -3.691199455465329e-01   +2.826520822499247e-01; -2.947651141229942e-01   +7.641867629565381e-01   -1.851398680812123e-01   -1.267032143665493e-01   -7.673509545955921e-01   +3.237796866316509e-01   -8.832601275384112e-02   +4.533193185663277e-01   -8.396931213086383e-01   -1.175547488224936e-01   +2.439486193854017e-01   +4.495724468456785e-01   +6.118813367475199e-01   +4.014052982175307e-01   +2.506108632009615e-01   +2.663486363410654e-01; -6.699308026937992e-01   -1.559400383447761e-01   -2.032496383953096e-01   +5.549054630301838e-01   -8.079781374035951e-01   +1.772710698966400e-01   +1.669601750470102e-01   -4.106708570249828e-01   +1.594454093115043e-01   +3.837297743638541e-01   +2.289279149168351e-01   +1.961091503940881e-01   -1.611954552570948e-01   -2.624099137849876e-01   -1.153238937099416e-01   +4.174780097834869e-01; +5.260262985978669e-01   +4.144025258471541e-01   -5.793883813606481e-02   -2.378540403126604e-02   +4.128281835775039e-01   +6.619161533278796e-01   +6.443457170204233e-01   -1.188043375813778e-01   +2.523155124953734e-01   +5.309481662604529e-01   -2.184923228727813e-03   -3.643248207268741e-01   -2.608949528133290e-01   -2.481976817463729e-01   -2.765766924459139e-01   -3.273525391862063e-01; +1.372127570361027e-01   +7.145266486119924e-01   +1.076704952446937e-01   +6.550650923478020e-01   +6.393960360033160e-01   +2.539787737036217e-01   +4.334021842798265e-01   -2.684925452541546e-01   -6.307787597665874e-01   -5.147803079776236e-01   +4.683246967606090e-01   +4.207737964251705e-02   +1.351359898199626e-01   -7.156558761523837e-01   +3.594106403301272e-01   -5.376069552991528e-01; +1.056134955386108e-02   -5.675608770409207e-01   -2.717041946483534e-01   +1.647900154034853e-01   +9.365244530494786e-02   +9.164013837403050e-03   +2.445488889129244e-01   +7.974231658959468e-01   -5.256534185807253e-01   -3.838543136016437e-01   -1.020545561803304e-01   +2.877935531534694e-01   +4.020626874269154e-01   +4.442840108950180e-01   +1.000000000000000e+00   +1.552052608361406e-01; +4.265701337118041e-01   -1.504344876131532e-01   +1.080523301735210e-01   -2.807541764131709e-01   +3.537124566850706e-01   +8.140625472784920e-01   +3.860344549694403e-01   +1.373955609153516e-01   +1.802097255443226e-01   +1.740616023403522e-01   +1.356940281096906e-01   -4.726240472414319e-02   +2.324643258018477e-01   -4.472299018230450e-01   +1.618192400244547e-02   +2.721206553211581e-02];
L2I_L2E_iAMPA_netcon = [-4.526803836938493e-01   +1.998680804469832e-01   +6.562133920003910e-01   +1.642233649385096e-01   -1.123098692513013e-01   +2.764176822965155e-01   +1.887283177637101e-01   +7.894368111028243e-01; +4.077381094468929e-01   +1.748964643683072e-01   +2.123482859382929e-01   +9.297137411065420e-01   +4.780001358679375e-02   +3.806057896172872e-01   +3.787562097045024e-01   +1.463835477740182e-01; -2.136264637305247e-01   -1.741016084621141e-01   +5.640018910329836e-01   +4.964743827540986e-01   -3.660132096568024e-01   +4.789487464136871e-01   +1.233761514215438e-01   +7.567005276758844e-01; +3.206797371964159e-01   +6.852172278442051e-01   +6.015865017871190e-01   +7.942816322431125e-01   -4.253877275153493e-01   -1.082241834235817e-01   +9.998903281162494e-02   +2.213569088324110e-01; -2.370218207942817e-01   -3.138795099852113e-01   +2.489276189495849e-01   +3.284911975532630e-01   -6.509970441203100e-01   -6.957340071500270e-01   +2.205165039099262e-01   +7.269906777833635e-01; +1.757126037294564e-01   +4.287680967725852e-01   -1.113515103400306e-01   -4.530445618702607e-01   +4.824778838429644e-01   +5.407958931590962e-01   -2.690068784227481e-01   -1.730629501544199e-01; +1.462534360377244e-01   +4.393896062901664e-02   -3.796145170053626e-02   +5.254005657096710e-01   +1.063781778655949e-01   -4.448315597588105e-01   +4.151950832491373e-01   -2.813211420789377e-01; +4.254713474366595e-01   +3.246900589253308e-01   +5.345095187438568e-01   +1.086827814443029e-01   -5.967283662206737e-01   +1.666826783376815e-01   +3.360668689516790e-01   -1.018794375330842e-01];
L2E_L2I_iGABA_netcon = [+3.089054859158279e-01   +2.651748176388057e-01   -3.476693358821129e-01   +5.858318009812377e-01   +1.929189003519132e-01   -2.661404318578546e-01   +4.985448095212237e-01   +9.848452144916173e-02; -4.561343930178821e-01   +8.717342220473183e-01   +7.471403041089950e-02   -5.419692482832361e-02   -5.143617853122025e-02   +2.728343511813791e-01   -3.654112686783408e-01   +7.219156831572784e-01; -6.081782590869373e-01   +6.090070910039391e-01   +7.331411826746661e-01   +4.413910588947345e-01   +5.332815044456009e-01   +4.564112562853686e-01   +3.236390576439229e-01   +5.842568671627755e-01; -1.853186793758222e-01   +1.209058589622081e-01   -5.062608591460188e-02   -2.627953656827338e-01   +2.927532163354293e-01   -2.608456979640619e-01   -3.158940085446563e-01   +7.010973142614878e-01; -8.389971789029305e-02   -5.269720428419167e-03   +4.289589234092041e-01   -1.338382631433421e-01   +2.306965533796669e-01   +2.854787642021848e-01   +1.433354675823308e-01   -1.816405504913967e-01; +4.116210553295863e-01   +2.031869843468476e-02   -5.383427863711326e-02   -2.196857016339297e-01   +4.991070414501584e-01   +2.269851275860028e-01   +6.388073474651026e-01   +7.544389059695192e-01; +5.285917856293811e-01   -3.097017267937423e-01   +4.712739568974414e-01   -2.037641649706383e-02   -2.825468667868153e-01   +1.539048984664589e-01   -1.173346397216308e-01   +6.728286758805060e-01; +2.192166638014016e-01   +2.982639052608312e-01   +3.092029077334268e-02   -2.154320860272834e-01   -1.193948388907264e-01   +4.910354402547440e-01   +7.021281690250307e-01   +1.368755327035593e-01];
L3E_L2E_iAMPA_netcon = [+3.861542609146100e-01   +8.950627309286863e-01   -2.656235382355995e-01   +5.445813998150695e-01   +3.537268701266135e-01   +2.563479918605957e-02   -3.998386778260087e-01   -3.321535526982740e-01   +5.667734563858968e-01   +8.499485700078503e-03   +6.225660155981511e-01   +7.291865869849056e-01; +3.099500713074256e-01   +4.946896586716427e-01   -5.936187629701610e-01   +4.566805458118032e-01   -1.154007271122942e-01   +1.380920418421749e-02   -4.153596005881466e-01   +3.584128182732136e-01   +3.580545993108450e-01   -2.451940785009896e-01   -3.547146110743271e-01   -7.954854120989688e-01; -5.590013470466315e-01   -2.484258622820543e-01   -3.118583105016751e-01   +3.171622864190867e-01   +2.108711852125709e-01   -3.860599284991638e-01   -2.048025716891811e-01   +1.290779831744622e-01   +5.371634671042266e-01   +4.249356101091124e-01   +1.889221635631937e-01   -4.003851835399562e-01; -1.026185873077623e-01   +4.928146954781474e-01   +1.398531112827676e-01   +1.029555158300428e-01   -3.659409653226794e-01   -1.437339270885720e-01   -4.551197369287467e-01   +3.762318387658755e-01   +5.207406447460519e-01   +5.212065970687378e-01   +6.625209864288198e-01   -7.722061279196119e-02; -3.010019148403018e-01   +5.329495610355162e-01   -4.777584963750627e-01   +5.510954374763105e-01   -4.126613432239759e-01   +1.882492717787628e-01   -3.875365925405132e-01   -1.395083832713302e-01   -5.706958935851500e-01   -3.679542386348125e-01   +4.112781981655956e-01   +4.703996796167225e-01; -9.125049325144670e-02   +5.832727123417164e-01   +8.373411999747302e-01   -1.237656601482244e-01   -5.621863425672453e-01   +1.824292634975848e-01   +1.586342039564764e-01   -3.470997276009242e-01   -4.075769895535691e-01   -5.210267011142791e-01   +7.356138457269585e-01   -7.268648213840243e-01; -8.005158666728207e-01   +3.058352205505223e-01   -2.086325307396353e-01   -7.308285038172574e-01   -7.272493947318517e-01   -1.133546996916419e-01   -1.499421428947877e-01   -2.065618423939413e-01   -5.874061866996867e-01   +1.184962146407258e-01   -3.071412440655989e-01   -4.026552943952558e-01; +7.239886557351012e-02   +3.680041170233708e-01   -9.578273996348122e-02   -6.135350138452123e-01   +2.542971190892304e-01   +3.144508560206550e-01   +2.766534666850300e-01   -2.289943709783768e-02   -1.603163096661581e-01   -4.136753467205244e-01   -5.455627324040792e-01   -3.983836058900922e-01];
L3I_L2I_iGABA_netcon = [-4.984403658284858e-01   +8.130132962226863e-02   +2.956629386087578e-01   +5.714093311610278e-01   -5.679688506829031e-01   +1.136471736124842e-01   +7.048704719084181e-01   -2.069392424732011e-01   +1.157637285841072e-01   +6.937917969569815e-01   +3.611090197977688e-01   -3.356507275482349e-01; -5.635741000137194e-01   -9.174953939676495e-02   -8.021243980598983e-01   -3.871914226144550e-01   -2.315148653314899e-01   -2.913086861005594e-01   +4.258646854006967e-01   +1.312733203720640e-01   -7.817240364399454e-01   -2.995789864449414e-01   +2.672126918057571e-02   +5.561283972160359e-01; -4.295406060234672e-01   +1.600512042010239e-01   +4.825323240866500e-01   +4.694844168469651e-01   -1.206493557081813e-01   -2.901463112626812e-01   +3.886726094055004e-02   -6.344935795705320e-01   +7.316543464199621e-01   -2.092117046353843e-01   +2.756668661313841e-02   +1.638582435808709e-01; +1.634628694654469e-01   +3.483749574271777e-01   -2.198244008021638e-01   -3.778977211567628e-01   +1.606706683332296e-01   -2.537009131494550e-01   +4.185882070236023e-01   -1.070601828699835e-03   -6.957953009528414e-01   -1.962949223156379e-01   -4.096239234771799e-01   +1.202415574104761e-01; -5.552432087794474e-01   +1.039922423134238e-01   +1.869163215056779e-01   +2.954474866498966e-01   +1.228091516587586e-01   +2.522847748200356e-01   -6.703961389741083e-01   +7.004921754192009e-01   +1.259338398512276e-03   +5.990499505601075e-01   -2.784108791302286e-01   +1.376135795719208e-01; -2.491877996805634e-01   +2.110027684844175e-01   +1.489054119919594e-01   +4.617982234755397e-01   +4.840543619188828e-01   +6.713370819250049e-01   -8.770636540368646e-01   -1.790992415316693e-01   -6.097177422085209e-01   +1.753891138859137e-01   -5.522630954658296e-01   +2.747003215906002e-02; +5.037593619425249e-01   +3.153425151778056e-01   +1.724455766425162e-01   +1.189214577619117e-01   -1.250426151584580e-01   -2.985814390735498e-01   -2.708346522220665e-01   +1.335541371956261e-01   -5.346420580214285e-01   -4.904165728352508e-01   -1.145022140523752e-01   +2.585320675451220e-01; -1.333203507913719e-01   -6.292437184706345e-01   +6.280146224457683e-02   +6.458200210584714e-01   -1.442800737630001e-01   +2.102370002066982e-01   +4.544547049630828e-01   +5.027696386037128e-01   +5.611767517188959e-01   +2.081504598229741e-01   +2.329666650336461e-01   -5.752983393402967e-01];
L2E_L3E_iAMPA_netcon = [+2.874498975525062e-02   -4.528345244376283e-01   +4.990611018920975e-01   +2.544973647736752e-01   -3.105245196722522e-01   +4.546218698868181e-01   +2.732957965020477e-01   -2.251843859432833e-02; -1.345815887285486e-01   +2.369661663935876e-01   -4.825879634957893e-01   -3.021934748792759e-01   +2.327375631256035e-01   -2.929328284283688e-01   +1.072450529452952e-01   -8.538006918145874e-02; -4.608640454827992e-01   -4.097939827161428e-01   -5.428207815270270e-01   +6.453637247098181e-01   +6.328203949471808e-01   +4.033356054106627e-01   +5.566039581210588e-02   +4.057574911347262e-01; +1.000000000000000e+00   +1.241122050417073e-01   -2.258560466956884e-01   +7.085408295397064e-01   +1.917540042113997e-01   -2.411245394318875e-01   -4.845886446625161e-01   -4.264041774975996e-02; +1.445794135800707e-01   +1.686288110242045e-01   +2.972751307484354e-01   -1.939281706701895e-01   +3.723892984801055e-02   +2.633412283901669e-01   -5.899919177966703e-01   +3.125434014579653e-02; +7.153097767543803e-01   -1.340225675670599e-01   +4.662738431511645e-01   +2.574188550318719e-01   -3.327482692947106e-01   -4.403799689380419e-01   -6.630692991668202e-01   -6.808170632161135e-01; +5.623998121507358e-01   -6.719534023655201e-01   -1.322521506832403e-01   +3.754806563233646e-01   +1.476094116312925e-02   -5.318647530318807e-01   -1.911017154279300e-01   +3.548252757448025e-01; +2.292555221918153e-01   +7.106400100974940e-01   -2.062037081356273e-01   -1.093799933373941e-01   +6.559051237562058e-01   -6.524223372976075e-01   +6.344320687669028e-01   -1.835164739467118e-01; +4.915165902262416e-01   +7.339260751380744e-01   +9.000363001264451e-01   -2.157468051447910e-02   -1.977392053482096e-01   +1.366768458886343e-01   -4.205769638574877e-01   -1.651999749766977e-01; -3.340057906193249e-01   +3.432332714510610e-01   -1.054534563004616e-01   -5.162729442396499e-01   +5.713964450418404e-01   +3.114333133957397e-02   -1.522619640944999e-01   -2.489265892591956e-01; +2.619966802745479e-01   +1.149532722089750e-01   -5.981170792720332e-01   +3.224307516775266e-01   -6.921538328157324e-02   +3.615644659020751e-01   -8.142962167442319e-01   -5.036728625585046e-01; +4.619761744251533e-01   +1.476720769414921e-01   +7.275792007382866e-02   +3.191061264737209e-01   +4.398964163703759e-01   +4.524192737528845e-01   -5.616309362007038e-01   +3.221065489230778e-02];
L2I_L3I_iGABA_netcon = [+2.420620510632106e-01   +5.036919310306277e-01   -1.104997484656948e-01   +2.422454549369836e-01   +8.595990013166941e-01   -4.848356001659060e-04   +4.614291891362267e-01   +6.919672284839278e-01; +1.503137929603677e-01   +2.262358126226773e-01   +2.133318689241629e-01   +1.791702532484064e-01   -1.227258195061622e-01   -5.095133065624294e-01   +5.469120135161921e-01   +2.187822917046036e-01; -5.191461712585483e-01   +9.106448322427582e-02   +3.189822458993756e-01   +6.072631800158023e-01   +1.574268740488117e-01   +2.658562353270925e-01   -1.513147096335876e-02   -3.802880868680422e-01; -1.512393720201965e-02   +7.416513347014332e-01   +3.812110738871042e-01   -2.659849173858139e-01   +1.285332881602090e-01   +1.999076237086912e-01   -4.575325305352329e-02   +5.183704753022198e-01; -1.621698218918181e-01   +2.569754481377061e-01   -2.292635176057506e-01   +3.243151789765039e-01   +4.664342201731295e-02   +1.513338816777244e-01   -9.560186297320156e-02   +9.091772184037251e-01; +4.073468892676898e-01   +3.806317843738554e-01   -5.034957744427814e-01   -1.030471990665936e-01   -3.042338711912529e-01   +3.347700863552462e-01   +4.672491798105430e-01   -1.609787732981407e-01; +4.198376583612051e-01   -3.348655246104884e-01   -2.614805076678106e-01   +8.174860300861374e-01   -4.936253647026236e-01   -7.061889072432781e-02   -5.889841325525403e-01   +5.543362516466229e-01; +7.759099836567187e-01   +2.243781531398494e-01   -1.922248038900624e-01   -4.616400996026528e-01   +2.120463806263809e-01   +3.020637813897096e-01   +2.674926659729221e-02   -7.831361063310810e-03; +9.072287793547640e-02   +5.799502474452582e-01   +1.192381171309217e-01   -5.306481080685783e-01   +9.733659998139277e-02   +5.593840058019380e-01   -1.107014182123826e-01   +5.698499856629582e-01; +1.383410643619216e-01   -2.526911602689581e-01   +1.830957763189222e-01   +1.371998593190343e-01   +4.050872682919489e-01   +4.046941793004127e-01   +1.325574926252426e-01   +7.629987534580530e-01; +2.731319135200010e-01   +1.518274563746141e-02   +6.637641767736482e-01   +2.285672687397221e-01   +8.541693494451108e-02   +6.137659499588946e-01   +1.129619855282003e-01   +6.972155159900031e-01; -4.005376546991343e-01   -1.913121745828289e-01   +6.607750185109265e-01   +4.812892572434894e-01   -2.663779638859360e-01   -2.521344388282591e-01   -4.696929567765839e-01   +1.907218516403794e-01];
L3I_L3E_iAMPA_netcon = [+2.541714931289485e-01   +6.268271811293498e-01   +3.968288350663780e-02   -2.446424702151664e-02   -4.212675361420443e-01   +5.477411949632176e-01   +6.772796800482542e-02   +5.395075573792005e-01   -9.732130536796188e-02   +1.484109791209519e-01   +7.197209084022306e-01   +9.633278017813942e-01; -3.452101054868205e-01   +4.798122253754725e-02   +6.395552695591311e-02   -4.695593479225574e-02   +3.672684413591922e-01   -3.932497102968402e-01   -3.051801756102168e-01   -8.696363683730371e-01   +1.471232151434877e-01   -1.101789251320061e-01   -2.594952741945962e-01   -7.940080853275491e-01; -4.158697259009262e-01   +2.920280424070549e-01   -5.340133470055757e-01   +3.314335471169410e-01   -2.534097101442059e-01   +7.131083967848934e-02   +5.998140572399762e-01   -5.884067924340342e-02   -1.695023886094133e-01   -7.215131804624081e-01   +9.572901206455445e-02   +9.269127710877898e-01; +9.585249332995321e-02   +4.537395464699018e-01   -3.899830699790409e-01   +6.812726869467578e-01   +6.606286969541573e-03   +4.701368857783264e-01   +9.597828272220743e-02   +7.879688082557479e-01   +2.951018910013903e-01   +5.613544404965125e-01   -6.430187866690642e-01   -3.449423502588975e-01; -6.089502929059507e-01   +1.348475087832004e-01   +5.262093451221914e-01   +5.750477428739024e-02   -2.844735212932115e-01   +3.234486085471998e-01   -2.112050212716906e-01   -6.366521689787011e-01   +3.344971023874426e-01   +9.628722181029309e-01   +9.945809842841402e-01   -2.342910823520913e-01; +4.788364454533222e-01   +7.606815979017725e-01   +5.955661538527347e-01   +1.459807011653706e-01   -1.260866508583212e-01   -1.128194026356066e-03   +4.975471214096714e-01   +2.422080528400237e-01   -1.328485900421609e-01   -8.632825855829140e-01   +4.186940376307357e-01   +1.742883793788390e-01; +7.823257235752836e-01   +8.127500067335852e-02   -4.110623577580020e-01   +1.500438000008252e-01   +3.226387943670539e-02   +7.314849989104238e-02   +2.117563301595436e-01   +6.913332820400964e-03   -6.895121882417957e-01   +6.649791226105594e-01   -4.621438135390393e-01   -1.089290222481730e-01; -7.029558917112271e-01   +1.738030687037619e-01   +4.944839229218410e-01   -3.680422747294850e-01   +2.687103046884631e-02   +7.734232047578014e-01   +4.628870390576126e-01   -2.359278676038435e-01   +2.118637940589602e-01   +4.535340229096581e-01   +5.651252263547117e-01   -1.733048470032270e-01; -3.972470141292228e-01   +2.399470368763268e-01   +6.824831592787903e-01   -2.677870539145300e-01   +1.931841786355281e-01   +2.627105842880710e-02   +5.428917302564333e-02   +2.387567453372137e-01   +2.100320744353878e-02   +7.980427978466207e-01   +9.868282198779164e-02   -4.883585203642358e-01; +1.280507080879475e-01   +1.317109170251856e-01   -8.772162111108467e-02   +8.513549368526273e-01   +1.831550102328242e-01   -8.975361655107479e-01   +2.163162299003094e-01   -1.402426812751205e-02   -5.356621936721292e-01   +3.705713515753969e-01   -2.594744573405167e-01   -1.991379528639700e-01; -3.982259198697516e-01   -4.198053134015712e-01   +6.418895659505479e-01   +6.249058675052228e-01   +1.677210201579673e-01   -5.880681037926581e-01   +5.406498102409868e-01   +6.105891778265730e-02   +6.995678958298537e-01   +6.159995517849364e-01   -3.966044662431477e-01   +4.130697941593040e-01; +6.382827661373056e-01   -5.391666802950845e-02   +2.697237670009194e-01   -1.382346359565929e-01   +8.366210156770896e-01   -1.977200123172501e-02   -1.049911689356416e-01   +5.888845126619038e-01   -1.917941314912754e-01   -4.474368019951036e-01   -4.338798665426689e-01   -5.269942866327190e-01];
L3E_L3I_iGABA_netcon = [-8.841653604937448e-02   +3.893256500091745e-01   -5.044903726409848e-01   +4.572836015190926e-01   +4.707099469564720e-01   -4.010247785540171e-01   +2.784100521321448e-01   +1.694331415785064e-01   -2.560972835793027e-01   +4.153845488060895e-01   -7.307122768343047e-02   +4.274383898353684e-01; -2.230587417669544e-02   -1.257400257422923e-01   -2.349228711460390e-01   +3.131924726245441e-01   -3.057558591262379e-02   +6.473417391497005e-01   -2.020675983721070e-02   -6.681784696275489e-01   -5.716922889289136e-01   -7.520221182596255e-01   -3.752647082120822e-01   +2.202027300203007e-01; -1.559316423314932e-01   -1.791679336423667e-01   +1.452101498805601e-01   +3.664316460204012e-01   +1.928617549988162e-01   +3.618762896069758e-02   -2.877767769868412e-01   +4.543266519582053e-01   -1.591632113453881e-01   +1.907833098633169e-01   -2.916728857160103e-01   +5.723567903876867e-02; -1.589482618702311e-01   -2.902378427725237e-02   +7.796860584027189e-02   +3.479142803525463e-01   -3.428229546652873e-01   +2.407027672712180e-01   -3.921931793783935e-01   +2.725799730670005e-01   +6.460531529414434e-01   +2.489871697828699e-01   -1.770554058840202e-01   +8.437877271054604e-02; -2.552429368574528e-01   -2.513838843114303e-02   -2.331948411177430e-01   +9.429509014841285e-01   -6.934615969766665e-01   -2.806458274391114e-01   -4.618106392813539e-01   +1.124117931337212e-01   -1.149451666516774e-01   +9.246028016539959e-02   +3.728436182262191e-01   -8.438449986698872e-01; -6.345498031862904e-01   +2.092169254032436e-01   +6.033150885689642e-01   -6.442628536395338e-01   +6.280598753101495e-02   +8.616194536551883e-01   -1.000000000000000e+00   +3.713388356670239e-01   -7.050487522533614e-01   -4.576857817115549e-01   +6.564979244518250e-01   +8.247621734384881e-01; -1.069249608951047e-02   -2.003715013351582e-01   +6.698982386400532e-01   -1.357481681572103e-01   +2.600155619066919e-01   +6.520924585515824e-01   +3.377111818088745e-01   -3.800268496459224e-01   -4.030169740946952e-01   +3.089930292251825e-01   +1.811288916387455e-02   -3.895590693677506e-01; -1.700818373800405e-01   +2.721002226524475e-01   +6.448099155535814e-01   +8.766126799055158e-01   +2.858996748978051e-01   +3.455380004517798e-01   +3.060234926823283e-01   -1.372887469894174e-02   +1.976449295066076e-01   -1.197971207567759e-01   +3.156737446118502e-01   +2.894113575403083e-01; -9.770799766261302e-02   +2.978153205469142e-01   +1.406532030779148e-02   +2.201820614193604e-01   -6.344410833557398e-01   -7.765035283007297e-02   +5.184499560858495e-01   +6.378673673564501e-02   -5.146814670553848e-01   +1.695918121344032e-02   +1.935604185218820e-01   +4.481473283640426e-01; -5.289069271469578e-02   +3.064314292346190e-01   +3.262334841517294e-01   +4.395650301600319e-01   +5.731831245198581e-01   +7.310139244162563e-02   +8.751796871419888e-02   +3.164011078070619e-01   -4.189883732655204e-01   +3.127885324340730e-01   +8.663512632970555e-01   +3.336879178673417e-01; -2.032615794667227e-01   -1.884164074971217e-01   +2.922374469424203e-01   +6.564689423425250e-01   -1.680890271967522e-01   +3.448439390142226e-01   +1.471087884685616e-01   +1.051771733713731e-02   -1.509918622008418e-01   -1.351888917353598e-01   -4.534674590785704e-01   +4.502524784278082e-02; -3.410294198920556e-04   -3.243464170423454e-01   -1.762312782710230e-01   +5.288623570409299e-01   +1.113465779459043e-01   +3.595444236728613e-01   -3.547918347226234e-01   -3.092570687676833e-01   -1.317628558933550e-01   +2.906047869086359e-01   +5.803390059110989e-01   -8.520899452123306e-03];
L2E_Input1_iAMPA_netcon = [-1.406367770601711e-01   +9.274463765713264e-01   +4.497734692761937e-01   -4.975801323025165e-01   +1.014774410672375e-01   +7.325645077730381e-01   +4.279612517449325e-01   -2.723418585424894e-01];
L2I_Input2_iAMPA_netcon = [-2.442299506078804e-02   +1.293100240077098e-01   +1.996864568113127e-01   -8.671114221900042e-02   +5.394269635508239e-01   -7.043299918726925e-02   +7.693366122696844e-02   -1.470954867801314e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
