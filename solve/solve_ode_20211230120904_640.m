function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.820170684576501e-02   +8.227857182830678e-02   +4.900992594039693e-03   +9.226080077408268e-02   +8.831819629780296e-02   +4.939795670087638e-03   +4.965340148244882e-02   +1.476412291118082e-02   +1.875791524415536e-02   -2.920750109127778e-02   +6.511228006394727e-02   -7.743570857643493e-02   +6.252785006004465e-05   +6.664045627822948e-02   +2.303933366377026e-02   +9.636518465291370e-03; +4.454767238722989e-02   +6.062539403603173e-02   +7.186151399543962e-02   +1.741197561599953e-02   -3.130678622942428e-03   +6.395182453114276e-02   +3.254997806107072e-02   +3.620393452982957e-02   +6.739620492686793e-02   -6.495593038263244e-03   +5.120895216535080e-02   +3.382732207425254e-02   -4.325081532578590e-02   +4.333371090296909e-02   -3.466800741184999e-02   +4.471508014222646e-02; -6.338977981734520e-02   +5.126039617647962e-02   +2.608244883512974e-02   +1.617565881081168e-02   +1.211871730290893e-02   +1.202355884083581e-01   -2.167724841486765e-03   -2.057620019906613e-02   +6.881388917184027e-02   +3.469643747034255e-02   +1.057202845316146e-01   +6.881163479726167e-02   -4.188491744323419e-02   +5.573438833153619e-02   +3.955748173184925e-02   -1.005224715643495e-02; +2.917435424091086e-02   -2.090706089498318e-02   +3.894599733023416e-02   +8.224433222000541e-02   +1.093236986327546e-01   +2.218332364028171e-02   -2.368461623835388e-03   -4.741627227857534e-02   -1.828122078589615e-02   +9.356663497905750e-02   +7.875900973029300e-02   +2.045799397430808e-03   -6.656479558195073e-02   -1.006449005025140e-02   +8.520918514653932e-02   +8.669310891948866e-02; -3.536870550685409e-02   +6.991944305704655e-02   +4.387486501221979e-02   -1.058660779582555e-02   +1.501897662228973e-02   +2.279585378435500e-02   +4.406662584387418e-02   -4.244652662741660e-02   +3.259075956459870e-02   +2.741491833984581e-02   +6.900989598660370e-02   +7.072559353271009e-04   +4.398836535616637e-02   -3.131589092563331e-02   +8.223884393073455e-02   +1.228765001214984e-02; +1.586975430671396e-02   -7.478528739534893e-02   +1.142132322987393e-01   -2.206790100104100e-02   -2.830467560223612e-02   +2.269367841821256e-02   +1.252037676301295e-01   +1.661718046027083e-02   +8.959334245906564e-02   -3.462782655139708e-02   +4.117179091345938e-02   +3.362822696288059e-02   +5.841306148819454e-02   +1.605326237142143e-02   +1.076847666156261e-01   +1.606376826393247e-02; +4.953842499466341e-02   +2.317291978694531e-03   +1.405215842364721e-02   +1.645682694622684e-02   +6.911627408230461e-03   +1.448234109782592e-03   +4.829684699055790e-02   -1.360425479286177e-02   +8.610557997899466e-02   -1.535667547783197e-02   +4.166543736872384e-02   +2.391130859579764e-02   -1.337298285244902e-02   -2.749266452723799e-02   +5.740984534162184e-02   +1.937155945166411e-02; +8.318857271390873e-02   -3.647193466847690e-02   -1.830328779194439e-02   +4.301119573723208e-02   +6.104166028482351e-02   -7.075739447386209e-02   -2.600433149926105e-03   +1.639313889618189e-02   -5.149149789364508e-03   -3.178386118047800e-02   +1.224723511726671e-02   -5.610543602448545e-02   +1.035798782962904e-03   +3.327624023793486e-03   -5.590536651258356e-03   -5.571010976777366e-02; +5.040484932721206e-02   +1.138108948375552e-02   +6.149247756229316e-02   +7.781972229203855e-03   -4.391064110800348e-02   -4.033532979855962e-02   +3.886316397106537e-02   +3.005321966758005e-02   +9.190270104957179e-02   +1.321231935172093e-02   -6.251899961892000e-02   +3.728121030645891e-02   +1.963698969223058e-02   -5.558622024717054e-02   +3.124539294843740e-02   -9.555550246298819e-03; +9.609074276566849e-02   +4.161869670195995e-03   +1.104588428807552e-01   -5.928338290642991e-02   -7.322624354660488e-03   +7.111245025759315e-02   +1.143092176652293e-02   -7.852779182096989e-03   +6.031521518025275e-02   +1.854865210026094e-02   +3.195935752163181e-02   +1.726435858570871e-02   +4.582885249967200e-02   +1.341519682478117e-02   -3.255779814529441e-02   -6.621762017748435e-03; +2.385012573495425e-02   -4.445937940394231e-02   +9.335980597381197e-03   +6.781653575046265e-02   -2.642287230039162e-02   -1.822859651525502e-02   +9.250418715506109e-03   +6.067403549802365e-02   +5.460556690848489e-02   +4.221213455047096e-02   +2.837922219447768e-02   -2.883640731309501e-02   -1.837217270431721e-02   +8.519947678171863e-02   +5.263719778135018e-02   +1.025066315106238e-01; +2.106095529978379e-02   -3.368182890689983e-02   -4.017166608613926e-03   -1.702631682924514e-02   -1.482288412889390e-02   +6.291930919067130e-02   +3.477956468450759e-03   +1.144790570085237e-02   +2.632500443113515e-03   +6.696265877579138e-02   -2.177261164105719e-02   -9.241110627744194e-03   -3.529561100206283e-02   +4.972332751292302e-02   -6.403524413673141e-02   +2.611503959298057e-02; +1.825346529294586e-02   +9.120643728656257e-02   +4.309243618200936e-02   +4.223330412425025e-02   +7.895750092671494e-02   +4.215898686516242e-03   -5.162451553704511e-02   +8.905905186302620e-03   +4.892943535178163e-02   +2.275392103968664e-02   +2.844984960074186e-02   -2.766533185234742e-02   -3.089870826114159e-02   +7.026592809034174e-02   +1.021332138688536e-01   +4.041026050136449e-02; +2.888493413212808e-02   +1.090131012341995e-01   -1.198820568426582e-03   +4.652731370147777e-02   +3.718326202909103e-02   -2.383793022479673e-02   -1.436379884509603e-02   +4.724664964032842e-02   -8.019859359235160e-03   +8.686690816645172e-02   -2.602489128468216e-02   +7.039681567545981e-02   -4.412762365479126e-02   +5.622779088220396e-02   -5.079518972646153e-02   +6.813478428207205e-02; -9.943731909883551e-03   -6.031330930444994e-02   -1.171264215169170e-02   +3.115491744009624e-02   +6.235799068097621e-02   +4.488707283294800e-02   -1.694047702351667e-02   +1.294227071679355e-01   +4.555761916819973e-02   +2.948857051097398e-02   -1.403441254048083e-02   -4.836022061075772e-02   +1.444102397728579e-02   -2.596036465435337e-02   +1.505509412978291e-02   -1.274277861105519e-02; +9.886521083313510e-02   +9.627351027955638e-02   -5.348253342678211e-02   +2.061039733711285e-02   +4.190470383961310e-02   +8.713354597170694e-02   -4.706338485554860e-02   -2.345785409166861e-03   -1.612475158228232e-02   +9.436970074647133e-02   +6.304763041284157e-02   +5.178833047515911e-02   -3.756164721418757e-02   +4.994856275992676e-02   +9.333103664573485e-02   +2.457030964184295e-02];
L1E_L1I_iGABA_netcon = [-2.600746600788528e-02   -3.650172538833788e-02   +2.311422209332328e-02   +2.053429316183714e-03   +1.191521310600082e-01   +1.225266883183064e-02   -1.369637924580136e-02   +8.783317660170914e-02   +1.204569722416157e-02   +3.504518137971208e-02   -3.403487355296281e-02   +7.789310791922811e-02   -2.707319798166431e-02   -3.052662911109243e-02   -2.085393593681670e-02   +2.129215266691075e-02; +7.818094871350451e-02   +1.030414253570410e-01   +1.955951622624814e-02   +2.222729369281556e-02   +1.955111825066313e-02   -5.714758789146582e-02   -2.110862220106522e-02   -1.398846011969032e-03   -3.494014712310003e-02   +9.273222247071994e-03   -3.374965839732501e-02   +8.245198609252750e-02   +6.606510730502922e-02   -3.904470987300366e-02   +6.369267392599483e-02   -1.854326705878088e-02; -5.199711022990158e-03   +1.046923268436729e-01   +4.612486607682382e-02   -4.230723747779340e-02   +6.338030602366972e-02   +6.725568065162107e-02   +3.303980779631545e-02   +2.236118394524708e-02   -1.072455392000007e-02   +9.983153735410795e-02   -1.394336596859682e-02   +8.994359864041729e-02   -6.220117440267244e-04   +1.127105368097843e-01   +4.810063933244533e-02   -3.859588991469071e-02; +6.347937781059841e-02   -2.484961985493139e-02   -3.487960315998207e-02   -5.449613619637651e-02   +3.539472525257208e-02   -3.258277815221206e-02   +5.669716135933178e-02   +2.790111980856175e-02   -3.857351665510782e-02   -1.198554130164389e-02   +1.023980787368938e-01   +6.881150762596035e-02   +6.017214038269068e-02   -3.167007049976642e-02   +1.882425129221172e-03   +5.626812808205495e-02; +4.900605442110512e-02   +3.256204409654015e-03   +2.388088483697779e-02   +2.526935578352130e-02   +4.611664357574192e-02   +8.638433605321841e-02   -1.274414954654994e-01   -3.734931904897295e-02   +5.523057422255515e-02   +1.995247172932120e-02   +2.832701040796830e-02   +6.426096987643755e-02   -3.320621691504381e-02   +2.440693973481109e-02   +6.706200137583887e-02   +6.432928758534862e-02; +4.778059613952085e-02   +3.255017461899541e-02   +1.030726503414841e-02   -1.652116915183732e-02   -2.151017735181297e-02   -2.707884887740570e-03   +6.648941569697951e-02   -8.132404210465838e-02   +4.299191456500383e-02   +8.846546929048926e-02   -6.570690895309472e-02   -3.133656664595206e-02   -7.085806779070704e-03   +1.622197559098649e-02   -9.548407149411178e-03   -1.075941528414303e-02; +1.107096088909606e-02   +1.029259293649688e-01   +1.310080930719855e-01   +4.225866778562576e-03   +5.733928218065908e-02   +9.098967420920881e-02   +5.679411179270903e-02   +4.833087501097880e-02   +2.014102263911555e-02   +2.613295898819726e-02   -5.710000572015887e-02   +2.188438725337427e-02   -2.954689329972586e-02   -5.778496387629610e-02   -2.830600693721385e-02   +7.200332376676793e-02; -1.945012304429745e-03   +3.743534393179307e-02   +1.116387128466967e-02   +1.015082660949804e-01   +4.423252459882649e-02   +2.279096175940878e-03   -3.974575961674901e-02   +7.078531472531847e-02   -4.994822773122161e-02   +6.146987640784063e-03   -3.701093837883146e-03   +2.524753544752909e-02   -1.576736437429294e-02   +6.875272328042360e-02   +3.814437124602022e-02   +7.328873548869100e-02; -1.142517178519162e-03   +8.635750933287727e-02   +9.849977293619865e-02   +5.084601557832365e-02   +6.628718336738976e-02   +4.248413747595229e-02   +2.148995038884251e-02   +4.695400040697003e-02   +1.278828567179679e-02   -4.281522614877312e-02   +3.248330081330873e-03   +4.887189983003284e-02   -3.866564917508812e-02   -3.325712771272599e-02   +6.316347063800998e-02   +1.013628888159941e-01; +1.883801772134897e-02   +7.554026686375148e-02   -2.423009435433405e-02   +7.198802759178086e-03   +3.011019616622957e-02   +7.123097277780502e-02   -3.196453034895168e-02   -7.327893073347484e-02   -4.038267677648993e-02   +3.161999165550862e-03   -2.758729540150133e-02   +8.867716085200336e-02   -3.761124056939514e-03   +6.414485635722939e-02   -6.875739122019457e-02   +6.251601797785546e-02; +1.250339153451942e-02   +5.939499959575244e-02   -6.256433117073801e-02   +2.127905085894478e-03   +9.798999136525523e-03   -9.364096094299024e-03   -2.448753890381667e-02   +1.113355385059376e-03   +1.015059833978816e-01   +6.838886558525346e-02   +1.787160884756069e-02   +4.194465999556789e-02   +8.487261050220362e-03   +4.089893649136657e-02   +6.869682818671319e-02   +2.103875132427654e-02; +2.286261118767566e-02   -3.187711312733914e-02   +6.706982487363582e-02   +4.954948286079065e-02   +3.624663432731906e-02   +2.653005496878982e-02   -4.611772199600080e-02   +8.190751473993330e-03   +4.087656947574301e-02   -8.882385780723562e-03   +6.948267150714102e-02   +5.865559379485612e-02   +6.583776981445078e-02   +3.925190882724441e-02   -6.517543827023414e-02   +4.194283781131311e-02; -3.722371759010602e-02   -6.707812915195234e-02   -4.336502302977947e-02   +5.109153274402952e-02   -2.209229357516388e-02   -2.281378873489092e-02   +9.917782452538010e-02   +4.970797434114092e-02   +3.907884628071921e-03   +4.195674603003776e-02   +5.414707624689791e-02   +5.092162034748719e-03   -8.193601058593729e-02   +9.819379261237592e-02   -7.693535573766162e-02   +7.128904323390299e-02; +5.861460423057942e-02   +4.450579539800777e-04   +2.235424507904066e-02   +3.304143780790090e-02   -1.975305036372935e-02   -1.783089399671815e-02   +5.123037838514700e-02   +2.054562702683065e-02   +9.736582422862454e-03   +9.594812602371094e-02   -6.105606080106701e-02   +5.082594307078367e-02   -2.114826201230001e-02   +6.436207014953575e-02   -4.032267904259607e-02   -3.865155024534241e-02; -2.060051445817665e-02   +3.724019390107525e-02   -3.226913826534178e-02   +1.041345164635692e-02   +4.342642345922286e-02   -1.586835870870806e-02   +1.467103553972049e-02   -4.743386690798937e-03   +6.280695264038953e-02   -5.777092067866119e-03   -6.021028318640664e-03   +2.994047767497376e-02   +3.010273212906627e-02   -4.321486076146318e-02   -1.852210112063209e-03   +4.120597035837353e-02; +2.908363777342674e-02   +1.206329592494139e-02   -2.818375926260400e-02   +6.025266964076717e-02   -6.046267780677392e-03   +9.460587531757368e-02   +2.828524627671784e-03   -1.442478618449129e-02   -3.666290998738152e-02   +4.543783538777531e-02   -6.072843417162138e-02   +8.147211667195867e-02   +4.046960289614582e-02   +4.411618036563931e-02   +1.890551353550968e-02   +5.438315178574782e-02];
L2I_L1I_iGABA_netcon = [+1.130099607448212e-01   +9.052339086583348e-02   +4.983287412192215e-02   +2.046293724173024e-02   +7.966952164138229e-02   +4.617906215489619e-02   -2.070288160114387e-02   +4.568535905393552e-02; +3.534542463550506e-02   +4.351107730071299e-02   -4.101258641867420e-02   -1.138262306584798e-03   -5.250320309020865e-02   -2.873281463146038e-02   -6.323209354025416e-02   +3.809648489427678e-02; -4.951288558252073e-02   +2.371154397890669e-02   +1.289770294954629e-02   -5.577944631510418e-02   +5.221059768249990e-02   +7.201549703404764e-02   +9.604332746958837e-02   +6.672268644735271e-02; +4.381975370480901e-02   +8.490311814318370e-02   -2.354691427881033e-02   +5.054321668126963e-02   -4.959704802620382e-02   +3.723897403295373e-03   +4.435668054195545e-02   -4.470961085242176e-02; -4.657709188068779e-02   +1.432972739403085e-04   -1.011032322637100e-02   -5.470627470318334e-02   -6.670953493142889e-03   +3.414544785101517e-02   +9.330647293745324e-02   +2.896086532149842e-02; +4.552922753923819e-02   +4.300812285313142e-02   +2.588236963896128e-02   -9.949257222708115e-04   +2.110543986325160e-02   +2.187668980360696e-02   +7.690112496749875e-02   +2.475158733938861e-02; +3.501398710674485e-02   -7.174308205188318e-03   +1.707796388190115e-02   -7.723258415437083e-02   -3.673916691474968e-02   +6.812638472745136e-02   -4.409662664916199e-02   +1.310198294863197e-02; +4.232180862522579e-02   -1.847362190017645e-02   +2.319544093469307e-02   -1.910279781651375e-02   -5.399962994265990e-03   -8.808583255046927e-02   +3.030683681073998e-03   +4.575903872533633e-02; -1.163897303438313e-02   -2.768854351675116e-02   +5.555558280067815e-02   -5.503544380454607e-02   +4.180971873434019e-02   +4.468413518970493e-02   +6.826780145253851e-02   -3.646810385084451e-03; -7.933431499065717e-04   +8.445173080013782e-02   +2.325047274740522e-02   -3.514423724922106e-02   -3.088615617341462e-02   -1.909514580151218e-02   +5.321427038072934e-02   +4.736222940029061e-02; +2.957621786754309e-02   +5.250031549404313e-02   +2.644364020533934e-02   -9.742424523857859e-03   +1.614487422711260e-02   +8.903423618369273e-02   -5.089031098886870e-02   +8.497297462908274e-02; +8.647995617439913e-02   -1.730017090568177e-02   +1.030997010549162e-01   +3.872787182004082e-02   -8.311599038237008e-03   +5.628327467390312e-02   -5.913703048128437e-02   +1.547194417934592e-02; +3.091817598281927e-02   +4.696495495388527e-02   +1.150550955461257e-02   -1.696190978671950e-02   -2.184939835972249e-02   +6.395077691551527e-03   +1.776107688708697e-04   +5.170225969999057e-02; +6.589109995136701e-02   -4.767617718627648e-02   -5.760866948356508e-03   +7.497303590808121e-02   -2.919284956097499e-02   +2.059317021746417e-02   -4.162646957544831e-04   -2.598520384730196e-02; +8.146956999180256e-02   -3.438430963921061e-03   +5.597325089806902e-02   +6.021174541988190e-02   +7.879246039750164e-02   -3.536790832864884e-02   +2.869748547286853e-03   +3.840300014827470e-02; -6.459398543548217e-02   +2.492512147684634e-02   +6.298384400316666e-02   -7.224312026040777e-02   +3.596584664777771e-02   -1.911340620560158e-02   +1.008250857574998e-01   +1.685425338240655e-02];
L1I_L2I_iGABA_netcon = [+6.105406623111212e-02   +6.346250932823227e-02   +4.276589483992289e-02   -7.824624077104157e-03   +6.338381610904671e-02   +6.123646085929692e-03   +1.986334007978144e-02   -1.127262290622825e-03   +1.599581674055051e-02   -7.354014418732542e-02   -4.014517562408336e-02   -3.377721049316663e-02   -2.274757530080675e-02   -3.728653916726155e-03   +9.431179335537346e-02   +1.087493420476287e-01; -6.253476836672262e-02   +3.575594897531099e-02   -9.852417377003775e-02   -8.972293398994964e-02   -4.715410810458827e-02   -3.894955262875874e-02   +1.958767130422997e-02   +1.443902289080790e-02   -7.628230169927849e-02   -6.834587066358683e-03   +2.227120562816734e-02   +3.378675849624666e-02   +3.744014649914078e-02   +7.915430782803394e-03   -8.670211145662665e-02   -3.396969197436342e-02; +3.180146909775973e-02   -3.064938281876866e-02   -1.038566915515014e-01   +1.704500312480610e-02   +3.252985584961302e-02   -3.769131429091188e-03   +8.836921794443631e-02   -1.513467395165368e-02   -2.293228486628457e-02   +2.973590319041703e-02   +4.707920292240549e-02   -1.655733972363299e-02   -2.324360592011351e-02   -1.191967476280724e-02   +3.623950362223419e-02   +3.443311795258040e-02; -1.423150039986044e-03   -8.228720133396731e-03   +3.435176008495203e-02   +3.449489797474692e-02   +3.659066195491416e-02   +2.582187786550208e-02   +3.986634791715931e-02   -2.482929943015645e-02   +1.168307754551932e-02   -8.426328200016559e-03   +1.613204973401222e-02   +2.299263045797299e-02   -6.547326672300066e-02   -1.224245165329809e-02   +1.219015646758590e-01   -2.805418686229843e-02; +4.470643302838831e-02   +4.611640610378896e-02   +3.646077855343810e-02   -4.745811624846830e-02   +6.913724671012025e-02   -5.412261825673925e-02   +5.761360901657374e-02   +7.375344012252608e-03   -1.016312206723290e-02   +3.664025034629760e-02   -3.800631677060506e-02   -8.297522643563224e-02   +1.062633853302025e-01   +5.595719176992854e-02   +1.862902120566911e-02   -4.624814315702348e-02; +6.565980660169574e-02   -3.767424542002118e-02   -8.123099891704814e-02   +8.782746759024364e-02   -4.388538126587894e-02   +2.515765029398911e-02   +9.542697383711322e-03   +8.022590117557613e-02   +5.383335607623727e-02   +4.337105617048401e-02   -5.167035515658604e-02   +5.037961619681471e-02   -1.112591981778883e-02   +3.365128697814904e-02   +2.632662378525225e-02   +1.042939060138541e-01; +4.715043225397725e-03   -1.026713582583737e-02   -8.335941751193791e-04   +1.814517272597346e-02   +5.602297477757157e-02   +9.996578273732935e-02   -1.192211812781538e-02   +2.590078722827243e-02   +5.999077369391426e-02   +7.019221802863801e-02   +3.610765411774935e-02   -3.321500554754890e-02   -1.018757918018712e-01   +3.942582549661157e-02   +1.806177401739857e-02   +3.509735149284095e-02; -1.963683940706070e-02   -5.982801084846651e-02   -1.503514792602788e-03   -6.091504163026019e-02   -7.967820329514059e-03   -5.268297715932391e-02   -1.957050736877212e-03   +2.134808878413715e-02   -1.203376491773465e-02   +4.686150136634538e-02   -1.721603719097382e-02   +1.414667717144670e-02   -2.042382147825784e-02   +5.932400610686190e-03   -4.617227985583591e-02   +2.743787298545557e-02];
L2E_L1E_iAMPA_netcon = [-1.404691725872747e-02   -3.503614680646071e-02   -2.447429580268042e-02   +4.261779012911340e-02   -3.822868851045058e-02   +3.847759185645363e-02   +1.248045550994369e-02   -7.410666667520618e-04; +6.912604989276726e-02   +6.402633979901322e-02   -1.213339004422676e-02   +2.196467027365391e-02   +1.347173220360141e-01   -3.155751200623431e-02   +4.506163425429267e-02   -4.042564055921937e-02; +6.970130312933499e-02   +3.060924010772280e-02   -2.697617829709937e-02   +6.572227719793555e-03   -2.019158904268535e-03   +6.994450133277261e-02   -3.002282780164129e-02   +7.941344825853380e-02; -4.244145914568923e-02   -7.709792902125194e-02   -8.785811866053329e-03   -8.473585226913261e-03   -6.022089585642038e-02   +2.821442323958446e-02   +8.192284449030831e-03   +1.673353463485243e-02; -2.862922864233771e-02   +1.611966649446308e-02   -1.005140806387779e-02   +5.016448580754035e-02   -7.425711320633441e-03   +1.408271629029560e-02   +3.388064843454996e-02   +3.787738803217507e-02; -1.512800843360653e-02   -3.273251166408817e-02   +3.725422598766236e-02   +3.132219948916014e-02   +1.019963888137009e-01   +3.264222995413326e-02   -2.656628317401579e-03   +5.433509077870385e-02; -4.328880757686005e-02   +2.040178399016926e-03   -8.865420539525620e-02   -9.951052918540940e-03   +3.506379584412443e-02   +1.951735419112728e-02   -2.470686882842887e-02   +4.033844349144500e-02; +7.508611578566009e-02   -5.874232571003522e-02   +9.239680700813369e-02   +1.279111360899355e-02   +7.992112533071503e-02   +1.539931716839103e-02   -5.452698970403751e-02   +8.049448255036687e-03; -2.970581858406620e-02   -2.299998498433460e-02   +3.747817103093212e-02   +9.680876428019489e-02   +1.018033913628583e-01   -2.420846580173439e-02   +2.669824194898328e-02   -3.391802153166952e-02; +1.517456979376190e-02   +3.949678376406389e-02   +5.075128641063130e-02   -5.555684006142003e-02   -2.222376005829788e-02   +1.538371828987511e-03   -4.164974306897486e-02   +2.842627275655926e-02; +5.265386374113301e-02   -7.351421555049931e-02   +3.063188174661724e-03   +3.852074790544234e-02   +1.055777975923706e-01   -2.993278994680011e-02   +1.955015159865097e-02   +3.569894116614643e-02; -6.997206102203508e-04   -5.977654523688589e-02   -2.265334330813528e-03   +2.420267061408542e-02   -6.675983525782060e-03   +2.996951426948590e-02   +2.392040209896894e-02   +9.943170497576648e-03; +4.694818533170708e-02   +2.653779957986285e-02   +4.243528736062288e-02   +4.356111290412575e-02   +1.066916662309431e-01   +5.145504259851445e-02   -2.737554386826252e-02   +5.278087675152285e-02; +4.027538440046860e-02   -3.055501472106807e-02   +4.492026415459130e-02   +7.734530074299531e-02   +5.299216888922961e-02   +1.733428965804345e-02   +5.766583828729521e-02   -8.393021183702477e-02; +3.166419992921705e-02   -5.442196539345995e-03   +5.593811102473772e-02   -4.292091636962241e-02   +3.311470706575307e-02   +1.679737712939089e-02   +1.235036566434447e-01   +6.674651060209612e-02; +1.243876534410296e-01   +5.916901351388061e-02   +2.775257484935992e-02   -2.755392116685875e-02   +7.086317115138353e-02   -8.291221381870956e-03   -1.957570945319263e-02   +3.645457402166612e-02];
L1E_L2E_iAMPA_netcon = [-3.627890880933705e-02   +6.336737585940196e-02   -5.071127865572930e-02   +6.282460596086438e-02   +2.387075043884465e-02   +5.015654791463828e-02   -5.746445709430868e-02   +4.191949934697808e-02   +1.845666602468013e-02   +6.622060303947427e-02   +1.316869230347785e-01   +1.685012411419385e-02   +8.825548561560113e-03   +1.135747200969758e-03   +7.516983266580668e-03   +3.978777173536756e-02; +4.027191738544111e-02   +4.338220604045252e-02   -2.825429619919509e-03   -1.249426106534380e-02   -1.168927673388457e-01   +8.129711146910740e-02   -2.645015151700961e-02   +5.124985116063569e-03   -6.547954642696997e-02   +1.345441747265313e-02   -8.797624961569420e-02   -5.168301912195872e-02   -5.433337706340615e-02   +3.382116015383931e-02   +6.032995591611449e-02   +6.093143876619166e-02; +1.065646270255445e-02   +4.840051578204095e-03   +4.500569808713731e-02   -2.670474759408591e-02   +7.711349656514382e-02   +1.130610097451329e-02   -8.981183934915674e-02   +4.018346247892234e-03   +5.163084028801204e-02   +1.214900347862011e-03   +3.951803709651065e-02   -4.116212058907388e-02   +7.052439826747846e-03   +3.359782702359027e-02   -3.287972390415546e-02   +1.187224695984930e-01; +9.629890351943688e-03   +5.133028534012310e-02   +6.985120762566491e-02   +6.413313267892326e-02   +7.124304795654055e-02   +3.271733195958895e-02   -3.291949802132484e-02   -3.139132030246876e-02   +7.965219715266537e-02   -6.531795513064072e-03   +8.062995763767707e-02   +4.830286784622309e-02   -2.932558442724709e-02   +4.976097666351299e-04   +9.345348207698619e-02   -2.602097554764425e-02; -5.495136019528223e-02   -7.335849779652776e-02   +1.482575593624827e-02   +3.117251882457930e-02   +3.898948982480532e-02   +7.338857061985735e-02   +8.467043852209041e-02   -2.986879459531434e-02   +3.924198215642310e-02   +1.495223323946368e-02   -2.833836941261236e-02   +1.052323046001604e-01   +7.349064855502277e-02   +2.940381900447799e-02   -7.223634547455683e-02   +1.272524044954996e-01; +2.405809612836895e-02   +8.168043455673243e-02   -2.507646773012432e-02   +3.312365642845826e-02   +7.740601148758701e-02   +1.386986905002023e-02   -4.332884560236538e-02   -2.172894224582949e-02   +5.484599034961563e-02   +3.314014437199295e-02   +7.236060317043748e-02   +1.231349926034640e-02   -8.753937598560354e-03   +7.557920145363520e-02   -4.818265846153792e-02   -9.110993254930479e-03; +4.203854885411462e-02   +6.276246893848632e-02   -1.009117087148919e-02   -3.258965241095652e-02   +4.811953929395464e-02   +4.400633926138321e-02   +1.845360890865881e-02   +8.870318221739880e-02   -3.831020032175984e-02   +2.986070689862630e-02   -8.803890834442712e-02   +2.971791728846983e-02   +3.454046183778708e-02   +2.689269337591947e-02   +6.793111121303007e-02   +4.246579250316469e-02; +5.765502030671070e-02   -4.485795459069156e-02   +1.510090574908467e-03   +3.116188866667083e-02   -1.765895620427858e-02   +2.000472993075696e-02   -4.820656751718710e-02   +4.734916403759091e-02   +7.469547831086348e-02   +7.373121391479258e-02   -8.035891853011765e-03   +1.234460331222309e-02   -3.625063507307100e-02   +8.168975542130559e-02   -5.565060112651571e-02   -6.181247851110473e-02];
L2I_L2E_iAMPA_netcon = [+3.201538504527170e-02   -3.750372100516829e-02   +7.399221416617932e-03   +1.707308441719292e-03   -6.845477404298403e-02   -6.403890598278590e-02   -1.066218924394511e-02   +5.324861920241946e-02; -1.792391524130319e-02   -3.254291014013620e-03   -7.414184933849328e-02   +8.585116867101936e-02   +3.319542377358633e-02   -3.606099059417753e-02   +5.879578133460769e-02   +5.354363465197676e-03; +2.909068996610530e-02   -5.079488743706961e-02   +4.855917276636298e-02   -5.395212856948932e-02   -5.279686194448763e-02   +2.901130514083939e-02   -2.435040257813895e-02   -2.581137939423961e-03; -2.787861141571903e-04   -1.933961741702131e-02   -1.639423069391939e-02   -6.355801941709620e-02   +6.843006549173307e-02   -2.982445900457934e-02   -4.661701100099866e-02   +1.025415199380992e-01; +6.642285531183278e-02   -5.595688157949653e-04   +1.320966808815108e-02   +8.930633939064353e-02   -2.834230820017941e-02   +2.791915056225787e-02   -1.160893109024588e-02   +3.615387954541712e-02; +1.315911377682229e-02   -1.492550305359917e-02   +2.663550472259927e-02   +1.840672141998204e-02   -2.124790560352616e-02   -6.841352955267162e-02   -3.926924413574831e-02   -2.516714225003844e-02; +1.375310408717394e-02   +5.073097208077566e-02   +4.652313180430189e-02   +2.522071981186804e-03   +4.083803409317835e-02   -1.096942086282211e-02   +9.330145768407883e-02   +1.237698116937424e-01; -6.366249665850278e-02   +1.821134629002734e-02   +2.565995221196249e-02   +5.451298910682743e-02   +1.042853368990743e-01   +3.061122694318406e-02   +3.355756608906128e-02   +1.951717086850874e-02];
L2E_L2I_iGABA_netcon = [-4.274509449156897e-02   -1.148696874760178e-02   +3.699304788853647e-02   +5.550954337473101e-02   -3.650428777614223e-02   +4.472951687318644e-02   +8.608360584638572e-02   +3.045737895371035e-02; +1.371411749699156e-02   -5.931621896837478e-02   +7.984556797957072e-02   -1.801504130015612e-03   +6.959861721474807e-02   -3.520640011710398e-02   +7.624354321435878e-02   +8.636391044152023e-03; +3.090188948439119e-02   -6.077310727215915e-02   +3.275002489478353e-02   +3.634673453721580e-02   +5.202008967563587e-02   +5.662101419904271e-02   +1.446700982636718e-02   +7.176285843661962e-03; -4.217141026167347e-02   +7.844795212672308e-02   -4.078970333650438e-02   +1.825885135876829e-02   +4.173618558055271e-02   +8.546646360299612e-02   +1.069185171837151e-01   -1.602203403869120e-02; +2.876642227968476e-03   +2.475681101703055e-03   +6.463132484846695e-02   +2.958040398775879e-02   +1.972538195675332e-02   -1.442491177928022e-02   +2.215971637448883e-02   -2.500310544789504e-04; +4.855530060998599e-02   -1.364274037435194e-02   -2.404582959325647e-02   +1.202892247173142e-02   -2.860634224015839e-02   -1.718024358609727e-02   +3.978992502059048e-02   +7.608638680033976e-03; +4.777195201515222e-02   +4.069914535504035e-02   +3.821348810769405e-02   -1.023001300540931e-02   +1.021554488962481e-02   -4.815969802958783e-02   +2.342377181527719e-02   +3.410622859540088e-02; +2.549130928387840e-02   -3.690765897967694e-03   +1.209049808698868e-01   +6.742167811518272e-02   -4.598867357673467e-02   +4.920648430573762e-02   +9.774234690077629e-02   -2.635725833718392e-02];
L3E_L2E_iAMPA_netcon = [+8.001569392457458e-02   -6.163607301905315e-02   -9.822759613799747e-05   -6.427914548265762e-02   +6.279040483510177e-02   +6.389574320867232e-02   -2.253900048497273e-02   +7.673465240802484e-02   -4.950694904021900e-02   -6.238390851305523e-03   +3.071226164706090e-02   +5.392325045005970e-02; +3.730908030177882e-02   -1.936118502290361e-02   -5.582756581125515e-02   +2.244203253537484e-02   -5.429467468816875e-04   +1.709353340726043e-02   +2.542679532566254e-02   -1.100531827967866e-03   +8.962741401085663e-03   +1.847241244117811e-02   +1.754538048255563e-03   -6.610581010603790e-02; -2.829707248833057e-03   +5.183669272151659e-02   +2.170844896129290e-02   +6.995699663447612e-02   -2.234012239886984e-03   -5.445759976508946e-02   +3.401557325634176e-02   +2.043817191680545e-02   +2.965289478567762e-02   +7.864592633677553e-02   +9.540715610303122e-03   -3.568480351179484e-02; -1.610604001189585e-02   -6.939746067764287e-02   +4.690483073226088e-02   +2.720653168041140e-02   -4.955023355384063e-02   -3.805200062714842e-02   -2.650707672035711e-02   +4.154886471918243e-02   +4.612273498948707e-03   -5.313165490481908e-02   +3.580177915808239e-02   +9.392091971796444e-02; +9.843125709797942e-02   +1.567181017086897e-02   +5.447123767349742e-02   +2.239264640573994e-02   +2.334430869109897e-02   -7.808681536375868e-03   +4.433941751128287e-02   -4.286182630537128e-02   -5.474738997087692e-02   -1.085923930780389e-02   +4.421263982575335e-02   +2.995908617660352e-03; -8.156820403122643e-02   +6.904992986393169e-02   +5.054781393127616e-02   -4.557125373574390e-02   -7.208483089551880e-03   -4.816735358276961e-02   +3.925475009153167e-03   +3.790838782120325e-02   +4.400335921939930e-02   -5.085140959023100e-02   -4.627308886280451e-02   +5.665518713748070e-02; +5.280015409320758e-02   +5.799779812530566e-02   +5.474421465411632e-02   +5.482927139482774e-02   +2.911904859692386e-02   +4.430991868644962e-02   +1.052355923954343e-01   -6.321891485053933e-02   +3.959536473874683e-02   +8.076529849036056e-02   +4.484260408851333e-02   +5.062890125156803e-02; +6.481121053313893e-02   -2.042746521705228e-03   +6.424354445371007e-02   +1.208347696813144e-02   -1.302748777177153e-02   -2.509848340538620e-03   +1.058156054907124e-01   -2.509262275003700e-02   -1.403499585657974e-02   +1.039178529526935e-01   -1.138372185981370e-02   -1.862399127582069e-02];
L3I_L2I_iGABA_netcon = [-7.850469333011202e-02   +3.301681813646052e-02   +2.882828685719361e-02   -2.018359094485676e-02   +2.121241938881805e-02   +1.478342950451945e-02   +3.538751753403514e-02   +1.715792183650667e-02   +4.437404572188082e-02   +1.623775555109164e-02   +1.092651171879979e-01   +6.818384297993365e-03; +1.928921473198803e-02   +8.549576699299839e-02   +6.484040474754942e-02   +8.064689292902835e-02   -9.294173033610606e-02   +5.841048590684552e-02   +1.006532621523010e-01   -4.263967258608203e-02   -2.962792288283880e-02   -3.043620405332172e-02   -9.342481383868770e-04   +9.946353305811822e-03; +5.761922499514843e-02   +3.219667476387982e-02   +3.114577470354993e-02   -2.130279225173216e-03   +5.918110728903295e-02   -7.210881141445970e-02   +3.386354061584482e-02   -3.547381562336295e-02   +6.272017626725368e-02   +5.406083901592137e-03   +2.037587485837053e-02   -2.201322897391584e-03; +4.097752627023933e-03   +3.990489899214598e-04   -1.630821061784632e-02   +7.212268051036894e-02   +8.478579261847140e-02   +1.551393803742913e-02   -2.974920039164699e-02   +2.466748076879797e-02   +9.152764935850329e-02   +7.329939525478102e-02   +3.225488434708702e-02   +3.386344770979402e-02; +3.181867337779237e-02   -6.965892743473391e-02   +9.614007945757234e-02   -7.246546431046158e-03   +3.147512401765507e-02   +7.503205962347557e-02   -8.010286424314165e-04   -8.556193646384727e-03   -3.261232014408504e-02   -5.251655205305336e-03   +2.864304837947724e-02   +1.536533093441179e-02; -4.286129971131906e-02   +4.603955911090783e-02   +2.430419614729130e-02   +4.154139429359871e-02   -1.390567788988811e-02   +4.287258249601422e-02   +5.744568034932585e-02   +5.016118906165810e-02   -1.363255308321078e-03   -1.254534283262721e-02   -2.999615092751051e-02   +1.426157529055033e-02; +5.438317943030292e-02   -3.827642827634477e-02   +9.745575909356344e-02   +1.919087807219386e-02   +1.082999346437024e-01   +9.554699661565717e-02   -7.089986869159418e-02   +7.848995973405121e-02   +1.016419637456507e-01   +2.352421015176976e-02   +9.056965359990137e-03   +4.297764429647579e-02; -1.520808928815732e-02   +3.537278789467029e-02   +4.712297228705526e-02   +6.696446047764424e-03   -1.178669027077238e-02   -8.137825656579622e-03   -1.995937585341405e-02   +6.758516372295939e-02   +2.529135388365628e-02   +2.015738264086041e-02   +6.184929535283003e-02   -1.555094941053051e-02];
L2E_L3E_iAMPA_netcon = [-2.427232847742267e-02   -7.554325754392029e-03   +2.751671226611649e-02   -3.101353656619297e-02   +2.075420088837202e-02   +1.115984105578849e-01   +1.054570244630008e-01   +6.974190002519237e-02; +5.221524865058551e-02   +3.610106874596187e-03   -1.934729761585872e-02   +4.483613721188705e-02   +2.300062827979342e-02   +3.168367042413777e-02   +6.630388538260040e-02   -1.801442830896563e-02; -4.367690740988377e-02   -3.226121208995891e-02   -3.409623579145849e-02   +5.633251051719632e-02   +1.087768458038185e-01   -1.558380446186089e-02   +1.186415054181392e-02   +4.595942330236338e-02; -7.249510066973355e-03   -3.760606409126994e-03   -1.162995298767922e-02   +1.429760178498650e-02   +3.821249294309770e-02   -9.147249838117155e-03   +6.767061691154021e-02   +6.910592622851354e-02; +3.399614063530337e-02   -1.459630473069673e-02   -2.810341795572503e-02   +5.141916210151103e-02   -3.780616021083561e-04   -5.388240916512501e-02   -4.490574566552956e-02   +5.489903893570831e-02; +1.401498583774840e-02   +2.369343792150411e-02   +6.262596521982577e-02   +1.663359998430984e-02   -7.157866539006097e-02   +1.088631903721779e-02   +1.979436041130609e-02   +4.538316711192529e-02; -2.974951196331204e-02   -5.147983309303275e-02   +9.507450094431101e-02   +8.468794123401256e-02   -2.990617347855069e-02   +3.544818836596181e-02   +3.069107175649262e-02   -6.485636180238898e-02; +3.958051403834917e-02   -1.336768620369151e-02   +1.331904582457502e-02   +2.018210410173087e-02   +5.026830975347047e-03   +8.295896854245569e-02   +5.758787972386508e-03   -2.797050910950021e-02; +3.841650426455647e-03   -4.578558994589584e-02   +6.066369674796911e-02   +4.268596187874233e-02   +1.533332593979965e-02   -1.238623017403399e-02   +1.048687873912963e-02   +8.188426096387449e-03; -5.680257892965625e-02   +5.465583056626619e-02   -7.711566184624183e-02   +2.832305006672043e-02   +5.845521376845068e-02   -4.951356585827134e-04   +1.067206682824348e-02   +4.175264674646508e-02; +6.793984826126805e-02   -2.109823205947990e-02   +4.891923200279931e-02   +8.512097986986064e-02   +9.112201182915418e-02   +7.517057482516637e-02   +3.044992627483609e-02   +9.965596421217311e-02; -4.196547485720917e-02   +3.926216677167438e-02   +7.471743284576565e-02   -2.617074601477944e-02   +4.914295349268959e-02   -3.562962655151874e-02   +4.356937809107756e-02   +3.249489886038832e-02];
L2I_L3I_iGABA_netcon = [+4.806876125150657e-02   +8.955659532840295e-02   -5.475216114214164e-03   -8.880729085835487e-02   +8.705468801716548e-02   +4.132538145969967e-02   +6.876650061402929e-02   +7.775358758844811e-02; -1.934720047570522e-02   +3.578725260927595e-03   +1.240278977339607e-01   +6.811937816008999e-02   -3.056981832790412e-02   -3.713047635210441e-02   +8.135408583316237e-02   +8.215745724991761e-03; +3.574178741492312e-02   -5.225872547104789e-02   +5.728306272665655e-02   +2.562167851522809e-02   +4.845955991180510e-02   +6.429886024174135e-02   +1.821958666654983e-03   +9.466945370838618e-02; +1.017160598367139e-02   -1.051410274394527e-01   -4.558733656680904e-03   -2.946695945337998e-02   -4.810836140909167e-02   -3.130253329771434e-02   -6.118958163404513e-02   +4.690132829027059e-02; -4.334142428859569e-02   +1.493048936150132e-03   +2.931642384174968e-02   -6.932140527163444e-02   +3.172236525539394e-02   -1.619891146197077e-02   +2.606622104516866e-02   -4.419422408395374e-03; -1.069836667016381e-01   -2.185472369029171e-02   +6.962714171187678e-02   +5.114480140517394e-02   +4.344257194615927e-02   +7.064236071877630e-02   -2.992042487984298e-02   -2.392007654268800e-02; +2.854243018302993e-02   +6.506213076853627e-02   +8.454047304844817e-02   -3.007871156885594e-03   +8.691080015199602e-02   -2.707925545157979e-02   +4.297478266685489e-02   -1.108495467887016e-01; -9.220910405334187e-03   -4.865406755209444e-02   +2.729788440492228e-02   +3.960290488886261e-02   -6.000962063169648e-02   -7.384426180466724e-03   +1.756137964683015e-02   +2.486824360417488e-02; +4.789699800169300e-02   +3.410640889551160e-02   +4.500502671033422e-02   +1.060232254036385e-01   -8.414041739830059e-03   +1.237697054585345e-02   +1.000549608356507e-01   -3.338731980758913e-02; -2.396986829903246e-02   +3.637431838568654e-02   -8.498559053599465e-02   +1.360350655727664e-02   +8.631732373278748e-02   +6.991816170743737e-02   -8.866668471420701e-03   -7.096313145767497e-03; +5.693741264659953e-02   -1.581497691457114e-02   +9.394418434387772e-03   +7.358342070845399e-02   +6.255414425647965e-02   +2.837702485726705e-03   -2.594668646789938e-02   +8.754274816442678e-02; -2.158011111534199e-02   +5.542020470130993e-02   -2.133184387125732e-02   +3.369572443115872e-02   -5.964912839782882e-02   +3.796411083871615e-02   +2.448130497301084e-02   +9.367177105551312e-02];
L3I_L3E_iAMPA_netcon = [+2.977588426522854e-02   +1.434046613117571e-02   -7.204666751717584e-02   +1.107161599340598e-01   -4.899815104588354e-04   -3.528759761304488e-03   +3.377336337702749e-02   -4.918394896088150e-02   +3.899696737728106e-02   -3.739115108607181e-02   -5.728048978657189e-03   +1.735417897544441e-03; +4.858058152812572e-02   +5.514966237916158e-02   +6.476145757799176e-02   -3.769932399170327e-02   -2.279441541655747e-02   +5.044060740469414e-02   +8.154151828720721e-02   +5.734606542310437e-02   +3.986348750375491e-02   +3.868692973765982e-02   +3.403239646800331e-02   +8.492412473043723e-02; +1.633728046516988e-02   +2.051292167397348e-02   +1.055170257191384e-02   +5.088823127575359e-03   -3.252343302515676e-02   +2.947253643103286e-02   -2.138786344970867e-02   -3.904648265994993e-02   -2.792176435725618e-02   +7.614841328938169e-03   -2.299586130786838e-02   -2.655878266296621e-02; -8.546862637605906e-03   +6.512907520944426e-02   +4.089696541939509e-02   +2.133761559912203e-02   -2.549856064737963e-02   -1.159897119932358e-02   -5.992209598456673e-02   +5.559096656765010e-02   +5.083266700945169e-02   -7.465959159235272e-04   +5.454056507123732e-02   -1.755085811371993e-02; -6.818839585363179e-03   -5.663676571409057e-02   -4.995907806525120e-02   +4.432047034386356e-02   -4.064525289487336e-02   -2.539175553750365e-02   +1.648989769403039e-02   +4.246808418000268e-02   -3.622163548353184e-02   +3.067823860072313e-02   +7.057166785899652e-02   -1.977604790536243e-02; +2.913760554376940e-02   +2.735756838543098e-02   -2.792115397192072e-03   +1.839450285114567e-03   +4.647410569728937e-03   -7.171395613217460e-03   -2.933650611592368e-02   -5.006653851365048e-02   -5.420378014196602e-03   -1.720878289425829e-03   +7.507164369518499e-03   +5.433726542471359e-02; +6.139174388066365e-03   +2.700707170654979e-02   +8.384930595087724e-02   +7.470628422218694e-03   +4.453668947445935e-03   -6.147990640594568e-02   +4.884252264489276e-03   +3.294282343037661e-02   +4.377786119484927e-02   +9.113359773784913e-02   -7.221798148875956e-02   -2.235544296292545e-02; -3.781893187480657e-02   +7.819252659679145e-02   -4.598543362488757e-02   +1.561217538329812e-02   -1.055906468816712e-02   +3.235428739232805e-02   +2.197643356120388e-02   -2.527360125327377e-02   +6.627643902889792e-03   -1.610999079015958e-02   +6.365823655807804e-02   +2.997043709988266e-02; +5.033614558640530e-02   +6.126335138870075e-02   -8.813674221149381e-03   -1.228045807768757e-02   -1.471433878588276e-02   -3.081371226729691e-02   +7.354333009705283e-02   -5.045428852012525e-02   -5.089644242405843e-02   -8.085787216557984e-04   -1.797621479787578e-02   +2.788978875747049e-02; +1.482465545438035e-02   +6.920363750157649e-03   +1.194276720691448e-02   -3.269311786779185e-02   +2.864879332694998e-02   +1.119915679700670e-01   -1.108815960787211e-02   +4.690110020519153e-03   -5.155248456399988e-04   +5.252515392524853e-02   -3.159341958769190e-02   +5.690582397214151e-02; +7.829078747966323e-02   -7.349745325173601e-03   +6.438735725505627e-02   +1.944978046425292e-02   +1.597177568098886e-02   +5.110104655458034e-02   +2.668108705957914e-02   -3.669839217324194e-02   -3.023747955364998e-02   +4.426242659883705e-02   +7.265779191423591e-02   -6.355818253182613e-04; -4.007503247271928e-02   -3.472280233030622e-02   +1.022545029755070e-01   +2.235468837861377e-03   +1.195302553461710e-01   +8.273252312889669e-02   +4.200704356183589e-02   +2.458809255284960e-02   -6.387127059447466e-02   -6.668399017316751e-02   +1.534427798496522e-02   +1.133919886156168e-02];
L3E_L3I_iGABA_netcon = [+2.584360451923207e-02   +5.632908571677208e-03   +7.500124720259380e-02   +3.587668934823394e-02   +5.889671454761462e-02   +7.899634096677212e-02   +5.458350196072785e-02   +3.775868248029498e-02   +4.634790298021481e-02   +7.501388837811680e-02   +8.952211379889015e-02   +5.417858247728708e-02; +1.081999115825427e-01   +8.407297116114219e-02   +2.857298920227266e-02   +4.304643392116328e-02   +5.152543555622328e-02   +1.001538131841589e-01   -9.688266236214706e-02   +5.396065673303817e-03   +7.992588994567897e-03   +1.030757205126453e-01   -2.029248722537142e-02   +8.751351782393927e-03; +5.077721007176196e-02   +1.147776557625767e-01   +4.993998609190756e-02   +2.287285593429544e-02   +6.855410902501478e-02   +1.702322369433103e-03   -1.366730335870755e-02   -1.679627322864500e-02   -2.348851188667228e-02   +6.842460129053261e-02   +8.718435912232350e-02   -2.145064150946241e-02; +8.969000766147231e-02   -7.461210308533621e-02   +8.385980472280716e-02   +4.950769983126111e-02   +9.809857486194290e-02   +2.077649902349273e-02   -2.226381676020892e-02   +7.051382784576703e-02   -1.138139468566887e-02   +9.515005761358489e-02   -4.635575761825750e-02   -5.260680800442714e-03; -5.487337638084471e-03   +2.700943579914285e-02   -3.367933441822628e-02   -1.658832526158005e-02   +5.168755157295542e-02   -5.033920760349160e-03   +1.490669470580273e-03   +9.138474213609402e-03   +7.824687293363677e-03   +2.469849540926011e-02   -6.752317974425592e-02   +2.815516047056311e-02; +1.417021823153970e-02   +7.006902139399342e-02   +7.800369531560410e-02   -5.674841985344471e-02   +3.318964989241936e-02   +8.908555686644939e-02   +4.671404236922022e-02   +3.373545345957182e-02   -1.520951053277855e-02   +8.781307348176579e-02   +7.172195774485780e-02   -1.306039606279728e-03; -2.794489485929575e-02   +3.240932577588458e-02   +1.278677927387342e-02   -5.046779085546721e-02   -3.327121501507507e-02   -3.845750747790039e-02   -5.294939556614450e-02   +1.027733161541763e-02   +8.480902866533307e-02   -3.161752502707706e-02   +2.246725477516135e-02   -5.613989062281774e-02; -5.349837586103441e-02   +8.135788391962571e-03   +8.809116877332505e-02   +7.425846678582260e-02   -4.481346170231072e-02   -2.816048810891184e-02   +2.708572403908370e-04   +4.343973437990692e-02   +3.634901591591272e-02   -6.895285292016246e-02   -3.006551066696953e-03   -6.339720315801993e-02; +1.078234982879213e-02   +5.009647577376261e-02   +1.008941963181719e-02   +1.102417009086958e-02   +6.193270223453706e-02   +1.913450322802811e-02   +4.584500125134633e-02   -6.160229483247875e-04   +2.092485559460735e-02   +6.497527138430592e-02   +2.970681108766694e-02   +5.656455521933955e-02; +7.153620335734136e-02   +2.248399656851223e-02   +4.491773161765794e-02   +2.624036847240797e-02   +1.015915885009296e-01   -1.896752497002972e-02   +4.289603130617535e-02   +3.772936461451624e-02   -3.339624915441788e-02   +8.926429826627152e-03   -6.660191265058462e-03   +3.702171209465180e-02; +4.621535101813828e-02   +4.560621446586276e-02   -4.282836365152182e-02   -1.761688789798351e-02   +1.065720241862395e-02   +7.639023175961819e-02   +3.390788846587518e-02   +3.756063453256440e-02   +1.349944866793952e-02   +9.081573626740397e-02   -6.079985423622434e-03   -2.491489642380013e-02; -5.350490741480305e-03   +2.881296131173362e-02   +2.359208274579034e-02   +6.007053864052489e-02   +1.470950162308940e-02   -2.085064534600812e-02   +5.684223036216273e-03   +4.890592358677975e-02   +3.732271417640975e-02   -2.658539782877124e-02   +4.575928258151132e-02   -3.617416366470366e-02];
L2E_Input1_iAMPA_netcon = [+4.317325792346272e-02   -2.939825171804379e-02   +6.863566536326980e-02   +8.701014404043200e-02   +6.006940492744293e-02   +1.408475843921032e-02   -8.245022712743166e-02   -9.038549284453891e-03];
L2I_Input2_iAMPA_netcon = [-1.007316013323890e-02   +5.247883703580432e-02   +4.918558178100627e-02   -2.995553684452681e-02   -2.451824669466993e-02   +4.509613160039939e-02   -2.827357341424325e-02   +9.069164761288254e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.8*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.8*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
