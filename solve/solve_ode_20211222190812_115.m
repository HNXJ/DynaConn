function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-4.019426690100070e-01   +4.740724228730472e-01   +5.775002999038211e-01   -4.528141408538165e-02   -8.489556252542724e-02   +1.904186392340288e-01   +7.166830416281789e-01   +1.100080093285685e-01   -2.702656949400222e-01   -2.604025301510844e-01   +6.279054360836653e-02   +2.661449052721553e-01   +4.789426638887407e-02   -6.123802777138001e-01   +2.461035295812921e-01   -5.776196995354820e-01; +4.739816418828289e-01   -2.649765917562931e-01   -7.699648903954019e-03   +7.473640046537167e-02   +2.643376147576059e-01   -4.196718199676501e-01   -2.756671118559103e-01   -1.792786286913147e-01   -4.330325610075121e-01   +3.213052101285691e-02   +3.516550906881228e-02   +3.515634770730559e-02   -4.063050989846854e-01   +4.462311620461364e-01   -2.879564608101018e-01   +5.415655529333789e-02; -1.198523460053678e-01   -1.672069645509253e-01   +5.965448876254129e-02   +1.847901782602834e-01   -1.019259184940565e-01   +2.651572071831712e-02   -9.129894532953542e-02   -1.757709792081240e-01   -7.509197517801616e-02   -2.469973075790337e-01   +3.540739014207860e-02   -3.574034953041314e-01   +7.499411959521207e-02   +1.657941159756778e-01   +2.477197941936406e-01   -3.052381133569097e-01; -4.270041278558006e-01   +1.708139773021587e-01   +7.250091966428294e-01   -1.675745350873708e-01   +9.238574041929695e-02   +1.128009042861690e-01   +1.235311288733163e-01   -5.712673033821804e-02   +1.722597394642850e-01   -2.425130310009694e-01   -5.213767213048811e-01   -5.595888451242935e-01   -2.202192216736057e-01   -3.569673499870252e-01   +2.276134498455598e-01   +4.801045063804215e-01; -5.688286395403019e-02   +3.789896510244595e-01   +4.255698786246417e-01   +2.585286388688319e-01   +8.097807903948925e-02   -9.762346226478294e-02   +1.554077890938800e-01   -4.535158837188710e-01   -3.994078571958856e-02   +1.770841919081587e-02   -1.048491011638101e-01   +3.691635433249144e-01   +6.614989492932605e-02   +5.244277305778289e-02   +3.623899467037072e-01   -1.063294007792302e-01; -2.548958023904885e-02   +2.308372700641458e-01   -3.078662740033999e-01   -3.905596986465554e-01   -3.097650625313666e-01   -1.240642812452744e-01   +5.453050793041259e-01   -7.366944515732373e-01   -2.720916017342375e-02   +2.551668116378410e-01   +2.307635163345836e-01   +5.253444386143502e-04   -5.229799825890907e-01   -4.122946578797243e-01   +9.330398458517071e-01   -4.957292332658852e-02; +2.487030503438168e-01   +8.472820838776632e-01   -5.225627601446813e-01   +2.449425648572495e-01   +2.493457203261653e-01   -2.966563605446768e-01   +4.621117064235189e-02   -3.511774916503278e-02   +3.565108633077121e-01   +8.125243186442868e-02   -1.200812209280563e-01   +2.647720301874140e-01   -1.595672305923675e-01   -4.494678993970052e-01   -3.173993343117678e-01   +4.854761818434025e-01; +5.968309646622076e-01   +5.955105810524238e-01   +3.899481841062705e-02   -7.263359296541758e-02   -8.579896278620103e-03   +1.538730511662601e-01   +7.757335558779657e-01   -2.502292074490410e-01   -3.594085511539581e-01   +7.470935692766444e-02   +3.441101442406533e-01   +1.030149675174915e-01   -3.223311435515485e-01   +5.074385440854302e-01   -2.795192580744588e-02   +3.075360140474049e-01; +5.894471686222905e-01   -6.108216729781779e-01   -3.139676878074299e-01   +4.370497099519942e-01   -2.825077505219417e-01   -4.328987799601799e-02   +4.872959836539622e-01   +2.378459969541684e-01   +2.482146471039968e-01   +5.455123515856787e-01   +2.898697496138908e-02   -3.486784771836770e-01   +6.341432915664396e-01   +2.225729136826959e-01   -5.569074902685064e-01   +5.973143147020019e-02; -3.924223793369742e-01   +2.928380323890233e-01   +3.384286134180309e-01   +4.516391783690836e-01   -4.952488399578725e-01   +4.301042783145709e-01   -2.463812909798824e-01   +1.403969996039071e-01   +4.036734372880827e-01   -2.083684949871483e-01   -3.611357990586953e-02   -1.432317323879529e-01   +1.153213482656486e-01   +4.115937171626307e-01   -2.708922704300701e-02   -1.157093326751747e-01; +1.698098371672077e-02   -2.190774475644819e-01   -2.218086317743071e-01   -1.320588994576316e-01   -1.258096528778877e-01   +4.255697665680789e-01   +1.964788662924333e-01   -5.741451891629312e-02   -2.462599349523013e-01   +5.408152696836478e-01   +5.133953882458943e-01   +3.879567410918435e-01   +3.935502757306812e-01   -3.517287065087021e-01   -3.736100792635518e-01   +2.397815135252969e-01; +2.899373796462632e-01   +3.599118692915215e-01   -5.615145419823261e-03   +7.961715771034660e-01   -1.474324760919374e-01   -1.061053907918704e-01   +4.331190443585017e-01   -4.306525970009246e-01   +6.363797517896403e-01   -1.027880226524162e-01   -2.859216842190773e-01   -6.751162252037075e-01   +1.623742545868887e-01   -1.391590028177557e-01   -2.816662235345792e-01   +3.961763502256712e-01; -2.644594212407889e-01   -1.021890423935115e-01   +3.081734175637493e-01   -2.460519289925905e-01   +3.569543492474205e-01   -5.763730117105309e-02   -1.104505505419835e-01   +8.810241553673802e-01   +4.760975523352419e-01   +2.707086384223536e-01   +5.286439543825633e-02   -5.260232554838494e-01   +3.764621196913187e-02   +2.247119477830542e-01   -3.599362601399486e-01   -4.162788780955141e-02; +1.425773397627655e-02   -4.415389201006125e-01   +1.040956104513661e-01   +2.834402703030517e-01   +2.036733765165461e-01   -5.247373684796903e-01   +3.920970642695584e-02   -2.349908820327198e-02   +8.057120687097946e-02   -3.262253771736900e-01   -2.777769021422918e-02   +5.680243858599585e-02   -2.795250796153641e-01   -6.820158532911864e-01   -6.175073454767349e-02   -1.820050471918437e-01; -3.514765422205680e-01   -4.242181532033414e-01   +3.963255276831578e-01   +1.753830690410890e-01   +5.221036468726699e-01   -4.885643919973377e-01   -5.383808500574537e-01   -1.524561021884589e-01   +8.369452325129065e-02   -5.293806563218340e-01   +6.389227648097917e-01   -1.390785607216047e-01   -3.835503600806852e-01   -1.799987438373415e-01   +2.296692669603039e-01   -3.534819510405650e-01; +2.206057397777433e-02   +1.605430129450202e-01   -1.880225255890413e-01   -2.193489441149899e-01   -3.693991175382054e-01   -2.184231267197584e-01   +4.657322876846895e-01   -2.807338249072262e-01   +1.166739380585889e-01   -1.233527841980840e-01   +2.861704988919299e-01   -2.044416681301778e-01   +4.789046396350910e-01   -1.869718572772855e-01   +1.835543107826836e-01   -1.195481550617492e-02];
L1E_L1I_iGABA_netcon = [+1.421218411368442e-01   +4.919771117336389e-01   -3.402108579701921e-01   -1.034886038518628e-01   -3.503148732799320e-01   -6.184944183987175e-01   +4.396763819080984e-01   -2.021445780774432e-01   +3.873942014572247e-01   +2.080254186084659e-01   +1.536590848045198e-01   -2.437840937062566e-01   -1.916299408278180e-02   +5.638155910652254e-01   -4.886546480535362e-01   +4.334736709761707e-01; +2.619935348746527e-01   -9.043581795839517e-02   -2.812468152504369e-03   +1.576107380958412e-01   -1.468770476524940e-01   +1.321417348227264e-01   +3.404842583364623e-01   +5.652498678105378e-02   -8.923648767260473e-02   +4.512955621132294e-01   +9.310597793144966e-02   -2.604323929248764e-01   -1.392793824621243e-02   +3.809675415372507e-01   +8.733934264482690e-02   +2.033395636352502e-01; +4.650037357115798e-03   -5.741300845846450e-01   -2.041529310290541e-01   +1.764806106110114e-01   +2.515946277461770e-01   -2.657720602543928e-01   -7.644839221248434e-01   +2.533842532817957e-01   +3.140673482269323e-01   +9.571194249014525e-01   +4.806199484676156e-01   -8.210016868515825e-02   -4.453523239001017e-02   +5.775031879582555e-02   -2.370968588984864e-01   +6.927527646319109e-01; +1.607292415149982e-02   -3.357599568457914e-01   +2.558683625013241e-01   +2.118489532272511e-01   +1.924929146480145e-01   +3.424697824305444e-01   +2.319188668142373e-01   +6.600941035447507e-01   -3.916642074748212e-01   +2.375286845548480e-01   +3.287347977735042e-01   -4.181224287463796e-01   -1.580832798130114e-01   -1.207189894056623e-01   +1.071456626999914e-02   -1.008723657154181e-03; -1.830007948193161e-01   -6.285363156248802e-01   -1.074164601374889e-01   -1.898489034515404e-01   -4.067214187316538e-01   +7.509846156541428e-02   +9.194393014383609e-02   +1.089155810961126e-01   +1.431497002120714e-01   +2.326359533323878e-01   -6.678167319610051e-02   -3.365087608816323e-01   +4.001971859125986e-01   +4.536177144399647e-01   -1.259158546336020e-01   -2.405299101040667e-01; +5.250480620478649e-01   -1.890520322642409e-01   +1.868516184190467e-01   -1.199874802424189e-01   +2.995006190700266e-01   -4.342067264029494e-01   -1.676853943870971e-01   +1.767330946804810e-01   -9.245235081474686e-03   +4.939384686361780e-02   +2.919525094440305e-02   +5.385994463339296e-01   +2.447420551809481e-01   -7.017300655296374e-02   +6.429966689902429e-01   +2.801748289063198e-01; -1.458376181899343e-01   -4.975867277842185e-01   +2.144671251725020e-01   -7.933615275830079e-02   -2.615871625402139e-01   -4.243665086136029e-01   -2.658452326004354e-01   +9.729408428380068e-03   -9.862996327217445e-02   +5.201009765411408e-01   +2.445399257777761e-01   +3.007065747723435e-01   +5.072684851877440e-01   -2.827497322949676e-01   -3.845911262285397e-01   -2.586839433266058e-02; -4.085501403999220e-02   +3.408985329380997e-01   +3.219110954156333e-01   -8.317323117481498e-02   +1.989116944964885e-01   +3.827178258082733e-02   +1.062028695553596e-02   -3.093088658070687e-02   -2.790686059530129e-02   -2.706002201535536e-01   -9.039117142368859e-02   -1.513156271313452e-01   +3.304616613469398e-01   +3.884258410533601e-01   -3.852549333477594e-01   +9.709125971355972e-02; -2.833224129967551e-01   -1.713759798803688e-02   -1.645936511592011e-01   +2.490811059861386e-01   -1.832494454280741e-01   -3.936002114288947e-01   -3.108735106967608e-02   +4.709617875149184e-02   -1.828975979033563e-01   -4.128007697122782e-01   +3.642362940973942e-01   -5.996743982592317e-01   -4.218834997311871e-01   +3.103519637935074e-01   -3.060935392603910e-01   +1.962374238053062e-02; +3.504746281189979e-01   +4.098704335146346e-01   +1.414218983498768e-01   +1.460055294784689e-01   -4.081052710622566e-01   +5.276260229792137e-02   +4.853297521323120e-01   -6.570864023055030e-01   -5.075599177386756e-01   +3.787842048035560e-01   -2.375377401725712e-01   +7.997715600324123e-01   -5.548508456236360e-02   -4.508089516776064e-01   -4.198680458078233e-01   -3.098636486224995e-02; -9.686785111046141e-01   -6.928618250459432e-01   -2.682107098086012e-01   -1.935114378046718e-01   -2.117559583658082e-01   -1.317857954223900e-02   +7.130085414112111e-02   +4.653043001379447e-01   +1.977491919857552e-01   +4.003791851540628e-01   +4.762842443388091e-01   +1.294395848395431e-01   +1.489628970116275e-01   +2.459556848926694e-01   +5.533782527565637e-02   +1.696191211016518e-02; -7.369620077319713e-02   -4.967557889221644e-01   -3.286103642518133e-01   -1.934239611490886e-01   -1.956505781101806e-01   -1.469578024178781e-01   +5.034638810361057e-02   +6.125039356605900e-01   -7.437295607398325e-02   +1.467486187835415e-02   -9.026660163493627e-04   +8.161743180530456e-01   +3.204734399626492e-01   -6.478529789460903e-01   +2.859507343067084e-01   -7.159531144937850e-01; -7.700740389834274e-01   +5.925233915270156e-01   +4.365457042677706e-01   +3.815551405829038e-01   +1.981952635756252e-01   +3.481073866142981e-01   -5.121958582162787e-01   +1.874948731872702e-01   +5.203849483423018e-01   +2.605021819719738e-01   -2.225699352722024e-01   -3.783219204071535e-01   +1.149694163043195e-01   +6.733560235920866e-01   -2.538869969389043e-01   -4.342672904756156e-01; +2.119320394807498e-01   -1.366849789219883e-01   +3.692554131585753e-03   +5.469465903790780e-01   +2.623989980726117e-01   -1.601716841780879e-01   +3.472594789473197e-01   -7.459168483834722e-01   +1.518930655603951e-01   -5.000791474139457e-01   -7.990023054328665e-04   -3.241919643052273e-01   -6.597422216320445e-02   +3.283264126478042e-01   +1.457503155755853e-01   +3.640517292605303e-02; +1.192952051976420e-02   -1.691745435030658e-01   +1.087534898193633e-01   -3.025978077391476e-01   +2.320273101200818e-01   +7.335111490675786e-02   +2.238421680494188e-02   +1.193218004112469e-01   +5.784170718497723e-01   +4.162266729218613e-01   +3.349648479003171e-01   -4.772833336900908e-01   -3.502283641824463e-01   -2.713924537919476e-01   +1.008735183983344e-01   +2.075091350773444e-01; +2.580605961332029e-01   +6.551997931662716e-01   -4.799274506793243e-02   +5.658539678417041e-01   +1.984518609164921e-01   -8.586906807060304e-01   -9.255627539072707e-02   -2.042818443348813e-01   -4.413324948017018e-01   +3.737451016892724e-01   +1.284220518163266e-01   +2.691979537042459e-01   -1.596415377257703e-01   -6.477772309772564e-02   -2.466515035578469e-01   +6.586313717222966e-01];
L2I_L1I_iGABA_netcon = [+3.286569376614155e-01   +9.258624557151507e-02   +1.596265373210217e-01   +8.081084953745871e-02   +3.083575753875356e-01   -3.051418301698009e-01   -6.138114157288065e-02   +1.795624617247077e-01; +3.265368726559724e-01   -8.484900693482444e-01   +1.844911037228386e-01   -1.249045165939911e-01   -2.486180279425543e-01   -1.994516129414109e-01   +1.371540594379627e-01   -2.023543068970078e-01; -4.220510277221955e-01   -1.864611406909301e-01   +2.395399679100891e-01   -9.861296975175880e-02   -2.223705365198296e-01   -2.255285364341693e-01   -4.824548829755775e-02   -2.363390500483396e-01; +1.032961494995910e-01   +2.207177182592887e-01   -2.470366092520815e-01   -9.768502021266569e-02   -1.593489702892622e-01   +4.366512223346127e-01   +5.676026154233403e-01   -8.875184113579207e-02; -1.202819646848118e-01   +4.868003771000917e-01   -3.770275477573863e-01   +8.406727218799884e-02   -4.098938807829933e-01   -1.166494568430147e-01   -3.107720648724228e-01   +4.273449305424074e-02; +1.695946675369111e-01   -6.480516755603960e-03   +4.373161661499111e-02   -2.805848183418855e-02   +3.672733993221977e-01   -3.557047256323764e-01   +4.891147726288680e-01   +3.186912842397597e-01; +5.227691721237444e-02   +1.705525519069108e-01   +3.001734701568967e-01   -2.384084931862237e-01   -3.828624699865076e-01   +1.666234456362314e-01   -2.616829493636667e-01   -1.284939983495770e-03; +1.081463958953284e-01   +3.050299599122196e-01   -7.782301030689302e-02   +3.241892047003604e-01   -1.762793873823086e-02   -2.859991786629980e-01   +9.078846854677569e-01   -4.712194613009211e-01; -1.122631493386758e-01   +5.300370957327705e-01   +4.664207107111323e-02   +2.401439152391533e-01   +4.800987787584070e-01   -3.014564023837674e-02   -5.619198449039500e-01   +2.193377522705203e-01; +2.254052061526181e-01   -6.678530965790827e-01   +4.644533794608134e-01   +1.071765987286136e-01   -3.831218506149306e-01   +7.308101959664585e-01   +8.718604482431387e-02   -3.438632574903894e-02; +4.910497056611617e-01   +1.571475053571248e-01   +3.363888354153478e-02   +4.563539989424000e-01   -3.086580304436298e-01   +2.307809958239579e-01   +3.004361088776312e-01   -5.819803523822191e-02; -8.080426533656658e-02   -1.472035844215470e-01   -2.829746527729858e-01   +1.359837542267119e-01   -6.253754426955787e-01   +3.078460001152294e-01   +2.761225615805685e-01   +4.441096685535164e-01; +1.059535952236473e-01   +3.291623099787730e-01   -1.427112954609009e-01   +7.970487784358848e-02   +1.860155732357507e-01   -1.441310930183211e-01   +4.380528951240590e-01   +2.922032945612087e-01; +1.368573461876564e-01   +8.657645165549578e-02   -1.470879966192519e-01   +1.447431164311268e-01   -1.190363187667519e-01   +1.605810552854058e-01   -3.400269173130386e-01   +4.649031798473703e-01; +1.851667604933336e-01   -2.243609795060252e-01   +5.101502661193025e-01   +1.836120986282503e-01   -5.110250600152839e-01   +3.594222006790219e-01   +5.145483593976143e-01   +6.939887738176187e-02; +8.891760603162048e-01   -1.980740625445496e-01   -1.562898022288148e-01   -3.133075585771239e-02   -2.600686388752569e-01   +6.779759724219020e-02   +6.867243238878365e-02   +2.781510855037455e-01];
L1I_L2I_iGABA_netcon = [-2.468623529298052e-01   +1.434836210516924e-01   +9.353871287688478e-02   -4.322609469376096e-01   +8.494152888011108e-02   -3.707414034471838e-01   -5.091124480505308e-01   -9.171392175384068e-01   +4.649811283519380e-01   -8.765739473621939e-01   +2.080208737244711e-01   +6.580820004612762e-01   -1.036579596149973e-01   +7.127577541383714e-01   +4.627908971682609e-01   +4.104981538830486e-01; -9.854377359693940e-02   +4.373773446749284e-02   +8.691067198373910e-02   +4.104142800528091e-02   -2.251138436576876e-02   +5.112046922412690e-01   +8.167614177331901e-01   -8.646222414275333e-02   +4.300401837000072e-01   -1.848308772952230e-01   +4.966942207354664e-01   -2.843388129200652e-01   +4.178519309159511e-01   +4.695170393033462e-01   +7.902153780982523e-01   -4.214363100436547e-01; +9.598264720300036e-02   +3.266923316148501e-01   -2.875395022343473e-01   -2.832339346963417e-01   +7.991610583519496e-02   -1.622283645859225e-01   +1.142459765120511e-01   +1.745394552097271e-02   +4.478092589368154e-01   +2.215914754114112e-01   -1.400813977188815e-01   +8.011248978051685e-02   +2.155190052971380e-01   -2.026042430390120e-01   -1.342019354698363e-01   +2.919824683797376e-02; +4.490800338881604e-02   +6.118557249152400e-02   -5.390466935772099e-01   +3.152722488234987e-02   -1.903097430902117e-01   -5.387946008061868e-02   -2.315534971316086e-01   -1.756740743708995e-01   +2.012427303840571e-01   -7.816216261874681e-02   -1.048236281736671e-01   -3.051744242174242e-01   +1.428724647512008e-01   +8.106102590561631e-03   -8.020579541944708e-02   -1.934883307908298e-01; -9.296009392985774e-02   +1.436805907935034e-01   -9.569957568943856e-02   +1.776659258987918e-02   +4.070892789904775e-01   +1.022492636988421e-01   -1.471091153332651e-01   -2.467052887686185e-01   +3.862543301606752e-01   +3.172627788856415e-01   +1.793297481260186e-01   +3.128904257037469e-01   +5.348920123764513e-01   +2.457163716136828e-02   -2.029979379980041e-01   +3.093218975697901e-01; -5.951292187079847e-01   +1.987745778990946e-01   +1.251043715622296e-01   -3.002047031304776e-01   +6.597161443621002e-02   -5.076449176716799e-01   +1.445117255069849e-01   +5.647498907949783e-01   -1.639109113610330e-01   -2.675320309967670e-01   -2.702432516725172e-01   +5.955052045379179e-01   +2.891441317156634e-02   -8.008590571745124e-01   -4.414394839519412e-01   +2.913109971903178e-02; +5.740960940652942e-01   -4.578216280845167e-02   -1.436269257715500e-01   -8.294197879558077e-02   +6.795182148601837e-01   -3.648477907339202e-01   +1.935475214643531e-01   -3.444648913016063e-02   +1.620035172015971e-01   +1.820992740091350e-01   +1.545827609586555e-01   -2.508328060931884e-01   +3.856825108892412e-01   -2.784975018099143e-01   +1.242458438817817e-01   -5.908438141938211e-01; -1.993382559842200e-01   +7.549312825055188e-02   -1.504634336337638e-01   -5.394889821760653e-01   +3.334759186213113e-01   -1.227577955693810e-01   -1.659646044157267e-01   -3.357898392241942e-01   +2.022827715628377e-01   +2.034835675120217e-01   -1.777772704327415e-01   +9.620235613245380e-02   +1.937213753511382e-01   +3.885945937755797e-02   -3.166040598793555e-01   +4.307481612712724e-01];
L2E_L1E_iAMPA_netcon = [-2.140296189178335e-01   -2.956942682510895e-01   +9.942275177332212e-02   -1.527930789159136e-01   -2.540649353874209e-01   +2.962250635161654e-01   +3.284389521992738e-01   +5.248383459508061e-01; +6.906523583244315e-01   +4.617017991021318e-01   -1.543173628737750e-01   -3.493951141447295e-01   +3.465065347973422e-01   +5.203301818099704e-01   +1.867953325765117e-01   +6.962962260484554e-01; -2.324263188806715e-01   -3.760790356177282e-01   -2.353716794642034e-01   +2.619503244539928e-02   +8.798135252994124e-02   -1.506204253171040e-01   +8.289762498343170e-02   +8.828501444921717e-02; +5.996915505010851e-01   -5.646297226867281e-02   +1.047630448508034e-01   -1.517505923908208e-01   -1.641333812996204e-01   +1.389800029919769e-01   -3.076400726274353e-01   +1.580024344128737e-01; -2.730047809081278e-02   -1.916309528586271e-02   +1.070984014070603e-01   +2.937608328466595e-01   -2.011125124722627e-01   +6.158519750196512e-02   +7.424364443769046e-01   -1.719326322030395e-01; -3.035862950407348e-01   +3.342992269662258e-01   +8.511150674997427e-02   -1.541885398581964e-01   +5.049036997200845e-01   +6.755075676598442e-01   -2.151477181964200e-01   +3.945278186165205e-01; +6.067942747906372e-01   +3.628331737088223e-01   -2.238060839468232e-01   -5.893881222580858e-01   +1.360122649846492e-02   +2.483242064688824e-01   +4.838852191684145e-01   +4.784063882842849e-01; -2.184305456888761e-01   +1.967162867667966e-01   -6.811898910583400e-01   +4.385814367428494e-01   -4.475086198272082e-01   +4.134674341380902e-01   +2.713365067141029e-01   +2.957954587307126e-01; -2.373419147854282e-01   +3.255837767008379e-01   +1.067269342315530e-01   +3.560194696702721e-01   -8.245433496941347e-02   -2.595246920059271e-01   -7.760896982858587e-01   -9.721286407083639e-02; +1.348423568954415e-01   +2.453546528919765e-01   +9.128847288179855e-02   +2.667547230867032e-01   +3.794947474253373e-01   -1.417450091669444e-01   -8.652340799384650e-04   +1.261194437040321e-01; -1.460360129247940e-01   -3.779893968270137e-02   +7.175174553376521e-01   +3.062516154402398e-01   +4.946216349920379e-01   -2.281616428162616e-01   +5.522622804175754e-01   -5.882790796044306e-02; +1.495339077603088e-01   -7.945172789585311e-02   +8.785040082443186e-01   +2.732534368761063e-01   +6.602544016414829e-01   -2.166936772581260e-01   +4.769675710553664e-01   -3.621875706582961e-01; -6.783362675952285e-01   +4.380873927879830e-01   +2.655425357305915e-01   -1.855922340430673e-01   -3.981448573428306e-01   -1.039130212994678e-01   +7.743943931857123e-01   -1.895102900122353e-01; -3.798082216747305e-01   +5.338034951259515e-02   +2.683665710564065e-01   -9.125787577214872e-02   -3.195459075430116e-01   -2.376901585294767e-01   +1.999391591134022e-01   +1.454620593355140e-01; -1.160189293685333e-02   +6.883535368027611e-01   -4.236005215340103e-01   +4.711724888140578e-01   +7.282755082414523e-02   +3.532725623859244e-01   +1.865662847630805e-01   -1.386554363223633e-01; -4.366277764863955e-01   +8.370484929389974e-01   +3.963862409334437e-01   +1.507334212517636e-01   -2.569086494684086e-01   +2.667344140590094e-01   -1.102150763193774e-02   +2.916016711608382e-01];
L1E_L2E_iAMPA_netcon = [-4.049215623091689e-01   +3.440322728392636e-01   +2.843272900800514e-01   +7.870749307399058e-02   +1.322665384515587e-01   -4.077539108050330e-01   -1.758730421398167e-01   -2.476049685939000e-01   -1.515526652737337e-01   +2.064017650294480e-01   +1.532478855904120e-01   -4.159420277032486e-02   -5.077586085760941e-01   +5.582538080960953e-01   +7.589576577639757e-01   -4.709076822746172e-02; -6.349596101294641e-02   -1.792972310164704e-01   +1.902828820662805e-01   -3.822252001310668e-01   +7.223905953766777e-02   -7.239550290163177e-01   +1.431551124565113e-01   -1.293312879402217e-01   +4.627307284116820e-02   +4.346128494818756e-01   -5.082091880020475e-01   +3.750900370374369e-02   +1.573529718953619e-01   +2.645441855124206e-01   +3.979867322223412e-01   +7.588245321782766e-02; -1.416692298901383e-01   -3.166731419386959e-01   +9.779658842138135e-02   -2.054595437488052e-01   +4.060324043533212e-01   +4.462903119588045e-01   +6.997055830871131e-01   +2.901532503988424e-01   -2.249227678098158e-01   +2.880756511227287e-01   +2.078967832292345e-01   +6.352610828204480e-01   -7.105160387740600e-02   -1.129259941802688e-01   -2.553057293095944e-01   +2.538901821377599e-01; +7.616705648541086e-02   -4.304293182301381e-01   -8.534330203877430e-02   +6.541220960757964e-01   +1.833073355379971e-01   -4.939494343788573e-02   +5.234439886010583e-01   -4.832785321379340e-01   +3.138894996645988e-02   -2.832863319289173e-01   -1.138995052910542e-01   +2.539353319974457e-01   -1.002954931953345e-01   -2.769267141281791e-01   +4.859217487956122e-01   +3.462773749054481e-01; -4.072335267572644e-01   +2.554257714358539e-02   +4.716874966540498e-01   +5.767538489029875e-01   +1.772033461761024e-05   +5.592081169494496e-01   +2.395939139114623e-01   +2.389282350726412e-01   +4.953740650346629e-01   -5.501244807106536e-01   +2.994565966918275e-02   +9.262326042964836e-02   -1.453006974112069e-01   -2.923288732619537e-01   -1.094224911332956e-01   -5.017781591338607e-01; +9.861143326861936e-02   -1.507163869366669e-01   -3.388397721328090e-02   +1.253377609452405e-01   +9.196803920867386e-03   -1.799439205588923e-01   -1.153272889988320e-01   -3.198395154584367e-01   +1.016397513137179e-01   +1.640304777488749e-01   +5.355258059852428e-01   +5.937101897070511e-01   +1.577025581096118e-01   -3.286103224368617e-02   -3.218832836477689e-01   -4.661150073148306e-01; +3.638316992913104e-01   +8.976454911779332e-01   +3.658408131075889e-01   +2.028607021302675e-01   -3.330996560987501e-01   +1.308600637161708e-01   +1.711787480756259e-01   -1.197979497526471e-01   +6.805738275574612e-01   +4.268105787246698e-01   +1.472423975194219e-01   +2.918116764756011e-01   +9.921957746148474e-02   +2.838145388161558e-01   +6.658213460346042e-01   +2.219597327236413e-01; -1.630493177798587e-01   +5.758628770972689e-01   -2.173334142864028e-01   +2.133515272550943e-01   -4.645436327188180e-01   -4.684307552358602e-03   -5.435408995427039e-01   -6.113062627896990e-02   +3.437563339385487e-01   -4.279379055079748e-01   -1.264388124980523e-01   +7.185485915206247e-02   +2.694794836665756e-02   +3.288799324418603e-01   +3.440555123797669e-01   +7.354608400277068e-01];
L2I_L2E_iAMPA_netcon = [-4.542360988659772e-01   -1.276141422683132e-01   -2.373303413731543e-01   +7.461337115313330e-02   -1.417768403286729e-01   -3.861547606054735e-01   -1.263178629511834e-01   +8.433821053400545e-01; +5.358683821593954e-01   -5.878257798618798e-01   +7.769461756822402e-02   +5.631805434104862e-01   -8.116470686924282e-02   -1.861547771381291e-01   -4.925894402431701e-02   -3.576393562566099e-01; -6.106801846685980e-03   -2.097692097656514e-01   -2.300069390791473e-01   +1.557733085114646e-02   -1.991721592423801e-02   +2.724997360127752e-01   +2.016364957728609e-01   +6.274874167207538e-01; -3.136252968255092e-01   -1.214190596310949e-03   +7.092004266131808e-01   -5.943985519571099e-01   +2.558379072362694e-01   -1.574833206074844e-01   -4.053270617759105e-01   +2.229921646345979e-01; +7.659587550700164e-02   -2.197814372681272e-01   -3.173145349695823e-01   -5.789346418085760e-01   +1.550894460129227e-01   -4.376634191212171e-01   +4.938051713915744e-01   +1.027211530300547e-01; +2.283098036201624e-01   +4.440745538359437e-01   +1.326403507058429e-01   +3.162866246377298e-01   +1.636436939638247e-02   +9.502113123516376e-02   -3.067522187103235e-02   +1.192586954721826e-01; +1.379281530888013e-01   +2.882323436933354e-01   +4.156679609557202e-01   -8.161498806781251e-02   -2.631617772217478e-01   +4.493585125495394e-01   +1.929050015882467e-01   +1.982307922441026e-02; -1.243860698025000e-01   +3.476005652556674e-01   -2.621713014915517e-02   -5.755214576579276e-01   +5.381570140005056e-01   -2.895246051653857e-01   +5.890209317594188e-01   +2.299765906719085e-01];
L2E_L2I_iGABA_netcon = [+4.037467414893618e-01   +1.722290741719282e-02   -2.244237685553750e-01   -4.426002189380762e-01   +7.379227115936748e-04   -3.223968959918289e-01   +1.091742485897631e-01   +9.392111283119389e-02; +2.065656799813640e-01   +2.618056605919998e-01   -3.504243793632265e-01   +1.610952323783857e-01   -3.735669446023075e-01   -5.975541242192248e-01   -5.228685685235355e-02   +2.531245003902476e-01; +1.650090102082228e-01   -3.314052356785075e-01   -2.665871694770485e-01   +1.089637070988684e-01   +1.433250459435773e-02   -3.036204144590982e-02   +9.455568640049428e-01   +1.947519164120299e-01; +1.724890291654153e-01   +1.688627870396338e-01   +2.841950410801524e-01   -3.861016631428354e-01   -1.174959265625060e-02   +8.254771240634792e-02   +5.473436703246040e-01   +5.743864618591353e-01; +2.879860520021851e-01   +1.035647315593799e-01   -2.925716722386708e-01   -4.259274436450489e-01   +3.047328547673877e-01   -2.042244849353984e-01   -4.559862192381652e-01   +2.765145676010771e-01; +6.108758840492849e-01   +1.580852883884052e-01   +2.496281958961033e-01   -3.773004502267484e-01   +3.431895866139320e-01   -7.592337924541662e-02   -3.089230731968208e-01   -1.631561481899785e-01; +3.236374026831212e-01   -6.677126760634466e-01   +2.745716848291468e-02   +2.365958831045433e-02   +1.430166284691874e-01   -1.044761677827736e-01   +3.103286312304279e-02   -6.227775082071409e-02; -3.166040376172244e-01   -2.060529199509517e-02   +4.151999902150537e-01   +3.391450016453849e-01   +3.990494398890035e-01   +1.886650413673620e-01   +3.083529333122270e-01   +1.097826245828342e-01];
L3E_L2E_iAMPA_netcon = [-4.421199169514495e-01   -1.450293803496672e-02   +6.726802904499270e-02   -2.788348943430832e-01   +7.114121136766736e-01   +4.297137233453827e-02   -3.380302167794962e-01   +8.597347061803345e-03   +2.505362453085116e-02   +5.173938255493749e-02   -5.416599974586313e-02   +2.423840058391090e-01; -4.197117946596503e-01   +3.721332113651986e-01   +3.521631120613355e-01   +8.243032646027806e-02   +4.231447412733745e-01   +1.476800321374361e-01   -2.130483722508905e-01   -1.765363193167413e-01   +2.106045774757390e-01   -2.420634671178720e-01   +2.760524014863396e-02   -2.150258158811286e-01; -6.573589946351844e-01   -6.449143311857510e-01   +6.390502107909675e-01   +5.459248594380869e-01   +4.169953425509612e-01   -3.439867670084483e-01   +3.582555908621626e-01   -1.997778157424722e-02   +6.652225699687938e-01   -1.813997597737824e-01   +4.217673621271198e-01   +1.103453802267728e-01; +3.604587691416472e-01   -3.293564288629695e-01   -4.007012705255997e-03   +6.993628881661941e-01   -2.408844202456328e-01   +8.379143990649901e-02   -3.284518963848589e-01   +4.270768941941115e-02   -2.077094828874311e-01   +4.892356591848978e-01   -5.993014343345220e-01   -3.271923546848393e-02; +5.253753882011347e-01   +1.002187869297866e-01   -9.443116563507309e-02   +5.703551187580919e-01   -1.877418861759972e-01   -4.937343997912559e-01   +5.779785158733600e-01   -1.391887636890590e-01   -1.036947681925614e-01   -1.990881080269347e-01   -1.997492204007280e-01   +4.888665177028624e-01; -1.208030896195955e-01   -2.081396027341541e-01   -2.373221381953340e-01   -2.480582154908209e-01   +6.338532891485240e-01   +2.679782129726446e-01   +7.414807434490488e-01   +2.189264881073474e-01   -1.596378585310786e-01   -2.713182385097332e-01   -1.680813479924726e-01   +1.025024291397764e-01; -1.827915923266917e-01   +3.588541494201293e-01   +2.351998652400727e-01   -8.756901220851159e-01   -5.274912963702486e-02   +5.969697350764780e-01   +3.897989530219986e-01   +1.747646847839338e-01   -8.395947258963590e-02   -3.929270554310180e-01   +5.787691060468706e-01   -7.267846126734335e-01; -4.170010511799868e-01   +5.145383667998804e-01   +2.296965737826535e-01   -1.324727441419102e-01   +3.163274758658439e-01   +6.190483516171907e-01   +2.425712043866640e-01   -3.829164470618546e-01   +3.322723130911942e-01   +2.791125694644656e-01   +2.268391861815362e-01   +3.924484074526045e-01];
L3I_L2I_iGABA_netcon = [+1.027135782968917e-01   +3.683331987013747e-02   +3.699327476412808e-01   -7.204244836356807e-02   -6.828492950992420e-01   +6.910406331190153e-01   -2.524175544331688e-01   +3.872788397771953e-01   -7.003603440938186e-01   -2.895775290906119e-01   -7.207033912893311e-01   +7.376012619326930e-01; -2.763747392107962e-01   +7.815663233285198e-01   -3.440624242541765e-01   -2.682323131194174e-01   +4.642120823568527e-02   -5.323732673888686e-02   +5.701015980982838e-01   -2.348653639905963e-01   -2.343756745337410e-01   -1.797354923670970e-01   +1.826551216417006e-01   -1.735080704209321e-01; +7.310366398642720e-02   +6.673927582901964e-01   +2.141614221162197e-01   +7.866481611869511e-02   +2.724331191192899e-01   +4.113672619536253e-01   +9.550833122661483e-02   +1.365253823084092e-01   +7.033096945551669e-01   +6.220791981082110e-01   -7.069260394325889e-01   -2.088054885176899e-01; -8.517207783850786e-02   -3.410498824473588e-01   +2.396692081900207e-01   -3.255048577772460e-01   +3.498423821737296e-01   +5.544713472653248e-01   +3.274112276866148e-01   -4.201068080628597e-01   +4.569402014562854e-02   +6.910666791625197e-01   +3.559688192293686e-03   +3.117023366846511e-01; -3.327799384207797e-03   -3.985895948849329e-02   +5.637639873770605e-01   +6.063876315095106e-01   +2.406607827277799e-01   -7.276174914797529e-01   -4.717502503380056e-01   +1.483832790754450e-02   +6.182884586722945e-02   -4.455634433695029e-01   -4.670435738697774e-01   -3.539967383805846e-01; -3.616275163359270e-01   -2.961974892630094e-01   +1.401651332836269e-01   -1.524920583385861e-01   -2.732059199050398e-01   +4.307294513049453e-01   -4.530175056730205e-01   +8.363945900184310e-01   -5.059414117553646e-01   -3.165529030242209e-01   -5.327196349207282e-01   +3.251838651460454e-02; +5.949887216074559e-01   -1.854777185445786e-01   -4.868817448291016e-01   -9.446183686554284e-02   -2.718220910124119e-01   -6.566098313519507e-02   +3.022201124133863e-01   +3.827798089916506e-01   +5.290355083528856e-01   +4.416375784814112e-01   +1.670556817771329e-01   -2.671235965185688e-01; -1.124286005731945e-03   +6.576435028304257e-02   +3.761380198961204e-01   +2.608831771147666e-01   -1.697816423908184e-01   +4.779578500009777e-01   +5.519433788280499e-02   -1.686644866784751e-02   -5.966872901521803e-03   +5.259607264271119e-01   +2.602558620600446e-01   +2.248576649703621e-01];
L2E_L3E_iAMPA_netcon = [+8.290323833461616e-02   -8.609368597315398e-03   -6.239829966035814e-01   +6.123953032434160e-01   +2.666401903479350e-02   +2.428063560568731e-01   +1.975302538611489e-01   +3.721470482172676e-01; +4.825852149761886e-02   +4.159658604008382e-01   +8.141634187225510e-01   -4.111230897810915e-02   -2.635304626080184e-01   +7.346860125786430e-01   -2.337529085758172e-01   -1.312799036973833e-01; -1.602735055171690e-01   +5.796265846092021e-01   +5.062489207995736e-01   +1.884012174698815e-01   +5.957362162727236e-01   -7.642581264727966e-02   -5.678854595069599e-01   +6.213621071538050e-02; +5.127905493334555e-01   -4.587764076832158e-01   +2.238412424760471e-01   -4.745467530268443e-01   -5.444026178935519e-01   -1.598627814883181e-01   +5.261230303612633e-01   +1.357586899898307e-01; +3.539415245612609e-01   +1.408322435183765e-02   +4.473008168343655e-01   +5.951240035066757e-01   -1.462239600259647e-01   -2.407015356568215e-01   -1.483967689877292e-01   +4.031395197460204e-01; -4.337380149533374e-01   +2.362196090441487e-01   +4.131814612816226e-01   -1.423617449599732e-01   +1.894025129270702e-02   +2.999134491510966e-01   -1.533864281608705e-01   +3.088272057364514e-01; +5.035189707890584e-01   -3.067519837245292e-01   +4.823968082720757e-01   +4.941242484967957e-01   -3.590929464240276e-01   -5.881023041003914e-02   +4.101513027487254e-01   +8.372808634964700e-01; -2.544160278963785e-01   +3.294185725466712e-01   -3.865850618545197e-01   +3.881728925411680e-01   +7.750893932618547e-02   -2.028225014160562e-01   -1.037928514689602e-01   +1.293363322496251e-01; -1.666369957366169e-01   +5.697151690736750e-01   -2.479899664392742e-01   -4.030738317830870e-01   -2.655650494564369e-01   -4.992305921370845e-01   -5.239976257330214e-01   +4.134894822509248e-01; +2.195619392508180e-01   +1.849373160802639e-02   -4.215155449569493e-01   -7.930050755925470e-01   +4.255149301486812e-01   +5.023623342301652e-01   +7.619384542172561e-02   -9.850854659855557e-02; -7.227887521511031e-01   +1.592933520679582e-01   +9.160202536055886e-02   +3.103493846238509e-03   -3.410845909539877e-01   -3.343989171836339e-01   +7.688398777292188e-03   +3.184911236675519e-01; -3.108841675776388e-01   +3.375771503017535e-01   +2.222766744830453e-01   -3.206325121680340e-01   -2.338110868024337e-03   +2.112011666807369e-01   -1.439904298047136e-01   -4.877465738009328e-01];
L2I_L3I_iGABA_netcon = [-2.928284780362367e-02   +4.632194261217779e-01   +2.419349162279816e-04   +4.218635706387988e-03   -6.124606820165692e-01   +4.860263094221318e-02   -7.364426219720109e-02   +3.741378729358460e-01; -8.213804718365325e-02   +1.386318944669223e-01   -3.056510067619851e-02   +5.437284061971246e-01   +6.123077522475888e-02   -5.273682065389499e-01   +1.618953445186918e-01   -2.427241849671063e-01; -1.370047316786764e-01   +6.142260877176827e-01   +3.277286850015595e-01   +4.724686099181495e-01   +9.365315494156076e-02   -1.249143733171633e-01   -2.542462886157441e-01   +6.520133298333081e-02; -4.385672466301063e-02   -2.483763191752442e-01   +4.263643196084363e-01   -2.856205518703569e-01   +3.552333612202213e-01   +7.445689102195907e-01   -1.698200445874457e-01   +2.144483875985854e-01; +3.735492022047350e-01   -9.519593127112783e-02   +1.353170240633494e-01   +5.475219816320047e-01   -2.092142217708478e-01   +1.793996587836276e-01   +1.756198947354708e-01   +8.881292700273790e-01; +8.718029822909347e-01   -2.907310628853860e-02   +4.063094235008676e-01   +3.095669872382875e-02   -9.590049482946768e-02   +1.298907791181229e-01   +2.732395982292825e-01   -1.970479222677997e-01; -8.630401688437213e-02   -6.654538306970853e-01   -7.556356148027356e-02   -3.075180916045020e-01   +5.738144665642083e-01   +9.131646950090604e-02   -4.919028871208680e-01   -7.035176696690610e-01; -7.133720197263016e-02   -3.766438020861946e-01   +6.214291492367654e-01   -4.707462048965861e-01   -2.401499531565068e-01   +3.023977548722137e-01   -6.453900986414592e-01   -4.645552655668572e-03; -2.988274158440335e-01   -2.501719968449618e-01   -8.646866919847493e-01   +1.398028554195496e-02   -2.958868967550052e-01   +2.586207663368493e-01   -1.192937169477220e-01   -3.087224608745537e-01; +1.692011432185846e-01   +1.221185627780906e-01   +1.535366369042788e-01   -5.863086292898398e-01   +3.974334552676461e-01   -2.575078189833037e-01   +2.849739342753952e-01   +5.636522367481316e-01; -1.502836154632816e-01   -1.876686545598618e-01   -1.494736845332745e-01   -4.900487265263914e-01   +7.153428391193067e-02   +3.230012201436231e-01   -4.915756011455303e-01   -3.687655585072439e-01; +5.834220115332538e-02   -2.411220291796773e-01   +1.329918087941642e-01   +2.286652922299890e-01   +7.498584142253300e-01   -4.658146291664760e-01   +3.110421194131330e-01   -9.313383326560180e-02];
L3I_L3E_iAMPA_netcon = [+4.901459010351356e-01   +1.044976749666507e-01   +1.503446204226177e-01   -3.659410190502764e-01   -1.103496879064209e-01   -1.184994957099667e-01   -3.524428586519452e-01   -3.304913984323274e-01   -1.444602311861130e-01   -5.182684783946498e-01   +4.641957303383848e-01   -2.702523354083335e-01; -2.284287524172710e-01   -1.981763288796736e-01   +5.678884267491576e-01   +1.256137528089049e-01   +2.130405091664349e-01   -6.132902954723102e-01   -1.683566011321128e-01   -1.055365959865850e-02   +9.376072391037558e-01   +8.581539131500224e-02   +4.335849392770102e-01   +1.521564614877323e-01; +1.123030982206497e-01   +6.817852907526341e-01   +7.991082151194147e-02   +3.025228925417432e-01   +6.249894182502640e-01   -8.535172855435278e-01   -6.982942658857785e-01   +1.458979585801519e-01   -2.282500593326835e-02   +4.393399984788864e-01   -2.809949193520376e-01   -3.666583657537341e-01; -2.285511237331111e-01   -3.260295198135697e-01   +5.213219915139486e-01   +1.145106097189215e-01   +2.433181234295090e-02   -9.593015864029833e-02   +5.794015153044997e-01   -1.210857734766090e-01   -6.597864216764266e-01   -2.260820599506289e-01   -2.391464642236011e-01   +2.527988375702763e-01; -4.613133053342618e-01   +4.151424154533054e-01   +3.398769422086362e-01   +8.176279371076460e-02   +2.025802411279432e-01   -1.502642849514751e-01   +4.442214718865563e-02   -3.474823089035671e-01   +4.261337579565372e-01   +1.170169600290853e-01   -3.174970890848992e-01   +2.242806797804077e-01; +2.188622064502851e-01   +1.870729092466700e-02   +4.258836625007315e-01   +2.459113469901978e-01   -1.578018704320129e-01   -6.245004290112358e-01   +2.464919185474489e-01   -5.625704199486523e-02   -2.323728670353267e-01   -1.805106174024169e-01   +6.041831188632085e-02   -6.680566364308267e-01; +3.339895718160500e-01   +5.289844420222201e-01   -1.192691537356424e-01   +1.423947738115939e-01   +7.567046081707642e-01   +3.646087822222244e-02   -1.869997750180340e-01   +3.428946803865877e-01   +4.660797334323313e-01   -2.735519576466033e-01   +4.690914828612665e-01   -1.464928347127979e-01; -2.971310078110980e-01   -5.342913301293293e-01   -5.895402782766346e-03   +1.518480060225320e-01   +3.113253736020218e-01   -2.230487776330650e-02   +2.618454411120679e-01   +5.885742346189350e-02   -2.984942727855626e-01   +2.874570707113503e-01   +1.822500683675667e-01   +1.577540129147857e-01; -4.604990478060618e-01   +5.267197745214204e-03   +9.211684492242762e-02   +1.326354770265094e-02   +1.108219196789534e-01   -1.475932491120363e-01   -1.618991118289362e-01   +2.076294890239305e-01   +8.197341256021735e-01   +6.663249167344207e-01   -3.427759163556347e-01   -1.726162950114229e-01; +6.432372639025580e-01   +4.371027611456891e-01   -1.562700760969626e-01   -2.173339172010758e-02   -4.448024825068845e-01   -3.384210909601108e-01   +3.183832209750037e-01   +4.688143548635947e-01   +1.603963424491522e-01   -2.954281539762787e-01   +5.342133044576922e-02   -5.853450397629795e-02; +1.608052425578666e-01   +1.531017312549730e-01   -7.032244246429608e-01   -2.893588920595314e-01   -4.261301860447421e-02   +2.295406915992833e-01   -7.760188644518329e-03   +7.921319307248921e-02   +2.693464904828223e-02   +4.774094611954477e-01   +5.147351850597814e-01   -2.291071123872697e-01; +4.441303878450599e-02   -6.661161243276994e-01   +7.038947715000966e-01   +5.229757347330819e-01   +5.037784702306991e-01   +1.354870870843409e-02   +3.743047585901281e-01   -4.053615643940731e-02   +3.129887623294634e-01   -1.781087063740979e-01   +1.844980630060562e-01   -3.536780076588665e-01];
L3E_L3I_iGABA_netcon = [-3.143842541639562e-01   -1.359164837035428e-01   +2.581454187300457e-01   -2.493805001248814e-01   -3.023408044525513e-02   +1.888962004047914e-01   +1.644528196646758e-01   -6.371977481736472e-02   +3.815334421229515e-01   +1.704732173233114e-01   -3.079656539733817e-01   -5.101294829573638e-02; +2.972614258598055e-01   -8.061995222368856e-02   -2.966491770917562e-01   -2.786743705240421e-01   +2.117182310246579e-01   +4.596652883462601e-02   -1.837279941743906e-01   -2.727064516812914e-01   -2.951779894364968e-01   +8.676987042163496e-02   +2.458478646670556e-01   +1.921825316329648e-01; +1.691680259053687e-01   -1.203520222875496e-01   +1.588630672887487e-01   +2.939291914735530e-01   +3.371381063552160e-01   +8.129599885870188e-01   +3.572239572518066e-01   -4.507366609640350e-01   -6.750757144606517e-02   +1.000477726972336e-01   +3.867102738243118e-01   +3.235686440205588e-01; +3.352681716103590e-01   -2.208760389358883e-01   +2.649143428442498e-01   -3.101248820483460e-01   -9.900465837051423e-02   -6.536893987588508e-01   -9.183521821968266e-02   +2.581966657980875e-01   +9.730924040968824e-01   +3.547971032835116e-01   +4.827576320510625e-01   +7.432405833810617e-01; +3.215543286533389e-01   -1.301515733777490e-01   +2.103625747101977e-01   -5.112084938373597e-01   -4.951235587473913e-01   +5.272857285890730e-01   +9.729247530289797e-02   -2.873273954823490e-01   +7.102257103504174e-02   +3.366364060438474e-01   +2.674257298505923e-01   +1.661205031905087e-01; +2.077064986003639e-01   -3.253721875997963e-01   +1.007033026730556e-01   +8.877691427339375e-02   -2.089548147218669e-01   +6.190788968252604e-02   -1.584236025961322e-02   -2.200828472257654e-01   -4.218401091814764e-01   -1.079384200344562e-01   -1.005383897313517e-01   -2.293967957863116e-01; +1.474764444433920e-01   -3.823420036193468e-01   +4.417009803920056e-01   -3.702850291273662e-01   +3.151616696031316e-01   +1.224144352635552e-01   -2.221117104691674e-01   +2.533763992182942e-01   -2.067456063193558e-01   +2.435250258595251e-01   +2.480832285714023e-01   +2.114569883724958e-01; +2.164909299422493e-02   +2.903463194020798e-01   -1.564758157900416e-01   -2.192821558267266e-01   -5.989291373910810e-01   -1.925926515898579e-01   -1.719126532960186e-01   -1.526499939715955e-01   +8.404842726952970e-02   -8.375889713202150e-02   +4.871726565138176e-01   +4.738676081011993e-02; +1.522452328254649e-01   +6.565516958560372e-02   +1.164072203313541e-01   +4.487298923871288e-01   +5.430652798448646e-01   -5.970518080217160e-01   -2.846207317521921e-01   +8.436684130247374e-02   -3.401394776024279e-01   -2.066830766055660e-01   +4.735303512507043e-01   +3.673075742396788e-02; -2.355515151133386e-01   -3.889498318760478e-01   -3.148785441123088e-01   +4.474039756056903e-02   -3.781780076001651e-01   -4.588684286456470e-01   +6.281214921901512e-02   -4.507730704448099e-01   -1.716841347037089e-01   -2.587830816730663e-02   -3.778856285377653e-01   -2.416768611240004e-01; +2.232192912034456e-01   -1.769455131053390e-01   -1.057818724362324e-01   -4.464005253343841e-01   +3.175472057821672e-01   +3.014117354221466e-01   +1.607400217339945e-01   -3.853726536744931e-01   -2.931657068051400e-01   +1.653195844351109e-01   -8.193390038940490e-02   -1.372794169591064e-01; -1.655401010959655e-01   -2.682715498413876e-01   -3.038895576784983e-01   +3.010180071281160e-01   +7.174247380069598e-01   +4.320412011396019e-01   +3.649367784556609e-01   +6.104969790268097e-01   -2.284060497254333e-01   +2.044423653150297e-01   +7.879099891261436e-02   +6.178414707908819e-01];
L2E_Input1_iAMPA_netcon = [-2.336114032344660e-01   +6.983992555028767e-01   -1.957794382606166e-01   -7.480443818679176e-02   -1.346164181068016e-01   +2.949715850508763e-01   +5.664403127214551e-01   +3.545172635372867e-01];
L2I_Input2_iAMPA_netcon = [-2.178829116686082e-01   -4.576584784165058e-01   -1.067763845733060e-01   -3.255409333927188e-01   -6.305681517615744e-01   +7.705155213599665e-02   +9.449005805149155e-02   +4.199734422545860e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.4*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.4*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
