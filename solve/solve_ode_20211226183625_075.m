function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.311328140195577e-01   +1.719365127604744e-01   +5.052949970329941e-01   +1.091681782922343e-01   +1.394389326440392e-01   +4.553993812738689e-01   -7.139616208867974e-01   -6.313977444137203e-01   -4.647622458297306e-01   -2.063994608631361e-01   +4.117531502520089e-01   -4.646024454603366e-01   -3.914343772380875e-01   +2.159069793943159e-01   +3.604438883093908e-01   +5.376391233582353e-02; +8.843438247994931e-01   +4.749193981064405e-01   +2.932021633713759e-01   +6.868477543051331e-02   -3.254195133216451e-01   -4.529692565417417e-02   +1.994575523918233e-01   +2.552799080725967e-01   +8.255053725701252e-02   -2.376761737894195e-01   -1.378005083824678e-01   +1.409564054454520e-01   -5.956044851698628e-02   +4.005027861772267e-01   +9.601635397750953e-01   +5.790425370756632e-01; +3.569890996589797e-01   -4.504329114814602e-02   -4.957176591130127e-01   +4.933127949302325e-01   -6.229431160071468e-01   -1.579336310070674e-01   +4.117828253336187e-01   -5.357756246620859e-01   -3.425037234437616e-02   +4.913182943559772e-01   +2.138224157495681e-01   +3.388555389658189e-01   +2.268281993779835e-01   +3.123030595859069e-01   -6.520294115877479e-01   -3.923757234921883e-01; -1.820498232397473e-01   -1.688871496188428e-02   +5.234481926541689e-01   -6.866580225252177e-02   +6.921727911665809e-01   +7.761465312217364e-02   -4.902353425476906e-01   +1.484049682443202e-01   -2.948603166574570e-01   +4.506599138916789e-01   +6.139894775707079e-01   -3.285273466716225e-02   +3.551400335164278e-02   -7.720122616936875e-01   +1.493951020045854e-01   -3.610089317340636e-01; -4.829896288439300e-01   -6.790153739097092e-02   -7.193278103200319e-02   -1.180005635824100e-02   -5.337327952272398e-01   +2.853542213530713e-02   -4.151510928513942e-01   +3.462998679146732e-01   +3.365452861142924e-01   -2.590052591506962e-01   +5.370373072017206e-01   +3.847537246695557e-02   -4.037200074533275e-02   +6.990442979359767e-01   +5.398120336662121e-01   -7.819628378693158e-01; +5.747735013121886e-01   -2.413469965005000e-01   -3.323826272953601e-01   -2.026212583564112e-01   -5.177150067321638e-01   +3.110501176272182e-01   -3.783964839637395e-01   +5.017655895341839e-01   -4.171563768486136e-01   +3.951253136285016e-01   +2.484330465466341e-01   -6.159068641727958e-01   +4.386861522736823e-01   -5.468976794052887e-01   -3.996935441875605e-01   +7.498847812624450e-02; -1.020411450228652e-01   -5.113641622282352e-01   -4.428385374986601e-01   +3.052429935983831e-01   -1.333680763917995e-01   -4.866499638096279e-01   -4.009517945878645e-01   -6.644393997849635e-02   +4.247179228018253e-01   -5.655722353704872e-01   -7.939367199773344e-02   +1.530076187870994e-01   -2.497001959919708e-01   -4.727108555777972e-01   -5.641715098453592e-01   +2.692205962144035e-01; -4.740387835099904e-01   -2.389347815240784e-01   +6.624610764010707e-01   +2.100589811367935e-01   -3.392927654763634e-02   +2.238032980357127e-01   -7.502338784793573e-02   +2.667821937019931e-02   +5.003055138348370e-02   -1.296476372339853e-01   +5.128212800677797e-01   +1.157492666238718e-01   +4.339233640984754e-01   -4.233931829136383e-01   +4.175025254568455e-01   -2.201174518456413e-01; +1.797689513448726e-01   -4.940475396424865e-01   -3.078491301062165e-01   +4.668242692648552e-01   +1.457188897066569e-01   +3.663861782159913e-02   +2.565502320394840e-01   -8.873778937901775e-02   -2.789447113620250e-01   +2.153185927054302e-02   -4.478777120320132e-01   +4.910213082610175e-02   -6.715012931613847e-01   +9.239684341532363e-02   +1.730361163518747e-01   -6.725399896357978e-01; +4.846032667042436e-01   -3.426467789827151e-01   -1.851786005185245e-01   +2.632416379362427e-01   +7.593986768266576e-01   +4.790983238790006e-01   -2.787508894221558e-01   +4.569276805995497e-01   -3.159316054777304e-01   +7.381173566301950e-02   -5.666754320549838e-02   -6.719627794760079e-01   -2.468564316674022e-01   +6.681334356461478e-01   -5.462402069643892e-01   +7.050715157103254e-03; -2.185583982480591e-01   +1.052837244539804e-01   +1.875013080493095e-01   +1.266775087526330e-01   +2.952415432855726e-01   -3.544188313124975e-01   +3.652055831937396e-01   +1.929727392612150e-01   -3.029717700327273e-01   -1.028201983006812e-01   +2.462566737974135e-01   +2.875882140073854e-01   +2.748886454125562e-02   +6.021832159092273e-01   -3.169081402566045e-01   +1.356629183070534e-01; +1.259687065986544e-01   -3.313725305116690e-01   -5.753249180624046e-01   -3.948688971429013e-01   +5.226028131604443e-02   -2.338844037822599e-01   -2.672491068807837e-01   -1.000000000000000e+00   +6.165886605576725e-01   +4.441127926469323e-01   +3.836880954948074e-01   -2.059328223316116e-01   -1.740724614684100e-01   +2.913033513874903e-01   -4.188006209205810e-01   +3.881773113848244e-02; +5.099802244357661e-01   -7.616543268547546e-02   -1.885539367595454e-01   +7.536019847105251e-01   +5.061491159806004e-02   +3.698410047269721e-01   +2.896573121747966e-02   +6.705945368824309e-01   -2.623437669149181e-01   -2.172814026213485e-01   +4.662123478220501e-01   -3.460845817459107e-01   +5.590856848372107e-02   -1.433634946637178e-01   -6.563703972440568e-01   +2.622985998288984e-01; -6.939844237543128e-01   +4.346675922303182e-01   -1.989775146139727e-01   -9.309409313626325e-02   -2.906066796308041e-01   -2.752139982663391e-01   +2.653311460456502e-01   +3.411808941898498e-01   -1.693648127630244e-01   -7.430841958743543e-01   -4.190293156590791e-01   +7.006407740545758e-01   -6.346105500037359e-02   +5.927731122810318e-01   -1.380774750087863e-01   +3.706513778429294e-01; -1.534319322620616e-01   -1.629919617935693e-02   -8.256815477161374e-02   +1.160850012731601e-01   -2.420765806381681e-01   +2.789001144911700e-01   -2.227001524943176e-02   +3.781501812478957e-01   +3.811237740492219e-02   +1.404362254532039e-01   -4.837508873378787e-01   +1.060636111036896e-01   -3.997912449413848e-01   +2.063682507350307e-01   -6.076733685196531e-01   -1.689280944118629e-01; +4.630068546647584e-01   -5.327226181475088e-01   -2.640531908124680e-01   +1.305564313447047e-01   +4.640390918135557e-01   -5.368883077527772e-01   +2.660662015919313e-01   +6.448994843733749e-02   +5.984482345150387e-01   +4.981913773085269e-02   -4.455449257415857e-01   +9.388257746438336e-02   +1.145394662829626e-01   +3.644896464228655e-01   +2.767582189339388e-01   +1.464439508405438e-01];
L1E_L1I_iGABA_netcon = [-3.858651284920230e-01   +1.578973620611355e-01   -4.096242245680848e-01   -1.904828503217175e-01   +4.853886635887503e-01   -7.291999688471645e-01   +8.619492148041594e-02   -5.639788884433767e-01   -3.214051494472835e-01   +4.168962162395046e-01   +3.023895880710645e-01   +1.448441704303745e-01   +3.096024784307702e-02   +2.652409585842981e-01   -1.745260749453786e-01   -5.041242702849048e-01; +4.313864114591774e-01   +5.981839023836931e-01   -5.140781990556109e-01   +4.828322443385387e-01   -4.978835997958262e-02   +1.022270665814722e-01   +6.128451530658279e-01   -2.181723682215552e-01   +6.745750984130113e-01   -2.023354035034426e-01   -1.465159018692002e-01   +5.138323865143375e-01   +7.934301937598390e-02   +2.880051670590032e-01   +4.299954025446415e-01   +1.786174355662438e-01; +8.582659286570559e-01   -6.639069700983082e-01   +2.746947986051759e-03   +5.450523187123949e-01   +3.143121921728960e-01   -1.000000000000000e+00   -1.727080144893992e-02   +3.744179158793883e-01   +9.514651748058293e-01   -2.181498019785209e-01   -3.264863296139720e-02   +2.336094568475747e-03   -5.860559972118600e-01   +1.443612222676631e-01   +6.264577169477289e-03   +1.070708984240270e-01; +4.339264301503987e-01   -3.204624440760839e-01   +3.941766783392681e-01   -8.441900298977266e-02   +3.258333419130933e-01   +5.937687828967552e-01   -2.908436142532005e-01   -4.371240163264855e-01   -7.556373078241698e-01   -1.461567799569277e-01   -4.263458569326156e-01   -4.976261204174932e-01   +4.573958724432408e-01   -1.232788368099492e-01   -2.169241866807088e-01   -3.583204364782867e-01; -6.069898750809722e-01   +2.155288042566126e-01   -7.903232491435692e-02   -3.525306710479701e-01   +6.633690623408396e-01   +3.741335781262871e-01   +6.121243006643341e-01   +3.319676861506748e-02   +5.436934186923352e-02   -8.261715224292201e-01   +6.735294508817448e-01   -4.344798441456046e-01   -3.633382600156759e-01   -6.226947446828944e-03   -3.054210031215603e-01   -6.706191723901986e-01; -4.561515298274794e-01   +2.577969229432610e-01   +1.829794506030143e-01   +4.241511013224335e-02   +5.017983737192022e-01   -2.227561291897139e-01   -4.329787109319436e-01   +7.013204917222370e-01   -4.934069156356117e-01   -1.500179713262701e-01   -6.638655115151094e-01   -7.728555531249561e-03   +3.193653553329507e-01   +9.503504270621945e-01   -5.306834256533776e-01   -2.643108625061540e-01; +9.659509953881399e-01   +3.421118912124126e-01   +9.208709186059326e-02   -9.254910939024908e-01   +2.952817195284689e-01   +1.344372255912386e-01   -3.622380195482023e-01   -1.696855121021693e-01   -5.345101200470962e-01   +3.776686275751537e-01   +1.574979240646408e-02   +3.885753805011474e-01   +6.463614720770421e-02   +5.238355788728426e-01   -2.602825610825112e-01   +1.583962171405146e-01; -8.788666123838133e-01   +2.063615393814797e-01   -1.495754431402790e-01   -4.902708605349044e-01   +3.336901904600553e-01   +3.137136553021423e-01   -5.479362249843795e-01   +6.475735482573433e-01   -2.746213899649739e-02   +3.406786279382085e-01   -9.080296416239952e-01   -1.561685169361876e-01   -3.652190989405892e-01   -9.507025884525289e-01   -5.012042445454419e-01   -3.444194510690246e-01; -2.197335802783967e-01   -2.300966190787682e-01   -1.341742342530433e-01   +8.694834072956753e-02   -3.576512005710903e-01   -4.555310589480278e-01   +4.294815445667410e-01   +5.635571939589594e-01   -1.866364295650625e-01   -3.632437200371209e-01   -2.990814897685636e-01   +5.284518407561343e-01   +7.620450627091042e-01   +4.426496397868809e-01   -1.122779378379228e-01   -1.584074047044061e-01; +4.344134183976137e-02   +7.201343180108113e-01   +9.308367295557972e-01   -1.101399185564934e-01   -5.206633996976344e-01   +2.208803231932580e-01   -2.647429688242705e-01   -2.857048397692320e-01   -2.680273329911648e-01   +2.166348247098683e-01   +8.193783703684566e-01   -5.550050193840822e-02   +2.371626925700707e-01   +5.636323237677097e-02   -6.652198909591760e-01   +1.531257592037813e-01; -3.270208434924511e-01   -4.092593356869221e-02   +1.852685799830079e-01   +1.454749509594444e-01   -9.131696931088629e-02   -1.154640949410653e-01   +8.552228709156885e-01   -5.026615663180866e-01   +5.412518898648017e-01   -8.249744713752348e-02   -2.717503934002575e-01   +4.929481814341836e-01   +8.051666551174618e-01   +5.578508766660595e-01   -2.702846923171296e-01   -5.273961248347300e-01; -3.670004307904089e-01   -8.815600502707268e-01   -5.511435129477101e-01   +1.116467825659985e-01   +6.000232789082801e-01   -2.559493442376194e-01   -5.007863522353793e-01   +5.874064619142850e-01   +4.838915834727667e-01   +6.235202848420465e-01   -3.345602485385953e-01   -1.036564017398296e-01   +6.837813068883132e-01   +2.342298936539448e-01   -2.555460351322310e-01   -7.739604277914742e-01; -5.318190713410528e-01   -2.874658428676309e-01   -3.411314786825925e-01   -4.485583711302011e-01   +5.963728871885091e-01   -2.666838396093766e-01   -3.832797245043744e-01   -6.512873164768417e-01   +5.710504895037042e-01   -1.893072554998734e-01   -2.683256785329575e-01   -6.083674324487401e-01   +4.491558896155255e-01   -1.329760178505180e-01   +8.673023133794925e-01   +5.671219797303914e-01; +9.478141777512640e-02   -5.353319106706355e-01   -1.564432632528150e-01   -6.159452567507443e-01   +1.634573911942634e-01   +2.366918586523505e-01   +6.283158611853430e-02   +2.678314150119748e-01   +2.644409756345522e-01   -1.408789515093036e-01   -9.665611946895976e-01   -2.230946887971957e-01   -2.739344787209280e-01   -1.914831849287236e-01   -2.408213148944599e-01   -6.150600234817086e-01; -5.999225546871300e-01   -2.730202767632083e-01   -1.148265344807697e-01   +4.525978005371529e-01   -4.013853370062855e-01   +6.295942963045355e-02   +2.037683634334743e-02   +4.873511513095747e-01   +8.549056566409652e-02   +5.281463219774660e-01   +3.901072171319844e-01   +8.842093396868372e-01   +1.920188431450437e-01   +1.945459077359772e-01   -1.689302163121678e-01   -2.566092520920313e-01; -3.582965183650787e-01   -1.750856287680143e-01   -6.101970871384894e-01   -5.050610004690071e-01   +3.842391049681559e-01   -1.762797094406567e-01   +7.515417870577803e-01   -4.162934351877700e-01   +6.027117169046559e-01   -5.541398439549294e-01   -5.669576157216116e-01   +6.765093958667806e-01   -2.429747846223476e-01   -6.388518916846710e-01   -5.249821819422064e-01   -4.336994585806470e-01];
L2I_L1I_iGABA_netcon = [-1.075277031999216e-01   -1.118446484318143e-01   +6.873568455849770e-02   -4.827693806968701e-01   +1.425342303682918e-02   -3.567513400007804e-01   +8.932152467239181e-02   +3.194018402573970e-01; +1.371619157526967e-01   -1.826251492067760e-01   +1.363254721419495e-01   -7.681858714286373e-01   -8.377518486115600e-02   -7.945897244626081e-01   +5.444070280217660e-01   +7.865947740953413e-01; -2.374955223090839e-01   +3.138462151351250e-01   +1.804491860851836e-01   +1.520487213792386e-01   -8.870376649187964e-01   -6.310591655979017e-01   +1.219157189087601e-01   +6.475387006084335e-03; +8.616853164057597e-02   -4.729014663556591e-01   +1.000000000000000e+00   +6.080748213687321e-01   -4.255395033079277e-01   +6.091546043319623e-01   -2.679506192607644e-01   +4.838379154956413e-01; -4.495563715478477e-01   +2.998496159133932e-01   +7.231338801762145e-01   -3.941708096437764e-01   +4.499850829401076e-01   -5.094933947103270e-01   -1.053496368427028e-01   +2.375684003143609e-01; +8.302177859037728e-01   -8.422810591476070e-02   -8.108548541904813e-01   -1.711737293869703e-01   +1.577007382920543e-02   -3.613761018550582e-01   +2.841604045571230e-02   +5.055827297341569e-02; -9.780228595761302e-01   +5.147250470803066e-01   +9.853648983644813e-01   +2.409586099185156e-01   +9.630127517632970e-01   -4.218869809967252e-01   -5.353320658771611e-01   -4.424179512053333e-02; +5.043655794102850e-01   -7.603312344352376e-01   -4.952140910503121e-01   -3.017773489612277e-01   +2.017812442359515e-01   +5.115430791528636e-01   -7.654435194127224e-01   +3.138444025396134e-01; -6.245588879468725e-02   -4.977089361521453e-01   -6.065163873212072e-01   -2.911245129199517e-01   -2.630070529158336e-01   -6.011803686697478e-01   +3.009480975395569e-01   +1.572535391434735e-01; +4.920032124626781e-01   -4.849002713193313e-01   +5.100256709228855e-01   -6.918079002529693e-01   +4.681588788279270e-01   -2.080557151078171e-01   +5.261924609868588e-01   +4.072476514077338e-02; -1.920072168269984e-01   -2.113414884737684e-01   -4.411036348515548e-01   +2.501980433385323e-01   -1.092757315084111e-01   -2.462413616610739e-01   -8.056960641284932e-01   -2.143249943439600e-01; -2.827680716751715e-01   +5.408000830457808e-01   -4.487171644702223e-01   -1.666283346602428e-01   +5.086744730630706e-01   -7.080068821778891e-01   -8.892213841990882e-01   +3.099366433827594e-01; -6.548628115575446e-01   -6.328724094666168e-01   +4.097156515922094e-01   +1.970834513747901e-03   -2.331701036617590e-01   +1.156857779414737e-01   -1.299934884400729e-01   -4.143742828971114e-02; -8.465040363357358e-02   -4.360442821363530e-01   +2.456450857141348e-01   -7.140655306056378e-01   +2.935118439888785e-01   +3.295616612096706e-01   -3.602643128370254e-01   -1.752005194235826e-01; -6.451662061464576e-01   -1.581845542534786e-01   +2.135639240548971e-01   -6.304226359778221e-01   -6.448822656266283e-01   +5.865599180037094e-01   +9.469390959407258e-01   +1.430533628798184e-01; -3.719738255807036e-01   +8.652232588009083e-01   -4.403689854068332e-01   -8.411462092637738e-02   -7.833510589215701e-01   +6.904745232996017e-01   -2.699430230331745e-01   +1.859663453520646e-01];
L1I_L2I_iGABA_netcon = [+5.502256812608309e-01   -2.013106960414106e-01   -9.864214333730700e-02   -1.334061937868479e-01   +2.626054873519887e-01   -3.772260976070750e-01   -8.200459930602043e-01   -1.166685628619709e-01   -3.799088699684446e-01   +5.563275661724711e-01   +3.414877521723047e-01   -2.141561165828704e-01   +3.146536750032362e-01   +3.505087279187860e-01   -2.700882170467095e-01   -1.018443368973971e-01; -7.299963691872648e-01   +9.614564134251049e-03   -3.377490596216246e-02   -3.402770870528328e-01   -5.615986012080381e-01   -5.878791726385388e-01   +5.593695721513838e-01   +6.168917495330789e-01   -5.773980677589681e-01   +7.849250842438030e-01   -4.435877329615083e-01   +3.919192172002403e-01   +6.076750687038950e-02   +7.000045040017593e-01   +5.652943871183751e-01   +6.173527401819562e-01; +2.947851856634739e-01   +6.526910708423136e-01   +5.501104417081458e-01   +4.810852877428297e-01   -9.770890859526618e-01   -7.891556045349004e-01   +2.043504807234305e-01   -2.597894865550769e-02   -9.280435101535369e-01   +7.005305427944317e-01   -6.229146679867341e-01   +7.813236985219658e-01   -2.833052131087938e-01   -3.121893661502984e-01   -1.214157616564616e-01   -1.657202741874498e-01; -2.106032530216997e-01   -4.678315095797221e-01   +3.283057834616556e-01   +2.043289466946237e-01   +8.300926475560062e-02   -2.942660719207859e-01   -1.245552224990452e-01   -3.658443420904687e-01   +7.753253375883896e-01   -2.302379403169055e-01   +2.279116513630827e-01   +2.370900267300471e-01   +3.649168407237235e-01   -4.530208574309774e-01   -9.744616854073694e-01   +2.072930757617313e-01; +4.892697207480214e-01   -7.049650012786511e-01   -9.187762366503126e-01   -1.813009566830008e-01   +1.269850375516781e-02   -5.792009221464197e-01   -2.827714047825828e-01   -9.724456392873075e-03   -1.687493774027430e-01   -7.168617161568394e-01   +4.703979727668330e-01   +8.025261258118925e-01   -1.422436399908390e-02   +7.715493463579065e-01   -5.082125797129620e-01   -7.276819151248376e-01; +2.860536729752668e-01   +7.044650694165008e-01   -5.073165158073552e-01   -3.932728510954763e-01   +4.356703802814759e-01   -3.602872296296524e-01   -5.462505896366370e-02   +9.132027401978607e-01   -8.530169033909775e-01   -5.349943904511197e-01   +6.236528406885384e-01   -1.327896457499976e-01   -5.673881992441837e-01   -3.059830743558812e-01   -1.155641315885070e-01   -9.151747860593244e-02; +1.034152058664946e-01   -5.950124935847864e-02   +1.379223348045188e-01   -1.691663606648831e-01   -3.331480280756823e-01   +2.869756233207891e-01   -4.996560260600681e-01   -1.810332061975148e-01   +4.742273637193375e-01   +1.914280929552132e-01   +2.330091668469293e-01   +6.941566706426108e-01   -7.395816348692563e-02   -5.767709562823367e-01   +1.313863386057160e-01   -1.000000000000000e+00; +8.765662370263850e-03   +2.314072847361344e-01   -2.916121838388753e-01   +5.773183420670842e-01   +6.541280620297965e-01   -3.366061959712146e-02   -2.520634377849285e-01   +6.762220796956288e-02   -6.369792993129333e-01   -2.892686338017806e-01   -5.906647332908199e-01   +2.584074623228947e-01   -2.798110204748558e-01   +1.965635056084260e-01   +7.918038488961242e-01   -7.481381288182316e-01];
L2E_L1E_iAMPA_netcon = [+4.581196114274552e-01   -6.225555448924609e-01   +4.223225271975066e-01   -1.440969541742655e-01   +5.010260381453172e-01   -3.413307775818405e-01   +3.905028347894032e-01   +2.574393930344905e-01; -3.455648760721711e-01   -5.272901654159113e-01   -7.061796457159509e-01   +1.876047082059875e-01   -5.872475757690301e-02   -6.532360492047578e-01   +7.285022132281141e-01   -5.327213604272408e-01; +2.728776615481549e-01   +7.539521827390198e-01   +7.467864833317106e-02   +1.899442044691238e-01   -4.885418935663874e-01   +5.320434164401970e-01   +2.131406760690423e-01   -2.007020197671785e-01; -7.374199777514019e-01   +7.135432476142304e-01   -2.477128412852409e-02   -3.539853081841126e-01   -1.470297911169090e-01   -2.708519996166850e-01   +7.340463051566041e-01   +7.284611247202215e-01; +4.164965603354909e-01   -1.727013702708281e-01   -1.868169259302737e-01   -4.507446450704659e-03   -3.881051396473598e-01   -3.827295642709790e-01   +1.078161470017366e-01   -3.829057036971746e-01; +4.373216411699027e-01   -7.462163809152578e-01   -5.003715956911382e-01   -7.371808935647864e-02   -5.281864184341577e-01   -7.225796515363224e-02   +8.745084061895927e-01   -7.505463997100014e-01; -5.086383320211855e-01   +9.589209071352706e-02   -3.666339188517116e-01   -2.912401047159991e-01   +4.575739842162897e-01   -1.062562781129235e-01   +2.017441237718071e-01   +8.797165077281434e-01; -1.147640592545245e-01   -3.717316643170505e-01   +4.131671644284189e-01   +5.601114589246630e-02   +9.966627016417212e-01   -3.527059738298313e-01   -6.364741954839477e-01   -6.590801655289967e-02; +8.647919433832852e-01   +5.181365599152136e-01   -9.266425881346522e-03   +2.343670508184805e-01   +4.981361256493628e-01   +7.208438121363564e-01   +5.744457100685361e-01   -1.158101825465625e-01; +5.771749173418795e-01   +2.329469185838249e-01   -2.395102730440109e-01   -2.198959007195032e-01   +2.218103912850317e-01   -6.822482865845142e-01   -3.227618255056593e-01   +1.431100832645003e-01; +4.106923741860574e-01   -4.341873735610269e-01   +1.763525354194599e-01   +6.371199907036743e-01   -5.776121135029652e-01   +3.300893288395384e-01   +6.687544488997057e-01   -4.263615173685462e-01; +2.588417298408288e-01   +2.393225968993447e-01   -2.781473010237702e-01   +1.191515861250778e-02   -4.484221023148567e-01   +6.990234979886261e-01   -7.357542155341238e-01   -7.257279738797001e-02; +7.745519704751146e-01   +1.618006294053038e-01   +9.503023062661009e-01   -3.559444051874495e-01   +3.599917701539186e-01   +5.388311519585399e-01   -8.734606000322714e-01   +2.615170279065812e-01; -7.826490614319137e-01   -1.453317766736593e-01   -2.893203722697480e-01   -1.785603769429659e-01   +3.182752462402313e-01   +2.034130327032548e-01   +6.280635476664113e-01   -4.583773156562604e-02; +7.238160424696127e-01   -9.224392062791772e-01   +8.666628890110251e-02   -7.908001643360595e-01   +1.896466561122424e-01   -8.824536664616008e-02   +5.902407790900813e-01   -1.713674891872499e-01; +4.896151899712866e-01   +6.159043514364011e-01   -1.000000000000000e+00   +2.405730837385830e-01   -3.096299715658994e-01   +3.312174370404180e-01   -2.495437490125214e-01   +1.946792807880684e-01];
L1E_L2E_iAMPA_netcon = [+5.787600843558005e-01   +8.341638762866613e-01   -7.516069955668975e-01   +6.709362429555841e-01   -6.029090388660541e-02   +7.469447928173171e-01   +3.904654122763793e-01   +5.891957422792276e-01   -1.735282443742903e-01   -5.497290902221971e-01   -5.063330286407535e-01   +4.507923143889525e-01   -8.984297630010947e-03   -4.366846086079003e-01   -6.769031833895682e-01   -6.671446767388013e-03; -4.293132302944145e-01   +6.468932566290405e-01   -3.014208877751566e-01   -1.865814972644103e-01   +5.237000594579961e-01   -1.099681541538396e-01   -3.349328493269069e-02   -2.749288952343648e-01   -3.611440895561590e-01   +2.923958542070173e-01   +3.222018744609285e-01   +7.363132591189592e-01   +2.824239824298044e-01   +1.972987351879756e-01   +5.106183725662815e-01   -3.499991252462815e-01; +2.387643689187822e-01   +3.783917728985221e-01   -5.324459056299730e-02   -9.468277607234503e-01   -3.982871807430573e-01   +4.495491305777461e-01   -6.386609429634714e-01   +5.451071612727216e-01   +1.000000000000000e+00   +6.477239620315126e-01   +1.160443252705021e-01   +4.656506362289075e-01   +3.473882449300011e-01   -4.671963948423504e-01   -7.391673147044222e-01   -3.021021564963620e-01; -2.777502008886250e-01   -4.138601670152494e-01   +9.555294979808622e-02   -4.168127856842122e-01   -2.387156815184817e-01   +3.835871854156359e-02   +1.817053789215097e-03   +5.175823100212907e-01   -2.549693812339631e-01   -4.058575454677386e-01   +3.026371683322168e-01   +5.054836959474702e-01   -5.622892953177191e-01   -3.270824110211738e-01   -2.260529354255085e-02   -8.799726439792214e-01; -2.348925026455648e-01   +1.279265782292750e-01   -4.726163990514640e-01   +3.380936521118610e-01   -3.072197308183927e-01   +6.673093698149690e-01   +3.214224857146373e-01   +2.037097803896401e-02   -6.138114952063662e-01   +2.051209405585480e-01   +3.841680786559637e-01   +3.159838068069744e-01   +1.852602535643335e-01   -1.780689212665308e-01   -1.928211995450216e-01   -5.978988886737315e-01; +4.165772910293095e-01   -3.835013999544981e-01   -2.564222660997018e-01   +1.082376010127863e-01   -1.431966229415972e-01   -3.685747288610765e-01   -5.513563766154436e-01   +4.366144774117039e-01   -4.262098723597249e-02   -2.270871580181878e-01   +1.398767437461820e-01   +7.220424562393855e-01   +4.279147673987424e-01   -8.247004146779304e-01   +3.290950445226589e-01   +1.176828818129795e-01; -4.636268625219414e-01   +5.609490835309019e-01   +5.111983787766069e-01   +5.342260753650977e-01   -3.460053361211647e-01   +5.188559868058309e-01   +4.463568330942303e-01   +2.283064406629798e-01   +4.538103258475845e-01   +1.879352408916198e-01   -2.782042545989326e-01   +1.469189906002503e-01   +2.931781485951226e-01   +3.983766528242868e-01   +1.651567707199185e-01   -1.671576981169801e-01; -3.035607020027236e-01   +5.829762512482540e-01   +2.897974512744657e-01   +2.233078472200128e-01   +5.040321834952963e-01   -6.242281937997775e-01   +4.937721414554517e-01   -5.993991689805596e-02   +8.138546656147221e-01   +2.127339836469271e-01   +3.456122982539019e-02   -2.141465849077326e-01   +1.394819417260534e-01   -9.863182843296166e-02   +1.667247984590311e-01   -2.352923417640964e-01];
L2I_L2E_iAMPA_netcon = [-7.139303103056623e-01   -2.562283200762823e-01   -8.757917151618405e-01   +1.194888747392914e-01   -3.518696877883241e-01   +1.933798838040628e-01   +6.568107490979249e-01   +1.319616359744427e-01; +1.253389974006782e-01   -1.438450833124064e-01   -3.661220633383385e-01   +6.529001514115885e-01   +3.965085767484536e-01   +4.325321147117036e-01   -2.002657118246366e-02   -1.942200532477741e-01; -9.804190874417956e-01   -4.649785519906605e-01   -1.207357776141400e-01   -9.796150754426070e-02   +2.935662098363129e-02   -3.008731855716237e-03   -2.276696768958781e-01   -4.013507556776289e-01; +5.760411482491432e-01   +2.882104788266276e-01   +8.920644536026560e-02   +3.447081815472859e-01   -2.730238446843345e-01   +4.607030424123826e-01   -2.359774125037026e-01   -3.280735886553556e-01; -5.607278764565654e-01   -5.949164197516458e-02   +3.933756572674440e-01   -2.078232304480858e-02   -9.143982311228342e-01   -4.926920603801777e-02   -6.818105216167010e-02   -1.066389191083376e-01; -1.794409726416059e-01   -4.123855993965443e-01   -4.513806999040491e-01   +1.628415222602902e-01   -2.330731548929955e-01   -7.250494250654613e-01   -3.268397998742055e-01   +6.139332874655567e-02; -2.887548143263181e-02   +5.300854329198123e-03   -5.021703628103877e-01   +6.346545921078847e-01   +3.177710578908896e-01   +4.487157529816070e-01   -4.206514989388831e-01   -8.165419055835869e-01; -1.192848501611509e-01   -6.274923644964384e-01   +5.570968482731193e-01   +2.634860541048855e-01   +1.000000000000000e+00   -9.622581503644781e-02   +4.279497424891036e-01   +2.425751682640159e-01];
L2E_L2I_iGABA_netcon = [+1.000000000000000e+00   -4.905541643977085e-01   -6.423661391806412e-01   -6.432289275300660e-01   -1.762750756316988e-02   -1.546428163174439e-01   -4.727765468738237e-01   -4.062940116183397e-01; +1.640060098242314e-01   +4.881957700075681e-01   +6.974155571525014e-01   +6.465154933723035e-01   +6.485468447607720e-01   -5.893564125012208e-01   -5.491388531809972e-01   +3.501955392074108e-01; -5.598811397705621e-01   +2.441059454852612e-01   +7.122497622529460e-01   -2.660558608034146e-01   +1.045393616261353e-01   -5.968987885134919e-02   +3.230014951536775e-01   +3.281884554222995e-02; +4.162406307157880e-01   +2.586020885248124e-01   -1.847152699378734e-02   -5.204033307473578e-01   +6.475392241579867e-01   -9.178010773438201e-01   +5.201544405030252e-01   +5.546752994987616e-01; -3.874939603396171e-01   -4.980266723565836e-01   -7.285933814307102e-01   -4.821079718253244e-01   -6.090009056087567e-01   -6.299574109292575e-01   +6.739576025771145e-01   +3.397200789276134e-01; +1.884410851322226e-01   -2.253519111445824e-01   +5.142056477358862e-01   -4.052542853138978e-01   +3.543493473145322e-01   +1.746626243063262e-01   +3.449919573170694e-01   -1.565582466206032e-02; -4.002342635422383e-01   +2.402009213513716e-03   -5.129275059603915e-01   +2.889709033488161e-01   -5.101825425959768e-03   -1.902285221830066e-01   +3.091347007707632e-01   -6.114053104056260e-01; -5.133157843767189e-01   +6.023945036531122e-01   +3.004103119927349e-01   +3.711927080033364e-01   -2.965370089772600e-01   -5.046493554241740e-01   -2.564026541592477e-01   +3.589809422123682e-01];
L3E_L2E_iAMPA_netcon = [+5.402872886525485e-01   -2.135179998060517e-01   -1.573789916993619e-01   +1.604468144770874e-01   +1.000000000000000e+00   -5.062326349951174e-01   -6.700853106692150e-01   -2.916241884029531e-02   +9.450699781190889e-01   -4.826651080175558e-01   -2.107225754024513e-01   +7.996232142629689e-02; +6.546938842021480e-01   -4.643621670106063e-01   -3.788846962737778e-01   -1.809370553004888e-01   -7.742541259564171e-01   +2.006979265682622e-01   +1.023623168351961e-01   +2.560645620214949e-01   +4.748327446531229e-01   -3.101312543420965e-01   -7.312985776191561e-01   -3.803562173302282e-01; +1.966035242815125e-01   -2.974304890934666e-01   -7.567968065764472e-01   +7.038365784928526e-01   -3.402738664738334e-01   +1.535773080255086e-01   +1.211470520426103e-01   +9.829353652557278e-01   +1.859237963730778e-01   -7.561696931413437e-01   -3.086892868792722e-01   +2.932167168593712e-01; +1.894233984096656e-01   +2.570167551363499e-01   +2.930430491987014e-01   -4.823954944286216e-01   +8.421083714318189e-01   +1.972510739134809e-01   -4.793379380329957e-01   -8.028340513619809e-01   +1.260865997991721e-01   -5.577428187838399e-01   -1.271450212951499e-01   +1.139543093198701e-01; -2.724110385601906e-01   -3.990418795056528e-01   +2.744919025041731e-01   +1.000607916155491e-01   +8.091362733855235e-01   -1.460786330786665e-01   +1.560092979055956e-01   -1.289943884699418e-01   -6.967210467405949e-02   -5.085900262963267e-01   +2.498847735887879e-01   +6.469414807225440e-01; +3.698561948250159e-01   -7.329439836275738e-01   -6.523539999469029e-01   +8.780589873346833e-01   +2.281780531086838e-01   -6.882058622977927e-01   +9.570598611993846e-01   -9.158140685059248e-02   -1.709804895457370e-01   +7.176048626569020e-01   -2.881739406211624e-01   +3.513919625863845e-01; +1.685474673645216e-01   +9.567467395743531e-01   +5.499267314791007e-01   -6.859119551282601e-02   +1.346354919175157e-01   -8.043048808635409e-01   +4.667378241082578e-02   +3.976885407638936e-01   +3.559342937287789e-01   +6.121557156546868e-02   -1.417488567684207e-01   +2.841205648587977e-01; -6.898708330048170e-01   -1.922264687177093e-01   +5.276186102666583e-01   -7.292420670186864e-02   +3.221697023394900e-01   -9.261294024683573e-01   +5.237656483385517e-01   +1.727673765577626e-01   +3.505756971634033e-01   +5.524519661893618e-01   +8.148761366813929e-02   -4.457719673513725e-01];
L3I_L2I_iGABA_netcon = [+6.749561328141288e-01   -1.708244653927148e-01   -2.531243676945121e-01   +1.939266919784386e-02   -3.506393382934652e-01   -1.000000000000000e+00   +4.801260453170488e-01   -5.750567193511935e-01   -7.941289561189365e-01   +1.349557763257731e-01   -2.197641432423235e-01   +3.118254578150734e-01; -4.457857696332587e-01   -1.206551491828840e-01   +4.396007523493740e-01   +3.542883031060496e-01   -5.154347418117300e-01   -5.516460272745410e-01   +5.106332477886395e-01   -2.313118880536598e-02   +2.409266766299439e-01   -5.125836039380618e-01   -7.066816873808132e-01   +2.656998698376986e-01; +2.618928086827856e-01   +2.191211705369778e-01   -1.598585748695874e-01   -1.900225990792835e-01   -1.355096103651542e-01   +9.483848153638426e-02   -4.930991430320806e-01   +6.398134295155775e-01   -1.902406803504058e-01   +3.045159097850073e-01   +1.733211964626860e-01   +4.693422454388217e-01; -8.916026540949223e-01   +4.925580389373403e-01   +1.626389665870469e-01   -5.658103580439576e-01   +5.174454916781092e-01   -2.882500883508682e-01   +4.799996242565250e-02   -6.255813218291294e-01   +3.444428859501634e-01   -7.766302498079269e-01   +4.134694718848369e-01   -1.236184066924774e-01; -4.336695008841669e-01   -4.961352676053311e-02   -2.883360240814383e-01   -8.857775391516544e-02   +6.062173865715844e-01   -3.371032247732770e-01   +6.576551543996223e-03   +1.153573209331735e-01   +3.176487448882483e-01   -4.986494169833681e-01   +4.056897460207016e-01   +2.762213617855026e-01; +3.553530220016775e-01   -4.924412029222621e-01   -2.377264536550847e-01   -2.981780470147546e-01   -5.315294874431317e-01   +4.556227479797412e-01   -3.504604485400882e-01   +1.968368048352498e-01   +4.028724771156101e-01   +2.545545744796059e-01   -2.016305982802512e-01   +8.887992097030403e-01; +1.399206638586240e-01   -4.595865649137937e-01   -1.380541842455673e-01   +2.789005693059633e-01   -8.832407537260663e-02   +2.215081981725589e-01   -5.786770398402229e-01   +2.075775810329082e-01   +6.604162287808205e-01   -5.990610510880885e-01   -7.247754794463757e-01   +2.064845219275487e-01; +7.537242708928021e-02   +2.721737579749870e-01   -6.779982267244191e-01   +4.623619754910085e-03   -3.239785180472678e-01   +1.010756524874283e-01   +7.170036964502744e-01   +7.403614642826591e-01   -6.558729262279416e-01   +2.225162185368602e-01   -2.639598520697518e-01   -4.813920653698330e-01];
L2E_L3E_iAMPA_netcon = [+1.461440585146002e-01   +1.851771027101948e-01   -2.632997980023219e-01   +8.103543112574003e-01   -1.428218507773207e-01   +2.040469421947068e-01   -2.332627074615976e-01   +6.721209609791232e-01; -1.272040126709105e-01   -2.433088364130700e-01   +1.968226672643461e-01   -7.855269529044751e-01   +2.462779661206164e-02   -8.140996117925107e-01   +2.080261511995816e-01   -6.407518755203185e-01; -3.802670921152020e-01   +7.146186345683395e-02   -4.219822905936372e-01   -7.353852286968525e-02   -4.605446866901605e-01   -6.236036446874893e-01   -3.132523303261286e-01   -4.361901957635662e-01; +5.146989108272090e-01   -4.478469376385176e-01   +1.000000000000000e+00   -1.006917603087971e-01   +3.091244433375723e-01   +6.294760792364451e-01   +3.593328991520016e-01   +4.605130408356818e-02; +1.919010572128892e-01   +4.397522223738961e-01   +2.527764460835342e-01   +2.245452394313398e-02   +4.742705489985416e-02   +3.551466879983707e-01   +3.005793179034646e-02   +2.241918716344832e-01; -3.245568260960141e-01   +4.309303121103283e-01   +5.955871778930162e-01   +4.421080571383658e-01   -7.713510311007659e-01   +3.574975434891418e-01   -5.504248119628032e-01   -1.898554193429245e-01; +4.301938725013174e-01   -6.098531300822803e-01   -2.900969760818101e-01   -4.142442062331596e-01   -3.982735385606995e-01   -7.042102214042211e-01   -8.823621771874994e-01   -4.421649923439324e-01; +5.782796144047226e-01   +3.748152186127301e-01   -5.216684685936508e-01   +6.477738170826113e-01   -6.035310442126602e-01   +2.390912910638097e-01   +4.097416630598664e-01   +1.946748475018175e-01; -3.148601268643972e-01   -7.760074190453142e-01   +6.699155561166747e-01   +4.887120162914388e-01   +3.456884082850535e-01   +1.910492995435206e-01   +1.208816026175733e-01   -4.912780576893984e-01; -5.608391485762656e-01   +2.041226075592395e-01   -6.731167947325527e-01   -7.279673228599205e-02   -8.631601997868170e-01   +2.662157426762816e-01   +4.366123498008383e-02   -2.256690099122542e-01; -6.307809644813770e-01   -1.453659071278991e-01   -4.727369911770739e-01   -2.284400898722802e-01   +5.412299843501638e-01   -4.939247705918983e-01   -2.592747535124300e-01   -3.575807858955213e-01; -2.648664452721120e-01   +4.604130460368036e-01   -3.183597279979366e-02   +8.114790515351140e-01   -1.817852633363826e-01   +2.020021056422908e-01   -1.255402615223327e-01   +5.294412157723932e-01];
L2I_L3I_iGABA_netcon = [-4.970930499370831e-01   +7.152058957885711e-01   -2.339607328748960e-02   -4.841470430002074e-01   +2.503362607604958e-01   +8.154443356470639e-01   -1.618955653207336e-01   -5.121798507187409e-01; -2.221962510140705e-01   +6.971602440453142e-01   +2.619273083215911e-01   -1.333763809562832e-01   +2.056920297508068e-01   -2.017669738076406e-01   -3.599372114385654e-01   +3.671533631245658e-01; -5.294029090089510e-01   -8.892901581513559e-01   -1.868274754249299e-01   +4.930491937815138e-01   +6.032452758580281e-01   +4.519825575587766e-01   -6.565952772544577e-01   -5.285809056908874e-01; -1.570761640373596e-01   +1.307721852346560e-01   +3.203143490572420e-01   +4.548564488701269e-01   +3.990207635544666e-02   +7.247134541024285e-02   +5.375253494385811e-01   +1.329795738699014e-01; -2.786841203993719e-01   +2.192569868659666e-01   -5.224696806118870e-01   -2.737051979532780e-01   +4.127841023170878e-01   -4.201733108512987e-01   -7.053932341972631e-01   -5.988911863630120e-01; -6.696347254044797e-01   +3.575022282463364e-01   -1.000000000000000e+00   -3.084401124595774e-01   +8.817861150699133e-01   +5.510414811090524e-01   -3.360127792498985e-01   +1.450212758833664e-01; +9.774528630072900e-02   -3.243744092788074e-02   -1.685272534709336e-02   -2.082688075425862e-01   +4.881924993990438e-01   +1.636793255393628e-01   +7.217611588876108e-01   +9.154286748315855e-01; -3.634958175450974e-01   -9.122544872426480e-02   -3.796958163903421e-01   +7.077934649700961e-01   +2.345234338600101e-01   -8.221697420361634e-01   +1.898523860931926e-01   +1.785501702766970e-01; -5.286244525346919e-01   +8.437897739910105e-01   +4.148652677262817e-01   +7.479192027382127e-01   +7.208400783692984e-01   -7.114531039351202e-01   +2.922108084481876e-01   -3.604915710637652e-01; -5.586294922020704e-01   -2.182746777463688e-01   +4.510436706386430e-01   -1.584519332089506e-01   +2.050816046524506e-01   -8.382556756176103e-01   -8.132421940558573e-01   -3.182717751576628e-01; +6.741729071368596e-02   -3.449633181910449e-01   +3.602642516822738e-01   -8.025034635893287e-02   +9.291781927009733e-01   +2.703667658865752e-01   -2.067900177463955e-01   +2.982693363168834e-01; -5.728698146595017e-01   -1.151423194428062e-01   +2.791311043698070e-01   -4.815138949927855e-01   -5.161892974351053e-01   +1.967380668797994e-01   -7.688372503758921e-01   +3.504030915968739e-01];
L3I_L3E_iAMPA_netcon = [+1.700684150791186e-01   +7.096660634130080e-01   -7.575176927419566e-01   -6.742821971103951e-01   +2.911300929483936e-01   +3.094123269056477e-01   -8.384809513896953e-01   +1.713094912685659e-01   -1.653085290718402e-01   -1.943386299224723e-01   -2.164670219201697e-01   +7.241152436857970e-01; +5.220161780114383e-01   +5.489380016361023e-01   +7.184929954626634e-01   -2.064351012512193e-02   +1.845110782786442e-01   -1.791835290265701e-01   +6.261037583070496e-01   -1.228520245558301e-01   -1.582013380317276e-01   -7.072060850675127e-02   -5.610256638283714e-02   -1.475370775839230e-03; +3.647540475457666e-01   -3.636114328163264e-02   -1.436771866303638e-02   +6.890444601145551e-01   +3.122947830939633e-01   +8.494551906397083e-01   -4.370721089772543e-01   -4.492715393019078e-01   +6.337218314057228e-01   +2.438974221572797e-01   +1.193037430220459e-01   -3.803923127053376e-01; +4.365486029270652e-01   +7.852973761017995e-01   +7.110681796209118e-01   -7.687112056062250e-01   -2.589266897801945e-01   +4.447537366623310e-01   -3.879727446086877e-01   +9.307251741468147e-01   +2.357582484362503e-01   +2.163200628748604e-01   +1.216598747048588e-01   -2.588442166041937e-01; -1.539849197830754e-01   -9.168978427064889e-01   +4.931136117471580e-01   +8.457088150397042e-01   +3.160250334210942e-01   +3.777568891978321e-01   -3.778093243536072e-02   -7.346893788348188e-01   -6.736405253340749e-02   -9.625994938039952e-01   -6.542337669879124e-02   +5.503264563215879e-01; +2.505331674600828e-01   -3.219377340157801e-01   +4.512623711111907e-01   +2.011541245381906e-01   +2.590714448040670e-01   -7.559940883746853e-01   -6.785016551503578e-01   +4.217061537634558e-01   -1.351365274480871e-01   -5.804396088975428e-01   +7.630684336039218e-01   -5.475750060549226e-01; +7.451450808299080e-01   +3.105347523478725e-02   +7.648554169374995e-01   -4.625903097994504e-01   +3.713119861822338e-01   +1.378158628867877e-01   +3.147132102756197e-01   +7.796977329290402e-01   +5.455553523652368e-01   +6.925238480333628e-01   -5.179320659505907e-01   -7.761769152676105e-01; -8.464564871813493e-02   +1.881318025311495e-01   +1.034355403067678e-01   +3.304674178828678e-01   +1.867374543658601e-01   +4.683638594530444e-01   -4.624960521262265e-01   -4.731650405351409e-01   -5.490064241660295e-01   -4.512633237731665e-01   +3.781319031454493e-01   -5.368059823862468e-01; +6.647965888942302e-01   +2.526740585472316e-01   -4.423026075172362e-01   +2.298799448958317e-03   -1.353316536925737e-01   +1.000000000000000e+00   +1.749431116415796e-01   -1.595873815939559e-01   -4.198060109104883e-01   +7.015552313593503e-01   -2.335123426045398e-01   -2.899329783262821e-01; +4.928770673410628e-01   -3.046676420686035e-01   -5.313169681041965e-02   -5.540947046744542e-01   -4.679303871545816e-01   -2.416581942574424e-01   -4.136604732575870e-01   +4.565754191637143e-01   -6.613070188777601e-01   +4.871788686436829e-01   -6.292252800759536e-01   +5.836866585381172e-01; -3.791729813969850e-01   -2.164336526841628e-01   -1.581973432393092e-01   -6.814043082595376e-01   -1.136427243327300e-01   +4.534818813098037e-01   -4.505321314745114e-01   +8.190191361841398e-01   +5.526923998239217e-01   -5.547437223989720e-01   -2.474180872653036e-01   -4.531321903323291e-01; -4.110050401367289e-01   -2.070210546252238e-02   -5.957268162959526e-01   -5.225083033376581e-01   -7.481736094485937e-02   -5.656881995142135e-01   -9.804358945011552e-01   -3.029788815439836e-01   -4.268872188474968e-02   -4.234290255129729e-01   +7.537855486026325e-01   -2.899534505389768e-01];
L3E_L3I_iGABA_netcon = [-8.496156743736900e-02   -7.931399746099344e-02   -2.599848417142047e-01   -5.524686340961826e-01   -4.447349851720255e-01   +4.511792912191461e-01   -4.783338857469519e-01   -2.498062387135009e-01   -4.027660119631559e-01   +3.195621121398654e-01   -3.814478909512915e-01   +6.673920781878376e-01; -2.367763569590704e-01   -3.628194162164969e-02   -3.828214281862359e-01   -9.855672715850052e-02   +3.276261232745499e-01   -6.759075571207623e-02   +4.872849813659390e-01   +2.258482241278073e-01   -3.341347664442986e-01   +3.163124887916635e-01   +8.373335536853377e-02   -6.082460380496051e-01; -6.101515114363733e-01   +3.242611669671093e-01   +6.479668671180544e-01   -3.449934923130545e-01   -1.584923685557701e-02   +1.256508534153585e-01   -3.798275218765834e-01   +7.655949910173971e-01   -1.308665656209640e-01   +1.544245258127545e-01   -7.290417845864260e-01   +6.039929476682768e-01; -3.334133666072204e-01   -3.833786291842536e-01   -1.522302083278336e-01   -2.981544544969239e-01   -4.501268253238963e-01   +2.079639628767783e-01   +3.986996429015979e-01   +7.564688917369676e-01   -3.775256439351721e-01   +3.467046025125548e-01   +5.055849465121002e-01   +2.053186959710790e-01; -4.930551425079863e-01   +2.649113775248536e-01   +4.196264493766032e-01   +4.760469130096960e-01   +3.024118771837884e-01   +3.411119964767245e-02   +2.579548526701673e-01   +1.012094163899897e-01   +7.445401435104466e-01   +2.432490758787150e-01   -2.634077082869538e-01   -5.988862197673090e-01; +1.361452790937328e-01   +6.359767474991237e-01   +3.646605253346702e-01   +3.376371553770965e-01   +5.392104589234755e-02   -1.532067642307067e-01   -5.460571138992965e-01   +7.484428426816400e-01   -3.064462156171752e-01   -3.797029852928298e-01   +2.922993244177838e-01   +3.848468391394760e-01; +2.583826645534015e-01   -1.904539259456388e-01   +2.100523692691404e-01   +3.108891640636646e-01   +2.981157555861348e-01   +3.303396195188000e-01   -3.459855040345919e-01   +6.263315946637852e-01   +3.711176363000500e-01   -8.418949013431875e-01   -8.541298291427900e-01   +6.984443301249945e-01; -4.045349421304615e-01   -3.559045029108371e-01   +2.517025940611142e-01   -5.864133841879271e-01   -2.858324247214001e-01   +1.309084961812072e-01   -1.485638084154260e-01   +2.220928642476301e-01   -2.846735198642527e-01   -7.157179771910759e-01   +6.707931285529852e-01   +4.641383903665612e-02; -1.339682829568113e-01   +3.327523945086386e-01   +3.961901752615301e-01   -2.567898136372713e-01   +5.538513023780398e-01   -5.384106088212676e-02   -3.762768890518326e-01   -4.757647057525321e-02   -2.887903573759190e-01   +4.010738194046059e-01   +5.145344544842713e-01   -4.684904786958199e-01; -5.674360915474459e-02   +5.629168968645555e-01   -3.792385317857874e-02   -8.974447230448716e-01   +6.380239210011635e-01   -1.204830824646934e-01   +3.488858803116974e-01   -3.172789484153916e-01   +1.297948690507078e-01   -2.080446389499705e-01   -3.727285347317242e-01   +6.214574221771482e-01; +5.077467738736358e-02   -6.100032966464011e-01   -7.022120682929582e-01   -3.296775636740373e-02   +3.324982983720847e-01   -3.930481564989728e-02   -7.735064426547836e-01   -2.759052720427323e-02   +3.151969261508561e-01   +7.522363357581211e-01   +1.000000000000000e+00   +3.581838393368560e-01; +7.736447775849272e-03   +6.050115321256293e-01   +6.287356081614582e-01   +5.587829419349110e-01   -5.022261682844542e-01   +1.022614881061842e-01   -5.813887211907750e-01   -5.862151025328244e-02   +6.325117350097860e-01   -4.116948814250423e-02   +5.259435423843063e-01   +2.438032181027028e-01];
L2E_Input1_iAMPA_netcon = [-2.090323338642347e-02   +2.529423020218672e-01   +2.201773669691300e-01   -3.591914827391647e-01   -7.918722686243861e-01   -8.432864446507418e-02   -4.755789933884917e-01   +4.703489753917254e-01];
L2I_Input2_iAMPA_netcon = [-3.671735962558867e-01   -4.743852083009622e-02   +7.323799093239633e-02   +7.523623405522614e-01   +7.185929857867068e-01   +3.287790206099048e-01   -3.210312749804431e-01   -9.488674511842354e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
