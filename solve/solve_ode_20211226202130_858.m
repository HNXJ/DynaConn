function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.955873118840439e-01   +2.507162790130741e-01   +3.563045763770764e-01   -2.280970816816430e-01   +4.419990289799472e-02   -3.721894714811035e-01   +2.627688780742029e-01   -2.663743802373850e-01   +1.560229516160132e-02   +3.909849562246371e-01   -2.950390104525034e-02   -4.288616462971949e-02   +2.066900089084130e-01   -8.464948764739494e-03   +6.940510366719757e-02   +8.850826263308897e-02; -1.192523864777933e-01   +3.721492748580489e-02   -2.003839416480137e-01   -2.749368775297009e-02   +8.681606127179249e-02   -4.191359610838769e-01   +8.561112235089155e-02   -1.612262921294327e-02   +1.599003776706015e-01   -2.420069492124849e-01   +1.097158757094803e-01   +1.399663023165136e-01   -5.903724065577860e-01   -3.113019854040360e-01   +1.088788865696272e-01   +1.435750699019420e-01; -3.586180591051534e-02   +9.802090778834981e-02   -3.144145138806926e-01   +3.317798604346918e-01   +3.110311480257630e-01   -7.999728963736180e-02   +8.595177132588838e-02   -2.181101350745215e-01   +1.289815299091847e-01   -1.351522176901206e-01   +2.233942035181243e-01   -1.219013222562237e-01   -1.277028573753081e-02   -5.025109807932340e-02   -1.501395177064224e-01   +2.576082095416622e-01; -1.534709611690677e-01   +2.608801939372211e-01   +1.899235261741013e-02   -1.936400405768590e-02   -2.002188385567983e-01   +1.177751373799331e-01   +1.686839656407350e-01   -1.681880485852195e-02   -1.365764223462559e-01   -5.259563634674556e-01   +2.856565356016684e-01   +1.838907645875953e-01   -2.517923615962273e-01   +2.668097892776550e-01   -6.050234780283617e-03   +5.649610862812199e-02; -1.577472047324107e-01   +4.762257613202170e-02   +1.314734013816632e-01   -2.573688930500437e-01   +9.679046745945762e-02   -3.671879892520577e-02   +2.704948407506501e-01   +6.607779003885708e-02   -7.626469465506670e-02   -1.709752167844384e-01   +2.654198322512721e-01   -1.527044418570355e-01   +5.083548834226789e-02   +1.599644166425622e-01   -3.156506506398272e-01   -1.067546718410484e-01; +1.639145432944286e-01   -3.967246474885815e-01   +7.172172501500761e-02   +1.379594792700042e-01   +5.088582059747235e-02   +1.799033978007063e-01   -1.254031068945234e-01   +1.556151479252277e-01   +4.532929980533519e-01   -5.301800827391123e-04   -4.768280373353110e-02   +1.775622768072024e-01   +5.134510174598919e-02   +3.846747388150914e-01   -2.038609646197698e-01   -1.241527582092295e-01; +2.247254489324760e-01   +1.022274429648122e-01   -1.468881604612145e-01   +1.357341925295966e-01   +1.189137241356051e-01   +1.972594909910284e-01   -2.365296342053262e-01   -4.051735662379325e-01   -1.572924654130095e-02   -2.199371164662981e-01   +9.652309584772027e-02   -3.574106995095426e-02   +1.815272799647251e-01   -1.911496120763511e-01   -2.864196841231074e-01   +2.033036482116552e-01; -1.393793070825290e-01   +5.280806585309907e-01   +1.592802128350765e-02   -3.257460804420071e-01   +1.131085561380279e-02   +1.866730929384125e-01   -1.667740476378164e-01   -1.812228950761092e-01   -2.683388934459618e-01   +3.724729064835279e-03   -5.062941414811063e-02   +4.713714840686721e-02   +6.345836459638043e-03   -2.854143763986146e-01   +2.058999290298631e-02   +2.903799863172759e-01; +1.827215868993721e-01   -2.351890935273676e-01   -8.370992641295275e-03   +3.651551060006343e-02   +5.577229331627932e-02   +5.232292916229085e-02   +3.540161558452179e-01   +1.737141063265142e-02   +1.215868087785962e-02   -1.206334016452479e-01   +4.996784455114335e-02   +1.245871524146239e-01   +1.726702741830068e-01   -1.880850270688470e-01   +9.889193563376904e-02   -9.094778121279290e-03; -1.231325806336945e-01   +3.406177545453991e-01   +4.687193490384898e-01   +7.837937977143852e-02   -1.337832711951099e-01   -6.023236091590286e-01   +2.397332972810260e-01   +2.078901645920384e-01   +4.029851853000030e-01   +1.146108384959249e-01   +5.516625738667166e-01   -3.405890131285388e-02   -2.355315951590100e-01   +1.498955411300957e-01   -3.716724688381670e-02   -1.298395408808214e-01; -2.747391708120679e-01   -4.025692479867169e-01   -3.171307772968440e-01   +1.731195226045496e-01   +3.776649291119832e-02   -1.202613985461213e-01   +2.747133961836727e-01   +1.221903988070892e-01   -2.155372560423638e-01   -2.588822077038955e-01   +3.395550430779025e-01   -3.835192267064867e-01   +5.026422933130267e-01   +1.287625171784009e-01   -2.034598056027428e-01   +1.870189612857863e-01; +1.902066817675704e-01   +3.586443805557813e-01   +2.216915028408155e-01   -9.690849529858711e-02   -2.116820864006472e-01   +5.868755404362314e-03   +1.174465172211765e-01   -2.487180036378086e-01   +1.781819810697100e-01   -1.881648213259040e-01   +2.140427739991644e-01   -1.797132838689885e-01   +2.403502075535952e-01   +6.829863310488599e-03   -1.785947305000057e-01   -1.815109425576862e-01; +1.761197609317073e-01   +3.384250037869307e-01   +2.773262070566748e-01   -2.195115235206025e-01   +1.333178558399565e-01   +1.594388426092813e-01   +3.694954436013456e-02   -3.784978620826210e-02   +5.756676877229417e-02   +8.039132531820101e-02   +2.922770153420494e-01   -1.512861783430003e-01   +3.895533208855085e-01   +2.876913757918678e-01   -2.298782023370118e-01   +2.492086826102630e-02; +2.059399235407251e-02   +1.731933204663169e-01   -1.257862920706378e-01   -1.224025672754614e-01   -1.461749540969186e-01   -3.745465824401189e-01   -3.240698014727293e-01   +7.798718175733355e-03   +1.327304418769729e-02   +1.820957105933776e-01   -1.688671656996639e-02   -3.387168234366291e-01   -1.196857612437056e-01   -1.625082589263841e-01   +2.061561265913192e-02   +5.890287914958656e-02; +7.013604549119437e-02   +1.760424543476533e-02   -1.324381031950740e-01   -6.875285483800275e-02   +2.306240038109701e-01   +1.341328165705401e-01   -1.991447950757723e-01   +1.661423984427592e-01   +1.169200438855243e-01   -2.772348148042849e-01   +1.836752755341481e-01   -1.644659422223675e-01   -4.612194177089980e-02   +3.578854830878891e-02   -1.527394177366567e-02   -4.329349232618743e-02; -1.541124780649993e-01   -2.246076633512405e-01   +1.009786677752930e-01   +1.016595173208077e-01   -4.475837249790481e-02   +1.659326229814249e-02   +3.366475956939998e-01   -5.685587823071339e-01   +4.935411451492990e-01   -1.635490194324876e-01   -3.530523855170661e-01   -3.701367233218462e-01   -8.403175289243069e-02   -1.036888018965865e-01   -4.734182747928340e-02   -1.962123998557672e-01];
L1E_L1I_iGABA_netcon = [+2.338390356720231e-01   -1.600330637158178e-01   -2.364396160020149e-01   -4.817377371049385e-01   +2.423303744460807e-01   -4.478341829656892e-01   +4.038707891561573e-01   -1.617901592881584e-01   +1.286716364377851e-01   -6.880082154774522e-02   -1.168239257887762e-01   +2.998549487224401e-01   -2.169017379318497e-01   +2.139570402813540e-03   -1.166242217294210e-01   -4.721336539652496e-01; -3.075007147482796e-01   -3.086851826862792e-01   -1.715454683550106e-01   +1.386892648900667e-02   +2.729703398992696e-01   +8.652309664180981e-02   -1.360939415062427e-01   -1.435250531266606e-01   +1.913475470100727e-01   +1.431141183968789e-01   -7.016058572140776e-02   -9.458873145346122e-02   +1.414785429866452e-01   -6.353621774556367e-03   -1.455976259635485e-01   +1.093211761999309e-01; +2.557937379400170e-01   +2.352178159485530e-02   -1.364328521189316e-01   +3.865800482979991e-01   +3.019567803465611e-01   -2.332755002944541e-01   -6.295945706654213e-02   -1.268848574489513e-01   +1.472406706275560e-01   +2.254138847460571e-01   -9.544756595373416e-02   -2.257738541003860e-01   -1.449477437826913e-01   +1.234606261353716e-01   +2.593166546693048e-01   +4.103277844653829e-01; -1.241549720212315e-01   -4.050820413584953e-01   -4.578255243742051e-01   +2.339167100865973e-01   +1.387296731836003e-01   +1.685539710364514e-01   +1.677648099121653e-01   -1.610564731850441e-01   -2.590276359334500e-01   +4.634081765968148e-03   +1.111840979698764e-01   +2.941640087659573e-01   +1.586426014398287e-01   +1.842787952862486e-01   -2.841939817652445e-01   -2.661225812956695e-02; -9.190140605832248e-02   -4.244384112301039e-02   -5.716076175877235e-02   -2.871213518793385e-01   -4.067365499142248e-02   +6.484539137599260e-02   +1.438575963579444e-01   -6.655128670459398e-02   -1.262409577389385e-01   +3.370390367465467e-02   +1.384880837398923e-01   -1.571499720667809e-01   +2.173489385538052e-01   -5.040021074565695e-01   +9.265828714439955e-03   +2.580913263532239e-01; +2.158230064588338e-01   +1.282314494263209e-01   +2.910497680337547e-01   +7.078534257206462e-02   -1.050014593646560e-01   -1.374343581704127e-01   -5.095639403965950e-02   +1.556498979419693e-01   -1.263152046531624e-01   -1.823071023612254e-02   +4.017253151333169e-01   -1.129440932919075e-01   +1.351675947708810e-01   +7.883470830518202e-02   +3.317076719737458e-01   +2.209115601375961e-01; -9.570354038728462e-02   -1.187451522782796e-01   -3.721182794094613e-01   +5.039757360199680e-01   -1.108733535879810e-01   +3.838651420593655e-01   -2.452300428012715e-01   -1.044461785558133e-01   -2.299838180319814e-01   -2.597567569526989e-01   +8.848586407193604e-02   -2.148825719228887e-01   +3.588620155663421e-01   -2.306259415721101e-01   -1.382585977534795e-01   +1.369198822770319e-01; +1.218962681841439e-01   -1.684082219778756e-01   +1.479282637857509e-01   +3.247725355033187e-02   +2.592933750327507e-01   +4.914187284410679e-01   -1.480822151785824e-01   -1.547397808072118e-01   -2.040579953182616e-01   +1.630903852282795e-01   +7.967005059326585e-03   +2.822488320135976e-01   +7.070059560776588e-02   -1.592996844821083e-01   -3.613065437981862e-01   +2.572163716506756e-01; +8.690650898677582e-02   +7.094131738714474e-02   -2.135878982302031e-01   -1.140210709127853e-01   +4.540356867419514e-01   +1.354073324571747e-01   +2.466911442603493e-01   +2.694215974698955e-01   +3.921153425739457e-02   -9.268498786184767e-02   -5.874030181970175e-02   -2.042020703063950e-01   -1.950690319019296e-01   +2.140216202175033e-01   -1.806084537784079e-02   -1.281896044971447e-01; -9.636505630806476e-02   -1.413464484534113e-02   +3.484065783676030e-01   -2.779530101592944e-02   +2.294476839226589e-01   +1.035944857933920e-01   +1.011114706693481e-01   -2.246716950250208e-01   -1.668613962443272e-01   +1.591472909508944e-01   -4.611595155502545e-01   +3.338377057683334e-01   -2.380838869339806e-01   -2.974540984856364e-01   +6.676543509664296e-02   -2.466597053803494e-01; +1.685171555885283e-01   -4.020350710503922e-01   -2.234832104567376e-01   +2.632401302832335e-01   +1.783303155199054e-01   +9.126077688389994e-02   +1.334392547807485e-01   -2.775746846201092e-02   +2.327872776150873e-01   -3.880665612199144e-02   -1.530443077176876e-01   +3.297383084475768e-01   -7.830622845512418e-02   -7.172058908721038e-02   +3.608048707225568e-02   -1.126098463275183e-01; +1.829710368273976e-01   +2.586071192554722e-01   -2.062622867103808e-01   -2.729582551266760e-01   -2.485810880734530e-01   -8.311106586232014e-02   +3.262207216463854e-01   +1.837930692473289e-01   +1.225075180466024e-01   +1.280444939108935e-02   +1.402279942791155e-01   +2.844578462714563e-01   -9.854564136482040e-02   +8.790585363256459e-02   -1.242212040152594e-01   -8.078155044839423e-02; +1.280758157549731e-01   +7.897201833654671e-02   +4.545152094934102e-02   +1.689017340236650e-01   -1.157907124707288e-01   +1.777575131253873e-01   -2.226142464049589e-01   -1.594595568597723e-01   -3.858403263189888e-01   -3.174984490756438e-02   +1.708965088708974e-01   +2.101375365671187e-01   +2.136376883274487e-01   +1.742078236059538e-01   +1.273243605791885e-01   +2.052421464676178e-01; +3.059689554218273e-01   -4.884135240762202e-02   -1.979634346030397e-01   +3.318553929038897e-01   +2.231757491782016e-01   -1.170613106821098e-01   +2.270384124487071e-02   +2.819186310962101e-01   -1.473743750744525e-01   -3.937672131227776e-02   +1.423042743539231e-01   -6.888800142751030e-02   +2.724087904178530e-01   -2.110649332198972e-01   -1.834661353990377e-01   -7.534840094213857e-02; +1.658010221465853e-01   +2.414034407303603e-03   +1.315120066431490e-01   -2.912296331609284e-01   +3.687196504034255e-01   +5.138013145166127e-01   +2.059670750789867e-01   -3.889444175016030e-02   -3.187616091108569e-01   +1.738262897138315e-01   +2.273423883309494e-01   +1.107363165552694e-01   -2.539575128496672e-01   -4.745144090907881e-02   -2.331872366543927e-02   +1.722513630385837e-01; -5.281142245537424e-02   +1.276778359403338e-01   -2.418314916052627e-01   -2.029731623065197e-01   -1.042859540814445e-01   -1.089501706436261e-02   -1.438737065494329e-01   -3.529121413741747e-01   -1.387031163097961e-01   -2.160266226100730e-01   -2.277921904226245e-01   +2.703991617499130e-02   -1.220533667427133e-01   -3.624397354072359e-02   +7.253302981135612e-02   -5.829935813490725e-02];
L2I_L1I_iGABA_netcon = [+4.444710235722157e-01   +3.175854049217702e-01   +4.263995387619868e-02   -1.731180629498956e-01   +2.381935989870231e-01   +4.001817634457719e-02   -7.963852691083233e-02   -6.660578741108675e-03; -1.085950556780987e-01   -1.780428825590695e-01   -8.242905373842058e-02   -1.017882108764245e-03   -7.208658112745653e-02   +3.030855557917190e-01   +3.562456029239930e-02   -3.247146796258222e-01; -2.614862087143559e-01   +2.687005205213598e-01   -8.761556052950450e-02   +7.949777811864719e-02   +1.905123805903271e-02   -1.638064816819348e-01   +2.602759206072691e-01   -5.288342263160828e-03; +6.954101479737185e-03   +1.650059412981359e-01   -3.847544255656783e-01   +8.616322873942338e-02   -5.866303703564821e-02   -1.403168622205738e-01   +4.569627360440215e-02   -1.128008088189758e-01; +1.893732370792574e-01   +1.268673550524377e-01   +2.767219378302087e-01   -3.264085796903918e-02   -5.206649545419456e-02   +1.859365686087474e-01   +2.205127458878223e-02   +2.212014515255146e-01; -1.440838483561888e-01   -8.762864994889691e-02   +3.617362277276319e-01   -2.156904228367238e-01   +1.331634693657507e-01   -2.998831462405989e-01   +3.113588846649235e-01   -1.484892932452877e-01; +2.772144542676481e-01   -1.129465177220235e-01   +2.100098195987278e-01   +2.937766467481062e-03   +4.748232610799693e-01   -4.007649786631052e-01   -8.077123579037278e-02   +8.826696929320846e-02; -2.448844404452784e-01   +3.119977366528190e-01   +2.270078293587517e-01   +2.681418848531799e-01   +1.308176519838407e-01   +1.733924018243391e-01   -1.028825420219928e-01   -2.843555879208903e-01; -1.127378974253908e-01   -2.609920244110246e-01   +1.635375363565249e-02   +3.476874295101025e-01   +3.774006973141701e-02   +2.497179283767001e-01   +1.366285896457024e-01   +1.822388595008427e-01; +2.477788150984663e-01   -1.183451424881151e-01   -3.791100318894925e-01   -1.395952020402142e-01   +2.310056175920138e-01   -2.643264323346467e-01   -4.755940499012254e-02   +3.503900275976432e-02; +1.020404577411305e-01   -1.840096055205397e-02   +1.329170432070484e-01   +1.353265889037358e-01   -1.577709762203315e-01   -4.306881715488980e-01   -2.810053652542104e-01   -4.949332122557479e-01; +9.182692018051378e-02   +3.445819670995035e-01   +1.481856085460198e-01   +6.817854348856878e-02   -1.504597732982047e-01   -2.433782386222524e-01   +3.187033761667450e-01   -3.739819596745174e-02; +1.616197613910922e-01   +2.671652130180346e-01   +1.884673677717509e-01   +7.647106313036625e-03   +2.202112143984217e-02   -2.849677230076187e-01   -4.697020524114453e-03   +1.886995561417435e-02; -7.538184763529193e-02   +1.783868093858850e-01   +1.133723193155610e-01   +1.693709463713452e-01   -2.393980826675941e-02   -4.432228623181724e-01   +3.845602234720329e-01   +1.383201480875579e-01; +1.496226636416327e-01   +7.893089339360330e-02   -3.523177558193945e-02   +1.951015926370510e-01   +1.751314011504914e-01   +2.916306649987023e-01   -7.395630659608216e-02   +1.775264171228086e-03; -1.723284900925114e-01   +1.716404768460002e-01   -2.012605104954271e-01   -5.949722366365774e-02   +4.129497029486062e-01   +8.462522173564223e-02   -4.495927363824059e-02   -7.276703118565184e-02];
L1I_L2I_iGABA_netcon = [-4.338557329714487e-01   -2.510158457682579e-02   -1.982092634723200e-01   +1.309518955169026e-01   -1.621624851648617e-02   +1.188416899911621e-01   -3.785940041654993e-02   -2.056283070771484e-01   -1.128744612363315e-01   +5.136660122389270e-02   +3.764928058802895e-02   -1.925901395529650e-01   +2.126518174287690e-01   -1.899705418843711e-01   +1.962983794557300e-01   -4.768471638711907e-02; -3.273824694519338e-02   -1.200162469748620e-01   +2.481554610134194e-01   +9.715127097551181e-02   +2.139473187665336e-01   +1.575599946885345e-01   +2.696137336442157e-02   -5.912109893297217e-02   +9.643255905100916e-02   +2.716917327844990e-01   -5.877939283930736e-02   +4.595976865161545e-02   -6.305519553354386e-02   +4.564584156060249e-02   +2.186573270194291e-01   -5.360862406444428e-02; -2.765962779603115e-01   -1.458371361588916e-01   +3.375659025648798e-01   -6.085611923991674e-02   -1.292774724414713e-01   +1.889515897030022e-01   -1.702966485504347e-01   +1.774890023055814e-01   +7.171845223398776e-02   -4.289699985546870e-01   -1.696705805176499e-01   -4.239112736632411e-01   -3.971455281380293e-02   -2.244113745190087e-01   -2.800111972996667e-01   -9.761645763239271e-02; +3.524775610453308e-01   +8.514637650832940e-02   -5.677731952382591e-02   -5.845119680875091e-02   +9.297390376621818e-02   +6.004693735171229e-02   -3.118121065629026e-01   +2.114470694104600e-01   +2.701646955320509e-01   +5.512865074077683e-02   -1.271928104025240e-01   +2.776603744428547e-01   -2.752411380033290e-01   -3.942941418637648e-01   +3.965483982749957e-01   +2.051517871678102e-01; +2.017384331042545e-01   +2.319745454904595e-01   +2.279782513812436e-01   +2.680895814397471e-02   +2.823193390361821e-01   +2.120769046984339e-01   +1.349466700157460e-01   -1.754451424187487e-01   -2.433513211364931e-01   -1.826264352441449e-01   -1.788333666662311e-01   +1.005916044789378e-01   -1.164839210226314e-02   +5.358397296565892e-02   -2.531192774576972e-02   +2.131681349877317e-01; -1.305491487521395e-01   -8.035299698826900e-02   -4.697516476408194e-02   +2.049896078616929e-01   -2.290785513581546e-02   +1.064183029029991e-01   -5.190022898501823e-02   +9.644172511055261e-02   +2.415747747043421e-01   -9.871695769842356e-02   -2.880535725163557e-01   -5.493321934174000e-01   +1.241094140865398e-01   +6.074069310067449e-02   +3.654826176053050e-01   +2.347953269233140e-01; -2.037572624456246e-02   +2.461754472102585e-01   -1.905151547162305e-01   -4.082396866282280e-01   +8.424238352981972e-02   -1.081034964346236e-01   +1.134507462860515e-02   +1.861683117217950e-01   -9.134202762739915e-02   +4.911323904275794e-01   -1.587493293181849e-01   +3.748834235258433e-01   -7.349601238767191e-02   -6.181628416352905e-03   +5.296058717657549e-02   -5.542401802660115e-01; -1.451470874870412e-02   -3.684913623551671e-01   -1.834486379986618e-01   -2.730665433878589e-01   -3.072915725302937e-01   -2.010185411848424e-01   +1.116933313097709e-01   -2.894315973481029e-01   -2.368221901348213e-01   -6.632625103003723e-02   -2.684622295904866e-01   +1.967288349967725e-01   -2.876036376978371e-01   +4.525498181709534e-02   +3.639980965920160e-02   +4.039748108318497e-02];
L2E_L1E_iAMPA_netcon = [-1.862406344899572e-01   -2.705501460065822e-01   -3.523951533649310e-01   +2.286638287529886e-01   +3.322485107225906e-01   +1.682835806989191e-01   -5.469599282292463e-02   -5.873328024307301e-02; -2.628233413422897e-01   -6.763915523738279e-02   +2.580423140223439e-01   -2.807685407671401e-04   +8.288425173694750e-02   +2.837785103591336e-01   +9.089325530263900e-02   +4.399857808961893e-01; -1.094951271479100e-01   +7.287010846304529e-02   -2.273210667549266e-01   -9.182688818035904e-02   -5.584231901118041e-02   +1.612206654981544e-02   -1.395611419367318e-01   +1.048686589924281e-01; -4.206954868169421e-01   -1.457790265060320e-01   +2.408957217789406e-01   +1.572889339948142e-01   -8.530997970470292e-02   -3.627220475578050e-01   +5.861143115289192e-02   +2.401102593117105e-01; +4.136090456420872e-01   -1.105619536596442e-01   -7.639696120822032e-02   +8.693898976257705e-02   -1.187151480401668e-01   -1.754324220490001e-01   +1.849136535591301e-01   -3.830379957525891e-02; +1.149758565471056e-01   +7.351357414603350e-02   -2.781382734566104e-01   +5.627920992713198e-02   -2.128199346218295e-01   +7.061439197857396e-02   -1.316427037419746e-01   +1.882233849378957e-01; -2.372878988461207e-01   -2.665696447348302e-01   -5.704377265610579e-03   -1.573874908771045e-01   +2.084260925919065e-01   -4.426255132851947e-01   +2.509136253759230e-01   -5.248586317782131e-02; +1.100342717108065e-01   +2.212021750314621e-01   -2.108538566230730e-01   +2.729166228287974e-01   -1.433455027192166e-01   +1.994481836578982e-01   -2.297647294000957e-01   +8.434560384111708e-03; +3.576071591093191e-02   +1.503901917672138e-01   -2.965711689319822e-01   -5.521481534461914e-03   -1.320975046034942e-02   +4.403055867733480e-02   +6.164431941460067e-02   +1.462443920981202e-01; -2.468518407161419e-02   +1.681389078711442e-01   -1.413601703176214e-01   -2.699161111482814e-01   +2.876627470750422e-01   -6.224257364721928e-02   +6.238759721663538e-02   -8.333726540721363e-02; +1.739699335490518e-01   +8.598329531802792e-02   +3.030971352307834e-01   -2.271195628571838e-02   +1.443918268991054e-01   +3.773411794635919e-01   -4.372260916994226e-01   -1.152401508513963e-01; -2.184188406113070e-02   -8.237381899915011e-02   +7.609118386781782e-02   -6.143208577420710e-01   -1.876083987121673e-01   +3.394522609938309e-02   -1.949405521082544e-01   +3.814429327539941e-02; +7.207939445417166e-02   -3.755195474960634e-01   +2.432336687242311e-01   +1.433080130157781e-01   +5.512060308210094e-02   +2.056548935253861e-01   +2.164500396373898e-01   +2.741744584855037e-02; +4.216091231887824e-01   -1.785804369871066e-01   +1.622894178660650e-01   -1.096749076306796e-01   +1.958437909181364e-01   -2.140827687049380e-01   -1.427582630476720e-01   -4.972868908784767e-02; -1.923416444638521e-01   -1.217307308468118e-01   +3.047304133685359e-01   -2.172030813967275e-01   +2.463143226163196e-02   -2.568815871083682e-02   -3.049316265735080e-01   +1.960161464161447e-01; -1.654494835663489e-01   +2.023075701525294e-01   +1.396467167878981e-01   +1.290406786326350e-01   -3.782922163974300e-04   +8.967218125130222e-02   +8.255823882722144e-02   +2.482208478826073e-01];
L1E_L2E_iAMPA_netcon = [+3.682063413258652e-01   -1.558960682230462e-01   -3.074137591530647e-01   +3.598810801195077e-01   -1.578199654705797e-01   -2.921638434549102e-01   +3.011205777868064e-01   +2.967366168585026e-01   +1.795286219800081e-01   -2.851587473693098e-02   +1.382549128468313e-02   -2.175496980831386e-01   +2.496556573418343e-01   +1.454994231204847e-01   -1.890940590140563e-02   +7.329116506900035e-02; +2.504757019086354e-02   +1.890061074961235e-01   -9.770600625731168e-02   -3.866162597915107e-01   +1.012970302506772e-01   -5.216860106846785e-02   -1.694935203915717e-01   +1.205263482108330e-01   +6.607948755620714e-02   -8.857427147696176e-02   -2.653087739282342e-01   +1.756605135084977e-01   -2.693144096675273e-01   -2.157052834031110e-01   +8.369942501395272e-02   -5.746942169234659e-02; -1.131236484431587e-01   +4.394996352849218e-01   +4.560701456993171e-02   +1.009353234388574e-01   -3.756763274283812e-01   +2.429981367034366e-01   -2.539102775777129e-01   +4.324788514695233e-01   +2.741649909452617e-01   -1.478279720004892e-01   +2.130940604176831e-01   +4.744514694671442e-02   +1.309966184522998e-01   -1.443338360771400e-01   +2.922276360750861e-02   -6.505025673253990e-02; -2.852594827421524e-01   +1.572937752191017e-01   +3.035453777731281e-01   -1.185749627179781e-01   -3.916834318542645e-01   -3.189272164865880e-02   -1.903333407593266e-01   +1.220671104056442e-01   +1.798519295411097e-02   +1.037745967178033e-02   -3.438804023280743e-01   +2.440462081084878e-01   -5.510364219606092e-01   -7.943976204348323e-02   -1.678328840006442e-01   -1.543952748421444e-01; -7.341493888469937e-02   +2.390723774746715e-01   +3.657521611325833e-01   +1.978606647714671e-01   -3.425148012964611e-01   -7.565957037512523e-02   -1.458789838738321e-01   -1.854782680415156e-01   -4.480319693878382e-01   +4.137922956138278e-01   -2.405447230430418e-01   -1.685789349288380e-01   -2.333431241080656e-01   +5.028351675802999e-01   +2.651601384978302e-01   +2.198780637175701e-01; -4.090727906033626e-01   -5.491078261998156e-02   +2.550141535688917e-01   +1.803524364183636e-01   +1.090776263602074e-01   +1.075837965346495e-01   -3.660769924136411e-01   +1.384347071556747e-01   +9.302866613381409e-02   +2.303749201369744e-01   -2.404837723531324e-01   -1.651235925831069e-01   +2.170079310792513e-01   +2.986765933514702e-01   -9.633135417758116e-03   -1.078952427476283e-01; -2.738048054087193e-02   -7.813111817879978e-02   -1.241825741861613e-01   -2.895351018878642e-01   +2.654798140635741e-01   +6.405244613832702e-01   +6.679348232861415e-02   +2.469736232584107e-01   -2.440153606279325e-01   +2.920538086165857e-01   -2.006013803123268e-01   +6.482743543446434e-02   +3.528060553130054e-01   -4.361533341525295e-01   +3.835875273441319e-01   +3.835711457205502e-01; -1.223753754339293e-01   +4.453895087167500e-02   +1.950069425989940e-02   -1.126633260861214e-01   +2.123149636178361e-01   -5.260067323263769e-02   -2.788596824302558e-02   -1.124432961952491e-02   +8.180015528759660e-03   +2.490684384861562e-01   -9.834233292123434e-03   +1.690405501954806e-01   -1.261388793454371e-01   -3.386754633310304e-01   -3.286202522371263e-02   -1.474123808429470e-01];
L2I_L2E_iAMPA_netcon = [-1.565361089824890e-02   +1.962583208851282e-01   -2.992129332588193e-02   -2.196820220023208e-01   -6.736212049381848e-03   -2.968782668286765e-01   +1.366038133881368e-01   -7.511140836237801e-02; -2.474831404034130e-01   -9.953594008150526e-02   -7.883828521488173e-02   +2.973284304160727e-01   +1.120005862601636e-01   -7.288202755483923e-02   +3.067088971576598e-02   +2.936198863782156e-02; +5.625466056155655e-02   -1.809841603466210e-01   -2.088208133645183e-01   -2.746974675243182e-01   -2.435037680352015e-01   -8.888100295250188e-02   -9.994204029122630e-02   -1.821789230213589e-01; -3.287124303737345e-02   +7.972811173697220e-03   -5.341188834300936e-01   -8.697388496566011e-03   -7.942610293636278e-02   -2.496435354724127e-02   -2.224628874071243e-02   -2.738118052513014e-02; +1.175983940631076e-01   -6.588144979977770e-02   +1.427005264020478e-01   +2.912077996662186e-01   +1.697859688670612e-01   -6.723258936347698e-02   -1.746798946660917e-01   -4.380917590745794e-01; +1.398251188211780e-01   -7.708619373067750e-02   -2.770647634131397e-01   +4.013547374480353e-01   -1.042457185938806e-01   +7.157760719376019e-02   -6.320236502789431e-02   -2.468130091660478e-01; +2.298792608241854e-02   +2.360166195160048e-01   +8.029009908282295e-02   -1.572473591297401e-01   -2.031138145422456e-01   -5.398218585521737e-01   -1.061770142856126e-01   +2.490441116740988e-03; +6.747772477144830e-03   +8.050766089416628e-04   +4.309948090014587e-02   -1.068225799389355e-01   -1.909989840575564e-01   +1.759540713119713e-01   +4.012992449336548e-01   -2.484954722315462e-01];
L2E_L2I_iGABA_netcon = [+6.810237245608614e-03   -6.148816560846745e-03   +1.857619554113483e-01   -3.571155934608845e-02   -1.898353579833457e-01   -3.846706128894752e-01   -6.779412607961077e-02   +4.487680289802390e-02; +2.395463240525873e-01   -2.483418257705175e-01   +3.074533053468559e-01   -1.062160021986076e-01   +1.349790087964352e-02   -3.352761746127283e-01   -5.166071267341947e-02   -3.483574188374295e-01; -6.157726787715589e-02   +1.597957681995952e-01   +3.607480500654194e-02   +1.367001637006791e-01   +3.980725403234973e-01   +2.670778385157553e-01   -6.580049149782906e-02   -2.444758539823005e-01; -4.866932657009461e-02   +1.936480838652277e-01   -1.846729834820175e-01   -1.832430246635887e-02   -3.831649439917773e-02   +2.674849408981368e-01   -2.583798079743036e-01   +3.546471889469544e-01; +1.924096167326506e-01   -2.848705821850734e-01   -1.532873882430285e-01   +1.647916877028815e-01   +2.034734658977550e-01   +5.053044837509295e-01   -1.793971981317099e-01   -7.391624646393773e-02; -3.069220263152403e-02   +1.485437670963163e-02   -1.865002809423921e-01   +1.733512850701829e-01   +2.040196062432599e-01   +2.175662373118047e-01   -4.122747841798372e-02   -3.151754513555066e-01; -1.980188692860354e-01   +1.630613129833723e-02   +5.359430969078578e-01   +5.585829489518959e-02   +2.257249150817691e-01   +1.562293145264927e-01   -1.351621305242625e-01   +4.944436351487218e-02; +1.440128418642111e-01   +1.522609887068238e-02   -4.744147447635627e-03   +9.257960320827041e-04   -3.762943691425863e-02   +1.847338737279723e-01   -3.221326217179435e-02   +3.649895018822782e-01];
L3E_L2E_iAMPA_netcon = [+2.445252035622919e-01   -4.485369758195928e-01   +3.243195357416601e-03   +2.951431528342096e-02   -1.290796566906590e-01   +1.389234762666322e-01   -7.965478696020097e-02   -9.688576707279448e-02   -3.012560729336797e-01   -3.333948115897499e-01   -2.430275435509039e-01   +2.320244574084182e-01; +2.892101764009790e-01   -3.173446365205982e-01   +1.422276643290363e-01   -3.496612386636976e-01   -1.888879667034792e-01   -1.320913692947416e-01   -1.183052233804616e-01   +9.672877958897701e-02   -2.674020981394721e-01   -1.470883669359618e-01   -3.038220933036169e-01   +1.446857785618507e-01; -3.050025948231830e-01   +6.854270407275451e-02   -2.198250712397848e-02   -5.588641317990869e-02   +2.201485291870708e-02   +2.613520792365375e-01   -1.317350357326307e-01   +1.370587932506532e-01   +1.906152504869519e-02   -3.562489239686506e-02   -1.434578729183243e-01   -2.947752214204226e-01; -3.560044065727684e-01   +7.172808206457273e-02   +7.782342828474098e-02   -3.800884788028178e-02   -1.631771495570374e-01   +1.291613586942882e-01   +2.799316138851961e-01   +2.280184883096374e-01   -3.351467155688118e-01   -1.368148604650734e-01   -4.375927057273413e-02   +1.271650329187607e-01; +2.343325307795998e-01   +2.743221758717608e-01   -1.639092850848146e-02   +1.213108494169829e-01   -8.883284850357748e-02   +1.627398319997075e-01   -5.365339630411514e-02   -4.003306156971918e-02   -2.938382412591024e-02   +1.830816279392231e-01   -1.323813109124564e-03   -1.324381012653478e-01; -1.844769883020680e-02   +7.133536370033738e-02   -2.617403109479627e-01   +1.357710450010327e-01   -3.473418082158494e-02   +8.394744748950148e-03   +4.596018803747250e-01   -4.629408229465314e-02   +9.887225647827629e-02   -7.725445730771226e-02   +3.167176983950606e-01   +6.120830028892833e-02; +6.821925305013629e-02   -9.571196712000360e-02   +7.138756793310200e-02   -1.414892976090757e-01   +6.044924784321738e-02   +9.727591286629721e-02   +2.233534286339491e-01   -4.359955402501267e-03   -2.581264601627992e-02   +1.171445063453836e-01   -6.026905029136630e-02   -1.737525793875010e-01; -3.082757416833348e-01   -1.010283963725322e-01   +5.990155576612769e-01   +2.211595220737763e-01   +8.826904609574229e-02   +1.461269337126248e-02   -1.806359571542939e-01   +3.812359463488079e-01   +9.888393229088856e-02   -4.020763259399320e-02   -3.829621529980955e-01   -4.019771639532398e-02];
L3I_L2I_iGABA_netcon = [-4.819955540516489e-02   +3.998325077868825e-01   +1.121442372289336e-02   +7.440841138225317e-02   +2.057856770816782e-01   -1.412556099457665e-01   +4.771565255507867e-02   +7.024156312915533e-02   -3.005735861831227e-01   +1.659831472204945e-01   +1.345061231842740e-01   +2.159868969460256e-02; +2.785621169602318e-01   -2.150337951720681e-01   -3.927264006183088e-01   -6.249844123928960e-02   -1.246251220425967e-01   -5.810177313504170e-02   -3.888080758109549e-02   -6.009837972608539e-02   -3.675233561250079e-01   -8.761975211387146e-02   +2.860795928551355e-01   +2.319017615153736e-01; +7.769642720126216e-02   +1.507957011377391e-02   -1.105251883356784e-01   -1.400371596405960e-01   -3.430664761324573e-02   -9.606135329989746e-02   -2.432986144400368e-01   +2.003475844884609e-01   -1.599249258287731e-02   +3.319377824003026e-01   -1.790580633090424e-01   -1.496368312065325e-01; -2.026016234555230e-01   -8.730169744403425e-02   +3.008195472771940e-01   -1.769943402384792e-01   +8.773425229554446e-02   +2.785947075694581e-01   -6.480417262176461e-02   +4.770282912019501e-02   +2.964567810752833e-01   -2.437082742583026e-02   +5.837332493584396e-02   +5.872321420352824e-02; +9.438794323145802e-02   -3.111044325923366e-01   +2.900453090206353e-01   -9.231104303489292e-02   -1.788656770654544e-01   +3.070451124291723e-01   +6.384611778764843e-02   +6.805900743061452e-02   -2.340704720879471e-01   +3.044453017871060e-01   -8.645856753013031e-02   +1.709959747396534e-01; +2.447362779605021e-01   -2.998299432703095e-01   +7.068647892792712e-03   +9.132119583968624e-02   +1.104466003494903e-01   -3.491143334974509e-01   +1.355510558029487e-01   -7.355287352019471e-03   -1.463273236755450e-01   -7.139147575873249e-02   -2.542786315230137e-01   +3.405153684978021e-01; +8.173671883913838e-03   +3.341461653121576e-01   +1.364518468966078e-02   -4.998681612458596e-01   -1.185550093031535e-01   +2.867826772873754e-01   -7.994504342350398e-03   +3.338460380963439e-02   +2.694983970379174e-01   -2.304479031864362e-01   +7.401121690171929e-02   -2.903359495159767e-01; +2.656300143281901e-02   -4.170523279637757e-01   +5.386697766065260e-02   +4.590643221084216e-02   +7.211683627465573e-02   +3.089603408608617e-01   +3.931464090666492e-01   -5.033260115434024e-02   -1.353633499885590e-01   +1.829481040704876e-01   -3.379908372360247e-01   +2.537993664726383e-01];
L2E_L3E_iAMPA_netcon = [+2.233289752538291e-01   -2.006807465690597e-03   +7.585017086512129e-02   -3.861266730790962e-02   +4.836315447227710e-02   +2.252735506547837e-01   -1.074334586105724e-01   +5.275818661814492e-02; -1.521773732893340e-01   -1.403599903519062e-01   -1.335979998268878e-02   +2.793167639866579e-01   -3.529776387585586e-01   +1.280379264788755e-01   -1.085672435783381e-01   +5.804412923139401e-02; +2.901310367357857e-03   +7.319646660500459e-02   +1.076052762860059e-01   +2.668782421509804e-01   -3.025218230801223e-02   -1.237886855679782e-01   -5.729159073002831e-02   +2.949761549603409e-02; -1.599165769151701e-01   -1.135431844902166e-01   -7.882764192320267e-02   +1.040800711851222e-01   -3.543007189700508e-01   -5.111767737010570e-02   -7.610899653659134e-02   -1.217756619911418e-01; +3.643477025925201e-01   -1.220026119451748e-02   +1.121213391838313e-01   +4.126575757661367e-01   +1.399573809189014e-01   -3.205009238117250e-01   +3.499964095114530e-02   -1.247548215399671e-01; -1.970679255963897e-01   +1.857297904129708e-01   +9.312938999486378e-02   -1.122573134387555e-01   -1.245440060498848e-01   +9.395385422954472e-02   +1.784358429773997e-02   -3.328659090893947e-01; +2.290688532768346e-01   -1.651866315632346e-02   +1.676305137532415e-01   +1.923222546502666e-01   -8.120211629609818e-02   -3.977190970027328e-01   +1.175580575607761e-01   -2.632834542722629e-02; +2.475186387711811e-02   +1.917712831998722e-01   -8.966855931687029e-02   -1.084943899986718e-01   +6.784196967446067e-02   -2.071352532450726e-01   -9.091486928976532e-02   +1.018874479497678e-01; +1.549205217534585e-01   -1.545123759258215e-01   -4.368245669319630e-01   -2.193009808826496e-01   +4.440845808696929e-01   -2.579166780700359e-02   -4.444497488719353e-01   -2.442865161079466e-01; +7.851761223138234e-02   -3.766907061232269e-02   -1.216209669680598e-02   +2.109076893663969e-02   -2.748288146768876e-03   -6.422778455568127e-02   -1.669225043592918e-01   +2.254088726744874e-01; +1.858085520585484e-02   -2.397003131799662e-01   +9.627685978831495e-02   -4.171785415556362e-01   +3.918530183272021e-01   -4.553570997266958e-01   +4.049419019650105e-01   +3.581624665547009e-01; -2.041436618437256e-01   +3.067736675946472e-02   -8.180160538222601e-03   +8.960846299827754e-03   -7.529946083468103e-02   -9.843385073023594e-02   -1.073249063333962e-02   +1.619956886178890e-01];
L2I_L3I_iGABA_netcon = [-5.481941918441995e-01   +1.768380338857016e-01   +2.633598104357457e-01   +2.852711804611109e-02   -2.727720632525076e-01   +1.915001271765398e-01   -1.719135405169784e-01   -1.955835140394240e-01; -3.985969337532810e-01   -1.362990126458438e-01   -6.626678592842188e-02   +4.521990193775427e-01   -1.066385423939811e-01   +2.324275460721573e-01   +2.512385411822085e-01   +6.263144271438957e-02; -1.971099346830110e-01   +2.128988621672271e-01   +1.316359198993956e-01   -4.493720114667772e-02   -2.115147919581093e-01   +6.250734141080502e-02   +1.305001476233575e-01   -5.842069551321341e-02; -5.866175368324411e-02   -7.277401094424264e-02   -1.944551255415014e-01   +9.443700205151999e-02   -3.384081230831277e-01   +1.774547526356789e-01   +4.465326533108530e-01   +6.530041031553022e-02; -2.118804662638806e-01   +1.760244229613675e-01   +2.128045563784242e-01   -3.418413818625554e-02   +1.167453762512627e-02   -1.749362661793984e-01   +3.332438604436085e-02   +1.874156439778180e-01; -1.414543631442622e-02   -9.783760109769180e-02   +1.406250410261850e-03   +1.013789146175241e-01   -3.121290019710964e-01   -3.124507877179282e-02   -1.072476059672470e-02   -2.740934364283796e-01; -2.533558973030776e-01   -7.910289423650294e-02   +1.071991684344761e-01   -1.551721564440526e-01   -2.563317310361075e-01   +1.033325046978241e-01   -1.439221780713611e-01   -1.632667356404467e-01; +5.383239656245294e-02   +1.168630997399001e-01   -1.510154018466695e-01   -2.886256074087664e-01   +4.058629519357421e-02   -4.603397566221318e-02   -2.658295279251930e-01   +1.598719988413780e-01; +1.874598805745231e-01   -3.015588634965066e-01   +1.094390792427445e-01   -4.316756562209439e-01   -2.317326317063706e-01   -4.618333522151132e-01   -7.963446211440633e-02   +1.898568494476884e-01; -9.093892634031260e-02   +1.175723389145308e-01   -3.014134623086333e-01   -3.623892168052318e-01   +3.311171735092155e-01   +2.407824658877541e-01   -1.881685482601503e-01   -1.124177000411643e-01; -1.665614021435217e-01   +5.255811077002788e-01   +3.347078989818453e-01   +2.132851728960189e-01   -2.327935217243863e-02   -6.265640628850398e-02   -1.773037783520580e-01   +1.471267972431800e-02; +1.355154666463183e-01   -1.500320075229655e-01   +2.350156708210410e-01   +2.934439541225940e-01   -5.430775496080172e-02   +1.253040688959829e-01   -4.948958954060895e-01   +7.505239423832855e-02];
L3I_L3E_iAMPA_netcon = [+4.698773196515309e-02   -3.371290194512984e-01   -8.725053911883790e-02   +4.025764866667602e-01   -1.943176144188496e-01   -2.673867196351352e-01   -2.799513241364269e-01   +8.003047200625679e-02   +1.346252590308083e-01   -1.739643283055333e-01   -3.480205066200425e-01   -2.682805604325274e-01; +8.001838751152031e-02   -2.397583959659005e-01   +1.450719495860562e-01   -3.382662805018044e-01   -3.598209321436922e-01   -6.430224991401084e-02   +4.216501877246599e-02   -1.913319605970144e-01   +1.131373731718242e-01   +1.953514633545426e-01   -2.712983761389590e-01   -9.203412294234180e-02; +1.872013021813722e-01   +2.661511217944177e-02   -1.895459199463423e-02   +9.811959523938935e-02   +1.834089224606647e-01   +3.820394036779536e-01   +1.940788926549986e-01   +8.131863927125958e-02   +6.540950468222601e-02   -2.961332577900105e-01   +3.002019089442143e-03   -3.844861948594522e-01; +3.472942849003557e-02   -2.704983002030362e-01   -1.569835312534262e-01   +2.238647710874164e-01   +3.569674139951942e-01   +3.218771896954847e-01   +5.411217803933706e-02   -1.150286677719877e-02   +1.329166903463589e-01   -3.859371495688642e-01   +1.399161246040130e-01   -1.332654777884211e-03; -5.257296017925704e-02   -1.578561105598362e-01   -2.885892557544448e-01   +4.734821950374266e-01   +1.993959507567274e-01   +1.487715928474772e-02   +1.742980989962233e-01   -3.122703274346303e-02   -2.480016053828229e-01   -3.990535759389679e-01   -3.504086373923742e-01   -8.494106978521522e-02; +2.894568707786761e-02   +2.466787742312007e-01   +1.255995825684728e-01   +2.605579741534071e-01   +4.172033507038563e-01   -1.760384434209862e-01   -1.571684955618709e-01   +4.441964887035811e-02   -6.599343740130685e-02   +2.872400992761208e-01   -9.337178734758306e-02   -8.288417877629586e-02; +3.709534864899061e-01   +1.280018505212216e-02   -7.721309237668436e-02   +4.035774630680568e-02   -2.921387081317370e-01   -7.420211121625073e-02   +6.046904954443092e-02   -3.481144682391805e-02   -1.911056305146230e-01   +6.008622345365891e-02   -5.464792661836841e-02   -2.176118014121931e-01; +7.798464741127595e-02   -1.688913857838580e-01   +1.522177900555365e-01   -3.482612843366779e-02   +1.996597595021522e-01   -2.797646815732299e-01   +1.712166606881968e-01   +3.313879934514116e-01   +1.511526293847277e-02   -5.207516394292890e-02   -1.257365848653102e-01   -8.580366449367355e-03; +2.039500156429817e-01   +1.950039695337567e-01   +1.446082705515818e-01   +1.984061457562846e-01   +2.506856016785003e-02   -1.295482021208881e-02   +2.073587982228272e-01   +6.400283788534861e-02   +4.246647396013531e-02   -2.554696374107537e-01   -1.192208535117936e-01   +5.791129172102236e-02; -5.822664189333485e-03   -3.530126220092442e-01   +3.018903545438818e-01   -1.498288346923013e-01   -2.261849300307944e-01   +1.012866013021738e-01   +2.006898149895048e-01   +2.180846275586775e-01   -3.009557638063127e-02   +7.799408438905053e-02   +9.490281085367575e-02   +2.158205912543222e-01; +6.891525905134264e-02   -1.121700671753512e-01   -2.791334681053410e-01   +1.400360707661186e-01   +2.744967521629744e-01   -1.580355087142288e-01   -1.751370927762961e-01   -1.063623512414727e-02   -1.362997667364846e-01   -2.304868398710920e-03   -3.172775059390321e-02   +1.375261868836684e-01; +2.114320930235472e-01   +4.392308453894452e-02   +1.463248954389375e-01   +2.792825892639152e-01   -1.054943805988615e-01   -3.984844927953052e-01   -2.837738002553938e-01   +2.812683581625669e-02   -5.877862458065641e-02   -1.212717432056837e-01   -6.174691197125018e-02   +2.001055330167305e-01];
L3E_L3I_iGABA_netcon = [+2.686425708725036e-01   -8.312778292275984e-02   -2.681029712274994e-01   +5.498225331625239e-02   +2.007531612909971e-01   -2.149984003856891e-01   +4.208420622100942e-02   +3.986829699719264e-01   -1.466281343554896e-01   +3.744168241514722e-01   +1.481667695174345e-01   -2.010655202026940e-02; +6.853747238426613e-02   -3.321624029040549e-01   +1.782976355749009e-01   -2.254425138213214e-01   -3.413487412110924e-02   -4.063491294578303e-01   +7.864821679980324e-02   -2.297715788489409e-01   -4.775386661144749e-01   -1.633154282670976e-02   +1.062832823642473e-01   -2.211655429201324e-01; -3.321999178458290e-01   -1.229563929424208e-01   -4.487612201268643e-02   +2.373575585051793e-01   -2.571446841004243e-01   -1.122300207305519e-01   -5.141394543071182e-03   +4.515349794260516e-01   +2.673137840836513e-01   +1.234510481006117e-01   -1.438532820695905e-01   -3.399634240156829e-01; +1.440691104956047e-01   -6.923971697677737e-02   -2.049194377217919e-01   -2.776989367753585e-01   +6.394621636206815e-02   +3.523014303358575e-01   -1.507507049122258e-01   -3.616693537560053e-01   -1.094723835583599e-01   +3.254913944031247e-01   +2.274246447856026e-01   -2.804409966980530e-02; -6.433447576026854e-02   +1.405312670041260e-01   -3.009790478599472e-01   +9.615073699466342e-02   -2.788904004452749e-01   +2.834528585313356e-01   +2.729530564125315e-01   -6.785397451365370e-02   -2.966456657813482e-01   +2.540817622741613e-02   +1.065395404524398e-01   -2.162527769629796e-01; -2.639717339839168e-01   +8.348548498657729e-02   +1.904575950624041e-02   +4.131468027796237e-01   +1.016899701332799e-01   +6.064735460360438e-02   +1.935442227878597e-01   +3.136402159381481e-02   -2.493284439792214e-01   -3.124880480417405e-01   +2.904055870490904e-02   +3.967236113180180e-01; +4.540518271326185e-02   -2.936143629980084e-01   +1.283533960985581e-01   -3.336982591585654e-02   +1.633891491392110e-01   +1.247041097528231e-01   +2.207178036953046e-01   -4.282568898867223e-01   -2.789607682177938e-01   +8.250208607637172e-03   -6.263470316170794e-02   -2.777415686564772e-01; -3.613919334944329e-02   -3.919496430953592e-02   -2.447195145545338e-01   +9.374116354561146e-02   -3.026014591988641e-01   +1.970432064432509e-01   +1.363685030115063e-01   -1.789654526127368e-01   +3.913507831627427e-01   +9.076236824020630e-02   -1.378027024854781e-01   -3.407735720473575e-01; +1.141843593078371e-01   -1.218544977029381e-01   -5.151132291239071e-02   -1.827894517402743e-01   -2.755110142828993e-02   -5.013235626061319e-03   +2.715435511198770e-01   +1.035016126123316e-01   +5.985458205320858e-02   -1.328921449318399e-01   +4.381346528559608e-02   +1.845157922284826e-01; -3.522400231614506e-01   -2.818881008920004e-02   +3.919631907479983e-01   +5.975206473835119e-02   +4.075710027696901e-01   -1.971905117857503e-01   -1.201529947276985e-01   +1.992108581958234e-01   +2.102869045905840e-01   -2.621055549125464e-01   +4.625499417167205e-02   +1.055672975592131e-02; -3.237999002306784e-01   +1.042569944044121e-01   +1.079645865030449e-01   +9.275572626519271e-02   -4.159348603779172e-01   +1.667740454614042e-01   -1.653357287170404e-01   +2.027446254293735e-02   -2.982961694584692e-01   +1.758783510115819e-01   +2.622067747330040e-02   +1.045326831503856e-01; -5.417270102007389e-02   +2.249615455793834e-01   -2.168803087977020e-01   +2.402513204250841e-01   +5.226100099272907e-03   +2.013114118383793e-01   -1.895799314363127e-01   -3.992601968262552e-01   +2.916590431334260e-01   -4.138090035224390e-01   +4.015529271478896e-01   -3.154597455636891e-01];
L2E_Input1_iAMPA_netcon = [+3.917484164735749e-01   -7.606553382680083e-02   -1.236804044224781e-01   -1.276867679229683e-01   -1.193684161515612e-01   -1.014703335343224e-01   -1.045588218148263e-03   -2.001258676985997e-01];
L2I_Input2_iAMPA_netcon = [+1.244116453434792e-02   -1.830835517021306e-01   -7.820805421104583e-02   +7.767928631421296e-02   +1.435324746179209e-01   -1.115893093765440e-01   -9.979994913889786e-02   +3.067188239172752e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
