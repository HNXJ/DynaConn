function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.269868863171807e-01   +9.373546529467056e-02   +6.557644112641572e-02   +2.457504351510106e-02   +1.406447700762963e-01   +1.489948956789869e-01   +9.489154022136007e-02   +1.010862208807381e-01   +3.303933551637150e-02   +7.968370759330802e-02   +1.366941323815467e-01   -2.102453923888472e-02   +4.180959319775576e-02   +1.736983243089577e-01   +4.286562316088131e-02   +1.159505373384594e-01; +2.602217769903472e-01   +1.630807528648862e-01   +1.210640222768636e-01   +6.180447854370009e-02   +1.240705328159737e-01   +9.666945688654545e-02   +1.887950162987887e-01   +4.148809812813228e-02   +9.854576295933624e-02   +1.179012283785177e-01   +2.036979762440938e-01   +1.800338543981623e-01   +1.849381845244895e-01   +1.543523542245137e-01   +5.054189942781984e-02   +8.948914834998252e-02; +7.651802726564419e-02   +7.350569689913974e-02   +2.109191226330073e-01   +4.007448999306778e-02   +1.414640245576116e-01   +2.321904680577409e-01   +3.086561901242672e-02   -2.072159214719913e-02   +2.455908253412279e-01   +7.008750061967056e-02   +1.835156624093423e-01   +2.118682834037157e-01   +9.767955701564179e-02   +1.461549733889314e-01   +1.619629074208308e-01   +7.436956543307988e-02; +2.383452883828019e-01   +2.978076745593310e-02   +9.487299217995135e-02   +1.620186084258792e-01   +1.446427583556678e-01   +5.390332302247844e-02   -9.462975341719318e-03   -7.919569804277923e-03   +7.969347956643051e-02   +9.409898977108207e-02   +1.236578337364685e-01   +1.200979791828619e-01   +2.245519896851463e-02   +1.365025133274093e-01   +2.169171169212381e-01   +2.146167681925958e-01; +9.431701572820775e-02   +5.478249975140326e-02   +2.487784915748704e-01   +4.829479135291437e-02   +9.464993002715918e-02   -1.356749912468760e-02   +1.471388564679221e-01   +1.419037740396473e-01   +1.695168884579053e-01   +2.222897822681735e-01   +2.245082018332344e-01   +6.573599379261799e-02   +7.936951688228885e-02   +8.116162672321514e-02   +2.533278640567396e-01   +1.449089916361054e-02; -9.691865515276149e-02   +1.069846983434489e-01   +2.300251494411605e-01   +4.085044768157797e-02   +7.874419555346734e-03   +5.204619649216693e-02   +1.117778540416650e-01   +8.694569013257704e-02   +3.536400159971542e-02   +1.024878890405900e-02   -2.674649022324975e-02   +1.457114853674014e-01   +1.847590688741602e-01   +2.781077686169813e-02   +2.503273339025134e-01   +1.928750978976790e-01; +2.085896403508889e-01   +1.906235051210428e-01   +1.977223984878955e-01   +2.403307020239775e-01   +5.909472205352538e-02   -1.234543622415273e-02   +1.092604876061689e-01   +6.356776902094666e-02   +1.601649389775272e-01   +1.212673454304336e-01   +9.236258732467899e-02   +1.989780641390299e-03   -1.139047419191984e-02   +1.659190917277336e-01   +1.474930710656616e-01   +1.316714811574132e-01; +2.472024474739662e-01   -3.097815495558075e-02   +1.035573890665444e-02   +2.113370092996783e-01   +2.571955165446562e-01   +9.326390485894466e-02   +6.379167059495786e-02   +7.889235202568352e-02   +2.264974676802461e-02   +2.397645215572601e-01   -4.171242822160981e-02   +7.581002824140461e-02   +8.691416887766382e-02   +1.419900853156673e-01   +2.489366412429749e-02   +3.690290518980713e-02; +1.364616907193936e-01   +1.729749389323736e-01   +2.508103597091027e-01   +7.623873123517980e-02   -1.863722977765371e-02   +5.406129954885597e-02   +1.628613482353478e-01   +9.132906750137057e-02   +1.683570338479293e-01   +2.758300528287793e-02   +1.391599316002231e-01   +1.160953136134510e-01   +2.025765749285449e-02   -1.791675283730534e-02   +2.253474428046012e-01   +7.385785367702859e-02; +1.890970084912703e-01   +3.008824289723080e-01   +1.657946157135180e-01   +1.084770950220921e-01   +1.313684804272241e-01   +5.058369596990552e-02   +1.930122409991640e-01   +1.698353320816550e-01   +1.861694000325457e-01   +7.584631353439643e-02   +1.537673040439730e-01   +1.934087484708842e-01   +1.060186606538330e-01   +2.330734453862582e-01   +2.405428770467262e-01   +1.023502359468027e-01; +1.078491130734864e-01   -6.130397010114914e-02   -3.289421382770972e-03   +2.035752059142989e-01   +1.658404154245182e-01   -6.859656046501031e-03   +7.133280420975417e-02   +1.656069429272023e-01   +7.062667720265348e-02   +1.743337342564736e-01   +7.833071248750768e-02   +1.130752442696814e-01   +1.169747339763833e-01   +1.178138044772590e-01   +5.206957380289310e-02   +1.047877717912557e-01; +1.435816779739001e-01   +1.253569800164150e-01   +2.220760673058923e-02   +1.627852196690219e-01   -4.415904907402661e-02   +1.449619742454995e-01   +1.577242956637245e-01   +2.535174184232824e-02   +8.846500157134518e-02   -6.608372837264273e-03   +2.653233754641427e-02   +1.026422838171330e-01   -4.130355530119905e-02   +2.904897426561323e-01   +4.062002465096236e-02   +2.645223680638909e-01; -2.730095280573436e-02   +4.652780150716438e-02   +1.958632187676538e-01   +2.003811546996145e-01   -6.373148467357459e-02   +2.131532870365171e-01   +9.220259616852663e-02   +6.364150070318024e-02   +3.354461436960520e-02   +3.351800457126380e-02   +9.682710951377911e-02   +1.097581682112642e-01   +2.443946413882246e-01   +3.718178245477287e-03   +5.857548664091816e-02   +5.815519173847500e-02; +1.627091125211770e-01   +2.134878191699670e-01   +8.991844578088484e-02   +1.943198519335781e-01   +2.321700637426508e-01   -6.014399510613729e-02   +4.887111019513501e-02   +1.694671337342570e-01   +1.490560242117032e-01   +1.582431462973570e-01   +1.302263782047465e-01   +1.323145508519695e-01   +8.488410785624928e-02   +2.075928163806602e-02   +1.613587177532133e-01   +8.321230407382579e-02; +1.044259259206988e-01   +5.407560525352653e-02   +1.547664187930600e-01   +1.792901458238340e-01   +2.781185419976961e-02   +1.438092593794791e-01   +3.003436525039804e-02   +1.614285768172974e-01   +1.255856988503563e-01   +2.494073421493123e-01   +1.022595900472485e-02   -3.161153548931070e-02   -3.009480954332709e-02   +1.552907411302915e-01   +2.520482831997077e-01   -3.622741258308914e-02; +1.344863714520785e-01   +1.434134744463098e-01   +1.823842508887717e-02   +1.681688453113821e-01   +1.761428351937948e-01   +1.700650451938069e-01   +1.383095255182782e-01   -2.712901374730072e-02   +7.761258426631895e-02   +1.490652163092303e-01   +5.178349221780937e-02   -9.344252711345480e-04   +8.119772898583817e-02   +1.661999141379591e-01   +1.464530066909754e-01   +2.207674173736659e-01];
L1E_L1I_iGABA_netcon = [+4.464983220579870e-02   +1.387305853047748e-01   +4.996916878932375e-02   +3.078541947481867e-02   +9.361534571838578e-02   +8.300601450484987e-02   +1.900968741240042e-01   +9.577324095120809e-02   +1.474047690267229e-01   +9.647637256229674e-02   +1.515202726158453e-03   -4.077502737609241e-02   +8.871070256750593e-02   +5.983286788127209e-02   -2.596571297519266e-02   +3.247762897555636e-02; +1.319049419940488e-01   +9.476410326435250e-02   +1.924291483697269e-01   +1.322299988872136e-02   +1.062096002274261e-01   -3.655384603543036e-02   -7.845154247240499e-03   +1.172080656569544e-01   +9.617624280864825e-02   +1.956437866779588e-01   +1.126654655079127e-01   +1.549258083245440e-01   -7.684217297569947e-02   +3.293195774545017e-02   +4.798810435131504e-03   +1.697699809201657e-01; +7.826337638547951e-02   +1.132651614349340e-01   +9.507439700312958e-02   +1.140160527865333e-01   +2.449268093876766e-01   +1.652456016599675e-01   +6.562678219108146e-02   +5.793169473270450e-02   +1.219694082488319e-01   +3.172733621192826e-01   +1.433296314938854e-01   +2.399978765272288e-01   +5.005083545177701e-02   +2.795024630763444e-01   +1.872346739194198e-01   +5.232884536826447e-02; +2.699025293641455e-02   +6.357900711289222e-03   -1.817579978466870e-02   -1.106357219612452e-02   +4.788535721076294e-02   +1.466032860068594e-01   +9.662689635241695e-02   +1.263701544717987e-01   -2.928208557895693e-02   +2.815177731173397e-02   -3.042531376607973e-02   +9.048883443899061e-02   +1.784337692130684e-01   +1.210255687735059e-01   +8.589180886030873e-02   +9.913068930722840e-02; +3.622670283102597e-02   +1.630842346954173e-01   -6.678006171286187e-02   +1.599879136049034e-01   +1.262296513737616e-01   +2.308399963473205e-01   -8.835196088271930e-03   -5.303024131109356e-02   +2.194904242533661e-01   +1.097793245594376e-01   -2.586546476224537e-02   +1.507119117567375e-01   +8.873306032506315e-02   -6.625153138279768e-02   +1.817316514777522e-01   +5.026651492226315e-02; +9.690960569463730e-02   +7.111558483474738e-02   -1.977179257161200e-02   -7.500620009872032e-02   +1.437011794811065e-02   +1.184708425025938e-01   +1.284278548223338e-01   +9.360500047814149e-02   +2.143746756371090e-01   +1.079881656704832e-01   +8.250146990523169e-02   -5.207882979406091e-02   -3.016556609350076e-02   +2.077163177443490e-01   +2.605980344226526e-01   +4.172938897437603e-02; -1.377673854933164e-02   +2.335196770763013e-01   +1.367388226781446e-01   +2.213434017949585e-01   +1.467567183750044e-01   +1.787368290188887e-01   +3.071302478168035e-01   +1.530034388257756e-01   +3.454561303135407e-03   +4.308589795154302e-02   +2.603641365135996e-01   +7.862723983923717e-02   +1.011793966297691e-01   +5.861255013956695e-02   -1.191625174392321e-01   +1.949325166600684e-01; +1.371389254245391e-01   +1.461135548603934e-01   +2.291192391163189e-01   +1.407661492042692e-01   +8.309647576686631e-02   +1.481296136987762e-01   +1.044220414039476e-01   +7.387974463228225e-02   +3.756190899151789e-02   +7.032196825298818e-02   +1.318659443582555e-01   +2.132176060644468e-01   -1.021625824269873e-01   +2.162709172030674e-01   +1.573439940643782e-01   +1.553657913710187e-01; -7.237704447044600e-03   +1.618077363070070e-01   +1.954266657087735e-01   +2.005743822063261e-01   +1.477612563724980e-01   +7.203062969866095e-02   -2.237371106631413e-02   +1.642994067147406e-01   +6.009645156214554e-02   +3.935031865098801e-03   +9.281092679894119e-02   +2.103495557923456e-01   +1.911066462196524e-01   +1.442190212140951e-01   +1.260289912519140e-02   +4.289456267249199e-02; +5.601452743991428e-02   +1.842519107905620e-01   +1.004665219609588e-02   +2.208151972782845e-01   +8.663998922470115e-02   +6.937554460092053e-02   +1.307446742061616e-01   +2.968635492210426e-02   -1.221980264527210e-03   +2.178521394428805e-03   -1.476974565465746e-02   +8.996105164221702e-02   +4.829533066890215e-02   -5.937246483953989e-02   +2.913354098160841e-02   +8.528511855904572e-02; +1.124051982468214e-01   +2.646339196544463e-01   +2.177072012507962e-01   +7.752429977934448e-02   +1.672590457300397e-01   +7.212790123295043e-02   +1.106831004119734e-01   -5.038476016346050e-04   +1.749886453162305e-02   +9.180893131889103e-02   +1.627498210048892e-01   +1.861705563894563e-01   +2.404261931570149e-01   +2.844038335358849e-02   +1.147396729085468e-01   +1.006116865830863e-01; +2.335235726816459e-01   +1.244077490525420e-01   +1.386357733528227e-01   +1.706867804271935e-01   +1.453338452528261e-01   +1.608580837965450e-01   +2.561944719476325e-01   -3.447058853389758e-03   +9.601161968004523e-02   +5.569088573279452e-03   +1.451345982166918e-01   +1.942219224912083e-01   +2.107234648978340e-01   +5.623010625702610e-02   -7.040879294096910e-03   +2.901793235253729e-01; +7.343460368024815e-03   +5.362271758318421e-02   +8.987503051316562e-02   +1.046482297665683e-01   +6.993311229732044e-02   -2.395970686873204e-02   +1.451973314910147e-01   +2.290790732255305e-01   +8.130813437585283e-02   +1.113169951982126e-01   +1.274096607962228e-01   +8.830496111110964e-02   -2.462796770740820e-02   +4.071423428568124e-02   +3.373133329594877e-02   +1.265323844787474e-01; +1.729184139216308e-02   +1.656982772854231e-01   +1.903223017425698e-01   +4.252298813331778e-02   +1.426009269488162e-01   +8.965199036886726e-02   +2.097457181325845e-01   +1.777460495273177e-02   +7.631493525066682e-02   +5.349495066276144e-02   -5.628594108669043e-02   +2.015804992913299e-01   -2.926642001383210e-02   -5.684989822584887e-04   -5.665223780553006e-02   +2.789572849621137e-02; +1.923992462603903e-01   +1.372291966787775e-01   +1.075526678795455e-02   +7.998248154458093e-02   +4.576921771735561e-02   +1.422796577414595e-01   -6.007965274837263e-02   +5.964749533742972e-02   -2.452240207155425e-02   +5.027280527157393e-02   +1.613821503594370e-01   +5.427020873238275e-02   +1.607880288360770e-01   +1.087300586075575e-02   +5.501622321264520e-02   +3.828173778783794e-02; +2.708834371424484e-01   +1.472039030602007e-01   +1.325251203362171e-01   -1.532849622016361e-02   -6.585544314915810e-02   +8.471465697409085e-02   -4.638881493837842e-02   +2.243088756165590e-01   +2.302585844683306e-02   +1.793612854240885e-01   +2.173531147805824e-02   +1.409626933785675e-01   -4.125603534767881e-03   +1.414771589906634e-01   +2.517823566929333e-01   -1.531381459954227e-02];
L2I_L1I_iGABA_netcon = [+2.199616347205863e-01   +3.695727409970419e-02   +5.314465817216405e-02   +1.551718517337855e-01   +1.272746413947486e-03   +9.813670452834730e-02   +6.648283931188209e-02   +1.768694109356591e-01; +1.135006157055081e-01   -5.218048202318645e-02   +8.575145832756251e-02   +4.640342343498177e-02   +1.041600221859748e-01   -2.355386210891068e-02   +1.212353116086695e-01   +1.196520223266106e-01; +2.254832867904343e-02   +1.284808183989964e-01   +5.934912170788045e-02   -6.525729232904036e-02   +1.826102408189419e-01   +2.441387773967268e-01   +1.919633186250028e-01   -7.840377574161521e-03; -3.996699176117702e-02   +1.899925595866301e-01   +1.104960434655854e-01   +2.186222935050673e-01   -2.583215372531137e-02   +1.324452524688453e-01   +1.386256142590201e-01   -5.345389553887969e-04; -4.670826095542598e-02   +6.494312270327579e-02   +1.021398338323456e-01   -8.352438524299394e-02   +1.743706203155010e-01   +1.528155524765676e-01   +1.324993711937041e-01   +6.520471536155484e-02; +1.524992452485982e-01   +1.319535867484105e-01   +5.561047605966289e-02   +4.925989699510840e-03   +1.927650552932655e-01   +3.081362335423904e-02   +1.936645689631349e-01   +4.616374828201786e-02; +5.233592786042694e-02   -1.793042784973617e-02   +8.489177247743680e-02   -4.835505356621565e-02   -5.859964704872715e-02   +1.587866270678907e-01   +5.016249733960713e-02   -1.043990128323335e-02; +1.526821455545437e-01   +1.316652986830147e-01   +1.728918673430334e-01   +1.644064662131847e-01   +8.518970239443523e-02   +4.695843464539370e-04   +1.875840898356247e-01   +1.232167055152291e-01; -5.382210085573269e-02   +1.263454310441547e-01   +9.429959211097136e-02   -1.795894961329914e-02   +8.721631066891683e-02   +2.224109267403972e-01   +1.707059571991094e-01   -4.131624440246306e-02; -1.485914076291430e-02   +2.506517572287557e-01   +1.766832844853763e-01   -9.632333276786600e-02   +8.418500839192042e-02   +1.253511639801760e-01   +8.393150717147232e-02   +1.442437009826915e-01; +2.111199414128563e-02   +1.552793661756057e-01   +1.011440380267788e-01   -5.251452280791851e-02   +1.060106272981818e-01   -7.376948951146170e-03   +9.614737618427241e-02   +1.117889146225128e-01; +1.221077381807683e-01   +1.538362978656576e-01   +3.519667632966057e-02   -6.744362388000778e-02   +1.264290856738663e-01   +1.332951013044461e-01   +1.642054837593742e-01   +5.094089886863851e-02; +1.624604994859111e-01   +1.473034597808446e-01   -2.748391724536900e-02   +1.423633552140116e-01   +5.957328830745656e-02   +1.640622437464516e-01   +5.061903868145211e-02   +4.926717005388300e-03; +1.223628688592424e-01   +1.163327433620108e-01   +2.244587737414373e-02   +1.882920120011640e-01   +8.195012777857502e-02   +8.227391523707009e-03   +2.487417874033684e-01   +2.820198478338713e-02; +1.027242908721023e-01   +8.943083707085220e-02   +2.178343948081896e-01   +2.357534208038699e-01   +1.738589389422729e-01   +9.204597816525720e-02   +2.155682432508866e-02   +1.259555089311458e-01; -1.427378807162902e-03   +2.495048399537211e-01   +1.218669383233532e-01   +1.739426398621093e-01   +3.266794627179151e-02   +1.692770596594964e-01   +2.065682129652641e-01   +9.493203278474756e-02];
L1I_L2I_iGABA_netcon = [+1.499290844207949e-01   +2.599904984154683e-02   +2.024715294148304e-01   +6.311003639387555e-02   +2.880407155140581e-02   -3.893487648637397e-02   -3.026613058969243e-02   +9.836823490723892e-02   +7.406561953350801e-02   +9.529983500224010e-02   +3.719349187065754e-02   +5.719317648739382e-02   +1.020533157736754e-01   +1.136386393674514e-01   +2.241836313124252e-01   +6.739372766774007e-02; +4.827828182541830e-02   +1.543746752984812e-01   +4.708977409794939e-02   +2.787592394227805e-02   +6.953697090887147e-02   +2.532269188641217e-02   +2.094021608697297e-01   +1.932070734041443e-01   -7.659168178936325e-02   -2.159809623325293e-02   +1.055958577619741e-01   +5.994658523293507e-02   +1.786423437412076e-01   +1.618323974210604e-01   -4.010322850663135e-02   +5.560744155993826e-02; +5.250174922243867e-02   +1.074241129403470e-01   +4.867699376235282e-03   +2.153018545866433e-01   +9.846830820765776e-02   +1.253890470420450e-01   +1.371907118658703e-01   +7.719703082427654e-02   +2.073675642462006e-01   +4.259926720897586e-02   +7.820477932730742e-02   +8.749201379789319e-02   +5.374167421938311e-02   +1.223737828351281e-01   +1.150933248531744e-01   +2.026425431126962e-01; +1.031660143967900e-01   +6.813927626065763e-04   +1.609699206190189e-01   +8.550187506225859e-02   +2.523837548254955e-02   +1.707992735574640e-01   +1.441560221294438e-01   +1.038190322154355e-01   +8.416654882059407e-02   +3.496912034281134e-02   +2.750437214185479e-01   +9.227780118103622e-02   +9.384785566014389e-02   +1.191028540451776e-01   +7.037952383847491e-02   +1.867568330148094e-02; +5.853382718593727e-02   +1.028701006151055e-01   +7.769099999034662e-02   +1.749554061315777e-01   +2.733585250002379e-02   +1.909189710825785e-01   +1.131946721240767e-01   +7.059802745916431e-02   +1.540431405530141e-01   +1.593771317996254e-01   +7.632458517231039e-02   +9.278767457665352e-02   +1.878084671653715e-01   -9.254154227085826e-03   +1.453670659596917e-01   +2.456415576960632e-02; +7.607675134759949e-02   +1.347453284768588e-01   +3.410503896716452e-02   +1.308370315178114e-01   +5.346959439487440e-02   +1.588049126779808e-02   +7.616131339585870e-02   +1.849515065501271e-02   +1.543010628571691e-01   +1.420668116821365e-01   +1.430587923364030e-01   +1.247856271511117e-01   +1.607352654428202e-01   +6.009328868447394e-02   +7.522149125942604e-02   +1.778614255829115e-01; +1.803055617616890e-01   +1.792425341288795e-01   +2.401148434465472e-01   +1.065713950585276e-01   +1.786518522411480e-01   +1.610271866010201e-01   +7.353244215466895e-02   +1.040920001171378e-01   +1.171028231060186e-01   +2.196914959659358e-01   +2.333611160377470e-02   +2.223996566613711e-02   -6.747788271375477e-02   +1.238343898154813e-01   +1.763233924689779e-01   +3.732214635385760e-02; +2.372135681001724e-01   +3.597438613169748e-02   +2.089286897627012e-01   -6.454969028650623e-02   +1.229802487986379e-01   +2.020864136154716e-01   +3.982975345486815e-02   +2.013654758952100e-01   +2.192090959251816e-02   +2.357989937361065e-01   +1.754335824718325e-01   +5.091654378336669e-02   +8.921504077017134e-02   +7.661449835819883e-02   -6.261063680457125e-02   +6.789803567004961e-03];
L2E_L1E_iAMPA_netcon = [+2.872887102526939e-02   +4.069305021286194e-02   +2.109018965246183e-01   +3.257541910324507e-02   +3.557720471104488e-02   +5.793879916886494e-02   +1.241147405150780e-01   +2.422143710444800e-01; +1.223846341622098e-01   +1.974816239027595e-02   +1.495234274106718e-01   +2.009460581223589e-01   +1.944902430959224e-01   +6.689131870229520e-02   +1.302951634761349e-01   +4.542717715192877e-02; +2.043792879577101e-01   -3.251801139071048e-02   -1.595825280206891e-03   +1.904760937588348e-01   +7.386871702781282e-02   +1.767622544152949e-01   +4.904442342823682e-02   -1.645428571772484e-02; +8.061161436243319e-02   +1.176127065324911e-01   +7.216003857939976e-03   +7.360882926038281e-02   +3.874547178246140e-02   +2.686475913588609e-02   +2.630144752342424e-02   +8.457159016012041e-02; -2.126266362035380e-02   -6.325124886491051e-02   +1.861488249048945e-02   +1.848997615180173e-01   +1.721596539991811e-02   +1.034206572265789e-01   +8.758694547569511e-03   +2.612109384714318e-02; +1.107656944974365e-02   +1.640211702397638e-01   +6.056931457852582e-02   +2.288033078546270e-01   +3.105643600505552e-01   +1.816922696278013e-01   +1.125365954575336e-01   +2.151979656918038e-01; +1.808628873651339e-01   +3.836234078695450e-02   +3.242522599074765e-02   +2.213148056171541e-01   +2.431475104267137e-01   +1.612492421462838e-01   +8.529874301620671e-02   +5.591724939728901e-02; +1.020973355519997e-01   +8.476951864607780e-02   +3.706588114534189e-02   +2.312921305099781e-01   -2.339545082250025e-02   +1.184971238710652e-01   +3.511415914637241e-02   +2.364457678242571e-01; -1.744605411756854e-02   +3.624014691409631e-02   +1.179113295725124e-01   +2.606111300565976e-01   +7.107019426534623e-02   +8.237271174566368e-02   +1.133721097540451e-01   +2.290266121510608e-01; +4.084071822298731e-02   +1.785261693236024e-01   +1.308823074689504e-01   +1.298339071151507e-01   +1.086840117760401e-03   -4.193275117360243e-02   +8.329041127142428e-02   +7.062947055322971e-02; +7.758928710742802e-02   +8.106553998465194e-02   +1.224082604859013e-02   +1.313098993638517e-01   +1.046033484646156e-01   -1.064352875244895e-01   +1.332808573719150e-01   +3.479665783760307e-02; +9.603327056838314e-02   +8.364073493444671e-02   +1.724418125260488e-01   +1.584221309842327e-01   +1.069154695751405e-01   +1.659351706966776e-01   +9.677813123648535e-03   -2.589651787635805e-02; +3.332832636164475e-02   +1.829424095894310e-01   +2.649554959370408e-01   +1.847731485803281e-01   +1.278351400337355e-01   +7.317002533320938e-02   +1.020671529731719e-01   +2.462364729892512e-01; +1.945106535350544e-01   +1.726913068500749e-01   +2.300676397286958e-01   +3.038568594076466e-02   +9.894730349793902e-02   +1.025512940548894e-01   +8.731730295963742e-02   +1.780810395421913e-01; +1.568982105548964e-01   +4.381608580837976e-02   +8.347217986781108e-02   +2.390484778107048e-01   +1.169393524185928e-01   +1.236268087143623e-01   +9.255495887563295e-02   +1.108232388419882e-01; +1.635650413572375e-01   +2.493369464898837e-01   -1.857704006388181e-02   +1.554677486402571e-01   +1.689121474397323e-01   +2.115957281910325e-01   +7.762749448423506e-02   +1.338609391441906e-01];
L1E_L2E_iAMPA_netcon = [+1.173150192713710e-01   -2.506359787982541e-02   -3.576480582421015e-03   +4.036774429262702e-02   +1.793224370321717e-01   +8.825792996005452e-02   +6.293167806538000e-02   +2.086120135945927e-01   +3.022120161905431e-01   +3.070827147761866e-02   +2.063449093191280e-01   +1.333339943177401e-01   -1.097671730368160e-02   +8.969504525517397e-03   +5.665876594373623e-02   +4.905643019993363e-02; +1.580871613073177e-01   +8.534326326269955e-02   +1.330436938783730e-01   +6.690681317454586e-02   +3.936946129693610e-03   +2.379847798255117e-02   +2.490774220093876e-02   +2.240341037169996e-01   +2.221625385569259e-01   +1.492911868707212e-01   -9.297137591697244e-02   +7.971041128365126e-02   +1.147451629572987e-01   +1.512624630261498e-01   -2.453205648802521e-02   +6.778105480143742e-02; +2.031120703120298e-01   +1.247590781909326e-01   +1.456515844744665e-01   +1.042703838905647e-01   +3.214983829362084e-02   +4.115596273312438e-03   +1.819140023474248e-02   +7.917130885337231e-02   +7.814009095610815e-03   +1.237189731304525e-01   +5.654808139017112e-02   +2.360945259121873e-01   -1.080485558154122e-02   +1.792122038605492e-01   +1.596407661241223e-01   +2.800363375678276e-01; +4.031006178285677e-02   +1.137119657251243e-01   +5.150615661562685e-02   -1.122829620184890e-02   +1.927364644390795e-01   -3.045636038373505e-02   +1.173243230623342e-01   +2.270202893114008e-02   +1.756945394567601e-01   +2.534415913553585e-01   +2.140512870208754e-01   +1.374132315970759e-01   +4.066194347238965e-02   +1.855936987672530e-01   +1.551695799322025e-01   +2.644324844732433e-02; +3.140981886803804e-02   +1.047894958875829e-01   +2.192156281558457e-01   +3.940445554685698e-02   +4.369666943249770e-02   +3.022332932404024e-01   -2.366757934522503e-02   +2.063178728689796e-01   +2.000493142659018e-01   +9.077647594744226e-02   +1.549907969759454e-02   +1.682282293343840e-01   +2.000242511675911e-01   +1.992473701794265e-01   -4.656057896124852e-02   -8.708905949399791e-03; +5.039274854144748e-02   +1.201534035111171e-01   +1.071971840781184e-01   +1.740619653782497e-01   +1.169717964618766e-01   -3.901487333721856e-02   +2.145914703422217e-01   +1.302494350062567e-03   +1.963040718031294e-01   +6.958848663186679e-02   +1.416424935533490e-01   +6.673582025052577e-02   +2.157336700424552e-02   +1.298670829574119e-01   +8.798190234288328e-02   +3.853759002090749e-03; +1.737657559307632e-01   +2.515038794278352e-01   +7.776718306098079e-02   +1.424144299317475e-01   +2.102355688173219e-01   +2.079949866946024e-01   -3.033824081151080e-02   +8.054176314415504e-02   -5.014640985346154e-02   +2.651313273654550e-01   +4.589011023760015e-02   +2.287336876859055e-01   -6.678888863068040e-02   +3.299983739683575e-02   +1.098575663584760e-01   +1.617237830549352e-01; +1.917705587861137e-03   +1.526307023941999e-03   +1.566721995394945e-01   +1.315496353950468e-01   +1.138213626015813e-02   -2.400150001404126e-02   -7.933829981508692e-02   +1.170960769779904e-02   +1.475924496334588e-01   +1.992957762193910e-01   -3.798910483294679e-02   +9.618339643432834e-02   +5.465392899798222e-02   +1.541795456788221e-01   -8.499496327810238e-02   +8.076743838807779e-02];
L2I_L2E_iAMPA_netcon = [+1.070566994933208e-01   +1.753122827339046e-01   -7.913784063404448e-02   +1.771291919763771e-01   -5.254676845653783e-04   +6.136917172471062e-02   -3.911281450519384e-02   +1.128304821762254e-01; -6.345685118955983e-02   +2.603544682924084e-01   +2.369523723364618e-02   +1.396722639738031e-01   +4.000574639577044e-02   +1.041136167057874e-01   +8.756394687543449e-02   +9.267262578750088e-02; +8.049098326138035e-02   -4.519715665846288e-03   +2.120021657355852e-01   +8.050377345513578e-02   +9.509861758717297e-02   +1.352463442943876e-01   +9.086518649218282e-02   +2.212162545450605e-01; +1.398910768785996e-01   -3.851504994435306e-02   +1.653362313314331e-01   +9.470814292415169e-02   +3.169790376493678e-02   +8.809735746066609e-02   +1.972911926427588e-03   +4.451429568461393e-02; +1.934885026728753e-01   +1.681938808022452e-01   +4.674309844605564e-02   +1.596008851743694e-01   +2.609349149056391e-02   +1.971725969397475e-01   +8.382157045548909e-02   +8.834727948894779e-02; +1.462241885663321e-01   +5.398799008376828e-02   +8.062588124066378e-03   +4.682063148618582e-02   +3.475400776622874e-03   +2.381924981797264e-02   +1.927078228055020e-02   +8.942735467805674e-02; +8.077722210034438e-02   +1.063413182974285e-01   +5.033972412051423e-02   +5.469604819269129e-02   +2.462593506357921e-01   +8.194092289938790e-02   +2.480896546553934e-01   +2.359490379751812e-01; +7.763722201330726e-02   +1.840705687636228e-01   -7.734432078915487e-02   +2.563615329232525e-03   +2.113978049070738e-01   +1.354931174398805e-01   +2.340329530735009e-01   +1.736039201228821e-01];
L2E_L2I_iGABA_netcon = [+1.237963159354951e-01   +4.954964361247401e-02   +1.172966949386983e-01   +2.424973215472873e-01   -5.958798496642739e-02   +1.712046617265107e-01   +1.996921398148435e-01   -1.473710810362926e-02; -6.673619512549292e-02   +4.935367494200776e-02   +1.755535482496488e-01   +4.679192590443020e-02   +9.306743352189085e-02   +1.098487566318463e-01   +3.096663288218280e-01   +1.552392422716965e-01; +1.096054496408856e-01   +6.485205143851303e-02   +1.269991034252132e-01   +6.403664282139429e-02   +1.886800458077767e-01   +5.197114504110661e-02   +9.595978321158702e-02   +2.290550529627552e-02; +1.164900055088998e-01   +1.988257867501238e-01   -3.819457685271391e-02   -8.091230001865235e-02   +1.800616826545834e-02   +1.785703966792802e-01   +2.083259363238962e-01   +4.373675741972663e-02; +1.991924274950439e-01   +3.239383215616481e-02   +1.184703949752413e-01   -4.320931152271175e-03   +1.362779839314605e-01   +1.018908124725354e-01   +1.664723229974581e-01   +1.157014571602490e-01; +1.823259625678408e-01   +1.127373062327908e-01   +1.233667128241518e-01   +8.759774495363858e-02   +1.964323851246333e-01   +7.548407590044301e-02   +1.181155749265872e-01   +1.857285896781633e-01; +3.492106369700690e-02   +1.208989000024623e-01   +1.531843301668399e-01   +9.628264770233289e-02   +1.484225689351029e-01   +1.130408244342691e-01   -4.905499092032935e-02   +6.834411255503715e-02; +1.084173805607695e-01   +1.139601539269094e-01   +2.860865542198182e-01   +1.769223154822394e-01   +2.542097000922416e-01   +1.722010038697153e-01   +1.398216727519720e-01   -5.569472997182337e-02];
L3E_L2E_iAMPA_netcon = [+1.575861974477483e-01   +1.350253254471827e-02   +2.963656354167175e-02   +3.955658999286973e-02   +2.589332478571412e-01   +1.774392355609196e-01   +4.101654166020233e-02   +2.778386065864732e-01   +6.411769754078253e-02   +1.343601189887241e-01   +2.510213144537351e-01   +1.921481675823504e-01; +1.291074289309301e-01   +2.641042852659480e-01   +1.731442431167176e-01   +1.687910401399780e-01   +3.474236431582969e-02   +1.547938421653728e-02   +1.101299381309644e-01   +8.423718617070639e-02   +4.495092723580030e-02   +6.004590187607452e-02   -1.779318618168987e-02   -1.675966028595827e-02; +3.194822082056659e-01   +1.698138428080481e-01   +1.392123426694747e-01   +2.172958817760818e-01   +1.084896453643360e-01   +1.355469719170661e-02   +1.971934098524161e-01   +2.158528290280057e-03   +9.888524149806710e-02   +1.527052071336650e-01   +1.654380317519195e-01   +1.108137381257910e-01; +6.798281577099663e-03   +1.418600769670778e-01   -5.227693530363541e-02   +6.952984341805114e-03   +1.064155851247054e-01   +1.477738978712002e-01   +2.046005404273087e-01   +7.404369822944221e-02   +1.747046852389066e-01   -2.743590328810112e-02   +2.679336005239129e-02   +1.142916348326391e-02; +1.655988698845227e-01   +7.426596820307695e-02   +1.429629928423365e-01   +4.863741642055848e-02   +5.536141313714334e-02   +1.873328496633952e-01   +2.680262419651023e-01   -1.899755132516645e-02   -3.862158240457662e-04   -1.392410833559224e-02   +2.655142871295001e-01   +1.680569717359320e-01; +1.468086987403135e-01   +1.405974393934131e-01   +1.824924060455957e-01   -1.358120918769832e-03   -9.190654366075084e-02   +1.010782250636689e-01   +1.116728037894636e-01   +2.028590414925018e-01   +9.912015876848389e-02   -3.205293141838154e-02   +1.530171813174301e-01   +1.146699614396971e-01; +1.595445107657493e-01   +5.290809995671839e-02   +1.092311578130354e-01   +1.916817862844464e-01   +7.607474970316511e-04   +4.581351694696135e-03   +2.355820820693745e-01   +3.455849447243274e-03   +7.760890385764932e-02   +8.809864235387524e-02   +5.181157333786887e-02   -1.474725177430834e-02; +1.554201431714071e-01   +1.452869615101589e-01   +1.463529813301873e-01   +3.490457288097856e-02   +1.822965736605629e-01   +5.130460639446956e-02   +2.378014516899631e-01   +1.252841807196837e-01   +2.522348713416563e-02   +1.104327210858352e-01   +2.555671745415005e-01   +9.560675057486963e-02];
L3I_L2I_iGABA_netcon = [+1.167661550274659e-01   +1.834685122085859e-01   +1.791492812797036e-01   +6.223050377234975e-02   +8.698212338741847e-02   +1.512021960675623e-01   +1.846951263708725e-01   +1.713345383071149e-01   +1.894147900912050e-02   +5.689463831531615e-02   +1.348250102073264e-01   +1.912658080141393e-01; +3.799987431115427e-02   +1.634577813155414e-01   +9.408775592325007e-02   +2.171799242464501e-01   +2.147433329842623e-01   +2.440114302710620e-01   +1.033049339790711e-01   +2.564789551305116e-01   +6.058468602508315e-02   +1.520213771455560e-01   -8.683687920425738e-03   +4.854118393812056e-02; +1.694856171763546e-01   +1.172513870918474e-01   +1.733018987472369e-01   +2.118517195420478e-01   +1.418737697468756e-01   +6.994681652745603e-02   +1.508545636927410e-01   -3.521036831831040e-03   +2.902151510374886e-01   +1.133933803622903e-01   -2.440067719421597e-02   +3.187446621778094e-02; +1.310186216496846e-01   +1.284076560304797e-01   +1.239224143235119e-01   +8.431599514463134e-02   +2.132319618016275e-01   +2.146332150383596e-02   -1.086329743956269e-01   -2.268055382835630e-02   +1.949992402330307e-01   +2.034468744499437e-01   +1.001414670675336e-01   +1.357501504548388e-01; +1.170663239585265e-01   +2.708544867972029e-02   +1.459013168703944e-01   +4.554109055066945e-03   +1.030712486335981e-01   +5.392448392124305e-02   +1.238861707425942e-02   -1.131417845901014e-02   +1.552301831574779e-01   +3.932615151855303e-02   +2.822628145343306e-01   +9.204524347112378e-02; +2.028278306074212e-01   +3.303029368876883e-02   +1.093147469276925e-01   -7.048200914820821e-03   +1.432473331294309e-01   +1.332784897841736e-01   +3.073408979093391e-01   +8.584221557549189e-02   +2.238614276192610e-01   +2.088959209198599e-02   +7.664771379385282e-02   +6.886917947125099e-02; +1.028850670454848e-01   +1.612617460304845e-01   +1.593187267761750e-02   +5.055841658117771e-03   +1.610233773130746e-01   +2.135824438830043e-01   +1.467950273555355e-01   +1.245267507326220e-02   +1.312797744305878e-01   +8.247132958014457e-02   +4.170114464962354e-02   +3.906308138878142e-02; +1.349532769048949e-01   +1.577927085300848e-01   +1.963526142077621e-01   +5.648813886215147e-02   +9.417161246299344e-02   +6.363230205919035e-02   +8.119126767502460e-02   +1.177848751842533e-01   +6.070590967847807e-02   +7.911511860751588e-02   -7.034939927359006e-03   -1.541747338033841e-02];
L2E_L3E_iAMPA_netcon = [+1.161078197883781e-01   +1.661933270399302e-01   +1.640936869206530e-01   +8.246483479673311e-02   +9.766200671859016e-02   +1.324674220330623e-01   +8.842523689095713e-02   +2.903040820788982e-01; +1.819766111381052e-01   +8.967847016642917e-02   +1.394099228815742e-01   +5.554162587721200e-02   -7.597455998844932e-02   +1.397259945854792e-01   +1.764963554384935e-01   +1.566857623896380e-01; +3.315796083214029e-02   +7.980050845590253e-02   -2.239173202370327e-02   +2.363739388319999e-01   +1.839761482661865e-01   +6.876313465165031e-02   +1.537916241951618e-01   +1.691412832384618e-01; +1.215698516295751e-01   -1.198895576005344e-02   +3.407295098271398e-02   +1.158199067511819e-01   -4.267297145439976e-03   +1.455780498188232e-01   +6.101665496147418e-02   +1.611671222680763e-01; +1.886534828418859e-01   +1.847069320851547e-01   +1.986523862557493e-03   +1.710332123201733e-01   +3.724703377472863e-02   +1.413005447098723e-02   +2.615992694784573e-02   +1.715532418802039e-01; +1.084523476076286e-01   +1.614760494640487e-02   +7.610358880189579e-02   +4.966831345588302e-02   -8.156757540773045e-03   +1.019782319117598e-01   +2.037385398455312e-01   +1.184992692883316e-01; +7.497044333043504e-02   +1.267802205607444e-01   +9.298138259014829e-02   +1.295332423468128e-01   +1.130274749962163e-01   +7.857979366938490e-02   +1.068539690624977e-01   +2.321660244999872e-01; +1.598119525058305e-01   +8.017705397787100e-02   +1.627568717502482e-01   +1.673591190641686e-01   +1.275123010450556e-01   +1.391153913425930e-01   +1.214029826438079e-01   +8.003533018698554e-02; +6.144830868453938e-02   +1.188088565125118e-01   +1.000957162174057e-01   +1.948883306723218e-01   +1.519537130682593e-01   +1.067035517452554e-01   +2.075318543643880e-02   +1.739499997386224e-01; +6.599996564265034e-03   +1.019955015029130e-01   -2.357500097903349e-02   +5.307384066814781e-02   +6.041072524989651e-02   +6.491441057293873e-02   +1.980499725030433e-01   +1.397669828392390e-01; +1.014248479816877e-01   +5.900442631944372e-02   +9.816599317657970e-02   +9.409562803986884e-02   +2.165583954316818e-01   +1.122672074555368e-01   +1.412926494803523e-01   +8.432224156672571e-02; +1.581499986218521e-01   +8.240363512840976e-02   -1.811698240500917e-02   +1.405485905026356e-01   +1.843607631905801e-01   +4.174159147767574e-02   +8.611760709730185e-02   +1.061325009826461e-01];
L2I_L3I_iGABA_netcon = [+1.078231963162862e-01   +2.385067275717891e-01   -6.506719897896045e-02   +1.430934977653933e-01   +2.648149354744139e-01   +1.700032598752781e-01   +1.686660095858159e-01   +1.351581858028687e-01; +1.700339215983760e-01   +9.878744125977210e-02   +1.222920777888111e-01   +9.776295868702889e-02   +7.834298544120478e-02   +1.495651043398603e-02   +8.159345542393834e-02   +1.651134698010282e-01; +2.382857275852576e-01   +1.606266428198260e-01   +1.246058980628687e-01   +1.557668682974595e-01   -6.008300299517715e-02   +7.670189315189664e-02   +1.965831821411891e-01   +2.173267802202121e-01; +1.726821947638571e-01   +2.200527693448463e-02   +2.715617419840492e-02   +3.402382666757193e-02   +7.062984196614297e-02   +1.274449199122996e-01   +4.873449279014853e-03   +1.145336579471941e-01; +1.041403494527193e-01   +1.804723482868638e-01   +6.152008094817013e-02   +3.544144473928431e-02   +7.061178873001432e-02   +1.380428201284481e-01   +9.152075032300519e-02   +1.862136800362688e-01; -4.663680661641183e-02   +1.395568170598678e-01   +1.449575085965336e-01   +1.569660964915328e-01   +3.232476775351989e-02   +5.451444775685006e-02   +1.917497432012203e-01   -4.437586340355418e-03; +1.102416695841851e-01   +6.679930763228273e-02   +2.025408317338606e-01   +1.049944571309012e-01   +5.009873122850979e-02   +9.468616231524932e-02   +2.417659631927855e-01   -3.128947238721701e-02; +1.059279035172273e-01   +1.488608040232529e-01   +7.041992388994273e-02   +1.611138810401333e-01   +7.162486858261673e-02   +3.183472330335051e-02   +9.361296149686063e-02   +1.325414663919371e-01; +1.430846126722017e-01   +3.246452067875083e-02   +3.478831123238954e-02   +2.296713489185326e-01   +1.208825526746079e-01   +1.373527718337143e-01   +6.753399891385675e-02   +7.337972491967787e-02; -4.662600082211617e-02   +6.021028422466657e-02   +1.045971311358767e-02   +1.523174327381420e-01   +2.011073491490564e-01   +1.172244932258735e-01   +6.341903976540961e-02   +1.104380275476438e-01; +1.619399416549775e-01   +1.595253521943093e-01   +1.059508759986044e-01   +2.170476740222822e-01   +1.563788884509760e-02   +2.442835300828320e-01   +1.931409976241417e-02   +2.913442664683972e-01; +1.164233860616768e-01   +4.642505286368614e-03   +1.682102642256069e-01   +9.610381131529019e-02   +1.225063871380409e-01   +9.280011377960985e-02   +8.203091101801391e-02   +1.172577341252481e-01];
L3I_L3E_iAMPA_netcon = [+1.571429085246384e-01   -5.231294323441174e-03   +1.140561563427362e-01   +1.601535079618951e-01   +2.052946511267572e-01   +1.373593590246316e-02   +1.364154589648234e-01   -1.329927562641164e-03   +1.209373768880798e-01   +1.131066377901276e-01   +3.129933505052959e-04   +1.444657420938120e-02; +1.518266252649412e-01   +9.753394423462394e-02   +1.474569037711156e-01   +9.679081095746717e-02   +3.134316510357978e-02   +8.695412609564469e-02   +2.752536762353778e-02   +2.071809687832810e-01   +1.787736253622244e-01   +1.430841716835680e-01   +2.839972319599651e-01   +1.818661771878415e-01; +9.287237367834726e-02   +1.056569631552374e-01   +1.778616505226084e-01   +1.135962745342166e-01   +6.445467077605556e-02   +1.627844995358824e-01   +1.025096186851344e-01   +1.602057489253582e-01   +6.375775031396913e-02   +1.040530685421122e-01   +1.930955188875668e-01   +1.786021110230869e-01; +1.174646838091880e-01   +5.235354792877001e-02   +9.865151365665722e-02   +2.479156016897750e-01   +4.133206173422957e-02   +5.770564098196668e-02   +1.440004960295621e-01   +1.337895817068591e-01   +4.207620725858355e-02   -2.909111080156713e-02   +3.969042923428551e-02   +3.680591210927536e-02; +2.052492185617669e-01   +4.585502949992916e-02   +7.436816787611181e-02   +1.859634450336819e-01   +7.668485825292734e-02   +2.449919428834042e-02   +1.139491852863956e-01   +3.101702064925999e-02   -8.434345287669356e-02   +1.510707383539670e-01   +1.311897729393172e-01   +1.418443513558090e-01; +1.864267266542908e-01   +1.548070676991735e-01   +2.364826964325204e-02   +8.136691669503389e-02   +1.445976061208555e-01   +1.492088886472440e-01   +1.268029602233056e-01   -3.404211144695600e-02   +5.968429777530838e-02   +5.317009210343069e-02   +1.148538759526631e-01   +2.246626780792433e-01; +3.726940379977130e-02   +9.373639510430706e-02   +1.422861215796829e-01   +9.380596583354163e-02   +5.917389526511198e-02   +1.914340658778689e-01   +1.858667149015921e-01   +1.260693773818204e-01   +1.773833323255604e-01   +2.023835394872348e-01   +6.680294957947047e-02   +1.672599566052440e-01; +1.291882113379732e-01   +1.861044813436399e-01   +5.121936047826605e-02   -6.220823626582765e-02   +2.304269776015402e-01   -2.936854881951945e-03   +7.339459693441525e-02   +2.165916085676574e-01   +1.229741262430855e-01   +2.050373228943173e-01   +1.517831485907802e-01   +1.227284691582969e-01; -1.115807535053522e-02   +1.374979108199575e-01   +7.165044774301042e-02   +1.157981862553243e-01   +1.671946464041868e-01   +7.878091963720855e-02   -1.898603318504528e-02   +1.986390849632900e-01   +9.095227266992212e-02   +1.702939446107306e-01   +1.935159929340977e-01   +3.239796833677610e-02; +7.581387162982575e-02   +6.671682625156623e-02   -1.801936448638951e-02   +9.549338002189668e-02   +1.034239987010871e-01   +2.502791897697519e-01   +7.654639035890516e-02   -6.856019122371812e-02   +1.463233219532110e-01   +1.541268738484879e-01   +1.469436086219674e-01   +6.562973379573106e-02; +1.370019041368304e-01   +1.658957975086221e-02   +1.917743486731060e-01   -9.342260751426044e-03   +1.455994825012940e-01   +1.148971364349501e-01   +1.487937760909846e-01   +6.365758405036581e-02   +1.476399658672473e-01   -2.241893787630730e-02   +1.853701638315151e-01   -9.021131487324655e-03; +1.819503764966017e-01   -6.641983291833244e-02   +9.058145178904328e-02   +2.005461224361441e-01   +9.184019608750360e-02   -2.947678152850613e-02   -7.821461264881624e-02   +2.129259197981879e-01   -4.510480232464392e-03   +2.009233047617010e-01   -9.413657656212608e-02   +3.175808903888962e-02];
L3E_L3I_iGABA_netcon = [+1.537193728349315e-01   +1.003971840075342e-01   +8.363409456351734e-02   +1.657815045920168e-01   +1.814006111735637e-01   +2.140419831028823e-01   +8.155825199058973e-03   +9.840788735820033e-02   +2.400842239685955e-01   +1.771903064280643e-01   +1.719455911541850e-01   +1.055728727982771e-01; +1.418333011145478e-01   +1.117235909927164e-01   +1.090552266272820e-01   +7.093665766327495e-02   -9.757487271975618e-03   +2.566839437374007e-01   +1.610814098273051e-02   +1.734405112439757e-01   +1.200432342214548e-01   +1.277298686445798e-01   +1.900119199058500e-01   +2.055352943353431e-01; -1.876952932535868e-02   +1.100409982529341e-01   +1.011016436366000e-01   +1.080044886981075e-02   +1.460101615704370e-01   +1.084660880470362e-01   -5.928695511953151e-02   +9.181149907447331e-02   +2.773778951246292e-01   +1.318247513741261e-01   +1.283533298371602e-01   +3.093026965409721e-02; +5.495050448783229e-02   +6.121024963788649e-02   +9.706747626771259e-02   +9.795739025003464e-02   +2.879850563326943e-01   -1.707528978538733e-02   +7.381787548069631e-02   +1.451428346793275e-01   +1.558668475101044e-01   +2.328152002272192e-01   +7.468399475866548e-02   +1.180654378370608e-01; +2.311637405052309e-01   +1.573324418621442e-01   +2.457923798958815e-01   +2.048687918761833e-01   +2.447775005164944e-01   +6.776014927276403e-02   +1.096027465010750e-01   +8.998563320376338e-02   +1.157465380504961e-01   +2.185876668634453e-01   -8.826399163431347e-03   +1.576885429821843e-01; +9.143810391136369e-02   +2.880072836174763e-01   +8.312293404845354e-02   -3.664057599728401e-03   +2.005922201844556e-01   +7.032295141302090e-02   +1.707824863676568e-01   +1.338046446215330e-01   +7.682283369251577e-02   +9.288668368562789e-02   +1.407723969609862e-01   +2.113185645186948e-01; +1.227434159142243e-01   +8.968540769886735e-03   +6.705186256530948e-02   +3.590706232728516e-03   +3.338005175305417e-02   +1.828840238323876e-01   +1.017546794571530e-01   +1.491158109429721e-01   +2.614465073855113e-01   +4.153024085600972e-02   -2.513446922877823e-02   +2.255267296190659e-02; -7.707857212235852e-02   +1.111832353515212e-01   +1.447947144146123e-01   +1.889142196074884e-01   +5.579886255475876e-03   +8.388808733217709e-02   +1.335730663683520e-01   +1.018048675509486e-01   -4.362719371806400e-02   +1.205951302957586e-01   +1.711184446008282e-01   +4.224985618973429e-02; -3.149159370884951e-02   +8.744287564093198e-02   +1.186609360199915e-01   -2.034896767019751e-02   +8.727811728576909e-02   +1.984903299329385e-01   +2.742686111022343e-01   +7.780440571276692e-02   -1.099644013206581e-01   +1.287774487152125e-01   +5.778573637042046e-02   -1.751363385355169e-02; +1.700162871046738e-01   +1.641624327893168e-02   +9.118355295292604e-02   +1.951560874406152e-01   +1.360242800384605e-01   +1.411516421283011e-01   +1.234259408218850e-01   +1.901842048943254e-01   +4.843525189278083e-02   +6.197349916190657e-02   +7.675267463607516e-02   +1.843360372858253e-02; +2.350973177772880e-01   +4.661142163851378e-02   +3.824780929459842e-02   +1.058930324797555e-01   +1.248484085351810e-01   +5.100273954535807e-02   +2.057445408022293e-01   +1.500029033848491e-01   +1.175915672684926e-01   +4.601774790141763e-02   +6.263233577698570e-02   -6.990863331318070e-02; +8.887052445709670e-02   +1.293937335072134e-01   +1.048233030457694e-02   +1.947081923551603e-01   +1.624975224825917e-01   -2.945235903144634e-02   +8.894087938812413e-02   +1.161788000045500e-01   +1.881350301912030e-01   +8.908752368953646e-02   +1.664180672998714e-01   +5.611432784394570e-02];
L2E_Input1_iAMPA_netcon = [+1.369079586405964e-01   +2.266364134117121e-02   -1.203229443682556e-01   +2.314994938211776e-01   +4.677526079186607e-02   +1.329960642861366e-01   +5.241672902717717e-02   +8.852704913198894e-02];
L2I_Input2_iAMPA_netcon = [+7.255946189638687e-02   +6.637335260412817e-02   -2.068766079844623e-02   +2.074840946569326e-02   +2.484002825841593e-03   +4.469348487248799e-02   +1.025417860790553e-01   -1.076723199562822e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.8*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.8*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
