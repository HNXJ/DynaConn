function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.948553311993001e-03   +6.040491897824260e-02   +1.099186505168909e-01   +8.278116259406623e-02   +7.625079174110810e-02   +1.234183176177112e-01   +6.112499984335086e-02   +2.173217048929601e-02   +2.929090875876175e-02   +5.279210254310667e-02   +7.320611619451597e-02   +2.919296000801815e-02   +5.086552211640644e-02   +8.312807688279721e-02   +5.421237527004001e-02   +9.420981780626555e-03; +4.595111778932338e-02   +6.576378048693610e-03   +6.401328646942439e-02   +7.370943701644968e-02   +3.493018532677931e-02   +4.071978348312321e-02   +1.142053050884994e-01   +1.206019566058374e-01   +7.963121774730506e-02   +2.602241201674466e-02   +1.239457289893358e-01   +2.465396674947442e-02   +2.485697737688296e-02   -2.809310945754341e-03   +6.787778981081974e-02   +4.233511037981999e-03; +8.349716112413208e-02   +8.642528805686385e-02   +1.084720543314731e-01   +6.157422392243619e-02   +1.117715462768893e-02   +1.060879084055417e-01   +1.055254875968486e-01   +5.521827514998672e-02   +5.429773329299927e-02   +4.455588402643702e-02   +5.998576009231260e-02   +2.084785237178808e-02   +4.556035248895942e-03   +2.334875359724126e-02   +1.046483388709496e-01   +6.985041626693894e-02; -1.877885153391582e-04   +4.036239416572179e-03   +5.912593989264243e-02   +8.136082543726948e-02   +2.604137512854506e-02   +9.036511346049242e-02   +5.625005082571233e-02   +1.186438808824684e-01   +5.243088579030986e-02   +3.334063920837493e-02   +1.088572268571899e-01   +1.117788168032628e-01   +1.640132018024952e-02   +1.130324194571331e-01   +3.135933045286059e-02   +4.010310743604606e-02; +5.878384851539545e-02   +8.093876144116906e-02   +7.466124249840957e-02   +8.938540947487326e-02   +4.930126922850688e-02   +1.053061111654540e-01   +6.177628985971233e-02   +2.897529697072960e-02   +6.276322179634959e-02   +1.020093076590649e-01   +4.361721606709591e-02   +8.042827421062079e-02   +3.086754020544551e-02   +3.395555741464364e-02   +1.156126849228485e-01   +1.766871020992066e-02; +6.174341841126462e-02   +1.941119991936238e-02   +1.034219105040822e-01   +2.001737633043731e-02   +7.495338978919382e-02   +3.849620117835672e-02   +5.302849690786393e-02   +2.236819145781554e-02   +5.827973304932084e-02   +5.833101450705460e-02   +8.301916158003586e-02   +2.958350537669082e-02   +5.908054591146651e-02   +6.642347188653674e-02   +5.889979295373047e-02   +8.512589765463854e-02; +4.041896688330610e-02   +8.519761594471069e-02   +1.104925572754659e-01   +8.142235431611244e-02   +4.977210454482250e-02   +7.293727748338046e-02   +5.016493329285682e-02   +1.031314746687100e-01   +1.167867337805850e-01   +4.355001694714686e-02   +1.793859046004797e-02   +2.445428447992495e-02   +5.339399041982348e-02   +1.120219194684842e-01   +7.518063267852385e-03   +2.514084624700921e-02; +6.817880313499251e-02   +4.163632480514845e-02   +8.697546769735029e-02   +7.702183133886284e-02   +7.273282115508301e-02   +2.007087488257357e-02   +7.702894062897229e-03   +5.725318591123659e-02   +9.093281145806538e-02   +7.667527102118232e-02   +3.285476529675871e-02   +9.206292886106952e-02   +3.192117387609242e-02   +1.436222486874034e-02   +8.381656135613974e-02   +7.688991417869862e-02; +5.463679163899113e-04   +8.029541802350691e-02   +8.224658326301376e-02   +8.151484100275704e-02   +1.092977766179970e-02   +1.079866887210887e-01   +5.169578134867124e-02   +5.679966779913988e-02   +6.244959969040420e-02   +6.177229135208710e-02   +2.484004781387885e-02   +1.090284474869444e-01   -5.434375019282565e-03   +8.953863204915503e-02   +4.423075916877638e-02   +5.786977065493935e-02; +8.541632583443388e-02   +1.779322833742903e-02   +1.081947913077121e-01   +9.707406536192968e-02   +7.347203759124671e-02   +2.508206628969727e-02   +1.178258307568060e-02   +3.258417515539843e-03   +8.902767872352768e-02   +4.772479107890022e-02   +1.142192504187258e-02   +6.601475736235714e-02   +1.035891416657597e-01   +2.685241529983744e-02   +1.062165083715185e-01   +7.511289765936031e-02; +5.207669002065937e-02   +6.066442573639014e-02   +6.083321356212234e-02   +9.606549080591924e-02   +1.085726696218337e-01   +2.416945970093606e-02   +7.193397065597518e-02   +7.217634092215029e-02   +3.259622602386105e-02   +3.287242153524562e-02   +8.879130212346259e-02   +1.157089897700188e-01   +1.660613829140846e-02   +8.777533238802329e-02   +9.421969540742638e-02   +2.707133265295401e-02; +6.539689088821697e-02   +3.421197070146790e-02   +1.154751653850739e-02   +1.639915227262090e-03   +1.155930959456461e-01   +1.110155224571294e-01   +7.584876951131363e-03   +8.517041313191473e-02   +8.580248065595572e-02   +4.069246004841275e-02   +1.812689151864154e-02   +1.018877577273219e-03   +1.081668451694444e-01   +1.248644200245337e-02   +6.142004413667076e-02   +5.183736809495513e-02; +7.908892797751280e-02   +9.011799132754646e-02   +1.007285090225380e-01   +1.852102148346878e-02   +8.273861624273504e-02   +8.585517423037936e-02   +8.644828601462071e-02   +7.936675394445468e-02   +1.048650866278135e-01   +5.631315432879869e-02   +4.472155135782821e-02   +1.134688260710567e-01   +1.053646562336467e-01   +8.527349398194073e-02   +6.087375212769275e-02   +1.095474549077888e-01; +1.031895465490964e-01   +8.105006944710244e-02   +3.622123162707676e-02   +7.427858651852783e-02   +1.733758120374945e-02   +3.129569218757879e-02   +1.282874554742561e-02   +2.910745024484428e-02   +4.282727529833030e-02   +8.710531348758518e-02   +2.460890250627766e-02   +1.015113717185837e-01   +6.954822705722491e-02   +8.164890682204692e-02   +4.745020141138617e-02   +4.230477228927953e-02; +4.122180704832817e-03   +6.803333089637328e-02   +1.045919113547867e-01   +6.642822453005853e-02   +3.475394974260642e-02   +2.187718474875316e-02   +3.511735653870933e-02   +4.701290382290233e-02   +2.869530866668241e-02   +1.207754970605324e-01   +3.677349940340436e-02   +9.574349223373928e-03   +1.891339463602918e-02   +9.187963655328905e-02   +5.554387060032044e-03   +7.999603660773395e-02; +9.485223091863482e-02   +4.261754600286984e-02   +2.419075868180452e-02   +1.180254767221989e-01   +1.384918909439267e-02   +1.887788287953712e-02   +1.069684474563276e-01   +1.928904581701235e-02   +7.066329349548706e-02   +9.780831967536371e-02   +8.404600759554683e-02   +2.078930163498600e-02   +9.202798677641860e-02   +9.650034552109002e-02   +1.149619784945822e-01   +1.064907966007625e-01];
L1E_L1I_iGABA_netcon = [+5.990170080467139e-02   +7.547853050577497e-02   +5.240043284020656e-03   +3.692926934315704e-02   +9.956277569665892e-02   +5.084155641980349e-02   +4.599211129977240e-02   +2.778201051219134e-02   +1.189617922884841e-02   +4.214237030150993e-02   +3.900548135690230e-02   +7.120472225437383e-02   +3.446750643709390e-02   +1.074094228908918e-01   +2.332584027033377e-02   +5.776630512302943e-02; +9.736660210451595e-03   +1.118780593991371e-01   +6.301091075393941e-02   +1.037746237017037e-01   +5.618377375614809e-02   +5.465297769828927e-02   +2.245672566984751e-02   +6.208848065808890e-02   +6.148220287762712e-02   +1.891428139916478e-02   +2.480136805925279e-02   +8.601262268774625e-02   +5.254381794553861e-02   +8.619158303650404e-02   +6.104309489221441e-02   +8.530259823884517e-02; +7.720531172112598e-02   +1.209040397724154e-01   +9.882730675867579e-02   +8.117103383295364e-02   +1.354648716590690e-02   +6.739217152361258e-02   +8.381841939810086e-02   +1.090497971496722e-01   +1.051006830837853e-01   +1.216595000993328e-01   +8.153375330170042e-02   +6.494098024908433e-02   +1.165202482903536e-01   +1.014518246513683e-01   +5.572403278096388e-02   +7.104965703755969e-02; +7.143621169591561e-03   +1.953123976427772e-02   +1.076480496431317e-01   +9.478511051742675e-03   +2.032668033635592e-02   +8.698470185506449e-02   +8.966206588350142e-02   +6.450463442012139e-02   +6.348335356305967e-02   +1.196242070392349e-01   +7.882986757840883e-02   +1.071151225885342e-02   +4.477740302620729e-02   +2.412768394099109e-02   +8.179610088601843e-03   +1.200994661537030e-01; +3.442584284081750e-04   +1.067593936575894e-01   +5.616815025900784e-02   +1.394060726002268e-02   +4.971542017907155e-02   +1.030461079250824e-01   +8.855730842433308e-02   +5.226121146113653e-02   +3.863816947580592e-04   +2.321585774680229e-02   +8.310928170631279e-02   +1.863966125586419e-02   +1.036198128554200e-01   +5.480978530061045e-02   +7.958976382727824e-02   +6.206925469540321e-02; +1.009893414205171e-01   +1.122885753938678e-01   +1.628791467319111e-02   +8.713199522070462e-02   +4.410689753457683e-02   -3.695416724871237e-03   +8.141352766952603e-02   +3.304538866623345e-02   +1.031722563565609e-01   +2.251809974400752e-02   +1.107959075431960e-01   +1.828758910202293e-02   +4.626050291218521e-02   +1.132652268416948e-02   +7.058891540263601e-02   +1.412525108489233e-02; +6.101575107016170e-02   +2.813050723550682e-02   +1.803969337949972e-02   +2.980978404570155e-02   +1.909979400586721e-02   +4.664394940614932e-02   +3.953247326452863e-02   +6.076938462206138e-02   +1.077614414569287e-01   +1.926812092381427e-02   +9.038546031938327e-02   +1.234548561089650e-01   +1.233191956472149e-01   +6.071583616833220e-02   +6.555258734719027e-02   +3.766582498952744e-02; +3.787032549192218e-02   +2.470986674307216e-02   +5.193979747019935e-03   +1.809134991383949e-02   +8.353725416321703e-02   +6.366894675096153e-02   +6.314240676095727e-02   +7.362962747606042e-02   +2.435667423149807e-02   +5.231397320106198e-02   +1.043896686036444e-01   +1.192750590744028e-01   +6.671919816844342e-02   +5.689974445558228e-02   +1.619726953617573e-02   +8.733086480801458e-02; +4.048322530733115e-02   +7.359206221449233e-02   +3.560822300429306e-02   -2.097420999910561e-03   +1.933479042189659e-02   +8.290990609348543e-02   +9.758074936926805e-02   +1.054953435016683e-01   +4.111573893730559e-02   +1.440730356178671e-02   +8.856581647838094e-02   +4.659772056417508e-02   +1.074533572217230e-01   +1.168584147190219e-01   +6.980774723833821e-02   +1.112958826791173e-02; +6.095899212779721e-03   +5.069941675196431e-02   +2.435907715412795e-02   +6.764622370418390e-02   +4.612300539113096e-02   +9.931966737239079e-02   +3.722657075557809e-02   +3.014483443233025e-02   +1.132989078863728e-01   +9.563975582893572e-02   +3.017152715005024e-02   +7.403195641839502e-02   +9.137016438030410e-02   +2.110330947263763e-02   +8.671400983836577e-02   +2.681759625447125e-02; +1.066815506462677e-01   +1.254964108788542e-02   +4.235195135256888e-02   +4.912255220585733e-02   +7.114950552370858e-02   +8.080055270567768e-02   +5.294783949180120e-02   +1.202987640920999e-01   +4.385699939185353e-02   +4.344189226194307e-02   +7.034255479084334e-02   +5.807922356342161e-02   +2.802073974087336e-02   +1.173608108508384e-01   +1.046328837734737e-01   +4.208064950686178e-02; +2.232171636774856e-02   +1.121178586689193e-01   +6.511466183088489e-02   +1.112134200677686e-01   +1.159530867050507e-01   +8.249846034624191e-02   +6.222216128941569e-02   +1.851107445476910e-02   +8.522055192059076e-02   +6.093151412721946e-02   +3.924463819115610e-02   +9.683608716193884e-02   +8.461077864822837e-02   +5.856051895686150e-02   +9.865051467139772e-02   +2.809158137850871e-02; +8.315268700031508e-02   +1.156928132449124e-02   +6.857081156285974e-02   +1.672305413392501e-02   +6.931234637565969e-02   +6.882805869584384e-02   +7.414612806169418e-02   +3.020635937522280e-02   +9.145296488042186e-02   +1.047465125380653e-01   +2.827582529411248e-02   +9.672102176976123e-02   +1.192777298017970e-01   +7.688769338166442e-02   +4.459691663657887e-02   +1.428299170948497e-02; +3.104504468829440e-02   +3.603462579198956e-02   +3.164699386392619e-02   +1.197542235639205e-02   +2.855155486146894e-02   +1.065554713526891e-01   +1.147535499914604e-01   +8.781809177556922e-02   +5.620787532557377e-02   +7.525075704141729e-02   +1.201044556906944e-01   +8.875473665740395e-02   +7.846019125924263e-02   +1.033612677061985e-01   +8.070160621542695e-02   +8.848599460522424e-02; +5.352831533065402e-02   +2.515395509885225e-02   +5.565115602249447e-02   +1.022551729891309e-01   +6.979761913279711e-02   +6.648284344726325e-02   +1.613931412137755e-02   +4.172752960562551e-02   +1.663858033607334e-02   +6.514419322244315e-02   +3.466444825014392e-02   +5.136132946488679e-02   +4.007126422348430e-02   +3.011648470649710e-02   +1.482389624846859e-02   +3.056093103957110e-02; +5.175911563525643e-02   +3.841937297019192e-03   +2.084292948589782e-02   +1.120739587295209e-01   +1.189472344036163e-01   +8.899606363614079e-03   +2.482931975157584e-02   +1.055077587670601e-01   +9.835685687057993e-02   +1.576028751472112e-02   +3.606411867716480e-03   +8.025883422348619e-02   +7.936767042597742e-02   +5.912115420478593e-02   +4.814222790519450e-02   +5.595287505286383e-02];
L2I_L1I_iGABA_netcon = [+1.227244158120320e-01   +5.765688854556623e-02   +3.858203338049926e-02   +1.055637268496436e-01   +1.162361617279733e-01   +1.107356647292040e-01   +4.449221675347160e-02   +8.975995870235368e-02; +9.763008933954320e-02   +9.838510809354178e-02   +8.588194520369100e-02   +3.581270215276829e-02   +4.990451639858353e-02   +7.738793179034373e-02   +1.061084473513951e-01   +2.920402760263715e-02; +2.178861815308343e-02   +2.825107864434981e-02   +3.208160652000235e-02   +3.639467919537421e-03   +9.393915223238086e-02   +1.180092791770856e-01   +1.347899302334677e-02   +7.482586072162141e-02; +4.656138417168265e-02   +9.867776788042903e-02   +8.598034796830424e-02   +7.714145986389041e-02   +7.474096344255064e-02   +7.396042914380652e-02   +6.386760293594103e-02   +9.685136723118391e-02; +4.295320265449874e-02   +1.786049747840820e-02   +7.858141544373022e-02   +7.166647657301464e-02   +5.359151450850309e-02   +9.143741764620077e-02   +5.768486701963774e-02   +6.576798394225213e-02; +9.611938289978746e-02   +8.536377450854948e-02   +1.120414755718815e-01   +5.469377129966066e-02   +3.137193567102959e-02   +8.377329715366909e-02   +6.843243486252116e-03   +8.911558349997101e-02; +1.372447497177720e-02   +5.178027023982106e-02   +5.001052038698198e-02   +3.019811015022611e-02   +8.721556978730766e-02   +3.537185647733673e-02   +2.737642828933588e-02   +8.431922642023500e-02; +7.178023611174007e-02   +4.386496210716243e-02   +9.802130671929762e-02   +5.341742991474979e-02   +3.733498464729649e-02   +9.161483325789020e-02   +5.557670139773625e-02   +3.926007947403325e-02; +5.360275784449265e-02   +7.790166496500883e-02   +2.282519349369662e-02   +2.343383157850681e-02   +3.664370482294823e-02   +1.822048039952753e-02   +4.924754449926843e-02   +1.210482716031815e-01; +6.968592254898949e-02   +7.979468217140048e-02   +2.485408122669858e-02   +6.061755259085513e-02   +5.348054447218194e-03   +8.502710019663605e-02   +1.058370903078425e-01   +8.203911986505663e-02; +6.546195265925278e-02   +9.041056654802961e-02   +1.023010160889878e-01   +4.354118080687273e-02   +8.595068242386203e-02   +1.126069313459570e-01   +2.534841443005974e-02   +3.054727719395262e-02; +1.010481188306671e-01   +5.980341918356109e-02   +7.605190928908423e-02   +5.009874976809962e-02   +1.123860816141419e-01   +2.856417704613042e-02   +7.431154636679502e-02   +4.530777035183754e-02; +4.302287945942807e-02   +1.178315437868545e-01   +1.112861129120807e-01   +2.003394559409039e-02   +6.931558753870035e-02   +4.113392671040366e-02   +3.952083031296938e-02   +6.707352689113916e-02; +8.973573245122109e-02   +2.897237693054918e-02   +1.196867045400899e-01   +6.237414176103916e-02   +1.019220123000221e-01   +2.300535847482267e-02   +1.159658031286239e-01   +3.369504234699341e-02; +1.217110421314523e-01   +2.612982493938184e-02   +3.562685158140185e-02   +1.096253085089945e-01   +8.088772073322624e-02   +1.475923859390102e-02   +4.625880063218449e-02   +8.033541199797860e-02; +2.469049957572292e-02   +8.505646098732869e-02   +8.268111292312709e-02   +7.791282611466585e-02   +1.017173823902356e-01   +1.695266414522155e-02   +1.201757214230059e-01   +3.844812096243275e-02];
L1I_L2I_iGABA_netcon = [+7.276681964888985e-02   +8.243699373116473e-02   +2.915126684221667e-02   +9.272292589444120e-03   +6.367548553222128e-02   +4.288607146915263e-02   +1.155343739549647e-01   +8.230381597947332e-02   +4.953911453877272e-02   +9.256455561159388e-02   +2.230558305287635e-02   +3.622096488415105e-02   +1.119437468147941e-02   +1.586287085372429e-03   +2.633000243774879e-02   +9.726462316565786e-02; +9.571253386667872e-02   +7.654628660713916e-02   +4.945926712370021e-02   +6.145114680330015e-02   +1.174481422664897e-01   +5.934868519461831e-02   +7.674921741991486e-02   +1.138775453456210e-01   +5.850835432645359e-02   +1.195019460426369e-01   +7.948181339918373e-02   +4.741924133910092e-02   +6.194842337257152e-02   +1.046512136525728e-02   +1.668644381807917e-03   +1.091444411276607e-01; +1.079910111765427e-01   +6.613727751219434e-02   +2.205504703457311e-02   +9.569078973640453e-02   +3.712941174556749e-02   +1.025983358203758e-01   +8.868564906265837e-02   +8.236063819699410e-02   +4.461597009740718e-02   +4.650961531669608e-02   +7.817133345846537e-02   +5.498076824596755e-02   +4.255882187297361e-02   +1.765846922895434e-02   +7.086047733800531e-02   +1.759219019793395e-02; +5.148354003566795e-02   +4.390448149184976e-03   +7.478516559122884e-02   +1.013581920695390e-01   +1.632193444273486e-02   +3.415026180329258e-03   +4.545469148355444e-02   +3.936110949060456e-02   +8.248428430464831e-03   +7.977883138211159e-02   +6.612243901665897e-02   +5.703757060972215e-02   +2.825743437900692e-02   +4.259006586245434e-03   +9.625174550708786e-02   +6.785199645579695e-02; +1.062408933543804e-02   +1.036520580193093e-01   +9.215730161535005e-02   +8.081084632059446e-02   +7.150019749148748e-02   +5.909064710108285e-02   +7.239879347485359e-02   +1.009752883039940e-01   +7.163639409427869e-02   +7.029991396922564e-03   +4.045352377841925e-02   +1.648359454144868e-03   +3.046358259539646e-02   +1.023107100648253e-01   +2.212722840758701e-02   +6.073312395783126e-02; +7.768125620404612e-02   +8.606500953508822e-02   +1.275774856109043e-02   +1.086153856736655e-01   +7.057880615490304e-02   +1.106807434323273e-01   +8.487215284313637e-02   +9.859837855913191e-02   +6.567391570359554e-02   +6.743410291616300e-02   +1.234248380163377e-01   +9.553659799954843e-02   +2.089695360882226e-02   +1.097185684381381e-01   +8.399577288308144e-02   +1.115667212403984e-01; +9.306623930754916e-02   +1.317289936154370e-02   +1.101218989573474e-01   +1.216303561507079e-01   +4.744024118015419e-02   +1.190224104460621e-01   +6.215436791950427e-02   +5.919808104311302e-02   +1.997386779552864e-03   +7.215902441709691e-02   +4.188627383634363e-02   +3.994330283034093e-02   +9.052736005392555e-02   +4.716760884420840e-02   +1.024260943073451e-01   +7.160244096179653e-02; +8.342502550190918e-02   +5.540344006024409e-03   +1.056554814110881e-01   +8.734140552195133e-02   +6.828546644708977e-03   +9.679481011999322e-02   +7.242761483239467e-02   +9.539118474527672e-02   +4.400181894214623e-02   +1.057877253366166e-01   +2.884558675438816e-02   +6.024105904334099e-02   +6.098527169328604e-02   +6.366055862519543e-03   +1.065837031292476e-01   -2.013972485466571e-03];
L2E_L1E_iAMPA_netcon = [+1.006542111428468e-01   +3.401636951735304e-02   +1.366723949863438e-02   +1.219951866448081e-01   +2.302446757332472e-03   +5.700476561689997e-02   +7.904140958359325e-02   +1.023457335455263e-02; +1.137037947238474e-01   +1.060376941855250e-01   +7.005181623567766e-02   +4.784184962369358e-02   +6.103724349375871e-02   +2.329284437137543e-02   +1.144758633647404e-01   +5.037358854642089e-02; +9.423979547289629e-03   +2.099410179828614e-02   +3.538412788417678e-02   +1.773974093714667e-02   +7.401534268980690e-02   +9.976035904218908e-02   +3.979713204695416e-02   +4.307053031161997e-02; +3.309481621054581e-02   +8.972776800921198e-02   +1.921458116820777e-02   +8.253715951310511e-02   +9.571325060449544e-02   +3.725855322677642e-02   +1.086507567098914e-01   +1.062515901392050e-01; +2.130690377517362e-02   +1.252113320185470e-01   +1.809930035833043e-02   +5.056917307445673e-03   +1.106968139759880e-01   +1.147864669053799e-01   +8.234917655029837e-02   +4.874771713225996e-02; +8.653361703599563e-02   +6.400802536976857e-02   +1.083662356877299e-01   +9.321423964096827e-02   +7.924558586170190e-02   +2.885262247847112e-02   +9.684445584404627e-02   +7.996713591239661e-02; +9.187219356919256e-03   +3.612254982076044e-02   +2.795174917029367e-02   +5.264643626115832e-02   +1.088391876823882e-01   +5.628661219222861e-02   +1.967916006349815e-02   +3.954288974673871e-02; +7.278033660474979e-03   +1.780981213155754e-02   +6.264203755845710e-02   +8.116839348737598e-02   +4.401701087641759e-02   +1.146176956016800e-01   +1.139324286271950e-01   +1.138079277968128e-01; +4.380586990168602e-02   +1.097993216461387e-01   +1.631048759582964e-03   +3.594155487654464e-02   +2.023422575614192e-02   +1.187751346385646e-01   +7.442778370016455e-02   +8.988311673518018e-03; +3.468537029796092e-02   +3.316433118096196e-02   +1.040767776655598e-01   +5.105112307657337e-02   +1.022680315283868e-01   +9.292735549503875e-03   +1.781758713546571e-02   +1.160412531121001e-01; +6.958481141294162e-02   +5.371078942932157e-02   +1.746073418871539e-02   +7.284197317671076e-02   +4.852245965850754e-02   +4.758341657846393e-02   +7.352594844584555e-02   +1.067762166405656e-01; +3.063151785309871e-02   +5.739781760671076e-02   +9.822145856551538e-02   +9.054920166930473e-02   +8.113157353599630e-02   +2.272392205554594e-02   +1.227507520566021e-01   +3.001409164983489e-02; +6.608893327888846e-02   +1.038795491706942e-01   +2.981167984793156e-02   +8.941230744407567e-03   +1.162105244385188e-01   +8.544767679381383e-02   +4.898140146336175e-02   +1.019375431521461e-01; +4.632480059061254e-02   +2.241122961445785e-03   +1.220796811903732e-02   +8.635130319047700e-02   +5.265034523477151e-03   +3.189702287248383e-02   +8.785044184476752e-03   +9.644247045454545e-02; +3.575129366027435e-02   +1.944637406154711e-02   +1.021886682646296e-02   +9.551791306036123e-02   +1.232556254028692e-02   +7.838347476916781e-03   +5.366873614436275e-02   +2.535153149298417e-02; +1.507663096085078e-02   +5.594994485787281e-02   +9.122191715603307e-03   +6.580596976233474e-02   +2.630832864298491e-02   +6.699794911628322e-02   +1.062167124051345e-02   +1.008195779380053e-01];
L1E_L2E_iAMPA_netcon = [+4.578321778253271e-02   +2.253804424476792e-02   +1.184776700015415e-01   +1.126788011310419e-01   +3.393113595151802e-02   +1.157112706115539e-01   +5.861991936604065e-02   +1.174252962219950e-01   +2.144258500036988e-02   +8.041583507921604e-02   +7.485704384917029e-02   +8.864963745640116e-02   +4.460007694531680e-02   +7.875135758624363e-02   +6.368111028059104e-02   +5.774106130025679e-02; +4.653382332695977e-02   +6.752293517406135e-02   +2.475617923808694e-02   +6.684623088052257e-03   +1.013667871862449e-02   +8.015123258423043e-02   +5.492640611173607e-03   +3.927692097758913e-02   +3.152150813291178e-02   +4.004300905333996e-02   +2.829113365928357e-02   +1.195926200105799e-01   +1.458576202390200e-02   +2.777132979359575e-02   +7.064103568850048e-02   +3.148755852295007e-02; +4.217595480105484e-02   +7.264901396825245e-02   +1.064558341547778e-01   +1.109008285525858e-01   +1.117968806249602e-01   +1.578977396671154e-02   +3.585725714923378e-02   +6.361836297768778e-03   +5.464747534841051e-02   +7.387958619036200e-02   +3.981308806140583e-02   +9.587443609161571e-03   +8.377154035784894e-02   +7.183214634315656e-02   +1.018451775152176e-01   +1.190506482043240e-02; +8.703133105274567e-02   +5.297673910921940e-03   +2.440078659649374e-02   +2.344416370591118e-02   +8.306056040929502e-02   +4.108467766555846e-02   +1.176719843357636e-01   +1.050110817541257e-01   +9.325587468588052e-02   +9.333508572272238e-02   +5.509111742516466e-02   +6.580612708482042e-02   +1.157097388281468e-01   +4.005082907940456e-02   +1.090770360364083e-01   +1.163391708283176e-01; +2.280815982657391e-02   +1.124146207833898e-01   +1.043110377989998e-01   +6.289278477072942e-03   +2.369246659594611e-02   +9.629735106893991e-02   +1.045326332778165e-01   +1.782264933254308e-02   +6.865603563718327e-02   +4.977120201271889e-02   +7.014786705693553e-02   +9.413268823170311e-02   +3.006685286386497e-02   +7.008387884481888e-02   +1.218881165683379e-01   +3.196070478951874e-03; +1.015913318798039e-02   +1.099119533792720e-01   +3.729640818484953e-02   +1.010402473217076e-01   +1.217383164720431e-01   +1.062795828031974e-01   +5.988823824282326e-02   +1.089898521432600e-01   +4.136787073480065e-02   +5.061973125538317e-02   +1.041947032064250e-01   +1.116796520903110e-01   +1.009518117627882e-01   +7.059641611141432e-02   +2.253307209224701e-02   +7.146266095445174e-02; +3.631615582420218e-02   +2.184116433008211e-02   +7.240400840269204e-02   +4.902781340695909e-03   +4.761944208096616e-02   +6.253887780039770e-02   +9.371744858049669e-02   +6.914922906012087e-02   +7.083947509392126e-02   +9.793136042979429e-02   +7.953409765483675e-02   +1.743643727516669e-02   +4.930262333286609e-02   +7.009173800132697e-02   +2.542375329250448e-02   +3.748110685112136e-02; +9.535222642920829e-03   +6.756591198203676e-02   +5.585482690089837e-02   +4.534072111089168e-02   +9.032380161770945e-02   +1.184413261249490e-01   +1.204888554235107e-01   +7.892741945994086e-02   +1.061234758514957e-01   +5.216935382355149e-02   +4.397344507331483e-02   +1.171257211834623e-01   +8.181806060242605e-02   +1.086210443016214e-01   +3.730121785829488e-02   +1.233818637155916e-02];
L2I_L2E_iAMPA_netcon = [+7.995317506871237e-02   +3.446731893824193e-02   +1.053102272644972e-01   +5.275376266838627e-02   +9.381920529790569e-02   +6.490376684339380e-03   +2.677628586214660e-03   +1.093717942530688e-01; +2.108691575849749e-02   +1.790816723486433e-02   +2.107274148027997e-02   +9.818742305056938e-02   +9.716019157230213e-02   +4.250154193635784e-02   +8.440689459128382e-02   +5.921072213914268e-02; +1.025092028733259e-01   +9.469792716707875e-02   +1.004205359455397e-01   +8.675397815406771e-02   +6.237992598406637e-02   +6.707323357618286e-02   +5.961037292164550e-02   +8.705954301958443e-02; +4.697464244798009e-02   +2.090167279465047e-02   +1.081023697060888e-01   +5.572139928276395e-02   +1.219587327942214e-01   +2.268494817218355e-02   +5.688749854512005e-02   +1.034226018104609e-01; +8.180286374741290e-02   +1.042286892745078e-01   +7.449283502612862e-02   +7.505658841878135e-02   +1.117482499542002e-01   +9.200858747308245e-02   +5.173440581357054e-02   +8.951414770707787e-02; +7.253981335173107e-02   +3.917931723931097e-03   +1.023772654575380e-01   +8.927058789030226e-02   +6.709740114232790e-02   +2.530187943361322e-02   +1.507968206826289e-02   +8.700424232175007e-02; +1.211951450480987e-01   +5.851126687515448e-02   +1.811253822184601e-02   +6.986266510550323e-04   +1.797736170011044e-02   +2.821140092894418e-02   +2.283033566959279e-02   +2.811917455298295e-02; +1.136058445242492e-01   +3.598989392088833e-02   +6.796281565638360e-02   +5.683474435605091e-02   +1.041680309406701e-01   +3.159505858506773e-02   +1.383500483606875e-02   +7.641205152821894e-03];
L2E_L2I_iGABA_netcon = [+1.130008344151086e-01   +2.332441918142288e-02   +2.575497976059520e-02   +1.823500090767255e-02   +7.701281981105269e-02   +4.565998166438259e-02   +9.973091390734416e-02   +1.156868859350938e-01; +2.680042932322433e-02   +4.781538429473042e-02   +1.943705395526270e-02   +1.502488931763774e-03   +1.217780569657346e-01   +8.428248518849371e-02   +9.399440100267278e-02   +1.035745161741913e-02; +7.845834244794556e-02   +4.358160305148251e-02   +6.542313088243314e-02   +8.569458298962390e-03   +4.568955289893009e-02   +9.348319706002728e-03   +1.134800661785743e-01   +1.038459837619363e-01; +1.001192926458677e-01   +6.854860234696980e-03   +3.105939105672189e-02   +8.505460488300849e-02   +1.099449910791505e-01   +7.785105143992667e-02   +5.535135122011070e-02   +7.716491804760998e-02; +1.524877361389460e-02   +1.073544262935327e-01   +3.873701527790429e-03   +9.705949264256776e-02   +3.894174865047793e-02   +4.557405582669255e-02   +3.558836282209181e-03   +3.028762286964846e-02; +9.422687116168253e-02   +2.677011108171943e-03   +6.404772881652494e-02   +9.431571797537919e-02   +1.071976763677172e-01   +3.148574152635026e-02   +1.131035637586909e-01   +8.927359774007577e-02; +2.082161009213062e-02   +1.225921288038924e-01   +3.380894959422947e-02   +3.349451179608256e-03   +9.337766736423589e-02   +6.242813263202347e-02   +7.204496464028794e-02   +7.308339798692597e-02; +1.024568610194623e-01   +4.090138864515785e-02   +6.100735784363059e-02   +2.776410581388954e-02   +5.678188686929794e-02   +9.615749732054366e-02   +1.155035945163638e-01   +7.538472830287375e-02];
L3E_L2E_iAMPA_netcon = [+4.187918560327929e-02   +8.203641765713635e-02   +1.351386725554098e-02   +9.729928459789627e-03   -2.520972175062202e-03   +1.191475324234720e-01   +4.869085353203539e-02   +1.057454672628222e-01   +1.536305118686894e-02   +3.148861220101128e-02   +3.357008078664821e-02   +9.960087181820136e-03; +3.273955822222348e-02   +1.096815426759075e-01   +3.514795568877859e-02   +4.404277319665337e-02   +5.963761000578510e-02   +6.622250167132251e-02   +1.079023174844563e-01   +1.206821545024688e-01   +7.293338253779530e-02   +1.127065097971405e-01   +3.652269735927717e-02   +3.019199621507869e-02; +1.169428184142347e-02   +9.519013902488800e-02   +1.483450472600235e-02   +9.053435354400897e-02   -6.173798252997071e-04   +2.192917670654148e-03   +6.589215647213173e-02   +1.211164782525977e-01   +7.732414133384943e-02   +7.204604422651278e-02   +3.011212163253982e-02   +8.217779288532050e-02; +6.401092515919304e-03   +2.004362714293359e-02   +9.915507419888915e-02   +3.346257850600341e-02   +3.266060782592472e-02   -2.308405719808419e-03   +4.034281541477332e-02   +9.920536125837806e-03   +2.263220182600093e-02   +4.372867991371791e-02   +2.188392906951988e-02   +3.649431270183134e-02; +1.111038944771199e-01   +4.535992794260901e-02   +4.207268586387503e-02   +1.172074687821727e-01   +8.526649793418423e-02   +4.746954071564063e-02   +1.196825612680774e-01   +2.421430427479471e-02   +1.042232160565394e-01   +5.551674485600596e-02   +8.422275557411825e-02   +4.125591144284460e-02; +1.046575957162694e-01   +7.316098986793566e-02   +1.080511245897877e-02   +5.704343450737630e-02   +7.515511989624282e-02   +1.221867533678246e-01   +1.110902536243501e-01   +4.023375358924437e-02   +6.037110447130142e-02   -4.344475373071454e-03   +8.020336606277438e-02   +2.862230599173356e-02; +7.773028931669818e-02   +5.858903078059454e-02   +7.803849722933670e-02   +3.303572918424583e-02   +3.208358499823417e-03   +4.619047065621132e-02   +1.016220923218263e-03   +4.049500256158331e-02   +4.244918750477232e-02   +1.343070555845877e-02   +1.664950739605903e-03   +5.414360912482926e-02; +1.030796734969422e-01   +1.502403671584686e-02   -3.021509207530529e-03   +3.109341454431244e-02   +6.535182325749692e-02   +1.209636047994772e-02   +5.802999838708167e-03   +5.618075829685739e-02   +6.162182334356128e-02   +1.026829529474353e-01   +1.132173162800304e-02   +7.100096169003126e-02];
L3I_L2I_iGABA_netcon = [+1.160880954368807e-01   +6.348245605963133e-02   +7.475931688957266e-02   +3.742738269363556e-02   +1.139935328307109e-01   +5.059134036827800e-02   +6.735847227609072e-03   +5.580471122371717e-03   +1.060729773813140e-01   +5.660505219019325e-02   +1.240605960031235e-02   +9.481963428070417e-02; +1.117452259717806e-01   +1.184820701723233e-01   +1.036605727402577e-01   +1.730104673544608e-02   +5.560941486195847e-02   +1.014178566170202e-01   +8.017377134462053e-03   +2.141308730099779e-02   +5.777080689427861e-02   +8.686714633407897e-02   +1.343992629157728e-02   +7.875321044383272e-02; +8.813249493672527e-03   +1.024177180413217e-01   +1.158402447092117e-01   +4.419003597448204e-03   +8.320593577369555e-02   +2.316039222021354e-03   +7.659014177910300e-02   +1.134582080430990e-01   +8.541906343367722e-02   -2.388942038028057e-04   +8.245734728997137e-02   +1.435614969697369e-02; +1.200215674526872e-01   +1.077112339968852e-03   +3.948205870094607e-03   +7.896642601990791e-02   +1.059319631482360e-01   +6.869170419133393e-02   +1.679351263526310e-04   +6.295732825940877e-03   +1.083509870102184e-01   +9.797091431255339e-02   +1.224205052605428e-01   +6.215859502566209e-02; +2.405293205297008e-02   +1.176039152206511e-01   +4.902570749865297e-02   +4.839674564615652e-02   +6.750531325544532e-02   +1.122426621576229e-01   +4.523183507386123e-02   +1.797843802260087e-02   +1.180726093032640e-01   +6.390383388634432e-02   +2.786623635441926e-02   +2.027478025118679e-02; +5.745028033877522e-03   +8.321917396297146e-02   +2.551684748152046e-02   -6.826265798017192e-04   +1.999140678702861e-02   +8.063201824854858e-02   +8.768002266122694e-02   +2.691594286063070e-02   +5.560127008393167e-03   +9.173222120035654e-02   +1.040200378022124e-01   +4.712046104814210e-03; +7.465332238063756e-02   +1.088324692420189e-01   +6.837974053744778e-02   +8.341544310182196e-02   +5.500368576480715e-02   +3.150726732596811e-02   +8.138321942838501e-02   +6.928472555941523e-03   +1.063903304000879e-01   +4.331079147763993e-02   +5.812661615842857e-02   +9.004509944977127e-02; +6.201898437231736e-02   +2.367810275454042e-02   +4.376388869362501e-02   +7.401292928333454e-02   +4.460924842477473e-02   +1.324813030939881e-02   +3.058491582624737e-02   +3.072056104083804e-02   +7.029101698971557e-02   +1.170452976786423e-01   +3.411976370362515e-02   +3.205097665760945e-02];
L2E_L3E_iAMPA_netcon = [+7.837020663405402e-02   +8.105177590903889e-02   +2.808609619702645e-02   +9.792059754334374e-02   +9.481070908059958e-03   +6.174586997674630e-02   +8.362660356972795e-02   +1.152536175535608e-01; +6.622818449724804e-02   +8.735787446755641e-02   +9.382885415917210e-02   +9.684150421563995e-02   +2.730436855414744e-03   +6.711341503607984e-02   +9.975505747795123e-02   +8.273917717280567e-02; +9.470903896640408e-02   +1.070459014918778e-01   +1.042689019602700e-01   +1.120339060403255e-01   +6.872706785009686e-02   +7.939592419289652e-02   +1.053159694733148e-01   +7.296216367660212e-02; +4.508517437402814e-02   +1.174987675182686e-01   +1.034547729424147e-01   +7.419244823308038e-02   +5.597372746966955e-02   +6.548657845858605e-02   +3.038288183263262e-02   +1.792008041263329e-02; +1.215864553993598e-02   +6.535427946941273e-02   +3.572284636634403e-02   +7.546773501618274e-03   +1.699215146198241e-02   +6.282047370733899e-02   +1.063930365870517e-01   +9.417462517118765e-02; +5.857015331839682e-02   +1.238391690073102e-01   +1.076886522630808e-01   +6.949039666267334e-02   +6.567367244998948e-02   +1.191837587636324e-01   +8.978085772221243e-02   +1.157943898848076e-01; +6.285516241606526e-02   +1.218223375607784e-02   +6.187809457705500e-02   +4.094065368947449e-03   +4.575871302730655e-02   +9.744103878638814e-02   +4.089754090740301e-02   +9.305487088241265e-02; +1.123679086379622e-01   +8.479154870168713e-02   +5.998646302456308e-02   +9.461875201991282e-02   +4.564022482832066e-02   +9.241596998701411e-02   +6.263191429748081e-02   +4.544192916904940e-02; +5.751969352628965e-02   +6.301170777302417e-02   +1.110672284466872e-01   +7.285951643788301e-02   +7.412270481086899e-02   +4.404079223230998e-02   +6.851886556309654e-02   +8.355641276589901e-02; +3.043180836858465e-02   +1.944450839513781e-02   +9.374331681291935e-02   +1.040894102733953e-01   +1.121990004520342e-01   +7.865123424391448e-04   +1.383131694258207e-02   +7.851059601375805e-02; +7.638466622282863e-02   +3.532028917293803e-02   +8.823165100697947e-02   +9.738818301956483e-02   +1.138030678327002e-01   +1.218906909386911e-01   +3.022513297625848e-02   +4.058102118110284e-02; +1.566600585058456e-02   +7.151018036048851e-02   +5.510437562863144e-02   +1.088474600181222e-01   +5.585910609251099e-02   +2.605416504618623e-02   +7.654299534850055e-02   +1.061863426623403e-01];
L2I_L3I_iGABA_netcon = [+1.132048879052950e-01   +5.153467667794529e-02   +3.289567563960058e-02   +8.503269200226771e-02   +8.899299389571971e-02   +1.030616406270375e-01   +2.740992553501082e-03   +5.885483403562051e-02; +6.730533759090380e-02   +5.521880012628284e-02   +8.636144769549949e-02   +2.057433266474260e-02   +1.089315928526138e-01   +1.028803495426356e-01   +5.501084885140009e-02   +3.396213047934931e-02; +9.292051527913656e-02   +9.100258778397259e-02   +1.139869702463818e-01   +7.055782196709845e-02   +4.364351404703228e-02   +7.683010590463953e-02   +5.532434555121545e-02   +1.763219820693671e-02; +2.271900673220403e-02   +1.012007132975530e-01   +2.564153663202850e-02   +5.813974749679677e-02   +7.321702375618550e-03   +4.009318591122270e-02   +5.024878038848578e-02   +1.245097018752719e-01; +3.629145822426582e-02   +4.512472846849588e-02   +6.322817424258906e-02   +5.378483461662107e-02   +4.492414523375099e-02   +7.771460499047909e-02   +1.248448359708210e-02   +2.065989487002137e-02; +3.697135505830093e-03   +3.346819820987598e-02   +4.747509060765652e-02   +1.674518059950376e-02   +4.349414641743819e-02   +4.719367425058749e-02   +6.325026210724266e-02   +8.787502974375173e-02; +4.347356963137024e-02   +5.631525436584545e-02   +1.174985239703332e-01   +7.882069876831818e-02   +9.096748394802798e-02   +3.648404176338088e-02   +3.976504221201303e-02   +4.038871131535410e-02; +4.554559146802321e-03   +1.234627089198670e-01   +3.928854932497988e-02   +1.075389256795549e-01   -3.062610905201063e-03   +9.303131622377894e-02   +6.785054489462407e-02   +9.671567320593923e-02; +1.045684597777157e-01   +3.827375210262375e-02   +1.025258760760980e-01   +9.703325625193276e-03   +6.274244074326532e-02   +3.806519370424007e-02   +5.009928371953829e-02   +5.139723963790137e-02; +9.202729492556835e-02   +6.449435675580825e-02   +2.716930175257406e-02   +6.204255279516059e-02   +7.281203215554792e-02   +4.176860025373227e-02   +2.327139159541849e-02   +3.928692856449351e-02; +8.736315885569365e-02   +1.158404611213552e-01   +6.773818472332582e-02   +8.110618774221807e-02   +4.008827582468261e-02   +4.613596033379899e-02   +1.070648341765750e-01   +1.607445064418636e-02; +9.016959495971506e-02   -2.707959202779634e-03   +4.453451829481950e-02   +1.790540848194060e-02   +1.984606138000934e-02   +1.187015468845846e-01   +6.133746756220504e-02   +6.944024440302352e-02];
L3I_L3E_iAMPA_netcon = [+5.761521827144227e-02   +1.214241246305272e-01   +3.046042098120312e-02   +7.295640175216689e-02   +9.329176499452187e-02   +3.973399134858915e-02   +3.598952132573736e-02   +2.957215742360821e-02   +3.923314899142399e-02   +3.607271653255896e-02   +2.901094434436120e-02   +4.268030377703478e-03; +4.714687655217242e-02   +1.010650093782356e-01   +3.019844388468473e-02   +1.202983884451196e-02   +1.233539941029709e-02   +6.919794830028589e-02   +6.784036199276275e-02   +6.419043112458155e-02   +2.006852239817505e-02   +5.770843172111122e-02   +8.622624706445765e-02   +6.779545502521642e-02; +3.515541812553498e-03   +6.927478086635855e-02   +6.117946780409706e-02   +7.249271021077920e-02   +6.401433409679616e-02   +5.423244815349305e-02   +6.298448969438709e-02   +6.005051098374525e-02   +4.737649959706781e-02   +6.753421457367879e-02   +5.267506245039020e-02   +6.553159865212820e-02; +4.855826045106387e-02   +9.088847436940758e-02   +8.106805368437038e-02   +5.643868579276715e-02   +5.398141954444454e-02   +1.100435187361081e-01   +8.997102491974496e-02   +1.852400003521581e-02   +1.148298381498917e-01   +1.085849624233196e-01   +2.411557581661688e-02   +9.017379557533825e-02; +1.493343436083437e-02   +4.674911846564900e-02   +6.778263230465100e-03   +9.956435284921714e-02   +9.468145091839568e-02   +6.963100643793009e-02   +1.167182517519565e-01   +6.886670963268563e-03   +1.163375537514739e-01   +7.120274023475244e-02   +4.445007348475169e-02   +1.152771113781786e-02; +4.334886241680922e-02   +7.241410909141111e-02   +9.891892336091537e-02   +5.258140045324105e-02   +1.158096802880805e-01   -1.732024073486447e-04   +1.041124304647086e-01   +3.809459222353903e-02   +8.169291254947834e-02   +4.840775939883803e-03   +4.334812306378340e-02   +2.261037696098394e-02; +9.556095353905397e-02   +4.926065049582388e-02   +4.810608866624621e-02   +3.507114261252353e-02   +8.348093236568979e-02   +2.245487418257102e-02   +6.456440426601034e-02   +1.123784039663026e-01   +9.898658182517683e-02   +1.195175072314876e-01   +6.807700931459858e-02   +8.466813472274984e-02; +8.897250859613652e-02   +2.385222759898364e-02   +8.842423197105719e-02   +7.788528969170920e-02   +1.251011004060829e-01   +7.104964697102963e-02   +1.063752004284556e-02   +6.137806769600561e-02   +5.882865625714009e-02   +3.819071745285642e-02   +2.742744667767021e-02   +1.123590117467950e-01; +1.329594641205174e-02   +1.051008991182909e-01   +8.608264561928410e-02   +9.355704472716446e-02   +4.795270496938620e-02   +9.313356376527666e-02   +1.671868128335798e-02   +9.255340402948344e-02   +9.959502037521072e-02   +5.429370971341621e-02   +2.735416421383903e-02   +2.505098819750599e-02; +1.090560447294936e-01   +1.024043009388195e-01   +5.421570296567076e-02   +2.312369016054779e-02   +6.602762496371778e-02   +9.764083365587653e-02   +6.464798707523421e-02   +1.095512975248691e-01   +8.539128955904242e-02   +4.366124225730790e-02   +1.029830733835299e-01   +2.461910751685897e-02; +5.079079864023033e-02   +4.432591540874133e-02   +1.200383918589597e-01   +1.134239394059010e-01   +4.327259650384912e-03   +7.310371248869725e-02   +8.266270714610897e-03   +2.905034798674069e-02   +7.441981531598856e-03   +1.144949943601787e-01   +9.320491998283321e-02   +4.979470419234275e-02; +7.001726338296397e-03   +2.132879989867594e-02   +3.776067738750106e-03   +5.399906867023636e-02   +5.758382488706795e-02   +3.216087344889930e-02   +9.640195579959474e-02   +2.382017362078302e-02   +4.016078145442710e-02   +2.993796344783725e-02   +9.401597800842751e-02   +3.566288240249067e-02];
L3E_L3I_iGABA_netcon = [+1.976430284256361e-02   +5.366978968165073e-02   +3.837255005512383e-02   +1.144486171222659e-01   +9.618243394107423e-02   +6.459764995940523e-02   +4.363429268645971e-02   +9.527369978765461e-02   +7.532374737697731e-02   +8.640880249199936e-02   +7.266362167057197e-02   +3.486353216912218e-02; +9.716645304609209e-02   +7.642794924062091e-02   +3.952055176117407e-02   +3.146086354137809e-03   +4.328813554493553e-02   +8.880811081895006e-02   +8.189340687435341e-02   +1.191689159084868e-01   +1.005515513782705e-01   +4.928386112360315e-02   +1.886575204944377e-02   -8.801719986194463e-04; +7.082164203554850e-02   +1.211720956080406e-01   +1.174869981830346e-01   +9.928770657023749e-02   +2.693274164436102e-03   +9.073807193511185e-02   +7.212505220443663e-02   +8.507296354282781e-02   +5.017141168890528e-02   +5.257948042669022e-02   +2.883250722075306e-02   +1.700732564154951e-02; +5.304491837064874e-02   +1.014224006397743e-03   +2.471188839110863e-02   +8.644733098513131e-02   +8.753008847837236e-02   +3.526729183188129e-02   +5.380353130762045e-02   +4.575411354527471e-02   +1.187543779061278e-01   +5.731959650524462e-02   +6.418136694150397e-03   +7.887720200506293e-02; +5.312762468575988e-02   +5.449155615431560e-02   +1.260845383522825e-01   +2.717349190297987e-02   +6.359267813705914e-02   +9.579246104912108e-02   +1.200890327726808e-01   +1.178909750980490e-01   +3.067464991121764e-02   +7.404695564219189e-02   +1.062685855451029e-01   +3.744023394078705e-03; +7.971669908701030e-02   +5.837814424235085e-02   +1.015061999197479e-01   +4.836777151098779e-03   +3.427899679353107e-03   +1.189865380292265e-01   +6.867598407920058e-03   +5.148746063675481e-03   +9.723112406429570e-02   +7.158786476326970e-02   +2.899447057446111e-02   +2.516335565913313e-02; +6.490764461024118e-02   +4.242293705819414e-02   +6.387615546558212e-02   +6.968616737359642e-02   +8.305158237553478e-02   +6.174082176243260e-02   +4.044666987890104e-02   +2.346889475890379e-03   +4.204739875120399e-02   +2.006857832979643e-02   +3.697884205853644e-02   +8.537605527930334e-02; +3.603174538198870e-02   +1.573806032114751e-02   +1.407182400971903e-02   +1.140568107676260e-01   +5.508542411950737e-02   +9.351384117350911e-02   +6.283009520371463e-02   +9.514491423491277e-02   +9.440636025339230e-02   +1.040541600540636e-01   +2.170380261325931e-02   +7.482073877166845e-02; +3.204228684354547e-02   +2.190375071660840e-02   +9.697223924215150e-02   +1.852100002573722e-03   +1.171696501274976e-01   +1.117314432266649e-01   +1.993581995880776e-02   +9.198482136632469e-02   +2.349008197796857e-02   +4.128477786326687e-02   +5.405388146511874e-02   +6.959851278767056e-02; +9.646538398672397e-02   +4.154154038370057e-02   +1.055465605483404e-01   +4.131780071479804e-02   +4.998901911778904e-02   +1.144586842431447e-01   +8.812434688289951e-02   +7.065435205374358e-02   +1.120271470939691e-01   +1.148212917337334e-01   +2.043498959185316e-02   +2.558856115314749e-03; +6.494282799117677e-02   +1.509590544122767e-02   +2.340457688221666e-02   +2.641449453154962e-02   +9.273181168191322e-02   +6.508015756538339e-02   +1.109249603698101e-01   +7.596625392192988e-02   +6.800765989450233e-02   +2.382430262251066e-02   +1.096910869295591e-02   +9.703425215686884e-02; +8.097002835789442e-02   +6.319621398607207e-02   +1.176787036710759e-01   +8.149521125910644e-02   +6.171690536906339e-03   +5.607126060351913e-02   +1.172807357598739e-01   +7.272002555786698e-03   +9.225579377391305e-02   +4.882658704022905e-02   +6.159257708457094e-02   +4.907485283567041e-02];
L2E_Input1_iAMPA_netcon = [+1.183360384618392e-01   +1.186795640793322e-01   +1.218600906970724e-01   +1.214502248467527e-01   +1.213111384451853e-01   +1.314467181410018e-01   +1.267010535778716e-01   +1.194542362903969e-01];
L2I_Input2_iAMPA_netcon = [+1.217259193019896e-01   +1.256372201201155e-01   +1.211528403041027e-01   +1.203234545053105e-01   +1.188072910894665e-01   +1.185629102665257e-01   +1.235330018136781e-01   +1.182046756893354e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
