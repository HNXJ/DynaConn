function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.343271764671528e-01   +2.443675789828179e-01   +3.577845077666414e-01   +4.528175230990653e-03   +2.653052058562864e-01   +5.582735314164412e-01   +5.430393216719480e-01   -2.364408027839557e-02   -2.019999228196082e-01   +1.052793755233634e-01   +5.206638524283045e-01   +1.881236808869370e-01   +4.507221100362118e-01   +1.271816021252956e-01   +3.556988973445167e-01   +2.723274829346252e-01; +2.307043824581845e-01   +2.665231577000763e-01   +3.369896591817231e-01   +6.565247720719469e-01   +2.004009776864114e-01   +4.025214146615211e-01   +4.189428773116057e-01   +2.631210720055169e-01   -4.991516514946667e-01   +1.439695103801599e-01   +5.781263872268725e-01   +7.022812064481195e-01   +5.741377846182312e-01   +4.519940642820321e-01   +6.019167048160230e-01   +2.958784984344239e-01; +2.147007264281660e-01   +1.760799722953330e-01   +6.254975571741340e-01   +6.136805437701480e-01   +6.294975576410823e-01   +4.520849714727018e-01   +1.763402801116754e-01   +3.099820429736749e-02   -6.618347725525987e-02   +1.495051532733047e-01   +1.896780709608485e-01   +8.166500059666408e-01   -2.436261616439246e-01   +1.028282433331194e-01   +2.709943511712177e-01   +6.789567005179695e-01; -6.686835845137340e-02   +4.642577749646148e-01   +5.149400663999383e-01   +3.371804479402689e-01   +3.180019825158743e-02   +7.502652263487014e-01   +8.243544832496282e-01   +5.080192502438743e-01   +6.854592049094813e-01   +6.193854278802369e-01   -1.497416702940725e-01   +5.119787227024403e-01   +3.199209612360917e-01   +4.554819099045280e-01   +1.188276672687368e-01   +1.069576577798352e-01; +9.135651037361706e-03   +2.860759901732803e-01   -2.842602296848767e-02   +1.045186042708726e-01   +1.831586303726908e-01   +3.129532466669823e-01   +2.173378265980921e-01   +4.850516864994781e-01   +5.243353727676741e-01   +3.495442558190510e-01   +4.005808814735176e-01   +1.292397335742373e-01   -4.912163731485776e-02   +5.486317492924759e-01   +4.825384272272135e-01   -1.231516643781353e-01; +5.367006737811126e-01   +5.286583428316569e-01   +4.534406458270910e-01   +3.417590227715746e-01   -1.519317917058904e-02   +4.992976865117815e-01   +5.329458462157771e-01   +4.708497692290453e-01   -2.752126531213408e-01   +5.649191490818428e-01   +1.834377136559598e-01   +2.527222710300815e-01   +3.626046341906416e-01   +7.000129306275205e-01   +5.263928566107725e-01   +2.390613708365408e-01; +8.115067334592801e-01   +2.606527524147511e-01   +4.312143966138474e-01   +6.103850795088495e-01   +4.756956387081003e-01   +2.446333754829850e-01   +1.196636356394137e-01   -1.947196890992570e-02   +5.775214603860098e-01   -5.144203962374198e-02   +2.035018605415360e-01   +3.967578240611022e-01   +3.436524869017523e-01   +6.402750393986537e-01   +4.978196531092424e-01   +7.900981019795750e-02; +5.178078248727832e-01   +2.228700627820794e-01   -1.562759138624361e-01   +2.227886805556371e-01   +5.945538340171834e-01   +1.187056050597858e-01   +2.451283135783147e-01   +1.531946203766285e-01   +2.369186258458333e-01   +1.236380505249300e-01   -2.057024981394440e-02   +2.006751307639527e-01   -8.278933787943013e-02   +5.968826930877077e-01   -2.159688029675993e-01   +9.690145652282009e-02; +4.107619889165894e-01   +3.065580942538116e-01   +4.579739810843126e-01   +1.910074264950959e-01   +3.081083372637178e-01   +6.376801099041702e-01   -2.561081150241618e-05   -1.145881983443068e-01   +2.343641771917837e-01   +2.533146068728794e-01   +4.628430821352472e-01   +4.837825947209889e-01   +1.419313965169462e-01   +6.598777575732305e-01   +3.703970795520911e-01   +3.136404827200345e-04; +1.862167464148949e-01   +3.663659101701613e-01   +5.353214719612862e-02   +3.861960529599122e-01   +1.775931633054283e-01   +5.514534991403222e-01   +4.670538672242764e-01   -8.954854537099605e-02   +2.443754705327171e-01   -8.133210261860045e-02   +3.816250813383108e-01   +4.894615995395125e-01   +6.581478767880508e-02   -4.029031844730074e-02   +3.489166022431921e-01   +1.780861189213980e-01; -1.044017057282161e-01   -2.641771790419438e-01   +3.027246203322606e-01   +3.007703848948416e-01   +2.949295677704228e-01   +4.326754024096642e-01   +6.673601655904134e-01   +3.797791336455104e-02   +5.388757873243097e-01   -1.375784944380948e-01   +2.098556490672559e-01   +3.937466137253425e-01   +1.907932833088494e-01   -6.587753192941498e-03   +5.225863388021211e-01   -2.368635537334185e-01; -3.337825742817185e-01   +1.958111671800018e-01   -8.729394052815904e-02   +3.770548194740246e-01   +1.224982899484203e-01   +6.571129000092523e-01   -8.011193875951644e-03   +2.818996261337642e-01   +1.832653916311667e-01   +2.821932634283656e-01   -3.699510525416672e-03   +5.553104881886792e-01   +4.309626451677505e-01   -1.050482033974607e-01   +6.890068803792048e-01   +3.543385366725458e-01; -1.978865793928248e-02   +6.585991304952182e-02   +2.348560115335439e-01   +5.027903262355838e-01   +5.513112610866222e-02   +7.086208859352268e-01   +4.448990325647398e-01   +1.130051111930234e-01   +7.068242448600466e-01   +5.156049410096152e-01   +3.206888651724864e-01   +6.598467937510546e-01   +4.016069700884046e-01   +5.606184837279813e-01   +7.196689889695614e-01   +6.728400335637070e-01; -2.265071148444855e-02   +5.381035557288559e-01   +6.092003296466947e-01   -1.906425264399686e-03   -2.325576474211530e-01   +2.559824720584226e-01   +3.554375161234323e-01   -1.234080286808273e-01   +3.288297428966200e-01   +4.069697808057250e-01   +5.383801993956440e-01   +3.720566904526612e-01   +5.349767726121872e-01   +2.689674372090476e-01   +3.519809309950288e-01   +2.847825712991279e-01; +9.111420488005553e-02   +4.251980951582265e-01   +4.962084870251683e-01   +4.793459852369581e-01   +6.683387057810118e-02   +1.903416653643984e-01   +8.625810377424362e-01   +7.502054217191568e-01   +1.094589321066667e-01   +2.998617701948247e-01   -1.857095982235774e-01   -1.396498796216630e-01   -8.883683428074751e-02   +2.159129661122086e-01   +1.159417178114070e-01   +4.320881502837372e-02; +4.387297466453965e-01   +1.930201715460169e-01   +3.203917897801500e-01   +5.344466148805216e-01   +2.824079988340643e-01   +3.244772380399461e-01   +2.089293638001962e-01   +5.542970448182378e-01   +3.551576116301167e-01   +3.907412963651722e-01   -1.124950537843106e-01   +3.632289682497785e-01   +3.314155838878623e-01   +7.536889928055734e-01   +2.416912464041847e-01   +6.225116816245264e-01];
L1E_L1I_iGABA_netcon = [+2.265027945244603e-01   +2.166759951659555e-01   +8.280931622061076e-02   +1.750751154789148e-01   +3.109470679889903e-01   -6.813199455228694e-02   -3.020024527098615e-02   +2.355741105963658e-01   +3.000165293558983e-01   +2.529286986665813e-03   +7.255658514648449e-01   +4.714568671479973e-01   +1.804804245722326e-01   +3.398950953937468e-01   +3.659844086881452e-01   +2.825417342531411e-01; +3.247548749465971e-01   +2.245659903651063e-01   +5.453757570752705e-01   +6.850550863669020e-01   +2.257587536089745e-01   +2.722630540272749e-01   +1.580802938670098e-01   +7.189197425222109e-02   +1.222853513636478e-01   +3.366593119859364e-01   -6.547949622253829e-04   +3.742652771208311e-01   +9.805136975986115e-02   -1.463319082110729e-02   +2.093361325221848e-01   +2.751699601795640e-02; +4.037568844399753e-02   -4.630658992595279e-02   +8.841869598624801e-03   +5.788717579389961e-01   -6.185532393851909e-02   +1.832420811950992e-01   +2.075860256590019e-01   +2.060334427040321e-01   +3.493276206133616e-01   +2.095625132409187e-01   +2.010333489029948e-02   +3.448725361124113e-01   +7.406890478765421e-01   +2.963666768175436e-01   -1.228625557930485e-01   +2.468117479397158e-01; +1.179783225619666e-01   +6.035279638492191e-01   +3.816670159568032e-01   +2.449455421395553e-01   +4.459642125847938e-01   +3.351739618557261e-01   +2.951520403894013e-01   +2.408841266604603e-02   -9.029251037119074e-02   -7.306784095231892e-04   +1.449325808285828e-01   +3.314418501084648e-01   -1.426056130711318e-01   +2.474078564204306e-01   +2.619840590062875e-01   -9.413623330934643e-05; -3.862201188445395e-02   +3.143958545879098e-02   -1.162203694563469e-01   +3.723822957867545e-02   -1.441559123668724e-01   +3.699166541148538e-01   -3.194592087148106e-01   -2.222407641913744e-01   +1.943985076735804e-02   +2.560339850385824e-01   +2.066699642538622e-01   +4.136676619642554e-01   +4.742336329251712e-02   -2.960561772801806e-01   +2.322118094766094e-01   +1.000000000000000e+00; +3.672780796688411e-01   +3.647641020384753e-02   -1.212640939048859e-01   +2.316644617855460e-01   +2.433456792156147e-01   +2.825044697740159e-01   -1.811854578825814e-02   +7.339364255762849e-01   +2.019829145016677e-01   +9.049077261446097e-01   +4.087248657122224e-01   +3.706284449187466e-01   +3.946420957098891e-01   +4.091665651987314e-01   -1.491863491623738e-01   +2.898302857644872e-01; +9.931679764892820e-02   +2.476323335886390e-01   -1.085518608389933e-01   -2.019716908779273e-02   +2.457719809936426e-01   +1.459339311780055e-01   +4.426941380209565e-01   +6.102046770717286e-02   +2.877732303800007e-01   +4.562529621020486e-01   +5.229252524619245e-02   +6.573842085945485e-01   +2.304790849106783e-02   +4.526929958144251e-01   +1.824729620905857e-01   +4.890596686538123e-02; +3.386959797315017e-01   -2.538289062187277e-01   +4.453309359307674e-01   +4.925656771414633e-01   -1.168892851227372e-01   +6.789588007587801e-01   +2.383067967738670e-01   +5.367818232053225e-01   +2.174103812336058e-01   +2.430846468289139e-01   -1.753188338913145e-01   +5.651183637705359e-01   +2.637416238046807e-01   +8.304303242802442e-02   -4.786587957893463e-01   -1.998831743214664e-01; +1.015554146173078e-01   +1.943539605948918e-01   +3.797670038048627e-01   +7.994790453111543e-02   +4.655157931084951e-01   +1.684848967095270e-01   +5.575801778498798e-01   +1.672696644734126e-01   -9.085989529756062e-02   +6.501811238563365e-01   -8.239819194216967e-02   +1.151885679787662e-01   +2.359789329231292e-01   +1.112153878031918e-01   -1.624449175291520e-01   +1.697536822303667e-01; -4.473457928121453e-02   +1.458693606281074e-01   -9.864013456793383e-02   -1.759091643752986e-01   +5.633319533870926e-01   -2.855618545316019e-01   +3.589843561306599e-01   +8.629335577297794e-01   +1.916273867490587e-01   +2.791924699491272e-01   +3.011648400379719e-01   +3.346532300193429e-01   +1.181187685078970e-01   -1.756893351276430e-01   +3.069305025738808e-01   +8.321767737705628e-01; +6.095429700583481e-01   +2.324638683974533e-01   +4.552674968661639e-01   +4.811161937303862e-01   +4.823839548721161e-01   +1.645963891473235e-01   -1.345125937922121e-02   -1.084650268185870e-01   +3.307018216066575e-01   -1.877657419764190e-01   +1.090638178756802e-01   +4.247209979121709e-01   -1.664425556872928e-01   +6.350769862676170e-01   +9.063325092334995e-02   +2.488056479753256e-01; -6.545659688094362e-03   +3.388605983596494e-01   +2.702621297851760e-02   +6.413700205734519e-01   -2.690921520436003e-01   +2.510183107140977e-01   +1.425870717475340e-01   +4.365115251204686e-01   +5.381203866753189e-01   +2.395020114822346e-01   +3.901391151342364e-01   +4.955833627445833e-01   +1.660182003175813e-01   +1.931858428532293e-01   +2.077546619173021e-01   +5.528025768249924e-02; -5.055213760739616e-02   +4.798813102776602e-01   -8.014944659654498e-02   +3.447854378846162e-01   +3.389861317187075e-01   +2.954766468519872e-01   +2.394602531488499e-01   +6.154601163084682e-01   +5.063935050458963e-01   +2.821543870955714e-01   +2.207893825830624e-01   +3.265482541047497e-01   +1.651943351561150e-01   +2.835078045375273e-01   -1.358577850890398e-01   +4.385882107537269e-01; +4.231110882155358e-01   +7.948221889065916e-03   +3.347289607601307e-01   +3.423630793532619e-01   +3.791698180861101e-01   +2.142384729841315e-01   +4.612927097201925e-01   -2.169113344229630e-01   +2.594768189701204e-01   -2.464162187659901e-02   +7.732155542519089e-01   +6.642676406805378e-01   +3.796196848506014e-01   +5.362436241357190e-01   -1.997030359039167e-01   +3.281760293125661e-01; +1.945012625477215e-01   +7.178162894513064e-02   -1.396273554417140e-02   -2.160539022609732e-02   +3.735191441307422e-01   +3.393682416697042e-01   +4.689957741261684e-01   +4.765411629872112e-01   +7.344197256551626e-01   +2.969640009351587e-01   +3.194275335679376e-01   +1.398217514588243e-01   +2.415079407347047e-01   +1.554792893124883e-01   +1.470562314246247e-01   +3.153202723301827e-01; +6.728982696451514e-01   +1.041163597153302e-01   +3.912930600061429e-01   +3.002304532561655e-02   +8.348876809930060e-03   +2.173329279640350e-01   +6.769464763693298e-01   +2.101916236870718e-01   +4.327415010804773e-02   +3.283143678233066e-01   +5.787761232736198e-01   +8.107942926927443e-03   +4.695112231568171e-01   +2.629743503395849e-02   -3.157869427214464e-01   -1.971324091274669e-01];
L2I_L1I_iGABA_netcon = [-3.061649735818114e-01   +5.046494611045359e-01   +5.830086261453454e-01   -8.517716024335459e-02   +2.767752304864416e-01   -5.111059579895232e-02   +2.927255167493018e-01   +2.811806221217870e-01; -1.893939802309986e-01   +2.909872207060396e-01   +3.857097419983500e-01   +4.776342420631488e-02   +6.297672694718689e-01   +8.696322970073114e-02   +2.859316122426274e-01   +8.929667841084190e-01; +7.514739769488289e-02   -5.083409100661640e-02   +5.534978978948342e-01   +4.909493516568872e-01   +2.253136564493460e-01   +3.552639359688056e-01   +1.740307143560840e-01   -6.588910884876711e-02; +3.064704756986673e-01   +3.078840726173835e-01   +4.436390882571912e-01   +8.931915409633263e-01   +3.546628893857027e-01   +2.252969632871354e-01   +2.797398190797968e-01   -3.034638099150043e-02; +8.391900201824491e-01   +2.048291081937599e-01   +3.389124991503067e-01   -1.374876976712000e-02   +3.706305882100469e-01   +4.230924160242240e-01   +6.034558135696717e-01   +1.547275827758344e-01; +2.544839639654735e-01   +4.635224718451471e-01   +3.733299042506274e-01   +6.399180572893118e-01   +5.048164209900071e-01   +6.584631359091554e-01   +2.428489910350812e-01   +7.290935594519600e-01; +4.673092835321338e-01   +4.903986862146825e-01   +2.300353314865907e-01   -6.449511532347238e-02   +7.992487842383803e-01   +2.756196998043836e-01   -2.369859114264888e-01   +6.202928613319308e-01; +7.431777054531078e-01   +5.107626608144478e-02   -1.365660269724023e-01   +2.306503924471862e-01   +4.969060144095307e-01   +7.002934186446921e-01   +6.669887485161738e-01   +1.960272896692631e-01; +1.131059380303696e-01   +1.002040603018681e-01   -1.370216925921016e-01   +1.286262858555342e-01   +4.079439132796913e-01   +7.659981245194436e-01   +3.782299587989039e-01   -8.228926310908019e-03; +4.266334309948096e-01   +4.758202568659219e-01   +4.947284636556711e-01   +1.261505923462989e-01   +6.119467511974139e-01   +2.197557728129911e-02   +7.415847358635808e-01   +4.369275811907838e-01; +5.050783970662700e-01   -6.442892457865773e-02   +7.690579130306389e-01   +5.978725298414018e-01   -1.590322560967959e-01   +2.435378361058028e-01   +5.779202648829270e-01   +3.051185637392402e-01; +3.641736074226780e-01   +1.094158823661280e-01   +4.484957281982714e-01   +3.699242389013455e-01   +5.456548695674450e-01   +4.669423618493557e-01   -2.152161978248351e-01   +2.441846899826112e-01; +8.110292322470875e-01   +8.515384903226512e-01   +1.122149658421834e-01   +3.556314367229537e-01   +4.981465784584228e-01   +5.890510945761997e-02   +5.496499301492723e-01   +4.654989382193878e-01; +3.246301936679787e-01   +9.226950505419734e-01   +3.147388059483126e-01   -2.105798293414163e-02   +6.695748217095725e-01   +6.519409688846707e-01   +6.066296987738257e-01   +5.018208660738731e-01; +4.786845031183146e-01   +6.742910296962876e-01   +6.346179606237735e-01   +4.656047357933648e-01   +4.513556141130239e-01   +3.938025288336094e-01   -2.246000250499658e-01   +3.305313038357532e-01; -5.868979425471049e-02   +5.922116745119020e-01   -1.182148068569633e-01   +1.011078420052133e-01   +6.834364644815183e-01   +9.245509634782403e-02   +2.112320816113045e-01   +3.629892546047513e-01];
L1I_L2I_iGABA_netcon = [+1.095285333126184e-01   +9.517165179541679e-01   -5.268135666592604e-02   +1.569726341026818e-01   +7.465661752738728e-01   +6.662483913901857e-01   -2.277840142361188e-01   +2.346653375912860e-01   +2.602043075984719e-01   +3.466242124779962e-01   +4.874291372383255e-01   +3.624613153597636e-01   -1.198793410983022e-01   +4.760620485683023e-01   +2.390963978900136e-01   +5.985475504850394e-01; +8.665749693956876e-01   +6.299009028667349e-01   +4.307071676029013e-01   +5.768011816797595e-02   +7.097615710190076e-02   -2.389618060326803e-01   +1.208360743344114e-01   +2.111149769853568e-01   +1.709162122106642e-01   +1.233025604182693e-01   +1.541758418761076e-01   +2.103368055868173e-01   +5.501816901508063e-01   +3.231579892164162e-01   +8.740296023989279e-01   -4.484799716507237e-01; +4.887010984904416e-01   +2.668364472222846e-01   +7.682599699294863e-01   -1.226026419720105e-01   +1.939706347570841e-01   -3.601873937288377e-02   +5.465664539335299e-01   +3.466731290908329e-01   -7.630338654320720e-02   +7.018964613591293e-01   +4.642604220095012e-01   +1.876507486184862e-01   +4.930488581705750e-01   +5.207755764491457e-01   -4.913722399824264e-02   +4.200888792027282e-01; +4.658276090367764e-01   +3.766727919703091e-01   +1.316395027089986e-01   +3.985897826895171e-01   +8.367506903594826e-01   -4.130953736877436e-03   +9.771641891683222e-02   +2.470393100903727e-01   +7.557033567148396e-01   +3.423228490301202e-01   +6.942936712216415e-02   -8.906980362617026e-02   +3.398620755526437e-01   -8.981822064820781e-02   -1.189384789455124e-01   +4.649166969076409e-01; +5.982240606185014e-01   +8.243361092750454e-01   +6.017937718684773e-02   +8.706477862676348e-01   +4.345002680443896e-01   -3.656664927727486e-02   +3.197336662935562e-01   -3.143779239113813e-01   +3.728428782624362e-01   +5.115494372609487e-01   +6.439925175529165e-01   +8.458294636545229e-01   +3.904550445360328e-01   -7.080198271981655e-02   +1.916581076382021e-01   +3.211465378830372e-01; +2.930605442323130e-01   +1.493669049254757e-02   +4.154537852298072e-01   +2.574229375591854e-01   +3.626796719357233e-01   +5.647292031348304e-01   +6.492533819336376e-01   +2.316995392438399e-01   +4.831298654631624e-01   +4.622968304175635e-01   +7.113503339803462e-01   +6.490359315182087e-01   +1.678604331518219e-01   -1.868535380455572e-01   +2.121656755269113e-01   +6.982828929449775e-01; +5.785132980670140e-02   -2.808187413830187e-01   +5.776068611481399e-01   +4.251220510437156e-01   +2.474595175523205e-01   +5.466128063875524e-01   +9.362205725512711e-02   +1.825111214128993e-01   -4.066900783180852e-02   +4.000529628905781e-01   +6.408449560379985e-02   +1.898809655405241e-01   +2.442731271643429e-01   +4.942171361588079e-01   +3.006372529743890e-01   -6.064500061659883e-02; +2.800227041960271e-01   +6.845174848626876e-01   +2.627082669294706e-01   +2.125930578192100e-01   +5.600023078932079e-01   +5.230082549884217e-01   +6.148904298887447e-02   +1.745801669841594e-01   +4.469564741623426e-01   +5.142254260767922e-01   +3.796839055389634e-01   +7.120615639594949e-01   +5.853722325065189e-01   +1.000000000000000e+00   +3.027461965287210e-01   +3.619455869590409e-01];
L2E_L1E_iAMPA_netcon = [+3.960579737558178e-01   +5.161191423354756e-01   +6.600085145391491e-01   +5.391925841950638e-01   +2.755928745351961e-01   +6.711004546532274e-01   +4.602978937852406e-01   +2.975560038404761e-01; +1.086822163737040e-01   +3.358649768769838e-01   +4.032674303667665e-01   -7.496505594426743e-02   +3.900635760431865e-01   +2.873376282209563e-01   +4.175638209686850e-01   -1.574533381917496e-01; +1.541376990315851e-01   +3.025225064011522e-01   +8.512524900840589e-01   +3.630217735454269e-01   +1.728299305635582e-01   +8.307686600234088e-01   +3.679652665865314e-02   +5.364554631637661e-01; -1.780236988965700e-01   +2.248964524603501e-01   +4.870253457981034e-01   +2.475412483536881e-01   +1.240393407353316e-01   +5.090551396863240e-01   +1.912805057805795e-01   +2.086345212457241e-01; +8.300045876656670e-01   +2.567554757013308e-01   +2.469430036120143e-01   +6.268709127416696e-01   -8.808477759493660e-02   +3.196708989215477e-01   +3.351358954303350e-01   +7.482975754560026e-01; +2.736477159885263e-01   +2.709255796519499e-01   +7.102680516357384e-01   +4.091814785618111e-01   +2.220099001780663e-01   +7.100852267169847e-01   +6.518006939107082e-01   +4.555937251431306e-01; +3.987537837747014e-01   +3.925588516773383e-01   +9.579323286658613e-01   +3.099266223703118e-01   +1.595349575865537e-01   -1.005194884045884e-01   +2.727634093542641e-01   +7.521886229954224e-01; +4.495750036620028e-01   +4.098130702707601e-01   +6.301589303706461e-01   +4.031596202225922e-01   +4.105098979584326e-02   +9.994743113696151e-01   +3.321693099178152e-01   +5.713457182261337e-01; +1.805534616440548e-01   -2.235702643040566e-02   +4.210601596824133e-01   +4.920712965799164e-01   -2.960869390620361e-01   +4.760156264451436e-01   +2.875534563277467e-02   +6.755188716358556e-01; +4.717378275212464e-01   +2.636794538813539e-02   +5.647993672719698e-01   +1.039838558960468e-01   +4.237027786596673e-01   +4.175585483531788e-01   -5.212843939261184e-02   +6.570337667840740e-01; +2.084057755700885e-01   +3.784099064461037e-01   +4.389055167099609e-01   -3.502564168306463e-01   +2.386539976224067e-01   +3.364926377835639e-01   -5.403180093669137e-01   -1.684513534792464e-01; -5.837886727710185e-02   +3.975709250830436e-01   +4.097053916081999e-01   -7.598254891169395e-02   +8.780508960865577e-02   +4.849434394660138e-02   +6.841709498592259e-01   +5.157549279297775e-01; +1.683869612502793e-01   +5.373258243073922e-01   +8.965023601796028e-01   -4.354608557349779e-01   +4.829174349535825e-01   +6.215643232286466e-01   -1.071544638923182e-01   +6.370028236333676e-01; +1.247278830531315e-01   -5.557663710919225e-01   +1.477844331617959e-01   +2.664873844169070e-01   +4.330308169414276e-01   +6.529603094772363e-01   +2.067457155602934e-01   +1.844359511201919e-01; +8.286666949678537e-02   +3.373748866263844e-01   +1.819916178549191e-01   +1.487656108437286e-01   +8.773231886813658e-02   +3.624373326873317e-02   +1.880319168035473e-01   +2.421453563026084e-01; +3.470388945776407e-01   +8.733131402412471e-01   -3.812657889302634e-02   +1.014588746596927e-01   +5.487138411342657e-04   +2.108464346136369e-01   +2.752038623916153e-01   +4.486816005662698e-01];
L1E_L2E_iAMPA_netcon = [+5.817234121272596e-01   +1.678454501592056e-01   +1.278182974116169e-01   +4.700443643779645e-01   +3.455013375437664e-01   -4.481754514514395e-01   +2.403836402315703e-01   +4.467414381053333e-01   +1.978040260204835e-01   +2.895634485462836e-01   +3.224292755613763e-01   +9.886028922514655e-01   -2.377152984664730e-01   -1.917500780235660e-02   +6.065505932693007e-01   +1.156193840639174e-01; +5.145011828630591e-01   +8.234260198714041e-02   +4.065004476996668e-01   +3.066859726166229e-01   +1.797153677619324e-01   -8.301552158995505e-02   +1.859985705303532e-01   -1.284763094406791e-01   +5.031300447287401e-01   +9.238247449858713e-01   +4.534942416591786e-01   +4.181037917260789e-03   +4.114494541198875e-01   +5.088156474529780e-01   +4.913466006342135e-01   +4.214187297592043e-01; +4.195880333774596e-01   +6.728434529603579e-01   +1.294957041728211e-01   +3.444767479033796e-02   +2.950246365373805e-01   -3.870668109256043e-02   +4.609291486737664e-01   +4.583841510095610e-01   +4.099699839661340e-01   -1.335925591197823e-01   +4.637011377841859e-01   +1.281372999034469e-01   +3.044675988478617e-01   +2.186019454556130e-01   +1.541866495401712e-01   +4.928244934182494e-02; +5.653293807741377e-01   +2.435476436817258e-02   +2.979650370535086e-01   +4.003445884795357e-01   +2.151189107869121e-01   -7.731295313201183e-03   +2.875714745332527e-01   +1.721763536648975e-01   +7.387811112551254e-01   +4.551759915934269e-01   +7.883665677974690e-02   -1.077860375356122e-01   +2.096886141615922e-01   +5.552471767806809e-01   +3.680766058143675e-01   +8.107477976498655e-03; +5.691606592342826e-01   +1.332531312939968e-01   +1.589007243774788e-01   +4.966141097111973e-01   +4.211568823605801e-01   +4.413560869666331e-01   +4.880210958565729e-02   +2.207121298003398e-01   +2.615136869796932e-01   +2.099713851392279e-01   +2.976564132185474e-01   -4.623854398758014e-02   +4.190986344537069e-01   +5.370968321681329e-01   -1.385605436482987e-01   +3.505946326458295e-01; +2.818605339994122e-01   -1.308765028980542e-01   +3.262333893471998e-01   +2.799821969394511e-01   +8.409761699653802e-02   +1.883975456986016e-01   +4.600126999201168e-01   +4.091942684420798e-02   +2.066403751966367e-01   +2.303599058701049e-01   +1.637434736180229e-01   +6.153314528910822e-01   -3.048786460617262e-01   -2.873646460172165e-01   +2.209189170767403e-01   +5.832901533595714e-01; +4.142433669411436e-01   +2.146627052972921e-01   +4.418405666184707e-01   -5.009997469001033e-02   +1.000000000000000e+00   +3.800094136419861e-01   +1.585080926870453e-02   +4.720479662409859e-01   +3.391325448494543e-01   +3.799088270827556e-01   +3.884156003659252e-01   +1.789375607100803e-01   -6.841431770579716e-03   +2.325566643974613e-01   +7.154385967300405e-01   -2.486042270791562e-01; +3.319171539196512e-01   +2.850772432083743e-01   +4.440886172384521e-01   +9.288580146527954e-04   +8.502457714880509e-01   +2.287614132264990e-01   +5.408297299999701e-01   +2.965888973470494e-02   +2.687790482910344e-01   +1.988602614912495e-01   +3.982762993786563e-01   +3.117455296530864e-01   +4.381212763656272e-01   +7.453616593297061e-01   +6.232527733843184e-01   +3.739454417284244e-01];
L2I_L2E_iAMPA_netcon = [+3.401193457682112e-01   +1.000000000000000e+00   +9.646140027395035e-02   +3.245246611088365e-01   +7.169371484892479e-01   +4.772244506102659e-01   +7.685821443788633e-01   +1.806258904456894e-01; +6.405601227233237e-01   +1.161243675309069e-02   +2.465824700606247e-01   +9.827126225226822e-02   +4.584332902377152e-01   +7.008582099000830e-02   +2.963367934160926e-02   +9.212267420110074e-01; +6.723723809162874e-01   +1.932007635402094e-01   +5.835078265912867e-01   +2.129573125192722e-01   +4.410692883001370e-01   -1.118158818344251e-01   -1.547329725600359e-01   +7.064307691678198e-01; +1.998097265980585e-01   +6.400143295789851e-01   +2.169713527663408e-01   +2.157456769074960e-01   +7.334748688237884e-01   +3.207135040297741e-01   -6.826027501400785e-02   +4.615847678362768e-01; +4.065337793556822e-01   +4.451408304188571e-01   +4.734609466853829e-01   -4.843223778517357e-02   +4.066844373027420e-01   +2.514800123513709e-02   +1.709891774541407e-01   +3.112101816163264e-01; +1.184186859439374e-02   +1.576215102002039e-01   +3.558314488628902e-01   +6.860767821774798e-02   +6.653654305235439e-01   +4.057206409497551e-01   -4.545367621725137e-02   +5.770563614484167e-01; +1.190771886362398e-01   +3.952636785820446e-01   +5.651914118995741e-01   +2.182063429353484e-01   +1.855241962664102e-01   +2.410732170146021e-02   +4.703343322764830e-01   +4.711359374652273e-01; +2.127848046599365e-01   +4.516112781395207e-01   +3.771958414102406e-02   +6.378072233916235e-01   -1.738259426275234e-01   +5.036243535850417e-01   -2.993514215958129e-02   +3.517068518422464e-01];
L2E_L2I_iGABA_netcon = [+5.418644517192973e-01   +5.392584697649214e-01   -2.432736548955106e-01   +8.378889775481612e-01   +4.179082996908660e-01   +5.189853676274524e-01   +5.378083047496288e-01   +2.419846399935378e-01; +2.986278085074482e-01   +5.159635581243479e-01   +1.485649461713275e-01   +1.489609577719725e-01   +2.639431359040024e-01   +1.920804285338127e-01   +1.548662992310688e-01   +6.839988802596009e-01; +4.785270536009476e-01   -2.004098926324218e-01   +5.197231917220749e-02   +5.182527437500822e-01   +9.970824182575484e-02   +3.768116467254713e-01   +1.064548111164400e-01   +2.302789739616470e-01; +9.467410050266314e-02   +2.732882472093611e-01   +1.515379046638734e-02   +3.956780061920093e-01   +4.072115863835929e-01   +2.674930505338253e-01   +5.188521700007813e-01   +4.611027906915320e-01; -5.113640988056927e-02   +3.832994776452990e-01   +1.752663268342769e-01   +3.348396137409761e-01   -6.091154476490189e-03   +3.016411118608143e-01   +7.563003332663863e-02   -1.243137643754787e-01; +1.288156543832054e-01   +5.183134860435761e-01   +9.047379728614167e-01   +8.198918264829345e-01   +4.029627726358109e-01   -4.711694333948666e-02   -5.124168978974948e-03   +6.206049704246275e-01; +6.296110050789664e-01   +2.651786508385556e-01   +2.258550489329120e-01   -1.844448039447950e-01   +3.144145219941471e-01   -1.946977257739399e-01   +4.105398700761370e-01   +2.680632833477136e-01; -3.786130222746595e-01   +3.327349114357818e-01   +5.253679365298495e-01   +3.377305878771515e-01   +5.919080258084727e-01   +2.466308129770142e-01   +7.312186128573559e-01   +5.201359287319014e-01];
L3E_L2E_iAMPA_netcon = [+3.165744227251691e-01   +2.958926472340437e-01   +4.526078686116456e-01   -1.385979569795983e-01   +3.719180615236981e-02   +6.729653782933193e-01   +6.563989563078029e-01   +1.519027280483565e-01   +5.216862479783576e-01   +1.999169802121240e-01   +3.736456238482242e-01   -5.696861681135713e-02; -3.330530014007312e-01   +7.805895793041618e-01   -3.918720125995131e-01   +1.855474188029609e-01   +1.426383378830959e-01   -7.482675434810114e-02   +3.722969080701711e-01   +1.796732231308429e-01   +4.533602779086662e-01   +3.565408158265318e-02   -1.595200866494269e-01   +2.800827664563775e-01; +1.740435657864041e-01   -8.720959455478239e-03   +7.499551563172538e-02   +4.100326668632364e-02   +2.138235973574524e-01   +5.870022093883330e-01   +9.975529907469084e-02   +5.746159235039325e-01   -1.209119984000097e-01   +1.531756872820379e-01   +3.684362430209603e-01   +6.354792068140261e-01; +2.535618748771771e-01   +3.992347240764788e-01   +4.906049523870682e-01   +5.661725802684545e-01   +3.800379091283165e-01   +7.141369495383474e-01   +1.420476759772656e-01   +7.335355510305208e-02   +5.279735287155189e-01   -3.854901962973885e-01   +4.846587891087854e-01   +9.917898025270989e-01; +2.263197607488314e-01   +3.959971950788459e-01   +4.206837369553085e-01   +1.479255169584710e-01   +2.115658472291699e-01   +2.984897575541104e-01   +4.036261780093695e-01   +9.901604793115147e-01   +4.882867221491924e-01   +2.353366382404587e-01   +4.390609199347720e-01   +2.961776083096465e-01; +2.542942600775563e-01   -8.812553414108663e-02   +7.472814249984794e-01   -2.444840148836841e-01   +4.671912305482588e-01   +5.258708013130008e-01   +1.527259579806778e-01   +1.026946956293733e-01   +4.382746522498879e-01   +3.027647375673133e-01   +5.290761235739232e-01   +1.182046769856768e-01; +3.241789660637993e-02   +3.216133712065711e-01   +2.425456748826622e-02   +2.645688572565441e-01   +1.000000000000000e+00   +5.946191225336235e-01   +6.177920157546423e-01   +5.554710557899061e-01   +2.977320047557357e-01   +4.792401742716550e-01   +3.968246683301533e-01   +5.821464639286701e-01; +1.640443734369420e-01   +1.784742793915275e-01   +1.350593693301721e-01   +5.628392193250316e-01   +4.619792416773127e-01   +4.713336760405805e-01   +6.511905400811213e-01   +4.489086145327161e-01   +3.761799198156821e-01   +2.735839121245450e-01   -8.195453358633938e-02   +1.177345303201873e-01];
L3I_L2I_iGABA_netcon = [+6.950223045167699e-01   -1.015786432378714e-01   +1.632322506624121e-01   +6.113705349209494e-01   +3.068700901912914e-01   -9.062862037638753e-02   +2.333774534496285e-01   +3.315425016818189e-01   -9.956673838783330e-02   +1.725517622304238e-01   +1.217594011144574e-01   +3.572538142660298e-01; +8.224434785148185e-01   -6.943624363460020e-02   +2.492463476621782e-01   +3.539418639479380e-01   +7.489582803189777e-01   +5.091273615911757e-01   +1.925968159930712e-01   +6.025478549576987e-01   +1.591514614354969e-01   +1.030654468298412e-01   +2.927418027815344e-01   +4.696524660838328e-01; +5.331241516079768e-01   +4.780937168748972e-02   +4.287805031107827e-01   -3.657838655210496e-01   +3.694663867307196e-01   +2.745421434650068e-01   +3.769873618706155e-01   +1.795905503720387e-01   +3.303463719125624e-01   +6.105478147869475e-01   +2.655560869400247e-01   +1.000000000000000e+00; +4.283312714026521e-01   +1.277184385325880e-01   +4.883877185021046e-01   +5.908092052654038e-01   +4.769811574368470e-01   -3.758963744154455e-01   +4.550604109073352e-01   +1.747856427548538e-01   +7.166090265165029e-01   -1.735319459467515e-01   -2.340477586064359e-01   +2.186204173124093e-01; +5.760156376403179e-01   +4.873684244154992e-01   +5.856370593503486e-01   +6.878119557511196e-02   +5.894067704910921e-01   +7.756956121131083e-01   +4.475685463048930e-01   -1.992047076579962e-01   +1.210321345042214e-02   +4.263864516895026e-01   +4.041729920206833e-01   -6.342656010930528e-02; +4.486198275716217e-01   -7.078251252492906e-03   +4.129673476139352e-01   +6.739049181167284e-01   +5.911234919596307e-01   +5.560785529685417e-02   +4.342408195799440e-01   -9.460224912771070e-02   +3.390641976100289e-01   +2.459169796383254e-01   -1.197500223633766e-02   -8.321041175268612e-02; +4.848103147940316e-01   +1.875336688614530e-01   +6.556664696431774e-01   +1.947370831702116e-01   +1.289335959364357e-01   +5.179663451006440e-01   +6.506717958574816e-02   +3.756463356532530e-01   +6.495856346986920e-02   +8.275251775302540e-01   +1.512763922989280e-01   +3.763897012805403e-01; +1.950408477755177e-01   +4.891376521230340e-03   +3.055829911423559e-01   +4.303562616576123e-01   +1.015408227543602e-01   -1.207110903114239e-01   +1.563270169623403e-01   +4.020272296677137e-03   +2.054848281628570e-01   +5.192938496399111e-01   +3.941973249137245e-01   +3.498198835767668e-01];
L2E_L3E_iAMPA_netcon = [+7.577860026289734e-02   +9.267825225174759e-01   +4.029930847156901e-01   +5.339299223968499e-01   +1.149453308838116e-01   -1.097673364272080e-01   -2.189319190580481e-01   +2.329802991139081e-01; +2.069527798210815e-01   +2.679218625231479e-01   +5.948494180837571e-01   +2.927613725163987e-01   -1.446502948291747e-02   +2.881920144430691e-01   +5.077606637130596e-01   +6.092205007841085e-01; -1.919130183410002e-01   -3.749455254798564e-01   +4.491081581281301e-01   +5.446659113288045e-01   +5.108818116809504e-01   +5.012978443860910e-01   -9.409300139233973e-02   +1.095459763661856e-01; +2.804880898774097e-01   +2.871479953998156e-01   -7.318428346929649e-02   +9.099459512058159e-01   +5.347757345110589e-01   +4.287556633734642e-01   +4.788321241905587e-01   +2.534827446662041e-01; +5.202520751983626e-01   +4.977963769685928e-01   +3.029497745725147e-01   +6.481932159480235e-01   +4.115232076351797e-01   +4.917011439210029e-01   -7.658374319602923e-02   +8.351287822234695e-01; +8.586833045151423e-01   +5.571649995550423e-01   +3.760365840713641e-01   +1.120770682571631e-01   +3.149579908162545e-01   +4.243896964058544e-01   +6.659662400258430e-01   +5.354807525045095e-01; +7.992738077237860e-02   +2.104183652882606e-01   +3.671345171194437e-01   -3.264362405092170e-01   -7.115243683831991e-02   +2.682095358727155e-01   -2.096318487595312e-01   +3.699240337144040e-01; +5.022360926451839e-01   +4.045965316108668e-02   +7.193519015795959e-01   -6.106151588314501e-02   +2.062731900018624e-01   +7.382543524843177e-02   +6.171815182287620e-01   -2.540012929090477e-01; +2.902348301492745e-01   +3.726264923002626e-01   +1.685956173683907e-01   -1.500933007975896e-01   +3.466100649601594e-01   -1.126972462600417e-02   +3.979012721492853e-01   +3.936571344400869e-01; +1.442804885950721e-01   +6.513492485211823e-01   +6.149626827229392e-01   +2.483444269404983e-01   +2.982076200564583e-01   +4.616220840538459e-01   +7.730273654386475e-01   +3.445293151010688e-01; +5.193305228010571e-01   +8.077496130199862e-01   +8.491619851909408e-01   -5.554314408435972e-02   -8.916604358957997e-03   -1.658886309346620e-01   +5.011895519994543e-01   +5.152349732464950e-02; +8.586467024627558e-01   +3.507528541596099e-01   +2.602354038828491e-01   +8.712072378147916e-01   +2.007395880583789e-01   +3.880897294004975e-01   +3.804384944022871e-01   +4.480171750137474e-01];
L2I_L3I_iGABA_netcon = [+1.586366197779431e-01   +8.923667102590235e-02   +5.880322157013922e-01   +2.099740478718286e-01   +2.059956806996539e-01   +5.068956955211557e-01   +1.588608639511854e-01   +1.943856566554751e-01; +8.400099688294096e-03   -5.689911588233778e-02   +7.741794292925128e-01   +5.552727785672146e-03   +7.681311293823626e-02   +5.853867558630169e-01   +6.386877479435970e-01   +4.312940529888060e-01; +1.246207776273751e-02   +2.734668540459161e-01   -3.973184702537976e-01   +4.333152142586463e-01   +3.956477749555102e-01   +8.593892030247736e-01   +4.674155826735472e-01   +2.829752303384825e-01; +9.746118166476078e-02   +2.009364207839708e-01   -3.238263818012171e-01   +3.713249701314324e-01   +4.473620292259856e-01   -8.632317420934900e-02   -1.439703310455693e-01   +4.469690161216858e-01; +6.591627541999726e-01   +2.296953779174845e-01   +3.752628354143204e-01   +6.486369058303492e-01   +1.425196958931663e-01   +6.613636664178724e-01   +7.610023467932758e-02   +9.755629940773058e-03; -3.572607833582429e-01   -3.775365490778520e-01   +5.280817809519511e-01   +5.253443385272232e-01   +6.915720967852799e-01   +5.762154220190560e-02   +3.949213488177842e-01   +9.429126136315558e-02; +3.446139249934845e-01   +3.863826127222423e-01   +2.713374345992054e-01   +5.706025123595589e-01   +4.209131327859608e-01   +4.484720651505174e-01   +4.344779768534614e-01   +8.360256499227546e-01; +7.034574291157030e-01   +5.434276914662706e-01   +3.721066947969862e-01   -1.121623994291027e-02   -3.192718444081017e-01   -4.839606317820869e-02   +4.324404064789233e-01   -9.905367392879250e-02; +6.782310833848990e-01   +9.106591723661253e-02   -1.916620489473350e-02   +1.811301389962548e-01   +3.144140930654932e-01   +2.015437357731547e-01   +2.847630638263832e-01   +9.718493328099981e-02; +1.962214033763000e-01   -7.095454430076661e-01   +4.619314780740917e-01   +1.532028552272255e-01   +6.197599972527345e-01   +4.555574108381741e-01   +5.526828068136483e-01   +3.311474377300991e-02; +3.286636282643401e-01   +4.262907558363901e-01   +4.005450579964139e-01   -3.130372626987701e-01   +2.209095858463570e-01   +2.954180161977259e-01   +2.741427681513091e-01   +4.421116872054558e-02; +7.379467282111594e-01   +4.467892509807977e-02   +2.758654568577870e-01   -5.924319425491134e-02   +4.929543242612465e-01   +5.307486010271386e-01   +2.060737541197288e-01   -1.600436456728810e-03];
L3I_L3E_iAMPA_netcon = [+7.312284168065501e-02   +1.617020732815626e-01   +1.232474949148652e-01   +6.733861174420109e-01   +4.333369476276004e-01   +2.625894493774721e-01   +2.403645874427614e-01   -1.254367662693757e-01   -1.565296806336292e-01   +4.893511020126820e-02   -1.757909798563326e-02   -2.443326648117159e-01; +4.350302127562725e-02   +4.544487468037490e-01   +1.662197317536853e-01   +3.561560122876027e-01   +2.431962415672330e-01   +1.491612149809713e-02   +4.276848557890393e-01   -1.039549091880445e-01   +3.657477563226273e-01   +4.767268749527104e-01   +2.070334186742015e-01   +6.191208713921337e-01; -2.324118787379172e-01   +7.758725450350703e-01   +5.845969004037254e-01   +5.434049892211393e-02   +3.179286556807480e-01   +5.966354090046160e-01   +2.231739470813457e-01   +1.505873782508700e-01   +3.691336022605400e-01   -4.958008988813279e-01   +3.811539085626725e-01   +1.214845169897732e-01; +7.531061799288805e-02   +1.675953657131173e-01   +4.890698851707644e-01   +1.135790255811460e-01   +2.236005989030118e-01   -1.201690980633684e-02   +1.047109152862736e-01   -6.250701886114617e-04   +4.405489133232517e-01   +4.130898584721528e-01   +3.317065740470541e-01   +1.195050052086298e-01; +1.449178033575276e-01   +8.639847519178937e-01   +3.007288650933285e-01   +2.619574443387285e-01   +4.375955299680664e-01   +2.465200530444815e-01   +1.259395716443665e-01   +3.324639824498180e-01   +4.161628633391745e-01   +8.967708891456960e-02   +3.319109734114104e-01   +1.007212663607087e-01; -2.643551978617342e-02   +6.746889061189276e-02   +7.219543465948957e-01   -2.427757484188928e-03   +3.551010451376432e-01   -6.261153401082961e-02   -5.377256565717588e-02   +5.974778863606559e-02   +5.134379742863163e-01   -1.568557888256327e-01   +6.776818043316946e-02   +7.734595684608592e-01; +2.285484968053749e-01   +6.600686370704626e-01   -8.901207458272614e-02   +1.342938438051152e-01   +3.763869277810013e-01   +3.044986439807124e-01   +1.216749358271764e-01   +3.837306808578313e-01   +5.161604324367834e-01   +4.874303061023367e-01   +2.335226506489502e-01   +6.824233956907882e-01; -5.776489397577300e-02   +3.586512517612540e-01   +6.029192976775328e-01   +4.851715398069631e-01   +9.037329063717687e-01   -1.137248738285199e-02   +9.427211720344143e-01   +2.859301717042861e-01   +9.420603948371693e-01   +5.357368672932781e-01   +4.343276110453281e-01   +4.348143071751692e-01; +5.177931621589805e-01   -2.581689716301065e-01   -1.272280426647697e-01   +5.338296140574239e-01   +5.616572600360533e-01   -2.607520963042115e-01   +2.266910911572835e-01   +3.433912964926596e-01   +2.387444870768107e-01   +5.579984532042250e-01   +1.060829854603515e-01   +2.601647838610204e-01; +2.802090852143202e-01   +3.046298678094090e-01   +5.907230643555903e-01   +5.381332483198247e-01   +1.016972162620368e-01   +1.150928418934106e-01   +3.821406411414366e-01   +6.273516431940209e-01   +3.855133703406882e-01   +8.626217519590156e-02   +1.711334580607055e-01   +7.395277031435509e-01; +1.104634962262760e-01   +7.044082736524362e-01   +2.299583353871272e-01   +3.172903952754705e-01   +6.792293580803370e-01   +3.165599493652294e-01   +3.829707555143915e-01   +5.455659169822220e-01   +1.326899121677543e-01   +4.095117191809623e-01   -2.944207341702039e-01   +5.946941596656911e-01; +7.488121688444221e-02   +1.058153782175930e-01   +4.019259556526940e-01   +7.029317461373181e-01   +6.643910158802365e-01   +2.146516415886593e-01   -1.171358444687584e-01   +4.607272137887624e-01   +5.944671750266561e-01   +1.381542868143144e-01   +3.230204422547679e-01   +5.637517034108245e-01];
L3E_L3I_iGABA_netcon = [+4.061435830094665e-02   +2.025832861768992e-01   +5.194486887779457e-01   +6.178510353242435e-01   +6.307054537740481e-01   +2.094101115141696e-01   +2.000748120453850e-01   +4.812572843908820e-01   +6.549033480138289e-01   +4.497234192887900e-02   -6.013247106957027e-02   +4.363209335434107e-01; +9.570955045410263e-01   +6.853035392618316e-01   +3.737178483193720e-01   +6.821523472898889e-01   +2.440777269889353e-01   -9.876735315250845e-02   +2.471164745897462e-01   +2.897784182549839e-01   +3.003616983797943e-01   +5.973996764736766e-01   +1.379795936926992e-01   +3.984296881386687e-01; -2.374966796106362e-02   +1.000000000000000e+00   +1.885269739221674e-01   +6.038749649635605e-01   +2.416728669164877e-01   +1.044166517457970e-01   -3.171932792757739e-02   +1.168410807427719e-01   +2.122142354912617e-01   +1.754312940754909e-01   +1.777663702033666e-01   -2.084222085293499e-01; +7.664509030500144e-02   +5.269618948369681e-02   +2.554110795755631e-01   +7.985429018268204e-02   +2.975319268036450e-01   +8.471462955839554e-02   +6.150572546912136e-01   +6.936805486451640e-02   +4.842589140812536e-01   +4.601157345848320e-01   +3.403032058223177e-01   -3.361646774429435e-01; +7.169146590117331e-01   +1.712742016871772e-01   +6.391347301646974e-01   +3.510043153843180e-01   +6.668808078874189e-01   +5.411483409298905e-01   +7.338103780035773e-01   +6.641292314342940e-01   +3.396603139677085e-01   +5.074564072872513e-01   +5.248239951867153e-01   +4.036829995408504e-01; +3.987878821576573e-01   +4.169117705427581e-01   +1.740124944054136e-01   +7.609795758358879e-01   -4.322709830887612e-02   +5.156399248403024e-01   +1.702349980466155e-01   +5.203835633022499e-01   +3.249518655382879e-01   +5.175042787213927e-01   +1.488242726943277e-01   +1.377409082368031e-01; +5.724405360728121e-01   +8.072111556940307e-01   +4.377098043526929e-02   +7.060012571295773e-01   +1.866047297246967e-02   +3.911134156483916e-01   +4.721225538492496e-01   +2.994475398544509e-01   +1.374611433448112e-01   +2.602068976534288e-01   +5.192063675630730e-01   +3.411595013584418e-01; +3.265058882860872e-01   +4.490781391441277e-04   +5.083743601170245e-01   +2.115928590064351e-01   +5.313156514105414e-01   -6.619579502118111e-03   +1.388820714214075e-01   +3.229416865203058e-01   +3.035355798270671e-01   +5.144566972509800e-01   -2.071837680317820e-01   +1.809710599312328e-01; +5.738800093964022e-01   +1.760427973317147e-01   +3.031185944802411e-01   +4.789801135322742e-01   +4.575898584403747e-01   +1.803255032617986e-01   -2.182122916180237e-01   +7.628519775067061e-01   -3.381303421076589e-01   +1.240974296413325e-01   +9.345350636844194e-01   -2.131476332659857e-01; +2.162068571824582e-01   +4.582551521635435e-01   +1.382408182939007e-01   +4.125421169275105e-01   -5.361865873833108e-02   +8.018158491969112e-01   -3.976699730972692e-01   +4.326940392860762e-01   +2.962108289961330e-01   +2.415406404181835e-01   -3.155523660790359e-01   -1.766608609829544e-01; +2.952045510360252e-01   +7.493658990767273e-02   +6.650087601389920e-01   +2.901222977461968e-02   +3.306791542602130e-01   +4.522731905443250e-01   +4.797328646987241e-01   +4.682537590802648e-01   +1.177398976739777e-01   +5.058948519119912e-02   +3.533469870209970e-01   +1.490898265445938e-01; -1.651620388452244e-01   +6.391812697362675e-02   +1.613875762674758e-01   +2.334851849517711e-01   +2.599212076996272e-01   +3.520579655245316e-01   +6.953742130331740e-01   +5.576283187189779e-01   -9.596718669496311e-02   +1.665858900351390e-01   -6.600912761608697e-03   +1.884952714166826e-01];
L2E_Input1_iAMPA_netcon = [+9.580591365512467e-01   +6.150023419771795e-01   +5.777420068157986e-01   +8.868399756181419e-01   +7.383665748424493e-01   +8.604528741742155e-01   +9.164190720737935e-01   +7.030574173550067e-01];
L2I_Input2_iAMPA_netcon = [+7.772061560547453e-01   +8.442161494638898e-01   +3.906622302589392e-01   +7.235481299354261e-01   +7.818705050611021e-01   +6.168113821894519e-01   +1.000000000000000e+00   +8.047153174136615e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
