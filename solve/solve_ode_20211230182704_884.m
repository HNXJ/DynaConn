function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.392008294720867e-01   +3.607168804731058e-01   +3.178726521249295e-01   +3.237015367529109e-01   +2.574367343247795e-01   +4.532340610078125e-01   +1.466547823399556e-01   +2.797897101157587e-01   +5.696757010423105e-02   +1.901834910867020e-01   +2.000998267304888e-01   +4.926667382867617e-01   +4.255207222298557e-01   +3.453275909970329e-01   +2.953081794303524e-01   +1.437840226898979e-01; +6.886082242547469e-02   +1.707907511127357e-01   +6.104768966416578e-02   +2.305597090554060e-01   +4.583497089621585e-01   +2.446390413721654e-01   +8.365875149313466e-02   +1.513236123074394e-01   +1.449975869225070e-02   +1.257299368285885e-01   +2.753666792051601e-01   +2.725341350572169e-01   +7.563519406171304e-02   +3.670461967761639e-01   +1.548178420940448e-02   +5.938962424290241e-02; +3.398198722116820e-01   +1.360901073362409e-01   +2.546022328584817e-01   +1.093991227118748e-01   +3.290295365535501e-01   +4.847492238368532e-01   +3.951037499296141e-01   +7.887538022331858e-02   +1.339755855283173e-01   +7.741491970222358e-02   +5.010891441469418e-01   +3.173347116133768e-01   +2.148920006059298e-01   +1.716855749597453e-01   +2.535982446186287e-01   +3.249586781624852e-01; +3.589648117360897e-01   +1.104698633556926e-01   +1.235303806600930e-01   +1.039278898142806e-01   +1.996266311498031e-01   +3.851984567696571e-01   +5.746164291855717e-02   +4.576132446451115e-01   +3.958097223574857e-02   +2.587985383966898e-01   +5.567944948737969e-02   +4.997183728404399e-01   +1.772157409632638e-01   +5.097524802673061e-01   +2.939277769568753e-01   +2.657487958198169e-01; +2.161983665347594e-01   +1.847441875233095e-01   +4.869051370353997e-01   +2.314067186896928e-01   +4.877488561558982e-01   +4.191411676893654e-01   +4.363246475929556e-01   +3.647723351688066e-02   +2.392126254119567e-01   +9.038141161666431e-02   +3.769219295772373e-01   +2.584694766276901e-01   +3.037786783792699e-01   +8.614793452375688e-02   +1.626072906069619e-01   +2.404061707004744e-01; +2.070329992290249e-01   +1.028007178877777e-01   +2.974749537193881e-01   +9.671529951327822e-02   +3.641770254249231e-01   +1.760381204843134e-01   +8.309078743603737e-02   +1.598009809823999e-01   +9.441507605023886e-02   +3.332696747374678e-01   +1.462680740654346e-01   +1.259725632924671e-01   +3.757838285392870e-01   +2.619155273438140e-01   +9.648040904124951e-02   +4.785276390788895e-01; +1.907733039632265e-01   +4.067781474356271e-01   +1.661198692758533e-01   +1.711618487077491e-02   +4.967014571779436e-01   +2.004421056093702e-01   +2.157330374787046e-01   +3.845590356795651e-01   +3.342345874568820e-01   +1.747218781367393e-01   +5.039008994013144e-01   +1.318370733857871e-01   +1.233315222805648e-03   +8.991565568139952e-02   +3.563305457232521e-02   +3.798916323504971e-01; +3.447343087919919e-01   +2.244679122352185e-01   +5.027240701603377e-01   +2.321164315237502e-03   +1.937107418450970e-01   +4.696282200147969e-01   +7.304975491821826e-02   +3.462941713691570e-01   +1.056980565081017e-01   +1.828479229396504e-01   +4.276760688151590e-01   +2.734162580866550e-01   +3.003649430787453e-01   +3.153640977742271e-01   +2.753599107808849e-01   +3.945323607879289e-01; +4.373283951970142e-01   +1.815217710007229e-01   +3.973278894017835e-01   +9.292944418896221e-02   +3.004668144388015e-01   +3.437630882433275e-01   +4.026718118733872e-01   +1.618491715343848e-01   +3.873755981987519e-01   +1.718061709890936e-01   +7.268649019929323e-02   +4.504542103585492e-01   +4.795609519011871e-01   +3.877947079438644e-02   +3.003813702433578e-02   +4.243237256078470e-01; +4.337654013537158e-01   +3.199658834555472e-01   +1.487271315496902e-02   +2.604929553298031e-01   +1.870077486145152e-01   +2.424980725817799e-01   +2.371636768306501e-02   +4.783653355675047e-02   +1.561448642592288e-01   +3.881199939356302e-01   +1.477884735611619e-01   +4.308601888040302e-01   +2.957048981589073e-01   +2.000196024727131e-01   +1.343965844832251e-01   +1.880169183968274e-01; +3.942038070366153e-01   +3.262472504577201e-01   +3.592920419325480e-01   +3.775895594346518e-02   +4.415518145439021e-02   +4.260599422249272e-01   +3.392717823003891e-01   +4.818873762775693e-01   +1.726226672222412e-01   +3.832870736973742e-01   +4.507844566378313e-01   +1.178743503975745e-01   +2.263547529504591e-01   +4.145298718419308e-01   +2.386565307069441e-01   +1.482624092018065e-01; +1.331326677895880e-01   +2.282676384456298e-01   +4.477984925516243e-01   +1.869154729941945e-01   +8.510247697679364e-02   +4.998509637141259e-01   +1.208758914017285e-01   +1.829667781416478e-01   +3.365795239059798e-01   +4.835835974200179e-02   +4.242795031206324e-01   +2.544398579714603e-01   +4.919968824514929e-03   +2.327827068173823e-01   +2.965810741018650e-01   +4.259585896782864e-01; +1.551077164166034e-01   +4.725564359189922e-01   +2.554114812672711e-01   +1.784957923451402e-01   +3.038436135599996e-01   +3.657975504340091e-01   +3.980536435268101e-01   +4.963989021415542e-01   +1.070849652172834e-01   +4.117521448955749e-02   +3.012696353344721e-01   +5.261389025217448e-02   +2.856648100262059e-02   +1.636059941872694e-01   +4.987578119087334e-01   +4.178969065794561e-01; +1.511700607935675e-01   +1.229547799752627e-01   +4.927292141258930e-01   +2.551281295672277e-01   +5.084481131461740e-02   +6.149961732709326e-02   +1.790637238491253e-01   +3.514552805022563e-01   +3.421496814939335e-01   +6.723433051998173e-02   +2.024668229638726e-01   +3.463470294840161e-01   +4.353859351623083e-01   +7.153835541931682e-02   +4.594961370188086e-01   +4.542824446651214e-01; +2.797747111961258e-01   +2.255648990597365e-01   +6.683384173924400e-02   +5.020997359649967e-02   +3.068028865883407e-01   +2.457479763930961e-01   +8.089564073508355e-02   +1.215277030399961e-01   +3.241880866120286e-01   +6.995679220781670e-02   +4.345548216749713e-01   +2.430010618854844e-01   +1.641531319722150e-01   +3.141912017064484e-01   +4.075226835993271e-01   +2.400433962155316e-01; +4.917708104509857e-01   +1.438619224091685e-01   +1.393272548093852e-01   +4.324941132838656e-02   +2.057194626325466e-01   +2.171034986139238e-02   +2.218272500045195e-01   +1.398758327244110e-02   +6.466778029625578e-02   +3.320063311548585e-01   +2.750062913252898e-01   +4.481226606216104e-01   +3.185005736359753e-02   +2.898329274295435e-01   +5.080413164399378e-01   +3.117965098167839e-01];
L1E_L1I_iGABA_netcon = [+4.829320102164782e-01   +3.637441562173701e-01   +3.719600781315476e-02   +2.344878433117855e-01   +4.582156981606010e-01   +2.254492381218743e-01   +2.190034913031541e-01   +6.539717596761359e-02   +1.021198734532696e-02   +3.013734820767285e-01   +8.257765110372292e-02   +2.978154768308868e-01   +2.578176079855091e-01   +3.636253119956172e-01   +1.253908510512526e-01   +4.553184126426378e-01; +4.837489850667342e-02   +3.316236096176525e-01   +2.265496403318100e-01   +3.736915180935891e-01   +4.131863334516792e-01   +1.431869599328982e-01   +3.429069016991564e-01   +1.623020514830430e-01   +4.200825048816236e-01   +1.557443564595540e-01   +2.983902938877732e-01   +4.876458061954693e-01   +2.499371092318824e-01   +4.374839069582909e-01   +1.355024639612498e-01   +3.800203946412078e-01; -2.756126000777358e-04   +2.463217666885915e-01   +2.210346258073328e-01   +1.185785699716432e-01   +3.327896030696279e-01   +2.294199425626093e-01   +6.254420320055853e-02   +1.916026658520115e-01   +2.231443959708261e-01   +2.705204566064385e-01   +1.471495591602310e-01   +2.982240917183571e-01   +2.186737008524517e-01   +3.098373253826939e-01   +4.832081241042423e-01   +1.181363574889291e-01; +9.187904560684290e-02   +2.205220686137878e-01   +1.282386080861015e-01   +1.422593647125897e-02   +4.416382172296162e-01   +2.807808805138275e-01   +2.698331424962852e-01   +1.997206790918456e-01   +3.340224343847202e-01   +8.352270970486913e-03   +2.663187314137826e-03   +3.081006337568311e-01   +3.417348671788361e-01   +4.116959032424325e-01   +4.726455696085586e-01   +3.306575911585227e-01; +2.067841768955391e-01   +1.452239465097539e-01   +3.667531877350670e-01   +1.268868726468118e-01   +3.506414999540890e-01   +4.637505056966776e-01   +3.086103428558236e-01   +9.173367251132657e-02   +2.427549654923017e-01   +3.923773860542777e-01   +2.805253066330550e-01   +4.125678183721755e-01   +7.365167589745164e-02   +1.967226542501841e-01   +2.563938019206106e-01   +4.022697598638317e-01; +5.271458714209905e-02   +5.817566252926212e-02   +4.481481683226077e-01   +4.888671276173776e-01   +3.413105748681934e-01   +8.650816795207662e-02   +3.519339324275282e-01   +3.147096829120031e-01   +1.084513614674927e-01   +2.317703559875242e-01   +6.026904184654572e-02   +6.893233135947999e-02   +7.291562894932664e-03   +5.048518007922044e-01   +3.091295886441708e-01   +1.520616508267434e-01; +3.700003386392729e-01   +3.118387416988904e-01   +5.933540637241853e-02   +2.522863391075622e-01   +4.641172544523378e-01   +1.574605086465644e-01   +1.111964203512511e-01   +2.395711960220186e-01   +5.638183612426168e-02   +2.287378076070963e-01   +3.773049791909417e-01   +4.747678714445368e-01   +4.219404283725697e-01   +1.553782319615655e-01   +8.249028568542692e-03   +4.805887755607325e-01; +4.053759080645752e-01   +4.936485481345727e-01   +3.536615754628039e-01   +3.525836245863044e-01   +5.595564749720017e-02   +2.023334347281529e-01   +3.454058978235001e-01   +1.585610517395855e-01   +3.921920538236798e-01   +1.141017511314890e-01   +3.092112662491064e-01   +1.683366956903350e-01   +7.847196324913149e-02   +2.739480467545930e-01   +1.741175799800134e-01   +3.418909194215808e-01; +1.388360394288847e-01   +7.394471073615222e-02   +2.313703331267864e-01   +4.108271552164640e-01   +2.140861419808220e-01   +4.891540271810058e-01   +1.620673401379761e-01   +4.740208577105836e-01   +1.556052440723004e-01   +1.664436044031872e-01   +1.585676338228114e-01   +3.514230410815073e-01   +3.270888264144709e-01   +2.416320009612208e-01   +3.000155876375510e-01   +2.935206791399045e-01; +5.017621161163689e-01   +2.600006154657464e-01   +4.949901722799518e-01   +5.019484290081664e-01   +4.814690860632072e-01   +7.943513031444893e-02   +3.687223678568493e-01   +4.943067444512933e-01   +3.632464085929782e-01   +2.148781316200888e-01   +3.268765979726215e-02   +1.391637637057120e-01   +1.593543788525014e-01   +1.028197935715848e-01   +4.691968083969457e-01   +2.849672503041962e-01; +3.582134079774603e-01   +3.395111640373559e-01   +1.283192018937592e-01   +2.953534433110004e-01   +1.536068305076806e-01   +1.405617204245970e-03   +3.703740401236341e-01   +2.739617914909687e-01   +4.896310604915647e-01   +3.560956312524921e-01   +1.784572814880970e-01   +4.125995385293327e-01   +1.719380420131073e-01   +9.016599697736195e-02   +3.317466247657261e-01   +1.275106581111651e-01; +4.172947103529531e-01   +3.973419031580692e-01   +1.072349529082968e-01   +4.459196549888858e-02   +2.340599049340696e-01   +4.755041409938965e-02   +6.870629871959302e-02   +3.828885976434446e-01   +3.654855448684842e-01   +4.152371332675023e-02   +8.102319366734673e-02   +3.194816407276776e-01   +2.996438173220580e-01   +4.231557389984602e-01   +2.554403176654998e-02   +1.511920233522716e-01; +2.149461941261265e-01   +4.858884597881438e-02   +2.906276492971472e-01   +4.954404844556651e-01   +2.791176836154071e-02   +5.494907532660561e-02   +5.114851796744071e-01   +4.553844312550697e-01   +1.397536689340606e-01   +4.417286128888427e-01   +3.238826962259684e-01   +4.108731157043506e-01   +1.009751510708332e-01   +3.946262806202472e-01   +5.095025407984813e-01   +3.485243811440752e-01; +2.809033051730024e-01   +2.953795608809195e-01   +4.092416167329735e-02   +1.832144721114692e-02   +6.506193315754262e-02   +5.777396632977277e-02   +8.803080024593993e-02   +5.964845697828266e-03   +8.146388815736169e-02   +2.401836401163430e-01   +1.658950977635789e-02   +1.509758400753917e-01   +4.861037380416963e-01   +4.299908559096783e-01   +4.450080441751765e-01   +3.488997630505908e-01; +1.117237811494701e-01   +4.778499828249773e-01   +2.758595142530859e-01   +2.441513588138040e-01   +2.782833425016673e-01   +2.375091817659615e-01   +5.050556166928909e-01   +1.429865808049732e-01   +1.061905493990254e-01   +4.389483438796360e-01   +2.573398831555675e-02   +1.277791638927114e-01   +2.636965467944404e-01   +1.213804420884367e-01   +1.464515580734155e-01   +1.346253455543170e-01; +9.067606276382641e-02   +3.677636999551843e-01   +3.999151869486902e-01   +2.272871370607664e-01   +1.253197531921509e-01   +3.147045599103391e-01   +3.506735219989728e-01   +3.387907715150279e-01   +3.365700305220806e-01   +4.119882787255059e-01   +2.249813231905346e-01   +1.776823104373441e-01   +1.143724355090992e-01   +4.480463384051559e-03   +4.718384402689297e-01   +2.925255374445123e-01];
L2I_L1I_iGABA_netcon = [+3.854177137186578e-02   +3.781012831953088e-01   +1.036175028524858e-02   +4.163367246005055e-01   +2.511959716389686e-02   +3.920566065261556e-02   +1.779488166005758e-01   +1.584838235256718e-01; +3.624650152955288e-01   +2.468346994152605e-01   +2.063639984498083e-01   +2.859209123714318e-01   +4.558886079700025e-01   +2.830661572327958e-01   +1.611383369201498e-01   +2.102233477145820e-01; +2.791711588358378e-01   +4.209949748162290e-01   +2.815523244704520e-01   +9.999850114964040e-02   +2.913087507398333e-01   +1.509515278827145e-01   +5.070909228278422e-01   +1.286735080554797e-01; +4.025598429292109e-01   +3.610808847772423e-01   +3.210985823538094e-01   +2.967169880923139e-01   +1.018820650937384e-02   +2.363787330454232e-02   +4.009910037515970e-01   +6.904530699965886e-02; +9.076966010436938e-02   +1.985771601764642e-01   +1.158519261257744e-01   +3.696615837999752e-01   +4.679786728789988e-01   +3.580949981749287e-01   +2.340080404801835e-01   +3.972186773195358e-01; +2.468426813548533e-01   +1.169072367735233e-01   +3.167282593365221e-01   +2.573078584571566e-01   +2.050938219872671e-01   +2.472258398564851e-01   +3.385795151380094e-01   +3.528673716153229e-01; +1.149364647370601e-01   +7.571786999685318e-02   +4.617883316979478e-01   +2.164625336934931e-01   +4.000241054551887e-01   +1.470130706850800e-01   +3.229954191282327e-01   +5.482174954412152e-02; +4.396010210244445e-01   +2.115638688611120e-01   +3.735305588967606e-01   +2.120760072297721e-01   +1.568722474900282e-01   +4.635985459595078e-01   +1.745326898572874e-01   +5.160761254341245e-02; +3.497882409533528e-01   +7.031908924545793e-02   +2.908706724696741e-01   +1.736180770405856e-02   +4.253578237946060e-01   +2.826115204365405e-01   +2.302880841559809e-01   +3.232804436246561e-01; +1.961986537206374e-01   +3.081166058316605e-01   +5.068458157881857e-01   +1.903258924504259e-01   +4.131028801687838e-01   +3.409098816768872e-01   +3.777695160046953e-01   +3.215855893875619e-01; +4.709860842157412e-01   +1.077297717708189e-01   +3.727034359837814e-02   +3.793716797271278e-01   +2.400745446411192e-01   +2.734031846775176e-01   +4.479878543016319e-01   +3.440924865293858e-01; +1.201265090315433e-01   +2.145846065274921e-01   +1.178939152891316e-02   +3.556840345706792e-01   +1.483210752277863e-01   +1.167054109311308e-01   +2.377580922736111e-01   +2.828200951531890e-01; +3.040302007466973e-01   +1.945132702075497e-01   +4.566379074077243e-01   +1.056982427520685e-01   +1.855698931338792e-01   +1.900712853666468e-01   +4.020052875421765e-01   +8.214580163995369e-02; +3.063414343811037e-01   +8.777789311728149e-02   +3.747119732960986e-01   +3.823605095605751e-02   +3.690345778768318e-01   +2.904349049752475e-01   +3.490347447431521e-01   +3.243605218638359e-01; +1.801968168496392e-01   +4.102397417251702e-01   +1.902356459417419e-01   +9.415802282868473e-02   +1.906884154896916e-01   +4.044781005283251e-01   +1.424149582249897e-01   +1.574167504570479e-01; +4.108328487221155e-01   +2.862876705378608e-01   +3.360212868766029e-01   +4.312435211053162e-01   +5.904423534220035e-02   +2.527112068847325e-01   +3.362078381801072e-01   +2.133717205517854e-01];
L1I_L2I_iGABA_netcon = [+3.797928625811566e-01   +2.120519937154064e-01   +1.855784816933031e-01   +4.401191834031353e-01   +4.468981202388943e-01   +2.572541148589242e-01   +1.498796501261466e-01   +1.792110826547478e-01   +5.011317491847465e-02   +2.019304031183398e-01   +4.083160301973574e-01   +3.636143018837491e-01   +5.006161515828896e-01   +3.944491896146293e-01   +3.491061136479720e-01   +6.897689868719474e-03; +2.494742233718211e-02   +1.272694088642750e-01   +2.264144322436343e-02   +1.616686414610720e-01   +1.747266785937810e-01   +6.922938845928725e-02   +2.926724659231671e-01   +1.448000723180392e-01   +1.365932650026289e-01   +2.000542269498046e-01   +2.238024992247983e-01   +1.363803577236101e-01   +1.500859062671019e-01   +5.158096463844813e-02   +1.204771197319243e-01   +3.376901921700916e-01; +1.164372143868623e-01   +3.332536443391779e-01   +2.428411214512330e-01   +3.570015545476609e-01   +2.619962355422825e-01   +3.517024043055636e-01   +8.333719285588333e-02   +5.807831200266585e-02   +4.936045109659273e-01   +3.170720908621123e-01   +1.807580682945210e-01   +1.774631471532998e-01   +3.584215697370571e-02   +1.998662478012513e-01   +6.482319298345658e-02   +4.544405039046567e-01; +5.678331846672466e-02   +3.385863935354287e-01   +5.176318681430719e-02   +8.841850347515168e-03   +1.810399299607199e-01   +4.137373993601715e-01   +2.483096162105315e-01   +3.522282246158619e-01   +9.579387735761469e-02   +5.285502916330898e-02   +4.508054824628714e-01   +1.781573135975112e-01   +4.453639268191754e-01   +1.416243542424662e-01   +4.972097672602455e-01   +1.565827169510438e-01; +1.567575185962374e-01   +4.848353902339087e-01   +4.872190236999478e-01   +3.587087518285153e-01   +3.799060293606567e-01   +2.602998180096241e-01   +3.985855533231385e-01   +4.749899317325280e-01   +4.771197175945440e-01   +7.272506391502397e-03   +4.339341249117990e-01   +2.936997635626395e-01   +2.973009183653177e-01   +8.030600175116129e-02   +1.169439295708416e-01   +5.430693312174883e-02; +4.644387900264812e-01   +4.893004817239465e-01   +4.900448053092975e-02   +1.432784089358629e-01   +3.182390065024008e-01   +2.168492718909137e-01   +4.956434502298375e-01   +2.756472025893819e-01   +2.979923548576622e-02   +1.373392196894536e-01   +2.347077622722833e-01   +1.666771042616079e-01   +4.424493010481183e-01   +4.467335613196127e-01   +2.534912392387330e-01   +1.567356586181853e-02; +3.254824168478277e-02   +4.828928660530403e-01   +2.011704026795250e-01   +1.370099685597624e-01   +2.939565961417340e-02   +2.397109367620292e-02   +4.733005385426138e-01   +4.146261931630122e-01   +3.226372715331456e-02   +3.898785260705906e-01   +8.959375224519853e-02   +2.539249432304166e-01   +4.503877743362070e-01   +1.930275843841578e-01   +5.074541298905743e-01   +3.403153681918505e-01; +4.116893304305323e-02   +1.353265602332300e-02   +2.542999884650067e-01   +4.736096979717364e-01   +5.277087519497296e-02   +2.998753361773833e-01   +3.175588047316156e-01   +1.473424940405143e-01   +8.198571827189315e-02   +2.477336911528039e-01   +4.209132535240913e-01   +2.258032880957019e-01   +3.113915794629629e-02   +3.305729116733891e-01   +2.637802127325681e-01   +1.841772249313062e-01];
L2E_L1E_iAMPA_netcon = [+4.225289544264625e-01   +2.902429445739090e-01   +2.930391093116714e-01   +3.745923241928078e-01   +2.291678644821383e-01   +2.372813355645295e-01   +2.690760412596187e-01   +2.740790997801925e-01; +3.445931392139162e-01   +2.963052995059337e-01   +3.878069112359697e-01   +1.912924079561882e-01   +3.587518567697238e-01   +3.854019435148368e-01   +1.502028436212171e-01   +4.908394139518805e-01; +2.878003919867553e-01   +1.166123604694718e-01   +3.218746920780516e-02   +5.057009649650506e-01   +1.889240683036321e-01   +1.039176066039438e-01   +2.098801718722481e-01   +3.309008979460110e-01; +2.540443772690497e-01   +1.030761032553397e-02   +2.913677805559197e-01   +9.543064047997220e-02   +2.112190995553838e-02   +2.422808662045506e-01   +3.151133408434590e-01   +2.657187072108809e-01; +5.110444952282803e-01   +3.609357434346332e-01   +3.975202214164626e-01   +2.636193889158924e-01   +2.296335150683994e-01   +4.810258428364563e-01   +2.903687979445890e-01   +1.283682632085753e-02; +2.966502869829624e-01   +1.472919801626325e-01   +4.080042599122591e-01   +4.226123267456499e-01   +2.169744988273918e-01   +1.426136960292362e-01   +1.911016498049480e-01   +1.825230746027985e-01; +2.363582184399614e-01   +2.999558009633380e-01   +2.139934480151016e-01   +4.213719232198586e-01   +1.565026140313503e-01   +4.464977234276250e-01   +1.648914620439020e-01   +3.634776930699571e-01; +3.911971417519949e-01   +3.738196149459290e-01   +4.735251008780045e-02   +1.340459138034001e-01   +3.769794333042639e-01   +2.225197755120968e-01   +2.907176302070946e-01   +3.703169085709423e-01; +2.918697282236529e-01   +1.183428260665068e-01   +3.730940558253818e-01   +9.615137231820661e-02   +3.814647188438851e-01   +3.280973583919169e-01   +2.507709026278619e-01   +9.984613478672363e-02; +5.346043668147188e-02   +2.564800755847431e-01   +1.295151167445509e-01   +4.129968177533414e-01   +6.397034343738416e-02   +2.931046925779663e-01   +4.218907151307009e-01   +2.138397053441356e-01; +1.708261644646235e-01   +1.158188071915314e-01   +7.540910143313333e-02   +5.686389959669468e-03   +2.106858078959628e-01   +3.194710170489285e-01   +1.201481846414020e-01   +3.643772342826961e-01; +5.854572268309819e-02   +1.949062262068295e-02   +4.172636583133553e-01   +4.627195603772575e-01   +1.820916393560258e-01   +3.966819470221252e-01   +1.879450094825830e-01   +3.688145879815835e-01; +1.484965253252876e-01   +2.376523555431573e-01   +4.262964001005771e-01   +2.474412223302311e-01   +4.730417303904882e-01   +1.542135906537878e-01   +3.467335596933244e-01   +2.687995778076878e-01; +4.716663175032073e-01   +2.121699220029927e-01   +1.886270388536310e-01   +4.778439337707242e-01   +4.661804975200671e-01   +6.162794078904028e-02   +2.353608190270782e-01   +6.857869737876490e-02; +2.421471410871605e-01   +2.461823721828188e-01   +4.385222585306622e-01   +2.629291485291220e-01   +6.400741291019238e-02   +1.016753032826720e-01   +1.893884461487269e-03   +1.028150820001975e-01; +4.306976147014294e-01   +4.106992023952478e-02   +1.274715163364787e-01   +3.982337759937097e-01   +2.004721437670776e-01   +1.802831686047781e-01   +4.154873210077980e-01   +1.419271842817445e-01];
L1E_L2E_iAMPA_netcon = [+2.937001737742539e-01   +1.652874674779235e-01   +1.281670145102342e-01   +3.786781855001806e-01   +1.312807574999559e-01   +4.947620761430319e-01   +4.277140372458652e-02   +3.086306291899285e-01   +2.137516325620104e-01   +4.594112499630548e-01   +2.235710332243935e-01   +4.950845199491880e-01   +3.938398927835202e-01   +1.522583885056120e-01   +2.683477879327837e-01   +3.579350493637637e-01; +7.200604414308326e-02   +1.323945514659489e-01   +4.641545294030507e-01   +4.893537456150183e-01   +3.841660273188363e-02   +2.146476341548237e-01   +3.825652899647196e-01   +2.375856826373134e-01   +4.695741092669968e-01   +1.108304533241180e-01   +4.113749206526642e-02   +2.009544170381693e-02   +4.762111074858065e-01   +5.067674466045913e-02   +3.379724888450329e-01   +3.645370683664268e-01; +4.308266174787077e-01   +1.999768411323277e-01   +3.639390608963481e-01   +2.560329972623249e-02   +4.980262998740348e-01   +4.728225406888784e-01   +1.561094716744115e-01   +4.438578923377073e-02   +4.810860269722518e-01   +1.116381355697216e-01   +3.420174890895464e-01   +2.975185915939328e-01   +3.163833026740743e-01   +2.620901352115868e-03   +4.252308629462179e-01   +1.754536799627399e-01; +1.697233329973251e-01   +3.632430186635021e-01   +3.480927064927975e-01   +2.828318812165969e-02   +2.501091450876700e-01   +2.726062607185217e-01   +1.715084774447660e-01   +3.805111539487053e-01   +4.029998986687411e-01   +1.962976847647724e-01   +4.598533755648815e-01   +1.436265030481474e-01   +5.028342211199560e-01   +1.642230781044381e-01   +2.824246329881460e-01   +4.727264062251639e-01; +3.744424745463937e-01   +5.088180202876620e-01   +8.023696305800512e-02   +9.225711743475284e-02   +1.411267944737984e-01   +3.962818818136160e-01   +1.122910121296636e-01   +7.217197904867766e-02   +3.543918910161392e-01   +2.799080242564580e-01   +2.446194844196298e-01   +1.842719475471380e-03   +3.351328775230502e-01   +4.336306254960397e-01   +1.509197785628444e-01   +3.922172940139963e-01; +6.015129693577580e-03   +1.924127845427499e-01   +5.411573443874459e-02   +4.228746556966132e-01   +3.758957872281836e-02   +2.286745407169848e-01   +4.450833965906400e-01   +2.988191570401738e-02   +9.392946026855392e-02   +4.137470464125050e-01   +3.920107104843341e-02   +8.075073901979407e-02   +4.233884532742893e-01   +2.458409070815639e-02   +4.621711826236971e-01   +1.028746815191111e-02; +1.746942333685740e-01   +1.192349349649145e-02   +4.600690469450914e-01   +2.501462875282892e-01   +1.336079336023481e-01   +4.043331879614879e-01   +3.621130261904928e-01   +1.648462250942999e-01   +4.473375145500398e-01   +1.561174086189892e-01   +1.656331163744225e-01   +2.388247361072378e-01   +7.373560731040316e-02   +3.948488619661273e-01   +1.668886724467562e-01   +3.875351174519662e-02; +3.735474106569258e-02   +3.937875594856626e-01   +2.462112288951910e-01   +4.911158090900372e-01   +6.307976976910736e-02   +4.236114892861060e-01   +3.096803730996405e-01   +2.161603913862898e-01   +3.599796274657477e-01   +4.873726317937880e-01   +2.523072668295142e-01   +5.744224335108875e-02   +2.160731614529657e-01   +9.465816087425241e-02   +1.819369125244497e-01   +1.317283089443184e-01];
L2I_L2E_iAMPA_netcon = [+1.856389812477516e-01   +2.053441274269160e-01   +1.786916775971768e-01   +2.554929182225080e-01   +8.214118921993275e-03   +4.142379305405604e-02   +3.549395168781652e-01   +2.543703087466424e-01; +2.516458866667429e-01   +3.651413279590880e-01   +4.965320124502403e-01   +3.869472260667683e-01   +4.022591967521442e-01   +3.254188612277953e-01   +3.901428348990375e-01   +2.259074658127214e-01; +3.908486759617350e-01   +4.940590073047675e-01   +2.788072489253898e-01   +1.198929102166963e-01   +1.314973923919136e-01   +2.408693466478398e-01   +3.308506874580830e-01   +3.786017282343785e-01; +5.048147401050465e-01   +2.491008202060121e-01   +1.475082158810079e-01   +5.864943840259641e-02   +4.510163192763612e-01   +2.570957313302504e-01   +2.890343245820210e-01   +1.891497128863918e-01; +2.270748213212121e-01   +4.575066846359761e-01   +1.524741806409872e-01   +3.757667100161978e-01   +5.092860560789949e-01   +4.689670015486989e-01   +3.546693485590143e-01   +3.200631494871405e-01; +3.784818878734389e-01   +1.040035820398190e-01   +1.370804645788178e-02   +1.702926334933228e-01   +1.704070582659141e-01   +2.549347382687830e-01   +8.311291472305383e-04   +3.161635717376033e-01; +3.455539017930634e-01   +1.886123678747361e-01   +2.763565649347261e-01   +4.839000432575296e-01   +4.727289730753840e-01   +4.765358001526390e-01   +1.033988096301711e-01   +4.785223100486794e-01; +3.380967189969726e-01   +3.643910560823207e-01   +9.027201225921237e-02   +4.394898808462743e-01   +2.524059647942622e-01   +2.677233383471146e-01   +1.691032612766598e-01   +1.247625682191710e-01];
L2E_L2I_iGABA_netcon = [+3.088974671154755e-01   +6.744089555790285e-02   +2.144831045584594e-01   +2.333945956167477e-01   +4.188940210076019e-01   +2.716272037505074e-01   +6.640685138775657e-03   +3.575272009752360e-01; +2.230219154372657e-01   +4.560192996972435e-02   +4.077063083079853e-01   +4.217706675379738e-01   +1.232665511914905e-01   +2.492871381345009e-01   +4.878420339061050e-01   +1.921643598506064e-01; +4.802251440020467e-01   +2.683568124411177e-01   +2.658212448298336e-03   +1.397241189709923e-02   +3.606940496456184e-01   +2.947484945937630e-01   +3.452089069184208e-01   +1.437317754820833e-01; +1.077829086634990e-01   +5.099645074750417e-01   +3.768838563913893e-01   +4.138066561563553e-01   +3.184722220221167e-01   +3.676659318076066e-01   +2.709655893317389e-01   +3.074108572940509e-01; +4.464694100169768e-01   +4.093104844345616e-01   +7.430157472495590e-02   +3.398544432675341e-01   +3.533846805046541e-01   +1.693648093986117e-01   +1.776211610248918e-01   +2.744665522250249e-01; +1.745953352369295e-01   +4.524863909707953e-01   +2.599890680645573e-01   -2.960606290869775e-04   +1.240010739965974e-01   +6.183332015426728e-02   +2.184109498991603e-01   +2.807974881868623e-01; +4.306555120031741e-01   +4.173682902445456e-01   +4.814363417005345e-01   +3.598182937241284e-01   +2.744713240949420e-01   +3.421770344105307e-03   +1.189748881267866e-01   +2.526226988364220e-01; +4.162602256062535e-01   +2.857903287389449e-01   +4.913431229678749e-01   +1.668192782298928e-01   +8.118752738274006e-02   +3.480761317742299e-01   +2.137269865063431e-01   +2.754787660386808e-01];
L3E_L2E_iAMPA_netcon = [+2.837806876160100e-01   +3.676601212287659e-01   +4.262217520700287e-01   +1.622380616941190e-01   +2.476765068580185e-01   +3.030770262654504e-01   +4.394134562541353e-02   +6.498705683143854e-03   +5.039061834031979e-01   +3.401598532948819e-01   +3.054303834105159e-01   +1.178554718215718e-01; +4.715197562168139e-01   +3.717298737487345e-01   +1.980001530738277e-01   +2.450223433020056e-01   +2.494562539101035e-01   +5.856198578692924e-02   +4.782930535947491e-01   +4.154950775521155e-01   +2.504218353090631e-02   +4.323103870771889e-01   +4.903111290315555e-01   +3.404186874722309e-01; +3.957342145308144e-01   +3.838945592243496e-01   +2.791807499531040e-01   +5.048119999323279e-01   +1.688616508611242e-01   +3.584040569799652e-01   +2.407241160221975e-01   +4.826296365771838e-01   +2.005429106925048e-01   +2.151245858472172e-01   +4.121877792921803e-01   +3.121116226588072e-01; +2.327663151470710e-02   +4.032219372770204e-01   +3.583686577719438e-01   +2.885742929135068e-01   +3.712716094633223e-01   +3.963486767179273e-01   +3.209324914103962e-01   +3.701000048900231e-01   +2.659469202741674e-01   +1.390605578842319e-01   +2.961812923532691e-01   +2.857885965935644e-01; +1.425163661204891e-01   +3.036871800412784e-01   +3.488239570563829e-01   +3.001432886428065e-01   +4.003437505256330e-01   +3.657924129507871e-02   +4.382375813981414e-01   +2.748517629803259e-01   +3.177480866095757e-01   +1.638562471911331e-01   +3.572760327478798e-01   +3.247822101862601e-01; +1.925947571762004e-02   +4.129371744555453e-01   +2.441752581533998e-02   +3.927309749096451e-01   +2.430138023514755e-01   +4.397178171580380e-01   +1.497774378352201e-01   +1.669289592753010e-01   +2.286675496787743e-01   +3.895188269282660e-01   +2.231831412245210e-01   +6.796436346900919e-02; +8.021143956225568e-02   +1.508051177279092e-01   +3.131585172401942e-01   +2.044397793145494e-01   +3.876291090303200e-01   +4.302528424219105e-01   +1.644985228173255e-01   +1.813105743600992e-01   +1.134738192956043e-01   +4.509845772674574e-01   +1.872587218605109e-01   +1.354070583905020e-01; +1.810318136405858e-01   +3.468860616934485e-02   +3.073776960158852e-01   +4.061721390559275e-01   +2.668467873085519e-01   +4.222269219249367e-01   +4.364158111208607e-01   +3.295620902798284e-01   +4.951426038698474e-01   +2.380990874697512e-01   +4.518046028055476e-01   +4.461489478585679e-01];
L3I_L2I_iGABA_netcon = [+3.824240611174187e-01   +4.724870993107236e-01   +2.846335409736162e-01   +1.572097871148111e-01   +1.745681873117559e-01   +1.224474443982006e-01   +4.602574702050792e-01   +2.494890376660772e-01   +1.984265994710918e-01   +1.348897915239614e-01   +2.872121182258031e-01   +4.965592101605313e-01; +3.751626582787357e-01   +3.636589314075080e-01   +5.270564396929894e-02   +1.562213382386809e-01   +3.687512669076816e-01   +1.823485248496343e-01   +1.515691151638325e-01   +1.746593498699690e-01   +3.113577353069430e-01   +4.470685699553561e-01   +2.560247539334711e-01   +1.386854251587133e-01; +1.515642566133278e-01   +2.269133184819792e-01   +9.219314443712370e-02   +4.170707700701854e-01   +1.084098981411225e-01   +2.285232539792259e-01   +5.117089211226966e-01   +4.843436815989170e-01   +5.029381247437162e-01   +2.743006550691688e-01   +1.592276277762286e-02   +2.842631380516704e-04; +9.877697463815799e-02   +5.844469228833155e-02   +4.466941476284388e-01   +1.551024147307535e-01   +3.876874217279687e-01   +3.594171287751599e-01   +4.740514272127076e-01   +3.469276727117583e-01   +4.573531650603567e-01   +5.365415726886548e-02   +4.856369563447430e-01   +2.321719909727384e-01; +2.376432851545496e-01   +4.448973055674340e-02   +4.986251677122656e-01   +2.812861933243165e-01   +5.112666863102358e-01   +4.698370001131197e-02   +1.011309696264649e-01   +3.004355624666777e-01   +7.736084212930291e-02   +3.744188928373434e-01   +5.947595014908304e-02   +4.713549318116849e-01; +1.728166269970422e-01   +8.274040546536621e-02   +1.580336200662967e-01   +4.027964479437914e-01   +3.645702618819684e-01   +2.479826146928690e-01   +1.378331174697184e-01   +2.911510323975489e-01   +1.891554465150477e-01   +4.895563916968236e-01   +4.060306828416604e-01   +4.479398532795030e-01; +3.534682330531262e-01   +1.998271038996939e-01   +7.252544662265148e-02   +3.782114405707067e-01   +2.426591850461962e-01   +3.050626372435284e-01   +7.196077057199904e-02   +9.031026246057886e-02   +3.761516234420809e-01   +4.001567154675273e-01   +4.178271052179044e-02   +2.104524970612890e-02; +1.661556954520493e-01   +3.887175106153422e-02   +4.037751358225379e-01   +2.689685259603845e-01   +3.372909557901023e-01   +8.228789956959025e-02   +2.483415896345739e-01   +2.094901991052174e-01   +2.203255335028764e-01   +1.547783975158154e-02   +1.069228350524117e-01   +1.578373506255303e-01];
L2E_L3E_iAMPA_netcon = [+1.640064147709396e-02   +3.148864443919723e-01   +2.208536389387712e-01   +1.681975520976763e-01   +2.841270380699675e-01   +2.769490346679441e-02   +5.126055645667258e-01   +7.855509038002932e-02; +4.126578301014414e-01   +3.699176316268831e-01   +3.785915681059871e-01   +3.475472106007026e-01   +4.273713957982673e-01   +7.252142416997742e-02   +2.409329615873358e-01   +2.249653467689126e-01; +6.867980579528266e-02   +2.431356065823228e-02   +3.084511647385219e-01   +4.410621601909022e-01   +3.009466875392626e-01   +1.074193806397835e-01   +3.078569185262078e-01   +9.161178357604564e-02; +2.680119623799642e-01   +2.645840800010715e-01   +4.153059170756764e-01   +4.383916583732721e-01   +2.107028908074768e-02   +1.528784135575445e-01   +3.477258438684399e-01   +4.612497336067666e-01; +2.764124137343984e-01   +5.014005725364323e-01   +4.724360014945186e-01   +2.906180735558930e-01   +3.952012242122642e-01   +1.772045160083098e-01   +4.838556800538121e-01   +6.112099477444378e-02; +4.132617970435398e-01   +3.749338401952721e-01   +2.427705363402873e-01   +2.118664480009824e-02   +7.261741017494955e-02   +2.327482895447020e-01   +4.925303617206815e-01   +4.166995296953373e-02; +1.251000750445852e-01   +2.097044325827981e-01   +1.464223516418337e-01   +4.035044903087613e-01   +4.713876798858572e-01   +3.351543013421132e-01   +3.866925721239260e-02   +4.191597143663998e-02; +3.154617833670454e-03   +5.720812903073037e-02   +4.035357329595354e-01   +2.901681151383666e-01   +2.504917977480129e-01   +3.896953085138393e-01   +6.132478597285839e-02   +5.681639324608882e-02; +1.128452555267204e-02   +4.350422595387817e-01   +7.700868212147440e-03   +1.532248664337480e-01   +1.826360030932083e-01   +1.282424562439174e-01   +1.514122447265070e-01   +1.781363350710568e-01; +4.055891857965002e-02   +1.777732514764437e-01   +1.595809184191686e-01   +3.651861443218121e-01   +4.180480509593493e-01   +1.172078275614412e-02   +4.603940997090289e-01   +4.374772807176712e-01; +1.097817528151222e-01   +3.012960287972238e-01   +3.460877965675186e-01   +3.468482004079148e-01   +4.325555887085823e-01   +4.489157840965184e-01   +3.390319091499389e-01   +4.406664534587675e-01; +3.089962890912154e-01   +1.782453999799325e-01   +4.564825521480192e-01   +2.894535793300607e-01   +1.566523409532742e-01   +3.226057934160958e-01   +1.372071957295329e-01   +4.635998567276468e-01];
L2I_L3I_iGABA_netcon = [+2.146514568486796e-01   +2.434313879894797e-01   +3.863517565088322e-01   +3.193022918591166e-01   +4.151045810270493e-01   +3.782008589997823e-01   +2.670981797112317e-02   +7.549778539618546e-02; +8.956612317252659e-02   +1.236150652377031e-01   +1.844263196925600e-01   +3.103866464858324e-01   +1.281172866969617e-01   +3.903698100951962e-03   +1.591182628522702e-01   +2.960246735506677e-01; +2.885532816106252e-01   +1.524327434555965e-01   +1.849113254327162e-01   +3.494288294848640e-01   +1.777455938541687e-01   +4.275325880111379e-01   +4.389693209292827e-01   +1.868334007427902e-02; +1.524192387504193e-01   +1.619782214850883e-02   +2.060003669046147e-01   +4.925455219139153e-01   +8.726473958611835e-05   +3.479887722867815e-01   +1.816379448493531e-01   +3.120695859126648e-01; +3.631709864784600e-01   +2.398504045769118e-01   +3.519922375800347e-01   +1.760573539719343e-01   +1.705028077574353e-01   +2.092809494207570e-01   +2.061619820035401e-01   +4.952332915550145e-01; +7.319260390378117e-02   +2.594580273812334e-01   +2.020504050860707e-01   +3.252487876321840e-01   +9.655953484851948e-02   +4.217437264774807e-01   +3.929906638083906e-01   +1.178642923877216e-01; +5.569606060479061e-02   +3.461665031504728e-01   +5.394547122004113e-02   +1.913458493662638e-01   +4.822926172276378e-01   +1.444407819273124e-01   +2.029951215248730e-01   +3.710042626972845e-01; +3.527164164246303e-01   +1.087732278556610e-01   +3.183935103295513e-01   +4.653423150236546e-01   +1.189739737445900e-01   +2.691462793084076e-01   +3.143150976204336e-01   +4.703271236412892e-01; +4.683289163308325e-01   +4.677223362906494e-01   +4.759166732507588e-02   +4.302950863705831e-01   +1.768939166357897e-02   +4.326396466619951e-01   +1.255344514893544e-01   +1.323535541172927e-01; +2.715764931310119e-01   +9.395311850593825e-02   +1.399237343895126e-01   +1.638402930171255e-01   +3.330169519077572e-01   +3.984506447596658e-01   +1.659942457781594e-01   +3.151374330965213e-01; +4.708074903976531e-01   +3.606582929078505e-01   +1.421398766502219e-01   +2.338344299112367e-01   +1.339450384678941e-01   +3.035008553491417e-01   +4.902601980885198e-01   +2.944354667323351e-02; +3.130691537478212e-01   +3.996311747389800e-01   +4.947807095484707e-02   +2.410527564626313e-01   +3.531607215804621e-01   +1.238794917824777e-01   +2.838029994783166e-01   +3.072522232649375e-02];
L3I_L3E_iAMPA_netcon = [+4.558719534647755e-02   +3.480623456604590e-01   +1.636027185462304e-01   +2.667719237118027e-01   +4.367410681428922e-01   +2.560654592245165e-01   +1.729113726403734e-01   +2.305746502245813e-01   +2.558911991998740e-01   +2.908172671907278e-01   +2.350604264331642e-01   +2.295809936388596e-01; +6.957946613769903e-02   +4.495339842430722e-02   +3.906874813671508e-01   +3.410724108660003e-01   +2.015779836340044e-01   +3.495717245721403e-01   +4.205753765523438e-01   +6.423399628760187e-02   +2.494749599995870e-01   +3.203955266174119e-01   +4.252490298758754e-02   +3.428894973863553e-01; +4.253040785265900e-01   +1.592905211014882e-01   +4.736798849822793e-01   +3.898656652627044e-01   +1.297804666525212e-01   +5.024174335427524e-01   +4.414087846294249e-01   +6.753487044324347e-02   +2.068654489756023e-01   +7.800407889093225e-02   +4.893598651219353e-01   +1.940942379976126e-01; +4.957472430367647e-01   +4.213321583738466e-01   +1.289919250479205e-01   +3.393840338887840e-01   +9.819789666430648e-02   +2.229646588773531e-01   +1.313058296171552e-01   +1.881490646475620e-02   +4.852737158915763e-01   +1.742976938605726e-01   +5.022659710295828e-01   +3.335817143220985e-01; +1.740761625476107e-01   +2.138689820305175e-01   +4.511117428501059e-01   +3.975623130201386e-01   +5.069825758710483e-01   +4.327973742309174e-01   +3.641705427863690e-01   +2.892485650900921e-01   +2.736807442409954e-01   +1.271352282028685e-01   +2.901528246893673e-01   +3.737774795681363e-01; +4.502823327229664e-01   +3.918570175348951e-01   +5.056512605921830e-01   +4.344224226871327e-01   +1.119148332266908e-01   +3.073972511058388e-01   +2.940520180213692e-01   +5.080240326552504e-02   +4.087425031444922e-01   +4.414667656815604e-01   +1.406709711479384e-01   +1.045009396446866e-01; +2.982656973345589e-01   +4.623106606450867e-01   +9.957300544961549e-02   +8.106660235770338e-02   +3.300488257375575e-01   +1.484325240473020e-01   +1.195664837999749e-01   +3.888019930282136e-01   +5.036984811978165e-01   +2.378872356812949e-01   +9.457535580528921e-02   +1.999492570656264e-01; +1.350026780301744e-01   +2.277353072960553e-01   +3.814874500432107e-01   +2.275782978423335e-01   +2.851364430485561e-01   +2.793693668474937e-01   +9.497174359066210e-02   +3.449896171961847e-01   +2.130700284664254e-02   +3.412031624814591e-02   +2.674496990834898e-01   +2.255546182202721e-01; +1.788411934820870e-03   +4.618594902936224e-01   +2.703328160358998e-01   +3.310554074097017e-01   +1.297854789818920e-01   +1.339204056291779e-01   +2.811643372494730e-01   +4.471336632853955e-01   +1.875186027474476e-01   +2.805378196828763e-01   +4.811947830122799e-01   +3.692728918719165e-01; +5.152542623783051e-02   +3.438019007180994e-01   +1.321275964164726e-01   +4.003718951582896e-01   +2.066194082291405e-01   +1.775500720370010e-01   +3.458791192893688e-01   +4.418544584547546e-01   +2.493358838920333e-01   +2.736971207157015e-01   +9.950909021549054e-02   +5.052707887031581e-01; +3.529823052172083e-01   +1.629198405442428e-01   +2.056744060236753e-01   +5.115865542235317e-01   +6.685961329200968e-02   +3.124050495258187e-02   +3.587568347597583e-01   +4.943925511635319e-02   +2.866077125567286e-01   +4.498666069483205e-01   +4.083598570986793e-01   +2.269379199204536e-01; +2.225515689098228e-01   +4.960882980324061e-01   +3.499330171483340e-01   +1.637395451702432e-01   +2.870189878954310e-01   +3.454740943265250e-01   +4.055066723774803e-01   +8.703840281634433e-02   +4.510513257724935e-01   +3.225720761440597e-01   +3.659383878045231e-03   +4.627118424392189e-01];
L3E_L3I_iGABA_netcon = [+6.599027436830134e-03   +2.080566197514581e-02   +2.754763758748830e-01   +4.439120437310308e-01   +1.041393527472071e-01   +3.466019967895996e-01   +3.717313154051562e-01   +6.776131175067961e-03   +1.854281244225491e-02   +1.141900182066008e-02   +5.022494777253512e-01   +3.888486817393269e-01; +4.665578768899835e-02   +5.000796628520692e-01   +1.806127614181117e-01   +3.181315536698534e-01   +3.720469323733147e-02   +3.433636295857437e-01   +1.211060235231369e-01   +3.365170838264078e-01   +1.021339059064000e-01   +3.196298592393689e-01   +1.001274209659480e-01   +2.855531826928163e-01; +8.024898931822608e-02   +2.891263331635981e-01   +7.581392130515124e-02   +1.260828841590801e-01   +2.228985215658998e-01   +4.592793249949869e-01   +3.049800036341259e-01   +4.769747495711925e-01   +3.234744174946393e-01   +1.781470350945529e-01   +3.746679768686248e-01   +2.107541919582213e-01; +5.005019301588494e-01   +3.564201870908117e-01   +7.352289511085575e-02   +4.324015770810716e-01   +4.281536080603091e-01   +4.160933585864088e-01   +3.933463973619884e-01   +9.306745705291108e-02   +3.552332819503166e-01   +4.622152801530829e-01   +1.086078670670483e-01   +3.712409341755856e-01; +7.666205087747568e-03   +2.913027565298809e-01   +1.903164070550480e-01   +4.622639500159859e-01   +3.607952384261249e-02   +3.965300509989573e-01   +3.564270114331250e-02   +4.581106327417068e-01   +3.625787842088586e-01   +2.380919162724421e-01   +1.599361893611757e-01   +3.472074228072098e-01; +4.399576479215349e-01   +7.894864866747639e-02   +2.825998125189645e-01   +3.528373884049261e-01   +2.714203118593198e-01   +7.936912058812917e-02   +3.016318083384352e-01   +4.723142103459991e-01   +6.367502926247788e-02   +3.696901080856557e-02   +4.347274352322695e-01   +8.169964365101502e-02; +1.556057317972486e-01   +4.218287864414490e-02   +2.038499953351894e-02   +2.217472883430930e-01   +2.229517768193624e-01   +2.874626907509678e-01   +1.319754366876002e-02   +4.755749940381992e-01   +2.914764428575578e-01   +3.982253468723471e-01   +3.492651949537057e-02   +2.686050052083855e-01; +1.490133624659785e-01   +4.556498473449509e-02   +2.465033535580320e-01   +1.940146344464845e-01   +3.113228134555551e-01   +4.530639104344535e-01   +3.163449049204315e-01   +2.874417043718013e-01   +3.241843550910866e-01   +5.015278910758044e-01   +1.068215022747551e-02   +7.925837407850927e-02; +1.038067161651601e-01   +6.571515610573753e-02   +4.268743331678981e-01   +3.871274712172664e-01   +1.673284739001858e-01   +1.672473942523166e-01   +4.332617052665803e-01   +2.626499556376541e-01   +1.791727579415711e-02   +3.578771891120000e-01   +1.207096037455940e-02   +4.062535854935391e-01; +1.268945295859818e-01   +2.187606881476199e-01   +1.122535693938779e-01   +3.203447725393259e-04   +3.440054887391165e-01   +4.583039208155056e-01   +3.091206187228835e-01   +4.277083843029829e-01   +1.228403367273456e-01   +9.829424119405999e-02   +4.568085871704212e-01   +7.988647147028274e-02; +3.525301231423041e-02   +4.324139819521249e-01   +2.404559983469810e-01   +1.175387108514103e-02   +4.936483274229305e-01   +2.117864348715271e-01   +2.750106711759375e-01   +2.519087639245010e-02   +3.635458562487566e-01   +2.683984182680557e-01   +1.397290666789884e-01   +2.358972846182597e-01; +1.476992010781144e-01   +5.312353407141569e-02   +3.234012128017792e-01   +3.774022049902937e-02   +1.987155526409422e-01   +1.593459648390784e-01   +1.210073790405298e-01   +2.958764557807106e-01   +3.233209854154207e-01   +2.194888503775804e-02   +1.421045065371074e-01   +4.926520337231988e-02];
L2E_Input1_iAMPA_netcon = [+4.559697047122244e-01   +2.360411558491513e-02   +1.448160531800604e-01   +2.334221916841396e-01   +1.591555598138771e-01   +8.668331862698778e-02   +3.849918497296131e-01   +3.949660558692521e-01];
L2I_Input2_iAMPA_netcon = [+5.068978743660388e-01   +5.097458642286214e-01   +6.642829307738721e-02   +3.422538933101921e-01   +3.890400318865082e-02   +3.558411338175784e-01   +2.022385984808748e-01   +1.384564320374475e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.1*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.1*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 30*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 30*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
