function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.434688730177618e-01   +8.151693032237366e-01   +7.936404112666152e-01   +4.983237294200202e-01   +2.497999267980787e-01   +4.214004729673928e-01   +4.943816858529647e-01   +8.350209115825528e-01   +8.596629801646952e-01   +7.436380911291530e-01   +6.592906181597270e-01   +7.378014520374633e-01   +8.979963058951248e-01   +1.410415048182488e-01   +3.628416555281814e-01   +4.282860229954448e-01; +1.844127488008541e-01   +4.607907573864634e-01   +2.437519033811099e-01   +3.684065868751453e-01   +6.735929425180429e-01   +7.203545461345655e-01   +3.067954748828082e-01   +4.236901684988386e-01   +8.899676566331753e-01   +7.938964186019782e-01   +3.744880452708178e-01   +7.422341971758506e-02   +2.057495347863882e-01   +4.050514672387107e-02   +8.652911173172312e-01   +1.464303779325875e-01; +4.405934017048091e-01   +3.564467938800254e-01   +8.239742136513715e-01   +7.044726116097374e-01   +4.911833288442224e-02   +7.176818942818495e-01   +1.142654074742439e-01   +1.995743919026175e-01   +9.658069426770823e-01   +6.876528591090499e-01   +6.538091523621032e-01   +9.150913000770131e-01   +8.324387531132593e-02   +3.403503045131508e-01   +7.971729024813623e-01   +3.896648458638369e-01; +3.457159564718111e-01   +7.115060091234249e-01   +7.973290694683638e-01   +1.659743847104777e-01   +8.522476259643493e-01   +2.829130527864400e-01   +2.567079628217332e-01   +8.989178893789425e-01   +4.790492828898597e-01   +7.210345847375331e-01   +8.466924481856304e-01   +4.747399069282421e-02   +4.717987358845499e-02   +4.362834947326522e-02   +3.784050452585547e-01   +4.092025754908767e-01; +5.095809252064591e-01   +9.880193722460459e-01   +1.578865407306450e-01   +5.581176602961510e-01   +1.145811404250300e-01   +7.268580099117415e-01   +6.430748386517664e-01   +8.038485169879507e-01   +9.195008654277667e-01   +4.121444491869972e-01   +1.656950846097632e-01   +5.991811783443068e-01   +4.367057240965171e-01   +8.082969140257767e-02   +5.869149879146458e-01   +4.487511169845159e-01; +6.026268965582567e-01   +6.439310552598083e-01   +5.962193067578214e-02   +9.813553898416004e-01   +3.786108957168229e-01   +2.655289029022070e-01   +6.356875062180584e-01   +4.472378413449283e-01   +6.513485825093963e-01   +3.947713440042439e-01   +1.218655089041001e-01   +7.032031628418250e-01   +7.723759458717998e-01   +4.728409192128924e-01   +8.341110455251729e-01   +8.848005107630249e-01; +6.371346597456155e-01   +2.134885215653125e-01   +9.411580764415014e-01   +8.205793536806902e-01   +3.288605498565120e-01   +9.849861621915601e-02   +3.075505309978035e-01   +2.251424962596736e-01   +2.323529461378271e-02   +2.810128011466286e-01   +6.504024194377064e-01   +7.665627498638806e-01   +6.591027607677521e-01   +6.543808197938973e-01   +8.164927680957548e-01   +4.049069138482886e-01; +5.401348989471721e-01   +6.177415209380753e-01   +4.338931544493921e-01   +5.296836539594092e-01   +3.484096809094375e-01   +8.942735641177474e-01   +6.645085789132744e-01   +5.973754133352513e-01   +1.595639816104223e-01   +1.562907246212343e-01   +8.713452585417835e-01   +6.833537346577725e-01   +7.085311255807285e-01   +1.283841332859135e-01   +8.368527787589777e-01   +7.393155356098993e-01; +1.758746714862705e-01   +2.093452714183834e-01   +2.383006208251619e-01   +7.403547460762776e-01   +7.322511072916246e-01   +1.774679928160255e-01   +7.396127706791611e-02   +5.556058762474830e-01   +1.257698385146783e-01   +4.205075018223190e-01   +8.891748474705530e-02   +6.186375714383957e-01   +5.521281786163301e-02   +7.670653013572254e-01   +2.797498334001406e-01   +7.399388629350008e-01; +3.161365188418381e-01   +2.724346836350479e-01   +3.817492654025939e-01   +9.419153420305779e-01   +6.814807178248079e-01   +6.490408552627681e-01   +3.320432161543464e-01   +3.942534294288057e-01   +3.807553283951887e-01   +9.715123758139580e-01   +8.346765544709034e-02   +7.328135098266296e-01   +1.591234403710882e-01   +5.214306894765491e-01   +3.023009955957612e-02   +6.446776188166095e-01; +8.598986304539007e-01   +8.779723816960966e-01   +8.757318038973251e-01   +5.490970892201279e-01   +5.328703837560822e-02   +9.629797533755239e-01   +8.375653238797572e-01   +5.403421466124542e-01   +9.324711648516659e-01   +3.780891604019420e-01   +9.755236081379548e-02   +1.715447089837198e-01   +2.352728031979151e-01   +6.079281591847425e-01   +9.474669815407555e-02   +2.719884873311504e-01; +3.112343990757328e-01   +4.833291483088613e-01   +8.538792778284415e-01   +4.648672315789156e-01   +6.553412118226876e-01   +2.246864218680620e-01   +7.206661754930748e-01   +4.235977960283188e-02   +6.705944441370139e-01   +3.264310960833919e-01   +8.858079794730884e-01   +1.170455373952222e-01   +3.196680573890839e-01   +3.154510473191092e-01   +2.081203718389438e-01   +3.516909796537915e-02; +2.767900606233281e-01   +7.487261859473103e-01   +8.938093267130544e-01   +8.366379215239521e-01   +2.936702650445944e-01   +1.437149190689849e-01   +5.519408859334826e-01   +6.073851162582914e-01   +3.810889592512433e-01   +8.945075135809644e-02   +9.159170711032132e-01   +7.906971063502973e-01   +5.802051893797007e-01   +6.051712562054072e-01   +9.686435795284618e-01   +1.217717237642371e-01; +9.053383182186567e-01   +7.980541654426743e-01   +5.677573259591890e-01   +5.118109952220171e-01   +9.462302232242011e-01   +5.767493927896373e-01   +8.434810231475183e-01   +4.217559714812571e-01   +9.549080202872726e-01   +6.116245617124195e-01   +5.674844775874517e-01   +1.862108481918497e-01   +9.999309468554451e-01   +7.061049730160942e-01   +7.686488464483748e-01   +4.615869771073504e-01; +5.931050045923647e-02   +2.707130635643639e-01   +8.643994063139513e-01   +7.720383139589012e-01   +5.228790385198689e-01   +2.629201265069332e-01   +1.038516184329310e-01   +3.831387908071722e-01   +7.905470353484232e-01   +7.275016721913394e-01   +6.327418153217538e-01   +7.877234493924911e-01   +4.769899759152419e-01   +4.255741249353188e-01   +2.331920244801287e-01   +1.438368347879834e-01; +1.568353226096765e-01   +5.716343634253599e-01   +3.587934078957753e-01   +5.735267907553756e-01   +3.332847880056201e-01   +2.383087919867838e-01   +3.604953178653457e-01   +5.172194692385269e-01   +2.619799161224671e-01   +7.831651655551534e-01   +7.182840186131907e-01   +8.796125286581777e-01   +7.569582214213239e-01   +6.638438007573300e-01   +5.298969182479559e-01   +4.993618859471451e-01];
L1E_L1I_iGABA_netcon = [+8.189111813071048e-01   +4.701125325464092e-01   +8.070366676073316e-01   +5.930932353897989e-01   +6.475644616837081e-01   +7.934880965279481e-01   +5.034118566448753e-02   +4.855029523995231e-01   +2.446355863615070e-01   +4.063630995179046e-02   +6.706044355136802e-01   +8.317101316001284e-01   +9.059687290360241e-01   +7.047265303681208e-01   +3.687843789755607e-02   +6.047405203383680e-01; +3.618213691070071e-01   +3.278985900932923e-01   +3.115126575444549e-03   +9.761520176918889e-01   +9.286521442806751e-01   +8.430784116325593e-01   +3.751147800633570e-01   +5.150308590466786e-01   +6.179951887274633e-01   +4.477579720496753e-01   +9.993123157018918e-01   +5.656473030356610e-01   +3.340279785781233e-01   +1.046528555084180e-01   +4.445581047954430e-01   +6.655060674633572e-01; +6.576969723481404e-01   +4.758304637026622e-02   +8.357904410188884e-01   +7.803628013627727e-01   +9.501398822060765e-01   +4.812397460288307e-01   +5.785894255068124e-01   +3.816260948670588e-01   +8.012465193363461e-01   +4.998793826684866e-02   +7.441620528827620e-01   +2.368938899647512e-01   +3.732985356433970e-01   +7.804520347210295e-01   +8.400912736831773e-01   +3.736234877455713e-02; +2.849897341421042e-01   +8.340805410641519e-01   +2.621133174069967e-02   +3.344153178526215e-01   +4.257552013132954e-01   +9.213157204572172e-01   +7.887069403733273e-01   +2.370966045704659e-02   +3.028717357443624e-01   +1.391447312553568e-01   +4.634094479295028e-01   +6.361178247989449e-01   +7.925436472937697e-02   +5.764083449069679e-02   +3.580059266063662e-02   +8.303668418616137e-01; +6.629933905108641e-01   +7.135606138308336e-01   +1.625123061021982e-01   +3.241485239652306e-01   +4.476950160780671e-01   +5.362240222233831e-01   +6.793041482674885e-01   +3.869908104873619e-01   +7.621327834353254e-01   +6.816753435561762e-02   +3.718337016348680e-01   +7.830246628838123e-01   +3.893410077372932e-01   +6.169162795071415e-02   +5.706496732952806e-01   +9.059699321912762e-02; +6.385437142370892e-01   +6.308489612326609e-01   +6.665711642614948e-01   +9.367607674424165e-01   +6.723838193262478e-01   +6.082336183182274e-01   +3.171767178190672e-01   +3.825868214996762e-01   +1.766903049687057e-01   +8.321324460286592e-01   +1.471669171871892e-02   +6.779859568480799e-01   +8.221462033197237e-01   +9.854700824316805e-01   +9.236792813071144e-01   +4.971392929034183e-01; +2.704673526825295e-01   +7.083504264415252e-01   +1.236473111651809e-01   +3.920411345789077e-01   +3.184498586430201e-01   +3.629172169367312e-03   +7.711728162039012e-01   +8.002846281783725e-01   +6.388750400484373e-01   +4.247146730662170e-01   +9.748720961461199e-01   +6.025061788584372e-01   +7.410670636277008e-01   +9.864694882051267e-01   +1.493144606455188e-02   +1.316078520163517e-01; +4.550030137114222e-01   +1.872148618036891e-01   +7.983208425262318e-01   +4.742975123071030e-01   +7.523934266921900e-01   +3.927542795159278e-01   +7.105539145839421e-01   +2.157896904928960e-01   +4.966836929843449e-01   +7.493564824178273e-01   +5.332584129284582e-01   +7.304056898287455e-01   +7.763102066834476e-01   +2.082379905585160e-01   +8.140000802032488e-01   +8.068076269586073e-01; +6.006742559136315e-01   +8.347978632978857e-01   +1.986450991769554e-01   +1.183174757130487e-01   +9.822021778083525e-01   +5.179968688171485e-01   +1.518965274447773e-01   +2.233490435145311e-01   +4.344304417521385e-01   +8.399710307804877e-01   +1.760063603837579e-01   +6.583580866026596e-01   +6.439179725912754e-01   +6.601779159614780e-01   +3.016580028439895e-01   +4.260984101435661e-02; +9.682981668482400e-01   +8.140692437916904e-01   +5.267551002923349e-01   +3.267852759183792e-01   +3.754094354141330e-01   +6.076264442590631e-01   +2.363269025540269e-01   +5.973253425013211e-01   +1.953302567154518e-01   +7.689683757965596e-01   +9.267397489993856e-02   +6.646228806684094e-01   +8.001770649949691e-02   +2.741432003512702e-01   +1.462231153927296e-03   +4.081894992224211e-02; +4.049388632259566e-01   +1.816207755249281e-01   +2.134585675609186e-01   +4.785555972063510e-01   +7.606641596871005e-01   +2.212884548362453e-01   +1.293980378062614e-01   +4.298605225721892e-01   +3.437823759127395e-01   +7.414644300258298e-01   +4.138413779477679e-02   +3.621074239672226e-01   +6.243031738398819e-02   +1.285948334034027e-01   +5.183984339712555e-02   +8.295451135869948e-01; +1.982936593895106e-01   +6.345663919897702e-01   +2.865138932566382e-01   +2.947814539523153e-01   +1.121031271518604e-01   +3.477738414311223e-01   +9.714261137599024e-01   +4.740478448786958e-01   +7.001610232876365e-01   +7.697258803563832e-01   +2.858277228875462e-01   +7.232464181663768e-01   +3.020156445109752e-01   +9.668798254807022e-01   +6.365484749790538e-01   +9.148084738979484e-01; +7.787316884994956e-01   +1.435488117856323e-01   +3.883181919460188e-02   +1.436223465741122e-01   +6.312455331244149e-01   +9.606235978153121e-01   +9.563595152131444e-01   +2.130711805933889e-01   +2.709983104570831e-01   +8.929361586589453e-01   +3.823028305059928e-02   +4.152551469245012e-01   +6.172619142944281e-01   +1.435905096185626e-01   +2.276606737088667e-01   +6.696385002843850e-01; +9.440457090978819e-01   +6.643134767882947e-01   +3.228440760690851e-01   +4.614533056738166e-01   +9.813446112127874e-01   +4.167727667218021e-01   +1.967198890936918e-01   +9.888962707996518e-01   +2.059105469105431e-01   +7.247285200879938e-01   +2.294731855068791e-01   +6.443387001021641e-01   +5.397575399109859e-01   +4.381215567979923e-01   +6.725855898516707e-01   +5.375499141695337e-01; +1.485275001065863e-01   +4.957543333685240e-01   +9.178652656563864e-01   +5.588577416219858e-01   +8.785496221123394e-01   +1.862664229485281e-01   +3.363707621102854e-01   +8.677835388125151e-01   +1.882459090218901e-01   +2.935705338933132e-01   +7.169068662129785e-02   +9.741745602663378e-01   +7.825850354815272e-01   +2.409639285713359e-01   +1.234914954450774e-01   +9.680020080613215e-01; +4.494801184490548e-01   +1.957147397589872e-01   +2.124895944983717e-01   +4.911668909288793e-01   +3.542147114908368e-01   +3.314777796802354e-01   +5.137145848697922e-01   +9.872137789664832e-01   +6.254468359629667e-01   +5.963696532262045e-01   +5.623203924213516e-01   +1.280744511849428e-01   +7.253045552958776e-01   +2.643180762648946e-01   +2.519918120141242e-01   +7.393817533447996e-01];
L2I_L1I_iGABA_netcon = [+2.717312672337561e-01   +5.652486207483747e-01   +3.648758000701752e-01   +4.759105752480771e-01   +2.883464699455721e-01   +1.333468636835672e-01   +4.929864247557025e-02   +7.770738388055057e-01; +7.095166142962762e-01   +2.332001568372720e-01   +6.613388236479489e-01   +1.439969584475014e-01   +1.684395959723061e-01   +9.309665993912538e-01   +4.692378568908395e-01   +9.337691037111373e-02; +1.899516837625473e-01   +4.912352687234196e-01   +8.564955452740386e-03   +1.895993670860978e-01   +2.949990920440637e-01   +4.568129526197166e-01   +6.983055518733589e-01   +1.340880633512439e-01; +2.539572177552251e-01   +4.523569670865056e-01   +4.814997038511398e-01   +6.649354054258316e-01   +2.847692636725079e-01   +4.387496593749608e-01   +8.837602879832159e-01   +5.720351977288834e-01; +6.368393479515866e-02   +7.613923310978278e-01   +8.659582324358575e-01   +1.827526619759099e-01   +8.494372069332179e-02   +9.422559183563074e-01   +7.754381236935719e-01   +2.549626417562323e-02; +6.142087468186108e-02   +7.392716005932312e-01   +3.258368163353631e-02   +1.704262935509070e-01   +2.194993156637272e-01   +3.373028156818287e-01   +3.406353933026984e-02   +7.678634235093984e-02; +1.205285924828274e-01   +4.690093020885086e-01   +1.091119529077023e-01   +2.128435294632390e-01   +3.514452387444241e-01   +9.560197462575181e-01   +8.449837803292860e-01   +9.899189436669137e-01; +9.377174791240321e-01   +1.415163914664607e-01   +4.254381967982482e-01   +2.995422005943775e-01   +6.364596285278957e-01   +8.098250911515437e-01   +5.081506352034275e-01   +9.783450797607619e-01; +2.583029352057675e-02   +7.185911923168599e-01   +7.302482497357603e-01   +9.832832213052668e-01   +2.775020205841559e-01   +5.832865140133814e-01   +2.637292245844891e-02   +3.119331758685704e-01; +5.902497181034113e-01   +9.943770774342575e-01   +4.690327703453123e-02   +7.791905665231150e-01   +2.863888856087017e-01   +6.886764531209540e-01   +3.141680952708993e-01   +1.019482164477735e-01; +8.553192609167882e-01   +1.759063162927118e-01   +1.923316152065461e-01   +1.758993559081481e-01   +3.668047548251188e-01   +8.711352571881481e-02   +6.394029521014003e-01   +4.479133421420892e-01; +8.523853374375633e-01   +7.912826379825870e-01   +7.314874956699371e-01   +3.043820180496339e-01   +6.256163955187960e-01   +1.121911122631576e-01   +6.094893653831651e-01   +4.900183098267882e-01; +8.809522572413427e-01   +4.518911313770279e-01   +1.467042795284301e-01   +8.205619911922513e-01   +1.031436196259076e-01   +2.915889958200204e-01   +9.697309550658791e-01   +7.076305978660946e-01; +6.999486724397246e-01   +4.229120434995294e-01   +3.899197793835710e-01   +5.426120280847671e-01   +9.178515237718825e-01   +9.186379884884291e-01   +9.341620625787705e-01   +1.349718877877322e-01; +3.215543448545682e-01   +7.877632395182985e-01   +5.452870414795717e-01   +8.470899799777850e-01   +6.760767970452561e-01   +7.255475989056770e-01   +1.240930283298973e-01   +5.671584805622595e-01; +2.268467363547880e-01   +8.673933905609643e-01   +1.272352516959110e-01   +8.671344130462071e-01   +1.473603706440526e-01   +2.390529767256218e-01   +6.867263947492541e-02   +1.289048723260044e-01];
L1I_L2I_iGABA_netcon = [+8.351915122968496e-01   +9.139645110455877e-01   +4.587732134360466e-01   +8.803239365935355e-01   +5.022179410897606e-01   +2.431382643994837e-01   +9.548179810240853e-01   +4.985276789254636e-01   +1.831998275954972e-01   +4.420165904072126e-04   +6.204491895820086e-02   +3.483799646298905e-01   +9.455747089566654e-01   +2.365519542496687e-01   +6.842909299383756e-01   +3.140683141334345e-01; +4.204740332298109e-01   +3.195893164815178e-02   +8.387231981299387e-01   +3.048329299452165e-01   +7.662127629265892e-01   +7.155646543437881e-01   +3.759964797024126e-01   +5.213107849171253e-01   +4.924324533335022e-01   +9.453169603771399e-01   +4.390486702145421e-01   +8.334782556488411e-01   +2.223869913178447e-01   +8.627351314709749e-01   +4.130270970734811e-01   +9.288224268489285e-01; +1.752320735542032e-01   +4.334894233583069e-01   +7.521224421587275e-01   +3.224085484728699e-01   +2.011527812191926e-01   +7.963430463901838e-01   +4.970714646465498e-01   +5.323288583094554e-01   +8.357784788031286e-03   +7.616964652436101e-01   +9.837726893360212e-01   +4.798953302748650e-01   +3.863444352534595e-01   +9.167603832074813e-01   +4.738661428516733e-01   +1.672400888267471e-01; +8.219877523938470e-01   +4.614432054170144e-01   +6.172555509088973e-01   +6.853425929947801e-01   +4.872291727378742e-01   +7.858601277039601e-01   +3.790219022794127e-01   +3.383197700231000e-02   +4.070036840394864e-02   +8.620482847663771e-01   +5.375332081610007e-02   +5.633574694400361e-01   +8.783344675713946e-01   +1.521137273137140e-01   +8.927103154825700e-03   +1.341858821139752e-02; +6.990061185517994e-01   +6.961595787594226e-01   +7.637223792037766e-01   +1.415925140628196e-01   +5.643101744107327e-01   +8.589551963004720e-01   +3.903611176404926e-01   +1.346620242118863e-01   +1.676877202540350e-02   +2.611688608508069e-01   +4.436248965336027e-01   +5.626062819962988e-01   +5.128566232215315e-02   +7.952159899303138e-01   +8.186037137610883e-01   +9.674196832918258e-01; +1.840521918587732e-01   +9.945922449181008e-01   +6.977961082615634e-01   +6.948542961816763e-01   +6.819576829243812e-01   +5.289426552836044e-01   +6.087210514443357e-01   +4.848331688968918e-01   +1.232127342826975e-01   +3.157008969459904e-01   +8.607796351025917e-01   +8.860593234550594e-01   +7.675496589230278e-01   +4.686513318806194e-01   +8.777811954980291e-01   +6.317383791556822e-01; +1.275533025811626e-01   +6.847319912669485e-01   +2.609423367423243e-01   +7.467005566324101e-01   +8.135449829800639e-01   +8.654888071947650e-01   +3.939174528076723e-01   +7.070756635734080e-01   +2.050817773535053e-01   +1.595782225401902e-01   +5.486622113563122e-01   +1.379333951986695e-01   +5.659791466711193e-01   +7.097041765226419e-01   +7.154281920733208e-02   +7.178338092262405e-01; +6.719193751181077e-01   +4.956626383934277e-01   +6.253019906053061e-01   +8.046457632164873e-01   +5.475170564992827e-01   +6.586891024718254e-01   +8.936929957869841e-01   +4.265081759165387e-01   +1.329855250354517e-02   +5.269845678562334e-01   +6.158238966672805e-01   +3.668122376985382e-01   +6.863092474108435e-01   +9.104679396048099e-01   +9.367575938687596e-01   +1.550671361660452e-01];
L2E_L1E_iAMPA_netcon = [+1.007584615676654e-01   +9.825394291255577e-01   +7.581409488661986e-01   +6.100974574873068e-01   +6.115332887259338e-01   +6.941343556201072e-01   +5.668401395078164e-01   +9.019104068029876e-01; +7.822048246046261e-01   +2.777266172493255e-01   +6.149664568382353e-01   +5.663898441578463e-02   +6.121939003799873e-01   +2.819196416684649e-01   +9.663979759574649e-01   +1.199198754382430e-01; +6.446926156962621e-01   +1.020704962778606e-01   +9.769609664837591e-01   +8.422378085235750e-01   +4.498304146652897e-01   +9.019503382415462e-01   +1.206015391188888e-01   +5.760463750001196e-01; +9.227022147053014e-01   +9.690789419846735e-02   +6.750955808720628e-01   +5.542953794303457e-01   +2.313204893013834e-01   +1.925309511794097e-01   +4.864638189495410e-01   +4.609765148277238e-01; +2.076543429031630e-01   +6.862767194048547e-02   +9.850954084918335e-01   +7.778665741221513e-01   +5.948499250027796e-01   +9.678407113141112e-01   +8.694308094243255e-01   +5.437277016753947e-01; +5.581929731764571e-01   +7.350244238904924e-01   +6.237624122459207e-01   +5.903574088302973e-01   +9.061217991173965e-01   +1.172743160090356e-01   +1.041660464431901e-01   +9.134796441296392e-01; +5.675294172786659e-01   +9.822570434743659e-01   +4.601892651229510e-01   +6.397226929175321e-01   +3.518342100118528e-01   +8.162516841280084e-01   +4.372030404096181e-01   +3.587081357659165e-01; +2.100653731267147e-01   +5.148256251205197e-02   +3.964277969674708e-01   +5.003836418860073e-01   +3.797115398435913e-02   +7.802910152945557e-01   +7.957859155153258e-01   +1.664276883951437e-01; +1.618381393723037e-01   +7.198049240828585e-01   +3.203030852367891e-01   +3.164579163733280e-01   +5.951785740472078e-01   +3.301982704562245e-01   +2.507807793244432e-01   +8.909578583287745e-01; +1.515739329452410e-01   +6.182679070961847e-01   +5.663066093473905e-01   +6.712761010537983e-01   +7.736606458629702e-01   +2.902708091170149e-01   +4.626437185142663e-01   +6.025835962740121e-01; +8.638651819430704e-01   +6.383016349614246e-01   +7.494349098410377e-01   +9.168740356141972e-01   +4.558337555872597e-01   +1.928209476486719e-01   +5.101517610967365e-01   +2.469853705494308e-01; +2.834615876192820e-01   +9.821247605946103e-01   +7.967250699948373e-01   +4.529104662691286e-01   +3.398944426374634e-01   +9.718075707771829e-01   +8.935637745599708e-01   +5.829626598807574e-01; +3.905620366466682e-01   +6.487646965157716e-01   +7.602201064305951e-01   +5.258114217290608e-01   +7.824014143008698e-01   +8.679420202639556e-01   +5.295086605539262e-01   +6.023561583219533e-01; +7.437612163141638e-02   +8.962306554761906e-01   +8.732572335181628e-01   +9.956845756593307e-01   +7.625841035033388e-01   +2.925601976399146e-01   +8.132029194489632e-02   +5.667969933684894e-01; +3.903923752924841e-01   +1.174648199748316e-01   +7.969342602566841e-01   +7.179383091613645e-02   +8.346952323937460e-01   +5.161393165337878e-01   +6.816524157923611e-01   +7.983708446768042e-01; +2.616411141422977e-01   +1.053322022809330e-01   +7.381182556572730e-02   +3.892958714311212e-02   +5.666556128598352e-01   +4.951550795640567e-01   +4.304799339501220e-02   +3.400830047426244e-01];
L1E_L2E_iAMPA_netcon = [+2.628524000221789e-01   +1.240206923814494e-01   +6.843764048804807e-01   +2.387507993519831e-01   +2.912384459909467e-01   +9.845691823589611e-01   +4.143982965326130e-01   +5.282541803514951e-01   +4.137283082884299e-01   +3.706488266635635e-01   +3.650884653805676e-01   +4.585991046046659e-01   +7.063485920178829e-01   +7.941651112188597e-01   +4.920818421591511e-02   +9.973388044562574e-01; +5.267924954001070e-01   +5.677393188226726e-01   +9.377122437519471e-01   +7.539708515095150e-01   +1.318810353815130e-01   +4.592859481108940e-01   +4.923298058005720e-01   +4.778466463754882e-01   +6.725926835678601e-01   +3.138572933379153e-01   +1.878924493526635e-02   +9.106143335290113e-01   +9.633061354314265e-01   +3.687727385216623e-01   +2.732055976466778e-01   +3.650207895686014e-01; +9.469050528061411e-01   +5.293181748489183e-01   +8.597316790583506e-01   +6.505579769731352e-01   +9.790962794306572e-01   +3.450760509417102e-01   +1.022151535287613e-01   +1.980160731017445e-01   +3.652334605658382e-01   +6.291101153201540e-01   +5.020004218505131e-01   +9.848109330978908e-01   +7.593276589265885e-02   +7.841253778895019e-02   +4.062295799825939e-01   +3.253266616488941e-01; +7.599633780263669e-01   +3.168206310536943e-01   +3.230790048662094e-01   +8.109296804413880e-01   +1.937250880908401e-01   +9.434324971368129e-01   +4.551681834992156e-01   +9.541292604927019e-01   +9.637192091554866e-01   +2.953294850361166e-01   +9.613367023422492e-02   +3.396290230367077e-01   +6.190013139456532e-01   +8.278794096805560e-01   +1.272638260073283e-01   +8.541980775639737e-01; +8.425500814062458e-01   +7.529127163060464e-01   +2.970481600204432e-01   +5.633415488465193e-01   +5.480708847674672e-01   +8.698153446699168e-01   +2.620234260978171e-01   +5.388692463643002e-01   +5.902669416656161e-01   +7.424063836757506e-01   +5.210390163770259e-01   +4.896956771201401e-01   +9.274806261421292e-01   +8.270183726577153e-01   +8.708967100827054e-01   +1.520323853630501e-02; +2.449859380811392e-01   +1.543667161188533e-02   +4.623005345493639e-01   +3.833747297773210e-01   +3.452799848348796e-01   +6.903383515914355e-01   +6.885641791259877e-01   +9.784101960729519e-02   +5.024447975550317e-01   +7.809763572213435e-02   +1.622384155744376e-01   +8.021738205887221e-01   +7.619526823959387e-01   +9.343126213908152e-01   +2.249653084363916e-01   +1.399752765931843e-01; +3.664464855702387e-02   +4.320988159476720e-01   +9.298146129757534e-02   +7.590215236595170e-01   +6.950168189187568e-01   +4.339191096856242e-01   +6.389509610849997e-02   +6.400999638147463e-01   +1.520746708892501e-01   +3.255357226728224e-01   +8.972741952165891e-01   +8.887351507344990e-01   +8.332905951211549e-01   +2.407680464953620e-01   +1.790581426966562e-01   +8.631980445255049e-01; +8.900778955163752e-01   +5.314377326671129e-01   +1.317214742112676e-01   +1.429749946481389e-01   +2.914909369771820e-01   +7.498803436863266e-01   +1.534972002191214e-01   +3.533140685671861e-01   +9.952201008661719e-01   +4.286522391939748e-01   +8.733631285146949e-01   +2.394006517389548e-01   +8.137241289645056e-01   +2.574088452196996e-01   +6.859225134803225e-01   +4.353272249448703e-03];
L2I_L2E_iAMPA_netcon = [+3.546247996305838e-01   +7.828733184299999e-01   +1.184318753289570e-01   +9.138896370281954e-01   +4.421899307033158e-01   +6.639360633313790e-01   +7.462363598852120e-01   +6.020967995925284e-01; +9.183314928539045e-01   +4.525841241289353e-01   +4.493045127789044e-01   +4.133822240794206e-01   +2.326062540730318e-01   +5.835557178355424e-01   +1.762262391635679e-01   +7.742662264165041e-01; +5.469672814389016e-01   +5.178846416169557e-01   +4.883464506705968e-01   +1.540013205816282e-02   +5.957348779284592e-01   +3.506104219405967e-01   +7.034053442503891e-01   +5.275006551332229e-01; +5.267539205654613e-01   +6.354001136328906e-01   +9.578819350009687e-01   +5.344662528365268e-01   +7.781512976319457e-01   +4.093343116399627e-01   +2.540912302800022e-01   +2.565840723575794e-01; +4.156378227045932e-01   +1.590381925739076e-01   +4.390402377783146e-01   +3.697102243569800e-01   +6.332651157444777e-01   +1.389523729727405e-01   +6.037069465981862e-01   +1.119049818273905e-01; +1.212537996974976e-01   +2.554216614100872e-01   +9.043761502178322e-01   +2.977675015434912e-01   +5.840265954907409e-01   +4.696348205908987e-01   +8.526581016204992e-01   +9.519882376085786e-01; +3.430971294124907e-02   +7.003572012617735e-01   +5.927732822760009e-01   +6.307346875444728e-01   +4.466918404671973e-01   +2.073023033668958e-01   +3.174957851266909e-01   +7.366574621987725e-01; +1.321869113913161e-01   +4.198041728012409e-01   +2.295167055640053e-01   +3.614351415146519e-01   +6.034707737556830e-01   +4.576172832071688e-01   +6.977432682057264e-01   +4.167086202419484e-01];
L2E_L2I_iGABA_netcon = [+1.694579110084808e-01   +7.912257400599900e-01   +6.454932088520049e-02   +9.634436213129727e-01   +2.587916315050720e-02   +7.283416658290320e-01   +8.185764382981169e-01   +8.381425242755092e-01; +6.455781992875569e-01   +6.238295946095089e-01   +4.102391314223156e-01   +7.273392588221250e-01   +7.143463140495901e-01   +9.972074941148475e-01   +8.987325323858922e-01   +6.930889697404867e-01; +8.722837918901526e-01   +1.296790499922051e-02   +4.612497252577497e-01   +8.042049768177439e-02   +3.045251443925211e-01   +3.010476449436380e-01   +3.264959969710417e-01   +9.977752613817484e-01; +4.605164481703494e-02   +9.513377747047052e-01   +2.725622973323245e-01   +1.250772625674179e-01   +8.903918662320198e-02   +7.849115591104316e-01   +7.231277361179133e-01   +4.383868733645264e-01; +5.203168250122991e-01   +2.582314784051188e-01   +5.363369276314730e-01   +5.339868022931550e-01   +8.233144100556432e-01   +9.977905943308407e-01   +5.320776125114667e-01   +6.492488696794763e-02; +5.102358111117689e-01   +9.931516581177945e-01   +8.151665934476382e-02   +5.137264199522207e-01   +3.871906904982663e-01   +9.854525367233712e-01   +3.035184049017120e-01   +2.934722855177452e-02; +8.160521721705758e-01   +7.415790130470700e-01   +2.556083059845774e-01   +7.897442312601518e-01   +8.189964834215056e-01   +7.888267426416120e-01   +6.485970611298669e-01   +5.498539404648507e-01; +6.031309121873182e-01   +5.979899020824632e-01   +1.291136899625995e-01   +6.196571768990189e-02   +4.273522962302047e-01   +9.643551634231876e-01   +7.306105427668186e-02   +6.508090454596924e-01];
L3E_L2E_iAMPA_netcon = [+2.257287432016953e-01   +5.201792090083778e-01   +9.760273196691599e-01   +6.600534458745162e-01   +7.937208316690556e-01   +2.380761450272126e-01   +4.878287262809966e-02   +1.232163716363091e-01   +9.127434681113389e-02   +7.296412407035074e-01   +5.685071859959040e-01   +2.386934017944750e-01; +1.182158873994825e-01   +9.141315709867616e-01   +3.907527110234185e-01   +3.906836039924235e-01   +1.586091742174234e-01   +1.128180843841388e-01   +2.837226834643800e-01   +6.508057508324246e-01   +1.138331839246081e-01   +8.532411431151279e-01   +1.919055266266123e-01   +6.011370112074940e-01; +4.344092978640607e-01   +6.471496545220796e-01   +5.983445343906931e-01   +9.996155817394523e-01   +9.244946179402441e-01   +4.709166616481325e-01   +8.480364643480056e-01   +7.758783794570662e-01   +4.759811330177599e-01   +4.661850103445366e-01   +3.623210495261927e-01   +3.325793836267363e-01; +9.908764281645556e-01   +5.529852851571193e-01   +9.019568001459921e-01   +9.793924001975758e-01   +6.320323571570098e-01   +1.133593843918732e-01   +2.505004677295416e-01   +4.178882885978243e-01   +1.814208240377432e-01   +8.386396701126778e-01   +9.701427118574188e-01   +9.583376770692127e-01; +4.234710562926286e-01   +2.956951024096661e-01   +6.159665836170112e-01   +7.542639676490246e-01   +3.253810844979378e-01   +5.091691788814972e-01   +3.856400535330966e-01   +5.653244332995919e-01   +1.807556564727185e-01   +6.412184357025708e-01   +2.572716366680631e-01   +1.994934508977617e-01; +5.919259377575629e-01   +6.707250319173665e-01   +9.553727590834011e-01   +8.560775052345481e-01   +9.564580013078312e-01   +5.029431773978724e-01   +2.493577271753938e-01   +8.697783221440563e-01   +8.549733547252343e-01   +7.520785734246590e-01   +1.308297538062028e-01   +8.445301163962804e-03; +8.751534225953469e-01   +4.779430785800430e-01   +9.780446059420239e-01   +6.296621777968414e-03   +1.807099588377081e-01   +5.895679827605975e-01   +9.287987975486323e-01   +1.658461436815720e-01   +5.613500736570840e-01   +3.106229469749298e-01   +7.762985128296486e-01   +6.172869685155749e-01; +6.085693391939595e-02   +1.895752964618480e-02   +3.612150217408131e-01   +6.302881990079432e-01   +9.940749182573794e-01   +9.863779602514966e-01   +2.359676176862213e-02   +3.678825955831122e-02   +2.048552905147593e-01   +8.773282067319176e-01   +2.273248066693996e-01   +8.109695681700740e-01];
L3I_L2I_iGABA_netcon = [+9.977071339988934e-01   +1.396252837544523e-01   +8.764226372089290e-01   +9.517734612547091e-02   +5.303611656764440e-01   +1.747337735943318e-01   +2.651602272176382e-01   +8.470859000828790e-01   +1.529688841575009e-01   +6.833226337850036e-01   +7.384790856862680e-01   +9.464563672908157e-01; +4.713409943951655e-01   +8.923286130582730e-01   +3.266204294047753e-01   +2.831698927788016e-01   +6.622508022642959e-01   +6.493951729077324e-01   +7.870028702360582e-01   +6.069238886165766e-01   +8.459105531316977e-01   +9.159069983548402e-01   +7.731656690908942e-01   +9.494061930621952e-01; +9.274032668117731e-01   +8.583160987235263e-01   +4.301102506495911e-01   +6.466965463592264e-01   +3.918809649818780e-01   +1.281906705190361e-01   +3.604239884212226e-01   +3.358832952475655e-01   +5.959988481756192e-01   +4.136616852314200e-01   +2.120128845503830e-01   +5.345458953441951e-01; +2.363856692325190e-01   +5.216852487238194e-01   +7.070241417094336e-02   +2.857412909650925e-02   +7.978692248313476e-01   +7.060389863850047e-02   +8.880674533482565e-01   +6.897218353655175e-01   +5.181479768589164e-01   +2.250321880668710e-01   +1.726287088999037e-01   +4.939033034021382e-01; +2.749917383919209e-02   +5.040096250679098e-01   +5.917318536264159e-01   +7.699425169557228e-01   +7.268841736093081e-01   +8.599479899084262e-01   +8.776909453940118e-02   +2.995491804931221e-01   +8.513657232244993e-01   +8.736766809922232e-01   +6.430396941427086e-01   +8.815883706649690e-01; +2.121182940382093e-01   +2.353963249489869e-01   +8.282796745707039e-01   +8.523533556814915e-01   +5.209166579802195e-01   +6.600122981486558e-01   +7.902583327986017e-01   +6.885370617413652e-01   +7.808587048342400e-01   +4.935218724829881e-01   +3.074259403388261e-01   +2.006830360903566e-02; +7.734939692926456e-01   +1.724785848787926e-01   +2.682848006774349e-01   +9.294048632849210e-01   +9.375397711651855e-01   +4.118179470773049e-01   +2.909970511167990e-01   +9.703325038106655e-01   +2.676257156689075e-01   +6.714812015091037e-01   +7.421489710826940e-01   +4.744998347210516e-01; +9.372357537161113e-01   +5.698361302361951e-01   +2.513016878475118e-01   +5.512498204595733e-01   +8.391011919180235e-01   +7.811744131716261e-01   +8.922964299224292e-01   +1.682203402023820e-01   +9.494070066106003e-01   +1.333305379134300e-01   +1.252742079450664e-02   +6.296095609967765e-01];
L2E_L3E_iAMPA_netcon = [+4.675707005231304e-01   +3.555899134194862e-02   +4.725933075894062e-02   +8.892222879023165e-01   +4.935949187575196e-01   +2.884146769738080e-01   +5.528454134940879e-01   +6.307956145503725e-01; +7.569174266319730e-01   +4.308714661169453e-01   +1.202544025472065e-01   +7.671792818852108e-02   +9.699002641477834e-01   +3.326694018123372e-01   +2.007124125513126e-01   +9.175005172968655e-01; +7.319325608492293e-01   +8.378021974951756e-01   +1.073006585717505e-01   +9.910892072889107e-01   +3.757854600030119e-02   +8.882462788021006e-01   +9.981886102945857e-01   +5.411744828116517e-01; +6.482114901866370e-01   +3.596879613803944e-01   +2.433264912788083e-01   +1.356651006128113e-01   +4.485462635025455e-01   +5.903719913313388e-01   +7.326540979215683e-01   +7.827639839369236e-01; +7.378486327478349e-01   +8.450212264967957e-01   +8.271237197609692e-01   +8.924325574398337e-01   +1.628836605022085e-01   +3.969274206212396e-01   +5.544777789279062e-01   +7.565627836769786e-01; +6.858851902186670e-01   +2.441849563321383e-01   +3.390326615146509e-01   +3.406314931287011e-01   +8.608727427242646e-01   +8.664331103374143e-01   +9.648399776806417e-01   +2.343076921679442e-01; +2.159305670404273e-01   +3.195647562476999e-01   +9.044871407812950e-01   +6.548902575198396e-01   +9.500249033906906e-01   +9.727909146502567e-03   +9.844397723627220e-01   +1.688480479168378e-01; +2.240159924504753e-01   +5.413463129166876e-01   +8.751968327667646e-01   +1.994656656013415e-01   +4.310884135220259e-01   +7.751103239488187e-01   +8.400973751470541e-01   +3.235836956775692e-01; +5.818277152605136e-01   +2.160974094655054e-01   +5.130688266915860e-01   +8.336586828783100e-01   +2.575036300183169e-01   +3.693072770557914e-01   +3.296592418452683e-01   +7.737277389571248e-01; +1.361023618517754e-03   +6.715170418479059e-01   +8.272497323258601e-01   +6.670146770843807e-01   +3.134200644178021e-01   +6.514306781615572e-01   +4.672564857519641e-01   +1.937255095222832e-01; +1.582330870258306e-01   +7.562573677703655e-02   +6.268943025272992e-01   +2.621858698301880e-01   +6.953240118657615e-01   +3.445139440955458e-01   +7.410904467642572e-01   +1.727893217458690e-01; +4.983577617314584e-01   +1.253027172587007e-02   +4.412429297255879e-01   +4.077873380801200e-02   +2.049155525640627e-01   +5.112279231062111e-01   +9.023162740668929e-01   +7.925959446087019e-01];
L2I_L3I_iGABA_netcon = [+6.453624708717092e-01   +1.906609325631206e-01   +2.437127947663723e-01   +1.799690046004776e-02   +4.749698602721776e-01   +7.648264627196638e-01   +5.992189842576339e-01   +7.861345030212145e-01; +1.160509994759331e-01   +6.444892905829799e-01   +3.608344519564480e-01   +7.547364971930995e-01   +7.262742880929418e-01   +6.685885030933107e-01   +9.314674376701759e-02   +6.608190294518571e-01; +4.087445718067787e-01   +6.857529566207938e-01   +5.748643847240521e-01   +1.188525228114791e-01   +4.461403364212365e-01   +6.395727544683442e-01   +2.436287061795004e-01   +6.121234928705621e-01; +7.630031046091686e-01   +8.655163259449038e-01   +2.484180090992490e-01   +3.907557576705925e-01   +7.378751089057483e-01   +6.088633304038615e-02   +4.143461552198983e-01   +5.706486327725329e-01; +8.432262068284277e-01   +5.060896589349899e-01   +2.886866111916302e-01   +2.521161255437364e-01   +2.384804837551893e-01   +2.081131072771417e-01   +9.073433087356957e-01   +3.058541802453411e-01; +5.440324357727255e-02   +1.083099337534189e-01   +4.203723535646805e-01   +1.012373467840367e-01   +4.037379574772484e-01   +2.456920467455802e-01   +3.202035601799689e-01   +7.859409395333187e-01; +4.611794363503402e-01   +9.110790795043860e-01   +5.620439852895694e-01   +5.848833570710954e-02   +5.553597939472272e-01   +6.289565940819664e-02   +1.714344993056360e-01   +4.080948983037533e-01; +4.121362125456284e-01   +2.614301372979629e-01   +6.337978222094640e-01   +3.996678822593879e-01   +8.354146209276229e-01   +8.124248345458889e-01   +4.747991924514688e-01   +2.661552679311597e-01; +7.989422820677723e-01   +4.559262662660294e-01   +2.021846535402838e-01   +6.229998553854916e-01   +4.603367873963340e-01   +1.629577370144547e-01   +3.321779679674076e-01   +1.505822002441137e-01; +9.265013593778991e-01   +8.600848056024338e-01   +5.181631844901254e-01   +8.228300577696173e-01   +8.976162314184440e-01   +5.967202113845023e-01   +7.613870313658816e-01   +1.799659180655887e-01; +6.096759368269725e-01   +1.735944105239858e-01   +8.077525835248089e-01   +7.407328149493110e-01   +4.994314002751046e-01   +4.270491700706137e-01   +4.713288610111053e-01   +4.609051259571473e-01; +7.188326449349531e-01   +2.019149374464206e-01   +3.084452800660127e-01   +2.978316387132651e-01   +9.364058103322855e-01   +2.429161212829675e-01   +8.452792487358018e-02   +9.160103171481214e-01];
L3I_L3E_iAMPA_netcon = [+5.628167326329092e-02   +8.861013931521909e-01   +5.996501896010534e-01   +6.758104234039417e-01   +2.441520391830898e-02   +3.574246155263880e-01   +2.142808399215712e-02   +7.706592009044988e-02   +4.395137627960169e-01   +2.620116948240154e-01   +2.991183693260104e-01   +5.522762323296087e-01; +7.407409973892422e-01   +9.869999849256025e-01   +3.971659036867410e-01   +4.492618252928631e-01   +3.467731898793626e-01   +5.254045560597977e-01   +5.107215382401823e-01   +3.007062208251230e-01   +1.104818162433714e-01   +7.016061646747798e-01   +2.876785976499097e-01   +8.464120987310937e-01; +2.691790109171434e-01   +4.472540259601536e-01   +1.987736249659796e-01   +4.561712076644396e-01   +6.054796900021568e-01   +4.115745054596941e-01   +1.646934012042596e-01   +4.898671054939410e-01   +8.728001653141551e-01   +3.722347335134153e-01   +8.703746488050565e-01   +5.151755183748800e-01; +5.550434972036298e-01   +2.704064359949040e-01   +1.825842566978200e-01   +1.618188764022512e-01   +1.880152975822349e-01   +1.297918925091321e-01   +5.830461268347700e-01   +5.951395677723172e-01   +4.598087349743089e-01   +5.869166945670449e-01   +7.699276421483692e-02   +7.313506450088966e-01; +5.624599022926109e-01   +9.288238568643954e-01   +1.696353399487840e-01   +7.030483246349516e-01   +9.062360330785468e-01   +7.031803286718016e-01   +9.323126486132913e-01   +9.514742595804535e-01   +7.746553665781215e-01   +4.433603289549672e-01   +2.356653367096734e-01   +6.190253173770049e-01; +4.128984107357141e-01   +9.396468327771719e-01   +8.696321549731397e-01   +8.762821899534401e-01   +7.272265823012853e-01   +2.033202765747949e-01   +1.291585041152322e-01   +1.665664048326365e-01   +2.495094546799215e-02   +9.200349147669128e-01   +8.372598617475052e-01   +6.910702208905118e-01; +8.610347643537120e-01   +1.797119683232250e-01   +7.485353922160662e-01   +6.327683343952315e-01   +3.205897865515401e-01   +1.319595258966373e-01   +2.696059894241504e-01   +2.246051504527707e-01   +4.641606758070534e-01   +1.691694728033972e-01   +1.030081821506346e-01   +2.738404010874839e-01; +7.499396387970381e-02   +6.668658832192476e-03   +7.873351242382007e-01   +4.412892119610600e-01   +1.212632875074263e-01   +4.206123253854306e-01   +3.958591442275307e-01   +7.143930488826062e-01   +8.131512504789123e-01   +2.828078211674886e-01   +9.687030025937187e-01   +5.886763601615176e-01; +4.213096395786218e-01   +5.875308616532953e-01   +3.588753282752033e-02   +4.934036185325724e-01   +9.003209171912843e-01   +8.972769597704934e-01   +8.238015346079498e-01   +3.445127028461004e-03   +2.421587865735692e-01   +6.011105245569968e-01   +2.255113862277333e-01   +8.081240333582986e-01; +5.483528341496700e-01   +5.154210702668736e-01   +3.748275370135461e-01   +7.888521190306913e-01   +7.426620005362182e-01   +6.378724063222991e-01   +2.443619961805560e-01   +5.843113428805197e-01   +5.054950447925597e-01   +5.241312142300300e-01   +9.990664306544210e-01   +1.710653793333480e-01; +5.570465031759709e-01   +8.548903474816751e-01   +9.943225256547727e-01   +6.318670577907094e-01   +1.622214877139988e-01   +7.513698607337964e-01   +2.808273625931500e-01   +9.550451924039945e-01   +2.291081082772685e-01   +1.689122398041466e-01   +3.166322775525046e-01   +1.172525926320094e-01; +1.231576143346312e-01   +8.450368745523539e-01   +3.527571891329636e-01   +3.813324242086691e-03   +1.428323066337951e-01   +3.683192143548020e-02   +7.075056522102540e-01   +3.441346210062403e-01   +7.413638354655862e-01   +7.814914977151112e-01   +2.169176742378001e-01   +7.026303247735946e-01];
L3E_L3I_iGABA_netcon = [+3.621967843488211e-01   +5.135114520999401e-01   +3.402258020351713e-01   +4.118476587698836e-01   +9.699987452329984e-01   +6.902144767858819e-01   +5.585493307645508e-01   +6.690199446174750e-01   +6.804263896597607e-03   +6.612660384760259e-01   +7.732636910658355e-01   +4.543442816600048e-01; +6.695648150114344e-01   +8.546254287909465e-01   +3.847619187220411e-01   +8.251813229748310e-01   +8.766456782306209e-01   +5.545078748849114e-01   +8.026345478245864e-01   +3.477703599637139e-01   +6.294025502839243e-01   +9.379720720087100e-01   +4.073915431565266e-01   +9.784374883466512e-01; +5.951052776472237e-01   +3.362205868843717e-01   +3.568432039861961e-01   +6.980096424305851e-01   +9.585401062848824e-01   +7.331745034532267e-03   +4.820444391232944e-01   +4.940060049464420e-01   +4.053208652056102e-01   +9.527576859508549e-01   +5.830809399431187e-01   +1.860988528897641e-01; +1.851619299099387e-01   +3.454760860940920e-02   +1.565137166978858e-01   +9.279562812247719e-01   +1.194556954310777e-01   +3.526055939575644e-01   +6.048901101323340e-01   +1.991844847659463e-03   +7.031253561738166e-01   +1.945041668970883e-01   +4.012915366611003e-01   +3.781410220127653e-01; +8.078556878110510e-02   +8.102364234262784e-01   +6.876598650295924e-01   +4.631386825977452e-01   +4.913476379760665e-01   +4.792955232419571e-01   +3.938175846642680e-01   +4.052105598452191e-01   +1.781469852922540e-01   +9.963597148516510e-01   +8.712539403007139e-01   +1.897405214270994e-01; +4.056362735997542e-01   +5.171967844391122e-01   +3.904592152998754e-01   +2.990694670392019e-01   +9.772949079727072e-01   +3.406138249280440e-01   +4.725663198048553e-01   +5.275237053921483e-01   +6.751500945230279e-01   +3.222599408686929e-01   +3.540390737794473e-01   +4.828878192342956e-01; +6.310520529414498e-04   +8.857628053241501e-01   +6.736233315868883e-01   +5.598679588543277e-01   +8.408074449149987e-01   +7.291544052828843e-01   +6.513034688103589e-01   +8.994888166057220e-01   +6.691075496105456e-01   +7.279761193646490e-01   +4.140236359280126e-01   +8.977722859219985e-01; +3.464580419009209e-01   +7.504970651098980e-01   +4.853848478099779e-01   +6.258355421753361e-01   +5.676791682742155e-03   +2.346634317818019e-01   +1.284218696311549e-01   +8.587098712005341e-01   +9.543222910960850e-01   +1.187099222731313e-01   +3.520810685071355e-01   +1.192392286509967e-01; +5.620319323769885e-02   +4.237064748561965e-01   +2.315814223891379e-01   +5.997112243457311e-01   +3.108929843025939e-01   +9.904205328391353e-01   +9.176485102872971e-01   +6.738548653502030e-01   +1.586798146549684e-01   +5.639575269036615e-01   +4.777817880430747e-01   +7.840977046038941e-01; +9.783206215595998e-01   +6.389404645966192e-01   +5.348678325613636e-01   +7.049498530573138e-01   +4.314286998024255e-01   +6.258015768411503e-01   +1.370810884647276e-01   +1.318844423221079e-01   +8.781764987628770e-01   +1.141747956387967e-01   +5.722539267613260e-01   +9.665729311232573e-01; +4.626314997720438e-02   +4.790666563134369e-01   +7.691552655808105e-01   +2.201508904970622e-01   +9.679941766431869e-01   +6.449398099288473e-01   +8.739388509967116e-02   +1.411937675868715e-01   +1.078570202046492e-03   +9.855164224431396e-01   +5.569798369155394e-01   +3.922263373211227e-01; +5.399982969484118e-01   +9.161735852295899e-01   +1.979386580366823e-01   +9.315286346311751e-01   +5.686754611887929e-01   +1.860195824642596e-02   +4.776975651856630e-01   +9.482664206937950e-01   +7.975666558895921e-01   +9.246463996801220e-01   +1.777325997801615e-02   +6.860395639916201e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last =  5.6 * ones(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  5.6 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = -10*((exp(-10*((t)-( 50))^2)));
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = -10*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
