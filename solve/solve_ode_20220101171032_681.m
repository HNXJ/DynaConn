function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.499679574493102e-01   +2.591402938711264e-01   +1.945626799151487e-01   +7.143102101594320e-02   +3.621703343592751e-02   +1.555921346116443e-01   +6.015329240362446e-01   +5.979675876948365e-01   +5.402942543761128e-01   +5.990071263993740e-01   +1.825377764733359e-01   +4.386905917443671e-01   +3.500638804226995e-01   +2.651629368230479e-02   +5.369424645272531e-01   +1.033747830117550e-01; +4.452100943877400e-01   +5.103037323963753e-01   +2.514149095017127e-01   +2.865159941032059e-01   +5.916830242030843e-01   +6.017732586044645e-01   +2.659083831055256e-01   +1.842561179697114e-01   +5.609875038167629e-01   +5.457960914743009e-01   +3.197152439096834e-02   +1.798310355341756e-01   +4.834344275486623e-01   +6.411073844663959e-01   +2.343755200911679e-01   +6.163851825299614e-01; +1.817547212221460e-01   +4.467755123821520e-01   +7.105235610561439e-02   +6.326320983077942e-01   +3.199142022546188e-01   +3.217726356192980e-01   +5.181210515830922e-01   +5.943442426490356e-01   +4.702853904271536e-01   +1.020236141273753e-01   +9.039939886196981e-02   +2.552480924561726e-01   +3.790637483823935e-01   +3.402075372089067e-01   +4.946772750922168e-01   +2.685390862576997e-01; +3.664490387739356e-01   +3.234806290346961e-01   +4.149485954929843e-01   +3.649232998676942e-01   +4.838304035392382e-01   +2.971815348128110e-01   +5.511300856897871e-01   +3.342429250672371e-01   +3.766292366919152e-01   +3.886035150470410e-01   +6.201060667470786e-01   +4.443845795226984e-01   +7.751514596775148e-02   +5.824437156295570e-01   +3.070682985126110e-01   +2.137599109960926e-01; +5.956483021037102e-01   +3.711130607433420e-01   +3.612495593435612e-01   +3.630594242358791e-01   +4.076076545923136e-01   +3.834428809804327e-02   +6.006839146462171e-01   +3.224181761580616e-01   +2.011565099556920e-01   +5.542666097213272e-01   +2.660924763439666e-02   +5.357791490215416e-01   +1.956504985399685e-01   +6.212910659998955e-01   +1.157800508891066e-01   +5.114255037293076e-01; +5.498059795993565e-01   +1.422138756577303e-01   +3.906321762568234e-01   +3.081689111925437e-01   +4.476758610948702e-01   +1.084858541336921e-01   +3.379341455165454e-02   +1.563055143021803e-01   +5.645362883675722e-01   +4.187872024069464e-01   +1.388614676438406e-01   +6.258750528092077e-01   +2.252602837170427e-01   +5.766464828730402e-01   +1.832819607503295e-02   +1.769864135245552e-01; +1.535807825864944e-01   +4.056411356392586e-01   +5.202746155718844e-01   +2.391338902841635e-01   +4.617140516014304e-01   +4.275686374086718e-01   +3.834191116721106e-01   +2.610270033464527e-02   +5.071608770471937e-02   +2.828491891798057e-01   +3.428041744664957e-01   +5.120390142241323e-01   +4.524569010250193e-01   +6.079436609157427e-01   +2.552464883475983e-01   +5.324915128754791e-01; +1.974587775467256e-01   +3.654268120432694e-01   +1.826310702155688e-02   +5.875621686917141e-01   +2.301326851860687e-01   +4.765423693773839e-02   +4.656372603156879e-01   +5.494264483225545e-01   +2.044936168200464e-01   +1.179398824191631e-01   +1.469399616266232e-01   +6.351803688296463e-01   +5.220594846070761e-01   +9.738992034494404e-02   +2.587289619921785e-01   +1.403190446630848e-01; +4.813385515403664e-01   +3.607833907503584e-01   +4.301137450470629e-01   +3.158906888843288e-01   +3.760673853251770e-01   +5.918683913590969e-01   +8.793462135363839e-02   +5.020757267006341e-01   +3.121134177383068e-01   +1.752864028708153e-01   +4.648059979987221e-01   +5.956646280898859e-01   +1.893871822420364e-01   +2.549684333806403e-01   +6.284143557061269e-01   +5.842479004627145e-01; +5.108657444941220e-01   +1.674105200610330e-01   +8.973186951759789e-02   +1.146608229386724e-01   +1.091129288515358e-01   +7.098928208071530e-02   +2.556126733997399e-02   +5.766012328090229e-02   +2.247144685233390e-01   +4.634250965755237e-01   +2.248114164457138e-01   +3.114881014758833e-03   +3.966018107192217e-01   +4.369350626142633e-01   +7.940226603262220e-02   +8.367145004097909e-02; +6.244545836278129e-01   +6.154295951288458e-01   +4.436340866440631e-02   +3.262503867551364e-01   +3.854597508159588e-01   +1.590752337429523e-01   +5.168975421308970e-01   +5.111265829656751e-01   +2.493091447946171e-01   +4.064446049649479e-01   +5.553236070211214e-01   +5.529924375806800e-01   +7.977278192821836e-02   +3.702916328196191e-01   +2.356319265960650e-01   +3.070842358051330e-02; +5.404437934965011e-01   +6.210832864969118e-01   +3.000129796860448e-01   +2.840019287189605e-01   +6.873428934792748e-03   +2.916812974130140e-01   +5.633727801839690e-01   +4.501408876980945e-01   +5.251626606109261e-01   +2.647514721352006e-01   +4.902347143930141e-01   +3.790777007267313e-01   +4.073061891343234e-01   +2.807647093346155e-01   +5.066112130395424e-01   +5.227476616843998e-01; +5.495719830250572e-01   +1.570822523326039e-01   +2.410457760881842e-01   +2.301013939516661e-01   +5.845819011156416e-01   +2.052511174518030e-01   +4.901307019630300e-01   +4.077001142565526e-01   +3.391929305659409e-01   +4.503827619559708e-01   +3.331913922381275e-01   +3.170533636382072e-01   +4.984080984065025e-01   +1.155786199140631e-01   +5.367356177324117e-01   +1.977518567495529e-02; +1.812830062427096e-01   +1.554656147337020e-02   +2.691447124378930e-01   +2.656338257828017e-02   +5.710806160227652e-01   +3.958913492783551e-01   +4.934810756911439e-01   +4.071691661321232e-01   +4.441836371612206e-01   +6.034411994264650e-01   +3.627410629769949e-01   +7.948325596258510e-02   +1.101646086182507e-01   +5.952464873285569e-01   +2.894798740019571e-01   +1.909073759126248e-02; +1.772523022568864e-01   +4.478129650103983e-01   +1.958024400592341e-01   +1.655545168879781e-01   +4.974302403831035e-01   +3.092864241725507e-01   +3.618704477465356e-01   +1.057137976948151e-01   +1.400301083508682e-02   +5.610373230260607e-01   +4.790433297395767e-01   +5.623029416954399e-01   +7.151304632664611e-02   +1.379851325610099e-01   +5.711387985982797e-01   +3.451892521600646e-01; +4.361890138175806e-01   +2.660268446679338e-01   +1.491665820574185e-02   +6.341727116929381e-01   +4.777850972760096e-01   +3.505682187708760e-01   +2.326104481388462e-01   +6.117798321713765e-01   +4.080468667215452e-01   +5.568253174787561e-01   +4.493003602695719e-01   +9.670657121781678e-02   +5.554023707999256e-01   +5.492339983814388e-01   +4.376338154187275e-01   +1.697394233047340e-01];
L1E_L1I_iGABA_netcon = [+4.584409640414462e-01   +6.327366703193780e-01   +4.891207914731580e-01   +2.931434202078369e-01   +4.819670783762657e-01   +2.254317975596305e-02   +6.072950932369130e-01   +5.972561107597322e-01   +5.619763229204600e-01   +1.216220705066492e-02   +9.234192989096305e-03   +2.663197954496881e-01   +1.913824138845930e-01   +3.260571952096212e-01   +2.229668817142744e-01   +2.929811989871498e-01; +3.004168226799334e-01   +6.286496246238792e-01   +2.665552306285900e-01   +3.235194934460887e-01   +1.835176784282934e-01   +5.280002611053346e-01   +3.626702913451939e-01   +6.213595643413709e-01   -1.360858309977608e-03   +3.493414182989008e-01   +2.446650959595677e-01   +1.743969862545297e-01   +6.324356909964678e-02   +2.121133042952185e-01   +2.625467362714167e-01   +5.531679280827575e-01; +5.351000407298555e-01   +5.591026087461692e-01   +6.196232668076863e-01   +5.174433232234049e-01   +1.064922801081073e-01   +5.116671433104399e-01   +2.313657267812729e-01   +2.377200179955018e-01   +2.209255668433380e-01   +5.208357143844128e-01   +2.768974467766737e-01   +3.446820249883916e-01   +5.291785142997952e-01   +4.102698150189327e-01   +1.470658416246095e-01   +5.106636646409323e-01; +7.689208297744174e-02   +4.421021494773613e-01   +2.208514871725615e-01   +3.746574578551997e-01   +6.146221939460327e-01   +2.585311867900924e-01   +2.479697669985690e-01   +5.005444472212170e-01   +4.638701573120952e-01   +4.531494735177937e-01   +3.682528768169292e-01   +6.236305849472566e-01   +2.253452308226503e-01   +4.555012899731778e-01   +6.300177252877585e-01   +4.975334372269650e-01; +2.590614253008325e-01   +3.020755104512786e-01   +3.514456855696010e-01   +6.063309792693156e-01   +2.546769913317586e-01   +2.424550627465039e-01   +3.622363762782438e-01   +6.263912561564399e-01   +2.009967657025444e-01   +2.290719408256497e-02   +5.838997648381201e-01   +2.558657980121063e-01   +5.183963551812359e-01   +5.606208352624484e-01   +3.844337827342092e-01   +8.836816027297277e-02; +6.278535966329977e-01   +3.719184896139786e-01   +6.482928314720539e-02   +2.066632831650539e-01   +2.911269196909244e-01   +1.517815223116191e-01   +3.456218745196769e-02   +1.568815451379615e-01   +4.587394299576494e-01   +5.901145107316118e-01   +2.693682257329386e-01   +3.182266633248364e-02   +4.047968310037539e-01   +3.521473837443507e-01   +1.310202719420747e-01   +4.794042198169576e-01; +5.285837658835045e-02   +1.349915802096585e-01   +4.323796462061431e-01   +1.549428921614131e-01   +3.291150128946255e-01   +1.272226889330701e-01   +2.202160432471081e-01   +6.970357728578684e-02   +2.268708247218101e-01   +5.130801548354896e-01   +4.753478067126509e-01   +2.228691112966801e-01   +3.093165968988435e-02   +1.426771827006427e-01   +3.864302265357361e-01   +2.998456756182157e-01; +5.675664979980076e-01   +1.068658924888007e-01   +1.795421239130978e-01   +4.222177277067516e-01   +3.987317897680089e-01   +2.496448506800653e-01   +1.429419705167547e-01   +2.142605611178411e-01   +3.819629212759887e-02   +7.380680636182577e-02   +1.306041441106981e-01   +5.942614794140200e-01   +9.269124391708983e-02   +2.039426871519931e-01   +4.305305720819265e-01   +5.586606720601723e-01; +1.047392797040804e-01   +2.695273355210940e-01   +1.656515226006789e-01   +2.381425331726892e-01   +1.447930330799003e-02   +2.285434930517445e-02   +1.438239488561683e-01   +1.522611470571586e-01   +4.184028717018486e-01   +1.196847549660822e-01   +1.053223043032303e-01   +5.242112286883870e-01   +4.094910033332795e-01   +1.341136036709775e-01   +5.329613117268789e-01   +5.769497522583242e-01; +1.435849762497810e-01   +3.907197883802954e-01   +6.003633456583413e-02   +3.054800680463264e-01   +1.953376298019838e-01   +3.509281104306805e-01   +5.879108355112944e-01   +9.154140762329761e-02   +5.785403345675355e-01   +3.006599796611126e-01   +4.626441654579780e-01   +5.511487058642426e-01   +3.679868963303950e-02   +4.160093310009379e-01   +2.553541087122879e-01   +5.556973640315227e-01; +6.136634960287027e-01   +4.929667624550652e-01   +5.798425362081151e-01   +2.234034696219550e-01   +1.862725398252639e-01   +3.569636539391106e-01   +2.089697476943113e-01   +4.142733679469016e-01   +4.708447204209104e-01   +5.283458335176597e-02   +4.135272366347690e-02   +4.252882184198829e-01   +3.126262026483365e-01   +5.205281150267627e-01   +2.410589706571738e-01   +4.462728176983588e-02; +5.710568930682655e-01   +2.349515797766915e-01   +6.282113514914152e-01   +2.225594600233713e-01   +1.901040088324915e-01   +5.095344272498449e-01   +2.957786630879248e-02   +5.096703756458110e-01   +1.126289288123947e-01   +4.983221354041663e-01   +5.424135893121536e-01   +1.402930273930194e-01   +3.402319553350974e-01   +3.021999823824860e-01   +5.992758557537758e-01   +2.436054563288229e-01; +2.082680919231052e-02   +1.719851853860052e-01   +2.116616098877692e-01   +1.304892166274682e-01   +4.634452710858040e-01   +2.750447087870988e-01   +5.384537649428685e-03   +3.389654119481337e-01   +4.110099120473829e-01   +2.824056905620574e-01   +6.224607191957929e-01   +2.566439935986827e-01   +6.631401165612639e-04   +4.668127059904523e-01   +7.310200848151384e-02   +5.391284666305303e-01; +3.869660628157544e-02   +5.251227607959774e-01   +3.961144375927301e-01   +1.449893771113965e-01   +4.119042172106055e-01   +4.046209149027980e-01   +4.953662188336138e-01   +1.113332852082608e-01   +5.528964141133569e-01   +5.695977560901877e-01   +2.414641122340817e-01   +7.440289036059174e-02   +6.126135328863466e-01   +6.234177295588880e-01   +2.004701861166762e-01   +5.270068365756355e-01; +1.774591892921223e-02   +4.266554380283811e-01   +6.067675476157051e-02   +2.135801407367775e-01   +1.184556395154322e-01   +5.085906155267298e-01   +5.273155468578764e-01   +5.386232296717824e-01   +3.562103200668243e-01   +3.617680746419317e-01   +2.994996345451408e-01   +3.370231891030713e-01   +3.754399518861735e-01   +1.419027119325490e-01   +2.611330653701729e-01   +2.022350046094137e-01; +2.630002596909984e-02   +3.781717208238711e-01   +2.133089524714278e-01   +2.441736548061145e-01   +5.918419487525436e-01   +5.592859282206193e-01   +1.360472581992191e-01   +5.850579023498157e-01   +5.086452397569071e-01   +1.207654289739923e-01   +2.012968844444445e-01   +5.176467903333076e-01   +6.255235683608524e-01   +5.513149750814990e-01   +3.246546007031587e-01   +3.499987241101454e-01];
L2I_L1I_iGABA_netcon = [-1.617662110835360e-03   +4.300445163045157e-01   +5.128752564486274e-02   +5.625574319581665e-01   +3.314680270882135e-01   +4.989309032427759e-01   +2.715208646987556e-01   +8.749093443980203e-02; +1.999667624782721e-01   +3.321564079642386e-02   +4.616613601585368e-01   +1.296067332691095e-01   +1.297088079434351e-01   +1.423692913461389e-01   +5.439651012383923e-01   +3.171297510961413e-01; +4.357930705344634e-01   +2.518925853656999e-01   +2.844965089491786e-01   +3.733489104126034e-01   +5.878638629777434e-02   +6.241390756743934e-01   +1.627227435268643e-01   +1.534202447493612e-02; +5.012561974744691e-01   +5.841316433637084e-01   +3.880397454963748e-01   +4.106775631161418e-01   +4.248264727071727e-01   +1.383513196696067e-01   +5.965237147951520e-01   +5.079532121743696e-01; +3.902894155204079e-01   +8.523100526020314e-02   +1.546534630844824e-01   +5.590837868633234e-01   +2.442417259042161e-02   +5.427783404936122e-01   +1.714955041881586e-01   +3.053627628980844e-01; +3.905439187149768e-01   +4.428207368075650e-02   +5.518060941964656e-01   +2.639113983276934e-01   +4.751804199934475e-01   +5.385552669460049e-01   +6.378635241399442e-01   +1.469063401748306e-01; +5.055077423673487e-01   +1.987725997570829e-01   +6.135613708788522e-01   +3.901245515933894e-01   +7.781580776317368e-02   +2.390025589566261e-01   +1.419694902021436e-01   +5.791161603040359e-01; +1.015152577248180e-01   +5.148957680731171e-01   +1.199584307782677e-02   +5.310276694238618e-01   +6.323867908812255e-01   +1.585904916543263e-01   +3.306969353234720e-01   +1.920929809508355e-01; +4.313964992397298e-01   +4.258569956590953e-01   +2.062341854943827e-01   +4.447531848021454e-01   +4.143253743146331e-01   +1.680783496835748e-01   +2.610275536762687e-01   +1.834117925391014e-01; +3.452865639363217e-01   +2.052005087139087e-01   +2.730396480656254e-01   +4.373545515068745e-01   +8.416344939558847e-02   +4.789121377450157e-01   +3.045204436459749e-01   +3.857870387464993e-01; +3.055880384281767e-01   +3.911733393406175e-01   +3.178879168354073e-02   +1.634680981574156e-02   +2.955018326897181e-01   +1.469260252662204e-01   +1.875502719458459e-01   +3.160475372313318e-01; +1.475449314369082e-01   +3.990343595780806e-01   +8.342150328349793e-02   +2.337639895188722e-01   +8.902307102528018e-02   +3.626974133351175e-01   +2.555802837173545e-01   +4.078946627035381e-01; +4.800353915170143e-01   +3.668267838862096e-01   +1.434239191130691e-01   +3.303454438987589e-01   +1.783797602844357e-02   +4.005435400995820e-01   +1.220081892560454e-01   +5.956081498255641e-01; +3.306940206500727e-01   +3.261566863994524e-01   +9.773661168044311e-02   +6.238438788756320e-01   +2.725349772176588e-01   +6.349338226827265e-01   +5.466345627701253e-02   +3.745220940227593e-01; +1.675326071473882e-01   +3.058930829691589e-01   +6.112528385290248e-02   +3.780360342393196e-01   +1.005912028515174e-01   +2.373441440729251e-01   +6.024654514395638e-02   +1.383377993031618e-01; +9.301900155287703e-02   +3.704725605903448e-01   +4.166699285551300e-01   +5.327719170937871e-01   +1.084613381561832e-01   +5.908318879194953e-01   +6.144409281303974e-01   -7.658143409215260e-03];
L1I_L2I_iGABA_netcon = [+3.562141838519578e-01   +1.779037482745005e-01   +2.716258976517675e-01   +1.862589279476196e-01   +9.006775615646820e-02   +4.752194360262674e-01   +3.047721215199035e-01   +5.333877291792039e-01   +2.139772797499761e-01   +4.559647293672081e-01   +4.606267470385055e-01   +5.668302247472582e-01   +2.845405049620780e-01   +5.225288255549049e-01   +4.056373936748520e-01   +2.843329094085117e-01; +2.322980371851795e-02   +9.197261872792718e-02   +1.748385118414955e-01   +1.792940968675703e-02   +5.933253567935284e-01   +4.269411394597177e-01   +4.637019260749294e-01   +4.337633458407774e-01   +4.183343262307351e-01   +2.471729922542806e-01   +1.909751617909088e-02   +2.626734111707262e-01   +3.773788575821163e-01   +4.053942867248756e-03   +4.550153801242258e-02   +4.080125324336951e-01; +8.766902879224213e-02   +6.607632930405187e-02   +1.390006190179189e-02   +1.556954708336768e-02   +6.283826743585789e-01   +4.406701192792854e-01   +5.987786886874161e-01   +5.514866990658747e-01   +1.844504183964853e-01   +1.810304686731229e-01   +1.250168128040720e-01   +1.326011197590806e-01   +5.561641120208390e-01   +1.438148609489543e-01   +1.756499621713715e-01   +5.055919019222677e-02; +3.322221314752160e-01   +5.259488932973397e-01   +3.281222951789801e-01   +2.210674956693912e-01   +1.922575043024815e-01   +3.544470588967696e-01   +2.831303087256413e-01   +4.825591522755573e-02   +1.649300791092499e-01   +3.555635044880507e-01   +5.806476858956860e-01   +5.825003319538442e-01   +6.318040486080469e-02   +8.213352546189530e-02   +2.193246886748203e-01   +3.735088556852161e-01; +2.725897896302737e-01   +1.765677762858356e-01   +6.423588768919845e-02   +5.640961350103878e-01   +3.597158371843041e-01   +5.481970728400249e-01   +8.606814791224024e-02   +3.441476354471247e-01   +6.045020319654070e-01   +3.624687891450787e-01   +5.640958495329651e-01   +1.788891361246714e-01   +1.021459634567084e-01   +6.287379556238051e-01   +5.277615033132597e-01   +6.216633279691037e-01; +2.131494900206366e-01   +4.542481275148413e-01   +2.056181785037504e-01   +4.953584332305098e-01   +2.673031123238124e-01   +4.741331648751941e-01   +5.237141681246547e-01   +4.317978181401360e-01   +2.538364336876436e-01   +5.805720404338172e-02   +3.502718729720571e-01   +5.681072649458492e-01   +1.828477536165679e-01   +3.971190305975221e-01   +5.880352831827373e-01   +2.224844132282718e-01; +6.073509635515425e-01   +5.402165454087667e-02   +2.991820159468661e-02   +1.533680916169301e-01   +6.271130680313355e-01   +3.907244582686911e-01   +6.042168084214298e-01   +2.644409874062009e-01   +5.933389292034149e-01   +1.592257869857132e-01   +6.260520672592474e-01   +3.404999409861981e-01   +2.756937366141770e-01   +3.551024175337915e-01   +1.518486357504113e-01   +4.999386143484031e-01; +4.913250251400237e-01   +4.233070509268450e-01   +1.732857440723419e-01   +1.892304935466586e-01   +5.280292243124175e-01   +2.388669048079408e-01   +2.135751164495613e-02   +1.040678039838078e-01   +2.358329032334544e-01   +2.015597120325051e-01   +6.570417449640222e-02   +5.763731696974119e-01   +2.873594747314393e-02   +1.318360721224699e-01   +6.079430554427971e-01   +6.296267630257548e-01];
L2E_L1E_iAMPA_netcon = [+5.907836645392673e-01   +2.435036280554259e-01   +4.421259040528296e-01   +3.594878002405328e-01   +6.638319680180498e-02   +2.110247011385287e-01   +5.624017851167912e-01   +4.075702345451217e-02; +2.130865065897900e-01   +2.005409486858535e-01   +5.246337555729624e-01   +1.377366751661054e-01   +4.610642817623757e-01   +3.396791574036588e-02   +2.009608450770059e-01   +4.466940628834550e-01; +2.001073882765743e-01   +9.509415381570367e-02   +4.807684652617675e-01   +4.225774656084462e-01   +3.114528187508785e-01   -6.517207976940501e-03   +1.466459852278848e-01   +2.276228375441506e-01; +3.818951806632536e-01   +1.185694988212357e-01   +1.755208253570417e-01   +6.074404190426211e-01   +3.337646577995946e-01   +1.508076741317929e-01   +4.007956076964440e-01   +1.884128541116115e-02; +1.183817243465815e-01   +3.197822982262581e-01   +4.403992425040960e-02   +1.506928369196493e-02   +1.723373012145230e-01   +3.398263888914336e-01   +1.596220809316509e-01   +1.536053389740859e-01; +1.613655907895746e-01   +3.426784541538759e-01   +1.000203977362478e-01   +2.892895298646574e-01   +5.690380222203658e-01   +6.159201346239546e-01   +4.180101786067094e-03   +5.312534804596786e-01; +2.671978824526860e-01   +2.563453207601779e-01   +6.121420348399121e-01   +2.394386304033105e-01   +1.585158481314923e-01   +8.539665985234275e-02   +2.786806425356182e-01   +3.157486150233396e-01; +1.208479266574490e-01   +1.422419491440192e-02   +4.539455943610870e-01   +4.341066254564344e-01   +1.873308440088037e-01   +3.260676656986272e-01   +5.244666655555689e-01   +5.010994825373338e-01; +1.708699937043802e-01   +5.359450668689136e-01   +3.760255861994910e-02   +5.327525233659636e-01   +4.331230375109553e-01   +1.789893550405552e-01   +1.761586170443217e-01   +2.124091395896054e-01; +7.459151013870198e-02   +5.661006726412863e-01   +4.756300006485622e-01   +5.061256547518468e-01   +2.747795512912693e-01   +6.274307966471876e-01   +6.102707775872406e-01   +4.242239580051064e-01; +5.107893758341795e-01   +2.276249896735702e-01   +3.448569513085453e-01   +9.061772856115413e-02   +3.083411275015180e-01   +4.756397723038816e-01   +1.934284740940204e-01   +1.451698943468328e-01; +3.939888593473039e-01   +6.133711095442945e-01   +2.405525894637603e-01   +5.443145558073583e-01   +6.210543126517447e-01   +4.983280369912079e-01   +3.050522262232969e-01   +6.138860357140165e-01; +3.268076396048360e-01   +3.580216849245694e-01   +1.366095981119745e-01   +5.590663547171481e-01   +6.312091854208046e-02   +1.479519168581518e-02   +1.624266342417204e-01   +2.173705056430771e-01; +2.732959101101680e-01   +3.504962673277759e-01   +5.803799708884021e-01   +2.516600137498200e-01   +3.174770442030371e-01   +3.910588889610563e-01   +5.571193543172366e-01   +3.254443073093677e-01; +5.065598213824589e-01   +1.602206378509133e-01   +2.578962458091606e-01   +1.349583427616217e-01   +1.535650422894320e-01   +4.980483005352602e-01   +5.994831652798309e-01   +4.060229657273745e-01; +3.835064146597304e-01   +1.034828291040150e-02   +1.814891086110648e-01   +4.901874295705824e-01   +2.923034063865707e-01   +4.974399492763724e-02   +3.321254343316921e-01   +4.793876074141641e-01];
L1E_L2E_iAMPA_netcon = [+8.958214081138109e-02   +2.330814860109851e-01   +4.871297909710235e-01   +4.811916220351960e-01   +2.432781627404026e-01   +3.844170304652550e-01   +3.528979274230987e-01   +5.900879243669747e-01   +5.089478916633525e-01   +3.118964230712645e-01   +1.934665739837725e-01   +6.128220483914090e-01   +2.908697546072203e-01   +1.776903967236452e-01   +3.499575474333762e-01   +1.177174587444257e-02; +4.812745813706480e-01   +4.151351071236019e-01   +6.085994207671440e-01   +1.351290342329664e-01   +2.754758602821516e-01   +4.465412333440969e-01   +4.364758792623100e-01   +2.256709860230188e-02   +1.674215972762776e-01   +1.916304070785921e-01   +4.680278806861874e-01   +3.215766408023238e-02   +5.180094647744433e-01   +3.096156400603230e-01   +1.781964065105528e-01   +4.996907569548937e-01; +2.252031706266847e-01   +2.536801253613665e-01   +1.511687589579788e-01   +6.330536315400227e-01   +3.749592635085342e-01   +3.624009693680769e-01   +5.287490276198934e-01   +1.793485442422608e-01   -2.374544073428501e-03   +1.376581686407340e-01   +1.159995060330200e-01   +3.729194053044799e-01   +5.886281463372235e-01   +1.151531235218406e-01   +2.111774836722228e-01   +3.358988244427571e-01; +9.774145210340948e-02   +2.200848195665864e-01   +5.599188461919934e-03   +3.040950386207309e-01   +4.979770017896392e-01   +5.147263210230621e-01   +3.987382454024556e-02   +1.377066884573770e-01   +5.568953119095648e-01   +2.739955256247049e-01   +5.156019323328253e-01   +2.092544482633209e-01   +6.346927845700202e-01   +1.830868251337754e-01   +1.223929199307177e-01   +3.454587370949132e-01; +1.364722880463308e-01   +1.097494356254325e-01   +2.340516301502579e-01   +3.165239915536828e-01   +1.880353491474488e-01   +3.791545205011949e-01   +3.926703889237517e-01   +2.704567651491048e-01   +1.820260292731404e-01   +4.437316363081258e-01   +2.012285382515399e-01   +3.684517301939710e-01   +9.917262432174226e-02   +2.372711267644458e-01   +5.739565552058570e-01   +3.043477938911909e-02; +3.069432499073865e-01   +3.408217761652048e-01   +4.612669466218206e-02   +3.138321542671843e-01   +1.328420295356748e-02   +2.400017826381501e-01   +4.053549899276311e-01   +4.372771983023791e-01   +1.798718917048869e-01   +5.139051175533708e-01   +5.574102945631182e-01   +1.922755892581493e-01   +1.096287970591940e-01   +3.377944189423440e-01   +3.899074777980391e-02   +3.831183770024172e-01; +4.383127601989836e-01   +1.109209696425731e-01   +3.061307299629140e-01   +4.467927992009514e-01   +1.250128112438056e-01   +5.323353717547201e-01   +5.317760957516550e-01   +6.293514288116814e-02   +5.999223023608670e-01   +5.775591310674603e-01   +3.489900025010289e-01   +2.582641770378084e-01   +1.878252997148046e-01   +2.174547888708086e-01   +4.817224649766091e-01   +2.787700916071596e-01; +7.929998619727174e-02   +2.158749542511522e-01   +7.089182044973627e-02   +1.473989035294260e-01   +5.252934056980021e-01   +1.760591669215551e-01   +1.585489537133655e-01   +4.597453782666948e-01   +5.759707999010620e-01   +4.231194556801671e-01   +1.910497447561106e-01   +5.585243303410736e-01   +1.735408585396475e-01   +6.196221685421968e-02   +5.687938572845398e-01   +4.481513834926433e-01];
L2I_L2E_iAMPA_netcon = [+3.669081138514973e-01   +4.846412195347093e-01   +5.347742122131995e-01   +5.802006923129043e-01   +1.847330614947898e-01   +6.354088957492302e-01   +5.043851907963562e-01   +3.083997669914628e-01; +1.035970763383737e-01   +4.462471060425339e-01   +3.236592130933114e-01   +3.887179225283277e-01   +2.199440563346627e-01   +2.770117614148127e-02   +4.893038277108249e-01   +3.934840148955951e-01; +2.912689728360597e-01   +1.452700173895804e-01   +5.860669212393840e-01   +3.729996250054039e-01   +3.230315455656128e-01   +6.229749254405317e-01   +6.799625108914059e-02   +1.043516767622980e-01; +1.929346411749022e-01   +4.762881766005855e-01   +5.330889653466779e-01   +4.573961437827939e-01   +6.270245396391222e-01   +6.246082195682480e-01   +3.901241323379627e-01   +5.679005744348388e-01; +1.848827289030964e-01   +8.102945977899724e-02   +5.628225590447057e-01   +6.267812532861483e-01   +5.217211451788745e-01   +5.333241698900568e-02   +3.820333285537019e-01   +5.140112505560159e-01; +1.158184098022564e-01   +4.966763326123168e-01   +4.430414789864116e-01   +3.324304862756085e-01   +3.784755658595784e-01   +4.509128395666480e-02   +3.883419717301376e-01   +5.228199468664303e-01; +5.118459790321314e-02   +4.673104697104410e-01   +3.565381566691978e-01   +2.690071320965411e-02   +5.707845782101213e-01   +2.599378454150731e-01   +4.708393732809957e-01   +5.350425859090420e-01; +5.337604606021048e-01   +2.054810120670303e-01   +4.049164426310231e-01   +4.526994206934735e-01   +1.098584941183364e-01   +4.958343817673006e-01   +2.731333684246994e-01   +2.967206258797951e-01];
L2E_L2I_iGABA_netcon = [+1.266367692040785e-01   +4.601963965544482e-01   +6.013902987984258e-01   +4.707320534437260e-01   +6.195852025205399e-01   +4.897656792827473e-01   +5.954020105542049e-01   +2.553433431339023e-02; +6.238311471639804e-01   +5.354090871173544e-01   +3.061424549677897e-01   +4.891298674081099e-01   +6.323902636511545e-03   +5.597011253073138e-01   +1.320628098908972e-01   +1.266573315521010e-01; +1.994740635547868e-01   +1.799982201740696e-01   +4.376569791204432e-01   +2.144547738768030e-01   +6.315081722821856e-01   +1.382108349135056e-01   +1.009740447629688e-01   +1.300451773628915e-01; +4.637953642896130e-01   +4.134777456926521e-01   +9.675879322604414e-02   +3.919095111231637e-01   +8.715444234902611e-02   +3.179422530969563e-01   +5.226906753039312e-01   +3.286468967395544e-01; +4.417201884957986e-01   +3.527954498195672e-01   +4.972984394338364e-01   +3.317353799446464e-01   +9.724060734676522e-02   +3.807202578170306e-01   +6.220076495131248e-01   +2.835783824858870e-01; +4.226635299462407e-01   +1.778135979879064e-01   +6.243112957301857e-01   +7.410723398920106e-02   +4.081786924205394e-01   +2.601188089330113e-01   +5.276313356913764e-01   +4.962915555373446e-01; +6.152679822488644e-01   +4.135801937594049e-02   +3.605442747310957e-01   +2.048439417209848e-01   +1.594393569787733e-01   +6.184337838330557e-01   +5.194160993129249e-01   +1.762146660441571e-01; +6.163555476844483e-01   +5.665635264402321e-01   +5.320275848225939e-01   +7.539708543050594e-02   +6.079760830936688e-01   +9.606483337269840e-02   +5.220340169258906e-01   +5.728227695587620e-01];
L3E_L2E_iAMPA_netcon = [+4.384394895947354e-01   +3.935586812630414e-02   +3.512822667741560e-01   +9.674219658400660e-02   +6.900821717949665e-03   +8.099667772264547e-02   +1.848710109856048e-01   +5.444966295122579e-01   +2.377400277645069e-01   +2.577164962170456e-02   +2.298894084575595e-01   +5.986079727948179e-01; +5.034722527415485e-01   +5.119489645758691e-01   +1.650311493527994e-02   +3.381016393674760e-01   +5.121236903668673e-01   +4.636806001259572e-01   +4.307502104669862e-01   +3.304789569759970e-01   +5.142864153116644e-01   +5.387692360335091e-02   +3.163776789723158e-01   +1.571658828275341e-01; +4.161248102144169e-01   +3.010347976777056e-01   +5.648009839853679e-01   +3.996991144847385e-01   +4.263889281760641e-01   +7.333798457844388e-02   +2.450182759946455e-01   +3.466783563448464e-01   +1.460641197499185e-01   +3.509149691329526e-01   +3.421156389364225e-01   +6.126700677683010e-01; +1.266404851646588e-01   +3.080403356757698e-03   +4.962985242004046e-01   +2.914492738133557e-01   +3.792999549152361e-01   +1.952448259862360e-01   +3.533168916109575e-01   +3.476346393881903e-01   +1.089913797833580e-01   +5.889260898675986e-01   +2.892249961167855e-01   +1.350499683771935e-01; +3.667156158336056e-01   +3.055907042958379e-01   +1.869824996711812e-01   +2.827155465199475e-01   +5.368099324944064e-01   +3.984660541264347e-01   +5.275913726440956e-01   +4.930540213821321e-01   +1.541885771320681e-01   +5.760482869855584e-01   +3.062351263922858e-01   +4.821330464182947e-01; +3.937924261020430e-01   +5.788409513302454e-01   +5.819734164799608e-01   +1.196949932219212e-01   +3.575700925755939e-01   +2.613062895313903e-01   +1.165803493215949e-01   +1.061710438025775e-01   +4.043554809381226e-01   +1.014035678640143e-01   +1.045150471081306e-01   +3.241505199314771e-01; +5.866442321685917e-01   +3.316447294578688e-01   +5.997292414934442e-01   +4.962215859716075e-01   +1.970169845382073e-01   +4.164854127653095e-01   +3.806517329417753e-01   +1.925461423908954e-01   +3.240532120894821e-01   +4.115430434074405e-02   +5.926501174345877e-01   +5.909925401600694e-01; +3.369297779481594e-01   +5.453707386180131e-01   +5.994099196651430e-01   +6.346650391579601e-01   +2.977167488740748e-02   +4.460639211381719e-01   +5.027070134536001e-01   +9.646877513550342e-02   +6.038479029908839e-01   +5.210622825241387e-01   +6.562159985345302e-02   +1.156180604329001e-01];
L3I_L2I_iGABA_netcon = [+5.049882760622868e-01   +4.293376332228670e-01   +2.813144029667842e-01   +5.579330884972964e-01   +5.056262748278494e-01   +5.926341555005914e-01   +5.121506124829698e-02   +6.339318361081965e-01   +5.474104304973569e-01   +2.855337687732321e-01   +7.650990268809556e-02   +9.884317188620639e-02; +4.422184795036787e-01   +2.841337453954946e-01   +4.226149492978542e-01   +4.173407106691573e-01   +3.962071943790835e-01   +4.111342192751554e-02   +1.523557970064047e-01   +5.790607280516519e-01   +2.460165746625503e-01   +4.274063402169584e-01   +4.749839542848655e-01   +2.028226936711244e-02; +1.253894917086986e-01   +3.232685922277478e-01   +5.284621109141745e-01   +6.142420773046370e-01   +1.894495997438303e-01   +5.488795393761317e-01   +3.751093605463301e-02   +2.520455169915377e-01   +3.087483040896106e-01   +2.140832040674587e-01   +5.389575146052408e-02   +3.145872784050812e-01; +4.754033778354785e-01   +2.449868381694128e-01   +5.888633022965856e-01   +6.383879508854056e-01   +1.100389435971387e-01   +4.492217728686856e-01   +3.841367283541071e-01   +3.887780446297580e-01   +4.022129464976115e-01   +1.982081238393556e-01   +4.103179034130589e-01   +4.800822779746207e-01; +1.412314173173928e-01   +6.004200030355129e-01   +5.314498141938376e-01   +4.168848560219408e-02   +2.586991408554427e-01   +5.043517178942185e-01   +3.670641338592096e-01   +5.925554768745271e-01   +1.511945774496708e-01   +4.195043904145311e-01   +4.757763596532800e-01   +3.497617131520839e-01; +2.053205917988309e-01   +4.930868739937487e-01   +4.276789269619097e-01   +3.978304389943749e-01   +5.369726620800524e-02   +1.830818882134405e-01   +3.544320336305223e-01   +4.781407470666175e-01   +6.218725900623786e-01   +1.564482207044590e-01   +3.403915244159350e-01   +3.833741595472776e-02; +4.345028329956572e-01   +3.667451341878881e-01   +3.464085240712246e-01   +4.582318342925258e-01   +3.599927509199030e-01   +2.154985802507046e-01   +9.235807233858852e-02   +1.376549504493307e-01   +1.593152587318189e-01   +5.693931834557032e-01   +6.007654218400201e-01   +4.665060055575895e-01; +4.145612081368900e-01   +5.468694187804118e-01   +4.797592170003996e-01   +6.252119571766003e-01   +6.342241586238146e-01   +8.079125294648735e-02   +5.522900391852287e-01   +5.486678393243629e-01   +4.275310200115652e-01   +6.234321083809495e-01   +5.058175273645111e-02   +3.259874566649388e-01];
L2E_L3E_iAMPA_netcon = [+2.448310103828912e-01   +5.563929257575070e-01   +2.152249668353179e-01   +5.994882814178624e-01   +3.454004604188017e-01   +4.210611798129514e-01   +4.429805783832418e-01   +2.639151021592041e-01; +2.555449739734454e-02   +1.425181874028933e-01   +4.217868034221638e-01   +2.396555839038644e-01   +2.663919480328917e-01   +3.445156176316959e-01   +5.299019888664667e-01   +5.685100536391263e-01; +5.978869050766366e-01   +2.224459690146779e-01   +5.560636198093713e-03   +3.038162088392118e-01   +3.674063555461087e-01   +5.902835984087444e-01   +3.051515470034519e-01   +3.927691021271007e-01; +9.030666423058135e-04   +5.178955123409398e-01   +2.102281179661194e-01   +6.027940058316971e-01   +5.400331341792707e-01   +5.280281051886104e-01   +1.933261261994569e-01   +4.930329905800646e-01; +3.078013293060207e-01   +1.810349637496216e-01   +1.196284299835142e-01   +4.089722163329973e-01   +4.003544510714084e-01   +5.134720626554785e-02   +9.338523769649801e-02   +3.832555982229406e-01; +4.972494347735966e-01   +1.517645416065693e-01   +7.138511897417353e-02   +1.830547132063401e-01   +6.396630478099173e-01   +5.224734196205180e-01   +1.395962911054034e-01   +2.856476056230753e-02; +4.723729181902779e-01   +3.457769376121449e-01   +3.774040669158634e-01   +3.099067426822583e-02   +2.987699190676448e-01   +5.310221454983628e-01   +6.411076309746229e-01   +2.916705428051803e-02; +2.993885441613117e-01   +4.794529852248737e-01   +4.954621482922342e-01   +1.558255788154191e-01   +3.604809374396597e-01   +3.676340299655076e-01   +3.626284364441912e-01   +4.661862945998737e-01; +1.907841461582046e-01   +2.950652577606043e-01   +3.946640304054494e-01   +5.410592660762500e-02   +4.060164918890709e-01   +1.776999033994184e-01   +2.569037267598863e-01   +5.869049548310300e-01; +1.708998163306005e-01   +4.039684619298218e-01   +3.665973755389265e-01   +2.283000742430200e-01   +1.569382345294461e-01   +3.391256231808446e-01   +4.099855318279164e-01   +2.777391284010119e-01; +2.749253203925144e-01   +1.594224867313941e-01   +5.501312055779169e-01   +5.450264545085495e-01   +2.995068213753463e-01   +2.977771153204226e-01   +6.385592312300649e-01   +2.097341758688957e-01; +1.477423106993003e-01   +2.921450897039305e-01   +3.126541999445152e-01   +5.926282792774923e-01   +1.709601860207486e-01   +3.498585351552052e-01   +2.693114011362051e-01   +2.484572345971886e-01];
L2I_L3I_iGABA_netcon = [+2.610917948470228e-01   +1.072343695440020e-01   +6.355834745274030e-01   +4.163384764028278e-01   +3.682905049589968e-01   +5.176379591577007e-01   +4.173034715204878e-01   +5.341187371431646e-01; +1.436142727560691e-01   +4.697724027336990e-01   +5.938160958161370e-01   +3.691859225018909e-01   +6.180080544497493e-01   +2.958903758831749e-01   +4.110971301805910e-01   +4.779522082690209e-01; +1.828120822253009e-01   +6.542013289111293e-02   +1.928131432029494e-01   +1.346450450395716e-01   +3.061746669143420e-02   +1.622777245162500e-01   +4.631183621339784e-01   +3.173951558219610e-01; +3.438525684995993e-01   +4.782528783315056e-01   +6.297929488969005e-02   +1.815376072688785e-01   +5.215623484028212e-02   +5.856699753753700e-01   +5.281835098929952e-01   +6.225454790336732e-01; +5.205474674795756e-01   +5.218461324701169e-01   +5.588857768911324e-01   +5.319124629355800e-01   +6.142935259088130e-01   +2.325144238718027e-02   +4.565584532090687e-01   +4.809465698004014e-01; +3.017528294067885e-01   +2.884434251250043e-02   +9.688927756417474e-02   +3.043127939683521e-01   +1.790671214081191e-01   +3.017894959954169e-01   +3.608844699197988e-02   +4.957612426272753e-01; +4.485444155198619e-02   +4.120300513356411e-01   +2.084630615222663e-01   +6.258357414309940e-01   +5.516811573715635e-01   +2.847845998789806e-01   +5.104968374500650e-01   +6.101915566621563e-01; +3.141356462889739e-02   +9.980618400019836e-02   +2.964510632416139e-01   +3.189662601770527e-01   +7.893569131845905e-03   +6.046912026223767e-01   +2.932352253809400e-02   +4.797333787378076e-02; +1.882231130274779e-01   +2.764378619401940e-01   +3.455606933972575e-01   +5.097326102176779e-02   +5.553213635083133e-01   +4.011298133505649e-02   +3.110951609134646e-01   +2.493720164502639e-01; +4.020072666703233e-01   +7.078594546608898e-03   +4.851711984054732e-01   +4.503526561812360e-01   +2.537578858624340e-01   +5.317273204742523e-01   +7.029650114700485e-02   +2.502915386416041e-01; +6.396850427693993e-01   +1.667163351593524e-01   +4.987696861528335e-01   +3.933520108785001e-01   +2.534690140516468e-01   +2.953600697669985e-01   +4.121597991951810e-01   +2.912914562900637e-01; +5.833685936867754e-01   +2.306408146628510e-01   +4.848849499788926e-01   +2.323381770629861e-01   +2.850196451217523e-01   +4.187924759584030e-01   +4.382704603066716e-02   +3.660911092335248e-01];
L3I_L3E_iAMPA_netcon = [+2.371377453583730e-01   +1.400826368904397e-01   +3.454284235222328e-01   +8.915561641895407e-02   +3.564228781989138e-01   +3.504557227176465e-01   +3.885214640515071e-01   +6.021438145030322e-01   +1.849463240609086e-01   +2.933952127150858e-01   +2.361208984568743e-02   +4.690958160585395e-01; +4.401601437832545e-01   +2.991161922288325e-01   +1.265974094999669e-01   +2.654262836973516e-01   +4.639694542006737e-01   +3.637469068850781e-02   +1.481278997874192e-01   +2.753315624472673e-01   +5.729415980582390e-01   +4.087801402561883e-01   +1.686871180421583e-01   +5.669799491457735e-01; +1.188081462531878e-01   +3.203148293693860e-02   +1.723376326848853e-01   +2.999828390086516e-01   +1.877703505754879e-01   +7.371861741347623e-02   +1.565412864600100e-01   +5.738483237646242e-01   +1.147985657446073e-01   +1.636044822587127e-01   +4.732726870829846e-01   +5.740827857484432e-01; +4.695293990556657e-01   +4.579180909886263e-01   +1.763581816348385e-01   +6.268161154674984e-01   +3.948827428133727e-01   +4.297538643709074e-01   +5.253247735957467e-01   +1.767283005872842e-01   +3.730376374799138e-02   +5.483792614357789e-01   +7.855826855014457e-02   +1.887287077811112e-01; +8.914083444563048e-02   +3.844475774890962e-01   +1.892937211820525e-01   +9.202362788251342e-02   +1.004080082674162e-01   +3.570903008126941e-01   +4.092982524303441e-01   +2.539583422570525e-01   +3.098024485975556e-01   +2.741853861910871e-01   +3.417114836817902e-01   +4.285527477877887e-01; +3.458465340173952e-01   +4.096126000651690e-01   +1.636567147634614e-01   +2.952288607588134e-01   +3.787897592338400e-01   +1.697808614364428e-01   +4.040836377663934e-01   +5.613383979723390e-01   +5.747784574621323e-01   +3.340752661629227e-04   +9.091009258615797e-02   +6.927522148858364e-02; +5.414967013766945e-01   +4.751229543243760e-01   +8.326543488297673e-02   +3.781518771086717e-01   +4.475077947006508e-01   +3.421591351762004e-01   +5.576365935190450e-01   +6.125297231572210e-01   +6.124920157443330e-01   +1.555278978014336e-01   +5.410689172945684e-01   +5.592852936070514e-01; +1.877755817417521e-01   +5.605441395932358e-02   +9.912141849728127e-02   +3.924282158882785e-02   +5.275951968099929e-01   +4.809322753985841e-01   +3.259749639833516e-01   +1.870396754717562e-01   +4.012406719888434e-01   +3.279252349988449e-02   +2.451663779272883e-01   +1.577070414975797e-01; +3.466637349114168e-01   +6.000469678976120e-02   +3.217649793893298e-02   +4.531218744312058e-01   +1.441420056435664e-01   +5.947468717259723e-01   +1.007426846793539e-02   +3.722520255995074e-01   +4.475510320563504e-01   +4.278728829310898e-01   +2.409733231462214e-01   +3.977001954548608e-01; +2.965583860423591e-01   +4.371430224009915e-01   +3.846253450956347e-01   +6.203987607023719e-01   +5.665265227468366e-01   +1.731739986693900e-01   +3.554266256090675e-01   +3.736150246322243e-01   +1.061166084215107e-01   +3.813681999042708e-01   +2.790788299320668e-01   +1.264969925991246e-01; +5.759023598223694e-02   +5.193441630384720e-01   +8.463764493743181e-02   +3.229412279564335e-02   +5.076274158548350e-01   +6.379581113863227e-01   +3.698888683410182e-01   +4.272986418313237e-01   +3.387735546211995e-01   +8.825610362236508e-02   +4.265382357299519e-01   +5.691366809627389e-02; +1.483162093765887e-01   +4.065496270153612e-01   +1.365879407690527e-01   +5.230915226738615e-01   +5.554095457234451e-01   +2.073019814687367e-01   +1.766388001592725e-01   +3.855769003180267e-01   +3.233221121506824e-02   +1.815428608691858e-01   +3.513730275391858e-01   +1.525576198108463e-01];
L3E_L3I_iGABA_netcon = [+5.277974066175980e-01   +3.703251475181613e-01   +1.460503951167443e-01   +3.507612122465136e-01   +3.450435684543358e-01   +8.700921468946950e-02   +3.487169717346424e-01   +5.029514302161792e-01   +3.679465938198627e-01   +1.245284518758017e-01   +1.402174746040187e-01   +4.303586801573740e-02; +4.079692945841528e-01   +9.517566601873632e-02   +2.099813658921983e-01   +5.641718042931896e-01   +2.585323418632546e-01   +5.618058200498718e-01   +4.642448581176568e-01   +4.845000518894159e-01   +1.844583184131481e-01   +2.630045248890097e-01   +2.964663257936196e-01   +3.077331852428095e-01; +1.403110822010916e-01   +1.869351814053756e-01   +6.281021654481838e-01   +4.847352811044177e-01   +5.159295714055909e-01   +1.438796286942602e-01   +3.086992821862460e-01   +5.406021747470637e-01   +4.995586428599086e-01   +3.114756003119847e-01   +7.422166462907802e-02   +1.399193425542121e-01; +1.771021196342595e-01   +2.520310471488451e-01   +5.681378159443384e-01   +4.728927988659227e-01   +1.272922523361727e-01   +4.986299306796869e-01   +2.029905106206131e-01   +3.679046398395958e-01   +9.653349288443813e-03   +5.912923326791559e-01   +6.198468900831506e-01   +2.338121412159448e-01; +4.885281694751870e-01   +2.768157501443389e-01   +4.863116576288989e-01   +1.673816701071767e-01   +4.036293321787880e-01   +1.778858673387860e-01   +6.130538355271401e-01   +2.280917915200354e-01   +4.976246433370047e-01   +3.244287068811807e-01   +2.639049910765937e-01   +2.978631973986187e-01; +5.966353044001135e-01   +2.527773551014629e-01   +3.742058745324822e-01   +9.020626237884009e-02   +5.151821389179079e-01   +6.477889296312635e-02   +5.310439724581931e-01   +1.869577240308283e-01   +1.158189335533376e-02   +1.711393556291674e-01   +4.877907451209471e-01   +1.528869781856008e-01; +3.964691119136168e-01   +4.666048409437389e-01   +2.310003826170108e-01   +1.426373565882507e-01   +1.113682994060644e-01   +6.247405313646652e-01   +8.853793605131288e-02   +5.859578843904849e-01   +3.987674991194355e-01   +4.740022571765119e-01   +2.174937871818832e-01   +1.698439338867026e-01; +1.661335290309714e-01   +3.031806173610805e-01   +6.349875222059535e-03   +5.805278103261906e-01   +1.185802307877168e-01   +2.511743337946550e-01   +1.736049874044590e-02   +9.699755852131983e-02   +4.781667785832799e-01   +4.783362520802752e-01   +3.104910912115741e-01   +2.949118746664625e-01; +4.955530559132575e-01   +1.259457998213654e-01   +5.137694490768739e-02   +4.340049849296531e-01   +2.931728518415909e-01   +6.416905917986239e-02   +3.762919129170230e-01   +2.090220339369573e-01   +5.720310442469211e-01   +5.512479143933403e-01   +1.459338440477825e-01   +6.271352041692767e-01; +3.579879758757810e-01   +6.049286375397736e-01   +6.370485463506582e-01   +4.696175845675332e-01   +1.104421314270004e-01   +5.364370907662324e-01   +2.596358818123108e-01   +1.823690307628406e-01   +3.624144248074633e-01   +4.952179980661692e-02   +4.153152944209387e-01   +6.068140812594031e-01; +7.719617996241530e-02   +3.162216805900745e-01   +5.654788528599148e-01   +3.784551740220339e-02   +3.378205162941959e-01   +5.372124203443869e-01   +4.224810863428869e-01   +1.746856116405328e-01   +1.706492617545483e-01   +2.960945225711276e-01   +5.068314876426069e-01   +5.767072713441628e-01; +4.699604836991901e-01   +7.550835526712416e-02   +4.266791641590356e-01   +4.936025660690600e-01   +5.583002498864736e-01   +1.039558337009670e-01   +4.551819200693246e-01   +5.027046562541372e-01   +2.873434957844093e-01   +4.963328841319874e-01   +2.223798088827178e-01   +3.037874911067260e-02];
L2E_Input1_iAMPA_netcon = [+4.261959944156213e-01   +2.612658263522541e-02   +9.060220339454737e-02   +5.875814173599361e-01   +1.340309203948494e-01   +5.667997639160751e-01   +5.331161671103655e-01   +3.275420285626852e-01];
L2I_Input2_iAMPA_netcon = [+5.658939775492011e-01   +1.268477822823661e-01   +6.239071741991020e-01   +5.660408646735973e-01   +4.277408508411151e-01   +5.720873007621819e-01   +2.313533181202354e-01   +4.907114129870449e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = -20*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
