function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.076768067691640e-05   -3.250390225083291e-03   -3.140035320413764e-03   +4.395019873456044e-03   +1.279087051015284e-03   +4.489611219328769e-03   +5.193464185320567e-03   -2.224634710070833e-03   +3.924885349920048e-04   +5.942656186974196e-03   +8.383838973700724e-04   -7.747028350515699e-04   +5.940990519025468e-03   +5.138292093086556e-03   +8.247451760075091e-03   -1.326676335039460e-03; +5.504572123051113e-03   -5.633628030768298e-04   +3.780788540392550e-03   +6.174593197844986e-03   +3.338498665393644e-03   +4.784766190850517e-03   +6.668497444340058e-03   -3.285691443442849e-03   +1.089725896895913e-03   +7.318234357880547e-03   +7.647000613370782e-03   +3.268535036644741e-04   -7.355335938952945e-03   -5.068135797225933e-04   +3.819702039243734e-03   -1.663832063204764e-03; +2.050451346030283e-03   -3.690049177730755e-03   -1.031121768023300e-03   -2.939463655616051e-05   -2.806314044610282e-03   +4.088615973025406e-03   +5.675127723114590e-03   -8.146336304791054e-04   +6.079946656472771e-03   +4.210744700915729e-03   +5.332486743202263e-03   -5.050214198506022e-04   +3.747856196074753e-03   +8.890266414705405e-04   +2.398156797341281e-03   +1.211432371200403e-03; +5.175712643184839e-03   +4.958229674619129e-05   -6.773658012840110e-03   -4.020366041437754e-03   -1.394904182655043e-04   +3.677408624097993e-03   +3.722677003558946e-03   +1.011014291090340e-03   +4.188520495970642e-04   +1.716452192322895e-03   +4.173584892839092e-03   +5.827945750885662e-03   -1.030020100228598e-03   +2.830060469371280e-03   -1.179331594376893e-03   -1.067294433525802e-02; +2.543389661744227e-03   -1.616378553027406e-03   +3.888461580445819e-03   +1.747913260818978e-03   +4.963944156683659e-03   -4.701206819973698e-03   -3.460590541027236e-03   +5.446026019576456e-03   -2.933803402499360e-03   +5.786762424527246e-03   -7.724502714984843e-08   -2.091591302549058e-03   +3.697161445702435e-03   +1.497170764308877e-03   +2.870940896366754e-03   -8.163209650118310e-04; +4.498874919450941e-03   +2.238198527382436e-04   -1.438226737112156e-04   +4.763513071242922e-03   +4.408696084493591e-03   -4.190753403446294e-03   -6.732277205115282e-03   -7.925596196803856e-03   +9.581925740272490e-04   -1.251182761496358e-03   -2.485151976291252e-03   -6.931084745324342e-03   -4.058478935919285e-03   +3.406902040081026e-03   -5.194876892665396e-03   +3.922104655531206e-03; +4.616934258467657e-03   +5.346022571214653e-03   +2.721072245518568e-03   -5.673754241414691e-04   +3.272172786982296e-03   -3.035208975733462e-04   +2.501444655842833e-03   -9.940374334442643e-04   +6.756646487446063e-03   +1.752171465962497e-03   +3.600734320331912e-03   +4.944598046117794e-04   -6.440354647575686e-03   +3.455236914182404e-03   +1.817742343603428e-04   -2.257002762780052e-03; -1.692137112561765e-03   -6.277073900892192e-03   +5.269875474016960e-03   +2.964819569775091e-03   +3.158452031589964e-03   +9.978966879863869e-04   -1.957321768710077e-03   -5.419237880456423e-03   +7.559699259798602e-03   -2.048824848585029e-03   +1.805796599681254e-03   +4.686779227842408e-03   +5.585000377545478e-03   -1.346305047475484e-03   -9.153883014597964e-04   +6.738427289328762e-03; -2.398278489335597e-03   +4.053612083206322e-03   +9.954795221590559e-04   +2.789754635480782e-03   -3.112126350985763e-03   +1.068310620595433e-03   -1.190191284522916e-04   +4.720894647678182e-04   +4.597131206850237e-03   +3.365937685809661e-03   +2.656615768291975e-03   +7.471331096816004e-03   +3.381275415577315e-04   +2.976953209684021e-03   +1.367948666036924e-03   -2.354726979269177e-03; +4.770923877847544e-03   +3.896166870450768e-03   +9.830550863533682e-03   -2.647943245746608e-03   -7.637019680295847e-03   -2.468213326591742e-03   +2.701671047342364e-03   -4.276532700175281e-03   +7.877960868135223e-03   -2.676578824125503e-03   +1.674773769663540e-03   -4.442113053555023e-03   +2.953955416739208e-03   +6.363198068014509e-04   +7.768056634213879e-04   -2.405361003051487e-03; +6.951245725547539e-03   -2.862315848922360e-03   +2.982602500080089e-03   -3.405588849942285e-03   +2.253012119083289e-03   +3.418387547204789e-03   -2.740539487808671e-03   +6.101418896843253e-03   -1.786915591442534e-03   +2.160759067385105e-04   +6.552746948540196e-03   -4.207014823877397e-04   +9.684745928611278e-04   +1.642081786973165e-03   +8.213080171348482e-04   -1.903897178147829e-03; -2.064296754618374e-03   -4.742595605017666e-03   -3.891467984930151e-03   -1.133745334121406e-03   +4.403079152844800e-03   -5.905795110810279e-03   -5.434434238758010e-05   +2.206175589107877e-03   +6.768778257272462e-03   -6.340005261884060e-03   +8.950207324211045e-04   -2.940609755388717e-03   -9.596890631828827e-04   +2.577863276792400e-03   -5.216139224223277e-03   +4.066392141938209e-03; +1.005150025741843e-02   +6.996309425405946e-03   +2.757997415915196e-03   -2.366878369714102e-03   -3.796782295634999e-04   -2.987962290902261e-03   +2.682408141813630e-03   +1.156390016968401e-02   +8.271648717217570e-03   -2.166819650862148e-04   +2.792009688083682e-03   -7.997770403877591e-03   +4.115303520678140e-03   -3.089622150346743e-03   -2.044730581042206e-03   +1.601686932448337e-03; +8.900202912584138e-03   +4.953720361479640e-03   +6.392363724042074e-03   -4.864666791832483e-04   +2.988634208653660e-03   +2.869039496020163e-03   -1.523379491138555e-03   +9.379193284745430e-03   -2.236589617036356e-03   -3.254018145328201e-03   -3.591006946068928e-03   +8.454123555032275e-03   -1.446715068669422e-03   -2.680013851686867e-03   +2.473942450631479e-03   +2.488411449820899e-03; +6.181134112748345e-04   -3.493991493882884e-03   -3.835718627919735e-05   +3.421774638489474e-03   -2.297715849953799e-03   +4.782844534430939e-04   +1.966060653353732e-03   -1.305048012864123e-03   -1.105309062677394e-04   +5.522071030345867e-03   -1.769202024942666e-03   +5.622589152825217e-03   -3.348124271205176e-03   -1.161602241566595e-03   +1.428589120827325e-03   -8.978657483748797e-03; +4.904721696130413e-03   +2.993632937491984e-03   -6.210945749500740e-03   +2.917931840086662e-03   +8.640774379796330e-03   +1.969770667949827e-03   +5.474881997958410e-03   +2.654690414820696e-03   -4.897502336644642e-04   +8.560804743484590e-03   +4.137242645584619e-03   -1.060821888928384e-03   +2.389987560007066e-03   +2.021596972189530e-03   +4.677394647330457e-03   -1.746138683840790e-03];
L1E_L1I_iGABA_netcon = [+5.554990512476153e-03   +6.303675732121771e-03   +1.959179896784722e-03   +2.126596589644545e-03   -3.319345232573407e-03   +7.443651870312377e-03   -3.334684834817372e-03   -7.349799814281536e-03   +5.505775870425045e-03   -2.853324334122734e-03   -1.697511502991486e-03   -9.131797677658664e-04   +4.434900992481781e-03   +5.707346056192809e-03   -3.095507412050690e-03   +2.768723606558368e-03; -4.370749251463606e-03   -1.580515995860948e-03   +1.123667485573554e-02   +3.017468200304232e-03   -1.269445824786151e-03   +2.809218591477020e-03   -4.274362704474009e-03   +4.181818447283740e-03   +7.022306198487347e-04   -9.271163746619349e-03   -3.732089916620484e-03   +2.084404871004629e-03   +3.073413761339599e-03   -2.514250787987444e-04   +5.372414423912284e-03   +2.655925392071369e-03; +9.925609765774416e-03   +1.617399569733738e-03   +7.246176954934170e-03   -2.865783523211383e-03   -9.290979947673699e-04   -2.988244569797329e-04   -8.566258518431227e-04   +5.550039680960858e-03   +8.215835032001382e-03   +8.128630143262131e-04   +6.602164996167437e-03   +1.041445036646164e-03   +3.093818518533743e-03   +5.182235689825886e-03   -4.786136935976672e-03   -1.706064636526827e-03; -2.256525465107518e-03   +9.503743820219639e-05   -3.709942044258913e-04   +2.956499501900480e-04   -4.315919324319754e-03   +7.375903027753709e-03   +4.844672150005808e-05   +2.273374003867116e-03   +8.608367158670274e-04   -5.928654185134676e-03   +2.917550218985704e-03   +1.562364321001139e-03   +3.073700922165489e-03   -6.717865868420573e-03   -9.323816413130209e-04   +7.979048804288258e-03; +4.482150623211317e-03   -1.699549527455009e-03   +4.709270856164371e-03   -2.567621576668321e-03   -7.926064467170962e-03   +8.054581367668477e-03   +1.276518323597305e-03   +7.928200124537391e-03   -8.608922534596136e-03   +1.965226768345572e-03   +3.266795767760180e-03   -3.220766808230643e-03   +8.798107855191757e-05   -5.585814809736362e-04   +8.619465985130116e-03   +5.226884417251370e-04; +5.898757960409981e-03   +7.724108967494942e-03   -2.235317592267755e-04   -6.880015300090930e-04   -1.015311428812706e-03   -3.758155047197723e-03   +9.308374631509768e-03   +3.082309363904374e-03   +3.381353207034551e-03   -1.419119935748579e-03   +3.852889183815158e-03   -3.517612116477073e-03   +3.613360628004309e-03   -4.046810994173464e-03   +1.958385417874946e-03   -2.401565018069251e-03; +4.282412122215567e-03   -2.909327931331231e-03   -2.896787318524552e-03   +9.791781815569165e-04   +3.407154510957793e-03   +2.988759266569455e-03   +6.409099322600303e-03   +5.662129688681803e-03   +4.623361195069896e-03   +3.580543297049952e-03   +4.839328392650099e-03   +6.177680429263616e-03   +9.940665378836450e-03   +4.074241631219208e-03   -7.718379552071367e-04   +5.640915742623367e-03; -1.758618674293231e-03   -3.427115827642440e-03   +2.734563980547450e-04   -3.344419534002370e-03   +4.591839970787284e-03   +5.514131120783379e-04   +4.373048060936221e-03   +1.651345454047410e-03   +1.062302499176646e-03   +8.611250506828177e-04   +4.455099646331007e-03   +1.255769540073917e-03   +2.779214835402463e-03   -1.073968854184447e-03   -6.044974536643254e-04   +3.057278403522799e-03; +1.684874772677921e-03   +5.579692739291878e-03   +2.415483505375507e-03   +1.192536549861963e-04   +2.324115658838725e-03   +1.799533642073638e-03   +1.039184495614458e-03   +8.009252974343921e-03   +4.110302606799395e-03   +1.261894928751594e-03   +2.983288198892116e-03   +1.028591184089401e-03   +5.041126386638784e-03   +2.051265825910103e-04   -1.392092328964651e-03   +5.623982663834120e-03; +6.353015119120675e-04   +5.595351539572707e-03   -4.735637648222411e-03   +1.294304298791617e-03   +3.202258842573154e-03   -1.005371788410529e-03   +1.863506921388245e-03   +3.240630156273479e-03   +9.413932172047893e-03   +3.097023798396115e-03   +8.848644178334660e-04   +8.931940367998964e-06   -4.167928130816923e-05   +5.309047211279956e-03   +3.647541572176375e-03   +2.138722070188071e-03; -4.617583129770560e-04   -3.588721385797429e-03   +3.247346892943355e-03   -2.583297929226264e-03   +3.266683541460673e-03   -3.111410999954911e-03   +8.821833239708870e-03   +6.739911404619379e-03   +3.531096132638411e-03   +1.157896663012414e-03   +3.544149990130760e-04   +6.212684331675657e-03   +1.178172859614069e-03   -4.333793672924226e-04   +2.556805539850532e-03   -1.017806414999431e-04; -6.342879837141087e-03   +3.346190709198260e-03   +2.605800811930202e-03   -1.058745207225474e-03   -4.599534511619899e-03   -3.405315573941207e-03   +1.184711889852979e-03   +9.235266823674732e-03   +5.761940032042731e-03   -1.440934692803192e-03   -8.085887864623682e-03   -6.557706236103947e-03   -8.286782657617345e-03   +3.802609109507991e-03   +1.167810948805524e-03   +9.257506372441302e-05; -3.303389145604596e-03   +5.697821684222976e-03   -3.886004650286317e-04   -1.607570889274133e-04   +1.273776582284250e-04   -3.150851093923638e-04   +4.602948867250101e-03   -2.866666209305951e-03   +6.261181638108552e-03   +1.808506276601831e-03   +1.632757490208339e-03   -1.975403356038639e-03   +3.647753298771799e-03   +5.116920472667694e-03   +7.870642199959635e-03   +7.222499280511413e-04; +7.980884003022134e-04   +2.705050527364417e-03   -1.724541868477637e-03   +1.076439614092658e-04   +3.212350354494149e-03   +5.820446019043155e-03   +2.695812092716122e-03   +4.084527323972192e-03   -4.328153281424746e-03   +5.078131019839303e-03   +2.738305513611900e-03   +6.391004289405760e-03   +2.974754694711791e-05   +8.697153190527152e-04   -7.999094548998005e-04   +2.765510507555730e-03; -1.494328821538471e-03   -2.583921650742941e-03   +2.201843578425461e-03   +3.783486849390915e-03   -1.187686973817404e-03   +8.974351129405910e-03   +5.582178615493432e-03   +1.603665754184868e-03   +9.741237521556304e-04   +2.463685888745967e-03   -1.525428349118961e-03   -6.380877197180630e-04   -6.658642453159631e-03   -1.967615173425164e-03   -7.200679975475988e-03   -4.690025361929254e-03; +5.314178308645405e-04   +6.572199490661039e-03   -2.370806911950997e-03   -5.720865005116502e-04   +4.715275554508199e-03   +3.474006079619331e-03   +8.804229904300976e-04   -1.233716949371893e-03   -7.728281106424872e-04   -2.193846766573651e-03   -2.191915778932897e-03   -1.814768334299297e-03   -1.496378833635693e-03   +9.532775370025245e-03   -2.265563534829785e-04   +5.735585651903657e-03];
L2I_L1I_iGABA_netcon = [-6.777084074508647e-04   +3.905027260725258e-03   +6.505520049851360e-04   +3.959594142796201e-04   +5.117802373982037e-03   +2.419784194183235e-03   +1.974534113332551e-03   +5.134509577955388e-03; -6.857286005858301e-05   -2.045548803637885e-03   +4.824552796106275e-03   -1.060619437738423e-03   +2.381633567558286e-03   -4.235864753753290e-03   +5.902857293374713e-04   -2.384492012963178e-03; -7.694259319455292e-04   +3.121659702968164e-03   +5.622077809561937e-04   +3.501240150289194e-03   -3.461553394484354e-03   +8.840911126558925e-03   +5.526111033675452e-03   +8.789961437070557e-04; -2.551045049313415e-03   -3.819722748187744e-03   +1.874680845481971e-03   +3.780934208731028e-04   +5.836182146877296e-03   -4.001553654167956e-03   +1.821766429632919e-03   -2.675349308869792e-03; -2.733202710462913e-03   +4.389359197930487e-03   +5.309206088501287e-03   +3.948012578505486e-03   +4.391709259040122e-03   +1.372438290676749e-04   -1.713619732632761e-03   +3.712587580887036e-03; +5.402016417489392e-03   -3.875809235512432e-03   +1.461527196271750e-03   +3.638762486153465e-03   +1.881221539705942e-03   +3.704027681493642e-03   -3.886555606168628e-03   +5.448935390814567e-03; -2.191464190341376e-03   -8.251602484314724e-03   -3.670046704088402e-03   +6.874725978746729e-03   +2.550605964629864e-03   -4.059198579140398e-03   +6.103787275553529e-04   -2.270461026296227e-03; +2.095110917231671e-03   +8.602236539615969e-04   -3.012618022484299e-03   +3.515687570009023e-03   +4.275966555354439e-03   +1.045101239336156e-03   +4.828357464069302e-03   -5.255662503654952e-03; -2.087373251587104e-03   +5.683371501642775e-03   +1.790471830184309e-03   -6.711226714815208e-03   -2.825731259014610e-03   -5.301099873177950e-03   -4.332449144659411e-04   +2.792449849637183e-03; +1.814318997281922e-03   +6.908150902868277e-03   +5.970579277594434e-03   +1.881476104811318e-03   -1.141001899633094e-03   +5.678165078869988e-04   +4.996971887493460e-03   -3.466183206101963e-03; +4.712112508487849e-03   -3.056639210583387e-03   +2.479791921135084e-03   +3.718380116376345e-03   +4.614914857345397e-03   +6.738570777958165e-03   +7.885775791812814e-03   -1.477559997163054e-03; +8.250033968553335e-03   +5.580496801156147e-03   +5.265675537230445e-03   -5.021353513422260e-03   +8.277116490401069e-04   +2.118516129097025e-03   +3.283541125017410e-03   -1.415232453901838e-03; -3.486501564242729e-03   +2.439979520640521e-03   +2.892629044393741e-03   -5.695090907092565e-04   +2.974770113565380e-03   +2.179998673625727e-03   +4.797923480535923e-03   +1.992578483981263e-03; -3.686336186711707e-03   -1.604648665031457e-03   +2.997425227178587e-03   +5.129579142790549e-03   +9.247417810377061e-04   -5.459676570578734e-03   -6.898986913608242e-03   +2.695120158194421e-03; -4.024639273811641e-03   -8.446130920273829e-05   -1.420481780065119e-03   +3.758535147476969e-03   +1.663124494811408e-03   -2.398067226646359e-03   +6.783960223227082e-03   +9.713216243302037e-05; +9.373820821213996e-04   +1.935799922329602e-03   +3.986792212341309e-03   +4.592257826994527e-03   +2.434255679832898e-03   -3.111488988122525e-03   -1.006767992959132e-03   +4.264546901511614e-03];
L1I_L2I_iGABA_netcon = [+3.941678829989107e-03   +7.248135921020162e-07   +1.483586661007839e-03   +1.355594995522098e-03   +3.145024002980310e-03   +5.877138745004077e-03   +5.073077521753942e-03   -3.461906944268295e-04   +1.483987898194691e-03   +4.176329448579146e-03   -5.710649494282145e-03   +3.408427017819337e-03   +8.483735604853354e-03   +2.664271293739774e-03   -4.623820813557339e-03   -3.441943039443326e-03; +2.996029915780660e-03   -2.929974963349304e-03   +1.799829926323578e-03   -1.686569888025729e-05   +7.272994631337416e-03   +8.002456376646247e-03   -1.881685725000127e-03   +9.133647766710294e-05   +1.690913980195068e-03   -2.497327517173982e-03   +5.355756584633488e-03   -1.386658697155567e-03   +1.701049725327156e-03   -2.154899545000879e-03   -5.947799186384641e-03   -2.258119603431559e-03; +4.451420041337728e-03   -2.899743363784942e-03   -2.831776287275942e-04   +5.156508533405497e-03   -9.291592494010594e-04   -2.762511180943907e-03   +3.009636541135084e-03   +2.423768298276117e-03   +1.651984209722296e-04   +1.328340398932503e-03   +9.335445774845083e-04   -7.863029705867070e-03   -4.559893729819378e-03   +1.103728389121726e-02   -1.297216047226350e-03   -1.202072229899234e-04; -3.390603645472311e-04   -2.424222121829828e-03   +4.790941438271197e-03   +3.516256502008541e-03   -9.099539036115422e-03   -8.366629407295122e-03   +9.472934742007092e-04   +9.460273883948069e-03   -1.802252771180352e-03   +2.919069278395705e-03   +7.353462969192474e-03   -2.078453547120010e-03   +2.429474472299706e-03   -8.471522767153745e-03   +3.667018283938727e-03   +6.836555812519921e-03; -1.713957605518827e-04   +8.365077124080548e-03   +3.407866288965606e-03   +4.637358025734857e-03   -2.446991373783106e-03   -3.179748137249381e-04   -8.009386672130944e-04   +5.921950839141384e-03   +9.163829217275334e-04   +2.955265158180314e-03   +4.313339866366466e-04   -1.130375828012538e-03   +3.488206570796295e-03   -2.320351412596048e-03   -1.044555359261953e-03   +1.375136564534419e-04; +2.473256116568534e-03   +3.328516810278624e-03   +2.821972685672670e-03   -4.647025726976298e-03   +7.939359998709906e-03   -4.794379346956792e-04   +3.586593312788455e-03   +1.103485859202570e-03   -3.325315249913287e-03   -2.660023740440232e-03   -1.457331954315308e-03   +3.779447055384800e-03   +5.368676266702505e-04   -6.357754543702668e-04   +9.379913291135349e-03   +4.217213046748824e-03; +3.017728801894744e-03   +5.711017730452723e-03   +2.229884675463058e-03   -2.538410838553201e-04   +3.747991094548625e-03   +1.407879326886475e-03   -2.685218202655151e-03   -4.701120270278287e-04   +4.569914163606361e-03   +2.041711406596526e-03   -2.848844014202894e-04   +3.921433029242961e-03   +8.983511047425217e-04   -2.647396236546432e-03   +3.846723251063727e-03   -4.294713569044500e-03; -6.253857655722939e-03   +6.762136269533258e-03   -4.670625411671443e-04   +4.923749079095142e-03   -2.706564526971901e-03   +1.823068293384611e-03   -1.615212482293164e-03   +4.526187180592636e-03   +5.536805023315572e-03   +7.073566578831873e-05   -4.444575015796088e-03   +1.319962648167225e-03   -5.282025019707108e-04   +1.959780437880708e-03   +7.962207080916270e-04   +3.259747566215392e-03];
L2E_L1E_iAMPA_netcon = [-6.276044512961076e-04   +6.785117854724801e-03   -1.836224057489577e-03   +1.577461765986498e-03   +1.073476708284150e-03   -3.660407998590705e-03   +5.920539995206742e-03   +8.281035099614725e-03; +1.415612298774989e-03   -1.870855551777558e-03   -3.056817857886363e-04   +7.350350835177587e-03   +4.265984482004218e-03   -3.659285486376129e-03   +3.246991865844827e-03   -3.908153176613648e-03; -2.980194593571658e-03   -3.658752022834064e-03   -3.644010313734432e-03   +1.949591879511553e-03   -7.276429244793924e-03   +6.244602113073861e-03   -6.647277982169909e-04   -1.976394707101000e-03; -8.192358216333653e-03   -2.129321566628049e-03   -2.743590210398688e-03   -1.301271605444746e-03   +4.319294824861760e-03   -2.954610578808181e-03   +2.834569584686248e-03   +6.340731258542699e-04; +2.685484542166192e-03   +2.221857126695114e-03   -4.213499126048339e-04   -1.165495226873663e-03   -1.100428316986295e-03   +1.860978703639907e-04   -2.185192550020731e-03   +2.004988454739642e-04; +3.455850966647553e-04   +3.421090647914003e-03   +5.256474000722058e-03   +4.787369650422454e-03   +1.699975014551546e-03   -1.106355106125275e-03   +5.899944304673988e-03   +7.469664410136530e-03; +5.024898676739972e-04   +1.075425768055218e-03   -4.804620837304908e-03   +3.881552018614219e-03   -5.627073455426907e-03   +7.084713651882167e-04   -6.621281769657164e-03   +8.797876921728927e-03; -7.263114158311022e-03   -6.806387062536738e-03   -6.610910607778833e-03   +6.078404071100335e-03   -1.807714496292957e-03   -2.085531884400040e-03   +7.753756550452027e-03   -3.462006377414522e-03; +2.021063021299815e-03   -8.589536831777882e-04   -1.416150140029667e-03   -1.853072910408961e-03   -3.123346360655926e-03   +5.004419598270372e-03   +9.163138354433673e-05   +5.111170051343674e-03; +3.731142477135548e-03   -3.534606039852329e-03   -2.948717343579785e-03   +2.838748023551183e-03   +9.918046438057992e-05   +1.606841843382986e-03   -8.063566296770339e-04   -6.615650653331510e-04; +3.749083558065732e-03   -6.092056248860151e-04   -1.691708852345695e-03   +2.181675056570026e-03   +3.653081824417677e-03   +3.469328256524048e-03   +2.536639970762618e-03   -4.376119915530485e-03; +1.678102685112553e-03   -1.351614903903017e-03   +1.304584063298562e-03   +3.670218557967666e-03   +3.955646919742948e-03   +1.177481364120700e-03   +9.940498391877590e-03   -2.401208591408398e-03; +6.899819289140345e-03   +2.092695504037835e-03   +8.210478005196810e-03   +5.701307771623553e-03   +4.009749317309818e-03   -2.161223787072724e-03   +8.096199453898631e-03   +7.010608706127585e-03; -4.221801247039669e-03   +2.494133424331666e-03   +2.040365912582813e-03   -2.323915369399924e-03   -6.110512392796413e-04   +1.848604345370306e-03   +4.746120470848830e-03   +2.574945300472999e-03; -6.284384317455928e-03   +5.179420094317174e-03   -8.418595976215602e-03   +6.853242135362418e-03   +2.680568665274001e-03   -6.270465927290254e-03   -5.343543152691828e-04   +1.321687789829212e-03; +7.677266311250689e-04   +4.751079352823448e-04   +3.808164402290430e-03   -1.577470148146297e-03   -2.190013470938025e-03   -2.649826637056300e-03   -1.884979595446585e-03   +1.041286169652025e-03];
L1E_L2E_iAMPA_netcon = [-7.725449239979604e-04   +3.472839161013467e-03   -3.015079223853503e-03   +2.152686911180929e-03   +4.687739958580049e-03   +8.906507912551358e-03   +1.176444822798592e-03   +3.903563484318034e-03   +1.811099653202884e-03   +7.802126195879693e-04   +3.218345625496127e-03   -8.254623929727753e-04   +5.709137292288616e-03   +5.031658152376498e-04   +7.432100855918238e-04   -1.624125334569052e-05; +6.181466742142442e-04   +8.534290869366301e-03   +5.792502021614307e-03   -2.912050878174231e-03   -2.479059661845880e-03   +3.440275417237155e-03   +4.588328557225158e-03   +2.732494522605399e-03   -4.267416472906319e-03   -1.833421621569696e-03   +1.221967871084999e-03   -1.093577793119639e-03   -4.000481596530856e-03   +3.286524400398706e-03   +6.187739435626973e-03   +1.843694708644501e-03; +3.840946933485312e-03   +4.887891202708824e-03   +5.370565740485415e-03   +7.786734582683076e-03   -1.398937909633115e-03   +2.108401425187287e-03   -6.028466086195968e-04   -1.520250769448549e-03   -1.182456545143867e-04   -4.031408092504620e-04   -3.584473776247399e-03   -1.340092827523498e-04   -7.698349637105278e-03   -3.839210161443898e-04   -1.353174934111787e-03   +3.041312170086070e-03; -7.503295454982762e-03   +4.254318030037884e-03   -2.143501732024227e-03   -3.354435637994662e-03   +4.854736289311360e-03   +8.469374372870786e-03   +6.400688457299594e-03   -9.600849934914997e-04   -3.792613521564812e-04   +3.952054657881623e-03   +5.675473669770554e-03   +3.382110556838056e-03   -1.177041567631891e-03   -1.960546495110434e-04   +5.116405864437078e-03   -8.773598762978887e-04; -1.550020616733211e-03   +1.085162368992198e-03   +2.784569729932313e-03   +3.649943558196528e-03   -3.522943882328541e-03   +3.521489742179341e-03   +3.479207654343505e-03   -4.862686752459393e-04   +5.006683185072038e-04   -8.079606385458297e-03   -3.879777576322334e-03   +1.443899210066175e-03   -1.398589442135948e-03   -3.955126527251367e-03   +8.144340340184476e-03   +2.629489389463188e-03; +3.269462967554191e-03   +3.795699541285548e-03   +2.236829972435992e-03   -3.537541830754924e-03   +5.248913171460909e-03   -6.509726733260376e-03   -1.617599472207123e-03   +3.617790185651246e-03   -1.961864622964887e-03   -3.426883311052060e-04   +8.282749225910147e-03   +4.142383984213743e-03   +1.135913772537802e-03   -7.953131325713087e-03   -4.035777464277135e-05   +6.789488967442558e-03; +2.833299167829978e-04   -1.165945153786883e-03   -2.698622603084472e-03   +1.784974434230091e-03   -4.642944123180869e-04   +3.847398416634763e-03   +7.141131044178827e-03   +4.240548585214063e-03   -2.573781997997405e-04   -3.238065457491801e-03   -3.188419829027433e-03   -3.893879193688544e-03   -4.172152509051073e-03   -1.879320532842911e-03   -2.225302526404330e-03   -2.654046950137380e-03; -7.001027486367107e-03   -1.810432064096460e-04   -1.515560305349078e-03   -1.384233118911442e-03   -6.782169988446525e-04   -3.215010672745332e-03   +5.855016023316804e-03   +3.950487374678516e-04   +6.222034647091436e-03   +3.633167349419146e-03   -2.856624777670330e-03   +3.738328911035117e-04   +2.098550924803530e-03   -8.751254868130101e-04   +2.460518292230876e-03   +3.153073590523801e-03];
L2I_L2E_iAMPA_netcon = [+4.760554347639956e-03   +8.403419126219020e-03   +4.764174671021961e-04   +7.959021039914764e-03   +2.176124632733700e-03   +4.570583008270856e-03   +8.179415586715030e-03   -1.317469562016771e-03; +4.409252917033802e-03   -9.400605795912989e-04   -3.268304168352762e-04   +6.100995357187841e-03   -3.621306665953830e-03   -7.432417502763388e-04   -3.331901903270975e-04   +2.537544694464882e-03; +5.292986023763368e-03   -4.081635876009774e-03   +3.558928381218006e-03   -4.178176017455556e-03   -2.354580307521510e-03   +1.117601052662894e-03   +1.754685301385466e-05   -2.265372238151835e-03; -4.861749790452791e-04   +3.414313249453515e-03   +7.173571752804997e-03   -3.291287046622165e-03   +4.462964315588812e-03   +4.555387139373073e-03   +4.880586693562332e-04   +8.638115533972307e-03; +3.466524558809708e-03   -4.489670497830750e-06   -7.217232644285863e-04   -2.361664260982151e-03   +5.230336729108520e-03   +2.623839374418027e-03   +4.987070236878530e-04   +8.676381479150452e-04; -1.181389225319988e-05   -3.978911224832207e-04   +7.247107748334871e-03   +3.110340651851699e-03   +5.344542506611886e-04   +2.280610143225195e-03   +1.731475948486005e-04   +4.118771696252117e-03; -1.049461987998425e-03   -2.514023336330884e-03   -2.383909198443902e-03   +2.996939655998158e-04   +4.947915141305408e-03   +6.956699352182315e-04   -2.158509231310085e-04   +3.160358360838370e-03; -3.229111056094849e-03   -2.790555722029547e-03   -1.494944183510886e-03   -7.705629880002896e-03   +9.995958601350531e-04   +6.675766798856697e-04   +1.457232677760405e-03   +2.710062787817614e-03];
L2E_L2I_iGABA_netcon = [+2.460707100910683e-04   +1.497899400738749e-03   +5.876670926532945e-03   +3.046948375098710e-03   +7.137313246534227e-03   +4.490753886111490e-03   +1.338931780570509e-03   -3.296235431541090e-04; -1.152294773126226e-03   +4.140413718729183e-03   +2.895281976962378e-03   +9.251189860815497e-04   +2.238292500350478e-03   +4.264201297431153e-03   +5.518411530716961e-03   -1.904982248013943e-03; +7.584009532180813e-03   -7.934428527879374e-04   -8.525364743642823e-05   +1.518928589415141e-03   +4.174379873078151e-03   -2.987305413382925e-03   -3.751280940418133e-03   +1.474709186079603e-03; +9.757846042699152e-03   -2.985928223596720e-03   +1.059206050642129e-03   +6.565664043601276e-03   +5.828250368295288e-03   -1.326672899857244e-03   -6.166175113744824e-03   +8.053144124511007e-04; +3.301891859309290e-03   +5.773330111248415e-05   +4.946352780963266e-03   +9.214794900476631e-03   +8.417912411594949e-03   +4.266360445486724e-04   +4.482511511787565e-03   +5.388414880485443e-03; +4.382630466216002e-03   -1.624972491841687e-04   -2.099930273678887e-03   -1.876650134785978e-03   +2.056745055337172e-03   -2.264733969258065e-03   +9.236949208181085e-03   +1.417825086112614e-03; +5.463785247691535e-03   +6.433768852036096e-03   -4.810397221901960e-03   +1.563692552871947e-03   +2.265891559747873e-03   +5.664003415904834e-04   +1.836367803552395e-03   +4.631743292169551e-03; +2.416920840461363e-03   +2.846305150142545e-03   +3.567638163103087e-03   -2.573646109062327e-03   -2.305165785562748e-03   +1.845857179467038e-03   +5.170584500016760e-03   -2.842928217148270e-03];
L3E_L2E_iAMPA_netcon = [-1.478436192471792e-03   +9.330024105685309e-03   +2.437686963658505e-04   +7.913385706618584e-04   -3.338071424429029e-03   -2.026067549214474e-03   -8.851957486663857e-04   +5.914657484787938e-03   -2.611722168354752e-03   +2.067843495178504e-03   +4.058643531150280e-03   -1.600197306929376e-03; +5.441562795195686e-03   +3.824172614010867e-03   +4.778662399220271e-03   +1.518403829617022e-03   +1.258269908591761e-03   -2.721802142308972e-03   -1.022600781790733e-03   -5.601642306528798e-04   +2.100505255375172e-03   -1.270628539892342e-03   +2.020958634437926e-03   +2.292353075209588e-03; +1.888700910166323e-03   +4.110563456607850e-03   -4.856560778762208e-04   +3.097452830829783e-03   +2.038313029410987e-03   +1.610901364773213e-03   +2.075682600455470e-03   +4.072081393610867e-03   +1.506146701423222e-03   +3.755867653860996e-03   +1.863539654603054e-03   +6.125557494659127e-03; +9.697136223227145e-04   -2.747890124147914e-03   -7.443913751993515e-04   +1.122211555936663e-03   -4.613242669647993e-03   +2.387464263680762e-03   +5.532059649730192e-04   +4.408019624732158e-03   +5.465842013043617e-03   +6.388993107713507e-03   +6.114040661286223e-03   -8.944643176604942e-05; -1.794545813273069e-03   +2.616068499621122e-03   -2.257348288323481e-03   +7.376768894533333e-04   -3.870707692799779e-03   +3.499548908164151e-03   +4.471916655508372e-03   +1.137381150096941e-03   +3.238036990438391e-03   +9.123647793459890e-03   +1.657738723602219e-03   +3.405016778115779e-03; +2.660993508684909e-03   -4.803900489641341e-03   -1.697190465778806e-03   -3.885017807539569e-04   -7.377766594543636e-04   +8.615672251573704e-03   +6.907511135586622e-03   +7.687760699411052e-03   +2.940549966169321e-03   -5.711921441732331e-03   +3.833187370464231e-03   +8.949856217460039e-04; +8.110720762193102e-04   +5.001609739258023e-03   +5.861896366091404e-03   +5.077114411028276e-03   -2.498476004447726e-04   +4.533756536083815e-03   +3.510761902421315e-03   +1.036085685711352e-02   +5.320441564206213e-03   +2.284650285860063e-03   +2.401487900198526e-03   -5.456392534080634e-03; -3.538952620630993e-03   -4.936558703246635e-03   +7.441088731224500e-04   +2.361869950169414e-03   +9.888820596280256e-04   -1.139233674041294e-03   -3.794554193971435e-03   +4.542458345511486e-03   -1.126202890265557e-04   -1.094580965744153e-03   -1.896561777627047e-04   +1.108938934812353e-03];
L3I_L2I_iGABA_netcon = [+1.272883158601936e-03   -1.150830086207779e-04   -1.707052288158875e-03   +1.465212439615157e-03   +4.491877365772570e-03   -4.205100681841166e-03   +3.391805424584908e-03   -7.727426623815275e-03   +3.435448134899292e-03   +5.045621910061022e-03   -3.759163872247177e-03   +2.301815035625303e-03; +4.141288595513576e-03   -6.597497572366731e-03   +7.339332391578999e-03   -5.299037415488306e-04   +5.272853348592413e-03   +2.714161729017065e-04   +3.377567046217590e-03   -1.544736928379853e-03   +6.632258193201473e-03   -1.593353429741159e-03   -8.141538313235120e-03   +2.142503488945072e-03; +7.594319630109743e-03   +5.147372901343879e-03   -2.584458875461302e-03   +2.851282375579528e-03   -3.954547584464760e-03   -3.060294662081032e-03   +4.322510886152930e-03   -1.078324298907450e-03   +7.332263803585358e-03   +2.283754146461131e-03   +6.420012317509024e-04   -5.125651874768801e-03; +3.102084996569966e-03   +1.381394067630451e-03   +2.636686803231876e-03   -4.202787692392592e-03   -1.279192795336843e-03   +1.043816986849637e-02   -3.241412715198029e-03   +3.482673929454371e-03   +3.819937942610933e-03   -4.684515736851017e-03   +2.556257352490694e-03   +3.221875054688656e-03; +1.600326637767992e-03   +1.529412502327763e-03   +3.256971462527497e-03   +3.632898995522995e-03   -1.255071156858109e-04   +2.783790622832656e-03   -3.579960457862266e-03   +6.525640190558318e-03   +3.773312931387746e-03   +9.433144452086560e-03   -7.136742346081268e-03   -6.118662105098241e-03; +2.347634462265467e-03   -8.086392925316275e-03   -1.653541037777953e-03   +3.188470201264434e-03   +5.137089843757493e-03   +3.370463528654076e-03   -6.294589438766079e-03   +7.104741095499635e-03   -1.647766200290676e-03   +1.529965443041378e-03   -5.026198994421484e-04   -2.605236467495272e-03; -1.307241250129144e-03   +3.070890270501715e-03   -1.893350901413594e-03   -3.205815649014029e-03   -1.137462121329925e-03   +1.319677516598677e-03   +2.084490226648658e-03   +2.202454706439818e-03   -3.073283037631513e-04   +5.893012330726454e-03   +3.986110048004725e-03   +2.462198809077588e-03; -4.875744956518311e-03   +1.670132730003047e-03   +8.678634488602384e-04   +6.210395720754811e-04   +6.449938006469526e-03   -1.209624890303760e-04   -1.749905303030804e-03   +9.054605785100104e-04   +2.634807370736269e-03   -3.467300167181424e-03   -1.161236364886709e-04   +3.798882195181937e-04];
L2E_L3E_iAMPA_netcon = [-3.234933527509038e-04   +6.562849557031891e-04   -6.894668115288615e-04   +4.390588766003463e-03   -1.600577283446123e-03   +4.541971348598840e-03   +2.948999027620510e-03   +1.282229320829525e-03; +7.180288821417232e-04   -5.111425209819239e-04   +1.771220686962647e-03   +7.978537379717097e-03   +5.020676861443975e-04   +5.816681954397281e-03   +5.521627283793703e-03   -5.578701988079075e-03; +2.632006425590779e-03   +2.088731654794048e-03   +3.813071268826842e-03   +6.238851079851761e-03   +4.252624955434053e-03   +6.192019003612870e-03   +2.619804001860098e-03   +7.972120931108906e-03; -6.841395986036852e-04   -2.695193698042235e-03   -1.201702318667934e-03   +2.133597629636472e-03   +9.570938079700774e-04   +5.112789730830488e-03   -6.076763816708199e-03   +9.565305936220863e-03; -3.302710630665401e-03   -4.183670008617772e-03   -8.263142834111549e-04   +2.913665015202507e-03   +4.425567080917422e-03   -1.145323200212028e-03   +5.292669491620074e-03   -2.437002694340417e-03; +6.499577678668780e-03   +3.840446097310392e-03   -3.357097286215245e-04   +2.069784490539104e-03   +4.193139548314160e-03   +6.446592235505900e-03   -5.677413034674179e-03   +1.104436747366732e-03; +3.698330627795969e-03   -1.258349743784237e-03   +1.250647748482723e-04   -6.190635678382628e-03   -1.095010976580904e-03   -2.322714197134158e-03   -1.473360107805269e-03   +4.488888016066195e-03; +5.002044335000369e-03   -2.678872349597006e-03   -1.216382044787045e-03   +2.061073379741478e-03   +5.114121552368720e-03   +3.188782753716359e-03   -1.342177750158341e-03   -9.482519470805212e-04; +1.469315244577853e-03   +1.191101645932882e-04   +3.200782430930403e-03   +3.100147579453123e-03   +2.367658180828455e-03   -4.846750196995428e-03   +2.885515943797573e-03   -4.264001471083168e-03; -4.947382019635186e-04   +2.098887709608345e-03   +1.274489203445208e-03   -7.571893571902304e-03   +4.738881005240669e-03   -2.702355028101776e-03   +3.081679026055667e-03   +1.323966478495727e-03; +5.689381660993141e-03   -1.572736937675012e-04   +4.046428309757693e-03   +2.572966643335069e-03   +6.448429895669988e-03   +6.313716803802738e-03   +1.683842373014034e-03   -3.745158705924421e-03; +5.288545045906519e-03   -1.511122251390473e-03   +5.983369203446713e-03   +6.888556125865574e-04   -1.201160378825116e-03   +5.825040332629403e-03   +1.048335888705268e-02   +1.023269973096840e-03];
L2I_L3I_iGABA_netcon = [+2.568024216923947e-03   +3.995831731934662e-04   -2.928261682157588e-03   +1.554396392220892e-04   +9.490754683936776e-03   +8.547957841108092e-04   -1.226628322487992e-03   -1.555553523863748e-03; -1.671146710308441e-03   +5.253451785181623e-04   +4.735236891067542e-03   -4.320105723866875e-03   -3.546915615825615e-03   +3.874294668863073e-04   -5.159140547814970e-03   -4.222775591000013e-04; +8.534879213850004e-04   -2.814069722157089e-03   +4.400892624132161e-03   -1.541595375817276e-03   +3.744671994484708e-03   +2.484972435917296e-03   +9.566494346657167e-03   +2.258094623662754e-03; -3.174077924278824e-03   +6.097539946260847e-03   -5.027180051489823e-03   +7.449692874263813e-03   -7.314151199598400e-03   -1.758129998665066e-03   +4.927006842611638e-03   -3.889226804026513e-03; -2.729825582778300e-04   -4.836116433066174e-03   -3.671729287424018e-03   -2.072259538397680e-03   +2.766524298925526e-03   +2.711063892142780e-03   -1.911035368472022e-03   +4.400679773535036e-03; +7.414497051481102e-04   +2.765071641067194e-03   +4.278403076082622e-03   -2.530322692232515e-03   +2.090686339003041e-03   +5.030950344395279e-04   -5.014554201609902e-04   +5.969500235235157e-03; -1.573124047140089e-03   +5.131660496715597e-03   +6.282090377775947e-03   +5.801487577761879e-04   -2.810929351935476e-03   -2.831693306762672e-03   +4.118204148068953e-03   +3.978512243753689e-03; -5.934999591367026e-03   +2.892830978766943e-03   +7.386475201405368e-03   -2.181375693028864e-03   +1.122978276216969e-03   +6.240599507533734e-03   +2.141796352182578e-03   +4.636334904765175e-03; +5.364999173735091e-03   -3.763263053420176e-03   +1.074671329527460e-03   +5.230438293353538e-03   -2.496587428581630e-03   -3.432473237514741e-04   -1.011369540500623e-03   +4.779207163072135e-03; +4.728138568211885e-03   -1.385559996035517e-04   +4.761881353622535e-03   +2.265629763487900e-05   +7.631344351890912e-03   +4.669822856889227e-03   -3.176006756164623e-03   -7.831536601423446e-04; +2.981661200127805e-03   +3.202036652985334e-03   +3.338350781812824e-03   +1.687845544186134e-03   +2.009574208605492e-03   +4.135541487595712e-03   +4.934359785905280e-04   +6.966402536126482e-03; +1.780447246982564e-03   -4.043698162920236e-03   +6.648882157607970e-05   -7.497952511038783e-04   -1.517030267231587e-03   +4.247119147973877e-03   -1.581360196140575e-03   +5.225751226763521e-03];
L3I_L3E_iAMPA_netcon = [-8.549726370858217e-04   +3.867450125594544e-03   +4.700169305951267e-03   +3.015743377034003e-03   +7.538736242771871e-03   -1.213127653457899e-04   -1.243072537044076e-04   -5.464661056175577e-03   +1.204813340033629e-03   +3.436989085777400e-03   -1.793216775622398e-03   +1.635740411228961e-03; +1.392169556012650e-03   +6.861837695556544e-03   +3.567328291100135e-03   -1.147827619501502e-03   +1.140230655359682e-03   -7.050499904709155e-04   +3.563630137740177e-04   -2.589158523000179e-04   +1.256616060158174e-04   +2.624239833209470e-03   -1.181517793660326e-03   +6.797964915642000e-03; -2.228843232969349e-03   +7.005885839679976e-03   -3.131471163794679e-03   +3.100465194315704e-04   -5.973739963251441e-04   +5.764573761726702e-03   +4.777097247597616e-03   +1.189838178088879e-03   -2.426174671855598e-03   +2.723251395472564e-04   +7.094680089108592e-04   +1.752278080187273e-03; +4.292228390872795e-03   +2.364148401238461e-03   -1.933066135070513e-04   +1.302382286597477e-03   +8.774120974703620e-03   +4.712486017684798e-03   +2.479005140132317e-03   -4.249001004431314e-04   -2.256391955967558e-03   +7.143297373889636e-03   -1.829210788263026e-04   +6.888895455395243e-03; -4.871558319777666e-04   +5.545910209074783e-03   +5.769274323700539e-05   -9.159076116729559e-04   +2.097345608179030e-03   +4.405964322120414e-03   -3.924500501107406e-03   +1.254260977652011e-03   +1.439961480823286e-03   -5.385127773454342e-05   +5.859629276263044e-03   +4.794849543024720e-03; -1.565641999002986e-03   +2.886528259609469e-03   +2.788363186020589e-03   +7.648884290334239e-03   -2.121337143997639e-05   +2.770432938093130e-03   +6.220189952144912e-03   +3.155507658714886e-03   -6.097464199349438e-04   +5.536273845529162e-03   -3.626234586310059e-03   +3.558275814408737e-04; -4.075260482688547e-03   -4.164099644962565e-03   -3.399919473071731e-03   +3.829389378393993e-05   +1.972544380313638e-03   +1.199692002409569e-04   +3.156096727438720e-03   +4.806384813056818e-04   +4.325609895818620e-03   +1.428592421972547e-03   +2.542471659815848e-03   +6.756239152983697e-03; +5.092757659924917e-04   -4.093102977523092e-03   +3.425847528594388e-03   +2.872761298463945e-03   -1.235816321551448e-03   +9.145151778316950e-04   +5.533398990060361e-03   -5.988737031744233e-03   +7.094325309072299e-04   +1.613251420667559e-04   +4.699024736666786e-03   +2.663271555141289e-03; -2.639487909164948e-03   -7.575648597619284e-04   -2.664484300691533e-03   -1.494649800771916e-03   -9.578591228373743e-04   +4.607066925017729e-04   -3.962961035699301e-03   +8.656990953037802e-04   +2.751492554349025e-03   +1.698984715713904e-04   +4.887368419933515e-03   -3.075010234771079e-03; +1.760307599479827e-03   +5.474703687010236e-03   -4.871900418238480e-04   +7.885162605533900e-04   +4.778886613549086e-03   -2.827850950070047e-04   +2.750273073226039e-03   +2.570598758656655e-03   +2.851140638136802e-03   +5.942276094838932e-03   +3.929210703625127e-03   -4.865625616121765e-03; +4.915582704253293e-05   -1.602815903458963e-03   +5.167147631079975e-03   -1.466196961989524e-05   -5.979179902317811e-03   -5.570480382883561e-03   -1.593940771296110e-03   -1.539075923631062e-03   -6.565538646128308e-05   +4.009362856924362e-03   -7.700981961144568e-04   +6.904957845827077e-03; -3.665255791618429e-03   -3.272961834223698e-03   -7.998984315541620e-03   -4.758322897794836e-04   -3.005885128366339e-03   +1.984912871727947e-03   +8.521509478778026e-04   -3.619234441583163e-03   +2.680249607684741e-03   -4.472648127207205e-03   +4.364789503222343e-03   -4.391167266031515e-03];
L3E_L3I_iGABA_netcon = [+8.182040753282201e-04   +8.555756410982759e-03   -7.006232464004296e-04   +1.143083501085559e-03   +1.616806935875763e-03   +7.626543540348606e-03   -7.803313194845950e-04   +1.702626556255123e-04   +3.838047267813910e-03   -1.909752739357045e-03   +1.737510597066557e-03   +1.306822973817832e-03; +2.031235277595211e-03   +1.170135523239275e-03   -1.747068128761818e-03   -6.123588491800669e-06   +3.088848366658494e-03   +1.923909883366137e-03   -2.123089227890561e-03   +8.437979735621758e-04   +2.436272431250403e-03   +5.901245263515448e-03   -3.331641674802353e-03   +1.037192371098956e-03; +2.096932437566625e-03   -3.768812022089152e-03   +5.163055600943304e-03   +1.160208879049208e-03   +1.036730673028914e-03   +3.514391995913810e-04   +4.069352578642120e-03   -4.781237958449557e-04   -1.660054389033255e-03   -6.286279908084718e-04   -2.719962999545158e-03   -2.855239001690131e-03; +2.508715143047029e-03   +4.809144917989684e-03   -4.965857951004606e-04   +8.069602594777084e-03   +4.340639266182663e-03   +2.450334434520569e-03   -1.001046980837605e-03   -1.569431100096058e-03   -4.935792049604420e-03   +9.294105210521528e-03   -1.811328250960169e-03   -1.984567756562606e-04; -9.485691549710241e-04   +2.537685196358389e-03   +1.826226910432312e-03   -5.076626141944919e-04   -2.463620037394379e-03   +5.399007670592985e-03   +1.116406851934789e-03   +6.766846520231812e-03   +4.109461634732402e-03   +1.275871783585532e-03   -4.037089064257206e-03   +5.310106733873512e-03; +6.333882089996241e-03   +5.870787842432659e-03   +1.036648209030402e-02   +4.149312549449254e-03   +2.555047096782986e-03   +5.459175265329286e-03   -3.033560305142425e-04   +1.026880433248538e-03   +5.899216135587738e-03   +6.952007586516434e-03   +3.226392065299569e-03   -1.728764714234647e-03; -2.111910256024055e-03   +2.864798787134697e-04   -1.808266594835346e-03   +3.847634622484789e-03   -6.874239300369168e-04   +3.674280342709950e-03   +1.113925505025597e-03   +5.079345477121761e-03   -6.064466914277109e-03   +1.259429779749022e-03   -4.221174567991815e-03   +6.398323818757330e-03; -7.377486547936692e-03   +1.948650929872071e-03   +2.474024424030526e-03   +7.353341445807416e-03   -3.887296465713320e-03   -1.268726422867136e-03   +5.978948207883537e-03   +5.848034556743186e-03   +3.383483947819787e-04   +4.689655554126169e-03   -2.926895886708169e-03   +6.820673925643968e-03; +6.519490022047590e-03   -3.724082452924348e-03   +4.381241782614523e-03   +6.219871528620625e-04   +5.018350182914980e-03   +7.970513899616727e-03   -2.750376065143116e-04   +5.335723829251211e-03   -3.783684403810910e-03   +6.176227170956696e-03   +7.427561231548151e-04   +4.230620941662345e-03; +3.955909133914010e-03   +7.933110658378042e-04   -1.115589642770193e-03   +6.777451784131796e-04   -2.041244722511407e-04   +5.878779194141458e-03   +2.830966457747164e-03   +2.527899985510543e-03   +3.661557259395298e-03   -9.171662697063902e-04   +2.977523435378261e-03   +4.479882388421382e-04; +5.112391077276911e-03   -9.408964308410634e-04   +3.894350942058131e-03   +3.648288101800322e-03   +2.597403856160737e-03   -1.573918296595749e-03   +5.091295978275146e-03   +4.987072005858821e-03   +5.907594775737921e-03   +6.277298742058023e-03   -4.753772884765937e-03   +4.597243159743592e-03; +4.019099400435006e-03   +6.697609412111604e-03   +9.617149529317381e-04   +7.338840920466925e-04   -2.657491798455747e-03   +1.120393116104833e-03   +5.373292786319084e-03   -5.283958081478588e-03   +7.381513027081850e-03   +8.447277559787907e-03   -3.632357859925895e-03   -8.675565032317885e-04];
L2E_Input1_iAMPA_netcon = [+2.720286224343415e-03   +7.813626382121287e-03   +6.574026842004616e-03   -1.042093878269831e-03   +8.469619073721235e-03   -3.756628909720043e-03   +2.170875840079840e-03   +2.856223449770599e-03];
L2I_Input2_iAMPA_netcon = [+3.602016890521072e-03   +5.437911968710731e-03   -1.445911366486175e-03   -5.043980462133885e-03   +2.002162991456762e-03   +1.988162837160686e-03   +5.612556923083589e-03   +6.428073001049371e-03];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
