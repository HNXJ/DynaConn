function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.705180143345322e-01   -4.775294844903387e-01   +6.452849905261724e-01   +4.396669178399674e-02   -1.052707451050105e-01   +8.146888469687134e-02   -4.109614788806867e-02   +7.540347518373151e-02   +5.061894283714391e-01   -3.401410944297824e-01   +8.688973142494414e-01   +3.973258242122065e-01   +5.124264924745037e-01   -7.093188844010598e-01   -4.717096264113494e-01   -3.942786179155756e-01; +3.678253985493373e-03   +1.060946045716702e-01   -1.415360963060610e-02   +1.149943659185789e-01   +5.205175598430554e-02   -3.685501014779600e-01   +5.658963595047040e-01   +3.961692004026071e-01   +2.492395993110209e-02   -1.695594517632596e-01   +8.933678232809135e-01   -5.688770882336533e-01   +2.371655062375511e-01   +3.518500929613197e-02   +2.294876166509693e-01   -1.251028111045595e-01; +3.337783287291548e-01   -3.456085269015924e-01   -4.441402237970458e-02   -3.684516512359722e-02   +2.703620583541511e-01   +1.968512655884975e-01   -3.055238937697288e-01   +8.250369687612015e-01   -3.232954477717193e-01   +1.810757751373670e-01   -3.875693187732601e-01   +6.180241177942751e-01   +3.087062724465635e-01   +8.298264346221252e-01   -6.414218272822452e-01   +1.743831039039593e-01; +5.196617569989098e-01   -2.030200927112426e-01   +3.510316568746319e-01   -6.534837385178500e-01   -1.634769381948237e-01   +2.402533228923198e-01   +3.297366664573221e-01   -2.156396566819881e-01   +6.553683376949372e-01   -1.803011535192321e-01   -3.901636519394491e-02   -1.567221344405272e-01   +4.754738467207653e-01   -3.136614962360106e-01   -3.884046308324108e-01   +2.820708757605900e-01; +2.424475875791489e-01   -4.325699597809072e-01   +3.255913060499295e-01   -4.952736106249877e-01   +2.128003641615754e-02   +4.719898668604417e-01   -1.138423451190165e-01   -2.521699440870973e-01   +6.552686592492546e-02   +7.084736877684444e-02   +7.543616303610309e-02   +1.079566976428941e-01   +8.585633342661296e-01   +6.075404202520239e-01   +1.437143537070830e-01   -4.911277048793531e-01; -5.975693231207153e-01   -1.696373193342047e-01   +4.044055154158746e-01   +2.665826643544230e-01   -1.174099640740564e-01   +6.878570598783253e-03   -2.920643335361911e-01   -3.895651417430240e-01   -3.916759332826195e-02   +5.804613651007164e-02   +1.374710685924100e-01   +3.169308560093960e-01   +9.377432479770405e-02   -1.924785785545888e-01   +5.624547331777158e-01   -5.134990495231124e-01; +3.848055631101236e-01   -2.798424333314499e-01   +4.086123968422553e-01   -3.159148834596844e-01   +5.482585283924748e-01   -1.239860174122270e-01   +9.362813013706993e-01   +5.275313253507973e-01   +4.669442192905233e-01   +4.728442442346572e-01   -5.724296625006505e-01   +2.698428512854611e-01   +9.998469330907152e-02   +4.876662110249977e-02   -6.985168204188074e-01   +2.831757792351335e-01; -6.684335751204207e-01   +7.412411928195393e-01   +1.856026844934238e-01   +6.001872592501643e-02   -2.735111557913085e-01   -3.608108298862815e-01   +3.736036442762656e-01   -5.468712705375222e-01   -1.411715850831728e-02   -5.147662091109699e-01   +6.656317932586062e-01   -6.628196126347300e-01   -2.495752823981049e-01   -1.626956165040416e-01   -2.685495534430412e-01   +2.111462253372152e-01; +6.790054836978018e-01   -2.270512942725051e-01   +1.603385223521791e-01   +3.475373339069261e-02   -1.055837717100511e-01   -2.061148432972622e-01   +2.370656758051831e-01   -5.425237337978621e-01   +8.142380573831144e-01   +2.609753986350170e-01   -5.270290083546719e-01   +3.246271708026488e-01   -7.238513407224031e-02   +3.006700979050410e-01   +4.318375486897372e-01   -3.464668490685154e-01; -2.299053154833598e-02   +3.920731851297585e-01   -9.095753116556837e-03   -1.432975403291607e-01   -4.983309402197260e-01   -2.696620801393030e-02   +1.130304776419064e-01   +3.703916196562386e-02   +7.119539543138029e-01   +1.225571494324241e-01   -2.069004096195862e-02   +9.055722030630570e-01   +3.110360021945455e-01   +5.401042978957900e-01   -7.440665485306861e-01   +3.748049567145374e-01; -5.521220607338336e-02   -2.390143755694125e-01   -4.205813595379415e-01   +9.100425298610042e-01   -3.642391483697553e-01   -4.376548113634858e-01   +3.081503197628109e-01   -4.139547883528132e-01   -1.000000000000000e+00   -5.814576295117631e-02   +3.857305929213592e-02   +7.650367192483556e-02   +8.405376978088724e-01   +3.556091676954021e-01   +2.988615461041119e-01   -2.329079443187966e-01; +9.911979297286269e-02   +4.718624455054664e-01   -2.755729230616079e-01   -4.963527963075962e-01   +4.356984994167053e-01   -3.282192754742941e-01   -5.185418815339061e-01   -3.827313973930309e-01   +6.597726790025087e-03   -3.467089760511787e-01   +4.669543776075164e-01   -3.929438004339234e-01   -2.134893531398718e-02   -4.633510789720076e-01   -6.282975381913463e-01   +2.428821771985525e-01; +4.329219871990398e-01   -3.774008413148663e-01   +3.463944456428990e-01   -6.699726016116496e-02   -2.650525211317046e-01   +5.618647825404207e-01   +5.351642053123210e-02   -7.033564943665681e-02   -7.964721303258205e-01   -9.156664143951875e-02   +2.909986212884531e-01   +7.944479720319212e-01   +1.434756240065760e-01   -4.281348116619532e-01   +5.046988276071419e-02   -1.337755030677878e-01; +1.222521646553044e-01   +3.271803296293562e-01   +3.831003046025668e-01   -4.140213396563794e-01   -3.802698214803685e-01   -6.592785569799553e-02   +3.334139024843890e-01   -2.888948488525015e-01   +1.298612331990684e-01   -7.975501560648190e-01   -2.513515338365606e-01   +7.436726206705428e-01   +2.142531129216183e-02   +8.604500547873365e-01   +3.006156257836445e-01   +6.726403744601862e-01; -5.163716466915202e-01   +4.062334907106951e-01   +3.858776493747711e-02   +6.851470045299454e-01   -4.425941891085718e-01   -1.250513484683182e-01   +3.619665959693793e-01   +3.294936838638042e-01   -6.061499138211373e-01   +5.535935559280619e-01   -6.535094220311292e-01   -1.544756042009426e-02   -4.648703547426837e-02   +3.165950838118625e-01   -2.883916884477434e-01   +1.833219136351981e-01; +8.205367531507799e-01   +3.157402212454785e-01   +8.600819834984439e-01   +3.491838797017733e-01   -1.605781747621455e-01   -2.807400275858210e-01   -4.868599792417490e-01   -4.592978730977090e-01   -2.222389949744887e-01   -7.897608446130505e-02   -9.120463862615578e-01   +6.337679832020758e-02   -7.913245062796141e-02   -5.629180192526677e-01   -3.062175154035834e-01   -2.543277309533095e-01];
L1E_L1I_iGABA_netcon = [-1.943180710527053e-01   +6.047722427118227e-02   +5.921159610217993e-01   -6.626860282309963e-01   -3.192099343230301e-01   -1.080139627683622e-01   +3.264379359837207e-01   +5.987509284310714e-01   -3.141779127267804e-01   -1.543013305339656e-01   -1.597444970051200e-01   +4.265106671579186e-01   +2.617220575671260e-01   +6.822354599982353e-02   +8.303232590130724e-01   -5.385401472085041e-02; +5.551785503464622e-01   +4.676601289474940e-01   -3.046181350883933e-01   +4.550410258805478e-01   -5.523173931885025e-01   -3.604048379541353e-01   -5.602251131152682e-02   -2.180181429217326e-01   +5.236102069730372e-01   -1.124730501695685e-01   +4.523335945888441e-01   +4.521279182998598e-01   +3.515586177518099e-01   -1.546762710363911e-01   -2.452804817737815e-01   +1.357024692338671e-01; -1.725547213040659e-01   -1.954994467327234e-01   +1.198096046840391e-01   +2.391197282176779e-01   -8.350502966572873e-02   -3.973659316212763e-01   +2.641520556504747e-01   -3.314759281337959e-02   -6.979140056959409e-01   +4.595192173008949e-01   +5.203041925086160e-03   -4.936456888712374e-01   +3.574049842873996e-01   +7.113107762986467e-01   -1.000000000000000e+00   +3.116494055213173e-01; +3.302379015182418e-01   -1.465635495235844e-02   +2.511879762284417e-01   +5.780257522797964e-01   +4.247874635004266e-01   +1.316366963138164e-01   -1.216727450694322e-01   -1.845273598285690e-01   +1.471888401295768e-01   +1.678450247975146e-02   -5.152463333603396e-01   +6.106057380737770e-01   +9.674199305212208e-01   +3.797617326509216e-01   +1.219782876175229e-01   +7.001840370500096e-01; -3.351395465048593e-01   +1.358941831379410e-01   +5.682142623141911e-01   +6.073323888871206e-01   +2.753334240715807e-01   +6.749956555162450e-01   -7.570127599529587e-01   -5.022581273272936e-01   -1.970279779103631e-01   +3.694531029294886e-01   +2.785202371544064e-01   -1.079621431743485e-01   +1.988556104039209e-03   +3.103158899895914e-01   -1.709268757130012e-01   -2.627998079477194e-01; +3.467698629339838e-01   -6.956000830385669e-01   +6.593970660296521e-01   +3.305146456505812e-02   -3.802366001946027e-01   +1.304299467453396e-01   -2.432460706931838e-01   +1.465723322533814e-02   -3.535925128817946e-01   +2.825273043560394e-02   -2.497366917252144e-01   +7.577136424453353e-01   +2.614979997557171e-01   +4.447268224336621e-01   +5.587226940133837e-01   -2.218784965201589e-01; +2.557800801964052e-01   +7.314870637662514e-01   +1.380082987318900e-01   +7.092561293023987e-02   +4.170628704228579e-02   +1.986393874528178e-01   -2.051358370595940e-01   +1.916516877833262e-01   -3.460339096401208e-01   +6.771008280021265e-01   +4.483170406312235e-01   +5.115345755242576e-01   -3.386084221895015e-01   -4.906263396446908e-02   -3.353609461817547e-01   -9.512483377799419e-03; -6.375419713187008e-01   +4.300392703957387e-01   -3.151964808661329e-01   +1.742870650531103e-01   -5.676875392281878e-01   +1.010548961368848e-01   +3.297250086322410e-01   -1.980801642737005e-01   +4.802918189874305e-01   -1.812725463239407e-01   +3.304161342544936e-02   +4.688530185727964e-01   -2.062417847960718e-01   +1.111705945059876e-01   +5.828791717035713e-01   -3.788090022501397e-01; +6.465672525434024e-01   -3.172806222635738e-01   +5.557823898359839e-01   -2.482114974664418e-02   -7.172740627612322e-01   -5.143720934959874e-01   -7.283430132194032e-01   -7.901986063650659e-01   -1.441255615612474e-01   -5.809247805529742e-02   +1.805337727330168e-01   -8.508198069370829e-02   +1.791641332255662e-01   +5.877658317335267e-02   +3.757424932218020e-02   -7.176788668096622e-01; +1.292235804918169e-01   -1.469201663811039e-03   -2.883813917714717e-01   -5.895462641158973e-01   +1.724558814770082e-01   -2.924433472910568e-01   +1.304041608706770e-01   +5.450306507418378e-01   +4.466172493274796e-01   +1.390804701946866e-01   -4.261917964080247e-02   +2.318292482055140e-01   -5.346591402384872e-01   -2.166001091858187e-01   -1.443014428475848e-01   +8.448800333196067e-01; +6.828916647946984e-02   +2.862455600504027e-01   +7.098296448021566e-01   +1.203932430786598e-01   -1.215071573312571e-01   +3.053496975337709e-01   +6.730260280816740e-02   -2.146564255734317e-01   -3.328926010484375e-02   +1.653372856637357e-01   -6.940897113343985e-01   +4.778610982671346e-01   +6.824033636827602e-01   +2.264683219457818e-01   -5.985695442565396e-01   +1.759764383564636e-01; +2.249820199742479e-01   -6.281040732796516e-01   -2.337216464384496e-01   -3.678228718000333e-01   +3.836908554475933e-01   +7.755530010559843e-01   +3.519830145860436e-01   +5.146911808538754e-01   +5.566031100811571e-01   +2.292698280006480e-01   +9.275566573266555e-02   +2.146548475045772e-01   +9.719148850062384e-02   -8.840995384982185e-02   +3.040684832733986e-01   -6.622510929255714e-01; -4.197102268738727e-02   -4.386186561844495e-01   +3.839649295458988e-03   -5.284552937681253e-01   +2.873894168369572e-01   +5.428847177514859e-01   +2.139560878181740e-01   +6.106440484795441e-01   +1.976577946977431e-02   +7.493424136669319e-02   +5.877247415616189e-01   +2.772220324835575e-01   +2.766001244230831e-01   -1.437260723337258e-01   -4.197846615288036e-01   -5.550597220052190e-01; +3.646342302914581e-01   +1.759785842764360e-01   -1.882029444662277e-01   -1.571949281708795e-01   -1.449012543720379e-01   -6.521030153008149e-02   -7.936326220146914e-01   +2.227466396763610e-01   -8.087756346200069e-01   +5.255217627979855e-01   +6.242843833409770e-01   -3.436372296922375e-01   -7.513247873562938e-01   -6.673602121839043e-01   -6.596867895359603e-03   +2.956173032799921e-01; -4.398911246478720e-01   +7.188355953451619e-02   +2.313919086817618e-01   +9.256460647490788e-02   +7.507749999981680e-02   +5.371690613010137e-04   +2.459122413066629e-02   +1.966310262594708e-01   -8.183059991368848e-02   -2.026734739677255e-01   -1.019511227651885e-01   +9.937699381205820e-02   +2.315296293639659e-01   -2.317749380140800e-01   +8.521256435402207e-01   +1.717891635938955e-01; +3.986006569621949e-01   +4.279298231738459e-01   -1.487512432928693e-01   -1.298997172282733e-01   -7.139840721346650e-01   +5.862215122273757e-02   -3.586590423128155e-01   +2.469849378643146e-01   -2.641315729345109e-02   +3.218222051687695e-01   +2.585918896986709e-02   -3.989131468308937e-01   -2.458175201907039e-02   -7.485069708983995e-01   +7.225637555720675e-01   -3.625934487612698e-01];
L2I_L1I_iGABA_netcon = [-3.513418472407277e-02   +6.345891804118063e-02   -2.462790044138786e-01   -4.449157250012775e-01   +4.818408999447593e-01   +1.001087569188497e-01   +5.424322734158286e-01   -4.458781421904010e-02; -8.785417038100501e-01   -1.038368596388278e-01   -1.541340134377321e-01   +5.466808059378567e-01   +3.996580427710125e-01   +1.613960541102845e-01   -2.432523765679356e-01   +5.811055672085191e-01; +7.536882026528909e-01   +5.515836529261308e-01   -1.731994219996373e-01   -4.418086447739871e-01   +1.799270612159429e-01   -6.275439625172575e-01   +9.224991933278091e-01   -2.373625330969380e-01; +5.725250145453470e-01   +1.075413468733219e-02   +6.118909829291606e-01   -5.528890367593665e-01   -6.922985644767173e-02   +1.191113638927734e-01   +4.014680713745170e-01   -1.000000000000000e+00; +3.308841577870447e-01   -1.921119365691203e-01   -5.421590812221407e-01   +7.830776115145424e-01   +1.346890471076077e-01   -3.132983674169848e-01   +1.241239139002704e-01   -5.436166076574813e-01; -5.182291319500771e-01   -9.378687546504939e-02   -8.708679013234086e-01   +5.698708253002448e-01   -7.833674682289106e-01   +8.168003816247438e-01   +1.107223086621111e-01   +5.358663141303744e-01; +4.482952125475281e-01   +4.452465371979854e-02   +3.054595430086861e-03   +1.269485591299336e-01   +1.673352742098471e-01   -2.536223310113275e-01   -5.765501744885915e-02   -7.328694164878601e-01; +3.876809508362336e-01   +4.147293522493177e-01   -3.865713529992789e-01   -6.194562668532567e-01   -1.683757442051091e-01   +6.543903009714238e-01   +8.392378064679299e-01   -6.947928712303351e-01; +2.010930659262934e-01   +1.908208728742803e-01   -2.902779970811502e-01   +2.190954782471833e-02   +9.621161068484515e-03   +4.113217065503824e-01   -5.319883563007970e-02   +1.096946943113880e-01; +5.356492842275969e-01   +2.424577299189834e-01   -5.287182612240818e-01   +5.869650669838894e-01   -2.609740241683628e-01   +4.025690724249809e-01   -1.142902211868931e-01   -5.541923473268962e-01; -2.929162744524546e-01   -2.619014262735398e-01   -2.714699844441779e-02   +7.629316687661535e-01   +6.284350707957880e-01   -1.932391107489362e-01   +5.993948261363837e-01   +1.302315037552573e-01; +6.209013011813140e-01   +7.290900559474124e-02   +7.267174163689647e-01   -2.586428357143508e-02   -6.374768063282786e-01   +4.400386239039861e-01   -3.213127264584709e-01   +3.949857095568457e-01; -7.647450609501389e-01   -3.706578546478915e-01   -1.496194982585732e-01   -2.289713389312519e-01   +6.469650952489667e-01   -2.305388183088190e-01   +7.412044666284171e-03   -1.388438962659896e-01; -7.138453697796940e-01   -5.822478219475598e-01   +8.031933116200933e-01   +8.740984985691801e-01   -1.852673388073299e-01   +3.161468428751890e-01   -4.680157701489828e-01   +5.140349116562988e-01; +3.047293764679638e-02   +7.358862777646675e-01   -3.645459981365119e-01   -3.885617875929392e-01   +8.228091408660856e-01   -3.151948793178634e-01   -2.487035218334483e-01   +4.211896384045229e-01; +3.680363389037844e-02   +3.653785685254629e-01   +2.737026542711095e-03   -4.413861909334033e-01   -1.303133239444572e-01   +7.004273692942519e-01   -2.991972048703885e-02   -3.031837092706691e-01];
L1I_L2I_iGABA_netcon = [+5.549263173461765e-01   +9.282601843593051e-02   +5.275266145228663e-01   +1.000000000000000e+00   -3.996786130144062e-01   -8.177326421415185e-02   -7.041457811164363e-01   +6.006824406818150e-01   +7.727423883405006e-01   +2.468664998857271e-01   +6.309933369701980e-02   +1.491659859933676e-01   +3.878021138075772e-01   -3.285466105230046e-01   +7.568010283473909e-01   +9.338559721377691e-01; -2.533991799436682e-02   -9.269373258993908e-01   +5.338269222285755e-02   -1.387025734399593e-01   -3.540495746128274e-01   +5.269768511025325e-01   -4.288955673673162e-01   +5.320181926955355e-01   -4.038332202796403e-01   +3.676586637731526e-01   -4.224288536682549e-01   +8.630270753202055e-02   -2.214578762738106e-01   -5.033031371256091e-01   +8.052580401504807e-02   +1.163733936866605e-01; -2.307503569702073e-01   -1.252694242445085e-01   +2.206465391658585e-01   -2.431236932233534e-01   -6.857742092298029e-02   -2.897519948806376e-01   +2.841764409210304e-01   -2.386730618400595e-01   -3.721662808008699e-01   +6.061986582168770e-01   -1.245950656968712e-02   +3.040548197146708e-01   -8.489482378450178e-01   +3.345432365894415e-01   -5.045971191713243e-01   -3.960680230434510e-01; +1.204105155657040e-01   -1.051808348350319e-02   +5.811900806077814e-01   -3.073707420920366e-01   +1.897475508470491e-01   -2.683170537148510e-01   +3.003105198930009e-01   +4.316783229852649e-01   -3.907024563918831e-01   +5.464539722973470e-01   -1.128618821124868e-01   +3.098318900499303e-01   +2.674120811417445e-01   +5.396279852808253e-01   +2.222828544644968e-01   -3.702653228391460e-01; -7.215989735804833e-01   -4.279372285682813e-01   +4.068268900583293e-01   -2.840179192089230e-01   -1.567679373319929e-01   +5.877511324650110e-02   +5.768605935814496e-01   +2.119607942167977e-01   -2.221112426681115e-01   -5.438517488541434e-01   -1.474767937693792e-01   +6.520538715340879e-01   +3.303192395830801e-02   -1.768373930410101e-01   +2.841151407673531e-01   +1.450577028439643e-01; +8.646293669036036e-01   +9.501716018586901e-01   -5.822361233046029e-01   -3.268511454004699e-01   -1.677032362892221e-01   -1.243161923171543e-01   -8.172994965352146e-01   -3.608134368713481e-01   -6.407124117528405e-02   -2.223525758344778e-01   +3.500095350105281e-01   +4.630308299936428e-01   +5.619803342672675e-01   -2.522214864253134e-01   -4.782034448751864e-01   -5.791472415668646e-01; -2.841915990082495e-01   -3.435297608610027e-01   +1.022377271688414e-01   +6.768430300008514e-01   +2.762187855511828e-01   +1.106419729648926e-01   +6.029570427340077e-02   -3.294097756418612e-02   +1.822303787022704e-01   -4.382329552713560e-01   +7.308898364024446e-01   -2.978035767627146e-01   +7.625683604050938e-01   +4.885630224769786e-01   -2.316902610585244e-01   +8.681015246601086e-02; +6.178003572244630e-01   +2.898995542817522e-01   -2.212161144052655e-01   -1.901115066360605e-02   -2.313446070305108e-01   -2.790737280053676e-01   -7.516688477878106e-01   +1.550544747748227e-01   -3.444111652263855e-02   +2.074647854081133e-01   +1.551864356429954e-01   +1.637107786615546e-02   +6.194378026493225e-01   +1.044319625969155e-01   +7.614918511383818e-01   -6.777738703815450e-02];
L2E_L1E_iAMPA_netcon = [+3.610123096976447e-01   +5.578342340259110e-01   +3.179470274803478e-01   +4.983433898654989e-01   -5.646892182976270e-01   +5.799169629938090e-01   +3.588664026035057e-01   +2.446490312207080e-01; +2.330524216948593e-01   +7.008720207303996e-01   +2.726195379522289e-01   -9.072356329630419e-01   +2.084778837399339e-01   +6.296924351648517e-01   -3.007321150857794e-01   -2.011978148849256e-02; -7.856387751296097e-01   +4.260714520270000e-01   +6.782344646262697e-01   -7.208024500065302e-02   -7.183058749394852e-01   +8.774367760616222e-01   -4.944396012351903e-01   +3.358253822915586e-01; -1.542382737253837e-01   +1.081049033244442e-01   -5.133943864462082e-01   +2.942067780383228e-01   +8.422429029126831e-02   +2.701604214843074e-01   +2.875300441149302e-01   +1.323992538575013e-01; +2.533921272347652e-01   +3.275388226363682e-01   -5.000163856512346e-01   +5.075223817670751e-01   -7.106104198993138e-02   +3.802766899953312e-01   +3.727955467052835e-02   -1.192410971826856e-01; +3.680942308491003e-01   -4.461826200680477e-01   -1.481304030183929e-01   +4.785158522821624e-01   +1.991210142961038e-01   -4.243825418819347e-01   +3.818251184077748e-01   +1.813701650177555e-01; +8.302388699394142e-01   -1.969992456300996e-01   +2.928641633495522e-01   +3.392034705282645e-01   +7.620556296347709e-01   -2.795284830517739e-01   -2.007090600133582e-01   -1.500202074127349e-01; +4.967605846530347e-01   -5.084195592653771e-01   +4.621135511161633e-01   -5.596740689612254e-01   -2.575120970581161e-01   +2.293102079668702e-01   +8.421036229881538e-01   -5.374718236382799e-01; -1.921390483892564e-01   -2.670287867504468e-01   -6.756336103693728e-02   +2.906221158545602e-01   -1.018332189244321e-01   +3.760895294045813e-01   -6.139623350855684e-01   +4.019221896493991e-02; -3.012182385288078e-01   +2.208291786427088e-01   +2.279377399368448e-01   +1.157140111810462e-01   +5.986272820916776e-01   +1.762871919220829e-01   -3.916566152779480e-01   +3.743060174847284e-01; -6.608983638760058e-01   +5.881445846322921e-01   +2.091532516138684e-01   -4.326277160100639e-02   -4.417725423449275e-01   +3.948633332827691e-01   -5.517578414160679e-01   +4.375933811484951e-01; +4.620293057403649e-01   -1.155638754823332e-01   -5.300016770483325e-01   -6.124998808441866e-02   +8.134265104011820e-01   +3.167901846480392e-01   +4.474787699116087e-01   +5.891934818647484e-01; +9.937683685098397e-03   +4.031343718586835e-01   +3.710225941601817e-01   +4.394088083404239e-01   -2.291864626884169e-01   +3.132740507077406e-01   +4.691421404712635e-02   -4.841754559170107e-01; -9.138218694780702e-01   -2.928073755430750e-01   -1.388005225120009e-01   -6.931457543567425e-01   -5.996365875233064e-01   -5.755774407955394e-01   -1.969402966780907e-01   -6.311330890491086e-01; +2.599709499081908e-01   -7.337703441111204e-03   -6.308942360877224e-01   +3.805246965063626e-01   +2.038778252719841e-01   -2.605033402226609e-01   -4.744323147615959e-01   +4.073871132124516e-01; +5.044186704999321e-01   +1.197928263742193e-01   +1.468658924410139e-01   +4.760037778353128e-01   -4.815693055256935e-01   -2.321324019910386e-01   -1.452733153353450e-01   +4.672799134986004e-01];
L1E_L2E_iAMPA_netcon = [-3.992988275468119e-02   -1.340569540202412e-01   +3.773858834031103e-01   +5.076291678743121e-01   -1.209034531602617e-01   +2.581517446380881e-01   +2.891334166675232e-01   -3.743036662070238e-02   +1.369222862259370e-01   -3.435725475032326e-01   +5.276219376067977e-02   -5.872497816902660e-01   -5.167801548586501e-01   +2.515030345317728e-01   -1.466923629340426e-01   +5.138398883175815e-02; +9.302146718295394e-03   +1.946176234413185e-01   -1.530761173864861e-01   -5.556176086002075e-01   -6.274472559243143e-01   -3.480167955705323e-01   +1.062180688176091e-01   -4.361921929447904e-01   +7.640150456501512e-01   +1.645411517918539e-01   -7.867513151599415e-02   -8.570539969898575e-02   -2.661438787482695e-01   +1.416459996521907e-01   -4.755984089489252e-01   +3.101323315530510e-01; -5.954740437240933e-01   -3.231384344364512e-01   +2.896237044108383e-01   +7.748428823543314e-02   -4.280445241729148e-01   +1.844191776073038e-01   +4.152121123681964e-01   +1.552554191011231e-01   -6.529022795919051e-01   -1.644685239103866e-01   +8.475435799948611e-02   +3.507508661272418e-01   +5.668632302064578e-01   +8.660663032450723e-02   -1.454170291441860e-01   +5.209481173320175e-01; -1.757041154505003e-01   +1.672591196243245e-01   -1.400192591845476e-01   +1.491652815504713e-01   -4.021044807230966e-01   +2.660181579663123e-01   +8.831706698495083e-02   +1.749127449421954e-01   -7.189312113541551e-01   -3.744240970490953e-01   +1.666525992541893e-02   +3.068240126334278e-02   -7.058883685128321e-03   -8.439360986938954e-03   -3.829802288571897e-01   +2.616862130820002e-01; +2.649827686441877e-01   -2.185069126325946e-02   +1.952264062798621e-01   +4.049104037853825e-01   +4.020587077264842e-01   +8.324276355010810e-02   -4.106317688875582e-01   +4.123022792148645e-01   -1.787796833068348e-01   -1.197508239491317e-01   +1.184581399155731e-01   +3.057158819095795e-01   +4.809244635038488e-01   -1.071173648185876e-01   +3.398493246812982e-01   +1.342492431945798e-01; -4.556805388817599e-01   +4.403609954351485e-01   -1.069105720898597e-01   +5.503616417455760e-01   -6.699541874821392e-01   -5.011878927524949e-02   +6.667189772703849e-01   +2.259510805598839e-01   +5.059176914772342e-01   +8.023180019642936e-02   +5.869337485246580e-01   +3.515443621410327e-02   -7.516197765560395e-01   -2.378211469243067e-01   -3.964055665479215e-01   +6.160161608797288e-01; -3.998442714382506e-01   -3.453432939202399e-01   +1.409186123740308e-02   +5.254158080693753e-01   +1.390728037018861e-02   -4.280697743067505e-01   -6.023529973940357e-01   -1.000000000000000e+00   -3.959994374510944e-01   -2.461006898019697e-01   +9.698048582239026e-01   -4.200513004815213e-01   -2.418087536699630e-03   +2.576097564743812e-01   -2.912278275395398e-01   +2.809278880218718e-01; -5.417634964703986e-02   -2.602424464151328e-01   -3.222836779822104e-01   -1.015346838711145e-01   -2.369368639745391e-01   -5.018403937981690e-01   +4.527932437520115e-01   +5.865434321358677e-02   -2.087637109782832e-01   +3.538251996498372e-01   -2.122886298717294e-01   +4.717711150911669e-01   -6.904079142037872e-02   -2.542638982124025e-01   +3.493924529581079e-02   -1.595316013229764e-01];
L2I_L2E_iAMPA_netcon = [+1.465002297728009e-01   +4.110593936488320e-01   +1.987578188220492e-01   +2.582143456402647e-02   -2.629152730708594e-01   +2.429014651173748e-02   +4.461104945999566e-01   -5.910865101082320e-02; +4.836523903272089e-01   +5.806242002724236e-01   +1.000000000000000e+00   +4.635989524536667e-01   +4.816327406630362e-01   -1.696510411808564e-01   +2.563226121001603e-01   +2.622843114185729e-01; +5.468159508291252e-01   +8.828521163724529e-02   +1.692946470103559e-01   +4.522816211418481e-01   +3.024743185363002e-01   +2.345125721310243e-01   +2.362175001228875e-01   -5.532373337811360e-01; +3.338184951066372e-01   -5.877523062024786e-01   +6.328871852247975e-01   +2.054857853721018e-02   -7.794473366853567e-02   -2.700058467016581e-01   -3.048509574614137e-01   +6.895981596483014e-01; -9.347171174786407e-01   -1.271339736225909e-01   -1.340188180817572e-01   -6.706878349419689e-01   +2.990471317773946e-01   +7.144566335132052e-01   +2.828403156823031e-01   -8.055037576083713e-01; +3.150958875299245e-01   -6.838775832540304e-01   -1.582190559495270e-01   -2.189394889568040e-01   +5.370171166589496e-01   +2.034877068178205e-01   +2.855238209630590e-02   -2.899702434092963e-01; +3.594576991855309e-01   -8.240659578869109e-01   -2.300861170680736e-01   +2.817610086538657e-01   +6.780173895373959e-01   -1.098123430299155e-01   -6.132857379107776e-01   +9.544996852288171e-02; -3.248693066509752e-01   -1.103996243706757e-01   -6.035133667608533e-03   +2.269629018869277e-01   +3.619889351759633e-01   -3.049454218665097e-01   +3.191318452239819e-01   +1.630934537073369e-02];
L2E_L2I_iGABA_netcon = [-5.085367256951171e-01   +3.252798635799176e-01   +3.156804500242535e-01   +1.508376882043716e-01   +3.973195951615374e-01   -1.119060251145842e-01   +2.853060267674075e-01   -5.629294528475580e-01; -1.299590105612446e-01   -1.571867535027251e-01   +7.037603426397383e-01   +1.112076136645724e-01   -2.734824655952123e-01   +1.508911203079091e-01   +9.245261997521578e-01   +2.450447945725123e-01; +8.445353155504295e-02   -2.411091885802498e-01   +1.000000000000000e+00   +5.606708586540882e-01   +1.579631652637508e-01   +6.142383949509127e-01   +4.233539184713679e-01   -1.774514088069033e-01; +8.809155604163877e-01   +2.425347685166620e-01   +8.515084170320934e-02   -9.612999261299590e-02   +3.074250358379853e-02   -1.972466603690131e-01   -1.188672976155868e-01   +8.250854624471234e-02; +8.305820103518121e-01   -3.158235198744573e-02   +7.050138754150211e-01   +2.171061844001978e-01   -5.944305693685858e-01   +5.657266632363075e-02   -8.919575912415529e-01   -4.498935730634876e-01; +6.345799866796205e-01   -1.790995618013852e-02   +2.935278605445431e-01   +3.336180022670658e-02   -6.865220191969368e-01   -3.057758114382179e-01   +1.578675996467587e-01   +8.929900000668854e-01; -1.709150813755353e-01   +3.131900502190728e-01   +5.012267767486283e-01   +6.320121425730582e-03   -5.492151033709274e-01   +3.870863429804713e-02   +6.260245526044284e-01   +9.004176777027190e-02; +4.957674641697666e-01   -2.524937932356521e-01   +4.809431403003191e-02   +8.294180118440682e-01   +1.305126631140206e-01   -1.191382704869024e-01   -2.917077253287315e-01   +1.121407346252990e-01];
L3E_L2E_iAMPA_netcon = [-1.364317453608153e-01   -7.388234128582137e-02   -5.128600143520506e-01   +4.046209488703049e-01   -2.480681625568357e-01   +4.196604482582806e-01   -5.962528418778766e-02   -1.344559902424100e-01   -3.316898006517078e-01   +2.905167552642718e-01   +3.731130693170860e-01   -2.471903474229731e-02; +3.815683807959004e-01   +1.352376490726528e-01   +3.664984796237952e-02   -2.596651964851318e-01   -4.863767772348075e-01   -6.658390508196693e-01   +9.229572435986327e-02   +9.216758541852922e-01   -1.160218605931456e-01   -1.392055876600557e-02   +1.845330485446919e-01   +2.674373468222675e-01; -1.943641076040120e-01   +2.755863904441930e-01   +8.582489697084571e-03   -2.451613376956864e-01   +3.720031567514555e-01   -2.021876188045202e-01   -1.970277377423506e-01   -1.978537561833519e-01   +3.362674893289879e-01   +5.628149517913539e-02   -5.604718289204089e-01   +7.494876310428183e-01; +2.047079730194391e-01   -2.446296729512385e-01   -4.858552596352850e-01   +2.109147604423720e-01   -4.386677217129983e-02   -4.948513722923585e-01   -2.905747006272852e-01   +4.109717101851639e-01   +4.881600949181745e-01   -5.603692807262967e-01   +2.438594831998890e-01   +1.000000000000000e+00; +3.488360645654090e-01   -3.064022029063195e-01   -2.698670963507254e-01   +1.790475832180579e-01   +2.919394587183555e-01   -6.558545086360323e-01   -2.100780414275485e-01   -8.631294520381562e-02   +2.341727671690113e-01   -8.520206655238292e-01   +2.152070918441752e-01   -7.559189340498911e-01; +3.519532727930381e-01   -1.398665783093467e-01   -1.345587191121117e-02   -2.366875987764066e-01   +2.071340755856668e-01   +2.735622058229033e-01   +1.201108270939728e-01   +1.846630514650572e-01   -1.554767611642641e-01   +4.930942916529540e-01   +7.310236323985950e-01   -3.630152969723292e-01; +1.528916120682371e-01   +3.967271034870773e-01   -5.435885892073794e-02   -4.030931241262982e-01   -1.188113431501513e-01   -6.996785525235781e-03   +4.361565259802027e-01   +1.080534323949863e-02   +5.115951829046534e-01   -3.641003222173597e-01   -3.777065135230583e-01   -2.834082646869563e-02; -1.277333179052563e-01   +8.733605696456806e-02   +3.658332956646503e-02   +1.971466250464358e-01   +4.936489172164362e-01   +2.636293266446020e-01   -1.162650179199189e-01   -5.362023942145223e-01   -2.108922008142580e-01   -3.885028199287573e-01   -1.750517301198143e-02   -4.709013088131933e-01];
L3I_L2I_iGABA_netcon = [-3.419531743296116e-01   +1.473387603230127e-01   +7.120409705969024e-03   -2.831186141801397e-01   +3.785977686329417e-01   -3.281410547120365e-01   -8.593532552623251e-02   -6.349226145423312e-01   +8.264999922898973e-01   -2.787947554983058e-01   +2.679806383133491e-01   -1.000000000000000e+00; +2.812472003949782e-01   +2.299608911694218e-01   -1.397178072783355e-02   +5.764566286341118e-01   +1.301450696642542e-01   +4.662568473656096e-01   +2.790658555245755e-01   +4.478476096961412e-01   +7.216541548617553e-01   -4.531351231864760e-01   -3.235584294027812e-01   +3.350686663754752e-01; -4.025989010493505e-01   -4.503703993902949e-01   -4.631012337879621e-01   +1.449302171868561e-01   -1.975928268541870e-01   +1.460167100069612e-01   -1.773343237599524e-01   -1.286487097306477e-01   -7.382346929353997e-01   +6.403332497049326e-01   -8.545371773347896e-02   +7.868427956113180e-01; +3.059798264777321e-01   +2.547577927510062e-01   +4.339742449188750e-01   +2.463617983895634e-01   +4.624579651398034e-01   +6.479075652512414e-03   +8.341951863536658e-02   -8.769829677082965e-01   +4.868493302876754e-01   +3.344407823162679e-01   -1.548077982158460e-01   +4.256536110531726e-02; +1.129307859570413e-01   +3.982144281644780e-02   -3.272287449084203e-03   +1.332461932761806e-01   +6.084733699039543e-01   +7.229369458758486e-01   +5.828355878729547e-02   -1.854639603663026e-01   -3.633058200131888e-01   -3.599940874240904e-01   +4.964602096387614e-02   +3.891155164282086e-01; -6.891728070456807e-01   +6.787493953097601e-01   -6.075933106928441e-01   -1.141119653272947e-01   -3.621926526288952e-01   +1.727739799061970e-01   +2.348027745741648e-01   -3.607881404762202e-01   -8.464770900894882e-01   +1.145712755117939e-01   -2.011944737588498e-01   +7.207869747112725e-01; -2.260435493910913e-01   -5.402383456862119e-01   -2.697733700695232e-01   -1.933987885878395e-01   +4.319710291350838e-01   +4.233407150580891e-02   -3.690890397933885e-01   -6.772180967006201e-01   +1.651291413798470e-01   -6.060198502750618e-01   +6.036862308815177e-01   +9.879362850807288e-01; -5.159126171717440e-01   -5.397719313040841e-01   -4.822818597469627e-02   +5.590686853414487e-01   +7.430896297170537e-01   -4.788888083183206e-02   +3.181105728361543e-01   +2.441364539735883e-01   -7.630274171291592e-01   -7.729251942928048e-02   +6.078558802628784e-01   +1.959073614114887e-01];
L2E_L3E_iAMPA_netcon = [+5.829216706782493e-01   +2.052912661127815e-01   +7.767891691576001e-02   +2.484205333862027e-01   -1.416405478333703e-01   +2.128592971026266e-02   -5.154921853240697e-01   +1.803663752738859e-01; +2.931216579562967e-03   -4.563789385753568e-01   +2.091453845173323e-01   +5.500983024910946e-01   +2.913347642659276e-01   +2.480479510399001e-01   -7.923140254544619e-01   -1.607886641039677e-01; +3.122265064062912e-01   -7.709977044214111e-01   +6.007636402715556e-01   -3.982804379501815e-01   +2.200360462583900e-02   +8.916723306792532e-01   +5.747159959746833e-01   +8.648304753902345e-01; +1.517887520044762e-01   -6.965004376082701e-01   -3.967000481636396e-04   +2.500315005802505e-01   -9.574427942951075e-02   +3.903598033808739e-02   -6.580092275726037e-01   -4.544452925119978e-01; +6.897966158303516e-02   +1.965487172563773e-01   +2.671125909698651e-01   -1.875742487601313e-01   +6.496096240428645e-02   +6.565282082097884e-01   +5.367562479031678e-01   +1.245236049705330e-01; +3.870174141384588e-01   -5.374152845637524e-01   +5.432493240958520e-01   -5.638042648188859e-01   +9.211528340732906e-01   -2.246878087142562e-01   -5.594944814736105e-01   +4.422451284507153e-02; -5.340977278175835e-01   +4.702058402437201e-01   +3.284803791794628e-01   +6.986975351652092e-01   +3.611509588454134e-01   -3.697903001092627e-01   -1.026709085884234e-01   +4.457566553114971e-01; -3.112999216216739e-01   +9.345839816758529e-01   -6.103578800493079e-01   -3.297913576578471e-01   +8.613162707560655e-01   +1.493650053960849e-01   +4.109142726696990e-01   +3.865091979739663e-02; +2.291046791798600e-01   +5.814059608345572e-01   -1.087298458321156e-01   +3.624629997049796e-01   -1.493378097157771e-01   +1.842621042237890e-01   -3.189654599507101e-01   +5.635977556004144e-01; +6.203163068675448e-01   -8.274594254331169e-02   -3.912048361050008e-01   +5.617971480964241e-01   -4.082136758988105e-01   -3.331697810660982e-01   +9.199347633130365e-01   -1.440801522376470e-01; +4.866761065685653e-01   +6.639978369009745e-01   -3.357270211013220e-01   +5.134135986154870e-01   -3.892419805234830e-01   +5.008661944985995e-01   +2.844940998767748e-01   +3.149450185327716e-01; +6.209140035177649e-02   -9.113128911629149e-01   +7.921991295998778e-01   -7.241757417959351e-01   -4.402794967245761e-01   -1.472526827027600e-01   -5.291413585882717e-01   +1.529996816822423e-01];
L2I_L3I_iGABA_netcon = [-3.339936634488739e-01   -2.868867372705469e-01   -2.800763929688193e-01   +1.567797183874689e-01   -6.636733840544747e-01   +4.715544988395413e-01   -3.649592419331514e-01   -2.581397024987923e-02; +9.389341212369669e-02   +5.107868971617845e-01   -1.904451675024182e-01   -4.509025396400029e-01   +4.071984067650624e-02   +4.602391310273650e-01   -1.477198648518082e-01   +1.305190423298684e-01; -4.653848810581387e-01   -1.980640422674326e-02   -3.309046123557497e-01   +1.927197015083906e-02   +1.097138964912047e-01   +1.903609542118661e-01   -5.434315951914397e-01   +9.521250400283036e-01; -1.481671619870489e-01   +5.044612080878179e-01   -3.448609367820465e-01   -3.021115853922588e-01   +9.361812333248960e-01   -4.701493354057737e-01   -9.045247370325786e-02   +4.509188070756848e-01; -3.088236013570222e-02   +2.018660899930952e-01   +1.564333713196766e-01   -1.534584244629977e-01   -3.848616236137183e-01   -4.803351600120732e-01   +6.591919577077849e-01   -2.163953751404475e-01; +5.262812360205756e-01   -5.718772104844764e-01   -6.242210838108083e-01   -2.506218019016111e-01   +4.057617963363528e-01   -5.926928696850542e-01   +2.892249433839511e-01   +6.415199364234749e-01; +1.498364810186191e-01   +2.357686957557446e-01   -5.454523007357704e-01   +1.530073201820084e-01   +6.383548945609654e-02   -5.095173314794043e-01   +2.801707156593419e-01   +2.387924471109464e-01; -2.518953497187842e-01   -3.141316875445828e-01   -1.879039601947974e-01   +1.028378070321902e-01   +4.296585838354941e-01   -3.149141778040530e-01   -4.376359440511406e-02   +1.974538150532482e-01; +3.481199937069720e-01   +7.674481256330185e-02   -1.254233930339321e-01   -1.000000000000000e+00   +5.399130810568996e-01   +6.613438916213283e-01   -1.630392945997455e-02   +3.550328310969535e-01; +4.684793405631662e-01   -1.717253132739949e-01   -1.930541026495779e-01   +6.020643286140143e-01   +1.031227922182205e-01   +6.227825006795560e-02   +1.431591919094697e-01   -5.382196359387184e-01; +7.102980404494336e-02   -4.884160449735760e-01   +6.248848184625498e-01   +1.899403780686257e-01   -1.593490785276718e-01   -2.573888798727447e-01   -1.017252158922877e-01   -8.322481291051415e-01; +1.725501722605758e-01   -7.413240123913081e-02   -4.579486783211493e-01   +5.576876006495413e-02   +2.708930708361077e-01   +4.531972037952767e-01   +4.904853562490280e-02   +1.781301857166079e-01];
L3I_L3E_iAMPA_netcon = [-2.380622881895574e-02   -4.580058364427841e-04   -1.641438870499726e-01   -2.503636474128005e-01   +2.795607895164751e-01   +7.509998063065180e-01   -4.533383719067895e-01   -2.372264884590611e-01   -3.126539653756554e-01   -4.722363059255355e-01   -8.274804220519646e-02   +2.718083074526352e-01; -2.077308916533639e-01   -1.000000000000000e+00   +5.101533261401054e-01   -2.019427394983372e-01   -8.583445901898605e-01   -3.407707922634958e-01   -5.206273610890891e-01   -1.202770744243795e-01   -8.611575139459261e-02   -1.286809281544836e-01   +8.522171299411909e-01   -1.067609832993384e-01; -5.194899933780658e-01   +5.519763577000197e-01   +6.131779309682935e-01   -4.381514806201252e-01   +1.679042328292522e-01   +1.454558823098787e-01   +5.497418494795762e-02   -1.403396618910812e-01   -3.609852453848337e-01   +1.237812005350911e-01   -9.598752917770589e-01   -4.942399526934363e-01; +3.663782052632719e-01   -2.854413989097696e-01   +5.537238646003069e-01   +2.578470250189327e-02   -4.758718443943221e-01   -2.123522659281966e-01   -8.194187076461138e-01   -2.201504917438188e-01   -7.415660564276207e-02   -1.506784859333668e-01   -2.481572471381772e-01   -3.406200454188297e-01; -3.712479294879892e-01   +4.709693673142633e-02   +5.738136805874310e-02   -1.212954247877228e-02   -9.090560077841544e-01   +8.716017858709209e-02   +8.410799929663453e-01   +6.724409286698726e-01   -7.607676122960992e-01   +2.644171910924704e-01   -7.647072736208380e-02   -1.458954135669089e-01; -7.056080665959575e-01   +4.694570780367837e-01   -9.038910086891477e-02   +1.774448932489901e-01   -1.644042150508616e-01   -1.438229859448459e-01   +6.882615300314923e-02   -5.124283378796133e-01   -7.045402537785080e-01   +1.954620219249535e-02   +1.659736155706963e-01   +2.744420900356477e-01; -5.051696066259773e-01   +8.264809398594097e-01   -7.034429017719086e-01   -7.188337030708054e-02   +1.288153106601006e-02   +8.540957971955212e-01   +2.734485983878374e-01   +2.788733247451295e-01   -2.819140360788775e-02   -6.468563617666486e-01   +3.959698950796391e-01   -5.273409861424613e-02; -3.053252650990084e-01   +1.037091779259711e-01   +7.750439630008812e-03   +3.584524186685262e-01   +4.400870658952859e-01   +1.671312264088930e-02   -2.909302532844043e-01   -7.037889230832227e-01   -1.539225933420624e-01   +1.382594021558838e-01   +4.905836502265779e-01   +9.116484345652340e-01; -2.064789620174538e-01   -2.621297134897303e-01   +2.468250460450979e-01   +4.877928939007045e-01   -2.338459437178614e-01   -9.384362920887060e-01   -4.072607823418968e-01   -7.587077108928414e-01   +5.797907658137261e-02   -3.402596859040299e-01   -5.467591222892528e-01   -1.413195829341826e-01; -6.854119971611708e-01   -2.838474664197905e-01   +7.447120075074805e-01   +4.039870174222824e-01   -3.160156767716110e-01   -3.138243354929443e-01   +4.619241096665221e-01   -5.789178515279614e-01   -1.188648434224074e-01   -8.466740502471420e-01   -9.193447427334303e-01   +2.502592305620129e-01; -6.160329343290960e-01   +1.362370408361188e-01   -4.251052885410597e-01   +1.809427181569015e-01   -4.099092271553263e-01   +2.354469978326503e-01   -2.678365637421821e-01   +1.498872373918535e-01   +1.868720674121983e-02   +7.487446647887138e-01   -1.688021988851534e-01   -1.032760797377399e-01; -3.126218819601658e-01   +3.071153435213802e-01   -7.098554704243433e-01   +5.239628294175326e-01   -6.272039963653707e-02   -4.177110188920264e-01   -5.920829566187126e-01   -3.299542736418923e-01   +6.778144616402071e-01   +1.599218753167543e-01   +1.456145984181846e-01   -6.068321466568972e-01];
L3E_L3I_iGABA_netcon = [+7.951589943992784e-01   -3.048264732038790e-01   +2.306751917082349e-02   -7.695284455017054e-01   -3.911684423385731e-01   -9.916677688798122e-01   -4.817110169330738e-01   +2.875255107125056e-01   +6.906978135099883e-01   +1.614193105600897e-01   +9.031809568736766e-02   -3.350942041545575e-03; +1.902875354888082e-01   -3.774356082187378e-01   +6.580813941487973e-01   -9.582665138836366e-02   -1.106966127252723e-01   -3.274502662128143e-01   -5.334032293361952e-01   -4.883813305024852e-01   +9.841578407696254e-02   -4.214847870790116e-01   +1.610840973905578e-02   -8.876067008596232e-02; +8.086403964854973e-02   +4.762344453223610e-02   -4.950947775401462e-01   -3.503620687879553e-01   -2.252322913085181e-01   +4.309412023636561e-01   -4.134524428032147e-01   -5.843241841958988e-01   +4.866359157708904e-01   -4.448754888775330e-01   +1.629621562358571e-01   -6.104397133115661e-01; -4.010473518695805e-01   -5.875103228737445e-01   -3.219628923142054e-01   -6.060131312697209e-01   -4.162319523513013e-01   +1.659257645159628e-01   +1.729872487146726e-01   -6.997160816189212e-02   +1.093476394004164e-01   -3.475384955201097e-02   -7.597795619228841e-01   -1.734956190191233e-01; +1.297276376764669e-01   +4.004301569600636e-01   -4.574453730453728e-01   +3.611977142898953e-01   +6.614471968924359e-01   -2.074087944163995e-01   +1.306936813782269e-01   +3.095125590977618e-01   +2.881713387400835e-01   -8.617820872042656e-01   -1.830190060601322e-01   +1.000000000000000e+00; +2.049910605009540e-02   -3.424538532088275e-02   +6.018965617867759e-02   -2.864548484562183e-01   +1.060087508467633e-01   +2.493273183065071e-01   +1.330620614999581e-01   -5.423961118667207e-01   +6.498191085055898e-01   -1.720753481090180e-01   +1.047068938668291e-01   -4.937154233453084e-01; +3.292295866652939e-01   -7.873042576703109e-01   -1.284120913315444e-01   -2.155616018350766e-01   -5.149313585542725e-01   +2.439609200520607e-01   -2.033858981382628e-01   +2.571595761483468e-01   -8.192668875364606e-02   -1.471818485012642e-02   -4.888010254842232e-02   +1.826364590001191e-01; -5.630325757327871e-01   +6.334981011666926e-01   +4.384938393642963e-01   +4.184618681384075e-01   -1.026020384619064e-01   +6.319987259904328e-01   -2.333022271424898e-01   -5.816779865377655e-01   +2.330395700252130e-01   +1.112885762174378e-01   -3.611791007221055e-01   +6.285519013336036e-01; +4.726106027208203e-01   +1.218928300528687e-01   +5.581725036469380e-01   +5.157306634224099e-01   -9.369689775461619e-02   -7.016500597914423e-01   -3.623319562687414e-01   -1.545804821527971e-01   +5.896555526785588e-02   +1.856351254986508e-01   +3.464084649353920e-01   -8.088415329763603e-01; -7.612492298471658e-01   +2.162372618404458e-01   +9.073661253791374e-01   +1.207614012334919e-01   -1.234154430473508e-01   +1.995121115418470e-01   +3.269902482432308e-01   +8.841396394730691e-01   +5.692854241159341e-01   -7.911219986275010e-01   +4.197470055821936e-01   -7.448574299599588e-01; +5.358329106130709e-01   -5.590217501174836e-01   -7.540860441146633e-01   -1.245144344102775e-01   +8.927001223555516e-01   +2.573370809007579e-01   +5.742361458430012e-01   -4.410385169808441e-01   +2.386259121101809e-03   +6.856447903888094e-01   -1.211746808150914e-01   +7.949727228301390e-03; +9.080817490694132e-01   +4.650263728992516e-01   +4.019853218012530e-01   -1.079212005267455e-01   +7.713767189989143e-02   -5.165485684271415e-01   +3.309520875283661e-01   -3.265304100432911e-01   -3.459536888603363e-02   +1.112712631706657e-01   +2.927496934380334e-01   +3.139655507341658e-01];
L2E_Input1_iAMPA_netcon = [+7.178710825199215e-01   +2.714579696767750e-01   -5.219639823146008e-01   +6.538699580837276e-01   +3.419353677412749e-01   +1.461611788933189e-01   -5.442442891292945e-01   +5.272945581601470e-01];
L2I_Input2_iAMPA_netcon = [-3.579460264832889e-01   -2.445909667418980e-01   +3.323730163674908e-01   +6.122215274915771e-01   -7.946377163108971e-01   -1.639891077270978e-01   +5.185110241521017e-01   -1.000000000000000e+00];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
