function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-7.353729516459749e-01   +2.270371811125703e-02   -8.982027591181203e-01   +4.829564598078338e-01   +2.755630101483733e-01   +8.910637797826491e-01   -3.597555382586465e-01   +2.446617732187026e-01   +2.104681997548485e-01   +1.371102465351766e-01   -9.607327421399106e-01   +4.623939561658369e-01   -1.751594312314201e-03   +2.506951086016372e-01   -6.368991946472291e-01   +2.312018862764426e-01; -4.181159756524496e-01   -6.034670983093062e-01   +4.475405848112848e-01   -1.210391030179429e-01   +7.457429818473885e-02   -4.023961921462563e-01   -7.408837060701402e-02   +2.293960917098630e-02   -3.879459896325890e-01   +8.586377986412712e-02   +1.920992037864809e-01   +7.749986206974427e-02   -3.304178392143853e-02   -9.182960002882132e-02   +3.473803753435876e-01   -2.821659601033170e-01; +2.345410665132143e-01   -2.647648875365594e-03   -3.309489982074004e-01   -8.808715651854064e-01   +3.883726401018950e-02   +2.269227742163404e-01   -5.291686217846372e-01   +5.328409866529998e-01   -4.728644141450429e-02   -8.435612597150182e-01   -3.555099067227894e-01   -3.246220855977840e-01   +7.318791599408032e-02   +2.479246352204162e-02   +1.262607041422745e-01   +8.074093839147639e-01; +4.743167797020591e-02   -4.879083910636087e-02   +2.265109549399361e-01   -1.177698607279372e-02   -5.126513908898720e-01   -2.312655460290846e-01   -3.175078265669221e-01   -1.945083787666572e-02   -1.120354452652734e-01   +6.438847761867048e-01   -8.790369847712759e-02   -4.360804482117859e-01   -6.607720234007048e-01   -3.092836339743212e-01   +4.069915943742017e-01   -8.228502463277243e-01; -2.357467338904744e-01   -1.785297681147485e-01   +1.149508531375282e-01   +1.907220352389786e-01   -2.470983356332042e-01   -7.612369263096642e-01   -7.348615443845856e-02   +2.851069995710130e-01   +1.962037723997694e-01   -1.380602957321382e-01   +1.257386022053327e-01   +5.981444829288879e-01   -2.689707163280904e-02   +2.087001952431133e-01   +9.167629458247334e-02   +4.859901495279984e-01; +7.892461697443303e-01   +1.647475045292258e-01   +2.300701522417979e-01   +3.957326749599568e-01   -4.202725891444524e-01   +5.029834848960990e-02   -4.763247718071397e-01   -1.066294131511479e-01   -4.768415964421968e-01   +9.252504807680381e-02   -2.407171779087653e-01   +1.628156269799351e-01   -3.466432148195651e-01   +1.432317703931034e-01   +7.459591148472682e-02   +3.196313547644648e-01; -5.482003174064365e-03   -4.886447781557963e-01   -3.633137623371388e-01   +9.064227907288559e-01   -7.619463130855083e-01   +8.589918670510314e-01   +4.846874442463383e-01   -1.945107126901801e-01   -6.918281397903789e-02   +6.654170963764303e-02   -1.000000000000000e+00   -3.888118383916554e-01   -5.974398926038563e-02   -4.846041054684508e-02   -4.614544251212563e-01   +2.671695140580082e-01; -3.147751303080172e-01   -3.249799742433531e-02   +2.070158376370992e-01   +1.369217284349545e-01   +2.555864754791821e-02   -1.329445607932349e-01   -5.464250617871733e-01   +3.571034784138887e-02   +1.800467871960229e-01   +7.164217882517492e-01   +1.035102715819172e-01   -3.656858197510219e-01   -9.927599567804482e-02   -6.593233279802509e-02   +2.442778356586968e-01   +1.453677883269210e-01; +4.150957342940292e-01   +4.700701147748649e-01   +3.085133731329063e-01   +1.170667427985668e-01   -1.535695028793844e-01   +1.843195923317837e-02   -3.251779665951469e-01   +4.291537878002794e-01   +2.228712169497942e-01   +3.361011431662424e-01   +1.400131971823194e-01   +9.941046599899736e-02   -4.064308200495027e-01   +5.064657061444512e-01   -4.458470090091657e-01   +3.292999076227666e-02; -3.270251876709068e-01   +1.383663361848203e-01   -2.689995747564409e-01   +5.076271592532524e-01   +2.078949149027887e-01   +1.349895448081061e-01   -2.141609577574521e-01   -9.611210244787903e-01   -4.744095336048195e-01   +5.250211582790633e-01   -1.088715379871007e-04   -7.388374893281602e-01   -5.196115593318960e-01   +9.074586005752203e-02   -5.037199487910315e-01   -4.986336780619582e-01; +7.425588470430398e-01   +4.350128179300919e-01   +3.016246688371921e-01   -5.460944190350316e-01   -7.051383442589966e-01   +7.208910930559084e-02   +1.490018431319174e-01   -1.914294400287459e-01   +2.936636331584895e-02   +1.159421299976697e-01   +3.759669214449586e-01   -5.963913994131308e-01   -4.322740887025925e-01   +2.805961593268504e-01   -2.722956931113700e-01   -5.225699222625974e-01; -4.187637889458101e-01   -3.778967582442194e-01   +3.989826495483533e-01   +6.135263864224811e-01   -4.806864044554206e-01   -1.521409988804023e-01   +1.923217427216694e-01   +1.306254073330906e-01   -8.900623548522416e-02   +2.457031855129783e-01   -3.987743122194153e-01   -4.499562380735672e-01   +2.099093584522091e-01   -8.982240768926683e-02   -5.381086842737833e-01   +4.037307252892717e-01; +2.783316805932238e-01   -2.067158584826587e-01   +1.613278120943569e-01   -4.993336763402815e-01   -8.375615736479421e-01   -2.024736507501868e-01   +7.711080186473722e-01   +4.492986654914712e-01   -2.178343761937984e-01   +4.642110183241738e-01   -3.567802404879709e-01   +3.586095173100434e-01   +2.213058224275310e-01   -2.795209183494242e-01   +2.205795319637796e-01   +9.180401323700732e-02; -2.037656848903712e-01   -5.566944360400500e-02   -8.003863099865698e-02   +4.804089673625191e-01   -2.364778194283599e-01   -1.730098257881041e-01   -2.874532433803080e-01   +4.853390946382251e-01   -3.451912895618784e-02   -6.308071843994748e-01   -5.115318232235444e-01   +1.324200241623117e-02   -2.233379360894083e-01   +4.875642287422506e-01   +1.812301316925771e-01   -3.445475780015340e-01; -1.934596591471211e-01   +2.093467889030315e-01   -5.029934391094666e-01   -3.355495701395597e-01   -2.487714958761907e-01   -3.426824801707180e-01   +1.977058685215358e-01   +5.019789661036237e-01   -3.074707640222273e-02   -3.420400883403991e-01   -6.199912106589588e-01   +2.152063607911117e-01   +4.408900900657613e-01   -3.587613959360241e-01   +5.840939884081363e-01   -1.130866278714308e-01; -5.397172388688001e-02   +1.674990489991432e-01   +1.144709266455120e-01   +2.545817813396067e-01   +9.882245222568399e-02   +1.285870162664321e-01   -5.164812115870287e-02   +7.879339093284000e-02   -1.052987592915407e-01   +1.131418151878977e-02   +2.272020517161910e-01   -4.362003951674416e-01   +3.672427128283144e-01   -3.242483395734887e-01   -1.898973914776568e-01   +9.739252362101818e-02];
L1E_L1I_iGABA_netcon = [-3.318421626318790e-04   +2.632322223529406e-01   -5.541868754141189e-01   +2.017080844677126e-01   -4.173103331345126e-01   -5.542467136684710e-01   -1.924973219149862e-01   -6.675043838614364e-01   -2.084683427149124e-01   -9.984260171892922e-02   +5.143361047086610e-01   +3.442426088731795e-01   -6.146113006127911e-03   -5.005141688192279e-01   +5.240538349605798e-01   +4.199265564044226e-01; +6.150895162736995e-01   -1.010720511350460e-01   +6.204206469675869e-01   +4.071814555245131e-01   -2.453946334719567e-01   +2.209923808341769e-01   -6.399487153774803e-01   -4.502421248390066e-01   +6.485220860873868e-01   -6.720360998813961e-01   +7.908586327095717e-01   +2.238011596403688e-02   -3.660560443964824e-01   -4.531544018979146e-01   -7.052938555980887e-01   -1.470490246829637e-02; -3.596223189863381e-01   -9.517919571775023e-01   -5.581716621434716e-01   -2.481214668895329e-01   +1.499671581540146e-01   +7.233238733004748e-01   +2.132811267535220e-01   +6.173335733017647e-01   -6.853200740133314e-01   -4.815109588594203e-01   +7.427173495917205e-03   -5.025999865220450e-01   +8.161446293564190e-03   +2.833111416659335e-01   +3.391193825107116e-01   -1.597403349089077e-02; +5.787546794786719e-02   -9.540215880490277e-02   +4.326108498225401e-02   +6.390356355714633e-01   -4.070597804248018e-01   -5.666301275582377e-01   -6.564461272609048e-01   -5.050896038326963e-02   -4.071128302605960e-01   +3.364709000908537e-01   +2.250948990009582e-01   +3.801757622606382e-01   -6.368750573832828e-01   +3.997551618720890e-01   -6.572641346804527e-01   +3.247671363478105e-01; +3.483102278160746e-01   +2.040323583822120e-01   -8.784959291806508e-01   +7.380347742923900e-01   +5.208392162926656e-01   +4.541144451618295e-03   -2.092390750706118e-01   +9.826371221788144e-01   -4.895250906590476e-02   +3.508703438124949e-02   +3.446584202529936e-02   -5.813293220785882e-01   -2.784773489641090e-01   -9.961937138861143e-02   +7.555212543301637e-01   +4.805406037548485e-01; -4.820800567811006e-01   +2.033885564806972e-01   -2.364816908509146e-01   -3.848879418640611e-02   +7.064050070826151e-01   -8.702516635183239e-01   -2.401732385047645e-01   +3.404958055558236e-01   -2.824054246612297e-02   +4.163457429093863e-01   -2.910039511819931e-01   -3.515876618042327e-01   +2.503231998711953e-01   +3.806521656578472e-01   -8.522643538789665e-01   -1.737383397973905e-01; +5.192483041330272e-01   -7.811900938579385e-01   -3.974085201369805e-01   -3.547774006718351e-01   +3.760974300761188e-01   -3.405309127000790e-01   -7.366495482069746e-02   -6.416273942435561e-01   -3.596260149308256e-01   -3.261111290627194e-01   +2.138299460696475e-01   -3.640075890457083e-01   -4.071477945008659e-01   -7.117616072369429e-02   +6.559861613781794e-01   +7.032478667081772e-01; -8.458993808553550e-01   -6.670889729226580e-02   +8.446217654513826e-01   +7.060554971460538e-01   +2.237341178926441e-01   -5.807537751604559e-01   +1.950252993330215e-01   +7.096767715403225e-01   +1.847477460087777e-01   +1.109296605302701e-01   -7.395426765454829e-01   +8.358103887444179e-01   +2.917863697692047e-02   -2.677831580264977e-01   +7.451499569463088e-03   +1.047007308206643e-01; +8.118734102310934e-01   -4.285928617978823e-01   -3.195736883576694e-01   -3.529616811797747e-01   +1.745654449783540e-01   -8.184158376722560e-01   +6.001841435901604e-01   +6.706715297341849e-01   +1.585422599792200e-01   +3.457524706919874e-01   -6.295349543047081e-01   +9.266642957500171e-01   +3.415882620200529e-01   +8.676563488866886e-01   +2.075517708526939e-01   -9.202910175720240e-01; -9.852040176670124e-02   -7.209284924709567e-01   +6.630913053700808e-01   -6.026324305131434e-02   +5.962956877816047e-01   +7.117473587365519e-01   +9.387827960192380e-02   +2.818808163616601e-01   -5.488843834738522e-01   +7.876026139652152e-01   +2.016783304438132e-01   +3.383257090976655e-01   +5.745591320070755e-01   -4.305817130801309e-01   -9.141517477631633e-02   -5.793306897226304e-01; +3.859417803696230e-02   +4.981346700000636e-01   -6.789010911122062e-01   +3.232752183316714e-01   -3.012586620310734e-01   +4.814730212080282e-01   +5.228011717135670e-01   +3.833613554933004e-01   +2.503137587792279e-01   +7.711566040025593e-01   -5.223735528407630e-01   -2.520022840134827e-01   +7.515719462829666e-01   -6.848391418285799e-02   -2.700025187369177e-01   -4.551617664228477e-01; +8.057016519085194e-02   -1.905679651856743e-02   -1.903550334496068e-01   +4.132909260140166e-01   +7.152705917485860e-01   -5.652467191602191e-01   -3.047839693467614e-01   +2.158869535287393e-01   +3.573191631131002e-01   -3.989442944944915e-02   -8.208698763580943e-01   -4.834246354772640e-01   -4.697127806433338e-01   -2.057567638466642e-01   +4.704714460732018e-01   -2.998426956112918e-01; -7.566455387654267e-02   +3.455857687828606e-01   -7.252323917964471e-02   -3.942200351913426e-01   +1.938346519972858e-01   +2.016106708889354e-01   +2.203857279363276e-01   -5.965987390957909e-01   -2.575674251584543e-01   +5.971900398599572e-03   +9.720532008557499e-01   +4.432726600683646e-01   -4.724010631650077e-02   -4.358606214891774e-01   -4.304779347941163e-01   +4.226890937424946e-01; +3.889252032800507e-01   +1.540216658431875e-03   +4.389900011684650e-01   -1.821232486657928e-01   +1.298937090844440e-02   -7.956135310309659e-02   -3.936954812776247e-01   +6.071309959786504e-01   -5.776574905700774e-01   +2.927297962936956e-01   +1.149970789159436e-01   -7.772786735942314e-01   -3.560145199808606e-01   -8.846298012423718e-01   +6.742848753249392e-01   +7.376432150275452e-01; -5.541326268203788e-01   -3.572004412329877e-01   +6.428639971176934e-01   +3.398958109509387e-01   +8.256320883830547e-01   -6.416430668740575e-01   +1.619304942317932e-01   -6.191649204830502e-01   +4.984054275896735e-02   +1.526758543559224e-01   +1.137413494021354e-01   -1.934540834136409e-01   +3.782387030613207e-01   -2.724579197464009e-01   +7.692489178241062e-01   +3.407108428040758e-01; +3.261184514432197e-01   -2.718314408385398e-01   -9.906753399153211e-02   -5.420747191125885e-01   -5.034698108618429e-01   +3.976701082397212e-01   -7.601535640361420e-02   +1.950970927979452e-01   +1.644982312191420e-01   +7.261056579269274e-01   -5.806137265676443e-01   +1.416462747211573e-01   +6.876557098468933e-02   +8.532325334511421e-01   -3.113766184980632e-02   +4.860735535559938e-01];
L2I_L1I_iGABA_netcon = [-2.789294693281320e-01   -3.603326628207941e-01   -2.232701307377492e-01   +7.794039081029218e-02   -8.191140834688992e-01   -1.238005776998452e-01   -5.140658016545914e-01   +2.874113666230407e-01; +4.714308009328211e-01   +3.904975607631365e-02   +5.466122948184735e-02   +1.905124201164633e-01   +1.896603685018818e-01   +1.461448574443233e-01   -5.401649237618034e-02   -3.575201371008602e-01; -1.610715949482689e-01   -5.385072538198261e-01   -4.804380129767441e-01   +3.000056282087495e-01   +1.246750993070024e-01   -3.399659681036751e-01   -1.603403196010507e-01   +1.000000000000000e+00; -5.441153877140801e-01   +3.865242546032558e-01   +3.307139279122938e-01   -3.183755055019006e-01   -1.675320311461268e-01   -2.782596320588125e-01   +6.306975454572523e-01   -4.468269230333593e-01; +1.016673556284291e-01   +5.695736349663497e-01   +2.960218705484076e-02   +6.473473757760168e-01   +2.915956683415003e-01   +2.058845739759160e-01   -5.598018133577141e-01   +7.342746796510193e-01; -3.830894015867529e-01   -3.209906011239923e-01   -8.864696655353604e-02   -4.202335649002523e-01   -5.719743964887074e-01   +2.301308810154395e-01   -6.457886423584194e-01   -2.060344036221076e-01; -4.377934225879239e-01   +2.302574721356262e-01   -2.848476580044256e-01   +1.158367939295595e-01   +5.306531078904151e-01   +3.055082767975340e-01   +5.474258713330831e-01   -2.688897637476983e-01; +7.655885488629843e-01   +2.098820595960141e-01   -3.577853263316408e-01   -3.477376814644568e-01   +9.614337960490146e-02   -3.520774734419359e-01   +5.213175574639973e-01   +2.126296676700286e-01; -7.830646981773589e-01   -2.095077412185938e-01   -4.813877451259735e-01   +1.840333813568075e-01   +5.327007928615246e-01   -4.021983178532859e-01   -3.442852042103666e-01   -6.824711164723422e-02; -2.900242317495637e-01   +2.969378895360336e-01   +2.702403268731283e-01   -6.042505976429140e-01   +6.738717297091243e-02   +6.976551081300832e-02   -3.756355151451551e-01   +2.356386671139031e-02; -4.062471500387394e-01   +5.526259994177379e-01   -4.749385924765998e-01   +3.043305581964990e-01   -6.251849079464656e-01   -4.374063423429930e-01   -4.951324734779782e-01   +1.514197387253169e-01; +2.286347195184793e-01   -1.257109971903140e-01   +8.667466722363913e-02   +1.624260116876132e-01   +7.785991639081110e-01   +4.088527458053802e-01   -4.784460886950521e-01   +1.623393092428051e-02; +1.565820832257201e-01   +5.996149395066868e-01   -3.243307134481949e-01   -2.304926613480673e-01   -1.401862732324955e-01   +2.399774622357148e-01   -7.198359285171791e-01   -3.548791157026251e-01; +1.258237486200377e-01   +8.840308100717392e-02   +3.233302874586609e-01   +5.118658267094870e-02   -6.020466707295423e-01   +1.022587958621924e-01   +5.810747315330717e-02   -3.544832627073975e-02; -3.515357964833444e-01   +2.308523638516795e-01   +9.851711151953148e-02   -2.844812087071854e-01   -8.044287091999794e-02   -4.558586590155009e-01   -3.395836483983023e-01   -1.810668080467871e-01; -3.372848375421560e-01   -1.647033644612027e-01   +4.181315531305895e-01   -2.441771047949276e-01   +3.425140239031503e-01   -6.917806348571297e-02   -5.415992680666016e-03   +4.482735337326985e-01];
L1I_L2I_iGABA_netcon = [+3.263023301793299e-02   +2.380200388686831e-01   +9.285679733323212e-01   +1.046261779435619e-02   +7.390316203159475e-01   +7.554217886867297e-01   +9.043042163107141e-01   +1.538129402136052e-01   +7.906209872897350e-01   -8.343883007232500e-01   +2.142222107252952e-03   -9.210163881205685e-01   -2.066563373743844e-01   -2.047192295566345e-01   -3.145489668719473e-01   -8.966036941654346e-01; +6.459990291716146e-01   -6.931069119475364e-02   +5.813383812030642e-02   -1.507406505550330e-01   +8.272783285850634e-01   -2.964089002782740e-01   +9.673519752032340e-01   +8.077624494750658e-01   -2.302729251242992e-01   +4.604409427995770e-01   -6.258425024976213e-01   +1.704367367315928e-01   -3.228210150612526e-01   +3.351789093903396e-01   +1.126847005127452e-01   -9.586988199279138e-01; +1.365841454314397e-01   +3.621918534567498e-01   -4.144299954863008e-01   -4.121668828021630e-01   +3.716665739538981e-01   -5.804623344657134e-01   +8.393263862632055e-01   +2.663330711621132e-02   -2.293997813189765e-01   +8.713773634474704e-01   -4.835461154979585e-02   +2.044142660710955e-01   +9.444723677593274e-01   +3.050434125408228e-01   +4.623959979788957e-01   +6.644141232962993e-01; +1.333128537232730e-01   -6.555300244377795e-01   +1.792185926029649e-01   -7.113965345835943e-01   +1.730456577255884e-01   +4.458695215134083e-01   -5.219187467758685e-01   +6.089758552026548e-01   +9.201686880624079e-01   -1.650936549643473e-01   +1.661122026399114e-01   -1.847685964346574e-01   -7.908444153055669e-01   -2.191514310396560e-01   -2.806420793535272e-02   -4.806262092085699e-01; -6.766875002810058e-02   -2.392602207148523e-01   -5.219589210669165e-01   -7.643818777790447e-02   -2.927992023219081e-01   -3.023030052726751e-01   +4.950201564325274e-01   +2.510775974586112e-01   -6.879370848350115e-01   -3.138080102250609e-01   -5.582770453925873e-01   -2.746017783588294e-01   -3.309264006255606e-01   -6.039031643557424e-01   +2.322273730666345e-01   +1.501678719777039e-01; +6.334476758629948e-02   +7.101091648974379e-02   -2.382183214455431e-01   +3.191203183514906e-01   -1.380636607909276e-01   +4.924198258502026e-01   -2.468150505130146e-01   +1.318405900109276e-01   +3.622108096439773e-01   +3.891214476899028e-01   -6.498744915786103e-01   -6.548936246927771e-01   -3.777144199641832e-02   -2.914861642033788e-01   -4.521988311450263e-01   -4.127160424639210e-01; -1.691714139323062e-01   +5.080829914593906e-01   +9.095874550426569e-01   +5.478150979749374e-01   -4.933547040854698e-01   +6.001278817780460e-01   -2.507740338628258e-01   -1.000000000000000e+00   -7.565005497280125e-01   +6.471846629685282e-01   -5.999875634073879e-01   +4.711226990017870e-01   -8.367566656560056e-02   -1.203176120647600e-01   +3.704644668996463e-01   +5.020394323174114e-02; -1.747589279066107e-01   +4.559689564506988e-01   -4.591027238675251e-01   -6.682897698854972e-01   +5.565299929020997e-02   -4.325810174604496e-01   -7.978297292855298e-01   -2.418420894242024e-01   -5.296049784931880e-03   +2.556938372419789e-01   +2.093233679650716e-01   -2.289385274998502e-02   -4.006557459393733e-01   -4.563688066282558e-02   +5.272966323706070e-01   +9.983706413284493e-02];
L2E_L1E_iAMPA_netcon = [-2.994134105179111e-01   +1.535907149456678e-01   -2.876515627593120e-01   +2.727594839631970e-01   +4.610162182800587e-01   -3.086588784172951e-01   -3.825776604101265e-01   -2.758901572088523e-03; -6.918806070798947e-02   -7.814593276760881e-02   +6.422517008198180e-01   -6.410175655334489e-01   -3.202096373150747e-01   -2.455969083336573e-01   -3.860606515517682e-01   +6.591297155949940e-01; -1.470963077437246e-01   +8.878372416719456e-01   +1.324135555126739e-02   +2.040946367751508e-01   -4.674604997584053e-02   +2.406674868521154e-01   +3.314458327119296e-03   +2.633041879656902e-01; -4.327643795232260e-01   +8.499500841631058e-02   -8.046558430884038e-01   +1.065625622597128e-01   -8.127318808116025e-01   +2.295329847902605e-01   -4.482222084900434e-01   -6.242937415601469e-01; +4.454751861622249e-01   -1.068503573319704e-01   +6.820395896529714e-01   -3.903842147415286e-01   -2.049576555168379e-01   -2.861176897160161e-01   +6.942256646228040e-01   +2.942216139133519e-01; -2.544939424027068e-01   -8.792466876314708e-01   -1.150056390048585e-01   +4.055825288781226e-01   -3.459826124321976e-01   -2.004056198888271e-03   +7.972821095638158e-02   -4.978540527847581e-01; -3.270039212603998e-02   -2.567061517268975e-01   +1.789272477571932e-01   +6.083317126385154e-01   +7.766213630978837e-02   -7.183642296547009e-01   -5.673030771323914e-01   +5.638911320074935e-01; +4.650699055696298e-01   -1.987114470916162e-01   +1.361217722609812e-01   -1.061681874449575e-01   +3.811581308315462e-01   -8.459943115389332e-01   +4.289086252314463e-02   -9.561128522963240e-01; -4.984514455816468e-01   -1.021004107213799e-01   +3.007321302499510e-01   -3.633174299426006e-02   +5.222818065651900e-01   +2.083471355618927e-01   +1.674274480447860e-01   +1.316149987286325e-02; +3.734228870152596e-01   +1.269144345526307e-02   -2.394565388390993e-01   +4.023538477140473e-01   -2.737530906261279e-02   +2.889622358434530e-01   -4.638770384695223e-01   +6.547369044669233e-01; +4.704599581475702e-01   -2.689198549929554e-01   +1.003473352697570e-01   -4.190253831200083e-01   -3.035933610313638e-01   +8.818343144096268e-01   +4.850598463787997e-01   -7.709910290482878e-01; +6.191695542304084e-01   -5.819260312803739e-01   -4.222173399215883e-01   -1.135473018471722e-01   -5.267723883779457e-01   -4.611984141744677e-01   -5.388977135189251e-01   +3.144865940994649e-01; -8.192238617291167e-01   +4.536936811535284e-01   +4.398398468232150e-01   +2.564501996702048e-01   +3.707016359114768e-02   +2.564403369952949e-01   -3.457245098833448e-01   -7.015562126228964e-01; -5.199222586825787e-01   -1.845459321972151e-01   -2.288956209551684e-01   -1.550109997332778e-01   -4.470212669055890e-02   +3.264131805178937e-01   +5.948941974752200e-01   -2.926656068836673e-01; +1.708489710053903e-01   -1.406023007834772e-02   -4.721319099545465e-02   -2.725329535851725e-02   -5.460438761339717e-01   +2.139739715857639e-01   -6.171119484402832e-01   -6.901152611555099e-01; -3.580074767912878e-01   +1.097449229642400e-02   +1.239619076035219e-01   -3.363156213698176e-01   +6.793594127950819e-01   +5.614509391945430e-01   +2.664219597959671e-01   +1.667614989111908e-02];
L1E_L2E_iAMPA_netcon = [+5.652532153483256e-02   +4.567137449204369e-01   -3.660571893077980e-01   -4.594394121910942e-01   -8.557118598050358e-01   -7.993740593171700e-01   -2.958240960300120e-02   -1.621753522012665e-01   +4.809429279936137e-01   +2.128048041654999e-01   -3.195714151801092e-02   +1.897315977197650e-01   +6.805611013778605e-01   +3.679254254789396e-01   +5.153981586023494e-01   -4.359528233702807e-01; +5.666995957048095e-02   -1.129726626942036e-01   -3.689564592677476e-01   -1.374064093843860e-01   +3.008192687830969e-02   +2.866939931363272e-01   +6.430804898601521e-02   -3.326273457449647e-01   -3.022516334519732e-02   -1.617812826557042e-01   +3.888111862476235e-01   -4.674891084106490e-01   +1.221643721462434e-01   -5.832394067029117e-01   +7.852004470718811e-01   +4.489386688965709e-01; -3.068569208188061e-01   +3.144143656217102e-01   -1.000000000000000e+00   +4.837547525695021e-01   -5.564836097620731e-01   +4.767741603511192e-01   +1.196334179475097e-01   -2.186739224334600e-03   -4.059925891427676e-01   -7.222832879544314e-01   +8.717563326171742e-03   +8.111242719431318e-02   +5.743674101290892e-01   +2.987244207053438e-01   -3.823931259507446e-02   +1.673038569234594e-01; +2.352521742206306e-01   -5.547402172460730e-02   +4.637293075487628e-01   +1.585704997126443e-01   -1.097404666685272e-01   -8.383934417249097e-01   +1.167754815807677e-01   -3.032972582689736e-01   +7.923137951785683e-01   +5.866391655799142e-01   +5.214803583228195e-01   +2.022572562212257e-01   +2.084465236314257e-02   -2.915864442516179e-01   +1.597731553256068e-02   +4.257259198477029e-01; +1.269646813426613e-01   +1.283380220146293e-01   -3.213443653846038e-02   -1.369095465521675e-01   -9.754566206943363e-01   -1.578567906146751e-01   +8.081752679774301e-02   +3.495842471790182e-01   +4.534588238720817e-01   +5.520493122667917e-01   -2.388948399699754e-01   -5.474179089803127e-02   -1.871651259173567e-01   +2.584632215948698e-01   +5.108746967996376e-01   +6.122960964170789e-01; +9.882647072164600e-01   +1.638262628003157e-01   +3.755767329646257e-01   +4.488510859286232e-01   +4.593139866034230e-02   -1.874673477998890e-01   -7.633461782554518e-02   +4.069889086049447e-01   -3.295697032026227e-02   +9.615139699011204e-01   +3.520159889295719e-02   -4.015525039750991e-01   +1.522120164973684e-03   +4.003936269485212e-01   +3.209630025241817e-01   +2.532231710165713e-01; +2.947681856757218e-01   +7.823432296533436e-01   +4.324233207369694e-01   +2.468974333098234e-01   -1.777420516451120e-01   +4.329454716263419e-01   -2.536431857439728e-01   +8.012204364336019e-02   -6.124128114287095e-01   +2.491976502345658e-01   +1.186452480563981e-01   -4.204089566406576e-01   -3.163574922788444e-01   -5.946767204753516e-01   -5.389751040328082e-01   +3.793821916432242e-01; +7.428557929765771e-01   -5.454416375782274e-01   -4.181242991870344e-01   +4.801758569585530e-01   -5.474731292898876e-01   +3.004742169732218e-01   +5.746098623997506e-01   +1.844987302224606e-01   -3.449621165669828e-01   +4.402727677023559e-02   -3.554763882684180e-01   +2.010487866807321e-02   -1.555769144061239e-01   +2.871020088350759e-01   -4.779448672393973e-01   -5.500388053803984e-01];
L2I_L2E_iAMPA_netcon = [-4.019632001985752e-02   -1.334140948258543e-01   +5.202345633396122e-01   +3.597378872876845e-01   +1.119397155078070e-01   -2.150337033499539e-01   +5.207590469256155e-01   -9.504628770662507e-03; -2.889444523386956e-01   +6.617809020371180e-01   -7.414393699491975e-02   -1.901321360775055e-01   +4.372442024786884e-01   +4.117987686673655e-01   -1.352334302706302e-01   +8.002853931591541e-01; -2.946577886969304e-02   -3.616027085928208e-02   +7.199960938199242e-01   -2.485835386502091e-01   +6.947888716068359e-02   -2.866987284602995e-01   -2.830643176950523e-02   -7.058911257651302e-01; +1.351505623483028e-01   -2.191606912489746e-01   -9.463119688608534e-01   +1.269804990599226e-01   +1.936523985079062e-02   -1.911266411114539e-01   -9.928910593826061e-02   +5.954054481206430e-01; +2.635244239469222e-01   +6.953263428408062e-01   -4.454341659149563e-02   -4.495470261322694e-01   +3.283653855109851e-01   +3.460462593818738e-01   +7.523747929307638e-01   +7.292835736754963e-02; -3.631691983436159e-01   -4.721036179267691e-01   -1.927401246343334e-01   +3.177892016584835e-01   +2.710828074245514e-01   +2.162140299134937e-01   +1.537801321926034e-01   -4.835111266353508e-01; -7.496033816053055e-01   -7.681335721872363e-01   -2.926289454634494e-01   -1.591451261101652e-01   -4.356118788235160e-02   +5.240960486245858e-02   -1.000000000000000e+00   -7.368754715215177e-01; +1.937570225410292e-01   -1.563068187140736e-01   +8.249447752059014e-02   +2.178564698520466e-01   -1.733734327432023e-02   -7.002764957925408e-01   +5.450873672345579e-01   -2.920669122966107e-01];
L2E_L2I_iGABA_netcon = [-5.767945368860987e-01   -2.823841477259028e-01   +6.173167071229053e-02   -1.000000000000000e+00   -1.296211387181540e-01   +4.228842198239081e-02   -2.069392398699333e-01   +6.541949487758325e-01; +6.020662096433442e-01   -1.948176117542574e-01   -3.540906310484440e-01   -6.319440919207518e-02   -7.588234358863972e-01   -6.242650143485461e-02   -5.223113538805173e-01   -9.282566060186914e-02; -1.431994945571606e-01   +3.313904810922881e-01   +7.041134553981623e-01   +6.597571148367747e-01   -3.901048196526712e-01   +1.507432122503479e-01   -9.689827404807817e-01   -5.362826638169932e-01; +6.849378329896720e-02   -1.558146891391969e-01   -3.695055273934155e-01   -1.251432037000689e-02   +7.060524510215402e-01   -1.188538646303634e-01   +1.489004443888280e-01   -2.819066195385052e-01; +4.835865951508200e-01   +6.746624727510397e-01   -7.589309169202220e-01   -3.347944195273098e-01   -3.755670434268676e-01   -1.469563637943012e-01   -2.199128662342070e-01   +1.478450341151493e-01; +5.497268380815996e-02   -2.051039411879808e-01   +8.280916728028062e-02   +6.901098387625726e-01   +1.933294601812195e-02   -7.548600477198428e-02   +7.293719814321935e-01   +2.613923348151010e-01; +6.471469820698804e-01   +3.326620059107894e-01   -5.232784367401483e-01   +4.587858482589233e-02   -4.969840828966224e-01   -1.753062119006349e-01   +2.778140376158003e-01   +5.377065544493943e-01; -4.621463022440643e-01   -1.150074459417740e-01   -4.821252732984931e-01   -1.095226346271217e-01   -4.141118500499682e-02   +6.342470793672779e-01   +3.205002755685282e-01   +4.577812970264299e-01];
L3E_L2E_iAMPA_netcon = [+2.635421021820356e-01   -2.612232026719631e-02   -7.731290568324310e-01   +5.737852538368203e-02   +4.200980600693918e-01   +4.981603419815157e-01   -4.176668075205977e-01   -5.020997737336942e-01   -4.359884869834671e-01   +1.153561260301460e-01   -4.013503053484648e-01   +5.620188365343248e-01; -1.441327823365924e-01   -2.787350312979060e-01   +2.068150509464627e-02   +4.437703774157678e-01   -2.619179409074309e-01   -3.390860085322023e-01   +6.137716900186243e-01   +6.070870007743101e-01   +2.426515800500733e-01   -1.530539925294071e-01   +2.437039432302491e-01   +5.777244800638739e-02; -2.201203097889307e-01   +2.408390822200576e-01   -2.902745596108950e-02   -4.413398504278667e-01   -4.726433699698025e-01   +3.422910745974855e-01   +3.719794516373805e-02   +2.302004557960259e-01   +4.680142991204300e-01   -6.074143881672245e-02   +7.573085648038444e-03   -1.959348366359480e-01; +1.000000000000000e+00   -5.061796311588501e-01   +3.769508863561039e-01   +5.059824369764376e-01   -4.161227439299693e-01   -2.081043346400892e-01   +2.001434537580242e-01   +7.106893819028612e-02   -3.660645462604185e-01   +7.536185653409284e-02   -7.021309881960444e-01   +4.490470373201749e-02; -7.341757053951434e-01   +6.469028317110829e-01   +2.561247722168150e-01   -4.123440384961032e-01   -8.866185919258596e-01   -3.026624339339854e-01   -4.787587037545024e-02   +6.357784787966337e-01   +3.555757455014180e-02   -1.381558797402560e-02   -2.885467134995686e-01   -4.857548062182201e-01; -8.808949577757132e-02   +1.866535652663465e-01   -2.327330810134733e-01   +1.623741619748537e-01   -3.336523428062744e-01   -3.903086472326451e-01   +1.285403856700977e-01   +4.834508076265927e-02   -2.615350690356950e-01   +6.353168778751574e-01   +9.970785359633244e-02   +1.400069327991817e-01; -3.787603125978111e-01   -3.876651074752709e-02   +5.258323753107785e-01   -9.391489320837028e-01   -4.092365667463259e-03   +2.133449410817014e-01   -5.103305364787484e-01   +2.121661455654835e-01   +2.768668499191815e-01   -2.573739167634874e-01   -1.702635267927930e-01   +6.892304948429557e-01; +4.665464919275226e-01   +3.079433842938750e-01   -5.670512057664019e-01   -4.341763959514307e-02   +7.151044130565543e-02   +6.893641758839362e-01   +1.153041594433595e-01   -4.850179877124781e-02   +2.207646374724505e-01   -8.969665449407977e-01   -1.933409208935997e-01   -2.088059772252039e-01];
L3I_L2I_iGABA_netcon = [-4.621264202966571e-01   -5.082536728132894e-01   +3.863842918067899e-02   -5.363174840236753e-01   -2.739965417585146e-01   +1.657988488743848e-01   -4.054476140937960e-01   +3.428875520350653e-01   +5.669868496974477e-01   -5.340496510564581e-01   +7.343619769266663e-01   +4.543070405459401e-02; +3.418894799145882e-01   -3.317368167959302e-01   -2.535898105555770e-01   -7.033756690705177e-02   -3.096669856525618e-01   +9.221259217825042e-02   -2.014689643205241e-02   +7.206910005155922e-01   +7.604315870741218e-01   +1.679872958957896e-01   -2.326280013510653e-01   -5.392343791456752e-01; -6.741954735327594e-01   -3.370100690694067e-01   +1.221761792510228e-01   -7.951907830185434e-02   +1.894599115912778e-01   -1.287132737168301e-01   -5.637494132738494e-01   -4.144060136889877e-01   -9.712555371683012e-01   -5.739054320109324e-01   -6.728917230468773e-01   +7.252292468341586e-01; -3.777349480652986e-01   -1.249848861362443e-01   +1.910768085417186e-01   +1.918477257481591e-01   +5.965832711106945e-01   +2.173840071260282e-01   +3.899023477599885e-01   +2.735616818278970e-01   +1.162431543122816e-01   -3.791353422400651e-01   +6.579582710794296e-01   -4.572990456418168e-02; +3.336776444242464e-01   +7.407849767508341e-02   -8.676053906332309e-02   +7.190200991750083e-01   -4.014301852010344e-01   -1.303632435566989e-01   -3.579367660586584e-01   +4.153451845334410e-01   -3.641349535122629e-01   -8.668511927720899e-01   +4.594334104956583e-01   +4.127133388013232e-01; -3.850095557558941e-01   -5.682469980394742e-01   +5.814308650103676e-01   +8.013967167626624e-01   +4.360628144116684e-01   +3.815796657572951e-02   +5.264067373621230e-01   -6.238546220638661e-03   +1.476154814474350e-01   +4.390869624610301e-01   +3.107834704280155e-01   -6.776712714225201e-01; +7.771907073769385e-01   +3.290744890893681e-01   -2.485129905391874e-01   -5.267135702023691e-01   +5.186982314638363e-01   +2.636535797595405e-01   +2.010181885697978e-01   +9.780607527635810e-01   +2.416678699654138e-01   -2.547536238125478e-01   -2.488103233524132e-01   +3.123206041135519e-01; +1.694670037048603e-01   +1.000000000000000e+00   -3.035297536242979e-01   +1.239031969467903e-02   +3.015121311130360e-02   +2.716276273783136e-01   -1.476969116398267e-02   +4.075195261172375e-01   -5.031004047397785e-02   -5.756771445355292e-02   -2.322823411036090e-01   +1.405313811260842e-01];
L2E_L3E_iAMPA_netcon = [-1.667011173998799e-01   +2.813553072754736e-01   -2.839707769117105e-01   -9.118191727332985e-02   +2.670947578511718e-01   -2.190175638083288e-02   +1.170425159508366e-01   -2.340725586702830e-01; +5.169426970661549e-01   +4.448329956890889e-01   +9.238651748030754e-01   -3.274154031817731e-01   -1.348049251808147e-01   +1.370728092180519e-01   -2.035996756367868e-01   -7.307628328995899e-01; +6.110710602278310e-01   +3.579874802656804e-02   -4.361591935401614e-01   +4.421073837079472e-01   -5.948071606077682e-01   +6.213833984235196e-01   +9.146971008439754e-01   +3.339477702291412e-01; -3.418584027093149e-01   +2.750007579498053e-01   +7.592381335271664e-02   +5.369216828138103e-01   -1.695920053517053e-01   -7.855850682432065e-01   -2.099672729871674e-01   -3.746840940461034e-01; -3.787799591579767e-01   +5.681702991691144e-01   -5.212254647365729e-01   -7.353394175421434e-02   -6.692659291356204e-02   -4.231128968675647e-01   +1.791695440694543e-01   -4.652915961061948e-01; -2.498788567845420e-01   +4.834919822976470e-01   -3.757921089939844e-01   +1.457977142176999e-01   -1.474435514616649e-01   -2.082852242723436e-01   -1.741118266112715e-01   -4.415323283569829e-01; +3.897555771666334e-01   +8.039722341331530e-01   +6.693414209296060e-02   +1.144310495278324e-01   -1.324360730265995e-02   +6.299253008827943e-01   -4.744350787704445e-03   -2.153253711123011e-01; -2.709359214486783e-02   -6.822068022395245e-02   +8.896267630789065e-01   +2.588566961456847e-01   -1.071412281668595e-01   -2.803933478625137e-02   -9.242794955566437e-01   -8.173364456431420e-02; +2.917715259461720e-01   +1.060887038627154e-01   +2.553394938945374e-01   -3.963323761124823e-01   -4.011535076586533e-01   -5.577674077984676e-01   +1.975620657010969e-01   +5.621816904044296e-01; +2.467540457946409e-01   +3.570669878061716e-01   -4.165598867782014e-01   -2.137023838697008e-01   -3.773898528335778e-01   -2.187492049891636e-01   -5.361069697731090e-01   +1.000000000000000e+00; +1.926282793727635e-01   -6.082946900680004e-02   -4.453340051753230e-01   -1.500820663783288e-01   +7.368348584196383e-01   -3.314450148932487e-01   +2.361731126157953e-01   -4.933720921439252e-01; -2.042518343737818e-02   +2.630282856000298e-01   +3.479754191780008e-01   -5.515554511431823e-01   +2.455002762467174e-01   -2.184652510239416e-01   -9.793020877558147e-01   -2.808869005585938e-01];
L2I_L3I_iGABA_netcon = [-7.334809335343358e-02   -2.311435448609612e-01   +1.787006837463984e-01   +1.884873959113257e-01   -2.467618444057217e-02   +3.724377452041598e-01   +3.160086097303336e-01   +9.064396233899038e-03; +4.026446436528742e-01   +6.129380888648324e-01   -1.000000000000000e+00   -4.277555715159311e-01   -7.448668491879739e-01   -4.613452172825665e-01   -1.906671478451422e-01   -9.267664768494793e-02; +2.810793602341733e-01   -2.575897160229207e-01   +2.611050462056351e-01   +4.178731731052828e-01   -3.042228314035418e-01   +3.572182565616191e-01   -5.525193540663567e-02   -3.444251821837822e-01; +1.048676182366670e-01   -3.951597739392236e-01   -7.591367491746587e-01   +9.744344608719896e-02   +2.889478234744549e-01   -2.201669360002196e-01   +3.003189726580812e-01   +5.630896433914319e-03; +4.029162011028053e-01   +1.930169255720870e-01   -1.212020191157296e-01   -1.140991910630657e-01   -3.211028012752229e-01   +5.301832304787095e-01   +1.308412642064383e-01   +5.346271977077693e-01; -2.431216789012321e-01   -7.662125749000739e-01   +8.839355510067078e-02   -3.393904775880970e-02   -4.855868518194252e-01   -5.428076210990106e-01   -7.295677761607675e-01   +3.146401260154664e-01; +6.450359705800246e-01   +4.912925585987134e-02   -1.541920500323564e-01   -6.584792627987012e-01   +3.422609246421915e-01   +1.456733790655691e-02   -7.035329068761753e-01   -2.255328672617523e-01; +3.954854963895568e-01   +3.879723600072525e-01   -3.611124214403126e-01   +3.446565555520609e-01   -7.682479324929159e-02   +7.537842770668078e-01   -2.608697757466549e-01   +1.372863948307346e-01; -7.737390624368909e-02   +9.671423158038481e-02   -8.197160417609729e-02   -5.850686243068517e-01   -1.526422320730019e-01   -2.963862110434615e-01   -3.836640513092616e-01   +2.634780603096564e-01; -3.455426492877661e-01   +7.032215795025164e-02   +4.388740143578626e-01   -1.356445983168813e-01   -6.097650873197924e-01   -1.853297855327218e-02   +5.815465393884532e-01   -7.183940388361157e-02; -9.766601371751084e-02   -1.419314626316582e-01   +1.795002855917272e-02   -1.264266733395547e-01   +7.070562788062143e-02   +9.184013626341916e-02   +3.994753160091281e-01   +1.073581283370179e-02; -4.927687223642517e-01   +3.171324431784705e-01   -1.218023035084475e-01   -1.996781730754981e-01   +1.851490034940177e-01   -2.166574487146661e-01   -9.766375598948865e-02   +3.247526879399322e-01];
L3I_L3E_iAMPA_netcon = [+4.562604721485786e-01   +1.992254848761955e-01   +2.129533025752768e-01   +6.290784857738554e-01   -3.049372573847824e-01   -1.899232431666796e-01   -4.410524646113913e-02   +1.298212551758318e-01   +3.372029224881033e-02   -1.516528056212393e-01   -6.050823186203128e-02   +4.320426337250820e-01; +5.983380331809774e-01   +1.622237466733098e-01   -2.797090772637741e-02   +7.937194087393182e-01   +5.771288827553791e-01   +8.193384915779256e-02   -3.848717207617599e-01   -1.996887802865709e-01   -1.000000000000000e+00   +3.022579444311185e-01   +8.526916296944972e-02   -2.086982938650586e-01; +6.727910220105752e-01   -6.132654771790564e-02   +8.127392716808655e-01   +2.482310932318346e-01   -5.796585397386028e-01   +2.138197211327022e-01   -3.531456114759183e-02   +2.369736674800093e-01   +1.375371786147960e-01   +8.073632156071801e-02   +3.428785077043551e-01   +2.484219698406340e-03; +3.925180625085552e-01   -5.601874682100005e-01   +2.617369600069124e-01   +2.079253993639707e-01   -7.472930778070517e-01   -3.236591259345831e-01   +1.929723938633034e-01   -3.598888034833359e-01   -3.877593787380614e-01   -6.552667874681539e-01   -3.005071759123712e-01   -4.423955549195036e-01; -9.803511914362471e-02   +3.304584965331501e-01   +3.539301006640073e-01   +9.849891819728575e-02   +3.758356967957848e-01   +8.660643700833667e-02   +2.022318058058014e-01   +3.338470845165379e-01   -9.877400269188737e-01   -5.293683832700999e-02   +4.846597839704592e-01   -5.319781423413752e-01; -2.619138764721277e-03   -5.039306514772670e-01   -5.260002126534031e-01   -2.227044941212990e-01   -3.068372337454885e-01   +1.041140860129365e-01   -3.081140658158224e-01   +1.918518590522074e-01   -7.007637734442876e-01   +1.026377089768371e-01   +2.913977197177675e-01   +1.967162532689524e-01; -1.290239844105354e-01   -6.562109835185939e-01   +4.136786201171244e-01   +1.821066198668679e-01   +2.410686620883339e-02   +3.360189042476367e-01   -1.450436722461103e-01   -1.220160110149042e-01   +9.179392479845763e-01   +1.585101316039993e-01   +5.106396156261977e-02   -7.410583065100084e-01; -1.485506124106868e-01   +4.915242312052251e-01   -3.982762312456429e-01   -1.607648494222097e-01   -1.044306169909270e-01   +3.895589192077539e-01   -1.530464479839469e-01   +1.379468781996989e-01   -3.155004848576081e-01   -2.768369088360970e-01   +1.532879707196051e-01   +3.789228520451828e-01; +7.021887400257433e-01   +8.248656808475428e-02   -1.831550998822198e-01   +6.895754648544918e-02   +1.872684807819991e-02   +1.133737924720152e-01   +2.983811965527275e-02   -2.901245835180030e-02   -5.245142726219444e-01   -4.880802422256188e-01   -1.130575508820558e-02   +1.793685694954071e-01; +1.758864520427201e-01   -3.568865677505343e-01   -4.514797686622238e-01   +2.664898799437735e-02   +5.652800883907089e-03   +3.980670528312527e-01   +3.147419205570839e-01   -3.340569646690454e-01   +2.642674116160329e-02   +9.014562814214901e-02   -3.130210968416133e-01   -4.126086961448686e-02; +2.663117681272049e-01   +1.300967701961364e-01   +5.486430937308030e-02   +1.618955019360994e-01   +3.270136095230025e-01   +5.729988985996538e-01   +2.685725432477559e-01   -3.021797375179642e-01   +9.146760932521786e-02   -1.327407023298992e-01   -1.782506815461377e-01   +5.695571720713398e-02; +1.772564003359957e-01   +3.846853261078486e-01   -4.653798313073402e-01   -1.236587352878387e-01   +1.557284347086144e-01   +5.896933327112551e-02   +2.934036035888128e-01   +1.616348129721638e-01   +4.831362379218324e-01   -2.450730921615979e-01   -2.488499646063261e-01   -1.772020267261650e-01];
L3E_L3I_iGABA_netcon = [-3.513077013025493e-01   -2.821794565964493e-01   -4.404126171237945e-01   +1.444729176650931e-02   +3.338433174511465e-01   +5.982043044046005e-01   +1.280503358599563e-02   -3.883997130490391e-01   +4.493279947901618e-01   -8.319845549210453e-02   +7.734759435010476e-01   -8.353931314412777e-02; -6.474381713030421e-02   +8.007743094846601e-01   +3.515603416707027e-01   -1.886092412027260e-01   +4.406094193919853e-01   +4.785248531643299e-03   -3.183744196715516e-01   -1.628440872466643e-02   -4.001936383213969e-01   +2.488345811410199e-01   +5.945243477548565e-01   -7.270843542062949e-02; -1.280850877170278e-01   +6.106333467141642e-01   -5.961447836965817e-02   -3.845286427639154e-01   -2.610008381679005e-01   -3.626190191035435e-04   -5.234413639630087e-01   -2.495513797152179e-01   -4.441987515790297e-01   -8.739507936267716e-01   +6.112538619497325e-01   -8.370130525183514e-02; +8.607877791501545e-02   -1.902602924946604e-01   +2.087710642492817e-01   -8.453179892882678e-01   +3.903299288059294e-01   +3.237646674286873e-01   -4.802391150556316e-01   +9.585379164802509e-01   +1.112881208598890e-01   -5.873947556530477e-01   -4.392271573329427e-02   +1.800284540560733e-01; +8.288719531379317e-01   -6.962883997421619e-01   -2.491900192101437e-01   +3.868796236228889e-01   -3.829586524917534e-02   +5.615756840562218e-01   +7.203181358646485e-02   +5.508940228363527e-03   -4.121700423198939e-01   +2.555364485479253e-02   +5.553551693227530e-01   -8.004181080611572e-01; +5.779846656450608e-01   +5.781585149172231e-01   -3.808473284598742e-01   +4.074811834563203e-02   -4.205406816292560e-01   -9.956551538029809e-02   -3.622227568826477e-01   -7.737058052303404e-01   +6.156870427582760e-01   +3.194178798266609e-01   -7.610349101595375e-01   +5.191303958392037e-01; -7.140612407282919e-01   -8.377212877741570e-02   -7.470783390010909e-01   -2.851502321119707e-01   -8.032141354100810e-01   +8.019893024678910e-01   -8.827485214262829e-02   +2.579092500693103e-01   -3.287174464302747e-01   +6.999975779892519e-01   -8.026067669275816e-02   -2.840330145096092e-01; -2.383865219334711e-01   +5.005763381055075e-02   +3.161577000368736e-01   +5.473772158127261e-01   +4.666206019596785e-01   -3.770393148889526e-01   -6.713318740707475e-02   +1.977156742802310e-01   +2.187051167253043e-01   +4.483565641423381e-01   +5.064203752982296e-01   -4.645414787108053e-01; +4.506639202816133e-01   -7.598081665765197e-02   +2.263568698254840e-02   +1.948713720442658e-01   -3.566690160337194e-02   +3.779878417583615e-01   -3.626322067606235e-01   +2.598880181488666e-01   +4.780155122420304e-01   +1.000000000000000e+00   -1.968091643319672e-01   -1.374982487373410e-01; -1.531820122099285e-01   -3.937239460981938e-01   -3.430617574542788e-01   -6.492144041035383e-02   -4.016581519299727e-01   -5.535679766228220e-01   -3.229351546236611e-01   +6.793627107212317e-01   +1.494845000732133e-01   +9.616594137552446e-02   -5.955457551375015e-01   -2.686657024413415e-01; -4.365608852790551e-01   +2.118686914838222e-01   -8.330815324086925e-02   +5.229707165826872e-02   -6.218380254939655e-01   +6.973184225539278e-01   -1.792119409992239e-01   +6.094179928149763e-01   +5.440683402011807e-01   -1.346760070154591e-01   +6.502574450940182e-01   +6.279468734938119e-02; -4.928703370437510e-01   +8.508036500980362e-01   -5.010654681298743e-01   +2.216936787251321e-01   -2.565880807304883e-01   +2.842529765978980e-01   -2.107936276378282e-01   +4.768544092796802e-01   -9.492059283600596e-02   -1.628417774180181e-01   +3.649258108803335e-01   -4.816443943802060e-01];
L2E_Input1_iAMPA_netcon = [-2.998962308539249e-01   +1.190042107106541e-01   -1.797931726455934e-01   +9.923616335708130e-01   -2.935040233346582e-01   +4.076519964970314e-01   +6.158394620917303e-01   +1.908183264001485e-01];
L2I_Input2_iAMPA_netcon = [+1.906994993009529e-01   +3.453367651723702e-01   -5.855759930648449e-01   -2.196673706144020e-02   +2.489180016954656e-01   +1.758060870890284e-01   -6.014204339010143e-02   +2.085991684993523e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
