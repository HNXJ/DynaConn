function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.408336209781147e-01   +2.025081762057399e-01   +1.460893170982169e-01   -6.933036025059069e-02   -4.964869006205487e-01   +3.742252513965139e-01   +3.025124780114695e-01   +1.027113312092327e-01   -3.439710184014991e-01   +1.660460641631979e-01   +4.478594857177987e-01   +3.068580941620349e-01   -4.062633598476983e-02   +5.499275263185960e-01   +3.480260104762258e-01   -4.700865727797442e-01; +4.360546915788972e-02   -2.812451100208107e-01   +2.041232902871713e-01   -1.639786704004739e-01   -6.255113230236212e-01   +1.079218529590072e-01   +1.556381403327773e-01   -1.053507916741788e-01   -2.610307883680835e-02   +3.877030604141984e-01   +1.911567293979793e-01   +3.420690809076292e-01   +1.628189292675300e-01   +2.888880340696546e-01   +3.441921252537696e-01   +2.705117411250442e-01; +1.232725488776597e-01   -6.841679944166124e-01   +3.029842401005282e-01   +3.461980482247159e-01   -3.783781365173892e-01   +3.240831308039091e-01   +5.710041049172586e-01   -4.638069377284287e-01   +3.608225369160742e-01   +3.140589243695946e-01   -3.710156805235372e-01   -9.501671613927334e-02   -1.379503891929940e-02   +6.843807410629428e-01   -2.839770057107737e-01   +2.273176136113106e-01; -3.125200488467010e-01   +6.819955130936767e-01   -9.059929099281025e-02   +3.086301996200057e-01   +8.258304043506366e-01   -6.231482280978641e-01   -6.552959804617613e-01   +2.152775539847853e-01   -4.147442641066167e-01   -5.160224434968108e-01   -5.845683388369418e-01   -7.529993203319679e-01   +6.966233172892933e-02   -4.281565717352579e-01   -6.749206378639045e-01   +1.752996693144676e-01; +5.594545657908877e-01   +5.295169664189323e-01   -2.612333764536285e-01   -3.900950341222476e-01   -7.925379215443450e-02   +1.818846879649303e-01   +4.348378177905127e-01   +1.821855768453319e-02   +2.140983307293467e-01   -7.015090889785168e-02   -7.789170117756717e-01   -5.756715602190718e-02   +3.275282796122518e-01   -4.928843120785231e-01   +2.024015876466130e-01   +4.503732023678432e-01; +1.346590291612332e-01   +3.316833191799191e-02   -5.414819562003116e-01   +5.440055207838003e-01   -1.677281423261635e-01   +4.226355642459609e-01   -2.024437006640284e-02   +3.503642986524493e-01   -1.135315337143713e-01   +5.004914383626717e-01   +1.503176571878463e-01   -2.390570904623710e-01   -7.207134948003881e-02   +3.577058500245196e-01   -9.514729769228042e-02   -3.497279092818164e-01; +1.145094775357551e-01   -1.468941130629744e-01   +1.000000000000000e+00   -3.330695078578564e-01   -3.562646514575048e-01   -2.228330785761679e-01   -2.598306711168294e-01   +1.620757554674047e-01   -4.695907444977677e-01   -3.948276270661818e-03   +8.556072504834245e-01   +7.429866032774839e-01   +1.820743545683746e-01   -2.779755889829280e-01   +1.131424293858318e-01   -1.873020713244556e-01; +1.571393577324965e-01   -6.121414890012495e-01   +7.640713189025579e-02   +4.328661030744598e-01   +9.271707924820832e-02   +1.701658122986049e-01   -2.610795935490135e-01   +2.586174028673318e-01   +2.227571077530742e-01   -1.845594189623886e-01   +4.211301260534844e-01   -3.555701298106061e-01   -5.654627434598934e-01   +9.634378397803497e-01   +8.252206022642030e-01   +5.993405410254988e-01; +2.888696732696100e-01   +1.966523923423170e-01   -5.730098911175285e-01   +1.940708641965634e-01   -5.981654460451814e-02   -5.385126212699081e-01   +1.598865408604929e-01   +5.227661813844589e-01   +6.924552080122698e-02   +6.847354415494185e-01   -1.665344346922291e-01   -1.531892027135408e-01   +4.136490751925701e-01   -1.004874053361195e-02   +1.429917177054149e-01   -5.706723363372885e-01; +5.058497052230212e-01   -3.047912759280327e-01   +5.237693175396153e-01   +3.281856262959689e-01   -9.470393121790204e-01   -7.909219856317230e-02   +4.572927966786656e-01   +5.935278777330646e-01   +5.385524801890692e-01   +5.313334926530399e-01   +3.051437907939103e-01   -6.883811654756482e-01   -8.702003466331387e-02   -2.138103511617260e-01   +3.684363511282066e-01   -6.372025452986799e-01; +3.964392731855287e-01   +1.089424441033611e-01   -2.255446366182679e-01   +2.977495368955924e-01   -5.157933344727776e-01   -1.715783300436973e-01   -3.125890646642274e-01   +4.327406004518508e-01   +1.777026035285574e-01   -9.730027392061600e-01   +1.502666245582220e-02   -2.440411441341892e-01   -4.133569557820425e-02   -1.419377409088539e-01   -7.067705042005451e-02   -5.897691983341683e-01; -5.248977940066482e-01   +6.647655455349221e-01   -1.226873222377399e-01   +1.971005653412488e-01   -1.308160863158427e-01   +3.517333502483383e-01   -4.950328484468178e-01   +4.957243834998676e-01   -7.692115774177177e-02   -6.668072362076445e-01   +5.188635935382050e-01   +2.558999750686488e-01   +7.074562206735744e-01   -1.318726454713239e-01   +2.104239705463183e-01   -1.949718694981132e-01; +2.041930787859127e-01   -3.695642504004064e-01   +4.822493350040880e-02   -3.295201271712531e-01   +4.471461937933795e-01   -9.322544984252398e-01   +2.756986954292684e-01   -2.874890326137849e-01   -6.636402540695435e-03   -5.822651441853455e-01   +4.722076910202311e-01   +3.036001637265247e-01   -1.717376453001111e-02   +5.029660858764056e-01   -5.986772792884192e-01   +2.430412167688970e-01; -5.172628106431930e-01   -1.526574425909113e-02   -7.878836812118433e-01   +4.365188159900372e-01   +3.611334907861154e-01   +6.031241620852202e-01   -7.437161544238813e-01   +3.076441486479959e-02   -9.615545386806271e-02   +4.477726468535509e-01   +7.279849344816993e-01   +1.571723512303908e-02   -4.502377423792576e-02   +5.726565939177277e-01   +2.707527717637012e-01   -5.619170373381902e-03; +4.142346030342052e-01   -2.774606555501352e-01   -4.326268304693356e-01   -6.573445247393964e-02   +4.228364159202670e-01   -1.488384505143908e-01   -1.239427611970463e-01   -2.501882652243791e-01   +2.227702433129964e-01   -3.087755772483196e-01   -4.754016649415729e-01   -2.970936555956494e-01   -5.270444267962910e-01   +6.484039340545424e-01   -1.055532248256250e-01   -4.719791514422139e-01; +1.340182531843722e-01   -4.774878409192457e-01   +1.445640460145816e-01   +2.614136014825019e-01   +1.667593020908023e-01   +1.251712745251686e-01   +3.524797328599455e-01   -3.791533041125402e-01   -1.291017675874743e-01   -4.971384180151231e-01   +4.816491266920858e-01   -3.520213491997299e-02   -9.731283025330301e-01   +1.539776169983647e-02   +5.539561293610364e-01   +3.696528389683160e-01];
L1E_L1I_iGABA_netcon = [+5.162786412784757e-01   +5.865992277126901e-01   -6.143611374848765e-01   +3.422561733786041e-01   -8.701489011887086e-01   +5.445735080020061e-01   -1.539785640081934e-02   -3.169320575417859e-03   -4.667445521868562e-01   +2.139982203574709e-01   -3.007443367361283e-01   -2.071735580948030e-01   +2.622360500573921e-01   -6.456356534203155e-02   +9.230543102056565e-02   +1.709029758873876e-01; +1.518819210189579e-01   -8.270463096188887e-01   +3.584092099536756e-01   +3.448975755241303e-01   -2.664882900070568e-01   +1.762016582857435e-01   -2.935500260664589e-01   +2.131775708858897e-01   -7.180987039599789e-01   +6.616497594665106e-01   -4.213847005280276e-01   -3.397580382343039e-01   -2.016418787860208e-02   +1.744595116097991e-01   +9.329652555981411e-01   -2.896082396898467e-01; -1.839742346499504e-01   -1.699562164899405e-01   +1.325975792448359e-01   -3.646872037238166e-01   +3.613244068406067e-01   -5.503087677185062e-02   -3.956582214831025e-02   -4.145332330192826e-01   +1.656155099512698e-01   -4.865607363914354e-02   +3.463372496937607e-01   -3.147272493003802e-01   +1.638889802668644e-01   -4.837447202668523e-01   +4.065007715965295e-01   -4.357831974192090e-01; -6.526238762781912e-01   +4.715028787212480e-02   +9.270055830172490e-01   +2.872648212741345e-02   -3.296135508484921e-01   -4.667378435120538e-02   -3.110964912487675e-01   -1.237414680596731e-01   -1.719868919676847e-01   +4.007700893243630e-01   +1.828848909800458e-01   -6.700123588096653e-01   +4.670388207263593e-02   -1.734229025899208e-01   -1.946316771687785e-01   -2.792861428252231e-01; +4.525854794439652e-01   +6.210651825631522e-01   +1.479422860000281e-01   +6.230332494855263e-01   -7.361698972908436e-01   +2.258581592404703e-01   -5.854690377367338e-01   -5.782061749149078e-01   -6.163081641261262e-01   -2.764000008409879e-01   -1.000000000000000e+00   +2.802492916465615e-01   +4.160994883927349e-01   +5.086625409684457e-01   +1.243187581213718e-01   +2.511074386554312e-01; -4.387749134521656e-01   +4.003301667550437e-02   -6.537863499412182e-02   -3.954969805729059e-01   +3.231017235366532e-01   +9.563276579214066e-01   +6.568020557119740e-01   -1.555398288924104e-02   +1.045329304305387e-02   -4.397983352814314e-01   -3.962846218584773e-01   +7.770425484221420e-01   +6.779126114230110e-01   -9.460226933842224e-02   +2.963086162783078e-02   +1.302686253952963e-01; -4.067571977931051e-01   +3.234764491381029e-01   -4.438466649956789e-01   -1.107432600544454e-01   -1.618531430902160e-01   +1.742313114316246e-01   -8.648889087870555e-02   +1.037686374186862e-01   +2.605269206361258e-01   -1.516834352165642e-01   +1.539999938438174e-01   -1.059184811463741e-01   -5.140679757879536e-01   -8.572941887968059e-01   +5.349094817159620e-01   -7.999794053132597e-01; -3.471376810779911e-01   -2.252768984650054e-01   +3.252870241845973e-02   +4.324180511949652e-01   -4.807199774486396e-01   -8.591283555260214e-01   +4.394947367034426e-01   +1.130027545562069e-01   -5.837223269993301e-01   +1.447187267160655e-01   -2.869059326242284e-01   +4.889167818417783e-01   +6.068307678476471e-01   -4.722809101711511e-01   -4.537865247569004e-01   -1.487679271556157e-01; +2.857329694578548e-01   -5.323193669173278e-01   +4.760101122719435e-02   +7.588681299963458e-01   -2.355424152641751e-01   -5.704748482869365e-01   +5.911453540503040e-01   -7.545445695199277e-01   -4.250399576192919e-01   -6.092127709079574e-01   +2.301123505208269e-01   +1.283430392356024e-01   -1.789328552711967e-01   +4.269623364142034e-01   +1.602788011032356e-01   +8.065853132722632e-02; +4.534808275504172e-02   -5.381796617908331e-01   -9.409201400926490e-02   -1.741594900521778e-01   +5.254367186638195e-01   +1.538538554848922e-01   -2.429722402289577e-01   -1.269292850263588e-01   +6.447889028889441e-01   -1.991221241079258e-01   +2.272261410358938e-03   -2.201444322334234e-01   -2.926239854064403e-01   +1.841339241405249e-01   -6.937685770037252e-01   -5.369272865051736e-01; +1.115025671608560e-01   -4.413936228915402e-01   +6.389974424707910e-01   -2.547125063943416e-01   -3.760734619000045e-01   -3.152168967137192e-01   -2.694247786425835e-01   +3.848805017388333e-01   -1.249913844929794e-01   -2.196541715094967e-01   +2.260019983828387e-01   -4.135547887309822e-01   +2.645670208785971e-01   -5.427688699667903e-01   +2.138269633461453e-01   +3.757200648866197e-01; +6.353491721120896e-02   -3.502229219988418e-01   -1.977372890400613e-01   +2.464101049144061e-01   -2.990550356119192e-01   -5.083339270251354e-01   -4.400553184248652e-01   -4.215892237135645e-01   -2.941148665262968e-02   -2.347115776513442e-02   -6.568528543431367e-01   +3.188678482143107e-01   +2.219619610738462e-03   +6.065731190028610e-01   -1.149014913519895e-01   +4.110838039910658e-02; -2.714501134248669e-01   -2.791432254143222e-01   +7.654014735217189e-01   +5.542830105523853e-01   +2.106652809361510e-01   -5.449318867098757e-01   -4.174897663857962e-01   -6.707166344209755e-01   +8.970221590231841e-01   +2.210816773852419e-01   -8.386235506044808e-02   +5.820710939530562e-01   +2.326420555191017e-01   -2.401614445952455e-01   -4.477766047485223e-01   +5.444360080405373e-01; +7.276654248502881e-01   -4.109849937000041e-01   +3.459402832522278e-01   -2.866618863811150e-01   -4.510207431775857e-01   +6.573282204736528e-01   -4.084771494950482e-01   +7.221132219654055e-01   -3.172064906241981e-01   +4.346537767673849e-01   -4.470770576842678e-01   -1.703536299667847e-01   +1.382852147252731e-01   -4.923321042041469e-01   -2.295760134481639e-02   +1.079956522318926e-01; +3.415324257235015e-01   +6.298548238265665e-01   -2.080696586593145e-01   -1.269536718482077e-01   +3.529665783244306e-01   -3.351203744126083e-01   -7.204842071961781e-01   -2.887594206977805e-01   +5.329127209900607e-01   +4.438009480084101e-01   +6.904194014606545e-02   +4.317695227945988e-01   +4.387116144101448e-01   +3.170494962172645e-01   -4.136551851411857e-01   -1.094902802676357e-01; -1.524153542445502e-01   -2.405096141126870e-01   +1.546813495859680e-01   -4.889510184556494e-01   -8.841065014818813e-01   +1.576250982824410e-01   -4.958119070483817e-01   +1.598097574685892e-01   +4.977199887106749e-01   +2.863128264706059e-01   -4.874851920229455e-01   -2.584277179224051e-02   -4.569033754879688e-01   -6.064248920020663e-01   -1.453683194293408e-01   +5.287582658021645e-01];
L2I_L1I_iGABA_netcon = [+4.365361253927137e-01   -2.272795935793372e-01   -2.899435237263722e-01   +8.279186700967014e-01   +1.039132873834827e-01   +2.560393683799916e-01   +1.240855548534373e-01   -9.726123509621785e-02; -2.811820521702620e-02   +6.753413944910326e-02   -2.515734177900249e-01   +4.319897571045599e-01   +7.391380296939877e-02   +4.773518439101928e-03   -2.423467570839177e-01   +4.878902194403062e-01; -5.149660770479597e-01   -4.181904139213395e-02   -6.010267195716475e-01   +2.458741726000248e-01   +2.893012096528910e-01   +4.987769892255032e-01   +2.581805446015541e-01   -1.321563399932972e-01; +3.119014686627465e-01   -4.173048302483571e-01   +1.684850262244575e-02   -3.441135817196803e-01   -5.069541139931424e-01   -1.058940010989520e-01   +3.729313322127192e-01   -3.984384039482547e-01; -1.285669125398131e-01   -1.791281640539432e-01   +4.569022664752282e-01   +3.866459275469540e-01   +1.477015820934625e-02   +2.547813266336255e-01   -3.892898658385960e-01   +7.691036051816862e-01; +3.531139187315973e-01   +2.645328503258857e-01   -7.351775527051172e-01   -4.885469808875197e-01   -1.122442818354005e-02   +4.473151839511062e-01   -4.346742023538294e-01   +2.386931053522963e-01; -8.060814997431024e-01   -2.296890956920293e-01   +4.903513380034422e-02   +6.661990122208593e-02   +3.276651962256618e-01   -8.511509402327765e-02   +3.308368384614951e-01   +9.091493564294936e-02; +4.845161141908276e-01   -2.883414348896030e-01   -5.027511570978677e-02   +4.724447328039825e-01   -5.273408227800238e-01   +1.606408207688006e-01   -2.437613536256818e-01   +6.968976426718042e-01; +1.488714614796358e-01   -4.540990969655003e-01   +2.065773181188531e-01   +2.762983837005303e-01   -7.663211023587432e-01   +1.737255231473780e-01   +3.992117431297523e-01   +3.224140713074771e-01; +4.130712185553507e-01   -2.349226464738073e-01   -1.199791332049239e-01   -1.000000000000000e+00   +1.583417579541121e-01   -3.529285816089306e-01   -5.578706702755007e-01   +1.014754306239447e-01; +3.395482932436853e-03   +7.343981866695934e-02   +3.553546518921470e-01   +8.759089568950050e-02   +5.330848637494479e-01   +3.612483334939134e-01   -5.873569979251267e-01   -1.826190060522022e-01; +3.552688373517388e-01   -6.140379488686603e-01   -8.765685444332284e-01   +1.146594473829820e-01   +1.055308163328352e-01   +2.407341288940842e-01   -2.135392682919261e-01   -2.543194312043519e-01; +7.591967355098216e-02   -1.011997844164867e-02   -7.517313725926639e-02   +6.779033280574315e-01   +2.139597279846954e-01   -7.240901936897580e-02   +3.775010282453279e-01   +1.233416124815516e-01; +2.325307415436274e-01   -4.565740427404224e-01   +2.619022854455580e-02   -1.365871514410984e-01   +3.832026545320354e-01   -4.708127039178958e-01   +3.916672762081933e-01   -3.415768026375509e-01; -2.652161779871110e-01   -1.169897252407114e-01   -8.062948079030595e-01   -6.554932669195734e-01   -2.317439345602207e-01   +6.923241069023696e-02   -1.461708775850957e-01   +5.109877270002945e-01; +1.069510908699048e-01   +5.512351174335118e-01   +2.703886871701218e-01   -7.424687488784160e-02   -1.924532194452555e-01   +3.487591402894935e-01   +1.494371976281842e-01   -1.319538542298710e-01];
L1I_L2I_iGABA_netcon = [+2.514067967164630e-01   +3.414673382568427e-02   -4.376575077017085e-01   +1.720991444342853e-01   +7.435147035836693e-01   -5.943853884062957e-01   +6.316135542462502e-02   +2.978253199022457e-01   -1.243832996929973e-01   +4.735931586182628e-01   +4.538827678456518e-01   +3.053656359716620e-01   +8.438377538578739e-01   +2.186308982418080e-01   +3.201009485623519e-01   +5.058514645619336e-01; +1.190601368695741e-01   -8.274016012136021e-01   +4.454510362226510e-01   -3.508542539561997e-01   -3.819034607909055e-01   -4.787241095705528e-01   -2.455040342157646e-01   +5.408211393704796e-01   -4.434132009647797e-01   -1.158981210760538e-03   -7.998349331663231e-01   +5.059104787888759e-01   +5.524148915797593e-01   -7.482828756895565e-01   +9.146590079050962e-02   +7.838921831458181e-01; +2.853226232176884e-01   +5.042055113563880e-01   +4.917198538883749e-01   +1.816631738263813e-01   +4.401094252763221e-01   +1.343307474302769e-01   +5.040769563769911e-01   -7.825794813282760e-02   +3.312974871604914e-02   +4.067988010714922e-01   +7.118878043432784e-01   +5.601900095420690e-01   -4.328363722332671e-02   -5.518772238318956e-01   +2.620842163878255e-01   -3.430851783921927e-01; -7.818351445244265e-02   -1.779905268687611e-01   -5.890343192028820e-01   +1.999616552518416e-01   +1.561716851846852e-01   -2.691511078493387e-01   +2.034163172344595e-01   +1.177235101978454e-01   +1.486032143363943e-02   -5.026145933096999e-02   -2.585540822631717e-01   +1.759913974372647e-01   -6.416087227658125e-01   +4.290999987009315e-01   +7.303808139282560e-01   -6.829591304995815e-01; +7.249057135586036e-01   +4.917282553246584e-01   -2.082961155219010e-01   +7.543247340454077e-01   +4.097807949966380e-01   +7.016181685116285e-01   -1.623891926707165e-01   -1.871581893880294e-02   +1.000000000000000e+00   -3.966453027211957e-01   -8.116523820108993e-01   +6.765086199600248e-01   -5.445317657112460e-01   +3.744325447270029e-01   -3.239596381574787e-01   +4.974525607274964e-01; +1.462315512015946e-01   +2.433360320772777e-01   +4.360088797125119e-01   -4.005025276229430e-01   -2.357610830117891e-02   +4.369250855312112e-01   +5.733990824260303e-02   -1.617996133299947e-01   +3.232564059766883e-01   -7.879098024148518e-02   +1.136507229166765e-01   -3.068036917451538e-01   -3.430125551100049e-01   +3.689246845012251e-01   -4.085124162400470e-02   +8.171204488304495e-02; -9.196618978937939e-02   -1.692611808305671e-01   +4.712390166546157e-01   -1.310771006377824e-01   -9.454907853828154e-02   -1.614551572230788e-01   -4.556929743075332e-03   +3.607828486440359e-02   -3.550661025229092e-01   +8.544180194371443e-01   +1.327537826978786e-01   +6.884288688783639e-01   -2.572338729143744e-01   +2.391077877682804e-01   -3.538696160358292e-01   -5.851329281433026e-01; +4.809898116676445e-02   +6.656031563615896e-01   -1.155465027323572e-01   +1.691747301214365e-01   -1.944357764066448e-01   -3.030839403550869e-01   -5.339636149631030e-01   -6.885129494828490e-02   -6.605466175526974e-01   +2.727560107673546e-01   -1.661178383619631e-01   +3.633663882418129e-01   -6.058145498514965e-01   -4.323928956403327e-01   -4.377891889838080e-01   -4.530990138891236e-01];
L2E_L1E_iAMPA_netcon = [+5.124030495900284e-01   +9.895133031055006e-02   +3.956997417966865e-01   +8.149501326858725e-01   -3.875365989330917e-01   -1.812204184197548e-02   +6.287939691883762e-01   +2.182604124903136e-01; +6.264330920568549e-01   -8.433951585886448e-02   -2.622144214686440e-01   -5.657688457569349e-01   -2.218008913337242e-01   -7.751889512660205e-02   +6.214522644581477e-01   -6.460244931207937e-01; -5.514413475620098e-01   +3.209611191649318e-02   +8.581556803304524e-02   +5.587091702354566e-01   -2.879052335564579e-01   -3.797423834208347e-01   +2.087629415841185e-01   -3.056660185761538e-02; -9.924888055712264e-02   -9.562351477630218e-02   -1.440992382884784e-01   +5.637284728853350e-01   -6.377084654425778e-02   -7.203529378960847e-01   -3.702454488433665e-01   -1.755445732143531e-01; +3.172740309602195e-01   -6.113856755851759e-02   +2.200031713750555e-02   -6.632937482601052e-02   +1.090069757670046e-01   +5.046054002776681e-01   +5.921741724940632e-02   -2.297761252478620e-01; -2.477960221105697e-03   +1.518694418084242e-01   +1.314999383429431e-01   -6.105780088657362e-02   -9.989348132159750e-02   +6.887033219871148e-01   -2.444104016563153e-01   -3.658384043187524e-01; -1.101855432853373e-01   -1.512569518972257e-01   -3.816437023940363e-01   +7.053529871230413e-02   -9.614692371348363e-02   +5.767999859259441e-02   +9.773008088814802e-02   +3.308216723500614e-01; +3.321498101700134e-01   +7.889220597441093e-01   +6.968134114465369e-01   +3.924362369488879e-01   +4.864376464974373e-01   +5.916816644514838e-02   -6.252531408288017e-01   -5.131440299171790e-02; -1.323266641741980e-01   -5.999507056506816e-01   +2.788098097755075e-01   -1.419426223633435e-01   -5.770688357805860e-01   -1.439099745581274e-01   -5.496059207234253e-01   -1.000000000000000e+00; -3.967658420138752e-01   +4.170195895844148e-01   -3.551539286510007e-02   +4.361475751023024e-01   -7.587284318501342e-02   +1.417663482894435e-01   +6.415418529347103e-01   +8.615527655239897e-03; +4.976760833310023e-01   -3.755823234520375e-01   +4.014426669862188e-01   -3.969482884004257e-01   +5.402992088556537e-02   +3.900491847994387e-01   +2.932831277917411e-01   -4.325511882988146e-01; -1.473522567395683e-01   -2.282884228622834e-01   -4.284033054289947e-03   +2.383879408179926e-01   +8.880403997926611e-01   +6.876496046565547e-01   -6.369204102626554e-01   -4.583789984997289e-01; -2.254948548749960e-01   +8.800222884891724e-02   +2.615940301872172e-01   -1.459995650671622e-01   -2.082914393274846e-01   +1.837836222799492e-01   +8.835907046966918e-02   +5.940429291758268e-01; +7.737490191918586e-01   +7.309224131704994e-02   -2.874238528443679e-01   -9.970410762333421e-03   -7.776508906671723e-01   -3.502688687466944e-01   +7.481523587534505e-02   -4.657146642584888e-01; +6.205102115480221e-01   -1.112896567729960e-01   -4.160619957655124e-01   -7.676232462453818e-01   +5.677747864008809e-02   +4.929455326295302e-01   -5.965022759110876e-01   -1.192713622249086e-01; +5.063264655077358e-02   +6.253387474123120e-02   -5.069956730392028e-01   -4.854708817116411e-01   -3.036216255556917e-01   -2.026457895759478e-01   -8.680984089805858e-01   +2.871639151586543e-01];
L1E_L2E_iAMPA_netcon = [+2.419902036962750e-01   -2.308391442480736e-02   +4.063568477145435e-01   -5.443913689810970e-01   -9.597744562514686e-02   -5.646680209846793e-01   -4.766939857751961e-01   -2.751142246387936e-01   -1.452121621840217e-01   +3.955735237151441e-01   -1.279957739930103e-02   -6.446664862743682e-01   +4.420261357418211e-01   +1.131495504382497e-01   -3.050354925817342e-01   -2.130362149885396e-01; +2.806854024090031e-01   +1.051340226143403e-01   -2.367585692698242e-01   +3.541949854632897e-01   +1.167850544790203e-01   +7.143457460896185e-02   -2.427833163897129e-02   -7.602973194217078e-01   -8.582327632001465e-01   -3.847964433684177e-01   +8.270662443465288e-02   -4.872389390710807e-01   -3.908312264517437e-01   +5.996455150449254e-01   +1.574503511709673e-01   -7.398453757782822e-01; -6.271636686710632e-01   +4.393354027902751e-01   +4.922581927731522e-01   -1.002015367531937e-02   -2.940962159284738e-01   +2.716258550635037e-01   -5.048507951961525e-01   +2.820795440544250e-01   -2.323022088542514e-01   -4.846091855550244e-01   +3.286978720590916e-01   -1.373696341660114e-01   -3.565134063008756e-01   +1.898992541421178e-01   -5.270846079096002e-01   -2.530738091391653e-02; -1.938073292606450e-01   -3.250614409939595e-01   -6.142298592419968e-01   +3.870473352387226e-01   -2.115090145829168e-01   +3.596891177214237e-01   -3.819413398325339e-01   -1.529312294320734e-01   -1.836904333228081e-02   +2.645285027820691e-01   -4.468228764566972e-01   -2.229408873746012e-01   -2.313868368110761e-01   -5.453391069614779e-01   -1.474305081010523e-01   -1.546418860495652e-01; -2.110190625584322e-01   -6.809015237340038e-01   -4.449312573851164e-02   -6.270884044407311e-02   -2.110044076651784e-01   +1.142545314537244e-01   -7.018039806026030e-02   +6.748806091919001e-01   +7.668123626330275e-02   -5.169615799641496e-02   -2.954176558927016e-01   -3.695750230961241e-01   +1.581025997430761e-01   -1.363649052645064e-01   +8.731523559260107e-02   +2.868550424984393e-01; -8.450232775489590e-02   +5.956914883652924e-01   -7.184738301673638e-02   +2.154507617978242e-01   -1.958114843512885e-01   +6.454203112196912e-01   -1.616995098703068e-01   +2.540375236611194e-01   -1.716159735401622e-01   +1.319787169605238e-01   +6.693205059663261e-01   -1.064892209068764e-01   +4.328340487638315e-02   -6.144040083795925e-01   +1.345795776635036e-01   +6.615696496218838e-02; -1.061246098699849e-01   +6.928530231808490e-01   +1.000000000000000e+00   -1.885738942625982e-01   -3.388339474963337e-02   -2.301704208308407e-01   +7.757417817730365e-01   -5.889087686009442e-01   +8.503376670360970e-01   +5.006042872482181e-01   -4.091298511251126e-01   -2.338026856362198e-01   -1.435380169881824e-01   +1.184246246320689e-01   +5.849737638951445e-01   -8.776978442278115e-02; -1.299240134392165e-01   -3.558273417552894e-01   +6.712705330633699e-01   -2.339240915017032e-01   +6.153315924118734e-01   +2.324812623350702e-01   -3.987732848929856e-01   -2.417243689865281e-02   +3.980409434427892e-01   -9.091531634414551e-02   +1.295690003262510e-01   +9.087551763084519e-01   +6.303858887648961e-01   -2.373424843400704e-01   +3.680928739322279e-01   +7.689717121043790e-01];
L2I_L2E_iAMPA_netcon = [+3.595555373821628e-01   -6.542552329381868e-01   +5.490099752817515e-02   -5.286440019385211e-02   +1.287263662657212e-01   -3.691430041363728e-01   +7.449021765474771e-01   +3.944894337096301e-01; +4.693741295290320e-01   -3.350875619494740e-01   -2.757405061374363e-01   +4.117484309933071e-02   +2.299905297457539e-02   +5.967049286757421e-01   +4.846625562316242e-01   -6.506271905161787e-01; -4.269880444194052e-01   -1.147508381447288e-01   +3.115561565935413e-02   +4.294493340789681e-01   -2.175676780211491e-01   -5.531892285787522e-01   -1.066393737507253e-01   +9.378117529988500e-01; +1.476677004344887e-02   -7.290588529089975e-01   -1.526831136710386e-01   +3.299691130104356e-01   +7.215626148663541e-01   +3.788011597112219e-01   -2.440196993335231e-01   +1.597718936185496e-01; -2.240327194933050e-01   -5.414003722542559e-01   +2.999427292149965e-01   +1.810279300393455e-01   -4.766109757075512e-01   +1.176858518888109e-01   -5.302578737948244e-01   +5.853381344371312e-02; -8.657028625936894e-02   -5.733685167574535e-01   -4.644462692903221e-01   -1.468748260485362e-01   -4.445266449872367e-01   +1.581409797545962e-01   -1.107119584146717e-01   +4.889269242561338e-01; +1.803771198004416e-01   +4.636007598915101e-01   +6.531400963663871e-01   +1.256429257401790e-01   -4.366658634496665e-01   +4.656815257946638e-01   +3.758197946389397e-01   +9.149777163252276e-02; -4.392789821941443e-01   +8.457418262477844e-01   +1.312888219735514e-01   -5.328021856536119e-01   +3.833979875835533e-01   +9.329853181155911e-04   +1.000000000000000e+00   -5.796336986371302e-01];
L2E_L2I_iGABA_netcon = [-3.198685831940298e-01   +4.958020149634937e-01   +3.373184008617376e-01   -2.975472580563128e-01   +8.947209653505181e-01   -3.856544820503005e-01   +6.631264534922823e-02   +2.928251360337165e-01; +1.471079945021250e-01   -6.222248974458200e-01   +5.264930297418747e-01   +4.136229359021383e-01   +3.992185093295283e-02   -7.967563954895263e-01   +8.498382003888065e-01   -1.624144022385430e-01; +3.033822558850230e-02   +3.140783998812509e-01   +6.233029561198753e-01   +3.374433141784559e-01   +8.273321193885087e-01   -1.320838327506421e-01   +3.444378417628049e-01   -4.941084373257867e-01; -9.495716996439657e-02   -7.030658049638041e-01   -2.304278475307935e-01   +5.676024716257918e-01   +4.230938065449621e-01   +4.305322668520131e-01   -5.481819320072780e-01   +3.860762450320804e-01; +2.450261831616566e-01   +3.415706962384085e-02   -7.591277642518129e-01   +5.133370997087668e-01   +2.620656441500068e-01   -2.745567445977080e-01   -4.874609151457839e-01   -3.012707687197026e-02; +1.494527788456687e-02   -1.624776639887958e-01   -6.001176036518234e-01   +1.803896100229437e-01   -1.646958382197410e-01   -2.138402566350192e-01   -7.161620559897035e-01   -3.809694283321477e-02; -1.753795681569159e-01   +2.937796136116220e-01   -1.946828222144440e-01   +1.468272251813506e-01   +2.058142282865422e-01   +1.095576290366857e-01   -1.456005030236343e-01   -2.303001250723531e-01; -1.982491954763575e-01   -1.377240571800229e-01   +4.326050039316687e-01   -1.841961961562060e-01   +4.310239039408553e-01   -3.650805115208084e-01   +2.656555611976243e-01   +2.129836522744701e-01];
L3E_L2E_iAMPA_netcon = [-3.898857118382071e-01   +5.688050538732683e-01   -5.570240436262452e-01   +2.415227260322084e-02   -1.319611249243414e-01   -8.506702189548221e-01   -1.418384385698566e-01   -7.593747595888675e-01   -1.716388444492282e-01   +4.428049671844776e-01   +6.563265055156730e-01   -2.444310753126601e-01; -1.915505515546359e-02   -2.048029281491152e-01   -1.800444469285422e-01   +4.296119240344549e-01   -2.766842492775340e-01   +2.106486024965802e-01   +6.805009070348744e-01   -8.154043864722826e-02   +7.177425637020014e-01   +4.397599180221823e-01   -6.185427110728829e-01   +9.561124280749424e-02; +2.775831222529535e-01   -7.934885936378781e-02   +9.185257423493715e-03   -4.542794189607790e-01   +1.117351245027384e-02   -1.898407061084864e-02   -3.387908783619080e-01   +6.760160597676614e-01   -2.246105906503151e-01   +6.473706184164373e-01   -3.094855301772816e-01   -1.668976893708510e-01; +2.656411276009466e-01   +1.663977672900745e-01   -2.037713070429921e-01   -2.834865246326086e-01   +9.003240589357802e-01   -2.509697764930087e-01   +3.338704998895876e-02   -4.776233116073324e-01   +5.134992350251690e-01   +2.867232603677425e-01   +1.952041838633464e-01   +3.804454686333865e-01; +1.457357339326106e-01   -3.456484291448527e-01   +3.433628422173226e-01   +4.251517784224136e-01   -6.613011465485860e-01   +4.662041296583658e-02   +4.146789063217086e-01   +4.006296686618377e-01   +2.474174602985862e-01   +6.259237508299098e-03   -2.251955594652706e-01   -2.403403680189183e-01; -2.505398628447737e-01   -8.265833202203671e-02   +6.118355180942714e-02   +6.064038345841446e-01   -4.664056171244166e-01   -1.248211254781839e-01   +2.803184554712800e-01   -8.564670099996988e-02   +7.660820811448048e-01   +2.226318350973872e-01   -1.883422621416024e-01   +3.762239160118701e-01; +9.271185333449896e-01   -4.732876727496786e-01   -3.956176387086230e-03   -4.968022851201360e-01   +5.456033731743065e-02   +5.181200979933996e-01   +1.083361787472602e-01   +7.102407232162374e-01   -1.284545997240791e-01   -6.883031045781038e-01   +4.167444761529044e-01   +3.779630439997720e-01; +2.055446679729252e-02   -4.925120360312349e-01   +2.399634785491741e-01   +4.052175466382266e-01   -6.109973856035031e-01   +4.096992484097113e-01   +1.038727786976157e-01   -1.468615547969163e-02   +3.027285522257822e-01   +3.042870024736919e-01   -3.706682234592363e-01   -2.351575633017176e-01];
L3I_L2I_iGABA_netcon = [+2.138541001103087e-01   +1.552897065056335e-01   -6.332504811187225e-01   +1.252245051501964e-01   +1.383327777365140e-01   +5.800794031362835e-01   -5.458025359435471e-02   -4.431556859524846e-02   -3.557469926478281e-01   -1.039201892092483e-01   +2.443261390434338e-01   -2.385030485926123e-02; +5.089396407684019e-02   +6.377239709847975e-01   +8.803702240051163e-01   +2.557223395745316e-01   +2.757242605387334e-01   -7.989942095165785e-01   +1.611892751674646e-01   -8.090899476394369e-01   +2.045706431266871e-01   -7.185872465226723e-02   +5.427217505392115e-02   +5.421517933533568e-01; +6.608234129997448e-01   -1.636435229423860e-03   +8.572820771936502e-01   -2.917575995417071e-02   +9.731107312765733e-02   +7.053365555315934e-02   -7.434713984474534e-01   +9.480549051387220e-02   +4.683238057553353e-01   -2.046878987005703e-01   -8.158685184110722e-01   +2.410168062611257e-01; +5.444271133949865e-01   +1.009306005651751e-01   -6.712352141779299e-01   +9.698418209744730e-02   -8.248166404622399e-01   -3.800287934584376e-01   -7.747373645385888e-01   -6.954890071349978e-02   -1.623846881032935e-01   -4.425570060569507e-01   +1.035807092287521e-01   -1.559281534543063e-01; -1.019428634403207e-01   -2.093527099457196e-01   +6.394405582260302e-01   -1.671015435461419e-01   -6.882596341967078e-01   +6.508427228918843e-01   -2.751532841358215e-01   +1.124590362966026e-01   +4.026786918741840e-02   -1.945829889074527e-02   +4.207263306241575e-01   +5.593129141885712e-01; +4.929409777511748e-01   +5.176225847044487e-01   -4.136641500112561e-01   +1.019218623200879e-01   +1.770835950182042e-01   -6.840819486774418e-01   +6.089111980347919e-01   -7.467153038450741e-01   -1.153025780521943e-01   -4.155528190415959e-01   -1.537249928845633e-01   +2.482966839962646e-01; +2.625996333585741e-02   -1.439837655351218e-01   +3.392020243592324e-01   -5.360935217217013e-01   -2.988608964493916e-01   -1.321662182129437e-01   +2.601130076724681e-01   -9.712969769339577e-02   +2.593509270602884e-01   +2.974285213171819e-01   -8.729039175476694e-01   +2.247768914564114e-01; +2.981325616604582e-01   -2.078866396274139e-01   -1.584954703722883e-01   +1.551267304851439e-01   -4.752529848033918e-02   +8.652721366338718e-01   +3.149431493555846e-01   +2.270237859553817e-02   +1.463696181875984e-01   +2.044089669132467e-01   -1.237305085298318e-02   +6.080008835740094e-01];
L2E_L3E_iAMPA_netcon = [+2.496279196202073e-01   +5.912051921365374e-02   -2.125058764583088e-01   -6.268352590704985e-01   -2.579345042680409e-02   +8.935755852167977e-01   -4.373721682372876e-01   +1.103441700219124e-01; -5.397844382585689e-01   -2.732828049857273e-01   -6.235121406458707e-01   +1.140385896455682e-01   -3.426939795371986e-01   -7.273019754043519e-02   -1.771794187216703e-01   -3.946277409863236e-02; +6.285647620850564e-01   -2.285162091492582e-02   +7.338618591878378e-01   -4.221875581293560e-01   +4.155412260522888e-01   -5.307815365459984e-02   +2.930174833109778e-01   +1.092952893706657e-01; +2.844196281705330e-02   +7.503262056601101e-02   -5.726668502707397e-01   -2.173710200055407e-01   -7.590512507651699e-01   +3.302350437596622e-01   +1.140464351739497e-01   +1.989428008052893e-01; +7.275708881450105e-01   +8.517376510568808e-01   -9.729990584359858e-01   +3.372293742978204e-01   -2.589181214033459e-01   -5.147372766094858e-01   -1.849853159832268e-01   +3.917068014594930e-01; +3.857448986295502e-01   +1.152712124834045e-01   -9.761629843924057e-01   -4.363295074878948e-01   +4.361584926528181e-01   -4.393502584663077e-01   -6.782663545657519e-01   -1.850792899334113e-01; +3.589012091754824e-02   -1.695499595158663e-01   -3.593188233359174e-01   +8.343415408627120e-01   -4.979116441787939e-01   +6.019529289366283e-01   +9.582303321665006e-02   -6.893505302902574e-01; +1.169048010122122e-01   +6.879481115108735e-01   -7.121137359262681e-01   +6.905789002651019e-01   +1.948929117132964e-01   +1.347431466036290e-01   +5.631939487339717e-01   -2.492065257699874e-01; +8.051355972663363e-02   +7.398872688454141e-01   -8.349548127260814e-02   +4.051869372337831e-01   +4.784446155849995e-01   +4.022102940977593e-01   +4.906584365351307e-01   -5.472217286331067e-01; +5.543455287472241e-01   -2.348985185923716e-01   +9.640395294070087e-02   -1.071702272142479e-01   +2.155869437301565e-01   +6.710862874244932e-01   +9.974370887489614e-02   +6.142988807621359e-01; -3.968268810153630e-02   -6.533466089296172e-01   +2.667105108056383e-02   +1.936530419748198e-01   -8.139173356009421e-02   -8.568095118331106e-01   -1.219585273323215e-01   +1.673040508426313e-01; -1.843600201431538e-01   -5.147156255252889e-01   +3.893242397195136e-01   +4.584089688167877e-01   +6.623033850343625e-01   +3.370911135630454e-01   +6.985572895972342e-01   -1.775001181167546e-01];
L2I_L3I_iGABA_netcon = [-2.098726591092121e-01   +2.818329119024204e-01   +4.040737088540574e-01   +2.611465263094251e-01   -5.770411957831387e-01   -3.892723832436937e-01   -1.857003119687660e-01   +2.708686921328158e-01; -9.247915905608342e-01   +4.179261152564817e-01   +1.676456673095529e-01   -1.000000000000000e+00   +1.925100816965011e-01   +7.317624362108994e-01   -2.265905427119352e-01   -1.697894676187175e-01; +9.212882437771872e-02   -1.984067127928148e-01   -3.559442203504091e-02   -2.773293616637919e-01   +2.159771683597602e-01   -4.755828229685269e-01   -3.706588456239679e-01   -7.777086506729587e-01; -4.696881287755549e-01   +1.806618348808703e-01   +3.163273447256879e-01   +4.952539595882773e-01   +1.407445742322688e-01   +4.274328722971257e-01   +3.064188435040154e-01   -3.849055618552465e-01; -4.309544901884314e-01   -5.972987468331243e-03   -3.549510643509259e-01   -1.962544543127913e-01   -4.602756960110586e-02   -3.933420132676431e-01   +3.636445684868960e-01   +3.671735651585912e-01; +1.160865632056464e-01   +1.097527036342429e-01   -7.705237659200984e-02   +1.167679957738359e-01   -4.151185061129466e-01   -1.904955568273459e-02   +8.114748286777979e-02   -1.096971928364147e-01; +1.592130277603180e-02   +2.691705207823207e-01   -8.454523330787658e-02   -3.631680306056738e-01   -5.511870359556014e-01   -3.283373165026386e-01   +1.962802656485817e-01   +3.380372088043684e-01; -8.177096641697456e-01   +1.809775200303787e-01   -2.123408190032798e-01   -3.667795650004093e-01   +4.413904493114353e-02   -1.869573425154053e-02   +6.329540042354984e-01   -2.551842716603063e-01; +4.363275160457045e-01   -5.942461154788544e-01   +5.420939497840159e-02   +6.470883863965154e-01   -1.692287458986459e-01   +1.683856828492586e-01   -8.439701077777002e-01   +2.918192666214710e-01; +3.982836924835307e-02   -3.153601111999636e-01   +1.257611480722494e-01   -4.077723577513874e-01   -2.303810885214483e-01   +2.430962957239269e-01   -1.630146536665785e-01   -5.669218852939557e-01; +1.152863106680144e-01   -4.360157145501656e-01   +1.890290775335802e-01   +6.604563660397067e-01   -4.375349070366710e-01   +1.945907637747052e-01   +1.077183435296390e-01   +5.014995109801966e-01; -1.464565931590200e-01   -1.508700729086222e-01   -3.276431596232535e-01   -1.467660212718594e-01   +4.358479436320372e-01   -2.325662733757528e-01   -4.663155332136521e-01   -8.330525001679558e-02];
L3I_L3E_iAMPA_netcon = [-1.703897609854226e-01   +5.600368515059899e-01   +3.538596248906398e-02   +1.858263111353883e-01   -3.262915907565924e-01   +9.738926479017300e-02   +3.302642239885882e-01   +3.006372769191324e-01   +5.744598935419934e-01   +3.393935951295603e-01   +3.923675824762348e-01   +1.871639947256573e-01; -2.710794042203092e-01   -5.087467736067413e-01   +7.073485194320883e-02   -3.709727629541129e-02   +3.586143290773682e-01   -4.955002985806152e-02   -2.903270320413726e-01   +1.734320459843779e-01   +8.234762071318859e-02   -6.743451558653655e-01   -2.960735435668426e-01   -3.594682110335047e-01; +3.436279783732579e-01   -3.982248009922960e-01   +2.206969733090817e-01   -3.973581901902894e-01   -6.271875560667385e-01   +6.556401168501924e-02   -1.582868968879418e-01   +1.130076833404065e-01   +2.614501914143997e-01   +7.484879777684585e-01   -4.109054539469037e-02   +4.898394675124921e-01; +2.487412596776372e-01   -8.635924367466931e-01   +1.123501510445856e-01   -7.138057163375777e-01   +1.526800961985968e-01   -1.246588408562713e-01   +1.428178959853222e-01   +1.661888946409149e-01   -1.016117617647257e-01   -6.050142183281181e-01   -3.566342642911119e-01   -2.835367873612317e-01; +3.346960175664246e-01   +6.431291651021565e-01   +7.236395372698260e-01   +3.666259048686120e-01   -3.462478974965657e-01   +7.191039562965754e-01   +2.018569229771254e-01   +4.511468389252031e-01   +3.149392118204845e-01   -1.479471008935008e-01   +6.016892052114956e-01   +3.767949930012593e-02; +7.148973056942960e-01   -7.018301357179046e-01   +1.670908617308472e-01   -9.294406636296895e-01   +2.944395277980273e-01   -2.074314682723755e-01   -3.251460258427920e-01   -1.071022237170925e-01   +6.966315946490962e-01   -3.476248850517549e-02   -8.743931814229344e-02   -5.438309419068942e-03; -7.865351999079664e-02   -5.166438016586788e-01   -2.891693179681555e-01   +2.402648405925303e-01   -7.819552342338972e-02   -4.316187257814034e-02   +1.000000000000000e+00   +3.866007339221939e-01   +2.611693188814687e-01   +2.922109522651381e-01   +3.283859263694393e-01   -3.033756353764355e-02; +1.652637825616114e-01   +6.248151268743666e-01   +1.178698003711756e-01   +1.023940375664562e-01   +6.063835781726283e-01   +5.158338796564063e-01   -8.858140228365839e-01   -1.893188058157886e-01   -2.403601536717578e-01   +3.733940457857874e-01   -4.429831088068118e-01   -7.092174916732864e-01; +3.908181300202809e-01   -4.453172803481171e-02   +1.272024673989743e-01   -1.084062915530038e-01   +5.996404575629812e-01   +1.257409503049164e-01   +9.865909719216685e-02   +5.515889629882893e-01   +4.980689815412693e-01   +6.553843626132773e-01   +4.075106974918694e-01   +1.983413181437072e-01; -7.798592855263408e-01   +3.272856401385280e-01   +2.121813217936879e-01   -6.281395520972416e-01   +1.160959093131424e-01   +3.713375081036827e-01   +6.178815055597939e-02   +1.653537886593398e-01   +4.322902001829598e-02   +3.191123516300062e-02   +2.995044504950720e-01   +4.252790036572657e-01; +1.736857478105217e-01   -1.017998882483316e-01   -1.877647285608925e-01   -6.716438395877093e-01   +4.055644471588073e-02   -6.683862858968864e-01   +3.436577109598262e-01   +7.691639718676392e-02   -1.668026781896406e-01   +1.517502662618200e-02   -5.630091145837356e-01   +8.435524384045681e-02; -2.933527743646611e-01   -6.912595037451948e-01   -2.218938434649058e-01   +2.678351085910716e-01   -5.537402593735657e-01   +6.911158703969206e-02   -4.673302434745947e-01   +4.506544529250727e-02   +1.054288125740227e-01   +5.706821590494748e-01   -2.984176126789502e-01   -2.051302873553151e-01];
L3E_L3I_iGABA_netcon = [-9.094527523912292e-03   -1.366022077649003e-01   +8.824755736196157e-01   -6.210166912972369e-02   -5.021551382207954e-02   -3.746595703168207e-01   -1.000000000000000e+00   -6.482538204010369e-02   +1.629680960594988e-01   +1.443611201814825e-01   -4.946434686227503e-01   -2.595761216709757e-01; +1.146487849207421e-01   +2.805136446866543e-01   -3.639186464000826e-01   -1.187449196774457e-01   -2.797075211291730e-01   +2.661786460521535e-01   -4.275237729426574e-01   +1.339109743329542e-02   +5.955742777783057e-01   -1.163907331006716e-01   +4.715298015222386e-02   +7.889751452135105e-01; +8.775905642948613e-02   -2.238299131386806e-01   -4.505970788919125e-02   -3.064031198133197e-02   +4.336374801932431e-01   +1.058420972844060e-01   -4.045209667131986e-01   +7.282407469812819e-01   +1.016738975161959e-01   -3.524248723579568e-01   -6.155934981973655e-01   -1.403002176038904e-01; -3.246494315405670e-01   -3.178403992153537e-01   +3.186116253372711e-01   -2.596018448608644e-01   +2.267828162704691e-01   +5.755616012016814e-01   -6.551071954962955e-01   +6.014724772360630e-01   -5.867836601594156e-01   -3.706118820721013e-01   -4.658206925303517e-01   +1.065500707084253e-01; +6.696787976362428e-01   +1.485637557718347e-01   +6.296141435742602e-01   -4.661286057781268e-01   -6.092727039571370e-02   +2.455915851111553e-01   -1.777192415464926e-01   -2.573643082324438e-01   -3.451262762492132e-02   +6.773147468780167e-01   +2.699429297338405e-02   -8.250292302052347e-01; -7.675741127906305e-01   +3.439468842867078e-01   +2.371811993815119e-01   +6.695053088244820e-01   -2.318091307331592e-01   -2.681650270360033e-01   -4.239675109834014e-01   -3.649861587676196e-02   +7.668644749576936e-02   -5.837760551264236e-02   +9.986911001591610e-02   -7.764016264707886e-01; -4.357189710173430e-01   -2.413926124918231e-01   +7.848069708740613e-01   -7.445333832897003e-02   +3.474261601808526e-02   -3.132526346509586e-01   -4.466686187600517e-01   +1.942014279415444e-01   +8.500309646014317e-02   +4.891036383573820e-01   -1.093155018338277e-01   -6.749397174609957e-01; +1.993702146141541e-01   +1.246713798811711e-01   -1.535556579010108e-01   +3.473277884228196e-01   +5.557561702843739e-01   +3.123121359129684e-01   +9.893154772650702e-02   +8.053832458241575e-01   +2.811022411332083e-02   +8.799443557702631e-01   -6.292603219139689e-01   -7.566296015848069e-01; +4.013851850811623e-01   +6.463777537063160e-01   +3.391532027564713e-01   +6.100510033568954e-01   +1.673348782325929e-01   -7.025417792067364e-01   -1.250671540571225e-01   +3.401874666762617e-01   -1.441907223724865e-01   +2.320981674087234e-01   -2.668058077356172e-02   -4.982761930169499e-01; +5.047192596557992e-02   +2.833138998563523e-01   -1.549312524601100e-01   -4.493137814389465e-01   -1.403518116752544e-01   -3.056944893905303e-01   +4.490117087922572e-01   -4.526610712735587e-01   +8.066054983357317e-01   +4.455745852530602e-01   +5.317374705318939e-01   -3.562703814137454e-01; +2.324271144221951e-02   +5.379009380459370e-01   +2.155634701141287e-01   -4.854186785335902e-02   +2.584812019290215e-01   +5.480831150055571e-01   -3.832822653168904e-01   +4.117401854665660e-01   +1.234805979279928e-01   -5.678834692818171e-02   +5.443290320692010e-02   +6.377009217296284e-02; -9.819879142488343e-02   -2.586175116599958e-01   -1.961721796884368e-01   -3.313853076882832e-01   -9.885602903024668e-02   +7.321365872305151e-01   -2.038067221049334e-01   +1.182784599958137e-01   -8.411101678319996e-02   -4.634856763023558e-01   +4.052502117575303e-01   -1.788305810424246e-01];
L2E_Input1_iAMPA_netcon = [-4.713072821928511e-01   +5.224746797478567e-01   -6.746674676365688e-01   -2.728015943221016e-01   +5.555101102247155e-01   -1.351953336199936e-01   +6.597175799485930e-01   -4.131221535100157e-01];
L2I_Input2_iAMPA_netcon = [-5.939680664353816e-01   -2.346823010320665e-01   -1.202796686529813e-01   -1.512027496123115e-01   +1.817158666853185e-01   +4.694318446545181e-01   -1.984203642082266e-03   -1.161454656111879e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
