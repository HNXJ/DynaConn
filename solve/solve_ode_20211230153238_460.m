function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.929382556810748e-01   +5.003111017216245e-02   +8.591717637679860e-02   +4.078524709323124e-01   +5.157500316026738e-02   +1.005807199600370e-01   +2.937758875160226e-01   +3.722769537978735e-01   +1.834420712024556e-01   +1.663352391487433e-01   +1.264645086493550e-01   +4.812947770673395e-02   +3.557542528724771e-01   +2.088088869660484e-02   +1.790390600212875e-01   +1.708153480095252e-01; +1.002677525896551e-01   +1.856747551912176e-01   +3.613466779133575e-01   +4.584201892989428e-01   +1.655306900818314e-01   +4.736819325118773e-02   +2.745023006975186e-01   +2.375883296353251e-01   +1.237621791782393e-01   +1.604356575347138e-02   +3.995231865254259e-01   +3.642423436993322e-01   -4.666452252217156e-02   +1.149732052901925e-01   +2.215266544332626e-01   +1.121448662163739e-01; +2.782300228859831e-01   +1.901486907401215e-02   +4.282587508740634e-02   +1.721796355005086e-01   +2.483155783951105e-01   +1.470604133286235e-01   +2.234876582213130e-01   +4.505821088425305e-01   +7.190894059391201e-02   +3.417779839474562e-01   +1.069902818790636e-01   -9.598639439001250e-02   +1.478164020830648e-01   +4.241236560317876e-01   +1.257878943270394e-01   +1.177424972314911e-02; +1.629444071005224e-01   +3.476580934021729e-01   +1.530560037064106e-01   -9.154067616179148e-02   +9.435717771314010e-02   +3.245635922047909e-01   +2.489906194429406e-01   +2.915065035413244e-01   +2.577963875701843e-01   +3.083853445594395e-01   +6.042319263878837e-02   +1.196386666208047e-01   -2.252943802449515e-02   +3.916048731468489e-02   +3.140575448996049e-01   +5.390586118393157e-03; -5.033600863448695e-02   -7.254353143131703e-02   +2.280319771061219e-01   +3.274283814406727e-01   +2.446818179344439e-01   +1.540471400436574e-01   +1.642689965096198e-01   +6.264462234492735e-02   +1.564315263911031e-01   +2.773740646020347e-01   +1.772734744265757e-01   +1.400340219861154e-01   +1.890096564540901e-01   +2.621957110415322e-01   +2.203454447005808e-01   +6.341609823959027e-02; +6.852538122870665e-02   +3.996065602823597e-01   +2.734667895887973e-01   +1.037680679485754e-01   +4.048189939838324e-01   +1.361686361467256e-01   +1.010913778091412e-01   +2.975295426272819e-01   +3.385837829745392e-01   +3.055497896008157e-01   +2.879543548141876e-01   +2.833279509555749e-01   +3.190413757881972e-01   +1.133637746323215e-01   +3.876830794323497e-01   +4.179706765571685e-01; +3.860735552976884e-01   +1.775483000686219e-01   +7.409024015879956e-02   +7.720558413121054e-03   +4.498480349943269e-01   -2.419085525927463e-02   +1.269381404941212e-01   +1.643986069734699e-01   +7.430011902612621e-02   +2.067364448085695e-01   +1.602899818255017e-01   +1.872605621188901e-01   +6.473550917962902e-03   +3.972836705816884e-01   +1.690526740454373e-01   +4.322921722451572e-01; +2.779394547422156e-01   +1.887350587197481e-01   +3.361012681240995e-01   +2.567587831155220e-01   +3.116300252087288e-01   +2.197706167262748e-01   +4.202029599336764e-01   +1.238019877024162e-01   +1.337782617681590e-01   +2.198709400651289e-01   -5.040826121179420e-02   +1.058759156171433e-01   +2.487349731008415e-01   +1.380839514276048e-01   +1.118348029383880e-01   +1.479862920958080e-01; +3.118126528595941e-01   +3.035655396035439e-01   +1.030587216661347e-01   +3.719306002324261e-01   +1.155177014662386e-01   +1.748526919612255e-01   +4.715615303590856e-01   +2.610959622823169e-01   +4.218616801555455e-01   +3.530394341212584e-01   +3.240561133096984e-01   +2.859726177273554e-01   +3.756665770975074e-01   +2.230902146192794e-01   +3.712519918073434e-01   +4.267731421652666e-01; +3.075252399250541e-01   -5.310525204345200e-02   -2.975799703465773e-02   +1.746638269748444e-01   +1.729768573498161e-01   +2.264092859788952e-01   +5.215548407030086e-02   +1.802988414730446e-01   +2.884937009071297e-01   +3.509180478499961e-01   +4.283545842564298e-02   +2.546917491538634e-01   +2.477721520432480e-01   +3.083866261004907e-02   +3.424619114884304e-02   +2.072646732879141e-01; +1.441679267200868e-01   +1.686114327001189e-01   +1.043146317088478e-01   +1.314799534228967e-01   +3.257862688089743e-01   +2.862481813450613e-01   -5.525487945316187e-02   +1.548315230173739e-01   +9.963168866197422e-02   +3.721962345232429e-01   +2.723177344777800e-01   +6.617317737797797e-02   +2.292568545700804e-01   +3.306802039419507e-01   +3.205540752172582e-01   +1.702142649444346e-01; +2.672643732838557e-01   +1.804598611464400e-01   +9.537162439538405e-02   +4.700889347324329e-01   +9.008449019402816e-02   +2.754090842104092e-01   +2.940771032944886e-01   +3.321295014954590e-01   +2.972730409107856e-02   +1.299396648428755e-01   -7.241685382212815e-02   +1.718275888512477e-01   +3.524024052103501e-01   +3.680358972205653e-01   +8.125870662383521e-02   +1.315635860315132e-01; +5.787355615949934e-02   +2.685535505565176e-01   +1.562321412644378e-01   +1.055602970984443e-01   +2.437123321865141e-01   +2.064476017811289e-01   +3.589657452141350e-01   +2.137672243691328e-01   +1.851314798442082e-01   +2.551168834210463e-01   +3.487082103505944e-01   +1.958980061235466e-01   +2.057051797875404e-01   +3.014242928949644e-01   +2.639142807162997e-01   +9.566651686786753e-02; +1.604341086470575e-01   +8.465937838996115e-04   +6.386105595718834e-02   +1.055117401274526e-01   +3.042469131667095e-01   +4.210569998645237e-01   +4.301667811336848e-01   +2.300902710188849e-01   +7.905941859925905e-02   +3.067246253624271e-01   +1.193774944441785e-01   +3.345333218034096e-01   +2.074926438139120e-01   +1.663164120128010e-02   +1.504407666055793e-01   -1.011163106251815e-02; +3.692128016141680e-01   +1.701665623697022e-01   +3.579236165154246e-01   +1.728285263244748e-01   +3.685933042403519e-01   +2.431099875420240e-01   +5.914481850379615e-02   +2.318105348950772e-01   +4.858039011083966e-01   +2.989352562787412e-01   +2.981192139904838e-01   +2.991659471389212e-01   +6.606990899728821e-02   +3.039562535087020e-01   +3.869363031160297e-01   +1.704987470338651e-01; +2.345550500771370e-01   +9.492731359681883e-02   +3.939170999498786e-01   +1.624467764232261e-01   +2.060031977493321e-01   +9.864185558833938e-02   +3.020101301172857e-01   +9.397369028189519e-02   +6.253826712445351e-02   -4.387099776120108e-02   -9.888649493189064e-03   +1.584964771425176e-02   +4.615037298429904e-01   +1.301474445584277e-01   +2.616798338411856e-01   +3.220531630747278e-01];
L1E_L1I_iGABA_netcon = [+1.718701101145260e-01   +2.765272281504341e-01   +3.961603659862665e-01   +7.680467514732815e-02   +6.107671144191899e-02   +1.465402664364694e-01   +3.173655555827155e-01   +5.016176835894495e-01   +2.676114816642595e-01   +1.314717449636850e-01   +3.750286193174984e-01   +1.889628146850082e-01   +1.087522532171801e-01   +1.914830024296271e-01   +3.266629258204419e-03   +1.674241759566283e-01; +1.745745940508948e-01   +4.145513785749492e-01   +2.496849955765973e-01   +8.298258255012192e-02   +2.941681760325348e-01   +2.091877284149480e-01   +4.805859463525100e-01   +4.112137169988069e-01   +3.838507277793806e-01   +4.219621287389185e-02   +2.523048166607533e-03   +9.421922157534186e-02   +2.771262527201357e-01   +2.943191877150608e-01   +1.272513062719089e-01   +1.507469974222984e-01; +2.343258791207490e-01   -1.833703350227051e-02   +1.197165204890905e-01   +3.532043798374085e-01   +2.992589502543039e-03   +5.522425112706917e-02   +9.931103877231431e-02   +4.988809829474743e-02   +1.103920405340180e-01   +2.521116700290128e-01   +2.773564314324477e-01   +1.726785297553079e-01   +6.368493114236937e-02   +1.865231473237746e-01   +1.131727991756102e-01   +1.448793716644658e-01; +1.567030291626771e-01   +7.499922682186555e-02   +3.082534653308348e-01   +2.947877140806292e-01   +3.134571890198343e-02   +2.515216731896209e-01   +4.221530106846702e-01   +4.509565860527299e-01   +1.050610792994097e-01   +2.321566254163419e-01   +2.587353683595383e-01   +4.207681284911231e-01   +2.916369153213384e-02   +2.865094164218665e-01   +3.084102542948209e-01   +2.908370072608896e-01; +7.155123764383968e-02   +1.474179039025466e-02   +4.051558980794319e-01   +3.039223313980117e-01   +1.820270097747347e-02   +2.055730697562110e-01   +4.923028303545667e-01   -2.785277839852712e-02   +1.548950816592062e-01   +2.146152298687294e-01   +9.151876310528843e-02   +1.960068876327511e-01   +2.761326363325980e-01   +1.657015552568183e-01   +1.838818375156072e-01   +4.536471588822161e-01; +2.573993875440783e-01   +3.243385170947062e-01   +3.338591245538989e-01   +2.973814334453024e-01   +1.578040584806830e-01   +4.034246447692105e-01   +3.174151411911562e-01   -5.158772354987234e-02   +2.364618428276135e-01   +2.906772189232285e-01   +1.219666160268890e-02   +5.623734791935017e-02   +2.954656408029767e-01   +2.991070630946974e-01   +1.972757548802009e-01   -2.920403410810093e-02; +1.824704129480084e-02   +1.722807571796352e-01   -2.728962605567270e-02   +2.297437466406698e-01   +2.313468428860727e-01   +2.219008607343943e-01   +2.247470427847824e-01   +3.011706375124327e-01   +1.040953418684557e-01   +3.179563117315438e-01   +1.800748746468500e-01   +3.653432865545698e-01   +2.489622399452215e-01   +2.851308352675109e-01   +1.955151441955938e-01   +2.161544972298090e-01; +3.174556712984552e-01   +2.419209153074754e-02   +5.930106950644012e-02   +2.160045059759839e-01   +2.380747310763444e-02   +2.878985368453310e-02   +2.100338053272874e-01   +1.221906065101516e-01   +3.501902448783493e-01   +4.183036481154129e-01   +2.127789071910927e-01   +1.222284131642261e-01   +9.392354707763689e-02   +2.669567583641335e-01   +2.331108648772795e-01   +8.633001825139293e-02; +6.159038403596716e-02   +5.503799950511444e-02   +2.639812186202661e-01   +1.772327361571504e-01   +2.120858327230657e-01   +1.202434010099182e-01   +2.154521976481974e-01   +2.926451884398424e-01   +2.950651495818704e-01   +9.989846783229896e-02   +2.684795959515239e-01   +1.862237807507118e-01   +1.038395400436040e-01   +4.181703597106370e-02   +2.590398902338895e-01   +1.184393124337538e-01; +3.242881484253423e-01   +3.944333827493040e-01   +3.237903284989327e-01   +3.693134519580765e-01   +1.246495804372254e-01   +3.159658673423177e-01   +1.175834270462810e-01   +3.212494857749888e-01   +3.924243634735448e-01   +1.485379031181633e-01   +2.496135295637378e-01   +4.458440444348589e-02   +1.096015919644034e-01   +3.927295095183088e-01   +3.206113975350140e-01   +1.321372708211404e-01; +3.966207316551930e-01   +3.658162167521074e-01   +3.627742908411938e-01   +1.073074276621715e-01   +4.057112059446600e-01   +6.219036398431076e-02   +6.406861582216943e-02   +3.693158501401368e-01   -2.357505363293392e-02   +1.612966072856752e-01   +1.365247750268313e-01   +2.497244989599195e-02   +1.811495556320701e-01   +2.906160153976150e-01   +2.631049675062771e-01   +1.028356359307183e-01; +3.335482507708423e-01   +6.529845346345724e-02   +3.399820572979895e-01   +3.615728603211188e-01   +1.443691136792318e-01   +1.086290371960907e-02   -2.539856178698989e-02   +3.393443876248510e-01   +2.942933075447480e-01   +2.998987617430608e-01   +3.293748924199352e-01   +3.419123911339818e-01   +3.231673912504553e-02   +4.084581507448323e-01   +4.153433427414805e-01   +9.588499738078911e-02; +2.259153070397480e-01   +1.823566102582289e-01   +2.217444238454147e-01   +4.046584620485555e-01   +3.555753290606782e-01   +2.075210043828619e-01   +3.531539690738345e-01   +6.548778775926048e-02   +4.477760066718912e-01   +1.545031250592856e-01   +3.522039232511295e-01   +3.860238482435119e-01   -3.949509618804856e-02   -7.836797533192358e-03   +3.257238969683121e-02   +3.736340663914981e-01; +2.243898290562614e-01   -2.050748599044748e-02   +9.836992245210528e-02   +5.460566093405333e-02   +1.492085074172255e-01   -1.143727690617332e-02   +2.255806424737686e-01   +3.384679342126915e-01   +3.166335814997431e-01   +7.164967516947084e-02   +2.431167614537342e-01   +1.597465404285988e-01   +3.867305778778138e-01   +2.808107988841777e-01   +2.879747301260070e-01   -3.720150760268713e-02; +4.109466196675065e-01   +3.248529094521660e-01   +4.574547533844547e-01   +1.864562639258149e-01   +2.512200852461444e-01   +1.910022972819593e-01   +3.997731341433285e-01   +2.307017257670676e-01   +1.830750571806433e-01   +2.910036008042046e-01   +4.625905146246014e-02   +3.958879720231648e-02   +1.550046953553516e-02   +1.037306852463868e-01   +2.644929205982477e-01   +2.390707692499127e-01; -4.530485742079842e-03   +1.002641913712415e-01   +2.453162974660774e-01   +1.715366473318778e-01   +2.445654821316688e-01   +3.784247586993603e-01   +4.197499752707708e-01   +1.016130960649078e-01   +4.188010254667431e-01   +3.392783180108740e-02   +3.401496348660782e-01   +4.134346317001141e-01   +1.474855739731636e-01   +4.021258435726058e-01   +5.800836753799192e-02   +1.746443533725554e-01];
L2I_L1I_iGABA_netcon = [+2.857027497284721e-02   +2.670028058946837e-01   +1.085898858542559e-01   +2.845542995815343e-03   +1.422106938465790e-01   +2.322760923308864e-01   +2.949994939969149e-02   +3.175394911037124e-01; +2.148056335607409e-01   +1.587594515352170e-01   +4.186186089926092e-01   +1.696305315471794e-01   +1.442278599667071e-01   +2.592340298892040e-01   +3.165578173856556e-01   +8.376303379466994e-02; +4.352224942141358e-02   +7.453921949320337e-02   +2.554896568622742e-01   +3.683046990148551e-01   +1.956117523701066e-02   -2.376523448716924e-02   +1.778893848664029e-01   -3.036571566850962e-02; +2.236879340735267e-01   +5.338302640815686e-02   +9.557869680514024e-02   +4.448331055303575e-01   +1.281429074676134e-01   +8.450536558293337e-02   +1.252559013257856e-01   +2.588033564341757e-01; +3.940397168825731e-01   +1.953137246222980e-01   +6.738367332121123e-02   +2.387322410118014e-01   +4.411775675808369e-01   +3.415055714480161e-01   +3.112695595719731e-01   +3.327856461015937e-01; +4.382468728280537e-01   -9.478033673319980e-03   +7.933583769179868e-02   -2.869891361044005e-02   +4.329377931714056e-01   +8.304033146048782e-02   +1.314967675181078e-01   +2.487412252131487e-01; +2.454315643003283e-01   -2.352157942856528e-02   +3.606202308570745e-01   +1.981070075773865e-01   +1.805096112115842e-01   +1.384770595751341e-01   +2.822727118751166e-01   +1.915141873362869e-01; +1.657023979335533e-01   +1.036079017608581e-01   +4.346254000024562e-01   +3.288667787867947e-02   +6.229506086484511e-02   +1.387142473582741e-02   +1.618576183887458e-01   +1.960260048270454e-01; +3.498412697168586e-01   +2.094133330676111e-01   +2.054055181534409e-01   +2.453799291563158e-02   +2.745166127270487e-01   +4.060355527146070e-01   +2.640815400215348e-01   +7.099605726998846e-02; +5.764720116115182e-02   +1.332719126735855e-01   +3.192392205736699e-01   +1.740605771574888e-01   +2.221731743025815e-01   +1.932983965773568e-01   +1.597522249395876e-01   -9.455346624029151e-02; +3.190469320707403e-01   +3.870878379240892e-01   +2.734807296797354e-02   +3.091644648782947e-01   +3.851082698452455e-02   +2.351093643449395e-01   +3.718460667800880e-01   +4.294750637433362e-01; +3.943428513031341e-01   +3.967253144203305e-01   +6.748115970687035e-02   +3.663822616477047e-01   +3.690536599768091e-01   +1.785596737296276e-01   +9.434049454471491e-02   +3.734339665769654e-01; +2.468288399260741e-01   +3.818319709713175e-01   +3.366159231197398e-01   +4.165358271610930e-01   +2.359660538111631e-01   +1.502784525600487e-01   +3.127467259640955e-02   +1.991886780684097e-01; +2.983408820156476e-01   +3.726699931638733e-01   +4.409270518913163e-01   +2.569980005768664e-01   +3.226230452499878e-01   +3.748290350279463e-01   +1.985480718807642e-02   +1.248430309372095e-01; +1.849457973529524e-01   +2.275052787794468e-01   +2.178153014674237e-01   +2.113022860036372e-01   -7.089937798311630e-04   +4.649954853896500e-02   +1.398767574181732e-01   +2.064099506731700e-01; +2.495827440076974e-02   +3.976128901027345e-01   +1.318736580205153e-01   +3.735319947797489e-01   +3.940212520305054e-01   +4.621493122061787e-02   +3.890781693186280e-01   +3.350308233587621e-02];
L1I_L2I_iGABA_netcon = [+5.728970488563136e-02   +4.059780694171797e-01   +3.572965605362878e-02   +2.761941091500383e-01   +4.142580567839873e-01   +3.902370889517857e-02   +2.467653152375006e-01   +2.013472758942647e-01   +9.642608786893683e-02   -1.386898431185005e-02   +1.900393795426023e-01   +1.995248725034892e-01   +2.526395690651217e-01   +2.337238412045047e-01   +2.916667585483509e-01   +1.532693007368610e-01; +2.019252107811464e-01   +4.288855481234137e-01   +1.759816167903679e-01   +1.956073361948295e-02   +4.178606522720432e-01   +2.691675909012397e-01   +2.655198616151191e-01   +3.897514353647807e-01   +1.768050538630341e-01   +2.456253751719316e-02   +3.615375864859713e-01   +2.590930152613073e-01   +1.622662012410403e-01   +1.049480744286775e-01   +2.581558913491934e-01   +3.424468334494449e-01; +1.842309136684714e-01   +1.014830060923059e-01   +3.325303998695319e-01   +3.370005616911235e-01   +1.530603389035252e-01   +6.929824586148681e-02   -3.729759074367656e-02   +9.828317047195465e-02   +2.148041722367888e-01   +1.484869937182998e-01   +3.091441329009469e-01   +2.001441238636626e-01   +1.651933333053090e-01   +5.737187017058948e-02   +1.519278060463788e-01   +3.448796424818281e-01; +2.447971742924350e-01   +3.618194679174620e-01   +2.100026613049565e-01   +2.187661002596975e-01   +4.707005425850402e-02   +2.741283792532651e-01   +9.938620750697279e-02   +3.806411234674433e-01   +8.840881771489773e-02   +2.671441022017905e-01   +8.533430126008618e-02   +1.989514404339443e-01   +1.184717983117487e-01   +3.510392988855187e-01   +2.412954847999388e-01   +2.266931851507567e-01; +1.330533004489244e-01   -1.048248876733148e-02   +4.648420792424078e-01   +2.043534894892847e-02   +3.131567642107922e-01   +3.571536334404864e-01   +6.095157552206420e-02   +1.994001953270772e-01   +2.394087384247195e-01   +6.608734859205923e-02   +2.475302682249798e-01   +8.576882915016307e-03   +3.102972730382378e-01   +1.569287614471870e-01   +1.875633058838484e-01   +1.448009153259987e-01; +5.140892468859947e-02   +2.001783002640953e-01   +7.014973813050970e-02   +3.342237353235482e-01   -6.477315639006689e-02   +4.233929417206362e-01   +3.819597016794071e-01   +1.173775912704939e-01   +1.551817570658243e-01   -1.941517383358397e-02   +4.379639722400154e-01   +1.614063902315318e-01   +2.469803007768904e-01   +2.525893014369671e-01   +1.478284390167108e-01   +2.988743308383328e-01; +9.952729978925180e-02   -1.136833185011735e-03   +2.934676114467554e-01   -3.276852366594397e-02   +2.299293128488132e-01   +5.028726631276750e-02   +4.152597684576894e-01   +2.610758298760312e-01   +2.944603992825256e-01   +2.518355423421405e-01   +1.196148206975859e-01   +2.212571679579470e-01   +2.319545808216171e-01   +8.140095512336216e-02   +4.603658090614603e-01   +3.872005683496956e-01; +2.389395826317046e-01   +1.708554605524742e-01   +4.060699263983731e-01   +8.744691883185071e-02   +1.715947537446116e-01   +2.586341930345933e-01   +1.107223370244116e-01   +3.661044893496644e-01   +4.607218912815332e-01   +1.900652433645896e-01   +2.488934760019454e-01   +4.353856747267923e-02   +1.971734202643729e-01   +2.298604199383421e-01   +3.114712223308876e-01   +2.835482292993072e-01];
L2E_L1E_iAMPA_netcon = [+3.159635371082702e-01   +2.115446142742473e-01   +1.130900619868562e-01   +2.485693281097330e-01   +8.438209468750676e-03   +5.916260083819400e-02   +2.082689692306301e-01   +1.608925427723807e-01; +3.450885497928127e-01   +8.185844054726416e-02   +3.678038776853884e-01   +1.809004376253701e-01   +5.558027173015170e-02   +2.034490966011482e-01   +3.744763965034313e-02   +4.640827442021296e-02; +1.680393115619823e-01   +3.234595567393176e-01   +2.850367328342195e-01   +2.163280496943260e-01   +4.661327900705036e-01   +1.309136310878391e-01   +1.889463982030986e-01   +1.111982360710704e-01; +2.099889633099037e-01   +3.553502092052425e-01   +3.248666089751727e-01   +3.853924866864411e-02   +1.046653781986858e-01   +4.609669268516906e-01   -5.531950245359053e-03   +7.602888160274601e-02; +1.112886370888861e-01   +1.527665939694955e-01   +1.528992084612794e-01   +3.904847041078645e-01   +3.723444524059523e-01   +3.807455647690198e-01   +1.075129020488987e-01   +1.023881390057610e-02; +1.890059178262272e-01   +1.701999229228235e-01   +4.243585026111300e-01   +1.883915764725030e-01   +2.080702839828581e-01   +2.549454042495839e-01   +4.102378991661437e-03   +1.026795568951848e-01; -1.569612688553315e-02   +3.422711128876280e-01   +2.906551888789183e-01   +4.230181433722112e-01   +9.908067740860420e-02   +1.397964966834301e-01   -1.875768207679086e-02   +1.561358808455507e-01; +4.924409782370714e-04   +2.036600995406670e-01   +3.090501979824103e-01   -6.269576744704819e-02   +1.174875848672051e-01   +2.705519588770012e-01   -1.573556828945762e-02   +8.979880534048125e-02; +3.964909965846422e-01   +2.625644838993932e-01   +2.565144786065585e-01   +3.495635696340499e-01   +3.929381567071765e-01   +8.772460076538730e-02   +7.243663861680044e-03   +4.168553349116236e-01; +1.803967301778788e-01   +9.832776686488587e-02   +1.012893032514127e-01   +1.925080658173212e-01   +4.389349866554513e-02   +3.609961179919998e-01   +2.817855221714081e-01   +2.269799970023783e-01; +1.659888295226448e-01   +3.835892233930467e-02   +5.414398074250030e-02   +4.130352320557255e-02   +3.085688133046929e-01   +1.293709560886774e-01   +1.383642919496967e-01   +1.000226512236615e-01; +1.695071963794702e-01   +1.188022429892235e-01   +1.081092810695372e-01   +7.719905046868408e-02   +9.919989180575935e-02   +4.787140026300254e-01   +2.610228128581409e-01   +8.674432345357931e-02; +3.580844088673052e-01   +3.633648261544610e-01   +3.878489678978760e-02   +6.896924688531245e-02   +1.747819514787255e-01   +3.203891164476668e-01   +1.278125103671216e-01   +5.112375556123375e-01; +1.897203832988482e-01   +2.213065999250327e-01   +3.155950000862076e-01   +3.104551647811885e-04   +6.677853367452846e-02   +8.651116354966942e-02   +2.364020402134740e-01   -5.936208191703490e-02; +3.334185789317979e-01   +3.729028313483834e-01   +1.774167578894111e-01   +6.055827293038746e-02   +8.031688526369499e-02   +1.000486783086712e-01   -9.877038334200242e-03   +3.954988238628232e-01; +3.434546923517113e-01   -8.874389582344766e-02   +1.410879242087486e-01   +2.601145383997918e-01   +3.202867899646907e-01   +2.657598477274636e-01   +1.883048827750634e-01   +4.914255968679253e-01];
L1E_L2E_iAMPA_netcon = [+1.752770763005309e-01   +1.750488098803517e-01   +2.064161705209731e-01   +1.334929359147686e-01   +3.040860839046916e-02   +1.943303543544679e-01   +2.085481592424155e-01   +1.086138504291905e-02   +1.105323650263655e-01   +3.550255617908532e-01   +3.925200796850041e-01   +3.477299997560601e-01   +2.658467941020473e-01   +3.515554504862798e-01   +3.651821698696689e-02   +7.402579073360287e-02; +3.346644940102581e-01   +9.410002570349058e-02   +1.268897854151851e-02   +2.723890022869555e-01   +2.116303404438913e-01   +3.127598994557636e-02   +2.175974808447239e-01   +1.230218763092067e-01   +4.080507552000318e-01   +3.217483695731902e-01   +1.944132291235509e-01   +3.465046779763941e-01   +1.046962699554051e-01   +3.241951230580186e-01   +1.795761260455290e-01   +2.203654028798896e-01; +1.675141030114736e-01   +1.921663427746125e-01   +1.252091467304891e-01   +1.088589296652589e-01   +2.565991573319425e-01   +1.293724546445099e-01   +2.779901749145110e-01   +1.447059632345621e-01   +1.066951630685995e-01   +3.342575020914326e-01   +3.312388416752907e-01   +1.554774503099299e-01   +1.105306754096839e-01   +1.965795028447009e-01   +2.024675172869173e-01   +2.146665006060983e-01; +3.697057799084700e-01   +3.884876671865815e-01   +1.719668064325492e-02   +1.783132651842714e-01   +1.004818548088308e-01   +2.470026624959792e-01   +2.245115009139199e-01   +1.246115292537969e-01   +1.873979216528660e-01   +3.078155975246600e-01   +2.640210182583488e-01   +3.917416072714297e-01   +3.242868353444143e-01   +2.911861302958401e-01   -7.711004639642412e-02   +1.529963242396699e-01; +2.118429868410420e-02   +1.470499022266746e-01   +2.035629348982549e-02   +2.773094169164743e-01   +3.012039699846185e-01   +4.682520085602744e-01   +3.429810186066745e-01   +1.313013492187711e-01   +1.169765379435677e-01   +4.127582841129081e-01   +3.529452396694903e-01   +2.044118578479620e-01   +2.380996113907356e-01   +1.718927370082522e-01   -6.125198573313353e-02   +2.719002941226149e-01; +1.929834153639727e-01   +2.733130215214077e-01   +3.569249317199213e-01   +2.577473196633168e-01   +3.113610185230656e-01   +1.008253155036546e-01   +2.685304571243817e-01   +7.461783806906098e-02   +2.840739264581814e-01   +3.166956715243812e-01   +2.546327366955967e-01   +2.237203899596218e-01   +3.406266479209807e-01   +1.482623897814986e-01   +1.415785393046592e-01   +3.529013338418749e-01; +2.949140909979817e-01   +3.391675424277061e-01   +3.119792242603650e-01   +3.056536124252160e-01   +1.626139152235072e-01   +2.043224968917550e-01   +1.903136791030747e-01   +1.432056847481523e-01   +3.492604209379653e-02   +1.706708268256605e-01   -4.187104186972775e-03   +3.091331211016384e-01   +2.217743581288078e-01   +5.188708662504594e-01   +8.789417557359261e-02   +8.437123302926366e-02; +2.229802284067313e-01   +4.088287776729786e-01   +3.259690219983831e-01   +1.794332427700154e-01   +7.917516622829347e-02   -1.365860375253841e-02   +2.503783009970402e-01   +6.236948858511275e-02   +2.933202686278677e-01   +3.769106962834310e-01   +2.440162946321724e-01   +1.839437648859990e-01   +4.420059837964760e-01   +1.417430205387041e-02   +2.218455705639743e-01   +3.008622737158267e-01];
L2I_L2E_iAMPA_netcon = [+1.867306163841266e-01   +3.606737056584318e-01   +4.137221917158566e-02   +2.212110362126910e-01   +1.323870775318273e-01   +1.445113266624850e-01   -1.376990182248887e-02   +2.560531602898530e-01; +3.462500640730228e-01   +4.878789885197617e-01   +6.011945848361486e-03   +3.831614411050156e-01   +2.408925056845216e-01   +2.482196168534061e-01   +4.355745919025437e-01   +1.975517498048883e-01; +1.013906819969048e-01   +2.999087525555980e-01   +7.885664443135980e-02   +2.850204171847608e-01   +1.510587299203069e-01   -2.297532695697568e-02   +5.072497204207155e-02   +2.933443074873393e-01; +3.828750367319269e-01   -5.166380218059261e-02   +2.594979505091158e-01   +2.604764831207995e-01   +3.314280545705922e-01   +6.617948743000396e-02   +1.149225745275260e-02   +4.031020821920900e-01; +4.891772960527868e-04   +4.642460258042770e-01   +7.852459925111098e-03   +3.833751000648017e-01   +3.274272043879899e-02   +2.513070086633536e-01   +2.574788859585255e-01   +3.665447795050744e-01; +2.122460566400042e-01   +1.432613416907756e-01   +2.779215753552126e-01   +2.566494462118935e-01   +3.573327695504441e-01   +4.482300334922793e-01   +2.954569543810727e-01   +1.088838210004744e-01; +2.753113859206642e-01   +2.959571902213839e-01   +2.969171077343871e-01   -2.582030377260302e-02   +2.211070696692899e-01   +2.154994868435327e-01   +1.690170971932453e-01   +4.024301261837946e-01; +1.326812503870863e-01   +1.783876580240108e-02   +3.443465024135728e-01   +3.445762265927275e-01   +1.048108511211295e-01   +3.229084124126996e-01   +9.209946909050952e-02   +3.280697173813838e-02];
L2E_L2I_iGABA_netcon = [+4.670706747693145e-02   +4.255126267947483e-01   +3.570229944612555e-01   +2.294904832581660e-01   +1.059570009004031e-01   +2.876597514198680e-01   +1.606829510465696e-01   +1.964965685864467e-01; +3.473979702589296e-02   +7.492818959040065e-02   +3.201485947582130e-01   -7.999364340154359e-02   +1.882680806269101e-02   +2.954018680982075e-01   +3.027983373979433e-01   +2.240927275953652e-01; +2.988520807603106e-01   +2.480852618407319e-01   +3.526341733131214e-01   +2.240671982678685e-01   +2.151222391903993e-02   +1.391152096450655e-02   +3.028596148351380e-01   +1.881118236550712e-01; +3.596097128645463e-01   +2.819741682192914e-01   +1.257218205177258e-01   +4.492758347344794e-01   +9.705651269121952e-02   +1.594899478455664e-01   +5.421131069444038e-02   +1.473486417568002e-01; +1.900137969182603e-01   +3.070837595726421e-01   +2.934617269673435e-01   +5.274548513927785e-02   +4.613887437714381e-02   +1.647258615737917e-01   +3.741087786840344e-01   +3.310785513414001e-01; +1.032347905518782e-01   +2.078445468385340e-01   +4.300158956486486e-01   +2.437090569193336e-02   +5.030505658077571e-02   +1.897127008483462e-01   +2.144780591894633e-01   +1.013166237142839e-01; +3.965745292129395e-02   +5.204095501708021e-02   +3.768124175559974e-01   +3.569242288188109e-01   +7.808467706303365e-02   +4.093328573150182e-01   +2.650934830926776e-01   +3.757690583921881e-01; +2.847983982544003e-01   +3.551483011955285e-01   +1.263514387289364e-01   +3.657684371791350e-01   +1.740664582294463e-01   +3.054604513702289e-02   +1.908029307107186e-02   -5.547317721874836e-02];
L3E_L2E_iAMPA_netcon = [+1.746666746376045e-01   +1.385504012777496e-01   +1.163858460273428e-01   +1.753278003839144e-01   +5.529925522629675e-02   -4.255262684147005e-02   +4.636134063938059e-02   +1.474794704635727e-01   +7.511577481750090e-02   +1.211137165810885e-01   +3.378940471709868e-01   +2.194524201796893e-01; +1.385400679326773e-01   +6.789184561794714e-02   +2.928486243710114e-01   +2.138569434490087e-01   +6.874910040417739e-02   +3.530546922981878e-01   +1.964620490594952e-01   +1.444237583523555e-01   +2.736739477371716e-01   +2.663071620267647e-01   +1.581697627155117e-01   -1.131791406379646e-02; +3.470944668093913e-01   +1.089111735115967e-01   +1.452441296712756e-01   +3.763172969014638e-01   +3.640223422558495e-01   +3.335200446410947e-02   +2.995856939267319e-01   +2.374782287275918e-01   +2.451242496131417e-01   +1.278647757863957e-01   +2.488474759426692e-01   +9.841589939515485e-02; +3.304922625387854e-01   +7.009655400160154e-02   +1.609095925110391e-01   +3.489082622489943e-01   +1.657635059342564e-01   -2.056979253752646e-02   +3.657451509869094e-01   +1.407284172314739e-01   +1.487965385971982e-01   +9.756345267271151e-02   +1.638232945192379e-01   +2.865179072290173e-01; +2.610287293697808e-01   +4.394737210443893e-02   +3.392443028811801e-01   +2.656490997568636e-02   +9.926402356432072e-02   +1.766279308308761e-01   +2.941108137886301e-01   +3.016348113698153e-01   +3.720302955898030e-01   +1.174284667337674e-01   +2.771372546372387e-01   +4.507024461953747e-01; +2.372073965454481e-01   +7.694380817279214e-02   +7.859379824179061e-02   -3.357179387679805e-02   +5.769159607140825e-02   +2.348254400047632e-01   +3.192154732718385e-01   +1.034574161284519e-01   +2.550022743478213e-01   +3.307921553224338e-01   +3.739472763906816e-01   -1.540508229719335e-02; +4.861748104944214e-01   +2.708647670273434e-01   +1.479643112576993e-01   +5.245569877496251e-02   +4.527182818120987e-01   +7.761588565171706e-02   +1.897998018736051e-01   +1.512955069812038e-01   +4.472790236101931e-02   +9.585592160237212e-02   +1.454142097329821e-01   +3.296625185882668e-01; +6.010191863554121e-02   +3.182103427576725e-01   +2.604845466978814e-01   +1.237773412958087e-01   +3.107000083739921e-01   +8.424342074356805e-02   +2.960774579460203e-01   +2.443343216645328e-01   +7.646547202162600e-02   +1.284628398334101e-01   +5.877149530443757e-02   +3.556360200027210e-01];
L3I_L2I_iGABA_netcon = [+1.717101830451198e-01   +1.317916872980808e-01   +3.578106351418917e-01   +1.636305453181674e-01   +3.150698381820461e-01   +3.597047580718252e-01   +1.821250768425330e-01   +3.458007879144688e-01   +1.506349338475611e-01   +5.851515020024875e-02   +1.266518648620497e-01   +2.748091405834706e-01; +3.593237876878723e-01   +2.899509001201168e-02   +1.973044866264391e-01   +2.263161839898618e-01   +3.252376628186673e-01   +2.761152815080800e-01   +1.128382460868632e-01   +3.094843706296885e-01   +4.661609739298943e-01   +2.036528063915932e-01   +3.622692851684956e-01   +3.632577810448842e-01; +1.451505505564194e-01   +1.672198988123131e-01   +2.465830280484052e-01   +3.557252153477191e-01   +3.293975068811766e-01   +2.348303444561715e-01   +3.292619758208865e-01   +2.084267893829025e-01   +3.652383582313868e-01   +3.613427559513137e-01   +1.252195829156701e-01   +4.825577344262814e-01; +3.612749271805831e-01   +1.144194420471868e-01   +2.501306046270781e-01   +2.493769894042075e-01   +3.326595689438075e-01   +1.675619330694682e-02   +1.138208742838376e-03   +8.796123038473661e-02   +1.358012369473879e-01   +9.100500713673640e-02   +8.680815415970296e-02   +2.024753264817712e-01; +2.910798941172645e-01   +4.729032077247634e-01   +1.164203495855063e-01   +3.602354009205860e-01   +3.176786096018580e-01   +2.149969393448684e-01   +7.892961849518897e-02   +1.487630459534037e-01   +2.106379569669279e-01   +3.078470308907503e-01   +1.371600197217370e-01   +2.772975654605854e-01; +2.581412125832576e-01   +3.994774507403737e-01   +1.439060402798307e-01   +2.860744062955394e-01   -4.776158353062667e-02   +1.668987616208541e-01   +1.848341670936058e-01   +2.288679855018718e-01   +2.553953228898542e-01   +1.007307299535910e-01   -4.023012874651649e-02   +4.447413438219378e-01; +7.854344047320710e-02   +1.519862723911483e-01   +1.895624588087353e-01   +3.476715088654352e-01   +3.829351913023706e-01   +7.736475764419384e-02   +3.640103706272617e-01   +2.302720010593123e-01   +3.432859785413411e-01   +1.958453278768533e-01   +1.030009781958775e-01   +9.432237679747252e-02; +1.396146054617559e-01   +1.840565385515040e-01   +7.882545324772211e-02   +1.621126780826762e-01   +3.308630041292064e-01   +4.147811972522578e-01   +2.295302759564481e-01   +4.496178591069636e-02   +1.252231332831503e-01   +1.761182138366718e-01   +1.419597680441523e-01   +3.450772979274581e-01];
L2E_L3E_iAMPA_netcon = [+2.776877885895155e-01   +2.175798768303648e-01   +4.117256414365530e-02   +3.760090050345830e-01   +1.516237886654093e-01   -2.729682593741073e-02   +2.170215494575195e-01   +1.337118590540730e-01; +4.028510089159670e-01   +3.029160230731405e-01   +2.138005165855938e-01   +5.088139307293581e-02   +3.643144206089189e-01   +2.281008658459059e-01   +1.030013656718687e-01   +9.014005796359655e-02; +1.913065705942507e-01   +3.414852773620620e-02   +8.238338822557811e-02   +2.932929123573175e-01   +3.503138551245006e-01   +3.082137826206287e-01   +2.139436097092761e-02   +2.629077260543672e-01; +2.307912466826549e-01   +3.020250058692062e-01   +1.358990045659075e-01   +6.290346309271551e-02   +1.093575195520172e-01   +1.547248605162229e-01   +1.007442926971660e-01   +2.955577293230653e-01; +2.663910862602411e-01   +3.366011139302164e-01   +8.089582914276916e-02   +3.500405153956149e-01   +1.511796874275462e-01   -3.315893379934647e-03   +4.350950424866640e-01   +4.083158393751261e-01; +3.272305893517125e-01   +2.755205531916302e-01   +2.378374650887858e-01   +1.347319781549556e-01   +4.063284325079334e-01   +1.586660202312446e-01   +2.678941740695912e-01   +3.151408706202993e-01; +2.465070971634836e-01   +4.161418912195538e-01   +2.802743065388542e-01   +1.302129968124895e-01   +8.940406753994989e-02   +2.338625589314975e-01   +5.639057602261600e-02   +3.373997876646977e-01; +2.221626661813335e-01   +1.587631006243215e-01   +3.823606413660428e-01   +1.893074477647676e-01   +1.188034448950810e-01   +1.160655930117691e-01   +1.574037663101760e-01   +3.655431433258128e-01; +2.991425889490776e-01   +7.604881941702281e-02   +2.203501094490692e-01   +9.868060411229751e-02   +3.065340642683341e-02   +2.084252230423229e-01   -6.906107195276441e-02   +1.543162865564305e-01; +2.241918516884544e-01   +2.933321395480467e-01   +3.988431622210774e-01   +4.965572231172575e-02   -4.323353363334230e-03   +1.079214730018771e-01   +3.221507569497804e-01   +6.063405694933048e-02; +1.667297804202688e-01   +3.096813256523748e-01   +5.913565291983669e-02   +1.718390809985299e-01   -2.633552523352368e-02   +2.831548508577236e-01   +4.409858003194342e-01   +3.361115498496826e-01; +1.201685758538925e-01   +6.940649406427606e-02   +3.676008650353893e-01   +2.331373745836761e-01   +4.324548450803960e-01   +3.694069707798730e-01   -1.340864620977650e-02   +2.084746044782574e-01];
L2I_L3I_iGABA_netcon = [+2.015242077103986e-01   +3.258800746859141e-01   +2.153075200283160e-01   +3.354311506505563e-01   +2.584479764454201e-01   +2.306884167632341e-01   +3.116728515444764e-01   +1.802204938491495e-01; +1.973231848764440e-01   +8.405001559523696e-02   +1.106639263814434e-01   +1.451152527939701e-01   +6.421279959649458e-02   +2.104215043416746e-01   +3.447869048127236e-01   +4.192059782184022e-01; +8.077059082990471e-03   +4.695325418368955e-01   +3.573999304163465e-01   +1.191761971614628e-01   +2.280311601146979e-01   +1.284541359501458e-01   +3.852452613952224e-01   +4.264111055432753e-01; +3.015158515745752e-01   +3.017077203238863e-02   +1.976694915767234e-01   +9.482507781664985e-02   +1.420216987505130e-01   +2.470857283479589e-01   -5.167644873442984e-03   +1.033345313659225e-01; +3.749048244164785e-01   +1.559247278681559e-01   +1.321217446075449e-01   +1.424503405310250e-01   +1.553199220108603e-01   +3.864989899384585e-01   +2.354033735754333e-01   +4.516807124364315e-01; +1.922144556695078e-01   +3.773306282028562e-01   -5.957920164078028e-02   +3.036828294714406e-01   +3.793274775232181e-01   +1.877239507191391e-01   +1.769967615036391e-01   -8.223074696204313e-02; +2.471873969860580e-01   +4.688015437711278e-02   +3.440697792167317e-01   +3.728722422746369e-01   +8.449949654338433e-02   -6.820902164920170e-02   +5.823862614294231e-02   +4.070963781709711e-02; +4.184576840310757e-01   +3.240707751290258e-01   +2.968023261472356e-01   +4.542246337501980e-02   +1.201061422341325e-02   +1.963190523422117e-01   +3.035754733404975e-01   +2.948416309459211e-01; +3.476005273410993e-01   +2.421274522814839e-01   -2.787542068407529e-02   +3.409342911795869e-01   +3.301509282251774e-01   +2.481252514394963e-01   +2.538205766518766e-01   +1.612161504068572e-01; +2.176065481177041e-01   +3.351644605379480e-01   +1.077545817398334e-01   +3.447416555059951e-01   +3.142748071724088e-01   +1.737107128127059e-01   +2.389255710382504e-02   +3.672543755336819e-01; +4.551459546799218e-01   +1.911089741232244e-01   +3.130611897392890e-01   +2.506615168579059e-01   +3.076444881169709e-01   +1.106990288014144e-01   +3.240879138768681e-01   +3.641930003678187e-02; +3.224912035304317e-01   +3.215952346566555e-01   +3.945441837464737e-01   +4.674858636823251e-01   +3.271348812004385e-01   +3.332356819974170e-01   +1.011538251475398e-01   +3.381501362616892e-01];
L3I_L3E_iAMPA_netcon = [+3.328419340694302e-01   +1.783028840206128e-01   +2.457073900520002e-02   +3.269189970532344e-02   +1.388502046390968e-01   +2.722729929816045e-01   +4.056815627045379e-01   +3.422897912723329e-01   +5.390176319487296e-02   +2.091631295856480e-01   +3.627383221761431e-01   +2.418096460502685e-01; +2.426542859729788e-01   +1.307417154050243e-01   +3.819455360147787e-01   +9.581562638091268e-02   +5.047380762708183e-02   +2.969548617165851e-01   +4.662505754584257e-02   -1.081509342948236e-01   +1.297747924713521e-01   +2.574837905383294e-01   +1.983757876862259e-01   +2.457625988887631e-01; +2.339372151898770e-01   +2.403298465846263e-01   +3.000635467114463e-01   +2.181849491278085e-01   +2.538653478220322e-01   +4.015452863504096e-01   +2.644869996033025e-01   +1.774168999576486e-01   +2.386119076466688e-01   +3.332494494565861e-01   +3.911547351757715e-01   +7.235220993471611e-03; +2.034571608495769e-01   +2.854527550686270e-01   +1.798956785741173e-01   +5.610919652194539e-02   +2.154526380053150e-01   +8.266841414803375e-02   +3.541849803472473e-01   +3.983516871598958e-01   +2.416444808986261e-01   +2.272917645076971e-01   +2.421940561144253e-01   +4.106947095035244e-01; +2.568106564959343e-01   +2.532346360168777e-01   +1.781567377082930e-01   +3.729760628154515e-01   +3.848140501245541e-01   +2.100043392793674e-01   +2.561811544821704e-01   +4.061050432627367e-01   +8.003590062774980e-02   -4.963810455468404e-02   -5.843437882337622e-02   +1.820760260521462e-01; +3.055888467382309e-01   +2.784548848633682e-01   +1.475665662430096e-01   +4.411517033025132e-01   +9.471849221119320e-02   -3.433312530176653e-03   +3.767840177799388e-01   +2.264709134497751e-01   +2.577194156498994e-01   -1.428625890217881e-02   +2.876091396604466e-02   +2.100823539699384e-01; +1.270729072786519e-01   +8.182893606010365e-02   +1.246552957499347e-02   +2.688963691060119e-01   +2.845943498339853e-01   +1.231050342521798e-01   +5.676921782141158e-02   +2.592113225819127e-01   +1.158636588977555e-01   +4.170996995803774e-01   +2.928101436038217e-01   +4.761849630275561e-02; +3.210201289588380e-01   +2.926331939890119e-02   +3.119817935343462e-01   +1.199266612793264e-01   +2.510514144913127e-01   +1.865292348843310e-01   +4.120968886386989e-01   +2.099393466314537e-01   +4.151110596249973e-01   +2.088453397696983e-03   +1.202862158900882e-01   +1.040097299442093e-01; +2.428188758374920e-01   +3.344620161681399e-01   +1.072701031603328e-01   +3.603347437355840e-01   +4.423078339215345e-01   +2.205669338818466e-01   +5.718746936233465e-02   +3.398203522582808e-01   +1.875022043405235e-01   +3.063152005679454e-01   +1.186989794649150e-01   +7.025115298703728e-02; +2.274860140149233e-01   +3.273828411020522e-01   +3.916809795296223e-01   +2.610821195772494e-01   +1.060254156709076e-01   +1.031279134267781e-01   +2.230234662636226e-01   +3.707098433216743e-01   +1.461756149409671e-01   +3.313552499410590e-01   +3.720155728300523e-01   +2.563800837815633e-01; +2.963290870697711e-01   +1.847684735438367e-01   +1.822669468961699e-01   +1.520584288860277e-02   +3.506323408803152e-01   +1.241811375980609e-01   +1.550444423807426e-01   +2.255220384995496e-01   +3.343766088838305e-01   +1.419402296977134e-01   +2.755716781897051e-01   +3.058319489752934e-01; +1.932283034983545e-01   +2.596000023779610e-01   +4.320631353938584e-02   +2.314344785524023e-01   +3.120945619130303e-01   +4.138712726804005e-01   +2.789742861232595e-01   +2.548626602912971e-01   +1.936686905368599e-01   +3.988974264617031e-01   +3.827344657092117e-01   -3.353758107488076e-02];
L3E_L3I_iGABA_netcon = [+2.960941786770015e-01   +3.981773656677481e-01   +3.714011307147645e-01   +1.245657173799960e-01   +3.781423228319997e-01   +2.479047345870140e-01   +2.265114600217419e-01   +3.210356646410207e-01   +2.825420177765543e-01   +2.078637105575785e-01   +2.422903920131382e-01   +3.393013097134585e-01; +2.564921131173662e-01   +1.973190744682885e-01   +1.572418967088503e-01   +3.768768423617736e-01   +1.983798548328759e-01   +1.369607196984637e-01   +2.308405216303389e-01   +5.552891091259446e-02   +7.530126038785863e-02   +3.784984944101572e-01   +4.446760060316027e-02   +2.021990624639275e-01; +1.735447157762040e-01   +3.452711795140804e-01   +3.314621806646528e-01   +1.020257809908896e-01   +2.006111284998830e-01   +3.411420473438753e-01   +1.311389794393722e-01   +2.602983511132675e-01   +3.217839289078299e-01   +1.704838267597123e-01   +1.013778556613150e-01   +1.442831265694271e-01; -2.887173425907258e-02   -1.977165524437934e-02   -2.092134861731618e-02   +1.064262654422451e-01   +2.806485769053587e-01   +1.875767258974044e-01   +1.744348579909809e-01   +2.818329881302549e-01   +1.447111602334581e-01   +3.056696173754771e-01   +1.202904062949119e-01   +1.039502765524282e-01; +1.776628174236648e-01   +1.528072039281673e-01   +2.510060050382533e-02   +2.185742694802870e-02   -4.518632957302066e-03   +3.230890706499126e-02   +1.048740697954000e-01   +4.003743784921641e-01   +1.035926896984663e-01   +1.810478308393494e-01   -5.869092966042148e-03   +4.118118872986375e-01; +4.521431562216503e-02   +4.515295016934217e-01   +3.376453346060851e-01   +8.841033958396352e-02   +5.986650641946208e-02   +2.870918013348071e-01   +1.996530458246742e-01   +1.052100026975989e-01   +1.410670969297011e-01   +3.843877914781047e-01   +3.008231363290081e-01   +3.568061364007677e-01; +2.962232636307754e-02   +8.594437495280451e-02   +1.225456226473562e-01   +2.863799229797501e-01   +1.227312149537723e-01   +2.281067149792967e-01   +2.983823712287319e-01   +2.841869198508055e-01   +2.443964265908992e-01   +2.639608384755293e-01   +2.548959141554342e-01   -4.119500388034583e-02; +2.189822041010634e-01   +3.241098810774937e-01   +6.937598311100852e-02   +3.021699248187285e-01   +2.512692683734282e-01   +2.513017073953671e-01   +3.147400176859101e-01   +1.281280687368977e-01   +2.096175976361873e-01   +2.143122935802554e-01   +2.382148303601775e-01   +3.785747809791215e-02; +2.494230827399004e-01   +1.135010259497488e-01   +7.194181733727238e-02   +2.003092982830616e-01   +1.050639637701867e-01   +9.948194234114251e-02   +3.831592553491503e-01   +1.818714518555623e-01   +3.078969062118934e-01   +3.843762362385754e-01   +1.466035683912711e-01   +2.865898343853903e-01; +1.243362845928595e-01   +8.747779552597909e-02   +2.944693488860552e-01   +6.798781827972125e-03   +2.098233205890888e-01   +1.082471874485717e-01   +7.111746128307193e-02   +2.829576253148958e-01   +2.147172679129251e-01   +2.341802433191003e-01   +3.022248756018599e-01   +2.848593167991805e-01; +1.826762958089024e-01   +3.277508042038172e-01   +2.820859696174476e-01   +3.478767123445901e-01   +3.035909777374287e-01   +2.093305740144067e-01   +3.699398362514644e-01   -1.608361550282418e-02   +2.286888350398255e-01   +4.993420180533846e-02   +4.182880043664295e-01   +2.866194455680754e-01; +2.446708896411298e-01   +2.311294980036419e-01   +2.034352838366537e-01   +6.689118659981126e-02   +3.721822193326404e-01   +2.495658474145824e-01   +3.330263658458025e-01   +3.342183849517414e-01   +2.328403830979239e-01   +3.686814362403912e-01   +1.593400936292445e-01   +1.940074535601291e-01];
L2E_Input1_iAMPA_netcon = [+4.763301847441986e-02   +2.400739296888702e-01   +2.061781071759490e-01   +3.139877597125172e-01   +3.470404649982420e-01   +6.607305411299473e-02   +2.955106295689892e-01   +3.360149298723101e-02];
L2I_Input2_iAMPA_netcon = [+2.954402068720462e-01   +2.920369423437323e-01   +4.415119576182369e-02   +4.659562225241299e-01   +5.442261727435529e-02   +3.722658949162848e-01   +2.407384919012018e-01   +4.263560038782941e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.4*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.6*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.4*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.6*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.4*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.6*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.4*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.6*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
