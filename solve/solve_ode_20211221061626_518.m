function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.291861693069928e-01   -2.523547319530940e-02   -3.369628713790579e-02   -3.098582245996732e-01   -4.172939164668688e-01   -7.753142356847290e-02   +6.593385094377381e-01   -3.596660423398928e-01   +3.042913299911444e-01   -1.690793156139274e-01   +3.607191232992334e-01   -1.170432350597835e-01   -1.249576440054033e-02   +2.881011022644034e-02   +3.010005001711182e-01   -3.361126009931966e-01; +9.965545423202364e-02   +1.270286062506318e-01   -1.390429098067889e-01   +5.840592789433512e-01   -2.740785690285364e-01   +2.939950905739129e-02   +3.339903034249123e-01   +6.178979767274093e-01   -3.632523664962147e-01   -2.560945869761402e-01   +3.142717720880458e-01   +2.058477683994904e-01   -5.913082886664490e-01   +4.972129192993905e-01   +6.241619000733464e-01   +6.156886084170897e-01; -5.763632394851432e-01   +2.203214472268081e-01   +2.558463690463038e-01   -8.007480496777930e-02   -1.004622333972165e-01   -3.876700366106368e-02   -9.832717702982507e-02   -2.391925155068307e-01   +1.665267927900335e-01   +1.383464724841246e-01   +4.445356294118562e-01   -1.091182880176760e-01   +1.890771603728810e-01   +4.207953039676388e-02   -1.540560961962130e-01   -3.849985407868240e-01; -5.697980759989164e-01   -5.798174051524926e-02   -3.785825488246486e-01   +3.091937374569292e-01   +7.566552108560423e-01   -2.850355762944984e-01   +6.045740041439444e-01   +5.296141686361847e-01   +3.151902534271063e-01   -2.968979105266835e-01   -1.713898568827562e-01   -3.590300441500660e-02   -8.985907368824222e-02   -2.208541858913854e-01   +2.685661749163730e-02   +1.801206495153224e-01; -4.258625158369501e-01   +2.985827656516230e-01   +1.903460115788965e-01   -3.479285500869782e-02   +4.056671401021260e-01   +3.118533896321969e-02   +1.893740772322963e-01   +3.067880432799944e-02   +5.860106546629027e-01   -8.978055534786357e-01   +3.920848600210157e-01   +2.856262302610871e-01   -5.621321709900208e-01   -3.300960289006741e-01   +5.866096614145971e-02   +2.826319959841824e-01; +6.150555177439229e-01   +2.451431530692635e-01   +1.884154236306060e-01   +1.754794607163389e-01   -1.486529106941581e-01   +5.081671286038182e-02   -6.114005488289984e-01   -6.526610626077507e-01   -2.760278420112187e-01   +7.000032653652071e-01   +4.573589891691302e-01   -2.299263918843855e-01   +5.193734229651830e-01   +7.587756724421371e-01   -2.560763351093992e-01   -4.417713822306515e-02; +3.396793559952799e-02   -5.165509182792078e-01   -1.265654784984577e-01   +2.952025512366489e-01   -1.130137302835050e-01   +8.327440106223900e-03   -5.553311905862286e-01   -2.623654197083501e-01   +2.714027936768065e-02   +9.313685065935028e-02   -5.459568292997039e-01   -1.147679180522352e-01   +4.548461225282725e-01   +3.362860140985136e-01   +2.895186602088979e-01   -3.145657833489068e-01; +7.727067278553998e-02   +9.729837607367062e-02   +7.120447204045044e-02   -2.122795996330933e-01   -3.039888892143920e-01   -5.209503783512615e-01   -1.007483778346498e-01   +1.648704957021771e-02   -3.974301694326403e-01   +4.684963302004043e-01   -5.020371289137457e-01   -7.896966273859751e-01   +3.406284202132511e-01   -4.184379688082567e-01   +1.099095533840105e-01   -2.503778949937364e-01; -2.047012525721498e-02   +1.849584484743755e-01   +4.679724137400517e-01   -4.885273343724991e-01   +3.960589109014737e-01   +1.367338698845900e-01   -4.170114926530268e-01   +2.105551576650829e-01   -3.084203611688360e-01   +2.032487922447996e-01   -3.187833847399768e-01   -8.348707741485620e-02   -1.167034563332008e-01   +1.586805677082720e-01   +3.711950592778940e-01   +3.465869321524592e-01; +2.095745443557803e-01   -1.236073132225469e-01   +3.641106921657344e-01   +2.399705005645430e-01   +6.703360267806378e-01   +3.255072187990239e-01   -2.007187497394913e-01   -7.456829923715976e-01   +3.448849477211964e-02   -1.009307137335311e-01   +1.536608677451999e-01   -3.851121447130093e-01   +2.180908118534393e-01   +4.645574616022968e-02   +1.136635767665494e-01   +2.271921793550844e-01; +2.263069845216725e-02   -2.819192782523643e-01   -7.044303137771437e-01   +8.841612676703534e-02   -1.366531764335202e-01   -5.229588344992249e-01   +3.864147101612614e-01   -1.128341788871823e-02   +4.281973108610907e-01   -5.413912222589472e-02   +6.185545985474221e-01   -9.063249464213804e-01   -3.887760047280064e-02   +6.548037781624977e-01   +3.305045781440527e-01   -5.650569753344975e-01; -1.626492143272931e-01   +3.567349451517325e-01   +1.812506212078239e-01   -3.544185303830930e-02   -2.588986552327297e-01   +5.891852333837556e-01   -4.651144400505599e-01   +4.390876730921115e-01   -8.956402221132365e-02   -1.371501030223681e-01   +3.183412952930897e-01   -5.989345721341418e-01   +6.926695479827684e-02   +8.050722962322472e-02   -3.110010689330552e-01   -1.947658274890965e-02; +3.359327407269703e-01   -2.016815487972859e-01   -4.619487113487621e-01   -3.211641974254501e-01   +5.722140806044183e-01   +3.393393790754928e-02   +3.552012602977788e-01   +1.301638254740636e-01   +3.023596873694674e-01   +1.765216487685368e-01   -2.481853837610947e-01   -3.507709729385627e-01   -1.769198616998842e-01   -3.403627647926949e-01   -2.969404791780291e-01   -8.431747594977330e-01; -4.776463750087762e-01   -5.803637570340447e-01   +4.035022701172400e-01   +1.561954932708811e-01   +8.145519441374340e-01   +4.764420418183014e-01   +3.264169693484832e-02   +1.172935262059022e-01   -6.790005379551410e-01   +4.002006330395526e-01   -1.823218469694297e-01   +2.203022460173856e-01   -1.789110359959193e-01   -2.004392938983188e-01   -5.597870802620978e-01   +1.316142669029118e-01; -7.136429858751661e-02   +7.760525736135364e-01   -3.220968146160234e-01   +1.102113995887085e-02   +7.376050220927872e-01   -2.217778893448611e-01   -6.784179683898611e-01   +9.506280516432729e-02   +4.956692472920544e-01   -4.761194816873344e-02   +8.001879790467735e-01   +7.100425762454912e-01   -5.305314978696196e-01   -3.276803080368164e-01   +1.864528574740121e-01   +2.848935203812828e-01; -8.567182391920117e-02   -1.330127306090399e-01   +4.581807436965049e-01   -1.959734104979391e-01   -3.181357356340211e-01   +5.423069800950335e-01   +3.431538110399514e-01   +5.849389254817665e-01   -2.336489090032167e-01   -9.475350205613468e-02   +4.016337476777598e-01   -5.992112268803951e-01   +2.607402796962168e-03   -4.696353597811211e-01   -1.425706236145822e-01   -1.095979892281269e-01];
L1E_L1I_iGABA_netcon = [+7.093017126276950e-01   +1.394979765182795e-01   +6.041149417071840e-01   -1.477430758539608e-01   -2.606894098264657e-01   -7.229447644866055e-02   -3.501247113328146e-01   +8.969197505650479e-02   +3.889532934138556e-01   -5.308823107847654e-01   -1.133149168364710e-01   +3.621864570475697e-02   -9.593853265257847e-02   +4.116225150073014e-01   -2.102949286765591e-01   +2.932171304498298e-01; +5.418869986423624e-01   -1.020650523019291e-02   -3.856106323906834e-01   +4.202848593311330e-01   -3.675915490010480e-01   -5.367164573422606e-01   -6.396781236068593e-01   -7.495844941432295e-01   +2.565752424916748e-01   +1.416230715972726e-01   +2.063464561564251e-01   -4.040762066637144e-02   -7.363881489877676e-01   -6.338652148594644e-02   +5.617485992561680e-01   -1.023676255108512e-01; +3.557526952717475e-01   -3.815433896829101e-01   +6.069964050072914e-01   +4.063730708770198e-01   +5.277806454494232e-01   -7.388085660587012e-01   +4.160374892088956e-02   +3.572748730690116e-01   -1.404924144103439e-01   +4.272847988953847e-01   +2.950041961262875e-01   -2.775836218345464e-01   -1.225399045897688e-01   -4.629924409340426e-02   -3.560377261714026e-02   +1.549064319082890e-01; +4.717473646374831e-01   -6.149460793000943e-01   -2.735847240907753e-01   -3.807742435292381e-01   +9.668597346096688e-02   +2.086295972580587e-01   -2.171286799223412e-01   -2.300496624290964e-01   +6.600686028409056e-02   +3.804728387268154e-01   +3.490880759517183e-01   +4.060406127632101e-01   +1.561640194268668e-01   +3.555258700691352e-01   +8.894686245981248e-02   +2.293453888655954e-01; -2.973841852576835e-01   -1.871954234341082e-01   -1.562852392083950e-01   +1.929405624580358e-01   +4.411615727486328e-01   -8.223962745632607e-02   -6.066500421855608e-02   +2.395893429062394e-01   +2.090880141665817e-01   +6.008467264902681e-02   +6.074069274209520e-02   +1.919274942871240e-01   -2.392181670384063e-01   +5.580257460565646e-03   +9.014872542846258e-02   +6.604911113900105e-02; -9.484273471035795e-02   +7.005585492030626e-03   -8.880038568326576e-02   +6.712560356670061e-03   -2.352085526624929e-01   +1.690869510685793e-02   -3.813276596810976e-01   +3.653050609346076e-01   -3.161033634908411e-01   -1.960818395736939e-01   +3.848779434333295e-01   +3.747204436046763e-01   -8.419715287329482e-02   +1.465026742848819e-01   +6.496891613858932e-02   -2.194631300712684e-01; +3.145511546831665e-01   -2.397245495929560e-01   -6.460637351494594e-01   +1.772903369821960e-01   -8.475115789123785e-04   +1.312530535695970e-02   +2.597304144442846e-01   -8.229280778825866e-02   +1.392387890304342e-01   -1.008977628160586e-01   -1.996457577987578e-01   +2.833175679649727e-02   -1.684807147138413e-01   +1.779644538017459e-01   +3.165191631966272e-01   -2.036972913612853e-01; +4.323149286998317e-01   -2.918909266719509e-01   -5.442175309666160e-01   +8.876807350458450e-02   -5.990835753775812e-01   -4.689877029653960e-02   +5.853240619766222e-01   +2.365407977228940e-01   -5.071220605963330e-01   -6.005355261114403e-01   -3.462105400474706e-01   -9.478684862000294e-02   -5.378405356487461e-01   -1.956287703887445e-01   -1.029876105877026e-01   +4.765145105680477e-01; +9.387059489742983e-02   +8.985289415976239e-02   +8.463818201514086e-01   +6.856973917597067e-02   +2.202443802620413e-01   -6.684312309243601e-04   +1.540283806175952e-01   +4.079726896512061e-01   +5.163993813166354e-01   +5.686630280097818e-02   -4.481733621459630e-01   +6.977007708565662e-02   +3.797084340425388e-01   +3.055021959070656e-01   +4.811288262768689e-01   -1.832368509705832e-01; -2.019409461438714e-01   -5.149757318649609e-01   +9.867533434073637e-02   -4.234801556347539e-01   +1.425995603028988e-01   -1.019768758401066e-01   -5.302703330929398e-02   +4.889824183788690e-01   +3.003396333663548e-01   -4.832435850201236e-01   +2.437045816498820e-01   +1.631176546611612e-01   +7.163101862431880e-02   +6.329619668579561e-03   +4.080655388434504e-01   +2.995458217284908e-01; +1.115208875201496e-01   +6.568350756708259e-01   -2.920005540259000e-01   -3.218038115401985e-01   -8.977948449963136e-03   -1.180488651986715e-01   -6.525769312982016e-02   -2.463769293932299e-01   +2.536027567662060e-01   -4.933131242264659e-01   +6.218640911449067e-01   +1.653280821253100e-01   -1.989263859335451e-01   +1.471057167490354e-01   +8.879067083885653e-02   -2.619059875105078e-01; -4.645917650058896e-01   +5.564578856329417e-01   -3.032352698103252e-01   +4.188780481121590e-02   +2.322823119250687e-01   +3.940706082390858e-01   +1.242531822662068e-01   -3.430011477089491e-01   -1.303676494024743e-01   +2.850870468487905e-01   +2.891088034822840e-01   -3.636219549333265e-01   +3.712334835086372e-01   -1.184679038868106e-01   -1.918031420119081e-01   -7.743144733847386e-01; -2.477586698474381e-01   +1.204296519622910e-01   -6.356081686214518e-02   -2.603319928789706e-01   -5.482471702691831e-01   -4.735192783195240e-01   +6.562261226012564e-02   +6.758697566517534e-02   +3.949831774497877e-01   +5.429305010823815e-01   +1.063699279882645e-01   -8.174943660077164e-01   +4.715292433027771e-01   -4.445102941823900e-01   -2.516442283368434e-02   -1.030946233032395e-01; +5.183320765328441e-01   +6.702142697246112e-02   +4.627822185495979e-02   -4.192322376059212e-01   -1.378043613098557e-01   -3.262950532580297e-01   +2.906622120295892e-01   +8.350264356661073e-02   +8.807395569893703e-02   -6.430480234551308e-02   +2.810850587369055e-01   -2.863287929707384e-01   +2.038242567222858e-01   +6.973917675924463e-01   +3.854148644449647e-01   +5.270596539312197e-01; -2.350860357123848e-01   +1.323543997312610e-02   -5.246089367663870e-02   +1.869444572194528e-01   -1.002862238583616e-02   -2.062189924177871e-01   -1.774350710408734e-01   +3.151883404400361e-01   +2.174008465761880e-01   -3.882626542505321e-01   -5.414905247130969e-01   -1.648696798318283e-01   +4.941259397493544e-01   -2.050543896665776e-01   -1.699799745930552e-01   -1.679898865051486e-01; -6.859524176268929e-02   +2.674289592284198e-01   +7.763074926607765e-01   +3.921185460938428e-01   -2.471973037704985e-01   +5.759888569568326e-02   -1.566133746790354e-01   -3.555612819760132e-01   -4.050042136473768e-01   +8.222612310562130e-02   -6.636772932243273e-01   +4.333342172069048e-01   -2.330262453828567e-01   -1.602337832755203e-02   +2.062896719731893e-01   -3.657162114121489e-01];
L2I_L1I_iGABA_netcon = [+8.620930107305402e-02   +3.179396217963142e-01   +1.164282517070147e-01   -3.770358954281300e-02   -1.705425603092069e-01   -3.399442600817908e-01   -3.970968138014991e-01   -7.537706518548612e-02; -8.366090366551535e-01   -3.528255915420783e-01   +1.187833448241337e-02   -1.312958018604856e-01   +2.459598090825399e-01   +3.990720560826773e-01   -1.651489982787094e-02   +1.372816856442678e-01; -3.178500453884843e-01   +3.688754447589868e-01   -1.758706825822387e-01   -6.068447867809688e-01   +3.638915957519376e-01   -2.461173880093853e-01   +1.894073335890982e-01   +4.695234489609892e-01; +7.889812065206496e-03   +2.482028679033847e-01   -5.059959548487375e-01   -5.093671178969508e-01   -1.018560948958040e-01   +7.894354811388673e-01   -1.396519767667823e-01   -1.992145934992254e-01; +1.990526845004520e-01   -5.819461125157661e-01   +8.114176054518304e-01   +6.172489147796133e-02   -1.285049107457875e-01   +7.439841117434244e-01   -3.099986537427492e-01   -2.796130041217960e-01; +4.466859950613480e-03   +2.216716475419971e-01   -3.266421056261630e-01   +3.281750564296505e-02   -2.053607783749262e-01   -5.662448150911107e-01   +6.142859923501813e-02   -1.130380143780769e-01; +1.398134524469255e-02   -2.884625500497008e-01   +3.461010589223066e-01   -1.737391903251197e-02   +1.382467553607318e-01   +2.743023939331630e-01   -1.434341860759383e-01   +6.215549699347646e-01; +8.320436524420681e-02   -3.946069563723297e-01   -5.344074643959118e-01   +4.407533231548629e-01   -1.017229643334118e-01   +5.046415668958928e-02   +2.012931858148444e-01   -7.853766994434908e-03; +5.860703496091607e-03   -7.758576614102997e-02   +5.258799803037961e-01   -2.189688117063033e-01   +1.386884580350998e-01   -1.470710652204621e-01   -2.073334438929330e-01   -4.322975179433200e-02; +4.430077519497992e-01   -2.698636040909689e-01   -2.403736994312473e-01   +3.325237229052996e-01   -9.306226996661657e-02   +4.127918833719831e-02   +6.178142027214222e-01   +1.793708563163836e-01; +6.388381843467034e-02   +3.450352993479845e-01   +2.390535239011728e-01   +6.852119678448123e-01   -4.949556732875636e-01   +4.705438879980454e-01   -5.460864972711919e-01   -5.125447989720335e-01; -2.908009988045972e-01   +3.010229210020031e-01   +4.302161939176993e-01   -3.243616248145804e-01   +5.048472834182341e-01   -1.195470345571696e-01   -3.385878003000802e-01   +2.366961272933023e-02; +1.307301212063824e-01   -3.539741398672721e-01   +9.793595178656318e-02   -4.241316765125028e-01   -1.691747013613309e-01   +1.552921444973647e-02   +9.387259610667777e-02   +5.194139917405399e-02; -7.622837908391749e-01   +6.328676230613122e-01   -3.672441521165426e-02   +3.558471383111186e-02   -2.089007493878837e-01   +3.505768691704193e-02   +3.641981040074364e-01   +2.059395061501957e-01; +4.132472616084336e-01   +2.939008181348860e-01   -3.125921217040883e-01   +1.453417853133244e-01   +4.938666797703299e-01   +4.079568878899401e-01   +6.231729128894530e-02   +4.447904557490564e-01; -3.076867410002190e-02   +7.506027155623628e-02   +5.165852877211828e-01   +1.928534129497964e-01   +3.230088457861077e-01   -3.546998400850966e-01   +1.386577498473494e-01   +4.907926758773839e-01];
L1I_L2I_iGABA_netcon = [-3.513524272994402e-01   -4.448191896349925e-02   -3.709216140143381e-01   -5.732463694790103e-01   -5.273186880763368e-01   +5.756872404120513e-01   +1.134041126247833e-01   -2.335075700343976e-02   -2.865558820486677e-01   +6.790560762407485e-01   -7.652129882428135e-02   -7.430657098454031e-02   +1.058669478217080e-01   +1.624009514643859e-01   -1.394299506849013e-01   -2.326352003458522e-01; +5.239028464235391e-01   -3.363228963693459e-01   -2.551312651175531e-01   +3.446642917623985e-01   +5.700577165415466e-01   -2.117557182618586e-01   -7.750291868113171e-02   -4.795732568605193e-02   +3.512709333093984e-01   -2.097002333888833e-01   -7.581285393642132e-01   -6.735401645768914e-01   -4.469557952703490e-01   -4.987909820990782e-01   -4.101195918668731e-01   -1.330504203888179e-01; -5.924585567524756e-01   +2.436163857831071e-01   +1.120475489378636e-01   -2.965954180010331e-01   -3.562908702537608e-01   +1.728869799035628e-01   -1.407795733744331e-01   -5.501071124961823e-01   -1.074821752204919e-01   +6.554913009442859e-01   -4.244890314234613e-01   -1.046565594420186e-01   +1.079796131484970e-01   -2.200712166566116e-01   +4.504132217003879e-01   -4.372269973419706e-01; +4.709499905217361e-01   +2.470466730013585e-01   -2.543365766591223e-01   +4.703826193625621e-01   -2.661504271370732e-01   -2.457263272132004e-01   +1.125954337703735e-01   +2.804593059344191e-01   +2.315821534493804e-01   +6.985830755973995e-01   -3.965494264770310e-01   +2.053971747000972e-01   -1.592359195709053e-01   +8.289087594974707e-01   +3.328865008786873e-01   -7.877849023195223e-02; +1.112406774925944e-01   -1.722940419660942e-01   +2.081804192224569e-01   +7.159504469508169e-01   -1.372665328403936e-01   +5.073922176383213e-01   -4.487755728674940e-01   +3.805578962307045e-01   +5.666714139852201e-01   -4.869530934370683e-02   +2.099697955429056e-01   +1.113636689148954e-01   -1.066745260202903e-01   -1.670176140697648e-01   +5.652613784435001e-01   +6.633266551610586e-01; -5.226708085228334e-01   -6.143755886827468e-01   -6.585257036553643e-02   -1.211605222153418e-01   -1.548076701526696e-01   +3.338831554940754e-01   +2.127162363755827e-02   -4.458566366513926e-01   +8.279103497939026e-02   -5.034385696055574e-01   +3.820779132134259e-01   +3.964703644342756e-02   -4.459961680198780e-02   +1.770343509825714e-01   -4.364330844659766e-01   +6.843056454155954e-01; -2.790354177018425e-01   -3.241699346644778e-01   -1.376000501434627e-01   -6.071676615095813e-01   +1.262722825111429e-01   +4.280019520503692e-02   -6.352248156199169e-03   -3.290081011196465e-01   -3.036904779481690e-02   -7.363004650622242e-01   -9.875055586782959e-01   +6.407974828021995e-01   +2.704134149083541e-01   -1.892051026718236e-01   -4.067066440218803e-01   +5.045818054251827e-02; +2.897411591922990e-01   -5.489582040713465e-01   -4.527007276062677e-01   -2.108918432129878e-01   -1.233400612393724e-01   -4.433981150690323e-01   +3.931376010458381e-01   -2.348886223839723e-01   -1.198422026169843e-01   +1.247266873810159e-01   +1.370266660260017e-02   -4.138579338294301e-01   +5.539292183003548e-03   +3.538935126367045e-01   -9.180421225615565e-02   -5.474836972242293e-01];
L2E_L1E_iAMPA_netcon = [-3.189496382327787e-02   -3.807061480571412e-01   -6.462314829512228e-01   +1.016123833172987e-01   +2.799532391298232e-01   +7.890168187571230e-02   +3.545377276706340e-01   +3.613800074289403e-01; +4.153855232519677e-02   +1.938413184525378e-02   -4.267262778751823e-01   +2.185934912313749e-01   +1.238451482476985e-01   +4.890216675483228e-01   +8.156425541576573e-01   +3.538375535386174e-01; +7.408612419004001e-01   -4.651313264530781e-02   +3.216747636204066e-01   +6.916263923476433e-01   -7.022315916123914e-02   -5.143942084981933e-01   -1.623789110145064e-01   -7.539026614279278e-01; +4.007474069756060e-01   +2.278022516771259e-01   -3.240048869228424e-02   +4.550369904709042e-01   -2.483290492098228e-01   +2.310459972511569e-02   -3.368806755684070e-01   -6.128018404683173e-01; +1.410944895386815e-02   +2.955769595462169e-01   +4.499242325769328e-01   +5.550318135695126e-02   -1.928865957268570e-01   +3.173984051668230e-01   -2.988077294945096e-01   -8.933293838678757e-01; +7.154274013540559e-01   +3.882713000958021e-03   -3.563747841431458e-01   -5.475076881695120e-02   -3.603229696181885e-01   -2.929726667221689e-01   -1.453536965274494e-01   +3.371698158638728e-01; +2.320864475973367e-01   +5.848968248425904e-02   +3.736535441299580e-01   -5.065849821516080e-01   +6.831356326583604e-01   -2.497521926509742e-02   -4.541400095480317e-01   +2.918849948255153e-01; -8.543188380681285e-02   -2.865495843569348e-01   -2.859130526199289e-01   -3.985870819318639e-01   +3.457450895514113e-01   +5.783043422162851e-01   -3.425196585051120e-01   +3.556888062721632e-02; -1.649532687510175e-01   -2.445716833968893e-01   +4.112093586311997e-01   +8.810517462269135e-02   -1.365140401305673e-01   -5.327842241391852e-01   +2.543206073207790e-01   -1.413067597324183e-01; +2.018548121626238e-01   +3.596829617458239e-02   -3.652393090054847e-01   -3.813440043944626e-02   -3.157115175824832e-01   -4.754087234164389e-01   +2.698449547356889e-01   +3.586138905974148e-01; +7.176386989229455e-03   -6.347746727454887e-01   +9.201015076019894e-02   +7.850952040871967e-03   +4.180574398777515e-01   +1.372616686624640e-01   -3.406534725251158e-01   +9.845713878520972e-02; -4.623487913285149e-01   +3.021678837288848e-02   +7.156279254614696e-01   -7.194530586034802e-01   -2.857774654310808e-01   -5.326346759148234e-02   +1.385540067071120e-01   +8.324334487380358e-01; +4.810303337762578e-01   +9.192413835988661e-02   +4.040735762648037e-01   +5.814404011906048e-01   +4.709983972474029e-01   -1.464116791796088e-01   -5.928903364042828e-01   -6.447090087535610e-01; -9.460966483640866e-02   -1.404918847416096e-01   +2.297600875887464e-01   +3.787630019709345e-01   -2.353287426053759e-02   -1.053818189604019e-01   -1.919186467292416e-01   -8.276782707553970e-03; +3.592976026437951e-01   +1.356527336895874e-02   +1.670638816171511e-01   +6.006806476764215e-01   +6.861764710564408e-01   -3.910139862276037e-01   -7.168399734358404e-01   -1.086918384210077e-01; +2.094129684756788e-01   -1.210033038450725e-01   -4.023275752172356e-01   +2.795436758267686e-01   +2.169178416976185e-01   -2.985555723894597e-01   +3.874928508243392e-03   +1.323262062509957e-01];
L1E_L2E_iAMPA_netcon = [+8.945105086970009e-02   +3.928603613720395e-01   +4.388868624427782e-01   -1.318780154855022e-01   -1.330310565765669e-01   -4.831367845185146e-02   -1.513941244890787e-01   +2.706826034644774e-01   +2.597963584425347e-01   +2.803137721665186e-01   +3.639328413983216e-01   +1.671838940840845e-01   +7.612327484854250e-02   +4.015869136336584e-01   +9.930630981818041e-02   -5.759754983042180e-01; +3.644111952994176e-01   -3.526712041196508e-01   -5.516014456728053e-01   +2.284138406730668e-02   +2.063774527448979e-01   -5.528649818197667e-02   +2.063599595480138e-01   +2.345994489135538e-01   +6.978866229406931e-01   +9.705758486147259e-02   -5.360347646250798e-01   +8.541637660667106e-02   -3.245513114672308e-01   +2.341106970361648e-01   +3.217810078956950e-01   -7.772734686502918e-01; -2.440502634127968e-01   -1.293686422275815e-01   -4.131600223145714e-02   +4.703553089943426e-01   -5.962502120389397e-01   -1.353643561976520e-01   +3.264274547215890e-01   -2.218462930203934e-01   +1.729450044129237e-01   -4.897354016721135e-01   -8.186815307222652e-01   -4.246552989250445e-01   -5.426139844402467e-01   +2.616878643828906e-01   -5.557021809501447e-01   -1.628966026267177e-01; +3.385960080045919e-01   -9.335128321301567e-03   -3.425734765116928e-01   +2.651829885598761e-02   -5.897106656160471e-01   -4.251470232768018e-02   +2.058550026934038e-01   +1.079732802552854e-01   -2.066405580251016e-01   +2.682285140688169e-01   -2.650640260289689e-01   +4.760455888986782e-01   -5.484455134688790e-02   -3.392278473706992e-01   -4.865739519382619e-01   -4.231668431900829e-01; -9.302714877764265e-02   -3.054188864005044e-01   -2.216995262458517e-01   -2.542952366436197e-01   +3.011395738457600e-01   -3.488474854996652e-01   -6.455702689173972e-01   -4.232276748706147e-01   +1.558447557759163e-02   +6.913769731674729e-01   -2.913195501491580e-01   -5.370285026198751e-01   +1.913160087256094e-01   -1.292156400410161e-01   -2.952790457284490e-01   -6.292847257363831e-01; +2.295916991382883e-01   +5.039659466326860e-01   -5.579630556545983e-01   +6.013851014960097e-01   +4.611428753773757e-01   -3.155134195551677e-02   -2.023703565150317e-01   -1.501851368250620e-01   -8.614582162270351e-02   +4.571596898602903e-01   +7.823313487585446e-01   -2.879156316698141e-01   -1.609748630454673e-01   -3.388019414188078e-01   +1.160310349317302e-02   +1.912905792729829e-01; +6.547309290314450e-01   +9.400431371992984e-02   +1.934605626385768e-01   +4.861179486482481e-01   -2.431767361947057e-01   +2.159482500866578e-01   +4.394864347413749e-01   -2.514930775856661e-01   -2.095950152010638e-02   -3.091185195070325e-01   -5.013466812590970e-01   +3.005255140006490e-01   -1.131862881581935e-01   +1.797049410204750e-01   +6.468824787485840e-02   -1.075459250992654e-01; +5.559117304578522e-02   +2.348174262621233e-01   +8.478821054942354e-02   -4.049526029042574e-01   -4.998745101257493e-02   -2.182455160894505e-01   -5.054428014367367e-01   -1.886854408205574e-01   -5.313471231701690e-01   -9.924223992095711e-02   -3.001819444829704e-01   -4.468387481176937e-01   -1.453755704940594e-01   +2.600091423044902e-01   -3.877868799476200e-01   +7.730241240288353e-02];
L2I_L2E_iAMPA_netcon = [-2.005177917397658e-01   -3.620936319307086e-01   -6.914484803573361e-01   +2.049790672170093e-01   +2.630524228644252e-01   -1.475286610122147e-01   +2.689990762432443e-01   +6.395177198247755e-01; +1.045349835918912e-01   -2.746217043633245e-01   +2.857171566740889e-01   +3.651544643864690e-01   +6.307239323970991e-01   +3.913017711747021e-01   -3.311477970262018e-01   -4.431828953259153e-01; -6.881606473967162e-01   -2.593039565068804e-02   +9.547397731790334e-02   -6.093634154825553e-01   +7.221068374897287e-02   +3.862833627048726e-01   +5.499770787189394e-01   +7.630043396261665e-01; -4.439199683372301e-02   -2.177357359207408e-01   -6.822539820716669e-01   -3.579651800970023e-01   +1.156573463759770e-01   +2.560212184084706e-02   -1.560096969258687e-01   -4.987687254207342e-01; +3.818477117244734e-02   -8.459039552224445e-02   +2.956104307620694e-01   -3.713900290146095e-01   -2.541029069339137e-01   -3.264293587337120e-01   +6.584217598475230e-01   +1.949294206999925e-01; +1.495286573712460e-01   -3.981270178431465e-02   -9.631633226515257e-02   -2.681882306387162e-01   +3.772396171668020e-01   +4.466534388949871e-01   +1.033008160811187e-01   +1.473904437724102e-01; +2.487562415521111e-02   -4.940698730178289e-01   +2.894132077581524e-01   +4.233576227951664e-01   +4.560115963477385e-02   -4.363575056139066e-01   +2.294763324216340e-01   +5.112854705070397e-02; +5.990648034534896e-01   +5.104986557567105e-01   -7.214258659557199e-02   +1.229331012215330e-01   +9.059020298176627e-01   -6.076706822961034e-02   +1.759499736674898e-01   +5.942623099933888e-01];
L2E_L2I_iGABA_netcon = [-6.312188508027539e-02   -3.475133251567811e-01   +3.184788199118603e-01   +7.079908172886845e-02   +1.350732456575170e-01   +4.752618519600772e-01   -2.966574518504037e-01   -3.608728532408650e-03; +2.340315148346401e-01   -4.386549339823774e-01   +1.836189623914917e-01   -2.083450001679721e-01   -3.217382356107967e-01   -2.741343074988360e-01   -3.821438153832188e-02   -4.886942995903596e-01; -3.589373015257372e-01   -1.977405973235868e-01   +1.395462727089126e-01   -1.718050437320536e-01   +1.410372157281010e-02   -1.741906212328739e-01   +8.410064889858515e-03   -2.911341735352317e-01; -1.782801901872323e-01   -3.660603888954492e-01   -2.582655655787250e-01   -5.447582349569187e-02   -7.785644502423473e-01   +1.953810055520127e-01   -3.112714761478031e-01   +5.627844489901761e-01; +3.788321014214568e-02   -1.274817692183433e-02   -9.847100052472239e-02   -5.324500508422971e-01   -2.220029386163529e-01   -7.907287821400512e-01   -3.768584285747432e-02   +4.666148594914467e-01; -4.164638470893766e-01   +2.887326132442329e-01   +1.747836545486431e-01   -2.743260886288263e-01   +1.682267228803325e-01   -5.707763046912683e-01   -6.817735023289575e-01   -2.520532439769629e-02; -5.301979253678224e-01   -1.334843496623343e-01   -2.277059501975258e-01   -1.547784954796221e-01   +1.442664076728703e-01   -1.216917170607347e-01   +3.222947886641167e-01   -6.332917110886372e-01; +1.477818197628326e-01   +2.309338292397775e-01   -5.601963974237135e-01   -6.893453659711533e-01   +2.792005559666290e-01   -4.947805553864485e-01   +1.692526647311666e-01   +3.891144412531029e-01];
L3E_L2E_iAMPA_netcon = [+1.482345481409679e-01   +1.509018879406943e-01   +1.911291233819947e-01   +3.895657843254753e-01   -2.670568595447508e-01   -7.347102840781004e-02   -3.496858795636031e-02   -6.879426693052542e-01   -4.641915885046392e-01   +2.118697480058496e-01   -8.958300378451457e-02   +2.983354328196558e-02; +7.391268618505734e-02   +3.168225647806299e-01   -2.197970038307515e-01   -2.647728132260843e-01   +7.023784320337205e-01   -1.830094321036243e-01   -1.012118051510773e-01   -2.187249563410366e-01   +4.955645796257385e-01   +2.252109504261074e-01   -5.036790745196100e-02   -9.143937685942174e-02; +1.898278569431900e-01   -3.886975312162451e-01   +4.320301678136462e-01   -4.371406982310626e-01   -2.930365151544846e-01   -4.901135305885156e-01   +7.400888177261454e-02   -3.922717420909841e-01   -3.168283406228865e-01   -2.518461803606659e-01   -4.104125336987383e-01   +3.798923990708523e-02; -2.131051909426370e-01   +2.159135280632718e-02   -5.572843286478054e-01   +2.719105486733612e-01   -3.510953552168603e-01   +2.004793278095803e-01   -4.668354187362210e-01   +1.818125577106697e-02   +4.541683954875386e-01   +2.660202294289752e-01   +1.357181879617043e-01   +6.355041363414615e-01; -3.170248826889869e-01   -1.184695893901954e-01   -4.703585425970458e-01   -9.984952072435829e-01   +2.556032311220055e-01   +1.291289915951830e-01   +2.213116891406351e-01   +1.955715690130005e-01   +2.856543712933987e-01   -3.681501262711276e-01   -6.968930351539275e-01   -3.018175622068808e-01; -3.670583737632241e-01   +1.476119152641890e-01   -2.982600714724210e-01   -5.385702291990386e-01   -3.042326812257066e-01   +6.096623105633807e-01   +5.578143081124662e-02   +4.659910349852802e-01   +3.943471036148306e-02   +1.563434897980151e-01   -3.874684825073800e-02   +5.058739999153274e-01; -2.014871409262039e-01   -1.259725016305743e-01   +4.945385982489620e-01   +2.057282428475223e-01   -2.576635667645037e-01   -2.795930528898466e-01   +1.874165282324272e-01   -2.993351675310340e-02   +6.579478020664352e-01   +2.431192238200386e-01   +2.400441582030892e-01   +3.094429302934126e-02; -1.625507942762220e-01   +4.045265939719545e-01   +4.566111077454292e-01   +1.581697021139047e-01   +2.674479016134629e-01   +6.157645287093978e-01   +5.177416333261555e-01   -1.985810945237482e-01   +4.515352801679772e-01   +3.257188186907648e-01   -5.355905993669025e-01   +1.079752189091885e-01];
L3I_L2I_iGABA_netcon = [-7.188664223407659e-01   +7.638000483532080e-01   -5.510105670814452e-01   -1.508341261782720e-01   +3.948256535112130e-01   +3.680714962501927e-02   +3.880114704750663e-01   +2.919168328184799e-01   -2.499701793850790e-01   -5.016836640354155e-01   +7.199090180800712e-02   +5.385231299583212e-01; +1.516760771163694e-01   -3.120691023691824e-01   -1.022841660071242e-01   +6.150052320573433e-01   +7.819346508530689e-01   -3.559938044523189e-02   +2.484705511656997e-01   +2.342066342684056e-01   -2.917555244210741e-02   +3.568095429013631e-01   -1.021226872074600e-01   -3.359872093846535e-01; -3.326651506392732e-01   +4.257927046394210e-01   +1.983853080441605e-02   +4.032758304204520e-01   -1.725155998927450e-01   +3.476556822791049e-01   +5.682542980299890e-02   +1.474448800513675e-01   +2.813631868792583e-01   +3.455039209936173e-02   +5.257388864264262e-01   +2.577173716047948e-02; +3.135515959329666e-01   -3.978362218516848e-02   -5.007163414792715e-01   +2.982205467891910e-02   -5.822633654736756e-01   -1.039984007943491e-01   -4.815310718472468e-02   +2.403240407350043e-01   +1.005533643788931e-01   +6.200219943099334e-02   +3.901661417008693e-01   +5.144838022970305e-01; -6.524186037812977e-01   -6.496047780325961e-03   +1.814584939182844e-01   +2.465546729293530e-02   +2.723954045290078e-01   -2.394728677167224e-04   +5.005802247623203e-01   +1.444943649412544e-01   +1.862941211898626e-02   -4.202696487181860e-01   -7.040726590516483e-02   -5.200360484658352e-01; +9.766455507918387e-02   -3.374107084067062e-01   -4.280473870305707e-01   +2.796994379953583e-01   -4.006737883510120e-02   +2.632088953725059e-01   -3.902944465101075e-01   +5.679652816985195e-01   -1.367145309026027e-01   -3.587845528433196e-01   +2.224790537756857e-02   +2.485084611292082e-01; +2.907536662047099e-01   +1.789814345436788e-01   -6.476737965691723e-02   -2.722652231867269e-01   -5.341374450672322e-01   -1.643552967190522e-01   +9.254082803184908e-02   -3.374043585630379e-01   +2.965878930203371e-01   +4.195332826093298e-01   +4.251377074146417e-01   +1.558314342920751e-01; -1.739450778812776e-01   -4.884483478828914e-01   -1.475283256779701e-01   -1.055246087907260e-01   -7.577675609669597e-02   +8.089999330625938e-02   -2.410212265694603e-01   -4.929021596540158e-01   +4.950590327410302e-01   -1.943298608673862e-01   +3.956197109584743e-01   +3.261693824565486e-01];
L2E_L3E_iAMPA_netcon = [+3.252190559439491e-01   +3.773547777204137e-01   +3.916355221615547e-01   -5.189560057631906e-02   -3.750694334971371e-01   +2.445608076345135e-01   +4.184109173590900e-01   -6.271067586604131e-01; -1.752366281259790e-01   +3.570096005172056e-01   +4.895827636634564e-02   +5.470684917600439e-01   +2.535260952800366e-01   -2.574978932102163e-01   -8.481575321069456e-01   +3.616220322572688e-01; -2.540780251787678e-02   -4.638072481935507e-01   +2.824807293025587e-01   -5.381662622871090e-01   +3.620464670830244e-01   -1.945613667083373e-03   +2.217359028351991e-01   +1.973720944277686e-02; +5.601246130150167e-01   +2.235238685432128e-03   +8.831359739781117e-02   +3.117302235116799e-02   -3.444087571936170e-01   +5.255314303879510e-02   -7.277142531600747e-01   +2.757272561920722e-01; +4.719058655007390e-01   +7.603699937674313e-01   -2.795160268109790e-01   +3.086355763287052e-01   -5.226793894132900e-01   -5.131078380193063e-01   +3.375361360637233e-01   +3.556388135537162e-01; +3.081426345022457e-01   +1.306167977818216e-01   -2.963649063912531e-01   -3.467798814051110e-01   +6.342599718704044e-02   +5.979642350524559e-01   -3.162788411544211e-01   -2.577264568869889e-01; +7.479097536377246e-01   -2.714416282968314e-01   +2.576161550090177e-01   -1.324697848058524e-01   +2.203746794560705e-01   -2.392137904761036e-01   +1.169777030043300e-01   +3.926843463419097e-02; +7.977297375090255e-02   -2.391425812196730e-01   +8.585841964087171e-02   +1.620742630970817e-01   +2.347612090148765e-01   +1.893526653832365e-01   -5.390555536030900e-01   -3.179766589877121e-01; +4.618713500723723e-02   -1.342653871453954e-01   -6.033040668569117e-02   +3.913444657297299e-01   -2.996476451087019e-01   +6.863044378454286e-02   -3.802785338764003e-01   -1.630770574345566e-01; +2.382692962505013e-01   -3.590960866177620e-03   -2.238599629445132e-01   +3.962854089481099e-01   +5.793826322764949e-01   -4.047043892542830e-01   -2.304861157250631e-01   +8.502662842217215e-02; +1.062493333109710e-02   -4.475920157202711e-01   +5.568248534344390e-01   -6.628891587897344e-02   -5.773659676097329e-01   +1.725158967974212e-01   -3.682188392987033e-01   -5.540718016303907e-01; +2.228567532039127e-01   +5.107285889461286e-01   +6.858945939831985e-02   +5.287119493296766e-01   +7.546084691601378e-02   +5.850142337923068e-02   +1.166950445465804e-01   -1.541795385108486e-01];
L2I_L3I_iGABA_netcon = [+1.061940385495948e-01   +2.854610260871880e-01   -3.133570803773691e-01   -1.827428917007509e-01   -1.328529133078459e-01   -6.516616312731000e-01   -2.315052771071230e-01   +4.673100835154614e-01; +4.575333812765821e-02   -3.692206153409901e-01   +2.528667219210578e-01   +2.721140097347877e-01   -2.114174801939669e-01   +7.998344562468575e-02   +2.026420754272800e-02   -1.019641885418522e-01; +9.015512644926288e-02   +2.528126266337474e-01   +9.584922176553116e-02   -9.012132940754838e-03   +2.576408793726577e-01   +3.632727398708704e-01   -4.616042833121697e-01   -3.052010162971500e-03; +6.008732217420842e-01   +1.289476978769551e-01   -2.833456551338778e-01   -2.625927192928953e-01   -1.560346385470074e-01   -6.046013047259150e-01   +3.786819973487773e-01   +6.161248660715268e-01; -6.657348836349624e-01   +2.858151889053916e-01   +7.039722369615208e-01   -1.394668267869211e-01   +2.966698285971598e-01   +6.726953679290001e-01   -1.301374387508691e-01   +4.749633296492976e-01; -8.868720123459564e-01   +1.139150972232300e-01   +5.427479138770898e-01   +1.301993493573720e-01   +3.207083432972511e-01   +2.264813817055754e-01   +3.750197713723442e-01   +1.180864739334940e-01; +4.061275837555646e-01   -9.735093791666741e-02   +1.383778653761053e-01   +4.384671296751742e-02   +4.441283141250039e-02   -1.542622923707593e-01   -2.822115533837262e-01   -2.695189378427130e-01; +1.636649719456201e-01   +5.746187143034592e-03   -4.383584062237107e-01   -3.034330980772955e-01   -4.328146909282520e-01   +6.307406986976596e-01   +1.341237811025965e-01   -3.500482545732957e-01; +1.985877423306855e-02   +2.855782894820063e-01   -4.342602556765815e-03   +2.172346395075084e-02   +2.122626602439661e-02   -1.031479798611872e-01   +7.687165667099810e-02   +4.448802976082212e-01; -1.924083191939158e-01   -2.046886654035079e-01   +2.725948858141972e-01   +3.369743014205927e-02   +2.493912616720164e-01   -4.560350609666490e-02   -1.000000000000000e+00   -2.916789810961404e-01; -2.257172134048996e-01   -6.931278406073283e-01   -3.058497671188752e-02   +1.246522151439842e-01   +4.523764164946694e-02   +6.724200388948320e-02   +3.705208723933865e-01   -3.623624285835687e-02; +8.274877651323088e-02   +7.447281580426993e-02   +4.897029045633786e-02   -3.772071846875233e-01   +2.957279772204727e-01   -1.405347163622190e-02   +7.332879302123640e-01   -3.941347801774218e-02];
L3I_L3E_iAMPA_netcon = [+2.376252955311268e-01   -5.325845235121068e-01   -4.521549007312865e-02   +6.849720670387725e-02   -1.253151299516227e-02   -7.465218535069822e-02   -7.445378222343407e-02   +4.317724125941294e-04   +5.710984695714636e-01   +1.804018360126989e-01   -2.722015772200995e-02   +9.207724216113619e-02; -1.644621414785184e-01   -1.419688846265898e-01   +1.254052945061208e-02   +3.070729193669106e-01   +7.369238621287266e-02   +3.376765093248060e-01   -2.848394677918882e-01   +1.468087128238157e-01   +6.529772340442356e-01   -3.840409821048269e-01   +1.010443777120576e-01   +4.076925521236788e-01; -5.654885078450372e-02   -1.205643587108884e-01   +5.159950670273326e-01   -4.502412077114122e-01   -4.765051483395888e-01   -2.810411471176849e-01   +3.516390738325666e-02   -3.956402721950775e-03   +1.536864674461308e-01   +2.219887287584224e-01   -1.781190752881689e-01   +7.793895963911929e-02; +5.589794175595639e-01   +1.191505812864373e-02   +3.833842381741691e-01   +1.514902093272857e-01   +1.869163624249745e-01   +1.970042075930267e-01   -6.689926700045309e-02   +7.367580887299122e-02   +2.271076474142051e-01   +1.777784778564184e-02   -4.222987567685452e-03   -4.009607478380671e-01; -1.038874695664837e-01   +3.460567686848864e-01   -1.417912421696645e-01   -6.241626731496508e-01   -1.817400412404390e-01   -6.322253583871260e-01   -4.121766265437888e-01   +1.795221154711966e-01   +1.705083440953378e-01   +1.624477224370669e-01   -4.123258170211906e-01   +1.936376034096585e-02; -2.332084641126399e-01   -6.090232113164207e-01   -4.284704134363122e-01   +3.947328564155420e-02   +5.844597808069696e-01   -4.004763172367085e-01   -1.923340161644809e-01   +2.055554491775083e-01   -5.014500180839739e-01   +1.481724922622219e-01   +4.770834597415730e-01   +4.286050504463991e-02; -3.735413191992037e-02   -5.455407429837694e-01   -3.593395386436571e-01   -1.373754700114822e-02   -1.324394155093738e-01   +1.880637642029061e-01   +4.507184909450991e-01   +5.334768779338637e-01   +5.434119963617434e-02   -1.722007386488985e-01   -4.199802455959431e-02   +1.063653712600723e-01; +1.095972387675913e-01   +2.929773964643332e-01   +3.543839377258777e-01   +1.594041664050166e-03   +1.749221009485378e-01   -1.680627774124873e-01   -4.038830284161901e-01   -2.779394873367375e-01   -4.401850361671574e-01   +5.201754705902483e-01   +1.186654019374943e-01   +4.601524413007410e-02; -4.894439220685012e-02   +2.477072079675480e-01   +1.157241942607910e-01   -1.016737517717211e-01   -4.756742240485813e-01   -6.376705312638418e-02   -2.858648143027386e-01   +1.340507388327897e-01   +2.278424688500224e-01   +7.877621928031053e-02   -1.934069476145586e-01   -1.171371077201337e-01; -2.487770241520114e-01   +2.829892974603276e-02   -4.034831571460646e-01   -1.543259834408730e-01   -2.816115456902662e-01   +3.130050191246377e-01   +3.272436380540265e-01   -1.577964550606582e-02   +5.208628275442256e-01   +9.151539249799404e-03   +5.396497558481311e-01   -1.847717864925279e-01; +4.074818203031407e-01   -2.640507087689071e-01   +4.711697028960470e-01   +1.113885285783463e-01   -1.969359319916788e-01   +3.638664448133577e-01   +4.267891594845157e-01   +1.506115440361916e-01   +5.822660602507360e-02   -5.218720462543348e-01   +4.853609466592798e-01   +1.246014785938206e-01; -4.598482322640393e-01   +2.124370885039314e-01   -1.012168939874968e-01   +2.113528213297155e-01   -4.118308994683913e-01   -1.350110213789881e-01   -2.074418267443157e-01   +1.888824506254469e-01   -2.221349869012315e-01   +5.080853102731042e-02   +1.188800251195340e-01   -2.744922081770750e-01];
L3E_L3I_iGABA_netcon = [-3.597407553840165e-03   -1.881458122195188e-01   +3.801991028644843e-01   +7.340547366566891e-03   -4.200295344903122e-01   +2.178977059114046e-01   +4.582719467963323e-01   -1.510201701959113e-01   +5.338242860204918e-01   -1.634820404993217e-01   -3.170315071135769e-01   -2.893280492072781e-01; +7.915069865757164e-01   +6.813502059283083e-01   +3.590346688238541e-01   -3.122059780688154e-01   +9.813298787754783e-03   -4.520418929542027e-01   -4.012646123826763e-01   -1.603904218414043e-01   +1.044133400788767e-02   -3.724205071958501e-01   +9.645095968433731e-02   +1.628652963785102e-01; -5.751675069782040e-02   -2.205794306732651e-01   +5.136871934055739e-01   +3.822646861607633e-01   -5.844004855181301e-02   +5.708330939962590e-01   +3.097093046550883e-01   -4.006023681631913e-01   -5.675411743721627e-01   +5.242958988016388e-01   +2.857381567929596e-02   +4.776527125871818e-01; +1.691530890117947e-01   +1.000946672873911e-01   +3.059332728448796e-01   -1.907657134795623e-01   -4.057378347787104e-01   +2.799916667348950e-01   -2.408191382634504e-01   +5.968709144213067e-01   +2.357051694463007e-01   +4.639561601893641e-01   +1.639445406596706e-01   +2.505825580751373e-01; +1.092302127074366e-01   +8.797059114510897e-02   +1.746879938739307e-01   +1.804021555318587e-01   -4.877307548871685e-01   -6.869794545973690e-02   +3.919320214626984e-02   -2.919334036910117e-01   +2.435069114155823e-01   -2.758914056719328e-01   +8.850201810205932e-02   -5.270693103115229e-01; -1.926343601200812e-01   -2.998873743613394e-01   +1.631029893064865e-01   +4.988292720340545e-01   +4.340614083015666e-02   +2.580457364262271e-01   -2.714041390224326e-01   -2.552423344548853e-01   -1.248278660162607e-01   -2.198795715238339e-01   -1.069929809075541e-02   +1.415250012424401e-01; +2.440129366466616e-01   -7.690798739170124e-01   +6.633017567475630e-02   +1.571417897625257e-01   +4.640388215790897e-02   -3.999422876561329e-01   -3.394096122920222e-01   -3.879337825778265e-02   +6.648008925283471e-01   +4.828737630995923e-01   -5.920344042448735e-01   +1.665563216779259e-01; +3.728264928011312e-01   -4.159929178927599e-01   -3.232816310546419e-02   -3.641342077900133e-01   -1.101015910267239e-02   -2.794022760423665e-02   +4.278178977873719e-01   +6.342692109935590e-01   -1.150628077169054e-01   -4.380637483662640e-02   +1.251414411577996e-01   +4.258381014711988e-01; -5.069741676138438e-01   +5.845564111912384e-01   -1.150158475871330e-01   -5.383057239175388e-01   -3.410907765160045e-01   +8.887539880354046e-02   +2.201178526228081e-01   +3.057297661362738e-01   +2.896869800402245e-01   -9.043452186040336e-03   +2.408203516940084e-01   -2.113074707158904e-01; +5.956020892558421e-01   -1.481519511920026e-01   +1.541944246010395e-01   -1.420432925752091e-01   -2.125287841679571e-01   -7.247594476018308e-01   -3.331403634710483e-01   -4.234177062692857e-03   -2.772515481578960e-02   -2.979002745633078e-01   +5.024188804663119e-01   -6.195716859899725e-02; +6.179208889235183e-02   -3.809087871107403e-01   +4.920331594781726e-01   -3.133589480467617e-01   -1.093517519742159e-01   -2.597213994279648e-01   +2.029143326615084e-01   +1.385347899246040e-01   +5.523832598840626e-01   +2.546698253223308e-01   -5.089081298248030e-01   +6.472177418052536e-01; +2.893685485000411e-01   -1.627835989429464e-01   -4.905060591420416e-01   +3.389357387358349e-03   +5.827514533664675e-01   +4.949235564309869e-01   +3.217600213974226e-01   +7.289237380714803e-02   +4.045639453242253e-01   -2.477765810370433e-01   +4.990281224551581e-01   +6.316230178279768e-01];
L2E_Input1_iAMPA_netcon = [+3.083212192139059e-01   +4.048627921783197e-02   +3.475944673766845e-01   +7.507554594765389e-01   +2.982213906916714e-02   -4.178916947145558e-01   +6.045165624111984e-01   +4.152081255412010e-01];
L2I_Input2_iAMPA_netcon = [+1.201072959807728e-02   +5.228582266676521e-01   +7.541134165131311e-01   +3.790265909461917e-01   -7.183030839389262e-02   -3.350203527096784e-01   +6.740685553374669e-01   -2.066593885299166e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
