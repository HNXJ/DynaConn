function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.408230977235148e-01   -7.596941289805328e-02   +2.968531196628711e-01   +1.884677557228740e-01   +1.960644144259235e-01   +7.090393961967743e-02   +2.889621089013993e-01   +2.256655311751678e-01   +1.994121070763950e-01   +1.987459743542344e-01   +2.915762572877673e-01   +5.424185255739278e-02   +2.622785561858279e-01   +2.139579022836354e-01   +1.541787059744382e-01   +3.005321078348798e-01; +2.680327384016729e-01   +7.602169150627651e-02   +3.291145362126194e-01   +1.174722094507758e-01   +2.726499375129636e-01   +1.322339112918109e-01   +3.263123516303604e-02   +1.002204027798580e-01   +2.752040002950536e-01   +1.061551111428382e-01   +2.071491182728374e-01   +3.902504535566305e-01   +1.536105614428557e-01   +2.346920854912289e-01   +4.236757788776485e-01   +3.622985070318016e-01; +3.696101994619865e-01   +7.366716112068511e-02   +2.573560175911728e-01   +2.702681998770637e-02   +2.404760711306101e-01   +4.069224707166517e-02   +1.063811268333743e-01   +3.859659675508115e-01   +8.476713127368579e-02   +1.472815878123410e-01   +3.219357432921277e-01   +1.028378342101665e-01   +1.879363825027602e-01   +2.617876913017372e-01   +2.249063497469097e-01   +1.656613504896772e-01; +2.598843775516482e-01   +3.506728674463307e-01   +2.611178822402611e-01   +2.115904973794105e-01   +4.203242097520510e-02   +3.074781297149180e-01   +4.675905890783951e-01   +1.260369969327164e-01   +1.045327648437934e-01   +6.555435173555080e-02   +1.629233886429574e-01   +2.688509849675402e-02   +1.505420852817367e-01   +2.831389952194956e-02   +2.940165687978609e-01   +1.881179475755931e-01; +3.638915369305604e-01   +1.930094573157109e-03   +4.284250695731568e-01   +9.939941577256119e-03   +1.230582515128034e-01   +3.225537917845323e-01   +2.537556402486216e-01   +3.257918427937553e-01   +3.096303236457969e-01   +3.092974127590639e-01   +3.680005104261498e-01   +1.248349715657685e-01   +2.351810518195157e-01   +3.316766098964875e-01   +5.520354361845320e-02   +3.140045459339458e-01; +3.035962772528928e-01   +1.837011496677717e-01   +2.158202266847748e-01   +9.585458558501245e-02   +1.879634791261577e-01   +2.749226105271059e-01   +3.665533616873518e-01   -9.206060044727689e-03   +3.113993957932752e-01   +3.658492002716693e-01   +2.917417108157810e-01   -4.854205305656656e-02   +2.945199679458399e-01   +2.218381239806778e-01   +2.280173659831892e-01   -4.272646445751309e-02; +3.135549738036995e-01   +8.258345849171383e-02   +8.260047002729280e-02   +1.155344800736958e-02   +2.459120061502853e-01   +7.143886765283061e-03   +3.607617343731801e-01   +3.388781432226431e-01   +9.312390070619779e-02   -1.936055414501915e-02   +3.264562398894221e-01   -1.028796949302267e-02   +2.654427236124002e-01   +3.977154242259524e-01   +1.919591431682640e-01   +1.033856226401622e-01; +2.824622344797527e-01   +7.214860394969304e-02   +3.062556441303826e-01   +2.931857403948456e-01   +3.464113900257582e-01   +2.492038983340322e-01   +2.949875288359239e-01   +1.424063686661756e-01   +1.185934516027171e-01   +1.519241860359918e-01   +2.081523683554571e-01   +2.060561927500352e-01   +1.488467388335311e-01   +2.062351529377141e-01   +2.475134504527841e-01   +1.070403326303716e-01; +6.476239946273378e-03   +2.026137507313064e-01   +9.748766684101876e-02   +4.151340741051460e-03   +2.999313999262743e-01   +1.308142475994696e-02   +2.090931505896589e-01   +3.311084333031954e-01   +2.334823937829448e-01   +1.540797191247342e-01   +9.841695222381909e-03   +2.392745562892309e-01   +7.173507094655623e-02   +4.922000012771541e-02   -5.500902363737736e-03   +3.171476818620297e-01; +9.756093124412210e-02   +2.595261601392603e-01   +3.945588941723859e-02   +2.709554339047615e-01   +1.486217083881598e-01   +3.308692289545734e-01   +2.741377655107700e-01   +5.476795831537216e-02   +2.925262416321903e-02   +8.563681770371172e-02   +3.164130492537792e-01   +8.077035405404008e-02   +1.544092136665811e-01   +2.072723296397775e-01   -1.751685862598566e-02   +2.682523514180543e-01; -7.774521942134534e-02   +1.363421404145016e-01   +3.515583971149934e-01   +1.736266110244155e-01   +1.907427682394511e-01   +1.917562587786859e-02   +3.067093909933463e-01   +2.878584425916759e-02   -3.285844532891177e-03   -4.181642435749007e-02   +2.122301191400617e-02   +2.513898216425716e-01   +2.107856003094812e-01   +3.264161518334810e-01   +2.573987624444543e-01   -1.252589159882179e-02; +2.016033049297751e-01   +3.110390284452833e-01   +3.676584141438277e-01   +3.803155830490094e-01   +3.156724537696586e-01   -8.189150050152352e-02   +3.241644734076192e-02   +3.621023729140659e-01   +3.681139386475972e-01   +8.243559297830326e-02   +4.362959771041578e-02   +3.527837681573849e-01   +3.108572227770020e-01   +2.846556109709311e-01   +1.238843719094863e-01   +3.751290445294287e-01; +3.103548030623399e-01   +1.873465283553352e-01   +2.868878901611239e-01   +2.886533491074162e-01   +1.777513693697558e-01   +1.964362429933884e-01   +1.343833786014267e-01   +1.121857552927964e-01   +3.930836458355465e-02   +2.321418817012765e-01   +3.620076481915950e-01   +2.289112708576556e-01   +1.042436817986555e-01   +9.043663901712848e-02   +3.349334424155257e-01   +2.620799844609208e-01; +1.408581044750895e-02   -5.915316490908944e-02   +2.438336698867254e-01   +1.419714648403570e-01   +2.489190903477646e-01   +6.214146958590527e-02   +5.933137878448879e-02   +2.743443388572526e-01   +3.381242049499738e-01   +3.326766094292688e-01   +3.368007615643746e-01   +1.818657724606487e-01   +2.269839083463555e-01   +2.597216602315248e-02   +3.136295151996876e-01   +6.636053493395225e-02; +4.195851871877374e-01   +3.616560332336178e-01   +2.610304981863573e-01   +6.868447983945498e-02   +1.043904636112367e-01   +3.319263901518481e-01   +5.452578834806185e-02   +3.344531310205367e-01   +2.574738499722949e-01   +2.929711416154834e-01   +1.568451565598588e-01   +4.910621762491908e-01   +6.696320314499976e-02   +2.246518379952731e-01   +8.678901275081434e-02   +3.766562480814105e-01; -6.046449302171034e-03   +2.023028806340468e-01   +3.511940625868762e-01   +2.023185812592934e-01   +3.122355489742838e-01   +8.211956716684690e-02   +1.881691288473986e-01   +1.004466243772485e-01   +1.363115036755215e-02   +8.333909618848691e-02   -5.654915231111236e-02   +3.345884616384887e-01   +2.646621241478639e-01   -3.209791870894359e-02   +3.471131966082250e-01   +1.044984038646163e-01];
L1E_L1I_iGABA_netcon = [+1.388266635270936e-01   +3.617222413251578e-01   +2.579479320711932e-01   +1.151378971979028e-01   +1.759145428922892e-01   +2.064677681555686e-01   +1.184105712971927e-01   +2.282732043753638e-01   +4.203445661723494e-01   +4.195562494916142e-01   +3.054766891975477e-01   +1.480212819276449e-01   +2.822407933880299e-01   +4.309838596807439e-02   +5.356264998860900e-02   -8.500630633705458e-03; -5.570874835279287e-02   +1.023120490861107e-01   +2.053199527214823e-01   +3.997438019025653e-01   +1.106275794785842e-01   +3.023387119045960e-01   +1.056167751901487e-01   +2.193040486241593e-01   +1.772653821292235e-02   +2.898508538723342e-01   +4.022960889799407e-01   -6.931021313294149e-02   +4.219640898618009e-01   +2.911323104364222e-01   +2.237336410388000e-02   +2.699001014601291e-01; +1.928387294808262e-01   +2.308369898781132e-01   +1.304365072566870e-01   +2.455942123809753e-01   +2.283948142009760e-01   +3.724533056161894e-01   +2.455654267802167e-01   +3.048396813524906e-01   +1.257184296012984e-01   +1.491147432371395e-01   +4.277865558143561e-01   +2.332663265491536e-01   +1.046104346143073e-01   +2.982252941877936e-01   +1.918490078587520e-01   +3.615654774178798e-01; +2.967414792536162e-01   +1.241109944293080e-01   +3.601694169975718e-01   +3.808774332151897e-01   +2.087593703008584e-01   +3.936653906734634e-01   +3.145980044098968e-01   +4.638655056340661e-01   +4.070607588783510e-02   +3.645195426062542e-01   +2.892309277289114e-01   +9.178086026766108e-02   +1.828203067131144e-01   +1.643465534498487e-01   +2.264809728281940e-01   +1.832623164256304e-01; +3.319636129642911e-01   +2.647435074399215e-01   +1.224138830991236e-01   +1.506578511668777e-01   +1.899189415530093e-02   +2.481796918055112e-01   +2.856767254589019e-01   +1.144146175914525e-01   +3.578595351027467e-01   +1.070407979936502e-01   +1.359376769162646e-01   -4.264050213929577e-02   +3.456092547307509e-01   +4.239041190490644e-01   +1.104970493545809e-01   -3.491741688767153e-02; +1.872026921374948e-01   +1.116478787759882e-01   -2.806904686856281e-02   +3.026045387331224e-01   +1.731110581395860e-01   +2.357164779313746e-01   +3.090381926122178e-01   +3.905722493774292e-01   +2.077891931215975e-01   +3.333687073974567e-01   +2.851785402898779e-01   +1.018684752841587e-01   +2.958691631954734e-01   +1.491101513841797e-01   +3.088866103973874e-01   +1.461244935456468e-01; -7.328667961795260e-02   +2.585704499349168e-01   +1.251742904548728e-01   +9.537527930651551e-02   +2.342730780328017e-01   +3.068364830822159e-01   +2.612789535319568e-02   +4.053694904937978e-01   +2.499987234952178e-01   +4.260054837368721e-01   -3.521209200812228e-02   +4.032925713261486e-01   +9.613808259312032e-03   +9.089359275788630e-02   +1.922968839521899e-01   +1.996840968555929e-01; +3.466204372317701e-01   +2.112302055876030e-01   -1.342563125464680e-02   +2.978891735714279e-02   +1.620088981660742e-02   +1.309625291053173e-01   +2.779252743473682e-01   +1.376949286789985e-01   +1.780426462205559e-01   +1.301721381412897e-02   +3.982577804319539e-01   +3.160845088623390e-01   +2.341419907830674e-01   +1.764372820939097e-01   +1.465784855943215e-01   +9.798524054995716e-02; +8.558117686370527e-02   +2.941589201641672e-01   +1.312965075750512e-01   +2.973774613221480e-01   +2.362755319230645e-01   +2.505047965877958e-01   +7.670986452851505e-02   +3.386469224449182e-01   +1.199795835599188e-01   +4.123997734720037e-01   +2.957326597026179e-01   +1.797374882638003e-01   +1.341880102216718e-01   +2.837939686586927e-01   +2.676949226900441e-01   +3.315363249757761e-01; +5.191217779007383e-02   +4.144846523253576e-01   +2.502844487682352e-01   +1.262006453969947e-01   +3.838010892795248e-01   +2.179042895930221e-01   +1.997624753736103e-01   +1.253336605989954e-01   +3.196009295502564e-01   +3.745576416161407e-01   +1.745584925862031e-01   +1.373197764837811e-02   -4.623027411190094e-03   +2.159440500815585e-01   +1.595840920796171e-01   +2.800743238202005e-01; +3.769944274966897e-01   +8.485171384792961e-02   +3.637941463733417e-01   +3.805175243787099e-01   +2.389476473601792e-01   +5.172617389939652e-02   +4.325416897896397e-01   +2.540133838657126e-01   +4.006520478513786e-01   +4.086597841496356e-01   +1.976829697386028e-01   +2.087555424322875e-01   +2.418319413945813e-01   +2.416852654382557e-01   +2.602752937263907e-01   +2.263937215113949e-01; +1.409516422874924e-01   +1.068348919375014e-01   +6.574620715639662e-02   +2.454005515452521e-01   +1.792284945853962e-01   +1.122023799982809e-01   +2.366574304232600e-01   +2.852863887698666e-01   +2.240749619555444e-01   +1.700390902378108e-01   +3.629028852424305e-01   +3.093867889724173e-01   +1.394207477709599e-01   +3.215864797449756e-01   +3.516182947822594e-01   +7.570806006391648e-02; +4.031347306199043e-02   +1.043702667214159e-01   +1.384813216773219e-01   +3.227544525561462e-01   +6.086270547515953e-02   +1.244147319187036e-01   +2.488156002093906e-01   +8.163269854100511e-02   +2.265668734383529e-01   +2.206960504735625e-01   +7.906564369820034e-03   +2.183835345782130e-01   +1.148679123702082e-01   +1.789703745756146e-01   +1.993300567614309e-01   +3.824901063919504e-01; +1.460032349205505e-01   +3.449014271447461e-01   +2.349580593584653e-01   +3.074612885054787e-01   +2.837174417810685e-01   +1.425619176956144e-01   +1.803261520212805e-01   +2.745394005838029e-01   +1.229860400226960e-01   +4.076106973039004e-01   -1.788538748075797e-02   +2.917997703174525e-01   +1.926582736938063e-01   +3.994307496763660e-01   +3.412386912414526e-01   +2.986513966942120e-01; +2.677716762468142e-01   +3.207295070792832e-01   +1.603971435729239e-01   +6.103434645015493e-02   +2.460942563668598e-01   +3.258600889104984e-01   +2.904603091375502e-01   +2.930093162541195e-01   +2.273807068277001e-01   +3.756062749955734e-01   +4.108634478935440e-01   +1.480506795802944e-01   +1.466646975238073e-01   +2.285380790159645e-02   +1.408022086417551e-01   +3.399003028267931e-01; +3.520835453222115e-01   +2.090142026815273e-02   -7.181411506775591e-02   +9.550958819299857e-02   -2.502252945541758e-02   +3.682567421868252e-01   +1.668439838582825e-01   +3.801399477732742e-01   +2.807627835022202e-01   +1.614425161283022e-01   +3.301263226564997e-01   +1.578002537579404e-02   +1.506594281771665e-01   +1.381607381663662e-01   +1.991817311551141e-01   +8.773185522611886e-02];
L2I_L1I_iGABA_netcon = [+2.362619138988309e-01   +4.191241347760593e-01   +1.156039461745823e-01   +3.272665749355670e-01   +2.353258466280450e-01   +3.333258175615376e-01   +2.898716974911775e-01   +9.278253926473745e-02; -3.407588053737455e-02   +2.833382766016318e-01   +3.691605811435724e-01   +3.079567552812733e-01   +2.402005577175859e-01   +9.019170440806358e-02   +1.284414579138146e-01   -4.327000567654497e-03; +2.464058387093151e-01   +3.791247476228495e-01   +2.503821337332439e-01   +1.831623681155465e-01   +3.452504421858831e-01   +3.809741304241271e-01   +2.556024396038772e-01   +2.302506568744764e-01; +5.366601958378471e-02   +7.300820578298456e-02   +4.432490315802822e-01   +3.598296819711939e-01   +2.280592186147364e-01   +4.227061133735965e-02   +1.835469414475258e-01   +1.758595553556971e-01; +3.891890699073397e-02   +8.710291950910054e-02   +2.480717259396890e-01   +4.605674294707872e-01   +3.319315757102694e-01   +1.948302614564036e-01   +3.477100098054397e-01   -1.263573191466597e-02; +2.069778881727432e-01   +3.049037976827372e-01   +7.737962115494559e-02   -1.027334208611934e-02   +3.587426392439009e-01   +1.558803176970399e-01   +2.251106040462471e-01   +3.908088302672721e-02; +1.788519490096849e-01   +9.391414656512470e-02   +3.774904537011183e-01   +2.352328846439833e-01   +1.921272388408434e-01   +2.757696881584578e-01   +2.251730060336471e-01   -1.654421623749174e-02; +8.008084464697890e-02   +3.277482840160770e-01   +1.541094824573506e-01   +2.146469406392311e-01   +2.083475001877735e-01   +3.702229991637951e-01   +2.782578629000809e-02   +1.318142752289077e-01; +2.146920439424325e-01   +6.221397636958467e-02   +3.469862629103642e-01   +2.766902133602449e-02   +1.849404730059860e-01   +3.772984770072112e-02   +3.164857515637349e-01   +1.116923035333110e-01; +1.551801739849435e-01   +7.755353642948149e-03   +1.777160129005354e-01   +3.654145212964094e-01   +3.144115101509289e-02   -4.535364161263947e-04   +2.176863687624966e-01   +8.397919640546327e-02; +6.926182609801787e-02   +4.337106096049140e-02   +2.523367060885159e-01   +5.463031730479773e-02   +8.829441713316237e-02   +4.369248882104653e-01   +5.530089996884577e-04   +2.445672596244477e-01; +1.870536518772934e-01   +3.652810005833336e-01   +4.126586741061883e-01   +1.303715766912225e-01   -5.817649825383123e-02   +4.863671492872574e-01   +6.253331022074526e-02   +2.218079796255950e-01; +2.768227167903146e-01   +1.338793310145943e-01   +1.203112294810842e-01   +1.766039041944338e-01   +2.933870790481887e-02   +3.104429734271631e-01   +2.709826097189331e-02   +1.063733230099642e-01; +1.300245450035406e-01   +1.025505960303757e-01   +2.932298881942998e-01   +3.684604565854721e-01   +3.762309867762747e-01   +2.200856041784287e-01   +1.586770525981291e-01   -3.545642518134252e-02; +1.714638608961891e-01   +2.937140250910817e-01   +4.813464553350518e-01   +1.779842421295369e-01   +2.720737566291477e-01   +2.252762016790251e-02   +8.816780077935411e-02   +3.995394670391939e-01; +4.349051564716260e-01   +2.840271685363257e-01   +4.588585039606488e-01   +3.211671234090329e-01   +6.699637743067804e-02   +4.172149981059315e-01   +2.947511917764233e-01   +2.008368265705325e-01];
L1I_L2I_iGABA_netcon = [+2.465604687518055e-01   +3.469682147060985e-01   -3.669542171698569e-02   -1.557383465647304e-02   -6.201514787993238e-03   +6.249824333906329e-02   -4.065380295632032e-02   +9.651606555851650e-02   +8.775342536293049e-02   +2.826075154484508e-01   +3.257409027245405e-01   +9.097028199568945e-02   +2.069424579321276e-01   +1.926992707279646e-01   +2.907571412488476e-01   +4.731984498950941e-01; +1.548824202050363e-01   -2.166485919715284e-02   +3.741498330918196e-01   +1.700691984852334e-01   +2.802710419464318e-01   +7.188611061878822e-02   +3.653256959347450e-01   +4.182804510647551e-01   +1.819742984632645e-01   +1.240653227008739e-01   +4.660628837858210e-01   +2.542465804369000e-01   +7.015919860886059e-03   +1.585452448234413e-01   +3.664005996637607e-01   +1.621718751945658e-01; +4.311081427830886e-01   +2.023680285200320e-01   +1.147687793221008e-01   +3.405856983250002e-01   +1.528494100446436e-01   +1.771119721352385e-01   +3.514463831435578e-01   +1.959275816484497e-01   +2.328052929398824e-01   +3.113103088687845e-01   -4.416684868490056e-02   +3.276943858800981e-01   +3.522492714368125e-01   +3.584511449041449e-01   +8.790206215086897e-02   +2.188560698460468e-01; +8.829666607660072e-02   +6.242388768758294e-02   +5.823606215586354e-02   +1.930443116551747e-01   +1.047436268780997e-01   +1.488675023755749e-01   +3.057771506487950e-01   +2.821173668057315e-01   +9.554881901978134e-02   +2.562342006275366e-01   +3.423926987538862e-01   +2.407472588542077e-01   +4.355784710870231e-02   +3.509504863700389e-01   +2.181936757064377e-01   +3.658648856306527e-01; +4.146449527632736e-01   +3.791250363818563e-02   +2.148004177184037e-01   +5.495329871305066e-02   +3.136463809797064e-01   -3.296767522941158e-02   +2.318324487312007e-01   +2.513366392038048e-01   +2.543453357067822e-01   +4.613261104133933e-03   +3.453351288798396e-01   +3.427686868798126e-01   +4.235283492869559e-02   +1.152190544433975e-01   +1.639717132122555e-01   +1.123784136411415e-01; +2.552335074804980e-01   +1.832827065255732e-01   -4.332327656414701e-02   +3.262026632228669e-01   +3.340052754075642e-01   +2.813358782946674e-01   +2.774343692771881e-01   +1.674128133647213e-02   +9.010017068778713e-02   +8.284715821616973e-02   +1.752605818746577e-01   +3.011248937889253e-01   +2.586933783098508e-02   +3.554416349684686e-01   +1.864895395789029e-01   +1.316459623384456e-01; +1.291462087798616e-02   +3.978139579119140e-01   +6.601007586413518e-02   +3.256540345416573e-01   +1.340638890276808e-01   +4.928761053170885e-01   +3.233989795165035e-01   +1.877661563361373e-01   +2.088062010262213e-01   +3.874616135164466e-01   +2.038817318417483e-01   +2.153129058231346e-02   +9.655759014808284e-02   +3.796435518389506e-01   +1.854412043750094e-01   +4.662485080036800e-01; +3.815056722885853e-01   +6.620493842538633e-02   +1.724370506037161e-01   +1.201611665666481e-01   +1.192585517308745e-01   +3.188655612702764e-01   +5.742827888529493e-02   +2.427981106086410e-01   +1.980585245684132e-01   +1.234973960298241e-01   +6.674490242329183e-02   +1.899471293662314e-01   +2.467599683461428e-01   +3.289987622349176e-02   +5.355167991467245e-02   +1.294588351173360e-01];
L2E_L1E_iAMPA_netcon = [+1.423130623826877e-01   +2.110922584674814e-01   +8.456987775610780e-02   +2.542436329989701e-01   +4.044725048650342e-01   +2.015239693390846e-01   +1.515115564685768e-01   +2.438834639966154e-01; +4.233809411312645e-01   +3.539106936866410e-01   +1.522277722190798e-01   +4.085893684224385e-01   +3.700858140046772e-01   +2.528887959037879e-01   +3.848895066819907e-02   +2.080722747701774e-01; +2.483170056586781e-01   +3.441846914521998e-01   +2.989040177038412e-01   +3.680025004083851e-01   +3.649095452664203e-01   +1.066126258277513e-01   +3.075022823778384e-01   +7.499454978653526e-02; +5.331947675974532e-02   +6.002197438171075e-02   +3.480301774139302e-01   +2.972617382433585e-01   +5.763205810002709e-02   +1.279381054121470e-01   +1.786397851621233e-01   +2.419391969073343e-01; +1.600268743023310e-01   +2.391784282292544e-03   +3.484322299838815e-01   +3.361651765978260e-01   +4.069129673648053e-01   +3.042643219173074e-01   +3.441591714894659e-01   +2.634292691548024e-01; +3.457126184440221e-02   +4.728677315961444e-01   +1.892290675991014e-02   +1.926648887097251e-01   +3.685352180976000e-01   +3.174385255873487e-01   -2.002664056248178e-02   +3.289602347703088e-01; +3.955736467394169e-01   +3.117812565253959e-01   +3.336865304335830e-01   +2.466594974353884e-01   +3.473106461199479e-01   +1.891913492091178e-01   +2.364146476284564e-01   +4.273907841884377e-01; +3.832927957510934e-01   +9.893526557862774e-02   +1.614201766188378e-01   +2.675589721685416e-01   +2.660609280864217e-01   +5.743048679459159e-02   +2.962983489914195e-01   +2.449817825647723e-01; -2.436337532359976e-02   +1.646586081289742e-01   +2.382847656302913e-01   +1.372181093649223e-01   +3.436605435024774e-01   -4.086883342348469e-02   -1.360752035839448e-02   +1.950504509102900e-01; +6.302831470378577e-02   +1.491246861124461e-01   +2.160452380919723e-01   +4.151736765308747e-01   +1.337573545366018e-01   +2.507932999783700e-01   +2.568061192911020e-01   +2.178477935085001e-01; +2.860875137354252e-01   -4.342018008753216e-02   +1.723608004598753e-01   +3.736871923757489e-01   +2.300460893127203e-01   +1.669427915170152e-01   +8.870693564685658e-02   +3.769398639137066e-01; +1.354201402817323e-02   +2.101112323758795e-01   +2.987231311718358e-02   +1.673456924799493e-01   +2.838805860381891e-01   +3.205373869483318e-01   +1.289720238236548e-01   +6.653646028858626e-02; +3.365608937318389e-01   +1.607176324497006e-01   +1.607833243078762e-01   +4.366148718133690e-01   +1.514157116142019e-01   +2.717609576885404e-01   +9.519314918278932e-02   +1.635900022919396e-01; +3.192011154089212e-01   +1.584285371013135e-01   +2.072174477120377e-01   +3.129300545039821e-01   +2.180770318237240e-01   -2.088044014354487e-03   +1.881225485857084e-01   +1.080847413290366e-01; +1.482558932743491e-01   +1.327634652035764e-01   +1.122503309938839e-01   -4.315126658284236e-02   +6.770705797645153e-02   -1.778030172767314e-02   +3.733118055979943e-01   +1.661382968850237e-01; +3.306113585742096e-01   +3.505188584892153e-01   +4.062589520103048e-01   +2.641642035715189e-01   -2.193347424941926e-02   +1.272572666812651e-01   +1.786937459305555e-01   +4.601254028048142e-01];
L1E_L2E_iAMPA_netcon = [+3.841293990747073e-01   +2.413021242722771e-01   +2.131536857033655e-01   +1.685984779195682e-01   +1.210273368426364e-01   +2.270746015409610e-01   +7.022516747467532e-02   +2.342145378326824e-01   +2.009220192438436e-01   +3.935437462832193e-01   +4.735014753091519e-01   +2.894074413332530e-01   +8.392003505887777e-02   +4.207209790915786e-02   +9.319729532787677e-02   +4.027449662678135e-01; +3.553422518399632e-01   +3.023031647750496e-01   +4.002419821930149e-01   +7.950862251574040e-02   +2.769068869697371e-01   -3.122483227747288e-02   +5.378281551816968e-02   +2.357110804030679e-01   +9.745795901881098e-02   +2.727767621468805e-01   +3.476398298573402e-01   +2.120573153324134e-01   +3.236649442225793e-01   +3.488587217536202e-01   +3.819427834983696e-01   +7.238997508845237e-02; +3.461366136624123e-01   +3.632963184233905e-01   +1.034183458029476e-01   +1.136068568148839e-01   +4.333747995644474e-01   +1.740863658295805e-01   -4.119414159120470e-02   +2.843428345905881e-01   +5.426121027770937e-03   +1.359835175121324e-02   -2.385758955138581e-02   +3.829900344086123e-01   +3.001880695703928e-01   +1.370558139321281e-01   +3.354597027647529e-01   +5.890317278397020e-02; +1.371635240372292e-01   +2.446186259533175e-01   +6.269376618313877e-02   +3.946069006001326e-01   +1.979371176211153e-01   +3.171396180603253e-01   +2.635929907537389e-01   +3.664168332809332e-01   +3.824425762538162e-01   +5.654486797971631e-02   +2.623698527068197e-01   +9.918053887548074e-02   +5.191068064828949e-02   +1.213018711960849e-01   +4.373475555419252e-01   +3.737357640552981e-01; +3.813614192988252e-01   +3.972583863393641e-01   +3.353560596960517e-01   +3.175304856321731e-01   +1.670159703827011e-01   +1.566732064526852e-01   +1.339150311033998e-01   +8.252882459214667e-02   +1.331777911770239e-01   +2.425726227410953e-01   +2.453224899520226e-01   +1.885937095359500e-01   +1.568450807375534e-01   +1.835333731284750e-01   +3.692291687044594e-01   +2.808715745114154e-02; +2.111508005740620e-01   +3.180156213465922e-01   +4.134350695081349e-01   +2.981471628714809e-01   -1.848068452562554e-02   +3.903012360501559e-02   -5.384574017822340e-03   +8.504819418662635e-02   +9.005266680833153e-02   +7.836697398911019e-02   +9.941135230798710e-02   +5.955584890724316e-02   +4.081010351206366e-01   +3.297325285396127e-01   +3.236826709975190e-01   +2.069132620772266e-01; +2.472527084576586e-01   +5.148035770050696e-02   +1.361140310188826e-01   +6.089982830993589e-02   +4.483568602524540e-01   +4.511819889934450e-01   +3.123564904786478e-01   +3.622960449465129e-01   +1.473135548062773e-01   +1.989553396034784e-01   +2.265379464254089e-01   +2.975241224481119e-02   +3.332443288088941e-02   +1.667775366548382e-01   +1.814305778524340e-01   +1.484186956140420e-01; +2.832440723852290e-01   +1.674062390301798e-01   +2.503743712599172e-01   +2.565509477455245e-01   +3.062256926761867e-01   +4.456390573391495e-01   +8.487897869160697e-02   +9.350235562830109e-02   +3.859251225194626e-01   -2.241500971187052e-02   +7.696651530117513e-02   +3.545808222162832e-01   +3.134982399939511e-02   +3.151196405888812e-01   +2.049355291552351e-01   +1.992265787501799e-01];
L2I_L2E_iAMPA_netcon = [+3.251598655599847e-01   +2.517913788185226e-01   +3.892061504792810e-01   +2.446211188305659e-01   +1.477314892298656e-01   +3.085132342641100e-02   +7.374729870182151e-02   +1.893364842140303e-01; +3.464018214993165e-01   +1.865747211212494e-01   +3.408115640118311e-01   +4.535147559465877e-02   +1.888153845890784e-01   +4.185816091289356e-01   +1.986587242047365e-01   +6.836619979177899e-02; +3.488478887119363e-01   +1.727150311683565e-01   +2.373452277077467e-01   +4.275013370663459e-02   +2.961338934477864e-01   +8.303649363197739e-02   +2.826833383218144e-02   -3.558310781529688e-02; -3.469266868502031e-02   +1.849318882440692e-01   +6.032555470603906e-02   +3.866968206843621e-01   +2.603212971826574e-01   +2.969338432857435e-01   +2.178433786023163e-01   +8.388279741514626e-02; +1.368660808199481e-01   +2.390976051356447e-01   +3.048370384463429e-01   +4.390385856334735e-01   +1.652300974174509e-01   +6.653358678598943e-02   +3.223829862825637e-01   +2.873586673545842e-01; +6.092999231409751e-02   +2.377920386108468e-01   +1.162563665895260e-01   +1.550205314318116e-01   +1.596720875430172e-01   +2.112241921576974e-01   +1.698704804983759e-01   +3.036978778135494e-01; +4.234474534799267e-01   +1.016780098925453e-01   -1.719633899862471e-02   +2.160732573802424e-01   +8.618994693704514e-02   +4.279214611599449e-02   +2.623381736559178e-01   +8.951756547319531e-02; +1.444921532151585e-01   +2.656573373902115e-01   +3.812983633636105e-01   +2.818206916277392e-01   +6.570917655415098e-02   +4.172232288423315e-02   +1.925489885333629e-01   +3.785122729893876e-01];
L2E_L2I_iGABA_netcon = [+4.661512624028575e-01   +2.385656758193618e-01   +3.066974204253791e-01   +8.262073928224403e-02   +1.395307943264238e-01   +4.554241703013910e-01   +2.031840358836507e-01   -3.766452836428705e-02; +1.221782157638321e-01   +4.058086372663325e-01   -5.575888170611530e-02   +2.046096058232786e-01   +3.113925644403170e-01   -2.167986353907713e-02   +2.543505785416700e-01   +5.311433712873805e-02; +2.864470864100736e-01   +9.751506139392874e-02   -1.646007398759538e-02   +4.263785860212392e-01   +8.218789464784920e-02   +2.158988315141226e-01   +3.903513046510735e-01   +7.960642912266089e-02; +3.349062842771616e-01   +3.262600516042004e-01   +2.764871439277817e-01   +2.812018152385244e-02   +2.202711907018678e-02   +1.985531114167275e-01   +3.495520485826050e-01   +2.338651590387702e-01; +2.063312443714683e-01   -1.970507725319276e-02   +2.748570752702800e-01   +1.586788482133360e-01   +1.673028108827208e-01   +4.553834535691338e-01   +6.591349458986491e-02   +1.977154535724139e-01; +2.233549838536182e-01   +1.767770990360138e-01   +1.525506033970629e-01   +2.011893473464985e-01   +6.986810516662921e-02   +4.320896037956589e-01   +1.392496546909182e-01   +2.302649007709699e-01; +3.024984577720974e-01   +3.366935083440369e-01   -9.528165235036225e-03   +5.107401183685026e-02   +1.971356282813511e-01   +3.744821418397321e-01   +1.194137229832394e-01   +2.925459695305067e-01; +8.995514152214532e-02   +2.682542746869330e-01   +6.957095432771519e-02   +1.250755591978990e-01   +5.488352624486027e-02   +3.467228730669597e-01   +1.419567065262715e-01   +2.146423319705011e-01];
L3E_L2E_iAMPA_netcon = [+2.788299977466063e-01   +4.348798715988003e-02   -2.191882028394961e-02   +4.197822520909705e-01   +3.509659005300542e-01   +3.563013112776555e-01   +2.676504529533977e-01   +1.074495598238162e-01   +4.292105672868232e-01   +1.170696409145810e-01   +4.076722667528555e-01   +6.465879569911803e-02; +1.561546258225920e-01   +3.903442553851149e-01   +3.415866842027942e-01   +2.425036108122366e-01   +1.478364773727294e-01   +3.622424474866558e-02   +3.535826381992375e-01   +1.120452397123813e-02   +4.676090645569351e-02   +3.411882646379595e-01   +2.066790140106867e-01   +6.312342695242210e-03; +1.734650895969501e-01   +2.309210781147714e-01   +2.118068483726537e-01   +5.521034100194154e-02   +1.918426442621247e-01   +3.337121578965533e-01   +1.136523353694237e-01   +1.365266830721718e-01   +2.322043778235879e-01   +3.143433577018397e-01   +3.350559469684431e-01   +4.302172792388638e-02; +1.397205126510335e-01   +1.345884412390917e-01   +4.188417495146210e-01   +6.431403596358025e-02   +1.524712081753887e-01   +1.794727433323018e-01   +3.731738024163451e-01   +6.469540080249042e-02   +8.964164776468392e-02   +3.706229483057965e-01   +1.841250073945770e-01   +1.142107194926713e-01; +4.638689104807003e-02   +3.607606020948306e-01   -3.195438439293807e-02   +3.423852283528843e-01   +3.165204842847339e-01   +2.369507549823343e-01   +4.130322012457385e-01   +4.723837352886167e-01   +1.151567046519325e-01   -2.192785691601402e-02   +3.172771616729324e-01   +2.141318569140111e-01; +2.079674630438750e-01   +2.435451965539483e-01   +1.910058617456056e-02   +2.996218498410151e-01   +2.555348182366146e-02   +2.398633795582702e-01   +2.903268905545515e-01   +3.133650094355754e-01   +3.520673914978172e-01   +2.948702893509442e-01   +9.099415167572492e-02   +1.636086904396820e-01; +3.752845337653157e-01   +2.762230652986186e-01   +3.934771822857679e-01   +8.483911589461951e-02   +3.501024298952258e-01   +2.704770649290233e-01   +3.546977405108493e-01   +3.913165807523949e-01   -3.226473419843112e-04   +3.297172536156276e-01   +2.896633222759449e-01   +1.894167424338637e-01; +2.290643646906858e-01   +6.389007704907546e-02   +1.775697286985581e-01   +1.292711934189121e-01   +2.053454294942093e-01   +6.743211216056952e-02   +2.229699403327785e-01   +2.412195037483236e-01   +2.755711240581516e-01   +3.725281067353035e-02   +3.148287365855797e-01   +2.886661286956423e-01];
L3I_L2I_iGABA_netcon = [+6.387891835143857e-02   +2.174462659296957e-01   -3.218083005104789e-02   +4.706633423350181e-01   +1.626096518173116e-01   +3.349991338238864e-02   +3.669880248708762e-01   +2.542971875749058e-01   +1.379887658618639e-01   +1.313730181703114e-02   +2.491436757044969e-01   +2.324517857807475e-01; +1.381309045922214e-01   +3.557723796504150e-01   +4.105529391680038e-01   +4.138482944406079e-01   +2.357543261036880e-01   +2.447257034810778e-01   +2.074926484152224e-01   +3.005623140295796e-01   -4.868712620988395e-02   +2.635719872005500e-01   +3.774515913110706e-01   +1.751298238086838e-01; +1.598095489367094e-01   +3.035234317780959e-01   +3.523778887431842e-01   +5.471210587040161e-02   +6.387852231736993e-02   +3.784044722412545e-01   +2.711340633672178e-01   +3.453915616255603e-01   +2.043729653928976e-01   +9.127950286882937e-03   +8.259810922365965e-02   +2.177792295404532e-01; +1.166894012761300e-01   +1.212615828326572e-01   +2.904149354636992e-02   +1.951681503606812e-01   +3.703546768536112e-02   +1.302910383734194e-01   +2.259448976845545e-01   +4.484316867227919e-01   +3.318935471126454e-01   +3.850793451431653e-01   +3.359567602939705e-01   +1.592409892459570e-02; +1.293494312972980e-01   +2.283686713723943e-01   +3.246381182961031e-01   +3.192848741086464e-01   +1.078885868718491e-01   +4.269876354195710e-01   -4.052552955726957e-02   +2.246907128222478e-01   +1.718997479164477e-01   +1.197205568918326e-01   +2.979889478268954e-01   +3.300044813150084e-01; +3.771841037489170e-01   +3.947787204622452e-01   -3.370644060688769e-03   +1.663576530327890e-01   +4.510557286701367e-01   +8.187612891483262e-02   +2.546813066348015e-01   +5.926430345512400e-03   +2.305280972867821e-01   +1.808486224461628e-01   +9.327705609495925e-02   +1.496637855581323e-01; +2.319480707889852e-01   +1.826854327143894e-01   +2.537465229627252e-01   +4.014787353142498e-01   +5.985955634042070e-02   +1.997862959052581e-01   +2.057824729346132e-01   +3.276179400650120e-02   +4.105633544999869e-01   +1.824499191789473e-01   +8.877793069819855e-02   -2.753623010949270e-02; +1.978160503762347e-01   +1.253852193122785e-01   +1.303484597517584e-01   +2.029773035225608e-01   +2.923970130834013e-01   +2.358120915704751e-01   +3.044628836892810e-01   +6.404282327296489e-02   +3.508205779437088e-02   +3.152916815666071e-01   +1.783434958416115e-01   +2.275212158405785e-02];
L2E_L3E_iAMPA_netcon = [+1.909852613173205e-01   +1.830976770178722e-01   +2.164392423666736e-01   +8.257735680584782e-02   +1.395306919110619e-01   +4.684573423837677e-01   -9.672212126999535e-03   +1.181224950770493e-01; +4.232730549413597e-01   +1.958971973877468e-01   +2.827846422523157e-02   +9.621502014270825e-02   +3.445282125584018e-01   +1.529181818303685e-01   -3.314531439011295e-03   +2.420308102210167e-01; +2.032582592457701e-01   +3.877561996981764e-01   +1.527779724952718e-01   +1.894730425084383e-01   +3.859765719576517e-01   +3.704514095917287e-01   +3.134416975394911e-01   +3.493814799958616e-01; +2.330264870852161e-01   +2.345853073868623e-01   +1.781757498805942e-01   +3.181577681285972e-01   +3.280239837414033e-01   +2.958314202269292e-01   +2.800134768739357e-01   +3.475480899784161e-01; +9.926191000268050e-02   +2.627813481863706e-01   +2.112283625797278e-01   +3.150219575500867e-01   +6.262191300472458e-02   +2.776286967580121e-01   +7.218873367622697e-02   +1.273451606516406e-01; +3.723747732956776e-01   +1.556953079759370e-01   +4.074891213107087e-01   +4.202894046626292e-01   +1.043895910593736e-01   +2.400255460995039e-01   +1.136803693791733e-02   +1.730437959674888e-02; +2.815790825542012e-01   +9.146135844137482e-02   +2.450507388851034e-01   +1.654764773881337e-01   +1.133594848228217e-01   +1.651345443021205e-01   +5.342785499203362e-02   +1.595498279903486e-01; +1.015834332056300e-01   +3.099683716063167e-01   -5.874615642372928e-02   +1.412867764314666e-01   +1.147011384938032e-01   +1.830669035424626e-01   +2.747374024354141e-01   +1.740082038805253e-01; +3.404138889923829e-02   +2.373024550970092e-01   +3.250675117603590e-01   +1.790667602090640e-01   +1.264167070049532e-01   +2.990927555176718e-01   +5.263314489619503e-03   +2.705503142518882e-01; +2.729011331878035e-01   +2.459270060025162e-01   -1.904024335239497e-02   +2.459152218012623e-01   +8.016548741102637e-02   +1.906535758336145e-01   +1.596622178828300e-01   -3.025089882887162e-02; +9.049339950889482e-02   +1.125451706611368e-01   +3.279832286355464e-01   +7.735061922537241e-02   +7.025656798556185e-02   +3.938430502485972e-02   +2.424298892910905e-01   +1.876096571235720e-01; +3.867145523495619e-01   +3.423611684212139e-01   +2.036296930288416e-01   +2.850306497802706e-01   +3.197401081973662e-01   +4.027449060181383e-01   +2.575021804787218e-01   +2.872663464780372e-01];
L2I_L3I_iGABA_netcon = [+3.593644711246922e-01   +2.770326976397804e-01   +3.173730177770698e-01   +3.011395338028600e-02   +6.718308928903849e-03   +3.621729581369293e-01   +3.993589419948473e-01   -1.230989784891629e-02; +1.514415993471321e-01   +9.555175817891134e-02   +1.959867342065664e-01   +4.378281856173110e-01   +2.394641351892025e-01   +3.719747590955738e-01   +2.642947355848633e-01   -2.834485554497196e-02; +3.393832360615696e-01   +7.703689055528472e-02   +1.293300150582790e-01   +2.102679367332340e-01   +3.959053359765254e-01   +3.233881635338384e-01   +2.627961071854684e-02   -1.655436855022843e-02; +1.250580855068182e-01   +2.566542285231780e-01   +1.010427122758298e-01   +7.686928101018893e-02   +2.390369926163195e-01   +3.518805618774182e-01   +1.612974575937528e-01   +5.843148497639492e-02; +2.332714317966452e-01   +1.639233814916027e-01   +3.850774320881178e-02   +2.547082692000827e-01   +9.929569317810805e-02   +1.163097038440651e-01   +8.635729670587955e-02   +1.391339630293473e-01; +2.938527952821163e-01   +2.864386721286674e-01   +3.242733300834727e-01   +2.621416844629285e-01   +1.977472406960297e-01   +2.958073282674127e-01   +4.192749619738549e-01   +1.139703071315194e-01; +1.046163082159155e-01   +5.330649493517572e-02   +2.678273138890286e-01   +3.357994679378578e-01   +2.903504902960812e-01   +1.977686233134636e-01   +9.859273432760990e-02   +2.658178922717027e-01; +2.480306504064961e-01   +3.506811988781334e-01   +3.136632590630641e-01   +4.454725995754023e-01   +2.902748173587034e-01   +5.735868367263219e-02   +2.478791195371060e-01   +3.001635212955625e-01; +2.639336835142598e-01   +1.999151695400747e-01   +1.529372249990855e-01   +3.949719303023581e-01   -2.933625056630288e-02   +5.894658264101923e-02   +1.031302074997032e-01   -2.967896215984597e-02; +1.042706820293439e-02   +9.744980577306689e-02   +2.313087182115298e-01   -4.435202289545834e-02   +2.324331548047328e-01   +3.489324472979532e-01   +3.812607354626918e-01   +4.487517685032234e-01; +3.633893092527503e-01   +1.828348087675292e-01   +3.170901373991352e-01   +1.484809482435109e-01   +3.693287571810543e-01   +9.005310701167199e-02   +1.479571245917122e-01   +1.843016709001738e-01; -5.686884398698376e-03   +1.947111721198734e-01   +3.143419624215213e-01   +2.301799946066156e-01   +3.534310437822641e-01   +1.091564628457919e-01   +3.205445210429225e-01   +4.492511717790411e-01];
L3I_L3E_iAMPA_netcon = [+1.135512304952425e-01   +1.108776490951965e-01   +1.958883041139889e-01   +2.473318717594708e-01   +2.648756961803731e-01   +1.858670560169917e-01   +2.252999504235703e-01   +2.055651943052508e-01   +2.705651555466718e-01   +3.034316501176285e-01   +1.023106103764459e-01   +2.933230651077494e-01; +2.279932806990580e-01   +3.831734949793514e-01   +7.549063629230565e-02   +2.960437413458750e-01   +3.018706179369208e-01   +5.177320077975976e-02   +1.980224967887536e-01   +9.764456560413080e-02   +7.662899117781721e-02   +6.232610078625557e-02   +2.806990341432491e-01   +2.558971592319394e-01; +1.264857359510868e-01   +1.313987691375594e-01   +9.487635620410176e-02   +1.446646270401673e-01   +1.920310226258528e-02   +3.683429237259195e-01   +3.518035258866893e-01   +4.056632336907878e-01   +1.525864381110951e-01   +3.502634061200425e-01   +1.736004101666044e-01   +2.661541767346389e-01; +4.001561302049056e-01   +2.870580376736117e-01   +3.452235771043090e-01   +2.915046516296206e-01   +2.709307208390396e-01   +2.922800909175007e-01   +9.751909862918538e-02   +5.612886217113008e-02   +3.847291811879414e-01   +3.125223711795379e-01   +2.377370263343258e-01   +3.629501975240895e-01; +3.403372017486738e-01   +3.615750188938814e-01   +3.286839380854165e-02   +3.681337996660947e-01   +3.784338098548523e-01   +1.264472469869940e-01   +2.029798068056929e-01   +1.603471981659590e-01   +4.185033202507476e-01   +5.201972907122298e-01   +3.195628065294787e-01   +2.772862155954005e-01; +8.217864767171873e-02   +2.806532769870535e-01   -4.113414962357917e-02   +1.745219842295290e-01   +3.060466275609998e-01   +1.642519354206423e-01   +2.485803487852027e-01   -7.195690202314860e-02   +3.161364616884494e-01   +2.517870935438302e-01   +5.845782453865491e-02   +3.295598850718079e-01; +2.451280117746220e-01   +2.291779744600080e-02   +9.272357640851631e-02   +3.091802136946512e-01   -4.191642722923931e-03   +1.668420273938280e-01   +4.043920607634471e-01   +3.930923902743578e-01   +2.903413760379067e-01   +7.123049209557358e-02   +2.558160929946870e-01   +2.332834596545929e-01; +1.283197482440611e-01   +3.519462637614726e-01   +1.269518994154757e-01   +3.204490128000309e-01   +4.083306966781818e-01   +4.758643623945233e-01   +1.081027679811639e-01   +4.198406043701352e-01   +2.470009382092498e-01   +2.359231674334238e-01   +2.552235864122056e-01   +1.325110248259248e-01; +3.162896366525050e-02   +3.026858274276047e-01   +6.349603953211483e-02   +4.049408512376597e-01   +3.219741552672752e-01   +3.384011424634757e-01   +1.318390132870191e-01   +4.024798735038529e-02   +3.147148039774741e-01   +2.409646006196002e-01   +2.965268698027838e-01   +1.589837122581607e-01; +3.154475441387671e-01   +2.867655222376935e-01   +2.148173209736476e-01   +2.384355834436501e-01   +2.297294437180170e-01   +1.048914180443043e-01   +2.142843213264177e-01   +3.625430407177711e-01   +2.079639623831339e-01   +4.297118414522027e-01   +7.733351552494527e-02   +1.811768830462585e-01; +3.082205409685019e-01   -2.107733287462513e-02   +1.688725775649660e-01   +1.457496232066242e-01   +2.696307908664302e-01   +6.293489601844225e-02   +2.505369403276269e-01   +3.979186211651029e-01   -9.686830228212695e-02   +1.354716103325504e-01   +5.969489832489892e-02   +1.137495915270007e-01; +3.218090023449254e-01   +2.401939675647627e-01   +3.620916166719815e-01   +1.282506610544016e-01   +1.550094204343676e-01   +2.533158428891835e-01   +1.099531682668743e-01   +1.983266015610953e-01   +3.631812574366468e-02   +3.080218543345493e-01   +2.210745256324531e-01   +1.292080745420114e-01];
L3E_L3I_iGABA_netcon = [+1.379954681963062e-01   +3.348157582094790e-01   +3.655713053879325e-01   +3.904277880636615e-02   +1.504652440161746e-01   +3.781466475642667e-01   +4.067647468891799e-01   +3.112341539779865e-01   +2.095426150576521e-01   +2.733466914862200e-01   +7.376328026441956e-02   +2.178635007893955e-01; -2.585428816960287e-02   +2.321976312473691e-01   +8.091120258453476e-02   +2.020454931490261e-02   +1.036324738583961e-01   +3.200575711680135e-01   +2.972253815037605e-01   +2.364961759293001e-01   +3.030749709027020e-01   +2.544104395873573e-01   +2.719298832933347e-01   +3.204976016159743e-01; +1.978336676752387e-01   +3.483760413311630e-01   +2.928002257061570e-01   +3.536052651658516e-01   +3.355488121026566e-01   +1.053581495952043e-01   +1.277697274906782e-01   +2.664981718177549e-01   +2.835448183462734e-01   +3.326812052307616e-01   +3.373665616926628e-01   +4.097418583977150e-01; +2.834178377499048e-01   +3.218814256056005e-01   +1.451689487375905e-01   +1.389342407091942e-01   +2.381098613816510e-01   +1.848292997554614e-01   +1.912512262669766e-01   +3.553560739589616e-01   +2.092392996513649e-02   +1.290957878717743e-01   +2.025816837680438e-01   +2.288075332798912e-02; +2.342075671099368e-02   +1.737019074030406e-01   +4.225494792354476e-01   +3.657256379701360e-02   +3.339117140815520e-01   +2.943020947420584e-02   +1.512819574668659e-01   +3.305646988224296e-01   +4.383096491846538e-01   +3.271595887501995e-01   +9.732646645030232e-02   +3.323238362181485e-01; +3.255722423543810e-01   +3.459833760081454e-02   +3.182876182834369e-01   +1.512778085045864e-01   +2.467131800084207e-02   +5.148038878165088e-02   +2.345839289129140e-01   +2.456462544507686e-01   +4.576406892715514e-01   +1.475980624293403e-01   +2.074607286765619e-01   +3.631226982122694e-01; +3.277488666413432e-01   +4.744809991330172e-02   +1.998073173871710e-01   +1.308115754649951e-01   +5.153182782219239e-01   +1.347184883242223e-01   +9.336514924402878e-02   +1.653609475576271e-01   +9.429667665706926e-02   +5.315643022309408e-02   +2.613537939142428e-01   -1.749131735571397e-02; +4.222466250236146e-01   -1.285292186941407e-02   +2.810644590841954e-01   +6.667903456474326e-02   +2.739387104397347e-01   +3.388598924846608e-01   +1.913028449155603e-01   +2.910186132544583e-01   +1.448268933087790e-01   +2.819770278936060e-02   +2.184088478986507e-01   +1.675724635085697e-01; +2.962987661421571e-01   +3.385203845551168e-02   -5.425761355720422e-02   +1.698409162969262e-01   +9.242086739764024e-02   +2.661695542596212e-01   +3.462437745346930e-01   +2.541085504155212e-01   +1.981638992453619e-01   +3.749932175603465e-01   +9.320747986534275e-02   +3.540713020414784e-01; +4.460460568327793e-02   -4.035822415118007e-02   +2.020861081402561e-01   +7.374189382932383e-02   +1.142838217649208e-01   +1.854959693383124e-01   +3.206809939916566e-01   +2.562566365863824e-02   +2.838493162972834e-01   +6.201128585953174e-02   +1.310448387860514e-01   +3.688557247068173e-01; +1.983030606010917e-01   +3.471828563644175e-01   +1.385955830754289e-01   -2.884482814799196e-02   +3.975629124663921e-01   +1.975050377303197e-01   +1.712135008460741e-01   +9.677795662520203e-02   +2.891883454732159e-01   +5.371017424560007e-02   +2.675929907257851e-01   +2.294062993021697e-01; +7.033004184463996e-02   -3.115711518379500e-02   +1.388045648759859e-01   +5.914542575621356e-02   +2.580386389141346e-01   +2.242656860626853e-01   +2.131160317551027e-01   +4.510555104698544e-01   +2.800264117017537e-01   +2.303628028725157e-01   -8.712518871056812e-03   +4.833131882237685e-02];
L2E_Input1_iAMPA_netcon = [+1.189151924222142e-01   +9.828698943097844e-02   +1.519409674719625e-01   +4.008127719081664e-01   +3.895835980192847e-01   +2.281283453848126e-01   +1.803313358827817e-01   +3.449376504411097e-01];
L2I_Input2_iAMPA_netcon = [+1.005520734357633e-01   +6.253624614137533e-02   +5.283442963484186e-02   +1.736570448701167e-01   +3.324144656020607e-01   +1.765941787802600e-01   +8.387141276437762e-02   +9.777800562103039e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.4*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.6*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.4*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.6*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.4*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.6*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.4*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.6*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
