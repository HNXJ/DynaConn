function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.457099189801555e-01   -3.862093211663711e-01   +1.500260680023155e-01   +3.381833094843300e-01   -4.761566848948898e-02   +1.003873076085078e-01   -2.364323482499462e-01   -1.055915969126421e-01   +5.610118835674482e-01   +6.057686986724152e-01   +2.136647928710413e-01   -1.060609313650341e-01   +5.389131950204706e-01   -7.993804556536316e-02   -3.722619609561222e-01   -2.882901115868697e-03; +4.398640724429858e-01   +1.875660158263932e-01   +2.650813887791333e-01   +6.585872396101347e-02   +2.178380560073076e-01   +5.135676667920864e-01   -4.792911061861385e-01   -7.511575541415746e-02   +3.380183023752190e-01   -1.289542755028017e-02   +2.982004782633280e-01   +2.950960603676418e-01   +4.223940091975624e-01   +1.817423530512979e-01   +1.507689076373706e-02   -1.046083599201748e-01; +3.127802616108594e-01   +1.159839967510840e-01   +5.594420329738747e-02   +1.705703392919050e-01   -2.244109775930271e-01   +2.675036346740003e-01   +5.786900638250877e-01   -2.470015631950628e-01   +5.036228135247083e-01   +2.717671817682037e-01   +5.797518209380601e-01   +3.075541326405785e-02   -1.269381967615169e-01   -4.286266431347180e-01   -1.661718712882158e-01   +3.293875905511082e-01; +1.757496302384882e-01   -2.234305595524691e-01   +5.969263160375672e-02   +5.382253319313469e-01   -2.436422221172441e-02   +5.217359383825515e-01   +5.957929704988227e-01   +8.076146861766244e-01   +2.679374429253193e-01   -2.745014536202548e-01   +5.549971059261968e-01   +2.928032375205666e-01   -3.439690963802516e-02   +5.177414839110734e-01   +1.312046408091658e-01   +8.946153882258367e-01; +2.377848549475180e-02   +1.793912251478449e-01   +6.178954231388254e-01   +5.542582508997259e-01   +1.802935959511635e-02   +1.230011633290541e-01   +1.535153347959400e-02   +3.282318944275536e-02   -7.697731940293545e-02   +6.746056352613002e-01   +7.823959530467669e-01   -1.752954667068224e-01   +3.611300927667679e-01   +2.749389226673613e-02   +2.965527747150178e-01   -1.508802683836361e-02; -2.985381172753866e-01   +9.776258790212677e-01   +3.791423778579932e-01   -8.061911103102129e-02   +3.050057855080109e-01   +2.965911258765097e-01   +5.543927682221577e-01   +3.762927627409164e-02   +1.100420078535004e-01   -2.442945018995078e-02   +3.125809004513365e-01   -2.470042323451640e-01   +2.911051847630386e-01   +1.167579244926410e-01   -2.815639073911244e-02   -4.907190840576530e-01; +2.910927195234083e-01   +2.881640319128317e-01   +5.434228252236273e-01   +5.717362644549034e-01   -4.542708198941499e-01   +3.089638030828252e-01   +1.797206592131490e-01   +1.990488575634944e-01   -6.997650208257626e-01   +3.144035996089308e-01   -1.262928632024895e-01   -1.028432254203754e-02   +5.349095137916170e-01   -6.443777917717615e-02   +4.325938320219135e-01   +7.288111327949462e-01; +2.239623378592189e-01   +6.272340944145500e-01   -1.222425126226170e-01   +1.922142972126291e-01   +1.919613836409485e-01   -1.722883854786416e-01   +4.806843765801840e-01   +3.417213015119622e-01   +3.321700358534566e-01   +5.708034652285890e-02   +3.779094037926207e-01   +8.243608587988635e-02   -8.835490748899510e-02   +1.909447064461578e-02   -2.399410420402223e-01   +2.154171105439104e-01; +3.314835699875160e-01   +9.082996341292386e-01   -5.712082057891061e-02   -4.256685072122579e-02   +2.836061613162386e-01   +6.714829473629870e-01   -7.692645643254693e-02   -1.864611015395806e-01   +2.883660328513515e-01   +2.748046305620849e-02   +3.343853281994070e-01   -4.834063473937913e-02   +1.647740744137839e-01   +3.097280092155603e-01   -1.439995352223127e-01   -1.490472697449208e-01; +4.203757448288144e-01   +5.991383521102115e-01   +8.174889093376135e-02   +2.389924206783832e-01   -2.873299072262560e-01   +1.952403683255468e-01   +5.651630567579715e-01   +3.869354666247087e-02   +2.542639717048953e-01   +4.178809478931735e-02   +9.820106524588065e-01   +7.026182763179055e-02   +3.141354594474889e-01   +3.097782417274792e-01   +6.416059560637721e-02   +3.434684040256066e-01; +3.610046407714876e-01   +9.115672793193692e-01   +9.092976969359662e-02   +1.139736069367165e-01   +3.428273470307431e-01   -1.791343678771298e-02   -2.579253885081003e-01   -6.421811707661834e-02   +1.296559579236572e-01   +4.862565203186253e-01   +2.287220132067586e-02   +1.558988531600411e-01   -8.191441372299461e-01   -9.501793940754215e-02   +2.013460918440705e-01   +4.285947386132055e-03; +5.245565031944607e-01   +2.980115426485401e-01   +1.769767930878852e-01   -1.690093721634820e-02   +5.170900521084014e-02   +2.189261747791856e-01   +1.726981258695887e-01   +1.151098407943739e-01   +6.543915477919307e-01   -4.250932175803642e-01   +4.336428979337275e-01   +7.470114854197261e-01   +7.233620383622965e-01   -4.378134320729973e-02   -3.368556805057348e-01   -1.254730494934576e-01; -2.102082980296761e-01   +2.516802684248874e-01   +3.075901972709108e-01   +4.329399715538368e-01   +9.624669230802809e-01   +6.064492568337893e-01   -3.123273458279529e-01   -1.217893933991593e-02   +3.657522272086638e-01   +6.172889578780349e-01   +3.592568954105795e-01   +2.899744924121584e-01   -4.655683757998839e-01   -4.024376197920518e-02   +3.191935088598862e-01   +7.919605122118510e-02; -4.694346612547218e-01   +6.127591525325173e-01   +2.396851045364513e-01   -2.328082770228851e-01   +2.261055602199810e-01   +3.776169287690066e-01   -1.807296344328496e-01   +3.611408863657474e-01   -4.265326413896670e-01   +1.040788970009722e-01   +7.342854704682850e-01   -1.312068223417697e-01   -5.888866417664265e-02   +6.865238102474737e-01   -3.296505716390216e-01   -2.882919118558305e-01; +2.720923871667545e-01   -2.414655771433237e-01   +5.469571636585928e-01   +3.389401813567618e-01   -1.583670699849118e-01   +1.670301217300632e-01   +3.345915401419669e-01   -3.408473497317188e-02   +1.150843845922590e-01   -1.966467835668899e-01   +1.057151075759929e-01   -1.090997814143016e-01   +6.315170882658805e-01   -7.672781661576991e-03   +2.131760379224356e-01   -9.153454090188642e-02; -7.102378294075247e-01   +1.757318876919734e-01   -3.806110665722630e-01   +3.751899640428996e-01   +9.279093296799967e-01   +4.517367587683497e-01   -2.589584474286896e-02   +6.577938634372524e-01   -1.069671140704993e-01   +1.429045543890498e-01   +4.022368847674475e-01   +2.496851151289531e-01   +3.940660454981489e-02   +3.199089017116553e-01   +1.147906630143226e-01   +2.656687892726579e-01];
L1E_L1I_iGABA_netcon = [+2.684221315425878e-01   +7.894652308465673e-01   -5.541209256023740e-01   -2.553212584530705e-01   +5.701323266540198e-01   +2.314332943553500e-01   +6.114331886203271e-01   +4.071981354338676e-01   -2.989373087191592e-01   -2.282576736427569e-01   -1.843730555635081e-01   +4.213274143469549e-01   +7.530744226418186e-01   -2.745351078084223e-01   +6.383309057591869e-01   +8.556685529574605e-01; -1.757098019603200e-01   -1.943456443423306e-01   +9.168571996455600e-01   -3.326773238981091e-01   +4.265701568507460e-01   -5.233784587218306e-01   +4.771287936117108e-01   +5.569331447817111e-01   +1.427724060117570e-01   +9.452896021270142e-02   +2.878952956904610e-01   -1.223672504033760e-01   +5.205304569854984e-01   +4.712184296466744e-01   +4.957176396603609e-01   +3.274951263197821e-02; -5.805926196909848e-02   +2.878109470720461e-01   -3.289456349645890e-01   +6.303314725737831e-01   -2.670561078060423e-01   -6.507159510889315e-02   -1.949870729868998e-02   -2.304582209458731e-01   -3.816483053553348e-02   +3.165974599334689e-01   +8.555002627406966e-03   +4.802536041488139e-01   +1.409157984761023e-01   -4.275331216073407e-01   +5.771457428984897e-01   -4.435750462284850e-02; +2.136972509271792e-01   -3.297322630527404e-01   -5.675579782128206e-01   +1.639415759362063e-02   -8.614147878755286e-03   +2.194742636262690e-01   +8.771841366397137e-03   -1.317299885621311e-02   +4.624517890274571e-02   +3.199053479696141e-01   +3.324110745649147e-01   +3.567078309590658e-01   +2.929924840604059e-03   +4.872094178897312e-01   +1.868332230395393e-01   -6.262250010853203e-02; +8.118893332788124e-02   +3.161735022172811e-01   +4.799279126283958e-01   -1.996754279305270e-02   +5.691460867498594e-01   -3.725936308859229e-03   +3.669057492191048e-02   -2.514933831475000e-01   +6.317420360061687e-02   +4.382559740349001e-01   -1.032095838742564e-01   +6.743063380217882e-01   +8.342236651592694e-01   +5.854089716992880e-01   -1.670447445849659e-01   +1.811216948257149e-01; +2.306366442803238e-01   +5.275188486364667e-02   +4.447684591683624e-02   -5.953774152431696e-01   -1.392827299897334e-01   +7.480934892412218e-01   -3.597049414059400e-02   -2.322061323383521e-01   +5.393879311014224e-02   -7.727626496093737e-03   -3.396408209497347e-01   +7.643101763320459e-01   +1.967345613409246e-01   -2.736591374688045e-01   +2.472417719948961e-01   +1.424324267644796e-02; -5.606721874385997e-01   -2.898347781131529e-01   -3.596840093083621e-01   -5.261970802614940e-01   +5.465798870953338e-01   -7.244285672998281e-02   -1.913365490518508e-01   -3.159205591866353e-01   +4.625388266725019e-01   +4.849132409794426e-01   +7.538931860605753e-01   +1.191721670852417e-02   -5.533601952494051e-02   +4.454447300178581e-01   +7.882679586964055e-01   -3.218888690800949e-02; +1.804927245909544e-01   +3.674031900147084e-01   -1.037657130519039e-01   +1.274603446878445e-01   +2.466553480186949e-01   -2.802104382751698e-01   +9.259128711360243e-01   +1.268608367273968e-01   +5.978262758991102e-01   +4.011578237243851e-01   +3.434736828783962e-02   -2.292906527656203e-01   +8.552692376878898e-01   +4.309880537292299e-01   +2.620155200917171e-01   +6.098588421284570e-01; +3.524657822995227e-01   +7.949685790266665e-01   +2.255115381895019e-01   -5.223271736160923e-02   -3.691290068827092e-01   +6.130507503327653e-01   +2.369422999612154e-01   -8.511936075255591e-03   +3.575455806431764e-01   -4.481737523752000e-01   +7.046253133587790e-02   -3.218378589870001e-01   -2.778453680992824e-01   +1.494467636172352e-01   +7.036216001236197e-01   -2.019952035980547e-01; +2.184622131356220e-01   +7.156236344636144e-01   +9.834327318842918e-02   -2.809510353562036e-01   -9.456261424817167e-02   +4.134262763144081e-02   -4.455913181432357e-01   -1.233335815346408e-01   +5.750125721409540e-01   +1.219647622824246e-01   -3.954808268329478e-01   +1.222864180345468e-01   +6.377894931123701e-01   +5.079247322871723e-01   +1.481691776283912e-01   +1.360843139109841e-01; +1.354790968581743e-01   +1.564484204765019e-01   +3.926637924745361e-01   +8.685637732557359e-01   +3.230780107528105e-01   -1.381531971915074e-01   +2.584789000440909e-01   -2.854139943827472e-01   +5.060705331595133e-01   +3.042714502910196e-01   -2.545800103995712e-01   +5.027145039234798e-01   +6.614093210618172e-01   +3.249580329993490e-01   +2.500955057206682e-01   -6.287432946117224e-01; +2.022187492419799e-01   +9.031941592508053e-02   +2.369363847031601e-01   -5.983876007518778e-01   -1.316274787684560e-01   +2.571483829469709e-01   -2.857530745293017e-01   +6.309340518666393e-02   +1.164626399961329e-01   -2.458788865462768e-01   +3.451020808568812e-02   +1.101214434639316e-01   +3.587979800966384e-01   +9.373222852932350e-03   +4.700165967832562e-01   +1.955432260472149e-01; +3.707892818436382e-01   +4.275887500500761e-01   -2.365198605359772e-02   +2.380669387924189e-01   -2.283056121944411e-01   -5.993075290253038e-02   +2.526292962649206e-01   +2.160321531739146e-01   +3.162744444566374e-01   -9.038513879060975e-03   -2.788628231441116e-02   -1.084350556051891e-01   +4.894385946628473e-01   +3.031307339046872e-01   +2.194030107317160e-01   +9.757370827566929e-02; +3.728331102442903e-01   -1.084107454651324e-02   -2.556049617400092e-01   +2.847852422829764e-01   +2.834390822611409e-03   -1.507124115181123e-01   +4.584875918053775e-02   +3.575248321330335e-01   +4.426475865776897e-01   -3.252950759314786e-01   +3.549844494407232e-02   +3.719707225991459e-01   -1.478248864022903e-02   -1.084185687914973e-01   -3.680014005881088e-01   -1.214131139967014e-01; +5.992832679214057e-02   +2.295032831782122e-01   +2.188239742653219e-01   +6.524965052301779e-02   -6.626325300623073e-02   +1.086074214484786e-02   -5.496299579106560e-02   -9.941176089890913e-02   +7.666939217592695e-01   -8.357752345412985e-02   +6.061191936895207e-01   -4.140481211424162e-02   +1.775668439050568e-03   -6.693992584693707e-01   +8.735567446100743e-01   +1.208100978231675e-01; -3.398989145130578e-01   +4.890829961791842e-01   -4.060173921342515e-02   -6.618312927691632e-02   -2.441970336263214e-01   +1.920391377558370e-01   -8.218360986844804e-02   +1.728703998791458e-01   -3.139212764707084e-02   +2.518882087737140e-01   -2.155815649044218e-01   -1.721894362875691e-02   +1.281899376694613e-01   +2.402037591951326e-01   -4.138205842157339e-02   +3.371494515006679e-01];
L2I_L1I_iGABA_netcon = [-2.171385680506789e-01   -3.549045274081117e-01   +1.599042789346218e-01   +3.406971545697277e-01   -3.236028149815879e-01   +2.543755500588252e-01   +8.063792635514022e-02   -2.818275800052678e-01; +1.297898797280702e-01   +4.881802800699722e-01   -1.293464419787727e-01   +1.456611335339933e-01   +6.492308298473292e-01   +5.921649113287647e-01   -1.554120009202987e-02   -1.805863039875683e-01; +4.407003102090450e-01   +2.753810661763579e-02   -3.076194343302065e-03   +2.726709804475123e-01   +7.741461996270685e-02   +1.347348569287937e-02   +9.297719780405304e-02   +2.823681505294587e-01; +1.445193865460240e-01   -1.185575502101830e-01   +6.535884455066445e-01   +2.843431804070438e-01   +1.247356738352817e-01   +3.488235572236650e-01   +3.259996824501049e-01   -9.238690062988955e-02; +2.413029065513142e-01   -3.538226754129267e-01   +6.566072478083316e-01   +3.564620354398571e-01   +4.868251518625468e-01   +4.603004609217987e-01   +2.932117338619837e-01   -1.386666357859450e-02; +2.550812212173432e-01   -7.613821366199870e-02   +3.793852869385005e-01   +3.833442854519832e-01   -1.221143762464409e-01   +3.166791985438313e-01   +3.520711220171067e-01   +3.172361595215130e-01; +3.448260113301354e-01   +1.741023457904530e-01   +2.000004485162835e-01   +9.736419311914975e-02   +1.984782440808424e-01   +5.621718514650492e-01   +3.104730382722370e-01   +3.503318019526914e-01; -1.830518461307067e-01   +4.964558873957630e-01   +2.812272873738926e-01   +1.801169082520802e-01   +4.234216264666228e-01   +4.131994961311038e-02   +1.519107969832090e-01   +1.145295312440991e-01; +1.891400232820188e-01   +9.086104190076856e-01   -3.064991996078640e-01   +6.124548302905823e-01   +3.569321173117819e-01   +2.448636875945338e-01   +2.659300510940490e-01   -3.874506941475919e-01; -2.221386816335903e-01   -1.103051484569485e-01   +3.627515929771807e-01   -7.021145787946836e-02   +2.515765167471635e-01   +6.073747400011555e-02   -4.574945212795839e-01   +2.106059908475043e-01; +1.462034413269221e-01   -7.074129948257203e-02   +2.497305280969165e-01   +2.623900450292688e-01   +2.543440437238197e-01   +2.367247469138800e-03   +1.958354042647619e-01   +3.670882991972601e-01; +3.648235357678721e-01   +2.644367606669339e-01   +2.869699020766070e-01   -9.019939133394500e-02   -1.534269173440218e-01   +1.909683089410456e-02   +7.076531160718482e-01   +3.277928020681046e-01; +2.758972775951795e-01   +2.586455945431658e-01   +2.958733454977657e-01   +2.076888697970000e-01   +5.528850200513552e-01   -1.568449646192230e-01   -1.544604043508486e-01   -1.842997247718657e-01; -1.743416420850471e-01   -1.495649925979287e-01   +2.456912780875256e-02   -4.120439251789165e-01   +2.927603872991859e-01   -2.058704013156254e-01   +3.848201720709099e-01   +3.101411106430222e-01; +3.450573425160978e-01   +2.359420424569497e-01   +3.685684275983671e-01   +1.012171770753385e-01   -2.949255900671138e-02   +7.877799645373933e-01   +7.309162830820898e-01   +3.896692342401154e-01; +1.223554398051796e-01   -1.786088837938154e-01   +2.205129134631913e-01   +5.142694933513470e-01   +2.261684836043871e-01   +2.820726878254767e-01   +1.676435539300160e-02   -2.471549611313531e-03];
L1I_L2I_iGABA_netcon = [+1.965415553226258e-01   -1.926033890591975e-01   -2.670642959670901e-01   +3.015003589831751e-01   +2.724106932710694e-01   +1.725932968399513e-01   -1.574476892380083e-01   +8.439381188131664e-02   -1.480560054769008e-01   +2.248390537329070e-01   -1.720902717610671e-01   +1.126000011141585e-01   +2.553918200193610e-02   -4.859613784887672e-02   -2.276763304386924e-01   +2.459512963408105e-01; +1.744382092509374e-01   -2.627216505706551e-01   +5.918931626236442e-02   -1.918891599073213e-01   -2.724995996517379e-01   -1.035259438423196e-01   +1.587904656846204e-01   +2.284635452251512e-01   -7.524676940743673e-02   +6.263675154336276e-01   +2.431288727467471e-01   -3.536141934923726e-01   +5.191213084207676e-02   -2.632876040922801e-01   +4.037106859994146e-01   +1.880012770621341e-01; +2.796183335112709e-01   -2.307948963235084e-01   +4.380901010032123e-01   -2.447392324707976e-02   +1.809280659246215e-01   -2.335606837938170e-01   +4.800758518707139e-01   +3.899772023982371e-02   -1.282814202039046e-01   +5.094494350602122e-02   -2.114325997476046e-01   +1.850828097095014e-01   +2.456012846192797e-01   +3.437338562710113e-01   +4.743365527472331e-01   -7.371231663109902e-02; +1.946834521535164e-01   +5.603804946118867e-01   +3.021673142396003e-01   -1.356187918889926e-01   +3.975004591784601e-01   +7.668933334312511e-01   +2.122278323461627e-01   +2.132299190324109e-01   +6.522796729709483e-02   +5.157169360897988e-01   +3.666844409490123e-01   +2.965948079667647e-01   +4.296789739203938e-01   +5.051923912573070e-01   +3.044881360037346e-01   +2.841247820256945e-01; -4.861371451730971e-01   +1.223622212964017e-01   +2.435205546898899e-01   +2.463447318486141e-01   +1.905023786607346e-02   +5.476586493076474e-01   +4.716973347731548e-01   +4.111313171809516e-01   +3.922269105077617e-01   +4.124652225699268e-01   +1.251091886757143e-01   -1.817236772729334e-01   -6.111839328067232e-01   +1.866812322837862e-02   +2.341256757893513e-01   +6.051087796267159e-01; +6.658638979537476e-02   +3.382041814501962e-01   -4.382611169471143e-01   +4.903028997564853e-01   +1.029949012483482e-02   +4.710524396093665e-02   +3.836388196623282e-01   +7.125577383914098e-03   +1.093331982478208e-01   +7.358030983640262e-02   +1.156441171849531e-01   -3.587131939435271e-02   +3.542720734404000e-01   +1.000000000000000e+00   +7.010481907856456e-02   +6.887165990543220e-03; +2.378737074429551e-01   +2.031956550841754e-01   -1.749974048226560e-01   +2.696241118685583e-01   +2.576731311690497e-01   -3.618328831695056e-01   +4.458698270595911e-01   -2.633211520867018e-01   -1.845913966929899e-01   -3.997021825515715e-01   +3.705508265641601e-01   +2.243100477595212e-01   +1.153117954628655e-01   +7.085848518238164e-02   +1.686207230818133e-01   +1.529645882439643e-01; +2.432994801146692e-01   +7.444646936553094e-02   -8.243300839900157e-03   +3.359567994718445e-02   +1.494156987699868e-01   +2.190824812948708e-01   -2.102382016712014e-01   -4.551342636193509e-03   +1.294011972688646e-01   +2.443653540975972e-01   +5.447988087984847e-02   +4.368604532295819e-01   -1.120250442464361e-03   +1.707098666245065e-01   +4.368239452447008e-01   +4.285084878764750e-01];
L2E_L1E_iAMPA_netcon = [+3.196358456870552e-01   -5.537307102141452e-01   +2.660657722332919e-02   +4.429189097946005e-01   +7.558194196022443e-01   +5.264348609545300e-01   +6.583401384932160e-01   +1.100875506779702e-01; -2.425834510018950e-01   +1.598480216377099e-01   -2.687443994477305e-01   +1.174352536270938e-01   +1.750643807732749e-01   +4.077394611167655e-01   +1.907070985028882e-01   +1.661181985535847e-01; +3.360651839337577e-01   +9.698856786072520e-02   -6.972707993911387e-02   +2.365688966833322e-01   -1.905793173915097e-01   -6.597642625903848e-02   +2.021365204320345e-01   +4.537959499757346e-01; +5.936954895339576e-01   -1.458937445316607e-01   -2.027933711164261e-01   +4.997068232073643e-01   -6.660671975800098e-02   +1.067307740833460e-01   -2.196405735462562e-01   +1.662782759309003e-01; -1.802852427621844e-01   +5.416735070468318e-02   +5.628023308763587e-01   -2.550012977435264e-01   -1.270695048421143e-01   +2.090707742224580e-01   -1.095085850977517e-01   +3.636000134170932e-01; +5.287662370493436e-01   -2.536558972333701e-01   +8.467937148188642e-02   +3.404384906526973e-01   +3.943760864959384e-01   +7.804338337736839e-01   +7.020602117010712e-01   +2.968422132368586e-01; -2.635047935879087e-01   +7.637456427025225e-01   +1.416713070774853e-01   -2.962475842664953e-01   -3.223954487440654e-01   +1.609718156569475e-01   +6.853174690092185e-01   -2.510296921142920e-01; -1.257864523817642e-01   +5.957865750030136e-01   +9.889306766389807e-01   +1.194242912339007e-01   -2.312057217461697e-01   +2.602336026228467e-01   +3.190472658539609e-01   +8.193101486516191e-02; +4.102881461781486e-01   +8.456648751932702e-02   +6.270715891807047e-01   +5.933264101695848e-01   -3.021994309062478e-01   +3.003099907758365e-01   +6.162159652921325e-01   -5.017936245977545e-02; -2.835097476225473e-01   +2.149711417353976e-01   +2.686211038562494e-01   +3.774673481248912e-01   +8.763131143070511e-02   -3.590274384597315e-01   -1.798816509093817e-01   -1.982417032542097e-01; -2.016779872661980e-01   +6.140442786425961e-01   +8.540713198977861e-01   +9.662260818796292e-02   -5.309762089877960e-02   +3.550587495396870e-02   -1.114104591338307e-01   +2.467121950573546e-01; +4.595564042394608e-02   -1.536515947299097e-01   +4.301290843222448e-01   -3.751863587009309e-01   -2.854830135338926e-01   +2.477145867028726e-01   -3.306537066404890e-01   -2.754389283712158e-01; -1.076632208920256e-01   +3.426053210848620e-01   -7.494759199142104e-02   -2.105136263064215e-01   +7.919308084241954e-01   -2.968853971007586e-01   +5.342974586140195e-02   -1.084275292249559e-01; -1.638251634105343e-01   +9.960136687686628e-01   -1.757048251219546e-01   +1.239954006122253e-01   +4.104553678871572e-01   +3.637239464592748e-02   -1.319924204078459e-01   +3.251574894300135e-01; +1.305427841922142e-01   +2.204089950319739e-01   -1.649041059740724e-01   +3.731544924513823e-01   -1.094469847002257e-01   -1.166319921984440e-01   -2.856799638353065e-01   -2.055417950165438e-01; +2.453901621103609e-01   -3.029298326170591e-01   -4.483262629018643e-01   +2.224395323178932e-01   +1.750029143554527e-01   +3.272081914001089e-01   +6.973608381530920e-01   +9.667510670586799e-02];
L1E_L2E_iAMPA_netcon = [+2.491184370141783e-01   +2.333542000525325e-01   +1.151956502258702e-01   -2.586921996316063e-01   +2.297667508369191e-01   +1.694741296824306e-01   +1.469175164315017e-01   +4.895151985155634e-02   -4.386309044821113e-02   -3.415114558324505e-01   +5.748386906975036e-01   +1.200696409300210e-01   +1.301607536054200e-01   -2.752631795358543e-01   -2.275307054421646e-01   +9.416063198989187e-02; +1.626056146851690e-01   +1.823089641100042e-02   +3.270805411391094e-01   -1.286906512868646e-01   +1.684404929555682e-01   +3.055474183820521e-01   +4.623335215294432e-01   +3.009275968646524e-02   -1.942765398289729e-01   -1.112543565009615e-01   +5.974552841143073e-01   +2.035995979073210e-02   +5.518101243301370e-01   +3.551591387715766e-01   +1.673260193909375e-01   -4.256131594755517e-01; +8.341832956216880e-01   -7.278427684683020e-02   +1.723232251878257e-01   +5.384615077146909e-02   +2.371347604015961e-01   -9.116885082553738e-02   -2.127148489852266e-01   +1.227682119613338e-01   -6.355086145350870e-02   -5.174295230047655e-01   +4.598515954090437e-02   +2.792822467451436e-01   -2.994108628044652e-02   +4.723290618843396e-01   -8.207755298856757e-02   +3.434719790075394e-02; +1.253632036711419e-01   +9.571742759535420e-02   -1.636695279924692e-01   +5.129510318849180e-01   -1.019768832055533e-01   +6.317732648456903e-01   +8.091764958735658e-01   -2.137883118854196e-01   -2.168284775431646e-01   +1.293856207703799e-01   +5.968064663264482e-01   -2.841214993113065e-01   -2.727030103166749e-01   +8.818448688547661e-01   +2.160051674556228e-01   -1.001123984159017e-01; -4.512039889047220e-02   -5.101118848247752e-01   +4.349129922716526e-02   +1.215623662267383e-01   -1.427520890836527e-01   +7.541936280078294e-02   +3.622318395414462e-01   +1.417890008001381e-01   +6.550221149948483e-01   -1.305916085098485e-02   +2.583730986090057e-02   -5.360301289882398e-01   -2.335721769341184e-01   -7.626961857393763e-02   +1.515095553389501e-01   -3.525928820768542e-01; +6.091752218107183e-02   +3.646763398828746e-01   -1.677618154903663e-01   +4.870683179428487e-01   +1.844365089047554e-01   -1.301654610281093e-01   +1.000000000000000e+00   -1.690827479382196e-01   +1.775435613826359e-01   +7.020967540580056e-02   +3.052343042028004e-01   -6.768677487213554e-02   -1.363684077170793e-01   -6.936432978647235e-02   -4.110451079319472e-01   +7.250475987872187e-01; +1.740864192402153e-01   +3.260559094751741e-01   +1.274529092860666e-01   -1.454419623422696e-01   +3.206209145736268e-01   +3.012062004205959e-01   +4.305891015265998e-01   -4.438028290774971e-01   -2.453474258146439e-04   +6.689792264815576e-02   -2.921259222813118e-01   -2.770343444059434e-02   -5.324365807065683e-01   +5.707881149474971e-01   +5.179373870386157e-01   +3.925474278313403e-01; +3.909960120692283e-01   +2.959176664580567e-01   +4.299818246471186e-01   +6.070145858876287e-01   +2.560150638503314e-01   +4.771037640085263e-01   +6.947921114626456e-02   +1.004641218214231e-01   +2.911738726174715e-01   +2.800257903734639e-01   -1.160965602535809e-01   +5.320044576171425e-02   -6.109017184509296e-01   +1.562058474260498e-01   +3.513893061220918e-01   +3.528604444869008e-01];
L2I_L2E_iAMPA_netcon = [+6.939046173288110e-02   +8.226841103619781e-01   +1.587230946800177e-01   -1.257329584953997e-01   +5.388082320955750e-02   +3.749210732581509e-01   -3.947175176236686e-02   +5.516654935074427e-01; +7.013285587091119e-01   +2.286809827433129e-01   +5.465824392752859e-01   +9.278333816648804e-01   +5.249407092865718e-01   +1.464658263762115e-01   +3.217119008952467e-01   +2.762432839598304e-01; -3.390231516273805e-02   +1.237634732391822e-01   -3.198897426334112e-01   +2.686540642979113e-01   -2.627809917414541e-01   -1.439575932666496e-01   +2.933526906085606e-01   +3.801564072264632e-03; +3.394467998787913e-01   +3.733442206848164e-01   -5.767053004899574e-01   +3.648953594902773e-01   +4.846129765696018e-01   -1.184525142118265e-01   +3.901045001439402e-01   +4.601630148926690e-01; +2.530448302514521e-01   +1.862299279229924e-01   -2.500159455470863e-01   +2.344804650897480e-01   +6.600902969906964e-01   -1.941130233194323e-01   +2.698445373023050e-01   -2.751661864410462e-01; +3.610861667750676e-01   +1.214938097877273e-01   -4.106266044518098e-01   +3.306861403484216e-01   -5.183295153353559e-01   +1.917528749375745e-01   +8.335230659561760e-02   -1.690340888923800e-01; +5.205941713723837e-01   -5.039015514100693e-01   +3.576579458403072e-01   +7.510975927170783e-01   +2.431755539560890e-01   -3.953892819728420e-01   +9.427441102399486e-01   -5.358629693009759e-01; +6.094106088711997e-02   -9.374972218191001e-02   -8.581945847953036e-01   +1.143152322496195e-01   -1.630764966084363e-01   -2.816318384387220e-01   +1.145303348312215e-01   +6.590320231010043e-01];
L2E_L2I_iGABA_netcon = [+2.399167029710448e-01   +4.021077937833653e-01   +2.726718184397583e-01   -2.257711388851005e-01   -3.534872801576071e-02   +1.987117280133763e-02   -1.366938812214433e-01   +7.137142376937718e-01; +2.100237559497033e-01   +2.473686195459439e-02   +1.244869816496498e-01   +1.000000000000000e+00   +4.848041403002950e-01   -9.027951502313250e-02   -3.595419547850255e-01   +8.689455065146855e-02; +1.205125434754286e-01   +6.597531519757187e-01   -4.210764554873149e-01   -4.932224714003743e-01   +2.938849719122354e-01   +6.575373614420540e-01   +2.166334904533020e-01   +2.537549665920965e-01; +1.969248294825257e-01   +3.263424292821018e-01   -5.029105272646851e-02   +4.863625872733592e-01   +7.064055446114589e-01   -3.921844559102641e-01   -2.192768120769598e-01   +6.566013069290973e-02; -7.056461138037076e-02   -7.254877819508697e-02   -7.805628057201849e-02   +3.479757708136667e-01   +6.190969967301456e-01   +2.322270204851928e-02   +1.783041677058413e-01   +2.044477082545818e-01; +7.167286336929994e-01   +2.930187811963448e-01   +3.615545529623709e-01   +4.494466928763496e-01   +3.282783298300047e-01   -9.809917841194041e-02   +4.503479281262689e-01   -5.075303662129788e-01; +7.805933686093884e-02   -4.760706035988918e-03   -3.716049690700556e-01   +1.275950480780338e-02   +9.164082242402352e-03   -1.144102584321681e-01   +1.420060072431094e-01   +7.613179327766152e-01; +1.496117552556322e-01   +3.259800410462088e-01   +3.681132788765284e-01   -2.683418504563605e-02   +5.350066885486130e-01   +3.463929687198189e-01   +2.761165104156915e-01   +4.527555154261612e-01];
L3E_L2E_iAMPA_netcon = [+1.765810723421561e-01   -3.861224898787936e-01   -3.488757610145370e-01   +2.709281816014126e-01   +6.479323113011430e-01   +2.346389537926407e-01   -3.306001877110414e-01   +9.627870989069820e-01   +4.150334290546855e-01   +2.962804036877840e-01   +2.339395789881906e-01   -5.064944602034146e-01; -2.691663778284917e-01   +2.842840470324398e-01   -2.556864382775953e-02   -4.770305048881372e-01   -2.554626448807247e-01   -4.963464847054160e-01   -4.186825149154612e-01   -4.193358692468638e-02   +2.088398576518478e-01   +3.692941370855795e-01   -1.143396627850799e-01   +6.425782098672512e-01; -5.716671883376291e-01   -1.128774997779897e-01   +6.336977749806140e-01   +2.819392149053200e-01   +1.450564014738416e-01   -6.771167913053973e-02   +1.065247421391684e-01   +3.132367246604539e-03   +5.962439714815614e-01   -3.828679627127229e-01   +8.215460943504976e-01   +3.286488825089608e-01; +3.183587833607043e-01   +4.781738837306036e-01   -1.865623950231318e-01   +1.576784941549551e-01   +5.019069632762093e-01   +3.166812722347757e-01   +1.679901415448359e-01   +7.019895314934623e-01   -3.172260202546256e-01   -5.045176028932078e-01   -1.488735249847532e-01   +2.032665959812070e-01; +1.899282389511738e-01   +6.930650850253049e-01   +4.113627134567450e-01   +8.616843271546717e-02   +3.445025344733180e-01   +5.342185682618590e-01   +4.975817363034372e-02   -6.734319851338477e-02   -3.498349166477412e-01   +5.874141836943815e-01   +1.979629061524394e-01   +4.342670589988027e-01; +2.224129954859410e-01   -1.092711857714469e-01   +4.918228395115550e-01   +1.246390334377303e-01   +6.813384049815331e-01   +6.003404201377703e-01   -3.628941558284159e-01   -1.349073769057560e-01   -2.069387011478793e-01   +2.920251045573612e-01   -3.218445257603483e-02   -2.622225089466811e-01; +4.608311811913317e-01   +2.147342872318773e-01   +1.501019145506997e-01   -1.260514158152559e-01   +3.366226648530676e-01   +6.139120204984178e-01   -9.886459182896239e-02   +1.454066811209614e-01   -4.567530015398713e-02   -1.424834155701715e-02   +1.728704103528416e-01   +2.015335042735579e-01; -1.978489120705387e-01   +8.498631793604872e-01   +3.528837835413617e-01   -6.452949488089309e-01   +4.520810727936258e-01   -4.281422353987679e-01   -3.430157585184691e-01   -1.270727807880753e-01   +2.201979259577178e-01   +1.559632572884695e-02   +3.900577718440918e-01   +7.017855078470497e-03];
L3I_L2I_iGABA_netcon = [+7.533821200406594e-01   +8.077914500213839e-01   -2.391695694411169e-01   +3.880651219063876e-01   -3.896511470822623e-01   +1.157664945083609e-02   +1.000000000000000e+00   +6.843860442148734e-01   +2.533992880247470e-01   +3.480488600208347e-01   +2.140110262379749e-01   +7.040373905052147e-02; +6.275026872563248e-02   +1.241135564545002e-01   +1.450783346835359e-01   -1.354977338468202e-01   +1.490812168361265e-01   +2.112339985516271e-01   -7.305553390924539e-02   +6.779103861625799e-02   +9.068327809076257e-02   -3.868274337907710e-01   +5.265832969540994e-02   +8.748126521485072e-03; +3.657668673356101e-02   -4.762926577865286e-02   -1.179859009285810e-01   -5.838133287289207e-02   -2.323035497690823e-01   +4.569395983921152e-01   +2.023756908913203e-01   +6.738046444206372e-02   +1.766582348087390e-01   +3.528210012732833e-02   -1.481595661486265e-01   +8.164146989541565e-01; +7.163367049008715e-01   +1.726736617148519e-01   +4.600812670273469e-01   -2.092077749184007e-02   -3.649681898680885e-03   +1.686294965206945e-01   -6.940602861635645e-02   -1.546446073726870e-01   +2.588387279362405e-01   +5.785809582018372e-01   +4.636508678751457e-01   -2.148671470907496e-01; +2.498357817688039e-01   +3.569694898032146e-01   -7.439989523883521e-02   -1.243041826074618e-02   +2.005747541528898e-01   +6.350466437124888e-01   +2.384560977171543e-01   +3.850823670534731e-01   +3.107916465424148e-01   +1.829694629281005e-01   +2.346375912527999e-01   +2.327197707352286e-01; -1.170151172151934e-01   +2.909323527864687e-01   +4.734509305028413e-01   +1.096927847745977e-01   +2.084578688797927e-01   +4.901193797134019e-02   +6.353861953219650e-03   -2.037538829607806e-01   +2.514755507324157e-01   +6.133986454674501e-02   -8.631393936162323e-01   -2.610649454835016e-01; +2.610552449171385e-01   +2.435959461503663e-01   +3.290642419227279e-01   +4.064886137350374e-01   +4.183152103338501e-01   +5.209638111129991e-01   +3.066750164646189e-01   +1.822485533284951e-01   -7.391469249347783e-01   +4.001160888972071e-01   +2.488240338258008e-01   -4.539802732734013e-01; +1.010828708603489e-01   -1.269379192535955e-01   +6.530140392906982e-01   +3.360020237215451e-01   +1.225207077432387e-01   +3.476033799432880e-01   +4.517164767932356e-01   +6.541086922363401e-01   +5.618861046170657e-01   +1.677303631517408e-01   +9.569469932625951e-02   +2.480604500040588e-01];
L2E_L3E_iAMPA_netcon = [+4.255566494137352e-01   +4.109555231924324e-01   +5.354368014530566e-01   -8.317195637246537e-01   -1.653190615093671e-01   +3.285630841646587e-01   +6.618169529149172e-01   +3.875597600011362e-01; +2.686968257636261e-01   -2.159905680881503e-01   -8.335691197996423e-02   +2.359264969511931e-01   +8.212277892834497e-01   -6.265488182079979e-01   -8.004458302140169e-01   -4.734287636848291e-01; +1.132463825387073e-01   -4.290439414381289e-02   +2.211423402823461e-01   +2.317046959694864e-01   +6.329266494873345e-02   +2.281735209057499e-01   +8.051083912503373e-02   -2.682133004982664e-01; +2.385983481417724e-01   +4.638013050807966e-01   +7.064523436157067e-01   +8.565115599708111e-01   +2.343547828344771e-01   +4.005301956105045e-01   +6.826729005541189e-02   -5.252124221655895e-01; +8.466645414391265e-02   +1.632987691164147e-01   +2.691388584389671e-01   +3.381139878497565e-01   +1.742329834289679e-01   -2.511667115980915e-02   +4.530944623653868e-02   -4.751907966549189e-01; +5.645125162007211e-02   +4.808102563905629e-01   +4.441435081679426e-01   +6.946712477848451e-01   -2.233453014491911e-02   +2.855074970636302e-02   -9.347957702462768e-02   +2.069552376566828e-01; +2.569806108801647e-01   +8.269610261160888e-01   +6.006985466525662e-01   -4.052396687319626e-01   +4.575250325831137e-01   +1.747399973011337e-01   +5.362716349141555e-01   -8.617632933778471e-02; +2.980349225231261e-01   +3.327689323173162e-01   +6.788427642788469e-02   +1.794551218480051e-01   -5.364826361177998e-01   +6.889371318655095e-02   +1.280295778200349e-01   +5.390110959912667e-01; -2.115940089647756e-02   +6.968455566421228e-01   +6.052667563160015e-01   +9.568481834323631e-01   -1.238130419318001e-01   -1.924810539004810e-01   +5.601703529934670e-01   +4.198948432926661e-02; -2.366340077891051e-01   -3.864902130949886e-02   +4.700515918818187e-01   +2.612718420393665e-01   +1.154867389055094e-01   -2.682245380899345e-01   +3.765654828434416e-01   -8.899718615391342e-02; +7.455791996982586e-01   +4.159957220383344e-01   -9.712583911349407e-02   +4.006826885717268e-01   +3.016304267344566e-01   +9.838394524714769e-01   -5.603742326372791e-01   +2.070482123581180e-01; -2.286133769529718e-01   +5.028924517275958e-01   +4.124061343213814e-01   +1.204539153160651e-01   -2.032697412346143e-02   +2.230706168550632e-02   +5.561110426078383e-02   +1.169129844676418e-01];
L2I_L3I_iGABA_netcon = [-2.214983294259700e-01   -8.720266238279138e-02   +1.584568459040755e-01   +2.118305470611096e-01   +2.507558403180872e-01   +6.143831766644492e-01   +3.950705609101925e-01   +3.593580650385980e-01; -3.280384331574949e-01   +2.737179413959264e-01   +1.988012160423258e-01   -1.011163606864174e-01   -1.592659625519034e-01   -1.801901588734063e-01   +3.156697607957081e-01   +1.828864641393171e-01; +5.582377472027987e-02   +1.000000000000000e+00   +4.219986413854752e-01   +3.515230143882105e-02   +2.862071830095038e-01   +4.668065279311864e-01   -2.379887858074275e-01   +5.466714416350526e-02; +9.244774912835031e-02   -8.389133109640001e-02   +6.750400066003468e-01   -5.047961455197382e-02   -1.291380270180476e-01   +2.704303258625472e-01   +4.574832831317706e-01   +3.957356841095179e-01; +7.420238056802356e-02   +2.303690991137609e-02   +2.499340078597506e-01   +3.515889782203561e-01   +2.130178501230184e-01   +2.988510173796198e-01   +4.853973302393838e-01   -7.564304656313087e-02; +1.222188816221579e-01   +4.402872713450909e-01   +1.733647786520618e-01   +2.109766724700576e-01   +4.045196487187566e-01   +2.559213421172166e-01   -3.626084159523464e-01   -8.542425507469820e-02; -2.226158621804965e-01   +8.159288719818790e-01   +2.924264995021094e-01   +3.506919184642611e-01   -2.255830739211534e-01   +1.340469495805677e-02   +7.649777500864243e-01   +3.993192664536994e-01; -2.281320135007149e-01   +5.552730353031204e-01   +3.209995771350546e-01   -4.833915208845069e-02   +1.749795347888696e-01   +5.155870149305328e-01   +2.174355454102680e-01   +6.249828637779794e-01; -6.366176342891861e-01   +9.165606758596659e-01   +4.850997967163426e-01   -4.623163659790078e-03   +1.956675305373874e-01   -4.251278775815982e-02   +1.934105638250690e-01   +1.500815342714304e-01; -1.051841807212421e-01   -2.727287521416744e-01   +3.429213213705264e-01   +2.751711120022053e-01   +4.320666687822364e-01   +3.463595394857384e-01   +1.337250643005525e-01   +1.345227828325081e-01; +4.226909281073383e-01   +1.700743116436250e-03   -5.440416152020470e-01   +4.874112537590385e-01   +3.553962904160676e-02   -1.609939875253013e-01   +2.289371815781307e-01   +3.905987208648762e-01; -2.493819252242202e-01   +4.422121221559958e-01   +1.564950005589592e-01   +1.480363186728743e-01   +4.067323568271815e-01   +4.291095856281589e-01   +1.235453072220865e-01   -4.117077512007136e-02];
L3I_L3E_iAMPA_netcon = [+1.320561358680916e-03   -5.053567658538556e-01   +1.100276660086139e-01   +2.249447025188883e-01   +1.873279653026330e-01   +4.582628133386649e-02   +2.269537574195811e-01   +6.395360896610452e-01   +6.789507017119130e-01   +2.588049687757827e-01   +1.897603283146853e-01   +6.637255388126559e-01; +2.740456432880095e-01   +1.390508148122866e-01   +1.466423400495210e-01   +4.936358468019465e-01   +4.582148399789533e-01   +1.725471177253228e-01   +3.678898183533861e-01   +7.160826373557387e-01   +6.497733353936462e-01   +3.458850732977004e-01   +7.873164180534525e-02   -2.386764883925410e-01; +3.224197970158296e-01   +5.398030927808254e-01   +2.634425834197112e-01   -2.159114838933412e-01   +6.751112085119868e-01   +3.679590867526299e-01   +4.893052870895097e-01   -1.670422914742121e-01   +4.873805287032564e-01   +4.012243769528639e-02   -5.710513484193921e-02   -5.989701099380942e-02; +1.407657468497635e-01   +2.319449774568325e-01   +6.032155258889001e-02   -2.687553054513956e-01   +4.287305918532933e-01   +1.967398346517747e-01   +7.443086035319996e-02   +5.784854030647862e-01   -2.980243002267446e-01   +2.887669127961027e-01   -1.804963851587506e-01   +2.589103647765294e-01; -1.483293801024029e-01   +4.543692509596907e-01   +8.442341134746721e-01   +4.048052655675062e-01   +2.420176682286772e-01   -3.309163230445501e-02   -1.030113626602372e-01   +3.963547264610582e-01   +4.390828217359413e-01   -3.434762990092197e-03   +1.462809925009086e-01   -6.697294755447598e-02; +2.863203268156471e-01   -2.196312711635377e-01   -3.460524333117689e-01   +1.006361967784108e-01   -8.517054421845317e-02   -7.102349188530173e-02   +6.842810653620548e-01   -1.428230292506793e-01   +1.227086675342773e-01   +3.741271931451303e-01   +4.678146831075826e-02   +8.677368805988078e-01; +3.158329543656895e-01   +7.940819854520753e-02   -2.040548324018000e-01   -1.035180832389015e-01   +3.383919834007272e-01   +2.179608604470979e-01   +2.687001248336970e-01   +2.430792898983312e-01   +2.730395768896134e-01   +1.064670205488959e-01   +2.416517107926542e-01   -1.189093449780853e-01; -1.637602008820369e-02   +3.825400652151169e-01   -2.692539752977675e-01   -3.713725628033016e-01   +4.070209185794291e-01   +3.282291880960568e-01   -5.604827457508396e-02   -5.640326492371100e-03   -1.932934448388727e-01   -3.206767506633647e-01   -3.936712297070032e-01   +7.531962034892098e-02; -3.238030982318654e-01   +6.980184584908016e-01   +2.059711500063749e-01   +7.357883218347044e-01   -1.838921864458539e-01   +4.440216169271975e-01   +3.123705096387843e-01   +5.466006553026295e-01   +3.039600686287888e-01   +3.545750268456521e-01   +2.345727176657472e-01   +5.478352202356808e-01; +9.074640353880905e-01   -6.476776021554322e-01   +7.730158204819646e-01   -2.672773382880774e-01   +2.035958958802397e-01   -2.724988967543884e-01   +1.588604972805341e-01   +3.088293725127846e-01   -5.658459812788763e-02   -7.129556183451088e-02   +4.117898988305522e-01   -2.731912331365216e-01; -1.523725209456326e-01   +5.768100649870553e-01   +5.259042516151635e-01   +4.051189673024455e-01   -1.777829290824772e-01   -6.779940445981639e-03   +4.976637748874573e-01   +2.963168917747590e-01   +5.401599397521673e-01   +1.301642572511912e-01   +1.493762242352575e-01   +5.385717497339011e-01; +1.888943615463171e-01   +9.741015526777984e-02   +1.534916114830708e-01   +5.776926557687926e-01   -6.031899202047113e-02   -3.571474464317993e-01   -5.000383515487384e-01   +4.157462374748797e-01   -1.025559857245278e-01   -2.984489988395367e-01   +1.823111646972045e-01   -1.106829969218658e-01];
L3E_L3I_iGABA_netcon = [+3.790453839088760e-02   -1.859882939065218e-01   +5.498006846776980e-01   +2.375819841295480e-01   +4.115877979277123e-01   -1.331196907168862e-01   -3.402994862687759e-01   +2.571948225620178e-01   -1.985590008802732e-01   +4.708200956497695e-01   +4.530723597355499e-01   +3.522812334199756e-01; +3.703996068885012e-01   -2.595991983908309e-01   +2.691198693944659e-01   -2.809936779123245e-02   +6.041372050949116e-01   -1.727271655737706e-01   +1.980248130982374e-01   +9.162779494647433e-02   -3.689653930331744e-01   +2.714176941221716e-01   -6.227787926332482e-01   -8.421919891377319e-03; +1.003106687610915e-01   -1.990960912862763e-01   -5.706454787592317e-01   -1.289441272242199e-01   -2.938377404670087e-02   +2.959532128450754e-01   +6.335365318597669e-01   -8.695538455237634e-02   -8.618781629989028e-02   -2.751133299922296e-01   -3.037270191670842e-01   +1.745401253767699e-01; +3.483891444021662e-01   +2.442993362371800e-03   -3.256507880289172e-01   +7.660680885498812e-01   +8.810345191159841e-01   -2.545926767140135e-01   +4.021490319624327e-02   +6.904315314087923e-02   +9.105533995571322e-01   +4.628679254835157e-01   +3.500959699434432e-01   -2.310019242263697e-01; +7.493573420881564e-02   +3.709745147094327e-01   -2.221544503871277e-01   +2.030923245790546e-01   -8.217217940192589e-02   -2.552310560820079e-01   +9.814670513140802e-02   +4.738209247052769e-01   -3.219089821323240e-01   +7.891618305652207e-01   +5.064463263024708e-01   -2.561345802855017e-01; +4.142219875787805e-01   -6.142614732679597e-02   -2.557914144581250e-01   +6.511780714119253e-02   +5.130678961285123e-02   +2.291003008525335e-01   +3.781794807669051e-01   -9.778929608086204e-02   +1.732878250687726e-01   -3.188130736711350e-02   -2.718446820173630e-01   +1.074440672515708e-01; -2.279768695876671e-01   +4.053763121052927e-02   +2.626145544551122e-01   +7.389726783170641e-01   -1.714917510802252e-02   +5.662541850931327e-01   +3.877725711710280e-01   +6.834383418343604e-01   -1.498368944848266e-01   +2.886215786320418e-01   +3.101062337390976e-01   +3.084911634126301e-01; +1.559432218089958e-01   +3.145194148747039e-01   +6.306453911044649e-01   -8.687928365451605e-02   +3.741033781678399e-01   -4.875781250637654e-01   -7.333165732226850e-01   +6.196019139031224e-01   -3.306684342242325e-01   -5.576827883973777e-01   +7.654612150973142e-01   +1.943735585165234e-01; +3.198115105430900e-01   -4.176965117725696e-02   +6.562660908409067e-01   -2.748731726624916e-01   +4.207144233863573e-01   -9.566061839658038e-02   -8.088785257189652e-01   -1.416611374142325e-01   +2.790527188215582e-01   +2.835319879552547e-01   -7.375981805942006e-02   +5.102423795942865e-01; +4.054905916325379e-01   -1.491537970769827e-01   +3.329474104495110e-01   -5.054353837033179e-02   -7.194762758443758e-01   +7.247658353508887e-02   -3.609108782754497e-01   +4.170158959672903e-01   -2.704042727648699e-01   +2.288340887198673e-02   +1.945729389640477e-01   +2.915243408457397e-01; -1.993862355724970e-01   -1.324180253784955e-01   +8.968194287642578e-02   -2.874577149868400e-02   -1.433705783603057e-01   -7.498638337800803e-02   +3.392335101474623e-01   -1.823480191317137e-02   -2.057423614402908e-01   -6.163649521284024e-01   +2.418764779551734e-01   +3.409768136226150e-01; +1.249731972426895e-01   -2.885780559304349e-01   -6.027244631449230e-01   -1.770852088180249e-01   +9.173738711212411e-01   +1.742841172784761e-01   +3.926010833402251e-01   +4.702417163762601e-01   -1.435345633455243e-01   -5.345073302051649e-01   -7.177698405302357e-03   -6.533625070280451e-01];
L2E_Input1_iAMPA_netcon = [+8.521185379535744e-01   +1.000000000000000e+00   +7.737936687354462e-01   +1.696886542201888e-01   +2.140520969350667e-01   +2.777023804805496e-01   +7.045006500036628e-01   +5.659284955269042e-01];
L2I_Input2_iAMPA_netcon = [+6.997850553432617e-01   +8.058656573830481e-01   +3.425083030626802e-01   +1.877773936391366e-01   -3.895976253494032e-02   +6.389152363455860e-01   -2.828371909446785e-01   -7.700269481111169e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
