function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+6.039967171302925e-01   +4.371314064112823e-01   +7.207688368718637e-01   +2.114135887471821e-01   +4.308900635285429e-01   +9.019603650357895e-01   +8.286040391942457e-01   -1.403801827080765e-01   -4.466366949162671e-02   +2.138732441937365e-01   +5.443638178293040e-01   +5.991050062210278e-01   +3.961752504555570e-01   +3.767745989710269e-01   +8.554780946292773e-01   +4.527856263627545e-01; +4.761921131646206e-01   +1.335159998540177e-01   +4.821359363698751e-01   +3.514379551231184e-01   +4.504186010597136e-01   +1.752003516105874e-01   +3.500559755685256e-01   +6.101471403338707e-01   +9.412369890729347e-02   +7.661363247753152e-01   +5.227180612521227e-01   +7.820445350981248e-01   +9.509398492101163e-01   +1.961105338129375e-01   +7.611936901064937e-01   +4.582443254142566e-01; +1.586728811039014e-01   +3.269827681504747e-01   +6.882761184951901e-01   +8.297371694061441e-01   +8.586383964240725e-01   +2.555885340127848e-01   +2.392233605494497e-01   +5.292619414603342e-01   +2.276412047741086e-01   +5.358948261750401e-02   +5.453898875890827e-01   +8.553852325762192e-01   -4.691935187607508e-02   +1.785525632657166e-01   +7.211453217135804e-01   +1.678489149168533e-01; +4.872158539533596e-01   +8.175899689557611e-01   +6.787845664939598e-01   +8.131374713399183e-01   +2.054518122780540e-01   +5.382363984443825e-01   +9.030620480776571e-01   +4.787379348719809e-01   +8.081355103286091e-01   +4.038645702048968e-01   -2.882728493276788e-02   +5.678360959968232e-01   +5.695780186244159e-01   +8.437636495154313e-01   -1.291999225168231e-01   +4.715710274095134e-01; +3.022858425520368e-01   +7.048006177268319e-01   +2.303928176495694e-01   +3.651137097850515e-01   +3.137863230002796e-01   +2.130811189253478e-01   +4.080624194466892e-01   +4.681736472210669e-01   +8.447511435623174e-01   +3.162127614722003e-01   +5.701209660684672e-01   +5.951787421526017e-01   +2.081239203601307e-01   +6.077777830845007e-01   +5.205472024621665e-01   +2.944028735269001e-01; +8.792021594592713e-01   +8.927461730187995e-01   +5.153252030475480e-01   +2.509101459118901e-01   +1.586513255547692e-01   +6.913205066519643e-01   +7.960042102445868e-01   +2.885916603969781e-01   +2.082726040625498e-01   +6.990598503565808e-01   +3.095148626221486e-01   +7.570840018258738e-01   +6.423773110553858e-01   +5.794074044069325e-01   +8.719322088257383e-01   -4.692078494141994e-02; +5.929688708630267e-01   +6.978710620876607e-01   +5.592670120398209e-01   +4.262353489700039e-01   +5.785625166172067e-01   +3.282339919685249e-01   +5.720096342648754e-01   +1.452828465473234e-02   +1.326896998644883e-01   +1.697869772789264e-01   +4.735379173452284e-01   +3.930689927876874e-01   +8.357072114463493e-01   +5.055111841286672e-01   +6.791971498859068e-01   +2.127059795276844e-01; +5.338558531073103e-01   +5.793777167036503e-01   +1.476713352670289e-01   +2.385845312895252e-01   +3.846444155349595e-01   +2.584363137665547e-01   +6.117727268357690e-01   +3.597071935211011e-01   +1.619705727537219e-01   +2.514905430695956e-01   +5.310879933869704e-01   +4.214660531234738e-01   +1.085874026770983e-02   +6.570209768844419e-01   +3.751609873038725e-01   +5.984109754292995e-02; +7.532835821918513e-01   +3.262166115598487e-01   +7.103166059637795e-01   +9.886536883175656e-02   +7.160197270752976e-01   +5.427778021088540e-01   +6.565239559085868e-02   +3.118806809761706e-01   +4.770577365326051e-01   +2.576894600145013e-01   +4.217150636576438e-01   +6.894390208116588e-01   +7.227998426808699e-01   +6.709775597326846e-01   +5.879329742120551e-01   +7.415581871624927e-01; +9.282153550998457e-02   +7.129750188812977e-01   +4.953340616281144e-01   +3.966544601838307e-01   +5.988812670052472e-01   +9.409796030193777e-01   +5.544304666823765e-01   +4.931143946634148e-01   +2.450431080458390e-01   +1.727326819051279e-01   +3.140162171439815e-01   +5.114467586335807e-01   +2.382970024596913e-01   -7.430840861092378e-02   +3.736812366656481e-01   +3.850403616179986e-01; +2.824532482806815e-01   +1.341225496039827e-01   +3.382291569072808e-01   +4.569240678185747e-01   +6.886920230315668e-01   +7.927177332569506e-01   +7.626872905448788e-01   +3.773199092916651e-01   +9.133933859558943e-01   +3.164710860165569e-01   +5.842988817656010e-01   +5.323407108343757e-01   +1.193411222855152e-01   +1.584856351654360e-01   +6.847585865615646e-01   +1.557611014233476e-01; +4.335626131410749e-01   -3.426623512598027e-02   +2.875810387985951e-01   +3.922732173749290e-01   +2.598363547332597e-01   +7.447075345964592e-01   +3.989043861933327e-01   +9.190971101422970e-01   +7.274604871382951e-01   +7.975596999877371e-01   +4.408169550078992e-01   +7.593058419905818e-01   +4.839428781879382e-01   +3.421636753050718e-01   +6.863422124385491e-01   +7.146257720868722e-01; -2.825618756060582e-02   +1.590861881999149e-01   +8.347235024033983e-01   +3.726519653353671e-01   +5.797372205983946e-02   +6.853577877224031e-01   +6.287144597104533e-01   +5.803203450854238e-01   +8.499389605265141e-01   +8.974908400215182e-01   +2.383578792850290e-01   +6.775794779340203e-01   +6.890271731116264e-01   +5.667077530444494e-01   +8.749108143257309e-01   +3.670048532684145e-01; +5.786110977065907e-02   +8.687498872655918e-01   +4.805976128292438e-01   +1.767279273226546e-01   +3.753429583948078e-01   +6.406669043701904e-01   +5.887820918112816e-01   +8.068358883817437e-01   +1.588766732334939e-01   +7.807574998647598e-01   +6.579530398646486e-01   +3.790749317399358e-01   +7.117925730902025e-01   +6.076225699531800e-01   +1.597038557679308e-01   +7.825373494621748e-01; +8.430787209357918e-02   +3.440906342109323e-01   +8.135256409654391e-01   +4.173059356549876e-03   +1.590563444943204e-01   +2.848230010811191e-01   +8.639667263102866e-01   +7.063492308573038e-01   +9.080882881619105e-02   +9.379476158497008e-01   +2.550875308969414e-01   +2.169787398913672e-01   +3.866684038063610e-01   +8.955510686205854e-02   +4.561789607785147e-01   +5.176665343368904e-01; +5.050646708470105e-01   +7.519535713106152e-01   +7.624229352439915e-01   +6.906951562575517e-01   +8.002990674876710e-01   +4.581179174575677e-01   +2.415578116299478e-01   +5.846380995892637e-01   +5.788598175971418e-01   +8.403573963584885e-01   +1.901121170044732e-01   +4.768148969959436e-01   +4.200446762277090e-01   +8.218559305424313e-01   +6.073865440181295e-01   +8.159013639382222e-01];
L1E_L1I_iGABA_netcon = [+4.422589654285364e-01   +1.829337729293625e-01   +1.509830495789613e-01   +4.259675195406374e-01   +3.131363652017429e-01   +4.131849829359241e-01   +3.303026660483895e-02   +3.785895138738457e-01   +5.761039412731853e-01   +2.712604173112941e-01   +5.621411579090883e-01   +5.770537398616027e-01   +9.488163175769647e-02   +5.095900568257190e-01   +5.668648121921835e-01   +1.363816037255581e-01; +2.583472283721315e-01   +5.402440739212189e-02   +7.368243676243551e-01   +4.958377700838691e-01   +4.007385981832174e-01   +2.286026331829777e-01   +5.769219525779524e-01   +3.761834779511389e-01   +1.450129497580483e-01   +3.015991933600837e-01   +2.634961522581558e-01   +4.062472821230128e-01   -7.083582332265355e-02   +2.769397919141904e-02   +5.264653922978194e-01   +3.141834457869034e-01; +5.635685332341462e-01   +3.225994787638403e-02   +5.188888425668795e-01   +6.548711291779741e-01   +6.116571010096489e-01   +4.653816566977617e-01   +4.444488951184118e-01   +6.146915510480684e-01   +2.240151459121749e-01   +2.955941387015675e-01   +5.063728225250010e-01   +2.871293987488333e-01   +9.722165210949741e-01   +5.344131665599290e-01   -5.209567419576951e-02   +6.059630299303681e-01; +2.165895447829277e-02   +8.124547173532197e-01   +6.046206470499077e-01   +2.649902429252506e-01   +6.383483461103099e-01   +6.579866340624275e-01   +1.114117055833628e-01   +4.928180389239067e-01   +1.765690571057148e-01   +5.460367452601277e-02   -5.919365947422573e-02   +3.206878332886662e-01   +1.398320547791255e-01   +4.083764674143881e-01   +1.956481059679567e-01   +5.609370286812547e-01; +1.774539450527600e-01   +1.590711988731232e-01   -4.314515180862372e-03   +3.242833131316469e-01   +1.934692936414877e-01   +5.680210892680625e-01   -5.528694492822378e-02   +1.122917995346669e-01   +1.389712559656090e-01   +1.106790935764436e-01   +9.310952211740556e-02   +7.340179513678465e-01   +3.580143885251557e-01   -6.664675545469290e-02   +6.231093256481118e-01   +9.155092732929290e-01; +4.660590007212243e-01   +8.630046508485009e-02   +2.963326858904222e-02   +1.318776342681077e-01   +7.270425928364727e-02   +5.196420577086610e-01   +1.190611531149278e-01   +7.236526330296008e-01   +4.694189781543590e-01   +8.318711130849837e-01   +7.486267541631637e-01   +8.131136179774403e-01   +5.238765395065789e-01   +5.065752854239275e-01   +3.654576259287007e-02   +3.699163411985478e-01; +6.513351886880020e-01   +8.629133119539574e-02   -5.406357376020832e-02   +1.033124750037176e-01   +7.161810981052761e-01   +5.423662675301411e-01   +6.491108994741667e-01   +5.466719720660078e-02   +2.517949464956720e-01   +8.568204502294570e-01   +9.286278395695274e-02   +5.597967594072859e-01   +4.903189721450764e-01   +5.255305001215478e-01   +3.722184639016076e-01   +1.659918965844484e-01; +4.838982197695292e-01   +1.599057493205999e-01   +6.133635868248017e-01   +9.572249817929162e-01   +2.222253201895052e-01   +4.924533054821121e-01   +1.390492467866284e-01   +7.751665445189113e-01   +3.684834722107594e-01   +3.421622241988871e-01   +1.029930123123073e-01   +7.537863221507823e-01   +5.327050516715907e-01   +1.830422668978560e-01   -1.523107555572078e-02   +6.998693726161046e-01; -2.599298952922980e-02   +7.527453392062152e-01   +4.860645677963306e-01   -1.606581863181024e-02   +6.402782098985619e-01   +3.528781857787359e-01   +4.181122689312071e-01   +4.115969399136676e-01   +2.309705961253774e-01   +8.725341708935226e-01   -1.100626042020353e-01   +8.509966167129820e-01   +1.898214558907504e-01   +2.193736181471123e-01   +1.282168606283818e-01   +4.278146069879335e-01; +2.480898658430617e-01   +5.652915068126070e-01   -1.147012112643189e-01   +1.383340919726348e-01   +6.562367830743709e-01   -4.946995256349855e-03   +5.501422569714622e-01   +8.324673923614905e-01   +7.301100146179634e-02   +6.887480512049461e-01   +2.086716494225686e-01   +7.797908577513024e-01   +2.325440085678335e-01   +3.067516457461074e-01   +3.117381421688796e-01   +8.779905778747522e-01; +8.181352562696681e-01   +5.978940980953802e-01   +6.033447734293867e-01   +7.509823830386471e-01   +7.193908083190712e-01   +4.750343074957872e-01   +5.986641355576263e-02   +1.579248307437421e-02   +4.520448092805068e-01   +6.740983529470351e-02   +5.128850061818319e-01   +4.353822795563925e-01   +2.000252861435186e-01   +9.391164082515654e-01   -1.924631986842825e-01   +5.879198842556865e-01; +9.220713158875446e-02   +5.316520325308262e-01   +4.732993835652892e-01   +7.667784921050290e-01   +9.317672942787188e-02   +2.363435245200140e-01   +3.333718681744038e-01   +4.407211071182357e-01   +8.455928208477019e-01   +3.444586852356016e-01   +6.475940580294963e-01   +8.064867367970826e-01   +2.077239996876720e-01   +7.321630123213853e-01   +5.949988325820268e-01   +4.384468679631915e-01; -2.760913013657472e-02   +5.518483284678848e-01   +7.476366371108248e-02   +5.379005517193028e-01   +1.509401671484613e-01   +5.570580733909307e-01   +4.502626027194357e-01   +4.847194953125936e-01   +4.528170019238589e-01   +6.035250992830705e-01   +3.338666058284281e-01   +8.476366778310404e-02   +3.022619345062705e-01   +1.263874537061277e-01   +2.524123617841922e-01   +7.986546180581330e-01; +8.615876664107767e-01   -9.140770864003476e-03   +5.996695707745874e-01   +6.066777922942596e-01   +4.402501263399391e-01   -5.695302701950364e-02   +3.251490736448712e-01   +1.152713470113608e-01   +6.216739365335266e-01   +1.193826647479495e-01   +4.023263582845437e-01   +6.458618984350503e-01   +4.643937752312399e-01   +8.128486243886965e-01   +2.576556492452767e-03   +3.198492517602563e-01; +1.865137332073663e-01   +4.356073127431695e-01   -1.648886545219900e-02   +6.935329155278191e-02   +5.504423928121883e-01   +3.715656191350851e-01   +7.997608204230066e-01   +7.148688323609643e-01   +7.433914476345310e-01   +7.124292943070534e-01   +6.234048427180161e-01   +4.191476200679425e-01   +3.345605984209848e-01   +1.309358301831442e-01   +3.144391458011830e-01   +3.052665470188048e-01; +3.746998981607378e-01   +1.884279845549513e-01   +5.833514431114319e-01   +1.102434045979545e-02   +4.815605790930336e-01   +7.055098668062155e-01   +4.510606152939922e-01   +1.493167310998166e-01   +7.071698089765707e-01   +8.585371030738194e-01   +6.626126041088336e-01   +5.752579796427936e-01   +4.962192839965874e-01   +2.430916449613601e-01   +7.082275200556996e-02   +4.536685295897405e-02];
L2I_L1I_iGABA_netcon = [-1.464442272654377e-03   +5.390653261386257e-01   +6.392522574964428e-01   +4.489938504502287e-02   +5.971130398362909e-01   +2.629225164482659e-01   +5.237035157724884e-01   +6.692880868440392e-01; +7.756555638908236e-02   +2.554643442141453e-01   +2.686924426784447e-01   +1.824783200507367e-01   +7.727756240173839e-01   +1.795549757679116e-01   +5.939585389444957e-01   +7.716438370069126e-01; +6.414770126964037e-02   +5.934574659279455e-01   +4.854459040703274e-01   +4.799493505713746e-01   +4.516627067758922e-01   +3.235952617877632e-01   +1.936974228270208e-01   +1.123905843429476e-01; +5.098273839931845e-01   +3.626730763207606e-01   +5.105675968536502e-01   +8.151470948433488e-01   +2.892299645669715e-01   -1.995964080280790e-03   +3.443461449143991e-01   +9.368017563070438e-02; +8.983079431502541e-01   +1.566465063940096e-01   +3.136523784409689e-01   -8.277530620630288e-03   +5.931572356549137e-01   +1.496261462102712e-01   +1.000000000000000e+00   +2.346841080078167e-01; +4.433055687373328e-01   +4.375879812789490e-01   +6.557465444092814e-01   +7.750719340208542e-01   +7.897593899917180e-01   +6.373350727659978e-01   +2.131136661498317e-01   +6.284311169513622e-01; +8.375559735333176e-01   +1.109588608319411e-01   +3.605759780266801e-01   +1.933716412514558e-01   +5.394374922640853e-01   +3.289236832023693e-01   -8.200933202050270e-02   +5.410150799241904e-01; +5.379386764083546e-01   +4.141609697819143e-01   +5.607580478249279e-02   +6.826253359737751e-01   +7.071355376426653e-01   +7.452256970216025e-01   +4.095573770713751e-01   +3.045007801203450e-01; -9.831399225195159e-02   +5.173869539557396e-01   +4.970268218092807e-02   +3.581720999440384e-01   +3.138485539354749e-01   +5.663015662437738e-01   +5.527495445644733e-01   +1.870896835643824e-01; +6.531152848770125e-01   +8.346285515468981e-01   +3.484162120384836e-01   +5.967329160286786e-01   +1.472289011765479e-01   +1.305472152243045e-01   +4.529437724819876e-01   +2.990887253277607e-01; +3.077975083797453e-01   +1.740580306921300e-01   +5.925001480794533e-01   +5.259118480108279e-01   +5.423971556506119e-03   +6.676381265507196e-02   +4.117550403777783e-01   +6.499725168237523e-02; +1.633732075897765e-01   +1.589991833789877e-01   +2.447926207786741e-01   +5.123995719727549e-01   +1.077564173676983e-01   +4.005335476548549e-01   +2.258754529096485e-01   +7.149360356914533e-02; +6.926606258219058e-01   +7.375813791595865e-01   +1.983327589061945e-01   +5.094358022574348e-01   +2.848067486799892e-01   +1.877041607061770e-01   +5.761346811219231e-02   +7.019724454455663e-01; +3.919369025774167e-01   +7.826037323780712e-01   +6.308726370325471e-02   +2.446664615672993e-01   +4.089813334122517e-01   +5.500061552654683e-01   +4.957960433619946e-01   +5.288932405667407e-01; +2.736684843338994e-01   +3.008357461551104e-01   +4.044630799046398e-01   +2.317674770033706e-01   +5.654091350148950e-01   +2.033431388376947e-01   +6.472671343890436e-04   +3.734658475056433e-01; -1.246767839240270e-02   +1.850537069196455e-01   +3.280979959408112e-01   +3.709587595737022e-02   +5.296907997593717e-01   +7.276786940993090e-01   +2.658517704031805e-01   +2.695989917317407e-01];
L1I_L2I_iGABA_netcon = [+9.743082361464910e-02   +6.162082055090818e-01   +2.396954012094186e-01   +2.617321840836827e-01   +8.196712317661385e-01   +7.923129067324199e-01   -1.550314034157624e-01   +2.122486216487448e-01   +4.143261182723480e-03   +7.211256812053911e-01   +6.752062783526365e-01   +3.852603783051378e-01   -7.237709411002123e-02   +2.643493983081630e-01   +7.423360170140333e-02   +6.827919300381865e-01; +8.604381533546953e-01   +5.503920281428173e-01   +4.200871881455505e-01   +3.710153082013185e-01   +1.756317268538134e-02   +2.897787240588096e-01   +5.673999828338199e-01   -1.220606525866825e-01   +2.987476209341788e-01   +2.762872731192247e-01   +4.669476737455276e-01   +1.031783550395143e-01   +5.514287027960600e-01   +6.408245303643169e-01   +1.000000000000000e+00   +1.371031655594259e-01; +4.625538348686198e-01   +4.718590432505317e-01   +8.053756303319916e-01   +4.466796885284851e-01   +1.403244772900842e-01   -9.050977980750970e-02   +7.294493977699236e-01   +5.166961297364928e-01   -1.891866268152770e-01   +5.898218474053117e-01   +2.343689578062990e-01   +3.785397525451238e-01   +7.927089386836661e-01   +6.555838256905354e-01   +1.452597535029989e-01   +1.673785646757818e-01; +6.848421590072269e-01   +5.261590397220550e-01   +4.851282793589943e-01   +3.351384112788462e-01   +6.802744722031472e-01   +4.969730782705606e-01   +4.206675675991134e-01   +1.163284943305308e-01   +5.027341795839185e-01   +3.265687748305135e-01   +2.768066309930406e-01   +3.184578066014949e-01   +3.300840521072665e-01   -1.650726879076161e-01   +7.294289582407332e-02   +4.291965178486555e-01; +7.848260168807660e-01   +4.313162009992079e-01   -3.109016147324160e-02   +8.662740637069751e-01   +5.945345483461527e-01   +2.670729589798195e-01   +5.577621328485567e-01   +1.370988881918834e-01   +8.006324100958716e-01   +4.736969727235645e-01   +6.641728949381828e-01   +7.853642510154945e-01   +8.226556883163667e-01   -3.292368952084353e-02   +5.340509972711728e-01   +6.869417037038492e-01; +3.686876720436916e-01   +2.618401525824371e-01   +8.375234690132463e-01   +1.865296996034462e-01   +2.221145531758834e-01   +4.124630887504859e-01   +5.862682354844475e-01   +6.779208634232468e-01   +5.244208265956800e-01   +5.271259240298429e-01   +8.361016783532152e-01   +6.319193614914004e-01   +5.158662367037851e-01   +2.581518741554438e-02   +2.678486278318077e-01   +8.444893579533947e-01; +3.648922717393448e-01   +1.620935170837514e-02   +1.538560034152076e-01   +7.087536294436203e-01   +4.496140437422139e-01   +5.471560691204803e-01   +2.390286745462484e-01   +3.627591435639181e-01   +2.527911634065749e-01   +2.104751917568776e-01   +3.630506900620063e-01   +1.724287925664342e-02   +6.060112010377282e-01   +4.269584611229907e-01   +6.364004301450794e-01   +8.099697781702388e-02; +4.383120051649620e-01   +6.360729464686360e-01   +6.849881321937528e-01   +2.916789169075522e-01   +5.591154363126979e-01   +1.842910865362079e-01   +1.759832794395570e-02   +5.635086259600646e-01   +6.000226807983392e-01   +2.883466810786250e-01   +1.525976468777995e-01   +7.773491625427160e-01   +4.206919125354353e-01   +7.601390083613795e-01   +2.578730889385058e-01   +4.027509693225598e-01];
L2E_L1E_iAMPA_netcon = [+3.020457085155352e-01   +5.327672228390328e-01   +6.538871663911819e-01   +4.936909869624636e-01   +3.823916979508635e-01   +6.883504401551953e-01   +7.066583090544187e-01   +2.289221250190810e-02; +2.536203568421549e-01   +2.473215856976329e-01   +1.539147431631974e-01   +1.303317863376588e-01   +3.992888838499792e-01   +4.609900469980268e-01   +6.971246713643692e-01   +1.459678781766637e-01; +1.587087173583722e-01   -1.289644079745189e-02   +9.213637974541893e-01   +4.373874631449590e-01   +4.152438650767782e-01   +4.031374500414881e-01   -1.557967650141925e-01   +4.184430131856644e-01; +1.058449170671631e-01   +1.795840869909347e-01   +8.098397566834669e-01   +2.089156506678756e-01   +3.888824962182176e-01   +7.454682692708103e-01   +2.414389812784271e-01   +4.072595530467580e-01; +6.031577780441906e-01   +1.064096197704604e-01   +6.006704296312232e-01   +7.024063841696262e-01   +2.351442756951299e-01   +5.383467792292468e-01   +5.804894812617312e-01   +7.648733818225207e-01; +7.392619011787661e-01   +3.886546834032587e-01   +6.602112819104272e-01   +5.020181089654836e-01   +1.998720346652082e-01   +8.413348036633708e-01   +6.591243856251120e-01   +9.227700573814128e-01; +8.234456488158917e-01   +8.165707303022609e-01   +8.069525354442851e-01   +1.276809790748212e-01   -2.169000346158203e-02   -1.486567500470105e-01   +7.529039866200397e-01   +7.763041760830833e-01; +5.843564971024180e-01   +8.915260972859030e-01   +5.346882587437420e-01   +4.380910472353532e-01   +4.212745417647884e-01   +6.741999131023872e-01   +6.816136829079388e-01   +5.171252975409859e-01; +7.901339785465250e-02   +2.813737365460944e-01   +5.753387932176545e-01   +4.765208693461566e-01   -3.801627826184174e-02   +6.378788039027904e-01   +6.321978236732683e-01   +1.000000000000000e+00; +1.313080267186406e-01   +1.028129665633103e-01   +4.083541822406374e-01   +2.378052425563638e-01   +5.929153386654860e-01   +2.533898183357188e-01   +3.479089494221986e-01   +6.750562183022343e-01; +5.760763402968354e-01   +8.040481688120378e-01   +4.655084169465692e-01   +1.438189621985981e-01   +2.262591560809944e-01   +7.361507925827641e-01   +6.513993008418280e-02   -2.141495218365037e-02; -1.039462227028343e-01   +4.895593870144869e-01   +6.905544395961644e-01   +1.835042038948019e-01   +2.544030541689172e-01   -4.177989789310544e-02   +5.920011478997964e-01   +4.282069659063805e-01; +2.592928446177798e-01   +6.047704602563917e-01   +9.554758785591443e-01   +6.961798473237694e-02   +4.073779875119468e-01   +1.432760447219833e-01   +4.264323795824917e-02   +6.864927671823601e-01; +3.230398924957009e-01   +2.835208814226547e-02   +2.904989318013608e-01   +6.675704916733594e-01   +6.825524989664905e-01   +7.182662620204555e-01   +2.145777554145933e-01   +1.340887350606887e-01; +5.854029386007445e-01   +5.783412896894859e-01   +3.405518062254815e-01   +6.377747047171525e-01   +5.809258286982455e-01   +3.510024163830877e-01   +4.644296092997864e-01   +6.647573588812224e-01; +3.559663184174702e-01   +6.265381207880382e-01   +6.682163997988851e-02   +5.238499530180686e-01   +1.593966296607702e-01   +5.114944187651335e-01   +3.752474031230750e-01   +3.423451723204029e-01];
L1E_L2E_iAMPA_netcon = [+6.848092495642514e-01   +4.757843030751243e-01   +5.101613011899638e-02   +5.094130024987565e-01   +8.292653156150526e-01   +1.834205487158603e-01   +3.000978792078735e-01   +7.516243703757711e-01   +6.443336729381081e-02   +3.207849215349761e-01   +5.148887346201491e-01   +8.554371299725099e-01   +9.006326701010278e-02   +9.576490871466435e-02   +7.346500787954255e-01   +2.688924652604787e-01; +4.510515271850572e-02   +7.171781617354693e-02   +4.245579155127593e-01   +2.218883871493445e-01   +3.242937530502937e-01   +2.854492268920629e-02   +3.465857150000203e-01   +2.537121440516248e-01   +4.755802908056661e-01   +1.000000000000000e+00   +4.865334576538029e-01   +1.169070055792211e-01   +9.287904395591167e-01   +8.519383825685283e-01   +5.521795744607780e-01   +5.285255238227685e-01; +1.734334208320575e-01   +7.151520504997233e-01   +2.473514795206459e-01   +8.700834724216726e-02   +6.237745864614668e-01   +9.823379242861441e-02   +7.734505432658139e-01   +6.873961364110006e-01   +6.190766549518464e-01   +4.375681203239853e-01   +6.243517935722689e-01   +2.272274798394652e-01   +4.796324199671894e-01   +3.393248599876447e-01   +1.227342340487810e-01   +3.986679731510509e-01; +7.317484715466434e-01   +1.902647526994021e-01   +4.359774955488167e-01   +1.148908756165214e-01   +3.772425496740950e-01   +4.149531466390915e-01   -1.928257353544137e-01   +1.130231780183450e-01   +7.032839942657270e-01   +1.673931416259917e-01   +3.838129517768109e-01   +1.209007540099453e-01   +5.255778721193706e-01   +6.899886676365938e-01   +4.475058537993197e-01   +5.710682613761541e-01; +4.534232598010888e-01   +2.531133871993573e-01   +1.648388204201281e-01   +3.906816873489746e-01   +4.249516391700821e-01   +5.611695038624270e-01   +3.668236382373470e-01   +3.948537668372395e-01   +3.096678332711494e-01   +4.844861925426062e-01   +2.795793509566889e-01   -6.990978100803261e-02   -4.877074577482862e-02   +7.374879284552985e-01   -8.432295979437747e-02   +7.397324703185719e-01; +8.232866284770941e-01   +7.892748301176970e-02   +1.243731274388184e-01   +6.170236917765868e-01   +1.184649616908773e-01   +1.539521012205056e-01   +5.238955799320419e-01   +1.105011516937991e-01   +3.755509701666557e-01   +2.712088079363071e-01   +4.014656343190386e-01   +7.436651440069331e-01   -2.215793851350934e-01   +2.008868182078572e-01   +3.539281675713803e-01   +6.097363983255975e-01; +3.698974697821271e-01   +1.176983461728225e-01   +2.713560366930635e-01   +2.240998169669500e-01   +8.636291237422432e-01   +5.280812833673677e-01   -8.084076034400851e-03   +4.879404328753161e-01   +3.282448302114241e-01   +6.661977767184268e-01   +4.502282472210709e-01   +1.361856886164938e-01   +3.699660181382764e-01   +1.746466355480815e-01   +5.129924147604580e-01   +1.161190316771940e-01; +3.736714918972742e-01   +2.071670647991529e-01   +6.285884156451518e-01   +2.971815196032184e-02   +6.598097626945848e-01   +1.706431949025278e-01   +2.609767602230331e-01   -1.227878074792604e-02   +5.748593767947171e-02   +6.721873473921115e-01   +3.874237421160986e-01   +1.465259279147441e-01   +7.219759089100994e-01   +5.818151452975361e-01   +2.155371488143948e-01   +1.608066558054883e-01];
L2I_L2E_iAMPA_netcon = [+5.426054106761928e-01   +7.945437057120019e-01   +2.117226313220856e-01   +6.537407178865398e-01   +7.958416292453449e-01   +6.796598549089207e-01   +5.033230068240102e-01   +2.833220409876788e-01; +1.000000000000000e+00   -3.658003738063000e-02   +4.678011686450804e-01   +2.110030621545992e-01   +7.332324199557307e-01   +4.745108589012643e-01   +3.774683826992348e-01   +8.584974240265439e-01; +9.539063440782634e-01   +3.514693233506923e-01   +7.239363745731049e-01   +5.406073188437477e-01   +1.424068653814850e-01   +6.576653140865762e-01   +9.200253584554018e-02   +6.791425109777479e-01; +3.946500522215587e-01   +8.298343481994704e-01   +3.715278836449148e-01   +3.017928542796855e-01   +4.641925278062841e-01   +4.195353045556437e-02   +1.281878513762639e-01   +4.220877086222993e-01; +4.219152254867872e-01   +3.912664024638716e-01   +5.048030592428193e-01   -2.746021713639253e-02   +6.952467315589432e-01   +1.534851488722687e-01   +1.865927241654051e-01   +6.034349886423497e-01; +2.893354187104463e-01   +2.107080103903677e-01   +5.296531147398623e-01   -8.415898813181667e-02   +5.248929674024615e-01   +6.317652650448515e-01   -1.045153955176343e-01   +3.934278416511101e-01; +2.565883169068287e-01   +8.372821102079496e-02   +5.126606554766638e-01   +4.872732188794012e-01   +1.806832811023731e-01   -1.912907134313830e-01   +2.286736281177800e-01   +5.439816223885593e-01; +3.777877058401892e-01   +4.605229257601192e-01   +4.766117027601485e-02   +6.297395029952847e-01   +3.319681019322923e-02   +7.822901961847124e-01   +2.572305335198057e-01   +6.757977382551478e-01];
L2E_L2I_iGABA_netcon = [+8.030183093747002e-02   +3.954496140916559e-01   -9.999167952559829e-02   +8.419754353402173e-01   +4.616716230752561e-01   +9.373109857737291e-01   +7.836535968530792e-01   +2.037902548916573e-01; +5.722890223473491e-01   +5.917677592608542e-01   +3.899280088071659e-01   +4.505837369707318e-01   +5.726114254248131e-01   +4.121495224626088e-01   +2.106135168985770e-01   +9.855902361244387e-01; +3.428191471625334e-01   +3.174317661480289e-02   +6.550764275223212e-01   +6.048497278741570e-01   +2.181713375596765e-01   +3.142460598310480e-01   +1.489823951737701e-01   +8.891599859624748e-01; -1.171441610013286e-02   +7.328349300232166e-01   -4.502748478163112e-02   +7.368375337498458e-01   +3.626742107830964e-01   +4.678844664924011e-01   +8.081567525583847e-01   +8.713394218309474e-01; +4.572287948412606e-01   +4.179590675998234e-01   +2.204161771619185e-01   +2.987899749438407e-01   +6.879320909240519e-02   +6.326734235562950e-01   +1.769733150486495e-01   +8.393409030845021e-02; +7.590406398150145e-01   +8.111466048590465e-01   +9.100885880610002e-01   +9.384014802309574e-01   +8.298392741436044e-01   +4.889965592738194e-01   +2.976759682512783e-01   +4.655324152070340e-01; +9.578848982765756e-02   +2.432151381688356e-01   +1.838306671196026e-01   -1.139652530458266e-01   +2.747041994500996e-01   -7.718277388950594e-02   +2.112241343446467e-01   +6.235619767397174e-01; +3.458480960960086e-02   +6.557496652422334e-01   +6.542887115003402e-01   +1.342245463276793e-01   +4.226927195625942e-01   +6.006967649363728e-01   +4.765344872639978e-01   +7.501704962326295e-01];
L3E_L2E_iAMPA_netcon = [+4.737158301324328e-01   +6.276718259895807e-01   +5.711038909289018e-01   +1.130351488782573e-01   -7.129420826055123e-02   +9.363279969966999e-01   +8.615780085087049e-01   +8.229404438306209e-01   +5.719726639284016e-01   +1.362499582446707e-01   +3.820788547528815e-01   +2.236100865311243e-01; -2.665094746113296e-02   +9.104389053431615e-01   +1.534403931850760e-01   +1.085943594841165e-01   +4.545828375981805e-01   -1.861633981295762e-01   +5.504341204803197e-01   +2.384477554002220e-01   +3.932869132518459e-01   +5.172502783260012e-01   +5.602454726379191e-02   +2.057986211718389e-01; +3.185273492308551e-01   +2.126824252407516e-01   +3.206401915888681e-01   +5.646314142569340e-01   +4.030846211581635e-01   +7.598149333158496e-01   +7.018843982476273e-01   +8.655896109786774e-01   +6.413899175345593e-02   +7.810582241724960e-01   +5.334635915519755e-01   +7.217585396599546e-01; +7.738097223727509e-01   +4.833036613882675e-01   +7.458949030190587e-01   +6.035965776897647e-01   +3.332251129853674e-01   +1.000000000000000e+00   +4.075103884687633e-01   +2.182829920492030e-01   +6.048370429887533e-01   -1.784742211750749e-01   +3.361039210585583e-01   +7.349810087071139e-01; +7.096316152838118e-01   +3.692698739579617e-01   +3.861168051930216e-01   +5.170098164167476e-01   +1.537213488410184e-01   +4.540525033813237e-01   +4.549701882266319e-01   +7.038021930276976e-01   +9.154915402637516e-01   +3.173988820086508e-01   +7.112713854611543e-01   +2.286037632377564e-01; +3.073811633345832e-01   +2.929364469995827e-01   +4.584431790147904e-01   -1.736456824958211e-02   +1.668255699431307e-01   +4.523596117083433e-01   +4.304493285792698e-01   +8.058720766104973e-01   +4.963706372223220e-01   +5.208675427574035e-01   +5.273300010514638e-01   -1.321399845565217e-01; +8.875965665748679e-02   +1.060470539461732e-01   +2.283221500929467e-01   +3.875504676202069e-01   +9.555823985565887e-01   +7.334703497947446e-01   +7.301967479883470e-01   +3.171401108702240e-01   +5.521299846097598e-01   +3.473710837328475e-01   +3.430211989254942e-01   +4.179501311195573e-01; +2.089475705224376e-01   -7.758081475426011e-02   +6.647952915911168e-01   +8.106754250332977e-01   +5.205031260817848e-01   +7.801004110440927e-01   +6.325344976156898e-01   +2.991180796855856e-01   +6.233215114608081e-01   +1.787392110650168e-01   +1.616230626868194e-01   +3.654989549973511e-01];
L3I_L2I_iGABA_netcon = [+8.692502818123758e-01   +2.492776037187905e-02   +4.987880590338413e-01   +8.157872600451415e-01   +2.712398256059622e-01   -5.380036421001372e-02   +1.525778165546229e-01   +2.494943908203244e-01   +3.321005518756998e-01   -7.698626957609916e-02   +1.535090153467442e-01   +9.229178750952730e-01; +8.203126852124023e-01   -1.734433302406176e-01   +1.534045134460443e-01   +6.388178218342635e-01   +8.354045836549401e-01   +4.443974791506823e-01   +5.400637491488263e-01   +3.938987513831345e-01   +2.427982229814089e-01   +6.548324939893929e-01   +1.424067903419630e-01   +4.368674178300638e-01; +8.441759244879395e-01   +2.090243729573427e-01   +7.145821516355561e-01   -1.216606704817697e-01   +6.967519827190936e-01   +1.526754564781096e-01   +5.512251756257019e-01   +1.265690220849860e-01   +3.658811696507311e-01   +4.989572122638697e-01   +3.916258542230627e-01   +8.999771897194817e-01; +5.378747780150215e-01   +3.175246983755998e-01   +8.754138936502014e-01   +8.698247180994060e-01   +7.533346066089081e-01   +2.957911778365603e-02   +7.209097868703871e-01   +1.636151084233574e-01   +8.427268236576562e-01   +6.512474667324829e-02   +2.420475274851517e-01   +5.755290386419029e-01; +2.870134925390599e-01   +2.277595902590371e-01   +5.830725248585035e-01   +2.904315044304281e-01   +5.873239556288484e-01   +8.629073401029645e-01   +4.520254855358951e-01   +1.211147580774495e-01   -1.124139053435980e-02   +1.867861053091084e-01   +9.499436766431467e-01   +1.564367607993567e-01; +9.211904317398125e-01   +3.260979842858385e-01   +5.502402301256301e-01   +9.611575854978015e-01   +5.923607951572554e-01   +3.258762731683981e-01   +3.955457258004138e-01   +1.105043964390231e-01   +4.454842806113735e-01   +5.732701073820082e-02   +2.154143884822955e-01   +2.706378494249534e-01; +6.973881642077127e-01   +6.311764591653917e-01   +7.572565141580309e-01   +4.265153582458800e-01   +3.237234583119541e-01   +6.111395254523249e-01   +4.197772431141263e-01   +6.450264552670446e-01   -4.092559393535741e-02   +9.608253824422776e-01   +3.757389512036735e-01   +8.340545361000659e-01; -7.360042807799223e-02   +2.875778922553586e-01   +6.073678784569172e-01   +5.532574129590085e-01   +1.283850736486880e-01   +2.423383379760253e-01   +1.458285911558824e-01   +4.692262622750346e-02   +6.314712715150590e-01   +4.728057032681817e-01   +3.008766483583039e-01   +1.658963860229136e-01];
L2E_L3E_iAMPA_netcon = [+3.735000488323773e-01   +9.089339947802867e-01   +4.193888266217842e-01   +7.118113524592592e-01   +3.879269702595695e-01   -2.793876146520377e-02   +4.092480891521162e-02   +3.724292348745105e-01; +4.048149469386798e-01   +4.549912540370400e-01   +5.574696858488895e-01   +2.137794837344265e-01   +2.567806955107394e-02   +2.833912306959284e-01   +7.115422812808539e-01   +5.699115573961080e-01; +9.896327985599075e-02   +1.880124270120999e-01   +9.144089055504057e-01   +9.243723257755231e-01   +5.513793766578866e-01   +2.072174047441575e-01   +4.152191227680398e-01   +6.333438569852828e-01; +2.448449217743236e-01   +3.586359825980211e-01   +1.055145470540711e-01   +4.830040386648013e-01   +2.875375855640309e-01   +5.959164157456176e-01   +6.278828096330349e-01   +8.461526769826185e-02; +3.172877654352214e-01   +7.439071379416605e-01   +6.282851821513591e-01   +8.111517665637131e-01   +6.854523231134207e-01   +3.593502971403241e-02   +1.116032028321889e-01   +9.237409451484321e-01; +8.908499755173166e-01   +6.731952939203630e-01   +3.585900546056320e-01   +3.917162658207694e-02   +4.185776060947373e-01   +7.261929231904218e-01   +4.888940670485122e-01   +7.445480695127931e-01; +5.153986414664663e-02   +4.012017729730666e-01   +2.782884327336536e-01   -9.093768227956495e-02   +2.365593586418513e-01   +3.545861622886391e-01   +2.473879975269249e-01   +1.737989608125343e-01; +5.555595385639754e-01   +4.917418744819566e-02   +8.941636912773500e-01   +1.658740198024825e-01   +1.742720036649230e-01   +3.040974462730338e-01   +1.769828713110730e-01   -5.606116137013537e-02; +5.133781557148079e-01   +7.256498306993605e-01   +5.601938942233491e-01   -1.580429224750059e-01   +3.976687512621140e-01   -1.669468690575755e-02   +5.108595760353200e-01   +6.434770964559478e-01; +4.785631887744812e-01   +7.208597846123687e-01   +3.285533578638388e-01   +5.661865368009906e-01   +6.607445533904535e-01   +5.540612477990672e-01   +6.343074188834075e-01   +3.656307198670310e-01; +5.072515285645055e-01   +1.928507081044160e-01   +6.545642869938184e-01   +2.264264992938351e-01   -1.202113517600767e-01   +9.334780005506123e-02   +7.527552180154241e-01   +6.212396414758654e-01; +6.780045853322227e-01   +4.380418196566787e-01   +5.071023906982407e-01   +7.617060274880224e-01   +4.228903637702674e-01   +6.409829751745924e-01   +3.785656859492090e-01   +4.817580075938430e-01];
L2I_L3I_iGABA_netcon = [+2.434668946628497e-01   +2.897376809332518e-01   +9.246260862220689e-01   +3.076192906819715e-01   +1.613493705062964e-01   +4.145867903473249e-01   -6.870723533899219e-02   +4.974709864818016e-01; +1.964127468828295e-01   +4.303766195920056e-02   +6.184570107890004e-01   +6.512235907983143e-01   +2.927887113428372e-01   +3.187905010729712e-01   +7.684612658793107e-01   +4.581795935459489e-01; +3.179948671181265e-01   +7.684403149155232e-01   +5.375200182626421e-02   +2.644863184535631e-01   +9.908288644176061e-02   +8.118970657065120e-01   +3.947241648714407e-01   +4.476890988356346e-01; +4.555046592046287e-01   +3.692154146449074e-01   -7.436007695693786e-02   +3.731151320579835e-01   +6.176716443159108e-01   +2.031324985002761e-01   +3.153025537291928e-01   +1.589075379644945e-01; +6.151613129437090e-01   +3.843711551573551e-01   +5.741207087327703e-01   +6.457748842271268e-01   +2.111693026457704e-01   +4.976684614920103e-01   -1.644542420277689e-02   +1.985512040715409e-01; -2.043973489216946e-01   +1.011149545952217e-01   +4.734851865986274e-01   +7.314461633175128e-01   +7.185399191747128e-01   +6.843160019352890e-01   +7.304227489451053e-01   +1.213377803547521e-01; +2.280763798954450e-01   +1.919881134138167e-01   +3.885871057412542e-01   +5.014314483695791e-01   +1.663659830898346e-01   +8.575248468992951e-01   +7.874656714657584e-01   +1.000000000000000e+00; +4.323153696506968e-01   +5.850115606455436e-01   +2.108978273140897e-01   +2.351978105833799e-01   -2.598766507966153e-02   +1.687997962958661e-01   +1.582349863407984e-01   +2.597437555333328e-01; +1.738095609629683e-01   +2.459875342185691e-01   +5.924279815475881e-02   -1.306387648558392e-01   +5.633384475889238e-01   +1.506463420972942e-01   +9.059512494562283e-02   +2.330454900507529e-01; +2.077979322332547e-01   -1.119639541645434e-01   +5.830169850229170e-01   +5.893332326343828e-01   +6.689505083132509e-01   +6.475060115577411e-01   +8.263491234581578e-01   +1.368936029447594e-01; +4.633960976910785e-01   +3.321073262584660e-01   +7.185707186725651e-01   +6.461109956898398e-02   +8.035452425709516e-01   +3.703550043844229e-01   +7.145125579801145e-01   +2.367015020976815e-01; +7.174575618929735e-01   +2.891009951761529e-01   +3.578202743778986e-01   +3.672159592933213e-02   +6.185045650706692e-01   +7.670874209783881e-01   +3.684163405958240e-01   +1.044213228709580e-01];
L3I_L3E_iAMPA_netcon = [+4.326634496329048e-01   +5.009097239427461e-03   +4.153729117010890e-01   +9.957982527722378e-01   +9.856533692070140e-01   +1.903682074282247e-01   +4.055716211911459e-01   +1.945492627413769e-01   -7.120885347462241e-02   +1.602427611162875e-01   +5.449703569973546e-01   -2.469396240610471e-01; +4.806795889714922e-01   +5.784832561671573e-01   +4.268172716443126e-01   +5.608276826499935e-01   +2.082868230330895e-01   +3.381464688463284e-02   +3.656534932616299e-01   +1.632446780535381e-01   +8.688209952349434e-02   +5.814685830938769e-01   +3.250130480128447e-01   +8.084984487033645e-01; -1.406773180183016e-02   +9.567048954876571e-01   +6.476407935999409e-01   +4.219268505105538e-01   +5.967607304426242e-01   +2.337874278016029e-01   +3.913876522576634e-01   +4.846953251295953e-01   +2.771925619677491e-01   +9.109425735842219e-02   +8.802185110706567e-01   +3.663429272611019e-01; +7.091809216224512e-01   -7.919803756134712e-02   +6.731752433041149e-01   +1.419375448899600e-01   +8.588732976109760e-01   +2.555240211974416e-01   +1.821920100357058e-01   +3.770966235030810e-01   +5.855159121384441e-01   +4.676866087730331e-01   +4.142134233765292e-01   +1.370887118271018e-01; +6.945558674848891e-02   +7.864285598819936e-01   +6.731198451639306e-02   +2.838661785125690e-01   +7.317492445870021e-01   +2.697622795028752e-01   +1.590365832547392e-01   +1.477176506627240e-01   +7.668209482963499e-01   +9.447872430302896e-02   +5.821829016755817e-01   +1.096426585279621e-01; +2.085197235746468e-01   +2.750148321525667e-01   +8.454205797075918e-01   +3.109448184926236e-01   +3.517919104829409e-01   +5.723032713086398e-01   +3.224663391718666e-01   +2.277264449141294e-01   +5.762932057137403e-01   -9.983706587974668e-02   +3.786517868525728e-01   +8.023070855059911e-01; +5.021112890701585e-02   +8.062925753225763e-01   +4.751485376017384e-02   +4.552763878953768e-01   +3.925506682765790e-01   +5.556276989850912e-01   +5.799501016479884e-01   +2.240253177757771e-01   +6.459861878145370e-01   +9.817990493156469e-01   +1.482568058672682e-01   +8.447914821701709e-01; +1.949340750592518e-01   +5.679788932429906e-01   +7.745388708772115e-01   +4.795431519235099e-01   +8.652167073422918e-01   +3.892661341951707e-02   +1.000000000000000e+00   +2.122808927761823e-01   +8.049505947459117e-01   +6.138415037226855e-01   +8.895048362550010e-01   +4.456445542864505e-01; +8.329297406007004e-01   -9.079219811062097e-03   -2.664285618330609e-02   +6.553676567117884e-01   +8.973323666087021e-01   +6.915777108834296e-02   +4.185505594926357e-02   +4.424155968783577e-01   +4.153374278992450e-01   +9.231819893770866e-01   +4.526857742585531e-01   +3.631102731272324e-01; +7.452000152760981e-01   +6.044679578438418e-01   +4.411555945814709e-01   +4.912086475797412e-01   +3.175424789092658e-01   +8.103213611486762e-02   +9.803747921391835e-01   +7.407076363627302e-01   +5.050821160973391e-01   +1.916477161214008e-01   +1.614621206726120e-01   +6.716153835509835e-01; +2.459876577650932e-01   +5.091961470188310e-01   +1.908551173824088e-01   +5.258543460426064e-01   +6.841512772745113e-01   +2.043954135882703e-01   +7.038110808728351e-01   +8.663536730414830e-01   +1.757580300756935e-01   +7.697715312502201e-01   -9.686353948849786e-04   +9.549793811660872e-01; +4.992175410932961e-01   -6.237567798699847e-02   +4.704807437435739e-01   +9.515116311551699e-01   +8.754949249610217e-01   +3.644046345934491e-01   +2.194657050284195e-01   +4.818075097839350e-01   +8.880006075693054e-01   +6.398138546200927e-01   +2.345614158502264e-01   +4.941985191297386e-01];
L3E_L3I_iGABA_netcon = [+6.991679124158837e-02   +5.216816050820108e-01   +4.051760694908469e-01   +6.373253731223999e-01   +7.788017868012952e-01   +5.733117763952582e-01   +7.717039625949101e-01   +8.380314417607595e-01   +7.953002399736481e-01   +3.356333147750989e-01   +3.064399400814025e-01   +4.204356980186953e-01; +4.941206029956990e-01   +7.226416867155656e-01   +6.443146416944676e-01   +7.451321575005218e-01   +2.811137264487367e-01   +1.403812159581874e-01   +6.231508595977902e-01   +7.313087489454390e-01   +8.178094976791884e-01   +6.604639984661517e-01   +3.597252217856755e-01   +3.336833155103908e-01; +3.358692229684358e-01   +9.944655124500239e-01   +1.550033456146828e-01   +8.383084201170438e-01   +2.418833712915301e-01   +4.742550037273703e-01   +2.205885335870861e-02   +4.887404289445558e-01   +1.668424019965553e-01   +2.126923927487779e-01   +1.446454974769380e-01   +6.843047941136886e-02; +2.373785409223548e-01   +9.079830928238319e-02   +7.506270731051126e-01   +1.036719042894564e-01   +2.114605262906049e-01   +9.022735448040384e-02   +8.187989578768784e-01   +4.753621792135331e-01   +5.306590742835789e-01   +4.083696611814580e-01   +1.119978026594547e-01   +2.822031346307389e-01; +8.414327272785003e-01   +6.915893912535692e-01   +8.381716277879263e-01   +3.605663966722583e-01   +5.090651442161711e-01   +5.030702907693740e-01   +6.391082367587729e-01   +9.203631746408915e-01   +1.627261926486664e-01   +8.343697273324149e-01   +5.067632437925609e-01   +3.774663026098515e-01; +8.671804764515540e-01   +7.409578775768900e-01   +4.066080509508472e-01   +5.339353422356693e-01   +4.847744241704414e-01   +7.106736974653672e-01   +2.776273298219759e-01   +7.521154685142734e-01   +1.747614150774630e-01   +4.892797426904109e-01   +3.706090339981976e-02   +2.533601727895490e-01; +5.978783596016992e-01   +5.787275190944944e-01   +1.684885588271895e-01   +9.194368503451351e-01   +3.764535175659189e-01   +2.898102774971633e-01   +4.271482281551418e-01   +3.571893564857929e-01   +2.995326772352292e-01   +2.453754297600528e-01   +9.208910496116475e-01   +6.338472392965337e-01; +7.453841072408637e-01   +2.832351209270362e-01   +4.489026373732326e-01   +5.882377415235732e-01   +7.778060262496193e-01   +3.545767234978093e-01   +2.961566985421303e-01   +4.296793082435350e-01   +3.670884478899000e-01   +7.578191461164867e-01   +1.754989132873789e-01   +4.287431713270277e-01; +3.061756654136031e-01   +3.325125083128211e-01   +6.736046410038004e-01   +6.658413765211098e-01   +1.176870321143586e-01   +6.116598243337839e-01   +5.707853692773696e-02   +6.617434565573678e-01   +2.329308655527965e-01   +4.894239571417849e-02   +9.090416466142274e-01   +4.846024450295811e-02; +3.919811048156325e-01   +6.050590704686981e-01   +4.247338973754526e-01   +3.260146922678500e-01   +1.695687897452832e-01   +6.192984240408903e-01   +2.431480119155413e-02   +7.069287396794587e-01   +1.467574417789485e-01   +3.580467068302143e-01   -7.992053055441850e-02   +1.524536889645856e-01; +8.509906050989984e-01   +1.475434623246085e-01   +7.938053986131394e-01   +2.419668125807857e-01   -7.715817437753841e-02   +1.943513933694198e-01   +5.636104434771774e-01   +2.194965757420546e-01   +2.523814991576916e-01   +3.367482406938539e-02   +5.300426881577937e-01   +5.755626477340063e-01; -2.150201202910993e-02   +4.055872063936568e-01   +8.388416071778645e-01   +1.407635467666557e-01   +2.444226129173845e-01   +4.521623919034820e-01   +7.271582155343579e-01   +6.148922362738143e-01   +1.605644464522201e-01   +2.489442042190948e-01   +2.252675785854746e-01   +4.102780357720680e-01];
L2E_Input1_iAMPA_netcon = [+8.561973646275461e-01   +8.828607847071879e-01   +7.505918635100818e-01   +9.944005699120304e-01   +8.958165213878717e-01   +9.656416745620091e-01   +9.103957597469603e-01   +9.305986279437615e-01];
L2I_Input2_iAMPA_netcon = [+9.608511589549794e-01   +9.100589565036072e-01   +8.399092130170424e-01   +8.853761513318962e-01   +6.492100471553490e-01   +7.307155113872704e-01   +8.027478917237291e-01   +1.000000000000000e+00];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
