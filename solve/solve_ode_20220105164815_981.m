function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.237777377844758e-01   +4.236743615472222e-01   +5.307556783049064e-01   +6.366705677446913e-01   +6.012990595279883e-01   +3.405626203703793e-01   +6.481754487955060e-01   +8.410762140192795e-01   +5.442166696124020e-01   +1.920374678280019e-01   +4.432588571381850e-02   +8.221787614740941e-01   +7.678106739778556e-01   +1.106053435128542e-01   +1.266464701935297e-04   +8.368181240805947e-02; +9.833940003370496e-01   +9.465665085790345e-02   +3.246585347570102e-01   +9.574740620167748e-01   +3.869306641800814e-01   +6.063850951808476e-01   +6.786295620530076e-01   +8.321342477179523e-01   +7.219636089378633e-01   +1.378150517833540e-01   +7.542566467095182e-01   +4.300852141785223e-01   +1.671228127116661e-01   +1.353421412413169e-01   +8.663196262092855e-01   +6.264456717572209e-01; +7.309845807698833e-01   +5.986784711499860e-01   +1.057284960469978e-01   +2.414968979752698e-01   +9.158744080182515e-01   +1.908297878854124e-01   +6.350146620147299e-01   +2.560751511987482e-01   +5.215058559954340e-01   +6.958326161851993e-01   +2.428259544727036e-01   +8.876074699313816e-01   +8.631077250521104e-01   +6.784315205658463e-01   +6.129503876273824e-01   +6.611860382247555e-01; +3.442616313547331e-01   +4.715041140009649e-01   +6.120034315877835e-01   +6.759830144838782e-01   +5.383625524655386e-04   +7.389477731445292e-01   +9.450802465559754e-01   +6.125116906755016e-01   +9.935736897030216e-01   +9.313258950982972e-02   +4.429749960446103e-01   +3.916663393938004e-01   +9.909309150713936e-01   +4.940232643677896e-01   +9.900678407579064e-01   +7.299590980728314e-01; +5.846379528593876e-01   +6.963008131057939e-01   +7.798723904020838e-01   +2.885120038330675e-01   +4.618782498418774e-01   +2.431437608209314e-01   +2.092433469765565e-01   +5.827942527435074e-01   +2.198750484640060e-01   +5.243676171311146e-01   +6.868744702292642e-01   +7.692033733766470e-01   +5.152366264742148e-01   +1.888378670663021e-01   +5.265122556648999e-01   +8.916929016537957e-01; +1.089004555387015e-01   +7.002577363511637e-01   +4.245021783894076e-01   +6.707408050629281e-01   +4.252494468559834e-01   +9.181782166318265e-01   +7.099839701083168e-01   +5.411973618435185e-01   +1.055663231780180e-01   +5.307699997404726e-01   +3.587580605478142e-01   +3.970145755343931e-01   +8.842271594653797e-01   +4.950210446331312e-01   +4.802227765515544e-01   +9.822648016650323e-01; +9.055541114144582e-01   +6.391393197503293e-01   +9.144647323996059e-02   +6.953826236986925e-01   +4.610885240406121e-01   +2.701098889413360e-01   +2.368110312203514e-01   +8.699220136555487e-01   +1.109120161305502e-01   +8.618310735803442e-01   +7.359799866123703e-01   +8.096480280547872e-01   +5.875841524056220e-01   +1.481017604759954e-01   +8.021010383803090e-01   +7.694037847600942e-01; +8.808001969246919e-01   +3.313123837379760e-02   +2.668036440893761e-01   +6.764723430961755e-02   +7.704822667384666e-01   +7.645628514506434e-01   +1.193514223089202e-01   +2.637474874224109e-01   +6.457495301451356e-02   +4.845661203292086e-01   +3.951216500686175e-01   +7.552291950510307e-01   +1.547577670718994e-01   +5.436674088971209e-02   +2.286785429701301e-01   +5.824042837839500e-01; +8.165807659946718e-01   +6.913374378755643e-02   +1.530498813108064e-01   +2.538690787035556e-01   +3.225897814885801e-01   +1.892329734173383e-01   +6.079041354250854e-01   +3.175419744320590e-01   +4.036490006128139e-01   +3.927753123922237e-01   +6.842848227536483e-01   +3.772136013208844e-01   +2.000638279147370e-01   +8.517076642549675e-01   +4.971637347073675e-01   +9.274568612312102e-01; +2.596513563979830e-01   +3.190263965714432e-01   +2.808888488550225e-01   +2.229000485107484e-01   +7.850902673160137e-01   +2.871014832806014e-01   +4.513105365689378e-01   +1.187895341678805e-01   +4.481118334967577e-01   +6.724684140419129e-01   +7.045174536709652e-01   +2.166999170133213e-01   +4.062901685358372e-01   +5.617177565840007e-01   +8.996341605169428e-01   +5.806955739592901e-01; +5.947871407289580e-01   +5.297321968055371e-01   +4.411529658886613e-01   +6.686884518492600e-01   +4.712556639944866e-01   +9.033199767302456e-02   +4.592519184827325e-01   +9.407765249616458e-01   +3.656806534986187e-01   +7.421580343730683e-01   +4.430520490327853e-01   +7.913691051194963e-01   +7.483548427370093e-01   +9.297290002979374e-01   +5.747618905265220e-01   +1.690877973168290e-02; +2.261905288318259e-02   +6.538613960337440e-01   +5.261781486811294e-01   +8.444648113922228e-01   +3.598141050811436e-02   +5.773023452000912e-01   +6.621859463345924e-01   +6.461987054421925e-01   +7.626274605167447e-01   +5.190428131316709e-01   +1.874471256759651e-02   +9.497575901990806e-01   +8.245441205149852e-01   +6.977498374099129e-01   +8.452991591777534e-01   +1.219909755582327e-01; +4.257482139603913e-01   +4.079768454191479e-01   +4.584264486098392e-01   +3.449443670091112e-01   +1.770175486826441e-01   +6.835246074595454e-01   +7.698931423697606e-01   +4.805922023598907e-01   +6.268360968449879e-01   +3.467406710608025e-01   +3.306256695714250e-01   +3.287260267620120e-01   +7.901391513018740e-01   +5.835244046914736e-01   +7.379633725745772e-01   +8.630877113745127e-01; +3.124411189178573e-01   +8.197479122013134e-01   +8.750045971715710e-01   +7.814321399235694e-01   +7.207500596552615e-01   +5.467509689873926e-01   +3.507544265248910e-01   +6.395197024934681e-01   +7.720292658752264e-01   +1.491796308708237e-01   +4.236066461789320e-01   +6.718743196275933e-01   +3.193575973514762e-01   +8.155269110473949e-01   +5.854499425837547e-01   +4.835148810191375e-01; +1.608991607066213e-01   +7.193823994291479e-01   +5.184779288395938e-01   +6.755312406663151e-01   +4.736550466340899e-01   +4.247891164845855e-01   +6.619792121604392e-01   +5.438286066720960e-01   +9.332291892451891e-01   +5.868205953929974e-01   +2.695815360888309e-01   +4.395647530398998e-01   +5.337087058718621e-01   +8.797928230382639e-01   +2.457290317342253e-01   +8.453237024178295e-01; +1.776843205413756e-01   +9.681872093516960e-01   +9.444837761174573e-01   +7.902617526617148e-03   +1.523674527309169e-01   +6.434573639323589e-01   +4.154087267209224e-01   +6.462335773100840e-01   +9.722182284858301e-01   +2.618494008391410e-01   +1.969241700091254e-01   +8.331495083839142e-01   +9.093342849808293e-02   +9.898208715995286e-01   +6.659243135033528e-01   +2.090178339813993e-01];
L1E_L1I_iGABA_netcon = [+5.514583117099680e-01   +6.943543801977216e-01   +1.053835887907766e-01   +1.765219774038535e-01   +5.502572595542898e-02   +1.784201178033060e-01   +5.965139323950952e-01   +9.960196483894481e-01   +3.389973140522681e-01   +7.797716119361781e-01   +6.832015292507646e-01   +3.654063705381134e-01   +7.822304762643122e-01   +4.323065652124562e-01   +5.979560064010488e-02   +9.830652545946929e-02; +6.303837597099005e-01   +4.979858724942787e-01   +1.414705682815471e-01   +3.988222965887973e-01   +1.777324975360635e-01   +3.606199564220423e-01   +2.995361396025733e-01   +3.312320900074700e-01   +2.937839154682391e-01   +3.374396877817842e-01   +1.311857811461634e-01   +3.692065841647699e-01   +1.005961798530837e-01   +6.551539309988749e-01   +3.150271941647987e-01   +1.428714946244831e-01; +3.250706161564644e-02   +5.346732222328200e-01   +1.666759160297769e-01   +1.333169222217295e-01   +6.623707530803271e-01   +5.625793394145642e-02   +1.338231439384996e-01   +2.976055574394371e-01   +7.452544034770309e-01   +6.067294379867167e-01   +7.221859765927297e-01   +6.845557727251329e-01   +2.935891239603028e-01   +1.109660019523528e-01   +7.723890618171906e-01   +1.686619114376791e-01; +6.141534795011233e-01   +4.444813289638427e-01   +6.216211276553554e-01   +2.994396783506952e-02   +3.313507552562519e-01   +5.215742422690692e-01   +2.114792816206460e-01   +6.280474235044139e-02   +1.130192154391507e-02   +7.416948196485310e-01   +1.094900336472027e-01   +5.976856332462221e-01   +2.363140828865501e-01   +9.331152296721928e-01   +6.964233337657512e-01   +1.954644275583002e-01; +3.631460979385595e-01   +1.233479038766796e-01   +5.731401449097826e-01   +9.379170134794158e-01   +8.980513171065017e-01   +3.355872136923721e-01   +8.957062893923342e-01   +2.971879778992723e-01   +4.855360738615860e-02   +1.057374316975655e-01   +1.169026072608352e-01   +7.881961226079176e-01   +5.299291742362261e-01   +1.863840452109774e-01   +1.244189014253829e-01   +3.179880019415288e-01; +4.979874075250805e-02   +4.909543834803844e-01   +5.234184679732178e-02   +3.007761126379499e-01   +1.176201921678252e-01   +1.751026371560273e-01   +7.253483732921505e-02   +4.532848600128161e-02   +6.669442687695905e-01   +1.275633195494012e-01   +6.398045782319585e-01   +3.684171265565784e-01   +9.234777912824745e-02   +2.664146075857930e-01   +1.289969957902581e-01   +3.171402483434890e-01; +4.885996969344379e-01   +8.524793422603713e-01   +9.318358911951737e-01   +2.961643443669700e-01   +9.893388215084974e-01   +2.100414152825565e-01   +2.434747259923627e-01   +5.050624994176967e-01   +6.044137025614588e-01   +5.489126598210754e-01   +3.290676211753629e-01   +2.059131034686068e-01   +4.061914944505105e-01   +7.973322493613663e-01   +9.246178528334827e-02   +2.176872003978870e-01; +1.924632588331729e-01   +8.748232147651930e-01   +7.285941425187832e-01   +3.338878653267892e-01   +5.411280047312864e-01   +9.056245892977867e-01   +5.469048570930648e-02   +7.618338389391742e-01   +5.261883310837897e-01   +4.852017011099272e-01   +6.546578878226518e-01   +8.740869912735943e-02   +1.041848231392201e-01   +4.877607313246260e-01   +8.366719650275750e-03   +2.515946050772211e-01; +1.220288708747194e-01   +2.705981470732868e-01   +7.378940790094818e-01   +4.676466986046852e-01   +7.057798044840369e-01   +6.745448231729084e-01   +4.408235993686328e-01   +6.320461185175882e-01   +7.293079928011278e-01   +8.915463882522567e-01   +7.497280854460371e-01   +7.721024883401382e-01   +1.115768132820275e-01   +7.692368613065342e-01   +4.239579653006562e-01   +8.932775148468469e-01; +2.066651034053010e-01   +2.088861525669928e-01   +6.323690840573784e-02   +6.468866931399487e-01   +1.000000000000000e+00   +4.675815698501940e-01   +1.412952109949242e-02   +9.039527894591870e-02   +7.072335877361798e-01   +7.985181357819958e-01   +5.843070029174389e-01   +2.067948090027996e-01   +7.847829840877595e-01   +3.970310848938813e-01   +6.547935239484128e-01   +7.030659570126130e-01; +1.467020509739541e-01   +5.638415622250240e-01   +8.599715405805577e-01   +2.401759906355575e-02   +2.882207309488150e-01   +9.124086324401139e-01   +8.969840942667606e-01   +8.014811855192183e-02   +7.806160129932096e-01   +7.351291199077529e-01   +7.409764369833447e-01   +3.881093360651834e-01   +2.914068644057243e-01   +2.721010477711970e-01   +7.230933096765948e-01   +5.549601942329847e-01; +1.888343467567184e-01   +6.397255197606656e-01   +9.332536513697952e-01   +8.429872867945657e-01   +4.138219473868082e-01   +1.036556695432739e-01   +1.958180212027165e-01   +7.760311007187697e-01   +2.882486338069268e-01   +5.193952599690668e-02   +2.346964960811183e-01   +5.518379758926404e-01   +6.035268029151803e-01   +3.773093861137458e-02   +5.304922124726733e-01   +1.845066390780221e-01; +4.265710954905822e-02   +4.170196967423306e-01   +9.837927293888721e-01   +5.585423927525907e-01   +4.653990951314578e-01   +7.450209018107175e-01   +9.316769493624993e-02   +9.055875595090835e-01   +6.914207648010187e-01   +7.273876857928679e-02   +7.344098672287550e-01   +2.286175320151485e-01   +9.636218793560811e-01   +6.734530041411757e-01   +1.086257374918518e-01   +2.112063816529253e-01; +6.358917291999440e-01   +2.064143616895738e-01   +8.584273249013102e-01   +8.545369967319815e-01   +7.641748465669878e-01   +7.370317516356575e-01   +3.079078258072470e-01   +5.336460205132260e-01   +5.566418545262678e-01   +8.755143605798013e-02   +9.708286979412680e-01   +6.419460349429561e-01   +4.324772274399007e-01   +4.287558835586310e-01   +6.323498674213121e-01   +7.622527913656049e-02; +2.819048638926944e-01   +9.476926051346248e-01   +7.858563637369943e-01   +3.483004937181885e-01   +8.175042635870698e-01   +5.616842005935656e-01   +4.555712759418939e-01   +1.094033586876003e-01   +3.965097538543488e-01   +7.972395602704083e-01   +8.668426297836573e-01   +4.838430505970069e-01   +6.950519013120844e-01   +4.514180244177455e-01   +1.271413775710187e-01   +9.141093333807124e-01; +5.381540545876891e-01   +8.104410852041800e-02   +5.140662056017311e-01   +4.466452932842668e-01   +1.003966991194979e-01   +1.850379726733800e-01   +1.017522497100374e-01   +8.267976497942775e-01   +6.142293811413005e-02   +9.427831602790512e-01   +8.634207218744203e-02   +1.513742942158456e-01   +7.569614356871783e-01   +6.086756499690172e-01   +1.339936897709549e-01   +7.059559975523120e-01];
L2I_L1I_iGABA_netcon = [+5.583546056687330e-01   +1.600137043528616e-01   +4.246365942446141e-01   +6.822259326721860e-01   +8.083080718095302e-01   +7.951423324447683e-01   +7.888503068832378e-01   +2.587704189792304e-02; +3.128128353110503e-01   +7.575719871099472e-01   +4.292820311369727e-01   +4.638515846833963e-01   +7.493311789899532e-01   +5.782166430079096e-01   +8.522332624893599e-01   +4.219509360058240e-01; +1.663763998179817e-01   +8.699668498270279e-01   +1.243367708253256e-01   +2.131433634804225e-01   +1.191075477307095e-01   +4.411192677832114e-01   +5.063968021706419e-01   +1.831145219400155e-01; +6.221496677978308e-01   +3.510977254339421e-01   +2.351240081372237e-02   +9.827014466386257e-02   +5.242176165556320e-01   +2.577413940470618e-01   +6.365330483628447e-01   +7.262849808710662e-01; +9.879479378199750e-01   +6.862965189288192e-01   +2.904754224645260e-01   +8.227461882686518e-01   +3.263190823253321e-01   +7.510456108427310e-01   +9.510698427285913e-01   +3.694617394061155e-01; +1.704993650309626e-01   +2.938958347926783e-01   +3.183096367394327e-01   +1.756848139581750e-01   +5.457324007962627e-01   +2.294822321245897e-01   +4.433542669827678e-01   +8.411511857713918e-01; +2.589093191751174e-01   +5.304398892349481e-01   +6.533686241017099e-01   +1.647823191836459e-01   +3.996916792006573e-01   +6.530573400730105e-02   +5.896825673620133e-02   +7.338850744931595e-01; +3.975912220053792e-01   +8.333326270034710e-01   +9.574011594624071e-01   +6.669845294622913e-01   +4.154176385104995e-01   +7.671865897554164e-01   +8.670040338724194e-01   +5.711416793724152e-01; +7.454154484738386e-02   +5.973694582842362e-01   +9.362766333834217e-01   +8.941067578851676e-01   +1.802685810037066e-01   +6.718272621370376e-01   +6.314615673931895e-01   +1.777686186514462e-01; +6.847436158022892e-01   +3.347522177101750e-01   +4.572667607114853e-01   +5.171552796533255e-01   +2.545131240083935e-01   +7.147814927642032e-01   +3.543653471834295e-01   +9.584509235104335e-01; +4.031864952209320e-01   +2.991566420776716e-01   +2.396596238589398e-01   +7.028738021391771e-01   +1.935301682811892e-02   +6.425910430408213e-01   +9.973050881939466e-01   +2.658136799073098e-01; +9.825186800884675e-01   +4.524551412796966e-01   +7.647145304155176e-01   +1.526296498476783e-01   +9.239640320252517e-01   +4.194325866558420e-01   +2.243730538528571e-01   +9.242788753245876e-01; +4.013636765594539e-01   +4.228211467192181e-01   +7.592302858244583e-01   +9.530301914463054e-01   +6.537395539649726e-01   +3.918837542831172e-01   +6.515017059684887e-01   +2.226963973303532e-01; +6.215459239103801e-01   +3.586664422351099e-01   +7.395147740494745e-01   +5.411993684430629e-01   +9.333475320031979e-01   +8.159418988034487e-01   +6.049482151142441e-01   +3.731736838580060e-01; +1.550921159114002e-01   +5.594635543701193e-01   +7.441756798846908e-01   +6.808289285950925e-01   +1.635964864134533e-01   +3.164179297780226e-01   +3.875002553575022e-01   +8.667508267102053e-02; +3.824181004220731e-01   +7.429891013363419e-01   +1.070379537092342e-01   +3.712245871959199e-02   +9.218273313387360e-01   +8.150639552306428e-01   +1.411812092612489e-01   +6.405824068895287e-01];
L1I_L2I_iGABA_netcon = [+1.810702289032176e-01   +9.110935027576089e-01   +2.761917671989731e-01   +8.670455176450467e-02   +5.337223430758535e-01   +1.067560392605185e-01   +9.882059492908914e-01   +4.113066160739794e-01   +7.204302587046550e-01   +2.173497074098104e-01   +9.224637683337826e-01   +6.736107137782644e-01   +1.069454332108826e-01   +5.575085938088342e-01   +6.296832430710123e-01   +4.845985359972933e-01; +4.575528375868463e-02   +8.001964157171412e-01   +2.476071366388620e-01   +8.024797074209742e-01   +8.863973475930848e-01   +6.153490982497670e-01   +7.677216305433606e-01   +6.017183060575279e-01   +9.963251044216925e-01   +1.259081427845688e-01   +7.712977664379944e-01   +4.782004951262179e-01   +1.817681707482336e-01   +7.716751261224507e-01   +1.009584680477777e-01   +8.938203494756616e-01; +7.235915958606882e-01   +7.448771291131038e-01   +4.515050746689431e-01   +9.894834471443597e-01   +8.982885583273906e-01   +9.404036715182884e-01   +3.364218346656441e-01   +7.499250067253432e-01   +3.548890483928568e-01   +3.087872997113247e-01   +4.366095221299310e-02   +6.245776468230931e-01   +9.929144339567743e-02   +3.123015869190959e-01   +3.906687767707222e-01   +1.381161981788244e-01; +3.478420647974416e-01   +8.135393751218043e-01   +2.278112805412181e-01   +6.721467358151129e-02   +6.248460436314475e-01   +3.539252674655954e-01   +6.622748625518665e-01   +5.833990273752403e-01   +9.722092485820403e-01   +7.258385974873305e-01   +3.785390462013407e-01   +2.372194595965394e-01   +4.899465547841276e-01   +1.787097820054313e-01   +5.503715894790762e-02   +3.899015967688617e-01; +6.601019840818226e-01   +3.827372393546515e-01   +8.050975703735691e-01   +9.395019885679764e-01   +1.370364349998614e-01   +4.112353289044472e-01   +2.452924366381796e-01   +5.523555171515298e-01   +3.474380406945063e-01   +7.830313279223086e-01   +7.041477651148482e-01   +1.776484242556862e-01   +1.929581424675406e-01   +3.392254309518072e-01   +5.013135558340654e-01   +9.278535627183917e-01; +3.846973369800352e-01   +6.171758057661525e-01   +9.851890348630191e-01   +1.786757045593030e-02   +2.184076659847210e-01   +9.841751173400615e-01   +2.949746752301639e-01   +5.824043979414671e-01   +8.864908399857834e-01   +6.925775307985244e-01   +7.284415420003157e-01   +8.298760209901371e-01   +8.950531573206094e-01   +2.092323423306484e-01   +4.313306036344419e-01   +9.183518827698848e-01; +6.279586839626002e-01   +5.759136181718213e-01   +2.961018281143661e-02   +6.842222502448824e-01   +1.814781064623398e-01   +9.449854991299699e-01   +6.799653988401262e-01   +5.113289792632771e-01   +4.550295851184505e-01   +8.860015987524568e-03   +2.253591077334074e-01   +7.657675940973760e-01   +9.956900641295106e-02   +5.103828343462072e-01   +9.977732286170219e-01   +7.144090643971330e-01; +2.227799873188255e-02   +5.288856430633238e-01   +5.367745267264713e-01   +7.828407742952669e-01   +4.254541608444685e-02   +6.762004498132698e-01   +5.273766241278910e-01   +8.260259749329792e-02   +4.139585679416197e-01   +8.443771959550784e-01   +2.686971828705483e-01   +9.340789865235666e-01   +4.518852799168031e-02   +9.062327331376885e-01   +8.105591194482081e-01   +6.181990932662514e-01];
L2E_L1E_iAMPA_netcon = [+3.434954771631519e-01   +7.574620974491647e-01   +5.897607926426804e-01   +5.027726892511712e-01   +8.485814656905497e-02   +4.664809443007410e-02   +9.227953794806947e-01   +4.764037594642909e-01; +9.357728568655730e-01   +4.137266130697562e-01   +6.613913743363573e-01   +4.887527164919866e-01   +9.745702745590449e-01   +3.429849452322314e-01   +8.004463767302745e-01   +3.634804726022721e-01; +1.244312561574597e-01   +4.928435478985912e-01   +4.815913663445022e-02   +8.774861516284024e-01   +6.512723082254275e-01   +7.360974013305619e-01   +2.868149309132160e-01   +7.887020863489135e-01; +7.307751131622182e-01   +6.956407576912005e-01   +3.479213212428072e-01   +3.531548535486453e-01   +2.304223943052847e-01   +7.953172561609649e-01   +5.444154922659722e-01   +7.807550571917033e-01; +6.466801637867775e-01   +9.736824817736898e-01   +4.502912059202160e-01   +4.496611439641539e-01   +4.028156503052357e-01   +5.442948700789758e-01   +9.838364938427046e-01   +6.678771754250808e-01; +8.326059685086026e-01   +3.280645558353430e-01   +2.397796358038940e-01   +9.644016575890281e-01   +1.214541817272713e-01   +6.873337404226738e-01   +7.147090067502290e-01   +1.331048786629752e-01; +3.976096552403163e-01   +8.382127345260876e-01   +7.148382798841166e-01   +4.295814723532120e-02   +2.686549723651334e-01   +8.936868586942628e-01   +8.395690583825745e-01   +2.037562642715074e-02; +7.498658207619445e-01   +7.392690067472408e-01   +8.556654700191371e-01   +9.733674160619552e-01   +2.567406472608036e-01   +5.396165235214093e-02   +4.336388194581347e-01   +5.594865611278123e-01; +8.347917509908814e-01   +9.539311338583819e-01   +2.821782504920585e-01   +1.879744829911630e-01   +3.328807551845800e-01   +3.041663682741826e-01   +4.710794503378882e-01   +3.014675845719851e-01; +3.232476150666130e-01   +3.257532752126356e-02   +7.308540474827497e-01   +6.663097426933031e-01   +1.514266470125019e-01   +4.598806842706436e-02   +5.610132405290795e-01   +9.391787300745132e-01; +5.515812404523037e-01   +3.558769493882596e-01   +1.388203950083672e-01   +5.871295938539601e-01   +3.476257798743129e-01   +1.952666901556184e-01   +2.694575676920011e-01   +9.816004640598048e-01; +9.800981560813254e-01   +6.619393740440531e-01   +8.374409280746722e-01   +6.752105576928539e-01   +1.207667196843367e-01   +7.192754849002158e-01   +7.483449683029380e-01   +2.874163421930884e-01; +5.485397671722193e-01   +2.823651619059095e-01   +1.390594080556747e-01   +3.599962391433663e-01   +8.831263928717006e-01   +7.225456201494805e-01   +5.041776059874834e-01   +8.001187209113670e-01; +3.305555822156310e-01   +2.302298102798359e-01   +5.873075012273613e-01   +6.206752214952188e-01   +9.493546019100665e-02   +8.771400241207670e-01   +6.469317422749710e-01   +8.954951090167043e-01; +6.189818746256641e-01   +7.103612369162586e-01   +3.672864712633432e-01   +8.115606544664395e-01   +9.304585180198826e-01   +5.812866941072220e-01   +3.079385967185560e-01   +5.982547355919486e-01; +3.616777145711471e-01   +6.240100840685825e-01   +8.061362241785822e-01   +2.038778569972853e-02   +3.998853445654242e-01   +7.134315068059852e-02   +1.384709445309084e-01   +8.842507968044300e-01];
L1E_L2E_iAMPA_netcon = [+9.434098765708079e-01   +3.722458778470536e-01   +6.678761675053763e-01   +4.856161363986450e-01   +2.474842130389264e-01   +4.509636012856157e-01   +1.224781844173496e-01   +4.971580450418349e-01   +8.833944806650019e-01   +3.252627073953535e-01   +5.142376835380161e-01   +8.540337454715340e-02   +6.307019627910685e-01   +4.294709822326244e-01   +6.131337026183047e-01   +5.045526198415290e-01; +5.491109140218714e-01   +9.372889779715043e-01   +2.078510762152105e-01   +7.572045083226592e-01   +7.851537626070657e-01   +2.046713381361560e-01   +4.076307627418094e-01   +6.939314380911803e-01   +7.199594060784433e-01   +2.459937764699274e-01   +6.576243695903892e-01   +1.632173730588286e-01   +8.591099546205286e-01   +4.925479726306441e-01   +8.194218840895569e-01   +6.122244534304949e-01; +7.284003958676789e-01   +8.300127855693624e-01   +6.538521829876837e-01   +4.169163909224644e-01   +8.834277539370583e-01   +8.996763631344794e-01   +2.763163613946645e-01   +8.333091285147505e-01   +1.903554625844050e-02   +3.425826177177307e-01   +9.518931712651038e-01   +3.231170843175441e-01   +9.752029352195013e-01   +7.004419477505430e-02   +8.869283468070613e-01   +8.199574719030543e-01; +5.767839164927926e-01   +8.489561616531520e-01   +7.206599826634826e-02   +9.712714414870246e-01   +9.132458340002031e-01   +7.622972240615067e-01   +7.170095993722320e-01   +6.107465726733673e-01   +6.751921981890607e-01   +3.745291929140367e-01   +7.232082799839068e-01   +3.014578332963952e-01   +5.699627853386710e-01   +8.879607607945182e-01   +9.298868124836412e-01   +5.312275122458053e-01; +2.596816207437975e-02   +3.714443482751499e-01   +4.063222267666086e-01   +9.890063703752868e-01   +5.587606905546458e-01   +8.833277347243594e-01   +2.822501977796102e-01   +5.745049111778895e-01   +4.384631779255116e-01   +5.457887549118033e-01   +3.999483639867074e-01   +1.184447559158069e-02   +9.975084881906027e-01   +6.471381458436137e-02   +1.916112894933498e-01   +2.029232088933973e-01; +4.473399096181646e-01   +5.931311596573036e-01   +6.669245678048431e-01   +8.645238780241925e-01   +5.990587929452882e-01   +2.856102008389611e-01   +8.963929756303236e-01   +3.253135738661763e-01   +4.368146831788792e-01   +5.620672264219536e-01   +8.327829554467784e-01   +5.403581133372665e-01   +5.536814869878304e-01   +4.367792642871336e-01   +2.588791360315978e-01   +4.548947335931160e-01; +6.471590861864541e-01   +8.734336231875215e-01   +9.348631296971238e-01   +3.887180052332193e-01   +1.485724966627937e-01   +6.721822974933129e-01   +8.267317357660119e-01   +4.564970746891741e-01   +1.164218655396729e-01   +3.953182815388399e-01   +1.353465839162573e-01   +9.639946419695025e-02   +5.146658292943739e-01   +8.257359028872764e-01   +8.973058454332780e-01   +4.283545711786790e-01; +5.214384161924929e-01   +9.336340130887134e-01   +8.102355015890992e-01   +4.549202326363342e-01   +9.002468644984338e-01   +6.638742647151306e-01   +3.900422943529144e-01   +7.145857285905757e-01   +8.144970270781642e-01   +3.976668280962925e-01   +5.995830772671064e-02   +1.477201674394468e-01   +3.313921887638988e-01   +3.940749734344978e-01   +5.938826702007752e-01   +9.662512643825674e-01];
L2I_L2E_iAMPA_netcon = [+6.194438652217613e-01   +6.955881556345110e-01   +7.345129011414151e-01   +5.900881920702331e-01   +6.690155107084359e-01   +5.567366040636009e-02   +9.844934884434917e-02   +8.486115633887815e-01; +6.962290090010042e-01   +4.267655007070655e-01   +4.293108766143460e-01   +4.599108005950176e-01   +5.000882130910211e-01   +1.531546690039723e-01   +9.078879455821489e-01   +9.172895497679928e-01; +7.213475035831353e-01   +8.364464393643917e-01   +6.940526109522989e-01   +5.141929159831217e-02   +2.189540788979422e-01   +1.959424934762104e-02   +1.091008735809862e-01   +9.871960879554045e-01; +3.474306931140296e-01   +7.313148866294572e-01   +9.448353700069191e-01   +2.281239122123664e-01   +5.720334709530566e-01   +4.347770586064952e-01   +5.165998811098204e-01   +5.039538117085359e-01; +5.175855772099381e-01   +3.610085426847495e-01   +7.834332474834088e-01   +8.349648261759631e-01   +1.217173922671538e-01   +8.318727529249604e-01   +1.441817122158325e-01   +2.706172546427766e-01; +5.566913105715621e-01   +4.545732500247681e-01   +7.057619356967222e-01   +1.592484484912465e-02   +6.711029674543273e-01   +6.166744326985953e-01   +5.601493990576781e-01   +1.014175701119082e-01; +1.566786990688817e-01   +3.863920961088370e-01   +1.099048503136515e-01   +8.646482483184285e-01   +6.001235029519141e-01   +5.205541288751093e-01   +5.337328085504411e-03   +5.089355823098020e-01; +5.629392714434640e-01   +7.756807809551123e-01   +3.898727284661108e-01   +7.814155421672055e-02   +5.611670617226183e-02   +8.633579567783514e-01   +7.677207862778269e-01   +5.844423041843206e-01];
L2E_L2I_iGABA_netcon = [+7.633445768628137e-01   +9.418975163943391e-01   +2.392542562484077e-01   +8.341797701457283e-01   +2.572380879746284e-01   +7.522028116069700e-02   +1.746538072360613e-01   +5.237505037447091e-01; +8.373678526605127e-02   +6.569428519977071e-01   +5.797535621241902e-01   +4.027170170542982e-01   +2.976505756335209e-01   +3.938305900228923e-01   +1.389579731355514e-01   +2.648244191896193e-01; +6.611411068435009e-01   +4.522216439845035e-01   +8.668286918469913e-01   +3.909479240554522e-01   +4.258996189332817e-01   +2.666882988316320e-03   +5.997498804819217e-01   +6.803169401028217e-02; +5.168449945439646e-01   +8.399153230949363e-01   +4.060382289528818e-01   +3.613234347875643e-01   +1.187327671573233e-01   +2.199015152429954e-01   +8.999361325673648e-01   +4.366504537581557e-01; +1.713777629899642e-01   +5.328480365362793e-01   +1.117903675247621e-01   +1.392589629079967e-01   +4.958525562666303e-01   +1.182398584461949e-03   +9.390281943608876e-01   +1.731948581834052e-01; +9.397452750854770e-01   +5.542603834224926e-01   +4.445921170174558e-01   +2.592077752216324e-01   +7.061397561781638e-01   +1.896262383565565e-01   +2.208443233180744e-01   +2.708864786646761e-02; +5.907235403207487e-01   +6.798862987377836e-01   +2.995946209409490e-01   +8.696094998290195e-02   +2.437054634187240e-01   +1.426332067683779e-01   +4.817374242480446e-01   +9.541910035658727e-01; +4.414885491586927e-01   +3.671802371695145e-01   +4.002040124903696e-01   +4.303495304191040e-01   +7.850120334829976e-01   +2.676513081053037e-01   +3.758139363070367e-01   +4.307617769246253e-01];
L3E_L2E_iAMPA_netcon = [+9.621375149000104e-01   +7.730466526119415e-01   +9.112731504362563e-01   +5.318008127157400e-01   +4.819356226905329e-02   +8.193044617681992e-01   +6.251220532390407e-01   +7.481983772833121e-01   +6.733153200025744e-01   +9.054221533924459e-01   +5.824203374560754e-01   +5.850218955712385e-02; +7.613191436819015e-01   +2.272653928852644e-01   +9.080856510087065e-01   +7.159357957195680e-01   +5.527152987411822e-01   +7.274925964121381e-01   +5.427115851768829e-01   +6.464723155433743e-01   +4.315638754129665e-01   +3.932943965601838e-01   +6.876373155726326e-01   +9.800399389019100e-01; +6.999555990550315e-03   +3.701624364457531e-01   +5.910830016996207e-01   +1.798237330105999e-01   +2.739874199774083e-01   +1.767860462089739e-01   +4.379273132465448e-01   +1.226716682983781e-01   +6.936497000167201e-01   +2.576691366494383e-02   +7.202149114063577e-01   +2.849784614459899e-01; +6.801019051241255e-01   +8.914117773658359e-01   +3.319685917816795e-01   +3.353281679311062e-01   +2.422919700599200e-01   +3.609196545670769e-01   +2.878766631267470e-01   +5.053656686879920e-01   +2.567975900248982e-01   +6.710797972764222e-01   +6.491417591424469e-01   +5.950410212131987e-01; +7.055206516388789e-01   +8.559048285499221e-01   +8.529124575724426e-01   +1.865402897633422e-01   +2.421264608222693e-01   +1.877700937846061e-01   +5.005637546023020e-01   +3.464288746054914e-01   +1.099958068930643e-02   +8.377556309381690e-01   +7.267006506529063e-01   +9.612161143218350e-01; +6.450268446347341e-01   +4.018432629115748e-01   +4.425983428505525e-01   +3.210617790400241e-01   +1.548116892206077e-01   +1.199832976217150e-03   +7.625002909355916e-01   +9.142296325979918e-02   +5.311492876554457e-01   +9.714750041749209e-01   +3.739959227584768e-01   +1.864939544148085e-01; +5.524773006778199e-01   +3.188997127772295e-01   +9.038735996226100e-01   +4.041806122839499e-01   +9.573486701487098e-01   +3.153211247463250e-01   +7.614671097358376e-01   +1.477305396156171e-01   +2.787834125007349e-01   +5.694025483912181e-02   +5.810203153858069e-01   +1.921508930569317e-01; +2.185314796248658e-01   +6.093564645959019e-01   +3.335772563347597e-02   +5.494989810822110e-01   +9.364791044276863e-01   +6.985638896037414e-01   +5.767491674781439e-01   +1.993185924916803e-01   +9.459046715112739e-01   +4.493041498385874e-01   +1.152572142516773e-01   +3.414177266779155e-01];
L3I_L2I_iGABA_netcon = [+9.334319269304685e-01   +9.241890062864834e-02   +6.163579302222709e-02   +2.777368533684537e-01   +2.547035437660691e-01   +4.037592462199376e-01   +5.295212775504908e-01   +1.096696509426762e-01   +9.123322185137761e-01   +5.850009856951648e-01   +2.086772404247753e-01   +9.090238053587260e-01; +3.904935225328301e-01   +6.154015949436147e-01   +4.957467125463937e-01   +7.454842167746015e-01   +8.580477629337950e-01   +9.887330329550569e-01   +8.293967136740963e-01   +2.704415521007946e-01   +6.396951180077315e-01   +2.844757440824127e-01   +3.170006090919645e-01   +5.511234957530168e-01; +2.729141345902683e-01   +1.193279884693166e-02   +6.430302020140859e-01   +2.379342217569973e-01   +9.113295240299518e-01   +8.957394894816220e-02   +8.577078225023629e-01   +5.240420021937418e-01   +2.557468808090487e-01   +8.275677553499260e-01   +1.336268066601033e-01   +3.374664451187585e-02; +1.521902977829527e-01   +5.737381303869539e-01   +2.218522523001549e-01   +9.568086391831283e-01   +6.996738082317906e-01   +3.212694294649384e-01   +7.887906245876045e-01   +9.725138229587251e-01   +8.970688271806812e-02   +1.921279252267307e-01   +6.720980042016251e-01   +5.391233889589315e-02; +3.963265903821500e-01   +7.888378352852670e-01   +8.381896013255412e-01   +6.211394408945153e-01   +7.258118093459771e-01   +5.118606196773791e-01   +3.188881233515403e-01   +7.096468934114428e-01   +8.386057293023143e-01   +4.414144803726258e-01   +5.701089342778641e-01   +8.049113483778152e-01; +3.754875306643721e-01   +2.357588417909298e-01   +9.710717929856192e-01   +6.011895447636327e-01   +2.291331687830239e-01   +6.022091392556089e-02   +4.519034699825054e-01   +3.110336298447321e-01   +5.842582937702196e-01   +3.937813212651351e-01   +1.703771215572095e-01   +4.510990230793864e-01; +1.299325749906583e-01   +4.475162908473952e-01   +8.466629115289453e-01   +1.736744668011108e-01   +5.750202612011200e-01   +7.258543724657924e-01   +7.513665246942287e-01   +2.925230263982134e-01   +9.485884638332887e-01   +8.268831721617572e-01   +1.476808759678798e-01   +3.818656704673153e-01; +4.350600474647103e-01   +5.683935369918982e-01   +5.067364084189624e-01   +9.054932166918343e-02   +8.105503656989363e-01   +5.574538606230893e-01   +1.108698631178130e-01   +8.492764484623522e-01   +6.063036216313219e-02   +6.771681512105243e-01   +4.757167352782250e-01   +7.897379107922602e-01];
L2E_L3E_iAMPA_netcon = [+3.649581077338822e-01   +7.577152355471608e-01   +7.429426716186277e-02   +5.184483404875873e-01   +7.570931519970661e-01   +4.328654064185367e-01   +1.992760134893559e-01   +8.767393117478474e-01; +5.313354455013483e-01   +9.962897380896741e-01   +5.917952559109496e-01   +9.951268771845879e-01   +9.952674670968151e-01   +5.433847443776186e-01   +1.942061968431522e-01   +7.859607147858265e-01; +7.123549454909869e-01   +1.871096659158826e-01   +9.108898394978584e-01   +8.555570158579789e-01   +9.626204012172949e-01   +7.122466746102398e-01   +3.267023379175135e-01   +4.659255093548930e-01; +8.718931098626425e-01   +7.808281458580701e-01   +1.925626859752959e-01   +9.621439058698171e-01   +5.347213779480248e-01   +1.627754558749049e-02   +8.801631674998638e-01   +8.134096279961451e-01; +3.276011195776529e-01   +1.947720222689565e-01   +4.325844545337155e-01   +6.784584016284222e-01   +9.646583444964882e-01   +8.007986931304609e-01   +4.699891043451129e-01   +8.982477483151591e-01; +6.490472052694518e-01   +9.925163322035753e-01   +7.496434660102438e-01   +4.030356497154550e-01   +1.163405255043673e-01   +1.419588203760090e-01   +4.047177384710715e-01   +4.284889317943873e-01; +9.757024901481840e-01   +8.014219424150995e-01   +3.979047056221807e-02   +9.338978983986255e-01   +5.066603002564792e-02   +4.788527787917417e-01   +1.789957832549669e-01   +3.337704182437997e-01; +7.651750487132469e-02   +4.250601770421968e-01   +9.464630375331363e-01   +4.797033679110889e-01   +3.036845401314933e-01   +2.556309628879366e-01   +9.681361914220581e-01   +5.960433809432120e-01; +5.881120483481781e-01   +7.279727440634669e-01   +7.627410160003258e-01   +2.307605085756659e-01   +5.806558914603271e-01   +3.685876096153287e-01   +4.083888586281486e-01   +9.009385760324088e-01; +4.129577776107908e-01   +4.981338846633937e-01   +5.578721662028895e-01   +3.964840795939042e-01   +5.317784515976077e-01   +6.618425880493891e-01   +8.436977364167169e-01   +7.022247611162206e-01; +3.081483311562547e-01   +8.089319809301815e-01   +1.841399298782418e-01   +7.055046244533283e-01   +9.001479094641551e-01   +1.688699766531943e-01   +6.160153499653280e-01   +3.778598728543311e-01; +2.633583776923145e-01   +3.561639319939092e-01   +4.990297041662580e-01   +5.584895138858831e-01   +5.396227678402061e-01   +2.799083123488929e-01   +3.754867614140706e-01   +7.342546343542811e-01];
L2I_L3I_iGABA_netcon = [+9.550697071644531e-01   +3.123888343192829e-02   +9.117387630015909e-02   +4.604519601308900e-01   +3.274781606235670e-01   +3.678674741237293e-01   +6.857916574796151e-01   +8.045049536327901e-01; +5.434396836245804e-01   +2.086669501400460e-01   +5.932807729186350e-01   +6.387694430508516e-01   +8.040834941013782e-01   +2.091816735384206e-01   +9.106082446664369e-01   +6.681889278738971e-02; +5.397215212237563e-01   +4.550095565925604e-01   +2.420289594131054e-01   +9.170247455587799e-01   +1.000000000000000e+00   +4.414612234390029e-01   +6.113535059551073e-01   +9.503209527074918e-01; +3.104761356786838e-01   +1.275652965411755e-01   +8.402184745815598e-01   +1.621942518024653e-01   +9.803367368350323e-01   +9.553208104760980e-01   +9.002692648446204e-01   +4.966970520759126e-01; +7.047825733804726e-02   +9.439523136851804e-03   +8.583080338302760e-01   +7.146072598751319e-01   +1.266876936304316e-01   +1.246432036423901e-01   +1.939562097742668e-01   +7.542747829354706e-01; +1.821676651652722e-01   +7.270075021783804e-01   +9.627065870038972e-01   +5.775418641431275e-01   +2.311139751686512e-01   +4.699494365003430e-01   +7.543314499015153e-01   +7.413990619070511e-01; +9.294653914736707e-02   +3.534332817579574e-01   +4.890842182507683e-01   +4.332504917494495e-01   +2.445987277577506e-02   +8.558385844931814e-01   +3.473440195328792e-01   +8.305461717075082e-01; +4.629592545291967e-01   +7.799077629379474e-01   +2.195020168329222e-01   +8.837477954099386e-01   +6.082892331971816e-01   +4.268342842550691e-02   +4.191340547425957e-01   +1.568361433811944e-01; +9.880526834895117e-03   +4.366683858335915e-01   +2.272922166067004e-01   +3.929800785194258e-01   +1.097669635861668e-01   +6.909828096167350e-01   +1.555078345837311e-01   +4.579633220929365e-01; +9.145952026100251e-01   +4.373471191842837e-01   +5.370391209350174e-01   +1.784301110327188e-01   +4.075654201507867e-01   +9.785734865460969e-01   +8.197124798707400e-01   +6.185526928017805e-01; +6.431003990602827e-01   +5.014058735871348e-02   +7.618524985265591e-01   +6.324284392885523e-01   +8.841860848568925e-01   +2.840147940572472e-01   +6.242361203046096e-01   +9.314070369838992e-01; +1.389329147934588e-03   +4.887948488843896e-02   +3.465747177964028e-01   +6.244938039869093e-01   +5.491268103144162e-01   +1.337298792383090e-01   +7.395308874863958e-01   +8.348741108531241e-01];
L3I_L3E_iAMPA_netcon = [+8.951434860775825e-01   +2.549793955068543e-01   +7.411095740610555e-01   +6.804851307266805e-01   +6.010902558584955e-01   +7.479466729853448e-01   +7.451638745172889e-01   +2.244276403908486e-01   +4.624071893577373e-02   +8.010565111991901e-01   +2.900870122988594e-01   +8.012720259239898e-01; +5.826592658052822e-01   +3.236481564196259e-01   +6.939849230088648e-01   +2.346493439488996e-01   +8.566481718432000e-01   +5.425185034032255e-01   +1.263926996340485e-01   +3.506169328670740e-01   +2.145280849434483e-01   +2.337005612773755e-01   +4.033682748396943e-01   +1.045118865428646e-01; +5.828943669352704e-01   +4.029900915426342e-01   +8.235503520645057e-01   +4.554623801602510e-01   +9.889118960721621e-01   +3.388574380751808e-01   +8.220519126818892e-01   +2.859880147282637e-01   +3.975864670039783e-01   +9.323615922941934e-01   +8.627256709743194e-01   +8.212459340485120e-01; +8.548007428383686e-01   +4.051748769891569e-01   +8.290906253775149e-01   +3.836350403698188e-01   +9.290869074113632e-01   +8.331660214490388e-01   +2.633050019112734e-02   +9.267770535760063e-01   +3.334499010354514e-01   +7.636161319106763e-01   +6.138344475623391e-01   +8.403839981040770e-01; +3.388191369995791e-02   +3.862875999532691e-01   +2.938087324653586e-01   +5.377926469406669e-01   +4.099269328737465e-01   +5.513787884281351e-01   +4.154624324388128e-01   +5.062938790970473e-02   +2.302691755461618e-01   +8.264172308263977e-01   +9.911649257527226e-01   +3.547168402147030e-01; +8.849476611465755e-01   +6.086134456173971e-01   +3.103569889075455e-01   +9.914199035437773e-01   +1.421178191580581e-03   +9.582743365096786e-01   +7.305735568257111e-01   +5.933758512635759e-01   +9.359659747534513e-01   +5.726413723240229e-01   +2.037006517559731e-01   +4.300267193168824e-01; +4.066914897833752e-01   +1.661759449620331e-01   +5.238100021395954e-01   +7.556430597351342e-01   +5.413920319309107e-01   +8.927558673331446e-01   +7.817142631335841e-01   +1.622584198068555e-01   +6.831527481083308e-01   +7.922570830651292e-01   +8.279985675871212e-01   +5.711673057014782e-01; +3.669996887951862e-02   +1.887964161568698e-01   +3.261146850467903e-01   +9.814690957520192e-01   +2.079969726017336e-01   +3.573336824289922e-01   +3.680179244805839e-01   +8.382947392150571e-01   +9.629792246969758e-01   +3.292180152651936e-01   +6.761759668990970e-01   +7.008019093025075e-01; +7.461487562656248e-01   +9.467070107395696e-02   +8.329058246080001e-01   +2.358063684694521e-01   +2.202626953037620e-01   +5.474672668958096e-01   +7.459620195296612e-01   +1.687604053639505e-01   +4.388110620765620e-01   +2.238068012719857e-01   +2.494862263411411e-01   +7.426926276015560e-01; +1.547186219829336e-01   +3.222517630449873e-01   +8.099747037541788e-01   +5.276001644097672e-01   +3.266612948118489e-01   +3.460429228990318e-01   +8.927045381843153e-01   +5.024203459191714e-01   +9.394457299751043e-01   +3.116333954102442e-01   +4.767600922130238e-01   +7.568865824035165e-01; +1.443332003076023e-01   +7.705735822888601e-01   +5.577033675207476e-01   +5.232440100104325e-02   +9.645307610694975e-02   +6.232205121471678e-01   +2.438124397847185e-01   +9.991310702363612e-01   +6.629333335529831e-03   +5.851971081928495e-01   +3.988626433925774e-01   +3.892159243593948e-01; +6.065357138596422e-01   +2.341661343590206e-01   +2.624666933170245e-01   +7.579905860016930e-01   +7.486509701576376e-01   +7.974660864592313e-01   +1.288483737428157e-01   +3.553598711854206e-01   +6.109090692406370e-01   +8.303845120362885e-01   +5.988634263113670e-01   +4.281099356865951e-01];
L3E_L3I_iGABA_netcon = [+9.556989419028834e-01   +8.847523127876241e-01   +7.994805377878694e-01   +9.862405064956016e-01   +9.022825745589484e-01   +9.612313638620572e-01   +6.530062841165547e-01   +4.954747863920603e-02   +1.071283766241740e-01   +4.520018201374409e-01   +8.288127455662869e-01   +5.807554218131150e-01; +5.719715365983074e-01   +4.380238315889636e-01   +9.878666618024406e-01   +5.599633654075624e-01   +9.947173357111879e-01   +5.409565329498146e-01   +6.719312672359247e-02   +4.659836024411160e-01   +4.604465515444112e-01   +3.332424280224449e-01   +6.259597182567188e-01   +6.361685440553144e-01; +8.500311803336832e-01   +7.826769614536121e-01   +1.585432628302247e-01   +9.335928457259582e-01   +6.528184707167322e-01   +3.122895194618466e-02   +2.756771276276119e-01   +3.247922466889286e-01   +4.510090317926913e-01   +5.860667711201311e-02   +5.391452005125267e-01   +6.511648046149970e-01; +2.763696858395559e-01   +1.490263510978408e-01   +2.366514438874474e-01   +7.206334233152766e-01   +1.085017536617352e-01   +6.955867802669342e-01   +2.812045846127867e-01   +6.306798565964888e-01   +5.511937253784011e-01   +7.412049688043758e-01   +6.510253314383213e-01   +8.637325107280237e-01; +6.231676172683966e-01   +6.209033054149089e-01   +7.017640717384021e-01   +4.838326834041616e-01   +3.689747044227693e-02   +5.191067384386915e-01   +8.793870001940493e-01   +2.294559505675977e-01   +8.063238841395809e-01   +5.066502666519337e-01   +7.264043295196548e-01   +5.679527694089498e-02; +5.890358343305484e-01   +2.596089565591005e-01   +3.759568297795241e-01   +6.392626657785159e-01   +6.184880966246732e-01   +5.985958605391223e-02   +4.445537824419460e-01   +5.803313909546247e-01   +7.014919172027059e-01   +2.005257755088592e-01   +9.426656886650840e-02   +8.179829087555974e-01; +9.644051881154841e-01   +4.451263486550591e-01   +9.746933976924000e-01   +8.884946512904467e-01   +5.663304370238947e-01   +8.890789263375445e-01   +7.569082890561271e-01   +6.043582143056329e-01   +8.721469163617571e-01   +4.276086581580017e-01   +8.780148599066356e-01   +5.290416769178102e-01; +8.593259949374481e-02   +8.442904848005998e-01   +9.717301669400685e-01   +1.990460550415509e-01   +9.623964265660091e-01   +3.295113837314759e-01   +6.025596960258457e-01   +5.997914487426249e-01   +5.233705952587178e-02   +1.678133100704913e-01   +1.329561122009900e-02   +6.948135966581978e-01; +5.007009150387691e-01   +1.962756295890757e-01   +6.439576775114270e-01   +3.964225879962020e-01   +7.472496973585174e-01   +2.288604624002325e-01   +7.833180052060067e-01   +4.484915826627402e-01   +2.184593302512954e-01   +7.509446945760981e-01   +2.932651080332071e-01   +2.130439604529724e-01; +5.217814775567825e-01   +3.030869529940408e-01   +8.592786185700636e-01   +9.923793882934174e-01   +6.622901798111651e-01   +1.132734556859472e-01   +1.136782242705749e-01   +3.422067654588880e-02   +4.590200988557516e-01   +3.672364204556158e-01   +1.788516910163444e-01   +5.429496280297801e-01; +9.010847582665656e-02   +4.822587342539676e-01   +4.016295974968234e-01   +4.022023737309101e-01   +5.244941140592123e-01   +3.118873497461292e-01   +9.781065810278852e-01   +5.134829988870455e-01   +9.585910191823511e-01   +9.417488699226680e-01   +9.266924335527558e-01   +7.035905307552862e-01; +9.054724532804921e-01   +3.369601606280874e-01   +6.314281007385202e-01   +6.586747379767721e-01   +2.600593056012235e-01   +2.281205686144205e-01   +8.477436015631321e-01   +4.067682338752982e-01   +7.907221112873900e-01   +1.641312753443705e-02   +6.770733643956942e-02   +9.554987834968907e-01];
L2E_Input1_iAMPA_netcon = [+9.995159640295773e-01   +9.999903064696796e-01   +9.982956660649284e-01   +9.986222663972363e-01   +9.979919412571324e-01   +9.998333380143642e-01   +9.989424051932414e-01   +9.980792073209522e-01];
L2I_Input2_iAMPA_netcon = [+9.981414357498335e-01   +9.981849590491191e-01   +1.000000000000000e+00   +9.998739476919621e-01   +9.994494609030204e-01   +9.980895130153433e-01   +9.996333134573497e-01   +9.991530316185571e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
