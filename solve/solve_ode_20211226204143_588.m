function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.016866780812987e-01   +1.546413259169983e-01   +2.469966669523703e-02   -1.002568590705757e-01   -3.219623072289712e-02   -2.800203914129061e-02   -2.074798996747756e-03   +2.102228078185839e-01   -5.696269158530926e-02   +1.871273364177474e-01   -3.124229375495491e-01   +1.147590397872212e-01   -4.103102890186422e-03   +1.056721082990295e-01   -2.848856734050986e-01   -1.536162596748791e-01; +2.116577544910358e-01   -3.775516099240371e-01   +2.766859225530591e-01   +1.121981719155548e-01   +3.235009701320504e-02   -5.065443797729435e-02   +1.590761812993005e-01   +5.541523303646921e-02   +9.637466869712957e-02   -7.670008994762510e-02   -3.098493845756838e-01   -1.510265311684569e-01   -2.697236019679725e-01   +1.629580748984104e-01   -1.265046446478004e-01   -2.640324700543886e-01; -3.099204131208543e-02   -2.219450934034654e-01   +1.376178193947377e-01   +3.344811786672904e-02   +1.070129755979091e-01   +6.434482405928525e-02   +1.694063420095786e-01   +1.989978684198027e-01   +1.855438501056645e-01   +1.271097368312897e-01   -2.241784450437967e-02   -1.560773851444098e-01   +2.101338527833956e-02   +6.943196129533519e-02   -3.708728112340908e-01   -7.685974918757398e-02; -2.000443037830571e-01   +1.741492090928596e-01   +1.422168875132065e-01   -8.321451108416533e-02   +2.045977548526809e-01   +3.011120689523562e-02   -7.096980004079953e-02   +1.114632104992749e-02   -3.088617593203320e-02   +2.821487492736252e-01   +1.460850362619192e-01   +1.154437986252110e-01   -4.497804542897374e-02   -1.001541281645043e-02   +1.825646557065335e-03   +1.871893130970426e-01; -1.985871824094916e-01   +2.165939827198759e-01   +1.363421927241852e-01   -8.882218452339288e-02   +3.033019503044812e-01   -3.716760480436881e-01   -8.198400348375545e-03   +9.364908532756534e-02   +2.365873454279506e-01   -7.792094130028750e-02   +2.076428013745869e-01   +6.695380465048997e-02   -5.138559233256970e-02   -1.266894228985350e-01   +4.702520222087798e-02   +1.314670947302974e-01; -7.475869423421568e-02   -1.778589682782902e-01   -6.890992958963657e-02   +4.927938857929506e-02   -2.366820675203818e-01   -1.324087361797234e-01   -2.508513754706168e-01   +4.451075635387677e-01   +4.038494792170764e-01   -4.149534219693542e-01   +1.397996151070371e-01   -6.590532506462955e-02   -3.593105154091284e-01   +2.622681634637210e-01   -5.676504929453539e-02   -2.753068770047321e-01; +1.993510161021554e-01   -3.737625756755660e-01   -4.338340505561045e-02   +1.778412129173291e-01   -3.362792197680108e-01   +2.201929456685632e-01   +3.283650550590542e-01   -3.382390583494457e-01   -1.660278068099316e-01   +9.923909211875606e-02   -1.589021935490066e-01   +3.321625496572619e-01   +2.686673038326157e-01   +9.493304435234465e-02   +2.096226136954001e-01   +2.521137725049388e-01; -3.978601249595935e-02   +3.255434463351863e-02   -4.354840783027560e-01   +6.570579533776218e-02   -2.563010037972810e-01   -4.097894859853922e-02   +3.738171479081164e-01   -2.418485560279291e-01   -6.276819202086614e-03   +1.507751301899915e-01   -1.402181950218802e-01   +9.276922305900762e-02   -6.317260232702605e-02   -5.069811102577850e-01   -4.803184228607673e-03   -8.803913858716139e-02; -1.350779676037535e-01   +5.451898139899042e-02   +4.129889602401527e-01   -4.330763168761441e-02   -9.560036240618697e-02   -1.669309036347200e-01   -5.512632264896333e-02   +7.347317395094240e-02   -2.161392556030859e-01   -2.489368143170140e-01   -1.334507342778035e-01   -3.673646686025758e-01   +1.549841160022310e-01   -2.151006715084979e-01   -1.350644405599954e-01   -1.624445889779111e-02; +6.358479517258893e-02   +5.159622086376096e-02   +3.327777267413987e-01   -2.620801461774492e-01   +3.312111223406038e-01   +2.966065495316025e-02   +9.972204491660493e-02   +3.392757105350537e-02   -1.637016558289552e-01   -1.828351576105651e-01   -1.416039893512002e-01   +4.057455001828861e-01   +6.517380782180927e-02   -2.706985403510182e-01   +1.835423682902094e-01   +1.458170652157810e-01; +1.028200630073696e-01   -1.905260702956690e-01   -1.788074463969079e-01   +1.389221392983730e-01   +2.389388907315944e-03   +3.187846765142713e-01   +7.894557754797125e-02   +1.699511789772389e-01   -1.108820554688175e-01   +4.853808159631620e-02   +4.435261788056554e-01   +2.090973426885680e-01   -3.722507812409488e-01   +2.258327368474448e-01   +4.259107988310580e-01   +1.941471097879275e-01; -3.877851385654841e-02   -2.031808779821215e-01   -3.641089488361708e-01   +2.963303626547164e-01   -1.726488404775121e-01   -4.697842435783303e-02   +8.839563052182817e-02   -1.896992736685152e-01   +2.933583441416627e-01   -2.141916030106417e-01   -4.124260008454121e-01   -8.619349023618215e-02   -4.166986014119648e-01   +3.506526538794904e-01   -2.703670193218860e-01   -1.800097967879881e-01; +1.634597199638518e-01   -1.249421175457903e-01   -4.311610110412704e-01   -7.226075167079617e-02   +1.862495331063008e-01   +5.917025078775684e-02   -2.851145481106143e-01   -1.468770040780015e-01   -1.333297981247611e-01   +2.066111945796897e-01   +4.906850842617920e-02   -2.474980149860458e-01   -1.426326718379990e-01   -1.796314856259350e-01   +2.977545832683003e-01   +1.059020460995506e-02; +5.618426482032195e-01   -5.766570300679055e-02   -1.432033909502441e-01   -1.809959409026380e-01   +1.673999503487364e-01   +1.458338007281303e-01   +2.483425805140525e-02   -1.753875503176231e-01   -4.287006878279065e-02   -2.094913092933575e-01   +4.957793514072376e-02   +1.476541453466537e-02   -4.103404319185192e-02   +2.770539414113182e-01   +1.743293427581288e-01   +2.965931643032771e-01; -1.833618281035598e-01   +7.811585718422977e-02   +1.751102533134103e-01   -2.104219384311591e-01   -2.327119938498715e-01   +4.610396209819234e-02   +7.526836602268600e-02   +4.086369997861568e-01   -8.603986940295459e-02   -6.629257607781115e-02   +3.301376458936233e-01   -1.214163028188426e-01   +3.296789773097570e-03   +1.491915002652343e-01   +1.438146304496418e-01   -9.003789549251598e-02; -1.158778219613375e-01   -3.418881923716428e-01   +2.374791371090124e-01   -1.376220012697478e-01   -2.704004473448499e-01   +2.024643905652795e-02   -1.155912758572969e-01   -2.883669203908703e-01   -8.140145791707729e-03   +2.546888553101469e-02   +1.527818476970427e-01   +5.878818463294304e-02   +1.681041115035843e-01   -1.494606370590179e-01   -1.515399394060214e-01   +3.762169951436627e-02];
L1E_L1I_iGABA_netcon = [-2.543183524631975e-01   +3.192622824146972e-01   -4.976051106636523e-02   +5.451216630482911e-03   -2.025866297590588e-02   -2.091632246586958e-02   +2.680231816326355e-01   -1.546768233702504e-01   +2.485624296901510e-02   -7.632251304920587e-02   +4.959495585919137e-02   -2.979003019050063e-02   +7.403240166514274e-02   -3.064343745454247e-02   -3.559840242119505e-02   -3.114323007657661e-01; -1.668706914848299e-01   +2.244983376136730e-01   -2.456491280952041e-01   -2.317960694742663e-01   +1.524479461019254e-01   -2.698831746893046e-01   +1.909497110469234e-01   +4.254436960560383e-01   -3.151233853033332e-01   -3.604034762038620e-01   -2.167862837369884e-01   -1.396026640261614e-01   -1.667959551891095e-01   +2.017194224677922e-01   -8.759128519170241e-02   +1.282186855149057e-01; +1.661731880790600e-01   +2.005365271677778e-01   +6.906555982274740e-02   -2.726928524030124e-02   +2.319563168747930e-01   -3.628328073177448e-01   +2.577647712716936e-01   -4.863928852403945e-02   +8.093008612721689e-02   -1.607557866734607e-01   -1.947193363168399e-01   -1.517504622370197e-01   +9.114899079572297e-02   -2.667873132526534e-01   -2.850770804776520e-01   -1.395774387589039e-01; -5.111332145339863e-02   +3.591115273013695e-01   +3.363004864781899e-01   -2.718616026551031e-01   -1.260332348003818e-01   -2.593978648172690e-01   -1.303296999944401e-01   -4.506600989559009e-01   +2.393684580654776e-01   +1.487708322992435e-01   +1.648839417440931e-01   +2.102465264124172e-01   +2.262341681907435e-01   +5.458580246386698e-02   +8.143668531981925e-02   +1.807124520070818e-01; +5.384328504730707e-01   -1.319396265512749e-01   -4.898836000873404e-01   -2.088295746565397e-01   -2.240324869307886e-01   -6.561432369232566e-02   -2.258006882119677e-01   +4.468758241311843e-01   +3.364408108400865e-02   -1.318313391438232e-01   +9.985655202127801e-02   +2.841823170640941e-01   +2.227405067972138e-01   +1.283393529889334e-02   +8.506356178420349e-02   -1.074816940855400e-01; -1.074745916219913e-01   +1.233107558608757e-01   +2.309588068228114e-01   -1.221240278236953e-01   -1.764066346077696e-02   +1.583069508916851e-01   -9.252865347276767e-02   +5.455002321149974e-02   -2.582700013888408e-01   +1.864571671376125e-01   -2.631708835138513e-01   +9.374121690090634e-02   +3.730291515283394e-01   +1.191175954568499e-01   +4.043740665735914e-01   -1.179268712398023e-01; +1.629353502111004e-01   +1.823319830151375e-01   -1.042783436839137e-01   +1.509874660306686e-01   -1.267350103973427e-01   +4.902142272973647e-02   +1.129692832119108e-01   +1.127902049910816e-01   -4.297413804268649e-01   +1.904016509546122e-01   -1.875422546967588e-01   +1.201032057708371e-01   +2.148169657225886e-01   -4.977885926277583e-01   +1.279873990303502e-01   +2.046796484971262e-01; +1.120910787777250e-01   -2.241740490657026e-01   +5.584767004525910e-02   +6.069733141990654e-02   +3.307578799544002e-01   -1.213542423122663e-02   -2.623957629491248e-01   +3.905558054330436e-01   +2.275277727152555e-02   +2.074156187631523e-01   +2.942696463568364e-01   +3.297346381409958e-01   +1.538656508921512e-02   -1.842221821586091e-01   -1.596848456261623e-01   -1.901925599201248e-02; +1.971050542395565e-01   -4.122907782503106e-02   -1.417866131183222e-01   +6.116492542455735e-02   -5.689388376984758e-02   -2.591615414934690e-01   -1.930418506776670e-01   -1.788294759764747e-01   -2.549628283826442e-01   -8.300774200461555e-02   +2.232436199125178e-01   -7.969515050451020e-02   +2.035906772044129e-01   -1.502501308287389e-01   +2.621557680380392e-01   -7.612144938881385e-02; +3.892686680205579e-01   -2.518346762279605e-01   +1.238228550006401e-01   -2.787862799502006e-01   +3.970833691108930e-01   +5.620639396101898e-02   +3.524271645348940e-01   -9.099324641507936e-02   -1.175878915756076e-01   +9.407454191366546e-02   -1.118329289659533e-01   -3.691233049207125e-01   +5.531339684794312e-02   +9.460542080198871e-02   -1.254129473840485e-01   -8.795234349549523e-02; -3.092285707421992e-01   -1.013280849874993e-01   +2.981216575999657e-01   +2.570108130236152e-01   +1.265695215317356e-01   +1.437932265091778e-01   +2.693970293561935e-01   -2.059364324410893e-01   +1.779470233109766e-01   -3.719505550323240e-01   +2.068554776855205e-01   -7.624099792686774e-02   -1.886496830591007e-01   +2.813983184662555e-01   -1.997796778212334e-01   -1.745404641754154e-01; -5.136105940963023e-02   -2.452074569866041e-01   -3.982907281432228e-01   -2.510993303935871e-01   +2.026257312669411e-01   +3.022387486083187e-01   -2.500511950415993e-01   -2.018958548784744e-01   +2.519107327423451e-01   +1.993447365351153e-01   -7.868287242856906e-02   -2.412642284673749e-01   +7.517766147128929e-02   -1.446146784060482e-01   -7.811052295115406e-02   +1.679809762502940e-03; +1.685384244124273e-01   +8.317007796952824e-02   +2.720740486754982e-01   -1.572603664257601e-01   +7.864821641223035e-02   +1.260537498305677e-01   -3.456933905174682e-01   -1.668277260090816e-01   -1.982065951938571e-02   -1.229469432851965e-01   +9.689382285958328e-02   +2.035920764210288e-01   +4.041521004034918e-02   -2.148342731327725e-01   +4.939885377384769e-02   +1.423446667043986e-01; +7.606206962896099e-02   -2.551522539559933e-02   -1.235154957090596e-01   -1.728211397337018e-01   -4.531094898220794e-02   -2.417426479487482e-01   -2.814282377302381e-02   +2.617861036394296e-01   -1.915444955973071e-01   +2.704389669744462e-01   +2.953137908394863e-01   -3.907320441108130e-01   +8.272154640743927e-02   +7.114293536322708e-02   -1.198356004258137e-01   -1.022659451702389e-02; -9.917524009076281e-02   -2.093527992325886e-01   -1.873040863279368e-01   +1.234006035754571e-01   +4.243380005167857e-02   +1.061833195232315e-01   -2.757635183415919e-01   +2.033476592239172e-01   +3.949022674734348e-02   -2.693594098438489e-01   +4.907090422101557e-02   +6.745781937073808e-02   -3.569537862903141e-02   -1.926469114502443e-01   -2.617381508075951e-01   -2.146332899037978e-01; +7.403953463757851e-02   +1.665623814784253e-01   -2.247387623837559e-01   +7.794595052345496e-02   -1.373924664837875e-01   +2.330595142583519e-01   +2.798261647393027e-01   -1.813228545086036e-01   +3.196401103625184e-01   -1.250107637134021e-01   -3.500865288348984e-01   +3.392201189709796e-01   +2.300482486824039e-01   +4.687814026761382e-02   +3.256009929032559e-01   -4.122317746096764e-01];
L2I_L1I_iGABA_netcon = [+6.429797092523091e-03   -4.189788813313500e-02   -3.455001903788598e-01   +1.674733486652841e-01   +1.356061867991079e-01   -9.812428347296766e-02   -6.176722672545198e-02   -1.930084961385637e-01; +5.593589343118576e-02   +2.174161306309672e-01   +5.678164686582429e-02   -4.044076019859928e-01   -1.713130415771110e-01   -1.243125659507182e-01   -1.166967243370378e-01   -1.088038470547215e-01; +1.592099724342238e-01   -2.144288308612037e-01   -1.333091593521255e-01   +2.085252062038045e-01   +2.370864892997723e-01   -1.892530103585352e-01   +3.242383418549067e-01   -3.900700277999682e-02; -7.868343219263191e-03   -4.680307904458014e-02   -2.532002006031218e-01   -1.661801667302524e-01   -5.323211632442006e-02   +4.096929593879698e-01   +2.334138216379629e-01   +5.897431366597822e-02; +1.672566934159111e-01   +8.659107965195527e-02   +1.958062310487077e-01   -1.324580187209730e-01   +1.121497177843182e-01   -5.994273300599164e-02   +2.961640688908582e-01   -3.978331715948042e-01; +2.264431922850517e-01   -2.198052728160296e-01   +3.079410618506191e-02   -9.151562225207784e-02   -1.352655213792905e-01   -2.050041847742824e-01   -1.086725480551543e-01   +1.149215689028614e-01; +2.857693946131262e-02   +2.575077047171961e-01   -1.031599630606998e-01   +2.987098404082683e-01   -1.131206990937743e-01   +3.836716540922949e-01   -2.281393999510982e-01   -3.844368711737439e-01; +1.655444805646436e-01   +1.920015534696304e-01   +9.783356050962719e-02   -4.436694079239491e-02   -2.613365753505116e-01   -5.686161800894057e-02   +3.708831552885974e-01   +2.210014465066006e-01; +2.780864167831426e-01   +1.453333284666303e-01   +4.596167492443490e-01   +1.456571781066761e-01   +3.142910213740538e-03   -2.325563181571920e-01   +1.419939363062579e-02   +2.516225280484141e-01; +1.737789343978420e-01   -2.439781842323479e-01   +5.170231605066682e-02   -1.645634003585146e-01   -1.786631790307912e-01   +2.026115292279257e-01   +4.406555345789644e-01   +1.933809397344473e-01; +4.179012706542344e-01   +3.030684766332838e-01   -2.830369071473537e-02   -6.791540860044315e-02   +4.740418470245256e-03   -2.053761999440269e-01   +2.674219425565338e-01   -6.207109544749127e-02; +4.775086951038919e-02   -5.298055834769097e-02   +8.428678095983641e-02   +3.973557690310460e-01   +1.908545339916460e-01   +2.503852958487023e-01   +3.760918898095711e-01   -4.922061512077530e-02; +5.090122591039498e-01   +1.682970685536533e-01   +4.048345339318299e-01   -3.265321989564246e-02   +7.118553544308134e-02   +2.987150141010976e-01   +1.939451766382135e-01   +1.915425187428502e-03; +1.423627971896924e-01   -4.644698158595568e-01   -3.575183494361468e-01   +4.293884006774241e-02   -1.888860156920759e-01   -1.116108203570931e-01   -1.557531966792958e-01   -1.219963733114108e-01; +2.401417791878663e-01   -5.412906527707205e-01   +2.593954117101964e-01   +4.676945791020809e-02   -3.165374096759322e-01   -1.108133510188299e-03   +8.821171443332872e-02   -4.997741177430012e-02; -2.651020620248367e-01   -9.230883929956146e-02   +3.286514642015803e-01   +3.578495064253701e-01   -1.221314006214641e-01   -1.095285131950392e-01   +1.503239613991703e-01   +2.474400236588599e-02];
L1I_L2I_iGABA_netcon = [+1.254256098030214e-01   -2.098636905412588e-01   -2.552094575093610e-01   -5.413955301373770e-02   +3.959994850455142e-01   +1.889217967884521e-03   +3.542702032680282e-01   -1.717872256743186e-01   -3.523647469881415e-01   +1.868784898621015e-01   +1.849516593126975e-01   -3.520764184855973e-01   +3.687234568177496e-01   +1.268875487568490e-02   -1.276306635249431e-01   -3.116981960717269e-01; +2.414691652536754e-01   -1.140898844962006e-01   +2.583452974548350e-01   -2.110412234050636e-01   +2.213278572577336e-01   +1.294335855484883e-01   -3.165804440555938e-01   -5.917031643512241e-02   -4.118179750932876e-01   -1.729466342871727e-02   -5.621264978466388e-02   -1.021090905687442e-01   +2.911198880592629e-01   +1.580651582853206e-01   +2.813661765766928e-01   +2.336694224074629e-01; +3.229298724562850e-01   -4.369934223032449e-01   -1.670498259809292e-01   -1.284856152516883e-01   -1.506472986184845e-02   +3.370836238109353e-01   +1.532374940707749e-01   +2.725279774342578e-01   -5.500998601181468e-02   +4.192435081210055e-02   -1.032811629536815e-01   -1.905025595657116e-02   +1.366728028770516e-01   -9.451686988598786e-02   +2.756413068746259e-02   +8.648901394490158e-02; +2.165382362778117e-01   -1.897750026874540e-01   -6.312564143863307e-02   -1.751322683588224e-01   -3.285509855052106e-01   -1.830283819735679e-01   -2.554458875757441e-01   +2.742591704456407e-01   -6.831923166825829e-02   +1.994131115153248e-01   +1.032163757759789e-01   -1.556424394755352e-02   -1.120597795621430e-01   +3.557100720495257e-01   +7.109283662286726e-02   -3.971782405211784e-02; +2.800104997818668e-02   -9.083169954528278e-03   +1.153883021962236e-02   -2.866423758878387e-01   +1.367256439275862e-01   +6.478410073817195e-02   +1.631580993635461e-01   -1.791648279985181e-02   -3.503938615557081e-02   -1.622444825779419e-01   +4.346658360814067e-02   -9.125504510042942e-02   +4.786062064968521e-02   -2.824646925751000e-01   -2.143568342983904e-01   +2.160062121938594e-01; -4.568559128948453e-01   +5.462410472138390e-02   -2.288121794750059e-01   +2.640037305529968e-02   +2.245908596097818e-01   -1.879049902738107e-01   -4.188145801209213e-01   +8.052093719148071e-02   -2.081484175709067e-04   +4.789579226012752e-02   -2.494278579288696e-01   -5.537001660968577e-02   +3.156179978593350e-02   +2.005520817398154e-01   +8.993241310921563e-02   -1.604523864761092e-01; -2.356963726515948e-01   +2.302084717141418e-01   +1.906963553933776e-01   +1.890363426970826e-01   +2.672971770589414e-01   +1.077747468416087e-01   +3.121030393352698e-01   +3.151114321936369e-02   +2.121096466990173e-01   +2.493511822233325e-01   +6.772654987895553e-03   +2.868958535459029e-01   -4.343815210036420e-03   -1.257454723580069e-01   -1.178195162532650e-01   -1.538846975870034e-01; -3.247948578182710e-01   -4.278363125162375e-01   -1.784654062576288e-01   +5.141023464360425e-02   +1.078340268304421e-01   -2.410549180330537e-02   +5.931698813568670e-03   +8.744119408412286e-02   +3.012900062796951e-02   -2.914615587921467e-01   -1.541272590913167e-01   -4.829416805931127e-02   -2.800042717511096e-01   -5.493485956420725e-02   +1.032351209779669e-01   -6.155513827982356e-02];
L2E_L1E_iAMPA_netcon = [+4.565377710430129e-01   +2.567913193722931e-02   +1.642888915408385e-02   +3.757049980850760e-02   +1.447316698221331e-02   +1.136363399221058e-01   -2.197798895756585e-01   +2.590066575612585e-01; -1.507222483935527e-01   -3.540263747421493e-02   -1.675856879022167e-01   -1.266212724128434e-01   -3.970510283859178e-01   +2.016914602413145e-01   -1.686498043588573e-01   +6.967553522384407e-02; -2.066019584518192e-01   -6.220297483431164e-02   +3.383714321196839e-02   -9.423910820645788e-02   -6.269706065232493e-03   +3.889277243463214e-02   +2.040507305233427e-01   +7.611789458161211e-04; +2.503535097302197e-01   +2.304642954188350e-01   +6.867946441404384e-02   -1.600598966354566e-01   +2.604955058029153e-01   -4.524333301953162e-01   +1.794520984698278e-01   +2.974920743245429e-01; -1.413651782207149e-01   -4.303805319407299e-01   -2.045004116608059e-01   +7.377844712558428e-02   -5.842465515521929e-02   -6.393108822164328e-02   +4.152141892370128e-02   -2.136056612365446e-01; -1.378552646154498e-01   +2.024008755112139e-01   +1.584953726668126e-01   -1.673191752801003e-01   -2.045992700007131e-01   +2.362777206637044e-01   -4.720931333658793e-03   +8.564283294051837e-02; -1.135246817148292e-01   +1.302300983578874e-01   -4.084491919908871e-01   -3.495499332821201e-01   -5.250177344426742e-02   -2.121617033618553e-01   -1.631713152864727e-01   -1.021146412530047e-01; +1.156039059109391e-01   -4.162818658035751e-01   +5.399504626185045e-01   -2.529073663973737e-01   +4.378006633115837e-02   -1.916767204630268e-01   +1.059277289026013e-01   +2.572514587758422e-01; -2.111962134847609e-01   +3.486096014628121e-01   -8.890118295934701e-02   -1.905193664302856e-01   +2.071674972236479e-01   +2.240128570892648e-01   -4.221232337063626e-01   -5.199518039815336e-01; +1.755190023217381e-01   +1.324234634773590e-01   -7.288593942993861e-02   -4.490583808231656e-01   +8.906348782496071e-02   -4.923389513016847e-02   +1.137350874983643e-01   +1.412945329386638e-01; +3.004844935202522e-01   +1.826280351149356e-01   -3.176819617997715e-01   -1.852503370676706e-02   +2.635372819175491e-01   -1.763743339518845e-01   +2.750433308301128e-01   -3.874159625159257e-01; +1.565475496586738e-01   -8.144118426931066e-03   +1.022388256793299e-01   +4.238563523089110e-01   +1.594764523783452e-01   +9.659937667510403e-02   -1.764962669667292e-01   +2.948758206276765e-01; +1.802113363969059e-02   -2.102664064732186e-01   +1.118353034511746e-01   -4.420021476439913e-01   -1.649845056984537e-01   -3.663390097408020e-02   +1.958647869513635e-01   -3.325686891039067e-01; -1.690610199381463e-01   -5.016880774034353e-02   +8.860323568323382e-02   -1.378434201800927e-01   +1.605355385253148e-01   -1.561467356806663e-01   +3.448488588481420e-01   -1.255499630304590e-01; +3.356855661726042e-02   -2.027334461025876e-03   +9.994400128548622e-02   +8.515266425160839e-02   -1.979157837008191e-01   +2.110931499460875e-02   -2.553892664199258e-01   +1.582102461656390e-01; -3.015509527646487e-01   -3.272312795088829e-01   -4.910518238302238e-01   +2.918853234017371e-02   -1.977304115472736e-01   -4.456329072760351e-02   +1.983107311799960e-01   +2.360152536450242e-01];
L1E_L2E_iAMPA_netcon = [-2.595464400839074e-01   -3.924155656419843e-01   -4.487741501356300e-02   +1.220062046623679e-01   +1.329989768247299e-01   -1.741703271803308e-01   +1.403848238212603e-01   +2.877037056631941e-02   +1.062604948334044e-01   +3.203996992147284e-02   -1.190771951356793e-01   -1.719201532415533e-01   -7.231740704868057e-02   -2.053897547542216e-01   -1.036326428460289e-02   +1.450897188888431e-01; -2.231421277635824e-01   -3.962433390536034e-01   +1.022066824718035e-01   +1.245710112640006e-01   -8.598582012415280e-02   +2.432985665300011e-01   -1.394334332006624e-01   +7.578305108164858e-02   +2.360761958928009e-01   +2.167259340706740e-01   +1.818217888542589e-01   -1.069103146060048e-01   +1.240602540641494e-01   +3.574846688912613e-02   +2.373090923754035e-01   -7.758794573189537e-04; -2.429082775897451e-01   +2.699401702979057e-01   +3.091980535258212e-02   -5.369448737814101e-03   -1.838727338791247e-01   +1.859294339882434e-02   -1.899899838368253e-02   -2.887881240618281e-02   +1.229916473097008e-01   +2.887045959443312e-01   -3.248665680519112e-02   +2.523979043535004e-01   -1.898567962038166e-01   -8.362915305116135e-02   -1.526628602082198e-01   +6.850760529889061e-02; +9.858491657683389e-02   -3.296095598171211e-02   -9.421898048061240e-02   +3.178594600428064e-01   +1.779700448168146e-01   +2.745839934045849e-02   +7.765662014813254e-02   +1.176261142720011e-01   -1.131118738819508e-01   +4.483082850811007e-01   +2.718968158205792e-01   -2.921538442629066e-01   -4.242217938322719e-01   -1.984631186178373e-01   -1.105161633457815e-01   -1.595756955426698e-01; +1.802172122654227e-01   +1.655789803862492e-01   +2.229264826948835e-01   +3.224886188496376e-01   -2.709153185436239e-01   +2.126013828862792e-01   +3.954808707096863e-01   +2.006967618495440e-01   -4.589422170450380e-02   +1.638619205104358e-03   +1.423283804221972e-01   -2.701493886235273e-01   +1.771993892502967e-01   +1.115598800491618e-01   +2.782835450877614e-01   -1.495456903068399e-01; +2.482872701575070e-02   -1.632727761019575e-01   -3.799625147688449e-02   +2.903470899138060e-01   +3.316540911403901e-01   -2.209099124171488e-01   +1.864501031719840e-01   -3.014083452977766e-01   +3.134856120431012e-01   -3.073943999952967e-01   -1.999284559032610e-02   -1.159743011837543e-01   -9.214967982668597e-02   +6.578116182598222e-02   +1.256576658054914e-01   -1.746132559743038e-01; +7.770643073493280e-02   -1.098872423166811e-01   -2.007000982515913e-01   -1.088857158285973e-03   +5.336603456240487e-01   +1.011533425623263e-01   +5.600197164609563e-03   -7.915952989570124e-02   +1.433651858727289e-02   -2.081058575001112e-01   +2.918370398240516e-02   -1.585052436810243e-01   +2.802793895505397e-01   +3.096640474319960e-01   -8.142062663892843e-02   -3.063229381918346e-01; +3.556210598229443e-02   -3.747562635334761e-01   +7.454495138235662e-02   -7.615195617227241e-02   -2.448967793670876e-01   +1.558358609125842e-02   +1.004536666251472e-01   -2.126131181582513e-02   +1.824531941319715e-01   -1.392597706989508e-01   +1.877016100830269e-01   -6.820179533959830e-03   +8.145695729580105e-02   +9.488578472550396e-02   -3.078809601205898e-01   +1.696490522591399e-01];
L2I_L2E_iAMPA_netcon = [-1.588368247335296e-01   -4.779010219673545e-01   +1.584958846211234e-01   -1.570615857324490e-01   +1.828657418678148e-01   -3.627850228344007e-01   +3.178027336567467e-01   +3.223165252716867e-01; +1.394384150606656e-01   +2.831030923905728e-01   +3.471661833442378e-02   -3.621553458676503e-02   -3.701980366116880e-02   +9.379837225966695e-02   -4.034236087310506e-01   +8.691844870643312e-03; +3.346225525568599e-01   -3.827998744541143e-01   -2.798036320338964e-01   +2.180549810243981e-01   -3.734486794764025e-02   +2.105772889182394e-01   -4.288310037330867e-02   +2.147204212244726e-01; +9.824948375861120e-02   -1.721008546521826e-01   +2.971401877610780e-01   +1.567390212820064e-01   +1.734691940725843e-01   -1.869063735922084e-01   -2.594068032125478e-01   +2.027779847636676e-01; -2.988152337892998e-01   -1.956142881580042e-01   +1.230358667882621e-01   +4.428281201049679e-01   -1.694010114128190e-01   -1.150386170475387e-01   +2.002018449914752e-01   -2.700286496017038e-01; -2.719614338968636e-02   +1.267181564610646e-01   -7.651048529957115e-02   -1.955178415538442e-01   -1.614576984621975e-01   -1.259776409908595e-01   -2.100246502416616e-01   +9.280193810714392e-02; +3.234171656052746e-01   +1.724923741549034e-01   +5.647085923640201e-02   +3.381657826280296e-01   +6.898406167888545e-02   -1.645123931574657e-01   +2.487074303085378e-02   -1.295996557349680e-01; -4.431971532617360e-03   +4.634094417885066e-01   +2.411288602002264e-01   -6.230379011618999e-02   -3.487364736948439e-01   -7.485103817595444e-02   +3.806998018279079e-01   -7.792265812007093e-02];
L2E_L2I_iGABA_netcon = [+1.870385958709643e-01   +6.112858604662107e-02   -2.900368840182192e-01   -7.896666508741844e-02   +6.647050636589631e-02   -3.593761486066688e-01   -7.604001933384516e-02   -5.721673542993844e-02; +3.225024182021181e-01   -7.443903839196236e-02   +5.472424202373581e-02   +3.406484850494152e-01   +3.819096338249695e-01   -1.607097212905125e-01   -5.108310832322081e-02   +3.205252953793850e-01; -5.482654537333945e-02   -6.926036974157783e-02   -2.518986924808322e-02   +2.534502447276725e-01   +2.852588511219000e-01   +1.018010551730158e-01   -6.886780843122595e-02   +8.727343262158993e-02; +9.295449798248243e-02   -3.063610777636788e-01   +2.933546098209461e-01   -2.779852824134345e-01   +4.927994063672184e-02   -5.107360052704266e-02   -2.601968947177113e-01   +9.393778731046520e-03; +1.355300317633042e-01   +1.914592375272095e-01   -2.548295758461322e-01   -1.359492660290452e-01   +3.137864538865893e-01   +2.394310604578456e-01   +5.923426706570159e-03   +7.017882108654504e-02; +2.466839057085403e-01   +4.499451636750664e-01   -1.037922127201530e-01   -1.971820829993733e-01   +1.946692933470512e-01   -2.618928652728423e-01   -1.850699379741928e-02   -1.341547326736176e-01; -2.805421722649793e-01   -1.284903529884523e-01   +5.562561421658917e-02   -7.289038638539466e-02   +2.370123365960028e-03   +1.655037443871130e-01   -1.960539380989100e-02   -5.054303564703458e-01; +9.892075757207477e-02   -2.738142073945380e-01   +1.713278657550874e-02   -3.937961103180602e-02   +2.634799722060630e-01   -3.543387875720241e-01   -1.749854849602065e-01   +2.413109725999718e-01];
L3E_L2E_iAMPA_netcon = [+4.060709760171880e-02   +1.638346021709043e-01   -1.626892477254903e-01   -8.564445595933040e-02   +3.316641828751654e-01   +9.699365322294332e-03   +1.511012860361293e-01   +4.304385269874064e-02   -9.664350456918545e-02   +2.457313069635366e-01   -7.672051159662099e-02   -8.683054022642987e-02; +2.752768973507890e-01   +7.389748874999091e-02   -9.831201429768080e-03   -9.625685617657526e-02   -3.471655074824682e-01   -3.660036012101623e-01   +4.340926160923783e-02   -2.899751166696157e-01   +1.187268352184585e-01   +1.858511972681022e-01   -1.916397559779212e-01   +2.564735509349367e-03; -1.930735308333028e-02   +3.838962251103361e-01   -1.239517591624492e-01   -1.949335937496073e-01   -1.432923558338008e-01   -6.027192675477330e-02   -2.348559136849811e-02   -6.153480499815407e-02   -2.450378046254055e-01   -8.565672804744906e-02   +2.119835327017998e-01   +9.740882021443698e-02; +1.580235306792935e-02   +5.448934760592014e-02   +9.438358326145750e-02   -9.481485867714279e-02   +2.207318126375991e-01   +4.631245117749275e-02   +1.519893634176696e-01   -3.065647843839961e-03   -1.266292994106343e-01   -9.972645030465022e-03   +5.127020847485525e-02   -3.945988799617675e-02; -3.928990286042300e-01   -2.537642198169476e-02   +1.958840549050140e-01   -4.992770293766885e-02   +1.220066580565622e-01   +1.808797281376320e-01   +2.017731224553187e-01   +4.357477580566713e-02   +7.118429249112995e-02   +6.412466355497200e-03   -5.041254596145258e-01   +4.237022206916889e-02; -1.975899827233306e-01   +4.612386946938964e-02   -1.822970768515285e-02   +2.892076602652875e-01   -2.016523813237273e-01   +2.963598489155517e-01   -2.908112062241869e-01   -2.779526730972676e-01   +1.256387057075795e-01   -2.157652403932696e-01   -6.759717213117744e-02   -2.439377708095405e-01; -3.018281994230901e-02   -1.523483477025351e-01   +2.885599169308997e-01   -1.571482332989547e-02   +4.091766264618401e-02   -1.162030998620214e-01   -2.772817244938255e-01   -9.014466075461669e-02   +1.829693064844033e-01   +1.132005611752520e-01   -7.426829948665381e-02   +1.688643795611112e-01; -1.465592299557503e-01   -6.249990543001471e-02   -4.004601997205755e-02   -4.598866043022127e-01   +6.070780878534017e-02   -5.348083000906956e-02   +1.516088381608581e-01   -1.031696433768796e-01   -4.303051348770137e-01   -1.907660369841488e-01   +1.037200569730101e-01   +2.484892515960905e-01];
L3I_L2I_iGABA_netcon = [+1.617993009642789e-01   +2.574744824525743e-01   +1.260501825169022e-01   +8.748203332575480e-02   -3.133750672944640e-01   -1.440593905950566e-02   +7.978099978850371e-02   -1.947161127729988e-01   -2.803936069181316e-02   +5.418066332563928e-02   -3.977320982712356e-01   -8.343406561041762e-02; -2.627268012543890e-01   -1.316083534655039e-01   -1.364172327064437e-01   -1.818165666386004e-01   -2.348095209542176e-01   -6.197882174835875e-02   +2.509709024971781e-01   -8.663128947500640e-02   -2.052408991611489e-01   -2.200397237517884e-02   -1.929567439616762e-01   -7.217025670192759e-02; -1.018444294879066e-01   -1.266414207974672e-01   -2.008903997782192e-01   +1.318011946153753e-02   -6.309697635535530e-02   -3.054745037564987e-01   -4.592934373798930e-01   -2.260978488023918e-01   +4.581364213282607e-02   +9.132590191482316e-02   -9.455425385142556e-02   -2.922762977099529e-01; +1.524666231302909e-01   -6.093346945383646e-03   -1.684521931023865e-01   +4.234622514510083e-01   -1.500054391229184e-01   -2.546631898432482e-01   -9.284289046191699e-02   -1.285789488065635e-02   -2.893257088482085e-01   -3.257662222795192e-01   -2.747833271127615e-01   -8.881825623701135e-02; -2.222457104398229e-01   +3.861325416318818e-01   +3.547522604250332e-02   +1.408099654292567e-01   -2.830122867816207e-01   -6.215441271233470e-02   +8.674292447259001e-03   -2.880711446276676e-01   -1.862494710004047e-01   +2.826719957709624e-01   -1.233319487113992e-01   -4.855611220075453e-03; -2.459449934892297e-01   +3.941080310975728e-01   -7.506398217689464e-02   +4.605839511481885e-02   -6.057392685044691e-02   +2.096464809069375e-01   +2.646020662009164e-01   +3.502875806961363e-01   -1.862251487952468e-01   -2.033155131098075e-01   -5.034087211939346e-02   -1.908028684612754e-01; +1.196783891628906e-01   +7.361360513632885e-02   +2.391114184970969e-02   -2.713291845782611e-01   +8.630707524988263e-02   -5.944233061978087e-02   +1.135283832847027e-01   +5.451293331414384e-02   -1.677160001787239e-01   -4.373610517131005e-03   +2.115373533057583e-01   -5.205394227610670e-02; -3.006597282215548e-01   +1.904566345538966e-01   +3.508027784579838e-02   -1.425330517323615e-01   -2.875562447041675e-01   -1.271048364317176e-01   -2.873171353415637e-01   -2.826694069802021e-01   -2.366092044378432e-02   +3.787590710419960e-01   -2.217359300388221e-01   -2.972982429244925e-01];
L2E_L3E_iAMPA_netcon = [-3.536492387991751e-01   -8.086739806267469e-02   -1.225125862265897e-01   +4.737443593321875e-01   -1.873181754471609e-01   -8.197645445649152e-02   -8.594590588886393e-02   +9.948265048721942e-02; +3.792763538350209e-02   -2.966097251568632e-01   +4.789992622506661e-02   +3.278364371294377e-01   +7.819267793618942e-02   +2.672831185012677e-02   -2.993233839021900e-01   -2.813125535406570e-01; +1.811879492700228e-01   +2.279566859638449e-02   -3.049308195946196e-01   +1.036227771836857e-01   +4.462794885229304e-02   -1.163846734860302e-01   -2.299919630882904e-01   +1.969688819388592e-02; +3.523229950604990e-01   +1.459469814787496e-01   -1.015864330556671e-01   -1.999715967882291e-01   -1.425482967636391e-01   +1.022031642738711e-01   +9.959035339134486e-03   -1.621344145282525e-02; +6.679349573833941e-02   -1.193358828750868e-01   -1.616824177164903e-01   +1.082326891696141e-01   +2.485357753085626e-01   -3.457854775816676e-01   +2.191524064446327e-01   -1.525347304710447e-01; -1.667380024930113e-02   -2.318789804776959e-02   +3.694621196099646e-03   +6.948060566391941e-02   -1.528632913231252e-02   +9.682894260986394e-02   -1.870618107260447e-01   +5.796855649585932e-02; +1.204100656166527e-01   -3.130896317449203e-01   +5.839279072011715e-02   -2.503043993939552e-01   +2.917261030323173e-02   +2.486701042021225e-01   +9.036968043314389e-02   -7.633470186098022e-02; -2.939088221255075e-01   +9.040173585138468e-02   +2.405432045251292e-01   +1.260650730031987e-01   -3.768059860959703e-01   +1.463343217892524e-01   -3.250449383030298e-01   -1.056721222302172e-01; -1.028903390030499e-01   -4.051168606355182e-03   +3.263916972292509e-01   -4.217210152009604e-02   +2.265598746137330e-02   -2.466736325375098e-01   -3.150937631332871e-01   +1.904698659277845e-01; +5.196001650241535e-01   +8.968565292352726e-02   +2.221167317336120e-01   -9.717275418720553e-02   -1.135028379985081e-01   +4.341253523666294e-02   +2.035057672673110e-01   -4.843469295729991e-02; -2.757436048335791e-01   +2.717561226813070e-01   +2.940192965355454e-02   -1.189852093795557e-01   +6.746008491688031e-02   -5.820987036748406e-02   -3.093119759832598e-01   +3.835141440668952e-01; -1.144428084391564e-01   -4.345574282980071e-01   +6.457195052064106e-02   -2.206134333888713e-01   +3.603372202764425e-02   -3.349185049675897e-02   -4.541836880103163e-01   +1.124300379406037e-01];
L2I_L3I_iGABA_netcon = [+5.593343931846770e-02   -7.431891925688973e-02   -7.453918592837841e-02   +1.501319472249687e-01   +2.412342550366151e-01   +1.936294972340654e-01   +6.627554354870280e-02   -1.060292748462788e-01; -1.071029842745020e-01   -4.792374197804903e-04   +1.620314719370154e-01   +2.419916901949283e-01   -1.390322738134737e-01   -7.513326578210250e-02   +8.348386686947359e-03   -1.532295075976992e-01; -2.086159830668246e-01   +3.709609786300971e-03   -1.198875496284004e-01   -1.349589352656016e-01   -1.666294698441567e-01   -7.239285823413164e-02   -1.174804149741883e-01   -1.172699874726985e-01; -2.214721764771187e-02   -1.716673286224217e-01   -3.759871262607707e-02   +1.346228932619926e-01   +2.572051871617226e-01   +3.322471457719337e-01   +4.537062561956204e-01   -3.687761031490253e-02; -1.704711543717750e-01   +2.850923132546622e-01   +2.024085354476368e-01   +2.865819276611937e-01   +3.270649025468441e-01   +9.037932532787873e-02   +2.973537914826624e-01   +1.845074210669398e-01; +3.573081188567458e-01   +1.534610681970764e-02   +3.198155103103482e-01   -3.124294739901137e-01   -3.495958799421428e-01   +4.385756927375217e-02   +4.213869497195810e-02   +2.674361101467366e-01; -1.497891685010515e-02   +9.973219916044972e-02   +3.430152792764065e-01   -3.125282633881263e-01   -4.441577938094693e-01   -1.431692303750063e-01   -1.077320048185185e-01   -2.327555331638136e-01; -3.274760178517611e-02   -1.729307487805778e-01   +1.363590215742986e-01   -2.203552712895598e-01   +2.360372498049018e-01   -2.802701685292291e-01   +2.283202642655807e-01   -3.604898236439726e-02; -8.865291496463684e-02   +2.961852154665660e-01   -1.294177774067151e-01   -1.510334540274255e-01   -7.157554097850155e-02   +1.516038651567004e-01   +1.312832734274935e-02   -2.525290180336143e-01; +6.195349137673089e-02   +4.342989676350570e-02   +4.444203416043280e-02   +2.885993727913125e-01   -2.161815424689086e-01   -4.937038834591363e-02   -1.062773406683643e-01   -2.627997324795026e-01; +1.947212684873493e-01   -5.425731037708024e-01   -1.429975015617296e-01   +6.741348111689674e-02   +1.412992265433332e-01   -2.990038145060899e-01   -9.720558278611519e-02   +1.872097239270999e-01; -1.244794029795046e-01   +2.742345514164197e-01   +1.198000450123601e-01   -8.266011151112057e-02   -4.372191418157674e-02   -1.862391280129664e-01   +1.239022086584087e-01   -1.549006088426945e-01];
L3I_L3E_iAMPA_netcon = [-2.296215001321862e-01   -9.738595596502800e-02   +1.804836457851270e-01   -2.574558348479317e-01   -4.283143901538400e-02   -3.967022660309988e-02   -1.304395550269620e-02   -5.960803223873104e-02   -1.738983013245355e-01   +3.624976876505426e-03   -2.707279536309271e-01   +6.606721519785289e-02; +1.832185286298713e-01   +1.067082928265710e-01   -1.725097427064906e-01   +2.054234154603195e-01   -6.122697793322461e-02   -3.030994935400119e-01   +1.025145630666294e-01   -5.542457339116180e-03   -5.111819834715328e-03   +9.748213825147037e-02   -2.888241710919388e-01   -8.313587288925864e-02; -3.640738102529739e-01   +4.039454117395221e-01   +1.388904778830706e-01   -1.357175879974346e-01   -5.984653209301675e-02   +1.056601686356368e-01   -1.304808717389436e-01   +3.774454193336510e-02   -1.399031684609236e-01   -2.077601988793162e-01   -1.911956472089973e-01   +1.557866211782599e-01; -1.768790880638918e-02   +1.686599190604837e-01   -1.628593365330344e-01   +2.839191037610458e-01   +1.554664674491009e-01   -6.843869140832096e-02   +1.331647416299650e-01   +3.432975677110471e-02   -1.999759333976568e-01   -2.341430972475125e-01   -3.255240343673238e-01   +2.439526569521696e-02; -1.561260521527063e-01   -2.817460398725177e-01   +9.004051785295636e-02   +3.825784896747940e-02   +9.969393947764552e-02   -3.869644967918106e-02   -1.041204266351510e-01   +4.040174494441914e-02   +2.785069734801572e-01   +7.208466059541405e-02   -1.203954063071761e-01   -3.235248355077039e-01; -4.280207653264943e-02   +7.800849033418017e-03   +4.449025334494849e-02   -2.386540357446080e-01   +2.205000834954002e-01   -2.904334975751419e-01   -2.132635991489203e-01   +2.184907772518883e-01   -1.327838291116268e-01   +1.691452111189833e-01   +1.560091587136317e-01   +7.095939952005004e-02; -6.949229367321708e-02   +2.677497048838996e-01   -3.032657929860677e-01   +3.628254009773180e-01   -2.515659448011595e-01   -1.427002486580078e-01   -1.608132535896018e-01   -3.815205241410712e-02   +3.231113077778180e-03   -8.761694768054687e-02   -2.453724316409418e-02   +6.428934573077486e-02; -1.094403133988059e-01   -3.177301080594251e-01   -2.140607297344110e-02   +1.109329639629379e-01   -1.407450737009489e-01   +2.287207861957345e-01   +3.982804583433778e-02   +4.003125767303324e-01   -4.441328097684032e-02   -7.618734979207717e-02   +1.523735679243444e-01   -4.747128969623460e-02; +2.321865618745859e-01   +2.165609283639411e-01   +1.491920037691251e-01   -7.646955675813426e-02   +4.343881085760172e-01   -2.109266920510844e-01   +8.839510001187754e-02   -1.546853658005705e-01   +7.769757689711027e-02   -1.890970739047562e-01   -4.226130848184411e-01   -1.783624460967247e-01; +6.545959261300395e-02   -8.550164632562261e-02   -1.425882176989445e-01   -1.916090171962455e-01   -1.650676583498228e-01   -2.474588404042145e-01   -2.443144747950056e-01   +3.584941110314988e-02   +9.443564527945875e-02   -1.847083873490181e-01   -1.928391353946565e-01   +1.208324156795540e-02; +2.681876537723714e-01   -1.043937074224568e-02   -4.600448446102500e-02   -3.941667912821517e-01   -7.639029204765041e-02   -1.872715050093527e-01   -2.852045017339849e-03   +5.024559321102136e-03   -1.861086120476533e-01   +1.373896124149519e-01   -5.519451693222160e-02   +1.054874948778174e-01; -1.469296836689695e-01   -1.089325750538136e-01   +2.216412557966826e-01   -2.498656468270689e-01   -4.101588254589419e-02   +1.092957187070806e-01   -3.642833189666107e-01   -1.545996219582335e-01   +2.221363676090314e-01   +2.255101600250980e-02   -2.652739352785586e-01   -1.030171887947267e-01];
L3E_L3I_iGABA_netcon = [+3.689901412037471e-01   -3.412889602723315e-02   +3.016313536575772e-01   +1.852780820298973e-01   +1.616379784818028e-01   -1.857535768058288e-01   +1.949874960215758e-01   +6.600832354212531e-02   -6.777208189472361e-03   -1.096605033088518e-01   +2.315082748774341e-01   +3.926392422955774e-01; -2.158070587539253e-01   +1.337604171737457e-01   +1.646927561468477e-01   -2.817591207734310e-03   -2.163154188201434e-01   +1.361271195789048e-01   +7.620199319050186e-02   -3.367606728717899e-02   +1.069106955080840e-01   +1.383164311308383e-01   -9.810632908726624e-02   -1.349387011549927e-01; -8.769046045764349e-02   +8.590698673199960e-02   -1.153250825632385e-01   +6.270839537643527e-03   +3.026216977497072e-01   -1.217301850063400e-01   +1.193761868520157e-01   -1.021802647869880e-01   -1.848084019565580e-01   +2.018319306944421e-01   +2.760307901259345e-01   -3.325949104683987e-01; -4.178013210904409e-02   +1.303638454556090e-01   +2.868320133793391e-01   +7.362490459334914e-02   +3.450216419639719e-02   +4.795578130218672e-02   +1.002138694690818e-01   -5.974082754885994e-02   -2.798469329910739e-01   +7.342284149243709e-02   -1.166820850464746e-01   -7.185795613447404e-02; -2.531076822483152e-01   -2.439018904948473e-01   +1.830526184585614e-01   -2.259681027004329e-02   +6.356366908500323e-02   -3.156372816841895e-01   -4.461407266804787e-02   +4.038649522390638e-01   +1.319335224258028e-01   -3.879061001842525e-02   +1.326273899758193e-01   -7.510861584398817e-02; -2.899718478271884e-02   -1.346315366104308e-01   +3.207612471654988e-01   +1.326441993315627e-01   -3.774576069819278e-02   -2.820223738070020e-02   -2.366968432406896e-01   -1.880466525375780e-01   +2.686162236722618e-01   +1.033123900431748e-01   -1.772432785167083e-01   +3.837620004817776e-01; +1.447317373668641e-01   +1.383570847080531e-01   -1.277439998223001e-01   +1.773134584479197e-01   +1.568835430774855e-01   +1.592976857990403e-01   -2.455919604445100e-01   +8.010356654635677e-02   +2.285440619925994e-01   +2.300204375029255e-02   -7.322403181007583e-02   +2.300739470945277e-01; -2.139901115450135e-01   -2.826966210015838e-01   +6.875310108526607e-03   +6.545023336684952e-02   +4.466368094424883e-03   -2.869214135186458e-01   +1.483838826849204e-02   +1.681870089950878e-01   -1.234310024548221e-01   +1.286162002542860e-01   -9.419592856806683e-02   +3.048067855507464e-01; -2.144560756652791e-01   -1.000800626178774e-01   -7.823815765749330e-02   +2.888666030923008e-01   +1.714942905719902e-02   -2.334579314704583e-01   -8.070887196580476e-02   +9.676004437342278e-02   +1.869682317145195e-01   +4.253332570496681e-01   +4.755929210928675e-02   -2.513624496654892e-01; +1.755254428758640e-01   -2.508656527239310e-01   +1.676604519568355e-02   -1.095104639436868e-01   -1.129055353946083e-01   +5.930923624257911e-02   -8.125276037230318e-02   -1.855051475069182e-01   +1.214086283191981e-01   +2.907289682964803e-01   +2.959195456332671e-01   +2.304167551590348e-01; -5.812513004864101e-02   +1.760076417143282e-01   -5.539784297923989e-02   +1.237821855352869e-01   +4.180934994333831e-01   +2.735701313060734e-02   +3.403729089113314e-01   +2.665467078332718e-01   -6.289996490910532e-02   -2.716497017544602e-01   -1.906919044650116e-01   +5.703776354038348e-03; -6.966998456286518e-03   -3.324452201867882e-01   -1.154101510198079e-01   -1.455370653067856e-01   -2.929521637508766e-01   +1.644783330852867e-01   +4.417630915494783e-02   -6.020340447090711e-02   -2.247503912969819e-01   -2.236519861366550e-01   -1.425947079401294e-01   +2.324375671607067e-02];
L2E_Input1_iAMPA_netcon = [-4.241724134669139e-01   +5.014352666765421e-02   -3.259350212597317e-01   -3.759656604762435e-01   +4.624841069364902e-02   -2.556674131800529e-01   -1.988311172916604e-01   +3.549293468841067e-01];
L2I_Input2_iAMPA_netcon = [-2.333195946542050e-01   -3.082972670574611e-01   -1.807223169700373e-01   -5.782846559019382e-02   +1.978766067892160e-01   -1.898929641438913e-02   +2.586459164616334e-01   -7.516144875531988e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
