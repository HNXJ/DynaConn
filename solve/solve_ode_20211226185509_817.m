function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.434112078165428e-01   +1.380717886119001e-01   -4.243502748243806e-02   +2.216435574802753e-01   +3.326022800539215e-01   +2.471248965501160e-01   +2.741227257850796e-01   +6.106849425954033e-03   +2.603263608565966e-02   +1.331624729617529e-02   +3.259952438972886e-01   +1.019220279938594e-01   +3.379041446840362e-01   +3.416680809253851e-01   +1.718717583576868e-01   +2.144450385457405e-01; +2.748613542079101e-01   +1.863988570304667e-01   +1.507305380761753e-01   +2.934953754226745e-01   +1.707126087253811e-01   +1.970077517150484e-01   +2.965874230539256e-01   +1.054043462502245e-01   +3.434541108631763e-04   -7.130590633967548e-03   +5.703590381630953e-02   +1.386051006917356e-01   -1.065162462995709e-01   +3.513100297035574e-01   +6.883488070228874e-02   +3.023993337250734e-01; +2.283406579411676e-01   +5.245166507034990e-02   +3.602533138668956e-01   +1.882854783475226e-01   +2.360723863854506e-01   +1.152645065024060e-01   +3.968665209817520e-01   +7.646038247103666e-02   +1.396822443749914e-01   -1.310616935478284e-02   +1.487381264542955e-01   +4.152753635887813e-01   +1.587940035454253e-01   +7.068209944797388e-02   +2.598669586550461e-01   +6.490725138448838e-02; +2.028691552237269e-01   +2.161858886196082e-01   +6.607201735289865e-02   +1.616730611704125e-01   +4.535013477256940e-02   +2.729822598286774e-01   +2.164583705584493e-01   +2.511442543959242e-01   +3.283878095825046e-01   +7.892368289871936e-02   +1.783950897339699e-01   +1.567741194197732e-01   +3.422122357412879e-01   +2.737822896173309e-01   +3.465322442081809e-02   +1.737197347845328e-01; +6.197982624070779e-02   +2.224700178000547e-01   +1.151903897061964e-01   +2.210372542417239e-02   +1.441833237810149e-02   +1.679051919003913e-01   +6.158322283334734e-02   +3.506722242914331e-02   +2.574341505932828e-01   +1.441503014182283e-01   +6.960874902596491e-03   +3.114548766650438e-01   +2.361230360402213e-01   +3.602369095922215e-01   +1.976308771717638e-01   +3.478307115673503e-01; -1.113550366918139e-02   +4.166880803464806e-02   +1.462513286109929e-01   -3.631413670256885e-02   +3.384233341191107e-01   +3.671631608825587e-01   +2.411991656616648e-01   +1.993358970744832e-01   +1.699840322206921e-01   +1.091119775242280e-01   +7.567126795232701e-02   +1.488552429940171e-01   +8.815499657147248e-02   +1.625068618565595e-01   +9.667333603742859e-02   +4.303811240378150e-01; +3.140494914508326e-01   +1.454457260798192e-01   +2.887427864767962e-01   +2.937543460752311e-01   +2.236600141767276e-01   +3.111652820280216e-01   +1.544001945609186e-01   +9.363397400861551e-02   +2.059589723805411e-01   +3.243547224096147e-01   +6.555063510519742e-02   +2.479371584830247e-02   +1.724157502638277e-01   +1.308957872040485e-01   +2.557468064343946e-01   +1.995517962801306e-02; +1.673617638460162e-03   +3.230944338200050e-01   +1.923845631990044e-01   +1.572919165014944e-01   +2.055256551319911e-01   +3.663195038468441e-01   +2.936472832727712e-01   +2.418758081919160e-01   +3.122704868092272e-01   +1.056635382223832e-01   +8.532296744778206e-02   +1.408988886650653e-01   +2.769214020889082e-01   +1.488623122821681e-01   +1.141994558858253e-01   +5.846867986205714e-02; +4.286561942716104e-01   +3.371419420553023e-01   +1.986824334505953e-01   +4.183516483232271e-01   +1.259037270133399e-01   +6.702901987213722e-02   -1.023789856148045e-01   +1.341143043197088e-01   +2.823686606337241e-01   +8.192892364823888e-02   +1.193315572442876e-01   +2.539677595226284e-01   +2.286890096490232e-02   +3.733272291278130e-01   +9.029447097520561e-02   +1.578040019184326e-01; -3.930012557631430e-02   +1.900828244353961e-02   +3.637451044228905e-01   -7.189875674091237e-02   +3.413031767136245e-01   +2.713347644528226e-01   -5.974571989723140e-03   +1.074410079700855e-01   +4.741322196452528e-02   +2.490496832270522e-01   +2.622698796864776e-01   +1.829997976228078e-01   +8.892961748098969e-02   +1.848545747266508e-01   +3.926785580929373e-02   +2.621287622369307e-01; +9.594046990237379e-02   +2.459039358243540e-02   +1.016874656578897e-01   +2.206634292304725e-01   +2.389738758031554e-01   +3.079158004036569e-02   +2.136995343534092e-01   +2.208033591610372e-01   +1.614222424989832e-02   +2.604939969689724e-01   +1.404158388727999e-01   +3.100870424051489e-01   +1.710752933574552e-01   +9.682619104050531e-02   +9.438482445427759e-02   +8.303378992608867e-02; +2.155526977346264e-01   +2.182462291405119e-01   +2.425677874725586e-01   +1.777671820379176e-03   +2.561469457369200e-01   +1.504654941333152e-01   +2.124913067452738e-01   -4.594925322438688e-03   +3.067883593394420e-01   +8.653767857147730e-02   +2.295299453584862e-01   +2.421014380557713e-01   +2.420581442872590e-02   -4.295649620982456e-02   +2.093104887002388e-01   +2.080169900545883e-01; +4.044239696810387e-01   +3.452000596053070e-01   +1.978475009871702e-01   +1.649205915893515e-01   -5.843859723977544e-02   +2.631278020529070e-02   +8.467770749358669e-02   +2.269826657453534e-01   +1.609938051907751e-01   +9.296780688421831e-03   +1.372558877523851e-01   -7.815698568623939e-03   -7.165590090615075e-03   +1.727114047870812e-01   +3.288884385161733e-01   +1.735244447638814e-01; +2.370210355032628e-01   +1.533866679875878e-01   +2.047873014328445e-01   +3.007831085882354e-01   +9.866742601682685e-02   +6.980513157504753e-02   +3.515623081968263e-01   +3.411071865784955e-01   +1.166834847979927e-01   +5.513553458363737e-02   +2.755549450129530e-01   -7.983678520583946e-02   +1.968376697957634e-01   +2.392101435498170e-02   +2.001967834195545e-01   +3.552188265425172e-01; +1.147204950784575e-01   +2.044702080198319e-01   +1.556563528092972e-01   +2.149539357047060e-01   +1.534378926814415e-01   +9.147514297857538e-02   +1.869273978688526e-01   +2.348997460256392e-01   +1.148609130079730e-01   +1.616982045246648e-01   +5.700430905418667e-02   +1.332453801206716e-01   +2.003269268753316e-01   +2.639424013850682e-01   +2.006469611782091e-01   +1.104955399722834e-01; +2.366977307689996e-01   +1.154405185225165e-01   +1.002161022504653e-01   +3.846744820408329e-01   +3.933245542573979e-01   +1.680083908040574e-01   +1.082975326820229e-01   +1.063111109321339e-01   +1.132450898127000e-01   -9.980194096658535e-02   +5.293529635073271e-02   +2.128885380611325e-01   +3.767303040394762e-01   +1.614608155121800e-01   +2.226678728001640e-01   +1.542859506558149e-01];
L1E_L1I_iGABA_netcon = [+9.715775057056002e-02   +6.370409976739533e-02   +1.627097068243999e-01   +1.572768343633210e-01   +2.512977886906591e-01   +9.915362790796542e-02   +1.757417126730044e-01   +2.598717750635294e-01   -4.091766185997090e-03   +2.758883673552553e-01   +1.939378026699884e-02   +9.648347912558003e-02   +2.906831185528566e-01   +1.355896197312950e-01   +7.947125473008788e-02   +2.693159636800988e-01; +1.582216623356691e-01   -2.298831555383147e-03   +1.567097887043805e-02   +2.186927098428585e-01   -9.807434264815215e-03   +7.713485625468067e-02   +4.915733897750996e-02   +1.206902142625565e-01   +2.523534241526904e-01   +2.655677967535757e-01   +1.612405710850521e-01   +9.303617628416636e-02   +1.124796066844706e-01   +2.703252633384681e-01   +2.378379521803198e-01   +2.092687743735779e-01; +1.787186424187509e-01   +3.770932708491623e-01   +1.509452921225530e-01   +2.560450818202869e-01   +3.039317040238965e-01   +1.464430757628608e-01   +5.299163317684393e-02   +4.250662794835725e-02   +1.604862845198081e-01   +1.772393141203371e-01   +1.596422536147149e-01   +1.880385241191457e-01   +2.220293733675032e-01   +1.166593896263962e-01   -4.493201542535396e-03   +5.031128074064684e-02; +1.530431137963447e-01   +2.204262816161908e-01   +4.203008370020100e-02   +4.591384861618875e-02   +2.268631830118835e-01   +9.602430549639814e-02   +2.883769396144799e-01   +2.974488329954355e-01   +1.875295184463917e-01   -7.334129834794642e-03   -2.776824609563456e-02   -4.071393246548436e-03   +5.141699140972653e-02   +3.102521229794665e-01   +1.363261004403224e-01   +1.998821748496083e-01; +3.519550955909256e-01   +6.532874331067876e-03   +1.600809631799108e-01   +1.150426369336842e-01   +3.389567779765819e-01   +1.713437197861161e-01   -8.222622531288132e-02   +1.171504957908616e-01   +1.027511789212628e-01   +1.499143637632900e-01   -5.630269586788206e-02   +8.809216311269753e-02   +2.664810996757687e-01   +8.060151946170596e-02   +6.337595698230876e-02   +5.768903167892962e-02; +5.517990789162866e-02   +2.914777938451120e-01   +7.421152392449271e-02   +6.227165283967603e-02   +9.448515224817022e-02   +2.335212931716434e-01   +1.580869808056599e-01   +2.932116028786301e-01   +2.219696690824226e-01   +1.834144150431394e-01   +2.840472324188704e-01   +3.493366018176328e-01   +6.677338326888417e-02   +1.693496035787294e-01   +8.874548201306726e-02   +2.569235232989820e-01; +1.167537519521033e-01   +7.733146526675874e-02   +1.728175371489380e-01   +3.743848886921129e-01   +3.536257725325048e-01   +1.367225845200271e-01   +1.717064227481880e-01   +3.161199621013341e-01   +1.579375879676603e-01   +1.774784980786208e-01   +1.713696138961619e-01   +3.655621028859030e-02   +2.171683906421658e-01   +9.176991411493299e-02   +1.404115863625131e-01   +8.654573791097228e-02; -2.562185342416508e-02   +1.488420000818235e-01   +2.950753876927806e-02   +5.398265277173335e-02   +8.625929050520370e-02   +2.145285069598635e-01   +3.132558174804226e-01   +1.326724720749884e-01   +5.381770545427225e-02   +5.268381285390152e-02   -2.341247058699964e-02   +9.641404260951145e-02   +2.076309347459739e-01   -1.204436066426150e-02   +3.844779780137393e-02   +1.137373235321894e-01; +2.184302015411725e-01   +3.428731892322595e-01   +1.790808631408984e-01   +2.782585077334401e-01   +4.195463959435951e-02   +2.615594751092216e-01   +2.719219945411120e-01   +1.833786744792884e-01   +1.313706114038376e-01   +1.727302564373868e-01   +2.745266055018438e-01   +1.425265920232269e-01   +1.230343060851085e-01   +4.335556974827318e-02   +1.885952758383925e-01   +3.146680567832461e-01; +6.976661414459345e-02   -6.696415156072050e-02   +2.151670794301537e-01   +1.058118112630045e-01   +6.521796427884968e-02   +8.232519920437291e-02   +1.618148657442839e-01   +2.493459953563694e-01   +6.649760355326773e-02   +3.276035477832034e-01   +1.452195662677148e-01   +3.727364948243217e-02   +1.659269785261452e-01   +1.336629770059404e-01   +9.066165942458179e-02   +1.405176223834380e-01; +2.054530934210342e-01   +2.257642652624058e-01   -7.756043127300993e-02   +2.898042943546584e-01   +1.388891054977497e-01   +3.618265505349575e-01   +8.301263649165111e-02   +4.365164318633288e-01   +1.706244891599965e-01   +3.624309831538147e-01   +2.873497365002500e-01   +3.267336586504165e-01   +3.122866106208707e-01   +7.524505041321354e-02   +3.141928219763223e-01   +2.132942833543764e-01; -2.264728079303838e-03   +3.799612509165124e-01   +2.262194970803771e-01   -3.214330550106121e-02   -2.226563993658917e-02   +1.434881140189018e-01   +2.993676521932108e-01   +3.165541569550026e-01   +1.816637985051889e-01   +6.739527809395743e-02   -8.766512217643631e-02   +1.530746113399732e-01   +2.267470105713697e-01   +2.274340587834663e-01   +1.380743770613611e-01   +1.145827438568691e-01; +1.305298058121250e-01   +3.501758286004312e-01   +1.881549183842429e-01   -2.222250930805098e-02   +8.594653433266607e-03   +1.661470477726750e-01   +1.841618570098643e-01   +2.384165733022354e-01   +6.411310692994301e-02   +1.091576861828148e-01   +9.820763984850418e-02   +2.833673267019311e-01   +2.050368762560696e-01   +2.463843859255193e-01   +4.630736561175269e-02   +1.255827997895568e-01; +2.919272257031497e-01   +1.076894430290772e-01   +1.412699103797413e-01   +1.403935954169441e-01   +7.916939737206893e-02   +1.419804535541300e-01   +3.888790019627455e-01   -4.843390528990182e-02   +2.554108154180021e-01   +3.090774041604028e-01   +2.220648338448896e-01   +2.934843520874162e-01   -6.296095896310078e-02   +1.790592005638667e-01   +2.450846496526793e-01   +2.424760394963307e-01; +1.346888408109655e-01   +5.417658152864103e-02   +3.130337124461366e-02   +7.402326358439007e-02   +1.898486129565180e-01   +9.458892385300867e-02   -1.518434284135106e-03   +7.097384402391074e-02   +6.427320568181311e-02   +2.223590257715214e-01   +1.485849008910479e-01   +6.493107119068309e-03   +1.957474196570499e-01   +2.841630754895996e-01   -2.972601608373080e-02   +2.800867657967798e-01; +2.146638858983842e-01   +9.339977457912924e-02   +1.093798407667375e-01   +2.983905237588169e-02   +1.954710185912961e-01   +4.003656545535933e-01   +9.685471756966105e-02   +3.683564412029881e-02   +1.344998485975598e-01   +2.785274111574486e-01   -3.799831900090912e-03   +9.000138147695230e-02   +3.431468646315590e-02   +2.688056724744711e-01   +2.786127209853996e-01   +1.054840377232212e-01];
L2I_L1I_iGABA_netcon = [+2.351548282180848e-01   +1.272358053505487e-01   +1.314995814705961e-01   +1.845454426294082e-01   +5.957754381114821e-02   +2.305193731746940e-01   +4.281066271848399e-02   +3.266442574791431e-01; +2.163998980727682e-01   +1.845784829721156e-01   +1.484891682128042e-01   +3.667802860061440e-03   +3.148195331745159e-01   +3.010964020721514e-01   +2.260872275176736e-01   +2.006616272568729e-01; +1.691888383598066e-01   +2.309684762233107e-01   +1.086267778254143e-01   +1.555948449817831e-01   +2.092806577686888e-01   -1.611483205458113e-02   +2.456254077807554e-01   +2.055131253300571e-01; +4.757111312279223e-02   +1.832221773021550e-01   +7.699433020024715e-02   +9.676837043668857e-02   +8.502588708765643e-02   +2.270681062051288e-01   +3.777825573092328e-01   +3.853790550674488e-01; +2.771807326891932e-02   -1.196820818680301e-02   +2.361228695221860e-01   -1.626569697598800e-01   +1.041519552327545e-01   +2.206005641732165e-01   +2.826992353836031e-01   +2.583535420703448e-01; +1.121613694473662e-01   +1.655830692778643e-01   +3.759139596520230e-01   +2.679674316739059e-01   +1.514573037903766e-01   +2.650680863187988e-01   +8.406430251844976e-02   +1.458876470001346e-01; +4.009092145256619e-01   +1.235239106810371e-01   -3.082269939629609e-03   +1.254620104987335e-01   -1.333931223039734e-02   +4.012898609779115e-01   +1.004277124135486e-01   +3.600821872826666e-01; +8.578266165797740e-02   +2.750495397914074e-01   -4.198426175566075e-03   +3.103964184165170e-01   +1.960523445476401e-01   +2.103115255608166e-01   +2.389449684926077e-01   +1.104701801028090e-01; -8.950668969265808e-03   +1.279731215017385e-01   +2.776317239419670e-01   +2.645252803046242e-01   +2.812880762431077e-01   +1.335173102836445e-01   -6.229186755555154e-02   +2.850338244695993e-01; +1.890042281830204e-01   +1.589392916139645e-01   +1.041629223603035e-01   +1.236987557259684e-01   +3.456341740781384e-01   +2.583181087121123e-01   +6.028571990342434e-02   +2.591305290363561e-01; -4.532037244292129e-02   +1.009160274209030e-01   +2.952853358456069e-01   -1.307413026348231e-02   +2.757984669353124e-01   +1.117638393312318e-01   +3.266213644630974e-01   +3.126687922229682e-02; +9.358825530514606e-02   +1.739513740525805e-01   +1.986743666136360e-01   +9.643323699473824e-02   +2.051014212354922e-01   +5.635882006453014e-02   +2.528427861075826e-01   +3.370172143860015e-01; +2.039467588918818e-01   +9.602128922504995e-02   +1.454255634053369e-01   +2.138218386644215e-01   +1.348403262983861e-01   +2.931325318154446e-01   +1.281085590417611e-01   +2.590458294116171e-02; +1.510039732857474e-01   +2.976517949107024e-01   +1.381557280777616e-01   +1.297543105154532e-01   +8.896598424902388e-02   +2.123461992012985e-01   +2.896999828491813e-01   +1.817161559711702e-01; -6.282085827257022e-02   +1.779360118747535e-01   +1.554866148699344e-01   +1.240568539340092e-01   +2.099771228278983e-01   +1.418887353585412e-01   +3.310692011241008e-01   +3.435739512986231e-01; +3.379205543945760e-01   -1.817681007675183e-02   +1.724185453690081e-01   +3.234634243198129e-01   +3.307354171558538e-01   +2.394241731656866e-01   +1.662550578843964e-01   +3.697162230074749e-01];
L1I_L2I_iGABA_netcon = [+3.647205523276412e-01   +2.600208542972549e-01   +5.807681179871373e-03   +1.478840850749186e-01   +2.883343222694637e-01   +7.142660240319929e-02   +2.536050115214735e-01   +1.213354325452421e-01   -3.814498560318224e-03   +3.249632422878664e-01   +2.849678351430443e-01   +1.239427164472659e-01   -3.873413531526033e-02   +1.409138127590434e-01   +2.488073664646150e-01   -1.212813444349820e-01; +3.313336829647446e-01   +2.403937780170262e-01   +4.970554037735610e-02   +2.658081053645582e-01   +3.912111382864678e-02   +3.520685105657735e-01   +1.082893236914513e-01   +3.618760383016193e-01   +2.951681558409719e-01   +3.146102660082263e-01   +1.510121475213420e-01   +5.518998010085281e-02   +2.145728355419640e-01   +3.730244648157155e-01   +3.509866446426789e-01   +1.037588733293938e-04; +1.276363853123626e-01   +1.411281857618607e-01   +4.377319883535824e-02   -5.362766154166838e-02   +1.945081610158075e-01   +2.183572602695047e-01   +2.398300955649148e-01   +2.892915483239396e-01   +1.376682823929853e-01   +1.492565094912458e-01   +1.787259683623656e-03   +8.664785302557070e-02   +2.778044973902323e-01   +4.075285284691118e-01   +1.471529778843420e-01   +1.619388949516140e-02; +1.719851795255740e-01   +2.410633530702031e-01   +2.862255391124097e-01   +2.526800849653548e-01   +1.573206155249163e-01   +3.890631576344746e-01   +1.988034615774316e-01   +1.979288699261993e-01   +3.088365288027920e-01   +2.591662821673703e-01   +4.240750890168407e-01   +1.955506305446873e-02   +2.251921087573482e-01   +2.383293820232464e-01   +1.066660668142667e-01   +4.223822122894654e-02; +1.997506122173712e-01   +2.872142770072309e-03   +1.782645336909256e-01   +1.876824760891107e-01   +7.073091786576444e-02   +8.815473430415033e-02   +3.306851871143821e-01   +8.811024560945595e-02   +9.812848557786145e-02   +2.458388111041065e-01   +1.902219316402756e-01   +1.159711234944032e-01   +1.226789954561622e-01   +1.245788213950507e-01   +6.641329117069489e-02   +3.598827125180730e-02; +8.929161975796684e-02   +4.968399980674659e-02   -3.137568687799255e-03   +1.268269074973524e-01   +3.710057495800910e-01   +3.164078598936045e-01   +1.485033931112937e-01   -5.098866683055994e-04   +1.952818278252053e-01   +1.242501821312779e-01   +3.035106561273729e-02   +2.709069778725284e-01   +2.239587420284772e-01   +2.062170401410343e-01   +3.081059332888940e-01   -2.562790187264618e-02; +3.266939160413752e-01   +3.764010237527826e-01   +1.254082940094206e-02   -7.986551622095811e-02   +1.327327464356250e-01   +2.155005186757354e-01   -1.998181915142547e-03   +8.109774747057805e-03   +2.640908175502431e-01   +1.214251055991101e-01   +2.828545300787996e-01   +1.787053875633953e-01   -4.451390065771159e-02   +1.639325095741027e-01   -3.428611998614726e-02   +3.586989427891039e-01; +3.576503420490159e-01   +1.600373321482887e-01   +6.899288288955771e-02   +1.588371537584015e-01   +3.096189597272984e-01   +1.774511997058034e-01   +1.428505258583765e-01   +1.825983680768584e-01   +3.441938326796581e-01   +1.942923140635595e-01   +4.070529843431141e-02   +1.431439537300238e-01   +2.659335937424579e-01   +1.965173742438835e-01   +3.092577403544931e-01   +2.599867611079522e-02];
L2E_L1E_iAMPA_netcon = [-3.214167217843336e-02   +3.103294856939214e-01   +1.906536164525393e-01   +1.549719174533501e-01   -2.335631459730380e-02   +1.932422815793657e-01   +8.990317951977479e-02   -3.810333869411504e-02; -6.291344314167305e-02   +5.924421193940605e-02   -5.805385874278831e-03   +3.739250940161447e-01   +2.860714007546930e-01   +1.734809602109507e-01   +3.247111401877725e-01   +3.860531239321807e-01; +2.966894123293632e-02   -2.126479008086851e-02   +3.729024729233624e-01   +2.333415100609141e-01   +1.287112445418950e-01   +2.196093831893212e-01   +3.147772271527657e-01   +9.882185883735556e-02; +1.493388948502879e-01   +2.730807531185702e-01   +4.890891299085720e-02   +7.433808160582922e-02   +3.780504971128130e-01   +1.579315378923571e-01   +2.389819025223704e-01   -1.688714500568748e-02; +2.830815288122696e-01   +1.338701444496681e-01   +1.963683797025261e-01   +2.709399568835176e-01   -2.166322519717846e-02   +5.902034597966281e-03   +6.526850151288741e-02   +3.486632495252656e-01; +3.203405410396283e-01   +3.212096007374035e-01   +1.137326391950688e-01   +1.122379651569572e-01   +2.451640071004347e-01   +2.312805349870700e-01   +1.833424141597704e-01   +2.854297331910219e-01; +1.079897906922538e-01   +2.030306353529407e-01   +1.042138055229558e-01   +2.525845631559412e-01   +1.366982275652656e-01   +3.056830044537875e-01   +4.001797493252303e-01   -1.369864152627038e-01; +2.310263941697607e-01   -1.149223219875669e-02   +1.887735555502152e-01   +3.390049762681481e-01   +1.996614098329066e-01   +9.438556919830163e-02   +1.263020361188029e-01   +6.250931844857496e-02; +3.981909296939921e-01   +4.831861738133450e-02   +1.919584848076238e-01   +2.356156507269667e-01   +2.113117882251891e-01   +2.312434215165044e-01   +2.471591193531599e-01   +1.622209207098461e-01; +2.993633724813828e-01   +2.043867531132455e-01   +2.129049551110053e-01   +2.650407877857238e-02   +3.280890917895970e-01   +7.156039616989152e-02   +2.323315869647427e-01   +1.640871494740804e-01; +1.368554889648631e-01   +1.784659432906251e-01   +2.445722877641448e-02   +2.827282017338523e-02   +3.952205377106693e-01   +3.264221445840870e-01   +6.821405859639507e-02   +1.538887413401561e-01; +2.177289863850707e-01   +4.975962868830926e-02   +4.431899297281679e-02   +1.644780120076080e-01   +1.035339290907346e-01   +1.830277942950276e-01   +2.939622256601411e-01   +1.337762926558383e-01; +2.896220112630462e-01   +3.943687353761255e-02   +2.070666011299417e-01   +8.877950673020595e-02   +3.024629080636866e-01   +1.001495677627036e-01   +2.471310383675919e-01   +1.798069302757979e-01; +2.657445483266958e-01   +3.897372265173774e-01   +1.576254561178441e-01   +8.611337114973243e-02   +2.092565408037706e-01   +2.677715776102341e-01   +3.058821183161125e-01   +6.022722741085131e-02; +7.688312117147916e-03   +2.977638879826587e-01   +2.306597672505366e-02   -3.753995789632935e-03   +1.126475242648518e-01   +3.053676578009739e-01   +6.489981633487164e-02   +1.218600451216617e-01; +1.264696984136741e-01   +3.176301335372785e-01   +2.122735870038910e-01   +1.721395595410101e-01   +1.982394053952741e-01   +2.022700349373195e-01   +1.585865785063042e-01   +1.280534942070702e-01];
L1E_L2E_iAMPA_netcon = [+1.509903376033191e-01   +2.612807590965608e-01   +1.796362049488848e-01   +1.060322449645511e-01   +1.309066049330954e-01   +2.553295271122473e-01   +6.464995519768496e-02   +3.660895271453131e-01   +5.578923876502788e-03   +3.248119908501000e-01   +7.257997000284758e-02   +7.991295556209949e-02   +1.196210207252886e-01   +1.284960545884764e-01   +3.060781546702093e-01   +7.578803774554949e-02; +2.920643366086401e-01   +3.905298467228335e-01   +2.470822708043520e-01   +2.969604269085656e-01   +2.164991877217612e-01   +2.708747698586577e-01   +1.925491876077325e-01   +7.001324449915949e-02   +2.035663476473704e-02   -1.791235488205433e-02   +2.325696844796342e-01   +1.609818516923382e-01   -2.403664296071331e-02   +6.677745035519708e-02   +3.335820546732641e-01   +1.588292425664208e-01; +1.615806648485434e-01   +3.983422689219671e-01   +4.501763936074514e-02   +1.849522994047448e-01   +1.202012946030749e-01   +3.169427954885201e-01   -8.479149925431660e-02   +2.333997364546451e-01   +8.849450021002900e-02   +2.688647655434300e-01   +2.538059650335487e-01   +1.241366709758412e-01   +1.197301892876169e-01   +3.053769140640734e-01   +3.597932793047223e-01   +2.404159496961471e-01; +2.840046226799300e-01   +7.553380591082778e-02   +1.974600690364402e-01   +1.070119914366319e-01   +2.550924542020450e-01   +1.283233968878418e-01   +2.941333085776013e-01   +2.279667368982120e-01   +2.363297398627154e-01   +3.859767451952031e-01   +1.817190732528296e-01   +6.885911152905405e-02   +3.810831131997585e-01   +1.600424477427258e-01   +2.942399884958337e-01   +4.457869786963736e-02; +1.047306372380397e-01   +9.854750355657796e-02   +1.713423705930120e-01   +2.961814269199317e-01   +1.255638446295980e-01   +2.215418245693642e-01   +2.029350563738676e-01   +3.986749145351428e-01   +1.462251345466692e-01   +2.022702374004484e-01   +1.472544601402170e-04   +1.878687890433254e-01   +2.263639277499504e-01   +1.191142708348176e-01   +2.509683024444999e-01   +3.932666909686575e-01; +2.708302200446755e-01   +3.447524460378726e-01   +2.750977184021126e-02   +4.261694194721874e-01   -8.265806976613334e-02   +1.165037644280354e-01   +1.567760801298567e-01   +2.447405121387499e-01   +2.819709754035825e-01   +1.975033661528313e-01   -4.426544989999769e-02   +6.529578530427416e-02   -1.148524459111100e-02   +1.524249233577304e-01   +2.486448401919201e-01   +3.971868267677384e-02; +2.400478489570560e-01   +9.159685283529166e-02   +1.377858096760766e-01   -1.285845287688512e-01   +3.651213767540227e-01   +3.245888372199484e-01   +2.478576736537795e-01   +8.326647863627498e-02   -6.926996686833183e-02   +1.852803637591698e-02   +4.569061099388558e-01   +1.045715337894395e-01   -1.183726614015268e-01   +4.393477266736526e-02   +1.310981802332501e-01   +1.967472713943888e-01; +7.717186010832097e-02   +2.314170411914616e-01   +8.897453272728910e-02   +2.258009189008546e-01   +1.126461347020754e-01   +3.097176532721200e-01   +2.331765784211055e-01   -8.757732091817363e-03   +2.558758687702276e-01   +2.580051151296731e-01   +2.173979230696455e-01   +6.325888313129069e-02   +3.868764013233451e-01   +2.346929178319353e-01   +2.887093358747836e-01   +2.602652428832910e-01];
L2I_L2E_iAMPA_netcon = [+3.433149714744094e-01   +1.680937912194789e-01   +2.257039771184327e-01   +2.274897435084273e-01   +2.901449389577382e-01   +4.054088485125835e-02   +1.096260633525890e-01   -1.956655029638827e-02; +3.889540222037450e-01   +6.369422343103595e-02   +9.953267927098186e-02   +2.461343780699407e-01   +2.912864567725698e-01   +1.466342649242436e-01   +2.640325974254062e-01   +1.482706400943653e-01; +2.777649905915303e-01   +4.679370513001953e-02   +3.633082635453753e-02   +1.600188894040089e-01   +2.864657643422296e-01   +2.281110768252151e-01   +2.185489304858445e-01   +2.588825624856513e-01; +2.225567665597807e-01   +2.463797955653113e-01   -3.378540931843987e-02   +1.661154532388419e-01   +3.253086636608301e-01   +3.555159585921178e-01   +8.129412409638456e-03   +5.282533899899494e-03; +1.661737905338195e-01   +7.387408600069983e-02   +1.225512828931935e-01   +8.873424356376559e-02   +2.238571028253601e-01   +1.861535029335644e-01   +1.333246440667566e-01   +1.606521856073087e-01; +2.021985061532671e-01   +1.898617345901075e-01   +4.016196568047879e-02   +1.533652472969414e-01   +2.877283975620616e-01   +2.386562520590661e-01   +2.394033771434338e-01   +1.063796889167963e-01; -2.291989767518244e-02   +8.027230256608371e-02   +3.043255898965923e-01   +1.653846790645858e-01   +1.872326348579141e-01   +1.537303895566079e-01   +3.391217032411883e-01   +1.259337304886052e-01; +3.143190507716487e-01   +3.958650041925046e-01   +2.956982433159440e-01   +1.436449083478639e-01   +1.130099397391655e-02   +6.484361818006401e-02   +1.111433841375875e-01   +3.109064934957791e-01];
L2E_L2I_iGABA_netcon = [+3.310765477143399e-01   +2.001633203245779e-01   +2.761900401991377e-01   +3.654337545914958e-01   +2.203871800012482e-02   +3.874702825865113e-01   +2.062349088290789e-01   +8.086957510775158e-02; +2.631444479918296e-01   +3.300600004572820e-01   +2.837160088207372e-01   +9.864307403121034e-02   +2.733643206579891e-01   +2.397970582046361e-01   +1.151021759678117e-01   -1.349812818482380e-01; +4.015869730779117e-01   +1.187885652034827e-01   +2.094528958849638e-01   +2.416983772877125e-01   +1.954878127651957e-01   +2.093884651621176e-01   +2.762832804190062e-01   +2.464209342306473e-01; -9.117357152949430e-02   +2.535181398565878e-01   +2.201843474477329e-01   +1.499614542845790e-01   +2.635969020056699e-01   +1.120825146030639e-01   +1.974140583375766e-01   +2.154399964764855e-01; +2.229344307327498e-01   +1.453111741338446e-01   +2.673414966204750e-01   +2.569725647145634e-01   +1.305526014954422e-01   +2.258377710742453e-01   +1.937651752121872e-01   +1.996393474822059e-01; -6.149274329343836e-02   +4.825389723511780e-02   +2.070847035050049e-01   +2.075965720983674e-01   +2.691645030220186e-01   +3.612863287772636e-01   +3.229750867597297e-01   +2.442273159532062e-01; +3.283138088139708e-01   -3.798113837902385e-02   +2.366302201467303e-01   +1.431603842640072e-01   +2.320850460807151e-01   -2.427051976452971e-02   +2.865996746327595e-01   +1.405529782955769e-02; -4.912327451707535e-02   -6.595701667992615e-02   +1.897915463812478e-01   +2.059375549060040e-01   +1.775636641053757e-01   +1.931197903166862e-01   +1.702901379557272e-02   +2.380793962358081e-01];
L3E_L2E_iAMPA_netcon = [+1.850263556700403e-01   +2.077080651149931e-01   +2.964409943997347e-01   +1.092079007386706e-01   +4.035357733924188e-01   +1.990932037048265e-01   +3.234527067674437e-01   +1.194408354959214e-01   +1.293006142335186e-01   -9.899414603482919e-04   +1.603322286157427e-01   +2.374153981700641e-01; +7.943751867810003e-04   +2.195797932808780e-01   +7.062379332423321e-02   +1.431366510872492e-01   +2.430311003815049e-01   +1.038402769367795e-01   +2.868794678151370e-01   -7.595600771441464e-02   +4.271582023862280e-02   +1.546884908744221e-01   +1.343595753668742e-01   +2.633926809912250e-01; -9.252535418597368e-03   -1.258670216677027e-01   +2.553963777115697e-02   +8.449566836376615e-02   -2.237536472286057e-02   -1.275314713119729e-02   +3.401019986593655e-01   +1.786628278091376e-01   +1.348977667425845e-01   +2.182474133689211e-01   +4.186398630980944e-01   +1.299278929687745e-01; +1.936662900523291e-01   +1.373727380093267e-01   +1.664807746996533e-01   +2.099827259168379e-01   +1.595525298644901e-01   +6.937486552941709e-02   +3.110001223484674e-01   +3.562902681995246e-01   +1.988089642257072e-01   +2.948550813680798e-01   +2.257653850451816e-01   +1.856043567915743e-01; +2.204223986790929e-01   +1.788784645249374e-01   +2.336396889717762e-01   +2.141204092385704e-01   +8.245642267224881e-02   +2.127679484652133e-01   -1.636884161128734e-02   +4.173494304924200e-02   +4.212220375471781e-02   +1.084657436410792e-01   +1.997850704940662e-01   +2.942901954720467e-01; +4.461562420555947e-02   +1.540603206626387e-01   +4.748530738156465e-02   +3.549853041418098e-01   +1.895970119195775e-01   +8.143780170686302e-02   +8.458620126858560e-02   +3.047492441531162e-01   +2.304891519095047e-01   +1.694705115532150e-01   +2.943266579934524e-01   +4.372809592054950e-02; +1.623597374355701e-01   +2.304027624407194e-01   +2.619689064137444e-01   -1.265884627783343e-01   +2.689764304059222e-01   +3.027986756690550e-02   +3.822105279416740e-02   +2.260570650149894e-01   +1.924837741949453e-01   +7.166683808988247e-02   +3.231933138524282e-02   +7.969086475088594e-02; +1.863441126247341e-01   +1.820829822899438e-01   +1.654116647925994e-01   +2.616894103956911e-01   +2.207057426912040e-01   +2.745654318937876e-01   +2.326892584716409e-01   +1.572277485758037e-01   +2.886741357485557e-01   +3.089587045881167e-01   +1.246618196883642e-01   +2.234973757940356e-01];
L3I_L2I_iGABA_netcon = [+1.276950384623521e-01   +1.684541521689307e-01   +3.157622451973178e-01   +8.010283535202109e-02   +2.550984575408137e-01   +1.430852089601447e-02   +1.981400194805531e-01   +1.974353246088952e-02   -8.232446565865158e-03   +7.998882379508675e-02   +4.678704583943595e-02   +2.971879716504040e-01; +1.680644166183931e-01   +1.742181320059296e-02   -1.652183088269819e-02   +4.353809012969807e-02   +1.059874926079439e-01   +2.776594449454259e-01   +1.727409943994214e-01   -3.325361401427536e-02   +2.045889570777851e-01   +2.561978916771205e-01   +9.146307387884427e-02   +2.501130520460082e-01; -4.502409755648298e-03   +1.843615330918637e-01   +1.101027018333146e-01   +3.565844119871858e-02   +2.345386383093510e-01   -1.099171978768669e-02   +2.015060430973766e-01   +2.864539856793127e-01   +5.720848868650218e-02   +7.947074965285718e-02   +2.088714885891961e-01   +3.116380866234058e-01; +2.175909720515408e-01   +1.411682090196451e-01   +3.019835905606607e-01   +2.070803063712432e-01   +1.866406056333041e-01   +3.456510874345507e-01   +5.383865514101901e-02   +2.136012475781680e-02   +1.931008194711126e-01   +4.226042189759325e-02   +2.862943353616572e-01   +3.923281847348401e-02; +1.371345517591052e-01   +2.404096026499029e-01   +6.786338304782169e-02   +3.031166220617131e-01   +2.524449360205895e-01   +1.448579561721650e-01   +1.848738653259442e-01   +4.367865006175452e-02   +3.727567906428109e-01   +7.695532189678797e-02   +1.602122691451311e-01   +9.482227481999538e-02; +2.605411800445974e-02   +8.542700163896855e-02   +3.465652396629305e-01   +1.230733914576503e-01   +1.147858923377173e-01   +9.643695997540547e-02   +1.055743668621001e-01   +1.392975569687410e-01   +2.940690661588862e-01   +1.709428224614287e-01   +2.273790042709399e-01   +9.238811228042924e-02; +2.429876912134227e-01   +1.126636165142948e-03   +1.673067643326399e-01   +2.689630279038307e-01   +2.336623438887645e-01   +7.726671816317872e-02   +3.984398748713257e-01   +2.262586914519985e-01   +1.227216380947903e-01   +2.171890391427881e-01   +2.370050979271932e-01   +2.582821638456761e-02; +1.381041364760169e-01   +2.532497957372450e-01   +7.153049213493529e-02   +2.104938243498360e-01   +1.308226685303227e-01   -6.549722779456119e-02   +8.383028446757303e-02   +1.149377998627878e-01   +6.265075076796582e-02   -1.029714630880385e-01   +1.089295077341848e-01   +8.088177985503513e-02];
L2E_L3E_iAMPA_netcon = [+2.564774951281990e-01   +1.321177553921602e-01   +3.689075888162502e-01   -7.226570636989722e-02   +9.405772815901024e-02   +1.832084068305719e-01   +1.197425264892521e-01   +2.524209998103204e-02; +2.705476167393437e-02   +2.126319182733615e-01   +3.702104968892216e-01   +1.630630694026960e-01   +3.386991826617289e-01   +2.070988409342234e-01   +1.514706638812139e-01   +3.286690386402556e-01; +2.217166387842711e-01   +2.147433484173105e-01   +2.333440620001069e-01   +1.415099554892485e-02   -4.876743957666829e-02   +3.734797974822170e-01   +2.457425619056361e-01   +3.241120881058660e-01; +1.273157457932206e-01   +1.891308001035899e-01   +7.508129609837363e-02   +3.142128417439004e-01   +9.894560719936568e-02   +8.271060852974998e-02   +2.659145285396723e-01   +3.619077869219057e-01; +1.861209322538806e-01   +1.312681789936456e-01   -4.810571396395616e-03   +1.947284635587896e-02   +1.819825897183975e-01   +1.522675551061498e-01   +2.069596548348785e-01   +2.626169885479788e-01; +1.262065094341024e-01   +3.008149479157348e-01   +2.378883116025081e-01   +1.065159524766047e-01   +2.235131582451184e-01   -6.709864138193562e-02   +3.131825373869076e-01   +1.388943474391127e-01; +2.404816030913022e-01   +2.332766429808512e-01   +1.293355541836246e-01   +1.680116058541363e-01   +4.506459266303069e-02   +2.287881028231816e-01   +1.746892677391425e-01   +1.130527937867742e-01; +2.056187437532565e-01   +8.944061885667971e-02   +1.305050017207535e-01   +5.258313748943906e-02   +8.731503445225017e-02   +1.525893816508052e-01   +1.895153995122541e-01   +1.574877480512499e-01; +2.345222424901923e-01   +2.527780538281795e-01   +2.793576373115837e-01   +3.151446658818258e-01   +1.747359738983346e-01   +1.579533768750515e-01   +2.947901021093021e-01   -4.431135340326550e-02; +2.508285616464407e-01   +2.573745447235393e-01   +2.028166046714170e-01   +2.936058709749600e-01   +1.447128496490210e-01   +1.139090113359498e-01   +4.023674609766841e-02   +7.833401933176470e-02; +2.712526179000242e-01   +1.878669610571414e-01   -5.666419237066490e-02   +7.420620801038408e-02   -3.375520668041218e-02   +2.236160543469378e-01   +1.893157149985744e-01   +3.421266610618716e-01; +2.673201489564478e-01   +3.116716787886480e-01   +1.990923247081492e-01   -1.054590396869757e-02   +1.774050919564839e-01   +2.001692212729365e-01   +1.720622391186641e-01   -1.135678755980496e-02];
L2I_L3I_iGABA_netcon = [+1.143403198482796e-01   +1.195478561099962e-01   +1.925591220288554e-01   +2.757732917772656e-01   -3.694394959588966e-02   +2.003287636962390e-01   +2.125516437913812e-01   -4.075551633555385e-02; +3.500806296920034e-01   +1.631428578124906e-01   +1.251833797418364e-01   +2.321275414583155e-02   +2.920742467721916e-01   +6.113826385492860e-02   -5.695610490810608e-03   +1.546398492632349e-01; +1.143290033124703e-01   +9.505784587150476e-02   +6.716308124219275e-02   +1.262562338354879e-01   +1.380940396914876e-01   +2.737687229044017e-01   +2.203681116563584e-01   +2.205027547620047e-01; +4.389899172128726e-02   +1.374268951214619e-01   +2.950010625252543e-01   +3.123744316371072e-01   +6.144527697052555e-02   +2.109623993660338e-01   +2.118114886067365e-01   +2.675720482851842e-01; +1.199410296340477e-01   +1.039501076926373e-01   +1.441273269468211e-01   +5.910147733995038e-02   +8.120807643560404e-02   +2.447695480861772e-01   -6.536941732560306e-02   +5.127065573249408e-02; +1.870798066045208e-02   +2.673297659218969e-01   +3.128875015308249e-01   -4.017110112713949e-02   -3.351560378241709e-03   +1.371419322301019e-01   +9.306543560810829e-02   +1.821155100448752e-01; +7.443041964472151e-02   +2.491867908141462e-01   +3.047195656998872e-01   +1.277724719925134e-01   +9.057032724791572e-02   +1.680148888990203e-01   +2.134668996860277e-01   +6.170605076541789e-03; +2.660285524697209e-01   +2.479828742436581e-02   +1.086168283970880e-01   +1.846322033467547e-01   +4.042362394391290e-02   +1.354872859028921e-01   +1.061261763971604e-01   +2.016767458394112e-01; +1.626923894744125e-01   +4.510748265640652e-02   +2.008815476146518e-01   +1.836632119165042e-01   +9.833896982711698e-02   +5.485605797014397e-02   -1.977702577325487e-02   +1.995717709134932e-01; +1.976915612320335e-01   +3.682067160095548e-02   +3.327376857692033e-01   +1.685113007589767e-01   +1.662543023633521e-01   +3.372354721725106e-01   +3.581968700904278e-01   +1.614282096624521e-01; +1.854923134081009e-01   +5.732522762611757e-02   +1.836254539234271e-01   +2.220353036708989e-02   +9.294837228179967e-02   +9.844709639626065e-02   -1.297719457368491e-01   +1.126300937319662e-01; +2.189445897133226e-01   +1.567171136614889e-01   -1.817341532507556e-02   +7.677392515635860e-02   +1.817683851330686e-01   +2.082433660189315e-01   +3.060873557589542e-01   +2.745991666979275e-01];
L3I_L3E_iAMPA_netcon = [+1.661919647861401e-01   +1.755973507268618e-01   +2.191109195173967e-01   +1.828169537441089e-01   +3.194494393545875e-01   +5.577972491323537e-02   +2.654671720818735e-01   +2.566719223461159e-01   +1.129753101237258e-01   +3.316570499407618e-02   +1.726063274918476e-01   +1.510446733507710e-01; +1.822787069332704e-01   +1.604334173835018e-02   +1.319879102297973e-01   +2.819662661056710e-01   +3.712941707178518e-01   +8.015975319934637e-02   +7.925827421573853e-02   +5.050128383144531e-02   +1.848949373696150e-01   +1.366343355031993e-01   +3.754156641481253e-01   +2.919831892453814e-01; +2.591605834494020e-01   +1.234251087996037e-01   +5.705687365838098e-02   +1.731090008965357e-01   +1.058155462299653e-01   +3.708915647835964e-01   +2.649517091769626e-01   +1.797640715856249e-01   -7.537815878801683e-02   -3.029126409475010e-02   +1.301775433782506e-01   +3.648206351023951e-02; +8.510891037748343e-02   +1.537767571268316e-01   +3.905380782329617e-01   +3.971760765859451e-02   +1.387334958838785e-01   +1.468289525465546e-01   +2.395275507400047e-01   +1.650915747726834e-01   +2.703191876712425e-01   +2.234103493028394e-01   +6.142289953603398e-02   +4.126564658185007e-02; +2.416021668932435e-01   +2.306967809852221e-01   +1.510681306585178e-01   +1.982050733048856e-01   +1.642461030211165e-01   +3.036102420163516e-01   +2.386676797671697e-01   +2.346156460997688e-01   +1.730902913078330e-01   +1.343523964867727e-01   +9.818575743753874e-02   +1.349998983327122e-01; +1.134226636601342e-01   +1.969161725512108e-01   +3.154977534502328e-01   +1.959096542065184e-01   +1.181654641750079e-01   +7.004432789730598e-02   +1.576957437414808e-01   +1.765077708656446e-01   -1.273820549847297e-02   +8.068102788705470e-03   +2.175765820120684e-01   +1.745009024497872e-02; +9.446436284592685e-02   +1.511541890998708e-01   +1.240615539998214e-02   +2.009242940337897e-01   +2.951631375407697e-01   +2.261641570018041e-01   +6.741958561518220e-02   +1.777548308106565e-02   +2.857011976900952e-01   +1.005669359894108e-01   +3.782139803140332e-02   +2.135310935583883e-01; +6.794142149623923e-02   +3.715062278331775e-02   +3.025366698866149e-01   +2.192476472601711e-01   +1.496384243784597e-01   +1.839737809808757e-01   +5.943353825151039e-02   +3.034036758298971e-02   +1.758977626319772e-01   +3.074941084622713e-01   +1.162813526332446e-01   +1.192415664806765e-01; +5.692739460166210e-02   +2.126579800131004e-01   -3.735759146344197e-02   +9.858862771362488e-02   +2.182534222599056e-01   +1.019657659005090e-01   +3.503705320946484e-01   +1.627157412522977e-01   +2.836963705020792e-02   +1.807789391394692e-01   -6.741292109909046e-02   +2.254358415633406e-01; +1.311128221246313e-01   -5.302523743817739e-02   -6.468485533057255e-02   +4.876133652969294e-04   +2.324617705782281e-02   +6.282068507670413e-02   +1.224302742398163e-01   -1.512173085712254e-03   +1.691882255332105e-02   +2.917530580931420e-01   +2.092958024483359e-01   +2.593463862835344e-02; +1.642172768174353e-01   +2.199281271069910e-01   +6.301828415263044e-02   +2.430269796312618e-01   +7.888625778111545e-02   +1.887332089571843e-01   +1.663438280529182e-01   +4.263300790702862e-01   +1.938362982041470e-01   +7.955990275917728e-02   +9.312639318255975e-03   +1.916320960552399e-01; -4.255004532487701e-03   +1.687370622323988e-01   +9.237890463785453e-02   -3.250516388051317e-02   +1.771149992278119e-01   +1.552253983443083e-01   +8.451723856922870e-02   +2.386161182523752e-01   +1.434193072314933e-01   -4.244248229802419e-02   +2.393996656689005e-01   +8.535453147621438e-02];
L3E_L3I_iGABA_netcon = [+2.033952974127841e-01   +6.089742085107883e-02   +8.518056894534315e-02   +1.116844462115101e-01   +1.288648034425340e-01   +1.549372248247369e-01   +1.804378402447643e-01   +6.989711238071139e-02   +2.852758167994530e-02   +3.277826097330705e-01   +2.645990672774635e-01   +2.953475647007269e-01; +1.020659424518774e-01   +1.505853531120588e-01   +1.344102395214346e-01   -4.829626626654768e-02   +2.786499291294265e-01   +2.786441623853394e-01   +3.230041792110179e-01   +1.767938189325569e-01   +3.243413028891801e-01   +1.307717296434106e-01   +3.847846250654567e-01   +2.373180759125050e-01; +1.230037028199700e-01   +2.128477321329934e-01   +3.189706790924455e-01   +1.880043138022482e-01   +3.383238868720223e-01   +1.033495071489545e-01   +1.685042343399961e-02   +2.807429552783555e-01   +2.424570972974701e-01   +2.960125366181875e-01   +7.120060078179979e-02   +9.593308459649741e-02; +2.881625682000733e-01   +3.238262554319790e-01   +2.497064420813049e-01   +1.327412392842439e-01   +3.149748314358431e-01   +2.998053764898020e-01   +2.691574861201770e-01   +1.442541951299114e-01   +2.333805650036489e-01   +1.805649349178201e-01   +2.640090942729918e-01   +1.016399958143899e-01; +1.004571942297517e-02   +2.580438490558986e-01   +2.928128582781255e-01   +9.512587920482669e-02   +1.019898114281293e-01   +3.294918490294393e-01   +1.139184155837726e-01   +2.406572068332641e-01   +7.604754901248054e-02   +2.252232274126516e-01   +3.326553828082728e-01   +3.572133162087084e-02; +1.503848791929154e-01   +6.167966077221321e-02   +2.998325775346999e-01   +3.668870664787163e-01   +1.990035476780632e-01   +8.334941786750676e-02   +1.567200756302330e-02   +2.753055122749181e-01   +1.341545243891261e-01   -1.081619293431348e-03   +1.075768853175588e-01   +6.835330235937066e-02; +3.177160372127706e-01   +1.142614155725517e-01   +3.732612756819482e-01   +8.582629942842941e-02   +1.625960400828058e-01   +1.509912971618116e-02   +2.547968488022037e-01   +6.628320105248797e-02   +3.666071658455722e-02   +1.728299359163829e-01   +1.679592178877418e-01   +1.819079168149379e-01; +2.567999025781640e-01   +1.047015369846597e-01   +1.260778174439343e-01   -5.195052900469368e-02   +1.968930899990092e-02   +3.837294943379028e-01   +7.268155530079481e-02   +3.005035266061054e-01   +1.274786674258258e-01   +3.861477490078171e-01   +3.054928786726864e-01   +8.164871606702973e-02; +1.079614825886362e-01   +4.100819671581785e-01   +1.644070041319895e-01   +2.463033044221307e-01   +1.918569906137579e-02   +5.416537307407068e-02   +2.308603987351726e-02   +3.667844276477781e-02   +2.044057083367086e-01   +2.757818959705950e-01   +2.305069388074679e-01   +1.177068262541097e-01; +2.058843665466051e-01   +3.283269160605130e-01   +1.125156601485488e-01   +4.522567366616862e-02   +7.995794303101146e-02   +8.873350930926255e-02   +1.867623257593129e-01   +1.276571037453852e-01   +2.045580178919154e-01   +1.611961331040807e-01   +1.758163246376333e-01   +4.119293716107517e-01; +2.386647569290755e-01   +3.108915520666111e-01   +2.154061296352367e-01   +1.928503169014801e-01   +9.552381285767336e-02   +2.638942483525667e-02   +1.968008621733746e-01   +1.448250935178773e-02   +4.782118435074739e-02   +5.919636149760138e-02   +3.428026685082247e-01   +8.915697273770151e-02; -5.006756046177663e-03   +2.370993895771891e-01   +2.188774392920206e-01   +2.721358220564248e-01   +3.071697071414704e-01   +2.856357848402637e-01   +5.882994843545916e-02   +9.994569963784061e-02   +2.273192747059413e-01   +2.756866226101442e-01   +3.394928291560694e-02   +7.576286848099970e-02];
L2E_Input1_iAMPA_netcon = [+2.674011066021442e-01   +6.501372695725569e-02   +6.666337917500263e-02   +2.214749335239347e-01   +1.055874740129990e-01   +2.178491814667332e-01   -8.141866736879050e-03   -5.474177256920077e-02];
L2I_Input2_iAMPA_netcon = [+2.216978542830211e-01   +1.121650510571422e-01   +3.269563981347285e-01   -2.989964489583080e-02   +2.960618964790848e-01   +3.036198651249460e-01   +2.342439898852065e-01   +2.317249556920304e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
