function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+9.741211588105250e-02   +2.915251673546262e-01   -4.768908153473789e-02   +8.314295482594054e-02   -1.836929729313619e-02   -8.750656569085449e-02   +2.556770746341749e-01   +6.396412731232637e-02   +7.719656367432369e-02   -1.219286925782708e-01   -1.186218867462591e-01   +1.695617259577074e-01   +1.237574227967246e-01   +4.203916226001633e-02   +1.727561852170113e-01   +4.973160044519283e-02; -1.002434098880275e-01   -8.726272370760488e-02   -1.105310896690970e-01   +8.023841406912065e-02   +2.370029676416854e-02   +1.345898118101557e-02   -1.617656544353091e-01   +6.949979620736810e-02   +2.608974625907011e-01   +2.801160158249565e-02   +2.562093997365287e-01   +2.403716374308751e-01   -1.439003224743738e-01   +2.181119650212215e-02   -2.853429556653485e-01   +3.855892018568563e-03; -1.437909649345503e-01   -1.898594653033710e-02   +2.416830130278927e-02   +3.937276555992266e-01   -3.340585275610972e-01   -7.698272510742832e-02   +3.287434158667059e-01   +9.042883058158049e-02   +4.102049460278197e-02   +1.916534646290031e-01   +1.128304044784953e-01   -2.154765211418180e-01   -1.061030343439270e-01   +1.521385898279956e-01   +1.696231376829193e-01   -1.404181782517832e-01; +1.158799357016490e-01   -1.025511076567121e-01   +8.827956963705863e-02   -1.475760688225622e-01   -2.105629598694381e-01   -1.566405257176514e-01   -1.984583196440585e-01   +2.289452338256715e-01   -1.889956913056479e-02   -4.147335865191517e-01   +6.022786740086009e-03   +1.201558167287814e-01   -3.543926625593987e-01   +4.579215322588111e-01   -3.531185923326181e-02   +9.648313394444585e-02; +7.613971543763759e-02   +1.407229888238302e-02   -3.674944225092507e-02   -4.960404079416910e-01   -1.041026596303769e-01   -4.026660323891791e-01   +3.179889288944788e-01   +4.803168083269477e-02   -3.300824351315569e-01   +1.919967404093628e-01   +2.549109562926740e-01   +4.118824933059517e-01   +2.006262954337787e-01   +8.784610120335989e-03   +2.306323240094555e-01   -2.771563620278792e-01; +5.992754563535369e-02   -1.584858604158229e-01   +3.007403053417458e-02   +5.971802383375052e-03   +4.275111891687119e-01   +1.405407711638072e-01   -6.230643003396794e-02   +1.185441552837815e-02   +1.031025705729690e-01   +3.206888574753644e-03   +1.813046972911380e-01   +1.363246418679498e-01   -2.235680489594282e-01   +3.316173276551723e-01   -5.109841353129592e-01   -1.825758882546477e-01; +1.494996722376875e-01   -1.241924581909848e-01   -7.743305115713582e-02   -5.671569662078581e-02   +1.466610185105625e-01   +1.279342202689661e-01   +1.121177995933903e-02   +3.545538163498916e-02   -3.138104877090038e-02   -3.622097060956057e-01   +6.192050403905358e-04   +1.145955950223469e-01   +5.521349162428021e-02   +3.415245893658762e-02   +6.723987876370227e-02   +1.411505762861788e-01; -2.753798625692070e-01   +8.987210665961096e-02   -9.684203873026111e-02   +1.969260355753476e-01   +2.270256084950137e-01   +4.596513994922391e-03   -3.798396079245012e-01   +2.288322727109979e-01   +2.635336454604405e-02   +1.107162336498911e-01   -1.675893245781621e-01   -1.363310000419641e-01   +2.309381880923793e-01   -3.962833463200128e-01   +1.856630660070789e-01   +1.825215962797282e-01; +9.203815080464722e-02   -9.401850663257945e-03   -3.244644464042658e-02   -2.437256424888429e-01   -1.538752946501552e-01   +2.051194624131450e-01   +3.061338319117925e-02   +2.310158936849394e-02   -4.445759848073815e-01   -3.025945736486516e-01   +7.668302146110270e-02   -1.255269827765066e-01   +2.479902935608355e-01   -3.924910808831537e-01   +4.604405002161342e-02   -2.120302501545001e-01; +4.611255300911796e-02   +2.906524028462671e-01   +7.613037289285907e-02   +8.945877186917409e-02   -1.329157643595418e-01   -6.555144962849960e-01   +5.766763168397482e-02   +1.160643447353064e-01   +6.396355564757003e-02   -1.482323740787819e-01   +3.367466019533057e-01   -1.066379340304714e-01   -1.576045093719069e-01   +3.339026539080981e-01   +7.200167747354264e-02   +9.338184752952038e-02; +3.328207663673292e-01   +2.000303883880651e-01   -4.143740376409233e-01   -1.994976601894906e-01   -1.733471342518708e-01   -1.973245006522461e-03   -5.880475688359513e-02   -2.750320786269795e-02   -7.574447360283228e-03   -3.770727102629898e-01   +1.565597043463355e-01   -2.026106556922068e-01   +2.317638375209655e-01   -7.646507012883851e-02   -2.879075983229063e-01   -1.384225730777681e-01; +1.213225728551348e-01   +7.949567037555950e-02   +4.300992879832090e-01   +1.288449060284577e-01   +4.984285799084023e-02   +5.406641683488916e-03   -2.767800098573781e-01   -2.746597804698536e-01   +7.694345870627575e-02   +4.751918144777337e-02   -2.723605016062940e-01   -2.488684449819885e-01   -1.339868751772324e-01   -9.507206124204973e-02   -2.195058444999122e-01   -2.329205769890609e-01; +7.952397361125238e-02   +1.997762008676714e-01   -8.454471808975898e-03   -2.141688849597445e-01   -1.927152068600110e-02   -4.322658248892058e-02   +2.210982729284018e-01   +6.218984750201674e-02   -2.549411131142468e-01   +4.688429997971334e-01   +2.246844937159675e-01   -2.483525805758959e-01   +1.554714895162461e-01   +1.020047659964214e-01   -7.949020884347151e-02   -1.594850525709675e-01; +9.899540835740846e-02   -1.913909350212051e-02   +5.354744195870088e-02   -1.814916225756846e-01   +6.329152229043968e-02   -3.841828098215405e-01   -3.862559453899088e-01   +2.370998645250592e-02   -6.079235840140512e-02   +1.508530673017068e-01   +6.010239059766539e-02   -2.241095272046827e-02   -1.018598668157095e-01   +1.784509379668734e-01   -1.432666463571777e-01   +4.263905818682452e-02; +6.787955962651072e-02   +1.644971769078768e-01   +9.399990509810585e-02   +1.666847856694948e-01   -7.871532076804275e-02   -1.367620161709056e-01   -1.289582757631965e-01   +7.096631276334650e-02   +3.604559430491996e-02   -1.058834342043149e-01   +2.247928682446054e-01   +3.610457213922319e-02   -3.058090172219698e-01   -2.096468242029342e-02   +2.043175724772233e-01   +1.288418936666066e-01; +3.316470055671707e-01   +2.529018303951203e-01   +2.748542115177912e-01   +4.760467593205309e-01   -4.818818200474716e-02   +8.293600641204525e-02   -3.952109193660172e-01   -4.738360223035459e-01   +3.401743104747722e-02   -2.592249429097422e-01   -1.307779950072513e-01   +6.625026010829128e-02   +2.042178385732042e-01   -4.928819646669497e-03   +2.426439757756871e-01   -1.788977925497632e-01];
L1E_L1I_iGABA_netcon = [+1.913894288860420e-01   -3.497458174771442e-02   -1.328080921534756e-01   -3.803001511627113e-02   +7.192885104392097e-02   -4.945163224523943e-01   +1.939796297005800e-01   +7.396412507903163e-02   +2.323302400084002e-01   -5.190151389972227e-02   -3.531818238562388e-01   -3.065022678466424e-01   -9.670095579594726e-02   -1.888270855434358e-01   +1.805165869705150e-01   -4.870242688824974e-02; -1.340731577603611e-01   -1.494040640899429e-01   -1.643527237317430e-01   +2.389279187120040e-01   -1.888203884248280e-02   -6.086842664171770e-02   +8.523457801435087e-02   +1.761634355337758e-01   +6.366109753416335e-02   -4.728555447831401e-02   -8.441134476943318e-02   -1.385175380453878e-02   -2.026199892982315e-01   -5.596433007648351e-01   -3.670995546401658e-01   -8.470538073773956e-04; -9.910172174536531e-02   +1.618291644995706e-01   +2.194355211035570e-02   +1.779216728834286e-01   +1.743634138176950e-01   +1.703625108555767e-02   -6.716686965200830e-02   +6.027778912952381e-02   +3.517593667362280e-02   -1.387766650041594e-01   +1.457942092497328e-01   +1.088430087960176e-01   -1.256790843978733e-01   -2.921136653574462e-02   +3.675204560692185e-02   +5.285930625275597e-01; +1.697853149829931e-01   -9.046092302216856e-02   -1.251743666869375e-01   +3.671376007865655e-01   -1.075228632557556e-01   -6.091122768035402e-02   -1.721194309496905e-01   -1.323759478901064e-01   +2.402007955809313e-01   -1.025414476148229e-01   -4.203549587188336e-02   +3.700659849432544e-01   +9.869468239954765e-02   +5.936231305345056e-02   +8.678251879199593e-02   -1.206367906581843e-01; +1.738781323297595e-01   -1.207277327655596e-01   +4.927716530134735e-02   +4.320960887438439e-02   +7.666262520412159e-02   -8.076523511679055e-03   +2.605338767974889e-01   -1.723626180145261e-01   +4.240526686877515e-03   +1.289177865150564e-01   -2.849219044468054e-01   -1.859876335589198e-01   +2.454871090415649e-02   -2.678115471537146e-02   -6.117794882492562e-02   +9.591680242983207e-02; +3.889120902373713e-04   +1.965689975705343e-01   -7.466433561614624e-03   +3.022543869929633e-01   -2.587082956495523e-01   -1.128399537758917e-01   -2.870364227564604e-02   +1.148662242145751e-02   -1.547103463134399e-01   +1.164266394936952e-01   +1.584762653398693e-01   -2.514010723049164e-01   +1.767755418532127e-01   +3.541677031787614e-02   +8.326411051484697e-02   -1.622234345556699e-01; -3.758703484534819e-02   -3.737124601181704e-01   -4.963537405294079e-02   +2.915886988576813e-01   -2.179601222433828e-01   -1.089986879840210e-01   -2.006168744993027e-01   +3.595026948584601e-03   -1.438351250293767e-01   +2.788329168231517e-01   -7.622280303410311e-02   +1.096832513710548e-01   +4.313230195357307e-01   +1.230394825896099e-01   -1.228036252582728e-01   -3.821045503155449e-01; -4.491929265562718e-01   -2.775988209201056e-01   -6.129879730780925e-02   +2.332529954903788e-01   +2.678873927992000e-01   +2.076212766260003e-02   -3.502128071105399e-01   -1.962757043786802e-01   +1.482798632497556e-01   -8.618542753058020e-02   +2.241523493840768e-01   +1.136435541858258e-01   +1.380914927830649e-01   -2.465337043564035e-01   -6.675161632456864e-02   +2.315604813518721e-01; -5.110016050151822e-02   -9.220502568240208e-02   +1.305780940612217e-01   -2.803196938476967e-01   +1.784121148859895e-01   +1.816682793131859e-03   +1.802842634999332e-01   +1.024287121864660e-01   -7.900156148755923e-03   -3.407714025525488e-02   +1.594303891466209e-01   -1.647767310638801e-01   +1.494518313494498e-01   -2.320211080633287e-01   +1.380292152002548e-02   -2.178714532283566e-01; -2.999499740499104e-01   -1.166589695264253e-01   +1.311188487295452e-01   -3.932377892126443e-02   +1.926093738457693e-01   -1.715586821861195e-01   -1.161970046036854e-01   +2.147050146906491e-01   -1.034363411092324e-01   +1.880389042632402e-01   -1.454716562337305e-01   +2.516842188702346e-01   -2.017826217656651e-02   -1.873050507841947e-01   +2.684072138938370e-01   +1.982259791121511e-01; +1.144401433776670e-01   -1.028773705849071e-01   -1.836412146867682e-01   +1.502073947271774e-01   +1.079993161250996e-01   +1.387498305263006e-01   -1.914097499904377e-01   +3.769367058661593e-01   +2.955125623077437e-02   -1.109430967841762e-01   -1.832625858795950e-01   +3.101459197339905e-01   -1.985334230865794e-01   -4.254187566129541e-02   +9.372586699076409e-02   -2.071686034458543e-02; +3.928145420830970e-01   -2.861601398152217e-01   -6.297506993158111e-02   -6.815812211645236e-02   +1.828364985130058e-01   +3.068829527382511e-01   -7.235695218129164e-02   +8.992003227974056e-02   -5.051446849284411e-02   +5.138748077174488e-02   +2.341774420625620e-01   +2.102466741293314e-01   -2.129140916385259e-01   -5.060873087379632e-02   -4.986667842953125e-01   -2.032711129635657e-01; -3.139621798488265e-02   -1.021424126680237e-01   -1.743081416008543e-01   +2.467208913328328e-01   +3.338840151038686e-01   -1.117702360245788e-02   +1.882114882108768e-01   -8.182885491873096e-02   -1.527811948693809e-01   -2.218488283681022e-01   -8.882610605104040e-02   +1.612899535184185e-01   -3.632321326408005e-02   +8.453210384597931e-02   -8.883985665509764e-02   +1.729373996487087e-01; -1.555546893190990e-01   -5.573713975692680e-03   -3.034568960573372e-01   +3.685145905316238e-01   +1.845213905295682e-01   +2.480146808111780e-01   -3.007080125520009e-01   +3.668194522333889e-01   -1.816715223691265e-01   +3.791749283094604e-01   -3.148702744217867e-01   +1.911178299094102e-01   +6.543950373773015e-02   -4.776175717184505e-01   +1.970765016855468e-03   -7.672772180275560e-02; -3.379406651461206e-03   -2.804424860946880e-01   +1.904499048846353e-01   -2.623080765957403e-02   -5.648859197933745e-04   +9.553073003358963e-02   +2.738067167374580e-01   -4.938361149711971e-01   +3.283786079375988e-01   +1.285976095510103e-01   -2.359573088346062e-01   +2.649372556041368e-01   -2.563792467880433e-02   -1.667360499909270e-01   +1.679860127798870e-02   +2.868951573821282e-01; -3.049530782228248e-02   -6.788661428015590e-02   +2.365719680675887e-02   -2.868931558709475e-01   +1.228602931489817e-01   +1.503210425146861e-01   +7.283255300507799e-02   -9.908323752794911e-02   -2.474202463045437e-01   +1.243715103884250e-01   +1.598973722897336e-01   -1.693287472804965e-01   +1.505656994992478e-02   -4.943689067762443e-02   +1.357813346974840e-01   -2.677049440323166e-01];
L2I_L1I_iGABA_netcon = [+6.194991149114866e-01   +1.104579061658735e-01   +4.056206232586542e-02   -7.084120544407183e-02   -1.351639316569396e-01   -1.771080795492317e-01   +1.572381667873847e-01   -1.057311056290773e-01; +6.591695630810225e-02   +9.325720973663693e-02   -3.404034309706854e-01   -1.631402023605659e-01   -1.292637034832022e-01   +5.924734409694553e-02   +1.271492475642241e-01   -2.174341833433765e-02; -5.143456499243516e-01   +1.526884925251868e-01   -1.282343943805624e-01   -1.716580484076081e-01   -4.408203047879790e-01   +2.030777206208667e-01   +5.880116142573302e-02   +2.869652230539151e-01; +3.314796271838734e-01   -2.096847621271323e-01   -1.766255578763039e-01   +3.761218324396942e-02   -2.013081652660150e-01   +1.948658612376623e-01   -2.672146572165780e-02   -6.238870506426532e-02; +1.484519980948797e-01   +2.498894393600842e-01   -6.023518267594679e-02   +2.664333025618313e-01   -2.150373354277014e-01   -2.566441361014689e-01   +1.472840189326005e-01   +1.997497483021964e-01; +2.374770957465970e-01   -1.407574599810959e-01   +2.188081879958020e-01   -1.746138905329371e-02   +4.600939029059969e-01   -1.954705424094463e-01   +2.466524040817982e-01   +6.481326124763057e-03; +3.347469871736989e-02   -3.111261313843318e-01   -4.600058778043570e-02   -6.171027414816363e-02   +1.960025005554921e-01   -2.835054143363160e-01   +4.043637526593331e-02   +2.429987167571642e-01; -1.197810313310271e-01   +2.944895615617865e-01   -1.280289389706311e-01   -1.433202706367366e-01   -1.071665806307863e-01   +4.948981864527174e-02   -3.282101078282826e-01   -1.886471520140712e-02; -7.390396964269126e-02   -5.549344841742568e-02   +2.660380453785515e-01   +1.730048686725064e-01   -3.397546556364744e-01   +1.993379751145971e-01   +8.911136770385081e-02   +2.725734307548892e-01; +1.544675845113419e-01   +2.526308321333507e-01   +1.594100980032712e-01   -4.541838187632306e-02   -8.466599140916950e-03   -2.146906254709866e-01   -2.783034501460332e-01   +1.279789120122176e-01; -3.828049983632553e-01   -1.680053273765938e-01   +2.196276001585848e-01   +2.493123282594353e-01   -7.842606037613982e-02   -1.876178658633353e-01   -1.843028678579614e-01   -3.885732135183570e-01; +3.074073990258663e-01   +1.382744887674122e-01   +6.799014140974262e-02   +1.202471330728380e-02   -1.049158086585535e-01   -3.131482865191569e-01   -8.956912413987995e-02   -1.379448145190801e-01; -1.273875460410821e-01   +4.170700183920456e-02   +2.784674234769080e-01   -9.073419597074525e-02   -4.612359995168563e-02   +7.042502784042487e-02   +1.270481914803517e-01   +1.673624562224973e-01; +1.896917173205264e-01   -9.143282763065616e-02   -5.123101438454191e-02   -1.504200323399272e-01   -1.988682947840731e-01   -6.487240399157040e-01   +1.996814815406541e-01   -6.697720593087116e-02; +2.130991944137778e-01   +2.233773148709644e-01   -2.275039573963323e-01   +3.243796439810196e-01   +1.688454302338982e-01   -3.958851606518450e-02   -1.370746996939148e-02   +7.940537701813277e-02; -3.355071321212310e-01   +3.536676177084560e-01   -7.213310585426762e-02   -4.410859084849795e-02   +2.440261627847664e-01   +1.544622651343672e-01   -1.107176786684924e-01   +4.264116070697809e-01];
L1I_L2I_iGABA_netcon = [+1.514113849149255e-02   +2.841572105958444e-02   -6.506162515472998e-02   -8.720909262368794e-02   +2.114741601878256e-01   +1.078050781239092e-01   -1.829130595327661e-01   -9.964322115238414e-03   -2.796349067807097e-01   +1.942317398165766e-01   -1.618793671462237e-01   -3.443335405822670e-01   -9.547666849431684e-02   +4.296450113860160e-02   -2.602790297682269e-01   +9.699383320705628e-02; -3.019279727698970e-02   +7.393980908183256e-02   +2.652632149152902e-01   +3.057585442147228e-01   -1.054788764765589e-01   -2.044882779366334e-01   -1.520166889928444e-01   -4.708105117864539e-02   -4.221322075831353e-02   +2.249999735810580e-01   +4.219173736544500e-02   -1.138860645747015e-02   +1.788089631738096e-01   +7.212008896241998e-02   +1.693616993381042e-01   +4.454891961899642e-03; -4.713329256298561e-01   +2.478350348326638e-01   +1.995006466969618e-01   +1.785437321501308e-01   +1.072210660085881e-01   +4.207822254244670e-03   +1.783657268931771e-01   +2.155094649568637e-01   +1.251982295041643e-01   -1.395596138182232e-01   -1.063677977625793e-01   -4.418665332294735e-02   +5.069759618562754e-02   -2.581578552644600e-01   -3.960384365882602e-01   -6.429157072208031e-03; -1.275095517387122e-01   -2.633265342721376e-01   -7.208438457908108e-02   -2.321590418760939e-01   +1.395777676576898e-01   -1.326856192949320e-02   -1.488209585303839e-01   +1.310762072973154e-01   -2.385381115627557e-01   -1.261544878969645e-01   +8.074047179472878e-02   +4.741410291965359e-02   -3.413156226472971e-02   +4.786528936740539e-02   +1.499663969087989e-02   +2.329922291122388e-01; +1.903302998821920e-01   +5.019970850086145e-01   +1.157280758262805e-01   +2.469625241394904e-01   +2.731749971797439e-01   -6.580158975858127e-02   -1.142692167158510e-01   +5.579404186901640e-02   +5.303301337219868e-02   -2.343672178281235e-02   -1.550703363712078e-01   -2.207813785106102e-01   -9.666703524912426e-02   -5.285037373985426e-02   +4.798656681462896e-01   -5.953563830037895e-02; -2.880062591296585e-01   +4.177152348757128e-01   -5.773560435620359e-02   +1.445541514134298e-01   +3.557401573529163e-02   +2.243958974183319e-01   +3.496649276767459e-02   +3.203857862780198e-01   +3.267240013808583e-01   -2.132903515307259e-01   +1.559396198915315e-01   -1.613383838163378e-02   -1.405655347837543e-01   -1.016545126314275e-01   +4.056757576583085e-01   -1.828961003394627e-01; +1.284799498585113e-01   +2.126337446721227e-01   -2.106312472116579e-02   -4.339047763779340e-01   +1.219192468893999e-01   +1.293610457030285e-01   -5.846712693014701e-02   -1.912338823592110e-01   +4.199810150730387e-01   -1.188802765276336e-01   -3.142561071272539e-02   +2.589847334993037e-01   +1.010649016660118e-01   -3.304291430742246e-01   +2.635674168237969e-02   -2.331113331987230e-01; -4.546834188369188e-02   +7.853516224599658e-02   -3.832039392542810e-01   +8.281576061051252e-02   +7.375407709614992e-02   -1.165687712761121e-01   +4.264277759596969e-01   +2.083281587161897e-01   -2.914693421319812e-01   +6.386688200924275e-02   +7.094469954214094e-03   -1.208332637438655e-01   -3.529157066038758e-01   +5.029067290132709e-01   -5.959080940848493e-02   +9.347592428884591e-02];
L2E_L1E_iAMPA_netcon = [+1.316151154564977e-02   -1.058766526848460e-01   -9.074527095153720e-02   +3.017387758108658e-01   +8.974623232810103e-02   -1.014436622856541e-01   +1.220540523337582e-02   -2.814806851529947e-01; +2.399792900888865e-02   -2.699925022109259e-01   +1.477427751817221e-01   -1.624095781207421e-01   +3.579875365134113e-02   -1.703330081800179e-02   -2.408646321280893e-01   +1.522124125810514e-01; +8.981711259891662e-02   -1.127223134994569e-01   -1.212814891647107e-01   -2.616587291843209e-01   -8.340895744023130e-02   -1.570929579806670e-01   -6.088921470362577e-02   +1.163493038412196e-01; -2.137893669699934e-01   -7.287299926247348e-02   +1.201486531848339e-01   -1.206555177308629e-01   -4.242697731917420e-01   -1.166336766624295e-01   +2.012014922793144e-02   +2.204099590945163e-01; +1.820411682565733e-01   -4.045986643896926e-01   +6.252558647741592e-02   +2.553396302797084e-01   +1.662495894268846e-01   -1.604352747304852e-01   +1.863806976108863e-01   -2.949443961633744e-01; -1.432125894654508e-01   -2.325174273476388e-01   -2.956790439601904e-03   +2.947050726602342e-01   -8.985924163620093e-02   -1.314890136558236e-01   -8.042733891103029e-02   +1.133505343562233e-01; -1.617361331066690e-02   +1.656628434315333e-01   -2.529974739180203e-01   -1.868843105276038e-02   -6.965363027508019e-03   +5.114695297446729e-02   -2.853657406477519e-01   +5.407716348744476e-02; -1.596999599432330e-01   -1.143321831891379e-01   -3.884053000591620e-02   -1.407408977676490e-01   -2.028597416779827e-01   +1.052274527640664e-02   +2.463704456078802e-02   +4.032675336265056e-02; -3.365023991534472e-02   -2.477645611294756e-01   -1.749151600636816e-01   +1.364419636531352e-01   +5.849082354494144e-02   -1.110573123740352e-01   +6.355444253487283e-02   +1.419015818970292e-01; +2.570201427587299e-01   +3.031866979554318e-02   -3.076485722832400e-01   -2.171566364589765e-01   +3.734848541908277e-01   +3.356321349268414e-01   +2.358915055535661e-01   +1.921922100902385e-01; +1.211983994898781e-01   -3.068162767774852e-01   +3.345593282391441e-01   -4.860280639890076e-02   +2.171569239313903e-01   +7.234404012462013e-02   -2.179483519854299e-01   +1.318084502703066e-01; +2.605908723318950e-01   +2.677022652854045e-01   +1.433104687611286e-01   -1.495514191159979e-01   +1.903441478085080e-02   +2.014261494109674e-01   -8.073969127667791e-02   -2.358107225781560e-01; +2.969631603704378e-01   -3.315273693154726e-01   +1.698725749910448e-01   +1.960430102005977e-01   -2.154841523689637e-01   -1.120342277169757e-01   +1.282240919736694e-01   -1.377152527741472e-01; +3.161223336722281e-01   -2.531846047704452e-01   +1.614996292346030e-01   -4.521829563892556e-02   +2.060394726231872e-01   +6.069229481106182e-02   -3.907050639587489e-01   +9.026312721623787e-02; -1.051099151395287e-01   +2.709531242753261e-01   +1.080645459744921e-01   +3.834376866955093e-01   +9.134216695764817e-02   +1.157532449172233e-01   -2.559710633187029e-02   +1.957477274053986e-01; +3.255747200211482e-01   -2.313472582065254e-01   +1.921988266493203e-01   -8.393189886821729e-03   -5.000924267844968e-01   -8.920355000482294e-02   +3.259994183730185e-01   +3.468337340992335e-01];
L1E_L2E_iAMPA_netcon = [+1.040224141884218e-01   -2.375484529922068e-01   -1.440106309546553e-01   +1.014719767591652e-01   +2.140491578354379e-01   +8.777307769114545e-02   +7.464634582087929e-03   +3.384247981101508e-01   +1.876805698021392e-01   +1.549560846799136e-01   -2.052654586850113e-01   -8.717321691760246e-02   +3.926554548617133e-01   +1.221495762509797e-02   +6.062159441742903e-02   -1.514115063953270e-01; -1.895225035744146e-01   -6.028105173077000e-02   +1.374147483047870e-01   -3.412176207232863e-01   +1.623460687689813e-01   +1.399908446025964e-01   +1.117442776396020e-01   +2.600243844205750e-02   -6.385017537633343e-02   -6.510025455167434e-02   -2.634721996897788e-01   +7.857220206284871e-02   -5.464887589204245e-02   -2.296790067982348e-01   +1.597130352334498e-01   +1.461961478383711e-01; -3.785132439776865e-01   +2.693035441448509e-01   -4.194172540944179e-01   -1.746218009642973e-01   +2.272522263457865e-01   +1.541702815622186e-01   +2.518229378173381e-01   +1.876264618972920e-01   -1.649140995504250e-02   +4.296094917486168e-01   +2.978126661650247e-01   +9.747234640274757e-02   -2.472041858708133e-01   -2.973290293882561e-01   +1.216907163585052e-01   +4.710394155330425e-03; -1.269793971514090e-01   -2.478984926434406e-01   +6.291405023387221e-02   -3.097274144198957e-01   +1.636416376232349e-01   +2.632131381184126e-01   +2.551524464784407e-01   -4.806055700703234e-02   -1.927947956104852e-01   +8.479545295266737e-02   -4.478265131433402e-02   -1.781969823692310e-01   -1.445624725883350e-01   -2.325585777887955e-01   -4.380721331727772e-02   -7.755731665197407e-02; -4.665108128833681e-04   -8.280586891504546e-02   +3.552667164551797e-01   +2.077611887402565e-01   -2.928177768296978e-01   -2.208264379539148e-01   +6.902140411419014e-02   -1.559762202779569e-01   -1.653980016049539e-01   +2.209048449120223e-01   -8.665643252311689e-02   -1.641108233209592e-02   +1.198434212679825e-01   +2.101294721707395e-01   -4.184513585232946e-02   -6.735116208493012e-02; -1.237101468360363e-01   +1.727866209632071e-01   -3.833646038425835e-02   +2.645076578710868e-01   -3.161906903019172e-01   -9.676652275001577e-02   -1.728375961764570e-01   -4.317330677864148e-01   +1.637259165501441e-01   +5.643488306445175e-02   -1.878399217549827e-01   -4.225905671364670e-01   -8.117464007834733e-02   -1.227120092040990e-01   -5.114368939298625e-02   -6.601073060021552e-02; -1.252358872046645e-01   +3.096821160081252e-01   +2.743865774569030e-01   -1.968742784100135e-01   +3.205227759581691e-01   +3.263913490897770e-01   -1.861875617019870e-01   +5.114475378668198e-02   +2.056493541102433e-01   -2.340792188085248e-03   +8.133881212863200e-02   +3.029171023826899e-01   -1.777966704571938e-01   +1.020411659707000e-02   +3.629644049538847e-01   +1.911200518078555e-01; +2.665744311666045e-01   -4.921794139398753e-02   -5.047409286509147e-02   +1.075812057195399e-01   +4.600502552512462e-01   -1.247129780739608e-01   -2.349842009860856e-01   +1.564902872131592e-01   +3.050046778783423e-01   +1.861696391548296e-01   +6.208062424313801e-02   +5.019506249988625e-02   +8.482990594799854e-02   -1.164273037776323e-01   -1.574103074743616e-01   -2.156764593083446e-01];
L2I_L2E_iAMPA_netcon = [-1.061801696576520e-01   +2.804147341980798e-01   +4.421383478462859e-02   -6.674232556038899e-02   -1.918544478322864e-01   +1.562834880351621e-01   -2.934378101564589e-02   +2.600718258308941e-01; +2.138529725171834e-01   +1.440747403558790e-01   -2.300880135124538e-02   +1.181569300364625e-01   -1.709975334141212e-01   -5.450648046116789e-02   -1.717488498088234e-01   -2.783153133340567e-01; +1.195079266879746e-01   -2.842756123477412e-01   -1.923455719334994e-01   -2.645002364866972e-01   -2.773314381768197e-01   -2.110549861768476e-01   -1.097536517831737e-01   +2.299161883329623e-01; +2.241190052598193e-01   +2.570771650795094e-01   -3.374722641600896e-01   +2.351236484688083e-01   -4.168873533250719e-02   -3.231709766143530e-02   -1.156619158717286e-01   -5.072714528967057e-01; -2.188241042541728e-01   +1.172294335028487e-01   +2.674396874961115e-01   +2.330313231632491e-02   -7.926686847500954e-03   -1.794034493625000e-01   +2.547939965941402e-02   -4.175045511766308e-02; +2.095395488648743e-01   +1.133190812679881e-01   -1.374311223566938e-01   +2.578387383217096e-01   -5.275463273252397e-02   -1.043535035317813e-01   +1.474640204193889e-01   -2.683249592936895e-01; +3.995394471799826e-02   +1.260400412795107e-01   +3.565149665459612e-01   -4.370814389614244e-01   -2.880773724891520e-01   -3.116441574047267e-01   +6.406962400839473e-02   -1.586070104876399e-01; +2.918812782873894e-02   +1.912947799611881e-01   -8.391093824635562e-02   +6.553005055565178e-03   +8.858787827677485e-02   +2.641663998121748e-01   +3.189055651997414e-01   -3.220341398702581e-01];
L2E_L2I_iGABA_netcon = [+2.321211818882911e-01   +1.415892690134323e-01   -1.043599295591687e-01   -1.819447942235067e-01   +3.969319965302308e-01   +8.004311770632278e-02   +1.253889336231122e-01   -1.405204990182876e-02; -1.032971264899636e-02   -3.636524092789034e-01   +3.536320293538787e-01   +2.066816086687764e-01   +1.969920118080402e-01   -1.450283051032932e-01   +3.219030789617505e-01   -3.134429751911869e-01; -5.423161837729090e-03   +1.188742632887701e-01   -1.243341720633163e-01   -5.890492292869198e-02   +9.674250352173025e-02   +5.425881843713981e-01   -8.793423914244537e-02   +1.039186612417091e-01; -1.389202793511531e-01   -4.871803961002202e-03   -2.917486367103547e-01   +1.982471049156576e-01   +3.452954850188176e-02   -1.701636040725121e-01   +1.009340130105737e-01   +2.226109694928199e-01; +3.395755748295294e-01   -1.136612072223604e-01   -2.827618028488617e-01   -1.872190353163273e-01   -7.992819892378895e-02   -1.453096155126120e-02   +9.266534550549452e-02   +2.321253253024442e-01; -2.443298311668478e-01   +7.178579136740115e-02   +1.940322095589332e-01   +8.405892304168489e-02   +1.681469720379625e-01   +2.274117032126290e-01   +1.678134406556481e-02   -2.848682502188006e-01; -8.008094104811202e-02   +2.108953796745131e-01   +3.277782358352348e-01   +2.509582899893089e-01   +1.506484628329487e-02   -9.514745299211877e-02   -2.584488834446243e-02   +1.530791361507053e-01; +2.083594511715149e-01   -2.258250711484674e-01   +1.219105576486390e-01   +3.579970564568240e-02   -8.973031223903066e-02   +1.164006591789021e-01   -9.157169274275415e-02   +2.331925831317156e-01];
L3E_L2E_iAMPA_netcon = [-8.564896417930719e-02   +1.121892615864551e-01   -1.568070835233342e-01   -3.172827818252677e-01   -3.469071294227910e-03   -3.624181830624416e-02   +3.924584808163554e-01   -3.462566939429826e-02   -4.680487243085572e-02   +1.147140950845392e-01   -3.252796201228141e-01   +1.758191760593479e-02; +1.457398595219580e-01   +7.142058284588991e-03   +2.564532564441674e-01   +5.122053156836408e-02   -1.426036825598012e-01   -5.480343580743704e-02   +7.522677131073600e-02   +7.274112759748651e-02   -4.659621985775630e-02   -2.424403730987311e-01   -3.416735464692738e-01   +5.921432193408745e-02; -2.276903733951390e-01   -1.523150828229457e-01   +2.072356949760306e-01   -1.806200747278053e-01   +6.532354738486931e-02   -4.635511009876931e-02   +1.637953829660466e-01   +3.572750531440542e-01   -1.284995174526879e-01   +1.417850329700392e-01   -2.810999590489362e-01   -1.486648522069636e-01; -2.261011595113171e-01   -1.344434624126052e-01   +3.349707355829247e-01   +1.460353072166044e-01   +3.014405149758047e-02   -7.676824911642981e-02   +2.806182082148505e-01   +3.845858103977987e-01   -5.170507888164217e-02   -2.418260270202192e-01   -2.030236215034762e-01   +1.774926459474255e-02; -2.325260428947268e-01   +5.695781470847025e-03   -1.293392717592206e-01   -4.915020560685702e-02   -1.630822085192317e-01   -5.607424613652623e-02   -1.091756087442599e-01   -1.962260805536802e-01   +1.262646453709253e-01   -3.025595792514717e-01   -7.820765846253014e-02   -1.589121936907938e-01; -1.410017305476142e-01   -2.627367795816694e-02   -1.774959409883262e-01   +1.861157420774357e-01   -2.106837749040322e-01   +1.035154678416742e-01   +3.938673222051889e-01   -2.913745558489552e-01   -3.524869500549720e-03   -1.955501653912612e-01   +7.496019880082644e-02   -2.746785494196769e-02; +6.722860906105611e-02   -3.140063658356929e-02   +3.458055851458100e-01   -4.082370664316377e-01   +1.256482950346441e-01   -1.443934088245342e-03   +2.350525443018125e-01   +3.367194596057459e-01   +5.923618230973721e-02   +1.337111586857017e-01   +8.172104721216918e-02   +1.104642185102818e-01; +1.638417452861808e-01   +2.601546136455832e-01   +5.115677661377674e-01   -3.811586461795419e-02   +3.551356038591058e-01   -2.718026662880887e-02   +3.917050474616663e-02   +5.971126183486761e-01   +1.966767205813040e-01   +8.306297143118074e-02   -1.677633774259279e-01   -2.577254199237016e-01];
L3I_L2I_iGABA_netcon = [+1.571200312111047e-01   +4.801600916933169e-01   +7.682386992316978e-03   +4.004205483072352e-01   -1.672399537520315e-01   -2.313166869664814e-01   -5.028275768417370e-01   -1.593553582510060e-01   -1.262766063219381e-01   +1.887803664086221e-01   +1.575092617359767e-02   +1.769680905047959e-02; -8.382746196903246e-02   +1.738724378261404e-01   +2.849028044490997e-01   +9.253148563383249e-04   +1.440691991900206e-01   +9.290196567737619e-02   +1.678789420243219e-01   +8.140778803794597e-02   -2.721983057794377e-01   -1.255760743733649e-01   +2.446215896057975e-02   +4.069788255247107e-01; -5.787830199997804e-03   -2.111329398200746e-01   -8.395959156389352e-02   -6.881877286772795e-02   +7.054730903026032e-02   +1.171488297657629e-01   -2.038496097376422e-01   -1.718872728592085e-01   +7.181342450394325e-02   -2.334452142850943e-01   -1.748932988048973e-01   +2.841494416300119e-01; +1.886801962635034e-01   -9.141637615963143e-02   -1.520644039779843e-01   -2.627047810345949e-01   +3.236069026630947e-01   +1.637109283424314e-02   -2.273422189745923e-01   -7.928272881243999e-02   +2.748174274200111e-01   +4.440404445188376e-02   +4.472198619371822e-01   -3.419224914570318e-02; +5.464661804611810e-01   -1.251581390569271e-01   -1.402067129692339e-01   +2.110361369460070e-01   -3.370188910467528e-02   +8.743166352750226e-02   +1.126641459568648e-02   -1.756493157619528e-01   -3.362166153935062e-01   +1.660247683448464e-01   +2.944242832153861e-02   -1.661450280186052e-01; +2.585536782662694e-01   +2.021685789249750e-01   +8.794012641512837e-02   -2.143085078492167e-01   +1.058260534507718e-01   -2.735279586460648e-01   -1.665362722037618e-01   -2.157568453397842e-01   -2.080382414954798e-01   +1.021617702319884e-01   -2.549946206743151e-01   -2.498544832761194e-01; -8.943054126368283e-02   +2.651436618533528e-01   +5.243022549930612e-01   -3.065718654192711e-01   -1.980548554063607e-01   -1.053557289088678e-01   +3.593137595414650e-01   -5.955914594936947e-03   +1.529379088331492e-03   -9.791698022816475e-02   +9.952602966115198e-02   +4.502891954895337e-02; +1.107552162404969e-01   -2.606193434085153e-01   -7.826551143685785e-02   +3.828874842377388e-01   +2.229018306759649e-01   -1.215315361809670e-01   +3.392203866597143e-01   -4.013746381264552e-01   -2.282875580619323e-01   -4.512583900320231e-02   -3.259880318717290e-01   +2.293429585862465e-02];
L2E_L3E_iAMPA_netcon = [+7.967640059905880e-02   +2.363709570579305e-02   +3.523260882142201e-02   +1.320002088289845e-01   +3.043042212098825e-01   +5.041420070141234e-01   -1.825013430049185e-01   -1.337294075570589e-01; -1.126025918057622e-01   -2.088654143256683e-01   +3.626828185738755e-01   +3.059203047248393e-01   +6.238250828741592e-02   +1.617827912851880e-01   +1.487115069666505e-01   -1.190287712356922e-01; -3.972363407580001e-01   +2.871461827260033e-02   -3.524436479483803e-01   +1.530333705737793e-03   +9.471544731501066e-02   -3.150850700742454e-02   -4.334792495793632e-02   +1.364814366551997e-01; +2.776085097573859e-01   -1.427048787116706e-01   -3.778708156776901e-02   +2.020600900266347e-01   -1.441684284164211e-01   -7.116911680694313e-02   -3.634755326887845e-01   +2.690734965852478e-01; -2.419865795488943e-01   +9.873825689484785e-02   -3.418229400991099e-01   +9.039727405364822e-03   -1.045077751071576e-01   -2.193527573267616e-01   +2.293796568202890e-01   -9.072946259924061e-02; -1.823526732007676e-01   -3.599197340558309e-01   +1.105163506928165e-01   +1.784437482591018e-01   +3.810390039678280e-01   -3.346725610461820e-02   +2.920152572649217e-01   -4.360312612552347e-03; +6.815134080771389e-02   +7.600685055493620e-02   +1.861135884209186e-01   -2.030380096357900e-01   +2.761934445299588e-01   -1.266385191100608e-01   -1.120594452037960e-02   -1.152412831076350e-01; +5.180902870788041e-02   +1.455345564367651e-01   +2.174037850769747e-01   -1.126645782090299e-01   +7.048498970868863e-02   -1.013214835731291e-01   -4.133501291785122e-01   -1.454237840291730e-01; +2.845072570777146e-01   -2.809786479340817e-01   -8.693822656829686e-02   -1.090769071659428e-01   +2.633250964638039e-01   +2.351854500860228e-01   -5.261911493134172e-01   -3.300327148661208e-01; +1.094805090212462e-01   +1.183112802172449e-01   +1.131604138248202e-01   +1.071757098249587e-01   -1.989902056902497e-01   +1.406833127553599e-01   +1.758531433176915e-01   +3.557594859564071e-01; +1.202284138220471e-01   -4.211346353792337e-02   +4.725106460428369e-03   -1.403488279587759e-02   +2.240730813824007e-01   -1.684134223003366e-01   +2.156656846336056e-01   +8.725052643239668e-02; -1.648349322107696e-01   -5.930612746707409e-02   -9.957003952814585e-02   +3.468520123958237e-01   -5.035367534284133e-02   -2.634516280121049e-01   -2.771388291067232e-01   +1.111398093882747e-01];
L2I_L3I_iGABA_netcon = [-2.798192497863831e-01   +1.858959581953319e-01   -2.362464480253512e-02   -6.697470127358540e-02   -2.474273062293153e-01   -5.894770000810343e-02   +2.040787924631666e-01   +8.866630443457293e-02; -2.626178088280974e-01   -3.435236644072347e-01   +2.277080829766517e-02   -1.008323187749100e-01   +1.036212308210505e-01   +2.319308048892648e-03   +1.189003868474483e-01   +1.225754312824451e-01; -2.054223204041464e-01   +1.032729828844054e-01   +1.421792217493585e-01   +2.287116828558940e-01   +8.378911851905417e-02   +2.923290211016653e-01   +8.234113682273202e-02   +1.511127598272194e-01; -3.773582810331414e-01   +6.393836345609419e-02   +1.517982572049528e-01   -7.053010558469394e-03   +7.362463796346053e-02   +3.621973333713212e-02   +4.576990950042149e-01   -3.832199029868592e-02; -2.304632974418621e-01   +1.503938842097710e-01   +2.811524388474737e-01   -1.136578231928868e-01   -2.707592284421462e-02   -2.802207637156111e-01   -2.470682758804851e-01   -3.776358434661044e-02; -2.268593893845921e-02   -7.690860877952081e-02   -1.782150910058736e-01   +5.438695738423579e-02   -1.773396303754051e-01   +2.909103998924302e-01   -2.564776941379135e-01   +1.458687139169146e-01; -1.163152783740248e-01   -1.616013109637797e-01   +2.829612303693164e-01   -9.951161085845324e-03   -3.204604352662934e-01   +1.107031274452802e-01   +1.968880284351809e-01   -1.920303098935955e-01; -1.403422403836059e-01   +1.208826614105900e-02   -1.482985189838885e-01   +7.917309193775279e-02   -3.389585025570969e-01   -7.901493113774756e-02   -4.482206809818378e-01   +3.033596338936497e-01; +3.078714341917430e-01   +1.223243205960005e-01   +2.351856008728837e-01   -2.838594369570556e-01   +1.122454133307380e-01   -3.200376385672396e-02   -1.542652683376945e-01   +2.078556000050072e-02; +1.282173314083441e-01   +2.376043095514647e-01   -3.243701130383704e-01   +1.738853377745218e-01   -7.403802919711117e-02   -6.074735137687497e-02   -3.215141640591233e-01   -2.331443635817455e-01; +5.051168747442064e-02   +2.120648481402243e-02   +5.742307438244023e-01   +3.816275376320561e-01   -1.599898555524207e-01   -2.993248993470796e-01   -1.096214034081345e-01   +1.036993230973089e-01; -1.070235492199355e-01   +3.449464896397891e-01   +3.235940421782976e-01   +2.492296635505370e-02   -1.936657964459046e-01   +2.041402957267047e-02   -3.324563831468673e-01   -6.060122641750990e-02];
L3I_L3E_iAMPA_netcon = [+4.164614336739961e-02   -5.489895549221607e-02   -6.403912902491936e-02   +5.354006953119007e-01   -2.132368401683957e-01   -3.912136331779648e-01   +2.167421965743304e-01   -2.328214775848792e-01   -2.699724720143598e-01   -6.741461651946008e-02   +9.572237217558918e-02   +1.004796609699549e-01; +4.969350717289075e-02   +1.084781990740541e-01   -9.404539539573156e-02   -1.006530317799696e-01   -1.860309721843913e-01   +3.518918089819592e-01   -2.146292728808798e-01   +4.804846046091606e-02   +3.131280596053992e-01   -2.806152844948347e-01   -2.763205421769874e-02   -1.099750590436311e-01; +1.872675083520636e-01   +3.299884160398882e-02   +3.470899180281529e-01   -1.110151927586466e-01   -8.527272939669789e-03   +2.826521416914871e-01   +3.467379355720857e-01   -3.476511445686636e-02   +6.980116964151772e-02   +5.088159651772454e-02   -2.357638169155956e-01   -7.550624248169935e-03; +3.632544999762132e-01   +1.135862553806998e-01   -3.194386647846832e-01   +8.997518232614346e-02   +2.599658354248180e-01   -7.271154846187612e-02   -1.775881398923890e-01   +1.210992914156613e-01   -4.753749430247907e-02   -3.000662381814428e-02   -9.180899595049739e-02   -3.962583931304849e-01; -1.945218833827818e-01   +2.327829471376852e-01   -2.662801808890680e-01   +6.584282627060954e-02   +3.151216306119151e-01   -6.829223035930071e-02   +2.403706369594227e-02   -3.661821772633516e-02   -4.088535836209108e-02   +8.081708446607511e-02   -1.363222409850369e-01   -2.376235554896537e-01; +9.620796786313127e-02   +2.276464213489911e-01   +1.453202371480036e-02   -1.505492055379573e-03   -1.956599409143449e-01   -1.327911509949305e-01   +1.369962895005405e-01   -1.150793436944994e-01   -2.271803726037447e-01   +4.354466867284653e-01   -3.171099509978035e-01   +1.694404387701699e-01; +3.261856424663742e-01   -2.615059374168218e-01   -3.684853972914348e-01   +4.252963632393415e-01   -2.734538609915571e-03   +7.318809910555583e-02   -2.746120407026363e-01   -2.900590358506083e-01   +5.656672608057441e-02   +1.154133098350773e-01   +1.276005189799286e-01   -1.356543858319151e-01; -5.741917003789139e-02   +6.787715009662193e-02   -4.377516653755315e-02   +1.225226942560561e-01   -9.584125958451681e-02   +2.668816744482694e-01   +7.781325093060726e-02   +2.493709614357092e-01   +2.377717187205443e-01   +1.758798003258387e-01   -9.385204568489203e-02   +1.292439202513917e-01; +2.562902410041117e-01   -2.394746766538702e-02   +3.354754562291608e-01   +7.200837492168030e-02   +7.266910772822781e-02   -2.599398029787226e-02   +1.188884506054474e-01   +1.835793421028460e-01   -1.972038043811327e-01   -2.457853121972740e-01   +2.398194420022608e-02   -4.889307558674647e-01; +1.396241797079136e-01   -1.548736201241784e-01   -1.323292401969445e-02   -8.824308661984834e-02   +4.863146135340890e-03   +1.697406796730762e-01   +2.656534281204130e-01   +2.845058421822570e-01   -1.525801546560592e-01   -3.246745136313763e-01   -1.572092036156304e-01   +3.254548530115449e-02; -2.686453253917448e-02   -3.336170124484983e-01   +8.629706161195393e-02   -2.562901728605100e-02   +1.121046038985123e-01   +2.808025408384280e-01   -2.842419450756404e-01   +4.819547968496932e-02   -1.246606637375420e-01   +1.660978537415595e-01   +1.405475380396885e-01   +4.062766270697883e-03; +7.764767851906629e-02   +2.027773937593872e-01   +1.180769519683465e-01   +4.779710589050581e-02   +1.113597659336667e-01   -4.968494096375466e-01   +3.978434995469654e-03   +3.322037326462697e-01   -1.583559918851950e-01   -1.580419341354804e-01   +3.845265002111022e-02   -2.208696894297086e-02];
L3E_L3I_iGABA_netcon = [-9.193202949994705e-04   -2.546077802902855e-01   -9.550085477371330e-03   -1.618942841566860e-02   -9.751077055356772e-03   +2.773941875969076e-02   +3.423122291003219e-01   +5.442707136629178e-02   +2.217653956385926e-01   +1.178113587423074e-01   +2.735407701369951e-01   +5.173011986042780e-02; +2.160897140912708e-01   -3.502026675678992e-01   -1.481631312550677e-01   -2.158912688625828e-01   -6.897574623612664e-02   +1.323793158770400e-01   +1.354611562948937e-01   -2.748483564630365e-02   -4.646335023457417e-02   +1.801493312973435e-01   +8.183712400424725e-02   -4.797755659356871e-02; +1.283484903062946e-01   -1.033341626078724e-02   -1.532277914091016e-01   +1.022435089856271e-01   +4.034478219936977e-02   -4.409292980068892e-01   -1.112662168062370e-01   +3.836732456681577e-01   +6.839664624100622e-02   -1.324725945268596e-01   -2.185048167210168e-01   -5.433336834616855e-01; +1.839582671519472e-01   -2.703591261067088e-01   -9.520978451364841e-02   +3.410758208349478e-02   -1.894780154000688e-01   -7.113820769144744e-02   +2.011325126641159e-02   -1.814186805860895e-01   +4.549456602741422e-02   +1.521080527631918e-02   +7.603069070133464e-02   +1.538217716767781e-01; +5.181113639711646e-02   +2.129452881030786e-01   -3.162882343317661e-01   -3.136413027692101e-02   -4.711436174661319e-01   +2.546283005784845e-01   +1.374831326819602e-01   -6.269652371411270e-03   +2.420918480458085e-01   -4.425355650263876e-01   +1.717371031433842e-01   -1.948635765213605e-01; +2.723427936437519e-02   +2.140096442808422e-01   +2.884851405064978e-02   +2.861402259201368e-01   +2.440907042923663e-01   -6.227953053853910e-02   -5.557918827054624e-02   +4.692367976296546e-04   -1.718169880347189e-01   -1.348887280632448e-01   +4.700929731479737e-02   +2.536073732737221e-01; -2.479301011296957e-01   -2.382763501766713e-01   -8.465895960934543e-02   -2.703500851982962e-01   +5.269179106607472e-02   +3.095484854149562e-02   +1.258658625957735e-01   -2.399492704375480e-01   -2.917421622970651e-01   +5.767201164380440e-01   -2.132014189779882e-02   -1.117451932335968e-02; -1.730033709502877e-01   +1.360978249700417e-01   -6.232965004463137e-02   +4.600499682156437e-02   -2.372133808574175e-01   -1.479204845922775e-02   -6.130266187082152e-02   +6.235284958156462e-02   +1.552419771495483e-01   -3.213324727462919e-01   -1.379079848254010e-01   -1.058138536451146e-01; -8.254202878757814e-02   -3.836734436185913e-01   -1.681864927705638e-01   +7.729129095509286e-02   +8.680125666909316e-02   -2.859870996129754e-01   +7.249497241948821e-02   +2.515538112607412e-01   -4.923801045994455e-02   -8.287506910850340e-02   +3.686009745311148e-01   -1.801664779517611e-01; -2.627004727986404e-01   +1.578283598569326e-01   +3.341172508985967e-01   +7.071637199568924e-02   -2.455067913913464e-02   -3.088869465993187e-01   -1.735105180921638e-01   -1.081043359396936e-01   +1.686186396749467e-01   +9.137238390248950e-02   +3.716077346420916e-01   +9.723141223969334e-02; -4.007940890461300e-02   -2.902573195694018e-01   +2.213770711456321e-01   -1.534690919277499e-01   -1.373719977355662e-01   +2.122896977739326e-02   +2.194157814156619e-01   -3.994007674279928e-02   +1.415008407373521e-01   -6.975875458631417e-02   +1.018041437460003e-01   +1.190978313740487e-01; +1.452329395348681e-01   +8.982302234760461e-02   -3.234841623356240e-01   +1.661356988161427e-01   -1.364502288317406e-01   +3.745640805788202e-02   +4.999125651517617e-02   -1.580124634071541e-01   +1.439948105610571e-01   +2.672778364685539e-01   +4.059100063381808e-01   +1.827764394196605e-01];
L2E_Input1_iAMPA_netcon = [-1.703567820880877e-02   -4.431300527818468e-01   -1.972137302443815e-01   +3.107562082636623e-01   +9.106235283416804e-02   -3.231826490005780e-01   +6.691824957349796e-02   +3.661195883564060e-01];
L2I_Input2_iAMPA_netcon = [-2.949797081814096e-01   -1.465040491459455e-01   +1.597564777025363e-01   +1.377974979019813e-01   +1.443576013837718e-01   +3.422516034793863e-01   -1.273926792415576e-01   +2.147758254580200e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
