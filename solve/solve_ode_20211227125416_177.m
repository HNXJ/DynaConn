function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+9.233330250467267e-02   -2.955500513516463e-02   +1.289174629846988e-01   +3.099124680398532e-02   -5.810979212738111e-02   -1.024767346140658e-01   +2.310550294020811e-01   +3.818546112062106e-02   -4.257524939135414e-02   +7.032197895975421e-02   +1.392570837111570e-01   +5.855556689285207e-02   -1.307483805538707e-03   -2.636541463383141e-01   +1.526479958816287e-01   -2.610001673516913e-01; +3.579207167366865e-02   +1.193631166543887e-01   -3.502080543644707e-02   +2.446166072609436e-01   -2.001247769605497e-01   -2.683272318648854e-01   -1.506402843897521e-01   +6.602783267389861e-02   -2.575590951616132e-01   -1.069033258151534e-01   -6.451135060344006e-02   -1.572007191950256e-01   -1.471058463640329e-01   -7.151342242420415e-02   -5.224714948041367e-02   +1.204064589609285e-01; +1.244283459011406e-01   -1.826309842280673e-01   +7.976879646838220e-02   +2.199618191974046e-01   -3.612032256899170e-01   -1.362273279203529e-02   +5.698637646723372e-02   -1.375601265237558e-01   -2.992708721055227e-01   -1.265736532317621e-01   +2.748361471135504e-01   -2.410999022738585e-02   +9.906954833144324e-02   -1.266223913707843e-01   +2.579405547296896e-01   -6.691148116302205e-02; +3.245545351439564e-01   -2.014385245918780e-01   -2.137632372563232e-01   -6.936746059240724e-02   -5.381538152042883e-02   -5.015770068017712e-01   +5.197399527375973e-02   +2.326827807379614e-02   -8.477740432565958e-02   +1.073848590270667e-01   +2.423699593809809e-01   +8.456511101901321e-02   +3.405247400631837e-01   +2.364307245218213e-01   +1.840213571340634e-01   +1.293606516979140e-01; -6.362106943922832e-02   -2.321587404047820e-01   -5.440245650978741e-02   -2.010739592292712e-01   +7.406370873857575e-02   +8.965495143176889e-03   -2.650405686100260e-02   -1.517587157740078e-02   +2.369719993198987e-01   +2.175029967377905e-01   +6.952814348955033e-02   +2.327442456577550e-02   -1.744063045990304e-01   +3.114396289011530e-02   +9.102363395558646e-02   -9.927333340236164e-02; -5.240245962755726e-02   +2.375886339583434e-01   -7.363137008227809e-02   -1.490873356297324e-01   +6.261228359217143e-03   -4.687688863498173e-02   -3.565738625594446e-01   -7.059499214490864e-02   +2.372531217888962e-01   -1.176455691381114e-01   -2.125951802110600e-01   -3.142335399110417e-01   +1.386710331891772e-01   +8.923917360909388e-02   -3.754472555431197e-01   +2.418471626515176e-01; +3.670175548375203e-02   +1.833748442034616e-01   -7.669570002747524e-02   -6.556998548384639e-04   -2.298248300023512e-01   -2.922429385419222e-01   -2.061865910074990e-01   +8.516467667949676e-02   -9.752111748262568e-02   +8.916220879566124e-02   -5.613522040812263e-02   -1.088808726887546e-01   -7.985377659894462e-02   -2.068867286626198e-02   +8.293859645021548e-02   +4.174237202558429e-02; -1.553206000571261e-01   -1.098357777035889e-01   +3.418109844555514e-01   +2.212323845898716e-01   +2.126340802621904e-01   -1.556023198478903e-01   +3.730341462992144e-01   +5.584695839143807e-02   +1.882526782724979e-01   +1.042072763240680e-01   +1.635800816710912e-01   -5.155088885702080e-02   -2.325365477509044e-02   +2.251225798204481e-01   -7.904093098543888e-02   +7.249129159306747e-03; -2.670476139411021e-01   -1.628646790801953e-01   +3.134309899228365e-01   -7.367035532746172e-02   -2.027435316372491e-01   +1.327706005071232e-01   +1.323365026778910e-01   -3.480532239084206e-02   -5.105724380757042e-02   -1.177832661281669e-01   +1.505385270932421e-01   +1.179308059347610e-01   +1.465865234021119e-01   +2.674578133747744e-01   -1.121937258139915e-01   +1.080258830317204e-01; -1.147453648600661e-01   +5.672477639500297e-02   +1.284781287290047e-01   +1.019475067628311e-01   +1.283250233887458e-01   -3.103279429348606e-02   -1.449572492769087e-01   -1.601421666637017e-01   +1.840134606175589e-01   +1.181595656150138e-01   +1.094906788159151e-01   +7.724839097525799e-02   +2.199480880900084e-02   +2.713754499940106e-01   -1.283719728955100e-01   -1.663359771948011e-01; +2.168872920536871e-01   -3.484752919701303e-02   -1.050301778780103e-01   +6.483468207954649e-02   -4.619471418283112e-02   +1.641784336322808e-01   +1.747241142352285e-03   -1.395700034946390e-01   +1.267132238912110e-01   -2.007093711766267e-01   +9.710742017718225e-02   -7.076989137223613e-02   -1.352656071485165e-01   +6.396404572972414e-02   -1.873772759229394e-02   +1.803493632961923e-01; -2.575173309451864e-01   -9.482883633061484e-02   -2.256015781166535e-01   +2.204022281900089e-02   -3.594345920612040e-02   +1.702214242171368e-01   +3.407753262575438e-01   +2.655025122635179e-01   +1.977807814991836e-02   -1.543133174704288e-02   +5.787603245238380e-02   -7.114428178105756e-02   +1.115915392771470e-02   +5.747522240601553e-02   +3.148694139185575e-02   +8.563875694804539e-03; -3.348281019882093e-01   +1.339750822845154e-01   -1.004778456936670e-01   -9.123291153410433e-02   +1.952196948738294e-01   -2.023112175709963e-01   +2.437692281943247e-01   -3.440822814196665e-01   -1.439232684218752e-01   -2.836265905440229e-01   +1.223548331670559e-01   -2.092232934922588e-01   +2.340772681024917e-02   +1.519243532864322e-01   -3.934177459456449e-02   +5.773545754357110e-02; +3.989391903431829e-02   -9.812205811651875e-02   -6.684105800248749e-02   -6.115988021714691e-02   +2.874547948860721e-02   +2.985471289753938e-02   +4.276854920683686e-02   +2.783038364335733e-02   +1.196512040106736e-02   -7.858918154431359e-02   -4.083280712561031e-02   -6.772795020482902e-02   -1.767923451833680e-01   +2.567790293896494e-01   +1.806168557651370e-01   -8.352995549666178e-02; +3.425556074096446e-02   -2.225237085358512e-01   -1.285507847364566e-02   +2.365633723337979e-03   +1.197595568555851e-01   -1.263340088863696e-01   +2.524952366855147e-01   -6.648667002325473e-02   +2.505533102904587e-02   -1.732460987473582e-01   +8.262415947768373e-04   +4.050410992908968e-04   +2.076679403932968e-01   -2.329321096892149e-01   -3.436885503717520e-01   -3.520588952047432e-01; -1.700961704948850e-01   +4.891942816204230e-02   -7.242987179410555e-02   -2.553286213664463e-01   -1.369104208674425e-01   -2.195200237399873e-01   -1.156155133426739e-01   -2.129486209529094e-01   -4.210517192655404e-02   -3.487958943160851e-01   -3.104928899424739e-01   +2.518706076234009e-01   -7.638653779611523e-02   -1.071630323215429e-01   +1.502017583382191e-01   +2.187480663020128e-01];
L1E_L1I_iGABA_netcon = [+6.354510683971529e-02   +5.821459458664402e-02   +9.330792041040158e-02   +3.018490202121849e-01   -9.126036500651524e-03   -3.812244758246461e-01   -2.903400444321473e-01   +1.154833034544288e-01   +1.959046413500893e-02   -1.579926561606422e-01   -1.793581823421824e-01   +6.642641298616631e-02   -2.216874884665226e-01   -2.394244635645878e-02   -7.823689662617966e-02   -1.377461560455393e-02; -4.769397824627273e-02   -2.185064291256728e-05   +3.133357109908761e-01   +1.573653425041473e-01   +1.682008435843955e-01   -5.850631657673139e-02   -1.131937290815016e-01   +1.798321036299796e-01   -6.398053056988862e-02   +2.287629983671578e-01   +3.176334503365282e-02   +3.276973334374406e-01   +3.566216466736695e-01   -1.271000738563878e-04   -1.516490028742835e-01   +1.545740641574491e-01; +8.927688342812515e-02   +2.028522787510990e-01   -2.513791459490522e-01   +1.335535620639288e-01   -2.271392862608325e-01   +1.172482536818391e-01   +1.188105204260883e-01   +9.992395608539842e-02   +9.819180541754242e-02   +2.674099909375628e-01   +2.735455215139999e-01   -2.650151113476676e-01   -1.582657355955099e-02   -9.334214501478558e-02   -3.931906478265507e-02   +5.124598782065585e-03; -2.951490226820709e-01   -1.877957021614991e-01   -8.648673078875305e-02   +1.983589832857959e-01   -4.195586146203096e-02   -1.004763266011969e-02   -2.324074532777227e-03   +2.027481637973432e-01   +5.834860153027651e-02   -1.056333601345092e-01   +1.208357816793566e-01   +1.536160303590504e-01   -1.524258171833741e-01   -2.496611412331770e-01   -5.860681638248379e-02   -1.558955591668257e-01; -2.405161747476321e-01   -9.155532054929014e-02   -1.134802243618884e-01   -1.523162530516627e-01   -2.283970149486954e-01   -9.541894715687667e-02   +2.680250045795339e-01   +3.272444103838802e-01   +2.181004147386128e-01   +3.938986086345570e-01   -3.356220311782306e-01   -2.393874362104704e-01   +2.854898743725146e-01   +2.354900902870717e-01   +3.885944392180895e-01   +3.010715872067882e-01; -1.981826499966606e-02   +2.054696451709563e-02   +2.611103008790996e-01   +2.978928578132555e-02   -1.004172999660675e-01   +7.315990848097235e-02   +2.080204753041548e-02   +1.340773559247949e-01   +1.344074556940049e-01   -1.702077865086085e-01   -2.870017560460906e-01   -1.270178914485390e-01   -1.476287875090618e-01   -3.339105617370833e-01   -7.046283786881980e-03   +2.132385566066811e-01; -6.092711255822214e-02   +1.170259811409811e-01   -2.682164004144116e-01   +2.737277556433007e-01   -3.955234211135893e-02   +1.640403538560630e-01   -2.223325497892813e-01   +1.348028381998807e-01   +6.412931639979014e-02   +1.360967337366512e-01   -4.714225080549965e-03   +1.824138939865416e-01   -3.615188213851402e-02   +2.981780127708650e-01   -1.559120584167649e-01   +1.463291484412670e-01; +2.852454903409614e-01   +4.193319110271577e-02   -3.079357319360549e-02   +6.085693074737800e-02   +2.558416429657133e-02   -1.273400957611333e-01   +1.111928941844354e-01   +3.141553603210625e-02   -1.587098933045243e-02   -1.961789437504351e-01   -1.001678002417871e-02   +5.345179968905155e-02   -1.768575349934791e-01   +1.918129211467269e-01   +4.219887796713794e-02   +3.711308109700358e-02; -9.011668953617255e-03   -2.604810899190667e-02   -1.255388759813080e-01   +4.879350700836148e-02   +1.524223456941733e-01   +4.822471681798449e-02   +2.128895553934188e-01   +2.074164831915884e-01   -2.747615669789209e-01   -1.112533322656465e-01   -9.629806333862242e-02   +2.335329614322528e-01   -8.835310321529484e-02   +8.332673405610963e-02   +5.248695677327173e-02   +1.638766412200767e-01; -4.985947448789099e-02   -1.014403340682341e-01   -1.197532533169113e-01   +3.268293818634754e-01   -4.450645283461147e-02   +1.506612444872905e-01   +1.009687899358417e-01   -5.358677644098815e-02   +9.384002971657876e-02   -4.646102055437175e-03   -2.656726289152833e-01   -1.338421871732657e-01   +5.650853826895459e-02   +2.511945151941531e-01   -7.521692220132462e-02   +4.534937091119490e-02; -2.179310077139016e-01   -2.542138240234889e-01   +4.356070048095209e-02   -2.332307404447407e-01   -3.822234950016829e-01   -3.013595911956043e-01   -6.434881499977352e-02   -1.581359682640374e-02   +2.394480724760183e-01   -9.653034252664455e-02   +1.022265217509174e-01   -2.287708814957999e-02   -9.552407468437449e-02   +1.778842853738278e-02   +2.371563176601944e-02   +2.748274402893195e-01; +8.659947538400095e-02   +1.486481547416390e-02   -4.290233915512284e-02   +1.521583956360544e-01   -4.674358536705007e-02   +1.513702755271559e-01   -1.095759856362506e-01   -2.445852283099521e-01   +2.993919454908794e-02   -1.671683659895250e-01   -1.208032027024569e-01   -2.552191925800578e-01   -1.334228526373048e-01   +1.197739071768800e-02   -1.614985086988749e-01   -1.982797711443875e-03; -2.106454563029481e-01   +1.792998190616070e-02   -3.118351486910472e-02   +1.924299684120650e-01   +3.123752768477755e-02   +2.338820766667267e-01   -4.529887134270050e-02   -4.683438823137327e-03   -3.903783287004183e-01   -1.670261818824463e-01   -2.716638420876908e-03   -1.523723131987030e-01   -4.849963187724314e-03   -1.447168570703801e-01   -1.698518764331764e-01   +1.290965364848797e-01; +7.287405124706617e-02   -1.578198935819682e-01   -1.310410599294237e-01   -1.104974502483156e-02   -1.283945750386495e-01   -1.376387691777960e-01   +2.386878613424077e-02   -1.536876769713492e-01   +2.658301264541040e-01   -1.067454956074216e-01   -1.166545509715455e-02   +8.264866833501855e-02   -2.735507066119185e-01   +1.252015234072082e-01   +1.024957973811059e-01   -9.822195675382146e-02; +4.841204057232093e-02   -1.521600257653533e-01   +2.274633793912645e-01   +9.084605782106465e-02   -5.767777123217285e-03   +4.217323492279267e-02   +7.972985380801928e-02   -2.152511669146837e-01   +1.796332021585201e-01   -4.805263605021876e-02   -2.693058948030319e-01   -4.319396601009741e-02   +2.921649667974529e-01   -2.291966515019838e-01   -1.852738640959743e-01   +8.932497155109750e-02; +1.368674719518650e-01   +1.142823921472270e-01   +1.796068011453724e-01   -5.992536018971158e-02   -4.220891549917781e-02   -2.351279434343038e-01   +1.510053722029700e-02   -2.638288373620291e-01   -1.541256807532107e-02   -7.387568735359352e-02   +8.190623883348395e-03   +2.047412180566501e-02   +2.338807262518597e-01   +2.015256122598663e-02   +3.524725963071789e-02   -8.757621481209078e-02];
L2I_L1I_iGABA_netcon = [-1.986666262233595e-01   -5.159023024121679e-02   -1.883177076308455e-01   -1.160931267163187e-01   -2.050558859509372e-01   -1.590971170742812e-01   +1.308171528164652e-01   -2.718202371486544e-01; +1.368493386024102e-01   -1.493868109552918e-01   -4.339894409841637e-02   -2.662557203272406e-01   -8.715476631450450e-02   +4.808283727811255e-02   +3.683691866995445e-02   -8.610040014098613e-02; +6.815350289515436e-02   -6.692817057991401e-02   -1.196458293658726e-01   -1.274508776317748e-01   +2.190396930116185e-01   -4.957192529765513e-02   -2.961357000765600e-01   -4.123861975870549e-02; -1.222961837838376e-01   +2.310098311907328e-03   -2.913461236031645e-01   +9.895071762743296e-02   +1.490762935005442e-01   +2.655038418295114e-02   +3.223237025356920e-01   +4.219591717078174e-02; +7.314327491670904e-03   +4.982935944588486e-02   -2.127516889444453e-01   +1.283016969575494e-01   -2.102204662089575e-01   +2.747864590501139e-01   -2.522622228425273e-01   +3.218185245166665e-01; +8.024619407158172e-02   -9.936319723415901e-02   +2.694561490442633e-01   -4.318902664974695e-02   +7.196057712084696e-02   +2.757493528510043e-01   -1.095897798448779e-01   -8.102002747156650e-02; -2.503704045980475e-02   +1.721942406900200e-01   -6.768359097449395e-02   +1.543039808552620e-02   +2.347329247447521e-01   +1.539383526034070e-02   +2.099453076045203e-01   -6.553247471827046e-02; +5.114884002654989e-02   -1.055023435276803e-01   +4.888620271752007e-02   -2.047916325004292e-01   +1.391173204971836e-01   -3.413919270704282e-01   -3.452289029332867e-02   -6.299249167705442e-02; -1.414830415838039e-01   -3.583461763804822e-01   +2.110512715072456e-01   -4.416478571936459e-02   +8.924680723925472e-03   +8.188184303949807e-02   +2.332517519003902e-01   +1.460178891018182e-01; -4.575106486430066e-02   +1.769581943694052e-01   +1.345531634172890e-01   -4.596680661921101e-01   +1.256338471979617e-01   +2.428582500230177e-01   +2.617541256357338e-02   +6.956351509957122e-02; -1.245388150223775e-01   +2.158667870930545e-02   -4.848385762826220e-02   +3.899518848313984e-01   -2.773226373463016e-01   -1.088239947550983e-01   +7.531796622643389e-02   +9.775476181676783e-02; +3.056770119778029e-01   +1.731851603308366e-01   -1.428655979616444e-01   -9.756978502163753e-02   -1.005199953908707e-01   +4.075186450449804e-02   +4.627707931686658e-02   +3.046896564247636e-02; -2.451950266967479e-01   +6.777338169879538e-02   -1.725988649259168e-02   -2.042887517488418e-02   -2.580101304684235e-02   +1.773329058655298e-01   -2.171140884994132e-01   +2.915226387189936e-02; +4.326451017427443e-02   +8.004334087033185e-02   +1.021072426116213e-01   -1.230730799207718e-01   -3.454990851263546e-02   +3.091644832157469e-01   -2.011719420058013e-01   +2.785254902616222e-01; -7.271761525807507e-02   -1.459303592431374e-01   +2.021138579574434e-01   -1.356365707139985e-01   +4.552070805602293e-02   +1.412406073895365e-01   -2.449707722418907e-01   +6.510433309414507e-02; +3.060580679704353e-02   +2.573221826169373e-01   +1.854182710224756e-01   -3.617050499501932e-02   +1.426755563680743e-01   -1.116011083036186e-01   -7.281345828805182e-03   +1.757746829443550e-01];
L1I_L2I_iGABA_netcon = [+4.592796556711968e-03   -1.209730142369547e-01   -4.097304109896548e-02   -2.821951877370311e-01   -1.329316013188129e-01   -1.123382231675051e-01   +6.509530241920405e-02   +2.614699399740876e-01   -1.376052338116894e-02   +7.497110460278089e-02   +7.864748723479342e-02   +3.863050040813924e-01   -2.773966281006780e-02   +2.566373760046563e-01   -4.036331921580968e-02   -2.648292328248339e-01; +2.515922897570405e-02   -1.298087533253693e-01   -2.476669868928300e-01   +2.256687609970180e-02   -1.186249887833844e-01   -5.763681791385279e-02   +2.349321226442659e-01   +2.614341903341977e-01   -2.165654472050977e-01   -1.259449156917104e-01   -2.317242291382049e-01   -2.555770069954193e-02   +1.828436370172767e-01   -1.902984083691349e-01   +7.269942931395648e-02   +2.176450715602692e-01; +3.825008117555657e-02   -3.088933540200360e-01   +2.396684521746708e-01   +1.555987977076455e-01   +3.240208718798434e-01   +2.946043444144227e-01   +2.602919172360378e-01   -1.155951841398146e-01   +1.752437975904325e-01   +1.256270268574829e-01   -3.793965592667316e-02   -1.403157609607061e-01   +9.374042038439900e-02   +7.471740597241730e-02   -1.489266767864383e-01   +3.691464549322500e-02; -1.644146403913092e-01   -1.668982754950479e-01   +1.767430650150607e-01   -1.248951232442490e-01   -1.128227131690339e-01   -2.377063649653486e-01   -2.975920763629329e-01   +1.198326234057772e-01   +2.707567928266301e-01   -1.904425265020970e-01   +1.021716170455410e-02   +3.089013346680732e-01   -2.984567755368997e-01   +5.922113338155248e-02   +1.122728809723693e-01   -3.485662609060236e-01; +2.421951609530425e-01   -9.391918921000211e-02   +3.718145235297593e-01   -1.148493748547569e-01   +1.094525987566009e-01   -6.205943838360438e-02   +8.647516520390430e-03   +5.520133405095710e-02   -6.097237393438348e-02   +9.103249862277982e-03   -2.177335775529949e-01   +2.645759888562614e-01   +1.122990997647471e-01   +2.718529034831450e-02   +4.912998891395204e-02   -2.372920249620614e-01; -8.971965837819328e-02   +2.274532729736255e-02   +1.007963730309619e-01   +3.802827835710608e-02   -3.434809699897510e-02   -1.373402481711210e-01   +2.283084037285131e-02   +2.443011135304065e-01   -9.697471720384505e-03   -6.504229730634384e-02   -1.091557859438366e-01   +6.934161311810400e-02   +6.407818700168860e-02   -1.929388624705564e-02   -8.945147753920082e-02   -1.551159803667979e-01; -1.936433288517498e-02   +1.425040832323254e-01   +1.187639100015254e-01   +2.399702015745992e-01   +3.516316411259232e-02   +2.408005687741326e-01   +9.911401064219102e-02   +2.391799493139386e-01   -1.544447358989107e-03   -2.470203577918452e-01   -1.996908683121379e-01   +1.220441262151830e-01   +1.969136269377132e-01   -8.763195166155895e-02   +8.688777454493966e-02   -2.994718281209630e-02; +5.795043289897073e-02   -2.662711855116321e-01   +1.251659505410545e-01   +3.239475978375596e-01   +3.482464393241583e-02   +3.573626428939223e-01   +1.638369179067381e-01   -1.017579413903051e-01   -5.606723746593192e-02   +4.375352410033433e-02   +1.558504862105101e-01   +2.780859262142745e-02   +1.563019309772749e-01   -1.762580093836562e-01   +1.351041830971816e-01   -3.106416218525092e-03];
L2E_L1E_iAMPA_netcon = [+7.364795753812046e-03   -1.075908924071776e-01   +2.080024943148696e-01   +2.399979783719602e-01   +1.687467692819384e-01   -2.690524906965295e-01   -1.592592852505055e-01   +6.217833942063042e-02; +6.947650156222797e-02   -8.674437534121465e-02   -1.277304321403813e-01   +4.687196416495317e-02   -9.143146188462167e-03   -2.078056588494301e-01   +2.708540574303193e-01   +5.968458461627377e-02; +1.307363658240947e-01   +2.105703445602533e-01   -2.274489850495146e-01   +2.756642597461056e-02   +5.471457323838387e-02   +1.377469127891448e-01   +1.197978806975209e-01   +1.508610394887022e-02; -8.155369624289963e-03   +2.185740468321644e-01   -2.134111245317835e-01   -4.518021071053147e-02   -2.299804350295326e-01   -1.078223648565280e-01   -2.437659522522576e-02   -1.016278232917045e-01; -1.927012488453786e-02   +2.643461438951470e-01   -1.669411395609040e-01   +5.328922700084068e-02   +1.634714070712303e-01   -1.717263218017449e-01   +6.084617570508637e-02   +1.182525580161867e-01; +4.517568176290291e-03   -2.689072927230080e-01   -3.862191244984720e-02   -4.155397529989218e-01   -1.035351977247018e-02   +1.348092303750133e-01   -3.543213333098805e-02   +7.063946435746149e-03; +2.164314487692342e-01   -2.396089683114807e-01   -1.572197610273356e-01   -6.915988638753780e-02   +8.856746399841731e-02   +2.014314143626181e-01   -3.254641411470443e-01   +2.063888556756031e-01; +8.252859519984182e-02   +1.625239495040063e-01   -1.718985073942615e-01   -1.585719431082291e-01   +4.928478112895127e-02   -1.432642619928562e-01   +2.993844208914014e-02   -9.324652401202929e-02; -2.871240094080755e-01   -3.373468733275693e-01   +5.937449572750801e-02   -2.033548314573033e-01   +1.149142242132608e-01   +3.612193667855991e-01   +2.162430516715013e-02   -1.603341868790739e-01; +1.156251660058962e-01   -1.847936313420387e-01   -1.702136847649715e-01   -1.263052188512451e-01   +2.973558051754787e-01   +1.218902382782706e-01   +1.447518401222450e-01   +6.187864056319708e-02; +3.288351432584546e-01   +1.285521338123339e-01   -2.449869942280204e-01   +1.201960021713867e-01   -7.871684393008390e-03   +1.970754424732325e-01   +8.690191082206769e-02   +1.492462110706034e-02; +1.050824679339012e-01   -2.258361947004732e-01   +1.573564060723039e-01   -6.593963269335271e-02   -1.531781253584015e-01   +5.694362886521398e-02   -2.099478093704778e-01   -1.953090139029695e-01; +1.700947927957294e-01   +1.295980747708768e-01   -1.402912334331041e-02   -1.375499039421827e-01   +7.588956723492767e-03   +1.024753375470971e-01   -1.230551278934487e-01   +5.779360548355739e-02; -1.127462104202540e-01   -8.184420498135653e-02   -1.040260698559983e-02   -2.083429298521375e-01   +1.871314824299471e-01   -2.624765530993276e-01   +1.571984299169447e-01   -1.810002196251084e-01; -4.018575693641897e-02   -9.191144391300060e-02   -1.331753246237845e-01   +5.181358630657720e-02   -2.049304100837201e-02   +1.045259391812555e-01   -1.950721969506735e-01   -2.075633467208416e-02; +2.227412453122942e-02   +6.149227765426261e-02   -2.167184707397943e-01   +1.024110600988877e-01   +1.704204475676852e-01   +2.131832664333360e-01   +1.779075102901070e-01   +6.851465985104860e-02];
L1E_L2E_iAMPA_netcon = [+1.094826560429316e-01   +1.205403320331557e-01   +8.302886587913157e-02   +3.381430282482954e-02   +9.441325195003911e-02   +1.307154221287241e-01   -3.066758689298661e-01   +5.970491251137232e-03   +3.152379064243240e-01   -4.080511570770851e-02   +1.651768660288246e-01   -2.152427410410645e-03   -1.545423147895540e-01   +2.306201607674181e-02   +6.575227851931412e-02   -2.424616468706547e-01; -8.599520021267658e-02   +6.122415146529671e-02   -1.702882034475868e-01   -1.088029362914001e-01   +1.962849300607626e-01   -2.470381292510599e-01   +1.287556118994519e-01   -1.263687664255376e-01   +8.235663808563734e-03   -1.448133087573008e-01   -1.332842309365718e-01   -1.350572217390404e-01   +4.211199278305750e-02   +1.945702888471524e-01   -1.194993498226049e-01   -2.179550905526194e-01; +3.620927379428711e-02   -1.635328634034427e-01   +7.890353604169131e-02   +1.987282394634151e-01   -1.054946799476788e-02   +1.743063178211798e-01   -1.165482494630333e-01   -4.335106086156770e-02   -4.720277895386922e-02   -1.069652368348400e-01   +3.350154946547225e-01   -4.326118389044359e-02   -2.290074671692879e-01   +2.092782178364191e-01   -9.247597573100402e-02   +1.732164811627921e-01; +9.508963623233840e-02   +8.550994801850190e-03   -4.100347369458592e-02   +5.922089295493316e-02   +1.004688401354232e-01   -1.308519353059511e-02   +2.812003642678220e-01   -3.673259535399369e-01   +7.853694071171517e-02   -1.291735962688285e-01   -5.581399140210335e-02   +1.673944530853489e-01   +1.453119485869848e-01   -3.675706286541816e-02   -1.428956063575315e-01   -5.057192300428243e-02; +3.699226416535373e-01   -9.023536070242691e-02   -7.184094224513646e-03   +9.076733719695432e-02   -3.650289646219859e-02   +1.958751333529576e-01   +1.103066203509027e-01   +1.937215363361830e-01   -7.119789996515458e-02   -3.527821902209125e-01   +2.701766261672461e-01   +4.913619007642660e-02   -1.923359513818023e-01   +1.383760371948774e-01   +1.379988690403593e-01   -8.045909276773013e-04; +2.070467652691429e-01   +4.060011053725861e-02   +2.790676796492567e-01   +1.373371053434728e-01   -1.801444832344003e-01   +7.284938479637842e-02   +1.251687868789356e-01   +6.454104677117337e-02   -2.303101380426059e-01   -5.913478609315054e-02   -2.371518149829450e-01   +1.914604634696520e-02   -1.484831065075309e-01   +7.644237273534886e-02   +1.432729636885356e-02   +2.792437254249007e-01; -1.423017551429658e-01   -3.863529689084422e-02   +2.423149681479741e-01   +5.425623187540869e-02   -8.762952537756458e-02   +2.658983836557164e-01   +6.870880234631588e-02   -1.702024133262696e-01   -1.215184004025345e-01   -3.174031345603818e-01   +1.148375928303509e-01   +1.888051644432718e-01   -8.198337502490528e-02   +3.068553944765302e-01   -2.097979868281309e-01   +2.912052342155843e-02; -2.357094744783203e-02   -1.497213335934685e-01   +1.473015770394875e-01   -5.121759682643201e-02   +1.203661003518928e-01   -1.098202449513756e-01   -5.902571761654279e-02   -1.321851837963130e-01   -2.445588830704714e-02   +2.074254883940575e-02   +5.582091571404979e-02   +9.823447039142791e-02   -2.459928289632734e-02   -2.806672656975621e-01   +1.204180082573772e-01   +2.552312486194106e-01];
L2I_L2E_iAMPA_netcon = [+2.355385912033356e-01   -8.476257535969969e-02   +2.159553182836774e-01   -1.865164025492702e-01   +8.165509312639520e-03   -1.977827771051133e-01   -1.704935881821479e-02   +4.147271834770411e-02; -9.407454016396180e-02   -4.147683961158252e-02   -2.560448760940748e-01   +1.956634398393372e-01   -7.358797569556003e-02   -3.185698983241027e-02   -1.072491644677615e-01   +1.909765282993868e-02; -3.263818658981427e-01   +1.267144463315187e-01   +3.345226505414527e-02   -3.245535448298652e-03   -1.971211588254560e-01   +1.214081457603133e-01   +4.466418778468270e-02   -3.126404730619852e-01; +6.744646654179694e-02   -2.170006786340979e-01   -1.738367130403582e-02   -4.535206766275362e-02   -1.130085692672468e-01   +2.059064739525011e-01   +1.428621530590401e-01   -1.481065804326322e-01; -1.242393963158990e-01   +3.339966873781754e-02   -1.131123838062291e-01   +1.346536050977856e-01   +1.027909753647912e-02   +1.169059784744395e-01   +3.470136469910284e-01   +2.629304808485134e-02; -1.426774711615023e-01   -8.039905947570390e-03   -5.671268454545511e-02   +7.386753933713394e-02   +8.564615994646753e-02   -1.092304170326357e-01   -1.411411090837593e-01   -4.661677528044744e-02; +8.684427339794520e-02   -1.621063599362404e-01   +7.827724262809611e-02   +2.099100232627069e-01   +2.250230665716026e-01   -6.966972344818761e-02   +1.204652833705653e-01   +1.967992705957608e-02; -1.535976204226455e-01   +4.686950790119226e-02   +1.487182264933885e-01   -2.627475690352307e-01   +1.418190390288342e-01   +1.549782916865544e-01   -3.955725478959206e-02   +1.871209671688497e-01];
L2E_L2I_iGABA_netcon = [-1.670249330875069e-01   -6.240371074130878e-02   +1.438643348032716e-01   +1.020793632885980e-01   -1.189087468294311e-01   +1.197990459739680e-03   +2.373109343925688e-01   -2.840105730573986e-02; -1.294753758569530e-01   -2.250323643834757e-01   +1.203634681913114e-01   -1.168172212926294e-01   +1.227896060016515e-01   -1.490637937277960e-01   +2.189797311313356e-01   +3.030894000668075e-01; -2.527388000773536e-01   +1.624506993563287e-01   +2.459831670483545e-01   -2.070456222484837e-01   -1.358993155026944e-01   +1.035359901349471e-01   +3.738921897002715e-02   -1.052666544517333e-01; +2.890044588378438e-01   -7.076086837058250e-02   +2.359617837594519e-01   -1.177628286098092e-01   +1.661587554586779e-01   -1.194107386656676e-01   +8.336661762862271e-02   +6.231112781328763e-03; -8.852072949408599e-02   -1.705465505756432e-01   -1.008275604270074e-01   +1.831914270709156e-01   +2.109136294624357e-01   -3.494716471852646e-02   +1.399030710427441e-01   +1.817969578129290e-01; -6.987440413929591e-02   -1.821510687925136e-01   +6.236722186829300e-02   +9.178215320541189e-02   -1.947450639719438e-01   -2.342112461367273e-02   -5.358861224989916e-02   +2.063795983822731e-01; +1.321750422064925e-01   -1.138676755192141e-01   +1.938969534834558e-01   +9.929470617717423e-02   +1.647386506109014e-02   +9.702325640176791e-02   +1.708514288448296e-01   +1.046584645862782e-01; -3.214615216212597e-01   +2.709278178277500e-01   +1.824317304437484e-01   -1.332645198044783e-01   +3.884934749876671e-02   -1.753303336359869e-01   -2.277541979396920e-01   +2.703154851502991e-02];
L3E_L2E_iAMPA_netcon = [-1.805886811500045e-01   +4.451331986160351e-03   +1.853696408402312e-01   -3.568534924780035e-01   +8.747346596480597e-03   +2.533667608268195e-01   +2.028321581987430e-01   -1.504102174835149e-01   -3.584952613376861e-01   -8.846352760447429e-02   +8.443079152328460e-02   +4.287075381331048e-02; -3.947108645389911e-01   +2.433481856860271e-03   +9.341031783626688e-02   -8.879370443855189e-02   +8.247342678174030e-02   +8.346201502844741e-02   +1.321951867562394e-01   +6.512312825121831e-02   +6.268080003460706e-02   -1.168810412470136e-01   +6.297412693913115e-02   -1.302157204127430e-01; +9.633794421842878e-02   +1.458762962630840e-01   -6.177022829866764e-02   -1.547461282053188e-01   +9.472768603610383e-02   -3.930474786346568e-02   -3.567543003076559e-02   -2.215773842793922e-01   -1.281384101787634e-01   -2.378476106257676e-01   -2.896027291719460e-01   -2.515314091712570e-01; +4.332660380948278e-02   -5.418447960319796e-02   +1.611623216274752e-01   +3.888537002367946e-02   +2.873488350132084e-02   +3.062841311315443e-01   +1.954225208458842e-01   +7.342568330033333e-02   +4.412081292125097e-02   +2.035554501725754e-01   +1.856944177564690e-02   -8.123296324476788e-02; -1.265686080163083e-01   +1.991896919574390e-01   -6.771249034672357e-02   -1.546423691581144e-01   +9.676612168098669e-02   -9.676841774671438e-02   -2.252603397517375e-01   -2.982466711528405e-01   +2.150892801874177e-01   -1.071106233554901e-01   +7.055896709512136e-02   -3.062747431294985e-02; -1.349947136929569e-01   +4.962759026098018e-02   -8.726053884768387e-02   +3.268961469705879e-01   +1.533952769366968e-01   -2.135197695919425e-03   +1.830531942426578e-01   -3.197242124585479e-01   -3.589428965360660e-01   +1.891234396538338e-01   -6.472818034239937e-02   +9.779385756157145e-02; +5.770786376678527e-02   -1.105153351446505e-01   +1.135616062300444e-01   +5.541776512550843e-02   +2.032045007313461e-01   -3.108977763184119e-02   -1.587859036374010e-01   -2.235560460958044e-01   +5.848637205361461e-04   +3.619013786193997e-02   +4.892179465980129e-02   -8.314109448580444e-02; -3.805470205198748e-01   -2.122335632001005e-01   -2.552430182162652e-01   -2.068797350918726e-01   +4.503941677586927e-02   -4.149919554138914e-02   +1.251998863365615e-01   +3.224771581378218e-02   +4.980059278089061e-02   -1.265590654387109e-01   +2.743298888738279e-01   -4.346363019808798e-01];
L3I_L2I_iGABA_netcon = [+2.752903337795805e-01   -1.700833641729415e-01   -3.428827024820789e-02   -3.410579700683514e-02   -1.723221096901768e-01   -2.608073310127900e-02   +3.701568703187821e-02   -5.348254994233218e-02   +3.452969121284444e-02   +4.822268904917620e-02   +1.692182485715249e-01   +3.521981814502637e-01; +2.654317026918372e-01   -1.130316238571091e-01   -2.748133190672264e-01   +4.347479970045842e-02   +1.756213704876729e-02   -5.649126111890015e-02   +3.945283272058420e-02   +1.997163629191631e-01   -1.264793470939859e-01   +1.521214828686772e-01   +8.066605718065786e-02   +5.909756046100747e-02; +2.014239918239963e-02   -1.690741992366538e-01   +1.571629777057698e-01   +1.178999869928457e-01   -6.888412342532213e-02   -3.086336101565487e-02   +6.841083402715928e-02   -1.020917918602628e-01   -8.398043520428483e-02   -1.086221664647111e-01   -1.318845787365440e-02   +2.900588370009074e-01; -1.601361917624739e-01   +1.407465261636161e-01   -7.237341433560404e-02   +1.354054282771464e-01   +8.706848538974069e-02   +7.313262514190960e-02   +2.242346746390751e-01   +1.531110897854405e-01   +1.416351003060465e-03   -1.623591172976843e-01   -1.796644583015324e-01   +2.927340255090384e-01; +2.009558843500885e-01   +1.915100225926473e-01   +1.076051945644404e-01   +2.246239238656044e-01   -1.284407635148915e-01   +1.682406997203283e-01   -1.465935858751692e-01   +2.123525770869826e-01   -1.095835762612240e-01   +2.423581725304116e-01   +2.568161652989934e-01   +7.371416479431397e-02; -2.099373624761550e-02   +6.283556963755654e-05   -3.339825977690292e-01   +8.699769249676095e-03   -2.440147197607406e-01   -1.875680368931761e-01   +1.148575993562088e-01   -1.430583437668018e-01   -2.551446405208008e-01   -3.295271859040216e-02   +4.885516229515667e-02   +2.169654426847865e-01; -2.076666476003512e-03   -3.436551273400473e-02   +1.082088571249446e-01   +7.204327750774978e-02   +3.437418145428795e-02   +2.919930652601191e-01   -2.212659965632865e-01   -1.465421562973173e-01   +1.106252925785637e-01   +1.782127366276670e-03   -5.678694523640096e-02   -1.161907214928768e-01; -7.029593371346132e-02   -8.071771093088592e-02   +9.562841747659437e-02   -3.716299572866745e-02   +1.581319019581166e-02   +3.085514182937265e-01   -1.739644796350729e-01   +3.397321410808797e-01   +8.985648351261985e-02   -1.331111215151349e-01   +3.168743497698764e-01   -2.478426507981975e-02];
L2E_L3E_iAMPA_netcon = [-8.457268450788633e-02   +7.669068926126199e-02   -1.640530614130206e-01   +1.041674414474368e-01   -5.998483799192551e-02   -1.055636453330156e-01   -9.551010736737045e-02   -7.488825446644461e-02; +2.145262773831209e-03   -7.652460947977627e-03   -2.472073663690702e-01   -4.026766427206208e-02   -1.128960753175883e-01   -9.727393231237058e-02   -2.394049121423515e-01   +9.195025280032521e-02; -1.999216600505411e-01   +3.420706307456675e-01   -2.369954051199424e-01   -8.959088977293986e-04   -9.393432345958894e-03   -1.932441554196349e-01   -1.002766619334530e-01   +5.157120391761540e-02; +2.666139916443885e-01   +1.148714836333807e-01   +3.573508713795108e-02   +1.984860858866139e-02   -2.522723179188073e-01   -1.270688242965466e-02   -1.967376974824496e-01   +2.261050557472698e-01; -7.124636146950485e-02   +6.024523285844074e-02   +2.582493622692189e-02   +2.949187113990909e-01   -7.910498932491850e-02   +3.345086210377652e-01   -4.681753481071918e-02   +8.797854567562649e-02; +1.993787353298156e-01   -3.413846858691943e-02   +1.137165673751378e-01   -1.027315428403055e-02   -8.708322391164776e-02   +1.061564490732803e-01   -1.664857568186153e-01   -4.701112582102374e-02; -5.957810641905940e-02   -8.711088362783424e-03   +3.439565899035030e-01   +1.173647125305153e-01   -1.692256722433667e-01   +3.246553337160119e-01   -2.314411463557979e-01   -1.363427015616328e-01; -1.113754187586395e-01   -6.831489973304974e-04   -1.433282349682780e-01   -4.084993738049796e-02   -1.762076421328161e-01   -2.954225984314846e-01   -2.382853914516419e-02   -1.695136725753130e-02; -4.549187484646262e-02   -8.465421925917782e-02   -2.641259310965801e-02   +1.353043739685351e-01   +3.140743297939003e-01   +1.690852787568656e-01   +6.929323881603063e-02   +7.810181576948488e-03; -1.157445212380139e-01   +9.187051276884119e-02   +2.514374363833838e-02   -1.025105674428744e-01   -6.856361044014690e-02   +8.620977888946876e-03   +1.112549553499460e-01   -1.623407453027076e-01; +4.251859278786901e-02   -1.257618439667424e-01   +3.657413882151733e-02   -9.580458914946176e-02   -1.969929041104422e-01   +6.826866371355485e-03   -1.107933331517447e-01   -1.674981266357124e-01; -1.011136585823313e-01   -4.062859310570463e-03   -8.907003705306392e-02   +3.694052606829006e-02   -1.321660072604633e-02   -1.224773356910376e-01   +4.625783313602942e-02   -2.038310321228927e-01];
L2I_L3I_iGABA_netcon = [-1.223915058182184e-01   +5.926188391988602e-02   -8.668782379874554e-03   -8.282050167443628e-02   -5.141513456269895e-02   -1.376262232541492e-02   -2.202055811407689e-01   -1.424577251930874e-01; +3.153639034656455e-02   +4.619613434860950e-02   -2.386060353919798e-01   -8.426435077189409e-02   -2.011025364874314e-01   +2.890260026244421e-02   +1.984719412562920e-01   +1.176941834961422e-02; +1.363754473137263e-01   -2.468909145346106e-02   +5.298375163512915e-02   +6.606786301914130e-02   -5.026929848012257e-03   +4.668757491842902e-02   -3.366960242770979e-03   +5.541426371233229e-02; +8.989266934225204e-02   +1.870633224705876e-01   +1.685239039506579e-01   -1.913378788955902e-02   -2.037425961878594e-01   -1.557331400272764e-01   +3.571160287551488e-01   -8.479213676053603e-02; -2.225878596220222e-01   -6.855708160026483e-02   -3.341089115049821e-01   -1.689003778451053e-01   +1.017641188019664e-01   +4.573217580203288e-02   -1.497752538534934e-01   -9.078084581866720e-02; +3.888548219803309e-02   -9.898476307003110e-02   -2.016968397876445e-01   +2.169714155947928e-01   +1.241557614205820e-01   +1.422172841270089e-01   -8.938067752008290e-02   +1.472945906123135e-01; +2.720735349489526e-01   -1.456336090704740e-02   +1.032985240035523e-02   +1.996311050415931e-01   +3.040025379802548e-01   -1.237710315791702e-01   -1.544865884350101e-01   -1.140158157150505e-02; -1.930933026712593e-02   +3.064787065015375e-01   +5.489280382476230e-03   +1.912604554653876e-01   -1.048939674643156e-01   -1.282537808487841e-01   -7.831223958145775e-02   -4.942189668523196e-02; +1.573533451946285e-01   -5.111138973692095e-02   +1.586706194809330e-01   +2.735282097245978e-01   +1.888417238066668e-01   +5.422196368437988e-02   +2.044440149519413e-01   +7.522541994839571e-02; +9.782073880129324e-03   -5.956146405868624e-02   +8.789343739357962e-03   +3.845471462925308e-02   -2.112730573523980e-01   -2.639624435083616e-01   -1.906566682594570e-01   +2.817034144943222e-01; -2.159297346194188e-03   -9.743303621175042e-02   +1.704115752817941e-02   +1.689224785793902e-01   -1.156901767885683e-01   -1.368702735500417e-03   -3.581881807876585e-01   -4.674504578067139e-03; -1.749230326402485e-01   +5.871460842123007e-02   -3.635360653090768e-02   -2.896696767515792e-01   +2.080904981621647e-02   -1.821077444398291e-01   +1.620195487774955e-01   +7.277570209825338e-02];
L3I_L3E_iAMPA_netcon = [+2.202735521122112e-01   +3.554889435921641e-02   +3.021227127401321e-01   +3.295783228382771e-01   +1.940865869202040e-01   +1.841502912854619e-01   -9.965333434613204e-02   -2.283671285272771e-01   +4.845319821582317e-02   +5.193151547353669e-03   -3.651433120366863e-01   +6.608029796361783e-03; -1.209884987335030e-01   +6.776658303620739e-03   +1.691866577096411e-01   +2.002240533913970e-02   +1.728451482414621e-01   -4.240878257195263e-01   +1.942434520799152e-01   +1.681998250255141e-01   +3.320091945180940e-01   +1.820304129842530e-02   -1.583762301613687e-01   +8.355992537082735e-02; +2.909617516380152e-01   -1.494916531292041e-01   -7.458080201064229e-02   +1.394876096684265e-01   +2.475659837884844e-01   -1.834943806920623e-01   +1.360540409769742e-01   +3.961897932881119e-02   +1.006798164562649e-01   -3.489355835144313e-02   +3.629476069963664e-02   +2.816955319042491e-01; +2.624022880211743e-01   -1.583955577833892e-01   +2.926858971973390e-01   -8.727483748057920e-02   -2.225447929660777e-01   +5.001572699115290e-02   -1.241023864188499e-02   +9.061922435918329e-02   +1.579170272562116e-01   +1.126722109142400e-01   +1.114822980462372e-03   +1.346413815739612e-01; -2.385078749756729e-01   -2.310318682504426e-01   -6.694726513290075e-02   -2.517678969193567e-01   +1.631644518743119e-01   -5.132027414621346e-02   +2.353621815047732e-01   +2.894419383295978e-02   +7.881314822771880e-02   -3.003404590974227e-02   -1.864499471455718e-02   -2.332127475616487e-01; +3.282169081764539e-02   +2.606644286663751e-01   -1.005531269478493e-01   -1.418701226893593e-01   -2.200294466140147e-01   +5.656167195806777e-02   -3.127318089455345e-02   +2.422139714257471e-01   +7.338800537512946e-02   +1.647276663736383e-01   -4.241709828159013e-03   -8.212248671696126e-02; -9.004508830404909e-02   -2.955070381352304e-01   -2.041219928007962e-01   +2.238912404275397e-01   +4.261230192862250e-01   -8.746315581686856e-02   +2.903154635112021e-01   +1.710578205629736e-01   -1.301869231528558e-01   -9.309156698335164e-02   +3.733105751248767e-02   +2.714652389635634e-02; -1.489072955468279e-01   -1.707816230607702e-01   +2.800224750097309e-01   +2.870613243471755e-01   +1.513963222615627e-01   +2.025945813375485e-02   +5.653838839822347e-02   +2.510047976769524e-02   +1.923632641396574e-02   +1.381499210617000e-01   +2.801913875011966e-01   -9.798313805845858e-02; +5.406464016151546e-02   -1.627257631549946e-01   +1.229399711361496e-01   +2.021679463314618e-01   -8.793372062271107e-02   +3.707767941618265e-01   +1.522619101644163e-01   +3.376443763339805e-01   -8.041618153330087e-02   -8.919085015345551e-02   -1.395277485043826e-01   -1.607829510297819e-01; +1.788469444248915e-01   +3.031563104991025e-02   -2.550038752077089e-02   -1.393591844929366e-01   +3.937674398464547e-02   +9.890205904271762e-02   -7.039057951136179e-02   -1.623504760490200e-01   -5.926007762390912e-02   -1.842684616754934e-01   -1.564525667143704e-01   -1.109479828800223e-01; +3.514052874754243e-01   -4.270056275625357e-02   -6.538415924967261e-02   -2.414373599098848e-01   +6.780768919700995e-02   -2.198688111887974e-02   +1.356802672558815e-01   +5.992098193581086e-02   +4.135631704287385e-02   +2.667006173500175e-02   -6.560712873132563e-02   +2.354547779395982e-01; -7.365480311626664e-02   +1.757691403142823e-01   -1.597943763766133e-01   -1.627894164636502e-01   +1.856518043604133e-01   -1.231200104687354e-01   -1.515242037696270e-01   -5.369558862505522e-03   +1.041657333610216e-02   +2.054598890156355e-01   +2.104662799241187e-02   +9.626224082101191e-02];
L3E_L3I_iGABA_netcon = [-3.662262114958932e-02   +3.688823473649579e-01   -1.758856397881921e-01   -7.560720231610746e-02   +7.607305747533892e-02   -1.227078995118245e-01   +1.295940910014270e-01   +8.775259609860987e-02   +2.184139949562295e-01   +3.565419411634838e-03   +1.324667002156650e-02   -1.827794845610813e-01; -1.611917576372671e-01   -2.502353450390536e-02   -3.554202461701449e-01   -1.111309108278309e-01   +2.001873330269030e-01   -2.095438235938310e-01   -1.965720485821717e-01   +1.445984181689542e-01   +1.039170393132689e-01   -1.869247405322473e-01   +3.841472883182909e-01   +1.440157613613424e-01; +1.873777519295702e-01   -1.384777847953195e-01   -9.346775375808802e-03   +3.636473064619633e-02   -2.387447496685826e-01   +1.869877512733079e-01   +1.482939960669157e-01   +8.509553584288905e-02   -7.507127948200404e-02   -8.062549663560015e-02   +5.165324951815828e-02   -6.886327429270445e-02; +1.336714531714867e-01   -1.911667938894876e-01   +6.010795156230467e-02   -2.987042421379549e-01   -2.831936811182816e-01   +2.251994856904442e-01   -6.342611099123735e-03   -1.542703120755225e-01   +1.103527164296642e-01   -6.274280762244833e-02   +4.139418962839055e-02   -1.331177464285216e-01; -1.962598546737617e-01   -9.595328657446953e-02   +7.544509121255294e-02   -7.460077606204485e-04   -4.325859571880758e-02   -1.847571688554779e-01   -1.977468779010772e-01   -2.847723318629375e-01   -1.155343281004275e-02   +1.995489749720279e-01   -2.234005367478638e-01   +1.427103180153719e-01; -7.253981742179758e-02   -1.141475330354024e-01   +1.098853359538609e-01   -2.573161503099658e-01   -2.975122390217599e-01   -5.300003316392164e-02   +9.385910150108727e-02   -6.168560843314016e-02   -1.444770870307493e-01   +4.568343922285027e-02   +6.577808732618215e-02   +2.336392490190776e-01; -1.251599000915306e-01   -1.737494644469648e-01   +4.668413567854136e-02   +1.195398933361488e-01   -8.020207562723880e-02   -3.974773759558120e-01   +1.439555547948856e-01   -4.670790857180440e-02   -7.862880068303547e-02   +3.051312556157844e-01   +1.708397942064301e-01   -1.119011867883770e-01; -7.868227050155423e-02   +1.762883637109011e-01   +9.343182990750606e-02   -1.095987959534453e-02   -2.318573973308209e-02   +2.302598150498649e-01   -9.140727892574844e-02   +1.708175284775397e-01   +8.176504838336922e-03   +8.799703827082242e-02   -5.728280108555093e-02   -1.960173325164911e-01; -1.067531559897701e-01   +6.578739416492083e-02   +2.071652549749948e-01   -1.350218062872539e-01   -3.370501848586964e-01   -3.482965183170371e-01   -3.460886410061081e-01   +9.606550386381132e-02   -7.287449924518614e-02   -4.179108529258530e-03   +2.004219491501183e-02   -2.039474198150019e-01; +1.874227635370952e-01   -3.746983936677954e-02   -1.708577660890297e-02   -2.910221401415197e-01   -1.248055476544815e-01   -2.441452583251372e-02   -2.943821331563243e-01   -1.301292582612515e-01   -1.037226538096704e-02   -1.256742390655857e-02   -8.503555011184197e-02   -9.918487407709871e-03; +2.989718324700160e-01   +1.082741021867586e-01   -2.615864332430059e-01   -6.243664857614347e-02   +2.189561592559806e-03   +2.789534999303999e-01   +2.051601591460024e-04   +1.231250394501372e-01   -1.473436850443199e-01   +8.953505846382427e-02   +3.879181384007032e-02   -6.426369327010632e-02; +1.106454639328794e-01   +4.221489751101935e-02   +7.779790282389934e-02   -3.291575647764097e-02   +3.356648811380336e-01   -1.583212483271063e-01   -9.162597808639764e-02   -2.510951362904760e-02   +1.012817334894683e-01   +9.265070159280342e-02   +5.941886174582665e-02   +1.215863333276671e-01];
L2E_Input1_iAMPA_netcon = [+2.114882968393563e-01   +1.620963342422573e-01   +3.635337118918701e-01   +1.130088249004462e-01   +1.680656762927802e-01   +1.042565841919734e-01   -8.045362672076671e-02   +6.454274427280275e-02];
L2I_Input2_iAMPA_netcon = [-1.854215514544303e-01   -2.204253995431417e-01   +4.257249999030766e-03   -2.726372672098148e-01   +1.143084727467003e-01   +6.553869861004162e-03   +2.531316801656583e-01   -1.708736974826087e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
