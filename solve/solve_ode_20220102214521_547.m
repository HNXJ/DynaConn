function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-3.392425020517553e-01   -5.443940890754332e-01   +2.617579989437419e-02   +7.000792274621909e-02   +1.839625358487225e-01   +2.011896368097008e-02   -5.580702298251574e-01   -1.873393525587654e-01   +4.697586898816508e-01   +7.149903035203078e-01   +1.283557516332735e-01   -1.722111144249237e-01   +5.005345621049859e-01   -6.489136474793823e-02   -3.180594968113671e-01   -1.245791051567670e-01; +2.122758389840946e-01   +4.560754226443119e-01   +1.171042079280384e-01   +2.502727148020481e-01   +7.532717586062167e-02   +7.472980352788777e-01   -3.501105084355430e-01   -1.515889921145917e-01   +9.790421947918522e-02   -9.097891729989338e-03   +1.337664741927106e-01   +4.364102048443370e-01   +2.534631119072246e-01   -1.108335807704987e-01   -1.094586155771367e-02   -1.441936101313176e-03; +2.360196371590525e-01   +1.591562556240729e-01   -2.305633103494770e-01   +2.311493813412791e-01   -3.611358023036055e-01   +4.057492317120617e-01   +6.567356851881946e-01   -3.351277472539239e-01   +4.435457303452124e-01   +2.157949352062961e-01   +2.601915630730959e-01   -7.734288425066878e-02   -2.118078971471076e-01   -5.155263558830983e-01   +2.163732884444975e-01   +6.265832301228281e-01; +4.375430131698922e-01   -2.063386216767170e-01   -1.186050286481448e-01   +4.164514149489251e-01   +1.943256850617759e-01   +6.120225960770338e-01   +6.067203268641053e-01   +3.205015706122769e-01   +1.795819152063405e-01   -2.670613228590116e-01   +3.780035618653291e-01   -8.688539431582400e-02   -3.460064498216186e-01   +3.624577218340622e-01   +2.527398563363122e-01   +8.652392241683381e-01; +4.550185952321867e-01   +1.068005766358868e-01   +6.559216631830421e-01   +3.349801192861566e-01   -1.859216933084738e-04   +2.386315582610383e-01   +1.180818868848945e-01   +5.271741237600452e-02   +2.889268074733276e-02   +3.940477337311353e-01   +4.799070201096397e-01   +1.757760224607326e-01   +3.960525964373921e-01   -9.998616928468165e-02   +1.430476025809265e-01   +2.363471950282649e-01; -2.650727503306379e-01   +8.653300181002230e-01   +5.563303139664069e-01   -1.006899892472838e-01   +3.809392295211313e-01   +2.482515772339649e-01   +3.453154204867503e-01   +2.517693096215086e-01   +1.464412289208502e-01   -6.723011735070648e-02   +1.298729647275086e-01   -1.987187354822537e-01   +2.026298283602075e-01   +3.497809565363174e-01   -2.875977425708542e-01   -1.929949236644637e-01; +2.461997725784864e-01   +4.545108214259584e-01   +7.414629162650501e-01   +3.017538270153216e-01   -3.705197615133664e-01   +1.030506610939728e-01   +2.706951907349242e-01   +4.493179863592884e-02   -7.633436809676030e-01   +2.728889819171650e-01   +1.107261512484122e-01   -1.782763837758380e-01   +4.287286382066483e-01   -1.659537425751876e-02   +5.354823102754607e-01   +4.497885577990369e-01; +1.413858226119398e-01   +4.536873082353141e-01   -2.752839271775501e-01   +2.433404115389711e-01   +4.568441347137358e-01   -1.401324924898149e-01   +6.372413114086972e-01   +3.859869641086096e-01   +3.683006919964352e-01   -1.725654928810688e-01   +2.092207075973019e-01   +9.918936125187695e-03   +3.507171357724660e-02   -9.796234870098622e-02   -2.588871373674812e-01   +2.304523940108452e-01; +8.854832301243822e-02   +7.107300035623233e-01   -1.412498465827472e-01   -8.307680433052905e-02   +2.750737001955578e-01   +4.516354836232390e-01   -2.414679502872002e-01   -3.588831849372126e-01   +3.962768898347876e-01   -8.435955989071747e-02   +3.832650699391245e-01   +1.810539797400156e-02   +7.261594237690379e-02   +4.231455408245590e-01   -3.317445061793773e-01   +3.164321718663939e-02; +4.004055259563953e-01   +1.688236133373122e-01   +9.767150214072097e-02   +3.744030029603754e-01   -1.396827905969855e-01   -1.767471885985940e-01   +3.325109187506654e-01   -1.589880507453864e-01   -4.972669379729554e-02   -2.634471482526573e-01   +8.259316548733537e-01   +2.731383347735115e-01   +3.774049150136438e-01   +3.148881933747154e-01   +1.964477547227922e-01   +1.206642334917712e-02; +4.302237513448770e-01   +8.497415441647348e-01   -8.326556963976353e-02   -2.059486429528699e-01   +3.726939806265587e-01   +1.502892328567026e-02   -1.842377148573123e-01   -3.306168265842052e-01   +2.685184984515093e-01   +5.728617959346038e-01   +1.916846741051149e-01   +2.827321538018747e-01   -6.261100798532964e-01   -8.886517400521673e-02   +2.695963686725049e-01   +6.984550233426881e-02; +3.226683263350406e-01   +2.679325716967613e-01   +8.587519325688960e-02   -2.697651055668093e-01   -1.516737535917207e-01   +2.103292367977541e-01   +1.977097901689339e-01   +5.112719744581409e-02   +1.149304216838099e-01   -6.197463648024140e-01   +3.264400156486693e-01   +4.902963680316049e-01   +6.991497574714770e-01   -1.751982097905768e-02   -4.731214492963164e-01   -6.622899960637424e-02; -4.564289498455332e-01   +3.313009143926402e-01   -4.644507296777901e-02   +2.519891933702135e-01   +6.144000751914346e-01   +7.966511197279228e-01   -3.212420634511627e-01   +9.795513980601007e-03   +3.480169602972941e-01   +5.031494558759589e-01   +1.335112328934132e-01   +3.507790909181602e-01   -1.371160901748658e-01   +2.922493755302755e-01   +6.254515798591116e-02   +1.274079295221807e-01; -4.947504921771074e-01   +4.446386148024041e-01   +2.814030649974787e-01   -6.007293811977219e-01   +2.990084801623981e-01   +2.328062386877295e-01   -1.914804056982946e-01   -1.186212753036974e-01   -3.355717125168166e-01   +2.747989467222495e-01   +6.638975088474039e-01   -1.322802156431987e-01   -3.786041943149330e-02   +4.622922105019464e-01   -1.745195025999897e-01   -3.759199054989758e-01; +3.388723167635912e-01   -1.673697564329905e-01   +4.283786618298254e-01   +2.468265766474297e-01   -7.654072464433971e-02   -2.404553307723469e-02   -1.222614593137686e-01   +2.119044683986381e-01   -4.255845171500605e-02   -2.291939229868437e-01   +1.878357169641429e-01   +7.867998582627524e-02   +6.733182199832211e-01   +8.426045724061455e-02   +1.310497154985109e-01   -6.996428115636691e-02; -1.000000000000000e+00   +4.595063521794158e-01   -4.500101910927124e-01   +5.748221731947641e-01   +6.739988484395851e-01   +3.987634087004384e-01   -1.532827580218559e-01   +5.414742925587115e-01   -3.876512850073789e-01   +3.055050194972924e-01   +2.511382145335133e-01   +4.213241256067547e-02   -2.822183862818272e-02   +2.262910574621385e-01   -7.013150213259389e-03   +2.854686733583687e-01];
L1E_L1I_iGABA_netcon = [-3.028153448372930e-02   +9.446379749519780e-01   -5.784582935468660e-01   -4.545560628821628e-01   +5.102440915385564e-01   +1.733466468529319e-01   +7.429134589836368e-01   +1.468379771490175e-01   -6.095904851512569e-01   -1.154496874547901e-02   -4.383003423975377e-01   +7.761562765281806e-01   +8.661346752405744e-01   -4.899027380838979e-01   +7.865540862799372e-01   +7.263896210517859e-01; -2.691352950437730e-01   +9.749937844567697e-02   +9.999957227661255e-01   -4.111027311693237e-01   +4.624347496115875e-01   -4.409666360329296e-01   +5.421251951047980e-01   +6.659461588226654e-01   +3.501500201964476e-01   +5.651733203441145e-01   +2.122963797857502e-01   -1.923585442459228e-01   +3.672063231418650e-01   +5.854083715229446e-01   +6.481560084901846e-01   -9.595781692872310e-02; +1.529314586779122e-01   +5.110833855713519e-01   -4.528243247029979e-01   +4.262540832133426e-01   -3.333440758761284e-01   -3.291242489806081e-01   -2.054824382327518e-01   -3.168876417498202e-01   +3.426670538878442e-01   +2.984493058730796e-01   -2.658674423378998e-01   +6.615669549603607e-01   -9.513267109095185e-02   -5.811611972837724e-01   +6.548373601763292e-01   -8.426072919162100e-02; +3.747470393946044e-01   -3.148456198633988e-01   -5.193639544433000e-01   +4.064900923791281e-03   +9.512795710756730e-02   +6.185914844391426e-02   +1.497131575994223e-01   -1.799453720913916e-01   +1.672840789938473e-01   +4.199222620557216e-01   +4.322972686315540e-01   +9.610483871471105e-02   +4.302372406035145e-04   +3.849320854274759e-01   +4.787998733365051e-01   -1.665733252134565e-01; -7.507299929243057e-02   +3.652444520686822e-01   +5.722166034753436e-01   +3.864499732835409e-02   +6.620997355367128e-01   -3.175505243992753e-01   -2.836527077643738e-01   -5.334315600669387e-01   +1.925094485072982e-01   +4.778320343284915e-01   -2.206489560610742e-01   +8.137215681088474e-01   +8.499022179239271e-01   +2.402745659946629e-01   -3.437015918449221e-01   +1.519429171929972e-01; +3.059017356662276e-01   +2.523243375395084e-04   +1.770419972747558e-01   -4.909802182294646e-01   -9.223959132305648e-02   +4.131389590443943e-01   -1.845951119103634e-01   -4.782001281183570e-01   +1.408028911481846e-02   -1.018463363501830e-01   -2.304696297024476e-01   +4.913454924063574e-01   +2.072010824433485e-01   -1.905584461365919e-01   +3.347037075630766e-01   -1.905290057344319e-01; -8.957624044600239e-01   -4.652676942297161e-01   -2.111026637299099e-01   -6.242861789419147e-01   +5.516100175275930e-01   -1.421533703595033e-01   -1.579071417262004e-01   -2.982951510466052e-01   +6.178849721307840e-01   +4.267125540527368e-01   +5.938251561573636e-01   +6.495130186256629e-02   -3.929638946541451e-01   +5.985814250970743e-01   +7.581939728579578e-01   +2.376110337197591e-01; +4.516723335204392e-01   +3.285729569213542e-01   -2.968584264323889e-01   +1.621698018550302e-01   +3.363883458841277e-02   -3.193507265758634e-01   +8.790639153257510e-01   -1.694342351832278e-02   +6.633268576825760e-01   +1.086383186004508e-01   +2.104081945604601e-02   -2.649788646587072e-01   +9.876371421903560e-01   +4.800251573546022e-01   +3.130766666377838e-01   +8.063936029152221e-01; +1.742143357927153e-01   +8.695651950484035e-01   +2.678184468280231e-01   -2.321506795152600e-01   -5.196625474298624e-01   +6.486029075955139e-01   -2.130156090393962e-01   +1.722720431226759e-01   +2.450065790141964e-01   -6.596081385113607e-01   +4.296153162029816e-02   -3.496349932815839e-01   -2.748929693131450e-01   +8.823373186731437e-02   +7.957318882678895e-01   +2.078273042750685e-01; +4.033429127748106e-01   +7.390546562910126e-01   -1.986441381686872e-03   -4.771827959445752e-01   -7.198743395087513e-02   +3.064419886328387e-01   -1.725214232678652e-01   +1.015312672201410e-01   +6.063216196438813e-01   +7.209493726775131e-03   -6.494224953497962e-01   +1.967994282317484e-01   +6.036373023230388e-01   +1.491824846233977e-01   -4.057894999802313e-02   +3.267581446760117e-01; +2.980850703947387e-01   +3.101147423337070e-03   +2.342395983060934e-01   +6.266414583729816e-01   +1.844094086736074e-01   -1.506691143423280e-01   +1.882617617876628e-01   -2.121117322394650e-01   +6.963147165981145e-01   +3.861964288104605e-01   -5.991365926880743e-01   +6.844915893930157e-01   +6.433501519535725e-01   +1.901552780267340e-01   +3.104450852099688e-01   -6.185019757713045e-01; +6.431203411058667e-02   +1.830871975709338e-01   -9.942939077358340e-03   -5.366897995590045e-01   +2.832079693796236e-01   -6.290504561535493e-02   -3.063331734880264e-01   +1.391834094659834e-01   +2.821839964168636e-01   -1.356589149914669e-01   +2.396188304615383e-01   -1.358411556663473e-01   +4.833946430168099e-01   -8.663176750703572e-02   +4.456646114199916e-01   -2.711492701526867e-02; +5.559766286989481e-01   +2.202319552218269e-01   +1.339684285628428e-01   +1.530112679652685e-01   -5.867899652740130e-02   -2.037294868868385e-01   +2.652578367157285e-01   +9.790826645340428e-02   +3.789155359837119e-01   -7.489610451844962e-02   -2.108723029400059e-01   -4.571154651318892e-01   +4.659606750142782e-01   +2.530567263973428e-01   +1.464798489109991e-01   +1.860308469256562e-01; +5.934102157579377e-01   -1.415097159922764e-01   -1.969117488024185e-01   +2.278931479301661e-01   +2.372340108471680e-01   -5.304671036696655e-02   +2.113592679756578e-01   +2.401592354251955e-01   +6.846192738264296e-01   +2.629452479351544e-02   +5.512156931384526e-02   +3.281244921589990e-01   -2.797822948201223e-01   +1.505127792301518e-01   -3.693182029781568e-01   -5.351318906915700e-02; +1.654783610285070e-01   +3.851931523957914e-01   -1.135533038711650e-01   +1.793205530260946e-01   -1.656052305730676e-01   +1.815772505780633e-01   +1.601606641958255e-01   +1.142579661582283e-01   +5.128323517154527e-01   +1.224287880807061e-01   +8.153853679903903e-01   +9.608389898186703e-02   -2.065971293279004e-01   -9.340849811151489e-01   +9.587039796639212e-01   +3.239962407582052e-01; -4.093244507867562e-01   +4.672636040759387e-01   -1.689724872686059e-01   -2.942578138851650e-01   -2.078441252875730e-01   -1.797011840135036e-02   -1.592119856394361e-01   -1.271598216367398e-01   -1.057897831401385e-01   +1.915329187614993e-01   -5.725775112277854e-01   -1.171735213627917e-02   +5.074938926000634e-01   +1.744830863702263e-01   -9.783562035295687e-02   +3.346981995265669e-01];
L2I_L1I_iGABA_netcon = [-2.895312092597124e-01   -3.242914116022640e-01   +1.372904138193505e-01   +5.684950524407514e-01   -3.275222870390282e-01   +5.750754521481227e-01   -1.334486351140688e-01   -1.298131165125553e-01; -2.204015674653509e-02   +6.341175629911768e-01   -8.002741462162083e-02   -6.781234067101846e-02   +4.207483062641368e-01   +5.816292089742459e-01   +5.396374413217082e-02   -4.176910891781013e-01; +4.774311190019489e-01   -2.033488083322805e-01   -1.934256168606150e-01   +3.682645155261344e-01   -1.203884704848608e-01   -1.221555850348726e-01   +5.152854724112710e-02   +3.594706838078541e-01; +1.049874803780484e-01   -2.467082127090317e-02   +6.009556340043358e-01   +3.983028866057515e-01   +1.140849308656397e-01   +3.262754701109811e-01   +2.926534723440513e-01   -6.306719857295556e-02; +1.334671312041723e-01   -2.097091581126905e-01   +5.245711307045503e-01   +4.471967970695473e-01   +7.985221632060920e-01   +5.025854876565006e-01   +2.299417448275749e-01   +2.883764330775506e-01; -2.395417535020734e-01   +9.451934163259501e-02   +4.367539184043299e-01   +5.865207971961300e-01   -2.583946546221390e-01   +4.067224033742646e-01   +6.720648444959227e-01   +7.997401685322985e-01; +1.097193722378856e-01   +1.293554932572723e-01   +1.436864732043105e-01   -4.722060402152925e-02   -1.005073492365376e-02   +6.492392534195982e-01   +5.885198616659432e-01   -1.308192865609391e-02; -1.316868655711685e-01   +6.456671458117348e-01   +1.486644605476263e-01   +1.343848112108426e-01   +6.731510083925918e-01   -2.089470222821526e-01   +5.308717300999228e-01   +1.138169859444784e-01; -6.197961118549426e-02   +8.081212803515928e-01   -7.040967775945445e-01   +5.084639234806794e-01   +3.091673988848038e-01   +5.304054546742450e-01   +2.722063405671520e-01   -2.032452316519104e-01; -5.351691549169012e-02   -2.878042663548576e-01   +4.070683053478750e-01   -1.094349987715796e-02   +1.503098350691947e-01   +3.652502512419701e-01   -5.605539551152132e-01   +8.273398304702348e-02; -8.502770053959630e-02   +2.404026236881442e-01   +2.962507798633669e-01   +4.266599811716604e-01   +9.901378611679727e-02   +6.777145088256303e-04   +7.571475423222684e-02   +1.440340525246193e-01; +3.247157255623745e-01   +3.599565078060715e-01   +2.093271458714691e-01   -7.547577072553750e-02   +7.833524890399489e-02   +9.729622211083658e-02   +6.235290926283492e-01   +3.905208876606275e-01; +4.453628860069990e-01   +3.165425017982166e-01   +1.372182632497707e-01   +1.790138369791670e-01   +3.816365133722974e-01   -5.271714653788281e-01   -3.225229125683851e-01   -2.144945913017050e-02; -3.138037337848534e-01   -3.526111815650871e-01   -8.077113482868488e-02   -4.227834389949588e-01   +3.277982904456375e-01   -2.587885581520979e-01   +5.840821464777042e-01   +4.739726864999952e-01; +5.658739585088095e-01   +3.210369060522309e-01   +3.588836845422433e-01   +2.205165807403064e-01   -4.459875925320844e-01   +6.838976585976146e-01   +6.979690307485705e-01   +1.228773760249811e-01; +7.210705527166228e-02   +1.237980921545395e-01   +4.937913117704886e-01   +4.838801043442490e-01   +3.753131084259299e-01   +3.755947167124711e-01   +9.640163714546013e-02   +2.129958229259530e-02];
L1I_L2I_iGABA_netcon = [+5.467940705630526e-01   -3.378873551477699e-01   +9.953170049394766e-02   +4.367390859971195e-01   +1.184667617161079e-01   +1.941452886101069e-01   -3.206013947157768e-01   -1.338245706290591e-01   -1.189471342317282e-01   +3.576756423448881e-01   -6.071815087903228e-02   -1.676605850715848e-01   -1.047277133283718e-01   -2.175675914183721e-02   -1.337219004809071e-01   +2.728094317860537e-01; +3.336551680837913e-01   -4.652935575257375e-01   -2.903875941509075e-01   +5.626362798675948e-02   -2.355131969795698e-01   +7.079285676135717e-02   +3.030110798045211e-01   +3.517467922530917e-01   +6.279395339964282e-02   +6.226787885847134e-01   +4.836778576676127e-01   -1.646953806689764e-01   +1.402684405149489e-01   -4.139912755854491e-01   +4.586448499236749e-01   +4.058799948560778e-01; +3.189296975103776e-01   -4.187546429638375e-02   +4.227697348549492e-01   -1.201488606376695e-01   -2.365470583135857e-02   -4.707847790824015e-01   +1.751926454236612e-01   +4.854342192253303e-02   -2.044532834508913e-01   +1.498201071250283e-01   -4.759766397604351e-01   +8.645618010116050e-02   +3.966990904277582e-01   +4.301009914521520e-01   +6.247792051739207e-01   +3.583239702244748e-02; +3.638716126156606e-01   +5.599607873622479e-01   +3.914099012312118e-01   -1.266591224747549e-01   +5.113963577339172e-01   +6.678229947484720e-01   +4.426152693891603e-01   -6.547779599670268e-02   +2.166330055529817e-01   +6.734971748054892e-01   +3.643379200292531e-01   +5.304422435618468e-01   +1.080664256446727e-01   +8.906471113171256e-01   +1.941942560412381e-01   +6.481205805394408e-01; -3.462929810513313e-01   -6.241506704746912e-02   +2.190001420107915e-01   +3.009433336844103e-01   +2.862154039396076e-01   +6.249396891023107e-01   +4.657825913575967e-01   +5.575075934679912e-01   +1.340678438081613e-01   +4.627666977293756e-01   -3.891394555854970e-02   +2.230971428448811e-01   -8.114433341390506e-01   +4.694293869161386e-01   +4.182971052047076e-01   +8.830426599405085e-01; -1.057299103346588e-01   +6.038544698709986e-01   -5.801934637185289e-01   +2.027675019294704e-01   -1.694694866942249e-02   -2.705716101937867e-01   +4.053926082349099e-01   +5.135840154344843e-01   +2.878798789891931e-01   +2.511726382458959e-01   +6.550965507517099e-02   -2.189264971670707e-01   +1.177756699850015e-01   +9.895470551038364e-01   +1.999182871792611e-01   +1.927305585262044e-01; +4.458740681922563e-02   +3.395114723842499e-01   -2.624167913156690e-01   +4.317707494120826e-01   +4.828543677956602e-01   -5.702829755662154e-01   +3.000902574589051e-01   -3.313206364605861e-01   -3.732836551988717e-01   -1.847789706430504e-01   +2.848453348820905e-01   +4.818527028120499e-01   -1.133407484194523e-02   +7.869123845844801e-02   +1.890235986835193e-01   +1.878612032687098e-01; +2.490849480179400e-01   +2.530177460125340e-01   +1.881676999637965e-01   -1.998121843939246e-01   -5.817713580246811e-03   +3.349547370114668e-01   -3.010196252744164e-01   -3.119494269507725e-01   +5.582384404009959e-02   +4.008987141546808e-02   +1.159109537648735e-01   +5.792588345967510e-01   -1.795859256252176e-01   +6.030017214524728e-02   +1.055462683170766e-01   +4.674536912216842e-01];
L2E_L1E_iAMPA_netcon = [+1.972193943990500e-01   -7.293929040335120e-01   -2.798007451246042e-02   +5.742899192245268e-01   +3.507513905065732e-01   +1.187093270029459e-01   +4.706810416557497e-01   -1.075046673018871e-01; -1.934059151846222e-01   +1.750442684301428e-01   -5.161832168273057e-01   +3.525842360694291e-01   +3.406880924644642e-01   +3.528203913145211e-01   +1.960250180869737e-01   +1.164158891405861e-01; +5.834042334281863e-01   -6.979184736180473e-02   +2.905931824561315e-01   +1.896392786641608e-01   -1.113060867003495e-01   +7.032353035359842e-02   +9.806780707482565e-02   +1.532536234946092e-01; +3.371721526005635e-01   -1.018641340797428e-01   -3.263283047157088e-01   +4.558647340696668e-01   +9.807800130960773e-02   -1.383073297292247e-01   -2.660780764485603e-01   -5.580051703791421e-02; +2.202289233016420e-01   +9.397592080515667e-03   +2.123123699190466e-01   -3.927909091443019e-01   +1.833627225002815e-01   -1.152113912306786e-01   +9.183513122683033e-02   +3.769807663073330e-01; +8.310556340314817e-01   -1.745567641482869e-01   +1.165403345025948e-03   +6.939506109099407e-01   +4.383845842775516e-01   +5.439611293549913e-01   +2.887355501328037e-01   +3.612497910225888e-01; -4.326807861237236e-01   +7.671300452728125e-01   -1.926366710451224e-01   -3.388979788371049e-01   -1.455564708692998e-01   +3.402558250876813e-01   +7.482562794552132e-01   -2.390603575087437e-01; +1.987401873129701e-01   +3.125737464099822e-01   +8.689742042639413e-01   -2.068108295638100e-01   +1.583774335180137e-01   +1.751906494562053e-01   +6.476982462428579e-01   -1.885997513634646e-01; +2.963297414774502e-01   -3.443764562479022e-02   +7.183938914994957e-01   +7.478708804060979e-01   -5.678308036214370e-01   +5.310145423821403e-01   +5.699076010564342e-01   -2.055241989707491e-01; -4.418214518057867e-01   +2.866568973886627e-01   +1.047438501707972e-01   +2.920576979305756e-01   -1.286987371072419e-01   -2.355866318368416e-01   -3.340064019063885e-01   -2.704193328643913e-01; -5.339603154663015e-02   +8.373437289984283e-01   +7.080566375940567e-01   +1.561932126241538e-01   +1.618739441749206e-01   +2.221738501879790e-01   -1.168958452503082e-01   +1.774430712759099e-01; +1.027310077205225e-01   -4.544835209922740e-01   +5.834657267618018e-01   +3.649434929103344e-02   -3.550373683360176e-01   -9.224382064155703e-02   +7.186598552670025e-02   -4.513791254180078e-01; -3.089378145474793e-01   +2.462136529574790e-01   +1.181189014107561e-03   +1.342989735682086e-01   +4.328642788289588e-01   -4.633252429162242e-01   +5.196955871002189e-02   -1.630586523766443e-01; +1.667152832522857e-01   +8.380114356689505e-01   -1.762506248422348e-01   +6.864589595703087e-02   +5.962429618834482e-01   +1.595085115311546e-01   -3.441443296650964e-01   +3.730037249755337e-01; +1.987410673984400e-01   +3.782962238543052e-01   +1.252798526731366e-01   +1.603875999844853e-01   +3.264462460909180e-02   -7.731053321934392e-02   -3.355151597125767e-01   -2.459645695257062e-01; -2.473364431340735e-01   +5.354636569009240e-02   -6.947659816314937e-01   +4.600199045839126e-02   +6.120339187066962e-02   +1.429703462963443e-01   +7.279376471314186e-01   -8.723033784770912e-02];
L1E_L2E_iAMPA_netcon = [+3.731820110522380e-01   +3.686476585051393e-01   -1.891533037257695e-01   -1.371500193526608e-01   +3.234459810993275e-01   +2.993214621795238e-01   +3.844875742610019e-01   +3.416849321157328e-02   -1.585404335624114e-01   -8.601624576432522e-02   +6.066523568660701e-01   -2.135188984669600e-01   -8.259461776514804e-02   -2.335970355604939e-01   -1.176548241992648e-02   +8.990314790887732e-02; +3.128439713610902e-01   -4.118560082446075e-02   +2.039040866352537e-01   -1.753936132927606e-01   +3.387537336484581e-01   +1.624267551807903e-01   +7.056142544593779e-01   +4.013021294484508e-01   +3.083504162919910e-02   +8.228022943357281e-02   +3.982962026416322e-01   +3.813446904195661e-02   +7.046750403745935e-01   +4.785171093686106e-01   -1.845003726288512e-01   -5.512519871299176e-01; +9.881141990801768e-01   -1.047653053150768e-01   +1.834873896288947e-01   +3.652831602852644e-01   +3.308683646449746e-01   -3.328884061116565e-01   -1.440375056102136e-01   +9.255214036072971e-02   +1.467216377478973e-01   -2.091173855099314e-01   -3.677996534020980e-01   +1.428898836543937e-01   -2.731288660402788e-01   +5.771852870867276e-01   +7.396472586520113e-02   +4.441574864044587e-02; +3.437118124060186e-02   -1.266905436157373e-01   -2.655006659594573e-01   +3.627367516189261e-01   -8.565111214147657e-02   +7.469046840885422e-01   +6.283803821628016e-01   -3.855031780290305e-01   +9.479116769263839e-02   +2.954502599351762e-01   +4.757147420374242e-01   -1.884419137946630e-01   -1.912072696418106e-01   +7.301177088028272e-01   +4.999431298626711e-01   +8.895741877001442e-03; -2.244350942077515e-01   -4.280871409704516e-01   +7.146556956364193e-02   +2.539478782522235e-01   -1.134646805017607e-01   -3.311105622519743e-02   +4.360002844368291e-01   +4.154706115535457e-01   +4.951941605912678e-01   -2.728754815137013e-01   +7.946023952693358e-02   -4.222269193096159e-01   -4.819692242523532e-01   -1.613932547214596e-01   -1.303036077741820e-02   -4.237866951998991e-01; -1.753664495560971e-01   +5.653502716811046e-01   +9.051147166917926e-03   +5.459240421160706e-01   -9.322209043150140e-02   -1.329291355210169e-01   +7.434598958248930e-01   -3.525476175011882e-02   +2.138366381064166e-01   +2.553185331468244e-01   +2.691134220573587e-01   +8.247629592535066e-02   -1.450664456083035e-01   +3.234400762199768e-02   -3.044941273625585e-01   +8.368976586145078e-01; +2.755861257043222e-01   +4.183006303470974e-01   +3.039912383319456e-01   -1.481859155669634e-01   +2.811269518348123e-01   -3.167063770790841e-02   +2.295985307753408e-01   -7.483036998464692e-01   -2.757947514196197e-01   +1.585408124551643e-01   +8.183873240142463e-03   -1.331094176372143e-01   -8.487447782408396e-01   +5.924679858885331e-01   +4.123307479016087e-01   +5.616806019325903e-01; +4.134470262391561e-01   +2.329400130696363e-02   +8.131008652250424e-02   +5.672391927082997e-01   +6.077321025520845e-01   +3.565451795589129e-01   -2.055477583864028e-01   +2.534646942129953e-01   +6.038635154350955e-02   +3.895348633930005e-01   +9.619967106315022e-02   +9.723493272357635e-02   -6.427242392776091e-01   -9.667476842752504e-02   +4.821076812195589e-01   +2.549351698525115e-01];
L2I_L2E_iAMPA_netcon = [-5.373683021813725e-02   +6.737318153185994e-01   +4.951679791252487e-01   -3.020995364961138e-01   +1.594976283185385e-01   +2.117980647695979e-01   -1.152392818755424e-01   +5.417428405274425e-01; +5.312927438826833e-01   +4.118534588204022e-01   +4.772843682979684e-01   +9.524376542483869e-01   +1.532175147597798e-01   +1.897973164902146e-01   +1.114561746530741e-01   +3.875655014210012e-01; +7.045701957284110e-02   +2.624615227086812e-01   -3.073974639249956e-01   +3.259264599325007e-01   -2.736048247337537e-01   +3.144614142629682e-01   +4.410342009236119e-01   -5.189837645839600e-02; +4.612942930389108e-01   +5.690988009921991e-01   -5.223554127254383e-01   +3.433654919092847e-01   +6.102280008983124e-01   +2.485939096592131e-01   +2.514484250507537e-01   +4.453020111683100e-01; +3.987905871080131e-01   +1.254630516653517e-01   -2.932451606119806e-01   +2.370072644820857e-01   +5.982638982739950e-01   -1.584793115881140e-01   +5.987115870549765e-02   -1.746322552648699e-01; +2.894720000873091e-01   +3.106618486520684e-01   -3.312633533118988e-01   +4.659580587041777e-01   -4.774064800117888e-01   +1.843871957285424e-01   +2.497411910844091e-01   -1.261608063012603e-01; +5.870118778211271e-01   -2.867224866758234e-01   +2.817964699738825e-01   +5.347071149001945e-01   +2.104857770870788e-01   -2.749381397255667e-01   +5.789879880719130e-01   -6.841914488373323e-01; +3.184044444245644e-01   -4.790010126052903e-03   -5.564706782809458e-01   +2.157402593847202e-01   -2.521567836621551e-01   -2.811822825315065e-01   +1.943045280621950e-02   +8.441367680606759e-01];
L2E_L2I_iGABA_netcon = [+3.451096981789868e-01   +5.395048287787044e-01   -1.635598758205389e-01   -2.026205531707633e-01   +1.583707341807468e-01   +1.910839902968868e-02   -1.696046939618538e-01   +5.804668588499200e-01; +2.747292051979369e-01   +3.583582554077840e-01   +1.836093445485239e-01   +9.426407290741495e-01   +4.750667253391855e-01   -2.720703902519815e-01   -4.595647043603584e-01   +2.199340623698321e-01; +2.563972235046179e-01   +5.868262654742223e-01   -7.370664923323004e-01   -3.926934438836385e-01   -9.580151748256209e-05   +7.969160171877810e-01   +1.572221906417230e-02   +1.001959139042527e-01; +3.062511054527345e-01   +2.757392830426575e-01   +4.889926249184667e-02   +6.330232137799617e-01   +5.702968250563158e-01   -4.043500976364883e-02   -1.809790842332203e-01   -4.963897896516005e-04; -1.866761208344125e-01   -1.363166156594826e-01   -2.606379951246929e-01   +4.462397282180638e-01   +3.921746231428614e-01   +1.246083090453654e-01   -1.205579942950992e-01   +2.559354705473963e-01; +1.000000000000000e+00   +3.270019297515533e-02   +4.111379600515663e-02   +2.278344627044549e-01   +2.289189106916732e-01   +1.762619599512822e-01   +4.255220508847648e-01   -4.078221925960005e-01; -1.721988926604315e-01   -5.288915096445269e-02   -1.772195921060082e-01   +7.743391727089537e-02   -3.138230614237275e-01   -3.538679194686162e-02   +2.681463234780512e-01   +8.010811054133714e-01; -6.740396651837262e-02   +1.839956209454645e-01   +5.034183037248250e-01   -5.715933293139786e-02   +5.422482337810904e-01   +3.454010550451894e-01   +1.258808377818663e-01   +4.210974860931555e-01];
L3E_L2E_iAMPA_netcon = [-2.443571448729969e-01   -2.846920476197920e-01   -3.091057435688048e-01   +3.309260253908979e-01   +9.043262748596678e-01   +3.010788893699026e-02   +9.148613605012998e-03   +9.173325170567260e-01   +3.826108975051640e-01   +3.550173236923312e-01   +2.718463354344081e-01   -5.448505071751194e-01; -2.788657140753213e-01   +8.046127384193882e-02   -3.469479838854631e-01   -8.371115775608625e-01   -4.843465384042843e-01   -1.193146052419657e-01   -1.524224193385960e-01   -2.469279310800319e-01   -8.605472870657985e-02   +5.084090094460679e-01   -1.185150065267493e-01   +6.237076072247364e-01; -8.180960799001268e-01   -1.763492181678405e-01   +6.631385610913054e-01   +8.805718074223368e-02   +2.891772636839331e-02   +6.427945533397830e-03   -2.954572299995478e-02   -1.305382590473698e-01   +4.614546248312912e-01   -4.130141385044298e-01   +8.769630042091709e-01   +3.113744614429419e-01; +5.619040642228972e-01   +4.458735663697106e-01   -1.908115167857081e-01   +5.351672797955529e-01   +7.224234616418398e-01   +3.127494982766433e-01   +1.564350921347548e-01   +7.514006146325503e-01   -1.102287860914604e-01   +2.700305968486106e-02   -2.864974293929274e-01   +3.242880736740608e-01; +9.093703616958312e-02   +4.487498251812660e-01   +7.032203547983346e-01   +4.588155031242164e-02   +4.513129702735138e-01   +5.103321175243377e-01   -1.108344245461185e-02   -3.893939380038746e-02   -5.549947751520187e-01   +5.135270636738826e-01   -1.824859777285284e-01   +9.707207748904112e-02; +8.973350327510653e-02   +3.486571693203768e-01   +4.371352773349859e-01   +1.371690319697764e-01   +7.691130515058817e-01   +4.580935176564565e-01   -2.994917581832246e-01   +1.419685937428947e-01   -4.876109380460409e-02   +2.138609150593788e-01   -1.531869939271982e-01   -2.260093540526099e-01; +5.164540087309593e-01   +4.933675658315388e-01   -1.065061376579700e-01   +2.177678728709566e-02   +2.432602365635844e-01   +4.819257062946541e-01   -2.870029538619073e-03   +3.047710000892213e-01   -2.966224314210678e-01   -4.182955279283582e-02   +5.910752353014711e-02   +4.922594348994794e-01; -1.737077198612738e-01   +6.930710112549731e-01   +1.515026751455421e-01   -5.867548027396118e-01   +3.730370453769209e-01   -2.151751948864075e-01   -1.193130778197989e-01   -1.023894247284355e-01   +3.394376768442877e-01   -2.858168118571764e-02   +6.188560640833879e-01   +1.123131308028575e-01];
L3I_L2I_iGABA_netcon = [+6.349894296452273e-01   +6.244115366467043e-01   -6.510614520240089e-02   +1.755168344746680e-01   -4.002763869771328e-01   +1.218636530047383e-01   +1.000000000000000e+00   +4.811489731247597e-01   +1.915926707567571e-01   +4.878809495017732e-01   -8.302779712105482e-02   +1.205103512984473e-01; -1.087596827708590e-01   +1.405117579702993e-01   +1.252936252236053e-01   -5.299957722036728e-02   -8.746174005710883e-02   +1.379957276330904e-01   +1.739192124281152e-01   +1.376921683083024e-01   +1.512711058744879e-01   -2.784693597350691e-02   +2.433272483430634e-02   +3.239232655811812e-01; -6.788888923670103e-02   -1.794892928515074e-01   -1.038135479156311e-02   -6.628844651731129e-02   -4.546571492909940e-01   +3.028297319946122e-01   +1.251262752797846e-01   +4.740882535186781e-03   -3.191338744559323e-02   -9.735450410891840e-02   +4.039373649035097e-02   +3.469981945905111e-01; +4.545656543023453e-01   +1.104304246030837e-01   +3.878721734106453e-01   +3.587291399718734e-02   +2.815315623828504e-02   +2.798756361139247e-01   +1.322655752812758e-01   -2.642781288822795e-02   +1.551239331614244e-01   +1.934926653867857e-01   +3.015187132250243e-01   +1.632537856717812e-01; +7.580247263217062e-02   +3.823929281242748e-01   +7.831302901360336e-02   -2.961258321168959e-01   -1.934067364424193e-02   +3.396753779949408e-01   +7.190812215484717e-02   +5.628656588423067e-02   +2.160340352108292e-01   +5.518905686074441e-02   +1.730317269058070e-01   +1.774116403048403e-01; -1.414869282121262e-01   +1.013048522293046e-01   +2.362463554604650e-01   -5.834466124192781e-02   -1.444816067226878e-01   -1.469437014733530e-01   +6.053515203725593e-02   -5.348831470019394e-02   +1.581448414453293e-01   -4.246617558124461e-03   -8.087856081974543e-01   -9.923294499389926e-02; +1.541289697904986e-02   +1.836219317032103e-01   +2.838920488380114e-01   +2.185087675865970e-01   +3.071478116813067e-01   +3.702410781072064e-01   +3.211442434652394e-01   -2.435832321034915e-03   -3.663736939348228e-01   +9.180895553309347e-02   +4.846054104700067e-01   -1.605916988449881e-01; +9.758336354495120e-02   +9.865890638290119e-02   +1.153544970878532e-01   +7.279658667426502e-02   -1.287880878870066e-01   +5.035530986333252e-01   +9.420768949116891e-02   +3.821831349451684e-01   +3.437178125443803e-01   +1.013271168927692e-01   +1.741749403729767e-01   +3.098317530097631e-01];
L2E_L3E_iAMPA_netcon = [+7.377178659477865e-01   +3.299034603081030e-01   +4.764821998372440e-01   -5.111481089884339e-01   -3.334593587184280e-02   -5.187657260434870e-02   +5.935096877904917e-01   +3.912035705279722e-01; +4.179994580633399e-01   -1.403968977835821e-02   -1.734788751288493e-01   +1.284158927305854e-04   +8.895386268230813e-01   -5.808401239447882e-01   -6.856845283869443e-01   -5.219544511374981e-01; +1.171618822418653e-01   +2.133643841637505e-01   +3.314548578540539e-01   +4.695478989723899e-02   -1.613039695206615e-01   +2.394857395243475e-01   -1.916295558659633e-02   -2.311823746106822e-01; +4.997442356358595e-01   +3.802432388392307e-01   +6.733503797622231e-01   +8.603856340835936e-01   +7.837016309485499e-02   +4.982244970441265e-01   -2.505123271278891e-01   -3.887446744853702e-01; -1.041501151150831e-02   -1.325960505482965e-01   +1.937071419319504e-01   +3.830752613310930e-01   -1.398307345452321e-01   -2.096854049974226e-01   -1.775719147146235e-01   -4.866121586268843e-01; +1.790887200592359e-01   +3.327015833552091e-01   +1.154137272618803e-01   +6.041579019075286e-01   -2.157376174536920e-01   -4.148717450506847e-02   +1.041029897372289e-01   +1.569539970719379e-01; +1.749175478058394e-01   +5.837054359486351e-01   +7.266136023999737e-01   -2.871341139181137e-01   +5.135401581993549e-01   +1.616715359579305e-01   +4.961555349051270e-01   +6.987086923719449e-02; +2.444709012190041e-01   +4.388903547216883e-01   -1.746788257378626e-01   -5.721234594631086e-03   -2.294058646668277e-01   +1.505529530226977e-01   +3.171824161044087e-01   +4.880212415709702e-01; -2.391370893741684e-01   +5.171609851152794e-01   +4.891240731573651e-01   +5.890744750489931e-01   -1.217885143114018e-01   -1.797775074990969e-01   +2.921103709142082e-01   -1.798206531141774e-01; -1.109920891511418e-01   +2.474739495687813e-01   +4.436703582186926e-01   +1.328165396003587e-01   +2.281776548953090e-01   -5.839958531461648e-01   +6.481234424755733e-01   +1.079985102432752e-01; +5.318747229810690e-01   +4.143075911325676e-01   +3.904791616099509e-03   +2.853487382106856e-01   +3.557447820631215e-01   +7.550476589273756e-01   -2.919042637650190e-01   +2.060524225394683e-01; -2.084084943050654e-01   +1.886444830247402e-01   +6.088517110615388e-01   -2.594806542806478e-02   -1.790241735283012e-01   -1.755310914618746e-01   +1.300017065557761e-01   +3.231907914138863e-01];
L2I_L3I_iGABA_netcon = [+9.930938023192340e-02   -6.662729194815112e-02   +2.827284129635850e-01   +2.623753350349494e-01   +2.334680506698220e-01   +6.167975764989569e-01   +6.414470145130966e-01   +1.715379554410124e-01; -2.892902612792897e-01   +3.228021681757636e-01   +4.640859373348176e-01   -2.155888308887415e-01   -1.665577243988553e-01   -2.045475363951175e-02   +5.425308677926260e-01   +4.364393940872735e-01; +3.622018704336396e-01   +7.401019963772404e-01   +3.515912935640115e-01   +8.127572941958079e-02   +3.527108726267137e-01   +2.847159778476051e-01   -9.104473606063984e-02   -6.767820695314421e-02; +9.794932813321081e-02   -2.016360879115218e-01   +2.082097244704323e-01   +7.258967468199246e-02   -1.340274628734981e-01   +9.826515290410327e-02   +3.663478857826782e-01   +2.477648004325761e-01; -3.794590828696941e-01   -2.117628063700310e-01   +1.717536574301647e-03   +3.616706274047726e-01   -8.073004465648401e-02   +2.038257037949601e-01   +1.995534392189978e-01   -3.245607037244194e-01; -1.398303165697921e-02   +6.928341997563724e-01   +3.224596709449735e-01   +2.748294114038466e-01   +4.006256733337085e-01   +3.256929831923328e-01   -4.313331320205445e-01   -5.164445965572399e-02; -1.066145854971143e-01   +1.000000000000000e+00   +4.351914912271299e-01   +2.757089385405359e-01   -2.286954318383066e-01   -1.977901882277657e-01   +5.351733193972418e-01   +3.512748666923511e-01; -2.350436847786171e-01   +4.011881934566482e-01   +4.250329936040449e-01   +2.758476040223551e-01   +1.091307762723892e-01   +5.450898975714096e-01   +3.927440972562465e-03   +6.469098804657972e-01; -5.003846930770759e-01   +6.756819294418935e-01   +2.073707047377177e-01   +4.701197772060349e-02   +1.870579299998628e-02   -1.112938945941181e-01   +1.646326240423475e-01   +2.256295329322140e-01; -3.664827152274425e-02   -3.767493748623976e-01   +6.257682420807192e-01   +1.879077635835974e-02   +5.335640500315529e-01   +1.873537272365109e-01   +1.156552169170908e-01   +1.050770554418797e-01; +4.189894789588011e-01   -3.596229114526381e-01   -6.710417111446045e-01   +5.070250239399290e-01   +5.813603166674614e-02   -7.321751242369251e-02   +2.286731980401041e-01   +6.200056015345139e-02; -1.994449177714656e-01   +5.093136906414971e-01   +3.586044955422847e-02   +2.660425015095093e-01   +3.512554283335754e-01   +4.791785679120054e-01   -4.052407389181418e-02   -2.367720350857910e-01];
L3I_L3E_iAMPA_netcon = [+2.701345017215667e-01   -9.347073949231803e-01   +1.715449414423877e-01   -2.220358640911934e-02   +1.290978444251406e-01   +4.084710643512337e-01   +1.963229107520196e-01   +3.093461886722937e-01   +7.679351243280458e-01   -4.978648517331936e-02   +3.401651326769337e-01   +5.206334730644021e-01; -1.006894804312198e-01   +3.972436836972108e-01   +1.463569350005926e-01   +3.936017584293954e-01   +4.688607849113908e-01   +8.989971781573677e-02   +6.073365676839753e-01   +9.640659989873677e-01   +5.372892810155371e-01   +9.950750774274440e-02   -8.309238073506733e-02   -3.520267738949474e-01; +2.149506514722812e-01   +2.057632747465628e-01   +3.938809730403472e-01   -9.747866681637084e-02   +9.097867338496973e-01   +2.893827681276131e-01   +5.051314270658634e-01   -2.575545692530133e-01   +7.341970833702132e-01   +4.875279731769042e-02   -1.442685321091884e-01   -1.000007137454609e-01; +2.620946942678177e-02   +9.087020437686414e-03   +3.183194305184607e-02   -2.505443636079048e-01   +4.118840320406826e-01   +6.801689551502137e-02   +2.165517464750487e-01   +6.945916655584509e-01   -1.683518707344497e-01   +4.205319017237042e-01   +5.081140476301135e-02   +5.522355062602665e-01; -4.429042510775130e-01   +2.564006787135658e-01   +7.309345063007887e-01   +5.746847851394481e-01   +1.390106116864432e-01   +2.298368179123045e-01   +2.745466278713528e-01   +1.429055371736392e-01   +4.883592277992486e-01   -8.883640262088116e-02   +2.147459572153593e-02   +2.259210694913147e-01; +1.434387613684916e-01   -1.461055959154199e-01   -4.003691403691186e-01   +1.283139406911402e-01   -6.039690927779422e-03   -3.547514122634347e-01   +5.797744899029530e-01   +1.076311342027286e-01   +1.486530763866718e-01   +5.638351600092221e-01   -2.092100019903450e-01   +8.118050073523175e-01; +3.390789120648872e-01   +2.533545762081328e-01   -1.242914452950088e-01   +1.867940095571720e-02   +4.126213191929851e-01   +3.624531944524190e-02   +3.672079603470533e-01   +5.730125203242989e-02   +2.006716127405291e-01   -1.527481864681340e-01   +4.371679556760839e-02   -2.220414887342360e-01; +3.739954625546398e-01   +3.444082010200186e-01   -8.135034169452281e-02   -1.498106478636676e-01   +3.791238686924713e-01   +4.306789555882932e-01   -2.061703281010380e-01   +2.009509095770514e-01   -2.117655677227749e-01   -3.187399967530997e-01   -6.307246313339110e-01   +4.395884628134095e-01; -3.422703989026018e-01   +5.829272160687958e-01   +3.859572794436986e-01   +8.201204462644126e-01   -6.816073744186463e-02   +6.584064423131688e-01   +3.696589285139679e-01   +1.494390448830330e-01   +3.433095772445517e-01   +5.301293811886154e-01   +1.862187952540516e-01   +4.600788871070345e-01; +1.000000000000000e+00   -5.939433506412151e-01   +3.105186209200133e-01   -3.788136511888500e-01   +1.656102784287941e-01   -4.055199214741844e-01   -9.790588228970977e-02   +2.857737567742356e-01   -3.175720751953985e-01   -1.559544304078932e-01   +5.771568808021899e-01   -1.696481717767387e-01; -3.440797222203573e-01   +7.366761141841343e-01   +4.709936981390914e-01   +1.986335215746398e-01   +1.442721907618144e-01   +1.387495794810588e-01   +5.642735773640726e-01   +3.825071028410396e-01   +4.456094171158811e-01   +2.769041099527796e-01   -1.893459766301692e-01   +6.617362389846411e-01; -1.936206895941823e-01   +3.743839939359039e-01   +1.569274049852586e-01   +6.949508313867983e-01   -3.369186392615892e-01   -1.656494421072819e-01   -1.560628548784866e-01   +4.707159367738476e-01   -9.415020224065468e-02   -1.739002839236297e-01   +4.299218497666633e-02   -1.041645112485262e-01];
L3E_L3I_iGABA_netcon = [-5.206579546526541e-02   -4.022359711410102e-02   +1.592540930076199e-01   +2.447133848653743e-01   +1.148485782517814e-01   +6.609712424994017e-02   -1.792974414391155e-01   +1.606222732872807e-01   -1.094636294634733e-01   +4.571826968881575e-01   +5.631220092624682e-01   +2.510356653668452e-01; +2.929447526253650e-01   -3.262979145003843e-01   +2.093409795769985e-01   +3.160247807821067e-01   +3.237465354762631e-01   -2.756831558317924e-01   -6.177124594028707e-03   -2.022141873703130e-02   -2.747291255818604e-01   +6.699539310698915e-02   -5.046899142690928e-01   -1.193449544153764e-01; +2.642026733040105e-01   -3.040867268545743e-01   -4.237353879247001e-01   -1.820476135040556e-01   -1.341853690541693e-01   +4.497572739628214e-01   +2.905188916490424e-01   -1.271715996167652e-01   -2.375842295057259e-02   -1.597244906253021e-01   -2.390853334923462e-01   +1.874834451969507e-01; +8.311412874832957e-02   +5.796394850185448e-02   -2.308211516008310e-01   +4.632370959578557e-01   +9.391016241538969e-01   -1.502969425968523e-01   -1.669106362626287e-02   +6.162278845558600e-02   +8.948346834390525e-01   +2.965947521914799e-01   +5.901493320903245e-01   -2.101761620914677e-01; +1.319689989172178e-01   +3.297818051096059e-01   -1.111802738953227e-01   +2.570250102980846e-01   -1.830246821409467e-01   -1.707130272222085e-01   +3.035629819087981e-01   +3.809838296999974e-01   -2.211031558443403e-01   +7.685360984318239e-01   +3.262226012291446e-01   -2.748849707914497e-02; +2.702463910865337e-01   +2.329112807535040e-01   +7.000459519358082e-02   +2.988136037158182e-02   +1.318716950781006e-01   +2.098150922304836e-01   +3.075839607663283e-01   +1.978809511831506e-02   +2.004278361189940e-01   -4.052273094828453e-02   -1.893033437530452e-01   +8.165036106253148e-02; -3.875486077904992e-01   +1.670496959454813e-01   +2.818559279342646e-01   +6.616966429203355e-01   +1.443934364544931e-01   +4.688626337787514e-01   +4.303256522340446e-01   +8.280836442289538e-01   -5.241605781184843e-02   +4.059432076847723e-01   +3.536042935780593e-01   +2.470654519220794e-01; -9.800706296177769e-02   +1.864123328240443e-01   +4.842287117309428e-01   -2.807547466498305e-01   +1.349910811288027e-01   -3.869526454182070e-01   -5.780925878122922e-01   +5.245249282563862e-01   -2.347342786421181e-01   -5.745186100624600e-01   +4.599511172461355e-01   +2.389242125494232e-01; +3.396471548200526e-01   +2.453412298203753e-02   +4.873900378107780e-01   -3.908510313255388e-01   +2.773057981340407e-01   +3.030979391721869e-02   -5.801724838735669e-01   -6.811882638072300e-02   +1.530142178548191e-01   +5.331335407545961e-01   -1.153984360318828e-01   +5.442057449750098e-01; +2.665046738628692e-01   -1.002458832361178e-01   +1.090641357118830e-01   +5.823490073513810e-02   -3.506566094970044e-01   +1.654988353373205e-01   -3.426986759930833e-01   +2.029074488615397e-01   -1.854399912672748e-01   +3.743923428749948e-02   +3.323769658070642e-01   +1.843336215905859e-01; -1.379839304647014e-01   +1.920273866932937e-02   +2.337179066789375e-01   -2.097194886488021e-01   -1.449018752837297e-01   -7.525078829716216e-02   +1.646831056138354e-01   +1.252722082212702e-02   +1.971680560793158e-01   -4.896181560169244e-01   -1.241438366171528e-01   +3.899578648407016e-01; +1.855113648073568e-02   -1.604575523826934e-02   -3.191897444112592e-01   -2.856580399090387e-01   +9.086136140549742e-01   -1.154352920434667e-01   +4.524635088319369e-01   +5.712374707531460e-01   +2.525477362017480e-02   -4.150875884868607e-01   +2.408825256777466e-01   -6.018971810340472e-01];
L2E_Input1_iAMPA_netcon = [+7.444935711697337e-01   +9.280712052410031e-01   +9.307006622817817e-01   +1.637176689842504e-01   +3.226789986538630e-01   +4.919894628313518e-02   +7.211416449128376e-01   +5.338301821315018e-01];
L2I_Input2_iAMPA_netcon = [+5.315068867510180e-01   +9.029395925938436e-01   +1.060062109813907e-01   +2.901000681386460e-01   -6.518357976181735e-02   +6.719248471739552e-01   -2.603869711720542e-01   -4.443573531444922e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
