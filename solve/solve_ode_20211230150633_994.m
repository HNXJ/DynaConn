function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.354593643307027e-01   +2.609559028798494e-01   +2.039058757195112e-01   +7.953005586564097e-01   +1.210959611933918e-01   +1.865321664989998e-01   +4.790413237165617e-01   +7.355036324653212e-01   +3.372088223985419e-01   +4.322878082487379e-01   +3.881161696725348e-01   +5.518266954262246e-02   +6.743436303787917e-01   +1.974847746018402e-01   +3.326405754164277e-01   +3.623319237732069e-01; +2.869921340933564e-01   +4.456448794997632e-01   +5.648969261184482e-01   +7.706002838058758e-01   +4.036747811630650e-01   +6.519914574560147e-02   +4.621105625191291e-01   +3.620862246585563e-01   +2.327920547169997e-01   +2.107344327074991e-02   +7.030833779070818e-01   +5.672918062401850e-01   +4.163422709649235e-02   +2.802215997678286e-01   +4.852778285280708e-01   +2.484820374965123e-01; +4.487573723292648e-01   +5.857273906152873e-02   +2.234585916968266e-01   +3.560077295084507e-01   +3.799851795131508e-01   +1.641239404380423e-01   +5.421165034940995e-01   +7.413824377261128e-01   +2.068977985591839e-01   +7.206155132546050e-01   +2.106691206066891e-01   -3.856634774830672e-02   +3.615859235039247e-01   +7.890661202959642e-01   +1.070876704190182e-01   +4.451486311549734e-02; +2.140908039518878e-01   +7.892893115044981e-01   +2.482591314055307e-01   -2.545074802803222e-02   +9.960300194816496e-02   +7.274602035240044e-01   +4.868355608975815e-01   +4.721799314595334e-01   +5.314720671950942e-01   +6.903069443068007e-01   +1.244714542934093e-01   +1.884865143622446e-01   +1.124924037105039e-01   +1.141441032861328e-01   +6.219010034318945e-01   +4.319746522314116e-02; -4.834313705220696e-02   -1.385846463193954e-02   +4.599845416279358e-01   +6.405392159275469e-01   +3.823388655882086e-01   +2.448342103487048e-01   +3.921379003851194e-01   +2.496626340306064e-01   +5.051385324129490e-01   +4.926350587570659e-01   +4.607028954208409e-01   +9.621070213431654e-02   +2.831823244722661e-01   +3.879624851654034e-01   +3.380291069434749e-01   +9.075385380712105e-02; +2.185082034328825e-01   +6.159289853987248e-01   +6.101867234976128e-01   +1.497617275449861e-01   +7.230661646540470e-01   +2.545431552118007e-01   +3.388699875208658e-01   +4.921952215538962e-01   +7.014565536481857e-01   +6.181389730105843e-01   +4.615618019328718e-01   +4.569949694072244e-01   +7.459120466866258e-01   +3.176566460233619e-01   +7.984107590985949e-01   +7.712192809235989e-01; +6.661772751134167e-01   +4.003118994075077e-01   +7.611103424195975e-02   +1.017569849010598e-01   +6.810570764334357e-01   +9.646176448227514e-02   +2.987969709293427e-01   +4.114421339852666e-01   +1.529613974901053e-01   +3.285151609589329e-01   +2.431236095900797e-01   +4.655231766071233e-01   +1.729664780630803e-01   +7.694192117052790e-01   +4.249359016963578e-01   +7.561343846044942e-01; +5.478122799790920e-01   +3.006564008697304e-01   +5.246359139413853e-01   +5.187310197107396e-01   +5.931785622870822e-01   +4.244871649046339e-01   +6.831776042315023e-01   +2.648766504775315e-01   +2.709108154142044e-01   +4.125807020521534e-01   -1.190267725899586e-02   +1.667182278112191e-01   +3.879347288575261e-01   +3.197815551767788e-01   +9.865578590167007e-02   +4.330682692135278e-01; +5.108035818124624e-01   +5.506679561490277e-01   +2.631353901495105e-01   +6.462829955149050e-01   +1.676087982388197e-01   +2.192941220424963e-01   +7.830034137142771e-01   +4.871287728799870e-01   +7.177404994546205e-01   +5.831108069077003e-01   +5.812863646777137e-01   +4.349387233242972e-01   +7.942183578021684e-01   +6.104416893002448e-01   +6.655518504954493e-01   +7.223189943913695e-01; +4.832676539293728e-01   +1.457024984669670e-03   +1.813787884221746e-02   +4.769220674071045e-01   +3.032437015743211e-01   +3.595928737349324e-01   +5.823778539370099e-02   +3.668862272161366e-01   +5.390078985270069e-01   +7.008637026620276e-01   +6.666112980905350e-02   +3.606126435663130e-01   +6.971131535123463e-01   +1.930593632521561e-01   +7.478558601369427e-02   +6.132435379186553e-01; +2.974449065533453e-01   +2.106964897383190e-01   +1.823806213120241e-01   +2.917912114688146e-01   +5.354238533018384e-01   +4.646686909638199e-01   +1.306787926236656e-02   +3.569861810079983e-01   +1.674478620274495e-01   +7.864163009833682e-01   +6.468134329675659e-01   +2.227327078448013e-01   +4.689293470242704e-01   +4.924664793160431e-01   +6.007340425754027e-01   +2.029874328638022e-01; +4.060837010500399e-01   +4.481379352081010e-01   +1.731418648999482e-01   +7.494116002760469e-01   +2.876803681929487e-01   +6.669080918000070e-01   +5.725404081771808e-01   +7.719723180370768e-01   +1.476772265171498e-01   +1.057461979392088e-01   -1.928263062425308e-02   +3.743943916662861e-01   +7.643856008460982e-01   +6.314042624752990e-01   +3.835725670761894e-02   +2.758105954798116e-01; +8.320787377822686e-02   +5.036794401002003e-01   +3.962068424805200e-01   +2.527289556823116e-01   +5.310792958731798e-01   +4.965929169347417e-01   +5.794819349354000e-01   +2.606866178832387e-01   +4.273763959693237e-01   +5.268678483395175e-01   +6.538121841375323e-01   +3.816460079780384e-01   +2.097965412518386e-01   +7.328886854605566e-01   +4.915420435741165e-01   +2.618574896778475e-01; +3.046500111036415e-01   +4.427959074778606e-02   +2.811514636689438e-01   +2.686487614742104e-01   +4.034630099328433e-01   +7.344657438827515e-01   +7.705243524488948e-01   +3.533588248331569e-01   +2.012938865647812e-01   +5.282148005720312e-01   +1.009880668533740e-01   +8.144310198423628e-01   +3.289493218592638e-01   +1.147569770642995e-01   +3.781691457322813e-01   +5.874453443356270e-02; +7.660674285682336e-01   +4.098750744151317e-01   +6.773298483298223e-01   +4.094525187793677e-01   +7.754836899767878e-01   +3.050666043819653e-01   +3.056220917263809e-01   +3.576275755244766e-01   +8.346444295906291e-01   +6.168710198654099e-01   +4.951464088100955e-01   +5.105973470726527e-01   +2.132855689821780e-01   +6.043624278964481e-01   +8.663955064992468e-01   +3.528954960192617e-01; +6.245969950881362e-01   +1.479814751853160e-01   +5.912916170679989e-01   +3.301215077550431e-01   +4.524262434896814e-01   +9.649637859787152e-02   +6.212455924257252e-01   +2.892394792305558e-01   +1.267260756842088e-01   +6.945556848947404e-03   -4.080881362312227e-03   +8.845403292214740e-02   +7.705106235918868e-01   +1.597354440730729e-01   +4.748968681490963e-01   +5.842560325580270e-01];
L1E_L1I_iGABA_netcon = [+3.177288397219470e-01   +4.910537377244132e-01   +7.029505507272754e-01   +2.974370067843302e-01   +3.143570067105978e-02   +3.093297150756334e-01   +5.683227552970881e-01   +8.129468209227083e-01   +4.761192565159146e-01   +2.718029589228905e-01   +7.171205652122903e-01   +3.758458018062998e-01   +3.492327519883459e-01   +3.417507955829747e-01   +5.311958778318139e-02   +3.526613350198445e-01; +3.754247517605828e-01   +7.712329363485814e-01   +3.922545450253999e-01   +2.163326304090131e-01   +6.011809902742085e-01   +3.965289715561721e-01   +8.244358767678992e-01   +7.291390016751351e-01   +6.282167866614830e-01   -3.991097061363495e-03   +8.665358083017501e-02   +2.921966663955585e-01   +5.542111666925822e-01   +4.513639500962613e-01   +1.985246036606818e-01   +1.628795044708241e-01; +5.075683598620374e-01   +3.048119950517621e-02   +3.736057336637983e-01   +8.090164655719169e-01   +9.458853798719426e-02   +1.747649122774701e-01   +2.422109599100840e-01   +1.968987164388835e-01   +3.521063460010585e-01   +4.718110653262473e-01   +4.131624008970708e-01   +3.250403217093534e-01   +1.691301136804901e-01   +4.242374888141625e-01   +9.164317583095280e-02   +3.001416457357919e-01; +2.559754491129607e-01   +2.676599943793986e-01   +7.595339035753723e-01   +4.501045774607562e-01   +2.112867769870447e-01   +6.164963637934707e-01   +7.641806524974044e-01   +8.492790451947773e-01   +1.228147527540530e-01   +2.967793768884563e-01   +6.152944507733956e-01   +8.075688611866573e-01   +6.884383234207217e-02   +4.900101961976639e-01   +6.503583932147782e-01   +5.491906912593748e-01; +2.287276848274315e-01   +1.521509792165956e-01   +7.479155713216764e-01   +4.854122195432846e-01   +1.148779487077608e-01   +5.207815939155228e-01   +8.436583470155288e-01   +3.201556616991232e-02   +3.635642072414150e-01   +4.538835615687596e-01   +1.252437920300457e-01   +2.169838182072352e-01   +4.688411103910962e-01   +1.929498847715402e-01   +3.155656117962513e-01   +7.449433277166113e-01; +6.014290854243493e-01   +5.697223857235996e-01   +5.426485557245581e-01   +5.734726613979411e-01   +1.479907136873871e-01   +7.610794298653473e-01   +6.405549649727402e-01   +3.347609786722179e-02   +4.254256203698455e-01   +4.695629577346678e-01   +1.121222943828316e-01   +8.258084723269080e-02   +6.281692129269100e-01   +4.822601297129465e-01   +5.379715369679248e-01   +5.896188117359411e-02; +1.255109347970082e-01   +2.768973271011161e-01   +1.346173542803025e-01   +3.641349112796732e-01   +2.757134372901963e-01   +4.274172399136827e-01   +5.585577763733907e-01   +5.672551609002269e-01   +2.488508769332636e-01   +5.197363138360346e-01   +4.222265722435369e-01   +6.653942112588438e-01   +4.883560216831111e-01   +6.261539382590056e-01   +2.352421187289535e-01   +3.350825303028575e-01; +6.029716650144124e-01   +2.513157493958407e-01   +5.996381400798385e-02   +3.910471559397571e-01   +1.164981378276034e-01   +2.075372431970308e-01   +5.115398854724772e-01   +2.451927810640901e-01   +6.030205305332864e-01   +6.740270191577110e-01   +3.450141002848498e-01   +2.750624385044681e-01   +2.806078424054266e-01   +6.216595761545262e-01   +4.077445791754133e-01   +1.680032830866707e-01; +1.856936600323078e-01   +8.170859892836557e-02   +6.007392369111605e-01   +4.572040832516895e-01   +2.811678792856013e-01   +1.424617855451473e-01   +4.596652790333072e-01   +6.028856732965792e-01   +6.826912400799994e-01   +2.104464713029509e-01   +4.832474211451968e-01   +3.966917188591524e-01   +2.050804680827344e-01   +1.089347303123857e-01   +3.933274324055580e-01   +3.508223881259802e-01; +6.596202363477888e-01   +5.702048666542966e-01   +5.044190302884002e-01   +8.180270867996526e-01   +1.940146361938058e-01   +6.277857195115921e-01   +2.255406757295700e-01   +5.171917051885246e-01   +8.482927897030479e-01   +3.388979584678539e-01   +4.058714490990324e-01   +2.551232672516150e-01   +3.710462930902054e-01   +7.898658977677492e-01   +6.942338739529776e-01   +2.775691891162739e-01; +7.210824366541004e-01   +6.350114356416640e-01   +6.787371945784906e-01   +3.456218314585937e-01   +7.445354956213627e-01   +2.484366455097333e-01   +2.241578383241920e-01   +6.923839346861648e-01   +3.490437826080477e-02   +2.934106983252636e-01   +3.035663598455745e-01   +1.251388723921711e-02   +2.748739006523058e-01   +5.331689160154568e-01   +3.468587804163222e-01   +2.767357778482619e-02; +5.833439144274142e-01   +1.681753323511205e-01   +5.990683172015984e-01   +6.754074995206535e-01   +1.979845318794755e-01   +1.198576630736069e-01   +4.901375951744549e-02   +7.741887646901059e-01   +4.535782402500357e-01   +6.908444733360686e-01   +6.451239627720783e-01   +5.741523988726589e-01   +1.582442385971013e-01   +7.793284422528880e-01   +6.946450081962803e-01   +1.712223564591523e-01; +5.043502405551448e-01   +2.578815661897244e-01   +3.017609881703333e-01   +7.441045837830994e-01   +5.441873245792638e-01   +4.594823470499314e-01   +6.110550381894760e-01   +2.236703704097987e-01   +8.126101239632815e-01   +3.946424267062974e-01   +6.143036360104279e-01   +6.439492785684147e-01   -5.363013444659161e-02   +1.823485412782617e-01   +1.890839987563198e-01   +7.839289588643529e-01; +3.775937711979166e-01   +1.172296691282181e-01   +9.909238126171950e-02   +1.350177251382803e-01   +3.099003906408117e-01   +2.639302621231066e-02   +3.800926821220681e-01   +7.207278681552356e-01   +7.332204207928431e-01   +1.105349990366144e-01   +4.658170085577908e-01   +2.565721933585415e-01   +7.191953138667033e-01   +6.450467324748902e-01   +4.895051367453094e-01   +8.665023762897314e-02; +7.601876110169801e-01   +6.187746042442199e-01   +8.391427233266984e-01   +2.385123592008748e-01   +5.594090184585443e-01   +3.768493992472026e-01   +7.587663901292261e-01   +3.519049909859287e-01   +4.183511515441555e-01   +4.643437064097497e-01   +9.474628756360008e-02   +6.298442268262355e-02   +8.310957755796200e-02   +1.661720408263634e-01   +6.757801996156901e-01   +4.615373621158911e-01; +4.145576340743440e-02   +3.135228380955286e-01   +5.609780342197754e-01   +4.947959028905781e-01   +5.404468650594368e-01   +6.498314997464429e-01   +6.164765066579304e-01   +1.380301640006833e-01   +7.650697675719799e-01   +7.363923139744250e-02   +7.013454387456521e-01   +7.543478766971060e-01   +3.675854107813373e-01   +8.350936913209450e-01   +1.106419103919401e-01   +3.676123472097909e-01];
L2I_L1I_iGABA_netcon = [+1.531031424783225e-01   +6.508689866079721e-01   +2.612369680598536e-01   +9.009590316974503e-02   +3.778331660248672e-01   +3.275026916917064e-01   -3.041103222591109e-03   +5.928890207088384e-01; +3.815957687159358e-01   +2.060414852209231e-01   +7.160685870829189e-01   +2.447212377382444e-01   +1.229066809829014e-01   +5.017809664503032e-01   +7.676495752080719e-01   +3.342848249445228e-01; +6.841423749380957e-02   +1.567055573845555e-01   +4.344255395236351e-01   +7.390474013543311e-01   +6.285011094444466e-02   +5.037750525097540e-02   +3.256812338560726e-01   -5.131551886461903e-02; +4.947490277718710e-01   +3.834040593502922e-02   +1.442405059046865e-01   +7.810250462267865e-01   +1.999393690122190e-01   +2.954653873124865e-01   +1.122014321472011e-01   +3.996246992428454e-01; +6.237095986254555e-01   +2.784210720167200e-01   +2.663640145023327e-01   +4.520706035174293e-01   +7.808325737854436e-01   +5.427990465993433e-01   +6.571577357931522e-01   +7.249731741058520e-01; +7.738382748433736e-01   +8.763047968844095e-02   +1.046871234624622e-01   +4.158178900922622e-02   +7.188810963061194e-01   +2.937887042703932e-01   +2.861866173229402e-01   +4.541338029732327e-01; +4.193047558275093e-01   -3.750355650216551e-02   +6.517853278570247e-01   +2.586115800477919e-01   +2.069206371406989e-01   +1.466042417385799e-01   +5.851285102426366e-01   +5.250684532640694e-01; +1.513234103387325e-01   +2.603874198256615e-01   +8.224193163729066e-01   +2.003850711536360e-01   +1.977726364454869e-01   +6.288364149865902e-02   +2.929456099561586e-01   +3.787977335762254e-01; +7.693535775734105e-01   +5.059042393259366e-01   +4.743834317472038e-01   +7.608473125198495e-02   +5.199541213793655e-01   +7.334244235038552e-01   +5.319938780076957e-01   +8.723966430349160e-02; +2.244152315352031e-01   +3.455639283728472e-01   +6.164380938479335e-01   +2.564926616359833e-01   +4.285944505556439e-01   +5.039403601971286e-01   +3.359159756251515e-01   -6.403617007740035e-02; +5.499200676516859e-01   +6.918453880671086e-01   +2.262609284496638e-01   +7.233153836052491e-01   +2.300119648137768e-01   +4.039666391610258e-01   +7.273177144181384e-01   +7.616577208509356e-01; +7.165689646082534e-01   +8.021210215891079e-01   +1.320225637505324e-01   +6.229994964735336e-01   +6.245096983794719e-01   +3.721805605497870e-01   +2.203971120326142e-01   +6.515102969710432e-01; +5.390860907195769e-01   +7.676898937811309e-01   +6.981452588502141e-01   +6.596491270428322e-01   +5.031770513779743e-01   +2.255812395565945e-01   -7.208647152284300e-02   +4.657157472875624e-01; +7.220325345514099e-01   +6.755615429968724e-01   +6.764863652278608e-01   +6.770475042290565e-01   +6.856692092471747e-01   +7.153480072677497e-01   +1.419074417724895e-01   +3.560326740333345e-01; +4.346859286017640e-01   +3.886240977258863e-01   +4.548840564484066e-01   +4.043381206616718e-01   -1.951982700162493e-02   +1.850831700657652e-01   +3.855957362058479e-01   +5.270526172361774e-01; -9.179895118531078e-03   +6.352705500387630e-01   +3.129561108398736e-01   +6.737656100128299e-01   +6.493221287263865e-01   +4.059132202108491e-02   +6.166903689139868e-01   +1.753636029099920e-01];
L1I_L2I_iGABA_netcon = [+1.000066750857189e-01   +7.558752208594639e-01   +1.830628410581912e-01   +5.264113949849216e-01   +6.187862170139589e-01   +1.003151804762389e-01   +3.692325994575208e-01   +2.716286702135361e-01   +2.247550692601039e-01   +8.237568950409499e-02   +3.878181104112151e-01   +4.243772414932613e-01   +4.546931147123480e-01   +3.157448888342566e-01   +6.879265603786179e-01   +4.655033316701765e-01; +2.690986102608829e-01   +6.549627576403751e-01   +3.210918181544061e-01   +1.745097403239421e-01   +7.925370311418998e-01   +6.130999208727334e-01   +6.050209718052326e-01   +7.332257726881238e-01   +2.676641062622795e-01   +1.968699644300881e-01   +7.379441131217782e-01   +4.972520330870696e-01   +3.458640705498169e-01   +3.213939773722553e-01   +5.286445427918185e-01   +6.763562031358521e-01; +2.447347455747283e-01   +2.075422325754744e-01   +5.837564436759949e-01   +6.388633253459783e-01   +3.608698758049920e-01   +4.784524041849441e-03   +7.969008438496447e-02   +5.551141820400292e-02   +4.286658845509241e-01   +3.172570163445102e-01   +4.491693217804610e-01   +5.334590288551334e-01   +4.217702321060356e-01   +5.075974531311478e-02   +2.156049774637996e-01   +6.686427568444541e-01; +4.341736025815464e-01   +5.767437024096628e-01   +5.746810818310757e-01   +3.551187638365556e-01   +3.679405918861532e-03   +3.948344306201407e-01   +2.984513724952558e-01   +8.375526247155536e-01   +2.589974997085196e-01   +6.125151807590381e-01   +3.750879186459599e-01   +4.210411316754916e-01   +1.542665386627631e-01   +7.044473531045995e-01   +5.154617819496627e-01   +3.981439593805779e-01; +8.656122120542822e-02   +8.115393610079763e-02   +7.543288277382795e-01   +4.484510464056263e-02   +6.712849882431431e-01   +7.244256923415503e-01   +1.098151809027303e-01   +3.113368228436444e-01   +5.031453049913505e-01   +1.816251635104179e-01   +5.965296253822480e-01   -2.069130442368015e-02   +6.670073279098008e-01   +4.079317367074538e-01   +4.746578194121885e-01   +4.139435855902469e-01; +2.409528976497806e-01   +5.100593592502967e-01   +1.917767347155962e-01   +7.590101599971369e-01   +6.926266734506761e-02   +8.091086730562675e-01   +6.505725653367771e-01   +1.175608360739313e-01   +2.233376893847783e-01   +5.618318725685990e-02   +7.274917697325947e-01   +2.945573498757625e-01   +3.014420471579100e-01   +4.425965488833051e-01   +1.481987367980944e-01   +5.900360153789617e-01; +1.859282585498904e-01   +9.635029418128756e-02   +4.937051004445201e-01   +1.880480610766090e-02   +3.321091917712952e-01   +4.243179078252848e-02   +7.457315922256995e-01   +5.005071781791601e-01   +6.836949175198024e-01   +4.725185120972345e-01   +1.854846567455196e-01   +4.045735888766347e-01   +3.472558623308770e-01   +2.667755688458583e-01   +7.514224278709050e-01   +6.771777896059862e-01; +3.499267060228291e-01   +1.616417364195966e-01   +7.786843433943412e-01   +1.680164995847660e-01   +3.660348522999797e-01   +4.226176511009508e-01   +1.071930922255895e-01   +7.140051888983483e-01   +8.672636634038399e-01   +2.516404235479681e-01   +5.356017610320232e-01   +1.403142992485829e-01   +4.408770409722189e-01   +3.513499285958747e-01   +5.578548934551388e-01   +4.600132114269556e-01];
L2E_L1E_iAMPA_netcon = [+6.725817890885721e-01   +3.987911219641935e-01   +9.911947752085772e-02   +6.279314267414229e-01   +2.781901885633724e-02   +6.488516477327655e-02   +4.596962159161336e-01   +3.387676387594487e-01; +7.046621825185140e-01   +3.675055428594260e-02   +6.961726842806767e-01   +2.258278796047264e-01   +6.627044657609873e-02   +2.259546631632729e-01   +4.834120092406417e-02   +1.371951010711183e-01; +1.509787481025222e-01   +7.431196052827870e-01   +7.283620252326792e-01   +5.573416931580292e-01   +8.561634764332547e-01   +2.772230139587873e-01   +3.186665989176913e-01   +2.936909558433047e-01; +2.025189876654012e-01   +7.422929891552595e-01   +6.014073365243047e-01   +1.470541893866454e-01   +1.705735329558943e-01   +7.031905844707105e-01   +8.880290842061833e-02   +2.322167378859691e-01; +2.683523963486016e-01   +3.974990351723081e-01   +3.437514827203763e-01   +7.475163054745055e-01   +6.849683545336263e-01   +6.975219764667234e-01   +1.447448401694217e-01   +5.371833369093881e-02; +2.591708250638298e-01   +1.253448398988313e-01   +8.291708617708392e-01   +2.695680682831244e-01   +5.316371770563135e-01   +5.354292168274707e-01   +3.430224384115692e-02   +8.919362194367927e-02; +5.041203894121955e-02   +6.593553301048451e-01   +4.252926699976597e-01   +6.805684374650183e-01   +1.729254787696200e-01   +1.938547310795972e-01   +4.782398764533695e-02   +2.962293093666436e-01; +1.325637555301993e-01   +2.997066173629939e-01   +5.904327411169148e-01   +5.071609185218383e-02   +2.697196623785412e-01   +5.224273620767537e-01   +4.644317850160754e-02   +1.382498465094596e-01; +5.970419486733123e-01   +4.811859723027006e-01   +4.826765750672675e-01   +6.379921016332084e-01   +6.978546531260073e-01   +2.738126836714633e-01   +1.752409347812660e-01   +7.562114196046976e-01; +3.460794873027624e-01   +1.739794360007721e-01   +5.447052128580789e-02   +5.461502500980235e-01   +7.343644127376073e-02   +7.646841334416714e-01   +6.233088850843178e-01   +6.607821466628110e-01; +2.462036259316243e-01   +5.528198306382755e-02   +1.690847498506401e-01   +1.193734288937033e-01   +5.334684503048245e-01   +1.434667487723014e-01   +2.623447130435682e-01   +1.895337389249933e-01; +2.863468591258191e-01   +1.904169413682845e-01   +3.458865915734374e-01   +1.170026796470665e-01   +2.220394919158489e-01   +7.828180604542284e-01   +4.288371386972094e-01   +4.837665156875742e-02; +7.397337404284619e-01   +7.189325884795923e-01   +1.547509651738929e-01   +2.769474995613356e-01   +2.292256530857349e-01   +5.710146529366179e-01   +3.461105259361467e-01   +8.580082834395905e-01; +2.577843719933516e-01   +4.957635647240464e-01   +5.421796551812850e-01   +5.728144637944113e-02   +1.679269258851987e-01   +2.633346482430415e-01   +4.277156522874699e-01   +2.727930241453853e-02; +7.433556842508359e-01   +6.789100740947623e-01   +2.552964808083463e-01   +3.059929514124800e-01   +2.240213138087501e-01   +2.501332961971959e-01   -5.364013752885541e-02   +7.098504693855415e-01; +7.696906421123018e-01   -4.258753201607900e-02   +3.884907869438298e-01   +3.790547272393571e-01   +6.702578507148013e-01   +5.860441993434834e-01   +3.597715032726494e-01   +7.556944455316169e-01];
L1E_L2E_iAMPA_netcon = [+4.886875219669206e-01   +3.123803263559264e-01   +3.765153307252786e-01   +3.245448822561712e-01   -1.404942878121967e-02   +4.140362623359353e-01   +3.442314709342352e-01   +7.737930672744323e-02   +1.329769728711727e-01   +7.036265702929269e-01   +7.316661299819941e-01   +6.799475202276681e-01   +5.813490209852924e-01   +7.119710632471252e-01   +2.523115899041716e-01   +2.046682361444840e-02; +7.034806883485747e-01   +1.367641080466694e-01   +4.999234666591299e-02   +5.912465502425404e-01   +4.800012830612188e-01   +3.801271011228319e-02   +3.416409845399381e-01   +2.841416734377484e-01   +5.863938349590581e-01   +5.999529684826245e-01   +5.558594121801653e-01   +6.642649287914113e-01   +1.053722566269867e-01   +6.502273017865449e-01   +1.855493010604474e-01   +6.354335924738068e-01; +3.796525706780504e-01   +4.988891416270537e-01   +1.450793524876148e-01   +2.550631441043788e-02   +5.939388367880348e-01   +2.864835561190104e-01   +6.116462897327909e-01   +2.300143882216697e-01   +1.628305513236360e-01   +7.603508748190699e-01   +7.745867769872079e-01   +2.067021784770312e-01   +3.052934293602397e-02   +5.240806022060240e-01   +3.793009679676648e-01   +4.752126802118537e-01; +6.665993756116309e-01   +8.419098129999655e-01   +1.165754795301213e-01   +3.928873360329708e-01   +2.152490398361060e-01   +2.981467662412099e-01   +4.362118211488998e-01   +1.249684389121734e-01   +4.428865148201902e-01   +6.413598736842537e-01   +4.798163307828487e-01   +5.711557445986049e-01   +7.141203401479508e-01   +4.814846824318569e-01   +1.638657412641830e-02   +2.835304945665226e-01; +1.897357827660743e-02   +2.876316090020888e-01   +1.154650670669096e-01   +5.076836049267166e-01   +6.570188650333141e-01   +8.443513477610861e-01   +6.364500408794349e-01   +4.501690392839315e-01   +2.656818065784938e-01   +7.040032521674388e-01   +4.859293917829731e-01   +4.855488223724228e-01   +6.035676359109622e-01   +5.543511799970160e-01   +8.879811137076822e-02   +6.293613167113133e-01; +4.023794996005648e-01   +5.506986395358471e-01   +7.575753845228568e-01   +5.885394819460648e-01   +5.275316187942156e-01   +1.084038017648770e-01   +5.661267716168518e-01   +1.956841646576026e-01   +4.391139022252418e-01   +6.866851177275008e-01   +4.746063264363580e-01   +5.291642084865977e-01   +7.301207964330261e-01   +8.239071254764030e-02   +3.183566271420383e-01   +5.423294832276685e-01; +5.771417246169080e-01   +4.434457209599088e-01   +6.609947028891571e-01   +5.164383435690655e-01   +3.730608768431719e-01   +1.991191009075804e-01   +4.174926587635737e-01   +2.970500950762467e-01   +6.895213488154558e-02   +3.257054946379792e-01   +1.441052925245813e-01   +6.302549640471941e-01   +5.360418274722107e-01   +8.251236001268318e-01   +2.783672697880512e-01   +1.655945980889233e-01; +4.361471827252443e-01   +7.785830892481302e-01   +5.106904155729804e-01   +2.791604162239766e-01   +6.666021568698410e-02   +2.009299378058116e-03   +6.751944401628331e-01   +2.186942794200950e-01   +4.904902682002305e-01   +6.634552440350232e-01   +4.024859600873540e-01   +4.431704829171597e-01   +7.491347343905842e-01   +1.499599260835981e-01   +3.452861106847416e-01   +5.354936061816730e-01];
L2I_L2E_iAMPA_netcon = [+2.562798223887469e-01   +6.303338042345399e-01   +1.747864736907402e-01   +3.107125803605745e-01   +1.505013032301737e-01   +2.986912684757120e-01   +1.032332876691567e-01   +4.188217240342886e-01; +5.238708117068811e-01   +8.739403354890493e-01   -1.123691435455193e-02   +7.846913702425570e-01   +5.843915097226221e-01   +4.488482506615627e-01   +7.491581037827217e-01   +4.146319889007141e-01; +2.699668444286492e-01   +4.780445670674209e-01   +1.602857913337676e-01   +3.661899058275974e-01   +1.861456281069986e-01   +2.095535026531492e-02   +4.941385868263422e-02   +4.931662011897326e-01; +7.851322375142935e-01   -1.996033731337679e-03   +3.999041067087128e-01   +5.045709186751730e-01   +6.906796256190952e-01   +2.653652966493270e-01   +6.580387813766410e-02   +7.255106927797015e-01; +1.575439495031140e-01   +8.253417463520157e-01   +1.673899644529596e-01   +5.712451129243383e-01   +8.089455049650883e-02   +5.216054216904663e-01   +4.131340122302362e-01   +6.828072194013803e-01; +5.149974695315144e-01   +3.870321390708172e-01   +5.235717022530172e-01   +4.080014374912200e-01   +6.676234970594005e-01   +7.427804389964918e-01   +4.865007536002236e-01   +3.295490676554792e-01; +7.302489179279835e-01   +6.583337471991876e-01   +5.860437020832496e-01   -1.831941865094791e-03   +4.999590125185123e-01   +5.220865024703687e-01   +2.711970270924701e-01   +6.600648512199333e-01; +2.650183156994127e-01   +1.965999363080327e-01   +7.282727076174635e-01   +5.406646620798452e-01   +2.718314983544627e-01   +5.810585034502184e-01   +1.728858693074982e-01   +8.573162285538234e-02];
L2E_L2I_iGABA_netcon = [+1.286396778376230e-01   +7.173747346093677e-01   +5.839208836391728e-01   +4.608016524741217e-01   +3.726344878695514e-01   +4.700633774376847e-01   +1.278263402799562e-01   +5.196851243787367e-01; -2.454646547427835e-02   +2.150592458428473e-01   +7.364190838414844e-01   -2.428892740284871e-02   +2.157605983930070e-01   +5.221912163477469e-01   +6.371998039610638e-01   +3.678765543756602e-01; +4.691552844063775e-01   +4.386250274212169e-01   +6.286550927636069e-01   +3.841781504343753e-01   +8.900327608617385e-02   +1.947224703420942e-01   +4.567734338410595e-01   +3.904598701662177e-01; +7.389417840322591e-01   +5.448977185974845e-01   +3.710283721127293e-01   +7.479535741553074e-01   +1.464190204767159e-01   +4.303648568082391e-01   +1.278181482409375e-01   +3.970152549629443e-01; +3.686772232310934e-01   +5.467462211579041e-01   +7.429647536237880e-01   +7.708199388153282e-02   +3.389616173700061e-02   +3.913742641977774e-01   +6.067678385243974e-01   +5.787629390045378e-01; +2.352411650617715e-01   +4.466919418252970e-01   +6.417030480845507e-01   +1.244410599829436e-01   +1.311434492371852e-01   +5.025952884138163e-01   +5.165313712920404e-01   +1.714320586897247e-01; -6.350779867723377e-03   +2.541887744089396e-01   +5.745603840909846e-01   +5.958896531256304e-01   +2.352563335677007e-01   +6.850442795190731e-01   +4.647219688758396e-01   +8.198804208153120e-01; +5.987527311556901e-01   +7.690385018533703e-01   +3.083748935825059e-01   +5.640288097305513e-01   +1.897183055352429e-01   +1.896438796220946e-01   +8.318444920561567e-02   -6.053396302450951e-02];
L3E_L2E_iAMPA_netcon = [+4.016040667848968e-01   +3.211836789175662e-01   +1.636185494523223e-01   +3.131886025159191e-01   +2.266161785430784e-01   +8.760908344178023e-02   +1.461501243570458e-01   +1.308423981014118e-01   +3.470351154453821e-01   +2.052559488373541e-01   +7.239548900256719e-01   +6.128330401781603e-01; +2.643633936030795e-01   -2.974861802212273e-02   +5.692970677685646e-01   +4.425922605227546e-01   +6.344335920169281e-02   +5.955969422043644e-01   +4.136786333564516e-01   +1.134808759962521e-01   +4.143597222250855e-01   +5.864459959776114e-01   +1.764119529162705e-01   +7.870540082539441e-02; +7.504136312477713e-01   +1.041476062063030e-01   +3.191266941402291e-01   +5.476607925584164e-01   +8.011648495859979e-01   +9.599366881901644e-02   +5.089402418930288e-01   +5.076438394898355e-01   +5.736399141090823e-01   +3.332811290478255e-01   +5.570995514717071e-01   +3.456876375994165e-01; +5.633498506058688e-01   +2.417111259117818e-01   +3.197952512670766e-01   +6.257915813816559e-01   +2.628227603277918e-01   +8.680786521639337e-02   +7.109780671697221e-01   +1.802452072630815e-01   +2.600068643568408e-01   +1.339923444036353e-01   +3.275010113857155e-01   +6.723273470847145e-01; +5.452940136864091e-01   +1.400955434354612e-01   +5.273985948840701e-01   +1.250487954514663e-01   +1.543079576827176e-01   +2.499838618919399e-01   +4.281774186215201e-01   +5.082147952747103e-01   +6.038645894059345e-01   +1.664417624374118e-01   +5.241399451086287e-01   +6.878230492784838e-01; +4.106062452561237e-01   +1.211508819237467e-01   +1.924028463014265e-01   -1.849771528890014e-02   +1.130423658894313e-01   +3.896175803924096e-01   +4.454463031574074e-01   +1.814015796421508e-01   +5.071633140119282e-01   +6.547960822338619e-01   +6.347399590112315e-01   +1.603847288794208e-01; +8.220385250295978e-01   +6.622713746070635e-01   +2.231995306513034e-01   +1.211001168990115e-01   +7.213041405511408e-01   +2.971770812882944e-01   +5.081473475970841e-01   +1.235569619983908e-01   +1.156204788401241e-01   +2.104377948106577e-01   +2.870382286878036e-01   +6.223025942057019e-01; +1.939560097513029e-01   +6.189886643738243e-01   +6.521954269029042e-01   +1.312432969969869e-01   +6.069310017790966e-01   +1.304086461601333e-01   +5.972797899079878e-01   +3.464449727666901e-01   +2.239277808892774e-01   +2.752590305932179e-01   +2.874651754189510e-01   +5.462752801821645e-01];
L3I_L2I_iGABA_netcon = [+2.102714448841752e-01   +2.908843266995960e-01   +7.770667056175113e-01   +2.939175735707685e-01   +5.964988831757464e-01   +6.717398580159712e-01   +5.134772492417755e-01   +5.721274065809915e-01   +1.848436899630762e-01   +2.716094498250389e-01   +3.645234832320541e-01   +5.821620198112805e-01; +7.080680713297053e-01   +1.754273679030415e-01   +3.957348879542185e-01   +3.527434877025848e-01   +8.099999917167153e-01   +4.550128731351747e-01   +2.745647328859102e-01   +6.407608152700159e-01   +7.641327411550994e-01   +3.790450111402856e-01   +6.140074073333398e-01   +6.943804261854597e-01; +1.319022991009014e-01   +4.021100922702411e-01   +4.143805108155231e-01   +6.058002702862127e-01   +6.109160004939455e-01   +4.454153413766346e-01   +6.280847603936590e-01   +4.668937779173161e-01   +8.557793549363193e-01   +6.095215171699115e-01   +2.166731719510324e-01   +7.895278426117290e-01; +5.854659320791925e-01   +2.531019042841556e-01   +4.267044235146367e-01   +5.056641802514081e-01   +7.250108322595726e-01   +5.385230013709732e-02   +6.768442079930928e-02   +1.064521430017050e-01   +1.234390759993747e-01   +5.931916259030454e-02   +2.861972540475464e-01   +4.407187597305594e-01; +4.745763838281006e-01   +7.579461908983268e-01   +2.422036036680116e-01   +6.426623241281513e-01   +5.782031702640247e-01   +3.554801724172004e-01   +1.544464259769955e-01   +4.847149451132520e-01   +2.630804254427903e-01   +5.176057318572365e-01   +4.699699497098284e-01   +5.896915244409512e-01; +4.880630034242656e-01   +6.945881169435337e-01   +4.052538435465517e-01   +5.123096667583670e-01   +1.253462554465214e-02   +2.092247692101524e-01   +4.028070184818191e-01   +3.667860874327447e-01   +5.341035961330387e-01   +9.282967308749995e-02   +5.746466737532109e-02   +7.080075738546447e-01; +1.668662295513333e-01   +2.690616916167200e-01   +5.363981125461040e-01   +6.413119080892425e-01   +6.540828537428780e-01   +1.800017812949517e-01   +6.370664127037439e-01   +5.433653862812891e-01   +5.482895313090395e-01   +4.168905957398940e-01   +1.617263317653023e-01   +3.455730489971234e-01; +3.809474292631687e-01   +4.300562598624561e-01   +1.751777578963830e-01   +2.625585363734910e-01   +6.354175153288565e-01   +8.023048192810507e-01   +2.552918483263844e-01   +6.352576644474416e-02   +2.111033431103664e-01   +2.813384578696403e-01   +1.684177848792698e-01   +6.469341637610901e-01];
L2E_L3E_iAMPA_netcon = [+6.949890736404585e-01   +3.689666483940238e-01   +4.228940416571438e-02   +7.927998154162107e-01   +4.557940543161615e-01   +2.560568450869889e-02   +3.297914699734349e-01   +3.785929434751972e-01; +6.781773019572037e-01   +3.954585885658830e-01   +3.069158710034989e-01   +4.999024153868924e-02   +6.022006898883524e-01   +5.063850259528108e-01   +3.557285879086272e-01   +2.226193766576095e-01; +2.756443678927332e-01   +1.158007129480523e-01   +1.280794901410142e-01   +5.181553558256877e-01   +6.968770414068434e-01   +4.593037589384184e-01   +2.152168312149816e-02   +5.661443510640043e-01; +4.492400749711651e-01   +5.072980590940188e-01   +1.139263885558584e-01   +1.253989730024580e-02   +1.852739531417529e-01   +2.266856173408236e-01   +9.748064939604661e-02   +4.991784445165582e-01; +4.925370664427646e-01   +7.578699056134189e-01   +1.041252530158938e-01   +5.920297869814168e-01   +2.480921230797754e-01   +3.525524310938639e-02   +7.265696756557309e-01   +7.048831126425930e-01; +6.389054791412877e-01   +5.291315218065608e-01   +4.292912827615400e-01   +1.377902648183524e-01   +6.358651632644913e-01   +2.237087310841455e-01   +6.099920583442807e-01   +7.067352130366805e-01; +3.870830847789223e-01   +7.386700729092769e-01   +5.341726799512513e-01   +1.308715331562115e-01   +6.486302056632659e-02   +4.955192546716564e-01   +2.551435217650902e-02   +7.039746678621488e-01; +3.703763329688408e-01   +3.618531683614388e-01   +5.820251786696584e-01   +4.270801562855394e-01   +3.267746543378461e-01   +1.567519469894320e-01   +3.462603810123381e-01   +6.166437929720084e-01; +6.280940670015486e-01   +9.241667797107811e-02   +2.980885478497468e-01   +3.681986255488569e-01   +1.199638064910574e-01   +5.490634628649775e-01   -5.078337536326506e-03   +4.044193531650963e-01; +4.244521850908354e-01   +6.000299891977832e-01   +6.908294695372198e-01   +1.199829328968504e-01   -5.791190023091513e-02   +2.906158782237247e-01   +5.734415542053550e-01   +2.507700283849690e-01; +2.832850819493988e-01   +5.837416262983889e-01   +8.742934035268408e-02   +3.651972715830624e-01   +8.251654501823542e-02   +4.802667781973425e-01   +7.231624020709846e-01   +5.856364960581599e-01; +3.237376535362019e-01   +1.874640198170407e-01   +6.009459668726489e-01   +3.412522823726258e-01   +6.681975908143092e-01   +6.844971538605086e-01   +9.962744547043860e-02   +2.178532942476708e-01];
L2I_L3I_iGABA_netcon = [+3.613597629545500e-01   +6.607787222464978e-01   +5.313994545208148e-01   +4.704164564183133e-01   +5.518206789587096e-01   +4.540003873270366e-01   +6.326877150475182e-01   +5.014807743037326e-01; +4.720755059411984e-01   +1.097279389086346e-01   +2.967572872590848e-01   +1.478181354629517e-01   +1.578909294845012e-01   +3.850416552434133e-01   +6.177047086788369e-01   +7.420580002184457e-01; +7.047503796173644e-02   +7.623603694474095e-01   +7.677509095418822e-01   +1.905993852554271e-01   +4.044524861741369e-01   +2.060106022220118e-01   +7.007910131168507e-01   +8.288806526039594e-01; +6.924065671601749e-01   +2.185631418875013e-01   +3.424106576616934e-01   +2.124730640082654e-01   +3.473003381159255e-01   +3.547902936805488e-01   +1.546931932505193e-01   +3.194925285737221e-01; +8.404364760244012e-01   +1.573447364087201e-01   +2.282040601925936e-01   +2.776157244556711e-01   +3.607601188964276e-01   +6.732362234124130e-01   +4.549882855577864e-01   +7.472028863654481e-01; +4.733762020158550e-01   +6.772476612094268e-01   -5.024657169814505e-02   +6.312446590654597e-01   +5.977231003544956e-01   +3.106286275548483e-01   +4.250535504796015e-01   -2.671778614054372e-02; +5.371402862468876e-01   -1.999243437642463e-02   +7.333980675269036e-01   +7.774615690721449e-01   +9.951015201075497e-02   -4.294677297911594e-02   +1.460769969410051e-01   +1.822254514123132e-01; +8.035944050066822e-01   +5.697547013962835e-01   +5.505067396947106e-01   +1.296322439817542e-01   +1.323124164633222e-01   +3.664177017325822e-01   +7.703596798352875e-01   +4.518595822995152e-01; +7.627141777619196e-01   +4.867735123556962e-01   +9.997464621974811e-02   +7.148980347150812e-01   +6.812346237358026e-01   +5.244988596842508e-01   +4.888684351562794e-01   +3.406566471181824e-01; +2.821431796732961e-01   +5.574180184366616e-01   +3.209586148823071e-01   +7.319757864464820e-01   +7.360371478614003e-01   +4.552194388994677e-01   +7.439228479337567e-02   +6.038427368856277e-01; +7.434100318640502e-01   +4.279940671345810e-01   +3.864717972478442e-01   +6.831137302084813e-01   +4.968684802195543e-01   +2.419643956507607e-01   +5.159337164242951e-01   +2.015992471328450e-03; +7.982325902658826e-01   +6.010300578487778e-01   +7.262230086950384e-01   +8.026082855254271e-01   +6.167698437704795e-01   +6.609688492227854e-01   +4.208519678562621e-01   +6.325569329419086e-01];
L3I_L3E_iAMPA_netcon = [+5.733459051828100e-01   +4.486487030379311e-01   +8.233060324224095e-02   +1.901909057756391e-02   +4.209493429960505e-01   +4.023459217401825e-01   +6.692637947672527e-01   +7.233182404198417e-01   +1.145140372618055e-01   +5.478302186085731e-01   +7.136816143198405e-01   +5.083432258516543e-01; +4.414078428692474e-01   +3.127334253609223e-01   +7.686437095188358e-01   +3.563246966829809e-01   +9.580205843333879e-02   +4.376000165020040e-01   +7.572468564468453e-02   -9.710337222377893e-03   +3.264750897478244e-01   +4.651225654589949e-01   +2.592475431331968e-01   +4.589471889380087e-01; +2.978399024262698e-01   +4.819920740522163e-01   +7.156748066057346e-01   +3.492078728795566e-01   +3.862190271652849e-01   +7.343489374926601e-01   +6.534776892465496e-01   +2.631902250126527e-01   +3.479086706061069e-01   +4.783556894836904e-01   +6.568063380450541e-01   +1.626147935506274e-01; +3.470386935407506e-01   +5.223104080070047e-01   +2.839856157267063e-01   +2.128010178211830e-02   +3.987439331764269e-01   +2.021958181029050e-01   +7.568407148213155e-01   +8.160173773169046e-01   +6.122497763754090e-01   +3.823556582619518e-01   +4.523825507127108e-01   +6.948338789253057e-01; +5.407059827125580e-01   +3.225824529424440e-01   +3.653188007463689e-01   +6.398880465595056e-01   +7.367709399119995e-01   +3.252329717474840e-01   +4.984293948032446e-01   +7.886688966335398e-01   +1.733113584428849e-01   -5.771500589353394e-02   -3.782522069923515e-03   +3.694741554513049e-01; +7.647937924862467e-01   +4.105314341582432e-01   +1.940065828639446e-01   +7.533169700703668e-01   +2.371441360371515e-01   +1.265882317149652e-02   +6.516726118569001e-01   +3.830246524978128e-01   +3.338268941692167e-01   +7.087146257500515e-02   +8.491834759472777e-02   +3.990883674628301e-01; +2.516907698995393e-01   +2.545305954581248e-01   +1.078173622621704e-01   +5.332414100439581e-01   +4.225076925119634e-01   +2.320071473335542e-01   +2.478597437073357e-01   +6.253919099548807e-01   +2.997577274138265e-01   +7.691314116187841e-01   +6.291118377889175e-01   +2.791382076883418e-01; +7.090126965585490e-01   +1.976405758606483e-01   +5.671118138429473e-01   +1.104798977628486e-01   +3.887868155739777e-01   +3.894540494958031e-01   +7.232318355013102e-01   +4.889694075658665e-01   +8.010335551926081e-01   +6.515294048886132e-02   +2.293420586442808e-01   +3.070133042022253e-01; +6.416089978256825e-01   +5.417625577423515e-01   +2.263806397883763e-01   +7.635129317602314e-01   +8.282418704347165e-01   +3.921258667302021e-01   -7.832242245463431e-03   +6.553436956632783e-01   +4.224470344080192e-01   +7.133896548875709e-01   +1.844201376396717e-01   +2.455506639484435e-01; +3.674078873992787e-01   +4.905783048052069e-01   +6.432942200272609e-01   +5.052026766859231e-01   +3.249615786970451e-01   +1.596391512185182e-01   +3.749743810145796e-01   +5.802602235735781e-01   +3.008107749513900e-01   +6.463912349251471e-01   +7.526036911819666e-01   +5.731829393598236e-01; +6.080616161439593e-01   +5.196547892233057e-01   +4.081041042868507e-01   +6.607921354355369e-02   +7.315227820805033e-01   +3.401998344868345e-01   +3.034436112011804e-01   +2.648642684883719e-01   +7.471689161830218e-01   +3.524736841197095e-01   +5.589463061007683e-01   +6.283621160983781e-01; +5.259045396268690e-01   +5.227150646414407e-01   +1.429688592070691e-01   +4.856682871946693e-01   +6.681217905795018e-01   +7.919548332832896e-01   +6.605678397146415e-01   +6.008772945964216e-01   +3.070956063786914e-01   +6.707598316870611e-01   +7.917371474931398e-01   +1.262748557401915e-02];
L3E_L3I_iGABA_netcon = [+7.514204543446775e-01   +7.012374637825773e-01   +6.642776888277698e-01   +2.071858034644725e-01   +8.156268295989226e-01   +6.291683768258360e-01   +3.937988833610216e-01   +5.288229859078850e-01   +4.476378558551907e-01   +3.035410933004687e-01   +4.221857947571812e-01   +5.113582963030597e-01; +4.694858622606994e-01   +2.677103078337760e-01   +2.208994735479959e-01   +7.549096679434897e-01   +3.813082822844190e-01   +3.334720476334703e-01   +6.394990707765159e-01   +2.702497908347367e-01   +1.552609967201137e-01   +7.046757585926703e-01   +9.632867539076534e-02   +2.531280237617819e-01; +3.922454326319881e-01   +6.519935476878903e-01   +7.046001287555264e-01   +2.295583833857903e-01   +4.113540308005754e-01   +5.834643532124164e-01   +3.133589691474579e-01   +4.490681883934141e-01   +6.540640052879731e-01   +4.955709620708142e-01   +2.281288776285540e-01   +3.396054989221937e-01; +5.817268921345325e-02   +1.121165393109622e-01   +5.658645563198473e-02   +3.127236797762608e-01   +6.896900269308026e-01   +2.673175590573301e-01   +2.853545821212834e-01   +6.569258462895702e-01   +2.735142281361241e-01   +4.839584531171260e-01   +2.852717496048983e-01   +1.758083222055148e-01; +2.791743812383976e-01   +3.412087667995063e-01   +1.188076084397895e-01   -2.984808869130337e-02   +1.496706553260453e-01   +2.313794245903635e-01   +3.170259818399382e-01   +6.389590917119232e-01   +1.396617502615448e-01   +2.739608550070206e-01   +1.105685559186388e-01   +7.590168753448112e-01; +1.072846848530121e-01   +7.385519252102585e-01   +6.268079596549426e-01   +1.538171674738384e-01   +1.728518335430317e-01   +5.287352541620572e-01   +3.781275198327758e-01   +1.051363473108051e-01   +4.279527872399533e-01   +8.126885978213668e-01   +6.291510492079533e-01   +6.975980864591380e-01; +1.052443030323074e-01   +9.187504961322572e-02   +1.639984034685810e-01   +5.003751808511860e-01   +1.911214230189412e-01   +2.775638019910098e-01   +4.465041760880574e-01   +4.878146707351932e-01   +5.247608229206421e-01   +5.661326475297075e-01   +4.368685044392700e-01   -3.929160054660859e-02; +3.944960866663123e-01   +5.328567117240405e-01   +2.495215991272858e-01   +6.339095749664393e-01   +5.871652390024458e-01   +5.051676473585887e-01   +7.231972402601772e-01   +3.004663148302282e-01   +3.221008263061462e-01   +4.379569772737372e-01   +4.999080583328339e-01   +5.309522596307052e-02; +4.218931225643985e-01   +2.139924770919583e-01   +7.323964733530190e-02   +5.359857210971517e-01   +3.506835548905974e-01   +2.786894384388344e-02   +6.060847910892755e-01   +3.082837245541119e-01   +5.844659528028651e-01   +6.937079332643425e-01   +1.554891189701558e-01   +4.189697338937647e-01; +1.924897614065840e-01   +3.355424311828827e-01   +5.283355702277122e-01   +1.966585987246383e-01   +4.880998504233166e-01   +2.805283800418049e-01   +1.577492933021944e-01   +5.021570733398008e-01   +2.913029263312201e-01   +4.563713947609387e-01   +5.233383141820250e-01   +6.361809815075076e-01; +2.778975139964791e-01   +4.854178843597421e-01   +4.554798347408249e-01   +6.735588567007852e-01   +5.331679127429836e-01   +3.735337574004628e-01   +6.155094353721894e-01   +1.178657905633735e-01   +3.891643988806709e-01   +6.329231100282651e-02   +7.737547587813098e-01   +5.823485744184006e-01; +3.884055916605819e-01   +6.482222179957463e-01   +3.769219916562893e-01   +1.189682605319737e-01   +7.420705599561365e-01   +5.754784195587744e-01   +6.020698560839617e-01   +6.386472151463547e-01   +5.572419611818287e-01   +7.049674815263258e-01   +3.542644006025706e-01   +3.949607174759082e-01];
L2E_Input1_iAMPA_netcon = [+2.556192818151525e-01   +3.684563475454700e-01   +4.877699438091539e-01   +6.687041070016170e-01   +6.137571675886336e-01   +8.057116047054741e-02   +7.116176912315449e-01   +1.052813239801193e-01];
L2I_Input2_iAMPA_netcon = [+6.877980277422477e-01   +5.169620929562464e-01   +6.961984910142538e-02   +8.308622251896287e-01   +2.669382135483391e-01   +7.755710532367494e-01   +5.147912682360680e-01   +7.554098370329053e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.4*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.6*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.4*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.6*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.4*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.6*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.4*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.6*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
