function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.892742987197454e-01   +2.063310286427745e-01   +8.457950883156100e-02   -1.862295589753067e-01   +2.432515523358200e-01   -3.168927614723841e-01   -2.720956013258482e-01   +3.365983104324327e-02   -3.896974850899540e-01   -2.490011360849864e-02   +1.463257497363101e-01   +2.886602773161457e-01   -4.236714169996944e-01   -2.455119997771875e-01   +4.055446299825236e-01   -4.231351741457324e-01; +6.148980288638244e-02   -9.860004213237197e-02   +3.641998217092146e-01   -8.985083723211744e-02   -3.537687338177108e-01   -5.457268844099541e-01   -2.563096524586837e-01   -2.018218221350490e-01   -1.680852382334170e-02   -1.764596021394998e-01   +1.352415183086554e-02   +4.575141283578293e-02   -6.176828575898387e-02   +1.187634143433695e-01   -1.141693950837814e-01   -3.862421671833824e-01; +7.455518647086005e-02   +8.834003463240203e-02   -1.967662823351591e-01   -1.345828669965307e-01   +1.562124470426456e-01   -5.622212192667754e-02   +1.531332927366592e-01   +1.483743861467799e-01   -2.929018584184170e-01   -7.261150511212573e-02   +3.337928945719667e-01   -3.652980255396362e-02   -3.176163619527489e-01   +1.513195528381602e-01   +2.128350514181900e-01   -1.167073981020279e-01; -2.945684421325449e-01   -1.611359622303724e-01   +4.013135472157801e-02   +2.366695186779511e-02   -4.887315465621479e-02   +6.488135397243482e-02   +7.062927269795700e-02   +2.338469785281097e-02   +2.307581861471606e-01   +5.838101330279745e-01   -7.921225548632065e-02   -4.854751150678799e-01   +5.453849489585678e-02   -2.534608245072830e-02   +1.659503030969118e-01   -1.657882629857109e-01; -9.368897790150507e-02   +1.674216526528840e-01   -2.699685204582939e-01   -1.448103633428944e-01   -1.455269033265200e-01   +2.390895083103644e-01   -2.064116677931584e-01   +3.493624768681937e-01   +4.351469010726430e-01   +2.087960840122067e-01   -3.467031639511946e-01   +3.158411311758086e-02   +2.904973087419770e-01   -3.167419963323452e-02   +1.345049894818623e-02   -5.918168664628849e-02; -1.833778516999950e-01   +2.484019298762716e-01   -1.347849091422500e-01   +3.545254395160733e-01   -2.912322844449680e-01   -1.537701618443925e-02   +1.819569145657617e-01   +7.120323425743927e-02   -1.623472326179736e-01   -2.256722056332521e-01   -4.051924229220506e-01   +2.320578654387086e-01   -2.396037737481648e-01   -5.965040517351974e-02   +1.434587427885015e-01   -1.747752487486224e-01; -1.883217590678910e-01   +6.061324891552311e-03   +8.686203434204770e-02   -6.160032570425712e-02   +3.180794031200471e-01   +1.455797047633658e-01   +2.975969800678956e-01   +2.186902230109885e-01   -3.111066602308897e-01   -1.533807756083388e-01   -2.785527352968111e-01   -2.270052647823485e-01   -1.149085820801759e-01   -1.476828907508045e-01   +8.217576260004544e-02   +3.259148725317551e-01; -2.205403677953440e-01   -3.524118450747882e-02   -1.413965755087344e-02   +2.375093559223327e-01   -2.741343115326017e-01   +1.383992325383278e-01   +2.580773918793315e-01   +1.798339212425571e-01   -6.037891979092899e-02   +7.496312393158246e-02   +1.281382118271005e-02   +1.362744551799581e-01   +4.638709917219161e-01   +4.532846920720996e-01   -1.554091245928622e-01   -3.235357518573152e-01; -3.270305824617634e-01   +7.109868877079450e-02   -2.235978045520997e-01   +1.711617562338791e-01   +1.061737554060557e-01   -1.772507627189963e-02   +1.893825818159564e-01   -1.197032082542726e-01   +6.893388640492178e-02   +2.763897625636899e-01   +2.802885722519130e-01   -6.985747877506067e-02   -3.232025014196832e-01   -6.518800753687308e-02   +3.587489709658889e-02   -1.977345142849423e-01; +7.630062429139228e-02   +5.594773395154448e-03   +3.774662428508546e-03   -1.759200867589285e-01   -3.714054710010533e-01   +4.397846835549324e-02   -6.124223205750447e-02   -2.723862653996619e-02   -8.957667164453131e-02   -5.645108345185806e-03   +1.616013698349743e-02   -1.378055328312700e-02   +2.528935391087743e-01   +1.423619125122766e-01   -2.378970077994039e-01   +4.898670561295507e-02; -5.146858556026895e-03   -1.166270776586136e-01   -1.259727779750502e-01   -1.558599750237907e-01   -4.864338937947410e-03   -4.725653311241268e-02   -8.978537493827705e-02   -8.715264113536278e-02   +8.060183349869922e-02   -1.465839100901392e-01   -1.796994873414134e-01   -3.079997214378524e-01   -2.913772228167864e-01   -3.690445728410519e-01   -1.705745785350320e-01   +5.230620466281991e-02; -1.123240645712821e-01   +4.998083917111922e-02   +1.731041672750558e-02   +2.110341245768331e-01   +3.298690834116178e-02   +3.337769536248419e-01   -1.373699680715085e-02   -3.331336944401563e-01   -4.538716874832064e-02   -2.587059544867946e-01   +7.381678419861186e-02   -2.956500979504544e-01   +1.801605484751340e-02   -2.887836298957105e-01   +5.774415430107446e-02   +4.734575195669576e-01; -1.737143348421344e-01   -3.193034865520986e-03   +3.151119363969584e-01   +1.291969663067032e-01   +2.282083627323505e-01   +8.977532557980153e-02   -1.589628430835831e-01   +6.585937134146075e-02   -2.044582006556578e-01   +4.003120159386556e-02   +1.948617259948019e-01   +1.024023904044075e-02   -3.557972176573795e-02   -3.103479621022304e-01   -3.299561133599174e-01   +2.898206023176791e-01; -2.801006641353849e-01   +1.845476217267867e-01   +4.775897508975735e-02   +1.919721871022668e-01   +1.675062461705137e-01   -6.882989302359295e-02   +4.663881995178597e-02   +2.751993806227880e-01   +1.259201704548038e-01   +8.533061943991910e-02   -7.563201416002484e-02   -8.218588966534612e-02   +5.902286769775997e-02   -5.889778826641252e-02   -3.472174431600682e-01   -3.292160493935873e-01; -1.579001257186642e-01   -2.557651606232510e-02   +1.571351068903819e-01   -2.569735766188038e-02   +1.726534097797942e-01   -3.565585727533703e-02   -8.213579941360379e-02   -2.766761573512738e-02   +8.222058378730944e-02   +8.336350103426124e-02   +2.556018353481754e-01   +3.429411183488922e-01   -2.069630137022072e-01   +2.995039040354953e-01   -3.319258886306034e-01   -1.436539771701386e-01; +1.223341911202063e-01   -3.479599726430875e-02   -1.896804626620791e-01   -7.814072941638250e-02   -2.940786011073115e-01   -1.432097424243201e-01   -2.008698329142879e-02   +3.327517985874510e-01   +1.751336581757615e-01   +7.816254014816680e-02   -1.677129049703023e-02   +8.317223234327803e-02   -2.207615292042050e-01   +1.214757496579146e-01   -1.803712588703102e-01   -9.662651980948136e-02];
L1E_L1I_iGABA_netcon = [-3.555407453951620e-01   -2.925013022280421e-01   -4.944499124606378e-01   +8.937016581974502e-02   +9.429227425294667e-02   -1.642226270384375e-01   -1.578666965452928e-01   -6.666244365909495e-02   +8.804165946196939e-02   +2.903334037585017e-02   -2.637251228399783e-01   -1.799633727905428e-01   -1.813976939226178e-01   -2.054389650714925e-01   +1.227083197229685e-01   -1.380272177219883e-01; +2.360720611250103e-01   +1.371857359783691e-01   -2.586484623594063e-01   -1.838913105196686e-01   +2.393323133707672e-01   -1.658025097090158e-01   +2.988138660309663e-01   -8.487367598203177e-02   -8.514667743274883e-02   -9.460853254526588e-02   +1.802081899820923e-01   -1.474383379303930e-01   -2.359844847451540e-01   -6.310348913656769e-02   +1.068863624948681e-01   -8.956165892035932e-02; -3.789949906243362e-02   -2.350483926999946e-01   -6.936839027203516e-02   +1.781184410381560e-01   -1.048173828047763e-01   +1.814599449218801e-01   +7.520738431996196e-02   -1.938461428536528e-01   +2.247095305874101e-02   +2.461231306059007e-01   -3.166882070924804e-01   -7.742712713051288e-02   -2.802390723163614e-03   +2.779890015196393e-01   +3.507590984807390e-03   -6.155763035583750e-02; +3.613562145135746e-02   -1.325614981252105e-01   +2.763831067255016e-01   -1.823521019378465e-02   +1.062612002822879e-01   +1.193317798770413e-01   -4.590382170232592e-01   +1.154159679797157e-01   -4.081714881756192e-01   -1.389841996214078e-01   -2.500020445693690e-01   +4.791583117291882e-02   +1.457576397888641e-01   -2.433400069968227e-01   -3.591397608552828e-01   -3.012377454658638e-01; -4.505962154456911e-02   +2.055410152621718e-01   +8.511310514519138e-02   +1.260848291452171e-01   +1.259260677238465e-01   +1.201398883518128e-01   +5.109691802294339e-02   -1.562444927307357e-01   -1.894481841312400e-01   +4.626709422075395e-01   +2.414646329554113e-01   -1.902148975232527e-01   +2.041230773982605e-02   +1.175850656975795e-01   -2.406891188031267e-01   -1.779460557389586e-01; +1.543216065768160e-01   +1.178885421896851e-01   +1.670989092688717e-01   -4.035071443573212e-02   +1.005897373335115e-01   +3.074211907996798e-02   +3.090496082072247e-01   -2.621172307664911e-01   +2.637262453413288e-01   -2.363610248181156e-01   +9.983501059734479e-02   +8.221136219899984e-02   +2.230509703539652e-01   +4.414750000424182e-02   +5.288007007183636e-01   +1.293347840769349e-02; +1.622086895552165e-01   +8.977821711956428e-03   -6.501537514098145e-02   -3.504074602084925e-01   +5.664332304588274e-02   +1.050814011452302e-01   +1.176584095366297e-01   +2.433546943107892e-03   -1.100998661465765e-01   -7.486099261068983e-02   +2.708942893385634e-01   +1.711497772194218e-01   -4.888057452055714e-02   -2.449853943199296e-01   -8.441350355388558e-02   +3.043304277706939e-01; +3.205907779706049e-01   +1.052498082727072e-01   +1.279893804170983e-01   -1.559753733855492e-01   +5.184508180644991e-02   +4.069440177454353e-01   +1.972493393324321e-02   -8.101641446002389e-02   +9.796406048799700e-02   +1.453469757693148e-01   -2.840454488088985e-01   -4.716429942407212e-02   -2.155068056180735e-01   -2.639266761454624e-01   +2.629146343249896e-01   +8.090963839119883e-02; +1.162096804853901e-01   -3.105154009034635e-01   +1.200599020625700e-01   -4.302581245310280e-02   -6.454748857329384e-03   +6.558526732270986e-02   +1.139261152445543e-01   -2.423261179513473e-01   +2.517728317249413e-01   +3.319084231294759e-02   +8.736344983111362e-02   +2.735033726573746e-01   -2.458621776924480e-01   -5.204842281915918e-02   +8.641216837486235e-02   +3.027385118713676e-01; -3.298223049478049e-01   +2.064344030907394e-01   -2.736134360269130e-01   -2.851881968214852e-02   -2.104473852605478e-01   +7.961789992790748e-02   +7.164442628042983e-02   -3.733071888241010e-01   +1.933789658006887e-01   -2.463299089184133e-01   +1.438837846325731e-01   +2.859867343556146e-01   +3.066017637022825e-02   +7.539856468063899e-02   +1.981151122938865e-01   -6.144822362110383e-02; -1.160944644212039e-01   -4.559932549907744e-02   +3.841562174143091e-02   -1.770281078374100e-01   +1.177175435264590e-01   -2.109250453479266e-01   +3.168830205399128e-01   +2.906034379684727e-01   +5.683615617716765e-02   -4.235763287149944e-02   -1.503885268309021e-01   +8.967947998663947e-02   +9.229394640388608e-02   -1.708218445652482e-01   -1.702279592113892e-01   +2.026755888767270e-03; +8.900041746618693e-02   +9.624658719670173e-02   -1.939863377664183e-01   +2.671505437108198e-01   -2.234364052342735e-01   +4.499731026165486e-02   -6.550482749382962e-02   +1.949027101204366e-01   +1.927187415370720e-01   -1.638339343875820e-01   -8.067252287962720e-03   -1.943376292796133e-01   +1.552196597465996e-01   -4.657512189184573e-03   -4.783581940617961e-05   +3.162806918776148e-01; -3.125778478233843e-02   -3.721917500678063e-01   +1.329897888747511e-01   +2.249928893163704e-01   -8.496512721801078e-02   -1.577252824449324e-01   +2.495118206236169e-01   -1.407853616987808e-02   -1.640086715931740e-01   -2.825222515931115e-02   +2.276703271292187e-02   -1.029478863160487e-01   -2.999794583702652e-01   -4.313589671754575e-01   -1.518840886834985e-01   +2.341908452057753e-01; +7.678621467793233e-02   -1.836976220922922e-02   -2.477553964909763e-01   +1.470184423696336e-01   +6.283152635153635e-02   -2.048950658589354e-01   -4.016347672814742e-02   -3.786183491460477e-01   +1.411133386014226e-01   -2.324722544752982e-01   +5.558778548349358e-02   +1.917956050948064e-03   +8.450859570621000e-02   -2.358483598636516e-01   +1.548447164456004e-01   +4.257080684043554e-02; -7.990227489789775e-02   +6.683084488512965e-02   -1.381378834549964e-02   +3.165023480568703e-02   -4.785447337178912e-02   +1.298182752508634e-01   -3.846288276920799e-02   +2.045472398868476e-01   -4.620534675082291e-03   -1.788403862415715e-02   -6.010595550731918e-02   -5.581918062628653e-02   -2.064119112250264e-02   -1.096928616355954e-01   +3.333593834751448e-02   +3.358413216980545e-01; -3.026049283076494e-01   -2.362366748615927e-01   +4.085946953461108e-02   -3.873447166091240e-01   -2.066505660371286e-01   -2.087070220810201e-01   +3.445245998698307e-01   +4.657165961148332e-02   +1.465597067251406e-01   -3.502829055946563e-01   -1.510470816382435e-02   +1.146179951675349e-01   +4.258120419591076e-01   +2.271719273609454e-01   +1.202266709334985e-01   -3.972004230493588e-02];
L2I_L1I_iGABA_netcon = [-3.057986737647262e-01   -1.958169674564169e-01   +3.322909061883159e-01   -3.512586192630185e-02   -1.837801056011614e-01   +4.597488040396241e-01   +2.101518571583799e-02   -6.564054689616634e-02; +6.475063949324245e-02   +2.106047659006051e-01   +6.820929849875876e-02   -2.386860270917519e-01   -9.685843969415962e-02   -8.280676635616893e-02   +3.462594313313622e-02   -1.094911502671025e-01; -1.901610680656089e-02   -2.487289593803574e-01   +7.667699568161548e-02   +8.446488173587832e-02   -6.722493985747292e-02   -7.644286869150889e-02   +1.023160740220078e-01   -2.963000644221879e-01; +3.877039091515459e-01   -1.563867435239366e-01   -8.601437148736318e-03   +4.084598931347331e-01   -2.278170239681174e-03   -3.141239434523210e-01   -1.941007257297738e-02   -3.200477553711621e-01; -2.267996399297393e-02   -4.890096135682904e-01   -1.727423711681040e-01   -7.915596157760292e-02   +8.641663291266893e-03   -2.530470109245620e-01   -1.945529218779172e-01   -1.764198679187365e-02; -1.560690932777151e-01   +1.926348295140529e-01   +1.936430455229185e-01   -2.836455828366853e-01   +1.070017331300886e-01   +1.918237488533630e-01   -2.238672675803788e-01   +2.441069247146103e-01; +2.838222020232341e-02   -2.031697541411524e-01   +1.866400323420921e-02   -9.109402425188928e-03   -1.312741668399980e-01   +1.587502990352169e-01   -6.420944430727271e-02   -2.190208119295016e-01; -1.166773242733246e-01   +2.982254694140555e-01   +3.033561342293906e-03   -5.220252408698398e-02   -1.019744932362478e-01   +4.916078379400169e-01   +6.146875512019694e-02   +2.876044808248580e-01; +1.519488069538089e-01   -1.185604693483334e-01   -6.640471524786758e-02   -1.672852616449244e-02   -8.349425202684548e-02   +2.317770172001239e-02   +8.630557989150932e-02   +3.190432346940189e-01; -6.286442300631287e-02   +3.466193771574188e-01   +1.730744391688629e-01   +1.115320912542146e-01   +1.272910053197715e-01   -2.780962919554424e-01   -2.879969829168850e-01   -2.119356701783019e-01; -1.967723589028508e-02   -3.875468339093301e-01   -2.739934955127081e-01   +2.580797626257353e-01   -1.091228708971961e-01   +1.207127835900229e-01   -5.031595462621774e-02   -1.698732344925603e-02; -2.196264385073355e-01   +8.961885978773818e-02   +1.471508751453927e-03   +4.592343343605779e-01   +4.614648675293210e-01   +9.759609225390059e-02   -2.468478135168457e-01   +4.262087421367335e-02; -1.110587505774732e-01   +1.527891476346339e-01   -6.995759543642202e-02   +2.210945375955838e-01   +3.225999652509569e-01   -1.429665487071938e-01   +9.406707263460726e-03   +6.718711163652351e-02; +8.558476652166075e-02   -1.017793284529349e-01   -9.901912970218821e-03   +5.860760305888381e-02   -9.554263453626363e-02   +7.199968279788685e-02   -3.070309563990761e-01   +1.994274631051407e-01; +1.883536942240369e-01   +2.517869170193420e-01   +5.154367418510218e-02   -1.433651940622623e-01   -3.675763301456061e-02   -7.497954121723738e-02   +2.965304587670315e-01   +2.409870627641641e-01; +1.393075216461882e-01   -4.738033018511140e-03   +2.699675081792777e-01   -2.296313832830926e-01   -3.169005708042875e-01   +3.381015457120624e-01   +2.803961095816321e-01   -2.281797312872180e-02];
L1I_L2I_iGABA_netcon = [-9.876741359051744e-02   -1.701918473420583e-01   +2.958164281805855e-01   +1.901551431395279e-01   -1.886022236730657e-01   +1.458179837500762e-01   -2.172484685274015e-02   +1.845931237024453e-01   +1.937348444598898e-01   -3.015809494486685e-01   +1.736550136437466e-01   +3.114745409474746e-01   +2.460889976468466e-01   +2.201469808426039e-01   +1.491609726679574e-01   -2.086784534946399e-01; -5.985495198464952e-02   +4.501071318037592e-01   -1.587984013041429e-01   -2.848307323569351e-01   -3.570280506686368e-01   -3.321488564717391e-01   +1.129778322525364e-02   +2.504188149978798e-03   +2.368146699567167e-01   -4.427391361123450e-01   -1.231660733970831e-01   +1.469739462345329e-01   -2.197433786958475e-01   +2.704665388042205e-01   -1.692848478662188e-01   +1.323397622001589e-01; -2.727577451219064e-01   -1.578152976418853e-01   +5.894955607856049e-02   +3.829379243003510e-01   -4.117636216764186e-01   +4.022664341383050e-02   +2.172392476401037e-01   -6.126714486142076e-03   -1.905169877921238e-02   +1.494836538224037e-01   -1.437554562960672e-01   +5.459593165902722e-02   +4.968248768414994e-02   +7.780878092904187e-02   +2.550631584786255e-01   +9.421936031275430e-02; +9.042137201559741e-02   -5.091542090291074e-02   -7.457176512025576e-02   +2.625413465835663e-01   +1.583933190513482e-01   -3.376721392862547e-01   +7.739518472553852e-02   +1.948962731125787e-01   -3.484750696856428e-01   +2.056047291311998e-01   -1.975923099975400e-01   +3.538177772862938e-02   -1.392726463616813e-01   +7.640964490119562e-02   -2.682354956049361e-01   +2.291764798044354e-01; +1.023690216590755e-01   -2.436213763493714e-01   +4.506801992238662e-01   -1.827516908094224e-01   +1.121079286983483e-01   +1.765013968423976e-02   +2.355817032284307e-01   +2.298363935946864e-01   +4.280647211321104e-02   +3.086125867338842e-01   -2.591822067996143e-01   +1.059567835268362e-01   +1.624115398273247e-01   +1.796667032477719e-01   +2.592122678781815e-01   -3.261243495567545e-01; -5.246323771534690e-02   -1.404988767095122e-01   -2.378402600176112e-01   +8.471271184471127e-03   +2.234965828359603e-01   +2.580005059023223e-01   +1.074798963473709e-01   -2.533041823230521e-01   -2.727179142810984e-01   -1.290888773343261e-01   -4.844865656300680e-02   -2.084462892775401e-01   +1.305624476944824e-01   -6.569349439369548e-02   -6.872416173867515e-02   -2.438560571937932e-01; -1.365482484944571e-01   -8.284968159497705e-02   +7.959058003607984e-02   -3.484123863094690e-01   -2.734586062857780e-01   -1.488767628954786e-02   -2.612727801238848e-01   +1.973574351579390e-01   +1.471017763726172e-01   +4.327012250530948e-03   +1.616732463370215e-01   +2.103529551714026e-01   -4.032801300375192e-01   +1.187064610385333e-02   -1.066209630897868e-01   +5.069226266256674e-01; -1.482982192154345e-01   -2.520325434036197e-01   -2.210929087724607e-01   -1.303734662487420e-01   +6.322263904101579e-02   -3.177778350425454e-01   +2.008423105569181e-01   +6.853010422977671e-02   +5.269818949849198e-02   +2.350301623879467e-01   -7.655169547810627e-02   +2.860397320618180e-01   -2.573214856792237e-01   +8.983633112708823e-02   +2.368867192263137e-01   +1.199341208470935e-01];
L2E_L1E_iAMPA_netcon = [-2.453111723005107e-01   +2.261676937777641e-01   -1.042806568484851e-01   -3.130063685480988e-01   -4.445978870852795e-02   -1.983379468210321e-01   -3.847218239865904e-01   +1.387192183523386e-01; +6.301664798001726e-03   +7.774875220667288e-02   -4.687145347101794e-01   -2.370717765785747e-01   +1.168834093540627e-04   -1.088430670887857e-02   -6.956490569146996e-02   -4.306120130164843e-01; -8.120364533109903e-02   -3.433552355060543e-03   +4.162992615421179e-01   +2.582370592567072e-01   +1.009643437276395e-01   +2.516164126861175e-01   +1.021225545255408e-02   +1.244283249553093e-02; -1.767285104217675e-01   -2.816924313250897e-01   -1.592867693674113e-01   -2.920998032905651e-01   +2.040875666197997e-01   -1.364046730407713e-01   +8.867580347275607e-02   +2.036898821648299e-01; +4.862892653723215e-02   +5.157488665501844e-01   +4.704347314221520e-01   -1.839419638505864e-01   +4.036279150798416e-02   -6.393152073053951e-02   -4.921656949528878e-02   +1.438486326459490e-02; -1.262981351413960e-02   +2.548410382636562e-01   -6.974491357287321e-02   +4.417736350975605e-02   +9.075424079248881e-02   +2.003844965285816e-01   +8.071786287202036e-02   +3.696310789218129e-01; +2.064548575779898e-02   -2.849367659510851e-01   -1.547168198918343e-01   +5.191779356490089e-01   +6.483862406777835e-02   -1.647118248757440e-01   -1.500987893580382e-01   +2.618685891333746e-01; -3.817672519177517e-01   +3.527473884182389e-01   +1.529247184223172e-01   -9.951986823735030e-02   +3.649987534978402e-01   -9.814112967058601e-02   +2.387508313705867e-01   +1.878107919475497e-01; +1.761337777094039e-01   +1.757898924317327e-01   -1.185055666641324e-02   +1.147786605439838e-01   -1.802709668325879e-02   -8.127481499906747e-05   +2.433556594227178e-01   -3.475449594856824e-01; +3.565135634967361e-01   -3.350258312936026e-03   +1.233361116871813e-02   +7.816941438328756e-04   -2.875191084505382e-01   +7.141713509160386e-02   +4.389226811163205e-01   +2.911430772661165e-01; +1.942388103063287e-01   -2.095892968621567e-02   +4.894928963342645e-01   -1.476269529745071e-01   -1.531096367755561e-01   +8.667370244575175e-02   -9.395497055234497e-02   -8.323317557629872e-02; -4.593816596805317e-02   -1.810110494158502e-01   +5.942366508889227e-03   -1.114018904192713e-01   -2.593335668235556e-01   -8.635966513598495e-02   +1.286925880549306e-01   +1.968613015919632e-01; +1.093892837164459e-01   +4.136508479608697e-03   +3.126351408074109e-02   +4.080568038701475e-01   +1.137378737278410e-01   +1.809479734312142e-02   -2.811930285615327e-01   +2.977116395684321e-02; +4.928133295097306e-01   -1.472169145734674e-01   -1.367437716769993e-01   -1.595461082927643e-02   -6.677529641906141e-02   +3.404729473502292e-02   -5.257254764533875e-02   +2.571805192926763e-01; -2.166456134130999e-01   -1.126695480624270e-01   -4.192241341467936e-02   +6.022277195601590e-02   +3.708618568675226e-02   -4.180035071610018e-01   +1.297720454800058e-01   +3.151686511865969e-01; +2.007097536830959e-02   -1.810884924143775e-01   +2.991926902177395e-02   -1.545933853459672e-01   -2.298917427449685e-01   +3.325935136816064e-01   +2.431883346945025e-01   -1.733487321519828e-01];
L1E_L2E_iAMPA_netcon = [-1.910390898576507e-01   -4.678308551357939e-02   -1.084822310725625e-01   -2.555602100385727e-01   +3.356556971051965e-01   +2.081547442292673e-01   -3.569683381095309e-02   -1.694633826369255e-01   -1.248154657227434e-01   -2.305318537220011e-01   +1.158014507375530e-01   +5.827186394576323e-02   -2.852785609640182e-01   +2.935815842074636e-01   +1.847084512050193e-01   +3.405568677067491e-01; -5.399561106600456e-02   -9.275868164740253e-02   +9.436949993905022e-02   +3.887903086271337e-02   -1.057599874419053e-02   -9.166276969515114e-02   -4.712380466318251e-02   -7.897292890763573e-02   -1.854742023737981e-01   +1.182835655570974e-01   -1.633384795412861e-01   -1.274799663175469e-02   -5.281688412642117e-02   -1.079285693918028e-01   -2.352857759650688e-01   +3.494106622394522e-01; -6.975848992502612e-02   -2.480697844439911e-03   +2.632776389504207e-02   +6.170871513119380e-02   -7.480944138599893e-02   +3.443375093891544e-01   -1.253575029134057e-02   -1.141488453511191e-01   +4.563713965288156e-01   -1.040469001205739e-01   -6.713509969739420e-02   +2.396303238435134e-01   -2.216395431787007e-01   +1.470610769283545e-01   +4.052513514273086e-01   +2.952635900115047e-02; -1.353284732406104e-01   +1.996166241654979e-01   +1.401533367076342e-01   -1.489846481998947e-01   -2.043509624350762e-01   +4.772369600620248e-02   -2.096774598680825e-01   +2.416920111023385e-01   +2.132516734142617e-01   +1.691168147439272e-02   -6.056394452731326e-02   +1.288975508458532e-01   +3.543896880107414e-02   -5.170595193522273e-02   +7.922637698180010e-02   +4.131322768485332e-01; -2.333136668663813e-01   +1.981488713156331e-01   +4.430198710763378e-01   +3.223265387651367e-01   +9.766253588707850e-02   -1.247991373868505e-01   -3.452905653597858e-02   -1.332475044491506e-01   +3.054064024161801e-01   -4.892275600524790e-01   +9.052913136931369e-02   -1.690519019260753e-02   +3.442444001807801e-01   -1.518921507477955e-01   +3.107182284916747e-01   +3.721154767227509e-01; -2.649107356863412e-01   +3.228082575852250e-01   -1.455176513796379e-02   -4.644818228047877e-01   +1.186338469028655e-01   +7.979841492206188e-02   +4.929024568583078e-02   -1.251137122227812e-01   -1.665871789614324e-01   +1.099579935070765e-01   -1.930172107105076e-01   -3.886431613554325e-01   -2.328967592767348e-01   +9.115084488091091e-03   +3.419252933986686e-01   +3.520157908847700e-01; +5.587999556261318e-03   -1.423999206261740e-02   -3.942839720151087e-01   -1.158735316790692e-01   -2.459572871010291e-01   -1.396501939764095e-01   -1.710521261953619e-01   +2.647467420353033e-01   +1.233946476812843e-01   -1.185410539249185e-01   +1.582274804747419e-01   +3.745795653875938e-01   -3.502741458112502e-01   -1.109270684641470e-02   +1.126376548214418e-01   +2.715027907247803e-02; -5.439433620369163e-02   -4.484287932720055e-02   -4.931607133575563e-02   +1.676217795894308e-01   -1.714826121937341e-01   +4.477734402498196e-01   +2.128171524376304e-01   +3.775502191143669e-01   +9.636258387263064e-02   +7.957647100714633e-02   +1.463209556043162e-02   +3.480326221810170e-02   -1.558148990608967e-01   +8.740876690789691e-02   -1.327017722911383e-01   +1.022232557215223e-01];
L2I_L2E_iAMPA_netcon = [-2.443884355883283e-02   +5.546391877469375e-02   +7.718090543671166e-02   -7.231053066457618e-03   -1.406064610902822e-01   +1.822363433237349e-01   +2.057203133064075e-01   -6.566326334724984e-02; -4.062033647161199e-02   -1.895728129199462e-02   -2.603918149644548e-01   +1.877880363503920e-03   +9.733785028298664e-02   +7.072537058064947e-02   +1.015866112890624e-01   -3.796760829445635e-02; +1.532892584428560e-01   +1.737216289500496e-01   -1.976509441030582e-01   +2.960102776059402e-01   -2.176979177204080e-01   +2.214778522089297e-01   +9.242041803129653e-02   -3.574177916675393e-02; +6.198010558566984e-02   +1.352090928342530e-01   +4.266793650069738e-01   -2.700396982788289e-03   -3.378127273422134e-02   +2.318839858563460e-02   +2.291611797664543e-01   -1.742885315378622e-01; -1.508092033627756e-01   -6.472745486352054e-02   +8.956488701992116e-03   -3.630768117648381e-01   +3.587135839529699e-01   -1.994692548022087e-01   -5.844409820669229e-02   -1.120810233206647e-01; -1.971860128786835e-01   +1.871116820401898e-01   -8.801922226689714e-02   +2.565208863923242e-01   -3.412902713592524e-02   +2.608349640133312e-02   +3.092096098519135e-01   +1.888390510486176e-01; +3.884540030833137e-02   +3.231710225910903e-01   +2.093626503011477e-01   -1.264659204341157e-01   +2.822300959271043e-01   +3.195136331591297e-01   +9.317532248779746e-02   -1.453484885018544e-01; +1.025452049278741e-01   +4.060798229756490e-01   +1.283891764610214e-01   -5.045821521976521e-01   -2.338353970172735e-01   -1.488176169225771e-01   -2.885721147069755e-01   -8.276706325580599e-03];
L2E_L2I_iGABA_netcon = [+2.673552552469774e-01   -3.480677063602355e-01   -2.366496688746207e-01   +9.327438632000568e-02   +2.982131902376278e-01   +9.317245650665062e-02   +8.523953591548350e-02   -7.034669523808841e-02; -3.935336614793633e-01   +1.271930980290762e-01   -1.839102991796794e-01   -1.932280687838421e-02   +1.126884595929440e-01   +3.985091835296791e-01   -1.424133086480203e-01   +1.084351610631859e-01; +4.654612132499477e-01   +1.813376611714995e-01   -2.644600487062000e-01   +1.374919630324981e-02   +1.209286449368565e-01   -6.314199032396692e-02   +3.680580116361852e-02   -8.408737034999777e-03; +2.754886536039463e-01   -1.673529909032429e-01   +1.236614700413525e-01   -1.027310461523783e-01   -1.957880590829753e-01   -1.533082707015223e-01   -1.214531998212308e-01   +1.450812431372910e-01; -8.424752863344914e-02   +7.848647283930421e-02   +1.077268288095728e-01   +2.130991184769925e-01   -3.370571131765381e-01   +1.140311922689673e-01   +1.915773914802343e-01   +2.655163236485162e-01; -8.109551864436654e-03   -1.170204449990792e-01   +2.713306480721794e-02   -3.690758434987827e-02   -1.993385498667482e-01   +2.293811021815130e-01   -3.338374236736811e-01   +2.389587597418439e-01; +1.047344519892079e-01   -2.889068025271470e-01   -1.170210131745783e-01   +4.754324827059118e-02   -2.936983390839378e-01   +2.499021656537760e-01   +1.038000703431940e-01   +6.429947940280485e-02; -4.091541264736668e-01   +9.884286012656505e-02   +4.060199456787167e-01   +1.274045240667756e-01   +1.489387742112057e-01   -1.226686306229571e-02   -1.524254201014671e-01   +3.158679725112650e-01];
L3E_L2E_iAMPA_netcon = [-2.390932748081248e-03   -3.875645180772053e-01   +1.368057464100587e-02   -8.633320110121429e-02   +1.821317968576124e-01   -1.806020587000573e-01   -3.001342464981960e-01   -3.038685476226946e-01   +2.429420758976487e-02   -2.383039720758661e-01   -1.707025193519049e-02   -5.708862110889357e-02; +7.610960685409882e-02   +2.525705179723120e-02   -2.858350523247878e-01   +1.620047157957458e-01   -1.712682417728904e-01   +9.187715198849883e-02   -2.081407319513387e-02   +2.031135720746690e-01   +3.309411836755652e-01   +5.140698012568598e-03   -6.235374984923370e-02   -7.363960782619619e-02; +2.638605376633008e-01   -5.701226891584434e-02   +2.629845025415745e-01   +9.648687016817400e-02   -6.885409523498430e-02   +1.565912003315894e-01   +7.760213366451935e-02   -7.766641737162147e-02   +2.296604370584984e-02   -2.309307000819993e-01   -1.017633370794435e-01   +2.377060995641922e-01; +4.396963795123629e-02   +4.225626781877139e-01   -4.060068130767534e-02   +1.530405321272499e-01   +1.438831912487131e-01   -1.903116396071715e-01   +7.353232127949061e-02   +2.531326088418662e-01   -7.761326005600611e-02   -6.873238100696125e-02   +7.834713880243666e-02   -1.052451200309544e-01; +3.908412996522344e-02   -1.087875972174782e-02   -3.264149458687753e-02   +3.564176964123528e-01   +3.270690990366639e-01   +1.986086582041514e-02   +1.521979297341711e-02   -5.791552522776400e-02   -3.439017317588450e-02   +3.474466291413854e-02   +6.781785392314379e-02   +2.212044855386387e-01; -1.739056895374380e-01   +4.896152381060838e-02   +2.123476974620639e-01   +2.158070084194011e-01   -1.054573254563825e-01   +1.737208877701875e-01   -3.235858730668724e-02   -7.324007563868018e-02   -9.982450681594532e-02   +1.332392006976831e-01   -4.022715054263576e-02   +1.432319773887754e-01; -1.870696530713602e-01   -1.287990283099107e-02   -2.305056388421000e-01   -1.923042569486147e-01   +2.132328822904556e-02   -4.715736078354578e-01   +1.991891129124052e-01   -2.317713431848512e-01   +7.851797165126821e-02   +5.216615330253923e-02   -3.961605572919793e-01   -5.404251424248480e-02; -4.192187340250945e-01   -2.593527274681787e-02   -4.191536107942195e-01   +1.805789364677760e-02   -5.338462546460014e-02   -3.527972014123831e-02   +8.885478351445687e-02   +1.700038426720894e-01   -2.341226898803525e-01   -3.894554608964331e-01   +1.231567061878476e-01   -7.456350687858672e-02];
L3I_L2I_iGABA_netcon = [+3.315139616624088e-01   +2.489578751415797e-02   -4.181135129760588e-01   +1.765355890871758e-01   +3.079011889826237e-01   +6.033250558126286e-02   +3.576384261825392e-01   -1.492980664996214e-01   -3.132678966629550e-01   -1.670170689463598e-03   +7.635128982927444e-02   +1.432598837402012e-01; +2.126777482717270e-01   -2.275880197594822e-01   +2.118907604599645e-01   -1.886810630317148e-01   -1.447879122091273e-01   +1.855558897465807e-01   -1.944032665872504e-01   -1.138663448983988e-01   +9.205538839774194e-02   +3.079529575347159e-01   +1.826659439868016e-01   +1.720266833787356e-01; -6.944039319719150e-02   +5.321188887786976e-02   +2.662811294729966e-01   -2.754922304459594e-01   +2.764691289331565e-01   -1.365106686352671e-01   +1.567947463936571e-01   -9.113452058696918e-02   -3.286551865106748e-02   -3.610269642592958e-01   -1.150878260332959e-01   +2.106229603138400e-01; +1.643031089388584e-01   -1.135985610564719e-01   +1.705095361683913e-01   +3.281659470187029e-02   -2.002658138969155e-01   -4.250735822035522e-02   -2.922924100206735e-02   -1.183922778156146e-01   -4.466461633477427e-02   +8.255941221970551e-03   +2.591515263126015e-01   -1.736690116974202e-01; +1.236987424305281e-01   -1.822487004387243e-01   -6.639072175049505e-02   -2.349719219532866e-01   -1.300874843192939e-01   -9.853161222986895e-02   +1.072826172762650e-01   +3.616917071499546e-01   +1.068104494230907e-01   -4.472736768243293e-03   -2.757397238310353e-01   -1.389865258065839e-02; -5.169457374171599e-03   -4.080663638134732e-02   -4.084758225132706e-01   +5.517104063223731e-02   +1.836945574449217e-01   -2.340743391718665e-01   +6.245033822085970e-02   +8.352038151520225e-02   -1.033575694283394e-01   +2.468037928637120e-01   +1.673778927911988e-01   -1.629255371232947e-01; +1.266830678371560e-01   +2.986997210561328e-01   -2.863287507042074e-02   +1.551507502303453e-01   -4.442434513021828e-01   -1.553306812247343e-01   +1.485035349510557e-01   +2.104046323996793e-01   +1.681124080052420e-01   +1.160911330108810e-01   -1.975004339904152e-01   -7.751872382429303e-03; +1.903973125645903e-01   +1.685476312682122e-03   -1.074826542144466e-01   +2.054706835787120e-01   -5.188152035650645e-02   -1.262076636128649e-01   -2.588551077977139e-01   +1.865560387192527e-01   -4.737795104447064e-01   +1.668551635171927e-01   -2.234554869818785e-01   -1.430633896985265e-01];
L2E_L3E_iAMPA_netcon = [+2.264209998636207e-01   +3.135384146502014e-02   -3.792873420227087e-01   -1.437052665396586e-01   +1.528831547981378e-01   +1.663909069221371e-01   -9.621152307199468e-02   -4.755803271593455e-02; -1.100871126243436e-01   -2.908396521650208e-01   +1.492169080878485e-01   +3.407155835446655e-01   +1.823710247513930e-01   -2.592765892589673e-01   -9.140540230580005e-02   +1.320372152215222e-01; +6.956636256314620e-02   -6.866352782769347e-02   +2.893895543908151e-01   +1.557077834427160e-01   -3.613204199120148e-01   -8.947852755501876e-02   -2.325994185695360e-01   -1.581354031462813e-01; -1.046775550888821e-01   -3.564247241345631e-03   +8.842690934234898e-02   +1.674616834232469e-01   +1.344735159264021e-01   +5.968038072585560e-02   -2.024311013427968e-01   -6.061634230032002e-02; -3.047598167544249e-01   +2.241765964951732e-01   +3.958843322166000e-01   -1.056323567458876e-01   -1.243950691440508e-01   +1.022927120743541e-01   +2.188032674158550e-01   +1.492189404237869e-01; +1.959074274202376e-01   -4.005719538854886e-01   +9.818676774182794e-02   -2.873993721926368e-01   -1.325107286249752e-01   +9.790027297729631e-02   +2.346535278922000e-02   -4.598385443948740e-01; +9.788083926095190e-03   +1.333079314092676e-01   -2.041737351171846e-01   +2.600678828291413e-01   -2.644032299107134e-01   +2.495901955261212e-01   +1.615125747188749e-01   +2.797383462745443e-01; +4.100171623275500e-01   -1.198491573246281e-01   +2.361389445213979e-01   -4.292504320306230e-02   -4.050383119992870e-02   -9.344073113151993e-02   -5.091836487951654e-02   -3.460994341300446e-01; -2.933400505345898e-01   +4.566022222037320e-01   +2.525309661610672e-01   +4.243665679577940e-02   -1.012726110712003e-01   +4.177057038671544e-01   +2.129216882306515e-01   +1.235884698630399e-01; -1.401560631070074e-02   -1.495074536965419e-01   +3.033370014620698e-02   +1.792580800587851e-01   +1.987942405819811e-02   -6.717450498373807e-02   -1.716656058549498e-02   +2.236296954623616e-01; +3.763503683374644e-02   -3.990610311562831e-02   -2.177134820176078e-01   -1.572475706745763e-01   -8.582234465370736e-02   +1.841092103813385e-01   +6.051208643787584e-02   -2.255883050455226e-01; +1.168093340345088e-01   -1.356112272235341e-01   +7.240809083363771e-02   -1.419607861668543e-01   +1.340056005194729e-01   +1.658414856964388e-01   -2.458195280003825e-01   -1.506068848609510e-01];
L2I_L3I_iGABA_netcon = [-3.731163418322760e-01   +1.274798652100051e-01   +7.330131174053402e-02   -4.120771847324815e-02   -5.101230927649553e-02   -1.281769323933488e-01   +1.345461081068273e-01   +8.227745658824390e-02; -1.765829515726738e-01   -2.008628671609584e-01   +2.617260283800296e-01   -2.038394852103440e-01   +1.469786206936156e-01   +2.234545408867831e-01   -7.777398268700922e-02   +4.433837650121271e-02; +3.286059042830480e-02   -8.121723119422650e-02   -4.251201823239148e-02   +9.755997718845924e-02   -6.189961147202847e-02   -2.018338778927540e-01   -1.119828697744810e-01   +1.071164645504934e-01; -6.514154471389338e-02   +7.432858062346245e-02   +3.538068334697834e-02   -4.756817613489914e-02   -1.079367513989901e-01   +3.014710625640592e-02   +7.604404792434578e-03   -7.577954280655554e-02; -1.643870140953168e-02   +2.002625074818439e-01   -3.356630260718351e-02   +4.128496307484265e-01   -1.587100327856251e-01   -2.476063621302396e-02   +1.004631470245522e-01   -6.180655581355518e-02; +9.072988932138898e-02   +2.150090640045049e-02   -2.017448509473327e-01   +2.548852246299295e-01   +1.375394831811558e-01   +3.153072377960838e-01   +6.626194595880595e-02   +4.877489245376987e-02; -1.679043505981406e-01   +1.246061896387370e-01   -6.002265342539635e-02   -3.722021223502478e-02   +1.878157004474120e-01   -3.524038147479068e-01   +2.486135350523573e-01   +2.462625191221091e-03; -3.086651942206806e-01   -4.318983784818837e-01   +1.924010559312612e-01   +6.419409223282768e-03   -1.899680735920062e-03   +1.756595633546424e-01   +1.244950203001659e-01   +2.120680039024813e-01; -1.258427053467352e-01   +3.505911981158164e-01   +2.849066259646448e-01   +3.893393893602124e-01   +3.135413204196624e-02   -1.731124167871056e-02   -6.302691385403114e-02   +7.422048234245143e-02; -3.163070831790121e-01   +8.664875539795154e-03   -2.205657169127089e-01   -8.100907956834186e-03   -9.958936100627583e-02   -2.993465126407530e-01   +4.685704929922310e-02   +2.952395063359092e-01; +9.131215076049072e-02   +2.049453439261631e-01   +2.258803054836748e-01   -1.396358392156325e-01   +1.118415907602267e-01   +9.808531683281888e-02   +7.530965219992032e-02   +3.672460703007836e-02; -5.369836688949323e-02   +1.069185143405279e-01   +1.387798975456024e-01   +2.716758297221943e-02   +1.009913372488914e-01   -8.517335892384265e-02   -2.944775316098946e-01   +3.930258688361162e-01];
L3I_L3E_iAMPA_netcon = [+3.593983272567208e-02   -1.148857404366358e-01   +2.316439696937921e-01   -3.212632428007317e-01   +8.341256597584500e-02   -3.179993307836134e-01   -2.264985827522930e-01   -3.272454734802412e-01   -1.805904542353188e-01   +1.786968368645089e-01   -5.060229591329193e-03   -2.389829616992310e-01; -2.079709153817761e-01   -7.318478915779053e-02   +2.156747670783149e-02   +3.347635894072860e-01   -1.185902044724376e-01   +2.347199179527670e-02   -1.084772978352496e-01   +2.114596750739605e-01   -1.116318710109447e-01   -2.926956370498355e-01   +1.044158934644712e-03   +3.495903393959712e-01; -1.438859977555772e-01   -1.532372623107622e-01   -1.116228334441864e-01   -1.025484602832742e-01   +2.423126634333430e-01   -2.885915595034532e-01   +2.722612504947026e-01   -2.652645325350413e-01   -1.215945356853430e-01   -1.809163142180841e-01   -8.766526826208842e-02   -2.718234596932130e-01; -2.225376426764936e-01   -1.285442057290697e-01   -9.506025062080689e-02   +3.514843860597311e-01   -2.558490581679700e-01   -2.155154187502440e-01   +2.246410196084264e-01   -2.974332624888820e-01   -1.083091677527870e-02   -1.515430436520909e-01   -9.439838262040798e-02   +5.316479234859674e-02; +1.606397522644138e-01   -7.892977736642393e-02   -3.658483536670475e-01   +1.547663541104685e-01   +1.050001183950058e-02   -3.337437807863922e-01   -1.652459100863590e-01   -6.505900245074549e-02   +9.532744706573897e-02   +3.312913185078867e-02   -3.005576168939998e-01   +3.210882009284633e-01; +3.416890964757530e-01   +2.273418805981416e-01   +7.285490400222805e-03   -1.261584921857182e-01   +1.368192309526847e-01   -5.392795058882197e-03   -1.128381025739089e-03   +8.387744500662561e-02   -1.451686168373184e-01   -2.879120002987323e-02   +3.621108942212098e-02   +2.062588856510819e-01; -1.101765137823883e-01   -6.904679652174812e-02   +5.752024946498105e-02   +2.641794421709248e-01   +3.170444744810603e-01   -2.870448529980397e-01   -3.027658765241563e-01   +2.206199359438832e-02   +3.678617567456685e-01   -7.487957379994359e-04   +1.289305397993885e-01   +2.395672818908405e-01; +5.644458585196854e-02   -1.288813532451959e-01   -1.431265797806111e-01   +1.319138696233086e-01   -3.464119132863893e-01   +1.501972210396657e-01   -2.730643659713864e-01   -8.104648932894598e-02   -7.184017040715600e-02   +2.965194127333790e-01   -1.241952456259248e-01   +5.469348315040450e-02; +1.035335955644468e-01   -1.441348035445859e-02   +1.592715907838209e-01   -1.313687026935621e-01   -1.134587187106430e-01   +3.230505395940320e-02   -2.585686525017624e-02   -9.843619924898050e-02   +1.219399759835006e-01   +1.017071242513139e-01   +1.458352179118129e-01   -3.932110895548832e-02; -9.294819308393397e-02   +3.788437327590545e-01   -2.352499177514144e-01   -3.130608165157922e-01   -9.835064190679036e-03   +2.960279715846754e-01   +3.160901355993227e-01   +5.950987630447098e-02   -1.957466673859926e-01   +3.697370270437827e-02   -1.602729297559781e-01   +2.872474787474873e-02; -1.350733782778706e-01   +2.596557387808743e-01   +1.480942492502975e-01   +1.028817460491103e-01   -3.130153965694586e-01   +1.393651971414709e-01   -1.504256331547140e-01   -1.656841177810089e-02   +2.822071825305153e-01   -8.682358257364944e-02   -1.582825697646958e-01   -2.224404937732576e-01; -4.923014177526544e-02   +1.931628015827202e-01   -8.854553800557265e-02   -2.045763097108338e-01   +3.311537242618079e-01   -4.432906223385236e-01   -1.098171631941374e-01   -6.489643226783964e-02   +1.415785222288566e-01   +7.062502307194464e-02   +2.586238482032663e-01   +2.322698077672354e-01];
L3E_L3I_iGABA_netcon = [+3.418152933819689e-01   -2.107822410540050e-01   +1.027385477634359e-01   +1.966119046861727e-01   +1.505833136447314e-01   -7.042824895496719e-02   +2.438442630204505e-01   -5.086176921418507e-02   -1.768221206820437e-01   +2.865383035405524e-01   -3.925892093984087e-02   +2.151038832186943e-01; +2.413615693571410e-03   +7.593236313564805e-02   +1.135612217620322e-01   +1.954632612430359e-01   +2.363497761351193e-01   -6.466398614227511e-02   -1.762857769642770e-02   +3.601854902297293e-01   -5.271911259609790e-02   +2.509424645511895e-01   -2.994800479776694e-01   -2.056530531874126e-01; -1.448242495577446e-01   -3.035115438770485e-01   -1.005419549124255e-01   -5.656799193940118e-02   +2.464893242163137e-01   -3.638196678032443e-02   -3.107403658109034e-01   +1.430218545504294e-01   -2.927225122198970e-01   -1.973450037407838e-01   -2.564766499278953e-01   +1.125572182542541e-01; +2.364638308057584e-01   -1.575994395904674e-01   +2.419772404421874e-02   +4.389142665201874e-02   -1.843763842295670e-01   +1.860502185200271e-01   +1.297652882775669e-01   -2.602762921698301e-01   -1.498402643102240e-01   -3.573677436545220e-01   -1.303293269332233e-01   +2.966678609388523e-01; +1.438194068125087e-02   +2.153342942747655e-01   -3.340470141358642e-01   -4.929478599349213e-01   -1.243669839934041e-01   +3.619305862564000e-02   +4.252619708937815e-01   +1.050226460698230e-01   -4.677758126221046e-01   -2.438949448471188e-01   -4.218423890754744e-01   -2.504723670672634e-01; +4.998287265896605e-01   -1.778553908986480e-01   +2.145711449540930e-01   -1.052980618774572e-01   -6.863708530653906e-03   +1.279850795892002e-01   +1.279601671483644e-01   +9.775424333769209e-02   -1.082735866908479e-01   -3.338114755499851e-01   -3.644721914264901e-01   -1.481976884434080e-01; -3.096500387543903e-01   -8.571140091792211e-03   -9.706254828814763e-02   +3.885359460582302e-01   +7.217421657747145e-02   -1.586551789716381e-01   +1.037330397521469e-01   +1.418530986540398e-01   +4.349547062075111e-01   -2.102643807051436e-01   +3.778290001902280e-01   -2.596894261805937e-01; +2.493101356637630e-02   -1.793314749248793e-01   +3.431760714339803e-01   +2.599650181832304e-01   -5.563043786710604e-01   +1.146818469110076e-01   +3.178470973572617e-01   +2.477806171080094e-01   -5.350115894550493e-02   -4.250001373234400e-01   +2.060340400626682e-01   +2.301723119537184e-01; +2.345642160838856e-01   +1.521912569296423e-01   -1.327733415771122e-01   -1.498098258879372e-02   +1.152909049655760e-01   +7.246958557010252e-02   +1.415588546925981e-01   +3.369348869536029e-01   +6.078866168501532e-02   +1.205007530629107e-01   -4.092120019523142e-02   -4.568909227736687e-03; +5.130305679019463e-02   +1.003593504734467e-01   -6.129536296207291e-02   -7.177144913001172e-02   +1.148633143651734e-01   +2.792368249194148e-01   +1.435034552864657e-01   +1.758881950034547e-01   -1.925341243844129e-02   -3.223313290226623e-01   +3.832899417218961e-01   +3.341982288107029e-02; -1.216498031433941e-01   -3.856683471291180e-01   -2.599052513893573e-01   +2.255623649522857e-01   -1.362459093318762e-01   +3.106754283574166e-01   -5.297686316315564e-02   +2.147539964173801e-01   +6.696172247370158e-02   -1.561681211978822e-01   +3.280837121849168e-03   +1.834739336223759e-02; +2.416236805364959e-02   -2.713416488490018e-01   +1.966851126224746e-01   -3.761701923232861e-01   -1.802761970690741e-01   +1.949584291795738e-01   -2.097672840115601e-01   -2.904469252619972e-01   +1.978733512908681e-02   -1.784448703362490e-01   +1.857558809284814e-01   -1.564943551443091e-01];
L2E_Input1_iAMPA_netcon = [-6.767305127731124e-02   -2.002769883692614e-01   -2.085421874913005e-01   -6.945150292881064e-03   +4.675134047651281e-02   +9.654349875459120e-02   +1.501670925013599e-01   +1.095544052422551e-01];
L2I_Input2_iAMPA_netcon = [-8.490929803705427e-02   +7.864630796886773e-02   +4.208232873103875e-01   +9.497674460925357e-02   +1.230384594542044e-01   -2.593189769887487e-01   +4.870069867510154e-02   -1.368770460611190e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
