function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.549738382095229e-01   +1.036643859494168e-01   +1.917213433348012e-01   +1.371371488987036e-01   -3.972774907876853e-02   +3.936732155757939e-01   +3.176411973721271e-01   +1.375484642512879e-01   +9.885490581263730e-02   +4.997857948571207e-01   +3.062184823670596e-01   +2.644837235216160e-01   +2.884470549586119e-01   +2.157226940558293e-01   +4.831396242932426e-01   -1.104918810535336e-01; +2.860309814003949e-01   +2.268550496701815e-01   -3.777059439594150e-01   -2.586994870185246e-01   +4.133473876254785e-01   +4.690603564713345e-01   -3.152514312154808e-01   +1.545450966210836e-01   +1.237646526681116e-01   +1.537385656450309e-01   +4.527816058971995e-01   +5.288113967443910e-01   +8.639466741209759e-02   +3.448092256291997e-01   -3.176413927992032e-01   +3.070210203332854e-01; -9.680627938597260e-02   +2.481011837007554e-01   -3.234446868760157e-01   +3.317219290386611e-01   +5.301078478019801e-01   +2.472720833420541e-01   +4.976317155708948e-02   +5.257485537194377e-01   +4.860905451263767e-02   +4.634673956274419e-01   -4.701521977270921e-02   +9.779152710552713e-02   +3.522263892245800e-01   +2.915926133142145e-01   -3.081050512299049e-02   +3.759317558800294e-01; +3.705325166701722e-01   +3.175628397026638e-02   +4.665824413771566e-01   +6.753954423326710e-01   +2.458925991279561e-01   +4.690637630944620e-01   +5.187720579492966e-01   +8.716724815365017e-01   +6.173480056807930e-01   +1.601402103254349e-01   +2.023955510683884e-01   +2.537477002755791e-01   +9.814605213059915e-02   +2.988859991453431e-01   +2.936150994549609e-01   +4.813510094333085e-01; +2.664203687755960e-01   +3.852793062272412e-01   +1.801929313567810e-01   +5.358624729480528e-01   -1.897955424974505e-01   +1.230290383311877e-01   +1.683016803331369e-01   +8.144355974734195e-01   +4.285906128836359e-01   +4.487602073795629e-02   +1.000000000000000e+00   +9.286986797325360e-02   +6.126875965719755e-01   -1.408268661343647e-01   +4.171977537873577e-02   +6.006431124823102e-01; +1.974460215659127e-01   +5.548920800911434e-01   +4.968666358802699e-01   +1.077148290256847e-01   -1.929059568503829e-01   +3.343476776002449e-01   +1.370602584867757e-01   +3.104936509838805e-01   +3.040841351313245e-01   +4.091248401853256e-01   -1.543525891535748e-01   +4.644465401369315e-01   +3.194967113188284e-02   +3.860621938362727e-01   +1.326361590869196e-01   +7.233907168557953e-01; +4.446514317935167e-01   +1.936996327265660e-01   +2.735295296816805e-02   +7.316176084847065e-02   +2.462255327278113e-01   +6.477676000429057e-01   +4.317227610825204e-01   -9.467271857805337e-02   +2.238842215033005e-01   +2.149576507408175e-01   +3.438317917202176e-01   +4.801725375966603e-01   +3.471154280110922e-01   +5.421512771563030e-01   -3.230337025906459e-02   +3.280883292282681e-01; +1.713239194416955e-01   +2.997991925610551e-01   +4.770193842284782e-01   -1.952077000296432e-01   +2.535857566106741e-01   -1.697799947191152e-01   +4.007927755977295e-01   +2.764436146201075e-01   +1.035555283509547e-01   +4.420055855036074e-01   +1.884126617912695e-01   +1.711720351664587e-01   +5.421616557338794e-02   +6.753935478422643e-02   -8.650692038094775e-02   +2.121579196580877e-01; +2.222001162626330e-01   +5.785361262217015e-01   -2.054418264507760e-01   -7.495598375595525e-03   +7.023083051339809e-01   +1.440276053641188e-01   +3.365439009468375e-01   +1.102008633605042e-01   -2.639179459553187e-02   +5.276534422972925e-01   +5.448220039843202e-01   +1.543083287940191e-01   +2.044895190673010e-01   +2.999776566014004e-02   +2.382846979005507e-01   +5.456035764430758e-02; +2.113626405889343e-01   +4.257724897459381e-01   +3.692245106930311e-01   +5.360619837186140e-01   +1.161054677047972e-01   +5.867771567332029e-01   +4.149764424374632e-01   -2.064394460444722e-02   -6.255134706918079e-02   +3.161745031568046e-01   +8.821192384169195e-03   +4.392741307558706e-01   +7.369162010271989e-01   +6.372519929851503e-01   +2.893467967513291e-01   +3.749047019025530e-01; +1.730988377077862e-01   +7.505132383360309e-02   +3.739504756786867e-01   +2.535447147466484e-01   +2.039088231635200e-01   +3.084951707384289e-01   +1.928758413723391e-01   +3.478569694546870e-01   +3.471554315815632e-01   -1.562153278547655e-01   -5.429253795150243e-01   +1.503487745382792e-01   +3.060013832684250e-01   +2.582973329840034e-01   +4.509109913099005e-01   -8.772754855112383e-03; +1.085108940368591e-01   +1.086502944155597e-01   +1.573388255707321e-01   -3.691618404122998e-02   +3.860845006719094e-01   +2.029454519357889e-01   +3.024742315892857e-01   -2.847255985809851e-01   -2.111601941287087e-02   +3.519287067926335e-01   +8.552338644870067e-03   -2.569370290386285e-01   +4.364957829845441e-01   +4.200747276399397e-01   +2.582060665545016e-01   +2.279475684561357e-01; -1.341784515638131e-01   +1.396180989757812e-01   +5.574166445376659e-01   +4.198408794996000e-01   +3.397394725544884e-01   +8.317586645656077e-01   +2.711081551125796e-01   +2.867680547024995e-01   -1.817692864133027e-01   -3.377991968104786e-02   +3.585697867813509e-01   +5.175009803210336e-01   +2.415117800844513e-01   +2.988531691493246e-01   +3.473514419950945e-01   +1.450283432776636e-01; +3.756421729884162e-01   +4.747068081584154e-01   +5.271282875718617e-01   +4.265932159880353e-01   +2.344250233594759e-01   +2.975907633913322e-01   +9.518455158627177e-02   +9.735030828180312e-02   +3.265754928693779e-01   -2.103348583228408e-01   +3.129586170866617e-01   +1.387946540963911e-01   +2.003054812178142e-01   +7.304385068259224e-02   -1.799672192056422e-01   -7.191178401908194e-02; -2.971519481079443e-01   +2.821048888481000e-01   +6.136870461783369e-02   +3.829249730130836e-01   +1.481688535505204e-01   +4.831352751492531e-01   -3.243047778965314e-01   +1.723674711162388e-01   -2.368928835113281e-01   +1.191030499353165e-01   +5.015740535983679e-01   +4.201736386199048e-01   +5.055235631405773e-01   +5.964723774644402e-01   +4.379679900014919e-01   +2.655241025701705e-01; +6.954027289091939e-02   +2.729434722064246e-01   +1.094076133468941e-01   +3.093676829598595e-01   +3.299956032649609e-01   +1.722963079508002e-01   -3.150248561214729e-01   -8.421886429425421e-02   +2.292960528414978e-01   +3.452059961554402e-02   +9.298881549921728e-02   +1.042332141715149e-01   +4.206272087711103e-01   -5.698164749715062e-02   +1.842059640841311e-01   -6.297208422167636e-02];
L1E_L1I_iGABA_netcon = [+2.958737938030829e-01   +3.358291617444510e-01   +5.933976669739564e-01   -2.745000590351555e-02   +2.500624956002124e-01   -1.280380043714699e-01   +4.680028777080550e-01   -1.589865113517392e-01   +5.068935337410185e-01   +5.607841219194512e-01   +4.866729899341421e-01   +2.976861052757673e-01   +3.656099037740296e-01   +2.040061982722951e-01   +2.624181351292071e-01   +3.929450662555091e-02; -1.044170856285869e-01   +2.975114316981650e-01   +1.826115798309557e-01   +2.259292329962207e-01   +1.111971780242237e-01   -8.116845170137442e-03   +1.874541590204007e-01   -4.959838605497568e-02   +5.674135025187887e-01   +2.213265818822550e-01   +3.193725233155873e-01   +6.400832148816425e-02   +4.105065329848865e-01   +7.309653499558286e-02   +3.752783150730468e-01   +1.837471727650139e-01; +4.925946072736475e-01   +1.165787675599612e-01   +2.943103913672678e-01   +1.080169474840986e-01   +4.832077521927730e-01   +4.746407028234176e-01   +1.196587852994281e-01   +2.635967594651388e-01   +2.505989143305123e-02   -1.801447295158553e-01   +5.390372022293625e-01   +4.662025444734536e-01   +2.357839494562122e-01   +5.638473282717678e-03   +3.783218122311668e-01   +4.785238664575578e-01; +1.188822367218045e-01   -4.131115284669439e-02   +6.607660553973950e-02   +6.324201995300741e-01   +4.046100543750219e-01   -4.059646264691296e-02   +5.450670216898144e-01   +1.349555502037674e-01   +5.875918274482184e-01   +5.926554070334910e-01   -1.576952045785767e-01   -1.475706054000845e-02   +5.459754756169238e-01   +1.412811083392551e-01   +4.034569437361504e-01   +3.210968743701653e-01; -1.960906481306161e-01   +1.577810411956432e-01   -6.783170931442402e-02   +1.383865037585081e-01   +2.639119793629729e-01   +4.679998201533732e-01   +4.711378449902358e-01   +2.898636729336811e-01   +3.080868093106545e-01   +6.324458493376646e-01   -5.968276365130178e-02   +2.419435232123155e-01   -4.917598753266793e-02   +2.748783999917463e-01   +4.677685221770461e-01   -3.173404331198201e-02; +3.933991862524704e-01   +4.687372036013451e-02   +4.571537125694873e-01   +2.240556995631528e-02   +1.526636208900357e-01   +7.615286261513556e-02   +4.401323031116166e-01   +3.008117917078024e-01   -1.673075948154203e-01   +1.935482926804352e-01   +3.879296725373756e-01   +7.797980434488681e-02   +3.368158534043457e-01   +2.227683846484661e-01   +3.917695957865963e-01   +3.019721267166492e-01; -1.306690051591883e-01   +1.513849596018507e-01   -1.487670533379511e-01   -8.276849867105381e-02   -4.304527752069116e-02   -4.127489111665281e-01   +5.595112851860353e-01   +3.694676410938202e-01   -3.813542563649137e-02   +5.173936780987912e-02   -1.474939807131979e-01   +7.268781195966606e-02   +6.095390873139266e-02   +8.829640654537591e-03   +4.444743133429636e-01   +2.981145879482415e-01; +2.728266062982933e-01   +6.991131099479457e-01   +3.780271491281007e-01   -1.553984051989255e-01   +1.409036989896227e-01   +4.003277847386588e-01   -1.032451789526958e-01   -3.286744294282714e-01   +3.140969764487782e-01   +2.929766430046672e-02   +4.536376976278480e-01   -9.143803303956287e-02   +2.384941723103120e-01   +4.781924116549562e-01   +2.841413818408689e-01   -1.349720497889426e-01; -1.329425932254072e-01   -1.102276957447551e-01   +3.072561622283068e-01   +2.156086306551991e-01   +6.295475313098463e-01   +9.800400305121730e-02   +2.662569518091458e-01   +2.246009407852438e-01   +1.269341270001310e-01   +2.232705227654643e-02   +4.616796482504794e-02   +3.536736879707594e-01   +2.539124549316326e-01   +7.264945920348085e-01   +1.469420923650986e-01   +2.332033242313833e-01; +1.792607305425266e-01   +1.000000000000000e+00   +3.456673111975257e-01   +1.728970792669057e-01   +1.554863038389409e-01   +3.732913089709538e-01   +1.959558200708654e-01   +1.919852737231008e-01   +5.502006230489793e-02   +4.045603440542715e-01   +3.676605463493526e-01   +3.757425295567151e-01   +1.240436474179525e-01   +1.743915874260436e-01   +3.893841178253935e-01   -5.837920550592964e-02; +2.813958918765420e-01   +9.541356704413231e-01   +3.663634930626439e-01   +2.098192354353494e-01   +4.766021034308673e-01   -2.129978000384641e-01   +4.497130001880544e-02   +4.143287306236422e-01   +4.507558952693756e-01   +4.895892818617360e-02   +4.213195066729049e-01   +2.548139493327939e-01   +1.455517615933075e-01   +2.598033752057934e-01   +7.167944326566623e-02   +4.676167825797104e-01; +6.483404404124224e-01   +2.664341096512543e-02   -1.413059425530335e-01   +3.407527708056264e-01   +6.620489399780601e-01   -6.708487273952581e-02   +1.793019331231079e-01   +2.969050702786749e-01   -5.324168730990079e-03   +7.493341982611988e-02   +3.234611504671972e-01   +4.472517247125234e-01   -2.819396823479602e-01   +2.145889717193160e-01   +2.521087616130464e-01   +5.359147956805704e-01; +2.563501988185292e-01   +6.030581538875197e-01   +4.697628443576858e-01   +2.098362417201069e-01   +2.155538958025396e-01   +8.475257178947789e-01   +1.476028262613603e-01   +2.351562076597283e-01   +4.926017815623041e-01   +2.803714703308140e-01   +4.869417100981243e-01   +1.388690429901741e-01   +1.308217022425250e-01   +1.920557485711712e-01   -2.554019469128684e-02   +2.146783645262088e-01; +4.527410620612800e-01   -1.426848115685301e-01   +4.848646941081254e-01   +5.260799998929734e-01   +5.430897814267531e-01   +5.104281996513937e-01   +4.662072720583385e-01   +6.455922413653832e-02   -1.991549030487324e-01   +4.499596514685243e-02   -1.100264046040543e-01   +2.516971473163652e-01   +3.080919173888390e-01   +3.424558341338525e-01   +1.840647441732719e-01   +2.896464973921561e-01; +2.618263692260666e-01   +6.201427026523256e-01   +9.729005639506827e-02   +2.035774223757124e-02   +3.820551009492114e-01   +6.251375528535469e-02   +2.352304543663702e-01   -2.703494902508175e-01   +3.890256993670587e-01   -1.406319363157299e-01   +3.111552003739297e-01   +3.012868267250691e-01   +3.965731885638344e-01   -1.696485658546990e-01   +2.969980841106780e-01   -2.363193668380000e-01; -1.837428987882185e-02   +5.154962073603964e-01   +5.650815040470792e-01   +2.280164450971224e-01   +1.134893644976303e-01   +3.393669557767292e-01   -7.212377591668872e-03   +3.618461127670720e-01   +4.844064854605445e-01   -5.460824665826207e-02   -5.503958251561943e-02   +4.166883475566237e-01   -1.146815527080130e-01   -1.400517408611081e-01   +8.163138133218464e-02   +2.048506521816285e-01];
L2I_L1I_iGABA_netcon = [+2.562202403023029e-02   +1.649909279402109e-01   +7.958259623348571e-01   +4.299833940987888e-01   +5.397580614686852e-01   +5.185170015857656e-01   +5.877521313786075e-01   +4.910624988160608e-01; -1.046515530790186e-01   +2.148580729920314e-01   +2.070875918941943e-01   +2.476041797062913e-01   +2.325815955953961e-01   -1.650995716574949e-01   +5.841940662313635e-01   +5.083293185293608e-02; +9.307479443441362e-02   +4.448033810313790e-01   +2.540709539315825e-01   +2.354144277593303e-01   +4.125894008654017e-01   -3.720594093082757e-01   +6.111896339780885e-01   +3.089540933388603e-01; +3.744216860884189e-01   +1.225179328814427e-01   +2.573664829518291e-02   +1.988905960384700e-01   -6.979071497118959e-04   -3.948500772608489e-01   +1.586350662081934e-01   -8.267793220577754e-02; +3.970576111313736e-01   +6.106781673164805e-01   +1.171919187586153e-01   +2.546915491184525e-01   +5.002048627444777e-01   +2.472325065311403e-01   +7.762732563138923e-01   +5.005969913006258e-01; +3.489684282436039e-01   +4.408245206064106e-01   +5.223553749393657e-01   +3.665031527460391e-01   +2.580561014111597e-01   +2.483460620191455e-01   +6.937456926438023e-01   +4.638984954914912e-02; -5.397902705865387e-02   +6.927450849802027e-01   +4.814862164032570e-01   +7.884339505218478e-01   -1.315649505700790e-01   +1.491254976363441e-01   -2.360219468742632e-01   +3.451036549614178e-01; +6.233764380768403e-01   +6.112359257392613e-01   +2.656361661269586e-01   +6.725350549431915e-01   +1.861416151536884e-01   +5.014923269814594e-01   +3.170616093624726e-01   +1.512199426177513e-01; +4.566550373315725e-01   +4.638130292517813e-01   +6.338360177950960e-01   +5.632321117227373e-02   +4.084164392392376e-02   +7.981759231455227e-01   +3.701989843112759e-02   +4.401817120396795e-01; +1.000000000000000e+00   +1.552292145817312e-01   -1.184268094654481e-01   +4.572240385476277e-01   +1.199570338059145e-01   +4.164666102830222e-02   +2.385234352101070e-02   +4.911486381303440e-01; +1.140506051600120e-01   +9.378001887023698e-01   +2.945246761600049e-01   +5.478250983123510e-01   +2.389426607664852e-01   -2.037509465934640e-01   +6.337537560565765e-01   +4.106132967607080e-01; +3.617765480719980e-01   +7.730458803523471e-01   -2.588572578265353e-01   -2.054908012988664e-01   +1.039799962403015e-01   -3.381333088574071e-02   +3.957026928396115e-01   +8.265042891957161e-02; +8.344590678390121e-01   +2.824373148129777e-01   +5.978733004983816e-01   -8.975008482734820e-02   +5.015521062795876e-01   +5.464954129180453e-02   +7.949300099376488e-01   -1.165924298134101e-01; +5.067175500852454e-01   +6.845454291257314e-03   +4.315080153167302e-01   +2.081737358222034e-01   +4.418207799118774e-01   +3.813209664896064e-01   -1.321280166207901e-01   +1.871501293321262e-01; -1.197535483697206e-01   +9.826350872411022e-01   +3.828957937392427e-01   +2.507483718139191e-01   +3.690386666386230e-01   +4.745744952169706e-01   +1.034037565794813e-01   +1.641364636717787e-01; -2.165917351832880e-02   +4.980160528791432e-01   +1.626515904054566e-01   +1.307365139339188e-01   +9.627690134814831e-02   +3.460725558666877e-01   -1.981593524216070e-01   +1.105417102614442e-01];
L1I_L2I_iGABA_netcon = [+2.180325363012782e-01   +4.230873429067863e-01   +9.857621191263444e-02   +5.878448141275419e-01   +6.167689391447408e-01   -1.028283303507678e-01   +5.875585650807523e-01   +3.005740875043915e-01   +1.065057883991738e-01   +3.630366506077756e-01   +1.996985162882559e-03   +1.777144172037111e-01   +6.478253147457992e-01   +3.287314274438450e-01   -1.477149609458858e-01   +2.224919625325698e-01; +8.866902962369749e-01   +6.886200270988185e-02   +5.911359178091418e-01   +9.492586747683623e-01   +2.674791609768806e-01   +9.847409161569102e-01   +2.168877054603545e-01   -4.463669694081891e-02   +3.022936950029056e-01   +2.051680361277633e-02   -6.846501166013563e-02   +9.134370642214943e-01   +5.874603238371436e-01   +1.459958194901331e-01   +4.735500278268012e-01   +5.684601076680027e-01; +6.062897078817847e-01   -6.032512362416229e-01   +5.401390365423020e-01   +3.465428058377327e-01   +6.120441334511441e-01   +3.138441364825798e-01   +5.440652559377068e-01   +4.872803294793414e-01   +4.279892001369372e-01   +4.101494779936242e-01   -2.679078487077197e-02   +1.903048454167811e-01   -6.568532378603753e-03   +5.946456586845911e-01   +4.318710685640208e-01   +3.593420624304158e-01; +1.974390594127304e-01   +3.962761038870416e-01   -4.774495716491103e-02   +2.806976852656949e-01   +2.891833131377395e-01   +4.726462350750715e-01   +1.000000000000000e+00   +3.912308462165110e-01   +4.564880813865542e-01   +1.950808634488420e-01   +1.766017246798161e-01   +5.180935951727935e-01   +3.339782284869342e-01   +4.202259753225027e-01   +7.307016347465181e-01   +3.563683872422053e-01; +1.735813841268636e-01   +7.182166250600330e-01   +3.884044097409902e-01   +1.914086423129309e-01   +2.944888409181814e-01   +8.021654892051812e-03   +2.601936212585074e-01   -7.122990669256632e-03   +1.383621188976546e-01   +2.784309416348150e-01   +5.550306737689777e-01   +5.020447598714277e-01   +1.708850829296572e-01   +8.339857777583433e-02   +5.862619230372189e-01   +6.097096856990777e-01; +6.986566295275063e-01   +3.585571177752229e-01   +5.518536147546141e-01   -2.352548965427326e-01   +2.147402602974421e-01   +1.621837005371812e-02   +7.582353777773387e-01   +1.328506769429537e-01   +5.651394103834468e-01   +7.929145868985527e-01   +7.193202161447193e-01   +1.837509529452883e-01   +3.000763459823528e-01   +1.599733390732450e-01   +2.309233260152693e-01   +3.977905777576204e-01; +6.101123629064593e-02   +3.823605742931261e-01   +3.548154270607040e-01   +6.226379352030471e-01   +2.890943425759119e-01   +8.327540132509226e-01   +6.587965828412246e-01   +2.490591402756356e-01   +4.816149724242694e-01   -2.738499804731785e-01   +7.243062709272052e-01   +2.210263089786964e-01   +3.684436819489861e-01   +3.781148383341483e-01   +1.829318336910479e-01   +3.942126844576662e-01; +5.768506229851116e-02   +6.944499976901465e-01   +4.679777718578192e-01   +6.473540798341202e-01   +4.226684848068411e-01   +4.106158125339094e-01   +5.565009310518678e-01   -2.802118864435695e-01   +5.887658102158708e-02   +1.304230286923936e-01   +1.538637752928242e-01   +5.365066075098809e-01   +2.812078439636647e-01   +6.921448347326684e-01   +3.688359570494966e-01   +2.382933684871266e-01];
L2E_L1E_iAMPA_netcon = [+1.274169805139020e-01   +5.083288357375900e-01   +2.817025697240892e-01   +3.480258695612326e-01   +1.449815447927950e-01   +3.335396288855461e-02   +2.447760537734870e-01   +3.040859866252552e-01; +2.255092048872697e-01   +3.811379669799714e-02   -2.820648735800067e-02   +6.995538065619757e-02   +3.878536150029132e-01   -2.660546252912353e-02   +1.278455157495598e-01   +1.983749470874666e-01; -1.345099611203506e-01   +6.114694750148838e-02   +4.521245337798718e-01   +9.884804332492513e-01   +6.792046848523213e-02   +3.750512165842734e-01   -1.109911261517548e-01   +3.863745743680911e-01; +3.144915945635957e-01   +9.371854701335673e-02   +2.032391251734033e-01   +3.223052869385404e-01   +4.158096447421906e-01   -6.474105892325678e-02   +2.844737410812176e-01   +2.953120314336276e-01; +5.187654949886016e-01   +4.565648230573203e-01   +3.450644770411638e-01   +1.609812726553909e-01   +1.788711528236481e-01   +5.153115945094481e-01   -4.437598726546656e-02   -3.038880131405591e-01; +5.243667279432638e-01   +5.939541701941111e-01   +2.451620497651888e-01   +3.341721431087217e-01   +4.436956645613506e-01   +7.121397872332239e-02   +4.789877607199547e-01   +8.083026782430259e-01; +8.140026511665569e-01   -4.947953327951793e-02   +2.597131481131614e-01   -1.263283402857018e-01   +3.606355479278550e-02   +1.856224357642314e-01   +6.182867432829214e-01   +5.224576386419483e-01; +6.715351204723315e-01   +2.734716435314249e-01   +3.683119011269740e-01   +6.047535756388632e-01   -2.733665827446444e-02   -6.465366736702009e-02   +3.858574967096962e-01   +1.000000000000000e+00; +2.577440360486265e-01   -1.483457939564697e-01   +3.350159559456975e-01   -1.184369900354841e-01   +3.593135428981643e-01   +4.164949408421040e-01   +3.776905428354984e-01   +1.689715481029943e-01; +3.192566343632052e-01   +4.125358346418061e-01   +2.192432916052759e-01   +4.696090307120145e-01   +3.782824797083468e-01   -6.899251417422675e-01   +3.668259691859531e-01   +3.521792114519592e-01; +2.545066227524444e-01   +2.535557859646496e-01   +4.062226737648034e-01   +3.841710794792170e-01   -1.010285783708519e-01   +9.998186148071171e-02   +4.387315104583658e-01   +2.380985652133859e-01; +4.367937950138689e-01   +1.225999547457957e-01   -3.820480689041186e-01   +6.339053859033768e-01   +2.181843744443123e-01   -1.004107892956725e-01   +2.387051231781889e-01   -6.056825823210181e-02; -7.713281092671596e-02   +2.385597271713572e-01   +4.133627467386660e-01   -2.374737822472587e-01   +1.367776968501688e-01   +2.171721067641253e-01   +1.058088200674542e-01   +2.393045425298625e-01; -1.611257294114605e-01   +3.588988819128238e-01   +7.448809424793100e-01   +3.830464984133092e-01   +2.256242862535461e-01   +4.652748478702197e-01   +3.368412726902995e-02   +1.224117922261197e-01; +1.361028591123385e-01   +5.296074077172257e-02   +4.244862173220558e-02   +5.321788931113897e-01   +2.308887118151208e-01   +4.937810545373512e-01   +2.971563403762043e-01   +4.667612110591979e-01; +1.294451135834966e-01   +3.487986950736753e-01   +2.614935832148687e-01   +3.368668089817317e-01   +1.006175739142730e-01   +2.686009365812891e-01   -5.998496645733063e-02   +2.348212988993782e-01];
L1E_L2E_iAMPA_netcon = [+5.617461617693785e-01   +7.665126839118731e-01   -1.247711159030697e-01   +5.724938060935296e-01   -3.431438208144960e-01   -1.144582235660750e-01   -2.327739250644593e-01   +8.613504328544659e-01   +7.900949174904821e-01   +2.318305992061447e-01   +4.860669683597589e-01   +7.802244857420987e-01   +6.131870192444473e-01   +1.479685924518941e-01   +1.451214312488629e-01   +6.257572800192523e-01; +1.630047135952816e-01   +5.900241828068749e-01   +3.819300922746693e-01   +5.006458596644320e-01   +2.091204790260800e-01   +1.118909408507997e-01   +5.601135690853024e-01   -1.299151402163823e-01   +1.521825058469114e-01   +6.638773009053572e-01   +4.668407908028374e-01   +1.708035916544975e-01   +4.859446664009219e-01   +6.649442138214000e-02   +3.891362416896138e-02   +2.517696632109480e-02; +2.381445488049914e-01   +5.082302645551352e-01   +4.432618288993976e-01   +2.436200058714715e-01   -5.798049451769956e-02   +1.466992410986482e-01   +2.571173405685091e-01   +2.120322034644042e-01   +5.222040330516409e-01   +5.955602311138474e-02   +5.958659553726615e-01   +7.690036731342786e-01   +2.392717423105043e-01   +7.558350063873387e-01   +4.437801897658554e-01   +3.674959650472209e-01; +1.307257660729369e-02   +4.257527841977091e-01   +5.869492799910368e-02   +3.787921368766564e-01   +4.437313552636253e-01   +9.101606086576117e-01   +2.506079829548572e-01   -1.210133070964393e-02   +2.960356564334254e-01   +3.355678212232687e-01   +4.753113809533563e-01   +1.899064471407666e-01   +3.099477449162734e-01   +1.705171223434695e-01   -1.235344706733299e-01   +1.113679557384677e-01; +7.909545316105870e-02   +8.010442004342418e-01   +4.229080813761126e-01   +2.967847372365007e-02   +2.805470356428088e-01   +8.121627736666044e-01   +1.725340096501483e-01   +7.860823242420616e-02   +4.688071093041597e-01   +4.094200878092390e-01   +9.176635142761599e-01   -2.738292877410189e-01   +4.279641646970178e-01   +4.890138081406574e-01   +8.895499211116038e-02   +2.468345132077068e-01; +5.924904771392004e-01   +8.924007620843374e-03   +4.633921600013420e-01   +5.508378156643672e-01   +2.481870566395193e-01   +1.210313776365942e-01   +5.317015961907359e-01   +3.629873475155289e-01   +4.371190699016524e-01   +3.039341487017695e-01   -8.724346203642200e-02   +3.164825353511031e-01   +2.641230450236242e-01   -7.511729209794638e-02   +6.018971808020683e-01   +7.766337330487814e-01; +6.198468324042004e-01   -6.165790442838479e-03   +5.219800077063502e-02   +1.937584117590233e-01   +3.239722533001713e-01   +1.671310490655356e-01   +5.879245432639153e-01   +6.648194619462423e-01   +1.707315235295394e-01   +3.927587665535546e-01   +5.397702319087285e-01   +4.904515665051209e-01   -3.867942583699872e-02   +3.100206092511690e-01   +1.979661719309203e-01   +2.950459427435696e-01; +4.773256553727187e-01   +3.629899421446911e-01   +5.550535451917171e-01   +9.334666554064730e-03   +7.523449705999971e-01   +4.325535206264361e-01   +1.674509221712764e-01   +1.281766666129902e-01   +3.224736654695678e-01   +3.703181607099598e-01   +2.077145616193361e-01   +2.681479692852384e-01   -6.294160812590807e-02   -3.387435678384463e-01   +1.842498081997075e-01   -4.368384303429568e-02];
L2I_L2E_iAMPA_netcon = [+3.734992723479640e-01   +8.428646959968396e-01   +5.772599773135362e-01   +6.004126611368252e-01   +3.514521576975880e-01   +2.976826122549498e-04   +5.439115785104133e-01   +4.674630963140143e-01; +6.113355240986645e-01   +5.998854679515641e-01   +1.835311786678082e-01   -2.396577220710996e-01   +2.393910282345112e-01   +3.261698154156333e-02   +4.233721102781760e-01   -1.357665696323680e-01; +2.164436415837632e-01   +5.761111054239579e-01   +7.116626613018808e-01   +1.546970064030547e-02   +8.053348601400821e-02   +2.141274554327032e-01   +3.211491687400463e-01   +2.445978255678978e-01; +3.884040686519104e-01   +6.862458190090811e-01   +2.216973926532365e-01   -7.517023160523244e-02   +5.137480657585326e-01   +7.620000840647386e-01   +3.490399231444803e-01   +8.266673919193140e-01; +1.000000000000000e+00   +1.719211981490522e-01   +4.694040511296389e-02   -1.886219747777103e-01   +2.543391319368863e-01   +4.593470379565016e-01   +3.555176456118144e-01   +1.198650691277661e-01; -3.269212924019273e-02   +1.085113064959676e-01   +3.290033403024992e-02   +2.165266664607097e-01   +3.232423676788785e-01   +6.275369828901549e-01   +5.886355937109365e-01   -7.258675754455408e-02; +4.855604820973493e-01   +1.296904775110650e-01   +3.126275613003996e-01   +1.433124935404361e-01   +3.507515095199584e-01   -6.411331920989966e-03   +2.113780084873982e-01   +3.149721628797166e-01; +3.470592958606991e-01   +8.942610136650880e-02   +2.879785285595596e-01   -7.541177440412725e-02   +4.769315799427715e-01   +1.855598645323456e-01   +3.692714689942157e-01   -1.015252299226675e-01];
L2E_L2I_iGABA_netcon = [+1.000000000000000e+00   +4.636284071532069e-01   +4.662683541762464e-01   +4.283224349420473e-01   +2.339564750966559e-01   +1.646963632904400e-02   +2.493497738744797e-01   +6.006338321889549e-02; +2.991269049163048e-01   +5.810543193161722e-01   +7.735381445456034e-01   +8.658812564063485e-01   +1.255211213648935e-01   +2.142361158325400e-01   +2.520943606931343e-01   +4.718137534390435e-01; +2.747622744618315e-01   +4.278095401276773e-01   +5.616617393615786e-01   +5.519097344522864e-01   +4.311309268908327e-01   -3.141645585802149e-01   +4.238124368554377e-01   -2.649511150497696e-02; +1.704529758102497e-01   +3.301686992508800e-01   +7.131892369871509e-01   +3.035464781295573e-01   +3.457325580803529e-01   +2.004251790477133e-01   +4.854369267848912e-01   -4.471975080389106e-01; +4.722641716407593e-01   +6.876164852473553e-01   +3.058643448969344e-01   +3.609222180111487e-01   +2.113362835623137e-01   -2.861862792730100e-02   +7.260565921046167e-01   +2.022474011814641e-01; +1.837150836025330e-01   -2.895848669536530e-03   -1.863360475084572e-01   +1.940736827818198e-02   +3.028792086097513e-01   +3.642902310617542e-01   +4.508979717646256e-01   -7.875868025440766e-02; +1.987885782709643e-01   +3.240292884894301e-01   -3.332598234193391e-01   +3.352617969022345e-01   +2.780127505640226e-01   +4.269473849630877e-01   +5.008732220907597e-01   +5.568523838932402e-01; +2.740086421656630e-01   +1.557034816764723e-01   +6.518484300004388e-01   +1.091349856735858e-01   +3.556432283589306e-01   -1.173414838996149e-01   -5.718051706253673e-02   +4.277882423000032e-02];
L3E_L2E_iAMPA_netcon = [-2.219591108743799e-02   +1.458399602631467e-01   +3.421832830049334e-01   +2.903347115137939e-01   +6.793386859232606e-01   +2.331942863006767e-01   +7.164036467237413e-01   +7.655957115777859e-01   +3.316694117235262e-01   +8.915576229881707e-01   +6.798181754147054e-01   +4.346118379055344e-01; +3.610838915061385e-01   +3.125875401832625e-01   +6.741263032598701e-01   +4.899708765670457e-01   +7.395543558453588e-02   +5.838117907132839e-01   -1.191346003874705e-01   +7.000149824626399e-01   +5.232997727417182e-01   +2.288500269705599e-01   +4.760714328716634e-01   -1.504431327155870e-01; -3.870618285768979e-01   +1.699322130692385e-02   -1.650706617190945e-01   +2.885539648289768e-01   -4.948630556039850e-01   +1.442976932671331e-01   +9.535302753333308e-02   +4.033407184877620e-01   -8.613525974021401e-02   +2.925349432519242e-01   -3.243236077781842e-01   -1.084571228981619e-02; +5.010036335231202e-01   +1.799477859652261e-01   -7.229727753401137e-02   +4.677506741439645e-01   +4.575451170966219e-01   +3.113958401356238e-02   -4.276987498935381e-02   +1.680699475521247e-01   +5.616245600080720e-01   +7.643135199793370e-02   +3.923598355716321e-01   +7.472595350567290e-01; +2.479053870174514e-01   +6.673208148676575e-02   +4.756772130540353e-01   +4.761831179147619e-01   +4.895502239024081e-01   +7.378902247195710e-01   +6.975509413858956e-01   +5.417282296314627e-01   +9.018861753482603e-02   +1.711651016235843e-01   +3.359937970774598e-01   +4.285041851015908e-01; +8.075678085517473e-01   +8.066771584872109e-02   -2.330333754570986e-01   +4.337385683805268e-01   +2.093866165997970e-01   +5.168588679212188e-01   +7.610016365080753e-01   +3.872040911664156e-01   +9.253148660133602e-02   +1.000000000000000e+00   +5.013639921209012e-01   +2.218546307111271e-01; -7.273446697455320e-02   +4.378437361351067e-01   +1.879808944176052e-01   -6.421355372891728e-02   +9.837389786704582e-01   -2.678323853619101e-01   +2.044015691850619e-01   +4.966354285018438e-01   -1.756791165687112e-02   +4.520024769262260e-01   +6.467351319250049e-01   +9.735131885941266e-01; +4.324528355565269e-01   +3.197042170709595e-01   +4.763153752118796e-01   +3.286342149493880e-02   +5.132669309812259e-01   -5.128554020261122e-01   +5.784707685063910e-01   -1.506944534616375e-01   +1.012033680560059e-01   +4.290991842793023e-02   +5.502190631344457e-01   +1.795626387833942e-01];
L3I_L2I_iGABA_netcon = [+4.260229895978013e-01   +6.542979109981788e-01   +1.750360744536610e-01   +9.125085028113875e-02   -3.459642441645343e-02   +2.872888061764808e-01   +4.272756229910832e-01   +6.206282472105815e-02   -2.108221941894067e-01   +4.641516551466999e-01   +2.964731137119710e-01   +5.956519013420436e-01; +1.649258489548750e-01   -2.862278854800878e-01   -9.808905069500692e-02   +7.162750163511338e-01   -4.733570522064022e-02   +6.403680112718444e-01   +1.300519944233935e-01   -4.005412441871220e-02   +7.943912324586413e-01   +5.318842481149649e-02   +7.309705645657030e-01   +1.790750101870006e-01; +3.292471921537441e-01   +7.550197625598933e-01   +8.315460260298601e-01   +6.389858824632519e-01   -1.060430244235603e-01   +5.580539907234053e-01   -1.767320590436750e-02   +4.459941808781652e-01   +5.618929322365700e-01   +3.117299757526897e-01   +3.771735036801359e-01   +2.439623774031858e-01; -1.495349221093852e-01   +5.176637651174432e-04   +6.905727885309321e-01   +5.069594466903848e-01   +2.107521048642865e-01   +4.978381070911744e-01   +2.151791643194118e-01   +9.090737874653948e-02   -3.357737142465916e-01   +1.657099472452808e-02   +2.760640719460189e-01   +3.486005107575671e-01; +1.757817651492681e-02   +3.362215574325079e-01   -1.721061849440333e-03   +1.294899910508581e-01   +1.358562067287188e-01   +5.411669870269804e-01   +2.889500345168973e-03   +3.875098337075094e-01   +3.333554712064005e-01   +3.558118262727667e-01   +5.025556830153294e-01   +5.059594482054232e-01; +9.832665618608158e-02   +4.183246584106253e-01   +1.155243173770505e-01   +5.905886346908590e-01   -6.387236638059356e-02   +2.515720724144833e-01   +6.494259558425568e-02   +1.114923309397297e-01   -5.185266566670876e-01   +5.551874864000766e-01   +8.674234127820210e-01   +3.974345414561545e-01; +4.807243501780709e-01   +7.098515574215766e-02   +4.794788838159503e-01   +5.465470655389305e-01   +2.086971544155997e-01   +3.259951753654350e-01   +3.457243469098492e-01   +1.592749059379334e-01   +2.788305477250225e-01   +4.891602126892822e-01   +7.560603218211850e-02   +3.353209937987525e-01; +3.456564470727952e-01   +7.182869076041599e-01   +3.571651107798655e-01   +9.898689185515996e-02   +6.026521271029612e-01   -1.559750031431947e-01   +8.596469478920201e-01   +4.142470600017300e-01   +6.832172070343476e-01   +3.570419268541478e-01   +3.210210119412452e-01   +3.741610450187586e-01];
L2E_L3E_iAMPA_netcon = [-1.480406958437099e-01   +2.486795747789560e-01   +1.357393800420566e-02   +5.686597048305918e-01   +2.772930080790385e-01   +2.304736373970531e-01   +1.206645238726651e-01   -9.949195231228761e-02; +4.342380229423070e-01   +3.607956396691062e-01   +2.081871215910243e-02   +5.381492437581953e-01   +1.008270362451131e-01   +1.134221157244899e-01   +2.921406814348442e-01   +4.310324602446650e-01; +5.368497177391902e-01   +3.027029368990422e-02   +1.704922142077160e-01   +1.865025951905474e-01   +4.624437630467799e-01   +2.565624576191501e-01   +2.321194608028315e-01   +3.089912132255402e-01; +3.953972564798236e-01   +5.088449628076849e-01   +3.725289519538791e-01   +1.244135259166358e-01   +5.297202409249823e-01   +3.887936380969557e-01   -1.801159791792133e-01   +1.420361766886084e-01; +6.402421595627351e-02   -1.192833858982991e-01   +3.520091906038775e-01   +4.750076860307124e-01   +3.588073286095234e-01   -1.548558890838602e-01   +6.457918235303949e-01   -7.418535372350375e-02; +5.674522076571975e-01   +5.191183085883845e-01   -3.111362054251850e-03   +7.556105375064892e-01   +2.248967063881019e-01   +1.834680598316029e-01   +1.646311005625229e-01   +8.338699779239643e-01; -1.724076693358329e-01   +6.356651865128261e-02   +2.912120504692239e-01   +5.391547515908479e-01   -1.282513982419860e-02   +2.419533404628515e-02   +8.908815983412155e-01   +2.769277640177729e-01; +2.320096197980662e-01   +3.711741220439553e-01   +1.562532574909201e-01   +2.112118245626550e-01   +5.610095389177026e-02   +4.907994865232267e-01   +2.288278938308984e-01   +5.464010404166248e-02; +4.121379126845801e-01   +7.505469177019020e-01   +2.739880915282987e-01   +6.001548543858863e-01   -5.046979608837112e-02   +2.497521427402254e-01   +5.825594075358348e-01   +7.989491090436788e-01; +3.082382614593322e-01   -2.674215911460690e-02   +3.693561048736989e-01   +5.714786287868662e-01   +3.856344288864325e-01   +1.528604290911554e-01   +5.381641243472250e-01   -4.648804879840727e-01; +7.008160184119215e-02   +2.733138644964921e-01   -1.902426037161112e-02   -9.062777025422597e-02   +2.821418908605572e-01   +3.978961260973041e-02   +9.488318349735693e-02   +1.000000000000000e+00; +3.178695974619149e-01   +1.761179648365891e-01   +3.798169550291798e-01   +2.234908913866642e-01   +3.863554083820573e-01   +3.461564238306191e-01   +2.425221344567815e-02   +3.439712752715047e-01];
L2I_L3I_iGABA_netcon = [+1.810033511675609e-01   +3.023003520937645e-01   -2.914950581519968e-01   +8.827618157616238e-01   -8.446630642895279e-02   -8.027438912517360e-02   +2.142015742458599e-01   +2.853623509578023e-01; +3.304307233813960e-01   +2.061120395491500e-01   +1.053660346456825e-01   +3.658173872360998e-01   +6.136581784674816e-02   +9.229157922130470e-02   +8.007130874205425e-01   +1.572592781783174e-01; +1.286692861085673e-01   +3.999655910295624e-01   -9.713623067385893e-03   +5.043577348960491e-01   +2.741989858568366e-01   +1.868067050498398e-01   +1.404270633994559e-01   +5.578715535631187e-01; -8.435440427649160e-02   -4.722281090343695e-01   +1.059483698323258e-01   +4.763472135766221e-01   +4.506770748613853e-01   +2.833179792817841e-01   +5.703516895306252e-01   +3.605025222710734e-01; -5.704087947152899e-02   +3.514222327475275e-01   +3.136121615074824e-01   +2.730986866486785e-01   +5.602485219220856e-01   +4.003005110439689e-01   +5.560909739150964e-01   +7.853472662326577e-01; -5.379599588714629e-02   +3.600589132320247e-01   -2.249508369996445e-01   +7.417626429079367e-01   +1.667829012053123e-01   +6.855965697770510e-01   +3.471632134672114e-01   +2.907198149978312e-01; +4.743039402818400e-01   +8.888434827528380e-03   +1.165118680622525e-01   +5.372476366369202e-01   +3.631636521003803e-01   -4.293493854431610e-02   +1.500885038264548e-01   +2.529571164254425e-01; +4.185127703390387e-01   +7.499064594959450e-01   +8.977755572884983e-01   +4.389252286888213e-01   +7.800525390133700e-02   +5.379155325704149e-01   +3.139558786035189e-01   -9.145191199776904e-02; +8.553790508886776e-02   +1.931666824572403e-01   +4.219430004996669e-01   +4.697622610946861e-01   +2.346032991073817e-01   +3.991731978640519e-01   +3.571572832429500e-01   +2.171675942012351e-02; +4.791260598956214e-01   -2.803098707962737e-01   +3.603320412131256e-01   +5.459834287839505e-01   +6.854173403761787e-01   +3.545971688414579e-02   +2.753223982575424e-01   +1.908243670621900e-01; +3.113912310545210e-01   +7.280613073225934e-01   +2.189732803322684e-01   +3.402704116770148e-01   -3.012365663282146e-02   +1.716071562579503e-01   +5.112191084031675e-01   +1.749157122095983e-01; -1.905847652822596e-01   +3.920598623019245e-02   +1.424553458049720e-02   -3.736111292177738e-02   +7.612997808419362e-01   +9.751490177044121e-02   +4.271268193065092e-01   +4.607221307898979e-02];
L3I_L3E_iAMPA_netcon = [+2.117113851679178e-02   +6.392113088036602e-01   -8.695159504460705e-02   +5.153528154389843e-01   +5.370237891891662e-01   +1.462236226771137e-01   +2.108438098490488e-01   +3.318457161024116e-01   +2.509733023003893e-01   +1.968189681601016e-01   +1.016812003272397e-01   +3.316208065806235e-01; +5.054899258269581e-01   +5.355569013476785e-01   +3.615372131687123e-01   +1.482162533077228e-01   -8.873543921941400e-02   +4.781061470073570e-01   +4.372630068077862e-01   +7.826108901329791e-01   +6.576612441334016e-02   +5.429496930904103e-01   +2.388512868387590e-01   +5.431453424662723e-01; +1.908677394138604e-01   +4.143754390777391e-01   +3.322694780869505e-01   -2.408730721597570e-01   +8.380478393913511e-01   +4.639239225382491e-01   +2.322179884885560e-03   +3.251883317546606e-01   +3.501004305820212e-01   -8.523405057810085e-02   +5.675954865871136e-01   +2.732973384298209e-01; +7.603261084799980e-01   +5.235834716697242e-01   +2.264153773195862e-01   +6.375847357359429e-01   +5.540604023446283e-01   +4.797316954565353e-01   +6.409158945796551e-01   +1.442975002541884e-01   -1.148056771262757e-01   +1.940247192628173e-01   +1.561346333047260e-01   +6.715296436989955e-01; +8.576868179038261e-02   +3.763494765889180e-01   +4.009434050707675e-01   +8.453677899780598e-02   +5.971702714497163e-01   +7.419049090048203e-01   -1.040342224949221e-01   +6.934063505946376e-01   +1.000000000000000e+00   +2.350394086862217e-01   +6.369888562073838e-01   -1.482692007592114e-01; +2.062066783148081e-02   +6.796570016841756e-01   +1.744941043388789e-01   +3.936460854020588e-01   +2.511065515667244e-01   -1.354915146178070e-01   +3.532636674317416e-01   +9.049456812035585e-02   +3.868030578448007e-01   +1.891023977376642e-01   +3.922259314075250e-01   +2.297494511162240e-01; +1.319236962991617e-01   -9.660266364423674e-02   +2.237073236348684e-02   +1.453445024391535e-01   +3.575859616588591e-01   +4.151679659508000e-01   +3.855469414889068e-01   +4.484561507021045e-01   +8.037584467490337e-02   +5.596697686900693e-01   -1.977101648013117e-01   +2.519133664742774e-01; +1.475839372691617e-01   -7.844419723688167e-02   +5.810878240996128e-01   -9.332146219489300e-02   +4.041573233689992e-01   -2.671056191948050e-01   +1.910132393625288e-01   +1.988448229688073e-01   +1.379002491286003e-02   +5.385741532707772e-01   +2.060553492078589e-01   +2.073331730422563e-01; -1.042110859240663e-01   +3.705268516750063e-01   +2.766463087709707e-01   +3.791228753717864e-02   +9.806544745576405e-02   +3.141129849240294e-01   +3.679527446198475e-01   +4.010420565014016e-01   +3.340389962944067e-01   -9.131965796261310e-02   +4.359935879424753e-01   +1.569717469472845e-01; +3.675397898021976e-01   +6.238492649890541e-01   +6.879872786210864e-02   +5.846995951167249e-01   -2.897505497359741e-01   +3.323555915715013e-01   +3.112489445302357e-01   +6.063509624869337e-01   +5.595446857983182e-01   -3.937584099969534e-01   +6.667363849847233e-01   +4.243811204288251e-01; -3.790524305726551e-01   +8.729330645146580e-02   +9.583071988419657e-02   +3.962440246253078e-01   -1.859861499792535e-01   -1.271898126292775e-01   +6.048829115065486e-02   +3.447654014188082e-01   +7.687409872809517e-01   +3.277326933452960e-01   +1.173679476140835e-01   +6.127238940869215e-01; +2.385629433331525e-01   +3.201200972187120e-01   +6.847576992844226e-02   +6.734611677040098e-01   +7.237109438927061e-01   +1.362310236900181e-01   +4.973828734815352e-02   +5.382053209650314e-01   +5.329667023103870e-01   +3.966721024920395e-01   -2.721548605554344e-02   -6.411005676920699e-02];
L3E_L3I_iGABA_netcon = [+7.994710174162549e-01   +4.845919017076597e-02   +9.998662194413737e-03   +5.748903539330618e-01   +2.481545472300317e-01   +8.158286321486325e-01   +7.654656612215942e-01   +8.878770715171671e-01   +5.941124333483430e-01   +1.092586013323704e-01   +2.471060098323456e-01   +3.162871796140228e-01; +6.795904419760848e-01   +1.626625479968365e-01   +6.434107100910378e-01   -2.143872375583527e-01   +5.454585038429635e-01   +6.888095705630166e-01   +9.279613784508307e-01   +1.189914719183301e-01   -5.454184095641902e-02   +1.132210334811201e-01   +1.111772969513520e-01   +5.135722233763389e-01; +1.423492268718268e-01   +5.398589623495890e-02   -2.467986025635260e-01   +8.212349185431156e-01   -9.611723273919293e-03   +4.159790146326339e-01   +2.709658906249240e-01   +5.039931661492668e-01   +3.340084837544146e-01   +5.901759226985137e-01   +2.204453861250857e-01   +2.727607449225306e-01; +1.301737828111281e-01   +5.937987268416135e-01   +4.018175452125408e-01   +2.742360991065128e-01   +5.226267613901541e-01   +1.346492593451457e-01   +1.071468135625201e-01   +4.732618385434630e-01   +2.580019521310778e-01   +1.575272924434748e-02   +8.948608154971938e-01   +2.985406673587825e-01; -2.966542462334450e-02   -4.137618749320090e-01   +2.600312715763973e-01   +6.200623155783036e-01   +4.140856922028546e-01   +1.457555638222732e-01   +4.873533142218253e-01   +2.852508773942578e-01   +1.439766380933383e-01   +4.604094256122283e-02   +6.373238304432299e-01   +3.041703770364672e-01; -2.810715072710411e-01   +7.393699746572058e-02   +3.535341204258018e-01   +1.780795557206948e-01   +4.464277354279804e-01   +1.846125475993019e-01   +8.973057365657375e-02   +2.617214772922404e-01   +3.993875061977325e-01   +7.271037743431344e-02   +1.485505146318777e-01   -1.534747058168188e-01; +6.859960876422588e-01   +4.267475530466875e-01   +3.025212760464610e-01   +8.374173356177209e-02   +3.410465628453209e-01   +4.343041311137595e-01   -8.402038582966967e-02   +8.176825803914425e-01   +3.345811089164064e-01   +2.307683426553283e-01   +4.585486197220841e-01   +3.451755274932106e-01; +1.241959475006176e-01   -1.343280357151260e-01   +2.059549500842969e-01   +7.342766287078272e-01   +7.847829534546383e-01   +1.839404223443480e-01   +4.536908044543542e-01   +1.141532329266372e-01   +1.768111331354185e-01   +5.154998158031571e-02   +5.081785468044044e-01   +8.904892987370328e-01; +1.539297743785668e-01   +8.060958639965649e-02   +3.379317576329963e-01   +5.999582601674334e-01   +5.598115662334253e-01   -3.978863309197968e-01   +5.967173061700490e-01   +4.517967698047920e-01   +7.443405583079091e-02   -9.747573351455034e-02   +4.000522495114149e-01   +7.841504505541834e-01; +2.386651074548658e-01   +8.024959768931563e-01   +9.393414087153070e-01   +7.482103820084319e-01   +1.324860664869720e-01   +3.693055780783545e-01   +7.060730072154474e-01   -1.351900102959104e-01   +5.267297035358711e-01   +3.478539231564551e-01   +2.858770863192924e-01   +9.754646718415547e-02; +4.541299722529010e-01   +4.080027604516493e-01   +7.568668239145482e-02   +7.418676419910861e-01   +7.122732308251453e-01   +2.311793799116270e-01   +5.229437815522237e-01   +6.630403322077575e-01   +6.868035069828449e-01   +2.768675489214421e-01   +2.264489334578983e-01   +7.196652501529350e-01; +7.318066523539837e-01   +2.658853903500137e-01   +1.139539857713975e-01   +4.812887635509588e-01   +3.523630704108899e-01   +4.047465772808100e-01   +5.988789744494110e-01   +6.713605483296997e-03   -6.947943893387099e-03   +1.728421072163480e-01   +3.360454774995125e-02   +6.773338438592305e-01];
L2E_Input1_iAMPA_netcon = [+5.360119792898103e-01   +7.504850345902166e-01   +8.076887737570516e-01   +7.577286560068704e-01   +1.000000000000000e+00   +7.930672924930203e-01   +6.914077518894545e-01   +4.656384842326687e-01];
L2I_Input2_iAMPA_netcon = [+7.406260331065329e-01   +7.063522845176092e-01   +6.151604028368080e-01   +6.297545215464125e-01   +3.910876372869992e-01   +1.000000000000000e+00   +3.416946699184215e-02   +4.309224903868638e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
