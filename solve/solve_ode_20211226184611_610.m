function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.719730008840759e-01   +8.864658486686719e-02   +5.216263212698776e-01   -5.180938943502025e-01   -8.426970961513417e-01   +1.061304416174483e-02   +2.918524923070569e-01   +2.192550442022878e-01   -2.306984400651480e-01   -1.495667460916262e-01   +4.732484942201354e-01   +1.621618816881420e-01   -3.387030113408433e-01   +3.938472251052395e-01   +6.487050215778167e-01   -2.562632300126166e-01; +3.996506836669327e-01   -9.028760944194332e-02   -3.973111119904806e-02   -1.091630834326347e-01   -2.652836042496376e-01   +3.046786653100328e-01   -1.619716057284002e-01   -3.344928797251124e-01   -3.475319787735238e-01   +2.687115768362985e-01   +3.265304225890873e-01   +7.081747471323020e-01   +5.528141313074094e-01   -1.766341181820847e-01   -7.202246874869990e-02   +1.643086927521612e-01; +4.197899605842079e-01   -3.471907850475214e-01   -5.358963806993921e-02   +4.664523027014135e-01   -1.052008161313925e-01   +1.000000000000000e+00   +2.128564031688277e-01   -7.580328538174622e-02   -1.192974986234914e-01   +1.741059877520756e-01   +5.008173774159238e-03   -5.609369360861932e-01   -2.950512681614463e-01   +7.260050730590913e-01   -8.059316907039713e-01   +8.937082765451050e-01; -4.837070330807596e-01   +4.260771040972653e-01   -7.182593445815403e-01   +9.077586430523074e-02   +6.868470516840377e-01   -5.963632758464457e-01   -6.306494957356735e-01   +8.371836448463869e-02   -1.437193149938065e-01   -4.809419364451357e-01   -2.843398503176859e-01   -6.490818265179413e-01   +4.490161567743287e-01   -5.834210060826229e-01   -8.246177257580630e-01   +4.273542065377940e-01; +3.207420269324956e-01   +2.441597046148381e-01   +1.770782310149003e-01   -8.799069250220272e-02   -1.756416245823899e-01   +5.215690593073872e-01   +3.811059397037532e-02   +1.304058620253483e-02   +2.877354257683421e-01   +9.325085031929810e-02   -5.409503751983695e-01   -1.194604544821164e-01   -3.587706778884020e-02   -1.418552682021483e-01   +4.878065997825188e-01   +1.102890751996580e-01; -4.130717631185624e-01   -2.152522677507841e-01   -1.171835018726671e-01   +1.444626242870266e-01   -1.902814982592634e-01   +4.481006198218729e-01   -1.678672474659601e-01   +9.166884685802494e-02   -5.289722212605839e-01   +1.628553531815411e-01   -1.695751722224428e-01   +9.507783120598273e-02   -1.524997884429054e-01   +2.930668039110916e-01   -2.845122617925583e-01   +7.719571702775498e-02; +3.647351653191449e-01   -3.782331818851158e-02   +9.683522382571749e-01   -3.575907603355830e-01   +6.722192709895962e-03   -4.299965401055785e-01   -4.892626738920445e-03   +2.596153325973876e-01   -6.135567893275991e-01   -2.648790270804713e-01   +5.633987046935972e-01   +5.528523958324519e-01   -1.489396406150998e-01   +6.006602505458324e-02   -2.781174601516856e-01   +1.632719093245368e-01; +3.069449894324854e-01   -3.671471296656391e-01   -2.191512302586099e-01   -1.976426048682691e-02   -2.681566689654223e-01   +5.315943803686062e-01   +1.576080349940004e-01   -1.579416664182459e-01   +5.727630964280788e-01   +2.804737067473960e-01   +4.470622318401926e-01   +1.154866270498001e-01   -1.478168829254811e-01   +7.289290475601109e-01   +6.979334887735229e-01   +2.948083028354325e-01; +2.939956761789006e-01   -2.940191158052083e-02   -8.187935894771422e-01   +4.931629465440343e-01   -1.108251165023773e-01   -3.892107043452816e-01   +6.244589327203490e-01   +4.093392371148787e-01   -3.715397949753282e-01   +7.828275295004071e-01   -2.640273336182248e-01   +1.314636214424109e-01   +7.168191563602869e-01   -4.479030944113852e-01   -5.270338618953103e-03   -1.700467814180460e-01; +3.417824236466053e-01   +1.191665822481158e-01   +6.666800274364098e-01   +6.578500818551362e-02   -7.652271398179031e-01   +4.094203403769334e-01   +2.814196114732729e-01   +9.014178648129513e-01   +4.198619421222493e-01   +1.069540900548944e-01   +3.214317996258023e-01   -5.421794317114365e-01   +4.802906941403832e-01   -4.106506920733735e-01   +3.831169364404075e-01   -5.499172455681984e-01; +2.150274024402207e-02   +6.912806546830579e-02   +1.621589794593410e-01   +2.133627133538548e-01   -7.562683569878277e-01   +3.074054356721420e-01   -1.327095439736814e-01   +4.835370472860142e-01   +2.064770412004681e-01   -8.289452733767171e-01   +7.414417033868563e-02   +2.067613411829627e-01   +1.674698883823496e-01   -3.958069948418579e-01   +1.548102442347390e-01   -2.305302187498397e-01; -5.563877131591926e-01   +5.514431103658926e-01   -5.441543123377418e-01   +4.534556145872230e-02   -2.600680863373964e-01   +2.261507933127077e-01   -3.014013716398151e-01   +8.272121848445687e-01   +4.818747646623394e-03   -3.784847269443484e-01   +5.467126681531027e-01   +6.342584897862503e-01   +4.180181186077955e-01   +2.982078581606123e-01   +5.634141645780214e-01   +1.869706345385114e-01; -9.885699138644478e-02   -7.207175543952292e-01   -4.651167750093385e-01   -5.372702144312599e-01   +7.803759596832422e-01   -8.520424043789555e-01   -1.085282267333945e-01   -6.473168078443412e-01   +3.091114613441353e-01   -3.298980040690646e-01   +1.419410811713861e-01   +5.288186852109682e-01   -3.780551107565569e-01   +3.427551638356971e-01   -5.140580729735240e-01   +1.233811443723035e-01; -4.676870738217255e-01   +8.007696605645086e-02   -5.504288217155897e-01   +9.414384827945348e-01   +1.673555588978438e-01   +5.185375133736766e-01   -4.672410512240100e-01   -5.546473670126620e-01   +7.344068868363249e-02   +3.956521009426619e-01   +5.556759563414665e-01   +5.003960685363392e-01   +3.468220943988336e-01   +2.638472925175273e-01   -1.128718964946683e-02   -2.857901199620689e-01; +6.222139347561800e-01   +1.867262745437714e-01   -6.889031472193693e-01   +2.695007281842252e-02   +2.164748868433867e-01   -5.015758523702147e-01   -2.747080418406392e-01   -2.491584802377965e-02   +3.981060265957486e-01   -5.815257601149805e-01   -7.637603117013771e-01   -2.527057581488713e-01   -2.449334296929767e-01   +5.393431817083373e-01   +3.929974137455369e-02   -1.642681935350211e-01; +3.912172758026586e-01   -4.836064884932044e-02   +1.342246773960407e-01   +7.352205094612475e-01   -2.905437024397606e-01   -9.170448624186650e-02   -1.511535058071355e-02   -3.666975908803044e-01   +1.561640792264364e-01   -1.225626491656800e-01   +4.736809099262006e-01   -3.416459354393581e-02   -7.984309071229019e-01   +2.982599861875664e-02   +6.772263294579565e-01   +4.833208307373462e-01];
L1E_L1I_iGABA_netcon = [+8.186644701224223e-02   +4.007435622569012e-01   -5.524285520212580e-01   +1.558463652961738e-01   -5.122527036165792e-01   +1.305261024880168e-01   -5.059567382453002e-02   -2.044436713542157e-02   -5.334051464923313e-01   +9.295614014170894e-02   +2.092229533896664e-01   -4.717752990193334e-02   +4.499069487983161e-01   +8.129373019658394e-02   -3.738172154232960e-01   +2.913322095811404e-01; +3.696120305075346e-01   -4.988222829157207e-01   +2.288960370101067e-01   +3.771732965458561e-01   +1.078812021100897e-01   -3.870912636099622e-02   -1.171497856308893e-01   -2.140855471920537e-01   -3.582925766017093e-01   +5.591750925681880e-01   -6.080815173557188e-01   +1.426687224981873e-01   +4.757497106402551e-01   +8.236350301727401e-02   +8.723409453000368e-01   -3.912164583408303e-01; +3.336223298260603e-01   +2.978157743967903e-01   +1.094801602467709e-01   -6.835814419892866e-01   +1.472330514181364e-01   -1.598373074257750e-01   -2.450927012846505e-01   -5.933282625666878e-01   +2.076762000017640e-01   -2.942398902862962e-01   -1.088572710706166e-01   -1.779212503691801e-01   -2.078696102036832e-01   -3.342116112279163e-01   +3.996707529193408e-01   -2.752729203548312e-01; -4.787719132973295e-01   +3.575612218208972e-01   +7.006471606534581e-01   +1.908221419025760e-01   -7.666366822783209e-01   -1.441664580177619e-01   -1.300817743698476e-01   -4.456115617179133e-02   +1.797685063359634e-01   -6.098205467646012e-02   -2.425052150852551e-01   -5.930031680988165e-01   -2.263383509577259e-01   -6.888329265010913e-02   -3.214637075113718e-01   -3.545896318038941e-01; +6.258691914189517e-01   +1.919188329224114e-01   -1.272708762568420e-01   +6.567911965748939e-01   -4.110921525426470e-01   -5.949012919484225e-03   -4.742179300799433e-01   -5.296325595598614e-01   -4.155342461571160e-01   +1.926142659900207e-01   -1.000000000000000e+00   +9.424888856910794e-04   +7.193059005020201e-01   +6.110517568677871e-01   -4.999153931864606e-02   +4.017742272456908e-01; -7.111405237205134e-01   -1.254269516642987e-01   -2.532441220536476e-01   -5.039387890408130e-01   -7.154702221747884e-02   +7.133807667103197e-01   +4.196135427627695e-01   -3.397857786025428e-01   -5.948531591101661e-01   -2.587565662684656e-02   -1.876060906730381e-01   +5.478363947664171e-01   +2.642808833318449e-01   -5.281722792423866e-01   +3.573535560950186e-01   +2.477712385761985e-01; +1.166925205529586e-02   +3.300707851548910e-01   -2.251760897162029e-01   -4.940922704302653e-01   -1.875886235639543e-01   +7.760254787730108e-01   -2.289323114306673e-01   +4.863338161675845e-01   +8.531958499820577e-01   -6.522545277784301e-01   +4.104734840273079e-01   +7.731971579722847e-02   -6.726083196228209e-01   -5.112422018688640e-01   +2.380221140717106e-01   -5.564568677817413e-01; +1.213647586952945e-01   +1.988307861870350e-01   +1.284850533424728e-02   +8.407451479808210e-01   -7.048904253473279e-01   -6.133758944529943e-01   +5.935951615251749e-01   +2.398398372200878e-02   -5.383063558855574e-01   -1.331150058635480e-01   +6.380265510479639e-02   +4.572597119581894e-01   +3.151086201568777e-01   -1.895729993618148e-01   -5.672826695617567e-03   -6.252891120226048e-01; -1.608866516800165e-01   -3.698526133367761e-01   -1.235293278344783e-01   +6.296147483883732e-01   -1.642265720091510e-01   -5.123398539996942e-01   +7.323651225858319e-01   -6.371424442492157e-01   -5.455538330922979e-01   -1.863020367726890e-01   -2.540249913682924e-01   -3.005751080990154e-01   -2.754437893843092e-01   +2.235908937487527e-01   +3.595206167015661e-02   -1.393410000848371e-01; -5.449446286743691e-01   -1.749356423697136e-01   +1.410110309107694e-01   -8.745198688861894e-02   +2.042497261139096e-01   -2.343954679754183e-01   -3.179780837906112e-01   +2.772334863397861e-01   +4.381804282257804e-01   -2.007595805277581e-01   +8.435150385243469e-02   +1.973655608307808e-01   -4.105455826594519e-01   -2.698341512181558e-01   -7.068531471799090e-01   -3.920784645228457e-01; +4.477773946134065e-01   -1.937362611946911e-01   +4.481281506027452e-01   -1.816616026357024e-01   -2.594073396095738e-01   -8.409668078905684e-01   +2.076146414080627e-01   +8.650754309205557e-01   +2.535150300303730e-02   -6.465680372245117e-01   +3.252294302936576e-01   -2.256763688465844e-01   -7.986074232516961e-02   -3.417013725394943e-01   +8.057378195592984e-01   +1.576503440259613e-01; +5.111909946003267e-01   -7.637000948363913e-01   +2.498849865773427e-01   +3.582937788809590e-01   +3.216256594163978e-02   -2.361391317103543e-01   +6.944281940838059e-03   -5.236382677248165e-01   -3.297665261055118e-01   -2.266679525421931e-03   -4.753399853456541e-01   +7.422093782553233e-01   +1.679597329541760e-01   +2.229413429464399e-01   -3.618358967074248e-01   +7.570323242789548e-02; +7.923078360616358e-03   -1.694411389930153e-01   +4.273655013210593e-01   +2.725682127839140e-01   +5.419412843846005e-01   -4.624045414435609e-01   -9.700748584677282e-02   -3.955419806771578e-01   +8.270604763818080e-01   +5.396943453179022e-01   -2.445192941371691e-01   +4.818135593032690e-01   -2.603756787639438e-01   -4.997107110652867e-01   -3.433917879058930e-01   +6.947497540897044e-01; +4.004361411653627e-01   +3.927828134821348e-02   +7.678354652150955e-01   -1.242965636626847e-01   +3.072666750412868e-02   +6.388657492688166e-01   -6.189883623094667e-01   +5.291495173931300e-01   -2.455562968817716e-01   +3.915574453560239e-01   -2.538125251368157e-01   -1.037322459724425e-01   -1.363389987166892e-01   -7.193159246577486e-01   -5.158876472532545e-01   +2.415704150511364e-01; +1.601052663946181e-01   +5.557137496295023e-01   -3.251751396866620e-01   +8.904779163323151e-02   +3.705028893943345e-01   -4.997141109763574e-01   -5.336478797349140e-01   -1.107219508134966e-01   +2.230821470817848e-01   +3.801885183789824e-01   +8.905429750017839e-02   +6.046503534053729e-01   +4.549787659356642e-01   +4.389520438734663e-01   -2.127874234132082e-01   +5.991976100569787e-02; +1.817576636367517e-02   +3.662200569749687e-02   -2.752810885680821e-01   -6.186456979871017e-01   -6.334146028151051e-01   -5.240082956488899e-03   -4.987811372182663e-01   -1.580715393460999e-01   +5.363144737543538e-02   -1.435038486220841e-01   -4.912519562205894e-02   +3.176431872867937e-02   -4.701739189164590e-01   -7.771897993856383e-01   +7.186140519039165e-02   +1.831347263384412e-01];
L2I_L1I_iGABA_netcon = [+3.168353754187901e-01   -8.270525939972809e-01   -1.749398539437662e-01   +7.227023418397490e-01   +4.021153345566173e-01   +5.915931468187809e-02   +1.408578417368680e-01   +1.646372598662086e-01; -8.890984628739772e-02   +2.400439149340603e-02   -3.184320644768334e-01   +3.633986721170868e-01   +6.126042726244337e-01   -4.712262108974958e-01   -6.048302517567930e-02   +1.728203840216551e-01; -2.921489748203510e-01   +1.494339528800620e-01   -4.907080052739843e-01   +4.095766080460120e-01   -7.202009185587754e-02   +6.793761542041170e-01   +3.188775383720938e-02   +4.079274943206234e-02; +3.928726374120524e-01   -8.369537601624977e-02   +2.298213472112814e-01   -5.261249437660258e-01   -6.919540272114630e-01   +1.662928773115635e-01   +1.722463821927176e-01   -7.990159570665926e-01; -1.566778090224255e-01   -5.938476484454184e-01   +2.988496964448559e-01   +5.479851572249089e-01   -1.817555534826092e-01   +5.787053145035791e-01   -2.576996770100758e-01   +7.011843700214505e-01; +6.974758518497604e-01   +8.365955198412847e-01   -7.033372447661821e-01   -7.959388390466464e-01   -2.169782410713073e-01   +7.857183870681514e-02   -4.709976987582450e-01   +8.676351172654483e-02; -6.189741218739652e-01   -7.767824050705601e-01   +4.811664368547237e-01   +6.870375209674334e-01   +4.804187915697666e-01   +2.175114936128516e-01   -1.108757173405201e-01   +4.514861589671579e-01; +4.093017583389589e-01   -7.360683488439487e-02   +4.551705300437688e-01   +7.010178916333208e-01   -4.311160266955120e-01   +3.434398777246824e-01   -7.908742701031256e-01   +5.993971048715748e-01; -1.950349916875865e-01   -1.910275826705741e-01   -3.020619126699888e-01   +7.701660316623649e-02   -7.747218841765158e-01   -4.309152164481728e-02   +4.238573330584099e-02   -4.239107756391819e-02; +9.716518840948736e-01   -7.717853717014854e-01   -1.866665493434218e-01   -1.000000000000000e+00   -3.751771824856953e-02   -3.642348523195121e-01   -2.230006151638021e-01   +6.332796549471451e-01; +3.209890267716912e-01   +6.413705827451711e-02   +1.651778574390205e-02   +4.700743497891030e-01   +1.997495979387381e-01   +6.326793173786531e-01   -7.044238799637301e-01   +1.263483129530372e-01; +6.814216761030715e-01   -7.619730966249816e-01   -6.846394721543827e-01   +3.669937929387614e-01   +1.765289652147257e-01   +2.149746071229548e-01   -5.685163513537198e-01   -6.677383181934982e-01; +1.863059011904282e-01   +2.842189728696906e-01   +4.138618248838044e-01   +4.041124030358417e-01   +6.374857051791464e-01   +1.688111985865959e-01   +6.053967574376740e-01   -1.681574227196700e-01; +5.221751698835470e-01   -7.276301915351453e-01   -4.762299134434720e-01   -6.031329019616536e-01   +1.552472913535607e-01   -1.504048193508071e-01   +6.381191488046252e-01   -6.257804216448096e-01; -5.670929635557407e-01   +1.342913318316489e-01   -9.070004914671713e-01   -4.238473808818616e-01   +2.138161425686314e-01   +6.182147258186573e-01   +1.618947838143775e-01   +1.625090720779812e-01; -1.688627528143371e-01   +7.116420631963151e-01   +7.009295631003432e-01   -2.938355353231570e-01   -1.637121084392398e-01   +2.599754262193110e-01   +5.920171143056048e-01   -4.203360280737705e-01];
L1I_L2I_iGABA_netcon = [-1.368037535140822e-01   +6.467253873937127e-01   -4.240504984056428e-01   +3.741527745857743e-01   +7.301964181090996e-01   -4.107399446383510e-01   +6.237171913993872e-01   +2.104461147285764e-01   -3.679474628474835e-01   +6.429354244605203e-01   +3.887033862318125e-01   +3.910359593419267e-02   +7.199106614574138e-01   +1.542465575682158e-02   +2.609356558814252e-01   +2.910507200024259e-01; +1.063389225294337e-01   -4.787841752403955e-01   +5.893930613014305e-01   -1.520764826319089e-01   -6.764038223554135e-01   -3.662378986571018e-01   -4.184824601112990e-01   +5.941539951406043e-01   -3.097092016772074e-01   -1.143863314979728e-01   -4.685104479774765e-01   +2.274137960561038e-01   +3.335539145496818e-01   -7.972715828333746e-01   -2.747110626544792e-01   +6.686288960231455e-01; +2.831437428888872e-01   +6.885527707948743e-01   +6.614596924849799e-01   +6.070976097976156e-01   +4.736957433296335e-01   -2.620144307553772e-01   +4.709674986118801e-01   +3.698440971056658e-01   -1.175079637019024e-01   +4.431441515578461e-01   +8.601296813005446e-01   +4.076080651449152e-01   +1.768526703146279e-01   -3.672435213276459e-01   -1.171029066935364e-02   +1.320513430089793e-01; -4.757423873501775e-02   -5.883050755771511e-01   -4.503607298124132e-01   -3.702782869080315e-03   +6.677758614042388e-01   +2.485606064540426e-01   -5.423538795482186e-02   +3.809848001846083e-01   -1.992948135341274e-01   -1.021126595825321e-02   -1.832264364849979e-01   +7.128622233684145e-02   -2.702609978155345e-01   +4.812462926025233e-03   +6.633005143077984e-01   -2.872431754065797e-01; +5.765419956509169e-01   +4.129997879697339e-01   -6.431887298123032e-01   +5.938184628684162e-01   +2.360964712941022e-01   +4.808056741725609e-01   -4.972748789391521e-01   -1.579993668396036e-02   +7.922416747928996e-01   -9.833749233627434e-02   -5.615011713311110e-01   +1.000000000000000e+00   -7.038729682019427e-01   -6.276884268847070e-02   -7.163042746137261e-01   +5.596738967872898e-01; +2.079955852266262e-02   +1.354437922495629e-01   +1.885731588203790e-02   -3.525204927742433e-01   -6.252153360092052e-01   +3.390742731998764e-01   +2.096964165226445e-01   +5.697062874809943e-02   +1.661117428637274e-01   -7.301494100640729e-02   -1.076136901584347e-01   -2.483046428919218e-01   -5.335862380566126e-01   +2.105695804969263e-01   +1.555809704581813e-01   +1.105514994742422e-01; +9.547377491844206e-02   -6.670017648174899e-01   +8.166548260462234e-01   +2.977064466986965e-01   -6.457334310078529e-02   -6.448502021121835e-01   +2.859555752655454e-02   -3.140120560296356e-01   -3.569376793907989e-01   +7.728250140989559e-01   +7.033885219773146e-01   +6.617049648108994e-01   -5.812225859357999e-01   +6.523280036843371e-01   -7.512837338918296e-01   -4.479869989212133e-01; +6.072127257583971e-01   +2.868774228080830e-01   +1.643348388852836e-01   +4.495072578957241e-01   +4.194521255137964e-02   -1.017618272032291e-01   -2.904380741193538e-01   -3.041099338911179e-01   -5.100114630709095e-01   +4.908993609923846e-01   -6.058195997612201e-01   +3.610891148152651e-01   -3.130046002429719e-01   -4.543874667706859e-01   -5.223558265097733e-01   -1.824707571754529e-01];
L2E_L1E_iAMPA_netcon = [+4.230789290310455e-01   +1.815154024647699e-01   +9.397359000525876e-01   +8.282073907255494e-01   -2.495813932226054e-01   +2.218667268398772e-01   +8.208351382588670e-01   -7.514427563236582e-02; +5.809084076083104e-01   +4.231245923531015e-01   -1.251902450497659e-01   -6.262579602040184e-01   +1.075892856792907e-01   +1.560635434974124e-01   +6.074814645012433e-01   -8.027628502707760e-01; -2.723825166627613e-01   -4.924669858073792e-01   +4.835166165065299e-01   +9.978488670429098e-01   -5.100351581303803e-01   -8.608721848943100e-02   +6.802720537188154e-01   +4.927241417355864e-01; -2.504942577610177e-01   -4.393074569885284e-01   +1.706934280561751e-01   +4.421643343617533e-01   +3.401150679111656e-01   -5.209459013477872e-01   +2.735733620093660e-02   -3.832849093876992e-01; +4.908965120440084e-01   +2.732664596709316e-01   -3.866405647267340e-01   +1.113485744238658e-01   -1.492614402559925e-01   +3.561836087422256e-01   +2.754970572243242e-01   -7.647346490295607e-01; +5.785721231624386e-02   +4.610410185817453e-01   -7.089273013105152e-02   +2.445787202862980e-01   +3.766704129545795e-01   +5.945422330509691e-01   -3.150344605482527e-01   -6.908953949183074e-01; -5.109603120057689e-01   -2.995875829560055e-03   -4.999503878215452e-01   +4.975307769859346e-01   +2.882177405754026e-01   +1.139005342290337e-01   +6.267023854438761e-01   +1.377509808196830e-01; -4.501215865766057e-02   +7.908932990210631e-01   +4.392119027623459e-01   +1.662351660260473e-01   +2.177159956334246e-01   -3.079023755389932e-01   -2.977078370061300e-01   -2.589026400572466e-01; -5.719286572256925e-01   -2.986439304910344e-01   +9.026381837874382e-01   -1.351787636529727e-01   -4.148187075340262e-01   -6.824703587632435e-01   -7.039171503833914e-01   -8.541339354008598e-01; -4.833006084522478e-01   +7.762047875034414e-01   +4.814255596115789e-01   +6.183353450006013e-01   +4.717953673299033e-01   -2.052596159708598e-01   +6.311706978147965e-01   -4.421576974898293e-03; +4.202114346285670e-01   -4.423321639161512e-01   +9.618981416599778e-01   -2.908035180789489e-01   +5.421943495743401e-01   +6.336898153340688e-01   +3.880305766505052e-01   -5.197224215093590e-01; +2.305136855355053e-01   -3.755102993160934e-01   +6.633228809219373e-02   +5.767497516806261e-01   +9.121650173239244e-01   +1.000000000000000e+00   -5.049323189493471e-01   -2.221295416319806e-01; -2.766655716394769e-02   +6.696243050801514e-01   -1.096495820387376e-01   -5.194257613766587e-01   +2.272670165652903e-01   +4.855801644338492e-01   -7.008521227177616e-02   +2.594920072914640e-01; +6.710637013469237e-01   -2.310123924873278e-01   -6.941565430689124e-01   -7.838026402081183e-02   -7.611334744098887e-01   -9.763427527184720e-01   -2.595564022043848e-01   -3.677865886584115e-01; +5.120763598120082e-01   +3.796731237706602e-01   -3.177433277702941e-01   -8.840796482051457e-01   -2.441029591731115e-01   +1.636958219203223e-01   -8.098495528951539e-01   -3.906667076980474e-01; -1.232746264127809e-01   -1.420130795900512e-01   -2.370845543336963e-01   -3.084478674748451e-01   +1.724121193658043e-01   -3.381880004654694e-01   -9.587782588516007e-01   -5.004302042384799e-02];
L1E_L2E_iAMPA_netcon = [-2.104153392485689e-01   +1.581785796289159e-01   +3.267983137949948e-01   -6.400139753734529e-01   -7.158426385554164e-01   -2.778794097372562e-01   -6.305205075917975e-01   +9.247182652304040e-03   +1.054510713816349e-01   +2.935875323348901e-01   -3.343150957128720e-02   -4.227562933313510e-01   +2.927452413574531e-01   -1.578048741474201e-01   -7.339611011242499e-02   +2.007218383535511e-01; +2.785582244115195e-01   +3.691405046360905e-01   +1.922412521729415e-01   +1.787292171996478e-01   +4.035158305774641e-01   -3.110409052099803e-01   +7.581999893943341e-02   -5.422605711979044e-01   -8.354972421668121e-01   -6.343843120223773e-02   +4.976236663490887e-01   -5.651155865733313e-01   -1.287727737913819e-01   +7.924597800005080e-01   +2.839855032434777e-01   -9.973894598727785e-01; -5.935814803087829e-01   +1.771186749745554e-01   +2.118489220811508e-01   +9.368562791701571e-02   -2.688738515783373e-01   +6.121792818433202e-01   -4.028616771910022e-01   +5.394433516414702e-01   -4.712800898380521e-01   -6.449376596110755e-01   +8.918082698460865e-01   -5.426252017919815e-01   -2.702645825498456e-01   +8.576195486009740e-01   -2.881516602207678e-01   -5.016530709787870e-01; +6.146677380719494e-02   -7.043847356846360e-01   -1.000000000000000e+00   +4.197257749790691e-01   -6.645847019006654e-01   -9.785594189590402e-02   -1.622773737652006e-02   +1.217992673796244e-01   +3.984655486128714e-02   -5.035031574579782e-02   -4.878888386357673e-01   +9.459558785566410e-02   +1.849548200494772e-01   -6.355326974058970e-01   +2.984661529343803e-01   -1.436062747674445e-01; -7.346995354602993e-02   -5.456628405233489e-01   -5.719993416269153e-01   -5.180860576550562e-01   -5.747762093345835e-01   -1.637404775058235e-01   +2.140469126017014e-01   +5.274354635141302e-01   +1.444770566646559e-01   +1.043843339860937e-01   -1.763504400304041e-01   -5.742702205413278e-01   -2.615178324464228e-01   -4.857466169590222e-02   -3.694632806652901e-01   +8.125606563379092e-01; +6.479666037828467e-02   +4.058677390437284e-01   -2.161138341496976e-01   +4.095516362081648e-01   -6.710792669914593e-01   +5.054369140327319e-01   -8.322137334455859e-01   +2.880320422316914e-01   +2.647350926165277e-01   +5.438338500750645e-01   +5.263275052584404e-01   +2.451446743723049e-01   +4.103146650180434e-02   -4.427007924269807e-01   -3.383499620902906e-01   -5.084378771485364e-02; -1.934721375990277e-01   +4.032430057375272e-01   +8.628939070751787e-01   -8.932810363691540e-02   -6.562860901232100e-01   -3.667526936368625e-01   +6.873009929896786e-01   -6.666972661766385e-01   +6.894664544037430e-01   +7.189384257648265e-01   -2.346143255609728e-01   +1.585676138780011e-01   -5.061599921996680e-01   +1.171083168484907e-01   +2.298660639539742e-01   +3.321655755922774e-01; -9.624989492040639e-02   -1.039763454501670e-01   +5.122796562392512e-01   -9.827290981834703e-02   +4.141174152305520e-01   +8.307341244917493e-02   -2.736932523954410e-01   +2.215102765655493e-01   +1.579298562568988e-01   +1.353544035869809e-01   +2.646247454599757e-01   +7.182638309116882e-01   +3.182496084830043e-01   -2.260259395982067e-01   -4.661108095889426e-02   +6.049541707126451e-01];
L2I_L2E_iAMPA_netcon = [-1.171932262255202e-03   -3.818523198878847e-01   +1.441553364116723e-01   +9.498941245039663e-02   +6.909985085054117e-01   -2.583871937284913e-01   +7.083935197847702e-01   +2.514494147590109e-01; +2.106523693739094e-01   +3.472074924969829e-02   +7.561199475397852e-02   +3.888134904162284e-01   -9.106331174918605e-02   +6.448983185407707e-01   +1.034751515677298e-01   -2.439421528924607e-01; -2.344594350688313e-01   -9.549866557175864e-02   -3.211385115997508e-01   +1.000000000000000e+00   -1.923393266570842e-02   -1.004976857569142e-01   -1.723503977973167e-01   +7.997960516307553e-01; -9.986848311691861e-02   -5.818008683643783e-01   +4.036744055127864e-01   +5.386882403710590e-01   +6.285044835238847e-01   +5.242420788323842e-01   -2.361309041550304e-02   -1.276137400473041e-01; -6.775289090596656e-01   -4.327957921048210e-01   +2.111431396999647e-01   +3.725789461906132e-03   -2.493967803111039e-01   +5.267657289779676e-01   -2.349062207404342e-01   -1.736652449853006e-01; -1.878008780610893e-01   -6.576772260733863e-01   -1.794626408282226e-01   +2.353148475958077e-01   -2.726636113023428e-01   -8.489313631021592e-02   +2.600518175928298e-02   +4.594587348418723e-01; +3.044364048412649e-02   +1.035335742922209e-01   +6.325060753538844e-01   +2.047048257833255e-01   -4.004048144227675e-01   +1.938755138291610e-01   +4.927165838672858e-01   -2.063574173086688e-01; -6.949625788700570e-01   +8.044576173567328e-01   +3.056199588715701e-01   -2.788007222676829e-01   +2.344598641167410e-01   +2.935880925396294e-01   +7.369474962252508e-01   -5.500754862331978e-01];
L2E_L2I_iGABA_netcon = [+1.738710876047063e-02   +3.594312666465658e-01   +4.225934676685081e-02   -1.213202766938347e-02   +5.146595940123393e-01   -2.297586863987159e-01   -2.747603756052890e-01   +4.152230379118239e-01; +5.217201619499831e-01   -2.728585651199372e-01   +1.776289870260548e-01   +1.310225894071488e-01   +3.005453081244631e-01   -6.462333608343437e-01   +7.915737785334023e-01   -2.811454677036038e-01; +5.859622316093675e-02   -2.051039395672212e-01   +6.539997051410974e-01   +6.213575485066913e-01   +4.986845320446965e-01   -2.263993618257650e-01   +2.100717673085825e-01   -5.239694706642010e-01; -4.809398605182120e-01   -4.753078443576164e-01   -4.838417560576843e-01   +5.071023569823752e-01   +1.976629859887755e-01   +6.713622659141992e-01   -6.207950926659886e-01   -6.739594527163230e-02; -1.030474752321191e-01   +4.893141292119564e-01   -7.834629048736086e-01   +5.847771537655702e-02   -5.576986306566991e-02   -3.113722937869178e-01   -8.134341215234990e-02   -3.466794907771270e-03; -2.701110471506992e-01   +8.655735205863480e-02   -3.503191790680537e-01   +2.380092886235303e-02   -6.999310101225991e-01   -7.193997956006006e-02   -1.000000000000000e+00   -2.380607727267995e-01; +3.567640315412812e-01   +2.220468144868265e-01   +1.665542248928775e-01   -4.211548473279513e-01   -3.455506139037141e-01   +7.521375431157772e-02   -2.585633500390802e-01   +1.345552944753842e-01; -2.731439480583432e-01   -4.924637133672731e-01   +6.491541885682979e-01   -6.694895290616227e-01   +7.415257600735614e-01   -1.278303155928130e-01   -1.187800254190410e-01   +7.193769328499934e-01];
L3E_L2E_iAMPA_netcon = [-4.913093968699093e-01   +2.636772286130104e-01   -1.001524093385937e-01   -1.102989651804538e-01   +1.047061893815487e-01   -6.433535158118272e-01   +2.996016774061410e-01   -1.000000000000000e+00   -4.749483434046182e-01   -4.355855035872006e-02   +8.634798519919710e-01   +1.604294615696198e-01; -2.781071866248581e-01   -1.637047712470299e-01   -4.808702858504973e-01   +1.182480872735860e-01   -1.263498516803559e-01   -8.203378050976434e-02   +2.450701268290090e-01   -2.479271365505121e-01   +4.981585357800311e-01   +6.831389812168033e-01   -2.357479195846958e-01   -1.550832519480069e-01; +2.274213781114600e-01   +7.677974591665300e-03   -1.462531044272016e-01   -2.472524774620606e-01   -1.450347772035717e-02   +2.621085964228403e-01   -4.347331361184919e-02   +3.902178945915064e-01   -3.645291355010274e-01   +3.369219955775694e-01   -1.689291361601159e-01   -3.042079637726757e-01; -1.992527877019417e-01   +5.291961623795568e-01   -2.223771854645145e-01   -6.634207935884734e-01   +5.437256271679025e-01   +1.228137521843075e-01   +1.538239378663865e-01   -5.108927011184701e-02   +6.525980303081652e-02   +2.073670580296744e-01   -9.270015399565068e-02   +1.207703937263041e-01; +2.772107739589308e-01   -1.613914196739410e-01   +5.674099516258962e-01   +4.202858429940867e-01   -2.966833878740945e-01   +3.077481394648279e-01   +3.957170534809135e-01   +6.463023943978692e-01   -3.094815554721426e-02   +9.763369033140970e-02   +3.208089869540245e-01   -6.304024556165698e-01; -9.574065298198638e-02   +3.469682477460460e-01   +4.096697286219005e-01   +2.118072949890456e-01   -4.322332638718989e-01   +3.274884696597575e-01   +4.178698466652215e-01   -3.108911661722503e-01   +6.837591528773873e-01   -2.883240644089362e-01   -7.622186195025410e-01   +7.718047229215873e-01; +7.387375696514425e-01   -8.518223719050022e-02   -2.616735993725251e-01   -1.242666085385331e-01   -3.464510723120077e-01   +4.317598063893140e-01   -5.763582885404165e-02   +7.945192137063025e-01   -3.109290361576602e-01   -4.780839933359273e-01   +9.808078253469078e-02   +4.198392803762707e-01; +1.104941204769016e-01   -9.468880125700112e-02   -2.726691450967674e-01   +1.478269623362676e-01   -3.434262260104145e-01   +9.622116694901074e-02   +3.697313933258193e-01   +6.223574174945549e-02   +2.596653310489401e-01   -1.943597571732971e-01   -1.523665247952015e-01   -1.024239743321058e-01];
L3I_L2I_iGABA_netcon = [-2.137977644004937e-01   +2.764389133717223e-01   -5.417270322810023e-01   -1.612147075900551e-01   -1.195085360369442e-01   +5.691979461445280e-01   -2.711986527000852e-02   -2.243493437557041e-01   -1.494402077649558e-01   -1.752223986589692e-01   +5.182986720929977e-01   -2.275542770480550e-01; +2.382642210302142e-01   +7.135384798155293e-01   +7.803669689247185e-01   -2.727772042365730e-01   -2.250301175437793e-01   -8.101366351738680e-01   +4.035429516196213e-01   -5.813436251407793e-01   -1.777878224631180e-01   +2.896070752177041e-01   +1.934603702930124e-01   +4.403691123508224e-01; +3.266261396611234e-01   -3.566311477521050e-01   +5.192942752087526e-01   -2.670159741136340e-01   +1.141985675824625e-01   -1.486671078520494e-03   -8.578134818667762e-01   +2.528857336318210e-02   +7.802628761259000e-01   +6.845914658669847e-02   -9.307728607841718e-01   -2.653443628036613e-02; +7.488018785956643e-01   +2.671380068604921e-01   -7.631264988235898e-01   +1.512229444864220e-02   -5.033508795370757e-01   -4.556283425150892e-01   -7.340915455115241e-01   +3.028802782234785e-01   -5.553297224719536e-01   -6.351017172431287e-01   +7.158915074706318e-01   -4.955609361104560e-01; +1.469138113869493e-01   +1.575956286000336e-01   +2.932023157049563e-01   +2.658851666421482e-01   -5.233669115335482e-01   +5.824373546017844e-01   -8.749585110762793e-02   +1.175501720986918e-01   -1.986612344461989e-01   -4.797909125049171e-02   +3.990365028319146e-01   +7.089021129064256e-01; +4.242588927037907e-01   +5.405760333836398e-01   -7.020668831103902e-01   +5.911301161173373e-01   +5.884668964229420e-01   -8.031090023651474e-01   +4.031394098713292e-01   -4.956215990084853e-01   +3.563149560847392e-01   -6.924065563214341e-01   -3.895242310885840e-02   -5.690551142850235e-02; +1.375457001282012e-01   +1.110230547480969e-01   +1.060487365947469e-01   -2.612576184977842e-01   -6.338600461791750e-01   +4.014357043530471e-01   +7.702994638715578e-02   +1.262468961848082e-01   +5.859947018131605e-01   +4.230706089862487e-01   -6.987563597130801e-01   +2.321313856560989e-02; +3.824921262798706e-02   -2.944048510777942e-01   -5.273821125105568e-03   +6.280073887616263e-01   +1.941971944980116e-01   +1.000000000000000e+00   +1.344769670636414e-01   +1.775178160794179e-01   -2.178203181933832e-01   +4.180827379375320e-02   -3.985516565608002e-01   +1.530163269022714e-01];
L2E_L3E_iAMPA_netcon = [-5.845317949451479e-02   -2.027060290873493e-01   +8.009178905083271e-02   -2.930701967958984e-01   -3.826069100128659e-01   +5.482009071180933e-01   -2.863187705346051e-01   -7.053777444059599e-02; -8.172312831914730e-01   -8.686569545802135e-01   -2.227004162393853e-01   +5.122707391425496e-01   +1.447458630186286e-01   -3.010084376873861e-01   +1.621159355944708e-02   -1.732053095060111e-01; +3.806788803513312e-01   +1.312105124365873e-01   +3.987932270280368e-01   -2.376689944857926e-01   +5.550373705505297e-02   -3.828724827624594e-01   +2.519683613613452e-01   +7.347167561384709e-01; -5.119842493171134e-01   -4.242642421326069e-01   -3.065867716599745e-01   -4.932064581786837e-01   -7.675700124126216e-01   +4.142533710040651e-01   +5.888031877529599e-01   -3.501398265940661e-01; +5.012973630552640e-01   +4.933443665718857e-01   -6.711904848083646e-01   +1.067524109923064e-01   -3.628998073336782e-01   -6.168320884281003e-01   +2.198866506159531e-01   +3.076905512149924e-01; -1.143845205393352e-01   +4.620501636734610e-01   -6.788624422199817e-01   -8.624998248059849e-02   +5.780302487059790e-01   -9.316295744476106e-01   -4.432021871478549e-01   +2.376516354853722e-01; -1.371740533696423e-01   +1.250437563778678e-01   -1.638890291519075e-02   +4.884873220004713e-01   -8.333740099425585e-02   +4.655410583879358e-01   -3.087071768774843e-01   -6.952872514077978e-01; +2.987115867968164e-01   +7.580680202049279e-01   -3.551696183660480e-01   +1.000000000000000e+00   -1.471622013211352e-01   +2.955927480875137e-01   +5.916100813408947e-01   -2.107729632446962e-01; +1.073969639446230e-02   +8.163417388502673e-01   +3.434016165823461e-01   +9.064701246607000e-02   +5.445228232260876e-01   +1.451890588209440e-01   +6.971540207232496e-01   -3.925562644881206e-01; +8.291800064450224e-01   -3.240853560953306e-01   -4.542590212573520e-01   -3.551940620447187e-01   +3.566845630672216e-02   +5.248649769417987e-01   +4.806694052155209e-01   +7.803618630509718e-01; +4.161336841056693e-01   -4.362689617284938e-01   -2.378864062064111e-01   +5.700013891072891e-01   +1.374894050878353e-01   -4.935706857000394e-01   +1.997938869123907e-01   +3.483537659282637e-01; -2.708521449855371e-01   -3.632421883989953e-01   -6.924395297720855e-02   +1.818846866976546e-01   +8.167016299096725e-01   +4.470075155711354e-01   +5.780588482992819e-01   +1.493151558757710e-01];
L2I_L3I_iGABA_netcon = [-3.438219640489424e-01   +9.520927846460931e-01   +3.188201045800715e-01   +9.422077589561158e-02   -7.269256930074997e-01   -9.309982735115818e-02   -7.549119407978190e-01   +6.659488684302999e-02; -8.564268536388661e-01   +3.633961825230871e-01   +4.539071474539994e-01   -1.000000000000000e+00   +4.729145515580735e-01   +7.982956969967565e-01   -3.670554069527723e-01   +2.944229979771229e-01; -7.029852022576705e-02   -1.764729585553009e-01   -9.699060188346026e-02   +7.870203866470363e-02   +8.883261743100188e-02   -3.995816615784475e-01   -8.235619772977554e-02   -6.490600351369638e-01; -1.824308725667422e-01   +6.809533208582719e-01   +8.065814056480859e-01   +1.790183195442299e-01   -2.763887711499946e-01   +6.466898524109613e-01   -3.136890580365140e-02   -8.055833745885684e-01; -7.233048671452791e-01   -4.446550582284671e-01   -4.651330211336190e-01   +1.735522464051659e-01   -1.752940790416205e-01   -4.620921345198691e-02   +4.695488080890067e-01   +1.443733378594569e-01; -3.899821422267108e-01   -6.397849376018078e-02   +4.069478205165851e-01   +9.692350611448280e-02   -4.372928903670669e-01   -9.367943520373995e-02   +5.739330009441457e-01   -1.958089731225742e-01; +5.464157765084450e-01   +6.854978969229141e-01   -5.789020042344288e-01   -1.584600886311522e-01   -4.853626572413043e-01   +2.965638698786006e-02   +3.048754376223741e-01   +1.084495251147515e-02; -8.659914470398545e-01   +7.672940994285923e-01   -8.613730723998696e-02   -1.471076266383331e-02   +1.989654157262276e-02   -2.253227248263125e-02   +6.350353462315611e-01   +2.023692494327208e-01; +2.916879698637389e-01   -5.067612494495775e-01   +3.830175343758062e-01   +7.918760252941988e-01   +3.365113217834896e-01   +2.774198528463271e-01   -8.735568009613579e-01   +1.601463673748420e-01; -1.168257998671398e-01   -6.099978505492869e-01   +7.639262652462953e-01   -6.185853122692027e-01   -6.993808062164418e-01   -6.382395693687894e-04   +2.256080157361453e-01   -4.724391854097604e-01; +1.341202681579747e-01   -2.247636631010744e-01   +2.245451721523409e-01   +8.639998716808939e-01   -5.703625073701228e-01   +4.122890922931352e-01   +1.719866752946005e-01   +2.128325983191136e-01; +3.406233077248405e-01   -3.692383344332282e-01   -4.399565600653788e-02   -4.508627837592229e-01   +6.127267178549349e-01   -3.568246857755792e-01   -3.366904700859925e-01   +1.095571671430166e-01];
L3I_L3E_iAMPA_netcon = [-1.729905309952375e-01   +1.000000000000000e+00   -3.666700831959264e-01   +1.549249276245326e-01   -2.039816581053739e-01   -6.018128038000860e-02   +1.648509266940078e-01   +3.780738852595259e-01   +2.340986562171850e-01   -7.821072309208871e-02   +1.493617626071199e-01   +1.987582508423242e-01; -1.560048572331056e-01   -9.934622089715921e-02   +5.368286942902990e-01   -4.514811059566300e-01   +2.070707556907223e-01   -3.546286494884948e-01   -1.777502918283322e-01   +1.700838069256943e-01   +2.664653585673085e-01   -5.801983054218641e-01   -2.016220090737606e-01   +8.789444564303107e-02; +5.690248059726134e-01   +4.098136674252537e-02   +4.061101235533499e-01   -1.915441709687971e-01   -5.553886398501815e-01   -1.803724220520204e-01   -1.394186683982936e-01   -1.354442117531083e-01   +1.477880777249058e-01   +6.097659256809890e-01   -2.328870491528367e-02   +2.423893584093320e-01; +2.254703360574738e-01   -7.096949183959707e-01   -8.511200047670729e-02   -6.894481732209473e-01   +7.770707125428425e-01   -6.038986463562681e-01   -2.337062562548853e-01   +5.758322561115129e-01   -6.734968145144176e-01   -8.207385821158424e-01   -3.350684460483332e-01   -2.414490293939012e-01; +3.480541180365422e-01   +3.796411754140670e-01   +3.932064154605932e-01   +2.562345813715520e-01   -4.432294847760301e-01   +4.670522239321034e-01   +8.216850109931119e-02   +1.458182784043634e-01   -8.767132005235957e-02   -7.972831188392004e-01   +5.218678602138649e-01   +6.160357428346454e-01; +4.024454760323810e-01   -3.763943549214035e-01   +6.960392722863677e-01   -7.197776374057495e-01   +1.636818077511834e-01   -8.088692799328270e-01   +1.040598843542467e-01   +4.366240366766236e-01   +7.620255655632637e-01   +2.044735813492778e-01   -4.161520889250706e-02   -2.152115557147917e-01; +4.713257262160114e-02   -5.957999110805758e-01   -5.818746562190619e-01   +3.777266001690764e-02   +2.211898414405622e-01   +4.226460356326350e-01   +9.676579545565256e-01   +4.088260415904805e-01   +2.850348287809268e-01   +5.777091406920932e-02   -4.074482259726025e-02   +4.593526749012826e-01; +7.928937559166928e-02   +2.981886221580947e-01   -4.169929531663504e-01   +2.715043441868597e-01   +6.305682653737011e-01   +3.902399776525441e-01   -9.120938203876242e-01   +2.292638381144284e-01   -7.897388081151937e-01   +1.291504358385075e-01   -7.231639204549127e-01   -4.249815501553680e-01; +4.091378900983579e-01   +1.593008771766127e-01   +3.731278475482508e-01   -4.167558940522220e-01   +3.169911059094928e-01   +2.506237892112345e-01   -1.882407458878193e-02   +3.063935945312862e-01   +6.341694923283775e-01   +9.903781374531140e-01   +4.856096020775547e-01   +1.261589152794410e-01; -6.168160693228537e-01   +1.206547878150202e-01   +3.127301887230434e-01   -4.410555901596512e-01   -1.564595705608323e-01   +4.197679856668969e-01   -2.916960911383580e-01   -3.119051087559750e-01   -4.625786746750429e-01   -6.827978838208545e-02   +3.424726291286489e-01   +3.000721559247568e-01; -1.865008738174664e-01   -1.214834601023234e-01   +3.177878019297679e-01   -5.886950641164166e-01   +2.503707308557373e-01   -5.325917623224627e-01   +4.212933762655987e-01   +1.415548138700236e-01   -2.654951410102959e-01   +1.712646572681247e-01   -9.056123776191779e-01   +4.073747701364022e-01; -8.111411018565106e-01   -5.282429878627781e-01   -2.515872972430414e-01   +1.078807457953090e-01   -2.677952604175425e-01   +1.400724191606698e-01   -5.955996144164383e-01   -4.422405814144205e-01   +1.773124550288856e-01   +3.116443675461940e-01   +1.692252606913856e-01   -4.707352217291444e-01];
L3E_L3I_iGABA_netcon = [-1.714718023769778e-01   -3.287967565966447e-02   +6.138057907149455e-01   -5.135972565394998e-01   -4.624314114969694e-02   -1.942582246841860e-01   -1.000000000000000e+00   -5.180049250606327e-01   +5.178807459435503e-02   -2.870735889718365e-01   -5.937621241203404e-01   -2.758368991175098e-01; +4.040831152462238e-01   +6.523181013971941e-01   -1.764850458654329e-01   +3.775200147104139e-02   -1.024800108107350e-01   +6.344588275841787e-01   -8.315541023546564e-01   -2.316237764335858e-01   +6.346566760280837e-01   +2.404457009740319e-01   -4.326659660842226e-01   +6.649678290429358e-01; +6.463565743963797e-01   -2.603606105011044e-01   +4.297251814684246e-03   -3.386332007485578e-01   -4.246305006061696e-03   -2.493150847366340e-01   -8.855722143800276e-01   +7.207207669296285e-01   -3.072191561043764e-02   -1.524091174478933e-01   -4.214473288062549e-01   -6.665018775762780e-01; +1.735647213347414e-01   -5.264927764570649e-01   +3.322099874763986e-01   +6.427537459471946e-02   +4.373249499048445e-01   +3.426170178798343e-01   -9.016114325666963e-01   +4.211840438969882e-01   -3.670103267396516e-01   -1.425197288179337e-01   -1.683112745410787e-01   -5.668010977209172e-02; +3.333616023249558e-01   +2.596030217958766e-01   +7.494564626764901e-01   -3.629008159703807e-01   +1.876592608824838e-02   +3.755053000309249e-01   -2.147711018718694e-02   -5.394847273346165e-01   -2.351674128659508e-02   +3.524651303628874e-01   +6.081403259066879e-01   -5.537266983438462e-01; -4.642447190731721e-01   +6.167668303703601e-01   +1.973711049457129e-01   +3.790224014984876e-01   +2.250723978065794e-01   +1.776288905827273e-01   -1.393235668147504e-01   +5.340574268072852e-01   -4.823051548716667e-01   -6.369805600275583e-01   -1.157675275393845e-02   -8.589557464335360e-01; -1.290380406045995e-01   -4.991672695506563e-01   +6.915763740006636e-01   +2.188936309915653e-01   +2.470726655409794e-01   -9.691474140396593e-01   -1.812399659333185e-01   +3.338333208754770e-01   -4.626508219595624e-01   +4.965950199970849e-01   -2.695019363870172e-01   -6.558519446838372e-01; +4.555394539542398e-01   +1.846744261479712e-01   +1.827337354709889e-01   +7.401847269889100e-01   +6.771355211486916e-01   +1.394881551751242e-01   -5.311541213110027e-02   +5.131770569621968e-01   +3.149932474366492e-01   +5.729771275377766e-01   -5.503056942840395e-01   -4.238881532520354e-01; +7.250531822523005e-01   +5.339716916885181e-01   -1.448546945338256e-02   +3.574747242924827e-01   +1.034102616671138e-01   -6.086148341234979e-01   +1.854557039620760e-01   +5.836221249239204e-01   -3.668382241215845e-01   -1.987059907905919e-01   -5.784865245511688e-01   -4.361651678611155e-01; +3.028183840900885e-01   +1.119350318752061e-01   +2.080871100886708e-01   -9.051678214053277e-02   +1.058487490623275e-01   -4.225004400884923e-03   +5.784864124840818e-01   -2.130316171384393e-01   +7.409245591936051e-01   +8.339419002418074e-01   +3.115105762175909e-01   +7.928840426917891e-02; +1.380648009167074e-01   +4.167661998221736e-01   +5.672151987555988e-01   +5.430543692938814e-01   +4.763609696961622e-01   +3.201254119447420e-01   -7.479437630244435e-01   +2.817807620099395e-01   +7.490837240339437e-01   -4.570749908663869e-01   +3.691674644684191e-01   +1.565992453498125e-01; -6.392363670559934e-01   +1.203668435615191e-01   -7.521984484750081e-01   -4.449591868060049e-01   -1.365719539101191e-01   +6.154194617835183e-01   -6.042484451134589e-03   -2.753883348279744e-01   -5.943846996496798e-01   -2.422554697860321e-01   +2.302795148496162e-01   -2.112414516106712e-02];
L2E_Input1_iAMPA_netcon = [-3.435126707163375e-01   +8.530527306421504e-02   -1.000000000000000e+00   +8.427225000347950e-02   +3.325321564010671e-01   -4.979776895685013e-01   +3.386430272352762e-01   -1.671478668280702e-02];
L2I_Input2_iAMPA_netcon = [-1.000000000000000e+00   -4.491241966478688e-01   +3.906867861524822e-02   +4.242066665887167e-02   +3.418724453254818e-01   +2.322435158567302e-01   +7.858608995480182e-02   -5.675415143248162e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
