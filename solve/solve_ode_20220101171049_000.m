function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.193387438129219e-01   +2.081381526347148e-01   +1.551957630401252e-01   +5.548949607481228e-02   +3.018667633138417e-02   +1.230081170237771e-01   +4.826602297425621e-01   +4.764744387414060e-01   +4.323018086196729e-01   +4.778859591100902e-01   +1.448049875170390e-01   +3.488118631758062e-01   +2.787673027289609e-01   +1.977882414319456e-02   +4.287835853154743e-01   +8.452608038317767e-02; +3.580400805344632e-01   +4.081604498706037e-01   +2.000015410560949e-01   +2.291379404466201e-01   +4.748164331671044e-01   +4.807166918953327e-01   +2.110797606853973e-01   +1.492613474258678e-01   +4.481712227443178e-01   +4.386354206391581e-01   +2.349815358523800e-02   +1.442883942717907e-01   +3.866593187078375e-01   +5.142414818494655e-01   +1.870054099149218e-01   +4.951732749025896e-01; +1.462736970823644e-01   +3.553179302273080e-01   +5.571878290708089e-02   +5.057790303430633e-01   +2.554164784054217e-01   +2.557614329787475e-01   +4.145996462919900e-01   +4.776353908360119e-01   +3.742989953339743e-01   +8.273057943917485e-02   +7.338619508734254e-02   +2.047537788532273e-01   +3.047283646721026e-01   +2.742834089085157e-01   +3.973335133018895e-01   +2.140332813627000e-01; +2.911624237082232e-01   +2.576885499902731e-01   +3.328060204126737e-01   +2.916789112390181e-01   +3.891156600901671e-01   +2.366250469326166e-01   +4.420849638422884e-01   +2.686871993576080e-01   +3.008553293725325e-01   +3.116240576829637e-01   +4.952819967374533e-01   +3.546432173193898e-01   +6.265741685030568e-02   +4.651442506028172e-01   +2.465481572383093e-01   +1.699024010024875e-01; +4.770356250991740e-01   +2.975088498292107e-01   +2.884854082906387e-01   +2.903075677997753e-01   +3.275836978025406e-01   +3.191625174043933e-02   +4.801472328602416e-01   +2.576972964885410e-01   +1.594974920879117e-01   +4.418518113864796e-01   +2.116116480299627e-02   +4.273271856887924e-01   +1.565380110354360e-01   +4.953116024021974e-01   +9.197326165130040e-02   +4.086494501693752e-01; +4.384575143271712e-01   +1.116712873882821e-01   +3.116086508633988e-01   +2.470030326354967e-01   +3.595800513783313e-01   +8.482986942873860e-02   +2.751906292227369e-02   +1.268021200153658e-01   +4.526957323718707e-01   +3.346832114099444e-01   +1.103930886637495e-01   +5.025466317397475e-01   +1.786433020447800e-01   +4.622447905755637e-01   +1.594314454915846e-02   +1.431194979977328e-01; +1.234502112305067e-01   +3.225878485182150e-01   +4.164171385251467e-01   +1.913788108582075e-01   +3.687517265979256e-01   +3.430836084159209e-01   +3.063214721234629e-01   +2.032688058149851e-02   +4.203793933227662e-02   +2.271155193105496e-01   +2.736949573148529e-01   +4.106065354806335e-01   +3.641124613683864e-01   +4.847630478977123e-01   +2.057735307503645e-01   +4.274193044666608e-01; +1.591512178572864e-01   +2.921618395895377e-01   +1.304798312798956e-02   +4.690251503169799e-01   +1.831606231301808e-01   +3.840908561390007e-02   +3.705949607579349e-01   +4.376652574073982e-01   +1.638476519763514e-01   +9.361738846054303e-02   +1.166910238239291e-01   +5.086327886107858e-01   +4.166745229504665e-01   +7.662959373011383e-02   +2.087576450942486e-01   +1.126563671427951e-01; +3.845589667313292e-01   +2.901759111460120e-01   +3.432893159702059e-01   +2.525328351114443e-01   +3.004721573268194e-01   +4.735476402097473e-01   +7.088893155034894e-02   +4.001780583064243e-01   +2.489426635427409e-01   +1.409598946979339e-01   +3.729959129117895e-01   +4.770756183268581e-01   +1.501552590062051e-01   +2.033281960819318e-01   +5.011030577347936e-01   +4.691597740002548e-01; +4.073116045549394e-01   +1.329645547540697e-01   +7.387936639374117e-02   +9.138320909800009e-02   +8.513319776014071e-02   +5.595029171095414e-02   +1.937968020904030e-02   +4.575183362214370e-02   +1.779465330585460e-01   +3.724051381583061e-01   +1.788663966771351e-01   +4.218644436417691e-03   +3.166555580797363e-01   +3.511407155916479e-01   +6.294544841283414e-02   +6.741500592145443e-02; +5.005983727499679e-01   +4.912459155365700e-01   +3.510182448850607e-02   +2.624953952021158e-01   +3.086547774360286e-01   +1.271603012138128e-01   +4.131974398787019e-01   +4.085987490816139e-01   +1.984731669421230e-01   +3.232953249876463e-01   +4.447630005412969e-01   +4.429722267552334e-01   +6.243239346652819e-02   +2.947273973863286e-01   +1.882268340741542e-01   +2.489376129442466e-02; +4.309844729770639e-01   +4.952332593673578e-01   +2.420030034567023e-01   +2.274266787850874e-01   +3.410675151153196e-03   +2.313267325798636e-01   +4.487004002873516e-01   +3.585921029017227e-01   +4.210746382112178e-01   +2.107467953519490e-01   +3.924206882923069e-01   +3.011766011797553e-01   +3.270795453273025e-01   +2.243440022806957e-01   +4.034199811271872e-01   +4.173897747721832e-01; +4.377338194116912e-01   +1.240268013222865e-01   +1.926916975672391e-01   +1.825582994557387e-01   +4.663044428386178e-01   +1.632004914314057e-01   +3.914700328281150e-01   +3.281242724249007e-01   +2.708992896197310e-01   +3.592179140045607e-01   +2.679456513404572e-01   +2.531928939122425e-01   +3.974144439129699e-01   +9.137709889962911e-02   +4.314844892943896e-01   +1.597519090852975e-02; +1.462720253804113e-01   +1.033885297256024e-02   +2.169822483154454e-01   +2.266176320385940e-02   +4.554235878195011e-01   +3.183271122129602e-01   +3.941827721644651e-01   +3.277067306452311e-01   +3.541542353478679e-01   +4.818758302910808e-01   +2.895124739201539e-01   +6.156553204184406e-02   +8.602468638017181e-02   +4.742069391626186e-01   +2.297618832313820e-01   +1.392375305542292e-02; +1.438897513439066e-01   +3.579365751390108e-01   +1.573917772129580e-01   +1.333214856587888e-01   +3.969806667466841e-01   +2.470453578040802e-01   +2.874559499086133e-01   +8.410490567993083e-02   +1.008437687698788e-02   +4.475083590865197e-01   +3.848548497843738e-01   +4.511187596675578e-01   +5.542908315657202e-02   +1.102045346055725e-01   +4.563729945025083e-01   +2.747939882447546e-01; +3.489119478236524e-01   +2.108152016524562e-01   +1.121294676053941e-02   +5.053729613218962e-01   +3.811323721194493e-01   +2.812098800471068e-01   +1.872075106273701e-01   +4.882832512695947e-01   +3.255636525516044e-01   +4.435479927024797e-01   +3.591041031568590e-01   +7.738874355048020e-02   +4.431743163427762e-01   +4.386554042627989e-01   +3.490547952600427e-01   +1.363271384533110e-01];
L1E_L1I_iGABA_netcon = [+3.670117154579342e-01   +5.046649408773557e-01   +3.930214491379656e-01   +2.354407785035819e-01   +3.846986620438167e-01   +1.931194199674926e-02   +4.848618564081860e-01   +4.770310023448787e-01   +4.502135195447141e-01   +1.032273430756714e-02   +7.097042015658413e-03   +2.139380687767692e-01   +1.526150169603044e-01   +2.594392937410491e-01   +1.765206174980452e-01   +2.339955324041608e-01; +2.402334214083197e-01   +5.009188288063473e-01   +2.112949749410087e-01   +2.570235107269437e-01   +1.447580094645663e-01   +4.225617610254349e-01   +2.906412433025800e-01   +4.963505107296173e-01   -2.398031845977042e-03   +2.809448610832095e-01   +1.953161845243333e-01   +1.384728343523556e-01   +5.178976204794186e-02   +1.708216703210262e-01   +2.085253973860825e-01   +4.411550440217170e-01; +4.284222966463327e-01   +4.460614588156349e-01   +4.940517233299141e-01   +4.138969481779577e-01   +8.323196086205074e-02   +4.084846213884212e-01   +1.867355907218491e-01   +1.899590369476284e-01   +1.787225887287900e-01   +4.165997292661484e-01   +2.205864368870027e-01   +2.767963581699762e-01   +4.212311612246643e-01   +3.266564591910127e-01   +1.190673159829938e-01   +4.067125853277676e-01; +6.162191368237664e-02   +3.515983098093052e-01   +1.786077058205688e-01   +3.013879500762576e-01   +4.907916585319570e-01   +2.077932180593214e-01   +1.990622770893033e-01   +4.004371392348950e-01   +3.716783307557717e-01   +3.641483780850027e-01   +2.935831806503196e-01   +4.985811791106939e-01   +1.816727114234278e-01   +3.631234008433153e-01   +5.021935851177324e-01   +3.963738408022924e-01; +2.091167467511137e-01   +2.435212042686881e-01   +2.831275791726222e-01   +4.857186542194952e-01   +2.043053337270940e-01   +1.924951406348391e-01   +2.885180868794271e-01   +4.995102629857432e-01   +1.598162658593431e-01   +1.855138973044996e-02   +4.673798276313466e-01   +2.036338064002751e-01   +4.162233781327274e-01   +4.471196260971780e-01   +3.060104060990216e-01   +6.897136970073747e-02; +5.004123432669627e-01   +2.973453736965085e-01   +5.142876576578526e-02   +1.649679598264691e-01   +2.337118351296803e-01   +1.194008770231839e-01   +2.648711159662791e-02   +1.263758515542130e-01   +3.653150316546157e-01   +4.713962446573463e-01   +2.150512749124532e-01   +2.341041488800405e-02   +3.227525879189868e-01   +2.825052504132666e-01   +1.039914281730687e-01   +3.840598971569777e-01; +4.241906954832877e-02   +1.100345367708720e-01   +3.445488749700767e-01   +1.237415084613920e-01   +2.620537732525909e-01   +1.018407117300576e-01   +1.762015698157301e-01   +5.398358030599095e-02   +1.826915416131059e-01   +4.114559401894732e-01   +3.823554871485835e-01   +1.774704147734757e-01   +2.622780260281894e-02   +1.133722641880784e-01   +3.104809804512115e-01   +2.400839982549564e-01; +4.519850457408772e-01   +8.524192850091418e-02   +1.441183605591557e-01   +3.399268227560959e-01   +3.188035536319649e-01   +1.979208515764743e-01   +1.137350968362745e-01   +1.716540735745921e-01   +3.142833155476545e-02   +6.012364448423409e-02   +1.042636250964310e-01   +4.773464553132257e-01   +7.286953265568935e-02   +1.614717718160254e-01   +3.424430655851200e-01   +4.471762062865837e-01; +8.301168228533778e-02   +2.148191913219789e-01   +1.337053625042612e-01   +1.908975597109961e-01   +9.670633630659189e-03   +2.037495741106873e-02   +1.168297926184243e-01   +1.229152854906513e-01   +3.359871586721223e-01   +9.755923609894065e-02   +8.589373633711499e-02   +4.203375872832638e-01   +3.260707208459555e-01   +1.073061180382728e-01   +4.251653060063879e-01   +4.622735762600935e-01; +1.148174297518577e-01   +3.133556475974077e-01   +4.915789776338250e-02   +2.440611733855741e-01   +1.545307427692618e-01   +2.819096762384168e-01   +4.698834443182702e-01   +7.381163951273133e-02   +4.644230879547352e-01   +2.411703597420988e-01   +3.703152142098312e-01   +4.429667956122378e-01   +2.909669193650124e-02   +3.313706263169010e-01   +2.060058269690007e-01   +4.426557083308587e-01; +4.895176266000558e-01   +3.933800939562256e-01   +4.623390839268378e-01   +1.766597244913447e-01   +1.507455196453424e-01   +2.846684402529555e-01   +1.691229379552876e-01   +3.296710399895451e-01   +3.756374161997844e-01   +4.347885333124491e-02   +3.168262656608547e-02   +3.401508766795564e-01   +2.503932649883387e-01   +4.163575754417940e-01   +1.916213418247407e-01   +3.505765032703247e-02; +4.588415703109381e-01   +1.862252554377693e-01   +5.034990246219110e-01   +1.762122534515525e-01   +1.536029888167543e-01   +4.093646972623550e-01   +2.366512371845864e-02   +4.091724203231463e-01   +9.209376739286193e-02   +3.972403198066399e-01   +4.354289265215958e-01   +1.124949363721467e-01   +2.728525054329671e-01   +2.397724242442520e-01   +4.791326349657817e-01   +1.958082925368058e-01; +1.509553061335690e-02   +1.375671028668725e-01   +1.683150784161984e-01   +1.056475608970719e-01   +3.700530240400420e-01   +2.218297680191493e-01   +3.231146498738269e-03   +2.705159785385065e-01   +3.274200107279322e-01   +2.240954046451533e-01   +4.980762022001781e-01   +2.068845382699480e-01   -1.198037892178720e-04   +3.737116506150504e-01   +5.838572921344280e-02   +4.331592265324501e-01; +2.957588711169614e-02   +4.205197585554508e-01   +3.149087389808496e-01   +1.159432998119727e-01   +3.282420588620054e-01   +3.222313564717250e-01   +3.958412664678945e-01   +8.907826075442993e-02   +4.427339019686028e-01   +4.554098432471910e-01   +1.910086156207489e-01   +6.134491460841225e-02   +4.880620000656352e-01   +4.979917824120809e-01   +1.615769192491730e-01   +4.201893726585553e-01; +1.442180692343235e-02   +3.399403826641393e-01   +4.828822237654226e-02   +1.702539609310587e-01   +9.356568600050624e-02   +4.060466078950704e-01   +4.201326593138109e-01   +4.312279728513204e-01   +2.863875955589931e-01   +2.899238298933683e-01   +2.414953758785498e-01   +2.683957722459339e-01   +2.995464742464279e-01   +1.117119144624163e-01   +2.074672969479326e-01   +1.624661172337541e-01; +1.898472210514203e-02   +3.031660385210623e-01   +1.711665835911110e-01   +1.934921397732710e-01   +4.753090823513371e-01   +4.485946029606265e-01   +1.071218579537239e-01   +4.672460612392114e-01   +4.058503294228372e-01   +9.837354003056270e-02   +1.609533584906787e-01   +4.133966122088518e-01   +5.025262184359394e-01   +4.393957210782513e-01   +2.580005226202743e-01   +2.791598915540493e-01];
L2I_L1I_iGABA_netcon = [-2.598379624545340e-03   +3.450532414803085e-01   +4.138232390852141e-02   +4.483096673120004e-01   +2.647893652886065e-01   +3.999971059246573e-01   +2.154907781106873e-01   +7.087837231106653e-02; +1.603950413160570e-01   +2.509623869698379e-02   +3.686922415500558e-01   +1.040442490703941e-01   +1.049086002978521e-01   +1.134134339998323e-01   +4.340950340765818e-01   +2.529065589582145e-01; +3.483123722226629e-01   +2.028905487142383e-01   +2.272363399078651e-01   +2.994005502500352e-01   +4.909493684356057e-02   +5.002891116099930e-01   +1.285814456702939e-01   +1.097044005558115e-02; +4.023128527090967e-01   +4.671895718067482e-01   +3.116199332972149e-01   +3.277828573172409e-01   +3.409476745332748e-01   +1.108532417678133e-01   +4.759051886732475e-01   +4.060021570054926e-01; +3.135300589256893e-01   +6.740939653392400e-02   +1.256291368509575e-01   +4.486029081916760e-01   +1.996922284026991e-02   +4.326736903834609e-01   +1.373238163630374e-01   +2.451099774731224e-01; +3.119325541531025e-01   +3.716057668159546e-02   +4.410493499524506e-01   +2.102800758084457e-01   +3.804761829752520e-01   +4.300948605963469e-01   +5.110493080096412e-01   +1.160876935353569e-01; +4.038881878096426e-01   +1.598467147846603e-01   +4.916611257575322e-01   +3.118742808272801e-01   +6.212112406435813e-02   +1.911788095554444e-01   +1.115546544234959e-01   +4.653290490173109e-01; +8.179552499874566e-02   +4.098795224047420e-01   +1.015335896598945e-02   +4.267304786192989e-01   +5.047081183173149e-01   +1.270994172392900e-01   +2.629507293211641e-01   +1.528155995842000e-01; +3.470208188790322e-01   +3.417310271193348e-01   +1.670212025014408e-01   +3.557645355561629e-01   +3.297893324516799e-01   +1.362323831380947e-01   +2.068267086680555e-01   +1.446916901740408e-01; +2.747532101451721e-01   +1.624760716480627e-01   +2.182455109304352e-01   +3.511346587436201e-01   +6.599310623746804e-02   +3.814008205634404e-01   +2.419819013832490e-01   +3.091207360940533e-01; +2.433931208857731e-01   +3.143196540547111e-01   +2.715161573159455e-02   +1.238188295850123e-02   +2.374371868880833e-01   +1.163016657207957e-01   +1.504832532435283e-01   +2.545747093235510e-01; +1.167844361254775e-01   +3.193590985205002e-01   +6.540628877124779e-02   +1.868789092397996e-01   +7.047320949891131e-02   +2.894746970817884e-01   +2.063298873905184e-01   +3.248896302700557e-01; +3.838224285940625e-01   +2.950174720415626e-01   +1.145762069371399e-01   +2.624832603699287e-01   +1.364158868369611e-02   +3.219322626354763e-01   +9.583496050485313e-02   +4.757643192063643e-01; +2.653372251010274e-01   +2.600275334260886e-01   +7.701202110461108e-02   +4.989824589557467e-01   +2.168608883335500e-01   +5.097458018278912e-01   +4.332686738545877e-02   +2.984077533705832e-01; +1.329113530439026e-01   +2.445058758799213e-01   +4.881591063390273e-02   +3.019991680449626e-01   +8.118156540058802e-02   +1.881594879353108e-01   +4.886455427926614e-02   +1.092286796094574e-01; +7.468135530036719e-02   +2.984520383090010e-01   +3.328102394836897e-01   +4.253664796000691e-01   +8.659408035443572e-02   +4.709063530651640e-01   +4.915992256521937e-01   -4.660184775257289e-03];
L1I_L2I_iGABA_netcon = [+2.841628491846412e-01   +1.434215460518411e-01   +2.163008403765591e-01   +1.492575350777564e-01   +7.071725609774018e-02   +3.815293348897725e-01   +2.419345016732524e-01   +4.278625732568357e-01   +1.694030399197972e-01   +3.639732366326937e-01   +3.690549011823477e-01   +4.523938001923203e-01   +2.287428388096251e-01   +4.195278291200735e-01   +3.248847659298488e-01   +2.266080433447211e-01; +1.717167141883302e-02   +7.493571035089121e-02   +1.387974303874033e-01   +1.628636808084170e-02   +4.749349715193097e-01   +3.417733432998469e-01   +3.694037566693313e-01   +3.487769372407994e-01   +3.360239921513595e-01   +1.997911674087469e-01   +1.724037486298248e-02   +2.089217743548439e-01   +3.020091010071398e-01   +2.301808828011376e-03   +3.668044016736510e-02   +3.277345737645245e-01; +6.940814476078859e-02   +5.250299363471440e-02   +1.247866518898069e-02   +1.451423256649913e-02   +5.045281695041828e-01   +3.535465479067185e-01   +4.799878436316927e-01   +4.403442482965688e-01   +1.472959562326796e-01   +1.429148687162940e-01   +9.907817444812611e-02   +1.063314678036774e-01   +4.456601438093772e-01   +1.145125182515867e-01   +1.394052935906540e-01   +4.096464272478485e-02; +2.658768139006716e-01   +4.220786448352590e-01   +2.610518987494110e-01   +1.753344726658845e-01   +1.528501719845329e-01   +2.830565978689543e-01   +2.266121314355910e-01   +3.988530213385912e-02   +1.338347001225407e-01   +2.865315352049126e-01   +4.645636762801507e-01   +4.671678388876967e-01   +5.033074027703359e-02   +6.418402940893010e-02   +1.754742810728449e-01   +2.992255171395400e-01; +2.161674954585833e-01   +1.415020488877769e-01   +4.963234633261122e-02   +4.497716155734688e-01   +2.878184548283751e-01   +4.365881171373838e-01   +7.051048042600934e-02   +2.755173223219361e-01   +4.839218023264389e-01   +2.901990154101671e-01   +4.521415306257889e-01   +1.423881647989678e-01   +8.077093079632855e-02   +5.009169917611044e-01   +4.234013717922583e-01   +4.962955572172190e-01; +1.697821457676054e-01   +3.647472074042617e-01   +1.637795216388566e-01   +3.964237697975104e-01   +2.133712144769824e-01   +3.801243743518865e-01   +4.174836717905889e-01   +3.439124049345097e-01   +2.020015091351203e-01   +4.568265286342617e-02   +2.815955326058705e-01   +4.552236464641113e-01   +1.459476775120932e-01   +3.189453158802637e-01   +4.699539069551528e-01   +1.758407122221066e-01; +4.852036090956443e-01   +4.330570467915324e-02   +2.201681796355683e-02   +1.224591667855006e-01   +5.018934634131246e-01   +3.125859959952888e-01   +4.812237697696536e-01   +2.116310261851510e-01   +4.751292298515366e-01   +1.294267736466269e-01   +4.992957511489304e-01   +2.735182315164661e-01   +2.206992922499274e-01   +2.836548851039094e-01   +1.205754687510041e-01   +3.994305338767714e-01; +3.927171625880215e-01   +3.385732924185401e-01   +1.397001618134492e-01   +1.507643881140359e-01   +4.217869306933107e-01   +1.917954552251948e-01   +1.789932067314560e-02   +8.388258663810652e-02   +1.906288284225719e-01   +1.596867761089860e-01   +5.396652046708875e-02   +4.619032246449799e-01   +2.271050933963513e-02   +1.056041351824049e-01   +4.857328801063985e-01   +5.025839509273696e-01];
L2E_L1E_iAMPA_netcon = [+4.710795671288145e-01   +1.967543850504121e-01   +3.532772392456152e-01   +2.878156462571156e-01   +5.362094350540857e-02   +1.708176888491933e-01   +4.481575759467147e-01   +3.296384146166341e-02; +1.715976896942598e-01   +1.622239146836775e-01   +4.197946824639471e-01   +1.120490142949856e-01   +3.686874073084941e-01   +2.759882222676781e-02   +1.594722069483750e-01   +3.564506156213453e-01; +1.587978556854395e-01   +7.642427602926856e-02   +3.824865979912856e-01   +3.363596845540104e-01   +2.497931398392827e-01   -4.612280723770502e-03   +1.164502124361858e-01   +1.815327061181173e-01; +3.054694274785245e-01   +9.358885896095558e-02   +1.397581391008721e-01   +4.875654769215373e-01   +2.689619538717128e-01   +1.188771396503121e-01   +3.223551876577355e-01   +1.518077495046866e-02; +9.547247245394018e-02   +2.571881965181024e-01   +3.714270116395501e-02   +1.132030715312464e-02   +1.380178772505820e-01   +2.711004234714028e-01   +1.286850566130552e-01   +1.249494586890963e-01; +1.311867246881062e-01   +2.737243233892503e-01   +7.926806616659306e-02   +2.319646506036540e-01   +4.537230729189208e-01   +4.927189683902712e-01   +4.024566372370251e-03   +4.261038984684525e-01; +2.139555312894997e-01   +2.055198233477581e-01   +4.904850439266062e-01   +1.922960263389234e-01   +1.256575632760525e-01   +6.751860203748250e-02   +2.226110557512813e-01   +2.505126555655159e-01; +9.716008316053458e-02   +1.162277853060988e-02   +3.649739332115257e-01   +3.467501422747308e-01   +1.508842892019837e-01   +2.590896899812529e-01   +4.209844053128580e-01   +4.006835398575395e-01; +1.351161067882173e-01   +4.276087548133839e-01   +3.069875441698263e-02   +4.242156214920597e-01   +3.477263418063783e-01   +1.439256259349909e-01   +1.393089321618435e-01   +1.714577330099611e-01; +5.854058044457144e-02   +4.533142512743975e-01   +3.818393057921636e-01   +4.056683522298039e-01   +2.194686840154204e-01   +5.033773095789310e-01   +4.863414006930405e-01   +3.392301296154041e-01; +4.090106818502828e-01   +1.817133923175282e-01   +2.776114923871446e-01   +7.132199385556694e-02   +2.480950970268636e-01   +3.811296514096714e-01   +1.555314229152582e-01   +1.140582677577445e-01; +3.155510709146275e-01   +4.918898325450233e-01   +1.920759972556135e-01   +4.349546180732843e-01   +4.953211079691047e-01   +4.001878097313118e-01   +2.443468091807749e-01   +4.906845156017693e-01; +2.605068390546410e-01   +2.858207151018321e-01   +1.104215401261384e-01   +4.485920569898650e-01   +5.263314746862379e-02   +1.303702502330664e-02   +1.301922885169133e-01   +1.742472532106764e-01; +2.169504775478084e-01   +2.800031215439337e-01   +4.627169629308521e-01   +2.014859495224360e-01   +2.541731976443885e-01   +3.129951052560134e-01   +4.456076640115554e-01   +2.614688242191687e-01; +4.052161529157893e-01   +1.286355541315742e-01   +2.069298547842074e-01   +1.090438958975914e-01   +1.224916513952577e-01   +3.984971597146786e-01   +4.792730037457449e-01   +3.266217370516594e-01; +3.081290283015325e-01   +8.910976365716453e-03   +1.473355336277945e-01   +3.923304468706755e-01   +2.318483851610368e-01   +3.999347062933997e-02   +2.664495706233374e-01   +3.840519945558409e-01];
L1E_L2E_iAMPA_netcon = [+7.130716525697484e-02   +1.847070825465232e-01   +3.885702487264512e-01   +3.834470754746901e-01   +1.959886083916902e-01   +3.072466398752949e-01   +2.837639181212092e-01   +4.701673861083896e-01   +4.050831573720694e-01   +2.483468852564907e-01   +1.553638308212749e-01   +4.886820786049234e-01   +2.314876245740191e-01   +1.420811153036647e-01   +2.809555768153760e-01   +8.933071605714328e-03; +3.830933298018178e-01   +3.308009975966908e-01   +4.887845459217384e-01   +1.094406808849719e-01   +2.195873815346424e-01   +3.572621905364108e-01   +3.484203398848520e-01   +1.894646079844449e-02   +1.344524933367485e-01   +1.543393683435128e-01   +3.722802810621800e-01   +2.510355324386640e-02   +4.126174397179835e-01   +2.477636499658923e-01   +1.444763578715196e-01   +3.990961986317751e-01; +1.784504020967536e-01   +2.050811721618406e-01   +1.204875287907322e-01   +5.079517656537090e-01   +2.982831105072334e-01   +2.878987250295856e-01   +4.241927785267120e-01   +1.452641763729975e-01   -2.779875503559492e-03   +1.111268812677656e-01   +9.287789940173595e-02   +2.978691216073487e-01   +4.702421641520518e-01   +9.127339065693633e-02   +1.679048232048396e-01   +2.705421315184237e-01; +7.849337241042566e-02   +1.763461781418641e-01   +5.603121645401053e-03   +2.417541821389648e-01   +4.001980499352824e-01   +4.109461478525619e-01   +3.403374846955530e-02   +1.104532778127997e-01   +4.454352210231133e-01   +2.182450441974448e-01   +4.111476542267890e-01   +1.653658258470030e-01   +5.070101694936062e-01   +1.477303970441784e-01   +9.961354438964316e-02   +2.751162130243268e-01; +1.083143500518794e-01   +8.803544540647362e-02   +1.868166960309489e-01   +2.514689411940415e-01   +1.490191130242675e-01   +3.035346644998211e-01   +3.154275521331979e-01   +2.153002006841703e-01   +1.454648843602864e-01   +3.545037604284567e-01   +1.624842170278762e-01   +2.949644456034687e-01   +7.821302710947894e-02   +1.901370249230591e-01   +4.593278442362074e-01   +2.316641167765639e-02; +2.473903077860007e-01   +2.730211408043492e-01   +3.878649780123019e-02   +2.525829859330526e-01   +8.596490676764870e-03   +1.898414848007791e-01   +3.245758373526273e-01   +3.489047326353457e-01   +1.419345907938004e-01   +4.117548205056956e-01   +4.461339711227166e-01   +1.555423033806242e-01   +8.556851976484343e-02   +2.701443614179174e-01   +3.082500359500631e-02   +3.062363893588815e-01; +3.508732441934117e-01   +9.011784116434153e-02   +2.453199255324523e-01   +3.580425925467653e-01   +9.894514690044841e-02   +4.264792718658487e-01   +4.262504755170091e-01   +5.161962556210873e-02   +4.820891260438039e-01   +4.624155795466140e-01   +2.809950106861780e-01   +2.045569141999879e-01   +1.504544180967345e-01   +1.744182350665647e-01   +3.841750020564225e-01   +2.217566819890737e-01; +6.394883405191407e-02   +1.728539109131678e-01   +5.612577702758990e-02   +1.193610382165208e-01   +4.219282279877980e-01   +1.410623314373524e-01   +1.260122341568032e-01   +3.696137275611360e-01   +4.627861359669914e-01   +3.387219345045195e-01   +1.544585341233817e-01   +4.481343852564439e-01   +1.390284096039922e-01   +4.796460576802061e-02   +4.554879174114135e-01   +3.578128352635336e-01];
L2I_L2E_iAMPA_netcon = [+2.944373610725077e-01   +3.881935678523767e-01   +4.279989453857806e-01   +4.620006161386250e-01   +1.483255423236305e-01   +5.096126593788796e-01   +4.023673435073331e-01   +2.487441252555823e-01; +8.174990672141091e-02   +3.584520603946828e-01   +2.579557418503917e-01   +3.100763568015962e-01   +1.767745925625501e-01   +2.239552233428877e-02   +3.893676577625902e-01   +3.132462981169110e-01; +2.342279537673775e-01   +1.169214689765180e-01   +4.691258864904876e-01   +3.004786966638406e-01   +2.604016098559384e-01   +4.997814748924011e-01   +5.479038580669147e-02   +8.271106848904383e-02; +1.540715264583652e-01   +3.805525634582217e-01   +4.281769362434777e-01   +3.676470827098947e-01   +5.027555040552667e-01   +5.001801632996111e-01   +3.129276202096755e-01   +4.534564468352089e-01; +1.489470443660191e-01   +6.456202546501004e-02   +4.507244394766903e-01   +5.032757337699996e-01   +4.193245527674069e-01   +4.397924477538320e-02   +3.067040598416778e-01   +4.118467379065019e-01; +9.193726677489703e-02   +3.979708426657172e-01   +3.559264906968004e-01   +2.675605936024933e-01   +3.022378272701208e-01   +3.681212307775126e-02   +3.091021735395129e-01   +4.201808337209298e-01; +4.180664770006630e-02   +3.725510400816647e-01   +2.851597157520114e-01   +2.219325303516638e-02   +4.556150089869034e-01   +2.058168304302876e-01   +3.787845137430275e-01   +4.289029504171097e-01; +4.263703637615545e-01   +1.626956270002806e-01   +3.225504510239089e-01   +3.602115100936812e-01   +8.873944682358743e-02   +3.973615901030858e-01   +2.196527959075874e-01   +2.379111326470834e-01];
L2E_L2I_iGABA_netcon = [+1.024754147500682e-01   +3.670103228059941e-01   +4.798752261821383e-01   +3.778446264144796e-01   +4.942660204911504e-01   +3.913937239340206e-01   +4.761373658310648e-01   +1.975075233849652e-02; +4.982245565872270e-01   +4.295986753154417e-01   +2.437581069372884e-01   +3.921708384923250e-01   +7.207519784985440e-03   +4.496063369660281e-01   +1.048765521446227e-01   +9.988992771356017e-02; +1.585901420175176e-01   +1.457620071279461e-01   +3.504315870832136e-01   +1.730661166386346e-01   +5.046013737448999e-01   +1.093955076958509e-01   +8.203354473650241e-02   +1.056287757654506e-01; +3.707151766562856e-01   +3.328912214954775e-01   +7.606122850829809e-02   +3.120413042975499e-01   +6.933143584100981e-02   +2.540404665815240e-01   +4.171641693871956e-01   +2.614919800520366e-01; +3.522636847238888e-01   +2.815812387139466e-01   +3.959095842559818e-01   +2.633727138579910e-01   +7.853726760790770e-02   +3.024530861542316e-01   +4.980193134699706e-01   +2.273719952229991e-01; +3.392850869626944e-01   +1.417899193427083e-01   +4.993576420283631e-01   +6.015473892549741e-02   +3.264382355333905e-01   +2.066320224989951e-01   +4.214481928625162e-01   +3.966647281582650e-01; +4.901707312823763e-01   +3.389886231180489e-02   +2.872358381045322e-01   +1.617383807112988e-01   +1.288088504829975e-01   +4.943565675851680e-01   +4.167651828266107e-01   +1.426129984546460e-01; +4.948568911718473e-01   +4.535732356912106e-01   +4.237314496902945e-01   +6.064838781867241e-02   +4.880521672873061e-01   +7.866270789389893e-02   +4.183530127536337e-01   +4.597158695981292e-01];
L3E_L2E_iAMPA_netcon = [+3.514620575178353e-01   +3.074353068416373e-02   +2.797056578784899e-01   +7.568156526102229e-02   +5.160525790370790e-03   +6.284226545281478e-02   +1.460736919873883e-01   +4.341472542108554e-01   +1.898003880229747e-01   +2.076918374448464e-02   +1.847875117620240e-01   +4.802737972956363e-01; +4.045409657309592e-01   +4.104175728051914e-01   +1.355881260060923e-02   +2.686036634333900e-01   +4.095075408302549e-01   +3.729596705565441e-01   +3.453962725345127e-01   +2.642513816411148e-01   +4.124478446360089e-01   +4.497878606054696e-02   +2.552610790368597e-01   +1.249324173932873e-01; +3.311988421256296e-01   +2.404678337736312e-01   +4.503302069313361e-01   +3.193717006948812e-01   +3.392724721117176e-01   +6.081499826987415e-02   +1.947621872095989e-01   +2.767786119891565e-01   +1.186460405591011e-01   +2.816855577097971e-01   +2.718575828744619e-01   +4.895498207165649e-01; +1.015497004030439e-01   +2.342057682417611e-03   +3.986734846974140e-01   +2.334868038949831e-01   +3.034011436139762e-01   +1.578979369886327e-01   +2.840971456908785e-01   +2.771657090782021e-01   +8.602146252689806e-02   +4.697177477354294e-01   +2.316598587336666e-01   +1.068819877171915e-01; +2.931516177772476e-01   +2.458083334295687e-01   +1.506248722289613e-01   +2.275825704294877e-01   +4.299477704932873e-01   +3.172689062502703e-01   +4.239614557391556e-01   +3.941666390771967e-01   +1.248406579984762e-01   +4.619946896232729e-01   +2.442424218258133e-01   +3.848979877074977e-01; +3.161418554595745e-01   +4.625694211427079e-01   +4.653514341248943e-01   +9.726137151733773e-02   +2.872618199484188e-01   +2.087472181323808e-01   +9.293265561107156e-02   +8.485751897144732e-02   +3.228882972529694e-01   +8.170743139472519e-02   +8.532508545971194e-02   +2.588605075325682e-01; +4.678880997292620e-01   +2.649369269517281e-01   +4.800832517537100e-01   +3.969588522088998e-01   +1.561325898187867e-01   +3.348143360336416e-01   +3.043899742845413e-01   +1.552521575051872e-01   +2.597372562484653e-01   +3.090038478565164e-02   +4.726440030731150e-01   +4.736566502913162e-01; +2.677249235640865e-01   +4.382838765878944e-01   +4.787538020807036e-01   +5.090507558954558e-01   +2.290330865202193e-02   +3.583194583960988e-01   +4.027653765332875e-01   +7.803997586811930e-02   +4.820293593008328e-01   +4.187927739157633e-01   +5.298130950541825e-02   +9.105389882102514e-02];
L3I_L2I_iGABA_netcon = [+4.054483058100030e-01   +3.448145016856730e-01   +2.251003619114232e-01   +4.465431891983602e-01   +4.063223747174408e-01   +4.737794733446869e-01   +3.935670142244384e-02   +5.082820140686188e-01   +4.360297655916511e-01   +2.271089055069226e-01   +6.159121501147764e-02   +7.733410281345786e-02; +3.549575785619127e-01   +2.263379839311611e-01   +3.385175106295550e-01   +3.318006204888530e-01   +3.156890018732014e-01   +3.113690287885473e-02   +1.238337268874330e-01   +4.648399372163144e-01   +1.967049357075697e-01   +3.400572144698039e-01   +3.794664045611173e-01   +1.766019028242712e-02; +9.979714284755722e-02   +2.600861538925718e-01   +4.217822459205163e-01   +4.897275288710833e-01   +1.504315608061096e-01   +4.374037854270224e-01   +2.788214955524951e-02   +2.018915139686462e-01   +2.481482915226478e-01   +1.725164336192534e-01   +4.281926649897429e-02   +2.495200393959691e-01; +3.796733340706527e-01   +1.941652340985288e-01   +4.704850281078901e-01   +5.108358531648591e-01   +8.839543886402854e-02   +3.582098825307299e-01   +3.064055405160694e-01   +3.091919253860717e-01   +3.230980721317208e-01   +1.600886275424123e-01   +3.297271914523832e-01   +3.859320760173220e-01; +1.129485589289516e-01   +4.818961147960700e-01   +4.234756651963567e-01   +3.258099691891436e-02   +2.068932543328096e-01   +4.021929501701022e-01   +2.922599829405175e-01   +4.747336143652708e-01   +1.197418843672583e-01   +3.353805841632695e-01   +3.825938766060091e-01   +2.819364638375733e-01; +1.642271797538950e-01   +3.961584557082393e-01   +3.414613779056408e-01   +3.171042692193331e-01   +4.314542690713614e-02   +1.447265352583566e-01   +2.837975134531640e-01   +3.842148850617446e-01   +4.977566478261874e-01   +1.250425484035609e-01   +2.741950219899906e-01   +2.918366532988826e-02; +3.459791104573147e-01   +2.930207179591798e-01   +2.758692674162754e-01   +3.668843132785815e-01   +2.899202875785524e-01   +1.732937368536148e-01   +7.562191992824689e-02   +1.087023851298319e-01   +1.278057189736723e-01   +4.550402901369419e-01   +4.812155832909265e-01   +3.714116969325894e-01; +3.305612678167719e-01   +4.386109715426522e-01   +3.829214102880323e-01   +5.021417306592981e-01   +5.080662200206280e-01   +6.575973073094774e-02   +4.421214610799817e-01   +4.398878023996775e-01   +3.425652655504079e-01   +5.008623994178826e-01   +4.042378606180072e-02   +2.590258135338970e-01];
L2E_L3E_iAMPA_netcon = [+1.942551954187409e-01   +4.438051881720153e-01   +1.734762452097514e-01   +4.805572346068580e-01   +2.783789219713639e-01   +3.373695547191442e-01   +3.525921518235334e-01   +2.124270970705069e-01; +1.971638460918734e-02   +1.157654082748090e-01   +3.378585616588251e-01   +1.935996388712132e-01   +2.146454605386127e-01   +2.777229405354625e-01   +4.220680934825584e-01   +4.541441488095752e-01; +4.762951613512776e-01   +1.780223453704715e-01   +2.791448105244611e-03   +2.448090486910871e-01   +2.940628164759255e-01   +4.712342635597923e-01   +2.443414352032017e-01   +3.151979772902437e-01; -1.006765000471725e-03   +4.144779505291499e-01   +1.686271804507794e-01   +4.817673422234082e-01   +4.329736400665018e-01   +4.237472616732723e-01   +1.537304362772828e-01   +3.943415088372685e-01; +2.455837098856867e-01   +1.458073657750786e-01   +9.360335255745750e-02   +3.266154072670128e-01   +3.201353798244358e-01   +4.157202255629600e-02   +7.457373565858851e-02   +3.081924086819189e-01; +3.987072296520934e-01   +1.200642697310950e-01   +5.649267925609659e-02   +1.479491433912951e-01   +5.121100546323977e-01   +4.188518245823819e-01   +1.114612795903119e-01   +2.358193562149402e-02; +3.762710482116150e-01   +2.750234009218200e-01   +3.000905282001695e-01   +2.618545007899712e-02   +2.373390769013489e-01   +4.266453591603837e-01   +5.121659773225669e-01   +2.377183400923090e-02; +2.375088676321983e-01   +3.835686972002381e-01   +3.974848625148646e-01   +1.245428405927123e-01   +2.902003790943157e-01   +2.930874363514516e-01   +2.894854507330901e-01   +3.718833157373242e-01; +1.509203334032991e-01   +2.378214782323374e-01   +3.136263987216730e-01   +4.508558818206699e-02   +3.253974313061535e-01   +1.410502599719330e-01   +2.054791382243059e-01   +4.696334636959699e-01; +1.369851711100553e-01   +3.229761696178710e-01   +2.953009035573835e-01   +1.846841865664219e-01   +1.240334235333633e-01   +2.719085946719956e-01   +3.280250367174559e-01   +2.242063958966263e-01; +2.192314043378737e-01   +1.257942923260286e-01   +4.396327290441586e-01   +4.338679423856016e-01   +2.396378641878150e-01   +2.375699126679937e-01   +5.089932355738604e-01   +1.692568543782152e-01; +1.167568261502400e-01   +2.334510292909008e-01   +2.489466815367114e-01   +4.726168891834359e-01   +1.383083056972924e-01   +2.779373001868296e-01   +2.144136164538196e-01   +1.978792963887308e-01];
L2I_L3I_iGABA_netcon = [+2.107079325420409e-01   +8.637915362473114e-02   +5.072277048939392e-01   +3.318265019923870e-01   +2.946847160081940e-01   +4.139038587388766e-01   +3.331978295654706e-01   +4.251769194831641e-01; +1.168952206905875e-01   +3.739853472568861e-01   +4.752100058741519e-01   +2.968621709074679e-01   +4.943782558921029e-01   +2.368842531329735e-01   +3.269974900275187e-01   +3.808712375058980e-01; +1.450025231222691e-01   +5.243295809247963e-02   +1.534001967336394e-01   +1.090071468888626e-01   +2.322134701199575e-02   +1.282851252399415e-01   +3.715765125037375e-01   +2.532430731126762e-01; +2.766236722450445e-01   +3.846981516866328e-01   +4.934304969465271e-02   +1.457256686279111e-01   +4.376746077581977e-02   +4.666891769828096e-01   +4.204454312913166e-01   +4.972463409636357e-01; +4.170717258229209e-01   +4.179088911757102e-01   +4.492506772007982e-01   +4.276781803267138e-01   +4.928912228330732e-01   +1.940865097487918e-02   +3.655933970551526e-01   +3.845396388412383e-01; +2.405071706314602e-01   +2.224192385155303e-02   +7.623339630629167e-02   +2.432472469865541e-01   +1.453684245258345e-01   +2.404372919882433e-01   +2.815894009649842e-02   +3.944733498610998e-01; +3.380680589505497e-02   +3.291492580784302e-01   +1.679284518779983e-01   +5.021502124165146e-01   +4.414595767454842e-01   +2.299919993860742e-01   +4.065023084930405e-01   +4.902063920217461e-01; +2.636890271643524e-02   +7.986500043257615e-02   +2.357361500695815e-01   +2.572192886613653e-01   +7.199565755592965e-03   +4.834640087795366e-01   +2.432618220678152e-02   +3.776638866706949e-02; +1.500667398507395e-01   +2.207088429972342e-01   +2.757565839443494e-01   +4.159824995199655e-02   +4.446501259048236e-01   +3.047572892883200e-02   +2.509309889602860e-01   +2.012858356460517e-01; +3.197160632777208e-01   +4.662134081474760e-03   +3.882628101256748e-01   +3.597140137327483e-01   +2.038888359435591e-01   +4.248910341874943e-01   +5.699565213921810e-02   +2.000177316294463e-01; +5.111227124262302e-01   +1.351652261469247e-01   +3.983789224882739e-01   +3.159788512262914e-01   +2.035243338923160e-01   +2.362462126503425e-01   +3.280013562920233e-01   +2.347847400763607e-01; +4.678481618425983e-01   +1.859593131560284e-01   +3.873886475949383e-01   +1.849694557938420e-01   +2.288917400369292e-01   +3.346843536063322e-01   +3.339496997720547e-02   +2.932048464409153e-01];
L3I_L3E_iAMPA_netcon = [+1.896522490219238e-01   +1.129107836398060e-01   +2.776146946761818e-01   +7.188958792694092e-02   +2.860873977974178e-01   +2.802930686497121e-01   +3.094131125865405e-01   +4.804259114861629e-01   +1.475257314899988e-01   +2.334731911648870e-01   +1.879905763207310e-02   +3.744668474792532e-01; +3.529342117729652e-01   +2.371368113494051e-01   +1.033079454541800e-01   +2.102647340179576e-01   +3.696890488521445e-01   +3.085601079024496e-02   +1.204660255213395e-01   +2.194148840393403e-01   +4.589646714586977e-01   +3.268360498456491e-01   +1.356151061721105e-01   +4.529013783848557e-01; +9.585950321720003e-02   +2.727711220933982e-02   +1.378884352696155e-01   +2.378734103556712e-01   +1.491155945281028e-01   +5.904667918995189e-02   +1.255460940807762e-01   +4.580016147702203e-01   +9.049321038273386e-02   +1.309990189833421e-01   +3.789708481823478e-01   +4.584845924310658e-01; +3.737264569182139e-01   +3.673842585132522e-01   +1.424929425908588e-01   +5.028486230315361e-01   +3.178004895314845e-01   +3.434275758379343e-01   +4.184687660599460e-01   +1.433844866577469e-01   +2.833913388908772e-02   +4.399833757292028e-01   +6.489262268077571e-02   +1.492230264936815e-01; +7.184599009695607e-02   +3.083058854520424e-01   +1.511017106517217e-01   +7.322712527005022e-02   +8.057384996261678e-02   +2.862059530351294e-01   +3.293342423551345e-01   +2.045463481942482e-01   +2.476501637138611e-01   +2.195056061169416e-01   +2.733864999672604e-01   +3.427466684306459e-01; +2.777553973448752e-01   +3.275073529015887e-01   +1.295241987999269e-01   +2.370610955762597e-01   +3.046654519740397e-01   +1.354998639704113e-01   +3.214292381499303e-01   +4.508659349688475e-01   +4.583216364740114e-01   +4.650208323790920e-04   +7.272883543523555e-02   +5.746675195905943e-02; +4.314836146931134e-01   +3.787575149260573e-01   +6.594195431560497e-02   +3.042921199980602e-01   +3.559143970255748e-01   +2.720057420066078e-01   +4.457879428351058e-01   +4.915394325274145e-01   +4.880015562812394e-01   +1.231744566367647e-01   +4.314280105303735e-01   +4.463772776321062e-01; +1.499880801650189e-01   +4.299194674381179e-02   +8.085072949460650e-02   +3.336337862312180e-02   +4.215317676591537e-01   +3.844962941226273e-01   +2.605837691867230e-01   +1.496785750237683e-01   +3.219143625147572e-01   +2.564119217705692e-02   +1.946302036323213e-01   +1.277087746071799e-01; +2.790396558218984e-01   +4.635837713205170e-02   +2.689908847846813e-02   +3.619099532802399e-01   +1.139097013248111e-01   +4.748658400603639e-01   +6.721801210683448e-03   +2.998940526560280e-01   +3.573952624020589e-01   +3.444268306354269e-01   +1.912003142850650e-01   +3.200459392918907e-01; +2.353915397281275e-01   +3.475869156130091e-01   +3.096404516208012e-01   +4.975375449606501e-01   +4.518191062199964e-01   +1.369503738481019e-01   +2.847848073985864e-01   +2.991307388137527e-01   +8.522701056820819e-02   +3.070522326081734e-01   +2.244352535054391e-01   +1.016020076021055e-01; +4.493807362182733e-02   +4.170882882312992e-01   +6.828525243124114e-02   +2.688731079268965e-02   +4.071998348040944e-01   +5.101366524538383e-01   +2.978794311680988e-01   +3.428488996433340e-01   +2.724216732834220e-01   +7.275955812310043e-02   +3.409490092501445e-01   +4.540758413630185e-02; +1.173016408944603e-01   +3.261879960254475e-01   +1.104753032336418e-01   +4.172422975142647e-01   +4.442585733590900e-01   +1.648681896885488e-01   +1.409474698744509e-01   +3.063966965119795e-01   +2.549527979634826e-02   +1.466532985317306e-01   +2.825307241359470e-01   +1.203854817415455e-01];
L3E_L3I_iGABA_netcon = [+4.208489623453177e-01   +2.975611553773830e-01   +1.176039391948882e-01   +2.819623729009522e-01   +2.744403625249347e-01   +6.778507126951877e-02   +2.774852198849680e-01   +4.034313582618380e-01   +2.927903662634659e-01   +1.008029757682302e-01   +1.141818040910308e-01   +3.611916159419321e-02; +3.244557422323002e-01   +7.804805001039486e-02   +1.668963246604873e-01   +4.520136841566491e-01   +2.051018541322496e-01   +4.505490602909977e-01   +3.716017765099848e-01   +3.868641674071341e-01   +1.473140211478549e-01   +2.123339819023407e-01   +2.366791128422846e-01   +2.475631148376698e-01; +1.128815338764538e-01   +1.477388067234603e-01   +5.027468276899029e-01   +3.867604042122860e-01   +4.139004452070384e-01   +1.162081734503606e-01   +2.456883196550503e-01   +4.308183620016416e-01   +4.012051259992186e-01   +2.491670128768597e-01   +5.840955810414844e-02   +1.118049239469119e-01; +1.423302140328526e-01   +2.008010361324490e-01   +4.539729406008710e-01   +3.793369145655084e-01   +1.012111060689557e-01   +3.968198163615074e-01   +1.634707377777243e-01   +2.938044648214364e-01   +8.577621321458045e-03   +4.726947322258824e-01   +4.963995749393704e-01   +1.880200834073961e-01; +3.910159697552497e-01   +2.226331905052477e-01   +3.890158570774104e-01   +1.342262339114549e-01   +3.212435064786925e-01   +1.427047428997743e-01   +4.922327871258766e-01   +1.832733824398050e-01   +3.981758004795873e-01   +2.575894535243785e-01   +2.098649211566823e-01   +2.374278963956245e-01; +4.754687209060385e-01   +2.009954106360169e-01   +2.973133695731934e-01   +7.254127692954997e-02   +4.101653960430702e-01   +4.991592812695748e-02   +4.241505380378415e-01   +1.476221243804119e-01   +7.138700167458090e-03   +1.364290920387602e-01   +3.923360681358815e-01   +1.237650339518757e-01; +3.182426928338613e-01   +3.738690961001392e-01   +1.849138342029144e-01   +1.140088649764619e-01   +9.114745779022497e-02   +4.992850568622388e-01   +6.949282405502810e-02   +4.690427445752526e-01   +3.209220633548048e-01   +3.774688281269871e-01   +1.740935014732259e-01   +1.353946739970001e-01; +1.310286905829979e-01   +2.433828573667659e-01   +3.581932088755319e-03   +4.631038735956551e-01   +9.420913117162381e-02   +2.000609283639795e-01   +1.258386158659489e-02   +7.952905898989533e-02   +3.833292967701007e-01   +3.833470097896781e-01   +2.492567531273029e-01   +2.370726630553763e-01; +3.966212756970606e-01   +1.016194416503706e-01   +4.122712396167286e-02   +3.481588441276078e-01   +2.332813242230442e-01   +4.921111229062614e-02   +2.994215837083437e-01   +1.686919675058363e-01   +4.562283079487773e-01   +4.417253044472493e-01   +1.164958460102866e-01   +5.035909010215470e-01; +2.864135905968153e-01   +4.842252162304616e-01   +5.091351709841678e-01   +3.752528694294650e-01   +8.787114634244607e-02   +4.285829969736938e-01   +2.074043216464153e-01   +1.469682239088450e-01   +2.888969283656250e-01   +3.791287441732186e-02   +3.308565454556548e-01   +4.853955230467534e-01; +6.135584158983594e-02   +2.520846727576788e-01   +4.523982625098967e-01   +3.219399426210866e-02   +2.720471514596836e-01   +4.310518807661955e-01   +3.399943262479727e-01   +1.387356052312539e-01   +1.353906936153115e-01   +2.371463059177135e-01   +4.036833999911257e-01   +4.622644161949963e-01; +3.745053918127318e-01   +6.114919624814789e-02   +3.413297653176572e-01   +3.967961720244048e-01   +4.468923375825305e-01   +8.514974633313097e-02   +3.659855235187764e-01   +4.013889816895668e-01   +2.301836696607236e-01   +3.952791709688002e-01   +1.782579322613684e-01   +2.468993112828920e-02];
L2E_Input1_iAMPA_netcon = [+3.397700916105087e-01   +2.251139228332806e-02   +7.436615294876775e-02   +4.680946296013212e-01   +1.058399458683674e-01   +4.519792348569822e-01   +4.255710236790784e-01   +2.622796424113094e-01];
L2I_Input2_iAMPA_netcon = [+4.548254307034215e-01   +1.005701495034940e-01   +5.008812199276007e-01   +4.522672023846533e-01   +3.433684658280874e-01   +4.562803639427016e-01   +1.871615786372234e-01   +3.923357168326223e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
