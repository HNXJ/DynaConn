function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.305576011188791e-01   +2.131174448869512e-01   +5.446766850022497e-01   -4.172119977707317e-01   +1.362190289964584e-01   +5.132548292405616e-01   +2.689195033510616e-02   +4.921643305114530e-01   +1.303570047904626e-01   +4.360471155189128e-01   +1.217952056268823e-01   +1.045824986562554e-01   +4.176793877960443e-01   +3.113441145077298e-02   +6.306659389364896e-01   +7.994776045617772e-01; +1.747346046245974e-01   +4.241675928712385e-02   +5.324976316100383e-01   +4.553337589112452e-02   +6.611984377233320e-01   +2.680258893492091e-01   -1.240151497726115e-01   +1.325728291663858e-03   +2.437966049006683e-01   +3.644271967500680e-01   +5.983494285456431e-01   +9.273063893782317e-02   +3.884240939705821e-01   +1.154870433205943e-01   +3.023306305826090e-01   +2.343110177081633e-01; +3.499434178082809e-01   +7.172753420765339e-01   +2.594090781097796e-02   +2.709037707721296e-01   -8.665161237267149e-02   +3.289656634319654e-01   +5.524214183028586e-01   +1.738839115722121e-01   -2.493631529266062e-02   +5.761841991763464e-01   +5.218452822070416e-01   +3.674593804536224e-01   +4.849111019290474e-01   +1.547718448982116e-01   +5.238164835316036e-01   +3.904847115452464e-01; +6.079391212785669e-01   +2.477988309013654e-01   +6.638949818843610e-01   -2.443543459468490e-01   +3.877559157544489e-01   +4.599024907803330e-01   +1.961868471177786e-01   +1.234132205097694e-01   +3.645072192524741e-01   +1.523716983741325e-01   -3.533187323685803e-01   +5.273170403348281e-01   -1.827872126029656e-01   +1.771742502511294e-01   +2.647885871313347e-01   -3.525032660978930e-01; +1.529913773123517e-03   +4.510158001645307e-01   +2.051542060441980e-01   +4.561213551582570e-01   -4.506394605034088e-01   -3.554261896519470e-02   -3.929017054723839e-01   +6.236699560087661e-02   -1.152014624350841e-01   -6.257234823776328e-02   -3.026005473382365e-01   -1.450225438598245e-01   -2.186196583948812e-02   +7.856211164573609e-01   -9.182845038588675e-02   +1.467711667141422e-01; +4.865792702075003e-01   +4.357035479817022e-01   +4.244401926336439e-01   +2.196852990933919e-01   +1.399186849998908e-01   +6.040874843469364e-01   +3.925385221668199e-01   -2.092530870924521e-01   -8.659043000040600e-02   -1.538592940724671e-01   +7.516674160017461e-01   +5.008953754508013e-01   -2.902025410923594e-01   +6.601304652363396e-01   +7.335188331221622e-03   +1.764371908583556e-01; -4.376269927400023e-01   +4.834515176945312e-01   -6.128150549746098e-02   +3.216421530421533e-01   +8.618003096324482e-02   -1.077923388883140e-01   -1.762802929751144e-01   +3.572571729583209e-01   +5.263153063746487e-01   +3.011332789411909e-01   -3.188896245332251e-03   -1.160614857073628e-01   +4.806817508600104e-01   -5.269068597988910e-01   +1.484035302003180e-01   +4.784955380052968e-01; +6.100488920155280e-01   +3.476031778861466e-01   +2.374289840449266e-01   +6.531720798567098e-02   -8.589566868908741e-02   +7.311285457249557e-01   -2.348351779247684e-01   +9.898769309728682e-02   +3.935385718075916e-01   +2.557415593354400e-01   -8.009738969402644e-02   +1.853167300489023e-01   -1.041612926270406e-01   +1.127614415395740e-02   +5.882490555180145e-01   +8.602748464124532e-02; +2.057838032446270e-01   +2.035553517557597e-01   +6.088229520574805e-01   -4.499737448755234e-02   -3.448626163633505e-01   -1.854609593617516e-01   -1.706707609672177e-01   +1.821354774145696e-01   -4.108657941566116e-01   +2.348914386308408e-01   +4.478792400961528e-01   -3.933680032664014e-02   +2.677122938118928e-01   -1.765497673149967e-01   -9.338143843223429e-03   +2.332596051653396e-01; -2.246581988467084e-01   +1.199296820164784e-01   +2.323660815054489e-02   +3.727360072155492e-01   -3.826077446472176e-01   +6.215239226060507e-01   +4.963276558870020e-01   +3.036534752509626e-01   +2.327940187235862e-01   -3.551748424634951e-02   -2.826607009231683e-02   +6.236897241361796e-01   +2.546265415833085e-02   +1.449016063067708e-01   +1.632461666188099e-01   +7.379599609400339e-02; +2.762544956857817e-02   -1.205527916605659e-02   +1.265738065225563e-03   +4.144575766962257e-01   +7.696702513427411e-02   +2.189924042135105e-01   +2.982992713739321e-01   +2.091358712545229e-01   -2.847891173123346e-02   -3.427418731743145e-02   +2.817742312113514e-01   +1.563790954718204e-01   +3.410996810312458e-01   +6.591009831069090e-01   +3.535429625417223e-01   +5.512989758379526e-01; +6.596616747513687e-01   -2.495889934614383e-01   +1.618930300413343e-01   +6.073402369477651e-02   -6.318811036667421e-02   +2.511074865718985e-01   +3.513718456094676e-01   +2.663575420445664e-01   +2.593730044389400e-01   +2.607880151803740e-01   +4.189564950554898e-01   +3.497503392862671e-01   -8.802941320429648e-02   -3.463557953163443e-03   +4.967255347366676e-01   +2.299053976099975e-01; +3.739654227570490e-01   -5.727849482276487e-02   -8.253714528822761e-02   -3.506234035035711e-01   -2.839398050027781e-01   +4.522741879354212e-01   +3.386613931019353e-02   +2.282532789700630e-01   -1.932138139081312e-02   +3.854786315286831e-02   -3.355262265059097e-01   +3.989505519992476e-01   +3.376080138741421e-01   +7.731215501708393e-01   -6.830481015804220e-02   +8.133857552646189e-01; -3.206035472127136e-01   -1.204689694138156e-01   -1.502721041600138e-01   +1.908718638262518e-01   +6.572284993322893e-01   +2.904447871814316e-01   +9.054036193181014e-02   -1.324463120587151e-01   +7.941829987041406e-02   -9.662103369032904e-02   +3.716264392596812e-01   +2.827055582130473e-01   +5.524107905703224e-01   +8.940525669057596e-02   -3.736119948912404e-01   -2.047095977138726e-01; +3.381086291388972e-01   +4.728823763306576e-01   -4.611321330112680e-02   +3.409698279839756e-01   +2.820506107225997e-01   +1.712583490144966e-01   +2.813583075190011e-01   -2.446056419428602e-01   +2.284415790648976e-01   -7.791834335551379e-02   +2.474306133784241e-01   +1.300789830233582e-01   +3.233580659763539e-01   +3.648811994993330e-01   -4.658846204338623e-01   +3.485017445055890e-01; +1.672750254074986e-01   +4.005981380450107e-01   +4.323554782213833e-01   +3.480226494157722e-01   -2.349122885485588e-01   +3.772258147096827e-01   +1.330552015656039e-01   +3.933242002353053e-01   -4.794637774796290e-02   -1.918799837588341e-01   +4.182784979907330e-01   +2.133051914193013e-01   +6.653092375498699e-01   +5.493799531731718e-01   +6.345589999570050e-03   +6.606058240076984e-02];
L1E_L1I_iGABA_netcon = [+5.302392721432563e-01   -5.208463260697693e-01   -6.860509668287174e-02   -2.389638813408604e-02   +5.985297565626827e-01   +5.632564212597706e-01   -2.199422830483072e-02   -3.584037393921217e-01   +2.080753072908532e-01   +3.010060094228939e-01   +1.876329162700589e-01   -1.417233448843019e-01   -9.354557771893338e-02   +2.059862948475658e-02   -1.638830141665862e-01   +9.080504524046362e-02; +3.528343661587471e-01   +1.138286037030411e-01   -1.359693772921652e-02   -1.464161475887496e-02   +3.288663457120901e-01   +3.268381249808129e-01   +4.536581797713671e-01   +3.590668024406355e-01   -3.562751197274602e-02   +1.439625437457590e-01   +1.877894954470007e-01   +3.372660958470960e-01   +2.036238697313798e-01   +1.114863769526259e-01   +1.912927755981425e-01   +2.829161277723169e-01; +6.806797595869948e-02   +6.263671211325593e-01   -3.269044361594368e-02   +2.321375027159491e-02   -4.162070075581883e-01   -9.588992672075192e-02   -2.257495021169378e-01   +5.262706807992457e-01   +4.528570075502619e-01   +6.641688509608907e-01   +2.698468683760112e-01   -1.211640153856516e-01   -4.755022520641123e-01   +1.108051025080381e-01   -4.748221492400604e-02   +4.243310120887719e-01; +6.448135746040365e-01   +4.133977770695438e-01   -2.669310342895343e-01   -8.190381238730202e-02   -1.614872251348415e-01   +4.118342919371798e-03   +1.167442838430311e-01   +3.044657755212838e-01   +1.019571301197494e-01   -1.987553642995682e-02   +7.694787352332344e-02   +1.873109794834995e-01   +1.149043711677940e-01   -1.549006021055651e-01   -4.306179258164299e-01   +6.109689245670954e-02; -1.116142847708853e-01   +2.582673675937033e-01   +7.375719569209462e-01   +6.111302673409398e-01   +5.199856816457689e-01   +4.816328557349867e-01   -2.048086633026339e-02   -1.037597014872987e-01   +4.336242155979064e-02   +2.818323527826884e-01   +5.799992588542666e-01   -2.102294712899055e-02   +2.573809246588290e-01   -2.723608402640476e-01   -1.492338289600202e-01   +5.181073568329075e-02; -8.561543248329509e-02   -1.594355601016200e-01   +2.915642400457384e-01   +5.570423181060705e-01   +6.618515280161026e-01   +4.491469856817721e-01   +7.842802009203553e-01   +2.791972208006435e-01   +2.626365354152917e-01   +9.521495934530026e-02   +4.724894263016145e-01   +6.707114503189329e-01   -5.171911632409579e-01   +4.023463513260073e-02   -5.039464487390496e-02   -5.045734063067175e-01; +6.423209800231879e-01   +1.020339306127431e-01   +2.334353033736841e-01   -4.391361554249004e-01   +3.446301852939598e-01   +2.456814483776806e-01   +4.788330083473518e-01   +5.333050474812090e-01   +3.787067685968198e-01   +2.597400400583656e-01   +4.718968334096303e-01   -6.893635536467935e-04   -2.861747739605072e-01   +2.287717280891024e-01   +1.267794846579814e-01   +3.125738711458582e-01; -6.470213632147685e-02   +5.769780238226943e-01   -1.185744518788083e-01   -2.687041116615546e-01   -4.454620472561598e-02   +1.498663920746319e-01   -4.777597555983676e-02   +2.287534913547868e-01   -3.262131256429311e-01   +2.427663134397576e-02   +7.424931897180582e-01   +1.019367713740103e-01   -1.566715655359212e-01   -1.649008831328489e-01   +3.713315502727845e-01   -2.368387256675349e-02; +2.925167930933471e-01   +1.642349160502626e-01   +3.844160918811228e-01   +1.942039442819834e-01   +3.446984825172353e-01   +2.130479511449625e-01   +7.922384607610017e-01   +1.742960327822295e-02   +1.776346661779130e-01   +2.605304981437609e-01   -3.152543253747703e-01   -4.342317103150272e-01   -1.023514554541052e-02   +2.872578342904888e-01   -8.952065737984860e-02   +2.433966938849430e-02; +4.175963619795605e-01   +3.138258930012400e-02   +1.189641462805384e-01   +8.383906054065791e-02   +2.600897766031978e-01   +4.313478299731625e-01   +2.535591875664977e-01   +3.228529710615771e-01   +2.826248642848854e-01   +3.684428594617193e-01   -7.252720319449257e-02   +2.651037787292651e-01   -5.820418126605150e-02   +5.895842127869378e-01   +2.677724405098242e-01   +2.573702660443801e-01; -5.542708833410619e-02   -1.838239015479564e-01   +4.897106955450312e-01   +1.025593721538504e-01   +2.729652610125375e-01   -2.345897701200687e-01   +5.880642228392780e-02   -4.278618667434524e-01   +2.010285882218808e-01   -7.712879392261264e-02   +5.050707343106012e-01   +2.354774197969852e-01   +3.609122963581344e-01   -8.983107627043840e-02   +2.866102291487674e-01   +7.114992978389880e-01; +1.303303567381165e-01   +3.144249251306734e-01   +1.451241579706842e-01   +1.369768447700916e-01   +4.373678515324742e-01   +2.823099123237576e-01   +1.901174983064634e-01   +3.378542739837368e-01   +1.603585756903928e-01   -3.068755335012639e-01   +3.857947288487668e-02   +4.336709717802649e-01   +1.938255563686584e-01   -2.803009441426700e-01   +1.035460020280924e-01   +6.242103550794873e-01; +4.791694141778610e-01   +8.336909536933698e-02   +6.579484857643210e-01   +1.920470771603603e-01   -1.515947434823692e-01   +5.849081543567427e-01   -1.159318279413494e-01   +6.051357221294720e-02   +4.615718367654068e-01   +3.626799502189069e-01   -2.030466749857978e-01   +7.131408736205318e-02   -6.321830688059774e-02   +1.013943564146202e-01   +2.549898359834449e-01   -2.189652577402132e-01; +1.102898767092755e-01   +1.301242287068873e-01   +5.132129007478774e-01   +3.456670715014946e-01   +6.108590447295668e-01   -4.842096693187572e-01   +3.325815171720981e-02   -7.261171596225005e-02   -2.946745601503739e-01   +1.674083009715154e-01   +4.324719946189161e-01   +4.952731655394027e-01   +3.653153579860244e-01   +5.702603314729757e-01   -1.539569586525097e-03   -6.610593997672924e-02; +3.331175844003955e-01   -1.163421164718604e-01   -1.193941902633103e-01   +2.889043454203266e-01   +4.186973292130965e-01   -3.940398922299147e-01   +2.004576079515950e-01   -2.406349368994122e-01   +2.441213660699189e-01   -6.743074181824693e-02   +2.693122260479372e-02   +2.589620606681576e-01   -2.710783509601374e-01   +2.463674974669735e-01   +6.884699250529818e-01   -4.898520297647771e-02; +9.893010545629839e-02   +3.235988259450579e-01   +3.853374843269960e-02   -1.285900041210614e-01   +1.887526460860435e-01   -2.244613624272259e-01   +4.314019303916328e-01   +2.271702403933596e-01   -3.613675447322809e-02   +6.697748846923046e-01   +4.012005704836263e-01   +6.478080162346109e-02   +2.380003518810618e-01   +7.899634358307012e-01   +1.871225602097286e-01   +5.603048593522191e-01];
L2I_L1I_iGABA_netcon = [-4.075304709519161e-01   +2.947777284493381e-01   +6.067501779282813e-01   +4.228463933658393e-01   -1.754805615718133e-01   -1.931901579751594e-03   +3.885160592257977e-01   +1.068311415246265e-02; +2.642010293519356e-01   +3.121681291233335e-01   +4.414118452963874e-01   +5.585715293001818e-01   +3.777958195267741e-01   -7.235613244428254e-02   +5.710105269548494e-01   -2.286775127164382e-01; -1.059932691899760e-01   +1.524085211834025e-01   +6.726485901166406e-01   +2.537682078702471e-01   +2.143123863216496e-01   +3.396879481088752e-01   -4.058330294514084e-01   +7.594114419380363e-02; +4.056678945005934e-01   +1.507523915965233e-01   +7.558778714483355e-02   +5.919639643770608e-01   +3.393473366461708e-01   +3.585068527614733e-01   +5.917894090025799e-01   -6.304795480831635e-02; +3.230366536853124e-01   -6.112771062525990e-02   +2.826066977836389e-01   +3.995598606329347e-01   +6.963298885342237e-01   -3.088296451431377e-01   +7.329019339222691e-01   +3.116264672400243e-01; -1.622212964102800e-01   -2.035042531367590e-01   +1.868524361833469e-01   +1.387704629719588e-01   +5.286974201248913e-01   +3.868645199154949e-01   +7.881707794749634e-02   +3.324572787962408e-01; +1.970179175641984e-01   +2.501918378475735e-01   +4.364761349660863e-01   +3.162892670371959e-01   -3.816111801119592e-01   +1.230838971446884e-01   +1.953977261405779e-01   +1.992746562021895e-01; +4.521501046706307e-01   +5.512580471075710e-01   -7.860088978636262e-02   +2.308818344309591e-01   +3.376907317253730e-02   +6.927271436271312e-01   +5.625437187636428e-02   +3.492977867077945e-01; -1.861567558252412e-01   +3.374767339042618e-01   +7.543672196748351e-02   +2.181595960963484e-02   +1.673469937573661e-02   +3.041864972131194e-01   +6.340153648094694e-01   +4.728817760665251e-01; +2.193236528682136e-01   +1.436196534418701e-01   +8.597137224010590e-01   +1.431828623662991e-01   +4.114307359557690e-01   +5.658275484019732e-01   -3.008165955290163e-01   +2.437998882040309e-01; +6.258246093410067e-01   +4.173601130714156e-01   -1.135822244731337e-02   -3.549178124172617e-01   +3.031978790067382e-01   +1.319654549117709e-01   +2.561892730900667e-01   -1.966490252008054e-01; +2.733518133638865e-02   -2.729681182326427e-01   +1.409281089945306e-01   -9.653061999649648e-02   -3.840882862513245e-01   +1.375989339131800e-01   +5.868678467098172e-01   +3.494241514846250e-01; +1.184281024098005e-01   +2.771493912306310e-01   +1.643523875961234e-01   +1.180472455561309e-01   +3.460159636555512e-01   +1.262674370801378e-01   -1.391213739152380e-03   +4.415081636077411e-01; +5.859133507147132e-01   +6.101006939351874e-01   +8.238414425313402e-01   -4.445155393196450e-01   +1.089091718571952e-01   +1.459587884643800e-01   +6.499605236399777e-01   -2.038112836428681e-01; +4.205401787509597e-01   +3.960518143129564e-01   +1.482584611276374e-01   +3.894960820407858e-01   +2.620381563027107e-02   -2.228533773375416e-01   +2.174465217710450e-01   +5.266539664944364e-02; +5.580906681896487e-01   -1.288548793438881e-01   +2.541828636715566e-01   +4.032045422220595e-01   +1.415920068506957e-01   +6.091221143646991e-01   +3.423822693201790e-01   +2.370429858602306e-01];
L1I_L2I_iGABA_netcon = [+2.317982642208508e-01   -2.071307511052854e-02   -3.902753327358751e-01   +4.098212863520785e-01   +2.995181188628283e-01   +1.040038039798732e-01   -3.908330486037628e-01   +2.413322142103354e-01   +1.446493054078459e-01   -5.940803305425439e-01   +1.315960322054259e-01   -1.569807913289786e-01   -1.129831616444751e-01   +5.064086263953055e-01   +1.596062313908884e-01   +1.449109590390025e-01; +4.302782917771136e-01   +5.310095979832212e-01   +2.457123817965159e-01   +3.632812491014551e-01   +2.556764118956698e-01   -4.197682100399541e-02   +6.913173135502830e-02   +5.196490613563541e-01   +4.943056675461727e-01   +1.274482915463480e-01   +5.101533523939145e-01   +2.998476600445412e-01   -1.433070588822737e-01   +5.076958841485356e-02   +3.643175470928752e-01   +2.420470918713479e-01; +5.755926213228413e-02   +4.720251423708025e-01   +2.410874719141674e-01   +3.879616651220407e-01   +3.563098701439569e-01   +5.461405118720475e-01   -1.076636495694561e-02   -3.325951088923301e-02   +1.664131226989006e-01   +2.879886192423587e-01   +3.296565080137296e-01   -2.785167852225937e-01   -2.616109050242479e-01   -9.439287008256630e-02   +4.971710153424231e-01   -2.946517175154144e-01; +3.177926354382847e-01   +4.898458147933039e-01   +5.367789850300959e-01   +6.723928698935326e-01   +8.946699083726514e-03   +2.376965901969852e-02   +5.713743104123477e-01   +5.183134501941105e-01   +7.447401094668674e-02   +4.990630558849379e-03   -1.786642827928860e-01   +8.854986071968314e-02   +4.311124772364204e-01   +5.611445470525409e-02   +1.998880638386850e-01   -7.908578410330100e-02; +1.199177793009862e-01   +2.024715477883297e-01   +7.267849231299855e-02   +4.455456613118044e-01   +7.734188202805986e-01   +2.613010995824472e-01   -3.365953616565363e-01   +1.453435072246762e-01   +1.471390449671872e-01   +7.180861476041991e-01   +2.790807909208394e-01   +1.900584665992418e-01   +5.388681650797732e-01   +5.019640019532838e-01   +7.137682139475936e-01   -4.116247409216159e-02; -1.459017948383556e-01   +1.848380429419027e-01   +5.275890696825968e-01   +6.166483575312671e-01   +3.491028627997603e-01   +6.785838518887556e-01   +2.514978815920974e-01   +3.674284091596025e-01   -6.664432010549859e-01   +4.798213852343797e-02   +1.915168016164777e-01   -1.958900391334320e-01   +7.933533542716975e-02   +3.531784898427067e-01   +5.250794456471302e-01   -4.836127027134440e-02; +3.180133268110547e-01   +4.843171194011414e-01   +1.087830703529613e-01   +1.274917157184223e-01   +8.404013135265860e-01   -1.245033272187950e-01   +2.215789114005915e-01   +4.306950318387495e-01   +3.355731625387869e-01   +8.714681437399366e-02   +1.562650179705288e-01   -3.892903271936307e-02   +4.526350214281827e-01   -7.190053441687577e-02   +5.327910308493240e-01   -5.256799836584775e-02; -1.934351291213740e-02   +1.513144579723243e-02   +6.062665649841740e-01   -9.011847200008805e-02   +9.003871868033794e-02   +2.741207249191637e-01   -5.411087775877116e-02   -9.294718380837325e-02   +1.599377762857164e-01   +3.207325606908373e-02   +9.193620414555287e-02   +3.513186703453856e-01   +2.633426398972887e-01   +2.423016629753418e-01   +6.013408489378274e-01   +2.329488492243520e-02];
L2E_L1E_iAMPA_netcon = [+7.040405689215889e-02   +1.222166145673000e-01   +2.944646483672374e-01   -7.507349930677043e-02   +1.852630012787023e-01   +1.339253195993144e-01   -7.045352288852447e-03   +8.241786427335998e-01; -3.819191758157032e-01   +2.096799324576406e-02   +7.464088992159004e-01   +8.438634370995990e-02   -2.574669256912291e-01   +8.658908094170574e-01   +3.486494893351262e-01   +1.295153755864345e-01; +7.693449281979043e-01   -2.178657128277074e-01   +3.168390650247805e-01   -6.165274787033217e-02   +1.977377158616927e-01   -1.285937391335902e-02   +3.621666666042266e-01   +1.889704326226931e-01; +2.205842559547644e-03   +4.327477405223603e-01   -3.468743719022544e-01   -1.203384717136123e-01   -3.330255142023515e-01   +5.790790921162558e-02   +4.839543346240480e-02   +2.388179675320528e-01; +5.864568305296114e-01   +4.693715393751604e-01   +2.963315832844255e-01   +3.638952199362310e-01   +1.728599263612330e-01   +4.656892492123867e-01   +2.908393088702389e-01   +3.567047126919097e-01; +4.552391209963036e-02   +2.662679084943705e-01   +6.156633188090590e-01   +5.225637692249752e-02   +1.294706712871710e-01   +7.887903281905086e-01   -1.255140014522139e-01   +3.268052318817049e-01; +1.943116734311398e-01   +7.189908371025334e-01   -7.229918219999690e-02   +1.660916581767185e-01   +1.087197205188688e-01   -1.037767927730637e-02   -3.302150419225924e-01   +4.562593775436535e-01; +4.615726139937622e-01   +7.299972649114383e-02   +5.387258399744949e-01   +2.517184863587073e-01   +3.247478665789492e-01   -3.066805953068265e-01   +2.458638370359162e-01   -3.928578969913321e-02; +7.504454456814505e-02   +3.073908231062681e-01   +3.515934602603789e-01   +6.219888585185386e-01   -1.638436809075146e-01   +7.218844495904613e-01   +2.047002957947321e-01   +2.483582562418031e-02; -3.806549917040974e-02   +2.924822585514160e-01   +3.641414631542235e-01   +6.903647235608921e-01   -2.432966719128875e-02   +1.880153925495807e-01   +2.700879648832262e-01   -5.962683562361829e-02; -3.175160318222051e-01   +2.589351026826490e-01   +1.187901876699294e-01   +4.375696791811391e-01   +2.169852580412662e-01   +2.631293972091937e-01   -1.261855373488994e-01   -3.330858774919161e-02; +3.652477413335411e-01   +1.235810522769111e-01   -1.314789895233245e-01   +4.034541329128774e-01   +3.053223062850834e-01   +2.807735618434261e-01   +4.189817419659409e-01   +2.251844216834300e-01; +7.608707054719708e-01   +3.132314734048859e-01   +5.835858988981970e-01   -1.073643414630421e-01   +4.504243399834172e-01   -1.826462374724693e-01   +3.716587803559577e-01   -2.211721537223699e-01; -1.368524132484120e-02   +3.278984818563684e-01   -3.361013822762621e-02   +2.303375087330035e-01   -1.592170566374266e-01   +5.823539741571124e-01   +7.817842257995117e-02   +1.140776121968317e-01; +4.993004559395208e-01   -3.638690197270344e-01   -1.640236219843199e-01   +9.700750026917854e-02   +2.906039680889838e-01   +6.140735049782636e-02   +3.387436884245737e-01   +3.614859339639789e-02; +3.557846455521509e-01   +7.316118622613654e-02   +7.991683550864662e-02   +2.048420090772451e-02   -1.824664080774608e-02   -1.790727587030795e-01   -2.628644519914341e-01   +2.981263514423934e-01];
L1E_L2E_iAMPA_netcon = [+3.563818421231341e-01   +3.407740790458378e-01   +3.808618876899986e-02   -3.912176242711978e-01   +8.128335312444646e-01   -1.845788269167828e-01   +2.621945509037244e-01   +1.223554066174848e-01   +3.586603794640639e-01   +5.959551607863993e-01   +4.573631991884188e-01   +7.906102281423850e-01   +3.176706055857788e-01   +4.995765232039082e-03   -3.131570481370555e-02   +2.618978476454851e-01; +2.928439737773189e-01   +4.723743768896589e-01   +4.048173229540369e-01   -1.496841945590275e-01   +2.887133129132979e-02   +3.773744391407516e-01   +1.276329224716267e-01   -2.337296304623134e-01   +8.466891701533746e-02   +4.140818756240431e-01   +2.735616215448679e-01   +3.087727963459799e-01   +3.567336477969563e-01   +1.210761925880070e-01   +1.451771787312870e-01   -2.650186082225917e-02; +3.227291599636198e-02   +3.817074302197473e-01   +1.725437354352009e-01   +2.595844722850522e-01   +1.937118439381576e-01   +4.977354263505046e-01   +1.157049013527806e-02   +2.930114368973980e-01   -4.092760460646117e-02   -1.963509642008865e-01   +6.941486604441327e-01   +1.227589544561345e-01   +6.179151211039641e-01   +4.647586984800829e-01   +3.092673421082244e-01   +4.499212674242618e-01; -2.920254084279106e-01   +3.545392289144353e-01   +5.195621222935209e-03   +7.185694740942791e-02   +2.128078944445935e-01   +3.774313416386098e-01   +4.795408513632522e-01   +3.548161446032186e-01   +1.537044877884259e-01   +1.203253755839225e-01   +5.060902389521462e-01   +3.568427256206477e-01   +3.753501734776227e-01   -3.551295462408017e-01   +1.648857378228185e-01   +3.994371979988807e-01; -1.196548975283580e-02   +5.743044061973892e-01   +3.415872039016286e-01   +4.081048006403392e-01   +4.840329492418069e-01   +1.823404838803633e-01   +6.797267578305097e-01   +4.802635847916393e-01   +2.713890156866210e-01   -2.767517111119676e-01   +5.741608962266314e-01   +5.357913546189231e-01   +1.695348913742352e-01   +3.322364109262194e-01   -1.583361416028146e-01   +4.701259236552988e-01; +4.852809578120001e-01   +7.281799262263642e-01   +6.616476800272501e-01   +4.182202707372609e-01   +1.455754007689964e-01   -7.670322297046908e-02   +2.988851798489751e-01   +3.203258113969030e-01   +6.798141088204062e-01   +6.415116781656427e-02   +4.770826667424811e-01   -1.903853242914292e-01   +2.023224887967844e-01   +4.191744487467323e-01   +1.291176096963262e-01   +2.769691180648576e-01; -2.286811614378828e-01   +3.597185943407863e-01   +7.828819232863911e-01   +4.607037757199279e-01   +7.200192283048701e-02   -5.625798376076163e-02   +4.643286478789213e-01   +5.185050307125231e-01   +2.644722943186992e-01   +2.036189654566609e-01   -4.279046250811838e-03   -1.419880899138641e-01   -9.391008404163163e-02   +6.972685806242455e-02   +2.522154424250276e-01   +4.295485825992102e-01; -1.688262756968756e-01   -1.218283081384952e-01   +1.878174503746400e-01   -1.516254208489580e-01   +3.441457612732894e-02   +3.179256283091331e-01   +1.453749640853460e-01   +1.918404600064377e-01   +8.519976576011168e-02   +2.387741317028627e-01   +2.304183833440356e-01   +1.311182453112351e-01   +2.596547281180591e-01   +4.988750607736770e-01   +2.492858894961590e-01   -3.662772375365514e-02];
L2I_L2E_iAMPA_netcon = [+3.239420633815694e-01   +1.076779411227249e-01   +7.906372026141484e-01   -2.900829458191231e-02   +2.906234464037295e-01   +1.786940528424816e-02   +2.525272053985455e-01   +9.507979577407076e-02; +2.285429754066674e-01   -1.245406846537100e-01   +1.123427861997351e-01   +3.293697884378893e-01   -5.272428927843814e-02   +4.816475739869649e-02   +3.594865202477485e-01   -1.483195701749696e-01; +2.538501803794849e-01   +2.011762149455021e-01   +8.493541083594103e-02   -8.077788181012205e-02   -2.899761198470914e-01   +6.409346080013795e-01   -2.289393436238152e-02   +6.152601274882075e-01; +2.095426728002105e-01   -1.796920027825122e-01   -2.601549620874088e-01   +3.467968235500954e-01   +5.161677827308198e-02   -3.197859280212779e-01   +1.368317251994140e-01   +1.482019784200170e-01; +2.741133027042237e-01   +7.035051520523288e-01   +5.649805887554270e-02   +5.339537540727579e-02   +4.539239689701476e-01   +8.122044528655370e-01   -1.007317695539570e-01   -1.649497132748065e-01; +2.765248163289803e-01   +1.345474255597227e-01   -1.248625645185433e-01   +1.985535629558773e-01   -6.150734435420049e-02   +2.053671889450987e-01   -4.841192246601400e-03   +1.184404892377847e-01; +4.260611909598911e-01   +1.540889238283140e-01   +6.287458739812576e-02   -8.529157995904868e-02   +1.251643832532797e-01   +6.005911879332861e-01   +2.468716264679055e-01   -8.364428151043192e-02; +4.285411378688848e-01   +6.119244364813947e-01   -4.835378144085312e-02   +7.801191741314151e-01   +3.138100241635765e-01   +4.757168935626643e-02   +3.937180015720840e-02   -1.486738161875221e-01];
L2E_L2I_iGABA_netcon = [+5.423770821864722e-01   -2.753755021273581e-01   +2.786983483865427e-01   +7.257166833689095e-01   -8.284328120644299e-02   +5.658796564113513e-01   +6.037824949293707e-01   +3.538666171405032e-01; +2.417823342469725e-01   -3.037044896553670e-02   +4.096174357290336e-01   +1.237573152546638e-01   +5.068920804132727e-01   +2.625564034257376e-01   +2.625709468865940e-01   -4.424373263418823e-01; +1.361232467245310e-01   -4.054450376074345e-01   +3.698667958504381e-01   -1.355668549617882e-01   -2.165490518129432e-01   -4.483772052691803e-02   +2.629551171732798e-01   +6.099564165718707e-01; +4.874624854565754e-01   +4.319957069959250e-01   -2.727136358840406e-01   -1.806508515841229e-01   +3.039948538155417e-01   +3.953498078490076e-01   +2.486839765423051e-01   +1.546302735004845e-01; +7.835829256855215e-02   +8.697792319766862e-02   +1.428715760034968e-01   -7.344136148418576e-02   +2.232995980765230e-01   -2.513567874599268e-01   -4.571392665328361e-02   +1.264771529134012e-01; -5.552577125380454e-02   -3.975160619331042e-02   +5.334863743071321e-01   +1.832302075213366e-01   +3.074748160579869e-01   +5.595353993540301e-01   +6.710735805971180e-01   -5.135382197730715e-02; +2.442327083548945e-01   -2.137189403625090e-01   -1.922142083158657e-01   -8.744845860811556e-02   +2.503744728315179e-01   +1.871229691273264e-01   +2.595253478914897e-01   +6.253007633068386e-01; -1.540605121444487e-01   +3.498965947420191e-01   -7.149489350694649e-03   +1.418015216697776e-01   +2.643069690093458e-01   -1.163840685125702e-01   +2.040561060933601e-01   +5.003412188549836e-01];
L3E_L2E_iAMPA_netcon = [+2.127483035641167e-01   +1.788907467251076e-01   +8.588471525929866e-01   -4.989496168861615e-01   +2.901950174291886e-01   +1.582766604212164e-01   +2.710158685257237e-01   +1.810059283969597e-01   +5.336420675718259e-01   -2.741836349319332e-01   +1.105693287747133e-01   +2.168973330293613e-01; +1.268230992768644e-01   +2.030919708531808e-01   -6.819721426366582e-03   +1.296302326720593e-01   +5.144146772553931e-01   +3.799655806088495e-02   +2.456634459400728e-01   +3.435514976933156e-01   -5.508624342654747e-02   +2.551410164055520e-02   -3.529196406377466e-02   +3.626878305506581e-01; +1.185384869326174e-01   +2.855332969433106e-01   +2.542300297293194e-01   +5.350107256836595e-02   -2.156895867737016e-02   +2.711331898738390e-01   +2.922696514003507e-01   -2.096165652473088e-01   +2.022028856979875e-01   +7.908592459683617e-03   +1.917959871921194e-01   +8.371694455876516e-02; -5.480934583167513e-02   -2.530514014966323e-02   +3.313068369493272e-01   +4.252687177519551e-01   +2.208984701957750e-01   +2.793894130081138e-01   +2.069047714847171e-01   +4.985850876929536e-01   +6.611004723597820e-02   +2.889556724543665e-01   -4.491177690958241e-02   +4.882915332328684e-01; +2.022149932491743e-01   +1.084100687948963e-01   +7.323393916049226e-02   -2.147549279971245e-01   +2.394335376975164e-01   -8.428104609666254e-02   +8.135339194451474e-02   +3.718269013352704e-01   +5.160549286345691e-01   +1.363255650565942e-02   +5.495619466160699e-01   +4.679523129920678e-01; +1.780416211930115e-01   +1.811532841375256e-01   -1.318156964422385e-01   +3.519121253638685e-01   +3.113930881926428e-01   -6.402559481709325e-02   -4.060871859148834e-01   -2.507989731277699e-02   -6.767742788514669e-02   -9.259790267940543e-02   +3.228655012425165e-01   +6.745525040739491e-01; +3.018104209182675e-02   +7.957635073149896e-01   +3.655786009254902e-01   +2.965526277953259e-01   +4.627738636627579e-01   -1.986008118047594e-02   +4.839475348085078e-01   -5.687930209902198e-02   +7.593063555889003e-01   +4.509645355767287e-01   +2.380433130128717e-01   -1.524804945489274e-01; -1.652679787074109e-01   +4.298343842936253e-02   +4.403896500594416e-01   +7.175831373801399e-02   -5.391025354676310e-03   +3.676342715935331e-01   +4.436533192871549e-01   +3.590068621234832e-01   -2.117190008777132e-01   -4.908879138996654e-01   -9.367449539466380e-02   +3.420622291518817e-01];
L3I_L2I_iGABA_netcon = [-1.695634764712427e-03   +6.446423554663863e-01   +2.172185448086783e-01   +3.646840306369108e-01   +1.974668720925665e-01   +6.563811913695223e-01   +3.667189626514152e-01   +6.369950220836009e-01   +3.876822186898290e-01   +4.169165651316566e-01   +5.791582848345246e-01   +2.130185460772923e-01; -7.274008532277486e-02   +1.916762142704594e-01   +1.180129789770551e-01   +3.707200216855104e-01   +4.332854509443991e-01   +3.635095434404060e-01   +3.594155095133484e-01   -9.025844676849565e-02   -2.558912155358348e-01   -1.406106601862963e-01   +3.412530399616043e-01   +6.272114959577957e-01; +2.043617211335880e-01   +5.076867354658315e-01   +5.265299185706361e-01   +8.753593348074717e-02   +7.430380705033779e-02   +6.299475351098300e-01   +2.556732418759418e-01   +3.480218316740152e-01   -3.386767588046598e-02   +5.036982818494634e-01   +2.034644250980072e-02   -2.731865856600182e-02; -9.084391751304527e-02   -1.597669224181609e-01   +6.535466233120374e-02   +2.688888223694036e-01   -4.216294132480917e-01   +6.543342139574261e-02   +4.249557178164596e-01   +1.233846809512719e-01   +4.869781280038021e-01   +3.339092920487755e-01   +1.729156444015672e-01   +2.946050025877572e-01; +1.080740702586668e-01   +2.490847695295604e-01   -9.077793368815179e-02   +4.171722675265244e-02   +1.784769037291462e-01   +4.191730281125419e-02   +4.049885904571027e-01   +2.040126218793322e-01   +6.517972005848285e-01   +6.346055082061071e-01   +1.258122790311128e-01   -4.177843230410228e-01; +3.508632431288796e-01   -7.971755877910869e-02   +6.575679543035472e-01   -2.867000371373162e-01   -4.834938001088998e-02   -5.954392543837950e-02   +1.718409740860891e-01   +2.845652819026558e-01   +6.181719536360080e-01   -4.192563792888758e-02   +7.844084104778144e-01   +3.882953126389244e-01; +3.742672755477923e-01   -3.322732184862907e-01   +6.865480131204824e-01   -2.595229562704572e-01   +1.516576223100202e-01   -1.367443826465686e-01   +2.781297443386869e-01   -5.334691528169655e-02   +4.319077137456097e-01   +2.687696866244312e-01   +1.818341474587573e-01   +4.485126981455194e-01; +5.780106660307518e-01   -2.799095305187529e-01   +4.363462110488422e-02   +1.350696117972099e-01   +2.522776963457081e-01   +2.815601478357175e-01   +8.417388606890458e-02   +6.246731471465179e-01   +2.899577363240709e-02   -1.432111867547686e-02   +1.549186649840470e-01   -1.371407295770140e-01];
L2E_L3E_iAMPA_netcon = [+6.455846292879819e-01   +2.031243409355550e-01   +6.300049575521767e-01   +2.854985656520538e-01   +4.339572764579042e-01   +3.971772564336681e-01   +3.926064716877202e-01   -2.338151451988589e-01; -1.047051929762512e-01   +3.500170637669064e-01   +1.761157694305596e-01   +8.126617281300914e-01   -5.395686254614317e-01   +1.831473521944801e-01   +1.829448297082460e-01   +2.231373376138639e-01; -6.589379750259415e-02   +2.868677016189533e-01   -1.139124139464141e-01   -1.252649185348628e-01   +3.355377695915345e-01   -9.398349085362745e-02   +7.008903794875528e-01   +3.060798602813998e-01; +1.407179747329909e-01   +4.898938479413567e-01   +4.943668699450282e-01   +5.382862214546451e-01   +4.609780906751932e-01   -1.426298111507586e-01   +9.900413570580191e-03   -2.807001104760080e-02; -4.426813553810586e-01   +1.230997849148462e-01   -4.271712703500485e-02   -9.254071881438525e-03   +6.885713977316918e-01   -6.790307072840618e-03   +2.966518770451642e-01   +1.582717058902417e-01; +3.765769126222171e-01   +3.711562260379553e-01   +3.740025614181699e-01   +6.149758577117883e-01   +2.444065163255610e-02   +8.217674593048807e-02   +2.162483402836535e-01   +8.158780923632497e-02; +5.168557289472846e-01   -3.930104224040610e-01   +1.424801496320527e-01   +2.358808983504955e-01   +3.960277845288058e-01   -3.244385389317693e-01   +3.851702628932298e-01   +3.425630631329556e-01; -3.530416288903754e-02   -4.502387334061697e-02   +2.319838690514562e-01   +2.323561714226541e-01   +3.515147971343572e-01   +4.501421644453821e-01   +4.239709366676194e-01   -2.661555149339117e-01; +2.827671546995285e-01   +3.549197091134121e-01   +3.352915257500221e-02   +1.065947714802072e-02   +8.753770412335835e-02   +1.090493076033981e-01   -1.693370901547955e-01   +2.641373969394054e-02; +4.651637011729850e-01   -7.871953919878860e-02   -6.974121729541577e-02   +3.733985025545233e-01   -9.873347729350779e-02   +1.424075844942695e-01   +2.324798479816427e-01   +5.547528301086487e-01; +1.912395775407988e-01   +1.420270248791873e-01   +2.232922288199097e-01   +3.901912627613309e-01   +3.326765226949683e-02   +7.008867887174801e-01   -1.469858735307557e-01   +1.102982887455946e-01; -2.912648753986901e-02   +2.475558964403917e-01   +5.837015168212297e-01   -1.520405235364991e-02   -1.280920593713869e-02   -1.427120476178506e-01   -4.104563141918863e-01   +2.544314432727590e-02];
L2I_L3I_iGABA_netcon = [+4.751689792266457e-01   +1.620259071016269e-01   +4.828446572706221e-01   +5.547710310394308e-01   +2.845641960442147e-01   +3.557530870911300e-01   +3.169617683636167e-02   -1.611391148795357e-02; +2.618345574854620e-01   +3.982851506287262e-01   +4.421654378765507e-01   -4.249587630533749e-02   +3.449663193088634e-01   +3.077312004517961e-01   +2.592323302519632e-01   +6.386188233930508e-01; +3.693020417880902e-01   +6.718952601513642e-02   +5.830809467939303e-01   -4.183186570131392e-03   +5.862491408524959e-01   +4.478788422100500e-01   +6.358039482318634e-01   -1.999412249970515e-01; +2.386764785451423e-02   -2.460042473509941e-01   +5.518858297615836e-02   +9.589753616608196e-02   +5.843675370069668e-01   +2.874739821291748e-01   +2.271413005486760e-01   +3.792240451939746e-01; +2.165994476939187e-01   +5.364633027952759e-04   -1.453244804514854e-01   +2.046329045041761e-01   +2.244509671863776e-01   +2.938017998270220e-01   -1.589703635187134e-01   +3.747150022237143e-01; +3.045734275144287e-01   +5.326738280506541e-01   +5.082534090497304e-02   +4.085581783809122e-01   +6.166736427572084e-01   +3.742554073712338e-01   +2.712417421736348e-01   +2.241767857909991e-01; +1.308422146267905e-01   +5.339424062039302e-01   +1.355959059812646e-01   -2.698686378591589e-02   +1.350018817282472e-01   +1.324578205906531e-02   -3.827417811843939e-01   +2.100938332171738e-01; +3.086398642670077e-01   +3.858743793778603e-01   +9.720522640590337e-02   -2.329035073301552e-01   +1.287979949142845e-01   +2.272899797287597e-01   -5.153663719411453e-02   +3.553928951036212e-02; +8.749308450879137e-02   -7.855773502149554e-03   +2.387554137488014e-01   +1.294169386278823e-01   +2.061662587794742e-01   +1.737056929167546e-02   +3.786425748632639e-01   +2.853692420805291e-01; +4.317866258353872e-01   +6.690809191334905e-01   +4.430469982610669e-01   +2.021583893689021e-01   +1.400046891073316e-01   +1.088918404599919e-01   +2.443380297606849e-01   +3.718096412646201e-01; +8.284085844810829e-03   +1.295651632286150e-01   +2.147718093576966e-01   +7.996096651153636e-02   -4.211824571506661e-01   +4.180172581457998e-01   +2.676188124837756e-01   -2.011630906001734e-02; +2.878778219316658e-01   +4.473579533925265e-01   +5.460870493183092e-02   +1.609099925707471e-01   -3.423309057095913e-01   -1.293171801406590e-02   +6.151943163941229e-01   -8.558217340104851e-02];
L3I_L3E_iAMPA_netcon = [-4.329365413787950e-03   -9.665976449858105e-02   +4.715136795632309e-01   +1.223027633727057e-01   +4.866112839530635e-01   +3.017223147788252e-01   +4.488045063255220e-01   -2.683419887078885e-01   +2.493302337855145e-01   +1.505304544865769e-01   +6.724257577809756e-02   -3.918277945679832e-01; +8.973550818783789e-01   +1.621962448375942e-01   -2.384404546554788e-01   +3.533173849723201e-01   +4.725991547298816e-01   -7.003484128041076e-02   +1.722013929822376e-01   +3.064270479397687e-01   +2.847686356681845e-01   +2.352685720432678e-01   +2.214882184894780e-01   +4.631367804071539e-01; +2.951400295124331e-01   +1.494230238628361e-01   -3.660343892347332e-01   +3.955086108699906e-01   -2.233976100217157e-01   -3.264345126701055e-01   -6.071849655978052e-01   -9.864321429899597e-03   +7.746868671477958e-01   +2.126530194470415e-01   +3.083430444517729e-01   +3.212841698741076e-01; +2.051924456933880e-01   +2.590279050751514e-01   +4.538572670302297e-01   +3.915338192208804e-01   -2.941277692110124e-01   +1.315378641670730e-01   +4.151086778668650e-02   +2.488436316739894e-02   +3.628826397178828e-01   -2.216822103426943e-01   +3.641873208520399e-01   +3.560503743752659e-01; +5.319088880045540e-01   +1.310462766760822e-01   +5.216544557900160e-01   +1.776440437936819e-01   +3.526579560672982e-02   +5.785514488971744e-01   +8.509973854618501e-01   -5.939409134298371e-02   +3.108103905419865e-01   +8.201526255083051e-01   +3.269021481452231e-01   +1.553880069793007e-01; +1.107650051503924e-01   -5.878605564550342e-02   +3.010920090767356e-01   +1.153496043248119e-01   +5.660189541536118e-02   -2.166184041002723e-01   +1.945757818794920e-01   +2.603384134027815e-01   +2.202326432475801e-01   +8.073345198242812e-01   +3.799888610661401e-01   +3.002949357958873e-01; +4.546137295938691e-01   -2.341030027079179e-01   +4.078535003832092e-01   +5.158089933951134e-01   +2.769050348252598e-01   -4.889738075319277e-01   +2.435304982992117e-01   +4.052910212231168e-01   +5.677521638940103e-01   +6.272600893595349e-01   -5.213522514786717e-02   -3.066969550203044e-01; -1.391939112151775e-01   +6.070838582679067e-02   +1.333282665429610e-01   -2.379203819127829e-02   +2.310519743279896e-01   +3.016158161374033e-01   -1.213378714143152e-01   +2.000630075961062e-01   -1.782863674235619e-01   -2.717056949352585e-01   +2.362253179881707e-01   +2.597942197793310e-01; -2.657474086110550e-01   +2.745642257355107e-01   +3.275182191433929e-01   -6.638628007390956e-02   +5.569895074668725e-02   -6.151334159465957e-02   -9.116073520277566e-02   +1.868465328868985e-01   +1.864436249284801e-02   +6.491503121456450e-01   +8.521892428173859e-02   +1.540803645686299e-01; +1.772624933971657e-01   +5.812963217925549e-01   +6.590022268570463e-01   +8.390873807354742e-01   +2.618961731802003e-01   +1.414778021041243e-01   +5.069289426622131e-01   +7.586904035635997e-02   +3.234180469256743e-01   +3.997415201261571e-02   -3.177060101384019e-01   +5.377208512287571e-01; +7.637081483012174e-01   +5.616217324705755e-01   +9.166028694036302e-02   -1.822265288469792e-01   +6.113078478695257e-01   -1.264971028739779e-01   +9.362691136271856e-02   +1.025278996855769e-01   +2.702433744279225e-01   -1.609274989240489e-02   -3.925623572678782e-03   +4.570877325406006e-02; -4.891915930990012e-02   +3.695051894875244e-01   +1.164886909716537e-01   +4.017761007996552e-01   +2.182546218056310e-01   +4.781639200330472e-01   -9.056445339214056e-02   +3.345892068974911e-01   +5.198386915839712e-01   -1.646489384208732e-01   -2.160189507684747e-01   +2.862847903444726e-01];
L3E_L3I_iGABA_netcon = [-1.255094293786355e-01   +4.539313787560360e-01   +4.625320486739364e-01   +2.382179446906943e-02   -2.384841199252063e-01   +1.274351019752957e-01   -1.285092829288530e-01   +2.949286839891172e-01   +2.594841927994486e-01   +5.745376897642159e-01   -4.477692247214177e-01   +1.571176640102419e-01; +5.822801814416519e-01   +6.101059366300512e-01   +3.987398886886358e-01   +4.071440648123378e-01   -4.038773687702722e-01   -6.987028757175594e-01   +1.867798466424047e-01   +4.614298441095797e-01   +3.176789989930237e-01   +1.833216131475288e-01   +4.280368429330146e-01   +4.072872269977754e-01; +2.665114977019593e-01   +1.205516490179590e-01   -1.469133195190139e-01   +4.722228023426206e-02   +1.783384319492224e-01   +3.429571211745112e-01   +5.754124464493315e-01   -9.084926071369204e-02   +1.960730781772317e-01   +5.004078296354797e-02   +3.017636980637891e-01   +5.273322185371948e-01; -1.026117847135173e-01   +4.261636151179833e-01   +1.607293029058914e-01   +3.164794202606031e-01   +6.608097734752996e-02   -4.804293258825302e-01   -1.154527065406190e-01   +3.012931475394631e-01   +3.033855845295864e-01   +3.135420229041291e-02   +5.758365341124814e-01   -5.551797300224291e-02; -1.385111449722171e-02   +6.501227693715195e-03   +4.849070795641131e-01   -4.884477456749244e-01   -7.456674932868324e-02   +5.806768190622105e-02   +4.748834808070341e-01   +1.011860148866970e-01   -8.841378822392268e-02   +2.796313577910828e-01   +3.140369808128917e-01   -3.346363954380078e-01; +6.141108005675088e-01   +4.941799982922859e-01   +5.055912162831905e-02   +3.592011759639822e-01   +4.522086724302931e-01   +2.210904175619310e-02   -2.314737369082412e-01   -4.550137116588179e-01   -2.697702576979473e-01   +3.550340048757341e-01   +3.417837430639448e-01   +6.969656441413425e-01; +2.690672060429380e-01   +7.577720192043047e-01   +3.159430681492076e-03   +1.795583616760162e-01   +4.808393508300839e-01   +4.824070232114102e-01   +2.089620531220851e-01   +3.124832870206256e-01   -7.746778502687887e-02   +2.672626830767427e-01   +1.838924358345112e-02   +1.835619054657486e-01; +4.066117678371304e-01   -7.507236169768541e-02   +6.783771782696197e-01   +9.636716580319893e-04   +2.705993127276706e-01   -1.541353485052084e-01   -3.036367029492959e-01   -8.615089589566433e-02   +3.942964305538518e-01   +1.390666876039234e-01   -3.081309804882961e-01   +5.772379951749324e-01; +2.192142376001027e-01   +1.649030984547125e-01   +1.250199798119610e-01   -1.457118545298397e-02   -1.971600837537430e-01   -1.700312535755086e-01   +5.964327235573463e-01   +1.096848878819515e-01   +3.632658213574363e-01   +3.536216794316788e-03   +7.818517618328535e-02   -1.345179141864183e-01; +1.611526403110316e-01   +6.630153600729514e-02   +4.009520140415213e-01   +7.220778211022122e-02   +4.174869266160480e-01   +1.883165479698383e-01   -1.193446422349595e-01   +9.584006176388343e-02   -3.547868526374326e-02   -2.607740459727770e-02   +9.688669726485344e-02   -8.441534569752432e-02; -4.033819876394334e-02   +1.824820480707403e-01   +7.666069865130232e-02   +2.285805696587801e-01   +4.265294350693238e-01   -3.298540110895437e-02   +6.048710379807065e-01   +3.919445532527481e-01   +3.596295462296518e-01   +2.001861731288564e-01   +2.616802681149286e-01   +4.232898010586632e-01; +1.937246641632198e-01   +2.832781989718397e-01   -2.709342352570264e-01   +3.883764853457983e-01   +1.999659078219688e-01   +4.111350366624935e-01   -3.712403389911541e-02   +2.811909825603666e-01   +4.018216537713453e-01   +7.706060671262736e-01   -4.489579124111192e-01   -1.846398959219282e-01];
L2E_Input1_iAMPA_netcon = [+2.307671118316991e-01   -5.190590955960961e-02   -3.278240022360807e-02   -1.162786738353600e-02   +1.466562497410618e-01   +4.716634557020420e-01   +6.853678889811182e-02   +1.875428927190218e-01];
L2I_Input2_iAMPA_netcon = [+3.944598232585060e-01   +9.021592561123593e-02   +4.699347079494733e-01   +6.559855145979446e-02   +8.161073218100542e-01   +2.836977479561136e-01   +1.164663537128397e-01   -5.349854178729530e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  33.63 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 60*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = -60*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
