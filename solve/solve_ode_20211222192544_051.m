function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.884412755015558e-02   +7.580920825586780e-02   -6.564179969161802e-01   +1.826410237355243e-01   -3.143129208727549e-01   +6.574156767742592e-01   +6.946395038625407e-01   +3.437302001884091e-01   -3.527318955126851e-01   -8.931776069012119e-02   +5.532858540815028e-01   -5.378570066059232e-01   -1.113419149451248e-01   +1.458125635348400e-01   +9.943295280409618e-02   +5.997643586443194e-01; +8.602978152065337e-01   -2.136865295575320e-01   -8.022562511942424e-01   -6.397452796331992e-01   +9.039800439579430e-01   +1.569135541669504e-02   -4.210305875680273e-01   -9.406592829623306e-01   +1.118637171235086e-01   -1.901152585129386e-01   +3.781347643935277e-01   -3.634450661238171e-01   +2.841107336607138e-01   +1.886761323986985e-01   +2.670033964799949e-02   -6.447173624013951e-02; +6.883556473788701e-01   +4.185633243618483e-01   +2.788323572536823e-01   -4.507656610828037e-01   +6.791948542999119e-01   +2.286342330253164e-01   -3.124478777276983e-01   +7.363942339295500e-02   -3.539238898498600e-01   +1.629510028970453e-01   +2.555902510694360e-01   +4.637150951159391e-01   +4.125472268104334e-02   +5.464422302553592e-01   -5.331639063142640e-01   +5.188971593806870e-01; -2.015916495094842e-01   -4.407378107995683e-01   +4.147286900798837e-01   -1.167604533120094e-01   +4.810890212420676e-01   -2.321346086122151e-02   +9.782223935288723e-03   -4.295766033322696e-01   -3.229953292687959e-01   +6.073109921649812e-01   +1.116085632566810e-01   -2.361883626193159e-01   -2.112113547669304e-01   +1.971316474502998e-01   -2.058294604038437e-01   +3.183390966372553e-01; +5.052408004006969e-01   -2.660536816197049e-01   -3.284336685354575e-01   +2.915590406400199e-01   -6.873959363413552e-02   +8.678476307296320e-01   -3.933031970613642e-01   -6.746948234376027e-01   +7.797277367116923e-01   +1.093879571780680e-01   +5.025658590137181e-01   +3.183042698658387e-01   +6.973643381850185e-01   -3.598053579153950e-01   +2.625206597318373e-01   +5.774346241532051e-01; +3.896463477231622e-01   -4.884822204882852e-01   -8.596248639179382e-02   -1.413969400389714e-01   +8.422798852425018e-03   +5.283669469739705e-01   -9.601208560517051e-01   -5.833137431977332e-01   -1.396139273674857e-01   -2.396958794571944e-01   -7.674037634100096e-01   +5.496714192395683e-01   +5.787173236852918e-01   +3.170000126789383e-01   +1.377969094519430e-01   -6.071895806233760e-01; -9.603331307815496e-02   +1.431141467945432e-01   +7.776726420995238e-01   -9.203003295341897e-01   -6.115721095162722e-01   +5.787805270805911e-01   +1.767968301820339e-01   -2.297803312935915e-01   +5.981667503066572e-02   -5.877430796940617e-01   -3.210167564588952e-01   +9.330380241761578e-02   -1.253698466310804e-01   +1.463636194910469e-01   -1.635894897451958e-01   -5.494261723090850e-01; -1.041578481521875e-01   -3.872737259000673e-01   -5.411751146082064e-01   +1.356686145484903e-01   +7.783522979881419e-01   -1.131826347701646e-01   -6.310967282579442e-01   +2.821278731736972e-01   +1.270465065379509e-01   -9.354661807083101e-02   +3.755466433653205e-02   -7.315974904291692e-01   -5.595482012814567e-02   -2.900389077511744e-01   +5.104863393440316e-01   +8.199718290166368e-02; +2.990686358651061e-01   -7.774298856561592e-01   -2.247057390236570e-01   +6.845373039220192e-01   -2.236178622815335e-01   -1.879724051633211e-01   -7.199953222720098e-01   -7.615624378168298e-02   -9.881064131508752e-02   +4.053462250898036e-02   -2.664570934797310e-01   -2.086916013655158e-01   +7.587537954592972e-02   -5.143979064856954e-01   -2.963120818716893e-01   +1.765094690059131e-01; -1.854679656585206e-01   +9.073594455926672e-01   -3.520745469974600e-02   -4.190666528877545e-01   +7.645955813903292e-01   +6.631794888284298e-03   -3.502701287876530e-01   +2.155898279113621e-01   +6.560010608539476e-01   +5.341099501284352e-01   -5.117575377965244e-01   -3.215908277070221e-01   -7.694617468920637e-01   +5.272757189395423e-01   -8.731643463170737e-02   -1.972186000218556e-01; -4.057559651343293e-02   +1.194137169926349e-01   +3.662216217311345e-01   +5.331184824409018e-01   +1.105178988704447e-01   +3.934697809069444e-02   +1.911400339582452e-02   +3.867602777026647e-01   -4.907376569871185e-01   +2.548939278611644e-01   +1.338545018027034e-01   -4.409853630222615e-02   +3.421525572687578e-01   +4.591120382546852e-01   +8.041761789569880e-01   +6.719322789318734e-01; -1.913877135341321e-01   -5.296729195205121e-01   -3.760997913601812e-01   +3.746227528158516e-02   -5.103232674023427e-01   +1.110767312322724e-01   -2.085503094798204e-01   +3.492161136497726e-02   -1.070117168751998e-01   +2.922807082615593e-01   -4.225663566998740e-01   +2.401133298672055e-01   -3.690758206682930e-01   -5.026034874448719e-02   -5.648095426673814e-01   -1.495288232500280e-01; -5.078141317548822e-01   +3.024622581568208e-01   +4.829238145486026e-01   -2.254650601252130e-01   +3.350490041780105e-01   +1.855016166021658e-01   +1.411947901513334e-01   +2.857822220313590e-02   +3.286780705331052e-01   -3.438869878789423e-01   +7.294246403566496e-01   +3.027786209840379e-01   +7.528795005310497e-02   +2.937471964181758e-01   -7.193660471197096e-01   -5.811181993847666e-01; +4.885952069051893e-01   +4.393706849599928e-01   -4.136985759625578e-01   -3.482833794825811e-01   -9.487298722500292e-02   +5.446045016628946e-01   -4.162696223106614e-02   -1.295250814383825e-01   -4.858527629246192e-01   +3.987553327851281e-01   -4.321501253726795e-01   -2.250996831738876e-01   +8.177784999030168e-01   -3.650592322277058e-02   +2.388722479326772e-01   +1.978423083643933e-01; -5.728027074318917e-01   -1.971555734495382e-01   -4.824504901625529e-01   -1.331068603734102e-01   -3.061527082248638e-01   +8.603537196165943e-01   -6.755208038053774e-01   +5.102697954739456e-01   -7.662921088691041e-02   -6.993204968825215e-01   -2.449879404816709e-01   -4.916795939693642e-01   +5.621281033565934e-02   -1.068170265089607e-01   -5.098686174505788e-02   -2.784630949892680e-01; -5.113321999233842e-01   -1.653511436630992e-01   +4.407549069308602e-01   +6.093291936546136e-01   +1.737267276726563e-01   +5.746681087503552e-01   -4.439708682248094e-01   -1.000000000000000e+00   +4.264831894500985e-02   -1.478546014779909e-01   -7.147781414116590e-01   -4.102907585643500e-01   -3.778191487979488e-01   +3.995736880561477e-01   +7.019614829592343e-01   -2.591052129194981e-01];
L1E_L1I_iGABA_netcon = [-3.999825709995183e-02   -2.884559086607912e-01   +2.732414006700316e-01   +4.425959581916181e-01   -2.166022853108360e-01   +3.012862993110387e-01   +3.330812656563260e-01   -2.747020479220326e-01   +8.524111883125141e-01   +3.775877261759729e-01   -1.104751802066232e-01   +1.779122615662320e-01   -3.029810482261572e-01   -2.115331257369266e-01   -1.271628105255484e-01   -1.349356655775086e-01; -7.592158851644604e-03   -4.614174900665362e-01   -4.310354337870108e-01   -1.780385516061178e-02   +5.322100306670299e-01   +1.651304660127522e-01   -5.311724928199595e-01   +3.595080588795662e-01   -6.857921865656811e-01   +5.130896010420091e-02   -5.796647835645363e-02   -5.897437536927564e-01   +2.762563235187339e-01   +3.174216901807725e-01   -1.688916977473577e-01   -1.781110327981339e-04; +1.344020750711805e-01   -1.162183442781500e-02   +4.120044675541945e-01   -2.599027706347716e-01   +4.000652283260600e-01   +9.915551725206298e-02   -1.168841339197401e-01   +5.269222348892810e-01   -7.000751696507174e-01   -3.291865038942918e-01   -1.420820378197483e-01   -3.129453681594911e-01   +2.539099331928032e-01   +3.163763060620390e-01   +5.855503957212062e-01   +6.564736066816236e-01; -5.863848442593933e-02   +4.310458844697462e-01   +2.825478401129563e-01   +6.063213387930590e-02   -5.035097063453523e-01   -4.337816130671318e-02   -2.465445971147061e-01   +6.232021583497798e-01   -3.628085136513394e-01   +5.193941911611960e-02   +3.903823616057698e-01   -7.724398300736495e-01   -1.938068197407466e-01   -3.773595199946796e-01   -5.643840544014674e-01   -5.466309319430025e-01; +8.211495572316607e-02   +4.548750624338516e-01   +1.187913486360384e-01   +5.462537057736196e-01   -2.678373320236129e-01   +5.280209139621768e-01   +3.126881472772178e-01   -2.832392584735416e-01   -2.777401447555653e-01   -3.463308298184713e-01   -4.920443080992115e-01   -5.746940154429803e-02   -3.710023363994644e-01   -7.163998988424646e-01   +6.132457253970237e-01   +5.214361457535337e-01; -3.278258750889427e-01   +8.301564593645391e-01   -6.063045468762888e-01   -5.679771777896249e-01   +2.464212951396286e-01   +3.321435770901835e-01   -7.069662383720116e-03   -3.998791819127212e-02   +4.320561065200688e-01   +4.031381421275713e-01   +1.750917072495153e-01   +8.061350088387548e-02   -3.488725096245666e-01   -3.093102496331929e-02   +3.042017313953620e-01   -3.965619847331006e-01; +2.557043711286733e-03   +7.238269581611376e-02   -2.507651075202798e-01   -2.973515509705975e-01   -5.281258653953664e-01   +1.605115534624607e-01   -2.721018720287687e-01   +2.289757985746297e-01   +2.070063893935942e-01   -8.315991287456908e-01   +1.701845034715150e-01   -4.771335662527763e-01   +2.797431754169813e-01   +5.198463792361697e-01   -2.763293060702693e-02   +3.360351562482666e-01; +7.054290536905383e-02   +5.531135271776347e-01   -1.356658462261510e-01   -6.307512945263586e-01   -6.090413243829891e-01   +6.911392642949236e-01   -9.587099532125426e-01   +6.049156950038659e-01   -2.162301669408717e-01   -3.701431948275777e-01   +1.616794125227470e-01   +1.830370386249205e-01   +6.216762756307845e-01   +6.868894671722808e-02   +4.326794295445123e-01   -2.107110152742432e-01; +1.685360260588648e-01   +1.162721207954732e-01   -5.246575089538748e-01   -7.848773205423865e-01   -5.097228819084227e-01   -6.493507252831673e-02   +1.878662649701202e-01   -1.376687504811770e-01   -9.694779300226468e-01   -4.651447787520241e-02   +4.058273281764713e-01   -5.814319590902211e-01   -1.946030244226670e-01   -1.701130706026508e-01   +1.028029619065141e-02   -1.224968538129887e-01; +2.483123305463926e-01   +1.873335616932889e-01   -3.567003956284670e-02   -5.420709191507281e-01   -4.063929106253952e-01   -4.425756122690210e-01   +1.152667580188045e-01   -2.716472773722080e-01   +2.579625241567979e-02   -9.178543827304275e-01   -1.982313713000653e-01   -4.332292712962835e-01   +2.308493971153848e-01   -2.391331774661662e-02   +8.068421081152393e-01   -3.772148682322609e-01; +3.599790715137202e-02   -9.857777355630627e-03   +4.136653006913475e-01   -1.166431250079952e-02   +2.710382843049103e-02   -2.761132257342845e-01   -1.163904913631685e-01   +1.263981600335969e-01   +5.165807397817022e-01   -2.802493281599446e-01   -2.969128895331101e-01   +4.677303434274340e-01   -4.821251457126901e-01   -7.889340832459651e-03   +2.906262515529501e-01   +2.713340109870950e-01; +6.491594165796415e-01   -5.706199089321495e-01   +8.141427832267867e-01   +6.591690444877882e-02   -7.581583050728053e-01   -4.925913332303224e-01   -9.721430105517880e-01   -5.182466111760679e-01   +3.805801183401228e-01   +2.050658537252981e-01   +1.385510159201070e-01   -5.417034173657819e-01   -7.306347133301780e-02   +6.029937337459920e-02   -3.742123413545820e-01   +2.988083777488074e-01; +2.072552913124623e-01   +1.383819384264040e-01   +3.175157470209095e-01   -3.189885870535593e-01   -9.924690496349715e-02   +1.183628501450902e-01   -6.417395218800517e-02   -7.068499328085416e-01   +4.020575460023950e-01   -3.061980219582222e-02   -4.161236608811626e-01   +4.539418143550020e-01   +1.303871254581869e-01   -2.997201834742574e-02   -5.558823966222298e-02   +5.160506981908810e-01; -5.485216874856345e-01   +1.484633566595900e-01   +5.035004254834325e-01   -1.973568905246330e-02   +5.663004612697053e-02   +1.631235118373509e-01   -2.887839394470906e-01   -1.044334877224397e-01   -2.964960965226209e-01   -5.823074665013172e-01   -9.743269628487150e-02   +4.450101442777077e-01   +7.491622632214094e-01   -1.627577436272677e-01   +1.549747213325636e-01   -5.879978996878433e-01; +4.193573971640128e-01   +3.133644260430208e-01   -1.512161978979080e-01   -4.501672604979868e-01   -5.308621220097718e-01   +7.860425713385499e-02   -3.581981444000599e-01   +3.179406098639104e-02   -3.711735750575043e-02   -3.318734108819151e-01   -5.421564984841915e-02   -6.367690332327210e-01   +1.299958120849617e-02   -4.180207478085952e-01   +6.410639249157478e-02   +8.451873103615317e-01; -2.070872176693046e-01   +5.303200513154165e-01   +5.079072804569766e-01   -4.588257671122073e-01   +7.271941928546459e-01   -5.085723677438370e-01   +4.540765278476510e-01   +3.562098360632635e-01   -8.353826191421582e-02   +1.701212212646092e-01   -6.411441541037524e-01   +3.470855331051431e-01   +8.477669419804044e-01   -8.375218415771617e-01   +3.924430271032662e-01   -5.476460034835334e-01];
L2I_L1I_iGABA_netcon = [-2.393635149571501e-01   +1.187625716292589e-01   -4.462601633844027e-01   +5.911671998320949e-01   +1.652201085954252e-01   +2.474802829520912e-01   -2.673925108431498e-02   -1.880913736599001e-01; +6.555303763154580e-01   -5.805666795407945e-02   +2.652694459881172e-01   -8.972575159077928e-02   +7.811201752564953e-02   +1.107120177784239e-01   -1.697607091391504e-01   +4.455410772483440e-01; +5.244415370191274e-01   +4.160955847395227e-01   +1.068042678712280e-01   -5.093083313317427e-01   -3.207451131658767e-01   +5.746926110340552e-01   +4.591829077231345e-01   -2.409491895030867e-01; -5.872767303775387e-01   +7.853191714001535e-01   -8.771531894665038e-01   +2.802686216882776e-01   -2.257620714427747e-01   -2.055102712634620e-02   +6.545672320021886e-01   -6.339464995940471e-02; -2.025519381986360e-01   +4.220444576271344e-01   +3.150685909027350e-02   +2.882148118645603e-01   -3.371777281619650e-01   +6.502338641608528e-01   -2.085433505563716e-01   +4.769839534095257e-01; +7.937603871217663e-01   +1.388235673560357e-01   -3.689502693585108e-02   -4.544228525248156e-01   -1.860058690463100e-01   +4.666424105729765e-01   -7.433620701558100e-01   +2.266255024294938e-01; -6.083794385047193e-01   +3.857753414133386e-02   -5.364468053633478e-02   +4.278553087589375e-01   -3.379923399016084e-01   -1.481693344746040e-01   +7.036656441236327e-04   -3.666409132200111e-01; -2.822742368966833e-01   +8.487373696407738e-02   -3.626727842404815e-01   -3.386627368258249e-01   -5.639849360119045e-01   -6.486472929429059e-02   -6.521577675582741e-01   +2.184471248014195e-01; +5.245862971439348e-01   -6.542149318794403e-02   -1.015830062452246e-01   -2.066243658107693e-01   +5.975387517071540e-01   -5.337312586985462e-01   +1.366720874287177e-01   +3.680684213241257e-01; +3.674601457615714e-02   +2.889179554905546e-02   +5.872027902719971e-02   +5.647583307968839e-01   -9.603418361814997e-02   -9.226026097061245e-02   +6.294514137796933e-03   +4.694049755647229e-01; -2.733490057969015e-01   -4.705080133929330e-01   +3.992365901857916e-01   +1.000000000000000e+00   +2.459937497866415e-01   +1.510017065609996e-01   +4.145619791639219e-03   +2.763226245550638e-01; -4.512691287589256e-01   -8.815458243011147e-01   +9.305730696782059e-01   -5.833711087316023e-02   +5.119578820765440e-01   -3.081122326094222e-01   -1.797367898621608e-01   +6.131108618962294e-01; +2.826126667827725e-01   +4.780255055766781e-02   -2.098338428357854e-01   +5.255255350127818e-01   +3.712568901001416e-01   +1.498682129751127e-01   -1.917543311222805e-01   +6.837358093702074e-01; -2.395248979983038e-01   -5.335344452951006e-01   -2.860801354419622e-02   +1.211369693787598e-01   -5.201907602216916e-01   +3.658663973325983e-01   +5.058242945071702e-02   +2.810101624981726e-01; +1.662758133062505e-01   -3.534087474678386e-01   -7.312615263522694e-02   -1.122838547292401e-01   -5.598939595572237e-01   +4.704293237465080e-01   -9.532726045681456e-02   -3.535972883892088e-01; +1.582942328388463e-01   -3.682274028619492e-01   +1.842601270233796e-01   -4.217567815135445e-01   -2.187703222681720e-01   +7.003703812797817e-01   -2.296038577717090e-01   -3.877586509282819e-01];
L1I_L2I_iGABA_netcon = [+7.208230607243542e-01   -1.594652783837572e-01   +5.784545387022390e-01   -4.591307959978725e-01   +2.533601257931456e-02   +1.486523943449761e-01   -6.198591839397448e-01   +3.219129807918337e-01   +5.593576895271665e-01   -2.868662657879009e-01   -2.958910747836607e-01   -5.739891222950179e-01   +4.562823262961583e-01   -8.659650580706497e-01   -1.774715940065792e-01   +3.149320403542205e-01; +4.080313436203285e-01   -3.606521920667677e-01   +4.326832580992741e-01   +4.544261112293437e-01   +1.092479446220174e-01   +6.148384530575410e-01   -5.445824131940816e-01   -4.151447504124149e-01   +1.938953446159211e-01   -6.710464297935995e-01   +5.833200755688576e-02   -1.096805659548139e-02   +2.532808800041695e-01   -2.990150959013296e-01   +4.334370959431788e-03   +8.875127199160647e-01; +2.739793006671722e-01   -3.595025298975023e-01   -9.802385637001422e-02   -7.468235614265823e-01   -5.849334753804604e-02   -6.661377612965375e-02   -6.564531254360007e-01   -8.391672397979777e-02   -3.935816526575520e-01   +2.488893321878318e-01   +1.641175725219333e-01   +6.218786169499760e-02   +1.343647231760796e-01   -9.204616126518257e-01   +3.499984890248958e-02   +3.040564751751316e-01; -3.256013603097469e-01   +2.007252316810472e-01   -3.100560681638227e-01   +7.649502365908545e-01   -3.543323517643155e-01   +6.747138018299112e-02   +3.409632488262625e-02   -3.814896304923588e-01   -1.280382830033736e-02   -4.353209896262821e-01   -5.660124382895672e-01   -2.232590616311222e-01   +8.301026704406855e-01   +2.842124198400579e-01   +7.038826368334664e-01   +6.354117155128508e-02; -3.872573215096926e-01   +4.127883613690280e-01   -2.826442980501073e-01   -1.925523067789515e-01   -8.997975199689910e-02   +3.219906491837892e-01   +5.814783949569008e-02   +2.822728162620926e-01   +5.287055680449663e-01   +5.034838676293019e-02   -6.874576546555353e-01   -9.308553286474542e-01   -3.671398701309664e-02   +3.522091485426505e-01   +3.537014379490594e-01   -1.551449701687741e-01; -9.715387601905011e-01   +2.358659491329952e-01   -3.259514865997343e-01   -2.108449848759864e-01   -1.948550269010326e-01   -8.457912823423919e-01   -4.696881265221864e-01   -3.253877007243021e-01   +3.796822091035080e-01   +2.902667817887672e-02   +1.027882701494172e-01   +1.216442968145690e-01   +1.154052038302922e-01   +4.148826579905157e-02   -4.073751649765605e-01   +2.918032977053365e-01; -3.292217130145967e-01   -8.842658492072952e-02   +2.567930729998064e-01   -1.669057337822130e-01   +4.516101125466596e-01   -2.313720033918986e-01   -6.725788709627980e-01   +4.778123143076033e-01   +1.134501012574050e-01   -9.777904090743104e-01   +1.444246972185551e-01   +6.863184577768761e-02   -7.102830443441191e-02   +6.192726138995764e-01   +2.880456599463627e-02   +4.874206454216749e-01; +9.219727955614261e-01   -3.765814333783749e-01   -7.431526436367256e-01   -8.434153855417936e-01   -2.109718187597517e-01   +6.899795778029314e-01   -5.323151445248628e-03   +3.511552394069546e-01   -5.074314755109406e-01   +6.124986937500552e-01   -5.313700144860197e-02   -3.717598298104948e-01   +3.144714994504801e-01   +1.684365749440501e-01   +3.086323381819573e-01   +5.758965461683853e-02];
L2E_L1E_iAMPA_netcon = [-6.169912732476699e-02   +1.702620687114142e-01   +2.624600128299490e-01   +3.184263832901328e-01   -4.341182262758060e-01   +3.801199563541106e-01   -8.101178616845121e-01   +8.134150088457197e-01; +4.659502881421461e-01   -6.856808766098398e-01   -1.634515403537914e-01   -3.178987472794962e-01   -3.389129990237436e-01   -1.203755154562849e-01   -3.859061127830574e-01   +5.306620214698798e-01; -3.933346274192669e-01   -5.165729466452356e-01   +2.623930013112156e-01   -5.727771336752552e-01   +2.641912910303126e-01   -2.248183008174277e-01   -6.031323288182461e-01   -2.890015736278505e-01; -1.276452042116034e-01   +1.793042478427697e-01   -1.095091194683710e-01   +8.509121943862585e-01   -1.402412139957938e-01   +6.882076575514726e-02   -1.080033906072322e-01   -4.186289502791550e-01; +1.066317464748662e-01   +2.897724855321695e-01   +5.899950623354362e-02   +1.123694616837407e-01   -3.261463626194651e-01   +2.793100001537094e-01   +7.879315065515883e-01   +1.725484183994512e-02; -3.492499582151768e-01   +2.339688421283414e-01   +2.017797779120433e-01   -4.339028892484044e-01   +2.297523297179882e-01   -4.871761186120871e-03   -2.103235669435433e-01   +3.125702907453083e-01; -8.792080843464700e-02   -1.355776753264011e-02   +2.409969769326127e-02   -4.255855381073096e-02   +7.920871554324255e-01   +9.620664477304264e-01   +4.111240741016934e-02   +5.127890800018307e-02; -3.797724807746614e-01   +1.786314892084531e-01   +3.690056652688820e-01   -2.337450298551890e-01   +3.364440459195400e-01   -7.647933480506450e-01   +2.178780822256086e-01   -3.126391468057759e-01; -2.643597598122965e-01   +1.180017202277410e-01   +9.978883841669332e-02   +1.000000000000000e+00   -5.654651121982268e-01   -2.229325460294437e-01   +2.008458544828459e-01   -5.081803673075924e-01; +1.267626468593198e-01   +6.526674606722127e-01   +3.055756242362568e-01   +7.559209293629042e-01   +1.869572983359418e-01   +2.501905770910193e-01   +7.140962257061685e-02   +2.252724323857568e-01; -2.017416944383035e-01   +4.069869186092132e-01   +7.840728872961877e-01   +3.916752813220533e-01   +3.427636711087545e-01   -6.325418519395618e-01   -1.892727108658322e-01   +4.582088413314532e-01; -2.060775365081772e-02   -1.984377447736356e-02   -4.605295701314981e-01   -3.784242500114469e-01   +5.389485955625404e-01   +1.690206900425697e-01   -8.307847388945343e-01   +3.079392515867393e-01; +1.063500165495613e-01   -2.829574974990201e-01   -4.269260910550635e-01   +8.813457603914009e-02   -6.403292805017925e-01   -1.061736310152584e-01   +1.985534635752680e-01   -1.513428484201633e-01; +6.554304721369493e-01   -7.565195322515843e-01   -1.350012261073781e-01   +7.911580527064768e-02   -8.407758215458552e-01   -1.042581757470175e-02   +6.190889568813741e-01   +4.488104047381987e-01; -6.425552369414789e-01   +2.347617379854628e-01   -3.225918349497717e-01   -5.592912793486213e-01   -7.904916458716950e-01   +2.029752789686873e-02   +4.366360222734098e-01   -3.991415734939911e-02; -3.556497111137625e-01   +3.084116705681481e-01   -2.540499828333493e-01   +2.716713333109112e-01   -8.166886444544241e-01   -2.173188962135507e-01   -9.802877856034644e-01   +3.336731031658031e-01];
L1E_L2E_iAMPA_netcon = [-6.647770906156532e-01   -4.208667725033785e-01   +1.610026164808496e-01   +1.373298351520691e-01   +6.616587065429352e-01   -4.260968637211015e-01   -1.719554810198725e-01   +6.490764068093653e-01   -3.861377144733402e-01   +6.061630512770525e-01   +5.898246491943782e-01   -2.068130068049421e-01   +5.060969650606392e-02   -8.121559810709904e-02   -3.826700625882223e-01   +2.205524194586908e-01; +2.070459797135661e-01   +1.722617882062838e-01   +6.254756492996416e-02   +3.873629223973015e-01   -6.211623476517144e-01   +2.415168949316443e-01   +4.389325371491120e-01   -8.946284869004206e-01   -1.070196262405035e-01   -3.400010020590086e-01   -1.453743852032412e-02   +3.614938992220710e-01   +3.149149353717738e-01   -6.112205341895200e-01   +2.386126342370721e-01   -2.034362194230813e-01; +7.727113395379174e-01   +1.014531918914156e-01   -6.124049530985457e-01   -3.105517921571195e-02   -1.042604364599901e-01   -7.509866614281101e-02   +3.483825055107999e-01   +2.371511913366879e-01   -4.149629931114077e-01   +3.168442692520889e-02   +6.212203835589676e-01   -2.361804293980767e-01   -7.504905084249815e-03   -1.454240544109831e-01   +1.797820561369661e-01   +7.294745651599485e-02; +5.132554523352466e-01   -1.351887241197019e-02   +6.090092560114072e-01   +1.008690680376469e-01   -5.220496942065385e-01   +1.775863720585630e-01   -1.608216098718117e-01   +9.318203523681677e-02   +5.370138174528664e-01   +5.745784263174566e-01   -3.440811932458256e-03   -1.000000000000000e+00   +3.064832791868193e-01   -8.901633977337464e-02   +1.598448812336022e-01   -6.590972142716256e-02; +5.096878821543364e-02   +4.684327984313838e-01   +3.883777537041914e-01   -3.027551576725015e-01   +2.359651922679451e-02   -1.840211015782577e-02   +2.918336369754463e-02   +3.262993353092986e-01   +2.488291360499185e-01   -5.499736966412856e-01   -3.238586621077008e-01   +8.560746913731256e-02   +8.163361308262504e-02   +1.578510030397418e-02   -5.851170760150323e-01   +1.230038514774448e-02; +3.691607476063453e-01   -3.074634079862689e-01   -1.945468368751856e-01   +6.373281468691651e-02   +1.621443359398400e-01   +2.254191137997764e-02   -4.881136319503844e-01   +3.465541212781821e-02   +9.851890362189593e-04   +4.777090878044074e-01   -2.532071738855427e-01   +1.429220611476051e-01   +1.873948850346730e-01   +7.827069652392504e-01   -6.653014641749376e-01   -4.814030784724647e-01; -3.882346236249742e-01   +9.482359893431878e-01   +4.543380817057506e-01   -6.041194665948485e-01   +1.336724935509736e-01   -7.672851975117990e-01   +3.204396123962931e-01   +2.937370634263740e-01   -6.788915776234878e-01   +1.097653543198163e-01   +6.056647121897281e-01   +3.719579480115000e-01   +3.224290881297597e-02   -1.583231128949173e-01   -6.935876939898102e-01   -6.221281959123706e-01; +9.052745508925730e-01   -2.655797775892077e-01   +1.015341182505454e-01   -3.718767504021699e-01   -1.510371614362285e-01   +3.788624208686990e-03   +4.681634361517424e-01   -2.202348399484726e-01   -4.419604631877355e-01   -6.114521934378463e-01   -7.577277922504522e-01   -8.811235077192137e-02   +2.228762302307075e-01   -1.867998365002863e-01   +3.744673938201290e-01   +4.456547391528428e-01];
L2I_L2E_iAMPA_netcon = [+6.143944390666179e-01   -2.140880103929863e-01   +2.722822489345493e-01   -8.800381686492406e-01   -7.387672374225738e-01   -5.847980837673414e-01   +3.736133874728109e-01   -8.166796249117191e-01; +4.733432166347755e-01   +1.219631956259927e-01   +2.853278606380454e-01   +1.923182406838881e-01   -4.530772008688884e-01   +5.526065878836603e-01   +2.899057329395734e-02   -7.794709012014568e-01; -4.162059445429556e-01   +8.266676366433351e-02   +1.133452918937859e-02   +2.225145168691026e-02   -2.453384993390352e-01   +8.182425710029003e-01   +1.789231808551608e-01   -8.796702788472833e-01; +7.670676635032525e-02   -4.697871456935740e-01   +5.220269296102893e-04   +1.889797398875137e-01   +6.324839241124967e-01   +7.554283638053539e-01   +1.071821660512124e-01   +2.390733829932324e-01; -1.000000000000000e+00   -2.089619544336841e-01   -8.457777914138859e-01   -2.487367957551018e-01   -6.107064195594841e-01   -8.125015059890112e-01   +7.905131622918193e-01   -4.003444377429738e-01; -9.602668320981628e-01   +3.210354269819377e-01   -9.257985008994097e-01   -3.613678422115476e-01   -5.531820972574510e-01   +2.899347809323450e-01   +5.097360002044041e-01   -1.040660735726576e-01; -4.413032454350308e-02   -1.926679486573658e-01   -4.972343467273848e-01   +1.728897417089832e-01   +7.019515672103007e-01   -1.945744357840004e-01   +4.629306447978669e-01   -1.127589249833820e-01; +2.479587357044263e-02   +3.411864661866164e-01   -1.270797448270193e-01   +4.248297631676092e-01   +3.203444720146194e-01   +9.179374886694428e-01   -5.784624061557737e-01   +5.872931597605130e-01];
L2E_L2I_iGABA_netcon = [+5.193025600009615e-01   +4.119590624624596e-02   -7.009513616036114e-02   -7.880183168039120e-01   -4.228676863945728e-01   -1.065911756963678e-01   +6.854065408050062e-01   +1.531304352525187e-03; -9.630448412166001e-01   -6.864192958983517e-01   -6.475922764449843e-02   +3.598052362773740e-01   -8.836652343990473e-01   -8.507038506808154e-01   +7.699531995628759e-01   +2.315580968772379e-02; -1.775100998741221e-01   +4.106092317423178e-01   +6.584429069915635e-01   -2.495413937739780e-01   -7.663516435601334e-02   -7.829196166996940e-01   +5.126200934533549e-01   -6.333817682000862e-01; -7.837316136139789e-01   +1.970329787367501e-01   +1.212658482421928e-01   +3.793557144367160e-01   -8.179160715676459e-02   +2.136072510336736e-01   +9.863695286691697e-02   -4.732826406407476e-01; -5.675900332251634e-01   +1.029594205741265e-01   -9.107940488851621e-01   -2.514420699452624e-01   +4.960931640089515e-01   +3.032379635906690e-01   +4.803611160914638e-01   +4.797009266887924e-01; +5.459595947020166e-01   +4.565501615876812e-01   +6.474816660407938e-01   +1.866219782238519e-01   +2.347858696934259e-01   +2.329895756661718e-01   +4.316770343360758e-01   -1.161508818468893e-01; -3.009660560916146e-01   -7.899555078785235e-02   +5.763087764777524e-01   +3.991916046734075e-01   -1.680798543699178e-01   +4.124515368237143e-01   -7.007271161246896e-01   -5.543419803693523e-01; +3.468692002769622e-01   +7.231841384479182e-01   +1.702454298084205e-02   +2.532776460086977e-02   +8.421225128346166e-01   +2.043362935101573e-01   -2.759868847754132e-01   +4.756846409988896e-02];
L3E_L2E_iAMPA_netcon = [-8.707513326137167e-02   -2.906857335008057e-01   -1.411374213525805e-01   -6.468944516316779e-01   -2.737101090902739e-01   +1.111878596694205e-01   +2.878159919718470e-01   +2.296822856279208e-02   -1.000000000000000e+00   -2.603424992016194e-01   +4.164681947752230e-01   +7.308877365288460e-01; -7.885994824729713e-01   -5.273779640194648e-01   -6.321160356716768e-02   +3.859547448303943e-01   +1.758340864981780e-01   +8.267973758324028e-03   -5.997775170247168e-02   +3.167933740177993e-01   +3.086350625860866e-01   -5.036361779752757e-01   +4.095334699618928e-01   +3.658170857236994e-03; -1.898053868161791e-01   +3.623607652381561e-01   -2.767517975143624e-01   -7.296454230264103e-01   +8.526608816786517e-01   +2.497678454439989e-01   +5.262497110548184e-02   -5.151254709003596e-01   +8.842045664418232e-01   -2.987593427188946e-01   +4.068690386538690e-01   -1.528134036470119e-01; +4.024783524050901e-01   +2.196445162079954e-01   -4.128299960244698e-01   +1.867411412144397e-01   -4.250651278815039e-01   -4.532125250728755e-02   +2.415432422106101e-01   -5.354707516972594e-01   -1.320992053088102e-02   +4.092230458917430e-02   +6.577300795795795e-01   +4.653806946979736e-01; +5.661109852744632e-02   +6.150694361833727e-02   +3.868634425077060e-01   -4.673611019167137e-02   +1.969181090480418e-01   +9.007360944654101e-01   -9.205632307725427e-01   +7.146543187561728e-01   -2.705972648211510e-01   +3.367796645134588e-01   +5.392746335129149e-01   +3.837066056294153e-02; +6.875377477487579e-01   -7.215464688289175e-01   -6.511833438378816e-01   -3.735661867208233e-05   +1.951337884362982e-01   -1.829149745856129e-02   -4.733055738572400e-01   +5.097699705259063e-01   +4.984905614802579e-01   +1.285265368104601e-01   +1.916337613423811e-01   -1.673711082357700e-01; +1.544595101974479e-02   +2.207746650381851e-02   -3.816150681482579e-01   +3.731034358216351e-02   -3.119050417987005e-01   -6.753961807172661e-01   +1.068851162779668e-01   -3.881039847479687e-01   +4.327831995362861e-01   -5.460807481704559e-01   -1.263418838234511e-01   +2.284918439270518e-01; +5.579870648586588e-02   -2.710590504809843e-02   +5.499134049217184e-01   -4.952237635012098e-01   +9.775735489302177e-02   +2.424289088945099e-01   -2.046582202140114e-01   -9.064745695839502e-02   -2.818027669554412e-01   +1.376277287725865e-01   +4.921380486352170e-01   -4.064035318800421e-01];
L3I_L2I_iGABA_netcon = [-1.664942301406263e-01   -3.326475749780842e-01   +3.131546701074035e-02   -2.782105724990270e-02   +2.252380962162662e-04   +5.609948349987591e-01   +4.584262205721666e-01   +7.895150906259657e-02   -4.426865059242659e-01   -4.517169155976608e-02   -1.334370639442848e-02   +3.089769944565378e-01; -4.239589581637755e-01   +1.022005625229567e-01   -7.028895550836793e-01   +6.149423697805416e-01   -4.473190382072497e-01   -8.596793063636315e-02   +5.385337337027304e-01   +5.984769951294151e-01   -1.784124092838361e-01   -3.530112145042358e-01   -5.010427020100375e-01   -1.572405875119883e-01; +4.924384982684544e-01   +5.476709414541352e-01   +2.823883008663422e-01   +3.210500789840283e-02   -4.377097013022112e-01   -6.620907673012231e-01   -7.802767118115692e-01   -6.614322908782296e-01   +6.959778400543603e-01   +6.279584045369966e-01   +6.209199672036334e-01   -7.507898599424253e-01; -1.000000000000000e+00   -1.166902461045328e-01   +1.553931884216323e-01   -4.428996129946025e-01   -1.109830825545980e-01   +4.253999909984950e-01   -7.398324312961636e-02   +2.670691103177187e-01   -1.796935695623443e-01   +4.677533838427129e-01   -4.965622330350696e-01   -5.387653767595513e-01; -4.054020382345398e-01   +3.283278817194019e-01   +5.139231829485553e-01   +8.432442198725014e-01   -5.247702119230505e-02   -6.491808860896887e-01   +5.312727537390552e-01   -2.471364522855308e-01   -9.558667977231512e-01   -1.355615621544254e-01   +2.797652833772603e-01   -1.930700190893693e-01; -2.926994597274302e-01   -1.663388078028523e-01   +5.722678247483441e-01   -7.767520111551544e-01   +2.391477737810348e-01   -1.012670534975369e-01   +1.583307503308801e-01   +1.036684110991516e-01   -7.064703296501114e-02   +3.652289184211805e-01   -1.872525340931392e-01   -2.470849140113035e-01; +3.759718807255345e-01   +3.172200439951995e-01   -4.403136337985421e-02   -6.305319081354881e-01   +1.575658046492782e-01   -2.138486461236887e-01   +1.056428554155271e-01   -6.437188203622995e-01   +3.054407808758202e-01   +1.450083138754792e-01   -6.796451827350175e-01   -3.102761601912571e-01; +3.724342795651506e-01   +1.936844524428254e-01   -3.325833342592763e-01   +3.208957402187675e-02   +6.239701301605222e-02   +4.137914937823325e-01   +4.422724799156158e-02   -2.127865876457343e-01   +1.373566903912403e-01   -6.512061648995090e-01   +2.044309152509660e-01   -5.063509227030911e-01];
L2E_L3E_iAMPA_netcon = [-1.780617057682914e-01   -1.158646813238353e-01   -4.451336298625900e-01   +2.729304056711408e-01   -1.344191347196960e-01   +4.226498833686316e-01   -4.678702961939896e-01   -2.839632659986874e-01; +2.227073173455903e-01   -6.443514112662110e-01   -6.560721904471053e-01   +2.634762907187783e-01   +5.276179616996866e-01   +7.307981372707738e-01   -5.942132406019562e-01   -7.764973088261197e-01; -6.672337557884439e-01   -8.322190139584114e-01   -8.646245002924423e-01   -1.755592207550207e-01   +1.224719653276682e-02   -2.408815208675862e-01   -8.045024218361554e-01   +2.050780502068052e-01; -1.509513954228794e-01   -1.241662711715050e-02   -5.370294591576110e-01   -5.483145567750687e-01   +1.462281197176290e-01   +6.506268092767589e-01   -2.245018234481421e-01   +4.353390578273786e-01; -1.426274304084847e-01   +5.184332265316309e-01   -2.373209039789101e-03   -8.172965460302266e-01   -2.650688937664862e-01   -3.138078910616511e-01   +9.324841288789485e-01   +3.420997952321772e-01; +3.629072933719585e-01   -2.933909857513120e-01   -2.383489630497754e-01   +5.203203272997737e-01   -1.581387920589667e-01   +5.418698130994786e-01   -2.766708321891070e-01   +6.206227934672981e-01; -1.215564564132313e-01   -5.217114728186759e-01   +8.238964909289082e-02   +3.129899427737205e-01   -1.516029841454811e-01   -4.073651156400802e-01   +1.168815583344323e-01   +4.685451430354182e-02; -2.044034243600970e-01   -6.966659523618349e-01   -4.804768062143468e-02   +5.821375758625304e-02   -1.148842664115356e-01   +3.347782560680889e-01   -5.940001085152953e-01   +5.308171900361568e-03; -8.013223599221815e-02   -9.776252915196589e-02   -2.508258304237514e-02   +4.862945858506775e-01   +7.437852738726756e-01   -5.219747569260966e-01   +3.827403830327893e-01   +4.446622155352568e-01; -3.650896496697625e-01   -4.063213882719298e-01   +6.319451285739754e-01   -5.760477816666734e-02   -2.808374877367357e-01   +4.369936514919083e-01   -3.803843397872900e-01   -1.335668744201847e-01; -7.336218675119677e-01   -1.641959893818741e-01   +2.292230521178469e-01   -5.317877423008741e-01   +4.429580840393246e-01   +1.000000000000000e+00   +2.339309024193206e-01   -1.071469575145623e-01; +5.769683555105022e-01   -2.627000432208685e-01   -3.583219664275709e-02   +5.898185240642676e-01   -2.223352169627565e-01   +3.676627807464521e-01   -8.881385344939092e-01   +1.072325791406018e-01];
L2I_L3I_iGABA_netcon = [+5.806852359924639e-01   +8.025992680760968e-01   +5.387986574907000e-02   +2.056394642542063e-01   +2.000746173066925e-01   +2.042469720569863e-01   +4.246393763204842e-02   -1.509247720127875e-01; +3.120911365455619e-01   -2.488967745730084e-01   +7.887284207545324e-01   -3.382827537593524e-01   -5.751636353847733e-02   -2.420240202600426e-01   -1.988127442812764e-01   +1.811227108017808e-01; -4.468725271693987e-01   -4.655822987395042e-02   +6.662804554917794e-01   -7.116654384665155e-01   +5.029309651516523e-01   +8.092632266519576e-01   +9.195813052389387e-01   -6.769129080502251e-02; +1.650991280868111e-01   -2.774975344254865e-01   +9.076044580280053e-01   +2.092347309590742e-01   -1.948735787181256e-01   -1.661850067601376e-01   -1.000000000000000e+00   +4.318034883913578e-01; +9.760405035965105e-01   +1.529684380111186e-01   +3.132191960044239e-02   +1.367057384065452e-01   +1.080919928898164e-01   +6.646938185754574e-01   -3.548702143887917e-01   +5.150683689168549e-01; +1.966335528138022e-01   +6.060563147381081e-01   -1.040716674711024e-01   +5.785856934499730e-01   +6.090483993346676e-02   +8.534345041234499e-01   +3.970688772050612e-02   +4.450740182316221e-01; +1.020886752787341e-01   +5.697380799229566e-01   -1.387893827877163e-01   -1.352070154200485e-01   -1.639609105320537e-01   +1.314396619920595e-01   +1.927300846670251e-01   +7.015316305884995e-01; -1.305675364031547e-01   +3.078226979273134e-01   +2.401747276158706e-01   +2.763520384155545e-01   +4.580262121136771e-01   -4.089155508479557e-01   -4.140019936234063e-01   -3.778751555083362e-01; -1.086884030791615e-01   +6.520976101133323e-02   +6.731002309291305e-01   +2.272122852580166e-01   -1.043879995944181e-01   -3.751899494503292e-01   -4.543597460897871e-01   -2.911189115188224e-02; -2.961957168210466e-01   +1.529599071120771e-01   -1.754784928074002e-01   -6.001354577526623e-01   +1.374122719184104e-02   -2.754651530072519e-01   -4.202278786192953e-01   +2.682835650478327e-01; +1.544957941330075e-01   +2.474681891597175e-01   +3.658296057250307e-01   -2.653038616066516e-01   -3.069143320067574e-02   -9.469929684758832e-02   +6.117990248789474e-01   +7.242067324235816e-01; -1.968418011336611e-01   -5.745850091816904e-01   -2.567490800423328e-01   +8.437289945207392e-01   +8.160812410997100e-01   +1.957487539744847e-01   -2.612097437623282e-01   +4.134596219895420e-02];
L3I_L3E_iAMPA_netcon = [+9.945365819008449e-01   +1.734441064317615e-01   +9.202711582586641e-02   +1.555796508824335e-02   +2.966134439784495e-01   +4.532111183866824e-01   -2.200715698098940e-01   +6.842933792675876e-02   +5.618093321942528e-01   -1.905907827962995e-01   +5.319292362733271e-01   +7.212002572769107e-01; -1.334704676179621e-01   -5.812537107824887e-01   -2.193190740361175e-01   +1.895365105983602e-01   +7.033683386491918e-01   -1.413013754873524e-01   -2.676270162853681e-01   +3.928924092604349e-02   +3.888523459175213e-01   +5.134059387666113e-01   +2.689401092612130e-01   +1.575134328756850e-01; +9.077488375366409e-02   -6.151632691824425e-01   -5.047068738438037e-01   -2.054216604296951e-01   -8.344167122274334e-01   -6.371230930346253e-02   +2.953188489429280e-01   +1.836032167415184e-01   +3.713072982904852e-02   +1.913373097622849e-01   -9.519233943199980e-02   -1.704738373020923e-02; -2.716311364210635e-01   -4.856613399731365e-01   +5.289744064643117e-01   +8.551619027681373e-02   +3.740943076122799e-01   -3.578431160785593e-01   -5.593843920504888e-01   -2.579066646981084e-01   -9.831334002433760e-02   -5.400664338783694e-01   -1.358535449058579e-01   +4.101965228858795e-01; +5.381463475962101e-01   -5.824063879416438e-01   +8.512440818735247e-01   -8.304941801956579e-01   -3.935611300178980e-01   -8.347045568733177e-01   -1.113141924226509e-02   +3.040975707081209e-01   -4.451641411757599e-01   -5.964288033017604e-01   -6.166641498045152e-01   -5.621578692865916e-01; +9.383632192286796e-02   -8.599109407272532e-01   -5.890639687683766e-01   -1.278085873011099e-01   +6.180694222797001e-01   +1.006397210782056e-01   +3.317186195195866e-01   -6.461360911882943e-01   -6.642934465376813e-01   +2.530873535929021e-01   +6.472745471847913e-01   -6.692037628360652e-01; +1.039149260159917e-01   -6.568078355587472e-01   +2.218438337482596e-01   +5.612471590021720e-02   +8.108522848266582e-01   -3.522250907788942e-01   -5.232941050995309e-02   +6.404664440112111e-01   -8.493163364307366e-02   -6.863542868589452e-02   -9.150994026761651e-02   +3.448962062570722e-01; +3.364581449496256e-01   -3.447075195149188e-01   +3.838097601824275e-01   -9.692522500270911e-02   +1.593348972113699e-02   +2.232172382355832e-01   -1.635718888763454e-01   -5.763441086971360e-01   +1.990752810890004e-02   +4.210234816215683e-01   -8.551020037372775e-02   -8.046489002427827e-02; -3.925402521005897e-01   +1.570814203787175e-01   -3.124516182305216e-01   -5.636209518175213e-01   -2.111474707518704e-01   -3.902861264370108e-01   +1.000000000000000e+00   -2.393314654369279e-01   -1.385793261226123e-01   -6.370181180367871e-01   +3.986343812265153e-01   -3.006727734757599e-01; -5.658380040263178e-01   -1.365841772562734e-01   +1.979765754875933e-01   +4.898816914024868e-01   -2.797510085597725e-01   +7.119018833931363e-01   +3.878929253880690e-01   -1.888128554118392e-01   -4.516521536242118e-01   +2.310242431048656e-01   -1.912195026715612e-01   -4.366233374719364e-01; +9.415177189709759e-02   -8.830488933858734e-01   -7.101655008338097e-02   -6.750050102791426e-01   +4.263171886352631e-01   +3.623166852085316e-01   +1.094937311915616e-01   -6.783420761603522e-01   -7.267571839547575e-02   -2.826392353006630e-01   +4.683897315131054e-01   -3.647659546678812e-01; -1.489216593711118e-01   +5.972978294679220e-01   +1.112796211426835e-01   -1.134640791952685e-01   -4.777903119775900e-01   +1.823369567547906e-01   -4.421999458062149e-01   +3.047207185734390e-01   +8.139227105263646e-01   -2.766306289675243e-01   -1.146220072763516e-01   +5.152533432775995e-01];
L3E_L3I_iGABA_netcon = [+4.288781069725408e-01   -6.393602222237922e-01   -1.895190393594936e-01   -3.714323441599406e-01   -4.310267083079975e-01   -6.054183765281080e-02   +7.898310046162789e-01   +7.983450517331310e-02   +3.461833259705031e-02   +2.511032481612565e-01   -6.614919846409472e-01   +2.438866372760830e-01; +3.192539832541663e-01   -2.244767162182133e-01   +2.326235229334475e-01   +3.267348990708247e-01   +9.118967657755184e-02   -2.577744285729040e-01   -6.672369407503678e-01   +4.957561257449939e-02   -5.311981824311882e-01   +1.563992147567823e-01   -6.877979012764019e-04   +1.367180826928294e-01; +4.002177945710911e-01   +4.460033063699654e-01   -4.713639813763082e-01   -1.225293371327896e-01   -5.790164698961363e-02   +3.124870405232869e-02   +2.860566208754008e-01   +5.516762411806863e-01   -2.214196762599285e-01   +5.058763763252285e-01   -4.411592657035729e-01   -1.308860765857928e-01; -4.055185385585978e-01   -4.987289715424340e-01   -1.380060962809143e-01   -5.873208469924669e-01   +1.634359792074420e-01   +1.688258831159596e-01   +2.795599141672552e-01   -2.122150745495376e-01   +1.818720104279142e-01   -1.573074794585026e-01   +6.339349176230611e-01   +1.607478799860438e-01; +1.667371204203493e-01   +4.780585097979522e-01   -3.985337915293347e-01   -4.301034363341995e-01   -3.870088055368643e-01   -8.478240510479450e-02   +5.940968555259686e-01   -3.989569223454227e-01   +2.963819837068452e-02   -2.966702552011288e-01   +2.840798129590484e-01   -1.113219590564983e-01; +3.760593260885473e-01   +2.161702984853355e-01   -2.204103524297676e-01   -1.053935138007282e-01   -8.308363346894807e-01   -4.709052358033758e-01   -2.327568116426986e-01   +1.489025508509875e-01   +3.662335122550883e-01   -4.448865991348540e-01   -3.727532632234472e-01   +5.283971880118644e-01; +6.153409087377019e-01   +5.432017732015019e-01   +5.341109130669559e-01   +1.653378317567303e-01   -5.438822187033101e-01   +6.118574421913302e-01   +4.598945872458600e-01   +1.423698779115115e-01   +5.567617969989124e-01   +7.681636472361696e-01   +2.271198636968979e-01   -4.890023252617130e-01; +1.186031182367469e-01   +1.105108597913257e-01   -5.102559967180109e-01   +5.379186637896878e-01   -3.744917232729593e-01   +3.469948030443612e-01   +1.387385939399667e-01   +3.066252528310306e-01   -2.954876835124036e-01   -4.249087814126638e-02   +2.913869185396158e-03   -2.054487323580221e-01; +3.690398161345640e-01   -1.430684140792703e-01   -1.988565636879232e-01   +1.015638979034041e-01   +1.164924386927733e-02   -7.293854935574372e-01   +5.649491219890582e-01   -4.804793927674816e-01   +1.601653942381716e-01   -4.366238845414713e-01   -3.192232259920080e-01   -4.890138043437175e-02; +1.087062659443442e-01   +1.951274214198060e-01   +7.764353864165506e-02   -2.055941879125099e-01   -4.187319436751386e-01   +1.488990910226936e-01   -4.432258804006251e-01   -2.873733758577705e-01   -2.465955239901164e-01   -3.950912348285930e-02   +7.906308481835472e-03   -7.295881348247140e-01; -8.516548764119407e-02   -8.999573105816466e-01   +6.349891299178538e-02   +9.312477462752043e-02   -4.560767448028726e-01   -2.967804429905755e-01   -1.371993785864042e-01   -6.762476257452683e-01   -2.586449341911821e-01   +7.836908456763110e-02   +1.517616294406727e-01   +5.130966510159843e-01; -1.395594790050387e-01   +1.264199345234358e-01   +2.582135861108966e-01   +7.911933369105233e-01   +1.000000000000000e+00   -4.445592556938391e-01   +1.115821480703362e-01   +3.100303014514099e-01   -9.006125369526657e-02   +3.317011343530144e-01   -1.154491207422739e-01   -4.987987149780000e-01];
L2E_Input1_iAMPA_netcon = [-5.545267390056566e-01   -5.323101995556347e-01   +1.330231657059149e-01   -2.675794419983665e-01   +4.487944313570081e-01   -2.295025628621631e-01   -7.897554946865241e-01   -2.726155223257251e-01];
L2I_Input2_iAMPA_netcon = [-3.683126675132382e-01   +4.565921636117524e-01   +1.089341637380112e-01   +5.213649563015345e-01   -3.801213902275247e-01   +3.291725729991352e-01   +8.001386736987892e-01   +5.522473185932090e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.4*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.4*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
