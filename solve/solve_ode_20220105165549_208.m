function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.243438785561323e-01   +4.224078899149981e-01   +5.307921422657206e-01   +6.364674941514218e-01   +5.996590103462931e-01   +3.411528324429274e-01   +6.480554976749286e-01   +8.394191272869421e-01   +5.443930509303303e-01   +1.926438305567842e-01   +4.453900587759709e-02   +8.224334080987065e-01   +7.677875735211664e-01   +1.102097762725923e-01   -6.101043153159254e-04   +8.400055898593024e-02; +9.829594027293050e-01   +9.633106777468836e-02   +3.239237934689495e-01   +9.571244501410117e-01   +3.870280943431864e-01   +6.064192727139794e-01   +6.786134088953630e-01   +8.319343125193297e-01   +7.223477236467980e-01   +1.379885861221714e-01   +7.529884651635338e-01   +4.306335379502156e-01   +1.678086971195983e-01   +1.360073248574417e-01   +8.653279550509819e-01   +6.268669188558883e-01; +7.305405417386694e-01   +5.971392706389342e-01   +1.059376872899784e-01   +2.414572084749806e-01   +9.158508666659410e-01   +1.916672731159163e-01   +6.347136578593462e-01   +2.558825885920525e-01   +5.211292870381945e-01   +6.959922988914331e-01   +2.410395524749567e-01   +8.875402764953590e-01   +8.633731711935957e-01   +6.793495432298845e-01   +6.129162614103533e-01   +6.614158918706770e-01; +3.449110464910803e-01   +4.722773860209082e-01   +6.112723108908429e-01   +6.762377248931843e-01   +8.624561485541891e-04   +7.396992627674110e-01   +9.458178114653165e-01   +6.138452988111875e-01   +9.930826328009377e-01   +9.258498191187828e-02   +4.420810912550751e-01   +3.918624072872238e-01   +9.903477173062188e-01   +4.948858143230472e-01   +9.885616959473894e-01   +7.301845865834166e-01; +5.860465590117425e-01   +6.955434708302684e-01   +7.803022204588047e-01   +2.883813528698415e-01   +4.625036332687406e-01   +2.420332724716218e-01   +2.088818737342220e-01   +5.824451054829842e-01   +2.211641036470879e-01   +5.234195756971379e-01   +6.875017278879039e-01   +7.694924159230236e-01   +5.155652742799818e-01   +1.887975711794187e-01   +5.264563894781520e-01   +8.929092597652042e-01; +1.087526552893287e-01   +7.003264457082609e-01   +4.234667925824649e-01   +6.705582045264468e-01   +4.251374675123881e-01   +9.196236625176019e-01   +7.088243337202482e-01   +5.411950768676270e-01   +1.045504195408445e-01   +5.314993386195680e-01   +3.583346488271966e-01   +3.970019525006823e-01   +8.845394851544688e-01   +4.940699107919422e-01   +4.808437496321149e-01   +9.820112279182932e-01; +9.051144041062903e-01   +6.397229654917734e-01   +9.094354216672908e-02   +6.940582538177996e-01   +4.605001619065172e-01   +2.707641871579612e-01   +2.370843266437609e-01   +8.709325588114224e-01   +1.113262531567576e-01   +8.610502812196567e-01   +7.363269983839309e-01   +8.099798068467785e-01   +5.875816679015934e-01   +1.487831053649349e-01   +8.025668390024593e-01   +7.691265260782025e-01; +8.814572855477086e-01   +3.283803699319414e-02   +2.652287085135777e-01   +6.687854448389988e-02   +7.706016224762937e-01   +7.656660693002276e-01   +1.195418921152599e-01   +2.648545359275311e-01   +6.566254439482250e-02   +4.847498414822929e-01   +3.940176527554192e-01   +7.548770992815307e-01   +1.552543709918943e-01   +5.395632562387850e-02   +2.283383580980114e-01   +5.830382315545392e-01; +8.178012724280217e-01   +6.798530392815273e-02   +1.536847355931265e-01   +2.522087686418898e-01   +3.240491653646542e-01   +1.898788630221439e-01   +6.077319904073183e-01   +3.159276371796516e-01   +4.043146995998320e-01   +3.926228413411716e-01   +6.841787297657761e-01   +3.782012844472929e-01   +1.999875559041813e-01   +8.513796887343557e-01   +4.970839577790317e-01   +9.268354743176092e-01; +2.598646370133215e-01   +3.193219564504937e-01   +2.816732707323235e-01   +2.216428604141866e-01   +7.839276292856859e-01   +2.857812415373368e-01   +4.522677718485888e-01   +1.190511815924755e-01   +4.474254270952087e-01   +6.712968735097369e-01   +7.042219652837104e-01   +2.170296245956349e-01   +4.076090844230841e-01   +5.612079355853051e-01   +8.992244868869884e-01   +5.810741769186646e-01; +5.939535413661127e-01   +5.296115349125118e-01   +4.415333937454424e-01   +6.685168508572917e-01   +4.702663832035923e-01   +9.097503552384807e-02   +4.589863835852669e-01   +9.399882949622300e-01   +3.658654652834914e-01   +7.415977016992658e-01   +4.423683255422726e-01   +7.905549093906151e-01   +7.477328936195916e-01   +9.299324927196698e-01   +5.758160518599579e-01   +1.672491403566159e-02; +2.274679364898651e-02   +6.540722388928780e-01   +5.261564727515884e-01   +8.449827084765780e-01   +3.612767732418878e-02   +5.776904511217259e-01   +6.621196250617410e-01   +6.455854707823309e-01   +7.626533404816606e-01   +5.194417087268266e-01   +1.855489715183775e-02   +9.501362294880678e-01   +8.239742983679784e-01   +6.978693102619178e-01   +8.440412197470166e-01   +1.210434918447057e-01; +4.259998742332908e-01   +4.069420832450585e-01   +4.585775291699251e-01   +3.451773315979775e-01   +1.761926020526793e-01   +6.835311122241998e-01   +7.698305684823460e-01   +4.802865315685242e-01   +6.267837302304388e-01   +3.449154416291595e-01   +3.292293367951621e-01   +3.287890098278046e-01   +7.917756880754305e-01   +5.843049859520958e-01   +7.383677907552679e-01   +8.622235195380161e-01; +3.116334254899462e-01   +8.194586856896118e-01   +8.747621213240664e-01   +7.820870823612830e-01   +7.199467976567644e-01   +5.466403343890442e-01   +3.499988088638551e-01   +6.394189666092198e-01   +7.725661187149376e-01   +1.493736096021984e-01   +4.234709406468183e-01   +6.730570690411177e-01   +3.201634393187388e-01   +8.148831913346599e-01   +5.866308998086069e-01   +4.828637093669912e-01; +1.607981673684884e-01   +7.201378351864272e-01   +5.193414579476308e-01   +6.768282478674843e-01   +4.739986250532892e-01   +4.241054168188780e-01   +6.617978175140947e-01   +5.446007193306784e-01   +9.326140105284777e-01   +5.871231562707699e-01   +2.687869586182588e-01   +4.400247877451313e-01   +5.338758354309884e-01   +8.806232017720840e-01   +2.445462776167414e-01   +8.451201419067260e-01; +1.776904850812110e-01   +9.681287238110624e-01   +9.450161483281898e-01   +6.647932581513483e-03   +1.528121391872813e-01   +6.439445943361652e-01   +4.155975210789455e-01   +6.471298706476456e-01   +9.733164076860821e-01   +2.611479365223792e-01   +1.966301933947243e-01   +8.327112843793469e-01   +8.989151266301754e-02   +9.897179762997282e-01   +6.650638692995534e-01   +2.096392833190814e-01];
L1E_L1I_iGABA_netcon = [+5.509695490271285e-01   +6.947886096455217e-01   +1.054300237440841e-01   +1.770338194108575e-01   +5.424678052572265e-02   +1.785561351512667e-01   +5.963410957257180e-01   +9.970177880870780e-01   +3.393045369961464e-01   +7.787687560846964e-01   +6.837405938108970e-01   +3.653772674516649e-01   +7.828043199346453e-01   +4.322891126863462e-01   +5.964246296451408e-02   +9.659261792045883e-02; +6.311924789081685e-01   +4.987581095913334e-01   +1.428071448704814e-01   +3.986106589587430e-01   +1.777321899833834e-01   +3.606666412186345e-01   +3.001161757274503e-01   +3.308154103779283e-01   +2.941464713582549e-01   +3.376873753705519e-01   +1.323188445503557e-01   +3.693585444987929e-01   +1.012226232681521e-01   +6.550717479782380e-01   +3.138635137431695e-01   +1.414073294640022e-01; +3.230014900020799e-02   +5.357370500985297e-01   +1.679123733735782e-01   +1.338348072973326e-01   +6.607967222084458e-01   +5.601409298873787e-02   +1.347868635747234e-01   +2.971152286559759e-01   +7.458840596903227e-01   +6.079881670813565e-01   +7.234713998381145e-01   +6.848754973085179e-01   +2.930547050885016e-01   +1.116401126169794e-01   +7.719006629954925e-01   +1.681087230495785e-01; +6.141223952215584e-01   +4.435082787309915e-01   +6.225799481056247e-01   +2.889699635888021e-02   +3.327138325167101e-01   +5.224961055804688e-01   +2.109071878599702e-01   +6.226064426953677e-02   +1.077955919882680e-02   +7.413873137700097e-01   +1.096164005686014e-01   +5.979049129338386e-01   +2.359882876149420e-01   +9.316311542035027e-01   +6.957110249800186e-01   +1.958044680220677e-01; +3.634076166490486e-01   +1.240784174759170e-01   +5.738180321997098e-01   +9.383013752802916e-01   +8.980723853700255e-01   +3.345721302899272e-01   +8.963699376809194e-01   +2.980666396097196e-01   +4.748179081335484e-02   +1.052721254401646e-01   +1.170929468167267e-01   +7.890445529537112e-01   +5.300569912045319e-01   +1.855178864762650e-01   +1.253903865921763e-01   +3.181355731576752e-01; +4.985667414394288e-02   +4.914254569794669e-01   +5.341999351586670e-02   +3.027824062604466e-01   +1.166721508727752e-01   +1.739463343272905e-01   +7.156963056734066e-02   +4.430070903935251e-02   +6.674787587680648e-01   +1.266609179206065e-01   +6.406381125739712e-01   +3.681930893980961e-01   +9.303867389751104e-02   +2.661552852917996e-01   +1.275184414219858e-01   +3.176235005115521e-01; +4.870451492070210e-01   +8.531951421483550e-01   +9.322964839854387e-01   +2.955370541148672e-01   +9.887605933087830e-01   +2.111110787613527e-01   +2.427088245594346e-01   +5.057087301691605e-01   +6.043320078964597e-01   +5.487108772359183e-01   +3.291749967813961e-01   +2.052806507270469e-01   +4.055230576520600e-01   +7.981778816010778e-01   +9.143502440986960e-02   +2.171390811545131e-01; +1.920653533909337e-01   +8.744714016296811e-01   +7.283228389082325e-01   +3.354509768318218e-01   +5.415195167488495e-01   +9.054145919869633e-01   +5.450294097868096e-02   +7.609812607542977e-01   +5.263824713408700e-01   +4.853439806131786e-01   +6.539033200977665e-01   +8.728405972103478e-02   +1.043103077957691e-01   +4.880641116153248e-01   +8.276622982015345e-03   +2.519444786062633e-01; +1.219676407516212e-01   +2.712535514758960e-01   +7.374285491681377e-01   +4.687632535567396e-01   +7.058259579128020e-01   +6.750135325345734e-01   +4.410331636209944e-01   +6.312900720962303e-01   +7.301163771616723e-01   +8.898449509222668e-01   +7.502758626829563e-01   +7.720966406686112e-01   +1.103725377555684e-01   +7.689938817239449e-01   +4.245767541934821e-01   +8.932396852436327e-01; +2.064272411634039e-01   +2.103825358221295e-01   +6.359263825768599e-02   +6.475627624539509e-01   +9.994533502265236e-01   +4.684306660395159e-01   +1.480006260596427e-02   +9.137583363014179e-02   +7.077968759714265e-01   +7.997248842492213e-01   +5.842348191547284e-01   +2.074086745440883e-01   +7.860208177427197e-01   +3.975373326851620e-01   +6.559184163114846e-01   +7.028647834771790e-01; +1.465566665504318e-01   +5.635616188252596e-01   +8.597167152484335e-01   +2.427208105890263e-02   +2.878826804561136e-01   +9.122007929078130e-01   +8.971191589722788e-01   +8.080729718744636e-02   +7.807485145537607e-01   +7.353486984743917e-01   +7.407826594882035e-01   +3.895276024414213e-01   +2.911647259645221e-01   +2.726124724896120e-01   +7.229040722003530e-01   +5.551347608950139e-01; +1.887885647428548e-01   +6.388770623272075e-01   +9.330566400459651e-01   +8.426657821438440e-01   +4.132628448775737e-01   +1.039291655769428e-01   +1.955226087019041e-01   +7.748842546068152e-01   +2.884610616248903e-01   +5.317447231891399e-02   +2.343044073050874e-01   +5.513222389162710e-01   +6.039839859009906e-01   +3.731815081237727e-02   +5.303655157838135e-01   +1.841060619164141e-01; +4.301776628791644e-02   +4.161644618939862e-01   +9.840465437233719e-01   +5.580881587221563e-01   +4.665129405820514e-01   +7.446130231033505e-01   +9.308749431450850e-02   +9.056153072173554e-01   +6.907648218441462e-01   +7.316697085291536e-02   +7.346280099679638e-01   +2.288971190634372e-01   +9.641862811367692e-01   +6.733321528691844e-01   +1.081037050310123e-01   +2.120654066742680e-01; +6.354933790042806e-01   +2.063937977893868e-01   +8.577459409087230e-01   +8.534377994583263e-01   +7.643598804886562e-01   +7.376721516746260e-01   +3.075324947344299e-01   +5.333934147513446e-01   +5.551703781753942e-01   +8.689312603763152e-02   +9.712452308972421e-01   +6.419951314707476e-01   +4.313859887110828e-01   +4.310375911329342e-01   +6.323121466998695e-01   +7.695758725832764e-02; +2.819772170366955e-01   +9.487367823805913e-01   +7.856818105568506e-01   +3.489791237342582e-01   +8.174328456635879e-01   +5.622929241242958e-01   +4.557893793452266e-01   +1.079190817624077e-01   +3.950463689326364e-01   +7.960675901511899e-01   +8.678049819436845e-01   +4.829043156208684e-01   +6.947267106108066e-01   +4.509276662137482e-01   +1.291934987863333e-01   +9.137443468068415e-01; +5.381910122881264e-01   +8.083733566217796e-02   +5.143814553788955e-01   +4.465673254826565e-01   +9.926874918449356e-02   +1.850963657801931e-01   +1.021223097533422e-01   +8.270525263030931e-01   +6.163692277898321e-02   +9.418053768465666e-01   +8.713421283922138e-02   +1.514371348195017e-01   +7.580203120766574e-01   +6.090767206635743e-01   +1.342465877217495e-01   +7.067753924361090e-01];
L2I_L1I_iGABA_netcon = [+5.584734936974762e-01   +1.594716619043722e-01   +4.230044352242586e-01   +6.834880754578652e-01   +8.084021305353629e-01   +7.953927408770292e-01   +7.888236416870319e-01   +2.663314314959780e-02; +3.133963293149760e-01   +7.583816760345244e-01   +4.296996191869695e-01   +4.637918206784878e-01   +7.470603279977698e-01   +5.778346040999198e-01   +8.516959949679735e-01   +4.206823187947525e-01; +1.662828298816632e-01   +8.703196772621575e-01   +1.251434143732494e-01   +2.129768446438187e-01   +1.185063811960365e-01   +4.415880495043049e-01   +5.069067908646057e-01   +1.829405353175116e-01; +6.217768381362607e-01   +3.509116581014857e-01   +2.390092411483115e-02   +9.828872939048346e-02   +5.255684417594130e-01   +2.571429401051985e-01   +6.356342140942026e-01   +7.264333672583505e-01; +9.875735910545929e-01   +6.861105168432191e-01   +2.905422028871826e-01   +8.232138181784908e-01   +3.247121818656272e-01   +7.524353857068113e-01   +9.523553950127593e-01   +3.703260181163205e-01; +1.712393486108737e-01   +2.935599100410187e-01   +3.185026260725463e-01   +1.754540433501593e-01   +5.458591306812359e-01   +2.290164107432476e-01   +4.443609321101883e-01   +8.418094632306965e-01; +2.580272049070541e-01   +5.298311285143031e-01   +6.535814738523519e-01   +1.641624999881237e-01   +4.002067282007788e-01   +6.506747464549262e-02   +5.853481295196444e-02   +7.330197153643720e-01; +3.974163614400697e-01   +8.330945363367283e-01   +9.570400749446687e-01   +6.676525717497490e-01   +4.156051375712168e-01   +7.664536403451989e-01   +8.676856807826114e-01   +5.695832180339099e-01; +7.482421773014561e-02   +5.991566969281873e-01   +9.365960474599583e-01   +8.934920366284198e-01   +1.788090440002518e-01   +6.714076102517428e-01   +6.310268473775450e-01   +1.780827593929427e-01; +6.844232623545315e-01   +3.348146758406718e-01   +4.583105142639845e-01   +5.158575202651268e-01   +2.561515006309766e-01   +7.146186389143577e-01   +3.532602552041337e-01   +9.589852909322906e-01; +4.037389596057051e-01   +2.993289127713458e-01   +2.395227973741796e-01   +7.028036485944192e-01   +1.960414804920183e-02   +6.424529569662059e-01   +9.971117910025181e-01   +2.652387157459997e-01; +9.826437568414261e-01   +4.529765120865212e-01   +7.647350155649766e-01   +1.519691421628322e-01   +9.228146926936918e-01   +4.192983463299926e-01   +2.248074783809439e-01   +9.246001524411581e-01; +4.006885205654355e-01   +4.238827719665367e-01   +7.594488939201949e-01   +9.528107404265819e-01   +6.548117710948379e-01   +3.898665985451110e-01   +6.527760797659401e-01   +2.216003336445826e-01; +6.210391559998925e-01   +3.596010156893281e-01   +7.403528705391088e-01   +5.402272422291269e-01   +9.336264525739588e-01   +8.171790261620955e-01   +6.043655440762582e-01   +3.726984709643543e-01; +1.548835135244450e-01   +5.603046801025274e-01   +7.444931610710905e-01   +6.808315152474471e-01   +1.638941857943464e-01   +3.165494028685364e-01   +3.880632740002317e-01   +8.803202698714789e-02; +3.814599342235306e-01   +7.429311438937755e-01   +1.084953224975653e-01   +3.735026102625939e-02   +9.215255751199590e-01   +8.162639033824730e-01   +1.399152266483450e-01   +6.417970017992699e-01];
L1I_L2I_iGABA_netcon = [+1.809302268055613e-01   +9.118870466758929e-01   +2.760383312600399e-01   +8.755956692696210e-02   +5.331173084197188e-01   +1.064763858569295e-01   +9.883065154984579e-01   +4.119605468294703e-01   +7.194599296974848e-01   +2.176841451656624e-01   +9.221150994345108e-01   +6.737602147754810e-01   +1.071254033011343e-01   +5.563552715356902e-01   +6.306756869505377e-01   +4.835268206802222e-01; +4.572370606544088e-02   +7.997586777153901e-01   +2.473434451003101e-01   +8.030267528808459e-01   +8.874494374911147e-01   +6.154341839406955e-01   +7.670371279952938e-01   +6.003468575476986e-01   +9.965941334465214e-01   +1.259841315336876e-01   +7.705164680722288e-01   +4.774896617012919e-01   +1.811077285309810e-01   +7.712981098129141e-01   +9.990573691226144e-02   +8.946273057165883e-01; +7.236431691679250e-01   +7.445935496974651e-01   +4.518283696119773e-01   +9.892453568890854e-01   +8.981638714058989e-01   +9.407150435657577e-01   +3.361851444277904e-01   +7.497361719516398e-01   +3.546189148388340e-01   +3.091104378667021e-01   +4.211478331074040e-02   +6.237878768812347e-01   +9.999158339180782e-02   +3.119683022590887e-01   +3.920114342487623e-01   +1.387194557597437e-01; +3.483974054766473e-01   +8.127486922559571e-01   +2.264880654558412e-01   +6.657508239600504e-02   +6.252579786949046e-01   +3.533460412242163e-01   +6.632495147733498e-01   +5.839506558923468e-01   +9.703767144338291e-01   +7.249716249478233e-01   +3.791061768575255e-01   +2.376816146842963e-01   +4.902479610364690e-01   +1.780746302354412e-01   +5.570300951188507e-02   +3.888811207814456e-01; +6.606559503056973e-01   +3.838643857174490e-01   +8.042311482611663e-01   +9.399064505777172e-01   +1.372347880537498e-01   +4.110450257211978e-01   +2.460270791674309e-01   +5.511950920636374e-01   +3.476893541269595e-01   +7.833562189882919e-01   +7.038683491310816e-01   +1.777291958298913e-01   +1.929897995896004e-01   +3.382038916427214e-01   +5.007592213541752e-01   +9.276181907589665e-01; +3.855023177926210e-01   +6.177615954275968e-01   +9.853711136461607e-01   +1.806863840547914e-02   +2.189794795534742e-01   +9.834394943335455e-01   +2.946837949778442e-01   +5.808088824259083e-01   +8.858897215587885e-01   +6.920768714401661e-01   +7.275606922227983e-01   +8.285659597395862e-01   +8.938576040283215e-01   +2.099080452606049e-01   +4.312529245491140e-01   +9.189089364882690e-01; +6.280829742207015e-01   +5.770778670980724e-01   +3.040816002839042e-02   +6.852035531859553e-01   +1.819477760847257e-01   +9.457051942457488e-01   +6.780368565683212e-01   +5.111498659041012e-01   +4.548409593762285e-01   +9.755309831192235e-03   +2.251481987014201e-01   +7.660932790925239e-01   +9.897857542775386e-02   +5.103454260011445e-01   +9.978747125872416e-01   +7.160316028888584e-01; +2.265038374265425e-02   +5.277436842524849e-01   +5.355535871165834e-01   +7.832648367392617e-01   +4.186014831523504e-02   +6.768263259448202e-01   +5.268724871169275e-01   +8.048074457278673e-02   +4.146823627480720e-01   +8.454593271191395e-01   +2.691845387173811e-01   +9.347848897284776e-01   +4.514485517524480e-02   +9.049197550860165e-01   +8.104768982280519e-01   +6.175705814363714e-01];
L2E_L1E_iAMPA_netcon = [+3.420594850037283e-01   +7.585990029475161e-01   +5.898949290472206e-01   +5.012929744463133e-01   +8.486929454246242e-02   +4.770451537678300e-02   +9.238473143676695e-01   +4.756392802205593e-01; +9.366816013452502e-01   +4.143669956420117e-01   +6.609417797365930e-01   +4.891127187840632e-01   +9.742426543286307e-01   +3.434007371043838e-01   +8.008344714343272e-01   +3.635456217060576e-01; +1.234604122950746e-01   +4.940416989490583e-01   +4.776920721386732e-02   +8.782815139194168e-01   +6.513245586309016e-01   +7.378531982406298e-01   +2.860724243840630e-01   +7.883062772757922e-01; +7.319564394922452e-01   +6.960777686854973e-01   +3.485017476188808e-01   +3.513362566310525e-01   +2.310696279529112e-01   +7.951366181023855e-01   +5.442539889764091e-01   +7.803364076610126e-01; +6.470524475160305e-01   +9.741978450936055e-01   +4.490614921877356e-01   +4.485172237040783e-01   +4.029941335258033e-01   +5.444953464715598e-01   +9.846017839466120e-01   +6.685704710121662e-01; +8.336004655395953e-01   +3.274276741418498e-01   +2.393986174276592e-01   +9.643563535911784e-01   +1.211092949791874e-01   +6.875918437824350e-01   +7.152277651890909e-01   +1.335798463889184e-01; +3.970968483718193e-01   +8.371657797899273e-01   +7.149844373199269e-01   +4.253005372793354e-02   +2.679651082199913e-01   +8.952848852145622e-01   +8.382867858178207e-01   +2.022093596315458e-02; +7.502169364610171e-01   +7.398364341361023e-01   +8.572612896196371e-01   +9.739021739287691e-01   +2.556565307155922e-01   +5.393454302313462e-02   +4.339583493648150e-01   +5.598170960112410e-01; +8.353054564108984e-01   +9.539532508826001e-01   +2.831782826375105e-01   +1.878489522875524e-01   +3.328143814912248e-01   +3.039125028400446e-01   +4.711921123296848e-01   +3.009918409592287e-01; +3.241092384331944e-01   +3.323980680029927e-02   +7.313738454697384e-01   +6.654510123818532e-01   +1.493541950835991e-01   +4.540192108552078e-02   +5.612321742553416e-01   +9.390084817287452e-01; +5.515279614822205e-01   +3.549706298510815e-01   +1.398609362963596e-01   +5.878008295776149e-01   +3.469467599797438e-01   +1.952091999567554e-01   +2.700671611267736e-01   +9.820043631413214e-01; +9.815177197809820e-01   +6.620091265468970e-01   +8.388830338687960e-01   +6.754898034634510e-01   +1.204665252761920e-01   +7.184915612849820e-01   +7.482643632123894e-01   +2.860948120661782e-01; +5.491058585041172e-01   +2.817055909656048e-01   +1.391012084013876e-01   +3.593805960524249e-01   +8.834173095504718e-01   +7.226317515396876e-01   +5.046619925909388e-01   +8.001581840380061e-01; +3.311728218712648e-01   +2.308064999607418e-01   +5.870726627975088e-01   +6.198816442643607e-01   +9.527093949224863e-02   +8.774282421731217e-01   +6.470566618806095e-01   +8.950192441706212e-01; +6.193193173013762e-01   +7.101845656276707e-01   +3.667499721586995e-01   +8.110186249198760e-01   +9.310502315391819e-01   +5.808180243853368e-01   +3.071726192974166e-01   +5.986488587969852e-01; +3.617594428712033e-01   +6.235887143424469e-01   +8.056349123502398e-01   +1.951032691269117e-02   +4.000257834977687e-01   +7.198479089896961e-02   +1.390629839909030e-01   +8.840646296047642e-01];
L1E_L2E_iAMPA_netcon = [+9.428253528199878e-01   +3.731509614156798e-01   +6.681084559948699e-01   +4.852179987326348e-01   +2.470534649255290e-01   +4.524854220554996e-01   +1.237410479262649e-01   +4.968460807814053e-01   +8.824760882312909e-01   +3.249405644682148e-01   +5.147513211224828e-01   +8.642259431841921e-02   +6.318547350365600e-01   +4.290037307193641e-01   +6.128106126402831e-01   +5.033830839898044e-01; +5.484610091145249e-01   +9.358737670777978e-01   +2.080986854931947e-01   +7.570189337520934e-01   +7.843873847943875e-01   +2.058663302525472e-01   +4.064637917231775e-01   +6.932009409886293e-01   +7.202547493627934e-01   +2.462065146772761e-01   +6.575635349899608e-01   +1.632602936472057e-01   +8.584499766740693e-01   +4.921773859109710e-01   +8.204558240529272e-01   +6.122186840893792e-01; +7.287964863585437e-01   +8.286891627070958e-01   +6.535943309069474e-01   +4.161293726210392e-01   +8.827114033207646e-01   +8.986178445592179e-01   +2.753920543959884e-01   +8.337904992567957e-01   +1.848511809105182e-02   +3.423507211528503e-01   +9.511346425805058e-01   +3.245428406740553e-01   +9.758786858872338e-01   +7.142666738074969e-02   +8.866980286108480e-01   +8.197995832308469e-01; +5.773704835796977e-01   +8.506316531024186e-01   +7.194410805372911e-02   +9.719575513010976e-01   +9.126446105185143e-01   +7.630150179511421e-01   +7.170901797949740e-01   +6.117891625542398e-01   +6.747185412503285e-01   +3.756814944775026e-01   +7.225040571822474e-01   +3.012479833852199e-01   +5.697337998030189e-01   +8.874094994358847e-01   +9.304401133736636e-01   +5.331620875248927e-01; +2.595130403291940e-02   +3.718731545237603e-01   +4.069199697791608e-01   +9.898294265796290e-01   +5.583681451776390e-01   +8.835341355372729e-01   +2.824871798063782e-01   +5.751042983112172e-01   +4.387726334856415e-01   +5.459813046057335e-01   +3.997162716949109e-01   +1.120326449040526e-02   +9.965458195770016e-01   +6.481487464817841e-02   +1.922269264305126e-01   +2.026780102189824e-01; +4.473856932410986e-01   +5.930522235716059e-01   +6.665589463531423e-01   +8.636841640750340e-01   +5.985376521906338e-01   +2.867716633002123e-01   +8.953368452840706e-01   +3.243789875868943e-01   +4.362258539618751e-01   +5.631393301419054e-01   +8.341835954668927e-01   +5.410997533084029e-01   +5.537276603344278e-01   +4.360495223020304e-01   +2.574071633394757e-01   +4.543588733715369e-01; +6.480014863561511e-01   +8.743084660765397e-01   +9.358750727890169e-01   +3.879552108545933e-01   +1.480886810351469e-01   +6.705248897226329e-01   +8.265956182121255e-01   +4.560649912659923e-01   +1.158823924203666e-01   +3.954530432020505e-01   +1.353447433901480e-01   +9.662916531292297e-02   +5.153026251402567e-01   +8.252619876467446e-01   +8.970761018233104e-01   +4.284402208379594e-01; +5.221341478084265e-01   +9.336848571007034e-01   +8.093966011135274e-01   +4.530689158640843e-01   +9.015595996782337e-01   +6.641293191009002e-01   +3.896740063293506e-01   +7.140421849553800e-01   +8.146840471973315e-01   +3.968899790813106e-01   +6.020299813984872e-02   +1.468761581216640e-01   +3.315950078125852e-01   +3.923039366644180e-01   +5.935447241645807e-01   +9.654371853053860e-01];
L2I_L2E_iAMPA_netcon = [+6.188636953137699e-01   +6.959693003921391e-01   +7.340817673400487e-01   +5.902883425230181e-01   +6.696090660903468e-01   +5.514927227789798e-02   +9.906037537794651e-02   +8.483787762666444e-01; +6.974193181985299e-01   +4.262848725868061e-01   +4.298660227589107e-01   +4.590228943831062e-01   +5.003986382624100e-01   +1.534263176804259e-01   +9.080986483533213e-01   +9.172100571048593e-01; +7.214271566670991e-01   +8.367065694710654e-01   +6.934605147691136e-01   +5.174334318230653e-02   +2.199017290827178e-01   +1.977540418608668e-02   +1.103857462252839e-01   +9.866697046845252e-01; +3.472642142176857e-01   +7.304885255897791e-01   +9.450524523920494e-01   +2.285745640212782e-01   +5.718476521961495e-01   +4.350320095606429e-01   +5.183250666071847e-01   +5.043375275551544e-01; +5.170652698881592e-01   +3.602527652553443e-01   +7.846388583648776e-01   +8.342953011546719e-01   +1.220711108401953e-01   +8.315962453695439e-01   +1.426239419753527e-01   +2.711001118263534e-01; +5.569158751715285e-01   +4.542080506220283e-01   +7.049428477251927e-01   +1.548109708186613e-02   +6.707960139507489e-01   +6.174219334520301e-01   +5.595392328357166e-01   +1.017046748623224e-01; +1.580739767741455e-01   +3.879602193915587e-01   +1.096373859235577e-01   +8.641693140016762e-01   +5.991078137056169e-01   +5.195832545769610e-01   +4.421346306399329e-03   +5.079250758838930e-01; +5.635144945105832e-01   +7.747164363412177e-01   +3.897399559522676e-01   +7.923248887345644e-02   +5.607076901133826e-02   +8.639446974734943e-01   +7.680612278627036e-01   +5.847283851031250e-01];
L2E_L2I_iGABA_netcon = [+7.643319216219008e-01   +9.414670857269670e-01   +2.384896044384692e-01   +8.336759435693669e-01   +2.573970021007715e-01   +7.557095018198215e-02   +1.737447897261153e-01   +5.235914496970346e-01; +8.270116428142432e-02   +6.566122957992617e-01   +5.784873065269948e-01   +4.021944522960901e-01   +2.982623259207833e-01   +3.939736065498660e-01   +1.401457516509760e-01   +2.643080085302604e-01; +6.599727255494749e-01   +4.522073793601264e-01   +8.658728393437197e-01   +3.910205499749299e-01   +4.247976764205725e-01   +4.208925788778043e-03   +5.980023375170935e-01   +6.844725005652373e-02; +5.172205848164872e-01   +8.397580715105495e-01   +4.052100655457958e-01   +3.624460588154467e-01   +1.178572547612358e-01   +2.200373876762314e-01   +8.997826548883359e-01   +4.361092296434297e-01; +1.718900446008766e-01   +5.333303337223403e-01   +1.117054582797147e-01   +1.378776533384518e-01   +4.973169427060987e-01   +1.225795074019440e-03   +9.386238697254489e-01   +1.731743612714102e-01; +9.405226656522430e-01   +5.537384953957443e-01   +4.436664683519400e-01   +2.575860635856890e-01   +7.068298500403001e-01   +1.899270063997902e-01   +2.204752150176356e-01   +2.660356225224368e-02; +5.911406676260786e-01   +6.805305293332224e-01   +2.981587814867939e-01   +8.622597446012174e-02   +2.441099738613359e-01   +1.420291937783774e-01   +4.810300129228660e-01   +9.538112875011499e-01; +4.401175574347200e-01   +3.675194082969588e-01   +4.014096291321518e-01   +4.297406157096935e-01   +7.847078273218798e-01   +2.680917338128282e-01   +3.775099930118600e-01   +4.308453450096673e-01];
L3E_L2E_iAMPA_netcon = [+9.616980326115523e-01   +7.729831227384427e-01   +9.117239572414680e-01   +5.311567377333054e-01   +4.823587982061427e-02   +8.191693999928698e-01   +6.252011618941851e-01   +7.482605932458839e-01   +6.734981638498018e-01   +9.051917313834523e-01   +5.818681871233889e-01   +5.939323968331347e-02; +7.626552846583919e-01   +2.273390601834543e-01   +9.073888329029581e-01   +7.162449041693689e-01   +5.524282037787027e-01   +7.274610092599201e-01   +5.423003641616639e-01   +6.460112260293629e-01   +4.318641964147609e-01   +3.934154947116437e-01   +6.865914957396968e-01   +9.804042986443412e-01; +7.996470821155259e-03   +3.701486830202189e-01   +5.912469517392193e-01   +1.803786549602573e-01   +2.743783790193589e-01   +1.774222736956441e-01   +4.373458632821307e-01   +1.217964397608812e-01   +6.921162554724761e-01   +2.466326064004446e-02   +7.207863062846142e-01   +2.843729165975152e-01; +6.798180419891541e-01   +8.924986133934448e-01   +3.310746610919677e-01   +3.352164876922074e-01   +2.435708496569883e-01   +3.602415806082482e-01   +2.870395875746520e-01   +5.052032186460589e-01   +2.571203209414233e-01   +6.700702651963230e-01   +6.491556608362314e-01   +5.931348033776106e-01; +7.052190814516993e-01   +8.564589303628189e-01   +8.532911118157920e-01   +1.875953236118068e-01   +2.432604035092646e-01   +1.865929057984286e-01   +5.008122842053837e-01   +3.477492233855585e-01   +1.223865527525511e-02   +8.375840886606485e-01   +7.252179041199699e-01   +9.611953729039816e-01; +6.448960502857737e-01   +4.006224695687422e-01   +4.429609596838444e-01   +3.207911876477341e-01   +1.542687636034803e-01   +9.394115285716888e-04   +7.623403684225638e-01   +9.032551126462925e-02   +5.313537589841004e-01   +9.711686036852558e-01   +3.747746562639336e-01   +1.868926508689047e-01; +5.540356188128385e-01   +3.186164097901659e-01   +9.017180408677052e-01   +4.044285579208290e-01   +9.579304748720474e-01   +3.141157293211986e-01   +7.616956616967906e-01   +1.477754644921079e-01   +2.800088882988194e-01   +5.644311861156441e-02   +5.798752650507292e-01   +1.928339742580999e-01; +2.176989717261559e-01   +6.088594879508514e-01   +3.437843214715734e-02   +5.480655247191347e-01   +9.359018443031688e-01   +6.984660314766009e-01   +5.774272222170936e-01   +1.995865003189257e-01   +9.461319288658445e-01   +4.502544086446001e-01   +1.144655784553909e-01   +3.406739311394379e-01];
L3I_L2I_iGABA_netcon = [+9.332868833005328e-01   +9.307051942477666e-02   +6.244405930432129e-02   +2.789556802549409e-01   +2.539123184334062e-01   +4.042824375915258e-01   +5.290611040462851e-01   +1.084722104057689e-01   +9.121028974701709e-01   +5.837097181673193e-01   +2.084722524854412e-01   +9.080648665364995e-01; +3.911852519776672e-01   +6.167091334820847e-01   +4.950089040397178e-01   +7.456650646949696e-01   +8.574243211679283e-01   +9.873991838441443e-01   +8.292956140068919e-01   +2.710707974172361e-01   +6.395483867371176e-01   +2.834904653709301e-01   +3.180854400647087e-01   +5.514623150650835e-01; +2.722163342528391e-01   +1.094476561186889e-02   +6.432472981794153e-01   +2.378493986042689e-01   +9.113659761366973e-01   +8.991544707320988e-02   +8.575862316124777e-01   +5.234318579725991e-01   +2.553107983536470e-01   +8.282571247194064e-01   +1.339417403829352e-01   +3.454993515910833e-02; +1.522156030563641e-01   +5.737243653875040e-01   +2.226988085192049e-01   +9.580021185738969e-01   +6.991799752079574e-01   +3.227847065827637e-01   +7.878983962723087e-01   +9.727604737522845e-01   +9.051544847903484e-02   +1.920249483022592e-01   +6.730105630995695e-01   +5.401874786485882e-02; +3.969311155966956e-01   +7.877894483093782e-01   +8.375997016523553e-01   +6.217773573206574e-01   +7.256039677106211e-01   +5.134540102068128e-01   +3.189679073841937e-01   +7.089392123864026e-01   +8.384377259962290e-01   +4.416906793989798e-01   +5.699196098882412e-01   +8.062994402255569e-01; +3.748435142679236e-01   +2.350439942589281e-01   +9.709580607607340e-01   +6.008568098040801e-01   +2.302193810468516e-01   +5.911097239628826e-02   +4.530713280576292e-01   +3.109442722582615e-01   +5.844117611313796e-01   +3.930070349674946e-01   +1.701978823404670e-01   +4.511770427308101e-01; +1.299138084324192e-01   +4.479136295880024e-01   +8.462862295077676e-01   +1.725212110242053e-01   +5.749312061737223e-01   +7.259181760439932e-01   +7.531346934931132e-01   +2.942305796927679e-01   +9.487443669251950e-01   +8.269607733487253e-01   +1.479060290429035e-01   +3.809336657210078e-01; +4.339570380700633e-01   +5.696456009392543e-01   +5.067229402801205e-01   +9.000146001627343e-02   +8.111262672026307e-01   +5.571295332264599e-01   +1.107871121396235e-01   +8.502877970662119e-01   +6.110769509936661e-02   +6.793852886866426e-01   +4.762261705526179e-01   +7.909967009099617e-01];
L2E_L3E_iAMPA_netcon = [+3.649772525717092e-01   +7.554084309851339e-01   +7.370115343341938e-02   +5.174068675825995e-01   +7.581338867032738e-01   +4.322797188335015e-01   +2.001140539734655e-01   +8.758117548008421e-01; +5.315831378876485e-01   +9.971073651589426e-01   +5.918302312087163e-01   +9.943989311878400e-01   +9.952588869014503e-01   +5.428408843492483e-01   +1.935557247448096e-01   +7.867394681460173e-01; +7.129735450079484e-01   +1.871864443706123e-01   +9.105869630950926e-01   +8.566276906446875e-01   +9.624326007611523e-01   +7.118501522688462e-01   +3.266705903588928e-01   +4.672280392804620e-01; +8.703587395101701e-01   +7.808204906752140e-01   +1.918016634649933e-01   +9.608958294580270e-01   +5.358430193673129e-01   +1.565568923673755e-02   +8.803099549360524e-01   +8.135237572416301e-01; +3.287590031513650e-01   +1.960340133858786e-01   +4.318800777425897e-01   +6.783272959616726e-01   +9.657918347216657e-01   +8.016855044302467e-01   +4.717113538329140e-01   +8.962037812814269e-01; +6.495234290419817e-01   +9.918873816930676e-01   +7.492499410856861e-01   +4.028276887055721e-01   +1.164769446524607e-01   +1.422060014645493e-01   +4.041911189232346e-01   +4.279276144579182e-01; +9.761984342738617e-01   +8.012027200471770e-01   +4.067175748810539e-02   +9.340220484149160e-01   +5.022232411558653e-02   +4.791445309268643e-01   +1.806803401755118e-01   +3.341034790791972e-01; +7.663510162004696e-02   +4.241936622145984e-01   +9.457552812496330e-01   +4.797671710794397e-01   +3.034209608266086e-01   +2.554393029228102e-01   +9.696447822512501e-01   +5.959828440578236e-01; +5.885688474189608e-01   +7.287229370663453e-01   +7.636709034844951e-01   +2.297233313251453e-01   +5.814746014562364e-01   +3.689263727958413e-01   +4.090083697420906e-01   +9.012931270819229e-01; +4.125539805801113e-01   +4.979342682713386e-01   +5.569481203505289e-01   +3.963717241774667e-01   +5.325618440792127e-01   +6.611729125561464e-01   +8.441796609010230e-01   +7.022915327303315e-01; +3.083051480131598e-01   +8.087189347450051e-01   +1.834403140567715e-01   +7.041675823100789e-01   +9.000633518277834e-01   +1.680614452217328e-01   +6.168169823726739e-01   +3.785763196611324e-01; +2.636895763790250e-01   +3.566306631343057e-01   +5.001452569245852e-01   +5.590516571087628e-01   +5.407656528812382e-01   +2.800453291008558e-01   +3.740627752885199e-01   +7.352117701447460e-01];
L2I_L3I_iGABA_netcon = [+9.545809032065730e-01   +3.132920217279389e-02   +9.115975611384065e-02   +4.595490930794987e-01   +3.272445716407220e-01   +3.674686339632702e-01   +6.851754375714616e-01   +8.048895893992978e-01; +5.424295250978498e-01   +2.083508979211825e-01   +5.936946855242056e-01   +6.387937602195640e-01   +8.048093723324748e-01   +2.095643294577674e-01   +9.094071351053593e-01   +6.655010619201940e-02; +5.386709028610499e-01   +4.548812519745249e-01   +2.407673871362219e-01   +9.163202240172580e-01   +9.995218584553432e-01   +4.406765536621806e-01   +6.108541938718900e-01   +9.487870476924640e-01; +3.091901069404890e-01   +1.265142890149283e-01   +8.389775900680627e-01   +1.609424023145836e-01   +9.796878056181954e-01   +9.548555365552912e-01   +8.997598371439790e-01   +4.951026028352264e-01; +7.011079892323394e-02   +9.187876143703321e-03   +8.572469687889390e-01   +7.134859282551712e-01   +1.257430338365437e-01   +1.236092899048162e-01   +1.942265898565750e-01   +7.540905040947563e-01; +1.820715821706366e-01   +7.270401008416254e-01   +9.615510538339312e-01   +5.769747070136366e-01   +2.303343114354960e-01   +4.694955487884280e-01   +7.534617943086549e-01   +7.400080143054366e-01; +9.243803081198287e-02   +3.533778077164864e-01   +4.886182722025303e-01   +4.323223168239412e-01   +2.339655383710331e-02   +8.551511219209470e-01   +3.475773887017762e-01   +8.305248996127013e-01; +4.639943979281711e-01   +7.784663339349543e-01   +2.184925801262115e-01   +8.830071619740897e-01   +6.077776439674921e-01   +4.231703842754269e-02   +4.190536537430735e-01   +1.557940694459995e-01; +9.541337345793505e-03   +4.361196363638247e-01   +2.270622248401355e-01   +3.908694003628618e-01   +1.094038704574896e-01   +6.898363540404199e-01   +1.535753671839158e-01   +4.566076617156535e-01; +9.142981703235780e-01   +4.366852567559191e-01   +5.365568498600608e-01   +1.771872545661840e-01   +4.063702594223230e-01   +9.773841948185862e-01   +8.191446026967967e-01   +6.185727532164327e-01; +6.421421345780448e-01   +5.029158457640109e-02   +7.615558740074405e-01   +6.315439034819373e-01   +8.830871028881393e-01   +2.836573350012390e-01   +6.227459669478386e-01   +9.297365550903051e-01; -2.820954435278148e-04   +4.793700542880309e-02   +3.465674346852518e-01   +6.236632246494331e-01   +5.479457058547230e-01   +1.338685137225852e-01   +7.400300343167052e-01   +8.336826093681236e-01];
L3I_L3E_iAMPA_netcon = [+8.942735527941766e-01   +2.553055078739462e-01   +7.402916386577801e-01   +6.821061470106229e-01   +6.012432286138863e-01   +7.485394128907651e-01   +7.459824419033386e-01   +2.231323213728980e-01   +4.542038022659130e-02   +8.004717207854775e-01   +2.909520211813697e-01   +8.024826528827006e-01; +5.819194912678664e-01   +3.230162445690212e-01   +6.933668763942206e-01   +2.362218556615059e-01   +8.556163627463772e-01   +5.432167419130315e-01   +1.273296195894473e-01   +3.514034498641602e-01   +2.138545580100410e-01   +2.332526703428665e-01   +4.034903327088599e-01   +1.034558453216055e-01; +5.832341803260364e-01   +4.019573806570292e-01   +8.226908677818675e-01   +4.553335990218568e-01   +9.897918267103235e-01   +3.396819426990889e-01   +8.220066251742413e-01   +2.864291024095932e-01   +3.967038411343940e-01   +9.306213347356936e-01   +8.634018645542870e-01   +8.204963810781438e-01; +8.548599809303695e-01   +4.051765491156454e-01   +8.292128002637379e-01   +3.837354263963288e-01   +9.295576910268806e-01   +8.320695080199432e-01   +2.605383842182025e-02   +9.265903979897903e-01   +3.340809209082268e-01   +7.631063643343895e-01   +6.148861745568076e-01   +8.406322419067916e-01; +3.364142754970599e-02   +3.867514316106840e-01   +2.949058754154740e-01   +5.383750765295849e-01   +4.109018855153436e-01   +5.513489601325964e-01   +4.164128801315726e-01   +5.073010814521157e-02   +2.284237607029862e-01   +8.279121654013637e-01   +9.902449894841862e-01   +3.558437210026026e-01; +8.841524086458160e-01   +6.093055666510589e-01   +3.093249025993612e-01   +9.910020026075076e-01   +8.435036597754942e-04   +9.574182165929856e-01   +7.306789332278034e-01   +5.925069911161975e-01   +9.352180654880498e-01   +5.730296799877700e-01   +2.034119106029337e-01   +4.294879134159105e-01; +4.068181448304316e-01   +1.649653368583853e-01   +5.240456882384368e-01   +7.550247669675491e-01   +5.421110614319427e-01   +8.928156270377487e-01   +7.817357561454082e-01   +1.618188218564730e-01   +6.813748623792891e-01   +7.931378667313626e-01   +8.284107145056240e-01   +5.700885282722109e-01; +3.617760599114474e-02   +1.895926391705038e-01   +3.270483580284353e-01   +9.810528120010774e-01   +2.083419143183072e-01   +3.580906275076916e-01   +3.679959711314547e-01   +8.371625888473692e-01   +9.631762869289305e-01   +3.295550736399946e-01   +6.763998749979865e-01   +6.995901441002798e-01; +7.463073792236740e-01   +9.636261992682034e-02   +8.339666453896207e-01   +2.348735620010808e-01   +2.191835511978023e-01   +5.479695078583008e-01   +7.462402528734988e-01   +1.675321594755231e-01   +4.388039428396328e-01   +2.238220603180275e-01   +2.486319015496452e-01   +7.429175618253442e-01; +1.558264549946155e-01   +3.221409221098527e-01   +8.087905235692219e-01   +5.290485407505343e-01   +3.279530974063711e-01   +3.465003923051489e-01   +8.928897928257385e-01   +5.012812310173613e-01   +9.389218373448729e-01   +3.115929656145391e-01   +4.774053000290381e-01   +7.575912204920819e-01; +1.448527189993388e-01   +7.701703081373275e-01   +5.590487596755161e-01   +5.406107464381119e-02   +9.553146238670006e-02   +6.231861281199726e-01   +2.446104249645168e-01   +9.989420244968780e-01   +5.968700643767714e-03   +5.846114607183623e-01   +3.996162050313127e-01   +3.898326761724263e-01; +6.060614812128299e-01   +2.351520853222070e-01   +2.636395188157823e-01   +7.576179656842615e-01   +7.499553143704604e-01   +7.981139264525418e-01   +1.296486057821193e-01   +3.547251600359567e-01   +6.104457481518094e-01   +8.296726171896429e-01   +5.990705379734957e-01   +4.267642316508976e-01];
L3E_L3I_iGABA_netcon = [+9.557605773320061e-01   +8.845856450098742e-01   +8.003854569257204e-01   +9.852778774612281e-01   +9.020869147186441e-01   +9.619517174347122e-01   +6.533422539997262e-01   +4.957599910082040e-02   +1.085428294646654e-01   +4.522148442404932e-01   +8.291296444568376e-01   +5.810017492335212e-01; +5.724815623911164e-01   +4.376835495967873e-01   +9.861854691019890e-01   +5.604273400132297e-01   +9.950099292192752e-01   +5.423337781642721e-01   +6.540241900444407e-02   +4.666106988742932e-01   +4.615514834543348e-01   +3.342565518860055e-01   +6.265375765024694e-01   +6.367163331314356e-01; +8.505367247347851e-01   +7.821950979838381e-01   +1.588495249723170e-01   +9.325306994034362e-01   +6.518500140634829e-01   +3.132141192281678e-02   +2.750613227112811e-01   +3.246250225005673e-01   +4.508058781694779e-01   +5.897299794982267e-02   +5.397492879968938e-01   +6.508777722666822e-01; +2.765615525619768e-01   +1.494233085066003e-01   +2.373219411171245e-01   +7.204244195421107e-01   +1.072694795901426e-01   +6.956377762974736e-01   +2.815651187314692e-01   +6.308549520427958e-01   +5.506836041031502e-01   +7.404400791893456e-01   +6.503029699504513e-01   +8.630542814893162e-01; +6.224216119670420e-01   +6.201886901924262e-01   +7.018851767802876e-01   +4.849532653851911e-01   +3.731225790113704e-02   +5.200276175432869e-01   +8.789529108225466e-01   +2.294053674312188e-01   +8.064273578775893e-01   +5.059732006172744e-01   +7.261713832455298e-01   +5.654893298694562e-02; +5.898522568841345e-01   +2.602386200424368e-01   +3.773950285869670e-01   +6.393937969459353e-01   +6.191144087211319e-01   +6.035233027934374e-02   +4.446857198800226e-01   +5.802526945795707e-01   +7.013170026278860e-01   +2.013779755679505e-01   +9.408846342462779e-02   +8.188105996711201e-01; +9.642342161027710e-01   +4.447943675225555e-01   +9.749772620032990e-01   +8.874709724494465e-01   +5.656072023271101e-01   +8.890417924815883e-01   +7.578909264565791e-01   +6.039757369690334e-01   +8.725598939778991e-01   +4.265156419413501e-01   +8.786473891841609e-01   +5.289700248841244e-01; +8.680958183572926e-02   +8.448256036259867e-01   +9.707484729622460e-01   +1.974962185578909e-01   +9.620853002386363e-01   +3.304486951962333e-01   +6.016499396819884e-01   +5.995286759225975e-01   +5.229147984068807e-02   +1.678748428236436e-01   +1.253260706367292e-02   +6.952716561793326e-01; +5.013336044808092e-01   +1.980470447228609e-01   +6.421492993490197e-01   +3.963464191835102e-01   +7.474254366073333e-01   +2.285213380839609e-01   +7.830966692975776e-01   +4.479811320810945e-01   +2.190546890986863e-01   +7.515354179293766e-01   +2.921970173709262e-01   +2.123412321299967e-01; +5.217127261286687e-01   +3.032523113302896e-01   +8.601409953779529e-01   +9.919801128074112e-01   +6.628169481151310e-01   +1.139722172596108e-01   +1.143760257395842e-01   +3.390488200052020e-02   +4.588183584205176e-01   +3.670101710786528e-01   +1.794705388683569e-01   +5.438131089720012e-01; +9.064678056641398e-02   +4.803495885527946e-01   +4.016516088097800e-01   +4.012252575934269e-01   +5.239538697377267e-01   +3.119186258224744e-01   +9.775696477215168e-01   +5.126400702783728e-01   +9.588375494483838e-01   +9.420804942799376e-01   +9.265433766183768e-01   +7.040871556229913e-01; +9.065909091207119e-01   +3.373140790838423e-01   +6.315214419191700e-01   +6.592731520316002e-01   +2.594324997749056e-01   +2.270712672377486e-01   +8.489106824060968e-01   +4.067428033175870e-01   +7.921213064645704e-01   +1.556123035294423e-02   +6.888464010539389e-02   +9.553684159275693e-01];
L2E_Input1_iAMPA_netcon = [+9.968337199912830e-01   +9.999732356593203e-01   +9.982498307593004e-01   +9.990930000936514e-01   +9.969551455350615e-01   +9.966877440977150e-01   +9.978265111578329e-01   +9.965074472336316e-01];
L2I_Input2_iAMPA_netcon = [+9.986474529763268e-01   +9.983910133135818e-01   +9.987796081720977e-01   +9.990646723897000e-01   +9.984645699868825e-01   +9.974434511864735e-01   +1.000000000000000e+00   +9.980694158815762e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
