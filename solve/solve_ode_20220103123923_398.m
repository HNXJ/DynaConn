function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.405295202689090e-01   +8.029732156517608e-01   +9.688142452342541e-01   +2.075055405190373e-01   +2.452679328966982e-01   +7.881623519338565e-01   -1.443556935264124e-02   +4.876574891649854e-01   +3.525110697266831e-01   +2.312255735512269e-01   +3.729357663057007e-01   +1.733147718543880e-01   +5.251087316602510e-01   +2.925843062968861e-01   +2.707922478407878e-01   +6.047067802980430e-02; +1.131084627379243e-01   +9.899157015949429e-01   +8.675096667694034e-01   +7.549759538260529e-01   +3.353820231051856e-01   +7.690389150947715e-01   +7.208470271655291e-01   +1.407469058926606e-01   +7.474733574414703e-02   +7.394886555001285e-01   +6.054984606952651e-01   +6.828588120377541e-01   +5.406913257565635e-01   +2.768315699341435e-01   +7.215759609004017e-01   +3.142835136462873e-01; +2.999694927222575e-01   +3.597379698011318e-01   +3.890574437660349e-01   +6.064303464530419e-01   +5.437673349967160e-01   +4.246810616533763e-01   +3.944676923479340e-02   +7.230310862804085e-01   +3.599660662891130e-01   +5.429582962949168e-01   +9.356871371339222e-01   +2.381518024744339e-01   +5.337913108535906e-01   -2.009381858805882e-03   +4.172684913257966e-01   +9.419026096803726e-01; +2.549203948395605e-01   +6.360534469543042e-01   +9.647402898371427e-02   +2.444400699267524e-01   +9.601584588328310e-01   +8.619848627934321e-01   +2.542115323244152e-01   +6.341479084881091e-01   +7.693903862642348e-01   +1.827845320281587e-02   +2.172199845631999e-01   +9.062384608759017e-01   +6.021882544344030e-01   +1.740573911336528e-01   +7.023505434108113e-01   +4.433678521489466e-01; +8.280733847855110e-02   +7.615011263164314e-01   +8.972236537204967e-01   +8.621796632443439e-01   +5.472875531718071e-01   +3.499858998276363e-01   +4.933110139233666e-01   +2.367769479945756e-01   +2.982825661997777e-01   +5.623743453585617e-01   +2.565017572408613e-01   +6.504440611119644e-01   +4.098162686356913e-01   +8.785835867617938e-01   +2.217551880899443e-01   +9.172459243633422e-01; +1.319306112618109e-01   +2.107643607974293e-01   +8.091708946784156e-01   +8.231842685347349e-01   +6.890078775136137e-01   +9.336036283392726e-01   +3.546173811733683e-01   +4.256342735843647e-01   +8.717876538304721e-01   +9.160011466643628e-01   +8.738602625981619e-01   +2.325718461894697e-01   +3.925127205983280e-01   +1.345447474099045e-01   +9.432606203550168e-01   +3.797682109683670e-01; +2.789460173003067e-01   +8.182981041717324e-01   +4.000615162315733e-02   +4.150534853489578e-01   +9.229660850319268e-01   +5.728941708540713e-01   +4.676709917811693e-01   +6.346114186912430e-01   +9.119614333781740e-01   +9.804014681834423e-01   +7.149375143461114e-01   +2.435196105613286e-02   +4.080526623129712e-01   +3.945549855209835e-01   +7.334014517391233e-01   +9.453467512351800e-01; +6.887475821059581e-01   +7.903884199875523e-01   +8.029202598706469e-01   +3.850717753635645e-01   +6.216752156746170e-01   +4.566029684392126e-01   +8.195306055913608e-02   +3.793235692095104e-01   +1.000000000000000e+00   +9.089328720759934e-01   +6.016400206039266e-02   +7.733592828688959e-01   +8.860981724057729e-01   +6.154971135564646e-01   +3.216225649754921e-01   +9.079806322951199e-01; +5.609593407950156e-01   +4.784063442311006e-02   +3.074636072335048e-01   +6.537668791255509e-02   +5.111297884865283e-01   +1.056724977620724e-01   +4.383921086365082e-03   +6.320341650515298e-01   +5.487442539554566e-01   +8.418371218555708e-01   +7.822322125860269e-01   +5.721493734633262e-01   +3.963028579221654e-01   +2.341752164090455e-01   +9.833644981433587e-01   +7.963428727132992e-01; +7.704874195327102e-01   +5.101943248370528e-01   +5.911644473210419e-01   +2.535677987610291e-01   +4.360422661374572e-01   +3.466583097291971e-01   +1.254881357975783e-01   +2.757243013746918e-01   +7.580320012687404e-02   +9.053292882862217e-01   +6.854082028397354e-02   +1.122388228643400e-01   +3.070067307726217e-01   +7.598507311174874e-01   +2.851388320211594e-01   +8.724341394444650e-01; +4.465007113400866e-01   -4.331507228930911e-03   +3.214319202266779e-02   +1.385307466576403e-01   +9.895399795911436e-01   +5.653379115410581e-01   +2.659084371879957e-01   +2.289117779400948e-01   +2.606197181767051e-01   +8.936885288436649e-01   +8.185263609189168e-02   +8.194968331236617e-01   +5.918931114027048e-01   +9.242093792364700e-01   +1.754709345577641e-02   +1.419100180011294e-01; +1.296579152459902e-01   +5.113303181629823e-02   +9.785644897194297e-01   +5.020624397288266e-01   +6.464393500988811e-01   +5.746620223139972e-01   +7.388302317118937e-01   +3.980675307693451e-01   +6.125767470560929e-01   +1.636630834955700e-01   +3.686652100322224e-01   +9.012416131177986e-01   +1.014506390537599e-01   +5.100309443510261e-01   +4.150653268380433e-01   +1.082238889200694e-01; +4.866282036107667e-01   +3.139179696086202e-01   +6.914460081226220e-01   +3.369542397757434e-01   +3.114038742974853e-03   +5.442405270201067e-01   +4.951894160344846e-01   +8.053912053113291e-01   +2.448175372196986e-01   +9.689038037021770e-01   +1.441418078851153e-01   +4.488278994841986e-01   +2.270633704903393e-01   +2.148306632221360e-01   +3.526419966584863e-01   +1.875140684347788e-01; +7.634316452054089e-02   +9.003412178522285e-01   +8.209007559677584e-01   +8.116350462245672e-01   +8.055928774675473e-01   +5.588130162189858e-01   +3.621283267636558e-01   +8.499695965417677e-01   +3.891380174723029e-01   +3.745542081335566e-01   +9.340933765289690e-01   +6.684088687354596e-01   +6.401226462548905e-01   +5.385476780135644e-01   +1.263035290444594e-01   +3.817527419261156e-01; +1.745660263587344e-01   +2.874805458193340e-01   +1.115085279533040e-01   +3.959299109937424e-01   +4.387760343237083e-01   +9.405791133507416e-02   +6.802730354356287e-01   +2.649230956909656e-01   +8.902701711797908e-01   +5.671344549260755e-01   +1.164606675576884e-01   +9.206770610041687e-01   +6.688613212292490e-01   +2.428386172066152e-01   +7.142752208884793e-01   +1.475793717182869e-01; +6.200498227183577e-01   +3.073293870327889e-01   +2.976632232215849e-01   +6.743357426071358e-01   +5.656784938659600e-01   +6.795897449657446e-01   +2.280174548946410e-01   +9.009564817735789e-02   +5.907911799424120e-01   +4.756050706084047e-01   +2.188274743326879e-03   +4.536078521836410e-01   +2.168124748297167e-01   +9.751494478162742e-01   +9.070664321869862e-01   +3.864390847899381e-02];
L1E_L1I_iGABA_netcon = [+5.615600047404230e-03   +2.620386056634050e-01   +9.454080670188638e-01   +2.935299621839413e-01   +4.442248614665615e-01   +1.301872865108668e-01   +2.809834272367901e-01   +3.560054079878102e-02   +2.231713994183921e-01   +5.528803092199534e-02   +4.521161409207325e-01   +9.794484653818410e-01   +1.681107612672534e-01   +8.622949116750914e-01   +1.076309841864089e-01   +4.724996131457917e-01; +7.505121977634304e-01   +8.149999787103434e-01   +4.931314382453950e-01   +8.565199325820779e-01   +7.560126514767602e-01   +8.870596223400962e-01   +6.315480041527358e-01   +8.895834988994309e-01   +9.972641297423610e-01   +9.331305351371477e-01   +1.091907101398807e-01   +1.190070674162094e-01   +5.871220006718595e-01   +9.661246970098983e-01   +9.760273663263117e-01   +2.718370280193529e-01; +3.326639069896240e-01   +8.221327833635721e-01   +1.045711727814008e-01   +6.119338191170698e-02   +9.899180000422352e-02   +2.334062667647638e-01   +6.146966960370943e-01   -1.755445965260139e-02   +1.057790821973446e-01   +1.179607408516235e-01   +5.432099880563075e-01   +4.521694908499605e-01   +8.496224576680450e-01   +8.458525163444227e-01   +8.028517798302460e-01   +7.887226691135396e-01; +3.575884240875605e-01   +5.477362207577999e-01   +6.603033400451398e-01   +7.912759115833475e-01   +6.749469457847644e-01   +6.891852584874164e-01   +6.061332023249985e-01   +9.094653613520985e-01   +4.677151575390547e-02   +3.477501868772001e-01   +5.409562459265870e-01   +2.235300079784993e-01   +8.053506358810518e-01   +4.380031348041440e-01   +9.271154833580842e-01   +5.706256345418378e-01; +7.580247946190818e-01   +6.153525739165762e-01   +8.421849591483305e-01   +3.489511529816941e-01   +9.806217162842515e-01   +5.199534770645148e-01   +3.610673158189336e-01   +4.627585653624071e-01   +2.964798882939544e-01   +1.049579119629495e-01   +3.456839602788178e-02   +5.390409403662046e-01   +9.262456307894467e-01   +7.955580729233406e-01   +1.258654125091914e-02   +1.766546062029082e-01; +2.793561783304072e-01   +2.992332047462795e-03   +2.638618967381133e-01   +1.398165978872957e-01   -9.390703880891887e-03   +4.221254400812287e-01   +9.017285805997690e-01   +3.168389639171021e-01   +5.528454321138613e-01   +4.017953809060972e-01   +9.498988798805793e-01   +2.234396374783599e-01   +2.959552837663681e-01   +2.058884418706816e-01   +7.272276037541441e-01   +4.336558205019498e-01; +6.762338846190912e-01   +5.602447873516383e-01   +3.818536462899697e-01   +7.871302388032624e-01   +2.949210235104745e-01   +8.762222434121769e-01   +6.652314575668731e-01   +5.292609833331708e-01   +8.870949774373733e-01   +6.444047585044862e-01   +9.514592513803100e-01   +2.928651000669026e-01   +8.009347237030265e-01   +6.340678777293252e-01   +9.630880608388082e-01   +8.391232478696705e-01; +9.718050256324975e-01   +1.459884038902041e-01   +5.924116623285334e-01   +5.120741571748029e-01   +6.469357207966990e-01   +2.082795811185631e-01   +3.201356165960894e-01   +6.192315283787805e-01   +2.118550725107269e-01   +7.829562073345480e-01   +8.115195419549079e-01   +9.620816957672985e-01   +3.097367550130317e-01   +7.948426703465918e-01   +4.857310879519159e-01   +6.377487724078544e-01; +5.613664231124119e-01   +9.828250798794641e-01   +3.767933670908418e-01   +9.755585427151676e-01   +2.228786645363462e-01   +6.874450793604102e-01   +6.122526512349009e-01   +1.000000000000000e+00   +8.529455766603259e-01   +1.250362263679146e-01   +2.134542632636761e-01   +2.051525569217025e-01   +8.622251894230484e-01   +2.375281146004350e-02   +4.798831778526258e-02   +4.485470932119494e-01; +2.903165564471599e-01   +3.833328675007874e-01   +5.746133744503765e-01   +2.879555495304975e-01   +7.974111264105214e-01   +4.275026835190551e-01   +3.517776034016357e-01   +8.868092354216347e-01   +9.196941057206268e-01   +9.293530925482339e-01   +7.915909557839019e-01   +9.356425377995891e-01   +4.952657196349799e-01   +3.863653563873649e-01   +3.521989630389753e-01   +8.586677390644405e-01; +1.260306840787052e-01   +2.513118627453285e-01   +7.897080589428259e-01   +8.947966650775864e-01   +1.344485445399467e-01   +6.055785675199223e-01   +7.775245702650446e-02   +4.645214958743361e-01   +3.813922675539468e-01   +7.086936233267856e-01   +2.886632632254261e-01   +8.932330289865594e-01   +8.354059439818334e-02   +5.022412143760868e-01   +4.817721089626587e-01   +5.226656947176416e-01; +1.438584811488069e-01   +9.380046230379152e-01   +7.410073588762324e-01   +5.238364098807861e-01   +5.105377666152029e-01   +7.300103544027245e-02   +1.544252694334394e-01   +3.716708164582844e-01   +1.400630927527207e-01   +5.725064300836460e-01   +2.965789480493413e-01   +4.478171365010885e-01   +4.255115442712135e-01   +8.898925196276031e-01   +7.297349933615285e-02   +4.633539327620713e-01; +8.941544620184320e-01   +1.237159725705782e-01   +4.787118120434646e-01   +5.619422386182420e-01   +6.774610725749732e-01   +6.062484896143787e-01   +1.541729980913498e-01   +5.631764248652892e-01   +5.198910113906945e-01   +3.360755124217210e-01   +9.781313235764012e-01   +9.574192846367162e-01   +8.446287697031460e-01   +5.828068940896252e-01   +3.235795170901243e-01   +7.665038591324074e-01; +4.474420376075512e-01   +8.769285896496766e-01   +2.904904724013836e-01   +4.172754639497114e-01   +7.504625613788432e-01   +1.532066209351112e-01   +3.526318548599623e-01   +6.218937746426939e-01   +3.312799112014304e-01   +4.478284759164523e-01   +1.616317726561310e-01   +1.263617393003582e-01   +3.166320669969875e-01   +2.794746145636650e-01   +6.238789285148386e-01   +9.127696955236747e-01; +6.245788767276580e-01   +6.327345611193017e-01   +6.804723038098167e-01   +7.048188017908935e-01   +8.453061335398958e-01   +5.121413575231054e-03   +8.585528217036992e-01   +3.463252459553962e-01   +8.104331226633653e-01   +4.889220736999026e-01   +7.078394147970982e-01   +5.849067722649700e-01   +2.275997698145020e-01   +5.194048258516782e-01   +9.179758992550967e-01   +5.058157132725732e-01; +4.609988457431616e-01   +6.212577042995933e-01   +6.197719200396461e-01   +2.786119163479984e-01   +4.490205213702928e-01   +3.041637195541902e-01   +5.955036795245851e-01   +2.317353301182513e-01   +9.077601360868902e-01   +2.982603821368800e-01   +2.359687376709005e-01   +1.724836631384764e-01   +7.959281649485234e-02   +4.936924485984603e-01   +9.344771520625587e-01   +9.654025476620213e-01];
L2I_L1I_iGABA_netcon = [+7.337149569622669e-01   +5.060552523184215e-01   +7.269497522110662e-01   +5.734639978934306e-01   +9.895877358910948e-01   +7.537169371730961e-01   +9.379779960782347e-01   +3.924989352518216e-02; +5.587260379486269e-01   +9.398595367712954e-02   +2.184778026620831e-01   +8.983722338028395e-01   +2.037856950615486e-01   +5.375014703064890e-02   +9.116074237324968e-01   +7.950931457562531e-01; +9.952214087263527e-01   +5.218518229633148e-01   +7.071964192004984e-01   +6.802994683862514e-01   +8.667890369576943e-01   +7.826867226099496e-01   +2.683827616578982e-01   +1.835570089889974e-01; +4.234327442130657e-01   +1.718195969840015e-01   +9.379268229005339e-01   +4.561802464196480e-01   +8.431959114388752e-01   +3.889629694099150e-01   +9.028414313109013e-01   +2.255264103483157e-01; +8.048432937525970e-01   +5.242771823875965e-01   +6.992177357970112e-01   +2.907210770316503e-01   +9.857643241142243e-01   +4.386197026259270e-01   +6.154843057498371e-01   +2.256748697735491e-01; +5.776288680562734e-01   +6.193518997803730e-01   +8.045686630775689e-01   +2.376459187596738e-01   +1.987865594902608e-01   +8.163213452274202e-01   +9.749489745444505e-01   +5.951897680489430e-01; +9.613725887462915e-01   +4.931107057201440e-01   +2.575159883206919e-01   +2.716444739173953e-01   +8.079557506645536e-01   +1.825561992189984e-01   +6.888023261042669e-01   +3.471664778494235e-01; +1.000000000000000e+00   +4.064798643602802e-01   +7.243089493093996e-01   +9.474540140508585e-01   +1.283156495387921e-01   +4.680948047553289e-01   +4.434390992355837e-01   +2.803353410761604e-01; +8.139858940731061e-01   +1.791761823524748e-01   +4.947323134946904e-01   +5.848250006346250e-03   +8.488043304738192e-01   +3.619252707514541e-01   +8.117464417708383e-01   +8.022679607292817e-01; +4.247169644629964e-01   +9.515501082821574e-01   +7.226911742718155e-01   +8.521178549784827e-01   +4.115289425492454e-01   +8.614575930310502e-01   +9.802632114888159e-01   +3.200615223114442e-01; +5.200022845977431e-01   +6.502841748236523e-01   +5.437909249364216e-01   +4.437228289059750e-01   -7.184839081553251e-03   +9.846968108908077e-01   +7.216817263640976e-01   +4.745086165101676e-01; +1.744048267629600e-02   +4.002967882402585e-01   +3.731912062520295e-01   +4.357560640823270e-01   +3.702657401348748e-01   +6.196275009471849e-01   +2.934355468459116e-01   +6.097536515875406e-01; +4.634441115907355e-01   +1.811965400980514e-01   +6.940721629413296e-01   +7.765156184019055e-01   +2.096845368716590e-01   +6.863287760938835e-01   +4.110877547268323e-01   +8.351107912587616e-01; +4.596203522314904e-01   +4.776208427269132e-01   +7.651615008591208e-01   +3.929806878279582e-01   +9.858117891570272e-01   +4.261491903020286e-01   +3.728420289922654e-01   +3.325208025621320e-01; +6.582899122128983e-01   +1.443525554232712e-01   +3.332739597522502e-01   +2.895805463205922e-01   +6.276791813770797e-01   +6.628027268403165e-01   +3.494523299515292e-01   +7.819416777454378e-01; +8.472770172775292e-01   +3.989494179642743e-02   +7.555507080551046e-01   +2.952052775154763e-01   +4.338205026440288e-01   +6.692197059273588e-01   +1.463548945630632e-01   +3.319759533991661e-01];
L1I_L2I_iGABA_netcon = [+5.479102242647178e-01   +2.037440560375071e-01   +7.994208252539102e-01   +3.095094121280915e-01   +6.528369404360821e-01   +3.365095137325365e-01   +8.602685489738857e-01   +2.281893440003868e-01   +6.342636948781772e-01   +9.593921702561531e-01   +4.336940114856759e-01   +4.704375092920974e-01   +7.986840306286470e-03   +8.033875516826708e-01   +6.652865204408918e-01   +4.647661041050051e-01; +4.173278954575155e-02   +5.940179846871743e-02   +3.318614409106097e-01   +3.382991309173638e-01   +9.182441230021263e-01   +3.511858697783712e-01   +3.472102197094258e-01   +1.471716110081753e-01   +4.589496491459659e-01   +2.301522914934823e-01   +3.052614013944887e-01   +2.768984577110167e-01   +9.383453157948244e-01   +1.651363503739095e-01   +9.066665763009474e-01   +2.278465422632538e-01; +3.482364662624481e-01   +6.563033491993771e-01   +4.033196545241868e-01   +7.352426086574216e-01   +2.625286009995189e-01   +5.320412066374437e-01   +7.667858891058754e-01   +8.711466158349515e-02   +8.135075285828512e-01   +5.063979315040154e-01   +6.590098093172290e-01   +8.959550627794159e-01   +9.833238852563309e-01   +6.838982758756913e-01   +3.187813956015836e-01   +1.302506872665610e-01; +8.969281050888551e-01   +1.620826637022901e-01   +6.271915816000283e-01   +9.801790072110699e-01   +4.932390538276533e-01   +9.500138808430787e-01   +6.696632455471423e-01   +6.756769883641973e-02   +6.042055417436210e-02   +3.635596848856325e-01   +4.437076582464209e-01   +5.537217355351707e-01   +3.122829106753469e-01   +5.131488285670360e-01   +1.812264543123941e-01   +1.467292735732484e-01; +9.683395879348081e-01   +8.052557040719747e-01   +7.563100980467760e-01   +7.117721662447057e-01   +3.112445497498391e-01   +6.646700195516195e-01   +7.307699586065992e-01   +6.854394773110232e-01   +8.084963873966017e-02   +7.082455202006263e-01   +2.144495348363553e-01   +3.962939818001762e-01   +5.257032877915950e-02   +2.284819469257961e-01   +7.464433290150467e-01   +9.795239103703148e-01; +5.835090096665582e-01   +4.504179849375788e-01   +1.173026247051482e-01   +3.807118584610684e-01   +9.741390711218451e-01   +1.554407326246375e-01   +7.224730235666048e-01   +6.895507912466878e-01   +5.617730043363385e-01   +7.754227225298338e-01   +3.265236532051928e-01   +4.788158142880911e-01   +8.957686988745803e-01   +8.458608901593639e-02   +1.650010462836621e-01   +7.218601279678219e-02; +8.088943004271315e-01   +1.073412473250475e-01   +4.130080090715737e-01   +3.344916239652419e-01   +5.727945206756414e-01   +9.297163837954038e-01   +4.973403829663229e-02   +2.297317272390650e-01   +7.712326573491743e-01   +9.573344637191337e-01   +9.013152694621339e-01   +8.789088603974001e-01   +1.423618135724318e-01   +3.538258260061368e-01   -2.005098071098654e-02   +6.199372010287952e-01; +8.586215848589573e-01   +4.143173390661450e-01   -1.001225634808433e-02   +9.036874158339591e-01   +2.166886022561463e-01   +9.684154546092401e-01   +8.157124479152006e-01   +1.305762702059978e-02   +7.967852843342740e-01   +6.592126062267552e-02   +9.293636114648945e-01   -1.251741912509277e-02   +8.481778872536012e-01   +1.031432902877923e-01   +9.764212932804129e-01   +7.081977074236245e-01];
L2E_L1E_iAMPA_netcon = [+2.862587614209874e-01   +9.130734736396033e-01   +6.396204321830010e-01   +5.365903033789664e-02   +3.318313284080863e-01   +4.092825377877829e-01   +1.265628676509010e-01   +6.085319421812627e-01; +3.050006475174624e-01   +1.816490448567299e-01   +7.471284813109375e-01   +9.146293646579630e-01   +3.405922031950059e-01   +5.543429781707636e-01   +2.900258172568216e-01   +1.301968263377775e-01; +5.219247845778072e-01   +9.090093126883297e-01   +7.919530821783746e-01   -4.471726095281001e-03   +6.595752475165539e-01   +2.153050583818078e-02   +4.320515477248071e-01   +8.288107907039322e-01; +5.242048648317967e-01   +5.946966476485031e-01   +4.170943160922110e-02   +5.759967092124323e-01   +2.547043276371119e-01   +5.090464412552385e-01   +2.170401866162924e-01   +4.454889030435430e-01; +8.276341274113356e-01   +7.638549458703479e-01   +7.830649379367493e-01   +5.154485744520474e-01   +7.809783596002705e-01   +3.514556192526258e-01   +4.897463613029474e-01   +5.291449676807229e-01; +4.878904224977939e-01   +6.801061688185827e-01   +2.638323715240960e-02   +6.325206356210986e-01   +6.471073724513613e-01   +8.827096807647415e-01   +2.182002003599594e-01   +4.627301645547505e-02; +4.702584729672343e-01   +3.383908107357114e-01   +2.580174316436504e-01   +3.775896771472260e-01   +3.976974704451908e-01   +2.619045903349370e-01   +5.212738020301414e-01   +3.014089939845013e-01; +7.460728324142166e-01   +1.650463307775274e-01   +1.833659828494638e-02   +9.461628921050880e-01   +5.330318225348025e-01   +3.662303021534267e-01   +5.415310505778888e-01   +6.149976724340838e-01; +7.473317936465881e-01   +5.921644769277903e-01   +6.529983748353883e-01   +1.410911873434733e-01   +3.726290601341202e-01   +2.421301953006489e-01   +1.119652875177600e-01   +1.000000000000000e+00; +1.421232868866505e-02   +1.500861626760082e-01   +1.365447789582725e-01   +1.972024309822782e-01   +2.389996075431567e-01   +6.014877401509477e-01   +8.698057945603872e-01   +8.302602414473149e-01; +2.855907521961904e-02   +2.231441554119915e-01   +6.102608994075235e-01   +5.308730058253435e-01   +1.501558293821924e-01   +4.407460116057125e-01   +1.736571761718892e-01   +7.278369330264315e-01; +4.041666933842404e-01   +4.924520438944050e-01   +5.777298642664187e-01   +5.068437696614128e-01   +6.801647253048247e-01   +3.305983508688142e-01   +6.332430778833905e-01   +4.661756104788307e-01; +6.450914291602540e-01   +7.296463760408826e-01   +6.482121876158570e-01   +2.731626465236206e-01   +2.138671823621150e-01   +7.794409468937648e-02   +1.158057900696710e-01   +5.861986105048008e-01; +7.701397688860249e-01   +8.348992575639609e-01   +5.902018292039293e-02   +9.054143463907752e-01   +4.701205079705401e-01   +8.766258280034918e-01   +5.203034186551768e-02   +2.146033969003823e-01; +9.267632102136379e-01   +2.111168163562870e-01   +4.023414111208080e-01   +5.561837990905085e-01   +3.591545836180058e-01   +2.244171276537910e-01   +6.217132942885415e-01   +3.960629125721049e-01; +8.324444938991754e-01   +6.112628091293322e-01   +6.833184444560157e-01   +3.824590429333999e-01   +5.223981178023412e-01   +8.739728570595412e-01   +7.805721910280274e-01   +1.200565374782080e-01];
L1E_L2E_iAMPA_netcon = [+8.866310313613501e-01   +4.948688386964324e-01   +5.616970530636413e-01   +7.871192545685674e-02   +9.672911046579111e-01   +2.722363830944332e-01   +5.209064977177188e-01   +5.216680943101504e-01   +9.825756046015549e-01   +5.387597159477351e-01   +6.490695581084471e-01   +5.187918259597341e-01   +5.271152763044326e-01   +3.564608392377644e-01   +5.342275769702275e-01   +2.115589166995033e-01; +8.021444520394144e-01   +2.303929494662660e-01   +1.039532407954993e-01   +5.679198898588389e-01   +8.219054935533234e-01   +6.359102485719706e-01   +9.282372890296836e-01   +2.647242800927980e-01   +3.598516377345219e-01   +3.337493384165922e-01   +8.004538743531459e-01   +6.610143591409122e-01   +6.716359241773497e-01   +9.051158591987642e-01   +3.698494665077514e-01   +5.476251911447950e-01; +8.033858148937704e-01   +8.193327060793652e-02   +1.166274564879747e-01   +9.530983990856484e-01   +2.813538965954739e-01   +3.795399488100193e-01   +9.620671381291064e-01   +2.961051981211062e-01   +1.944954821632280e-01   +6.079587757129462e-01   +8.777338730961862e-01   +4.748468265434131e-01   +8.676718026314497e-01   +9.909599561198582e-01   +8.422444062374314e-01   +6.443118705347093e-01; +7.282517259890340e-01   +1.064987933018637e-01   +5.446969012893275e-01   +3.865905825070221e-01   +3.872839646174658e-01   +8.225979032650321e-01   +2.206547595014481e-01   +1.457659571023662e-01   +6.212401630678505e-01   +4.479067956661577e-01   +3.678454541088768e-01   +9.733088656429045e-01   +7.565738391307325e-01   +9.367235073430408e-02   +7.611912438707220e-01   +7.948680207726212e-01; +5.087610667946719e-02   +2.766692568964502e-01   +1.521888968795574e-01   +7.816610888092902e-01   +2.157611608225773e-01   +4.865146739268803e-01   +9.769609045951981e-01   +3.017551804661023e-01   +1.354445890159523e-01   +7.625071956659440e-01   +6.704184082360307e-02   +5.773254221083063e-01   +8.304938780270384e-02   +6.247725502834284e-01   +3.937294292624193e-01   +1.324452094939616e-01; +6.662484600062983e-01   +4.485515924953139e-01   +3.936517710654633e-01   -1.893924572616279e-02   +9.537235981258663e-01   +9.447726377576780e-02   +4.855070394967805e-01   +1.828175015231195e-01   +7.930950345701885e-01   -2.070021274117776e-02   +7.660054541172333e-01   +5.908956048703425e-02   +7.327594784450945e-01   +5.450140910493848e-01   +7.017361144279143e-01   +3.435570196461604e-01; +3.093901372058105e-01   +6.692469257673923e-01   +4.078327751839303e-01   +3.927158123817308e-01   +3.925886991768818e-01   +9.001958615014076e-01   +9.363993801869368e-01   +4.025452440843841e-01   +6.824429173618535e-01   +7.740636071025190e-01   +8.150540662221251e-02   +1.244419213555471e-01   +1.016126795527506e-01   +3.679896712384255e-01   +3.408015194705254e-01   +7.786701406027623e-01; +1.850937271414176e-01   +4.604488579871241e-01   +3.097728552607907e-01   +4.240565274077603e-01   +9.384666427950665e-01   +4.818670187381903e-01   +9.667886989807841e-01   +9.156823921022750e-01   +3.691596288019522e-01   +7.959308888425920e-02   +3.691348600066707e-01   +3.134493156613024e-01   +3.327444802738812e-01   +7.587215441270035e-01   +5.871233158300798e-02   +5.595312598360260e-01];
L2I_L2E_iAMPA_netcon = [+3.921086607212184e-01   +2.183798395390803e-01   +4.432017235151225e-01   +5.859798843945689e-01   +1.801653483021924e-01   +8.817503268080769e-01   +6.651041218241524e-01   +3.013361094741936e-01; +5.218433488531521e-01   +2.312564644852567e-01   +6.147585746992431e-01   +2.669034878820044e-01   +6.589214897763694e-01   +8.039315979427352e-01   +8.175221393054107e-02   +4.923396264191643e-01; +6.294735798401160e-01   +1.020435335904979e-02   +6.885417971759393e-01   +6.236741436285164e-01   +1.636918320581430e-01   +5.993822432421456e-01   +8.359931069426965e-01   +4.324284865242881e-02; +4.810300566188842e-01   +2.894574210984237e-01   +6.914393242895986e-02   +9.656753623447217e-01   +3.540827849770922e-01   +6.172860304390044e-01   +9.472864858198469e-01   +2.097772532359729e-01; +1.489302890912795e-01   +4.326038122450356e-01   +3.882529047380489e-01   +8.217843234705245e-01   +8.278034160384844e-01   +5.982996164382127e-01   +6.916894051371877e-01   +3.123462588839806e-01; +9.000507844278405e-01   +4.999837459511837e-01   +8.968216754745566e-01   +8.520034844162363e-01   +7.218023483887693e-01   +8.181847412003561e-01   +8.904335152770350e-01   +5.324081081120945e-01; +1.455172257871011e-01   +5.610749960057301e-01   +9.450256648672152e-01   +9.332484883264812e-01   +8.114275844786693e-02   +7.799131443788687e-01   +2.788857931878596e-01   +8.649011431000388e-02; +5.609836818243076e-01   +3.883206624986096e-01   +1.894344919011597e-01   +2.957700527629312e-01   +7.227536469281824e-01   +4.124272355130469e-01   +9.641447954552039e-01   +6.337365201786695e-01];
L2E_L2I_iGABA_netcon = [+4.818937753066304e-01   +6.498881156558134e-01   +6.650056221854580e-01   +6.685012232128368e-02   +4.943401469797805e-01   +5.197561080567500e-01   +3.253477033108698e-01   +7.624177649655789e-01; +4.564976724698692e-01   +3.700095349924813e-01   +3.361788178366031e-02   +4.850685065425460e-01   +4.979447595627532e-01   +6.147855236015921e-01   +4.811992665803966e-01   +4.822541595053116e-01; +6.204526156697802e-01   +5.068419733179622e-01   +4.171496763664668e-01   +5.549028579971327e-01   +3.204728335399475e-01   +2.696517754135486e-01   +2.214374278738842e-01   +1.000000000000000e+00; +7.495987997044460e-01   +5.694926224964166e-01   +4.219940228796333e-01   +8.899292749036979e-01   +2.355085153756765e-01   +5.680815198746365e-02   +1.467290296261287e-01   +4.652123802732991e-01; +5.307219644672619e-01   +8.323891571796832e-01   +5.468433009772640e-01   +8.450575232879837e-01   +3.930048427728681e-01   +7.814962619756973e-01   +7.123007824544221e-01   +3.254573498659701e-01; +4.080028250565756e-01   +2.583924510877694e-01   +4.994282450112874e-01   +3.761665598094114e-01   +7.961816943043512e-01   +8.756108569274708e-01   -2.627084377334781e-04   +4.655355932070041e-01; -8.170397767649065e-03   +4.858792785840086e-01   +8.780141118920362e-01   +5.581764666125064e-01   +5.036862989873477e-01   +4.030171905723831e-01   +9.505277297882178e-01   -1.024489328560818e-02; +9.479545039924464e-01   +5.475043178013200e-01   +9.389304891894957e-01   +4.849803487511044e-01   +9.563499306307397e-01   +5.712504829416203e-01   +3.816909297809201e-01   +3.591210152287740e-01];
L3E_L2E_iAMPA_netcon = [+2.218545375514423e-01   +9.431473425937894e-01   +4.470651927491384e-01   +7.734131856375237e-01   +1.715462819900890e-01   +4.289006333693837e-01   +4.213855795305873e-01   +1.147010612449722e-01   +1.426468916396257e-01   +5.614368278215118e-01   +1.553100052668659e-01   +4.788677250131501e-01; +2.460861856212199e-01   +5.023906467795823e-01   +2.032259907925462e-01   +2.406411960446155e-01   +6.385934053382831e-01   +9.333444236557669e-01   +7.422513417152461e-01   +6.211258235542700e-01   +2.795727144719486e-01   +4.838984942656296e-02   +1.200796006094933e-02   +1.008206876749696e-01; +8.123767427544623e-01   +3.620896583636102e-01   +5.667030481338428e-01   +1.093078814428429e-01   +8.905908176487352e-01   +8.482418331281057e-01   +5.266447996645754e-01   +7.302784340664765e-01   +6.794201805656018e-01   +3.875799807593732e-01   +4.274704001869932e-01   +9.118700976983772e-01; +2.004911495319735e-01   +4.277610703626155e-01   +1.919311460623805e-01   +8.249331218381079e-01   +5.255632580236897e-01   +6.015142785435700e-01   +8.911248137816674e-01   +2.875678878337182e-01   +8.230908078878780e-01   +8.159536414593944e-01   +4.772069083275948e-01   +2.171359591998565e-01; +2.265554032908859e-01   +8.353672429012704e-01   +4.332125333117265e-01   +6.782650275922943e-02   +2.057641285785854e-01   +9.642906882001152e-01   -1.503047167257921e-02   +6.933690939349673e-01   +3.302020606075582e-02   +8.174977604741737e-01   +2.948728553616044e-01   +2.515622579046420e-01; +3.980274381776112e-01   +3.689315079804891e-01   +8.511746252765413e-01   +1.000000000000000e+00   +4.063830582504643e-01   +9.835202443802843e-01   +1.151394848883854e-01   +4.235043738754715e-01   +4.933399234909579e-01   +7.920840190330733e-01   +6.747243663376294e-01   +8.541083174239770e-01; +1.697444038925757e-01   +5.233051668859469e-01   +6.120645460813033e-01   +9.345057717469996e-02   +6.387637354247868e-01   +4.975702658579071e-01   +7.898966849280030e-01   +1.587072642553313e-01   +4.586882613315730e-01   +3.880951870934636e-01   +9.688747038955660e-01   +7.686138875330228e-01; +6.110505857978014e-01   +4.899629633913439e-02   +4.031410489763023e-01   +1.907725135205336e-01   +3.157587606889242e-02   +9.179354209901893e-01   +3.905943176995493e-01   +4.436226643810430e-01   +8.945253523587192e-01   +9.852543221233121e-01   +9.314920310136766e-01   +3.518132993832384e-01];
L3I_L2I_iGABA_netcon = [+1.258911672095999e-02   +4.215160288209621e-02   +4.592598816878148e-02   +6.577892753149628e-01   +9.781617292878995e-02   +4.576184452725097e-01   +8.390576395198492e-01   +4.153432045821166e-01   +4.291014608469321e-01   +9.970707763338060e-01   +9.127585000318831e-01   +6.332241922132551e-01; +3.369979553702254e-01   +4.346636726011043e-01   +3.103615950185412e-01   +3.406376724242783e-02   +4.544619517444978e-01   +5.970124476962008e-01   +4.521960790084008e-01   +8.797044295945692e-01   +1.110863192819088e-01   +9.246174919277254e-01   +3.269342354823219e-01   +6.389927301348339e-01; +3.170723922406141e-01   +7.268616192250700e-01   +3.101684254870806e-01   +8.146674684841234e-01   +3.364483601256948e-01   +8.429494737154017e-01   +9.472233556287419e-01   +3.975079917780364e-02   +6.110680805013307e-01   +4.900210471805627e-01   +1.410506511586418e-01   +5.554943809476827e-01; +6.441219043753994e-01   +9.685889490678543e-01   +3.456463385682655e-01   +2.684352202958493e-01   +1.752242491207588e-01   +6.162916942804981e-01   +1.975905079189012e-01   +3.004441731562086e-01   +7.137019736474220e-02   +3.634097651133877e-01   +5.392305428101146e-01   +8.483371178897907e-01; +9.718400783058292e-01   +1.180465508738418e-01   +4.818711201965378e-01   +8.083250739134796e-01   +5.174479861021796e-01   +8.958124715605255e-01   +1.064266869830411e-01   +5.466174887580920e-01   +5.558892260013631e-01   +8.284020085695134e-01   +7.709986280087809e-01   +5.288477866429503e-01; +9.396732387869087e-01   +1.862861963205322e-01   +1.040626440501068e-01   +7.192864092926530e-01   +9.267494225736354e-01   +7.142080670460524e-01   +8.868837092551766e-01   +5.123252147956455e-01   +1.578290050649675e-01   +8.479479860828988e-01   +4.067602900862090e-01   +6.187807830634413e-01; +8.994094595098724e-02   +5.546401843311074e-01   +9.431561019314255e-01   +5.634580005183204e-01   +9.496284281029637e-01   +8.565169236337736e-01   +8.303405060405544e-01   +8.271558687677344e-01   +6.011268005693113e-01   +3.658365646328683e-01   +2.958240369448373e-01   +5.600896350445269e-01; +3.107315163768771e-01   +2.788541923465652e-02   +7.884832552474655e-01   +1.853429671823796e-01   +4.406880875863564e-01   +5.792534273855004e-02   -2.189559857117403e-02   +1.000000000000000e+00   +4.758738860940857e-01   +1.127430906389957e-01   +7.423266954961930e-01   +3.900448644454002e-02];
L2E_L3E_iAMPA_netcon = [+9.203458867725847e-01   +3.099834249976536e-01   +5.885801611775400e-01   +6.682438349746763e-01   +2.050784869539943e-02   +6.940523994589451e-01   +7.582520239529279e-01   +4.765902242063623e-02; +3.424528676909464e-01   +5.906007977737995e-01   +6.734479335300586e-01   +7.590638923756892e-01   +2.237977288064413e-01   +2.285067329674174e-01   +8.566912761995072e-01   +1.036703505199188e-01; +6.375138659593161e-01   +5.270947909644447e-01   +9.099864055834851e-01   +6.782776874143652e-01   +9.176757570263330e-01   +4.765777896969188e-01   +9.752346187556186e-01   +5.117098958712214e-01; +1.654394237871984e-01   +9.397574059496255e-01   +9.245157801250214e-01   +4.476976485899675e-01   +3.523921577159989e-01   +9.588591596915477e-01   +2.477154519401397e-01   +5.055917088922517e-01; +5.344802146653627e-02   +2.222005817191121e-01   +6.938635116748449e-01   +4.067921859208010e-03   +1.941168303654930e-01   +5.019695731048163e-01   +5.411303131692089e-01   +6.387052403199360e-01; +4.063874438482052e-01   +7.726107024834503e-01   +1.832618367279638e-01   +8.018180038075234e-01   +2.439891572130780e-02   +2.929106913092051e-02   +4.730133352211570e-01   +2.903109677224377e-01; +4.886998053714088e-01   +7.743215914553455e-01   +8.024277991082652e-01   +2.726641164790548e-01   +8.717205766827495e-01   +2.261995325616748e-01   +7.212185087154230e-01   +9.627461259231175e-01; +2.981622810090034e-02   +6.012996625458495e-01   +9.146646551256333e-01   +4.685347719687045e-01   +1.121421679405460e-01   +7.330430390214997e-01   +1.406595593381147e-01   +3.656512405265638e-01; +1.000000000000000e+00   +9.377730524480369e-01   +5.446903091023133e-02   +1.375101477547349e-01   +1.447565163155812e-01   +9.117856500475325e-01   +2.613619326185257e-01   +9.124955139112028e-01; +1.766021184991918e-01   +3.317625939525211e-01   +8.107744660276760e-01   +3.493194677328477e-01   +3.754274545655029e-01   +9.402256903075137e-01   +5.216871606552446e-02   +9.867363323547579e-01; +6.591238273232614e-01   +4.008702357809598e-01   +2.500323508231918e-01   +2.110659110105957e-01   +1.246538025305189e-01   +3.318733086731103e-01   +2.138759019680398e-01   +1.196556926751693e-01; +8.523788763698978e-02   +6.287675243263379e-01   +7.844618800203249e-01   +4.432958023213674e-01   +2.589834257623668e-02   +7.826274263849603e-01   +8.070588949460494e-01   +7.922225948170585e-01];
L2I_L3I_iGABA_netcon = [+3.739460385222709e-01   +6.191939420658398e-01   +2.255754893633145e-01   +7.080062551058812e-01   +5.575547376132951e-01   +4.594005001533057e-01   +4.219377429650257e-01   +4.648736537945501e-01; +3.400600237999365e-01   +1.270248896515208e-01   -2.497828354128946e-02   +8.500688341529228e-01   +7.265395326776937e-01   +8.687217126074215e-02   +1.016905917818387e-01   +6.386851919006068e-01; +3.577838837404049e-01   +6.217357288118903e-01   +3.891661423625286e-01   +1.190778606121059e-01   +8.261385421869405e-01   +5.972377837787556e-01   +1.829746903706928e-01   +9.157098996061340e-02; +6.056897812954944e-01   +8.930988746410178e-01   +6.083712607781826e-01   +4.912403870750043e-01   +5.468387021862525e-01   +7.082411338464010e-01   +4.580765556768190e-01   +7.157804817254206e-01; +1.013266153166925e-02   -1.189120311081958e-02   +1.048055256373754e-01   +6.251937255734774e-01   +2.341377003401701e-01   +7.211097034703021e-01   +4.489633996247714e-01   +3.438736160590622e-01; +5.179730400826275e-01   +4.542717772231608e-01   +4.328139332252345e-01   +7.079427128001345e-01   +2.756630653981033e-01   +8.623731028617152e-01   +3.564658751583553e-01   +1.332910900883819e-01; +2.893935321855456e-01   +3.495018920001632e-02   +4.560397334714506e-01   +1.000000000000000e+00   +6.511991210419537e-01   +1.022702989323220e-01   +2.941152410702536e-01   +8.102006774285839e-01; +2.074213138800275e-01   +9.545000800102770e-01   +9.534166335327964e-01   +9.598269876540482e-01   +5.034720909821939e-01   +1.049163474093623e-01   +7.648187914677740e-01   +1.446590571264584e-01; +3.500704119624631e-01   +5.323977794615438e-01   +3.077001959806104e-01   +2.070093789483848e-01   +3.426824498516305e-01   +2.602644309010641e-01   +6.280225508831152e-01   +4.996856950280122e-01; +4.141544291363643e-01   +2.055239498552938e-01   +1.754795639510524e-01   +3.612197451834733e-01   +9.609611455736663e-01   +5.076094268709093e-01   +4.788527287683581e-01   +9.579326379338222e-01; +6.437031307475797e-01   +1.138349573602742e-01   +3.194278686003125e-01   +6.192283261508927e-01   +5.142318253466509e-01   +7.722450887364201e-01   +9.285217762252409e-01   +6.790679764095259e-01; +3.772200222912521e-01   +2.444924922422648e-01   +6.322788962838628e-01   +2.632469073418098e-01   +1.011370264446030e-01   -9.961082949132630e-03   +2.921092257836386e-01   +6.866244133252396e-01];
L3I_L3E_iAMPA_netcon = [+8.184702092649308e-02   +7.274844051103517e-01   +1.378270189869835e-01   +1.957829560941330e-01   +2.924708545869947e-01   +6.638890666775309e-01   +6.696029505861821e-02   +3.513494286863227e-01   +5.487865490554243e-01   +3.201371048630711e-01   +6.071198577935203e-01   +8.839694572572026e-01; +3.551245358292517e-01   +8.245347793725258e-01   +2.504524022304482e-01   +3.559723083466428e-01   +8.180435048214822e-01   +3.582807139678174e-01   +3.593843187282394e-01   +4.240386471461962e-01   +6.307426033312326e-01   +2.900446031787829e-01   +7.212979231951532e-01   +2.212819619737455e-01; +4.892998156627434e-01   +3.737345044535065e-01   +7.751395007730493e-01   +8.996604445500910e-01   +6.216646083975229e-01   +5.997569254611479e-01   +1.000000000000000e+00   +4.222168771974296e-01   +2.352569861951935e-01   +3.209791634859326e-01   +9.099125708351020e-01   +8.400937108481968e-01; +5.440832988986183e-01   +9.568564372615000e-02   +5.582678240351925e-01   +7.775137269656948e-01   +4.428006602998679e-01   +6.080968831211534e-01   +5.848264873586475e-01   +6.814489669580482e-01   +5.579149864040007e-01   +1.874898076463206e-01   +4.218603851343880e-01   +4.756162402366553e-01; +9.802872200642491e-01   +8.605841252885290e-01   +5.841892889627552e-01   +4.539019519040230e-01   +2.731872602158023e-01   +3.768908531454709e-01   -1.552278764950299e-03   +2.250141411813727e-01   +1.626510278471111e-02   +2.463272305236236e-01   +6.675608551218755e-02   +5.017783495825074e-01; +3.983416699886134e-01   +2.137114832798030e-01   +6.475148652114248e-01   +4.433632296236211e-01   +9.398144148782693e-01   +6.189575120391464e-01   +3.175036863557397e-01   +1.045602404983606e-01   +1.880478889630513e-01   +5.554734929256303e-01   +3.622672550596015e-01   +6.327079430777911e-02; +4.631585680941221e-01   +2.128296832663611e-01   +8.482615572490779e-01   +8.902142292561482e-01   +1.594392004376489e-01   +2.971634118408717e-01   +3.799179529815649e-01   +1.200628972127541e-01   +8.978350872140013e-01   +6.835197409523975e-01   +2.652559066944329e-01   +4.578253715769789e-02; +3.519803404387736e-01   +4.435613022366668e-01   +2.358545708136744e-01   +6.135547818126028e-01   +8.652776057376402e-01   +2.734104430006153e-01   +3.863592009508832e-01   +3.022107713959966e-01   +3.700428459100372e-01   +2.674738898329831e-01   +6.973607075133356e-01   +5.698484799057543e-01; +2.998823452982446e-01   +5.287176163638235e-01   +3.619612725112648e-01   +5.848321858371088e-01   +5.624696360570846e-01   -9.360090089130907e-03   +1.029521442058703e-01   +6.484279641025539e-02   +3.210009277474593e-01   +2.237160706994297e-01   +8.937804908324704e-01   +8.996642046016463e-01; +7.461704782158471e-01   +5.956010562825153e-01   +5.756223080882874e-01   +4.013813557735417e-01   +4.508971048483029e-01   +3.901983190285406e-01   -9.463273616146160e-03   +6.503404366008210e-01   +2.873978996024999e-02   +9.361694222269813e-01   +4.700642634522337e-01   +1.713118340152364e-01; +1.087105331018215e-01   +2.817975429574013e-01   +6.679410887156455e-01   +2.462271765782864e-01   +4.827030770619489e-02   +4.932856551628223e-01   +9.336918419584164e-02   +7.397882210305464e-01   +7.816439318863773e-01   +1.520291403866413e-01   +6.590238308853370e-01   +2.363822614166968e-01; +5.966664560175058e-01   +5.885343955951151e-01   +4.091193119430294e-01   +5.875967055120028e-01   +6.438986727445895e-01   +4.506694642540869e-01   +3.385452109038672e-01   +7.970300026385493e-01   +6.487636091668373e-01   +4.254164560015487e-01   +5.240766685432958e-01   +4.244473460352220e-01];
L3E_L3I_iGABA_netcon = [+3.282613875524641e-01   +7.575375622845684e-01   +7.544390737578639e-01   +9.330901514079627e-01   +4.552117555750675e-01   +1.151882991175949e-01   +2.892327194186394e-01   +7.178715048638201e-01   +8.357669945960801e-01   +2.751097629857259e-01   +5.182413002636466e-01   +3.021473748969576e-01; +8.931629626257030e-01   +3.909531315296469e-01   +6.368165243694294e-01   +2.032866026897027e-02   +9.285341302692178e-01   +3.902214343204521e-01   +8.406698095084072e-01   +7.713866209690359e-01   +6.397613595412800e-01   +7.538517043141737e-01   +2.833600007232864e-01   +5.249380735499968e-01; +8.622608044432034e-01   +3.479479291475129e-01   +3.794386535707958e-01   +4.740746641598947e-01   +5.818946730211872e-01   +5.587436653958748e-01   +2.577391198603121e-01   +8.541843296931810e-01   +6.063666391378428e-01   +1.267228523585259e-01   +7.832699975389779e-01   +8.847391019993534e-01; +1.245870026365090e-01   +6.647787156973392e-01   +3.068856711298316e-01   +3.108816357069945e-01   +1.060918155796344e-01   +7.311318433565952e-01   +2.408615769492793e-01   +1.087907867043069e-01   +3.110267198030640e-01   +5.078933325871385e-01   +7.862919046852720e-01   +5.855495343375892e-01; +2.421218299030295e-01   +7.530828499853426e-01   +6.274799203485619e-01   +3.111827930669274e-01   +9.827590140535181e-02   +6.082211574443815e-01   +9.195893041877690e-01   +2.626759078693359e-01   +3.483584201495025e-01   +8.402385261189682e-01   +6.404308004429745e-01   +2.376165884949656e-01; +4.531252852902500e-01   +8.350319328531277e-01   +7.623806295015066e-01   +5.429305850720565e-01   +7.677890220539281e-01   +9.714174359523459e-02   +3.961703599356446e-01   +3.421561514538510e-01   +8.553467290372871e-01   +8.625309747785435e-01   +8.167423943548571e-01   +2.966242575880539e-01; +5.039992353230354e-01   +8.229522822618424e-01   +2.279187847178229e-01   +2.429998058436554e-02   +4.254014068388728e-01   +6.422346614403160e-01   +6.398628058564317e-01   +1.787951685378213e-01   +1.000000000000000e+00   +6.456314036754682e-01   +3.372109329815963e-02   +3.946024868427557e-01; +4.788139243559052e-01   +4.178584629642417e-01   +8.691206600314941e-01   +3.875772977180742e-01   +8.197371244175493e-02   +1.008359398508839e-01   +6.139681785365412e-01   +3.673952113461704e-02   +6.147966273445712e-01   +8.372810976447613e-01   +2.136350974785053e-01   +9.943323635371967e-01; +3.311792043664747e-01   +5.653820377104599e-01   +2.235839597279200e-01   +7.199075091359911e-01   +9.347713849379577e-01   +2.459113300419440e-02   +3.615571048332832e-01   +6.219445191923167e-01   +6.237788789244318e-01   +9.496173044303435e-01   +7.235135277957776e-01   +6.623304646771634e-01; +9.248917939122867e-02   -4.196820561843630e-03   +3.470460819637723e-01   +5.845429561129268e-01   +8.064053116024110e-01   +2.373499907844135e-01   +1.640069397148726e-02   +3.099572678833277e-01   +7.211282608082943e-01   +2.990773147304329e-01   +6.333610948772759e-01   +6.906571141833648e-02; +9.295790905869467e-01   +1.005838759884395e-01   +7.559272691473159e-01   +5.158701867944044e-01   +4.374731441004379e-01   +8.819622156098550e-01   +1.025394100212944e-01   +8.013241534958051e-01   +3.704394453340288e-01   +9.865326174178114e-01   +4.410715289877180e-01   +7.287347610284345e-01; +6.736231545126755e-01   +8.516635611673382e-01   +5.302829617792330e-01   +9.094543986119178e-01   +8.480215474729020e-01   +5.090048339234561e-01   +9.940062441965474e-01   +9.227981092425965e-01   +4.533697656886362e-01   +9.226967415790858e-01   +5.345690020341169e-01   +9.600806934646031e-01];
L2E_Input1_iAMPA_netcon = [+9.742843299856043e-01   +9.679985248308450e-01   +9.787970886116428e-01   +9.979081140357161e-01   +9.653156379894811e-01   +9.952900089475291e-01   +9.559683923592108e-01   +1.000000000000000e+00];
L2I_Input2_iAMPA_netcon = [+9.891387023583159e-01   +9.969595637775888e-01   +9.974391881284769e-01   +9.538259394284904e-01   +9.798026000260162e-01   +9.600553218518438e-01   +9.715007272457629e-01   +1.000000000000000e+00];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
