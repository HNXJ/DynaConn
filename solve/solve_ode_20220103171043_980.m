function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.794194806919450e-01   +1.713400679499254e-02   +2.264521928790807e-01   +4.565003601013342e-01   +4.251167302305975e-01   +6.480234262010684e-02   +4.966058660604158e-01   -4.046488985737658e-02   +6.627053706262815e-01   +5.265602057981609e-01   +2.711057626401138e-01   +6.964416270386984e-01   +3.322027936005512e-01   -1.160372641505639e-02   +1.250404673437737e-01   +6.588474251713352e-01; +1.073859179269651e-01   +5.361187929497226e-01   +1.028764609294533e-01   +2.755774892760980e-01   +4.008708196445107e-01   +8.218811956281286e-01   +7.741046041125937e-01   +6.977471044027014e-01   +4.545580286122661e-01   -1.435772293279406e-01   +1.967912644210375e-01   +7.469498572503115e-01   +1.254455102340982e-01   +3.228135139064406e-01   +4.719647568404596e-01   +5.086320676765559e-01; +2.797398753567467e-01   +1.805814491896356e-01   +6.037804939888093e-01   +8.191161936395145e-01   +7.656284396116524e-01   +2.318425592907479e-01   +3.287866214137232e-01   +7.718492367765306e-01   +2.518813458012516e-01   +8.331608259057891e-01   +4.968040659415268e-01   +5.273603624367489e-01   +3.247780077610692e-01   +8.465744815042809e-01   +2.580403410689823e-01   +2.869552514260686e-01; +8.707889094475713e-01   +4.166410618083055e-01   +3.723128848996687e-01   -3.459272760198269e-02   +5.409505072683795e-01   +8.113505232642418e-02   +1.583355857767704e-01   +5.091326462007896e-01   +6.287070340246976e-01   +2.435081080200772e-01   +2.832046890907675e-01   +1.984813854433666e-01   +8.553470111455960e-02   +3.564271046890866e-01   +6.218879901506164e-01   +7.768183744799831e-01; +2.108633438892532e-01   +4.765693719633464e-01   +3.961724139802617e-01   -1.163187825630136e-01   +6.909596900815874e-01   +3.031801411091276e-01   -6.261474731308782e-02   +3.107066495665540e-01   +1.968174157233182e-01   +5.277545569374329e-01   +5.781588914826292e-01   +7.593347938121827e-01   +5.343861435516941e-01   +5.582153014942079e-02   +3.147908197412916e-01   +3.090838959982445e-02; +6.110434868073914e-01   +5.103156389221197e-01   +5.316967860307005e-01   +9.204691115616311e-01   +1.339132369665041e-01   +6.209750499781383e-01   +3.339961893903177e-01   +7.666536800643374e-01   +4.201591057931284e-01   +3.348845479879298e-02   +5.002498419181479e-01   +1.568415573070540e-01   +6.849200259969425e-01   +6.647357186883259e-01   +3.590915387649719e-01   +3.300690867891051e-01; -4.783729556055201e-02   +3.509497790003277e-01   +3.743118445369563e-01   +7.084218979119692e-01   +3.160161946070607e-01   +8.410708638435840e-01   +2.729204639811598e-01   +1.352964109897176e-01   -7.246685287757314e-02   -1.407135788858885e-01   +1.435434706925598e-02   +3.772409103801211e-01   +4.392836630410790e-01   +1.914806628734011e-01   +5.123407733902782e-01   +6.132734849816013e-01; +4.597972288885610e-02   +2.628364704808456e-02   +4.897185339607295e-01   +6.925770888902530e-01   +2.092395065398532e-01   +6.593125764545887e-01   +1.061985446040997e-01   +8.369459468728175e-01   +5.961690598533870e-01   +5.391570600717632e-01   +4.526357946253053e-01   +4.087584627250448e-01   +4.561286886157063e-01   +2.232186261764771e-01   +9.487550016507634e-02   +2.003111491359156e-01; +1.103096103785386e-01   +5.490688844819782e-01   +2.577669038909719e-01   +2.574147113965096e-01   +5.875955462859468e-01   +1.541336924222144e-01   +3.597741099953973e-01   +8.438949360426230e-01   +2.842936489167490e-01   +8.075552499887275e-01   +6.427117562589064e-01   -1.748504426059024e-02   +9.654919986574495e-01   +5.821611058409377e-01   +7.893584743035001e-01   +2.579840114012278e-01; +7.799500503659974e-01   +5.514126563637156e-01   +6.953044332212878e-01   +8.178035912938846e-01   +3.590642262842309e-01   +7.046315588259593e-01   +8.831791508112750e-01   +4.943798739893647e-01   +8.865975376877508e-01   +6.701676687019897e-01   +6.510217099086811e-02   +4.391302513845343e-01   +7.465907611162240e-02   +6.563515736834431e-01   +8.201603816399841e-01   +7.507276287548086e-01; +4.256878525908575e-01   +4.364254174880201e-01   +7.069865402995411e-01   +2.758851667745398e-01   +1.455059967884968e-01   +1.782547337704784e-01   +2.355531641267451e-01   +7.693906589148739e-01   +5.754747202291662e-01   +5.470076319468494e-01   +5.465905936732688e-01   +3.295129846268394e-01   +6.297557218911147e-01   +5.517894884997537e-01   +2.646449543876477e-01   +6.173575342013835e-01; -6.256975790655028e-02   +2.026990592413223e-01   +7.478535006258341e-01   +5.673401672982842e-01   +5.755103683879185e-01   +4.367932451198054e-01   +1.692172298425240e-01   +4.400789233497269e-01   +8.548639535801685e-01   +8.089377498369000e-01   +7.353661746058059e-01   +6.768134654433635e-01   +7.537698244125222e-01   -7.673673157738420e-02   +6.225601556920255e-01   +5.135026785378360e-03; +2.335524162352870e-01   +7.144492163203143e-01   +7.461496988690887e-01   +1.984030661174971e-01   +1.098465404636201e-02   +5.252828786224424e-02   +2.985855326615007e-01   +1.010585070729392e-01   +2.836752217255956e-01   +5.231475276193707e-01   +3.651049304182781e-02   +4.987717691240587e-02   +4.258783469275744e-01   +6.837518645639328e-01   +4.264350878503438e-01   +3.889954408460481e-01; +1.720731798934672e-02   +1.156638227614554e-02   +7.935274141211038e-01   +8.194020445559543e-01   +2.833244548128885e-01   +2.950665428830331e-01   +4.065735467687199e-02   +2.651842171222362e-01   +3.169055940853744e-01   +1.673737931409017e-01   +2.542313606116451e-01   +1.192098254688739e-01   +4.039381901258648e-01   +8.927735637951426e-01   +2.828952694779734e-01   +8.420770400501341e-01; +5.979711195304320e-01   +3.663090400599108e-01   +7.103115555053604e-01   +7.335358159953285e-01   +3.284738476068351e-01   +9.359463605164337e-02   +7.193251284621512e-01   +4.553366003379960e-01   +8.006514381501916e-01   +3.353055582148947e-01   +3.914254701710904e-01   +1.245136152405598e-01   +6.565420952209872e-01   +7.493787167876457e-01   +6.823708496635336e-01   +1.634709913317133e-01; +8.269062402362540e-02   +4.243022477013837e-01   +6.126695770944167e-01   +7.104475720112192e-01   +8.335118641184412e-01   +6.175206293464001e-01   +6.000754803234882e-01   +7.489309954179349e-02   +6.509395699425324e-01   +4.637501617689785e-01   +4.350074130645371e-01   +4.028149186668744e-01   +9.948369895119397e-01   +8.210531546292817e-02   +3.554333376449781e-01   -6.104177145915426e-02];
L1E_L1I_iGABA_netcon = [+2.078680861560342e-02   +5.984436671774633e-01   +1.850044996497835e-01   +2.557518949680949e-01   +3.229075783757671e-01   +7.177304139226627e-02   +8.116255038646878e-01   +3.867170204873626e-01   +6.157828137793946e-02   +4.692856627448344e-01   +5.939402723157657e-01   +2.964647169325700e-01   +4.714306522215579e-01   +1.707612088381797e-01   +3.975569045578741e-01   +8.198741677194683e-01; +2.069497415932944e-01   +3.509194534171046e-01   +8.586244231656559e-01   +3.521248350132321e-01   +4.716730500205260e-01   +2.738807956736194e-01   +4.909858422049663e-01   +3.131982079753714e-01   +1.993496090119912e-01   -1.121363755667998e-01   +6.392006479681883e-01   +3.055363976059141e-01   +1.000000000000000e+00   +2.848578529649973e-01   +2.125460531708034e-01   +8.421195714016912e-02; +2.149491882677079e-01   +3.514413994541884e-01   +1.967741063699944e-01   +2.329517561074333e-01   +3.620708931678283e-01   +6.492471221218989e-01   -5.918266605200402e-02   +2.218104120005463e-01   +7.959084692628139e-01   +3.604638942614215e-01   +7.075369568249017e-02   -3.310348307387221e-02   +2.735943560724334e-01   +7.453777575043042e-01   +2.281910697087084e-01   +5.748421449307302e-01; +7.440983339612212e-01   +2.406920979005721e-01   +4.696755922411101e-01   +3.252811009432765e-01   +7.809485859976769e-01   +9.068955798816304e-02   +5.204913731723406e-01   +4.640743309282256e-01   +6.246340376534707e-01   +1.231995721769915e-02   -1.766439028121710e-01   +5.489051380681464e-01   +1.461238117534434e-01   +5.478321894265924e-01   +4.204069759843638e-01   +2.505955725481025e-01; +1.711337680864019e-01   +1.129417989586210e-01   +2.318040629625784e-01   +7.937787350284836e-01   +7.376348983709644e-01   +3.949896450110638e-01   +1.139287131518450e-02   +2.228635395315124e-02   +8.090411699504130e-01   +2.689794857059840e-01   +6.662868208783795e-01   +1.548034578006141e-01   +1.031434409112754e-01   +3.672276869711553e-01   +4.207496797607159e-01   +1.535751660432987e-01; -7.304063644365509e-02   -5.672652376736874e-03   +6.257382085024513e-02   +5.716787210508852e-01   +2.887371389544588e-01   +7.112329825740866e-01   -6.295484698223021e-02   +9.050350317827559e-01   -1.317379515938565e-01   +3.601067270863060e-01   +7.186190687022231e-01   +4.836142206996932e-01   +3.030511533368023e-01   -5.243729386810451e-02   +5.320797466668600e-01   +4.136922736765546e-01; +7.588740456411659e-01   +3.392815321757971e-01   +1.580742676224222e-01   +3.927713913053946e-01   +8.825748906218783e-01   +3.808379130703682e-01   +3.384237676582296e-01   -1.753523400781737e-01   +4.749645878893684e-01   +4.130380055376699e-01   +4.725395211762010e-01   +7.102670381295765e-01   +2.332294239989393e-01   +4.054581141990711e-02   +4.380782195973113e-01   +2.170529008136795e-01; +2.932210833912008e-01   +6.128605746012846e-02   +2.639100463138565e-01   +2.075127132637813e-01   +2.695291401299668e-01   +8.322607100505051e-01   +2.331695329205677e-01   +2.081166186822551e-01   +3.949667384955473e-01   +6.945880776678018e-01   +6.955705737095299e-01   +4.298984289127846e-01   +6.960551829115345e-01   +8.044127243389528e-01   +4.828381674909170e-01   +3.224337531418510e-01; +4.599706558314569e-01   +9.255056734932728e-01   +5.193538238795326e-01   +5.718058724381243e-01   +3.328856329982551e-01   +3.875690096879541e-01   +4.264571363882820e-01   +2.749730109950639e-01   +8.380626101524330e-01   +5.342648711665978e-01   -3.241631500542892e-02   +5.383963348567814e-01   +7.800783890192893e-01   +3.640058271284482e-01   +3.189896592209384e-01   +1.713562185682015e-01; +4.413389265390156e-01   +3.292316828272775e-01   +4.538894437607480e-01   +4.547136378520884e-01   +4.950095386302498e-01   +8.265835133951616e-01   +7.980684934266270e-01   +8.484839519773039e-01   +3.404296998212335e-01   +5.493649826296257e-01   +3.534993635224085e-01   +6.566262088965862e-01   +2.537694845555977e-01   +7.555783316070797e-01   +8.062216124931419e-01   +2.888491492089665e-02; +6.761695241457215e-01   +8.332450422448269e-01   +5.970996602147824e-01   +4.850499497033882e-01   +6.073236995612984e-01   +4.843287167006165e-01   +5.462689932750164e-01   +7.896658347336409e-01   +3.177903636955580e-01   +5.719960667750711e-01   -9.627489239691284e-02   +5.489076690432757e-01   +1.788094703861682e-01   +8.004523601439341e-01   +7.207423806823713e-01   +3.562542063147346e-01; +4.942187801211612e-02   +4.773500354777700e-01   +6.331821530442659e-01   +6.668681960973326e-01   +5.008749311784620e-01   +8.254203536176624e-01   +3.871840753929479e-01   +5.738564970749037e-01   +3.258108471359716e-01   +5.873512623108125e-01   +9.143259204441195e-01   +9.065902177727178e-01   +5.368142223288740e-01   +8.998354754133185e-01   +6.724966280271722e-01   +2.854916165852220e-01; +8.610854208965607e-02   +8.260411051622102e-01   +3.119824020783861e-01   +2.113039970633652e-01   +7.209780789906856e-01   +4.987070359495911e-01   +7.058802565661182e-01   +5.156858233299457e-01   +2.877690301827194e-02   +1.693686531588733e-01   +4.146770517326098e-01   +6.324987657668037e-01   +2.272170111590452e-01   +4.605469108305622e-01   +2.629473439376484e-02   +4.268730830748475e-01; +2.654727850519338e-01   +5.592962223071710e-01   +7.494255912678833e-01   +8.060295149048797e-01   +8.141433386363816e-01   +3.803709899332283e-01   +7.565629845555442e-01   +4.785455396605523e-03   +3.347165278960992e-01   +8.785611057127721e-02   +5.610936145800626e-01   +1.969972883466342e-01   +7.960964621034881e-01   +6.051408024666897e-02   +5.705572213054818e-01   +7.805617657423317e-02; +7.036151698570915e-01   +5.907204273567269e-01   -4.220342869431472e-02   +7.085431531363585e-01   +1.806708415334561e-01   +4.704739627143932e-01   +2.424077577994945e-01   +7.832938349160299e-01   +4.835400301353832e-01   +1.243783031100197e-01   +4.505329476685008e-01   +7.954708657020563e-01   +9.894135502722473e-02   +3.704778024605190e-02   +3.788460281890190e-01   +4.115203341923799e-01; +6.935228003214911e-01   +2.810375334149011e-01   +4.892780926894753e-01   +6.463854504701164e-01   +5.528206285646188e-01   +3.041519977181606e-01   +3.794004801506555e-01   +8.371575292639737e-01   -1.950983055425495e-01   +2.687729544655086e-01   +3.460614890656825e-01   +1.175132187242634e-01   -2.084479313922504e-02   +5.057777918241574e-01   +5.380531815531715e-01   +1.728977967354605e-01];
L2I_L1I_iGABA_netcon = [+7.380822031706260e-01   +6.387493338567727e-01   +7.610432904861252e-01   -1.768215372057339e-01   +3.992295973110587e-01   +3.135574525907125e-01   +8.963708970329962e-01   +1.058316157185883e-01; +3.000127630757238e-01   +2.209800564440529e-01   +2.756930278507101e-01   +6.483037683366000e-01   +7.447457045581453e-01   +4.408604042576579e-01   +7.201000938808282e-01   +5.885808141418380e-01; +6.508555480582064e-01   -1.189359935290197e-01   +8.815419818006898e-01   +2.649900251612657e-01   +3.117043833007982e-01   +3.531054120036376e-01   +5.657842468268929e-01   +6.165054318679392e-01; +1.955601196741500e-01   +6.709032488744753e-01   +3.758414436420939e-01   +9.960738178846823e-02   +8.360231344608797e-01   +2.692018155049729e-01   +2.937722973548367e-01   +6.318756412966854e-01; +5.670127485751126e-01   +7.459693984555236e-01   +1.922036129506699e-01   -5.252723830841300e-02   +9.222909618656213e-01   +4.247946775244423e-01   +3.394159600406916e-01   +6.591934515274478e-01; +8.110785661552309e-01   +6.219612816528176e-01   +6.252681331328749e-01   +6.865150520671105e-01   +8.043212715042930e-01   +9.336246673239899e-02   +8.172012784064957e-02   +3.722677326584322e-01; -1.776184591745658e-01   +2.337883013229001e-01   +2.763908643693060e-01   +7.581621473879208e-01   +2.369185836235996e-01   +3.876226612129795e-01   -7.925528097557731e-02   +3.493029965199534e-01; +4.649588349419105e-01   +2.248121083119695e-01   +7.131968359414422e-01   +5.853999470759347e-01   +3.177925397251709e-01   +1.814090592995354e-01   +5.832137134459891e-02   +7.018517228367203e-01; +6.341578864758053e-02   +2.590864130826354e-02   +4.151737307325504e-01   +6.131795016720989e-01   +1.671637798174048e-01   +4.805445020475307e-01   +4.448013678587667e-01   +3.840916144982527e-01; +2.361454724102609e-01   +4.791300488898668e-01   +4.366678049986781e-01   -8.349315545681767e-02   +4.248943815619730e-01   +7.831453076122892e-02   -1.082114651721229e-01   +2.297050282318351e-03; +8.194013709002593e-02   +1.505360390170347e-01   +1.284854705761403e-01   +9.704507581138734e-01   +5.034825343029871e-01   +3.718978864250296e-01   +2.527747284514986e-01   +4.564571626246501e-01; +3.228454935703007e-01   +2.419271402901217e-01   +2.153674153508998e-01   +3.260585267736682e-01   +1.814090114685048e-01   +3.935637347420683e-02   +9.989477497767772e-01   +5.043675923044221e-01; +7.592304212041479e-01   +3.867041872723242e-01   +7.078930459741555e-01   +5.510086441486729e-01   +3.287209378391209e-01   +2.954757755215183e-01   +6.690317516152539e-01   +1.927339295968997e-01; +4.003150727296619e-01   +1.209605461010929e-01   +1.880153940001851e-01   +9.494123437999518e-01   -1.131496501798883e-01   +6.166784111639402e-01   +4.892187356279377e-01   +1.644489464593761e-02; +5.773442814753553e-01   +8.632882352588549e-01   +7.012585684312515e-01   +5.085200543616867e-01   +4.039631715317011e-02   +5.262270726746581e-01   +6.661374016187761e-01   +9.259572026790009e-01; +7.741439967705498e-01   +5.923684661435555e-01   +8.353758334345747e-01   +6.350221533760172e-01   +2.242591866384089e-01   +2.030626842844135e-01   +1.000000000000000e+00   +7.725208928782646e-01];
L1I_L2I_iGABA_netcon = [+1.468668005691492e-01   +6.511159072068683e-02   +3.933311836412183e-01   +4.858301745351459e-01   +3.875836116231740e-01   +7.415377395153303e-01   +5.824223108952631e-01   +3.533155132657996e-01   +5.490191752804848e-01   +2.509271159117970e-02   +2.375585967542726e-01   -4.543155561726911e-02   +7.720329640287459e-01   +1.981185737889953e-01   +3.280941132766645e-01   +6.085651972877916e-01; +9.913866092503514e-01   +7.915508324322521e-01   +9.369420471584525e-02   +1.218611909182391e-01   +4.091600771720224e-01   +8.064365512190937e-01   +4.683472052547775e-01   +1.553598846816987e-01   +7.961635034586024e-01   +9.662870271004987e-01   +1.828411716253336e-01   +7.189775966823885e-01   +6.589625272943513e-01   -1.083260595081645e-01   +6.444588731017588e-01   +3.249793720438244e-01; +2.031037739538525e-01   +2.832029876037359e-02   +4.008963493873833e-01   -5.919556565705617e-02   -1.514260460259985e-01   +3.581243642250608e-01   +2.875863787921816e-02   +7.347123606419206e-01   -8.809063972267368e-02   +4.958491998459916e-01   +6.986085074650950e-01   +2.856444098126490e-01   +3.706809535779902e-01   +3.491072913551234e-01   +5.484690887184925e-01   +2.726905475920455e-01; +1.453120698456977e-01   +7.266641089962479e-01   +1.364819763372195e-01   +2.271898045227109e-01   +2.463170490542543e-01   +4.216486828848930e-01   +7.489345988216904e-01   +6.740243776191438e-01   +4.094448979433055e-01   +4.990922872676392e-02   +5.644981295360305e-02   +9.250977428399741e-01   +1.578414343807313e-01   +4.231108715226528e-01   +6.338139819268824e-01   +2.440385539068640e-01; +7.549085909100609e-01   +8.660216476600795e-01   -1.534904044380342e-01   +8.088746631298439e-01   +4.562974603368800e-01   +5.944931065282024e-01   +7.348596492209711e-01   +3.227212800368938e-01   +1.000000000000000e+00   +4.573718404872107e-01   +5.371031149955872e-01   +4.929613576984929e-01   +5.939447724883373e-01   +5.401773926575898e-01   +2.140363456940094e-01   +5.441028289330122e-02; +4.019393878776666e-01   +3.124641951374706e-01   +6.373442229474293e-01   +4.111350473767720e-01   +3.268836932577747e-01   +5.170672637504797e-02   +7.119036404427836e-01   +2.849690404362864e-01   +5.519766192907227e-01   +2.831720366539555e-01   +2.331831766775425e-01   +8.215115669393497e-02   +6.682545543791439e-01   +7.891753896776480e-01   +8.539447427530457e-01   +6.675690844383531e-02; +8.286125520543811e-01   +2.332392533686150e-01   +1.072107375845413e-01   +9.299605998378465e-01   +3.141509248949227e-01   +5.342722822535760e-01   +8.426355349655857e-01   +4.677275529424228e-01   +2.631176809111507e-01   +4.504654518401831e-01   +6.223457633810008e-01   +1.000084029965092e-01   +3.270238917987409e-01   +4.918063620203171e-01   +6.420349833149456e-01   +3.034308649294692e-01; +5.185880858419110e-01   +7.352672764744376e-01   +6.341041380181383e-01   -4.017691384361155e-02   +8.918097394263211e-01   +4.713915449400073e-01   +1.635622417073128e-01   +5.475935301717447e-01   +1.524068869537635e-01   +3.260702873438047e-01   +6.399987823329728e-01   +5.086651877193965e-01   +6.579598884330429e-01   +3.533854204606972e-01   +2.030101486006397e-01   +4.073824983707734e-01];
L2E_L1E_iAMPA_netcon = [+6.348829269876410e-01   +3.238492092242939e-01   +2.778991290010790e-01   +1.990813547018770e-01   +5.997007215636190e-01   +3.397175473249529e-01   +3.116652811908509e-01   +6.895388708915546e-01; +9.375033074512560e-01   +7.222576925845465e-01   +4.769339775786650e-01   +1.445790060786339e-01   +6.314534919102391e-01   +7.766883588123510e-01   +8.239500082836972e-01   +1.653497308248862e-01; +5.323353327058229e-01   +2.127375984888123e-01   +5.568623498297957e-01   +5.063746749981265e-01   +7.151877363966491e-01   +8.500139083547320e-02   +4.019320755420684e-01   +3.467127205142073e-01; +5.077801858184721e-01   +9.173210923015224e-01   +8.013689651038259e-01   +3.217578623431721e-01   +1.644156888283606e-01   +6.800784778449516e-01   +5.778677364879727e-01   +1.561644843089159e-01; +7.959893322351631e-01   +5.675293440351529e-01   +7.103371344932558e-01   +4.550409802969101e-01   +3.848347926878030e-01   +2.036340778009620e-01   +1.939423799001294e-01   +8.231175438597976e-01; +3.863867516323578e-01   +5.945734372194819e-01   +8.860437485319401e-01   +7.780337984628720e-01   +1.901670220241962e-01   +9.251400082319101e-01   +9.666682329973048e-02   +3.990715752397805e-01; +3.026521734488418e-01   +5.359882072986827e-01   +3.618984018395886e-01   +5.524015170321975e-01   +6.537628768772640e-01   +6.786411254806717e-01   +9.842518745239747e-01   +2.350705686699725e-01; +2.624556979385970e-01   +3.964608616100592e-01   +4.917414963289474e-01   +5.086769180790873e-01   +3.921705977404795e-01   +2.113886788465225e-01   +2.466025692832384e-02   +5.076851890646523e-01; +6.135686159910096e-01   +5.433898325647432e-01   +7.057592089687325e-01   +3.405774539054263e-01   +5.536874361854259e-01   +8.233771055821718e-01   +6.723644150430954e-01   +7.781113213058488e-04; -5.759074846195152e-03   +7.351900378007703e-01   +4.101760114899295e-02   +3.477674569076213e-01   +6.297915034871888e-01   +2.060665208372196e-01   +7.130527401814823e-01   +5.147176519866901e-01; +1.470188090992295e-01   +4.335971571616464e-01   +7.234234525098316e-01   +5.251902492591830e-01   +9.999693352768996e-02   +6.463890180709524e-01   +1.190005755577371e-01   +1.862005195308459e-01; +5.825615050462155e-01   +9.614671044676648e-01   -2.030290273844960e-01   +5.577403620880351e-01   +8.562641708561713e-01   +6.389627316417423e-01   +6.107111643158734e-01   +2.222890784724123e-01; +5.352653641970326e-01   +1.483372654467933e-01   +5.712589934704061e-01   +1.987894065774443e-01   +6.283550799155824e-03   +4.732110790871381e-01   +5.174652016162543e-01   +5.136845763671981e-01; +5.459955063038158e-01   +3.394635237426998e-01   +4.783446011085963e-01   +6.739292615353666e-01   +6.917934483185091e-01   +9.549775320038421e-01   +2.880379186531991e-01   +4.435778707157927e-01; +1.091420499316411e-01   +7.347651912763193e-01   +6.214734273543590e-01   +4.146886202156562e-01   +3.454737452977312e-01   +6.117629875289552e-01   +2.688262169598342e-01   +3.058725937993503e-01; +4.500921009207048e-01   +6.464974085820507e-02   +4.952072341561864e-01   +4.718759146654490e-02   +4.232306354659592e-01   +6.783116529452821e-01   +9.491592293901927e-01   +3.610829792292589e-01];
L1E_L2E_iAMPA_netcon = [-1.576155816440218e-01   +3.650474637618275e-01   +5.863907914722062e-04   +6.150472670010612e-01   +1.631194562280943e-01   +1.205943122047275e-01   +2.642259901137263e-01   +2.619598807924208e-01   +7.194042134628232e-01   +6.338534971242779e-01   +1.655174962736740e-01   +2.240792916989610e-01   +3.788148606353649e-01   +4.235560664633829e-01   +8.587871621835430e-02   +3.933115752514396e-01; +3.508435013725014e-01   +4.632319447169137e-01   +4.558028785089469e-01   +2.190212391569661e-01   +7.147097011002924e-02   +7.583955101707827e-01   +1.186996356906878e-01   +3.483425914388234e-01   +3.892525916462170e-01   -1.326600281741698e-01   +7.687537980628247e-01   +2.761455316831790e-01   +4.865868571001486e-01   +5.890432359808717e-01   +6.878124959881554e-01   +3.407440019793764e-01; +3.268966882891889e-01   +5.050534605625809e-01   +3.746894578000943e-01   +5.789263337902825e-01   +6.521708896737610e-01   +3.708556689955713e-01   +5.360414654386072e-01   +6.558532286059549e-01   +6.852717041536342e-02   +7.221283778520865e-01   +4.704961489147240e-01   +3.611410382492865e-01   +3.028242728052310e-01   +6.009440643348763e-01   +2.985672602204083e-02   +2.526247089576007e-01; +3.442761746423403e-01   +2.958881736696991e-01   +4.898587142337830e-01   +7.011811155847824e-01   +2.350796818903008e-01   +9.700146317576117e-01   +6.631254501742844e-01   +3.757959617420988e-01   +3.249829450459638e-01   +1.208157482175133e-01   -8.340648958431574e-02   +8.416411614832010e-01   +2.569056176506011e-02   +4.679471999213277e-01   +4.218777756413148e-01   +5.440423369990287e-01; +4.153047867634206e-01   +7.743266917982886e-01   +5.526475133383087e-01   +2.847044779799099e-01   +3.165313335281947e-01   +3.706465195449365e-01   -1.811410553404370e-01   +3.090262841256655e-01   +3.519461792059036e-01   -1.682008201232445e-02   -1.788241563176980e-01   +1.613456567302972e-01   +3.592740551095312e-01   +8.559475413972669e-01   +1.686910163237673e-01   +2.635224919810055e-01; +1.182708754213824e-01   +3.181927449175574e-01   +5.648098267275966e-01   -2.457769396912426e-02   +2.166813984102336e-01   +5.975947524219398e-01   +4.864284787581757e-01   +5.560200924274472e-01   -1.422123534077365e-02   +1.735135921628823e-02   +6.419650770642787e-01   +4.678501987571596e-01   +3.379290433062285e-01   +6.255215903392152e-01   +5.171868188606005e-02   +2.502554080881718e-01; +6.367172353623963e-01   +4.166495163385513e-02   +5.754307722686159e-01   +3.609759847217343e-01   +4.701255116895277e-01   -1.630311588348026e-03   +4.940200448163434e-01   +7.632091871975761e-01   -9.590449184609383e-02   +1.448371948345756e-01   +8.444827921350033e-01   +1.953347352301201e-01   +5.593341580864968e-01   +4.177196226716977e-01   +7.014086797896436e-01   +7.818200045679592e-01; +3.125777186151899e-01   +4.662224621184841e-01   +5.911315130483125e-01   +5.520422078805061e-01   +3.947762890301795e-01   +2.409440285964092e-01   -1.124832298702751e-01   +2.670628366185249e-02   +1.248755676401846e-01   +5.380251964509714e-01   +2.139026960195674e-01   +4.977501579789083e-01   +1.000000000000000e+00   +2.822152011844899e-01   +4.872756610795432e-01   +7.772601566259799e-01];
L2I_L2E_iAMPA_netcon = [+1.650329649535904e-01   +6.405919452865075e-01   +6.034148476498434e-01   +8.546159773850175e-01   +2.982727748107442e-01   +6.971011212397453e-02   +4.904142682295243e-01   +5.903808266234171e-01; +6.628698271322961e-01   +3.085680138602720e-01   +2.289488278297547e-01   +9.294252595399136e-01   +4.645253009216885e-01   +1.675722799142868e-01   +9.295790031631653e-01   +8.085940012089229e-01; +8.404147113622096e-01   +7.121640901691282e-01   +6.466370485041577e-01   +2.467349434382816e-01   +3.992092619465386e-02   +4.839644570344517e-01   +1.486523300498084e-02   +7.664746286492148e-01; +4.872979665820605e-01   -7.691899156096151e-02   +5.402366912494121e-01   +6.131030966096307e-01   +7.276259655876511e-01   +7.556128836891393e-01   +8.573160812100011e-01   -1.891263555253006e-01; +9.311713188350657e-01   +6.422766224820269e-01   +6.449745040914060e-01   +6.768046475490302e-01   +8.683267518498695e-01   +3.151221776098815e-01   +3.484613521819239e-01   +7.487636209743003e-01; +6.362013883901417e-01   +6.681319387080600e-01   +1.223116718829552e-01   +2.070164567349152e-01   +2.784826265174823e-01   +7.493580889094598e-02   +3.744775893376566e-01   +3.884340917887950e-01; +6.819591184355628e-01   +4.183903787154614e-01   +2.675571403680738e-01   +3.887910345862335e-01   +8.716435085961204e-01   +8.103135640717619e-01   +4.194630629986814e-01   +2.777128356100012e-01; -1.079363632659479e-02   +4.513264065555959e-01   +1.449890946045480e-01   +1.344350735282312e-01   +7.659542468172771e-01   +4.550520088166656e-01   +5.772847755644923e-01   +5.223053002100252e-01];
L2E_L2I_iGABA_netcon = [+6.166183692286649e-01   -2.756278714318582e-03   +7.254473749895178e-01   +4.923055187399142e-01   +5.518648648997743e-02   +1.767180144955442e-01   +8.056718659575125e-01   +4.201166879705086e-01; -3.972649211428903e-02   +4.180103112266467e-01   +3.545895353811817e-01   +4.636001527283585e-01   +7.765310831066180e-01   +6.535684994302781e-01   +1.828035502416809e-01   +6.871961269243638e-01; +5.284341752925955e-01   +7.935585408896435e-01   +2.610926597852590e-01   +3.719078555545468e-01   +2.477330650933025e-01   +3.638179309586805e-01   -1.387115252694209e-01   +3.060201159955874e-01; -4.033792748488772e-02   -3.855220924802163e-02   +1.919841440088361e-01   +4.426004973169770e-01   +7.814145584153345e-01   +4.967472138565161e-02   +4.745254609740742e-01   +9.320296751087447e-02; +4.511615484650023e-01   +7.100143939891082e-01   +6.915748532371813e-02   +4.744483044262582e-01   +1.175678191042714e-01   +1.798180679656811e-01   +2.938123089529129e-01   +6.743134321639110e-01; +1.268324774726162e-01   +1.930542322799674e-01   +5.032476265296287e-01   +1.295879924507687e-01   +9.803715814074103e-01   +2.085236588177614e-01   +4.041310370151462e-01   +3.807502567353193e-01; -7.938420728942977e-02   +2.114080957429472e-02   +4.190238652904188e-01   +6.808129619968581e-01   +3.535266167440528e-01   +1.000000000000000e+00   +4.583949978862603e-01   +9.527229855078934e-01; -1.151397194268038e-01   +7.330738505714714e-02   +4.014692247624039e-01   +3.521059493898463e-01   +5.355983661700849e-01   +5.855132891561057e-01   +3.673451613214859e-01   -1.989073651075396e-01];
L3E_L2E_iAMPA_netcon = [+2.311578333918371e-01   +4.681624108869752e-01   +5.197869088654565e-01   +2.627401384036873e-01   +6.488913501487306e-01   +1.472885035749168e-02   +6.924519429120606e-01   +9.072089378424026e-01   +6.151206874673840e-01   +1.198240633071685e-01   +3.041669461226959e-02   +8.996471036072153e-02; +5.581126981016646e-01   +6.570956684671516e-01   +3.186290739378276e-01   +1.417621577584241e-01   +2.878641830153681e-01   +6.662677076222326e-01   +2.073963891241218e-01   +3.666211186249119e-01   +1.057335374703781e-01   +4.777482048956502e-02   +2.806017263770765e-01   +5.406459340570625e-02; +4.609101128084017e-01   +1.844226554418085e-01   +7.626881907762608e-01   +8.170683408785439e-01   +1.854547056927451e-01   +9.571233569064406e-01   +5.298356645159251e-01   +9.643997012698964e-01   +3.533023815841983e-01   +9.791973184644867e-02   +1.920551538908176e-01   +4.380483060229320e-01; +1.306067787947511e-02   +4.517602261878608e-01   +2.194503341838798e-01   +1.344233955278252e-01   +5.800261032054945e-01   +5.979703359637414e-01   +5.436131400323934e-01   +3.242467784620436e-01   +4.780842414478758e-01   +1.802964694638873e-01   +1.279859765129444e-01   +3.712921233396709e-01; +3.817167713939135e-01   +1.000000000000000e+00   +6.408815141929276e-01   +3.547783541587494e-02   +8.328223492519053e-01   +3.364436847069658e-01   +3.315459264444567e-01   +9.126207549396310e-01   +6.897101600245654e-02   +1.639814661506964e-01   +1.131646431205314e-01   +6.347720916867854e-01; +1.335925056159300e-01   +9.046773118734983e-01   +3.330717729903100e-01   +4.828212074427182e-01   +3.663348514527180e-01   +3.578702521755583e-01   +4.134019738722580e-01   +4.451114141273884e-01   +1.517907340130276e-01   +6.315797013578500e-01   +2.095391730957293e-01   +4.918623667539851e-01; -1.816987202324771e-01   +4.129234819505860e-01   +3.338856526712261e-01   +7.034661983123885e-02   +2.465330358051564e-02   +2.746432883518821e-01   +7.752238039844351e-01   +5.907416054342630e-01   +7.952859902004987e-01   +2.990489126697028e-01   +1.666174571046075e-01   +4.790744525271296e-01; +3.980577882081848e-01   +1.334392983797125e-01   +5.857201102914640e-01   +3.958636055956367e-01   +7.567994029129707e-01   +6.673648936981096e-01   +3.464727373031670e-01   +6.518932984547173e-01   +8.047855844738332e-01   -5.036003589819334e-02   +8.126420956654157e-01   +2.770615216905493e-01];
L3I_L2I_iGABA_netcon = [+2.603228431968686e-01   +5.496813780752089e-01   +2.729821744095771e-01   +7.345442531038331e-01   +9.419993027151759e-02   +5.893475761916555e-01   +4.048279335572001e-01   -1.408153288346609e-02   +1.655689178712493e-01   +1.716957947516541e-01   +7.339248626364167e-01   +1.000000000000000e+00; +1.268913586578976e-01   +3.992109278095551e-01   +1.649151549330847e-01   +6.398485798414891e-01   +1.128488173422640e-01   +9.388778826334948e-01   +8.637712254113923e-01   +1.978322814634595e-01   +8.578052270231730e-01   +3.119718728633202e-01   +6.366636343869360e-01   +2.871815249914368e-01; -3.562577640615266e-02   +4.534913476406720e-01   +5.153110450405954e-01   +3.575260442039714e-01   +5.504396329343181e-01   +1.257924615300511e-01   +1.157716615758329e-01   +7.882926198538851e-01   +2.144431501815557e-01   +5.278171109441174e-01   -1.428202637818247e-02   +9.099429139084702e-01; +9.989463569305276e-01   +8.676835577430735e-01   +2.179868782294064e-01   +6.007149447254234e-01   +4.733911498734050e-01   +1.874012284119987e-03   +6.164791700645811e-01   +5.076821093283246e-01   +7.729397872267446e-01   +1.904617465266340e-01   +3.941205002224735e-01   +1.880053159114066e-01; +3.166539675362350e-01   +7.275194788790621e-01   +5.281889499649799e-01   +5.276482064236840e-01   +9.351408217982310e-01   +1.730076513820909e-02   +3.119046001447726e-01   +3.892178703185955e-01   +6.810177254971408e-01   +8.611965362861397e-01   +6.791886238726427e-01   +4.057043328660859e-01; +7.232532058964732e-02   -2.558652869887238e-02   -2.855456985425958e-01   +9.167019701802531e-01   +9.079639096765293e-01   +7.899513996890635e-01   +1.789594246788090e-01   +7.167891275061367e-01   +2.013729834742089e-01   +7.023806489294602e-01   +6.062606698008906e-01   +8.054443827066667e-01; +6.700258795662951e-01   +6.181338524608183e-01   +7.190004193839497e-01   +6.917430513530743e-01   +9.582379582102236e-01   +1.726191871668107e-01   -1.147389390205807e-01   +6.947961022204476e-01   +2.874874138807640e-01   +6.215577897280156e-01   +7.662636189528398e-02   +7.227518062410228e-01; -1.029197528530510e-01   +8.586610504935216e-01   +4.868673436566607e-01   +6.852277449134045e-01   +3.644696010500205e-01   +2.668769929411585e-01   +2.583237962508941e-01   +1.454318584120916e-01   +8.498595994612884e-02   +2.063162820916339e-01   +3.661417285376707e-01   +5.925603418403810e-01];
L2E_L3E_iAMPA_netcon = [+7.238038171013206e-01   +7.444031995583736e-01   +7.965891567235873e-01   +4.731333877605751e-01   +9.977646097966758e-01   +7.712675224480745e-01   +4.489782649377609e-01   +2.951176116443307e-01; +4.173628349655405e-01   +7.140281536351294e-01   +1.509148165124917e-01   +2.274813938755345e-01   +4.725177434922772e-01   +1.782886458322762e-01   +4.390283137267817e-02   -6.613660581871086e-03; +5.358800167684742e-01   +2.837650105030844e-01   +1.227838660746787e-01   +5.504961982999159e-01   +8.784514285146445e-01   -7.292673189484671e-02   +7.620321014547687e-01   +6.024394012457132e-01; +4.378564508162044e-01   +8.238776024131116e-01   +5.208361957657134e-01   -1.347218054262569e-01   +1.909839482552794e-01   +8.608002334469659e-01   +6.105710551399524e-03   +6.172915166518168e-01; +4.375592156637094e-01   +4.176283525565340e-01   +3.257900693825881e-01   +8.787532361146391e-02   +6.884470361033882e-01   +4.966426370440936e-01   +7.652648254904986e-01   +8.252222982085834e-01; -2.967386175306458e-02   +2.147670216596279e-01   +1.550912639518316e-01   +9.396879457053543e-01   +1.315225425537662e-01   +3.781783960594679e-01   +4.451588450496912e-01   +7.475214981130691e-01; +2.396315865190826e-01   +4.543803596134491e-01   +4.763940915557062e-01   +6.972296145316853e-01   +6.578775503040735e-01   +6.728977064090553e-01   +6.165045559529888e-01   +4.607991708648091e-01; +6.305893516913112e-02   +4.626976983290284e-01   +4.232052927996664e-01   +6.880519885226714e-01   +1.237509337137132e-01   +2.514436176070120e-01   +9.751625962380395e-01   +5.383266927753052e-01; +1.387388963723243e-01   +6.377602471645775e-01   +3.895080412352886e-01   +2.914757867323053e-01   +4.129670988439340e-01   -1.331706891012176e-01   +5.258384553502764e-01   -1.857964525183285e-02; +3.336965890026584e-01   +9.478461707017646e-03   +4.446002512644345e-01   -6.406323484150012e-02   +6.006689899650854e-01   +3.618244118800487e-01   +7.270772863094959e-01   +4.752198433664827e-01; +2.709059144281202e-01   +2.151144027412440e-01   +1.610333656343936e-01   +9.806766755084763e-01   +1.351509445040923e-02   +1.958404514724837e-01   +4.036449412086059e-01   +7.832639700892011e-01; +5.947145949011169e-01   +7.541953413764499e-02   +1.187300507801159e-01   +2.238626498163382e-01   +2.490700305401971e-01   +9.889826418990704e-01   +4.868734433563389e-01   +3.707073366985683e-01];
L2I_L3I_iGABA_netcon = [+6.319131098553027e-01   +6.685836741202210e-02   +7.632423992629080e-01   +1.000000000000000e+00   +4.873509889336192e-01   +3.002273406391733e-01   +4.682440590017820e-01   +5.774538982477241e-01; +8.060825741303537e-01   -1.563075612790281e-01   +7.082977464242685e-01   +3.013980179002276e-01   +5.948010358260504e-01   +1.321636597778988e-01   +4.252731546209658e-01   +6.551589658058929e-01; +1.445192416526289e-01   +2.803081161923770e-01   +7.923582694781420e-01   +4.450759602469535e-01   +4.317094622666147e-01   +5.131197149266166e-01   -1.389748698080618e-02   +6.897523247041417e-01; +6.473920924084647e-01   +5.168617056704199e-01   +9.747458996875737e-03   +1.727529617681046e-02   +1.581727473580676e-01   +1.370104623270370e-01   +8.012627715770607e-01   +6.497662048838923e-01; +1.093096518779183e-02   +1.122963170741141e-01   +3.467490480186268e-01   -8.738407562260452e-02   +7.429910322776829e-01   +5.585034298700934e-01   +8.382593648836693e-01   +5.296773735243531e-01; +6.546887190858449e-01   +5.444149892093738e-01   +3.647360355258857e-01   +6.333776253600462e-01   +5.255980650198125e-01   +4.664653757788441e-01   +3.375908891212167e-01   +1.355234938157948e-01; +6.663956944035776e-01   +3.337930320302599e-01   +1.233204514606728e-01   +7.606993622037567e-01   -5.705780139577662e-02   +6.328316325040027e-02   +5.375297216541246e-01   +5.437537833287927e-02; +8.355167977145527e-01   +6.326283655790038e-01   +2.228925886270014e-02   -1.138952315061375e-01   +4.170105203615823e-01   +2.862571401581018e-01   +8.077975363887073e-01   +4.512111972179026e-01; +3.929521724109222e-01   +4.885018738378132e-01   +2.109313548241643e-01   +2.428380928641143e-01   +5.291702378387981e-01   +7.932535621517559e-01   +2.721822506719289e-01   +3.515152979837763e-01; +3.676323141211711e-01   +4.236453041614984e-01   +1.126608554641342e-01   +1.417574559932559e-01   +3.759526841339311e-01   +1.859308340875001e-01   +5.731193895403075e-01   +3.204319990390243e-01; +3.896219819338324e-02   +7.484837558900774e-01   -2.801994901348669e-02   +3.051504525666313e-01   +2.139089716335275e-01   +5.363561133866451e-01   -2.792190707012029e-02   +3.685384618393029e-01; +6.442610481290473e-01   +2.642582888014345e-01   +6.093317561321885e-01   +2.847360184903195e-01   +8.530241875953358e-02   +2.633223063470611e-01   +8.442253561738270e-01   +2.670117144109283e-01];
L3I_L3E_iAMPA_netcon = [+2.257320102583411e-01   +6.762638122834623e-01   +1.545011155865786e-01   +6.904009204521224e-01   +5.399804812809219e-01   +4.772736524076944e-01   +8.684050951867504e-02   -5.806896158516973e-02   +8.079898378687854e-01   +4.040679886261698e-01   -4.467022097207061e-02   +5.744912350319669e-01; +9.713545794631037e-01   +4.032564178300428e-01   -3.085270263311189e-02   +7.838950199983826e-01   +2.361957644057049e-01   +6.588623879261679e-01   +6.067437327833300e-01   +4.857942770119820e-01   +1.990661206762561e-01   +4.704266841042924e-01   +5.231801696943970e-01   +4.253310283268134e-01; +4.426523422720605e-01   +6.804824217011304e-01   +7.756707787014462e-01   +1.938811384276762e-01   +2.417487789629095e-02   +3.646989708191223e-01   -1.553509938379221e-01   +4.369370824606339e-01   +3.351440881829454e-01   +3.726993260550006e-01   +9.247419578223275e-02   +1.550938526255555e-01; +3.482325115477358e-01   +2.635605312785664e-01   +5.097570807684052e-01   +2.901834022414858e-01   +8.607330195244196e-01   -2.802663700145054e-02   +6.664623183993181e-01   +2.964941576980960e-01   -2.724558012547555e-02   +2.566522962340341e-02   +3.196155695772966e-01   +7.026143602462234e-01; +1.763172161508783e-01   +5.348336747470713e-01   +1.955745015707919e-01   +7.698971795019462e-01   +6.478004601648967e-01   +4.857553450088684e-01   +1.001999275336004e-01   +2.122007415746593e-01   +4.891770729414427e-01   +3.360812963350530e-01   +8.002478336106175e-01   +4.461610991386551e-01; +9.631573734610909e-01   +4.313068628382715e-01   +1.876677882356545e-01   +7.028959795951397e-01   +3.773736838026377e-01   +5.115311298679859e-01   +2.413594071402437e-01   +1.834434039826811e-01   +8.400511907675546e-01   +3.743051701497772e-01   +7.370948607924702e-01   +3.544863366983595e-01; +5.404882027509030e-01   +1.000000000000000e+00   +1.092737073622145e-01   +3.350456856257111e-01   +6.595141251590656e-01   +3.562555191577317e-01   +6.275185694405772e-01   +6.517461149042529e-01   +2.302235805946469e-03   +3.392973978694042e-01   +3.026263437383747e-01   +7.609886143349198e-01; +2.151585081235640e-01   +8.494158446871882e-01   +5.809040813304556e-01   +6.837751377991356e-01   +2.526320915012222e-01   +5.440760589203573e-01   +7.600986627149120e-01   +5.099401139967450e-01   +2.222345356149153e-01   +9.519133739994093e-02   -1.724891793159860e-01   +4.066721376259462e-01; +1.348998820605481e-01   +5.542399060765695e-01   +2.437620027355080e-01   +3.299305555165849e-01   +4.075937562103298e-02   +6.539952955320102e-01   +9.064550933550304e-02   +9.970399524527948e-01   +3.366847301515994e-01   +2.319535947063852e-01   +4.895993215464702e-01   +5.866976654338685e-01; +3.238529410866566e-01   +2.387831186776029e-01   +5.421320295027682e-01   +7.068497547558552e-01   +5.411092012024021e-01   +4.671194086200165e-01   -1.226336165892205e-01   +2.787791626385170e-01   +7.553017758988719e-01   +6.913979683967874e-01   +7.078338662812222e-01   +8.863927095345354e-01; +2.590884177744055e-01   +8.439608342530948e-01   -3.350853331546183e-02   +2.926044445510389e-01   +6.507848634051344e-01   +2.608704007752861e-01   +5.803786452364439e-01   +4.436078953157057e-01   +3.750488222648818e-01   +6.237112774511919e-01   +3.574583805284563e-01   +7.568086785218701e-01; +6.694736712588842e-01   +5.578070218525119e-01   +5.347771664307931e-01   +1.072233395781613e-02   +1.418077494909376e-01   +4.917194366801614e-01   +5.532788609289798e-01   +7.647954539740501e-01   +8.043533027290813e-01   +4.533525725928881e-01   +5.064820749307523e-01   +3.078784621136306e-01];
L3E_L3I_iGABA_netcon = [+8.997273767036404e-01   +1.470957888099636e-01   +2.754676493039266e-01   +2.916011310187767e-01   +5.000159321592325e-01   +1.851658317114775e-01   +6.939118199806360e-01   +5.196270948273729e-01   +6.777843511541228e-01   +9.841907715004038e-01   +6.114403575424423e-01   +7.105400889521193e-01; +6.516938569868743e-01   +3.704962705175813e-01   +4.672463680730385e-01   +6.970876854762936e-01   +5.768942456032596e-01   +4.594807354557504e-01   -3.535951905123850e-02   +1.404785888777113e-01   +4.583597605508649e-01   +2.034486349997139e-01   +6.641947328802446e-01   +5.989589426274359e-01; +5.007105933534568e-01   +5.182667273948759e-01   +6.203783168566787e-01   +7.443305378101156e-01   +9.355749749592673e-02   +5.754510306329786e-01   +6.339826458034659e-01   +3.627718159042666e-01   +2.521739368449920e-02   +2.328639081353115e-01   +5.835287495833047e-01   +4.948343060948153e-01; +8.500096356906547e-01   +4.967648088847158e-01   +7.876023572466546e-01   +8.436085748730967e-01   +1.419025633273106e-01   +3.192127580994560e-01   +2.564008650287505e-01   +7.154459197157549e-01   +5.669925108569774e-01   +3.868344190374345e-01   +5.676574067814192e-01   +4.707279331397780e-01; +2.644650244145681e-01   +4.426473893130303e-02   +6.258582709606526e-01   +4.991365176866724e-01   +3.136050393039811e-01   +8.328317417458350e-01   +2.942559812241638e-01   +2.911628922467635e-01   +6.517491242678938e-01   +7.412630672479104e-01   +8.191334509419429e-01   +4.931114038920046e-01; +8.031367894330337e-01   -1.026193855662132e-01   +9.983889184846494e-02   +9.716366087947467e-01   +5.214861342511008e-02   +7.201287124421694e-01   +3.482133260663953e-01   -5.260495447312871e-02   +7.957081802455770e-01   +9.249781350110009e-02   +5.951894626529349e-01   +7.172400077791851e-01; +1.932079084520358e-01   +3.148608938314269e-01   +3.251561157365431e-01   +1.540549731900188e-01   +2.486121857116950e-01   +1.208942888120414e-01   +6.035879625937893e-01   +2.792240472182329e-01   +5.404397161439778e-01   +7.198683626493114e-01   -5.515473653548890e-03   +4.239321196062745e-01; +6.227231356210716e-01   +3.993030035216415e-02   +4.631339200858869e-01   +4.396586942663726e-01   +5.870970835201312e-01   +6.094310035137335e-01   +6.262410199167131e-01   +5.370331060725029e-01   +8.612394373848824e-01   +5.491737552264563e-01   +8.368613715776813e-01   +6.996172377994420e-01; +8.861259637246380e-01   +2.865430946747218e-01   +6.918214685722953e-01   +1.333265344940344e-01   +7.222821503746749e-01   +2.058193459122936e-02   +2.499888535265553e-01   +7.641197744681331e-01   +5.439130834422096e-01   +2.945404998304366e-01   +6.679541429603831e-01   +6.615641009197079e-01; +2.555131986238887e-01   +4.567581999563438e-01   +1.853336326549632e-01   +3.897968055968469e-01   +3.225791690572691e-01   +3.442819976828191e-01   +8.469868684025892e-01   -1.865505085004841e-03   +5.445952919558815e-01   +7.034684104793620e-01   +6.559355432172403e-01   +5.009526715228663e-02; +8.487998561350877e-01   +1.467677178233169e-01   +5.139016222616324e-01   +9.271462095367721e-01   +3.530580021861788e-01   +3.607313909351001e-01   +1.938643555546175e-01   +3.396820619345049e-02   +3.382735173518111e-01   +4.872770540788365e-01   +1.000000000000000e+00   +7.265979402728531e-01; +6.130821989259643e-01   +9.044768539770141e-02   +1.952063600111764e-01   +5.505309434956294e-01   +1.135321367566548e-01   +3.230915523371199e-01   +6.443271703988612e-01   +7.383508307937211e-01   +9.247680197062172e-01   +2.573587404669442e-01   +5.140939686425638e-01   +9.887481336780040e-01];
L2E_Input1_iAMPA_netcon = [+8.799540478226255e-01   +6.058151665757502e-01   +7.219546045214751e-01   +7.732971911456087e-01   +8.500180793582818e-01   +1.000000000000000e+00   +9.615914054521119e-01   +6.091144836900102e-01];
L2I_Input2_iAMPA_netcon = [+8.374516875980507e-01   +9.656305671348264e-01   +7.164464914078218e-01   +9.270235219205737e-01   +7.825896390614422e-01   +9.164461487690463e-01   +8.038136984005775e-01   +9.709863459860606e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
