function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.428701018622133e-01   -4.611499436546207e-02   +2.159837032118233e-01   -1.687446941762079e-01   -1.333279119662204e-01   -5.361245783518599e-01   +4.469237868328062e-01   +3.443373967074390e-02   -3.758943152600829e-02   +5.073061708482294e-01   -2.241161598977973e-01   -3.327116512293969e-02   +2.944099221716460e-01   +3.327142611159540e-01   -6.852059994724920e-02   +7.212434913057379e-02; +2.354784395022714e-01   -2.690226476936079e-01   -3.732134408948864e-01   +4.556748696616550e-02   -6.823860159614337e-02   -9.758414584384326e-02   +3.510621214972219e-01   -3.011090921812594e-01   +1.454862195603170e-01   -2.330443388340946e-01   -2.403077094688245e-01   +1.300934617265077e-01   -1.609723660136808e-01   -4.778348400280448e-01   -1.791142135166526e-01   -5.829354442194132e-02; +3.045505014167330e-01   -1.939527870819415e-01   -1.053009312951244e-01   +1.738847272561387e-01   +3.363187050973457e-01   +2.419974833792335e-01   +2.288618878109755e-01   -1.355227948700477e-01   +2.370384513455098e-01   +1.469237323200188e-01   +4.215431580452824e-01   +1.400153815012644e-01   +1.855009372895636e-01   +2.583765426631112e-01   -1.692931127040968e-02   +5.097410499045182e-02; -2.878844093045600e-01   +4.212397417381475e-01   +2.278348945558229e-01   -7.926375279179576e-02   -8.441945477405796e-02   +2.940535612284210e-01   +3.441091426972089e-02   +1.351054870850911e-01   +1.685260594117543e-01   -2.623575883531459e-01   +2.000796669854164e-01   +2.259585632502639e-01   -4.620264888400255e-03   +2.686123340342349e-01   +2.518296023619609e-01   +1.748226551319902e-01; +2.514171407595649e-02   +2.691200489009185e-01   -2.351589083079630e-01   -1.371498696712363e-01   -5.483325409391149e-02   -3.075264344276196e-01   +5.770469211399917e-02   +2.404160270951575e-01   +1.082011452028692e-01   -8.595523627469409e-02   +1.751241325409042e-01   -2.655964667427056e-01   +5.194921065088622e-02   -1.102206170547810e-01   +4.840337283147991e-02   +2.438101127828936e-01; +2.046816617237673e-01   +4.161871368978773e-02   -1.973430770775884e-01   -2.051181127538793e-01   +1.200762063778954e-01   +1.527577976976777e-01   +1.536896231719217e-01   +2.930791505635968e-01   +4.856972892203508e-01   +2.674993658645696e-01   -2.799264407216512e-01   -1.113550790827301e-01   +1.708954917872510e-01   -5.840066601336666e-02   -9.337526456213313e-02   -2.794046456361169e-01; +3.693879855108470e-01   +4.303003076905203e-02   +1.713215831432008e-01   +1.816140237892916e-01   -2.195102624477867e-01   +2.680453205276898e-02   +7.197435471758938e-02   -3.815900108222237e-01   -5.118143934774994e-02   -2.171100076672015e-01   +2.118048123586662e-01   -1.766709221260209e-01   -2.160124852581032e-01   -2.035175903104815e-01   +5.326719282014730e-02   +1.390002787862259e-01; -2.475989086150471e-01   +3.469118277843141e-01   +7.456657008215622e-02   -1.365024942389884e-02   +8.320599486882221e-02   +1.586504991340608e-01   -2.925042238515185e-01   -4.410752587276904e-01   +1.193974250289392e-01   +1.525404002387554e-01   -9.305585457075959e-03   +8.847801604585548e-02   +3.504179112102124e-02   -5.003359195556007e-01   +2.704596400213813e-01   -3.561375095167946e-02; -2.102330131904759e-01   +3.009738688001004e-02   -2.069488855944290e-02   +2.421510082904999e-01   -6.340727530057140e-02   -1.419510210340881e-01   +4.327109165607357e-01   -6.806228684039281e-03   +4.704490216623020e-02   -4.044434444927461e-01   +2.148807682476951e-01   -1.769079085690814e-02   -1.521229143351908e-01   -3.828392652830499e-01   -1.093165840449774e-01   +1.882088114191036e-01; -1.242781654300070e-01   +2.306992780982223e-01   +3.000502693603579e-02   +6.406780528322162e-02   +2.031187908238359e-01   -4.985463567089012e-01   +4.600578188799920e-01   -1.319337778189475e-01   +1.029285038150491e-01   +1.123119161479225e-01   +8.787737351914249e-02   -1.178741099988412e-01   -1.876004837338895e-01   +1.330620696165244e-02   +8.075081177549225e-02   +8.601967530407195e-02; -4.095013995212724e-01   -3.065527159435649e-01   +5.381919812952057e-02   +2.924846510013205e-01   -2.599290146110420e-01   -8.536429918639374e-02   -5.166559186201194e-02   +2.872694697455261e-01   -2.061847866578082e-01   -3.383699607725299e-02   +7.785281490964463e-02   -7.829482551804015e-02   +3.689272440028285e-01   +4.214407103372411e-03   -1.267485872726418e-01   +3.021092024706784e-01; -1.853573823264614e-01   -8.217927265295896e-02   +1.860567431075024e-01   -3.423684055829364e-01   -1.522988169649115e-01   -1.924492999052452e-02   +3.210630203850434e-01   -3.140146412608630e-01   +3.989660714412154e-01   -3.857966730678856e-01   -1.118730249932697e-01   -3.648108677084795e-01   +5.010008588393738e-02   +3.950593511113380e-02   +3.841178413147295e-04   -3.335498156392389e-01; +2.015993318203471e-03   -1.196844803196553e-02   +1.860721799998293e-01   +1.757199450834551e-01   +2.517585977029305e-01   +3.233105720782417e-01   +5.905000256626233e-02   -2.972794824602235e-01   -2.099403659343277e-01   -2.053325107515448e-02   +1.534649309433370e-01   -1.590660146001838e-01   +4.536814967749736e-02   +1.246034048157596e-03   -3.157155874423641e-02   +2.702130607521919e-01; -2.206971034996275e-01   +2.130671698665807e-01   +9.500483878867073e-02   +3.901021291137399e-02   +4.020505518495865e-03   -5.240763750957090e-01   +1.055514768189628e-01   +3.298935916693560e-02   -3.173091707193135e-01   +1.304643251722523e-01   +3.471608837466724e-02   -3.805948638238464e-01   -8.063330328624853e-02   +2.063045536547512e-01   -1.182862387798579e-01   +2.353001207580341e-01; +2.559193276747415e-01   +6.867895691176973e-02   -1.190854339501073e-01   +1.300575892302045e-01   +2.005121409383019e-01   -1.191902557565270e-01   -1.093186006194632e-02   -8.500587200519696e-02   +7.122556166999873e-02   -3.260537128856796e-01   -9.710105043976289e-02   -2.830167050381766e-01   +1.507816243851213e-01   -2.000190742826897e-01   -2.979711340836232e-01   -6.854329541068882e-02; -3.614654488974136e-01   +1.047165955381241e-01   +6.548454101249855e-02   +4.509197696589162e-02   -1.579619959053590e-01   -8.518931424125241e-03   +4.539651813679837e-01   -6.839402819825047e-01   +1.806705343153236e-01   -3.019366234031047e-01   -5.402416277126311e-01   -1.583007690952656e-01   -2.735325546595891e-01   +6.128800385307513e-02   -9.231337194532313e-03   -2.785932749442852e-01];
L1E_L1I_iGABA_netcon = [+3.080330562319825e-01   -4.717789779161741e-02   -4.092395677073686e-02   -6.093877290798722e-01   +1.556422330147766e-01   -3.214831662049789e-01   +5.045517483005718e-01   +2.155700947943752e-01   +3.271075233194736e-01   +3.287813714548578e-02   -2.233011793909680e-02   +4.566271674059780e-01   -3.099713311748141e-01   +4.262930075550889e-03   +4.457149939119233e-02   -4.220626187137723e-01; -4.603852107162826e-01   +2.943496591742450e-02   -1.451063969432792e-02   +4.383904778244051e-02   +2.128015621997328e-01   +2.349808253623579e-01   +1.646211194205439e-01   +1.994518999712219e-01   +4.279327232244211e-01   +5.216343341660556e-02   +2.306215262513143e-01   -2.344260119993657e-01   -8.096539069537016e-02   -1.609912560019306e-01   -4.056948900679164e-01   +2.460472805662177e-01; +3.640332530273795e-01   -2.203195269090791e-01   -2.240971823949230e-02   +3.690367566575082e-01   +2.072475060486328e-01   -3.838999980422006e-01   -2.401274698693728e-01   +1.396941731810360e-01   +5.558707739036113e-02   +3.952100437662222e-01   -3.307135356095565e-01   +4.300911567483695e-02   -5.677411778594273e-02   +1.177046629994601e-01   -1.622622503380304e-01   +4.071633744346730e-01; -8.520211537373959e-02   -4.598603239735999e-01   -5.861316636757548e-01   -9.180973950955418e-02   +3.848108295606505e-01   -1.311320863444589e-01   -1.328204312394936e-01   -2.794204418555128e-02   -1.535938435799492e-01   -2.923328272836159e-01   +1.065079626617303e-01   -1.018504930561358e-01   +2.863292209538790e-01   +1.226242552591702e-01   +1.297203776197753e-01   +2.589257988863700e-01; -1.440088338920630e-01   -1.970568966134110e-01   +1.592830054632018e-01   +9.267648229957479e-02   +2.791906695968289e-01   +3.388004957786139e-01   -1.030321919789030e-01   +1.594506325484299e-01   -6.589243330660556e-02   +1.717952845705354e-01   +1.456359145554871e-01   +2.040707166591882e-01   +1.100193596726375e-01   -5.474985888662051e-01   -2.504845607088060e-01   -1.027844983791545e-01; -1.631323318509272e-01   +2.455892379038247e-01   -9.133179385553797e-02   -2.335918257823973e-01   -8.248698681897654e-02   -2.827219724230873e-01   -3.108096828193251e-01   -1.795365739768724e-01   -6.057925665011082e-02   -1.069284139890840e-01   +3.089850070650332e-01   +1.575690961802120e-01   -2.109486368524537e-01   +3.394155809674469e-03   +4.284672540044583e-01   -4.239625036120825e-03; +2.148668306944010e-01   -3.079817896842232e-01   -3.829143699535998e-01   +3.478888342413508e-01   +1.070287574874229e-01   +2.048483709229584e-01   -7.256146782594029e-02   +7.156089532941361e-02   -3.531189639524163e-01   +3.310386314173999e-02   +3.144284990610790e-01   +1.492985026357599e-01   +5.304424892175711e-01   -1.503278978666328e-01   -4.047674142172294e-01   +9.863913984561698e-02; -3.331031640599701e-02   -3.867112398114048e-03   +2.120781993701810e-02   +1.656569480969267e-01   +1.502438219922757e-01   +1.557896034675863e-01   +1.906280879310215e-01   +1.072528095855407e-01   -4.546846174746551e-01   +1.879244989323550e-01   +7.636884048524167e-02   +4.718929858386461e-01   -1.946639930323877e-01   -6.521218754653496e-02   -1.326152625258712e-01   +1.167534340262312e-01; +9.633880270968932e-03   +2.155563726588860e-01   +8.912770595929789e-02   -1.492939463940336e-01   -1.606632500160454e-02   +3.129615294530646e-01   -4.529333963129833e-02   -8.880819343110355e-02   -1.282789018226625e-01   +5.933875935904651e-03   -1.256976451860361e-01   -3.788563126881685e-01   +2.391259961522671e-02   -8.282826519397304e-02   +1.544484582966771e-01   -1.823288553266232e-02; -6.648656567696219e-02   +7.500039371605090e-02   +2.486437583835509e-01   -1.245004125018176e-01   -9.689649455093863e-02   +3.092660304744476e-01   -2.114269655594430e-01   +6.668455881596830e-02   -3.555248541311806e-01   +3.217922594789915e-01   -4.174383489549830e-01   +3.707686674649304e-01   -4.360096407064852e-01   -2.175633538510511e-01   +9.306261903840472e-02   -4.227558230147528e-01; -3.777376978156233e-02   +2.316818903206730e-02   -1.823135510352417e-01   -6.963065279334266e-02   +4.275253345628585e-01   -2.193665930076297e-01   +3.476986747847963e-02   -2.239951244247210e-01   -2.005553323959439e-02   +1.620365893965229e-01   -3.534980537553878e-01   +9.579567938066272e-02   +1.212681783552340e-01   +1.887010336268336e-01   +7.188160772551584e-02   -1.341148652449314e-01; +2.459695202123698e-01   +4.448129933091101e-01   -4.432402568802862e-02   -2.381301764400000e-01   +1.332139055984084e-01   +7.517908361150802e-02   -1.140225556067487e-01   +1.343984125952516e-01   -3.106709628644262e-02   +2.740049659831937e-01   +5.836252818404447e-02   +3.598639879388384e-01   -7.900652796632344e-02   -1.648050818549220e-01   -3.549060144385965e-01   +1.608005891787340e-01; -1.636565491017503e-01   +3.364175684297447e-01   -1.695978897245380e-02   -1.386054520648396e-01   -4.209247354378971e-02   +6.830329388763517e-02   -4.391448641263439e-01   -8.997093347826181e-02   -5.416871223622990e-01   +1.040286081481631e-01   +1.528901577727095e-01   +3.670533399865450e-01   +1.694477083531324e-01   +2.132974060403969e-01   +3.234568095364034e-01   +1.920375884913652e-01; +1.590719226470990e-01   -1.626698149208504e-01   -1.165854478933820e-01   +2.192136284491212e-01   -1.806033160402271e-02   -7.967223401679253e-02   -1.370997730281346e-01   +3.935389274677179e-01   -3.566412982606894e-01   +4.014985451774380e-03   +1.856418137829529e-01   -2.273741177017229e-01   -4.637018655631325e-02   -2.147761187623964e-02   +1.382312991326936e-01   -1.919825853285890e-01; -1.165660395659194e-01   +3.330954631578587e-02   +4.031168152957646e-01   -3.506054321143482e-01   +1.301997569083777e-01   +2.858404165226048e-01   -1.338911300566991e-01   -2.968627637130751e-01   -4.007657662168150e-01   -1.415676456072276e-01   -6.090469369138207e-03   -1.723874159315137e-01   -3.743241157987745e-01   -1.905616023438889e-01   +1.822997193378920e-01   -1.912144359439079e-01; -4.031941620099935e-02   -2.210921042839470e-01   -3.824077329086326e-01   +3.167779431823953e-02   -4.589629582675341e-02   -2.992775806495174e-01   -7.660027558139605e-02   -3.132227073947464e-01   -6.791200139036055e-02   -1.324583304778608e-01   -1.730274618546468e-01   +1.647875788295403e-01   -2.303855167889115e-01   -1.753353203197495e-01   +2.671961133231389e-01   -1.289164355129767e-01];
L2I_L1I_iGABA_netcon = [+5.796239958755052e-01   -1.117863069986255e-01   +2.540839499859522e-01   -2.462023891757391e-01   +4.297080161647690e-01   -2.427695348602709e-01   -2.505151105029556e-01   +2.259474684384039e-01; -1.863369913117196e-01   +4.718904518995223e-02   -1.188678524173405e-01   -3.029199876745631e-02   -2.562970102264016e-01   +6.591742813355139e-02   +1.433249968048682e-01   -1.187329898980401e-01; -4.128038887439847e-01   +4.909446553651382e-01   -2.280139180508812e-01   -1.580846051434116e-01   -1.788266913677965e-01   -4.036745185682492e-03   -1.557253104903411e-01   -2.000210457598628e-01; -3.182254097843949e-01   +1.661240023948850e-02   -5.712099646696442e-02   +2.245175418653637e-02   +3.394139064749288e-02   +7.086999810763292e-02   +1.536529934333878e-01   -5.190203355617534e-02; -2.921341655765089e-02   -6.003561469685119e-02   +4.324119007046665e-01   +4.216741657239557e-02   -2.720882728028176e-01   +1.472893427560336e-01   +9.448762932144344e-02   +4.030397390333498e-01; +6.817328864895367e-02   -2.594252096042821e-01   +3.232883840927214e-01   -9.347496301414290e-02   +1.229810974960598e-01   -2.418594685431983e-01   +1.005508791016590e-01   -6.288480220942470e-02; +3.962150284768751e-01   +7.820846032419168e-02   +2.637955274272760e-01   -3.142044532623409e-01   +1.946781965215656e-01   +2.018339168431543e-02   +1.352774618011199e-01   -3.841108981666272e-03; -4.586109632731397e-01   +9.573753931592613e-02   -6.615058424995304e-02   +1.489829416298832e-01   -1.603127545201815e-01   -7.623128719180758e-02   -2.661913733468805e-01   +5.264406356660500e-02; -4.344419583613310e-02   -4.538789777203794e-01   -2.315407878124846e-01   -9.918480923121087e-03   -1.877907312085206e-01   +2.003364666956259e-01   -2.227838157896475e-01   +1.194596648259257e-02; +4.229432375509719e-01   +1.020060274939736e-01   -2.097732928708443e-01   +4.251588879085690e-02   -1.396784633522815e-01   -4.764814851008700e-01   +2.406962010591287e-01   +1.646302919041167e-01; +3.178260235012526e-01   -3.376297282954892e-01   +1.636164733417376e-01   +3.891547996231317e-01   -5.942803137834754e-03   -4.017487806742290e-01   +1.134706614538189e-01   -5.523406496214024e-01; +1.546317936497961e-01   -8.576058092409530e-02   -1.347359268197914e-01   -1.507106856699263e-01   -2.955495538581595e-01   -4.357832908155810e-01   +1.876351041650829e-01   -2.670887690701642e-01; -2.247594587658412e-01   +1.485326423033949e-01   +3.077470917931326e-01   -1.835849964895555e-01   +4.308718625012200e-03   -1.248155105317547e-01   -2.009109985726175e-02   -2.116946438873469e-01; -1.026623936340934e-01   +4.091428766488070e-01   +5.083679857968023e-02   -1.650311880983702e-01   -2.215362127974147e-01   -1.751914044864468e-01   +2.611489603873816e-01   +7.229473108329580e-02; +6.231479854764937e-03   -2.492077878231624e-01   -2.598087223475847e-01   +2.477398535977627e-01   -1.753325724123287e-01   +2.687865455387360e-01   -3.315100934738450e-01   -1.328299715917274e-01; -1.192299361299402e-02   +3.071525749201002e-01   +1.935472610143393e-02   +6.296003272370401e-02   +4.536057623725192e-01   -3.040625297692006e-02   +2.703486772294026e-01   -1.418795330255973e-01];
L1I_L2I_iGABA_netcon = [-3.511260869805157e-01   -6.543365604342380e-02   -3.682743250859468e-01   +2.879648794745290e-01   -1.495979899447019e-01   -1.208572489235921e-01   -2.265988013493119e-01   -2.927199731489648e-01   -2.491395928985415e-01   -1.549810720778093e-01   +3.505831984462573e-01   -1.833382916885671e-01   +3.801771171152530e-01   -1.271820329269182e-01   -8.217403224974462e-02   +1.461872604854098e-01; -9.940850748059774e-02   -2.237471847954263e-01   -9.865685793077564e-02   -1.646241777313551e-01   -1.221881219644108e-01   +1.657386916631325e-01   -1.904811680820641e-01   -1.765307941088773e-01   +2.244891873984622e-01   +2.270565576574311e-01   +1.571560112298093e-01   +6.330123209265964e-02   +8.214071939971138e-02   -2.591210204565014e-03   +3.480022978650452e-01   -2.483548637161603e-01; -1.890599295155756e-01   +4.967976461893667e-02   +1.757296417060595e-01   +1.348414164935998e-01   +9.648177634024269e-02   +4.030553951340414e-01   -2.011475167221186e-01   -1.465221991108590e-01   +2.617668938485394e-01   -5.083044158615310e-01   +3.576679195012264e-02   -1.765622284960763e-01   +4.094937531074595e-02   +8.761333550517775e-02   +1.273480056034069e-01   +6.374816242321371e-02; -4.062818754192360e-02   -7.071168222647446e-02   +1.017669893842222e-01   -3.512048027987481e-01   +2.286665658765181e-01   +1.609080582444901e-01   -2.756304469332256e-01   +1.979433151571661e-01   +1.782291785630616e-01   +2.018532069915541e-01   -3.061062699491366e-01   +3.097743679915330e-01   -4.390152467538562e-01   -5.102720618488241e-01   +6.820868044375561e-02   +5.162793678394283e-02; +1.512414895011200e-01   +1.599056403818275e-02   +7.897975725841486e-02   +8.133835681828289e-02   -4.673945292375922e-02   -2.957366581914708e-02   +3.601656952841161e-01   +5.985371876968151e-02   +1.094776939353312e-01   -1.642759362169361e-01   -3.223343244755619e-01   +2.994193318613191e-02   +2.986892170181653e-01   -2.858536080141808e-01   -7.290222913373641e-02   +1.500095263600480e-01; -2.825867775854079e-01   -2.145611770298243e-02   -1.617632113070473e-01   -1.204975484853029e-01   -3.045206977917524e-01   +3.477428825792168e-01   +1.003109279718330e-01   +3.427122066767518e-01   +3.364810955932199e-01   -1.207823614660844e-01   -4.608101501231930e-01   -4.604530066768285e-01   +2.591687089901205e-01   -6.212377646447349e-02   +4.175498564952705e-01   +2.024226007284398e-01; +4.057270340570415e-02   +4.032550608750929e-01   -4.275643325220532e-01   -5.010020314577763e-01   -5.147321798309101e-02   +1.622467825483158e-01   +1.987944550332879e-01   -1.783682040173874e-01   +1.188627416071265e-01   +1.018579086843738e-01   -3.645215169824229e-01   +1.000319288225877e-01   -1.699211357329864e-01   +1.844914737855730e-01   +1.987868787800395e-02   -1.708517550443768e-01; -2.276864888049246e-01   -2.599797591265764e-01   -4.035532124417218e-01   -3.449090828363481e-01   -4.663544822567531e-01   -2.899460801873701e-01   -1.292064988057882e-01   -2.384218775689889e-02   -9.559736706272776e-02   +6.073224231831319e-02   -2.746008318217379e-01   +2.291229787132439e-01   -2.269185282547281e-01   +7.165160447726421e-02   -1.031149530215547e-03   +1.274763220481451e-03];
L2E_L1E_iAMPA_netcon = [-2.652077750822919e-01   -2.156134177285642e-01   -4.250819999622957e-03   +1.139210335683650e-01   +5.163354601390453e-01   +4.182822034390624e-01   -7.873872121399174e-02   +8.271453669336737e-02; -1.657133359075325e-01   -6.392291868372180e-02   +2.106742156273377e-01   -1.036308737258425e-01   +8.868677724460468e-02   +1.611808420607779e-01   -1.949138385296513e-01   +5.891909511349075e-02; +1.013318036904872e-02   -1.758983649690771e-01   -4.033716310165527e-01   -1.425568056897339e-01   +2.755560947127989e-01   +2.394841811032096e-01   +7.684661657265057e-02   -2.564527275737398e-02; -5.456148552156306e-01   -2.382157586637496e-01   +2.142914168324569e-02   -1.903223686235140e-01   +1.664298775758633e-01   -5.605204610122927e-01   -1.257140265176615e-01   +1.302382768398447e-01; +5.008525618635920e-02   -1.188874253249229e-01   -2.305801587380402e-01   -6.872983366425708e-02   -3.685695748280456e-01   -1.448003852507264e-01   -5.018071679624493e-02   +1.138187260569442e-01; -4.539664418812844e-02   -2.888070925494108e-01   -1.695029446714078e-01   -6.672829120467960e-02   +1.683619415442175e-01   +7.702945285677423e-02   -1.780260718385868e-01   +3.467564582188171e-01; +8.867936054019349e-02   -2.271531362592141e-01   -2.825335878555191e-01   +1.166566966414502e-01   +4.422953801908263e-01   -3.173482976228169e-01   +8.830509410650303e-02   +9.339724065246513e-02; -1.257193336398222e-01   +1.646471030500732e-01   -2.913996068401785e-01   +1.466405019298059e-02   -2.515421243869651e-01   -1.153926140096487e-01   -2.095056694234194e-01   +2.709214351176629e-02; -6.626398511715832e-02   +2.295064349065136e-01   +1.076845973861277e-01   -2.953569002194368e-01   -2.122635508032577e-01   -1.575818488025560e-01   +1.027530265316518e-01   +1.320076360344654e-01; +1.426959588635134e-01   +1.354238236529372e-01   +2.160140623350736e-01   +4.472303956499088e-02   +2.056375307245943e-01   +1.330551323220891e-01   +2.260104036962446e-01   -3.445636089645018e-01; -1.177449545529765e-01   +2.326284656626984e-01   +1.691488419765344e-02   -2.065371468482103e-01   +2.675972820940532e-01   -1.443300183410490e-03   -3.246688463036579e-01   -3.355499744964049e-01; +1.100915938439301e-01   -8.717240863339323e-02   -2.676704768804629e-01   -4.483779003721150e-01   -1.295031459911166e-01   +9.127074751921274e-02   +1.527820812582514e-01   -1.067578068740534e-01; +1.286238119050558e-01   -4.634201968863741e-02   -1.729350393649229e-01   +1.620255990025627e-01   +1.263123493814008e-01   +3.128095082938592e-02   +2.132697101019291e-01   +8.580944951702979e-02; +1.835179330153556e-01   +3.536140310061428e-02   +1.339697398766226e-01   -1.160179047787698e-01   +1.980823415009282e-01   -2.036489155069321e-02   +5.060574532032129e-02   -6.218222149956823e-02; +1.935038482294025e-01   -5.233154554157181e-02   +1.302890993656017e-01   +1.324379692220434e-01   -5.748289137860126e-02   -2.201919050116358e-01   -1.450928704839113e-01   +3.101704984825708e-01; -4.849327205622311e-02   +3.387596158137433e-01   -6.699867983090135e-03   +3.333425165317941e-01   +7.606188098088840e-02   +2.641306445463942e-01   +3.211552482349078e-01   +1.156639091781970e-01];
L1E_L2E_iAMPA_netcon = [+6.832207972211990e-02   +3.533531852953328e-02   -3.713372464041486e-01   +8.761011998909959e-02   -4.060225107118866e-01   -5.149878380472546e-01   +1.415348806381353e-01   +9.936953994622823e-02   +1.010307105216529e-02   +2.492029673452399e-01   +6.895311194669625e-02   +1.983140144343670e-03   +2.309089728146681e-01   +6.259512412449762e-02   -3.088317533512434e-02   -9.194933039937934e-02; -6.438648989238228e-02   +3.500114866235923e-01   -1.263135608015504e-01   +7.247110156870201e-02   +1.763038814632615e-01   -1.957177468594721e-01   +6.878535816549529e-02   -1.363855588045692e-01   +1.274707575927335e-01   +2.467707347702157e-01   -4.089433284321387e-01   +1.400727130124943e-01   -2.424553484049337e-01   +1.912127451324242e-01   +2.867680048107569e-01   -3.126813360265441e-01; -3.246633636767957e-01   +3.542129711933854e-01   +2.184328001905586e-01   +7.878920322924927e-03   -4.355725798533057e-01   +6.597678837890004e-02   -2.784974833871187e-02   -5.622048461716472e-02   +2.243286244072077e-01   +1.314455908234256e-01   -8.520544246663961e-02   +2.933736398648663e-01   -2.141720021565786e-01   -2.020781055849649e-01   +1.687754884665340e-01   -1.380860589940522e-01; -4.044849115061586e-02   -1.818256954854867e-02   +1.714713955110639e-01   -3.676958332179428e-01   -2.232501962851311e-01   +1.473008940305627e-01   +1.773659497571624e-01   -2.512653533737378e-01   +2.725671514329097e-01   +1.156479265090782e-01   -4.911526291974810e-01   +3.209296642656377e-01   -3.794362652076462e-01   -3.709273631576774e-01   +1.127592646648891e-01   -3.514202171340475e-01; -5.049860881206500e-02   +3.543057977454647e-01   +3.403259818987653e-01   -3.447904746494340e-02   -9.681896557228334e-02   -3.245865388439978e-01   -1.070081292691970e-01   +1.254842010759175e-01   -3.289453223367033e-01   +5.853086080956390e-01   -9.452068390258472e-02   -2.976229375148103e-01   +1.189001653016683e-01   +3.961607462736264e-01   +2.028532717405204e-02   -3.237798087719007e-02; -4.852059265058885e-01   +2.503896057827760e-01   +2.695093716721633e-02   +7.588869529932490e-02   +1.678108608380216e-01   +1.149095397137696e-02   -1.059541193410408e-01   +4.372567945749127e-02   -2.037532196721190e-02   +4.657928733108191e-01   -3.418213505167392e-01   -3.162741547808695e-01   -1.482403838526603e-01   +4.726236185767838e-01   -1.228535037734899e-01   -2.311940696320870e-02; +2.183279003385470e-01   +4.864132264813124e-02   -3.650721763602361e-01   -2.376392321149832e-01   -1.351175966464006e-01   +2.149407190038481e-01   +1.039824008158746e-02   +2.165351878081821e-01   +5.355236353767487e-02   +4.599798300903140e-01   -3.196372085428898e-01   +4.138195828747687e-02   +1.821525389855590e-01   -3.661259262016074e-01   +1.220545049639837e-01   +2.290456945915725e-01; -2.490242265786289e-01   -2.398250429879860e-01   +2.084758269710102e-01   +2.005241327702566e-01   -1.489142461980474e-01   +7.823957087626182e-02   +2.143967194120341e-01   +3.008964340113872e-01   +5.995000005265450e-02   -1.185206685911136e-02   -1.833436465712953e-01   +2.366611740280737e-02   -7.297699834738912e-02   -5.109320082018985e-01   -1.318343922628087e-01   -2.277900246723652e-01];
L2I_L2E_iAMPA_netcon = [+2.162026032717557e-01   -9.820692167055023e-02   +1.087383809294133e-01   +1.428424609275296e-01   -7.181342319595271e-02   +2.268037677240922e-02   +1.892156481852227e-01   +2.148619801761701e-01; +1.424168880069719e-01   +1.796507593417396e-01   -3.629896831447136e-02   +3.020008974828698e-01   +1.559144957637096e-01   -2.459193406649965e-01   +7.775856944490832e-02   +1.237846812057633e-01; +3.304227809319748e-01   -1.087863417084276e-01   -3.981910250518464e-01   -1.915118618732707e-01   -4.021832497452505e-01   +1.727597683620854e-01   -1.554830040675432e-01   -8.358188996757120e-02; +3.850623456280398e-02   +1.348983825147446e-01   -1.147733186591533e-01   +1.143117546562367e-01   +1.175828583561412e-01   -3.019008640833146e-01   +1.012305581825302e-01   +1.436150900573823e-01; +1.146184244046793e-01   -1.391629482470544e-02   -1.452667105392640e-01   +1.021320126797455e-01   +3.337255442461852e-01   -1.091316940332168e-01   +1.703221882552132e-01   -2.420689752458183e-01; +1.850632963791199e-01   -1.688179802684881e-01   -1.991583052004084e-01   +1.514734691203833e-01   -1.535075856312562e-01   +3.173401564211838e-01   +7.757679305754157e-02   +1.183511808555475e-01; +2.579838114860812e-01   +6.612403328622356e-02   -4.371039325332163e-02   +1.217135556102854e-01   -3.610718897540618e-01   -1.527370932693156e-01   +1.263919781997289e-01   +2.894535545357672e-02; +2.817457114163159e-01   -2.674862148058586e-01   -1.782571807211355e-02   +1.932318738139607e-01   +1.316878617210604e-01   +4.329023348493234e-02   +5.350971707416203e-01   -4.298204152595203e-01];
L2E_L2I_iGABA_netcon = [+2.552839878852938e-03   +6.266666128802020e-02   +7.176659555466758e-04   +2.205620217387479e-01   -2.723132466499448e-01   -5.389491388560205e-02   +7.451371145997819e-02   +2.523535677758634e-01; -7.919124677521394e-02   -2.683273199965247e-01   -5.568687365388403e-03   -2.087723780295286e-01   +3.399781675912626e-01   -8.678241215676155e-02   +2.256049949716294e-01   +1.416986999433076e-02; -2.948013056720127e-01   -8.433911962571801e-02   +3.990140192965408e-03   +2.639031174050772e-02   +9.669900466109332e-02   +3.757694699746496e-01   +1.410162325061482e-02   -3.191512660609586e-01; -1.335751778812512e-01   +2.455689694099953e-01   -3.791731923818925e-01   +3.304889136452546e-01   -3.492189457638713e-01   +1.151359337012520e-01   +1.500781138629156e-02   -8.521546346265957e-02; +2.311219927109154e-01   -1.378073331509514e-01   +1.633908155165829e-01   +1.111797954664622e-01   +3.746550748071860e-01   +5.787866154224039e-02   -1.440847402466157e-01   +8.384439520162819e-02; +6.037566470295613e-02   +8.493130488717207e-02   -5.829574122348188e-02   -7.332083001341567e-02   +2.284038637434982e-01   +3.331041959597393e-01   -1.452281709069516e-01   -1.427288870090946e-01; -7.721859219933544e-02   -4.040317225304123e-02   +4.302199087883335e-01   +6.529325575801391e-02   -8.085111865548339e-02   -4.083295307023703e-02   +1.130337750991208e-01   +7.431586868866319e-02; -9.982034097021590e-02   +1.350306119285068e-01   -2.709288573419577e-01   +2.595345321044307e-01   -9.817936374742108e-03   +4.425320571716495e-01   -5.011684206079861e-02   +5.738489792033802e-02];
L3E_L2E_iAMPA_netcon = [-7.222870165696574e-02   -3.884595671647625e-01   +1.140685419642949e-02   +2.365525966671798e-01   +2.205249101688167e-01   -1.888474829912205e-01   -2.556471631610103e-01   -2.354112996975629e-01   -3.309800560971810e-01   -5.174983265146829e-02   -4.325862434675037e-01   +3.065955801186114e-01; +2.800053467411583e-01   +3.078595079770996e-02   -4.351508858116505e-02   -4.325652974493539e-01   -2.175356094764271e-01   -1.748656197436628e-01   -1.601421056298477e-01   -1.881151453535228e-01   -2.630867193337545e-01   -8.838615121219477e-02   -4.175170547076892e-01   +3.392281399164219e-01; +7.066563240601162e-02   +2.875134918047395e-01   +2.849728317327558e-01   -1.332792660818589e-01   +2.315378263895536e-01   +3.682475719671804e-01   +1.241918512583100e-01   -1.494170743481789e-01   -5.406247370566809e-02   -7.675931633636761e-02   -2.164575653895301e-01   -5.013376552501234e-01; -3.999861252727130e-01   +3.784152130133109e-01   +1.224721999024610e-02   -4.358838847023414e-02   +2.801897548902120e-02   -9.323910846350565e-02   +3.764093320316784e-01   -1.279201999835906e-01   -8.167100597908544e-02   -1.068899049413730e-01   +4.060650591037618e-02   +8.521792880537817e-02; +2.680092144684189e-01   +4.184104807675065e-02   -2.767698607871898e-01   +2.479145044637210e-01   +2.318243433376698e-01   +7.138154419587164e-02   -2.626368583405178e-01   +1.465670770669385e-01   -7.994426761009206e-02   +1.860733180159820e-01   -5.683311869121928e-02   +1.734536203145121e-01; +9.643409348720049e-02   +1.692881614418949e-01   +1.222251737047398e-01   +2.428023236936822e-01   +2.670575270679995e-01   +1.319964863649532e-01   +2.260799675413550e-01   +1.808333826460370e-02   -1.262474285586693e-01   +2.220545487117667e-01   +2.242405397493092e-01   -2.295256835639370e-01; +8.613850061994584e-02   +1.855439600494166e-01   -2.186993558649102e-01   -4.034743869154209e-01   +1.303358971236985e-01   +3.131373625184613e-01   +5.286041316109312e-02   +2.347825270871972e-01   +2.081263201786697e-01   +3.369949102634034e-02   +2.313741187595361e-01   -1.817305587480313e-01; -5.145345580582076e-01   +1.491578419697495e-01   +3.372767423551267e-01   -2.880082285261254e-02   -1.806574397444791e-01   -7.317406576617613e-02   -2.130478648478498e-01   +1.885257701784897e-01   -1.045404052357276e-01   +5.730657470191498e-02   -6.145350910258157e-02   -1.235639294416080e-01];
L3I_L2I_iGABA_netcon = [-1.535131077489186e-02   +1.555563369994691e-01   -5.218837716231078e-02   +2.946090101693107e-01   +3.785591877692309e-01   -4.704135812991583e-02   +1.358898653003372e-01   +3.125715497575843e-01   -7.256249596807926e-02   -2.743340361818876e-02   +3.011029165560580e-01   +7.468858936550618e-02; +4.993589697745877e-01   -2.118031782030586e-02   +4.014566692585092e-02   -1.029150628394832e-01   -3.934178289886322e-01   +1.911230011511524e-01   -4.985913452841068e-02   +2.590209998002270e-01   -4.795816365231211e-01   -6.083904897095767e-03   +5.023952235094219e-02   -6.837269393038103e-02; -1.973868683487471e-01   -3.597660493929637e-02   -5.540230153091793e-02   -3.242582826264665e-01   -1.111970869765310e-01   -2.017999896531327e-01   +1.498989069328990e-01   +2.129831596641845e-01   +5.864034264261721e-02   +2.845344454813626e-01   +2.310808901303152e-01   -3.519599460397070e-01; -1.479822404667012e-01   -3.285285567424489e-01   +1.442159730544179e-04   +1.344941387758671e-01   +1.006003997114515e-01   +1.430073063878997e-01   +8.861823642364189e-02   +1.785103278802138e-01   +3.849057836614517e-02   -1.439692795443100e-01   -2.712317644887854e-02   +1.500247662541710e-01; +1.110402956181464e-01   -9.494689255679059e-02   +1.888214204464369e-01   +6.675631979322223e-02   -2.505955872013505e-01   -8.577740755180205e-02   -1.111425386789474e-01   -1.358580227496801e-01   +1.333032395618651e-01   +1.542730093360177e-01   -1.556581887896175e-01   +3.483663424245012e-01; +2.261919958423658e-01   -1.323090001568462e-01   -1.502666567042660e-01   -6.647325138179519e-02   +7.504425921020930e-02   -1.466582962618081e-01   -8.981579926970830e-02   -2.430573352117879e-01   -6.996269414445838e-03   -3.832927857628216e-02   +7.221657233416451e-02   +6.728410122708475e-02; +3.232157232670373e-01   +8.351374399604472e-02   +2.793515599483968e-01   -3.826256239747291e-01   -3.553363010435999e-01   -1.191701393785723e-01   +1.422798061105658e-01   +2.688089600463744e-01   +2.857278693800452e-01   +1.617878036287695e-01   +8.807215201604388e-02   -3.117313006862948e-01; +2.732115163362797e-01   -2.351667528617496e-01   +1.228064709341192e-01   +6.101544910832504e-02   +2.397722833268303e-01   -3.506075640509224e-02   +3.344736672913388e-01   -2.217561739465644e-01   -3.029296354066985e-01   +3.785918741290244e-01   -7.607443500582775e-02   -1.074630322686556e-01];
L2E_L3E_iAMPA_netcon = [+9.403769780824134e-03   -2.510331107500463e-01   -1.839059872922916e-01   -2.071020620274509e-01   -2.205086431071229e-01   -2.449492312582885e-02   -2.131287215866707e-01   +1.191372364904177e-01; +1.248852693716185e-01   +4.282126992253026e-02   -1.886311485578407e-01   +5.406107270109738e-02   -5.038449424140194e-01   +3.372965472112316e-01   -1.593062514096520e-02   -5.515825788471072e-02; +2.968562445273409e-01   +2.511456710657930e-01   -9.209460591535897e-02   +3.140845869860371e-01   -1.674542816667575e-01   +3.578110892599431e-02   -1.154283232507528e-01   -8.404776980729622e-02; -6.216797588958096e-02   -2.098938375948591e-01   -1.875636024662432e-01   +3.089184241706235e-01   -4.205137710213517e-01   +6.826388989784055e-02   -1.543085820303702e-01   +2.364972904391315e-02; +2.995967542575977e-01   +1.264634499799291e-01   +2.371169009759871e-01   +3.490238036458718e-01   +1.553513553499144e-02   +4.936144170816364e-02   +6.465017993127131e-04   -1.235830865531987e-03; +4.764363763313850e-02   +1.404211131976495e-02   -2.426810718207000e-01   -3.634271448561129e-01   -1.530973326280073e-01   +2.608048427682451e-01   +3.306957647380954e-01   -2.587989552832750e-01; +3.581675194797894e-01   -2.461817022452372e-01   -1.336020884897510e-01   +4.151287485884643e-02   +1.641675259865901e-01   -3.283531886395603e-01   +3.466435917245792e-01   +1.862733911228556e-01; -2.604897270841066e-02   +3.140085555301527e-01   -3.349490700855899e-01   -2.199769590521508e-01   +1.554076194561633e-01   -4.261765581768533e-01   -2.625665496592391e-01   +3.905018648411893e-02; +9.842532591691341e-02   -2.049122362158408e-01   -5.683113751078622e-01   -5.642349537881662e-02   +4.011183132270413e-01   -2.514879324512583e-01   -1.119672723453248e-01   -2.116905637745455e-01; -1.549448464624708e-01   +1.433352924631117e-01   -2.158869579027474e-01   -2.144084036212267e-01   +7.313634146146017e-02   +1.405968997904370e-02   -2.316776661919329e-02   +7.655075447754130e-02; +5.287971209197279e-02   -8.981376407586637e-02   +1.851438547475386e-01   -2.077746620819051e-01   +2.945157079409520e-01   -4.370898752090992e-01   +1.491385599077847e-01   +3.711402228783299e-01; +1.288653515705049e-01   +1.869234751179545e-01   +8.278580413215433e-02   -1.511260051756118e-02   +1.173621464633940e-01   -2.614564135999151e-01   -2.886202425952445e-01   -1.011920266038565e-01];
L2I_L3I_iGABA_netcon = [-2.679177895131742e-01   +1.830895232198340e-01   +4.678328297003278e-01   +2.583962724594024e-01   -6.923762775938430e-02   +9.263596837513627e-03   -1.863585043332375e-02   -5.466363249593892e-02; -5.195337417781398e-01   +9.391015008209068e-02   -4.980149153973544e-02   +5.698874455569805e-01   -3.737012105038930e-01   +2.872035408416401e-01   -5.587609442659913e-02   -2.269735959203589e-01; -3.856045843172839e-03   +1.863732021562744e-01   +4.002517840085587e-02   +2.515867094766859e-01   +1.023375172307096e-01   +1.194661253470495e-02   +1.661346500829508e-01   -2.027015298253429e-02; +2.754378900354643e-01   +1.577907875717934e-01   +1.267971839256570e-01   +2.858308182926094e-01   -5.578396952205206e-02   +4.460624660269608e-01   +5.467181330779929e-01   +2.193658110145000e-01; -4.139684868446332e-01   +4.075765369866896e-03   -1.245849161910376e-02   +2.651033427033900e-01   +1.513893004602985e-01   -2.515225984576222e-01   +1.016043160501266e-01   +3.874214321895373e-01; +1.400959899336485e-01   +9.665335139131204e-03   +3.012425993526028e-01   +2.684863161135279e-01   -2.359038318450258e-01   -2.488143836225267e-01   -1.880383294156451e-01   -3.190289193569226e-02; -1.862446281172983e-02   +2.371444351494442e-01   -9.434828211886319e-02   +8.246862293125720e-02   -6.354819768828415e-02   +1.469219713857962e-01   -5.959757712244051e-03   -1.858602906941452e-01; +2.598696258507196e-01   +9.348655571871603e-02   +8.213490922498508e-02   -4.618824780984209e-01   +1.668399673376551e-01   -3.714109623042303e-02   -2.030908017607211e-01   +2.400886022816875e-01; +5.330380622629305e-04   +4.993128900885513e-02   +2.872790095404266e-01   -3.893403634453665e-01   -3.016479622300955e-01   +7.106136550881492e-03   -8.740302423453425e-02   +7.394614070086354e-02; +8.267934746633586e-02   +3.052164668535497e-01   +8.919274938710448e-02   -3.299872666409206e-01   +1.847573922595330e-01   +2.599355680729122e-01   -1.286875633020531e-01   +1.562209014590070e-01; -2.028445513864232e-01   +3.476594855254972e-01   +3.989208922608975e-01   +4.089224218628519e-01   -3.534828655414338e-02   +1.000283425399764e-01   -5.908171148736818e-02   +1.567804576003016e-01; -1.725539183507275e-01   -8.012676041256228e-02   +1.243770808895673e-01   +4.269095494252476e-01   -2.594743231673447e-01   +1.021631134365249e-02   -8.842962859613335e-03   +3.035839181744526e-01];
L3I_L3E_iAMPA_netcon = [-5.894600270893725e-02   -3.667433045028220e-01   +4.896147823212557e-03   +5.384424890333422e-01   +9.490204070661665e-02   +6.250719493917181e-02   -1.686968078565756e-01   +2.622274681745943e-01   -1.008562595360910e-01   -2.387039431684715e-01   -2.906240189842291e-02   -4.777519764651921e-01; +2.250176004316253e-01   +1.628861023669864e-01   -2.257498905454456e-01   -2.225160872746112e-01   -7.633272399846217e-02   +1.066330273947476e-01   -1.189804870507778e-02   +1.826149733940901e-01   +3.929627012736184e-01   -9.901245459104868e-02   -2.492383451209479e-01   +6.737709798529871e-02; +1.155210126140324e-01   +2.808435285886742e-01   +2.189163719364585e-01   +3.667501942008765e-01   +3.854779032649194e-01   +4.049834919198939e-01   +2.155216198848381e-02   -2.744228027092706e-02   +1.847938638052015e-02   +6.257618342280599e-02   -1.748787534038957e-01   -5.075783624050044e-01; +2.595129236708435e-01   -1.641952912695907e-01   -1.202045332974234e-01   +8.706651935166748e-02   +1.353206980402573e-01   -3.047837292224048e-03   +2.232814526016941e-02   +3.140245412618952e-01   +2.712124090464301e-01   -3.798850808541678e-01   -1.353561841005375e-01   -8.726459387169164e-02; +9.905438696599625e-02   -3.938930953820917e-01   +7.664374158559306e-02   +1.963269205517200e-01   +3.495797025179768e-01   -2.752336111608976e-01   +1.919594368110389e-01   +1.433162862957184e-01   +2.966607137961066e-02   -2.606875480321745e-01   -2.335765796251225e-01   -2.696235738200792e-01; -6.114423333031137e-02   +9.374418907234260e-02   -2.106794669524049e-01   +4.555283368515397e-01   +1.597059584389212e-01   -3.208856536839031e-01   -2.055490136244566e-02   -1.105093382860147e-01   +6.383325551240582e-02   +3.111804319116162e-01   -3.298447329215961e-01   -1.255327660109062e-01; +3.552844623403489e-01   -1.214652645727209e-01   +2.790713551178107e-02   +8.043740905338747e-03   -8.070309491194635e-02   +1.176374209744613e-01   +3.559932670911694e-01   +1.450599632122618e-01   +1.099818520565313e-01   +2.035448602584734e-01   -9.028260895992690e-02   -3.442698927708105e-01; +1.372729120193795e-01   -1.105656707719406e-01   +1.425941918598172e-01   -1.697030552369005e-01   +3.697815578467200e-01   -4.548874096643520e-01   -1.832069197915035e-01   +1.359258860241413e-01   +1.482308333647112e-01   +2.958034149164944e-01   -3.791470899548163e-03   +4.411969626200310e-02; +3.146002448292498e-01   -1.052688830657921e-01   +1.231213812199117e-01   +4.270609886422337e-01   -8.098518742458374e-02   +1.446064636832366e-01   -1.474076249667745e-01   -5.438624266674574e-02   -2.850262850207040e-01   -4.186866978098117e-01   -1.692269854445495e-01   +1.447637058109849e-01; +3.105507091124235e-01   -2.959513004028200e-02   -1.063985495702286e-01   -3.413248052722851e-01   -3.714501541195661e-01   +1.050613370294561e-01   +1.205325065437811e-01   +3.999138256479553e-01   +7.221378495206178e-02   +1.127599710537335e-01   +6.125704854372341e-02   +7.135482828756617e-03; +2.007364999698170e-02   -5.928761210890510e-02   -2.722363405071763e-01   +1.833938242295865e-01   +1.099301699766519e-01   +1.449070881905064e-02   -8.491924719869030e-02   -2.275687143762968e-01   -3.025015582879813e-01   -2.594793427064396e-01   +1.945435222652750e-01   -8.974104350426212e-02; -1.725319434883748e-01   -8.458209426969251e-02   -1.532173687009153e-01   +4.995150741221401e-01   -1.040826257348001e-01   -1.010240066005655e-01   -3.092765786050092e-01   +2.404944448288926e-01   +8.098338402778527e-02   -2.124316662120312e-01   +5.340574945673436e-02   +2.341132009127639e-03];
L3E_L3I_iGABA_netcon = [+2.673512430793451e-01   -1.948617135117192e-02   +1.353973579656853e-01   +1.336992976910136e-01   +2.886889573376935e-01   -3.764594816477097e-01   -1.498509656371462e-01   +3.825463322182180e-01   -2.221452002638420e-01   +3.977014870546317e-01   -2.813958946962661e-02   +1.194074797834125e-01; -1.439342130687499e-01   +8.803491959451026e-02   +3.388086878731675e-01   +8.189533773793481e-02   -1.228194744687931e-01   +1.603483099918954e-02   +2.102757288754351e-01   +5.562773488429928e-03   -1.699743475198559e-01   -2.720734357138160e-01   -2.205613078291332e-01   +1.395547103127262e-01; -2.507303502544277e-01   -1.894894752366680e-01   +1.803346806035337e-01   +4.149051462736682e-01   -5.731227819252446e-02   +9.390855127007065e-02   -1.312932365384838e-01   +4.220545265020598e-01   +4.551544643653318e-01   -8.329032994564291e-02   -4.190025076798054e-03   +6.893169367353519e-02; +2.497477858413625e-01   +7.399577988048092e-02   +1.485221881200614e-01   +4.714969096042915e-02   +5.910136555066439e-02   +3.896231828268075e-01   -4.112783613375505e-01   -5.384153008190725e-01   +1.781998466742287e-01   +3.261632023032853e-01   +3.821060552746229e-01   +2.431187124568879e-01; +1.641123552225112e-01   -1.285122627483933e-01   -5.447368367874347e-02   -6.406474783731472e-02   -2.973091883792277e-01   +6.069026358913879e-02   +3.958840384811132e-01   -3.359697532025951e-01   -2.501859974741217e-01   +5.732493073885695e-02   +2.818535783500472e-01   -1.393290522260238e-02; -2.398129858267908e-01   +2.758317517607551e-01   -6.325882181070178e-02   +1.273256182501110e-01   +2.472571869060141e-01   -2.926864294920962e-03   +1.486813461283152e-01   +2.561201360154949e-01   -4.567707013510827e-01   +1.557940313150749e-02   +1.654826434665875e-01   +5.031460295944689e-01; +2.070871789815207e-01   -3.565248219481794e-01   +3.943331455665240e-01   +1.834919044064257e-01   +3.364690051869482e-01   -1.867023077740189e-01   +2.830949799543325e-01   +5.673529280687650e-03   -1.155865534610731e-01   +1.995561099188010e-01   +4.216709481726024e-02   -1.681595384656225e-01; +2.272386946297671e-01   -1.461264983861010e-01   -2.076958492147035e-01   -2.750508155631066e-01   -4.912471278238649e-01   +3.688322897324773e-01   +2.106151636856021e-01   -4.065460573944475e-02   +1.574428497891963e-01   -9.199902754284037e-02   -2.098190428756298e-01   -2.324521287174611e-01; -4.591930697397809e-02   -1.012722068037914e-01   +1.024840444247044e-01   +4.566824120022847e-02   -5.570784738454154e-02   -2.134596922765370e-01   -6.934667461661911e-02   +3.614889467342033e-01   -1.514281583507017e-01   -2.285864944688877e-01   -2.465515968228444e-02   +4.378591739111297e-01; -1.713803363349884e-01   +2.249815488600573e-01   +4.397927978229748e-01   -9.286863036214105e-02   +2.379029914176989e-01   -3.697547129000331e-01   +2.511011492242085e-01   +1.917601182907998e-01   -1.887742230277211e-01   +1.059087038089499e-01   -5.199953132885753e-02   +3.367043393014170e-01; -4.069916683249785e-01   -1.428464795652108e-02   -2.546982413213657e-01   -1.701367590157794e-01   -5.031257766805411e-02   +1.296665985418711e-01   -2.963935651792042e-01   -1.374439010686101e-01   -4.054737355628886e-01   -1.735309335206462e-01   -2.891806624487517e-01   +3.999474378346388e-02; -2.793463074898946e-01   +5.626800989142290e-02   -2.070558344881961e-01   +2.390187238637545e-01   +2.167919376105251e-01   -1.277374751212566e-01   -1.530048305349692e-01   -2.509123202495462e-01   +4.503425703412040e-01   -3.485080920974795e-01   +5.645385240011866e-01   +3.097186543734881e-02];
L2E_Input1_iAMPA_netcon = [+1.461102458562830e-02   -2.025437161684009e-01   +2.035056434779930e-01   +1.857365274828522e-01   -2.186501710991212e-01   -2.853009362705317e-01   -2.474820778850611e-01   -3.371531320522220e-01];
L2I_Input2_iAMPA_netcon = [-2.131509277862995e-01   -3.528357035497052e-01   -2.127886009838054e-01   +1.004474920311974e-01   -4.018155642070614e-03   -1.539353033312699e-02   -3.167701414662338e-01   +2.732298976454559e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
