function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+6.470028028812137e-02   +1.003851393776201e-01   +4.715373138384499e-02   +8.095366703150064e-02   +1.203229481771493e-01   +4.914416484530572e-02   +6.010794212848442e-02   +8.287023922775175e-02   +6.133716279940589e-02   +7.507528465189012e-02   +6.268525490421969e-02   +1.532630277968372e-02   -7.170713262942156e-03   +1.058767250961682e-01   +2.622812208093794e-02   +4.137922105294798e-02; +1.394082726186344e-02   +1.070660557490133e-02   +8.491926318343945e-02   +5.556497557755725e-02   +2.909284772995872e-02   +1.077580218190711e-01   +1.378561053336259e-01   +3.437328457009717e-02   +6.854831928388622e-02   +7.056748239900416e-02   +1.773871167949282e-01   +1.598672596561278e-02   +4.487689803283776e-02   +6.592783780822002e-03   -3.209366570533200e-02   +2.122403073888094e-02; -3.202413040539841e-02   +4.781310262493842e-02   +9.622278238675491e-02   -1.429979310215310e-03   +1.306594885314775e-02   +1.341710775966884e-01   +7.107841913950205e-02   +4.734929581475267e-02   +1.731356070397970e-01   +2.313929138913887e-02   +1.360849294481477e-01   +9.471555221812382e-02   -2.410197291509339e-02   +1.508581433101567e-01   +1.031672975350851e-01   +4.064236206234103e-03; +1.431696266321363e-01   -6.185076495300585e-03   +1.123318562040122e-01   +7.091259546834731e-02   +1.099737586437683e-01   +4.113205328526544e-02   +2.609463660090897e-02   -6.879257877207776e-02   +4.059500404618255e-02   +1.030274080644200e-01   +3.389585074577363e-02   -1.960297927976540e-02   -7.087704659220163e-02   +2.949709998579043e-02   +1.155917494452602e-01   +1.531148502272350e-01; +7.012824530763916e-02   +9.761893334895058e-02   +1.489327772297022e-01   -3.207980554786952e-02   +8.483256440678602e-02   +1.659824797469360e-03   -1.600720701225855e-02   +1.137642618909132e-01   +1.368658459845313e-02   +8.758101305458027e-02   +1.381275459217272e-01   +3.945541696850674e-02   +2.229948794635259e-02   +6.652058323176338e-02   +1.353025789037536e-01   -5.738209570077563e-02; -5.613210989613475e-03   +3.249322747832733e-02   +7.909677622200703e-02   -5.921592731841755e-02   -4.270486064823503e-02   +6.881909780148796e-02   +1.509344470957692e-01   +5.728406968556410e-02   +1.189554383001806e-01   +1.919653010059831e-02   -2.971981150571683e-02   +3.477070963570494e-02   +1.478962913788071e-01   +3.922525354681330e-02   +1.216688598529692e-01   +6.147886067448730e-02; +3.407650850978564e-02   +3.816374323942585e-02   -1.150422360813348e-02   +9.146959434949734e-02   +2.976442966469379e-02   -5.337236202782231e-02   +1.098068426676134e-01   -2.751707146537265e-02   +1.573776234374254e-01   +1.196726560479613e-01   +1.847884314631278e-02   -1.022830953737864e-03   +1.261969543285086e-02   +1.366513639771265e-01   +1.284198596958929e-01   +5.590276909805326e-02; +4.706419849723898e-02   -5.197383674415965e-02   +6.827990094649286e-02   +5.713090303052067e-02   +1.171897053696323e-01   -7.219669575078565e-02   +3.067662035005034e-02   +4.218001045973418e-02   +3.864549519723694e-02   +8.957066383214236e-02   -4.852235918722370e-02   +2.464573381003304e-02   +8.724299030693355e-02   -1.247926491251877e-02   -1.225656129601432e-02   -3.979884213822286e-02; +6.617557823255807e-02   +1.390482044232673e-02   +1.212636701234465e-01   +9.346856931647335e-02   +1.171230516388257e-02   -5.038160271333500e-02   +4.601193040024180e-02   -1.468954021897389e-02   +1.262572798647689e-01   +9.158001839209312e-02   -4.844161226276638e-02   +3.481526278345587e-02   +1.785885799350513e-02   -8.015434974249425e-02   +1.323837865820593e-01   -1.297463126575665e-04; +9.164353277336727e-02   +8.994301582285791e-02   +9.100883482396693e-02   +6.097153662346586e-02   +3.946063384751326e-02   -2.451766505770214e-03   +3.969507583255463e-02   +4.194598098615453e-02   +6.348496490970973e-02   +8.572490810528634e-02   +9.412185756102380e-02   +7.712823219849155e-03   +5.921881291126209e-02   +4.266667109921924e-02   +4.678520288983722e-02   +1.625984290722557e-02; +6.035373076153171e-02   -2.575049358494116e-02   +1.328087563044978e-02   +3.243722113029432e-02   +9.811100220733714e-02   -2.439839337707417e-02   +4.269590010282804e-02   +1.686851557470232e-01   +3.657328001766118e-02   +4.339449110806722e-02   -5.136354622334638e-03   -1.133613292167493e-03   +1.063606598411309e-01   -2.906641682322957e-04   -1.064684679290485e-03   +5.443725848766966e-02; +2.120427956648177e-02   +1.516456912534685e-01   -1.930546154528329e-02   +4.967276762984289e-02   -5.525039894188816e-02   +6.988192184289821e-02   +2.650576065461487e-02   +5.114037025805354e-02   +7.828628249954842e-02   -5.614770069476353e-03   -4.475896726289774e-02   +4.029079795354819e-02   -8.688672736491283e-03   +1.865841209115751e-01   +2.975467586351506e-02   +7.922866343840859e-02; +3.770929568005170e-02   +1.183714903725799e-01   +5.721742488191568e-02   +9.285102259541965e-02   +4.666236361433668e-02   +2.139140079118455e-02   +2.774451153372709e-03   -3.958348336607643e-02   +2.160991849738108e-02   -7.737574195949790e-03   +6.430324004162527e-02   -3.157270104435905e-02   +1.237135626731900e-01   -2.513240715425144e-02   +1.247029451029120e-01   -3.909232693842646e-02; +3.559264027022131e-02   +8.141341131044424e-02   +5.322766491677267e-02   +6.473196329269953e-02   +1.391983415823397e-01   -2.575635697676057e-02   +1.345344500313216e-04   +9.582427095008292e-02   +5.449571707398698e-02   +1.219590924990574e-01   +9.107972098556161e-02   -2.914018091855027e-02   +7.633116909815487e-03   -8.270085433158476e-03   +4.984999290012816e-02   +7.258294380976735e-02; +3.989218640229109e-02   +2.399233444635676e-03   +2.256264925239114e-02   +2.622129791698223e-02   +6.744195323133655e-02   +2.220938761699682e-02   -1.550436823425724e-02   +1.525081476312383e-01   +8.715526370451997e-02   +9.842320506091204e-02   -3.912858614652837e-02   -8.133620945760001e-02   -3.491677864758708e-02   +5.729417959827816e-02   +1.021175994051564e-01   -5.871333456160841e-03; +7.467429141556740e-02   +1.409161167105463e-01   -3.412526448644942e-02   +8.418650835713461e-02   +1.311952288476957e-01   +8.710296279853709e-02   +3.420716064876322e-02   -8.420365588300766e-02   +7.439031461043537e-02   +1.215725781248826e-01   -1.006262328613816e-02   -1.731451928036251e-02   +8.721022706399262e-02   +1.096396370640664e-01   +8.096103456459333e-02   +6.067495693881697e-02];
L1E_L1I_iGABA_netcon = [-9.964532090052845e-02   +4.555772848728344e-03   -2.386495901742855e-02   +7.079132872370808e-02   +9.570774912711461e-02   +9.643503860921121e-02   +2.023292800709388e-02   +1.283465635156314e-02   +4.991675666333516e-02   +2.896179710818202e-02   -1.604391995862586e-02   +5.296186456567919e-02   -6.962082685597028e-02   -6.630182027100054e-02   -3.370383803189587e-02   +6.953502877749825e-02; +6.190233473329117e-02   +4.205956896152091e-02   +9.636151366280089e-02   +5.397130439472107e-02   +1.461708010614573e-02   -8.723473768611847e-02   -4.267102273976175e-02   +8.811359921593402e-02   -2.178733319388713e-02   +1.240918881711150e-01   +3.741526255309592e-02   +6.939181598159655e-02   -9.584779268046247e-03   +1.955163788182079e-02   +2.532612753592159e-02   +7.396513787222925e-02; +5.570859512641078e-02   +6.630301186299065e-03   +1.441044984974620e-01   +3.791302697761349e-02   +1.669914717456724e-01   +9.866578791659099e-02   +7.416898491450281e-02   -2.628656214484175e-02   +2.852136312587100e-02   +1.735688351798532e-01   +8.264579627714895e-02   +1.578274867382455e-01   -6.298306656699563e-03   +1.528668817518038e-01   +4.815482892255826e-02   -4.107672383343466e-02; +3.867140658980335e-02   -5.794318202982741e-02   -1.912452483876096e-02   -5.975157456554417e-02   +5.280547486381968e-03   +5.628217189751095e-02   +4.032625242423105e-02   +5.198615303208376e-02   -9.482042102414528e-02   +8.105499294766408e-03   +9.285324997048996e-02   +1.978033809449588e-02   +4.031344274356387e-02   -4.822221562273211e-02   +1.294100777053524e-01   +1.052473631529535e-01; +6.929795892382344e-02   +1.349564972896029e-02   +5.163003949900795e-02   +8.936015542577411e-02   +5.064267904241873e-02   +9.758479746630805e-02   -6.431544660025397e-02   -4.676636817245435e-02   +1.460755837437770e-01   -8.411207733817518e-03   +1.500604270479065e-02   +2.828447791205836e-02   +4.828926859915297e-02   +7.741733109655631e-02   +6.608178535196488e-02   +6.466430508458615e-02; +8.541382087600406e-03   +3.389064660916024e-03   +7.811381691685393e-02   -9.535856661050399e-02   +5.948959139133871e-02   +8.731361886075822e-02   +1.032184062305432e-01   -2.632949557860469e-03   +1.253086520290308e-01   +1.087540698960032e-01   -6.111099637906894e-02   +4.767228530607120e-02   -1.025246155044452e-01   +1.274540868350823e-01   +1.871749639879173e-01   -2.559235479745928e-02; +2.152178359881060e-02   +2.033993283410661e-01   +1.343876213728489e-01   +1.608735257808146e-01   +1.048913236500710e-01   +9.984812241665357e-02   +8.045543020039368e-02   +2.384834216599008e-02   +9.479387839373919e-02   -8.121529179046391e-03   +6.358387927594131e-02   +5.719574993873031e-02   +1.829809179416622e-02   +3.754785829658894e-05   +9.466417537527303e-03   +1.149203536152522e-01; +1.065199626344914e-01   +5.650758189832441e-02   +7.379715298609354e-02   +1.302550597212862e-01   +5.757071073587761e-02   +2.358504553811952e-02   +2.712452856194535e-02   +6.791998453192530e-02   +6.783427223167623e-02   -5.262871831880159e-03   +7.894829669046374e-02   +9.672582145872480e-02   -6.241894425539033e-02   +1.371774386926517e-01   -2.000976809773273e-02   +5.961673901056001e-02; +9.293922857144341e-03   +1.811923270278659e-01   +1.090415311639861e-01   +1.173617381788647e-01   +6.582535124413474e-02   +4.824224194886461e-02   -3.183485309421785e-02   +9.510162793608574e-02   +5.538756075421837e-02   +2.166276801095186e-02   +3.740393677654645e-02   +1.046459796670775e-01   +9.622164103119348e-02   +6.292107519359219e-02   -1.355668086946802e-02   +1.077478086208969e-01; +4.411894688842559e-02   +4.263763507962580e-02   -4.734852140142048e-03   +1.072091344087534e-01   +7.981681186288839e-02   +8.315003324532336e-02   +1.620820501020317e-02   -2.145107708587928e-02   -9.949951341578311e-02   +4.750351565522613e-03   -1.138018724325206e-02   +9.997728994182403e-02   +4.768603055970414e-02   +2.459976058343167e-02   +3.241826875934806e-02   +4.525070209738231e-02; +3.519626963819544e-02   +1.865826272105119e-01   +3.452864761778291e-02   +1.689845303446387e-02   +9.561213642574398e-02   +8.250126490792176e-02   -7.545060596115455e-03   -1.558552998590660e-02   +1.222125260334274e-01   +7.413762901330150e-02   +4.164958803173185e-02   +1.397261179851871e-01   +1.388783520873905e-01   +5.956385688649041e-02   +2.579467920057621e-02   +1.945812010042066e-02; -9.923421538854831e-03   +1.529592955261858e-02   +4.732201003064704e-02   +8.154367109606307e-02   +7.177691079908025e-02   +1.060716906752320e-01   +5.320403171187629e-02   -1.270990460447762e-02   +1.205579044331940e-01   -5.222702329366664e-02   +1.406236508772587e-01   +8.640278363531903e-02   +1.083306366376783e-01   -1.013999461922109e-02   -2.312333164959158e-02   +1.350258599332345e-01; +4.476622200049714e-03   -1.680859237960759e-02   +2.514859210240146e-02   +8.040178660497384e-02   +9.681160020919358e-03   +9.162002870473718e-02   +8.335384288242226e-02   +1.157267226627833e-01   -6.476551116599848e-03   +1.053904195610454e-01   +9.384676858525576e-02   +1.413451780941920e-02   -1.148961759211511e-02   +5.884507486547930e-02   -8.404781186922429e-02   +3.775842816884623e-02; +5.587373261203755e-02   -1.063170424726040e-02   +5.945105849000008e-02   +8.370096490152777e-02   +9.114730569209281e-02   +2.680981051948600e-02   +7.078396135780757e-02   -4.217834095722135e-02   +4.618384376449265e-02   +7.747244064445410e-02   +2.677141153607464e-02   +1.442235411897376e-01   -7.398133752106524e-03   +8.545905370730858e-02   +2.773172101976563e-03   -4.031477801019943e-03; +1.436093487668420e-02   +9.859982754004490e-02   +4.377295297074237e-03   +5.520541929179791e-02   +9.133657173796575e-02   +6.290159612929218e-03   -1.643467332270336e-02   -1.556268792274827e-02   +8.549821165179322e-02   +2.835225318911710e-02   +6.252201827819048e-02   +4.012593586735764e-02   +7.611127822959614e-02   +6.161645844166993e-02   -2.306661487018477e-02   +5.272246471498822e-02; +1.365495252184647e-01   +1.164444377726876e-01   +4.686992802909808e-02   -2.807809462887255e-02   -2.444840966903012e-02   +3.494937414560154e-02   -5.999449792531336e-03   -1.683554582162329e-02   +2.243646398851224e-02   +1.386371026818415e-01   -5.768056778176051e-02   +6.302555734390408e-02   +4.051968629694033e-02   +6.599816908441222e-02   +6.129449309851679e-02   -3.608194907959061e-03];
L2I_L1I_iGABA_netcon = [+1.210332133968370e-01   -4.010975490789728e-04   +1.669633005967443e-02   +1.065798781795106e-01   +8.708374508044223e-03   +1.180870968937658e-01   -3.322674297749356e-02   +8.557591868085393e-02; -2.801538033122216e-02   +1.953010388043559e-02   +1.593914286595105e-02   +2.059680436540218e-03   +9.852885924448261e-02   +1.875328328927157e-02   +3.996559670743040e-02   +1.025533203239707e-01; -7.246502003602349e-02   +2.181967307618884e-02   +6.217069177272491e-03   -4.960732995966670e-02   +1.468287175022190e-01   +1.355988534535041e-01   +1.239668943292291e-01   +7.737444277714863e-03; -6.534248976207001e-03   +1.209155793213659e-01   +4.872559803015650e-02   +8.862726784248795e-02   -8.553782367934271e-02   +3.488924687453779e-02   +9.486702253228312e-02   -5.327546481389069e-02; -8.201727012224522e-02   +2.203985332438618e-02   +1.668010400914424e-02   -3.476408265632776e-02   +8.060960427891617e-02   +8.575999643045581e-02   +6.561520789367095e-02   +2.457477540520290e-02; +4.265897739165365e-02   +8.897911095221896e-02   +1.190031245791408e-01   +6.879431260511513e-03   +8.426131241293884e-02   -1.777374134637168e-02   +3.540167468756355e-02   +2.449488721742784e-02; +5.834351584988869e-02   -1.297330592111375e-02   +7.179912568913385e-03   -1.044766909064959e-01   +9.082138965786826e-03   +1.718156605238850e-01   -4.549809583553817e-02   +4.665833128743185e-02; +6.792847599185502e-02   +4.942824974821403e-02   +1.296318695240529e-01   +9.378856229208901e-02   +3.706560765142775e-02   -5.157302934717389e-02   +7.607628183041826e-02   +6.580788741695952e-02; +2.292586523387778e-02   -1.015986356981287e-02   +3.675700877983243e-02   +3.735768019214723e-02   +5.378023426948167e-02   +1.066995680193797e-01   +6.867915433653048e-02   +2.791514375085728e-04; -1.037766780366005e-01   +1.704382147088621e-01   +7.943645242249581e-02   -6.567433220947992e-02   +2.653538636143847e-02   +6.334886337480347e-03   +1.063149991555946e-01   +1.166464304778844e-01; -9.887615942490557e-02   +1.215040451899833e-01   +2.923336641486615e-02   -3.431299809865403e-03   +6.757643505916452e-02   -1.651559152208817e-02   +1.271456661408805e-02   +1.431640356018734e-01; +1.239286935670486e-01   +3.538241837435989e-02   +1.018949519170549e-01   +2.393365927023181e-02   +6.465756343007548e-02   -2.403849068231284e-02   +5.716390288741647e-02   +3.719112194649847e-02; +8.520307738355096e-02   +1.043484816901041e-01   +3.747520629361447e-02   -1.431575367219639e-02   +1.266551352760573e-01   -1.574275801442722e-02   +2.834862578066104e-02   -6.272940745589803e-03; +3.871844809313240e-02   +4.761834358022952e-02   +3.319648543228761e-02   +1.035308561460114e-01   -7.855621507201639e-02   -1.053889349644071e-02   +1.396935823742734e-01   +4.514991216558537e-02; +9.584414128865130e-02   +1.746502404047438e-02   +1.284340123302677e-01   +8.916646712603638e-02   +1.520350410229638e-01   -4.073777723774472e-04   -5.099187024763894e-02   -1.097970053832196e-02; -5.089984535033207e-02   +1.866275188576172e-01   +1.409172429677901e-01   +4.149136869103462e-02   +7.817438707561634e-02   +3.194334292120878e-02   +8.969331979237397e-02   +2.014939814633070e-05];
L1I_L2I_iGABA_netcon = [+4.672727341783434e-02   +6.563491991790299e-02   +5.192180351975462e-02   -6.524813970208118e-02   +1.193601784201694e-01   -3.278856497060839e-02   +1.371895699727258e-02   +2.689684554286390e-02   +7.155874958759842e-02   -7.460265420753101e-02   +2.254794574911980e-02   -8.386622087033484e-03   +2.390111817013194e-02   +9.739792637644511e-02   +9.067470771684967e-02   +1.156946624892982e-01; +1.213831572582420e-02   +2.078900603006463e-02   -3.683383791223019e-02   -6.160598161785681e-02   +5.241050931543594e-02   -4.844745382750414e-02   +6.570728450189608e-02   +2.870489201719763e-02   -1.972795450063301e-02   -3.679682861590611e-02   +5.152196341529384e-02   -3.518045654080840e-02   +1.067116557294972e-01   +1.076563673885931e-01   -6.917357420827726e-02   -5.259494648989477e-03; +6.480389967904585e-02   +5.726934009738276e-02   -9.961642569024451e-02   +1.673885825501217e-01   +3.050470834410401e-02   +2.563739810932324e-03   +1.655131593163920e-01   +8.802462508636316e-02   +7.653379799367717e-02   -6.915198464506502e-03   +5.049609536394380e-02   +6.388067869585491e-03   +4.940167673207699e-02   +4.076866758224836e-02   -3.698443260759595e-03   +3.826108992870185e-02; -2.961303766822999e-02   +6.688623567210317e-02   +5.819292685457440e-02   +4.544255303234379e-02   -3.605114019193767e-02   +7.719299638908769e-02   +3.388407679422809e-04   +5.848551862908069e-02   +7.739174028263589e-02   +5.759343882861400e-02   +1.307187688157350e-01   -5.516098233704338e-02   +5.081105629444476e-02   +6.169973757298347e-02   +8.629780302167239e-02   +1.859079045877495e-02; -1.184565688874626e-02   +5.048129316559328e-02   +3.182416433362930e-02   -1.142670465303621e-04   +8.771876095327452e-02   +5.218552530522246e-02   -4.661323846946526e-02   -1.715539583227767e-02   +3.262644480470949e-02   +1.234730709261151e-01   +4.593741249149451e-02   -8.448394133845016e-02   +1.911148034185137e-01   -5.150448687726940e-02   +7.074652591475501e-02   -6.999492901478167e-02; +8.237310731730042e-02   +1.002053671427833e-02   -7.562846172368685e-02   +9.753815517691078e-02   +4.813727598345457e-03   +1.001443160501155e-02   -4.614497226703702e-02   +9.555955232260817e-02   +8.726223299608016e-02   +4.570905755607516e-02   +1.065390737480899e-02   +1.535162936448059e-01   +2.455521101864728e-02   +4.642178220244428e-02   +8.837454493382635e-02   +1.367149505729556e-01; +4.452923645838132e-02   +8.559932698709061e-02   +1.194890095115095e-01   +7.430504985100103e-02   +1.084069693720378e-01   +1.006671248058032e-01   +4.463338155708041e-03   -2.973466891355336e-02   +8.925237260013084e-02   +7.637557821675608e-02   +2.903504252827896e-02   +3.401427414252267e-02   -7.895174430960893e-02   +6.446725879890122e-02   +1.176500704446760e-01   +6.892061453529776e-02; +7.968790726173104e-02   +5.188655590526228e-02   +3.191784892767482e-02   -1.202796954010416e-01   +9.752086006543070e-02   +1.842811867849002e-02   -2.457045651423448e-03   +5.318910676170852e-02   -5.459744900664505e-02   +5.316801180257449e-02   +4.968819791122253e-02   -4.525160023031397e-02   +5.649774577460880e-02   +3.708963847791450e-02   -3.488916079183633e-02   -1.991204176753004e-03];
L2E_L1E_iAMPA_netcon = [-4.953234377165358e-02   +3.174005699026938e-02   +1.309562647510694e-01   +6.138587609252896e-02   +8.987548676500032e-02   +9.048404891537488e-02   +8.023115808396154e-02   +1.455115066880086e-01; +9.633116681627844e-02   +1.474928823398538e-02   +2.539085334972761e-02   +2.933796572934667e-02   +8.153330329043958e-02   -3.650213726392497e-02   +3.391862572005672e-02   -8.869521136207630e-02; +3.051353022151582e-02   +4.706781977765617e-02   +3.573425066433285e-02   +6.144965552755453e-02   +1.116815463680851e-01   +8.808963304264550e-02   -4.191001807995183e-02   +2.993629536945212e-02; -7.652157588696518e-02   -3.611533403531018e-02   -1.097400292825448e-02   -9.243832876839341e-03   -7.542285008047998e-02   -8.798720506664595e-03   -2.636866021116235e-05   +1.126414860287299e-01; -6.628870179040673e-03   +4.893361748816569e-02   -3.972295729399165e-02   +8.233446620000288e-02   +2.290302472121284e-02   +7.052582269168634e-02   +9.609115842840749e-02   -3.201601952531419e-02; +7.552935810590447e-02   +6.508831523265129e-02   +4.631947762471442e-02   +3.539766372299093e-02   +1.787139468009167e-01   +6.483010021358296e-02   +3.385806019027973e-02   +6.846102210712766e-03; +6.542937297814681e-02   +8.368914318476192e-02   -4.453969179001326e-02   +6.627051106232125e-02   +9.376991614233368e-02   +1.144272807287338e-01   +1.345317582454334e-02   +2.981604558980652e-03; +9.454092351249922e-02   +2.269620296955817e-02   +3.176683851359104e-02   +8.665893175986958e-02   +8.934524404346057e-02   -2.039701457490485e-02   -6.415781646298518e-02   +1.123724009107605e-01; +2.586840167985022e-02   +3.662768865480763e-02   -2.195560671034340e-02   +2.132342314363683e-01   +1.473323243696742e-01   +4.126444052192609e-02   +1.562217933126828e-02   +1.539409224711872e-02; -1.177342048725349e-02   +4.237509035836257e-02   +3.643316397036558e-02   +1.299530492019573e-02   -5.846405229491682e-03   -5.572995208231316e-02   -2.837310758093294e-02   +1.300145121819915e-01; +6.724180354419204e-02   -4.953724337803777e-02   +3.070954206735426e-02   -4.623040008325321e-04   +9.164856022724500e-02   -1.089968519371833e-01   -2.044353963604955e-02   +7.500536642327346e-02; -1.788593599249355e-03   -3.715111736908951e-02   +3.106879651368528e-02   +1.135798804755622e-01   -2.084503770219841e-03   +2.844332061985212e-02   +7.434048136558745e-02   +7.416925795979820e-02; -2.210280346264826e-02   -3.379228129399385e-03   +1.178935955954086e-01   +1.027874559492603e-01   +8.481227317087342e-02   +4.135904191621680e-02   -1.508251617882812e-02   +7.291451520778131e-02; +1.053106557910831e-01   -3.473130167781661e-03   +1.124171789626901e-01   +3.106911632239433e-02   +5.739964944413785e-02   +5.617046610823892e-02   -2.954349971921361e-03   -1.184357640621392e-02; +2.633476211215481e-02   +6.063357485929689e-02   +9.652668102186007e-02   +1.175933841888778e-01   -1.903074915286485e-02   +4.989474453992352e-02   +1.252252519104645e-01   +7.449886382526630e-02; +1.723054449380726e-01   +2.034296180804396e-01   +5.675015663832263e-02   +1.089620769364868e-02   +8.723993677548632e-02   +7.477349625445007e-02   -6.638298307232393e-03   +2.453739335047920e-02];
L1E_L2E_iAMPA_netcon = [+5.418631172711576e-02   +1.099264490290548e-02   -3.195313696024021e-04   -1.855907269861552e-02   +4.765895582042799e-02   +4.365669748844164e-02   -3.921447399550992e-02   +1.315522835424881e-01   +1.695420444820138e-01   +1.961049303920365e-02   +1.614036036948656e-01   -1.934772832477234e-03   +1.332839688220334e-02   +2.055547690051424e-02   +1.468145795571315e-02   -2.397283873704755e-02; +7.864036731480764e-02   +9.394283715153698e-02   +4.565403489078878e-02   +2.279530086644405e-03   -8.637304850734132e-02   -1.134179635849858e-03   +2.955990837975466e-02   -3.400826266650163e-02   +1.957056241731095e-02   +2.918832601147799e-02   -1.043266100040771e-01   +6.982660731732506e-03   -4.453100154640648e-02   +4.034447320147393e-02   -8.441563630762795e-03   -2.452303975920340e-02; +1.380749510892139e-01   +1.055074739716570e-01   +1.448339891171549e-01   -4.787234620552570e-02   +1.789250827451960e-02   -3.131953125336104e-02   -1.617257904770952e-02   +8.748882657004463e-02   -3.006599519907907e-03   -1.101435388301460e-02   +5.545866513131731e-02   +4.819308909723338e-02   -5.042894058534104e-02   +2.890559302976698e-02   +4.686599130876037e-02   +1.988372078863183e-01; -5.258901721211472e-02   +6.799330792639330e-02   +2.820407790597988e-02   +3.410054026747013e-02   +1.317173195119999e-01   +5.996920533670482e-02   +1.231186502429588e-01   +3.931812863195184e-02   +8.151002821833876e-02   +1.001976001497078e-02   +1.569707599766252e-01   +1.716320090453867e-03   +3.865449188483866e-02   +6.405994256312023e-02   +6.742766264414032e-02   -1.198782931986182e-02; -6.250180273292247e-02   -3.261282807668937e-02   +8.418769395531547e-02   +6.411161637349441e-02   +1.246325651479058e-02   +8.465120062602342e-02   +2.281684905412618e-02   +6.454099065618445e-02   +8.266218284627226e-02   +4.851668720634621e-02   +2.849705617868895e-02   +1.021195060960344e-01   +2.068579973168368e-02   +1.997717382771915e-01   -5.999136345275842e-02   +9.546877472742836e-02; +3.304672444394675e-02   +5.944692678919214e-02   +9.481297172673174e-03   +7.596295618877014e-02   +4.400935973651926e-02   -3.338222312233203e-03   +6.250466400025273e-02   -6.727512934752457e-02   +3.276265304092570e-02   +3.337817262479392e-02   +8.322829668279880e-02   +8.127294514635727e-03   +3.358542615554433e-03   +9.793878039973235e-02   -4.889680968189134e-03   +3.679446104397362e-03; +1.278924267980904e-01   +1.240162798050093e-01   +1.980834995314160e-02   -1.397048856021652e-02   +1.272370482366475e-01   +8.625853548250675e-02   +6.438292283533631e-02   +2.512699811285857e-02   -1.735006809195878e-02   +6.805927044898136e-02   -4.365422517926167e-02   +4.248351437091812e-03   +3.868151276571863e-02   +7.100664785636171e-02   +8.430718270423788e-02   +6.018934498941326e-02; +5.074306166262386e-02   -6.906255869197955e-02   +3.861398210226868e-02   +9.622824437530217e-02   +3.301029849786576e-02   -9.429976811757354e-02   -2.175025620769278e-02   +9.014510198757422e-02   +6.013097201147427e-02   +8.454214098094172e-02   -2.883368263630487e-02   +3.366282673591518e-02   -2.816595254479238e-02   +1.509699132178551e-01   -8.084379843890568e-02   +9.722942215785573e-03];
L2I_L2E_iAMPA_netcon = [-7.092484792014318e-03   +1.063096025504961e-01   +1.888967039653911e-02   +2.851996604225108e-02   +1.861490559522187e-02   -1.235303460616508e-02   -9.694741363586337e-02   -4.966094878893025e-02; -2.869955765471563e-02   +8.646741295499544e-02   +1.285924869638053e-02   +1.606191514515894e-01   +5.620790886734799e-02   -2.845375876620296e-02   +2.990212718226194e-02   +5.248371265779428e-02; +8.014536575624551e-02   -4.808581121831470e-02   +7.211429768542180e-02   +8.005054369309155e-03   -1.673725542904406e-03   +4.043604525262495e-02   -2.129849957317091e-02   +1.177232379401234e-01; +7.021738001470493e-02   -4.954701684021347e-02   +7.315717579539706e-02   -4.867944091935009e-02   -1.567622315166204e-02   +4.984438386513806e-02   +3.233872059883057e-02   +9.023176928892472e-02; +1.567090038404679e-01   +3.510748385400120e-02   -1.744963215578828e-02   +9.313034679818047e-02   +6.303404878025003e-02   +1.498073018442543e-01   +6.551035815666004e-03   +5.857051383600111e-02; +7.777235306595022e-02   +3.735334784373768e-02   -8.195332524162258e-03   +7.364113754593465e-02   -3.967108540599347e-02   -4.142943428671046e-02   -3.325490560423643e-02   +6.585475269719301e-02; -7.070509092253246e-03   +6.101736828813084e-02   +9.109109736728599e-03   -1.730923859783638e-02   +1.424970148593301e-01   +1.309335052303462e-03   +7.893680248046635e-02   +1.464840755772360e-01; -2.403105101030132e-02   +4.023689295902795e-02   -8.904228160510581e-02   +1.644780648405712e-02   +1.332900236024711e-01   +6.219375550509978e-02   +8.081443573018675e-02   +5.996663733785819e-02];
L2E_L2I_iGABA_netcon = [+8.010525941060959e-02   -7.792135948093099e-03   +3.576252167085780e-02   +1.861656239317860e-01   +1.861334890170473e-02   +2.168395507981817e-02   +7.227118325013621e-02   +1.377577110398998e-02; -1.255520273524507e-03   +3.811729831428938e-02   +1.182866484937976e-01   +1.024537348341389e-03   +6.202055336161419e-02   +1.060024482774254e-02   +5.513344130176911e-02   +7.641886698472160e-02; +3.801855609295629e-02   -1.302796056244491e-02   -2.010300749907754e-03   -1.243968391067357e-02   +6.722429379220546e-03   +9.644423319475984e-02   +5.019797064144907e-02   -3.867330545910285e-02; +5.200412554872476e-02   +6.175820583569128e-02   -6.656829325101224e-02   -3.328278414975534e-02   +4.380654461146445e-03   +9.642579888839721e-02   +1.359645811131254e-01   -4.951866291846388e-02; +7.596175380075386e-02   +3.798433326940035e-03   +8.507531767496594e-02   -5.814238062389688e-02   -2.176475718352033e-02   +2.815542797284870e-02   +5.003672391623301e-02   +6.758388728230422e-02; +3.960068988004101e-02   +5.638839749772875e-03   +8.705655696838682e-03   +5.471539508196581e-02   +8.220983692831146e-02   -2.372236663478628e-02   +6.381830185666076e-02   +1.129609269896148e-01; +2.700748108507291e-02   +3.156084911931337e-02   +6.703827026630393e-02   +1.028785844482792e-02   +1.456879495083333e-01   -1.996440177446563e-02   -6.487071475058191e-02   -4.842505598143483e-03; +1.225754814223249e-02   +6.017474518896325e-02   +1.279082366890542e-01   +5.272698051502404e-02   +5.686835079088391e-02   +5.377822047354424e-02   +1.104076254019408e-01   +7.292535607969212e-02];
L3E_L2E_iAMPA_netcon = [+4.235366389466009e-02   -4.775728745693842e-02   +1.005906807524230e-01   -3.866991391658973e-03   +1.363138646783489e-01   +1.137624291522586e-01   +1.038672602082388e-02   +8.689890226148439e-02   +9.686215490041540e-04   +1.058315203364341e-01   +1.681749701960149e-01   +1.466173376975540e-01; +5.189265026356965e-02   +3.448388994155534e-02   -8.618897612153304e-03   +1.235822388994410e-01   -6.994169735655871e-03   -2.681005652042155e-02   +1.208295118203252e-01   +3.492634171640987e-02   -3.073453724080778e-02   +7.901592342737861e-02   +5.469567533894755e-03   +1.676008926453322e-02; +1.037994458776887e-01   +3.383311776417766e-02   +6.201654757434782e-02   +1.455186307581477e-01   +8.905370799110583e-02   -1.938404942984509e-03   +1.095011706122042e-01   +5.623747590507969e-02   +6.985436817372259e-02   +6.451972210176626e-02   +8.172597337430479e-02   +7.104834289180106e-03; -2.252734598147103e-02   -2.239338256737312e-02   -7.754106460300732e-02   +5.182751647578078e-02   +4.406189399363341e-02   -4.662273259875068e-02   +6.723189420999906e-03   +5.931713961637196e-02   +3.810362938425382e-02   -3.152681962809694e-02   -4.549599810562277e-02   +1.164720661503580e-01; +1.202286110374865e-01   +3.028406997558724e-03   +5.698255024646341e-02   +2.615195454288978e-02   -2.666164455713638e-02   -5.247638814629565e-02   +9.792949349526434e-02   -5.962064285985169e-02   -1.608472015066322e-02   +1.804847247153473e-02   +8.933529518427416e-02   +6.501300603343120e-02; -5.184746399169406e-02   +3.814573944887489e-02   +5.733064012498259e-02   +1.131195920214857e-02   -6.753283210356034e-02   +6.326995236500355e-02   +6.340560520517707e-03   +6.020053560931929e-02   +4.916839026464516e-02   -5.249672096766434e-02   +9.462591196331652e-03   +1.166907301996239e-01; +1.519864373219199e-01   +5.058693724599019e-02   +7.372187469488081e-02   +1.623206942869012e-01   -4.532189440613608e-02   +1.542890856038764e-02   +1.768401445735858e-01   -5.680794511066616e-02   -3.312014586782246e-03   +8.601274156391242e-02   +6.636409564913144e-02   +8.617645194072660e-04; +1.088782293520274e-01   +1.065884880667122e-01   +1.452063463838612e-01   +5.225038395124697e-02   +3.479651875108390e-02   +2.641507715397478e-02   +1.632639388982146e-01   -1.440148072763596e-02   -1.573787134657579e-02   +3.525837665526570e-02   +2.049717640373696e-02   +4.755044652068517e-03];
L3I_L2I_iGABA_netcon = [-2.237507969958574e-02   +5.106629765019755e-02   +3.550139511220542e-02   +2.322238748477726e-02   +7.219317937840870e-02   +8.027693865349170e-02   +1.376905858961059e-01   +1.115344992879788e-01   +3.185372527240637e-02   +4.531610009153374e-02   +1.191124084740841e-01   +8.146547510770023e-02; +3.441765437043423e-02   +1.402795578325874e-01   +1.426224738947370e-01   +1.260852569652021e-01   -1.909978745880742e-02   +1.323565757639013e-01   +1.092878480681278e-01   +1.377813235171933e-01   +4.059895778524206e-02   +1.271390771122385e-01   +7.976312944806055e-02   +8.345244311929489e-02; +4.513721962503005e-02   +6.312106638146557e-02   +1.211915490388139e-01   +4.438990171452332e-02   +1.054978323239851e-01   -3.200074835978602e-02   +3.617725560388685e-02   -1.010291786295768e-01   +1.400597620846768e-01   -6.089352720287000e-02   +6.588121834338970e-02   +7.578219493303374e-02; +2.901470888075761e-02   +1.074859897548117e-02   +9.407700243790477e-02   +1.449141186990291e-02   +1.524742023055486e-01   -4.757547130002168e-02   -1.046586832510557e-01   -1.196514215251826e-02   +1.019162026890766e-01   +1.684005238331149e-01   +8.423799478742404e-02   +4.250102104369051e-02; +7.620356515487416e-02   +2.002565757505386e-02   +9.238121370558854e-02   -7.833722844357242e-02   +1.140147647398755e-02   +2.492044704482874e-02   -3.551898600341823e-02   +4.679108528238873e-02   -4.799427674403618e-02   +5.363088239419404e-02   +8.279413834640431e-02   -5.149581195618008e-02; -9.326379056903665e-04   +5.822365961889320e-02   +5.376006172294977e-02   -2.596825042569543e-02   +2.872155655448243e-02   -2.046419992204969e-02   +1.697107471186965e-01   +3.217180675834865e-02   +2.785292703376194e-02   -7.114904067041225e-02   +2.234188063388281e-02   +6.910180752379911e-03; +9.649596458465264e-02   +4.651405193574394e-02   +7.162469177702886e-02   +1.380920201539927e-02   +5.532630436844003e-02   +1.721609022653918e-01   -3.327712049262614e-02   +2.126021532384230e-02   +1.347080942780246e-01   +8.219797228676151e-02   +1.458437082573323e-02   -1.050738462881028e-02; +6.907255027285854e-02   +1.146604395047662e-01   +5.433817901533036e-02   +6.067767920604955e-02   -5.239498669723805e-02   +3.954780962062930e-02   -1.622453648262453e-02   +8.604301751866579e-02   +1.963354948132970e-02   +3.372250324401600e-02   +7.120615492913958e-02   +5.125775146982212e-02];
L2E_L3E_iAMPA_netcon = [+9.972893776730926e-02   +8.101394580759949e-02   +8.065794291417668e-02   +1.896241112664755e-02   -2.551431672680177e-02   +9.943220318915906e-02   +1.093776674128712e-01   +1.467353118060244e-01; +7.975177309494537e-02   +9.584496794905836e-02   +1.168540151680499e-01   -5.313583491461466e-02   -4.134826820463330e-02   +7.994114123139340e-02   +7.453228891236562e-02   +3.177756972715553e-02; -7.181674161137791e-02   -4.823520615013411e-03   -8.751223267128883e-02   +6.689919844851507e-02   +1.203784574059937e-01   +1.554549824893556e-02   +6.188763815032285e-02   +1.063686877560827e-01; +3.189212069457084e-02   -1.157635975572099e-02   -1.995991481673182e-02   -4.427473207366442e-02   +9.120040365089704e-02   +3.704348749122199e-02   +2.034793996721023e-02   +6.128684629436058e-03; +5.180199792550023e-02   +7.281356318226576e-02   +1.520568201048608e-03   +1.025496020445042e-01   +4.044680518558118e-03   +4.478627391610172e-02   -3.629521127255673e-02   +7.429670320414380e-02; +4.518553016907472e-02   -3.018705374961165e-02   +1.184519915173256e-01   +3.460732337207724e-02   +1.765845407100965e-02   +7.722445876592982e-02   +5.713323680297912e-02   +1.277338924075108e-01; -1.675307604906947e-02   -1.724843291290176e-03   +7.925426175073977e-02   +9.126727264580617e-02   +1.694262724442184e-02   -1.465684613389188e-02   +6.726144903021788e-02   +2.715027714745334e-02; +7.273415283330728e-02   -4.163270810165692e-02   +9.391302241294938e-02   +9.843566032303551e-02   -4.041795504702878e-02   +8.269610540097243e-02   -4.878494559046272e-03   -3.528025022240065e-02; +6.094679883631528e-02   +1.100092215659994e-02   +3.791815218734729e-02   +9.966349325688414e-02   +6.454418060434622e-02   +1.875648693530644e-02   -3.195478983059729e-03   +3.187002939299197e-02; +4.806495768290509e-02   +9.078281760374324e-02   -3.360197125830626e-02   +3.758080479598629e-02   +5.862352109750062e-02   +7.086445077795255e-02   +1.388062184006518e-01   +1.370154230584824e-02; +9.446562134384412e-02   +2.504455550542960e-02   +5.667927685338021e-02   +1.213523489091684e-01   +6.253353536778694e-02   +9.423924512808861e-02   +4.535724930120218e-02   +1.422061326896167e-01; +2.314540728214287e-02   +1.083468185536615e-01   +1.955792566696880e-02   +9.498017447967402e-02   +4.149246956199405e-02   -4.270402764850947e-02   -6.566578843182659e-04   +1.036068886239109e-01];
L2I_L3I_iGABA_netcon = [+8.762961099377942e-02   +1.063847102761954e-01   +1.743431244122054e-02   -4.603985193354011e-03   +1.738725178356059e-01   +1.660503619524002e-01   +8.905194499970753e-02   +3.925198467142569e-02; +3.851192914269670e-02   +8.332905654649654e-02   +1.003284013319255e-01   +7.239384577925639e-02   +2.121586053869305e-02   +1.786610603116530e-02   +9.649582484377378e-02   +1.051037241192032e-01; +1.116285624309531e-01   -1.798794864842646e-02   +1.002960928918318e-02   +2.694568306959675e-02   -3.771070085725053e-05   +4.779071609127664e-02   +7.137785990944351e-02   +1.529533794981723e-01; +1.333412590769711e-01   -6.712156588074901e-02   +4.923955903493753e-03   -2.602339513091346e-02   -1.394274243804028e-02   -1.044045769278464e-02   -1.161576271762225e-02   +2.353627087985672e-02; -3.531807208334231e-02   +8.468308056044346e-02   -1.485152822005912e-02   -5.386156570272652e-02   +1.187828382322171e-02   +3.628570529953177e-03   +1.628078593625848e-02   +6.397790469243581e-02; -3.351543319921785e-02   +5.743445150322629e-02   +7.401682635147501e-02   +1.692621611151845e-01   +8.930643579532840e-04   +2.806400032212272e-02   -1.330309304063301e-02   -1.464424355408631e-01; +3.915405806060431e-02   +3.020972224505587e-02   +1.190161685638810e-01   +4.752848118458998e-02   +8.132281560199849e-02   +1.406384344539496e-02   -3.240664914436753e-03   -5.049429725814635e-02; +2.545526341753800e-02   +4.888540224994992e-04   +8.762843567216197e-02   +1.311939682008334e-01   -5.149489299929304e-02   +7.759100978416940e-02   +3.731162104963077e-02   +1.172997728988565e-01; +4.862846253062124e-02   +5.415176901514683e-03   +5.138392454008803e-02   +1.901777049466907e-01   -2.756036145605097e-03   +4.071903856809957e-02   +9.421973419995525e-02   +2.692279747636045e-02; +4.627993548346751e-02   +1.291267335442690e-01   -1.826787090045167e-02   +1.328712783852486e-01   +7.835896823817011e-02   +3.210144322971253e-02   +4.418430110455731e-02   +4.231914455596217e-02; +9.503308551148673e-02   +4.901094890287332e-03   +1.171430681194208e-02   +6.073382791433909e-02   +4.040975558163386e-03   +1.700031747492965e-01   +4.566891540201436e-02   +1.289907366531927e-01; +7.080056379657339e-02   +1.286451884292447e-02   +9.090906041258123e-03   +6.382156386410147e-02   +1.004196997633437e-02   +7.118580259855886e-02   +2.520492717856581e-02   +6.363260549423608e-02];
L3I_L3E_iAMPA_netcon = [+3.700117199148310e-02   +3.351368338256433e-02   +2.894455063892910e-02   +1.660058915550891e-01   +6.604641932752844e-02   -3.451658784900663e-02   +1.141536525275531e-01   -1.324790347669982e-02   +5.462047577997189e-02   -2.951489767971070e-03   +3.785129580132003e-02   +5.464841222356581e-02; +1.027332390133160e-01   +2.868972035743957e-02   +3.321012076303039e-02   +3.847581730143403e-02   +2.254832470873866e-02   +1.079944146884675e-01   +3.880993424915304e-02   +1.363669262076527e-01   +9.926813103241544e-02   +1.210959263880700e-01   +1.677016972131383e-01   +1.573316020201548e-01; -2.278343697975015e-02   +5.695364861796964e-02   +3.839140296675713e-02   +6.685482242755285e-02   +2.572298241640497e-02   +4.230597809183789e-02   +2.210301224921912e-02   +4.997601252463987e-02   +6.644927453752526e-02   +1.781281076445210e-02   +1.107779501133659e-01   +3.849290597756280e-02; +5.952379267440876e-02   +4.509953337847479e-02   +1.087200059800173e-01   +1.173633257289418e-01   -2.159897409141517e-02   +1.923470672810630e-02   -9.166037945835509e-03   +5.556852471081444e-02   +6.687056163768734e-02   +2.042894648257367e-02   +9.653387591037586e-02   -1.799662878278941e-02; +5.764834529510512e-02   +1.963341143969226e-02   -5.722103227990193e-02   +7.924576395193912e-02   +8.389747652214150e-04   +3.007814315280070e-02   +1.278982656235587e-01   +2.152549206812875e-02   -6.504834937492864e-02   +1.228988331099245e-01   +4.913014285520170e-02   +9.903502797017183e-02; +6.376688940167159e-02   +5.225047074020414e-02   +4.720001864099756e-02   +3.028341342615029e-02   +1.074074425761081e-01   +1.140903519200705e-01   -9.022394660307138e-03   +2.116095756546696e-02   +3.003367183997878e-02   +2.669872411149391e-02   +2.035227409876155e-02   +1.330441564951340e-01; +1.924461336832980e-02   +7.237937572971818e-02   +7.215623110199523e-02   +9.800347104086535e-02   +5.070382948092045e-02   +7.755842495852069e-02   +3.869161256136398e-02   +1.004639039181384e-01   +1.225693977010375e-01   +1.202055008774989e-01   -1.476360737439962e-02   +1.017737112571493e-01; +6.970057089657052e-02   +1.202392748988692e-01   +6.270437308441346e-02   -9.266572116106500e-04   +9.128402806598461e-02   -1.373731950786209e-02   +3.740929154065743e-02   +7.452563623449218e-03   +6.841525768437356e-02   -1.242439086623781e-02   +6.543461665005383e-02   +8.909643900715544e-02; +3.734397109903665e-02   +1.012747475073928e-01   -5.628007460240214e-02   +7.862944473285388e-02   -8.943822081470706e-03   -3.024164674632658e-04   +2.497808798680242e-02   +3.258656900075096e-02   +8.327971628241118e-02   +9.991717570112159e-02   +3.567449684149217e-03   +7.990225920891433e-03; +1.522773392837456e-02   -9.259059506345124e-03   -1.867027259291982e-02   -7.153714002167007e-02   +7.457320013764845e-02   +1.615787528592493e-01   +1.221026778951705e-01   -8.949690542371241e-02   +1.260309193656069e-01   +1.120514434900459e-01   -6.753995171714863e-03   +5.076888705587940e-02; +6.177254486104417e-02   +4.550095016631468e-02   +1.372108204123005e-01   -4.306686712661063e-02   +7.761790963565704e-02   +6.427966040667822e-02   +1.100710821731904e-01   -5.328899854561940e-03   -1.237129138318474e-02   -4.399300971096649e-03   +4.759616145433906e-02   -2.713822735546032e-02; +4.859903781590577e-02   -5.005441342303349e-02   +8.209895590855375e-02   +8.904717547105953e-02   +1.079683789800237e-01   +6.317532270248032e-02   -7.391212694735541e-03   +1.213844041342590e-01   -2.427601886240299e-02   +4.023408129081441e-02   -4.901713484197967e-02   -2.914326463093932e-02];
L3E_L3I_iGABA_netcon = [-1.066812114443740e-02   +1.633645317155726e-02   +1.936945440093771e-02   +6.113382250751383e-02   +5.689829346396378e-02   +8.880527798863261e-02   +1.672238273190821e-02   +7.019412835776191e-02   +1.644725550341744e-01   +7.929862008928441e-02   +8.715062916466773e-02   +2.784009583356745e-02; +6.966281609932962e-02   +1.202954416741513e-01   +7.076206641523193e-02   +3.400804675558419e-02   +5.882971794933067e-02   +2.069497991076309e-01   -8.350756662055504e-02   +1.458205794991822e-01   +7.674378147990407e-02   +5.427798631476487e-02   +4.038324032383451e-02   +1.061970834206232e-01; +2.351034407184030e-02   +3.989398682387873e-02   +4.936389497293834e-02   -2.954267741437705e-02   +9.476877102929843e-02   +5.104159817373489e-03   -1.631739599982875e-02   +2.389686706805175e-02   +6.799364407365682e-02   +5.113802598928789e-02   +8.455529711872722e-02   +1.714672257763673e-02; +7.913534830652023e-03   -2.760835493909392e-03   +6.693947784320049e-02   +1.490272757138206e-01   +1.570853869024600e-01   -2.215273642980843e-02   +2.318222822654171e-02   +6.594574056813975e-02   +1.936501776243625e-02   +1.750404040666882e-01   -3.851244201168878e-02   +2.712612587792455e-02; +9.148734449328676e-02   +1.598715258865627e-01   +9.851847684529079e-02   +3.793765011936337e-02   +1.268583545684167e-01   +1.379109005339097e-02   +7.177396213921515e-02   -3.278791049223200e-02   +3.295132965531387e-02   -5.612704890536037e-03   -1.625261410139604e-02   +3.978955431776083e-02; +7.464858200822082e-02   +1.643443867580372e-01   +8.222621602818236e-02   +1.705407942533704e-02   +1.364140808288425e-01   +1.533604735802483e-02   -1.148458549442252e-02   -4.907108367421697e-02   +9.336668192048769e-02   +1.521557455946261e-02   +2.354888519243448e-02   +7.670377301535257e-02; +6.558464754375834e-02   -1.778760654239481e-02   +1.850330923723075e-02   +5.880750797723620e-03   +1.654619571534160e-02   +7.663089747480251e-02   +5.108045583752396e-02   +1.198150412261784e-01   +1.117079950915170e-01   +3.156771274165010e-02   +4.959031923939300e-02   -6.028081678854195e-02; -3.090704147986432e-02   +5.631167013725110e-02   +9.249402615331868e-02   +9.738957758006647e-02   -2.923962688100916e-02   +3.198788435488503e-03   +3.587722506625181e-03   +1.197586215596866e-01   +1.422886810172152e-02   +2.375412822564697e-02   +3.461018441660743e-02   +3.761881076151143e-02; +6.836372349142091e-03   +9.913267788390397e-02   +1.039363470714504e-01   -6.613403412016461e-02   -1.701509222637873e-02   +7.063991554634025e-02   +3.524134791401966e-02   -1.880955100808419e-02   +7.500482593722824e-03   +6.876141871510578e-02   +4.741022941960821e-02   +7.041941387016863e-02; +5.585022661219357e-02   +8.252257593504794e-02   +3.816780893213476e-02   +1.193670525969104e-01   +7.202193949629249e-02   +1.928262281334236e-02   +8.982409023753621e-02   +1.251745775149242e-02   -1.018121875478203e-02   -4.079207938195387e-02   +5.672391965251505e-02   +3.153701873926618e-02; +7.469391877082798e-02   -8.412097000653120e-03   +5.138646386993653e-04   +5.937574558238637e-03   +5.396497393958263e-02   +2.804474273518704e-02   +3.554797444247067e-02   +6.430572712829868e-02   +1.048600787402030e-01   +5.400714977028426e-02   -3.359235034565593e-02   -4.570187118501952e-02; +5.752335127238051e-03   +5.416334437314128e-03   -6.477870891346986e-03   +8.993806623250986e-02   +1.843083983787248e-02   +2.805776241448541e-02   +3.384261042964325e-02   +3.261010936785554e-02   +8.233418995517711e-02   +1.190725121650124e-01   +6.406635739218691e-02   -2.602923821769909e-02];
L2E_Input1_iAMPA_netcon = [+9.806933984445283e-02   -4.310519589084889e-02   +5.274760095398907e-02   +1.558127062473670e-01   +1.481853208650339e-02   +4.734650750405736e-02   +3.686976438603337e-02   +3.919473088388099e-02];
L2I_Input2_iAMPA_netcon = [+6.625818945907822e-02   +2.052972187344890e-02   +4.112957663050033e-02   -6.873165568165299e-02   -1.994480425020965e-02   +6.909119753641522e-03   +7.902571728138172e-02   +2.005390606337511e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.8*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.8*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
