function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.173460867857306e-01   +2.482058260796496e-01   +1.315775091945714e-01   +2.388864216183092e-01   +4.502964096058475e-01   +1.213711549078112e-01   +4.270684255626609e-01   +2.113143207886639e-01   +8.090812593340928e-01   +5.565123440202409e-01   +4.839997053844733e-01   +2.136511939811347e-01   -3.393345279869900e-02   +2.534246717824840e-01   +2.474577308677091e-01   +3.414295887584230e-01; +1.293250098813563e-01   +2.779811562756732e-01   +5.910902707069017e-01   +2.379597427506899e-01   -1.263488782834314e-01   +2.009286980450022e-01   +2.830095921184235e-01   +3.752813261995281e-01   +5.910794838653637e-01   +1.771360175820370e-01   +4.767999353143348e-01   +1.455544532659266e-01   +4.701589710107109e-01   +1.087160608532484e-01   +6.576757229760519e-03   +4.397564072046205e-01; +8.406344933705873e-02   +3.032030495663296e-01   +4.501979982005210e-01   +2.800306833258347e-01   +2.269232596444747e-01   +3.826386109151443e-01   +7.241523740960175e-02   +4.908216901610180e-02   +3.787236809717309e-01   +5.757425383573508e-01   +5.609843469836062e-03   +3.819548318651571e-01   +2.528160272656246e-01   +6.805299486869623e-02   -4.306976856225952e-02   +8.933982544813146e-02; +1.197807805764121e-01   +4.203515797742039e-01   +3.089935641863428e-01   +2.816332348515104e-01   +3.632539644508639e-01   +1.692668854730348e-02   +2.082065771752755e-01   +4.944453723702829e-01   +5.740249951410026e-01   +3.704629086296873e-01   +2.944870347341636e-01   +4.569734415619902e-01   +5.576058260018157e-01   +5.578872229809123e-01   +2.573045395861866e-01   +3.711849513347750e-01; -4.774968835411295e-02   +1.562158536131749e-01   -3.887709118697716e-02   +3.105398528396880e-01   +3.726358576894874e-01   +4.841829216632750e-01   +5.034858706170431e-01   +9.053405383553467e-03   +3.824338881637409e-01   +5.381079421298730e-01   +1.837363718466822e-02   +7.999883857290957e-02   +2.677195095629236e-01   +5.010853149409092e-01   +1.115956669394984e-02   +2.417611992139261e-01; +5.477434645472955e-01   +2.514670435853952e-01   +1.012581519470145e-01   +6.322748312771083e-01   +4.366672137515440e-01   +4.062535004061199e-01   +7.872541632606442e-02   +1.248341690374562e-01   +4.707738292457804e-01   +3.921341537838228e-01   +4.148540880701040e-01   +2.599287911289916e-01   +5.295201681783309e-01   +6.355939793265964e-01   +6.261290947175193e-01   +2.783502573936512e-01; -9.072079281713284e-02   +2.264249569631355e-01   +3.809601023176852e-01   +3.684156881504386e-01   +5.078654914905529e-01   +8.472195353149463e-01   +2.279267038290609e-01   +1.580267382860313e-01   +4.928507199711075e-01   +2.612991474831586e-03   +2.457276421147739e-02   +3.695828064724714e-01   +6.110227901323937e-01   +5.336260373218320e-01   +4.223521908026712e-01   +5.268292559859840e-01; +1.198069410852844e-02   +5.485266065905372e-01   +9.582861341499652e-02   +6.031042773463927e-01   +1.452203657069081e-01   +4.942891861995886e-01   +2.521889048683499e-01   -8.895234945177830e-02   +4.499698257023709e-01   +4.437304740196544e-01   +3.719808389161947e-01   +1.817053463456244e-01   +1.542577297939295e-01   +1.464925844629975e-02   -1.080541620732819e-01   +4.847105204663887e-01; +1.183197271690729e-01   +2.338731411995421e-02   +3.828295157905136e-01   +1.590734133493095e-01   +2.868522915407445e-01   +2.369435888675649e-01   +5.305502532456535e-01   +9.735393541104378e-02   +1.887024099952833e-01   +6.023092320386021e-01   +4.468121332711921e-01   +3.107832541158542e-01   +1.884681924350965e-01   +5.944995947745078e-01   -1.008865004286172e-02   +5.250311872207980e-01; +1.085985414440719e-01   -1.631382066879187e-01   +2.892667097171809e-01   +6.874175088684770e-02   +4.353395005263389e-02   +3.811259559304662e-01   +3.069269160754117e-01   +5.583912977518148e-02   +4.332332188314374e-01   +1.694026527623558e-01   -3.803068392370987e-02   +4.997087561230966e-01   +5.516757395705397e-01   +2.374259127508274e-01   +4.759037149763043e-01   +2.015078513876798e-01; +2.737541693267287e-01   +3.862937459138976e-01   +2.494006643483057e-01   +5.404777856364146e-03   +6.275757814686858e-02   +2.035673849053645e-01   +2.364320943901344e-01   +3.615583049083714e-01   +4.637898414535118e-01   +2.676307148031634e-01   +3.506238250118028e-01   +4.896999378805704e-01   -9.416304995385838e-02   +4.618152559455272e-02   +2.294060704981763e-01   +2.090176847064152e-01; +2.619668866475977e-01   +4.407699730625475e-01   -4.449021425443706e-02   +4.390111699615762e-02   +6.622404827041329e-01   +2.512593120785839e-01   +5.305803862028192e-01   +3.886115820523102e-01   +5.546919216429923e-01   +5.634534003546252e-02   +1.509525711091515e-01   -7.902485492757638e-02   +3.166394042200202e-01   +3.751710900287880e-01   +5.643846323493095e-01   +2.704658439468806e-01; +2.244426216705290e-01   +5.657429620138474e-01   +1.600485015534147e-01   +2.570545851682722e-01   +6.901983407715004e-01   +5.642999503647040e-01   +6.516715816554540e-02   +3.750552210300317e-01   +8.496697470158994e-01   +6.185570249185075e-01   +5.444054948327240e-01   +2.340472167718195e-01   +8.214338607889431e-01   +4.078994819242938e-01   +2.606282462136140e-01   +4.929107034125788e-01; +5.325502521599682e-01   +1.140471969895583e-01   +4.524418472903695e-01   +4.651743635140055e-01   +1.870887054414882e-01   +2.833351797092375e-02   +1.639821884603230e-01   +5.700345193218052e-01   +6.558932609056748e-01   +9.643871843555085e-03   +1.902023439223257e-01   +5.987430032340535e-01   +1.866951582758361e-01   +4.866005016101134e-01   +3.028411478068719e-01   +6.070681529286990e-01; +3.275010711951472e-01   +4.789520463619594e-01   +6.315662380204589e-01   +4.082022004225688e-01   +6.723578308218782e-01   +9.829716868694961e-02   +4.328425873858657e-01   +5.187936542657930e-01   +3.894627989123896e-01   +7.058608589376201e-01   +2.657385803290846e-01   +3.044855701688530e-01   +5.177952005568642e-04   +3.454877500868289e-01   +6.363321904572714e-01   +7.102563657906066e-01; +1.457489699614937e-01   +4.464416201346530e-01   +4.778127529104615e-01   +1.574470251250950e-01   +8.722033363610773e-02   +8.140764543962367e-02   +6.744751403594629e-01   +6.049554379005307e-01   +6.638966178755089e-01   +1.682767679239725e-01   +1.011972939037228e-01   -5.395120957749544e-02   +1.940853767796093e-01   +3.309684613543085e-01   +5.359192780923481e-01   +5.942220885469306e-01];
L1E_L1I_iGABA_netcon = [+4.829245999014080e-01   +1.601155572973855e-01   +5.087211958182631e-01   +2.735102379715919e-01   +3.539281375155473e-01   +4.672678621866393e-02   +5.390477606180132e-01   +4.257413018123336e-01   +2.537519352659546e-01   +4.306849305399513e-01   +3.986014653170802e-01   +4.612437934896084e-01   +6.409676169797507e-01   +2.658057732361815e-01   +2.080986568959475e-01   +5.089220507540277e-01; +2.587383700296634e-01   -6.699736582913675e-02   +3.273251236738202e-01   +1.433556217030881e-01   +2.820393375400413e-01   +4.987660424192106e-01   +2.749315266493675e-01   +6.896489449054188e-01   +5.697948720846582e-01   +4.908784584159102e-01   +1.988732092041086e-01   +3.029698053978570e-01   -4.276664574790125e-02   +6.202797628321617e-01   +2.364633260123397e-01   +4.775701305533995e-01; +3.647174417020945e-01   +1.289406552183575e-01   +1.570273366018735e-01   +2.566740760972236e-01   +3.453391648832114e-01   +3.324210958020448e-01   +4.803076447668510e-02   +2.585028317172721e-01   +1.037962214085169e-01   +2.082597988261148e-01   -1.199766315972571e-01   +3.421399444334917e-01   +1.772956287207622e-01   +1.480443586376036e-01   -1.184886056958853e-01   -9.460345623352695e-02; +3.330289149061707e-01   -6.807126535717396e-02   +6.133563565439917e-01   +1.985019438368638e-01   +1.615137963959603e-01   +3.051393850501455e-01   +3.977637089454314e-01   +2.938233568361717e-01   +3.029606290289057e-02   +2.140468519299217e-02   +6.670862510987711e-01   +4.580867060238702e-01   +6.616017438309700e-01   -4.167053515351408e-02   +3.184008540390527e-02   +5.870850149894912e-01; +6.075246703154646e-01   +6.024062915004127e-01   +6.016690280606455e-01   +1.955637814815619e-01   +4.349654198863596e-01   +4.534896821613098e-01   -4.958337816573914e-02   +5.328198885745017e-01   +2.272086903684542e-01   +2.640171998545054e-01   -3.845318721737659e-02   +2.578765618458402e-01   +5.461733180182771e-01   +1.778693960804342e-01   +2.971280998930738e-01   +1.443607096999648e-01; +5.712606914243857e-01   +5.628879014831585e-01   +1.560773432848365e-01   +6.445926135022569e-01   +4.330951318168859e-01   +6.752244912914299e-01   +5.428994442295398e-01   -1.089203999466967e-01   +5.304452207310094e-01   +5.290289949262692e-01   -8.779071480547346e-02   +4.650518518936935e-01   +3.225095875088684e-01   +3.782071000895005e-01   +4.402807481804411e-03   +5.144643448078892e-01; +5.884124639308482e-01   +4.379321304952677e-01   +5.181894758761048e-01   +2.551657170268791e-01   +5.065974421145931e-01   +4.282246746870843e-01   +2.552068072566084e-01   +2.582157586488713e-01   +1.060845325043083e-01   +1.487278516369423e-01   +4.739770763243009e-01   +2.702288057740582e-01   +7.902072114518929e-02   +4.585394533023159e-01   +2.466939516944299e-01   +1.963254417617823e-01; +6.135457792809438e-01   +2.261371339014499e-01   +6.639108748898572e-01   +3.879711438951346e-01   -2.941733862549160e-02   +2.743791384091803e-01   +5.522792737222810e-01   +1.776462896403409e-01   +3.329482965766050e-01   +1.051382822408921e-01   +6.205963754721071e-01   +5.077778392621530e-01   +3.972972007849407e-01   +1.602472860062372e-01   +5.289271569510051e-01   +5.804446164021285e-01; -2.390685528159395e-02   +7.113244775222571e-01   +5.154575168080716e-01   +1.511660941116438e-01   +5.123855785972901e-01   +4.231608567627075e-01   +3.144964092158362e-01   +3.203913107350881e-02   +4.110720318987248e-01   +2.294563973868908e-01   +2.896348355828307e-01   +2.849990183707597e-01   -4.626725857997968e-02   +3.252884623929138e-01   +3.347473201145975e-01   +1.424309048516993e-01; +3.186183884350847e-01   +5.198515584556590e-01   +5.523891711930756e-01   +3.851901314947450e-01   +4.798508266470271e-01   +6.837839303506310e-01   +4.435973797216335e-02   +3.052387424530152e-01   +3.601765655583052e-01   -6.599175273492716e-02   +1.578333670633310e-01   +3.318362546853716e-01   +1.150357077040144e-01   +1.099324362897377e-01   +2.816424921056210e-01   +4.430713544917971e-01; +1.655680743120315e-01   +2.504391564754301e-01   +1.031339427153618e-01   +2.496009100343953e-01   +3.714645825940929e-01   -1.317046418253152e-01   +3.991507198790268e-01   +3.073650907161589e-01   +2.311129419314582e-01   +1.895564082619673e-01   +2.380769816282016e-01   +1.170244547673593e-01   +3.347069968558208e-01   +3.152484523813422e-01   +3.585651780687411e-01   +4.284951709328114e-01; -1.571865400352677e-02   +2.405873488749776e-01   +1.672730420360295e-01   +6.098371869475383e-02   +3.381049177021986e-01   +2.403505965681347e-01   +1.749633169603683e-01   +5.774196585909338e-01   +7.022206248369038e-01   +3.326089180942168e-01   +7.394322887048426e-01   -2.063111163990772e-03   +2.647945404597397e-01   +3.473671285106610e-01   +5.521122939763312e-01   +4.526244937215754e-01; -9.651362198952987e-02   +7.085439074639530e-01   +2.077046511420049e-01   -6.024134671387614e-02   +6.556173711472026e-01   +1.599024160229750e-01   +5.929384790922160e-01   +5.249839229887352e-01   +6.740592610764665e-02   +5.376704772214298e-01   +3.116377046282978e-01   +7.455696105409720e-02   +5.293728893449802e-01   +4.741686970695180e-01   +6.574076963401261e-01   -8.998573684300873e-02; +8.423280584304074e-02   +3.011263262471603e-01   +5.906663384423557e-01   +6.122007459750058e-01   +1.573354752694946e-01   +4.045299832179106e-01   +1.631443375227749e-01   +4.711752995682518e-01   +4.408994360099157e-01   +3.130901520827292e-01   -7.637318363248430e-02   -8.059360270744133e-03   +1.418153334821693e-01   +5.953541877218542e-01   +6.454332096424896e-01   +2.819044922051087e-01; +2.397352551100215e-01   +4.715800388752950e-01   +1.911166804444446e-01   +5.081782048637150e-02   +4.130230378883123e-02   +6.394025634590907e-01   +6.129764243042740e-01   +3.351527183757381e-01   +5.170654798375481e-01   -2.180066685945361e-01   +4.395835767539913e-01   +5.827790691900678e-02   +2.323201347881179e-01   +2.695130277011986e-01   +3.857914582039080e-01   +5.835845950653369e-01; -1.200977561439504e-01   +5.853287632423004e-01   +2.122951477419241e-01   +1.974172624081592e-01   +1.075470423478535e-01   +1.063867846732664e-01   +5.338525445037559e-01   +1.815388391806454e-01   -8.690209208269792e-02   +2.701979123718411e-02   +2.860305584560952e-02   +3.605630945697061e-01   +2.036848842935762e-01   +5.226335047327428e-02   +3.020456452268248e-01   +4.298375941134036e-01];
L2I_L1I_iGABA_netcon = [+3.035501696330193e-01   +3.757657702027651e-01   -4.058675351645173e-02   +7.193898652403916e-02   +2.379379094634014e-01   +1.821828953610911e-01   +7.184577052760575e-02   +5.053534252959790e-04; +3.687626713652313e-01   +2.849478548329073e-01   +5.777736145994193e-01   +6.456399372301000e-01   +4.161194863485107e-01   +2.956472213438764e-01   +6.147973910569516e-01   +5.034420512628616e-01; +3.343356762248767e-01   +7.760550255075646e-01   +6.393672449937396e-01   +1.744644276126488e-01   +6.191356009180287e-01   +3.116249116486371e-01   -3.915595287428369e-02   +6.986227901173575e-01; +1.806821397676030e-01   -2.458217780368643e-02   +2.863260181623404e-01   +5.564208235907943e-01   +1.778273745722936e-01   +5.830622436045216e-02   +5.858566429449782e-01   +1.186407417886512e-01; +1.363045578934914e-01   +1.390010380751466e-01   +3.544438170129784e-01   +4.966301150225758e-01   +4.833540660022062e-01   +6.507528764984257e-01   -7.605935116655226e-02   +4.684997880935152e-01; +3.762927200840520e-01   +3.006254037011636e-01   +6.555506349302305e-01   +7.286064773092809e-01   +7.579641312947423e-01   +5.066647619492044e-01   +2.095004650577884e-01   +1.062619383683679e-01; +1.157076277794420e-01   +2.664024814588127e-01   +2.140493768714891e-01   +4.961340986353591e-01   +3.421545860600244e-01   +5.270178622535910e-01   +4.594196454620487e-01   +2.812285475398483e-01; +2.563374765514694e-01   +2.669096756655095e-01   -1.568358785852981e-02   +3.609031530296187e-01   +5.604532237913111e-01   +6.485760424385479e-01   +3.398286107339678e-01   +3.179304323813432e-01; +3.723331286822553e-01   +2.012534136957480e-01   +1.685974712705199e-01   +1.803967085235409e-01   +2.900583922067759e-01   +2.223960873068441e-01   -1.047390761199819e-01   +4.814780908996555e-01; +1.182301180133499e-01   +5.961480337272439e-01   +2.719507723192420e-01   +3.961120566314903e-01   +1.324880193959610e-01   +5.985766182290138e-01   +3.455322114039177e-01   +2.302490185557479e-01; -3.722147561664584e-02   +5.268825713224597e-01   +1.302123537222288e-01   +6.402780883448014e-01   +1.684420653291467e-01   +1.124083458010666e-01   +2.165803534234365e-01   +6.105033772903332e-01; +5.922213239786056e-01   -1.685099910071551e-01   +2.985868452507645e-01   +4.062116439680254e-02   +6.318270834018929e-01   -2.025166541770813e-02   -4.291888610150151e-02   +3.436948863421946e-01; +3.817045128646417e-01   +2.502423998202516e-01   +5.550352153936094e-02   +2.036251730334293e-01   +7.256469158195273e-01   +5.825914250654999e-01   +2.107943086817613e-01   -3.284974739374186e-02; +7.105426862617251e-02   +4.897235000867833e-01   +2.340324701041485e-01   +4.712293849938208e-02   +2.749702995506650e-01   +8.512519546823963e-02   -2.905715063822064e-02   +3.954899452892549e-01; +1.644206816080450e-01   +9.504117088057500e-02   +7.308917657833420e-01   +4.873286700871334e-01   +1.962342160403475e-01   +1.761616887156563e-01   +3.703096703372071e-01   -1.672807845647444e-02; -3.656792696158963e-02   +3.271866582349548e-01   +4.064251178748747e-01   -3.475654923097195e-02   +3.288064069462773e-01   +5.413224455426526e-01   +3.847808783555458e-01   +1.596386761827684e-01];
L1I_L2I_iGABA_netcon = [+3.667920673065943e-01   +5.642061000886982e-01   +6.238933842991876e-01   +1.764391956455439e-02   +4.210725480765601e-01   +6.867202633440009e-01   +4.301208666183078e-01   +2.267854373244532e-01   +6.315675507347731e-01   +1.234665330110949e-01   +4.371161672058784e-01   +4.307147310016046e-01   +4.201844375354835e-01   +4.656064569230286e-01   +7.548218213745493e-01   +4.849844877245976e-01; +1.037903125927068e-01   +4.679141662665504e-01   +1.511828624576284e-01   +6.608992344926624e-01   +3.674987798718554e-01   +9.998084116560246e-02   +4.108755585254981e-01   +7.016758670906692e-01   +4.616935364496512e-01   +8.702494213725635e-02   +6.770508545594965e-01   +3.430836021872492e-01   +1.308625172087024e-02   +1.773606746296467e-01   +1.172966931093824e-01   +4.894978645346328e-01; +4.853840650818825e-01   +1.274035489531374e-01   +1.625457767041289e-01   +2.940894501324408e-01   +4.980558654358430e-02   +3.140617635067071e-01   +3.788350685285614e-02   +4.393727668123311e-01   +1.347637478733328e-01   +3.202918876323630e-01   +6.897646534421035e-01   -6.155249576836773e-02   +1.526468392639702e-01   +1.536727179597718e-01   +5.146689674105448e-01   +4.022735432835301e-01; +4.956734987476382e-01   +3.058068369685891e-01   +7.133625827737061e-02   -7.844225368723007e-03   +8.168965435559741e-01   +2.430812437919906e-01   +2.575215168575891e-01   +6.232428687696245e-01   +4.031629709270741e-01   +2.454999287666627e-01   +1.392133128929771e-02   -9.462056194190718e-02   +6.362908108431238e-01   +4.799157145066046e-01   +3.037545170870036e-01   +2.931038952242038e-01; +2.530640131811666e-02   +7.169617105476259e-01   +3.630034436318434e-01   +4.760136133303851e-01   +5.403437062605163e-01   +1.424787720072031e-01   +2.673795059343585e-01   +5.994065847049040e-01   +1.902166724513074e-01   +7.159205671934663e-01   +5.750478824952199e-01   +4.712529013672926e-01   +4.252414074446349e-01   +2.469427513915441e-01   +6.203247202048475e-01   +4.430674996779901e-01; +5.053708264576607e-01   +3.347514755284227e-01   +5.113224938093330e-01   +7.004606218518247e-01   +6.359541755949524e-01   +3.443220011852560e-01   +2.411654620868180e-01   +6.364522822139870e-01   +6.561740971362383e-01   +1.270660677192047e-01   +1.236987604624449e-01   -2.385680804434853e-03   +2.751832577172881e-01   +1.570540812453380e-01   +4.954314085347262e-01   +1.252109170741262e-01; +1.966248983057706e-01   +6.572463855363611e-01   +5.541758319828353e-01   +1.463724405838329e-01   +4.254906361737449e-01   +4.901078485854326e-01   +4.943057191708274e-02   +3.433054100031718e-01   +2.757637938531431e-01   +6.963532703152901e-02   +3.916811290331628e-01   +2.407663621126828e-01   +6.907391999983792e-01   -1.392474165853482e-01   +5.046033962519325e-02   +4.478562839974720e-01; +3.646931764382583e-02   +9.004376023029617e-02   +6.791970523622567e-01   +2.868989605167990e-01   +2.395656107335908e-01   +2.475392324445491e-01   +4.163196872224094e-01   +2.160970924559592e-01   +3.583077600130756e-01   +5.866470914487049e-01   +2.841391897213411e-01   +2.947713565530574e-01   +4.609091012665584e-01   +1.143633136431654e-01   -4.554996817877383e-02   +4.960422819692441e-01];
L2E_L1E_iAMPA_netcon = [+5.170951416083965e-01   +1.017882119423002e-01   +1.719365450827722e-01   +4.910653834646915e-01   +3.443284997792629e-01   +2.135517613798701e-01   +6.044004432989722e-01   +3.757416392127315e-02; +7.699089363373210e-02   +4.889718345483223e-01   -1.240367732630569e-01   +3.808216297631909e-01   +4.269640996650023e-02   +2.594080287123961e-01   +3.129247397799131e-01   +2.091405494897823e-01; +8.044012276607436e-01   +4.088547538226041e-01   +3.393739488618079e-01   +2.407065027684134e-01   +7.125581365323640e-01   +4.088179785464602e-01   +4.359546456762876e-01   +4.200352780954404e-01; +3.178015112611653e-01   +7.073659617465175e-02   +6.090949442802612e-02   +1.326185317086140e-01   +4.921279783156352e-01   +6.562524702777730e-01   +1.614905576930579e-01   +2.725301294045862e-01; +7.274931677199626e-01   +3.039292594652441e-02   +4.281498761838664e-01   +3.133116195229027e-01   +4.773640958733636e-01   -9.015419737140774e-02   +1.347496184588840e-01   +2.378871406138619e-01; +4.866163789683389e-02   +3.757571616421524e-01   +5.690973783138108e-02   +2.511710418308779e-01   +5.845984872412213e-01   +3.748660702964432e-01   +6.565165590595383e-01   +3.643301544990579e-01; +4.592770175622650e-02   +3.446002384242490e-01   +5.306800786560638e-01   -3.002823851187107e-02   +1.247461595751274e-01   -4.246871452653737e-02   +2.934395218587564e-01   +3.221475825046187e-01; +4.802888701079787e-01   +1.472604648724505e-01   +3.459469863234935e-01   +7.476839869789730e-01   +3.217451715532894e-01   +2.038142068044911e-01   +3.405593804271895e-01   +2.582147828848201e-01; +4.625938753784997e-01   +1.608452828855540e-01   +1.503174936081468e-01   +4.504453239793263e-01   +3.810570306460823e-01   +3.768778536316474e-01   -1.271710740257680e-02   +3.023513745772297e-01; +2.798627225180526e-01   +2.676012216422912e-01   +8.207340834175153e-03   +2.541220280495156e-01   +2.177174627636315e-01   -2.443529583307791e-03   +3.748115287952168e-01   +2.219758712376201e-01; +7.742293538696303e-02   +7.191176911596576e-01   +1.565359002945746e-01   +4.872347327869201e-01   +4.184716189025818e-01   +3.651339421351614e-01   +2.917628325431608e-01   +6.484867240219815e-01; -9.575996605140183e-02   +3.906797800044921e-01   +5.324903148169925e-01   +1.085492940013243e-02   +5.878372748149021e-01   +3.571731066395012e-01   +2.755366931561774e-01   +3.162829048505289e-04; +6.845544351371142e-01   +3.426781451664369e-01   +1.091498405107910e-01   +1.728492447326241e-01   +1.738611812534748e-01   +4.220397589503003e-01   +6.828146410497571e-01   +2.039960971815623e-01; +2.341080909787551e-01   -7.268077295575517e-02   +5.225713750346155e-01   +1.757743752626112e-01   +7.441003380577464e-01   +5.274518894108621e-01   +4.966188373245958e-01   +3.238241257948843e-01; +4.496447091151945e-01   +5.231526464383530e-01   +7.636978209910944e-02   +2.537522950308490e-01   +1.072572469123587e-01   +4.946720654926425e-01   +4.533552834585852e-02   +2.323148131019520e-01; +4.521156783323351e-01   +3.209193257234408e-01   +5.190148365144925e-01   +2.716772430034683e-01   +1.237156388749228e-01   +2.251678970819452e-02   +3.956594958702057e-01   +4.697695979376007e-01];
L1E_L2E_iAMPA_netcon = [+2.654388191472210e-01   +4.424840970835200e-01   +4.600839903146541e-01   +4.805224221358937e-01   +4.375898856366341e-01   +6.017667345992263e-02   +4.073059010716440e-01   +5.810582188960987e-02   +4.878069984566165e-01   +1.346729430200445e-01   +7.161335845678783e-01   +3.470953462428737e-01   +4.453514644659362e-01   -4.095414838467483e-02   +4.986243763330482e-01   +2.323344777876401e-01; +3.490379644664491e-01   +3.684102601736627e-01   +9.675403407621280e-02   -1.146174988006746e-01   +5.907035143341296e-01   +3.186002998995977e-01   -1.568955165949687e-01   -2.299157055611502e-02   +2.681133471681049e-01   +1.612457553758095e-01   +8.144913141857418e-01   +1.683029442820408e-01   +4.483977021060195e-01   +2.066103331829713e-01   +2.558816524272484e-01   +5.412548233362507e-01; +4.130172444956925e-01   -1.896491549755183e-01   +1.250744466646587e-01   +4.399978555648686e-02   +2.143993316478893e-01   +1.226118034634358e-01   +2.715996061305012e-01   +1.160340008250495e-01   +3.607864711950794e-01   +3.476364125223087e-01   +7.420428846995403e-01   +5.235431231349695e-01   +6.955230518986646e-01   +5.830820663012130e-01   +3.289864649025815e-01   +3.557122143529784e-01; +7.642650940664135e-02   +6.288401471136315e-01   +2.755679005939925e-01   +2.083152651441928e-01   +5.894636316584912e-01   +5.434841325121503e-01   -6.416653607307338e-02   +3.385394563557784e-01   +5.126670902074574e-01   +3.820415622642669e-01   +4.008477607661880e-01   +6.105892387541211e-01   +2.306972899360809e-01   +4.973081893356496e-01   +6.607194955499806e-01   +3.265247483415262e-01; +3.152081963116452e-01   +8.059949938068338e-02   +5.915625315070281e-01   +1.326821105293306e-01   +1.139960577812190e-01   +1.046727773446896e-01   +4.137605507822708e-01   +1.425953561474167e-01   +1.051342447894377e-01   +3.556366599207239e-01   +3.121116957974106e-01   +7.949248607476954e-01   +1.980838229431031e-01   +5.585843496286582e-01   +2.719380105642946e-01   +2.337182227057402e-01; +6.235963692972896e-01   +7.357773732833647e-02   +3.920013168772323e-01   -3.825398054294049e-04   +3.526065754782133e-01   +1.694343478060028e-01   +5.296725037237784e-01   +3.318670632986087e-01   +7.747530176610423e-01   +5.579241343687018e-01   +4.020092854438199e-01   +1.805509675254375e-01   +6.935674404620988e-01   +3.329729439365688e-01   +1.881658116860939e-01   +1.497891021126515e-01; +1.034469982226761e-01   +4.950202499394880e-01   +1.375996610793795e-01   +2.638790584546202e-01   +2.606989479353701e-01   +7.758795829697328e-01   +6.665112365701829e-01   +3.667704361051953e-01   +3.511436837688328e-01   +7.911760850930121e-01   +2.230921474203900e-01   +5.791949978500287e-02   +1.154942302798593e-01   +4.183417188467100e-01   +4.972703361371389e-01   +5.703897579288589e-01; +2.749590490919737e-01   +4.183742730903549e-01   +5.773813944524575e-01   +3.824609737576584e-01   +3.319162390831871e-01   +2.730770267737226e-01   +5.855635645379577e-02   +5.838568009653085e-01   +1.977080093680285e-01   +2.606619161318179e-02   +8.024924542337343e-02   -1.117916469311760e-02   +1.884757387273161e-01   +6.024426699147511e-01   +2.690007385047299e-01   +3.498033085310533e-01];
L2I_L2E_iAMPA_netcon = [+4.617328724042891e-01   +2.555737994077992e-01   +4.765847708697483e-01   +1.951975622981528e-01   +5.323136396208304e-01   -3.215803139012342e-02   +5.282440673555592e-01   +7.876488857888522e-01; +1.967758211266897e-01   +6.084550178151801e-02   +3.790585070607350e-01   +7.487787940246122e-01   +3.169586228036818e-01   +3.238400835143743e-01   +1.610889815375967e-01   +2.997248221476095e-01; +4.856666924826918e-02   +1.220085570870758e-01   +2.742020801257590e-01   +1.120188672640265e-02   +2.002569669759152e-01   +4.446781731406505e-01   -4.245210577643307e-02   +6.771391739473869e-01; +2.698743935887300e-01   +1.727521160422901e-01   +2.406795017967961e-02   +5.142796020239889e-01   +1.398790827353100e-01   +3.952649447327252e-01   +3.656903554143553e-01   +5.079792538627634e-01; +1.378798722983873e-01   +5.890244469588337e-01   +4.248803586233468e-01   +2.574513717776161e-01   +6.692188458800665e-01   +6.231755308471920e-01   +4.184689936912642e-01   +1.208216254783378e-01; +5.367428215692744e-01   +6.174627830391732e-01   +1.860396553833215e-01   +4.134742444962528e-02   +6.219858831142313e-01   +6.379600944737506e-01   +2.733820902547245e-01   +3.014047494805554e-01; +4.508153529888593e-01   +1.211478653810584e-01   +4.264755607981416e-01   +2.042493674281506e-01   +5.873224816167806e-01   +3.801036590323207e-01   +2.581705753077504e-01   +1.410316605995935e-01; +2.670002562371933e-01   +7.535075753334568e-01   +6.219344937173679e-01   +2.791021575686452e-01   +4.073050756503216e-01   +3.096325204890511e-01   +4.108201163764380e-01   +3.533197699827936e-01];
L2E_L2I_iGABA_netcon = [+1.071194143598000e-01   +3.209130446707187e-01   +5.869793749307908e-01   +1.242178498624186e-01   +2.421171183214851e-01   +2.558210682639891e-01   +3.057062961883130e-01   +2.699812752558982e-01; +3.100200101204728e-01   +7.807160154262735e-03   +3.104447148396947e-01   +3.929696920934650e-01   +3.727928074949422e-01   +3.339437267543080e-01   +4.387923615955126e-01   +4.927969588833516e-01; +6.847231800892992e-01   +6.633313971412982e-02   +2.248613963930797e-01   +3.233790170061946e-01   +1.057788726320566e-01   +6.330572412742906e-01   +1.766537200400983e-01   +3.817394276332459e-01; +4.395379612906348e-01   +6.588447398584824e-01   +2.466250596968743e-01   +5.114156739020470e-01   +1.344984341352951e-01   +8.090793695438830e-01   +3.120379490432350e-01   +1.034171651020781e-01; +8.571003129993771e-02   +4.317493139185881e-01   +3.759990879640677e-01   -5.040740017918317e-02   +5.445603765140151e-01   +4.230154501362152e-01   -4.277390445759287e-02   +5.918336480669740e-01; +4.299392379574098e-01   +3.415985934977193e-01   +1.963403033900694e-01   +4.609160431261640e-01   +2.746792480064398e-01   +7.706624167653874e-02   -9.109524069937611e-02   +3.838953281656923e-02; +5.124648896365200e-01   +6.017180979111737e-01   +9.113433799242590e-02   +4.012095899215237e-01   +4.343744057380282e-01   +2.396648982293583e-01   +2.202294759400653e-01   +3.466580791320356e-01; +3.743211218584837e-01   +3.245371891662228e-01   +4.166961552245256e-01   +4.495879740726187e-01   +6.697282459849588e-01   +6.412105524985969e-01   +4.206781593797304e-01   +5.094919899487080e-01];
L3E_L2E_iAMPA_netcon = [+1.244933470346383e-01   +2.489466125858109e-01   +3.683062311830538e-01   +1.995656551000548e-01   +1.712672637123947e-01   +7.167892772443633e-01   +1.750094623353886e-01   +6.259594773301045e-01   +3.546776948805227e-01   +3.428345436340628e-01   +5.392651661677142e-02   +6.746804798896743e-01; +6.314845056227819e-01   +5.588145931396304e-01   -8.651654927219583e-02   +3.158942076066983e-02   +4.165945163501204e-01   -4.348159461976049e-02   +6.752752965184158e-01   +2.792370801179818e-01   +2.719581699826644e-01   +2.617320753433898e-01   +6.438781739350007e-02   +4.385841849581146e-01; +1.888636813839936e-01   +2.086089055173747e-01   +6.311179759267658e-01   +6.005511115196914e-01   +6.976536128124413e-01   +8.340742089637539e-01   +4.797887808760093e-01   +5.187894270487186e-01   +1.514227182345586e-01   +2.305907322784378e-01   +3.241433258617130e-01   +2.281448352096113e-01; +5.835556009271166e-01   +3.186705880570010e-01   +5.978075835138328e-01   +6.665753764068651e-01   +2.552621285836337e-01   +6.860584268642512e-01   +4.936806242814329e-01   +3.820427145837592e-01   +2.169160425577213e-01   +2.409271463995306e-01   +5.670158444578240e-01   +1.765459187762419e-01; +1.449643929095221e-01   +6.459413287363954e-01   +6.192293033799019e-01   -1.736811607643024e-02   +3.093158901997532e-01   +4.155144949990368e-01   +2.888188463537896e-01   +4.957318399695268e-01   +2.159737306789614e-01   +7.745640234181189e-02   +3.152899693252944e-01   +3.314435645750777e-01; +4.672642408233351e-01   +3.091083809929110e-01   +4.202024289127174e-02   +9.083685184148342e-02   +5.640372564751380e-01   +4.397730524368850e-01   +5.812147809180918e-01   +3.883748865287105e-01   +2.758483593736937e-01   +2.935726691703464e-01   -6.758415846515765e-02   +1.740155282193020e-01; +7.370668250563863e-01   +4.473774620923076e-01   +2.491779790114651e-02   -3.003842753316460e-02   +6.893953680389306e-02   +9.366282800205483e-02   +3.433128469583786e-01   +4.845053865505362e-01   +6.250204101060836e-01   +5.284492307835602e-02   +2.254106338486870e-01   +2.975953450876406e-01; +5.133211414982857e-01   +3.323552244521420e-01   +2.610275167460496e-01   +1.403335143301397e-01   +4.401106496809484e-01   +1.268565259831096e-02   +4.521151893424648e-02   +1.359114420519669e-01   +4.865713208698010e-01   +1.852086030362824e-01   -8.615031860480518e-02   +3.150430156981154e-01];
L3I_L2I_iGABA_netcon = [+5.143119706083960e-01   +3.233782428322036e-02   +5.645596032862124e-01   +4.574487354170097e-01   +4.426161349187089e-01   +1.472720435978265e-01   +2.762385571333055e-01   -1.041091779896986e-01   -1.054098807955465e-01   +4.256083378319612e-01   -1.686222709483602e-01   +1.534202527232313e-01; +4.647612118931280e-01   +4.624182929801910e-01   +5.979295246679014e-01   +3.319677489576316e-01   +3.812662549924193e-01   +1.652413541866238e-01   +2.071590985011799e-01   +1.498809147809753e-02   +3.649796251643571e-01   +5.257470025087998e-01   +5.644718011264167e-01   +3.351645187456412e-01; +1.142872204740124e-01   +3.723191835299620e-01   +1.705149913683587e-01   +2.222508282886879e-01   +3.075348812791729e-01   +3.455228755475452e-02   +5.792613945354774e-01   +3.188836184659857e-01   +1.820211805395184e-01   +6.425867839536964e-01   +5.955210060017978e-01   +4.212307432713026e-01; +2.834573416288353e-01   +5.758771303515551e-01   +7.613375677069691e-01   +8.623587452369071e-02   +5.987316974367105e-01   +2.416469564050072e-01   -8.647058856630613e-03   +2.520056278081095e-01   +9.424991087353692e-02   +4.591711479240870e-02   +4.136990350449780e-01   +3.635615622396036e-01; +5.835046920057219e-01   +2.087897013192740e-01   +5.471984855860904e-01   +4.616190576687347e-01   +5.092555885351571e-01   +2.713028607587825e-01   +3.480619631755310e-01   +3.071658883139090e-01   +8.141449543244635e-02   +1.602116847924855e-01   -2.290513045672013e-02   -1.115102789866992e-01; +4.227954241825069e-01   +4.776694464930101e-01   +2.789577457231391e-01   +2.262394963660022e-01   +7.172902004719550e-01   +1.705489745556362e-01   +7.385681230885230e-02   +4.803066573807489e-01   +5.666837509743198e-01   +5.974163330139626e-01   +3.195956218574383e-01   +3.351254779926122e-01; +9.591366179222582e-02   +3.787077037131727e-01   +4.672803741333717e-01   -1.228454441107364e-01   +5.093133823835811e-01   +4.045761301104875e-01   +2.155564684169649e-01   +4.430098933016308e-01   +1.174871635564387e-01   +2.052180281310736e-01   +2.840837552006886e-01   +6.716975029891736e-01; +2.872135894442893e-01   +8.393697044479224e-02   +3.494254192955735e-01   +4.180935006137084e-01   +2.402925559388349e-01   +2.487446849193033e-01   +4.842768505063624e-01   +1.723072782990930e-01   +1.662494150958824e-02   +1.770109654780023e-01   +1.837517355857017e-01   +3.475443289394386e-01];
L2E_L3E_iAMPA_netcon = [+1.019766456102629e-01   +3.799894661404077e-01   +4.409799467860854e-01   +2.731599592695579e-01   +6.765441757804778e-01   +5.535074964965015e-01   +3.982968189933835e-01   +1.039430727933203e-01; +2.038089854159623e-01   +4.511603130070883e-01   +2.924865448441977e-01   +4.290356944352069e-02   +3.871058858927924e-01   +3.894073359988205e-01   +3.340149429757309e-01   +4.168737726834433e-01; +1.199680277897192e-01   +3.799934177455792e-01   +2.730238425326583e-01   +8.720968801797581e-01   +3.800121668981264e-01   +7.755143315292544e-01   +2.921123271470120e-02   +9.829074927998202e-02; +8.936127713752362e-02   +2.930161124453034e-01   +3.423442992294115e-01   +4.027988315229897e-01   +3.347447681971015e-01   +5.539561396826925e-01   +4.249124668606767e-01   +3.899013576127017e-01; -7.348240089698740e-03   +7.038153488950082e-02   +2.432534397572589e-01   -4.636215824068098e-02   +3.784190757548986e-01   +5.358456521769835e-01   +1.013018455199264e-01   -8.843238060033576e-02; +1.169336498510230e-01   +1.159676238830064e-01   +1.720138829896250e-01   +7.475602341448876e-01   +3.750954797386404e-01   -3.133643996162110e-02   +4.785116107212875e-01   -2.867309683827547e-02; +7.653971438735131e-02   +3.518149108873270e-03   +3.305823109275083e-01   +3.682639905039001e-02   +3.606818004734388e-01   +5.341540938353171e-01   +1.660249341259765e-01   +5.142711222709524e-01; +3.027246398575867e-01   +5.858996821396566e-01   +6.175044843118823e-01   +1.777806886117684e-01   +3.846364308755107e-01   -5.759446947022752e-02   +4.755765656949893e-01   +4.863195419952439e-01; -1.061446395759145e-01   +3.463280248400190e-01   +2.536682262626508e-01   +5.871059683317464e-01   +3.224855076478458e-01   +3.958967014670736e-01   +2.903435979417914e-01   +4.758425114260057e-01; +4.644803927274140e-01   +1.714763072549460e-01   +1.395044834037207e-01   +3.918660033910120e-01   +5.766518535638377e-01   +1.713345116748874e-01   +4.967431270838597e-01   +8.062316414854172e-02; +7.643389092187116e-01   +5.593481689996865e-01   +3.389167417139135e-01   +2.829948637651745e-01   +7.649412009583378e-02   +4.078000968727464e-01   +6.774869158862513e-01   +1.417254546826379e-01; +6.543838614637608e-01   +4.241491510734244e-01   +2.206997796785682e-01   +5.672064714607805e-01   +3.243883099411112e-01   +5.605906202065843e-01   +5.186797216204734e-01   +1.669286887185378e-01];
L2I_L3I_iGABA_netcon = [+8.124964277705733e-01   -2.223255724020164e-01   +4.336942976943677e-01   +1.093996751402393e-01   +3.706776846636863e-01   +3.471031688862464e-01   +1.890844839259406e-01   +4.861300925167449e-01; +6.609720461715829e-01   +4.832376096081763e-01   +1.802532249103461e-02   +4.993241832943605e-01   +2.436297812536413e-01   +1.594332922452426e-01   +3.835315498688469e-01   +3.763164240509643e-01; +3.274795388966611e-01   +5.104524804888806e-01   +4.910228742078948e-01   +6.250704014449330e-01   +4.444747261914889e-01   +4.931939672771625e-02   +3.748692394583113e-01   +2.207637190694273e-01; +2.819474978441032e-01   +4.245662729503075e-01   +3.439962296972653e-01   +2.725549331057669e-01   +2.289986608524001e-01   +6.401680269249976e-01   +2.846322469763489e-01   +3.833622183534385e-02; +7.794145961808350e-01   +7.358037535719004e-01   -5.700835687517009e-02   +6.884438126512741e-01   +1.387796882271218e-01   +3.447698045138766e-01   +1.375555380274932e-01   +2.195759036789482e-01; +7.627741310023783e-01   +7.061953306533668e-01   +6.645184198266335e-01   +2.048041756705429e-01   +7.064844288202912e-01   +1.196723341837775e-01   +1.560764694316370e-01   +5.866009648822068e-01; +2.135126773230130e-01   +3.368691707772626e-01   +4.219358281054736e-01   +7.610444791025794e-01   +2.747992099848479e-01   +5.490595027500718e-01   +9.411334711596785e-02   +1.344379918030144e-01; +1.558057560053864e-01   +5.400844058415539e-01   +4.874113402597020e-01   +6.073605585476929e-02   +4.516046432079739e-01   +9.385005291681128e-02   +2.381726401935839e-01   +6.934008705636212e-02; +3.329522694743355e-01   +2.820379031418392e-01   +1.926114167656011e-01   +3.905129587838386e-01   +4.242593262025231e-01   +2.134012525139833e-01   +3.678164421296303e-01   +5.364577958703654e-03; +5.757531229496404e-01   +2.245428497357263e-01   +3.205516260587200e-02   +3.894274113063910e-01   +1.090470738523188e-01   +1.999560912806990e-01   +5.138489742149479e-01   -3.455763906873951e-02; +3.607732633152216e-02   +2.089954082771096e-01   +2.878916831697272e-01   +2.762955948711411e-01   +1.878325990506835e-01   +2.524354692949017e-01   +5.844757263865023e-02   +9.277200170994013e-02; +4.950895332520954e-01   +3.908642406768181e-01   +2.011293902132846e-01   +5.554755578138967e-01   +2.900085471731675e-01   +1.549457578650799e-01   +1.368970847604103e-01   +1.101639567770221e-01];
L3I_L3E_iAMPA_netcon = [+1.668806652320558e-01   +6.841604802594026e-01   +1.857486215866795e-01   +3.824644759137269e-01   +1.039386697899952e-01   +4.644199124287834e-01   -6.585985565448493e-02   +2.904229934531143e-01   -1.484210188878196e-02   +3.545150131843290e-01   +5.170657096068906e-01   +3.508716520752586e-01; +5.812424618154750e-01   +4.560187369552152e-01   +4.452997754255388e-01   +4.245157894571463e-02   +3.558493662263703e-01   +3.360629228359611e-01   -2.933793235597652e-02   +1.041715946583630e-01   +7.724471673310459e-01   +6.881818419179861e-02   +8.368174300953701e-02   +5.138196817305085e-01; +7.244965914625903e-02   +1.084347532568904e-01   +2.572300411700421e-01   +2.117145372247488e-01   +1.569686960106511e-01   +7.705971243251044e-01   +1.001843810307752e-01   +4.245115369799719e-01   +3.498485379841423e-01   +2.707779529045729e-01   +1.793698368931868e-01   +5.283628320976416e-01; -1.883025319973864e-01   +3.415115561619860e-02   +3.335768146706886e-01   +2.869764883608152e-01   +3.319876602323023e-01   +3.893512240622980e-01   +1.700349409122479e-01   +3.941512053188619e-01   -1.062642793208712e-01   +6.249483003138535e-02   +6.698120519493803e-02   +4.132586724113341e-01; +2.076994277395436e-01   +4.665616491840402e-01   +7.342359162394865e-02   +3.492301939463973e-01   +2.218308667314842e-01   +3.358661295492510e-01   +2.244770451849056e-01   +2.850349963140367e-01   +2.534401306772606e-01   +1.621791708157374e-01   -1.721908243266258e-02   +5.114289439467318e-01; +7.672224532395050e-01   +3.644456273953073e-01   +2.640225604971785e-01   +2.154258530612909e-01   +3.473575039225242e-01   +6.557434937267799e-02   +5.396968090141440e-01   +7.038939403988543e-01   +4.118828480687053e-01   +2.956450527773921e-01   +6.125047345434391e-01   +6.482508350811850e-01; +2.388592510461683e-01   +4.101255168564085e-01   +6.589142408074247e-02   +1.454450041396231e-01   +2.681073071119228e-01   +5.647672545868751e-02   -3.586279627200897e-02   +2.037481367629645e-01   +3.314964751379254e-01   +2.739922916777623e-01   -6.990001733247754e-02   +6.593265409677092e-01; +2.055897350204449e-01   +4.923545815696523e-01   +6.033468779867817e-01   +2.062341425785204e-01   +3.957793414374666e-01   +2.381255193219597e-01   +1.868696141201989e-01   +2.122689977616162e-01   +1.818396416584606e-01   +4.591321635455797e-01   +3.446555329929364e-01   +2.912503709158663e-01; +3.011810608752831e-01   -1.485495572041481e-01   +3.252750529528572e-01   +5.633525623885267e-01   +4.319218776724710e-01   +3.283037781688565e-01   +2.285606973804780e-01   +4.767952170124845e-01   +4.148852417593655e-02   +3.248871282925678e-01   +2.970995893698166e-01   +7.178438956078140e-02; +2.546413073497638e-01   -1.159856297908429e-01   +4.149342688674768e-01   +6.175435849975357e-01   +2.424809687612953e-01   +4.650506408183979e-01   +4.312668109594739e-01   +2.816746778562633e-01   +3.996031140436699e-01   +3.153815964992250e-01   +6.546459103130140e-01   +2.693360522234778e-01; +2.579709670886574e-01   +3.106958736762836e-01   +5.330017266394064e-01   +5.198124445938186e-01   +4.294513121432761e-01   +2.662109549702874e-01   +4.634180908038188e-01   +3.669973787660513e-01   +2.785883086135113e-01   +1.866145643666646e-01   +2.808975062200824e-01   +5.314302459773063e-01; +1.170798816682512e-01   +5.515549951870762e-01   +4.632747431555691e-01   +2.574105441896157e-01   +3.582833273158608e-01   +2.761167928506456e-01   +3.417104667622894e-01   +5.221135266325413e-01   +4.323062783489097e-01   +3.052589999030897e-01   +6.165671766976426e-02   +3.560344832404664e-01];
L3E_L3I_iGABA_netcon = [+5.775829488613304e-01   +4.671980345978219e-01   +3.399396607976927e-01   +6.129167194580569e-01   +3.599496643871730e-01   +3.735979789570937e-01   +3.776177410531892e-01   +1.896904768126881e-01   -1.626366830246545e-01   +4.592388158450780e-01   +8.379662459679073e-01   +3.902454709490600e-01; +4.516557830712640e-02   +3.383141735545181e-01   +6.799172772405948e-01   +3.061472806404225e-01   +2.535761670029895e-01   +4.706855538214578e-01   +4.977400925847404e-01   +3.789470876865060e-01   +5.481606131994911e-01   +4.056626081912759e-02   +3.699429405222336e-01   +2.912698325879083e-01; +3.895285945912067e-01   +5.366466582037491e-01   +6.868370493158178e-02   -6.132818042132254e-03   +1.734619641831294e-01   +4.051980896524583e-01   +2.955029625544204e-01   +1.920755179951811e-01   +6.161644963261748e-01   +3.456374416072228e-01   +1.212397679490756e-01   +1.330242761533872e-01; +3.627608918116209e-01   -1.400009817709376e-01   +1.552110656190742e-01   +5.559227112342932e-01   +2.859104176663602e-01   +3.584301411596768e-01   +4.879061255028291e-01   +6.659697153734397e-01   +6.636325610282291e-02   +1.252151024279875e-01   +1.720246432755693e-01   +4.932101829105865e-01; +3.974664618097184e-01   +1.821908530437224e-01   +4.457739635830656e-01   +2.032839775886514e-02   +5.277340463296045e-01   -2.262087919819779e-01   +7.106252044376885e-01   +2.736706709902081e-01   +4.074264433687405e-02   -2.742388941665118e-02   +2.044210353054564e-01   +1.443552070048522e-01; +1.880588108247511e-01   +5.372098556749645e-01   +2.777082103366736e-01   +1.716669006081490e-01   +2.859051531516719e-01   +1.111247126021121e-01   +4.758974441683351e-01   +2.774231569337134e-01   +2.543295194917713e-02   +2.559623434934851e-01   +2.422433344008024e-01   +3.593447838971857e-01; +4.187815264739344e-01   +3.029655344222618e-01   +7.849147628286112e-01   +1.450416164985697e-01   +2.061843480828076e-01   +2.288860971568639e-01   +2.868019473361608e-01   +5.126286104268216e-02   +8.855543859680805e-02   +1.521897395922821e-01   +4.896231300084548e-01   +5.636407566139942e-02; +4.524468682133481e-01   +3.590041416365407e-01   +4.505273634423207e-01   +1.453217338212705e-01   +3.656889066513609e-02   +2.063824367973539e-01   +4.364231780231054e-01   +2.719119196040797e-01   +6.896277912771709e-01   +4.918757498427588e-01   +2.769409947910126e-01   -6.426290587680701e-02; +3.432440260148392e-01   +2.750948239040679e-01   +2.518322537684967e-01   +2.372661073372483e-01   +3.717762869293091e-01   +1.547868734788755e-01   +1.765953502002441e-01   +5.064914865111844e-01   +5.774532346432085e-01   +2.758490727737638e-01   +1.684602103778985e-01   +2.362540510295046e-02; +6.607985167454548e-01   +2.683273571016763e-01   -1.796434151381588e-01   +4.884359793078109e-01   +3.529996055360342e-01   +3.978557680909381e-01   +3.165798111649662e-02   +1.599471417467914e-01   +2.904801666575966e-01   +8.679217838982115e-01   +3.680546513954441e-01   +4.774012752556425e-02; +2.595415751639406e-02   +2.021613326779113e-01   +3.881569975767116e-01   +8.016645803786179e-03   +5.140512702610152e-01   +5.072361009897353e-01   +3.861631926035496e-01   +4.383162857847646e-01   +4.471233699581377e-01   +5.291296487522536e-02   +2.635962468718036e-01   -1.114334637659482e-01; +2.746713524009222e-01   +1.265979590599435e-01   +2.418745045649203e-01   +4.358996631315930e-01   +3.007885808622126e-01   +5.316606870164610e-01   -3.490893937489871e-02   +3.864949465218663e-01   -6.181820127607335e-02   +5.730367160487353e-01   +3.551259254123158e-01   +2.794721311600028e-01];
L2E_Input1_iAMPA_netcon = [+1.468464655690318e-01   +4.240241610315931e-01   +2.030703398541175e-01   +1.946524087794128e-01   +3.878975757657106e-01   +6.169394364808178e-01   +2.978278096212195e-01   +3.207947172638352e-01];
L2I_Input2_iAMPA_netcon = [+3.243730659185370e-01   +1.223286668746762e-01   +5.674321737379788e-01   +2.627580035438826e-01   -2.586446064153569e-02   +1.036029823249252e-01   +2.434063272211263e-01   +2.707492934564451e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.6*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.8*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.8*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.8*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.6*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.8*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.8*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.8*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
