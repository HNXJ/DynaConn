function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+6.273157677253093e-02   +6.239664207975033e-02   -3.986415240741015e-02   +1.239877860185066e-01   +6.083849313142782e-02   +9.314938920011957e-02   -2.559172898550454e-01   +1.949144077896548e-01   -1.807896538475439e-01   -2.733798794987505e-01   -5.035064484104575e-02   -1.137799324735974e-01   -6.280129272775506e-02   -2.671477010984346e-01   +1.558756576647644e-01   +6.912322563451018e-02; -2.923299634626067e-01   -1.706223368556790e-01   -4.250197324316483e-02   +7.559349062615120e-02   +1.847582900070906e-02   -1.741854049157732e-01   +9.749987328434030e-02   +3.162379980812659e-01   -8.781803250280720e-02   +1.856768387603267e-01   +9.807981116685757e-02   +1.527313621420080e-01   +1.028349412915194e-01   +3.049572872869079e-01   +2.220120208794543e-01   +2.697276047660360e-01; +1.871014270526925e-01   +2.748631861012359e-01   +2.485559886264828e-02   -1.098661437431818e-01   +1.985480613543755e-02   -3.156859178715909e-02   +1.886959943977583e-01   +3.716932430901240e-01   +8.541243020904055e-04   +2.547711912386777e-02   -9.960520873563959e-02   -2.225112945423652e-01   -1.500628237681668e-01   -1.178387058385529e-01   +3.329204399507639e-01   -7.715014103368487e-02; +1.982306259843447e-01   +1.404718435720276e-02   +5.276022196696786e-02   -4.252693216265622e-02   +1.825494094447291e-01   -1.668086765238018e-01   +4.784842340236781e-03   -1.547156218234693e-01   +1.390049840561074e-01   -7.774548114593735e-02   +2.227008255435630e-01   -1.731804109046956e-01   -3.088429151061692e-01   -5.845507314976130e-02   +6.166881206502527e-02   +2.151810441541529e-01; -5.365018496237816e-02   +1.891380231852916e-01   +7.730516833919232e-02   -2.064594947506258e-01   -3.993452502915522e-02   +1.288332468404480e-01   -1.059596984252361e-01   +9.789089439982580e-02   +1.517194305157114e-01   +2.901388898576255e-01   +1.890811228888959e-01   +2.522123371770115e-01   +3.384450092445380e-01   +3.683308985165304e-01   +3.010741107875636e-01   +1.599957031634860e-01; +8.851964878340243e-02   +2.132220692972688e-01   -1.375619322309797e-01   +2.148981400291881e-01   +1.867394922124259e-01   +2.010878835567934e-01   -1.496971055805735e-01   +3.328299929026054e-01   -4.164307245946902e-01   +3.296687674102611e-02   +1.508860691722667e-01   -1.231432705886178e-01   -4.608930674469060e-02   -1.514751853404917e-01   +2.377327041098467e-01   -1.543100908528547e-01; -9.433370582616146e-02   +3.300633576853759e-02   -2.139426869966453e-01   -6.051604193705519e-02   +1.962665195752147e-01   +2.873554499375742e-01   -4.580680141556705e-02   -2.257704961281832e-01   -4.790978351793980e-02   -8.866031025663586e-02   +1.942514072454942e-01   -2.466747057133972e-01   -1.549889819990636e-02   -3.156105097379260e-02   +2.361713314377176e-02   -2.179783744380884e-01; -1.922228043005910e-01   +1.774691457264695e-01   +2.284424453248988e-01   +3.468695920283861e-01   +5.380718503300494e-02   +7.957023588713105e-02   +1.405790984849138e-01   +7.086743184748806e-02   +4.788231240045553e-03   -1.215866212089250e-01   -2.248569572080648e-01   +2.356751557958575e-01   +1.951445440338156e-02   -1.945816800086841e-01   +1.221870004718816e-01   +1.756130623701346e-01; -1.150146270573035e-01   +4.340870313889728e-02   +9.870665555916334e-02   +3.011594855841682e-01   +1.705884409315576e-01   +2.295536470246075e-01   +1.364835451690526e-01   -2.820449689948218e-01   -1.751479462011937e-01   -1.667249985201218e-01   +1.153947518006245e-01   -1.200462891988670e-01   -3.731740803965782e-02   +1.611444045253748e-02   +2.158238289767738e-01   -4.119921304845281e-01; +2.286884356817205e-01   +2.531745213051415e-01   -4.154244086484089e-02   +6.142086343210150e-03   -1.972295691032960e-01   -2.607472204328556e-01   -1.879773359238968e-01   +2.193266103999663e-01   +1.706450468869003e-01   -1.151424085663038e-01   +9.944655161978821e-02   -7.766613199904629e-02   -3.946683580844032e-02   +1.786785106741432e-01   +2.303880295830125e-02   -3.690642273360981e-02; -1.167549352022775e-01   +1.036674481275944e-01   -1.993095047234932e-01   -1.168865434224108e-02   +9.774592565165220e-02   +2.084258029025229e-02   +9.023952157780182e-02   -5.406671173048567e-02   +3.771299525727381e-01   +3.699271706470433e-03   -2.745687971553906e-01   -2.211558192758107e-02   -9.289386482851943e-02   +7.195444450237806e-03   +1.486502498885005e-01   +7.684714604464299e-02; -9.064724092212280e-02   +7.518101864419224e-02   -9.832994457289362e-02   -5.736047170641946e-02   -2.743913228143855e-01   -1.422261944340658e-01   +1.293521993339416e-01   -2.605856536779695e-01   -2.820868199270892e-01   +4.350362776098939e-03   -7.971458542866222e-02   +7.160539828450078e-02   -2.721991053367726e-01   -1.140979049089589e-01   +1.278949744931484e-01   +2.720853460239600e-01; -1.558602587416201e-01   +3.574744483046451e-01   +2.557371611473079e-01   +7.102459224125883e-02   -2.881581098329426e-01   -3.739287790886144e-02   -9.211932437115403e-02   +2.462156179976321e-01   -4.747829200248717e-01   +6.375164687683496e-02   -2.139634766274441e-03   -2.193233124120752e-01   +2.678978237773466e-01   -1.417536446803968e-01   -7.740617433358309e-02   +9.727240301694376e-02; +9.596424475737128e-02   +1.488050342874797e-01   -1.354779361958994e-01   +6.007844266292671e-02   -1.929522794796212e-01   -7.940322180216272e-02   -1.943780779789967e-01   +1.382887249887935e-01   -6.913817668475486e-02   +4.945826752707400e-02   +2.637251152082196e-02   -2.168435181726767e-01   +1.977651125651567e-01   +2.267572057271999e-01   -1.130747420181813e-01   -6.108907187056418e-02; +1.567810684744328e-02   -7.995783719804844e-03   -2.131980596819368e-01   +1.563567159961081e-01   +2.168950548098994e-01   +1.770139278443587e-01   -4.415290195963378e-01   -8.558588653871431e-02   -2.055639194860807e-01   +5.089270351247678e-02   +1.858004049658464e-01   +1.856265204706776e-01   -2.822096458067717e-01   -4.522183817591059e-02   +2.753681058583506e-01   -1.000012492831075e-01; -8.274471423780791e-02   -3.079397609887823e-02   -2.334217361109899e-01   -3.157990861473377e-02   +5.339103527931784e-02   +7.478113058253083e-02   -2.167540514966916e-01   -2.455189899566015e-01   +4.522802372588910e-02   -1.263871920154927e-01   +2.315226728563645e-01   +1.802071950560503e-01   +1.228034064042468e-01   -1.334865105534342e-01   +1.773902308670339e-01   +1.130088079262347e-02];
L1E_L1I_iGABA_netcon = [+1.606206368932953e-01   -2.853020131891243e-01   +1.345371868353671e-01   +1.046928220412202e-01   +7.279552047713853e-02   +7.628534094981267e-02   -8.887207159237109e-02   +2.431427670163677e-01   -1.543646087174420e-02   +2.629523394865718e-01   -1.889885064647079e-02   -4.159969347587965e-02   -1.385864250678353e-01   +5.589733740342077e-02   +7.281594225868773e-02   +2.598539887839811e-01; -6.616887475166576e-02   +1.770159088763401e-01   +2.091148749484896e-01   +1.245138205780707e-01   +5.971103192760563e-03   -3.157746376676530e-02   +1.157130835912642e-01   +2.026159652290816e-01   +2.885565060598628e-01   -1.041502895317285e-01   +1.812361508113153e-01   +1.033204372959861e-01   -1.585213083878156e-01   +6.865954709056235e-02   -9.902620592694603e-02   +2.189641884487792e-01; +3.262482279571695e-01   +2.966874384519846e-01   -5.396644272089536e-02   -8.686203017482327e-02   -1.230069907263079e-01   +5.274649361528379e-03   -2.579734483528532e-01   +8.787957886130129e-02   -1.729304684045849e-01   -7.321851047906169e-05   -8.240915703829899e-02   -5.448265006042911e-02   +1.601642392279619e-01   -7.293583442233850e-02   -1.470496765082081e-01   +3.907087778746827e-01; -1.965537737163559e-01   +1.522867757873033e-01   -1.868061959865513e-01   +8.090624525639803e-02   -1.274889891358868e-01   +1.542077285535093e-01   -2.417529091166569e-01   -5.640269226907599e-02   -1.183018246009259e-01   -4.637908621331912e-01   -1.115679614124095e-01   +2.758885877415260e-01   -3.070045789303306e-02   +1.855062395670005e-01   -7.424644340158147e-02   -1.810067689590929e-02; +3.017937932273185e-02   -2.370931521191919e-01   +2.469063761217999e-01   +1.896660813716058e-01   +1.136104045931421e-01   +2.914093299151756e-02   -2.210545670955464e-01   +2.526510055654373e-01   +1.941523187762201e-01   +7.728986085888645e-02   -5.201067696097317e-02   +7.954249201329366e-02   +1.499961007850519e-01   +3.454839336838743e-01   +1.971557098866943e-01   +6.204400265737212e-02; -1.987628857662206e-02   -3.833375591867398e-02   +9.401449563694668e-02   +1.651317843948090e-01   +2.090097700288279e-02   -5.654920882793987e-02   -5.698292996686526e-03   +2.245714547622374e-01   +5.714846110877640e-02   +1.514378504500097e-01   +1.188636411889742e-01   +2.440194838855513e-01   +5.738073050287262e-02   -1.239794213573471e-02   -4.779333522356950e-01   +1.074472632122630e-01; +1.835357524617831e-01   +1.988395688182853e-01   +5.470775234674982e-01   +3.280092431889244e-01   -1.866240114887291e-01   +1.693623589474468e-02   +5.181317001520113e-02   -5.202340114970091e-02   +6.383375614196664e-02   -1.505659626785790e-01   +1.330703922244825e-01   -1.292976964722498e-01   -7.848416079319048e-03   -2.236337881095167e-01   -3.347577851953010e-02   +1.267681852112208e-02; -4.305610340910407e-01   -1.939936383946581e-01   +3.081095155796413e-01   +3.236557526943393e-01   +1.179493036959570e-02   -2.130836048434942e-01   +1.630439194919476e-01   -1.951854487833236e-01   +2.062133564458936e-02   +8.406726121507345e-02   -6.507121875111577e-02   -7.100406736595513e-02   -2.460815687796632e-01   +5.630051969905552e-02   +3.009621127888545e-01   -4.395873593561507e-02; +1.495113557022150e-01   -6.229083918446260e-02   +6.421608747989439e-02   -1.851085041624433e-01   +2.504829592033024e-01   +2.007950766687795e-02   +2.429302043398717e-02   +1.374033146500421e-02   -1.664224012096242e-01   +1.439654986695610e-02   -4.554819008188428e-02   +2.487805935181407e-02   +1.798651270002646e-01   -7.270170486919064e-02   +2.834938182252333e-01   +2.667786695880467e-01; -1.629221289845308e-01   -1.697185411687302e-01   -1.670928368256057e-01   -3.454095660771104e-02   +3.210705395346689e-01   +9.576823432697330e-02   +1.723641218831964e-01   -2.984293719392854e-01   +1.297619656230457e-02   -4.129547795384877e-02   -1.276432472716549e-01   +2.945526986972549e-01   -3.055249922980551e-01   +2.788233349622132e-02   +3.045387526314515e-02   -1.201918728376193e-01; +1.714992185726467e-01   +7.079640889789106e-02   +9.832725429396089e-02   +2.807910718812723e-01   -9.280334145202684e-02   -1.972614184816703e-01   -4.483790924349074e-02   +1.501218422771284e-01   -1.160754022589260e-01   +1.111994044000990e-01   +4.156005992620684e-02   +8.100778358365940e-02   -2.644949388781843e-02   -7.277813106477440e-02   -9.404221900520279e-02   +1.707218745650984e-01; +2.136489136544001e-01   -5.964222313379251e-02   -8.650391511549183e-02   +7.601576304626184e-02   +2.559128395199241e-01   +1.407978757077755e-01   +4.938650116069660e-02   +2.522301908961305e-01   +1.828504470402305e-01   -1.821325061333204e-02   +5.238319619210611e-02   -1.074728318827240e-01   -1.002868773981818e-01   +5.734732290118149e-02   -2.428127739318341e-01   +6.696193355753474e-02; +2.617849419915442e-01   -7.324079332228101e-02   +2.391435696693915e-03   +9.466065129957263e-02   -7.298013463045460e-03   +5.933250756599316e-02   -2.852298264787342e-02   -2.018480076610998e-01   -3.163874276662237e-01   -3.037711686997145e-02   -8.586575577814240e-02   +1.488999000751736e-01   +2.943917883230499e-01   +1.575544695057090e-01   +2.871934663976913e-02   +4.985157738500499e-02; +1.133070847985008e-01   +6.070252499297524e-02   -1.842982633355033e-01   +3.538122662966217e-02   +7.344174070902179e-02   -2.213561180374074e-01   -7.162233021718535e-02   +3.517111554631706e-01   +1.266325248163966e-01   +3.437899803698611e-01   -1.482970652684954e-01   +2.064805300531553e-01   -1.861864420651523e-01   -2.990721567140334e-01   +3.803008266096723e-02   -1.881111358758126e-01; -2.661561634899489e-01   +1.089501572269358e-01   +1.039521575466189e-01   +7.519765660284894e-02   +1.260857897474023e-01   +9.140546834959569e-02   +2.765481947556041e-01   -2.450343116470635e-01   +3.059428890908411e-02   -1.928427919745828e-01   -2.487271968032755e-01   -9.548906477053429e-02   +1.011084205913716e-01   +2.900387630910084e-01   +4.789261600079225e-03   +1.363438044861181e-01; -1.664982357611938e-01   +2.093669211735322e-02   -7.948483509163873e-02   -3.614165524190983e-02   -7.084266191148952e-02   -2.269682136016547e-01   -8.593420292471271e-02   +2.435784794438704e-01   +1.809648538307955e-01   +1.074477313134192e-01   +9.076552590570014e-02   -2.029265851622573e-01   -2.355797501528745e-01   -1.315648658776348e-01   +5.630492674189966e-02   -1.310819159662240e-01];
L2I_L1I_iGABA_netcon = [+2.061967193635633e-01   +2.144601731526092e-02   +1.681025275868157e-01   +2.432402068147191e-01   +5.050015626174988e-03   -9.030168034497540e-02   +3.623487172030178e-02   -4.901081440316417e-02; -1.306334722285147e-01   +1.217099479694123e-01   -1.082837836605114e-01   +1.024927711933664e-01   +2.901406896620887e-01   +3.901417790836006e-01   -3.179000911991369e-02   +1.298778964682213e-01; -1.656173259391106e-01   +1.970088760988866e-01   +1.003289703068082e-01   -1.345809800861791e-01   -1.163212400535562e-01   +5.031356088093757e-01   -3.881208164941490e-01   -1.486266791922680e-02; +3.680743891353798e-02   +4.039757570491977e-02   -1.223086701220506e-01   -2.418398975125292e-02   +7.639448798989763e-03   -3.419242140987382e-01   -4.814062287436858e-02   -1.007925525184277e-01; -3.442794218830484e-02   +8.786605915206595e-02   +3.720330211368020e-02   -8.311385134720073e-03   -9.451930671204956e-02   -1.894856420231060e-01   +1.191011060012108e-01   +3.792126564183523e-02; +2.042418845583660e-01   -2.664234612398595e-01   -1.242251048989061e-01   +1.739112539592260e-01   +3.506760445063314e-01   -9.357557252964951e-02   -6.693198101225652e-02   +3.001082180825888e-03; -6.136107405112660e-02   -4.375664674736401e-02   -8.346045603473348e-02   -3.312788981661169e-01   -1.987175939307820e-01   +1.604019370173844e-01   +1.704989331691611e-02   +5.292988673293041e-02; -2.099734045276264e-01   -8.078855322446579e-02   +4.610494535750490e-02   +8.196495074254662e-02   -9.677687092779069e-02   +4.191422246199364e-02   -3.585314602741195e-02   -1.578940221188476e-01; -1.080233667678625e-01   -5.746521639142232e-02   +1.927249738711545e-01   -2.484103310678203e-02   +2.118236919869288e-01   -9.812384221933587e-02   +8.485834191848569e-02   +2.211173634019959e-01; -8.445410763438925e-02   -7.363971102611076e-02   -1.461723450752788e-01   -3.620254345983063e-01   +1.310705619186550e-01   -4.239136857251236e-02   -3.763960965579878e-01   -1.976826636745008e-01; -2.347003193029983e-01   -1.481264170973058e-01   -2.340777695408308e-02   +1.318230175701386e-01   +2.427276192024209e-01   -1.326893999634317e-01   -1.985202153384448e-01   -1.034833609905496e-01; +1.533848694927793e-01   +5.664915449148354e-02   -8.517493788277918e-02   -1.039928080652954e-01   +4.905472778513893e-02   +7.146695386044452e-02   -2.067002296956213e-01   -3.986609643556496e-01; -2.423372598636466e-01   +1.085779175752184e-01   +2.162245616004316e-01   +1.669034474177971e-01   -1.977943738844050e-01   +8.322028218620320e-02   -1.749928551658076e-01   +2.466718648279791e-01; +3.030159924207749e-01   +2.486776654192400e-01   +1.880176698930164e-02   -5.657800270968564e-02   -2.838742873246693e-01   -3.173032694425023e-01   -1.216951043367933e-01   +1.824259057139472e-01; +1.096456584384824e-01   -2.905877977148216e-01   +3.916789805443517e-01   +4.481837031007735e-02   +1.819615670187032e-01   +1.662292507444450e-01   +3.031717770603203e-01   +2.328310852945798e-01; -3.973880340724275e-01   -5.779428736543357e-02   -1.946749558735074e-01   -1.855119409403121e-01   -2.005645115914955e-02   +2.134669372591615e-01   +3.682089676024939e-01   -1.213198857213134e-01];
L1I_L2I_iGABA_netcon = [-6.695830698516361e-02   +7.912681114708327e-03   -4.444201459998531e-02   +1.605304548191032e-01   +7.469063893603162e-02   -1.269937859835066e-01   +3.719123288032732e-01   -2.662371688271736e-02   +1.003333604120082e-01   +2.729079114632523e-01   +5.487699509199261e-02   -2.132702245230728e-01   +9.709739734187754e-02   +5.961122591669005e-02   -2.722425493782300e-01   +1.724866488938821e-01; +7.267480407901680e-02   +4.255864864732428e-02   -2.852505503461994e-01   +3.899479226473025e-02   +1.028829818742513e-02   -3.165785536059162e-01   +8.530474490327677e-02   +1.604177475021475e-01   +1.552061701652638e-01   -2.077492790381255e-01   -2.327011060128143e-01   -1.075117124045559e-01   -1.375115359418827e-01   +1.907899347646302e-01   -3.522583416863918e-02   +3.070324101299033e-02; -2.458730312044665e-01   +3.338812229456379e-01   +1.019603584192099e-01   +9.975988417431179e-02   -2.317520925344894e-03   +2.786550951507252e-01   -1.275891672508618e-01   +1.841844239680533e-01   +1.304497763097618e-01   -7.034720140740022e-02   -1.270140184752502e-01   -9.777430327410023e-03   -1.402912985498008e-01   -2.902083176144606e-01   -8.140897768061212e-02   -1.734030085330436e-01; -1.618701882118221e-01   -1.590594235553290e-02   +1.591102296336818e-01   +3.997873144022589e-02   +5.165836650316958e-02   +1.045526043173824e-01   -1.393366682270517e-01   -7.315910356547253e-02   +3.522201808608350e-02   +1.424895830229961e-01   -3.587228934531390e-01   +1.276615075459393e-02   -1.176547533678563e-01   +2.495889857502127e-01   -1.340003657083637e-01   -3.304653836959979e-01; -1.473358478667969e-01   -1.764356208203886e-01   +5.561573028418701e-02   +1.987781801462647e-01   -1.312879095106576e-01   -3.845726117764745e-02   -4.037358698446006e-01   -9.051391270258309e-02   -4.670510077667654e-02   -3.521248237267738e-01   -3.672369891658391e-02   -2.234482372419112e-01   -6.501526193052161e-02   -5.117027708357276e-02   +3.178933624025231e-01   -1.187688304122291e-01; -2.094255818909193e-01   -3.242202910226853e-02   +1.325365273608979e-02   +2.507984633687166e-01   +2.160073909447648e-01   -2.456618316410636e-01   +1.080402110041835e-01   +1.286046054186703e-01   +2.350542511996369e-01   -1.068593089451353e-01   +3.648894952641089e-01   +6.447764074234721e-02   +1.512024501162661e-01   +9.344300222221144e-03   +3.609094329546857e-02   -8.857577524145760e-02; +9.200374342931990e-02   +2.634900724452759e-01   -5.913707430912189e-03   +9.184359894163086e-02   +1.346543099788626e-01   +1.078591408043430e-01   +6.668897960109782e-02   -1.196491249790682e-01   +3.232043497947552e-01   +2.553383124631728e-01   +3.400078079792482e-01   -2.761747693609206e-02   +1.755205461806381e-01   +1.814900361534276e-01   +9.371314846690529e-02   +2.733182363591363e-01; -1.703124273003653e-01   -9.425706216405930e-02   +2.321147683186974e-01   +1.977150670254061e-01   +2.414188843841221e-01   -7.080277927332852e-02   +3.408607441359131e-01   -5.437502929705527e-02   -1.227786035528824e-01   +8.054761168950461e-02   -7.193640862903425e-02   +2.229012453234034e-01   -1.594353746560972e-01   +3.463175464486056e-01   -3.379845029903916e-02   -2.463533937182112e-01];
L2E_L1E_iAMPA_netcon = [-8.435704017627921e-02   -1.386338676187907e-01   -3.084046309283007e-01   -3.293339556267050e-01   -3.291293169090401e-02   +2.444598711849853e-01   -3.675248252406568e-01   +3.172732056903609e-01; -1.362207703141076e-01   +4.299002578066421e-02   +2.866395162952787e-01   -1.814318463749310e-02   +2.715627376967744e-01   -2.150771673994487e-01   -1.020059329719765e-01   -2.168077873920483e-01; -2.677754896846845e-02   -3.251772606010650e-02   +5.900022645799001e-02   +6.625991556228655e-02   -3.779305375759071e-01   +2.152847384736535e-01   +3.300801031617561e-01   -2.222054348297463e-01; -1.359347524067280e-01   +3.399283443315250e-02   +2.994241998090552e-02   -3.243552312650498e-01   -5.427038055103688e-04   +1.047530589037400e-01   -1.011018086181392e-01   -1.252867039825458e-01; +2.649569477635126e-01   -2.014126204745922e-01   -2.462135678044610e-02   +7.579688405878954e-02   -5.178013835303048e-04   -2.373901055166133e-01   -1.214916860453850e-01   +5.382838048986713e-02; -3.162174710077091e-04   -1.612691041326489e-01   -1.417454973358854e-01   +7.810843837628660e-03   -6.359277981785844e-02   -1.696484888663110e-01   -2.243449718146297e-01   +1.326577455445621e-01; +1.967839888008219e-01   +1.381665018000998e-01   -2.222756881349962e-01   +1.228754676713509e-01   +2.239912450201021e-02   +4.753451889088964e-02   -2.019707405361858e-02   +2.347098067718414e-01; -4.131452219641165e-02   +7.453811299744179e-03   +9.497581604232928e-02   +8.195610617474130e-03   +1.202581873495948e-01   +1.496406293925992e-01   -2.121657985984152e-01   -1.571087095031415e-01; +2.965933378782107e-01   -3.165007496385924e-02   +3.771750891541462e-01   +8.772057162313804e-02   -5.505870021169992e-02   -1.328870541972056e-01   -1.563406432929904e-02   -2.623886146085726e-01; +2.678030721075772e-02   -1.824991113413944e-01   +8.585751253171625e-02   +2.036590426736501e-01   +1.151734271754465e-01   +1.549414439568121e-01   -1.390222970127840e-01   -1.421365104402098e-01; -1.318774621147262e-02   +2.180566539692966e-01   -6.226969891927806e-02   -4.293201779091612e-01   -1.403400904111924e-02   +1.321267290434939e-01   +1.074178827064359e-01   +7.365221523502211e-02; -4.510530360511873e-02   +6.218980083270892e-02   -1.442885817248560e-01   -6.824195778713654e-03   -1.921363955075251e-01   +1.484057859656571e-01   +8.601905397139618e-02   -1.978730581224378e-02; +2.916817873449163e-01   +1.089179768800763e-01   +3.814378316064453e-01   +8.383251397154772e-03   -1.244027574440958e-01   +1.566824982022631e-01   +7.908720500842259e-02   -2.528405066332511e-01; -1.846871294331031e-01   -1.233531405785223e-01   -6.964725151621708e-02   -1.036384346940567e-01   -2.310159341015591e-01   +1.918344002660493e-01   -1.382543639349754e-01   -6.548640387435982e-02; -2.665797135075824e-01   +2.400780343588713e-01   +5.886313614292493e-02   +1.591805557815145e-01   +8.602068143423094e-02   +1.375444365428163e-01   -2.105809635225190e-01   -1.603394451273723e-01; -5.165650400155314e-02   -9.460867631470837e-02   +2.002196302448832e-01   -1.555040988907092e-01   -1.811106314179393e-01   +3.013738346224253e-02   +2.256020850086821e-01   +6.055664183257249e-02];
L1E_L2E_iAMPA_netcon = [-6.740357428980707e-02   -1.078132701005002e-01   -7.473132230325330e-02   +2.220227315728750e-01   -3.524054688864478e-03   -5.288125579765876e-02   +6.619656862250080e-03   +1.153602341046884e-01   -9.962944920405060e-02   -2.090552149721711e-01   +1.511929852118206e-01   +1.278303798608427e-01   +2.969434222915446e-01   -2.071114280922733e-01   +1.849902413983945e-01   -1.109647785335428e-01; -4.751267553220532e-02   +1.822785717445746e-01   +2.897655134634722e-01   -1.870145837039703e-01   -2.064140445178036e-01   +1.469814336065274e-01   -1.308356428105389e-02   -3.405128507302221e-01   -5.784189911041013e-02   +2.582214881162826e-01   -2.998987929350471e-01   -5.720737896044013e-02   +3.953704152232337e-01   -2.696055433700854e-01   +9.883140004457333e-02   +6.558786417493034e-02; -1.858091193429435e-01   +2.961148217549421e-02   -6.322273085837497e-02   +1.145047497183524e-01   -1.054013724282340e-01   +1.777746418936696e-01   -2.072179399752792e-01   +5.514594929187028e-02   -3.745423417670124e-02   -1.309586460073431e-01   -4.765199866536012e-02   +1.320713374538210e-01   -1.028572706700475e-01   -2.668728115746871e-01   -5.597196321298234e-02   -9.457470645084740e-02; -8.318308522781247e-02   +8.592266925203852e-02   +4.109317556775287e-01   -1.751473764028194e-01   +9.519108690625901e-02   +8.838492644028254e-03   +8.816925336330655e-02   +2.426542422148655e-02   -1.572449635884852e-01   -1.284107293813622e-01   -1.617622623107958e-01   -1.728742435279404e-02   -1.104673207597366e-01   -1.663355217541400e-01   -6.984311852485503e-02   -2.369358196979947e-01; -2.451347473044962e-01   +3.048505983611261e-01   +3.322678545801222e-01   -2.261635048069249e-01   -1.286965205815635e-01   -9.948482484236111e-02   -6.679843510334524e-02   +1.303164785621097e-01   +3.183672525779495e-02   -3.457238168842616e-02   -6.217521963081144e-02   +2.243637510751907e-01   -1.602887169924265e-02   +5.615840516258117e-03   +1.777385129270376e-01   +2.774749257286389e-01; +1.116304214413248e-01   +7.384655871381468e-02   +2.838820476884590e-02   -1.701860043959602e-01   +1.820436454741316e-01   +1.389135161405846e-02   +2.467404729056862e-01   -3.038307693223296e-01   -4.766889764465850e-02   +1.387849443788575e-01   +9.980913951204706e-04   -3.824272824867775e-03   +1.135070064741767e-01   -2.206885693699171e-01   -1.768284910580339e-02   -2.920648602835753e-01; +7.976073809657537e-02   +4.453333039965986e-02   +1.466371974239837e-01   -1.816859417614597e-01   +5.945660734081148e-02   +1.823971252878009e-01   +1.730749548513997e-01   -5.327796771406462e-02   +3.703880918447527e-02   +1.177396200615613e-01   +3.894125060354228e-02   +1.985206127740300e-01   -1.323466186732018e-01   -9.424303482797736e-03   +3.067737239853446e-02   -1.019935121210520e-01; +6.768226037621791e-02   +1.403760874083299e-01   -3.019857863723860e-02   -1.017938832780334e-01   +2.679464286747886e-02   -2.065940518146023e-01   -2.089447280051445e-01   -1.908510095863554e-01   -3.484473286725622e-03   +1.731287988188735e-02   +2.053729805248811e-01   -1.668202484919271e-01   -2.097929081564270e-01   +1.367995639343736e-02   +2.575437326849117e-01   +1.894815654373037e-01];
L2I_L2E_iAMPA_netcon = [+7.837519144931993e-02   -6.611446953639040e-02   +1.228336767089094e-01   -9.766485405163203e-02   +6.631297830965764e-02   +3.235653028066304e-02   -1.608815090617389e-01   -1.273642667473519e-01; +6.951596096900127e-02   +2.262759053532024e-01   +2.331136626285842e-01   -2.019261014354518e-01   +7.598265737721265e-02   +2.317358164757213e-01   +2.027411520054705e-01   -2.996442898037643e-01; -1.622044666902071e-01   -1.733855426490472e-02   -2.819331319029315e-01   -6.182328864924251e-02   -3.351660005460916e-03   -5.531344704703794e-02   -2.311389770068228e-01   +1.243538907652227e-01; +2.573988763374738e-01   +4.416683767103713e-02   -8.422157602516769e-02   +1.280074138409920e-01   +2.350571430463973e-02   +1.570939744301012e-01   +2.431638510989796e-01   -7.724854810176759e-02; +3.071527666166346e-01   +2.098532949205286e-01   -7.370449237003994e-02   +3.486660616863978e-01   +9.761001431829372e-02   -1.334801165469725e-01   -2.426096610996016e-01   -7.952357720893807e-02; +1.248264661397820e-01   +4.401453019650991e-02   +1.969090414148047e-01   +9.899510481661990e-02   +3.907367293341524e-02   -1.511693329696314e-01   +7.527373857334876e-02   +5.846815517740649e-04; +2.418612928664779e-01   -1.146395061822521e-01   -1.551944713131060e-01   -1.116176410427218e-02   -1.546555032621682e-01   -3.683298441053560e-01   +5.773768362902861e-02   -1.589860275959236e-01; +1.354408011980486e-01   -1.025737959868113e-01   -1.287723004844425e-02   +3.196885281640703e-01   -1.840344315730681e-01   -6.381795071914477e-04   +2.963277896540310e-01   -3.657814922792929e-01];
L2E_L2I_iGABA_netcon = [-2.038581814782831e-01   -7.937260176356895e-02   +3.503501941934545e-02   -1.128639330547627e-01   -4.506007872804831e-02   +6.312819379957452e-02   +3.840139904510024e-01   -2.554827321551625e-01; +2.735065059062648e-01   +4.873485657491274e-02   +1.161243726782134e-01   +3.278476325135026e-02   +8.028622103003012e-03   -5.250169937357439e-02   +1.757312250838585e-01   -8.619499639964918e-02; -1.941128769304508e-02   +6.238895016845630e-03   +7.151696024293216e-02   +1.340072593059763e-01   +1.143676780418900e-01   +2.400647462586140e-01   +2.776492079913945e-02   -2.939927301832151e-02; +3.592448923094790e-01   -1.002687089955664e-01   -3.416842569060487e-02   +8.592895281782550e-02   +3.580848044901757e-01   -1.517608133114485e-01   -6.459203513315011e-02   +6.714915052620063e-02; +3.447466059813715e-01   +1.256314912078096e-01   -2.288305581846552e-01   +2.722629539605840e-01   -2.048999689362916e-01   -1.370573903756072e-01   +2.184391134332516e-01   +5.708907693781840e-02; -5.864136725262088e-02   -5.077969746218439e-02   -1.309609700937704e-01   -1.966582587618389e-02   +1.482291340491235e-02   -3.096640097407864e-02   -1.160013268420435e-01   -3.545167596958154e-02; -4.468445640215129e-02   -1.103162897453756e-01   +4.404784720844732e-01   +1.414780778767728e-01   -3.214912179393298e-01   +5.050021708796833e-02   -1.185398386787106e-01   +9.520196577386443e-02; +9.111953338760032e-02   +3.343263375581731e-03   +1.205053157932336e-01   -7.757487752085404e-02   -5.965848496544920e-02   -7.576176351333740e-02   +7.029745263179313e-02   +3.775527070011123e-01];
L3E_L2E_iAMPA_netcon = [-2.943812900212361e-01   -8.392111196188058e-02   +1.075243777431790e-01   -2.177990247754468e-01   -7.546642300632750e-02   -7.752987136519603e-02   +4.075497706539755e-02   +2.645582659194096e-01   +3.397920841345418e-02   +3.215025495168143e-01   +8.176511359912486e-02   +4.895661727455032e-02; -1.698644275187716e-01   -1.663619637504308e-01   +3.686561266967563e-01   -9.960121700725971e-02   -1.758922948974355e-01   -8.721058579392352e-02   -2.928539161359686e-01   +1.608512264538632e-01   -4.457119662795803e-02   -1.008370612494832e-01   +3.817345986908796e-02   +1.055563997843507e-01; -2.239797545303353e-01   -1.907619316963423e-01   +3.339764042752999e-01   +8.886667976579911e-02   -1.509336602810654e-01   -2.232496614922773e-01   +9.698118569099924e-02   +1.436546469392113e-01   +3.946432233540390e-02   +5.564604333851210e-02   -1.218908140815135e-02   +5.909990907866514e-02; +9.994643787197964e-03   -1.037095108363439e-01   -2.321706135087323e-02   +3.767373350299739e-02   -5.099619596953289e-02   +8.946765008513327e-02   +1.080868055553497e-01   +6.551069807533524e-02   -3.744692654147942e-01   -1.184756136999415e-01   -3.617691728679894e-01   +1.205299158411103e-01; +8.369963373621250e-02   -1.957242746176206e-02   -1.713290183824338e-01   +6.581871263878700e-02   -1.783461995586726e-01   +6.324152851240254e-02   -1.225765344517262e-03   +9.421306477524240e-02   -2.147405843511393e-01   -2.103874033277097e-02   +4.124911730991126e-02   -1.626003707595368e-01; -3.127761259234330e-01   +1.105236066785499e-01   +2.170047523712444e-02   -2.204320420674257e-01   +2.995637053220328e-01   +3.247792403059512e-01   +2.611929524281814e-01   -1.717893952467615e-03   +1.263605602906238e-01   -2.590656740795720e-01   +1.596781782506775e-01   -1.633908316612696e-01; -1.886035058170972e-01   -1.867618278246878e-01   +1.073485283762908e-01   +5.149781520114298e-02   +6.170791600236761e-03   -5.548534868716800e-02   -1.437987031614965e-01   +1.192910813114401e-01   +4.253649386692428e-01   -1.896595705151043e-02   -1.513727248809283e-01   -1.027922483895522e-01; +1.785884788452010e-02   +2.362379987197954e-01   +1.628998298937388e-01   -2.047984869465760e-01   -1.569158999135919e-01   -5.411388534483730e-02   -3.253046522009072e-01   -1.348712683704034e-01   +7.027272977339553e-02   +1.101559503027655e-02   -1.687376231710913e-01   +1.348409077119771e-01];
L3I_L2I_iGABA_netcon = [-1.455249155665047e-01   +2.994933143653096e-01   -7.770191246248243e-02   +9.568708900827803e-02   +1.064842334211347e-01   -1.435452417338718e-01   -1.448648176678411e-02   +1.279563441896653e-01   -3.137597029647835e-01   +8.868172267364482e-02   -1.565756569792119e-01   +6.122092959481870e-02; -1.583593759132004e-01   -4.718104532066927e-02   +2.899791937623771e-01   +2.163721959234357e-01   +1.066488934511987e-01   -1.170018123687907e-01   +2.212537732107226e-01   -5.374624757833357e-02   +1.318664253256797e-01   -6.485502036131451e-02   +2.231861730069386e-01   -9.577911779854149e-02; +1.877768738534020e-01   -1.058018040811163e-01   -1.560335828689550e-01   -2.181995897434422e-01   -1.944410748210466e-01   -1.393447380870277e-01   +5.351126502035133e-02   +2.060774943319394e-01   -2.473988257856889e-01   -2.694697871200909e-01   -4.150544266682930e-01   +1.033588879145215e-01; +2.969392477313522e-01   -9.645973269799030e-02   -3.524956078284738e-02   -2.783349129883936e-01   +1.868444631792657e-01   -3.245637636542043e-02   -1.539559689835230e-01   +1.479966905599585e-01   +2.170563314455057e-01   -1.333377551088893e-01   +2.155962674054696e-01   +1.564302910054980e-01; +2.881509165411625e-01   -1.896709098404347e-02   -1.391978141931122e-01   -2.867968853768627e-02   +5.947225285271678e-02   +1.314961657129013e-01   +1.673708088900089e-01   -3.496719415946189e-01   -2.219634873723714e-01   -7.690694073609669e-02   +3.277449486298978e-01   +1.187475759058781e-01; -1.058768917384226e-01   +3.132549071453661e-01   +1.757203830142317e-01   -1.384880983162182e-01   +2.224026880055437e-01   +1.926986867613143e-01   -4.444955831439988e-01   -1.292828274893549e-01   -2.849393497935222e-01   -7.340210668290320e-02   -1.059686193529171e-01   -1.466339536696372e-01; +2.261786441915614e-01   +2.269461477750285e-01   +2.575479956868955e-01   -2.982929690171229e-01   -1.188663529602949e-01   +2.059795043697267e-01   +1.607316173592703e-02   -9.488608511964822e-02   -9.492567002300083e-02   -1.770583874337113e-01   +2.475333069271166e-01   +3.250216718416879e-01; +3.867170758007961e-01   +1.387412153387156e-01   -8.436963073173519e-02   +5.221173040614348e-03   -9.631384309660664e-02   -4.713173176396774e-02   +2.845914501440115e-01   -6.282174310837406e-02   -1.703569433864941e-01   -5.765002530654162e-02   +1.721657438644092e-01   -1.461864985717008e-01];
L2E_L3E_iAMPA_netcon = [-9.560026712302028e-02   +6.936818902724383e-02   -1.072343593262854e-01   +4.749366820300404e-01   +1.226031611373501e-01   +3.232227089216644e-01   +6.196246573301773e-03   -1.492072092877547e-01; +6.599400718056291e-02   -9.204610357839343e-03   +2.559129303856630e-01   -2.748589988409662e-01   +1.533763290539707e-01   -1.573357458722006e-02   -2.295297201741047e-01   -5.570635250516216e-02; -1.198700525802118e-01   +5.878217435309917e-02   -1.728714070856928e-01   -1.788245177531666e-01   +2.150951186994007e-01   -2.552519686294574e-02   -1.176472219367157e-01   -1.634236875355692e-01; -4.601335974745183e-02   +2.799470732919004e-02   +2.063333122540946e-02   +1.509435485476851e-01   -1.000434068235334e-01   +1.244838617661200e-01   +3.534079904712106e-03   -2.146093608081726e-02; -8.340234145105320e-02   -1.039016030553053e-01   -2.069972808145102e-01   -2.412548118645919e-01   -1.404754163428834e-01   -1.180148638571685e-02   +6.967428841656662e-02   +1.374765293177832e-01; -9.644232467624134e-02   -2.513421235364865e-01   +1.241732845439250e-01   +1.454994690231814e-01   +2.381251026509304e-01   -1.224597461755869e-01   -1.247257461630731e-01   -3.495175042119335e-03; +2.512590415892239e-02   -1.537671776565816e-01   +5.446444924251184e-02   -2.046388385399641e-02   +1.991878351354088e-01   -2.694148518297780e-01   -1.590500596475724e-01   -1.137017521783932e-01; -9.011027929245860e-02   +4.302298536174708e-01   -4.205128744694579e-03   +1.447817508341136e-01   +4.652372782936209e-02   +3.403065949334704e-02   -2.302462894519323e-01   -2.996498869651516e-01; +1.291259866811047e-01   -2.666106823696304e-02   +1.132193129352557e-03   -8.686943784292912e-02   +1.047790439311856e-01   -7.936646821515350e-02   -3.028857638786580e-01   -2.408965820123762e-01; -1.051553488420373e-02   +1.372508304829446e-02   +3.256488308789017e-03   +1.947713642250021e-01   -1.780935026194002e-01   +1.404235717827549e-01   -1.486449053144222e-01   +3.823775954851196e-01; +2.006960700783153e-01   -1.582064102911618e-01   -1.422034214180450e-01   -1.556381752672869e-01   -7.434476444589774e-02   -4.560631624486391e-02   +3.377840563835135e-01   -1.041771692068853e-01; -7.778110917906775e-02   +2.725625221899317e-02   -1.864901939131303e-01   +2.411373974084388e-01   +2.030858736886768e-01   -2.982930812652674e-01   +1.830358761081050e-01   -2.753399821205218e-01];
L2I_L3I_iGABA_netcon = [+1.302503407876001e-01   -9.864551006620428e-02   -3.258548514761175e-01   -1.312355710016762e-01   -1.946341685418882e-01   -2.444150392784542e-01   -6.725158042239165e-03   -2.780785018861336e-02; +3.722602961931267e-01   -1.359578460590557e-01   -2.830692120395760e-01   -4.353274660497281e-01   +1.151123152601671e-01   -5.709652120324246e-02   +3.781944290282502e-01   +7.714793013668847e-02; -1.106414946556793e-01   +2.876237610883545e-01   +2.415441547906808e-01   +4.490530171317408e-01   -1.622105596498730e-01   -1.633548754816814e-01   -9.014582065660322e-02   -8.740197368706659e-02; -1.386142053800641e-01   -3.393649607239144e-02   -4.752453998340976e-02   +3.567351391972531e-02   -1.912269361379181e-01   +2.226337747245072e-01   +1.322558637364026e-01   -6.716450470182954e-02; +9.371913283739856e-02   +5.301841592401495e-02   -5.678368890879863e-02   +1.681064280214443e-02   -6.029703384053349e-02   -7.316323663842039e-02   -1.831836459893771e-01   +4.203925015141311e-01; +1.208990341375326e-01   -2.975745870653324e-01   -3.150725138485155e-02   +1.151052392751597e-01   -2.813264958931496e-01   +2.309365806447449e-01   +3.082025788032547e-01   -2.668175912191385e-01; -1.050885349977052e-01   -1.157116794901878e-01   +2.892498844035821e-02   +1.316182973184101e-01   -1.558345130798245e-01   +1.922204339521235e-01   +1.958211668359393e-01   -2.670166302825152e-01; -2.025344200237097e-01   +1.214495416617585e-01   -2.788979300225689e-01   +1.484123958783420e-01   -8.329264773874036e-02   -2.102716996372690e-01   -1.552409779761614e-01   -1.357726171724228e-01; -1.805924338542013e-01   +1.407247197681457e-01   +4.127099272736773e-02   -1.764994548853557e-01   -1.757137358530772e-01   +2.832589687730990e-01   +7.288891280824449e-02   -2.343002239631808e-01; -3.106928132003339e-02   +1.489171256668647e-01   -1.468492570887773e-01   -1.546825455775528e-02   -1.706573310231658e-02   +1.911938842916160e-02   -1.601695438334226e-01   -1.962771532908375e-01; +3.020089145800244e-01   +1.350411962176089e-01   +4.103641450518135e-02   +1.381204898101661e-01   -2.035927042932433e-01   +1.795527246909497e-01   +1.216074823698741e-01   +1.079743976077390e-01; -1.098707787834223e-02   -3.879823401339496e-02   +9.212700767992738e-02   +3.376221676312433e-02   -9.468346090692477e-02   +2.702786864801147e-01   -1.766948667643769e-01   +1.499131266943257e-01];
L3I_L3E_iAMPA_netcon = [+4.049788664583689e-01   -1.217309172397623e-01   -6.385151135623543e-02   +1.121921292634394e-02   +2.295954889043039e-01   +4.221067957231421e-03   +2.873348140350417e-01   +1.232098553105218e-01   +2.100585744713356e-02   +2.830750113789299e-02   +3.385857468370957e-02   -7.021035223074085e-02; +2.515950544917192e-01   -4.330797975392358e-02   +2.312867891389699e-02   -1.173414545800111e-01   -2.457230325501248e-01   -1.186581391890713e-01   +2.235611413283634e-01   +3.964831379261560e-01   -2.012627538490222e-01   -5.841851302507903e-04   -8.913499934479935e-02   +1.672523142667357e-01; -6.117229000420742e-02   -1.946158573326916e-01   +2.260863412368558e-01   +4.485837854104915e-02   +5.154146516659387e-02   -1.451950264977588e-02   +1.285630170817846e-01   -1.493961486129389e-02   -2.333729783315797e-01   +5.887092888447618e-02   -3.751374838549398e-02   +1.370606786284101e-01; +5.361565023686660e-02   +6.650802067488647e-02   -1.387040202339669e-01   +2.848199398049499e-02   +3.296825565359446e-01   -9.682246382899712e-02   +2.148364970362175e-01   +1.885782210105219e-01   +1.164735959631030e-01   -3.751376983238323e-02   +2.681592463854499e-01   +2.296633243063889e-01; -9.387504764631319e-02   -8.871426208943685e-02   -1.936839527661767e-01   +2.675296624245077e-01   +9.954349030472159e-02   +6.780761013858665e-02   +2.557379683360496e-01   +1.694442424719458e-01   +5.572694603275916e-02   +4.980117964201784e-02   -4.808289815869983e-01   +1.853940288333279e-01; -2.622488889530698e-02   -1.459298089388800e-01   +3.844415759351991e-01   +2.734054512967657e-01   -1.325515602305519e-01   +7.277190782372908e-02   -1.622871050495430e-01   -1.456100107452154e-02   -2.001767872592270e-01   +1.112171733650455e-01   -2.530048817868102e-01   -2.106547434352719e-01; +1.230250224347842e-01   +1.080512919845992e-01   -9.180146970626318e-02   +5.400196489936877e-02   +1.062945373336395e-01   -1.102446209777540e-01   -1.722074059239020e-01   +1.540128981277066e-01   -1.430065422796975e-01   +1.787996934848047e-01   -9.870073541735659e-02   -8.621502279548010e-02; +2.519366285734193e-01   -2.965032955909595e-01   +8.527413691466479e-04   -4.589864392333812e-02   +8.483439890714391e-02   +3.491123903542994e-01   -2.501370982368583e-01   +1.348807260634483e-01   +1.441049037772838e-01   +1.637043375634628e-01   +1.647855878632264e-01   +5.891858839721860e-02; +1.833701107406813e-01   +1.714294202931932e-01   -7.683132955043992e-02   +4.777611832977471e-03   +9.725569035309647e-02   -3.044382924167817e-02   +8.802573227486611e-02   +4.077736676572849e-02   -2.430596949112706e-01   +3.720711498241080e-02   +3.009550752952167e-01   -4.182106708535104e-02; +5.514502399051408e-02   -1.926058734331962e-01   -1.087867742572202e-01   -1.712165956987912e-01   +2.087294145839903e-01   +1.442192211502056e-01   +2.652638679334617e-01   -2.977271534735902e-01   +6.420627866929263e-02   +1.759530080188006e-02   -2.621364279616524e-02   +2.861558866410646e-01; +8.899957350593762e-02   -4.981782009546742e-02   -1.365560357318452e-01   -2.348708988612417e-01   -2.171067501451137e-01   -2.530280427974658e-01   -2.270212833063096e-01   -2.039970324615029e-01   +8.129901558290320e-02   +2.447731999415112e-02   +1.068000220211169e-01   +3.241039350673501e-01; -1.027132655755416e-02   -2.382516757025492e-01   -1.248406845465856e-02   -1.361068422410653e-01   -2.306281631681039e-01   +4.803408130989330e-02   +1.494297995837149e-01   -2.445417482225286e-01   -1.088523392694211e-01   +2.090854970279386e-02   -2.851389898320522e-01   +1.402951611973690e-01];
L3E_L3I_iGABA_netcon = [+1.176364113067074e-01   -5.621185046404255e-02   -1.200535894008801e-01   -1.590656353141212e-01   +3.258946948538039e-01   -2.025853606024135e-02   +1.950242013297375e-01   +1.542274063195777e-01   +2.593865723503546e-01   +4.010294986008304e-01   +1.781149572363797e-01   +2.728303585282906e-01; +1.131799367503028e-01   -3.295946338502452e-01   +1.102930497143006e-01   +1.295549949681027e-01   +9.182049719794554e-02   -4.792441697714710e-01   +3.303215618723354e-01   +1.480141619735303e-01   -2.203948500133146e-01   +4.673702819472585e-02   +2.313111777347759e-01   -1.609237913758479e-01; +9.960312656893278e-02   -1.055720413252821e-01   -2.998231185302070e-01   -1.681721588802668e-01   -7.684351678080835e-02   -1.705718183301206e-01   -3.107909312752805e-01   -4.924759083463544e-02   -4.797227876867988e-02   +3.333725513484584e-01   -7.786635479494000e-03   -2.628848335532803e-01; -5.803715136992953e-02   -1.779530327046560e-01   +3.540751278737191e-02   -2.916600342956995e-01   +1.251208533763964e-01   +6.221227589885971e-02   -4.111992658987945e-02   +1.254864437770537e-01   -6.275960916296611e-02   -2.483115853419717e-02   +3.335384250809368e-01   -1.371548393833448e-02; +2.360176636404625e-01   -2.490485852994927e-01   -2.739357836957355e-01   -3.013006176110943e-01   +3.080417759033685e-02   -3.456344290760859e-01   +2.434141157688108e-01   -1.708796433830402e-01   -2.131266611734041e-01   -8.574138371794224e-02   -6.202643555989058e-02   +1.407688364945879e-01; +1.312984402014387e-01   -3.126938397556560e-02   -3.157641879006898e-01   -2.465255634403282e-01   +6.452927255680142e-02   +6.365540843070366e-02   -2.315076042562378e-01   -1.079293183367991e-01   -7.175523767861425e-02   +1.285381127320631e-01   -1.289211560176727e-01   -1.687153743347398e-01; -3.093941162401930e-02   +4.385230991045262e-02   -1.585044952365995e-02   +2.388814028627020e-01   +1.542906916513433e-01   +8.718895445138714e-02   -9.822218054933912e-02   -4.605144058502434e-02   -1.309443788284820e-01   +5.039338919626147e-01   +1.901462930340944e-01   +1.359128700699838e-01; +2.147318461705386e-01   +1.928811804438027e-02   -1.962073557878092e-01   -1.089112550720751e-02   +1.782644297970766e-01   +1.856210082421085e-01   -2.016121999408538e-01   -5.767680271241021e-02   -8.078310112018185e-03   -1.767067631826520e-01   -1.024335987735497e-01   +8.460620592774687e-02; -1.130391332689533e-01   -1.202622673550635e-01   +5.565154523586243e-02   -3.276687016819256e-01   +1.282100684726544e-01   +5.062615090779062e-02   +3.446552132760013e-02   +7.705895418828762e-02   -3.787475307653569e-02   -3.968688226850408e-01   -2.253260706974934e-02   +1.959114376634484e-01; +9.797626601388673e-02   -1.366019431351758e-01   +3.291277485048912e-01   +1.307833900850518e-01   +1.923278875603919e-01   +7.861064179815941e-02   -3.121864421853897e-01   -4.923433526233872e-02   +9.681415758096298e-02   +1.413749600936564e-01   +4.211342153405235e-01   +2.048211887100447e-01; +1.766114817239720e-01   -1.672887367673260e-01   -4.744275891143543e-02   -8.861842661618867e-02   +1.300762784313577e-01   +3.944999687751154e-01   -1.017973634764418e-01   -2.416279838652421e-01   +3.233301029393678e-03   +1.104073256973754e-01   +6.090063538313856e-02   +1.795615568802900e-01; -1.239037316429495e-01   +1.045370918183064e-01   -3.262191145565241e-01   -3.136345282977528e-01   +6.617133480917695e-02   +3.003838041833730e-01   -1.596013457433622e-01   -1.832217123348330e-02   +9.280055786403725e-02   +1.346406289577176e-04   +1.384429697059295e-02   +1.492809927936765e-01];
L2E_Input1_iAMPA_netcon = [-5.806670896906123e-02   -3.550298798451326e-01   +1.103024415698012e-02   -1.251932770738193e-01   +3.771151072586164e-02   -1.936238188486165e-01   -5.855507459025279e-02   +2.654569424464945e-01];
L2I_Input2_iAMPA_netcon = [-1.293589638345831e-02   -1.967700670288007e-01   -1.247036540013186e-01   -1.555310708231240e-01   +2.686899084183090e-01   +8.024981562463972e-02   -3.699171704960687e-01   +2.027016730527613e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
