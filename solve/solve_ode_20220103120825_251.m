function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.062080369733662e-01   +1.530432051951133e-01   +3.907891678415372e-01   -2.547413149428888e-02   +5.267616939613475e-02   +3.942437630423002e-01   +8.612886004615669e-02   +2.339093404799916e-01   +6.756594085328937e-02   +5.821870833123389e-01   +5.610585475816171e-02   +2.105477506716978e-01   +2.299697016779488e-01   +4.181462337198017e-01   +3.724793506624993e-01   +8.098797974141772e-03; +4.430871856889417e-01   +2.239271104327674e-01   -2.317389018184809e-01   +9.512872319027485e-02   +3.921490554448071e-01   +4.823289182199117e-01   -6.453831247304051e-02   +1.901653688151187e-01   +3.759041773598414e-01   +2.778789160671004e-01   +2.680701767375061e-01   +2.989419370413768e-01   +2.168336640007061e-01   +6.674521548950586e-01   -2.728656844826468e-01   +3.752207177969780e-01; +4.423445335633455e-01   +3.676786333978387e-01   -1.567886272024638e-01   +2.372873272456481e-01   +4.631184500351884e-01   +2.017233806860786e-01   +5.368715259889151e-02   +2.969622239417570e-01   +1.421472866375112e-01   +5.154422795321236e-01   +4.972420447360021e-02   +9.080771758772674e-02   +4.534195108441595e-01   +3.210512430601160e-01   -1.692308820960582e-01   +2.887222601907494e-01; +5.405091945004530e-01   +2.057772208245202e-01   +5.528309667647979e-01   +9.525335477464490e-01   +5.152764332173040e-01   +4.832408107023027e-01   +7.239691914539363e-01   +9.201324712609330e-01   +8.314654523286018e-01   +3.169103970215565e-01   +3.643074639796938e-01   +1.559046888595025e-01   +3.055609642290843e-01   +4.883287947899330e-01   +1.333495317048657e-01   +3.528988506519509e-01; +4.605083285555443e-01   +5.213913816275766e-01   +4.577837268229584e-01   +8.649192810416398e-01   -6.802289983022308e-02   -7.900566755453839e-02   +1.787836289780420e-01   +8.133272304769317e-01   +3.848698439677273e-01   +1.952987616366772e-01   +7.634842361823033e-01   +2.413378347669646e-01   +7.219455170139575e-01   +7.468914441164945e-02   +1.128314900283200e-01   +5.260164622426138e-01; +1.297139675197754e-01   +4.300296859705831e-01   +4.826866964588142e-01   -3.069305481282129e-02   +8.978651701516684e-02   +5.282212655866101e-01   +2.588168333978769e-01   +5.928585974130703e-01   +2.585621600194135e-01   +2.867604948792066e-01   +3.509249433320658e-02   +4.285505460353056e-01   +3.857045027753422e-02   +3.638293785667543e-01   +2.857390755946189e-01   +6.098145644949597e-01; +3.759069964772347e-01   +6.803057549369584e-01   +1.257878874643806e-01   -1.144197940433157e-02   +2.576413723112261e-01   +5.573250571376243e-01   +4.505296342114113e-01   +3.074742294086855e-02   +1.992861668550348e-01   +2.152128309567815e-01   +5.851831793078235e-01   +4.092972793344655e-01   +5.546872668414805e-01   +2.184073262275817e-01   -4.792617941823087e-02   +1.187867409150469e-01; +5.676479179644753e-01   +7.061174113187719e-01   +3.759636144473216e-01   -1.780898861003028e-01   +3.810573774576765e-01   -1.447000063782244e-01   +4.146438040254122e-01   +1.390775442395227e-01   +2.426719154439251e-01   +5.305046785591625e-01   +2.304735298918469e-01   +2.900292870920887e-01   +3.579145366244942e-01   +2.539177135328242e-01   -7.006921855753162e-02   +4.939827817365308e-01; +3.305643069968842e-01   +4.283925259393334e-01   -8.901296762765722e-03   +2.329601950243659e-01   +6.193473348985158e-01   +2.048600962884672e-03   +4.316056323368477e-01   +5.000840637927979e-01   +2.665726037856188e-01   +2.209087491530279e-01   +4.506716402635640e-01   -5.661845906615219e-02   +1.402924475524406e-01   +1.816191488003791e-01   +3.755375838115034e-01   -4.455831999637423e-02; +2.943164248152781e-01   +5.430365535092201e-01   +3.873152981820600e-01   +3.760520762148343e-01   +3.554901947973430e-01   +5.163400419665604e-01   +7.117230897187831e-01   +1.907051097522686e-01   -1.059771384627217e-01   +2.824370407905043e-01   +3.170007973814933e-01   +4.507357348646480e-01   +7.052198887084680e-01   +5.471539427703997e-01   +4.137521124661975e-01   +3.036216966110605e-01; +2.741197390354849e-01   +2.090319713890476e-01   +1.916793531389699e-01   +6.396011274877507e-01   +6.116009659780167e-01   +2.730539320812174e-01   +3.583826735599192e-01   +5.612930002329977e-01   +3.497761002744454e-01   -1.868290424369457e-01   -1.940575587079331e-01   +4.735164116154640e-01   +3.407729188722393e-01   +2.203424435967915e-01   +2.976723937204073e-01   -3.993502941697299e-02; +2.386785501849161e-01   -3.640433629840450e-02   +3.730764211096664e-01   +3.075027602637948e-01   +3.883662538191381e-01   +3.096187905294725e-02   +2.565570517981384e-01   -7.479814857231967e-02   -1.147628274575410e-01   +5.273296491736622e-01   +2.672243869055884e-01   -2.435103520717114e-01   +5.419956533195557e-01   +5.072979129689210e-01   +1.586098026398230e-01   +2.513647673120536e-01; +1.019399176618197e-01   +2.844304976839958e-01   +9.100536944906030e-01   +6.096777470336010e-01   +5.071508581194790e-01   +7.686685784486801e-01   +2.541048201305343e-01   +3.921848624896474e-01   +1.236038474472415e-02   +4.317088467086964e-02   +4.343292270651990e-01   +5.494042958392885e-01   +5.542313110447173e-01   +4.635780741131933e-01   +2.970847812766439e-01   +2.198866945499067e-01; +4.547607957905798e-01   +5.943787544373367e-01   +5.581787239918385e-01   +4.610669971907433e-01   +6.212418216031237e-01   +3.733808602709781e-01   +1.951594741126046e-01   +2.022738137540936e-01   +4.930085079308736e-01   -1.846502885353649e-01   +4.480542274175214e-01   +9.203802505932433e-02   +1.637880311866393e-01   +3.406762097098998e-02   -1.124137211000272e-01   +6.918704743842340e-02; +3.867015639213121e-02   +3.475891078822352e-01   +2.388076957272644e-01   +4.969944350445297e-01   +3.353562403109144e-01   +8.967992903419557e-01   -1.106920421847887e-01   +1.482193339983683e-01   -6.580538030091176e-02   +3.592653530725402e-01   +4.966833714553807e-01   +5.585960616950481e-01   +4.291470578494316e-01   +7.300113552160283e-01   +3.847901516042667e-01   +2.243515927792693e-01; +3.309786969118014e-01   +2.318597520138186e-01   -1.381467319555129e-01   +1.209434180679247e-01   +5.432694160161400e-01   +1.916045240825435e-01   -1.298111069967762e-01   +1.491988475206651e-02   +3.669988693544753e-01   +3.094673907711974e-01   +3.183725545744052e-01   +1.901252177954735e-01   +4.717139251147106e-01   -1.931265198695900e-01   +6.907506093143559e-01   +2.892394686280057e-01];
L1E_L1I_iGABA_netcon = [+3.484284814634772e-01   +5.546492036982715e-01   +5.944632576400035e-01   -5.275090784761691e-02   +9.028587144087388e-02   -3.380826212744674e-02   +3.831759067118139e-01   +4.784502713652920e-02   +5.486987740378000e-01   +6.113094317528160e-01   +6.112254707438030e-01   +4.809870481059732e-01   +6.135115461842070e-01   +2.923266042196680e-01   +2.993000271083859e-01   +1.690246407411834e-01; -6.293653021844157e-02   +3.628221180846327e-01   +2.369569115508779e-01   +1.873880631897527e-01   +2.071675346440728e-01   +3.182213301851822e-01   +2.505409520780240e-01   -3.282832022013332e-01   +7.617515391544593e-01   +4.655562331008435e-01   +5.004780478559903e-01   +7.345078118709107e-02   +3.864887888591303e-01   +1.193323984540755e-01   +3.393749495507442e-01   +2.403394688283770e-01; +5.818287443433092e-01   +3.535284863555521e-01   +5.780550372730592e-01   +2.005546228688396e-02   +5.066927433539643e-01   +6.913666250889777e-01   +3.191533550386833e-01   +1.458958499516137e-01   +2.730761272952989e-01   +1.260568694955854e-01   +6.956171988545228e-01   +4.898682694839649e-01   +7.112444019114496e-01   +3.629531288289264e-02   +5.674422944698868e-01   +6.935217951938980e-01; +1.080884347498004e-01   +3.313840603793291e-04   +9.469353237083883e-02   +4.759394169525250e-01   +4.557320319490697e-01   +2.337199367590072e-01   +7.059045978760863e-01   +3.233013717621242e-01   +4.578334723975583e-01   +9.040830109317294e-01   +8.965364601527030e-02   +1.910442632538265e-01   +6.686042442977750e-01   +1.099877936766948e-01   +3.356785548205795e-01   +5.896973484990062e-01; +8.553909230370707e-02   +1.502592872961103e-01   -1.843671718458036e-01   +1.183398454170946e-01   +3.320226923439563e-01   +5.906854305116781e-01   +6.776847306560141e-01   +5.466439136952411e-01   +2.978238637995058e-01   +5.975800879976110e-01   +2.902945035345420e-01   +6.068303129245785e-01   +1.758762255581725e-01   +3.917247600199704e-01   +4.411006769078634e-01   +2.126151763991850e-01; +6.886145602704898e-01   +2.446776347452090e-01   +3.511094517188955e-01   +5.582174410716925e-02   +3.515423466107778e-01   +1.908468628051138e-02   +4.318965654808133e-01   +2.815339695152599e-01   +7.563264222709487e-02   +5.390896750516935e-01   +4.126951807761126e-01   +3.167384533839784e-01   +1.447430300938486e-01   +3.526038808617103e-01   +4.054592245206686e-01   +4.892058577233226e-01; +7.382725726724404e-02   +5.528768598126246e-01   +1.174033648916285e-01   +1.967340466973289e-01   +5.511945887910934e-02   -3.743974936394494e-01   +7.190820687603973e-01   +6.490480161408644e-01   +2.728758224299276e-01   -1.198024964628670e-01   +6.155795199450005e-02   -9.683689461902013e-02   +6.035173359577500e-02   +4.849445293591138e-01   +3.562766714751540e-01   +4.124491312310736e-01; +2.554525724652496e-01   +6.764007183558328e-01   +6.972237704935447e-01   +1.749070689815253e-01   +3.389244299847685e-01   +6.527631122644895e-01   +1.243087191858337e-01   -2.436075978259776e-01   +2.156345659706469e-01   +3.224155447353797e-01   +7.059856764598372e-01   +4.089116529759149e-02   +4.298988542689912e-01   +7.551509545508192e-01   +2.280532354155508e-01   -7.557095456265468e-02; +1.602523449949926e-02   +1.070485727023251e-01   +3.317793700717799e-01   +5.209624753614718e-01   +6.026056912942827e-01   +1.774441717828981e-01   +4.667979948360088e-01   +1.554808198436433e-01   +5.256285099997887e-01   +1.294973599701847e-01   -6.116919670133569e-02   +4.195908817093700e-01   +2.078414429622008e-01   +6.179573221817521e-01   +3.085526633586319e-01   +5.198074244415977e-02; +6.208111275632638e-02   +8.643599599845341e-01   +5.376718010179983e-01   +3.871112001165089e-02   +3.711542878327608e-01   +4.554153482266909e-01   +7.231089105943057e-02   -4.205352871775482e-03   +3.898148738492175e-01   +3.882501439286436e-01   +4.450817100282290e-01   +6.713939755782453e-01   +2.715343734384922e-01   +3.943265015299252e-01   +2.392468741911377e-01   -3.619023174227054e-02; +8.000478539800382e-02   +7.203764811959095e-01   +6.584559369394249e-01   +6.181876575542283e-01   +3.909264819784997e-01   +9.090915525973521e-02   +1.051225205852488e-01   +6.116007521860711e-01   +4.919946062581174e-01   +3.375863208714834e-01   +5.831719880256683e-01   +4.893416614427730e-01   +3.645052066478570e-02   +6.054730954885001e-01   +6.660371876266846e-02   +4.967876018187639e-01; +7.287301114837409e-01   +7.350585223975643e-02   +2.034942051185636e-01   +5.548101736990055e-01   +6.493701581455309e-01   +1.305686335179110e-01   +1.768716248729277e-01   +3.939099375080761e-01   -8.061798024779723e-02   +2.477712910003803e-01   +4.914925226851206e-01   +4.559891438946730e-01   -6.152339074669266e-02   +1.200664988361502e-01   +2.473247894345575e-01   +5.328512491484285e-01; +5.920164729062182e-01   +6.853589190700301e-01   +7.605261857327289e-01   +1.821541585544603e-01   +3.269702706917023e-01   +8.899033008088795e-01   +5.574278888642869e-02   +2.398050266924603e-01   +5.552583207740329e-01   +5.765965532634827e-01   +7.579169289001503e-01   -2.194637880466654e-02   +5.459819774632155e-01   +2.477766337887127e-01   +8.889638433385401e-02   +5.030513712759288e-01; +2.949570280393493e-01   +2.367108886244287e-01   +4.523116717251014e-01   +6.269928942133945e-01   +1.000000000000000e+00   +5.681989141771084e-01   +7.739750013682064e-01   -6.359001245914706e-02   +4.641095912728638e-02   +2.796220918403433e-01   +4.053970715056802e-02   +7.602000431527415e-01   +4.733016841858505e-01   +3.099203123240742e-01   +5.284018860556459e-01   +4.828005010617553e-01; +4.833559217783777e-01   +9.947805324698932e-01   +1.336866175760638e-01   -1.339003633810311e-01   +4.796514463244198e-01   +1.812053471001700e-01   +2.428679917555688e-01   +1.451618735428762e-02   +4.969396840673641e-01   -1.724266107079337e-01   +3.717390426372519e-01   +4.058379077328583e-01   +6.112051923897905e-01   -1.260180384310936e-01   +2.255319102447157e-01   -3.371101638303499e-01; -6.949734102157831e-02   +3.510552514399403e-01   +7.503401731715831e-01   +9.643416976346893e-02   +3.260583293055939e-01   +4.122226666317939e-01   +1.325859123373185e-01   +6.899177441915598e-01   +3.580889518727815e-01   +1.088780641668799e-01   +2.221640562977487e-01   +6.783019440677268e-01   -6.844147124637577e-02   +1.742836415911122e-02   +7.643325868952192e-03   +6.814051473799679e-02];
L2I_L1I_iGABA_netcon = [+1.938065420609650e-01   +1.155620837495456e-01   +8.360697913435269e-01   +2.036723811343296e-01   +5.043386147730526e-01   +5.126126952090300e-01   +6.171248759454452e-01   +8.641679573763189e-01; +2.038740584894985e-01   +7.167931571894701e-02   +2.466632266089732e-01   +4.568611593467036e-01   +6.771882475118410e-01   -6.583828227459317e-02   +2.669424781614622e-01   +9.342073194028443e-02; +5.174696693435007e-01   +5.496687766590910e-01   -1.478017257602372e-01   +3.487390602015064e-01   +4.793457489966619e-01   +4.510516268326276e-02   +3.452509724903676e-01   +4.306413834875189e-01; +4.099838252160402e-01   +5.037796462609770e-01   +2.779157199640413e-02   +4.953081772340909e-01   +9.800180670715916e-02   -4.573027859059078e-02   +5.058387599519652e-02   -1.094554954917226e-03; +2.025288081689995e-01   +5.526372194098326e-01   +1.208339703756533e-01   +1.116133641241777e-02   +5.738225769684213e-01   +2.500171683359394e-01   +5.621007107270951e-01   +5.277825914802295e-01; +5.492093759514600e-01   +3.645115214678031e-01   +5.069361100179497e-01   +5.425603470620941e-01   +3.590579969256563e-01   +1.687544965894301e-01   +4.796978092155187e-01   -1.294694600244025e-01; +2.449403631766886e-01   +6.114578784599045e-01   +4.371996436973297e-01   +7.590600834596689e-01   +1.123938621134638e-02   +7.683056143171189e-02   +1.249593723786961e-01   +4.691705732861448e-01; +4.300722490218736e-01   +3.424550950560499e-01   -1.337866434147859e-01   +3.298687947352794e-01   +1.599003509418029e-01   +3.645572270541307e-01   +3.497657256598636e-01   +1.023799067696216e-01; +2.439292139983319e-01   +1.345072932765151e-01   +5.268643627113324e-01   +2.105416595313217e-01   +2.886274407229223e-01   +9.811575006836396e-01   +2.156339308466694e-01   +9.685479561300456e-01; +6.137467216845549e-01   +2.564441823636787e-01   -2.459621795937297e-02   +7.211196432139773e-02   +5.412859857131428e-01   -2.353872341514061e-01   +1.999430048221565e-01   +3.134098618707544e-01; +2.588236004560632e-01   +6.875876530817492e-01   +2.552087110154258e-01   +7.538846554506274e-01   +2.809356313669680e-01   +2.979256454936354e-01   +8.225407061014439e-01   +7.282091447091552e-01; +5.256405605642440e-01   +1.000000000000000e+00   -2.271777116945116e-01   -2.538355486328304e-02   +2.272394142070457e-01   +4.024366042228886e-01   +2.700595898347233e-01   +2.669972212415375e-01; +9.559047655601273e-01   +3.536952616017697e-01   +5.673682798220735e-01   +3.234811422712709e-03   +4.059832788058831e-01   +1.196758491544396e-01   +7.408195218217852e-01   +1.392252207738695e-01; +6.425556009968585e-01   +3.546723986598564e-01   +3.832549452036333e-01   +2.674594265134836e-01   +3.556082529197720e-01   +3.266690144901930e-01   +1.029938170084543e-02   +3.053348717136605e-02; -6.642080350635457e-02   +8.014430466093138e-01   +6.130429513914915e-01   +1.032511828725881e-01   +4.303879872160204e-01   +4.599344985347309e-01   +4.070963955004171e-02   +3.165862217105725e-01; +1.842603405029755e-01   +4.938956608357782e-01   +8.080647704650813e-02   +3.694972805882697e-01   +2.071892582747206e-01   +2.325007534020204e-01   +1.231060612711426e-01   -9.135168919391251e-02];
L1I_L2I_iGABA_netcon = [+4.663365539536819e-01   +5.385616411326285e-01   +1.353742527107196e-01   +3.791137351490410e-01   +8.190309313690126e-01   -1.706345573848695e-01   +6.214773528577889e-01   +1.573263526621874e-01   +1.887463551898144e-01   +4.722522040057084e-01   +5.581948784096107e-01   +4.880664476753182e-01   +5.573627516958025e-01   +1.808768401202886e-01   -4.271899951696758e-02   +4.679467444155371e-01; +7.624521851345389e-01   +3.742273263959662e-01   +6.063653037306755e-01   +6.784461759664085e-01   +5.933382901018334e-01   +1.000000000000000e+00   +5.585104385279643e-01   +3.203447844119794e-01   +4.403084708586677e-01   -1.090403149300966e-02   +1.063997123619964e-02   +7.576484480204971e-01   +5.570060948825973e-01   +2.081784840184379e-01   +5.893274008650403e-01   +8.852756990446178e-01; +2.467850175022466e-01   -8.717448871008381e-02   +6.427267046826866e-01   +5.214097660278981e-01   +3.946051348306122e-01   +5.191881892553186e-01   +3.296922399124208e-01   +6.740998523600347e-01   +5.085643048792085e-01   +4.208309573204473e-01   -1.281230721510578e-01   +3.292797220639051e-01   -1.557525311986453e-01   +7.419287814410459e-01   +4.408063768030103e-01   +3.904543681332543e-01; -2.114352833541610e-01   +5.289868725611907e-01   +4.093271855975369e-01   +5.032469534720262e-02   +4.454219372267025e-01   +5.527038698780278e-01   +8.799171692179406e-01   +3.407516894934282e-01   +7.519995250454309e-01   +2.191320943492637e-01   +3.910053933637091e-01   +9.060959860859754e-01   +5.027820964461595e-01   +3.992451095834262e-01   +6.972205080278729e-01   +3.958578933915898e-01; +5.883975030884980e-01   +8.168022944583790e-01   +1.645930023044912e-01   +2.618811365943909e-01   +1.870069646661165e-01   +7.350021444179156e-02   +6.925819942942336e-01   +9.760388241818967e-02   -2.010608436639910e-01   +3.770260870065538e-01   +4.919945095975240e-01   +5.933022435057234e-01   +1.625769103657681e-01   -1.193580473344345e-02   +5.930772502863191e-01   +8.278897211472180e-01; +6.995400341349158e-01   +4.760391063243771e-01   +4.569524000302128e-01   -6.347960264452768e-02   +2.753586235399714e-01   -1.019622910913503e-02   +9.403768726741251e-01   +1.781827382221479e-01   +4.301849880961942e-01   +6.549868000580803e-01   +9.414531200760946e-01   +1.471390309846942e-01   +2.598951094811316e-01   +4.557672262814411e-01   +2.758870782661432e-01   +2.616590158230307e-01; +1.779924558889124e-01   +6.212535667166340e-01   +6.586971342643725e-01   +2.829361551702652e-01   +3.955778837744015e-01   +8.973228122131136e-01   +6.938051217464809e-01   +3.171920456505681e-01   +2.030165048270943e-02   -1.313735341486568e-01   +6.323076071473926e-01   +1.668956776558802e-01   +6.205868837533189e-01   +9.533215099881027e-01   +1.323940864030720e-01   +5.413192002068449e-01; +2.743492918025503e-01   +8.550210679921592e-01   +3.925865351622674e-01   +7.687100971840515e-01   +5.462603520762479e-01   +3.571750986509183e-01   +5.432132062815354e-01   -2.949810364932310e-01   -1.100841233435134e-03   +1.723597758741385e-01   +3.988661991722015e-03   +6.086492387613145e-01   +3.595503630698230e-02   +8.540892695548000e-01   +4.236874676332634e-01   +4.194779015747402e-01];
L2E_L1E_iAMPA_netcon = [+3.918065880897312e-02   +3.366207890185202e-01   +5.266970036543046e-01   +4.880218286586138e-01   +5.273720341201232e-01   +2.154143638338335e-01   +4.827410706375977e-01   +6.982083370899953e-01; +5.917029343903689e-01   +4.262631858776342e-02   +5.877703870243144e-02   +1.720970673856747e-01   +2.650630024886856e-01   +3.579670571230640e-01   +1.308615133269045e-01   +4.529708115328407e-01; +2.476838272615231e-01   +1.992555572140479e-01   +4.112582112019332e-01   +1.000000000000000e+00   -2.232591713642010e-03   +3.310917472095462e-01   -6.321017447626989e-02   +5.564084062981356e-01; +1.386879221602764e-01   -1.186686531763552e-02   +3.864781151661467e-01   +5.182014435835178e-01   +6.836344402322049e-01   +2.005869967035951e-01   +5.893467616167696e-01   +2.667583087947826e-01; +7.868599938881790e-01   +5.349409850667217e-01   +1.891474419756258e-01   +1.525638855815702e-01   +1.510236584178278e-01   +3.116907852129830e-01   +1.929632984699080e-01   +1.970933502934850e-01; +5.249929115717455e-01   +3.378939750042135e-01   +7.604690214342632e-01   +5.683082803075673e-01   +6.057447672286412e-01   +4.571025696195284e-01   +4.383183807617914e-01   +7.333843997616076e-01; +6.906333062000687e-01   +3.347844767148820e-01   +1.106448163150715e-01   -1.295461756598003e-01   +3.034075966178162e-01   +3.133973292966268e-01   +3.648251507809312e-01   +7.073170394882431e-01; +5.808216870479167e-01   +4.514868969759134e-01   +2.903227737537242e-01   +4.777392999064705e-01   -3.222245348359862e-02   -1.271223360021641e-02   +3.966200436628669e-01   +9.303758009726356e-01; +1.112987678698597e-01   +2.184476807225218e-02   +3.873677475917766e-01   +7.621071733759441e-02   +5.017584959181109e-01   +5.490655723497823e-01   +3.444346974529425e-01   +1.429193522812029e-02; +3.134048561303123e-01   +4.805931688180755e-01   +3.066649280247837e-01   +5.981736816231862e-01   +5.334746966226426e-01   -2.360375078192310e-01   +6.611285336016751e-01   +9.840881804733660e-02; +6.503798773270443e-02   +8.879402835894484e-02   +3.837151965562991e-01   +5.923477727068041e-01   +8.010119746555537e-02   +3.389297613684764e-01   +6.697858669055761e-01   +4.570919526191013e-01; +6.665338493768879e-01   -3.806963651755811e-02   -1.449311615371236e-01   +7.269568752927678e-01   +5.170439154107295e-01   +1.187479527322414e-01   +3.703817953927033e-01   +5.012610407432078e-01; +1.277461899364084e-01   +5.799798401917559e-01   +1.592578909844714e-01   +5.768741368961678e-02   +3.836670783016081e-01   +2.955442049094116e-01   +7.697250829051852e-02   +3.052278815602372e-01; +4.575912098397408e-02   +4.899455744035687e-01   +7.082392975909997e-01   +3.083760987242323e-01   +2.352845511689762e-01   +3.513104923137372e-01   +1.555558283478879e-01   +6.176646616468644e-01; +2.197936081454535e-01   +2.244888341719539e-01   +2.157279095236888e-01   +5.606301202603581e-01   +5.357790920595655e-01   +3.158856532346715e-01   +3.227366682734872e-01   +7.238661569045902e-01; +2.883690232833503e-01   +1.767719938284066e-01   +3.397617097673772e-01   +2.527605270221607e-01   +6.233085457929614e-01   +7.261245746367750e-02   -1.112495215608190e-01   +2.113474747467861e-01];
L1E_L2E_iAMPA_netcon = [+4.921019313836703e-01   +7.772984742927275e-01   +1.772503060525306e-01   +4.321918608431437e-01   -2.834212116790235e-01   +2.539239506369930e-01   +5.389762621603066e-02   +7.120564129556397e-01   +7.775798449949659e-01   +3.280510317753972e-01   +6.058999462950303e-01   +6.908177784201086e-01   +6.166577065515799e-01   +1.949006734791081e-01   -7.097567431248025e-02   +7.261740780428240e-01; +4.221555090804603e-01   +5.854300054601793e-01   +8.183882410766202e-01   +6.049063483788466e-01   +4.115843807458326e-01   +4.335993077872655e-01   +5.909241443945117e-01   -2.784974344860943e-01   +2.641788509678600e-01   +6.823498192299139e-01   +3.893981902651736e-01   -2.394002560855902e-01   +4.910058128274691e-01   +1.305813468244668e-01   +1.064083430357204e-01   +1.853279951283405e-01; +7.251998644009061e-02   +3.603147414714912e-01   +6.236384318422143e-01   +6.508562359662495e-01   -2.422888188676822e-02   +2.612725261983039e-01   +8.652951265178399e-02   +1.148889108799226e-01   +4.024666063557096e-01   +1.223228718031305e-01   +8.354591164036073e-01   +4.665684937175273e-01   +1.410334638438338e-01   +5.748512572287928e-01   +6.934031139437253e-01   +5.437070410068447e-01; -9.009998127922576e-02   +5.436094918552332e-01   +2.129304949799759e-01   +5.662878104833418e-01   +5.156387789931702e-03   +5.805937416803572e-01   -3.887137480488297e-02   -5.185905786545201e-02   +1.371538798108675e-01   +3.846514252925742e-01   +4.664626581048439e-01   +1.624735422739007e-01   +2.326868924297233e-01   +2.219515737141725e-01   +5.813910207656713e-02   +1.767589786358097e-01; +2.646009277488531e-01   +7.359977633760250e-01   +6.996117387238044e-01   +6.419327609177769e-02   +3.375953675784940e-01   +7.695328372612863e-01   +4.838709204780592e-01   +1.578061547481318e-01   +5.370118385621229e-01   +5.341367859620169e-01   +8.971713427603678e-01   -5.950193981045595e-02   +6.977072563720453e-01   +7.215494724349985e-01   +3.866250669627859e-01   +2.140906300377605e-01; +3.449975244736778e-01   -2.769675800109755e-02   +4.678051833103328e-01   +5.786284455466425e-01   +4.929480748936923e-01   +5.421782737697808e-01   +8.290990567689234e-01   +3.051755222004672e-01   +1.728354983170016e-01   +6.129419347018291e-01   +1.724064051788783e-02   +5.635880775623595e-01   +4.164057528166697e-01   +1.976650915936627e-01   +7.132522963252440e-01   +7.716299490836247e-01; +4.711744758502318e-01   +3.713845875763735e-02   +2.523366664899091e-01   +5.083514933329467e-01   +3.698935949903732e-01   +2.483949519694170e-01   +9.260249402921212e-01   +8.780587498864748e-01   +2.620549415770620e-01   +3.207999394015680e-01   +6.063674297125652e-01   +5.167247678280311e-01   +2.781447623627821e-01   +6.677450975300518e-01   +3.559470207523844e-01   +2.277213431253640e-01; +5.242090208914787e-01   +5.274546384845864e-01   +5.190961461633213e-01   -3.680882362015046e-03   +7.612307647144783e-01   +2.367467585233143e-01   +1.900587498735478e-01   +4.682994165234170e-01   +4.883901754016273e-01   +2.566413912467164e-01   +3.663003817940177e-01   +1.826641365791553e-01   -9.669976132018240e-03   -2.179876834465729e-01   +3.876130435788868e-01   +3.794532488804725e-01];
L2I_L2E_iAMPA_netcon = [+1.887803660344926e-01   +9.260860012880333e-01   +6.589878517728451e-01   +6.035610825362576e-01   +3.932302229762054e-01   -1.829988395083641e-02   +8.953389323400651e-01   +6.730412162265343e-01; +7.719379987850915e-01   +8.488231463657607e-01   +2.020704244031144e-01   -7.739889845553914e-02   +4.866369491369856e-01   -8.002566858482836e-02   +2.806149113565475e-01   +2.861701328212267e-01; +5.251936633856891e-01   +5.792796794432928e-01   +6.777315963381138e-01   +1.591703837177655e-01   +3.360751242424049e-01   +7.641174475741348e-01   -4.068126665642128e-03   +2.988823186799970e-01; +6.064442652968205e-01   +6.807455302715228e-01   +4.024442635925062e-01   +1.871284744112964e-01   +7.608903417336771e-01   +1.000000000000000e+00   +8.568167900458801e-01   +9.134051927352567e-01; +8.856185653019034e-01   +1.000652433646108e-01   +4.331861115441604e-01   -1.088652900346458e-01   +8.787112965813429e-02   +7.108046809683315e-01   +4.090095411882363e-01   +3.728033389928835e-01; +2.823191190467804e-02   +2.015719210495678e-01   +2.063994003035666e-02   +3.514346107123131e-01   +6.775656253910947e-02   +6.292507174792589e-01   +6.678340075806506e-01   +1.322588917483320e-01; +9.091006069713381e-01   +1.725275444463305e-01   +2.924580026752004e-01   +7.663182467722288e-02   +2.594266356708501e-01   +4.247952404985966e-01   +5.112654709016902e-01   +4.030672935714960e-01; +1.740971373662064e-02   +2.303473764046564e-01   +2.726672497529894e-01   +1.705613322252248e-01   +7.499979137152551e-01   +5.852715472512471e-01   +3.837496397364243e-01   +4.367433657140957e-02];
L2E_L2I_iGABA_netcon = [+9.105754960105253e-01   +7.506746420694553e-01   +7.971958216437073e-01   +6.765190748820867e-01   +3.783310971345099e-01   +2.022720144584313e-01   +3.250243788348819e-01   +2.011383113301953e-01; +3.744419963418594e-01   +7.888670753394570e-01   +9.894617216073788e-01   +1.000000000000000e+00   +2.974154973283780e-01   +3.933559082429298e-01   +1.211785956766135e-02   +8.040929205194199e-01; -1.970095179980995e-01   +5.195545529899530e-01   +8.423846445993565e-01   +6.670872175448498e-01   +5.946124201054875e-01   -4.945317356934891e-02   +6.032325016399892e-01   +2.322279231288792e-01; +4.993999507466830e-01   +1.992676521924576e-01   +7.328315088543254e-01   +1.743543176442898e-01   +5.486702764440505e-01   +2.992571618571891e-01   +2.293747863133511e-01   -2.533916884114382e-01; +4.296859629050482e-01   +8.737974269738791e-01   +5.143971994262772e-01   +3.625180525461657e-01   +2.899711826402775e-01   +1.274737559059824e-01   +7.333578188664761e-01   -4.986043848718610e-02; +6.694611918129741e-02   +8.555166162032371e-02   -1.421656662086766e-01   +2.855240138549272e-01   +6.464038730294482e-01   +4.330996634512804e-01   +3.556656130166085e-01   -1.572055243921829e-02; +4.626087934191728e-01   +6.017402451702317e-01   +8.755172636755452e-02   +5.620576231449722e-01   +5.018622353669878e-01   +7.618437402209063e-01   +4.825880373401369e-01   +7.506982597731027e-01; +3.926434161664132e-01   +1.568766632850485e-01   +4.449170716595921e-01   +6.097272201231327e-01   +3.794281131421977e-01   +2.356720666634075e-01   +1.601356701398747e-01   +2.705073450665196e-02];
L3E_L2E_iAMPA_netcon = [+2.507936445555340e-01   +1.736712293781858e-01   +5.686139470301180e-01   +2.895994442647428e-01   +4.105594329645393e-01   +3.459998435286632e-01   +3.610797227896465e-01   +5.313293868180063e-01   +1.705908574716088e-01   +6.812519208293580e-01   +8.203751529094204e-01   +4.785814185649973e-01; +3.740864939231325e-01   +2.808080980092861e-01   +5.745719527700107e-01   +3.809782790258641e-01   +5.667293232760407e-02   +2.136472631572626e-01   +1.195458324625572e-01   +8.125195330370399e-01   +2.531510781081420e-01   +4.124482022884173e-01   +4.493779110957365e-01   -1.582061743138934e-01; -8.904457807865508e-02   +2.326859926291091e-01   -7.638602641233673e-02   +5.280263666070171e-01   -1.266795502231174e-01   +1.848783002841762e-01   +1.194217253863278e-01   +2.339696426260868e-01   -1.712228352453284e-01   -2.087929474143684e-02   +1.188713687231369e-01   +2.985269829831184e-01; +4.846317127652408e-01   +1.761985673047416e-01   +3.749469361458559e-02   +3.149492951539224e-01   +3.829692873629549e-01   +2.375104751115351e-01   +1.144274769598567e-01   +1.137783756394699e-01   +5.238715237058478e-01   +2.115853738564567e-01   +3.516975135313051e-01   +5.960384733930292e-01; +6.576976370837141e-01   -6.153275293457349e-02   +6.134880450927821e-01   +4.632386453920266e-01   +2.122604679798044e-01   +6.542511156722185e-01   +4.639765703051275e-01   +6.665568775830275e-01   +2.081260306961271e-02   +5.967493810315095e-01   +4.427912513202938e-01   +3.192892892330109e-01; +6.713668934434192e-01   +3.787378138151121e-01   -1.711563727887577e-01   +5.947002345418678e-01   -8.702506161740233e-03   +6.312555394165773e-01   +6.809252810429388e-01   +1.437448540971366e-02   +1.083497733391727e-01   +6.148074929721574e-01   +1.549902603229999e-01   +3.837365154777629e-01; +7.607796926725560e-02   +5.382151878726342e-01   +1.345125404955352e-01   -1.852962138320544e-01   +1.000000000000000e+00   -1.439435456871555e-01   +2.489250341444487e-01   +5.586397584462788e-01   +7.171077470612885e-02   +5.775674466620681e-01   +2.770911614719270e-01   +7.622351224418016e-01; +3.754091398233869e-01   +5.193607777273405e-02   +4.961711686719843e-02   +3.189736242183452e-02   +6.046220755844354e-01   -1.749534219346482e-01   +5.328362930252319e-01   +1.297002489766837e-01   +1.424249452802427e-01   +4.159158212138672e-01   +6.780771935102544e-01   -3.109834025797432e-02];
L3I_L2I_iGABA_netcon = [+5.100175052189871e-01   +4.640632501990741e-01   +5.431679629421406e-01   +1.538199179282449e-01   +2.305089158960344e-01   +4.534253317859216e-01   +4.126485236968844e-01   -3.890597694729020e-03   +1.369649339884078e-01   +4.135801961671963e-01   +4.938403779845483e-01   +7.157344574148023e-01; +3.741955864121027e-01   -3.666217824301066e-01   -2.150510103285895e-01   +6.880008914710036e-01   +3.320811532313476e-01   +5.632275594940466e-01   +3.800744552592867e-01   +6.852687461908939e-02   +7.522547264193550e-01   +1.604848478185756e-01   +7.956017707982844e-01   +3.399009531608539e-01; -1.162361170641116e-02   +6.600898323520425e-01   +7.893373792868186e-01   +5.179074747879084e-01   -8.159844895691640e-03   +4.075740000168574e-01   +1.596326153286409e-01   +7.175400149075445e-01   +4.769830228828827e-01   +3.667726401094655e-01   +6.590416118492394e-01   +6.399249153954165e-01; -2.104651701954524e-01   +2.004773241216514e-01   +8.036151915969517e-01   +3.688693505769575e-01   +4.947343785835227e-01   +4.136255330637767e-01   +1.890463213174035e-01   +4.110906096307680e-01   -9.872802769565264e-02   +2.847788020414720e-01   +1.077800912825228e-01   +7.379713422934503e-02; +1.343365896212219e-01   +3.726560191254670e-01   -3.099594975635174e-03   +1.075019878120366e-01   +2.894155277234653e-01   +3.263134872920650e-01   +1.927887567307136e-02   +2.004854541528588e-01   +1.994314211441606e-01   +4.989911922747348e-01   +7.343669899670177e-01   +5.209571498674488e-01; +1.093919900464812e-01   +5.112269223532685e-01   -9.082539577215801e-02   +4.932982530502494e-01   +8.993133190157439e-03   +1.322679559684535e-01   -1.543557355764882e-01   +3.788236001008743e-02   -9.019301761255018e-02   +7.416798106625792e-01   +6.880560069213568e-01   +5.494276128187444e-01; +5.847701949409219e-01   +4.512325045057112e-01   +6.050271490519923e-01   +4.836250800455456e-01   +4.406026904579601e-01   +2.981969942046765e-01   +4.386148774760029e-01   +9.600841805351686e-02   +1.663663657367931e-01   +7.472714122985377e-01   +6.639245216925384e-02   +3.898306707877828e-01; +5.196426144680533e-01   +6.817255391686142e-01   +3.404786701496432e-01   +2.505659009711470e-02   +5.281030258934527e-01   -2.705134341378456e-01   +9.122716510432568e-01   +5.874634327219727e-01   +8.176380910282740e-01   +5.048047476959128e-01   +3.858867281585873e-01   +6.843015821755194e-01];
L2E_L3E_iAMPA_netcon = [-5.551112214886422e-02   +2.492848166920637e-01   +2.028031166640410e-01   +5.147506960068181e-01   +3.883613961736226e-01   +7.819144705190073e-02   +3.743941657750113e-02   +1.503187184332057e-02; +5.004393808931037e-01   +5.391803667858279e-01   +3.380617671050152e-02   +6.093801156384203e-01   +1.653678432391830e-01   +3.675949421016335e-01   +1.069422882424849e-01   +6.950156306264165e-01; +5.997553553151180e-01   +4.422293928851264e-01   +2.924112606091493e-03   -4.691736819249932e-03   +6.072495066256733e-01   +9.771234277978724e-02   +2.895426347060200e-01   +2.701915088291708e-01; +2.974813470666933e-01   +5.662671874338941e-01   +4.513502084753943e-01   +3.669070191048144e-01   +4.988354098181719e-01   +3.516409700143188e-01   +1.634872151175532e-01   +4.682183426701989e-01; +9.570176880590546e-02   -1.516326279482164e-02   +4.507317953200659e-01   +4.480830904046076e-01   +2.953479018824994e-01   +2.748839679074060e-02   +5.408035052851593e-01   +1.081138850678555e-01; +4.523678679749122e-01   +5.190029922861760e-01   +1.382731109841051e-01   +6.232826750247743e-01   +6.323391828917875e-02   +3.863375898566196e-01   +3.640933609385343e-01   +4.795700279770476e-01; -1.725499949877924e-01   +3.749023802404407e-01   +3.649648572750646e-01   +4.189460609740365e-01   +4.632672476067185e-02   +3.102376946369326e-02   +7.513049557978028e-01   +2.381814262677318e-01; +1.033940420096931e-01   +6.892802944418116e-01   +3.605914722436747e-01   +2.919431582916134e-01   +2.403457851929588e-01   +4.465753133595224e-01   +5.714833584046949e-01   +1.163605439624571e-01; +7.136132991703156e-01   +6.786628552387624e-01   +3.272296873606569e-01   +6.583930069364948e-01   +1.334543012800288e-01   +2.795521313533276e-01   +4.241972056347894e-01   +1.000000000000000e+00; +2.128021682606429e-01   -2.332238341328548e-02   +3.098397582668397e-01   +5.436703339118346e-01   +2.551073495569885e-01   +1.102708188685540e-01   +6.633829044812765e-01   -3.227874823062432e-01; +1.800160931792129e-01   +1.951724357606510e-01   -1.869035982948176e-02   -1.155695812725308e-01   +2.550136529122470e-01   +3.867248558860007e-02   +2.374822050815296e-01   +8.185651004752523e-01; +3.798201407365471e-01   +2.644904067676788e-01   +4.985085695328353e-01   +5.066627262294034e-01   +7.074840050743132e-01   +9.663225687221601e-02   -2.366294952638773e-03   +3.301510107333948e-01];
L2I_L3I_iGABA_netcon = [+3.043497849930168e-01   +2.933713930186009e-01   +4.387278829121138e-02   +9.177067147873544e-01   +2.947428244928696e-01   -1.683170594837512e-02   +4.664091170815952e-01   +3.664783616328265e-01; +3.166388791815640e-01   +1.274825495773733e-01   +9.004590416444530e-02   +2.222578186513310e-01   +1.052724376161634e-01   +3.775178241771774e-01   +9.944115865368111e-01   +2.613489823464024e-01; +4.446140083720251e-02   +3.292275279350456e-01   -1.138338629436926e-01   +5.673563265329903e-01   +2.420240957810823e-01   -1.372158379877860e-02   +1.658607619727779e-01   +3.819687491286715e-01; +1.275548954358255e-01   -3.704761782841055e-01   +3.546662948837021e-01   +4.582954338526470e-01   +7.004440602325362e-01   +1.885500380296229e-01   +4.445191370469017e-01   +3.034672417965444e-01; +1.988329447738223e-01   +6.143104325742139e-01   +3.139818173060536e-01   -3.618005847090558e-03   +2.720805067411970e-01   +2.219602169767395e-01   +2.689593659451171e-01   +5.591001974687900e-01; +1.324381929991064e-01   +4.072421310329216e-01   -7.276543805264213e-02   +5.422634409916229e-01   +4.517848646953371e-01   +7.630137484802131e-01   +1.289074447626038e-01   +3.926924114336786e-01; +4.526698739436599e-01   +3.933099782000445e-01   +2.893511253085733e-01   +4.873557861575754e-01   +4.069625635585971e-01   -1.132467494275011e-01   +7.142139155223992e-03   +2.057967025954009e-01; +5.449105398628681e-01   +6.522421658316836e-01   +6.571064358035904e-01   +2.500605788933521e-01   +6.219760468629537e-02   +4.744671530238855e-01   +1.551930216821717e-01   -1.105765140285193e-01; -1.052465468924688e-01   +1.735269195068735e-01   +2.923219552901976e-01   +4.329685390300497e-01   +4.429458822233685e-01   +4.566114404118803e-01   +5.318316731387911e-01   +3.184561966025300e-01; +5.685084460881467e-01   +2.151886570417384e-02   +4.021445836529624e-01   +3.500302584363104e-01   +4.018982456037939e-01   -5.988970928530429e-02   -1.725219880968117e-02   +3.859005038974690e-03; +2.576435085265358e-01   +7.287220798230312e-01   +2.662482027039982e-01   +5.358466348605739e-01   +1.588420068861453e-01   +1.978027188231531e-02   +4.144970058282133e-01   +2.038580253703464e-01; -8.415603414044102e-02   +2.756526535203971e-01   +4.982174542444059e-02   +1.894084562034220e-01   +7.541195143343574e-01   +5.878207038761056e-01   +5.907660163021223e-01   +1.155375251683917e-01];
L3I_L3E_iAMPA_netcon = [+1.695062276991706e-01   +6.316001563292311e-01   -3.072565783725364e-01   +4.126089657355112e-01   +9.897108023239359e-01   +1.449797464483206e-01   +5.038481632193729e-01   +5.867368320019850e-01   +1.697335363437421e-01   +1.664662759005485e-01   +2.315877811029747e-01   +4.116713676842542e-01; +7.469309716282571e-01   +9.664824561876451e-01   +3.361280535159631e-01   +2.814822997065075e-01   -1.155405646611332e-01   +6.584679855666097e-01   +5.819433465333853e-01   +9.445798429966517e-01   -1.295784662933724e-02   +8.427146029398180e-01   +4.352790206005933e-01   +4.858862151729315e-01; +4.096523118708558e-01   +5.444427441774544e-01   +5.638000763609737e-02   -2.537935469543766e-01   +8.742371231927502e-01   +6.119432004418127e-01   +3.372512688252631e-01   +8.285653380392001e-01   +1.936035667887220e-01   +3.428719560214801e-01   +7.507214490818764e-01   +4.681071214202287e-01; +8.364848425804126e-01   +3.647051839763771e-01   +4.108901614230659e-01   +9.408518256980309e-01   +8.373801688825114e-01   +8.158771596561242e-01   +7.564399769845872e-01   +7.270897758849347e-01   +5.986483399915168e-02   +7.003409382257396e-01   +3.316738269163026e-01   +7.592777856673543e-01; +2.667126093522887e-02   +1.917307194462580e-01   +3.994327975340075e-01   -1.944376499618901e-01   +5.870552442917487e-01   +9.438960320093989e-01   +1.680707241703228e-01   +8.174158715207892e-01   +8.910736882720900e-01   +2.460218619198267e-01   +7.090460498875244e-01   -3.067630146293711e-01; +1.625151262284294e-01   +7.327649683122390e-01   +1.700954267827214e-01   +4.429975658395088e-01   +3.710164563604141e-01   +2.351734469339367e-02   +4.310344299810215e-01   -9.969411628257616e-02   +3.559420819757822e-01   +3.610433968664023e-01   +4.071642819887366e-01   +3.260795641252486e-01; +1.219191965526462e-01   +2.205680659556805e-01   +2.507982472457305e-01   +1.999354159137706e-01   +8.338613833713764e-01   +4.584507946652504e-01   +3.421969679367194e-01   +6.375878191842809e-01   +1.289914000730615e-01   +5.163784099813656e-01   +1.420628909048291e-01   +2.789923983734565e-01; +2.860642794138854e-01   +1.549033074814415e-02   +3.841389635984962e-01   +1.544934988172769e-01   +1.995143230052950e-01   -1.241817486719022e-01   +1.855132949067521e-01   +2.192783110171749e-01   -4.323494351627490e-02   +7.874851864197246e-01   +3.938203517622266e-01   +2.833364683923230e-01; +2.732792742745526e-01   +3.655311835503474e-01   +3.443402470782399e-01   +2.640402501124767e-01   +3.643998418018724e-01   +1.662940056506862e-01   +3.677886118854293e-01   +1.396766045477624e-01   +4.783972077788498e-01   -7.997996467971732e-02   +3.999825302312929e-01   +4.919499193857434e-01; +7.153676580445343e-01   +6.456204203163952e-01   +4.611545922457335e-01   +4.748797034431617e-01   -7.154786188879117e-03   +5.982964215528531e-01   +6.544819393954753e-01   +5.575868559248083e-01   +6.739672874416366e-01   -2.790404903851066e-01   +7.196530949996653e-01   +2.917300961092683e-01; +6.109516503082571e-03   +1.898085228129307e-01   +3.617650713335828e-01   +4.082774441802252e-01   +2.345390328342562e-01   +3.401080682858018e-01   +5.917297671989853e-02   +6.969867333954685e-01   +8.178580792459273e-01   +6.967813094837543e-01   +2.522318811911896e-01   +4.495850482464312e-01; +9.897019253473943e-02   +5.882022453414727e-01   +2.105935735611320e-01   +6.605536875262137e-01   +8.617866628434643e-01   +1.872196857891704e-01   +1.857340606987428e-01   +4.217642518598074e-01   +4.504920180591497e-01   +2.725051352431029e-01   +3.838646790592670e-01   +3.365693284325424e-01];
L3E_L3I_iGABA_netcon = [+7.077603343499809e-01   +9.480631484177969e-02   +2.070278981053828e-01   +5.759119272363429e-01   +4.359043020045318e-01   +9.347998316266063e-01   +7.328118056818673e-01   +8.876713905773872e-01   +5.881186466509760e-01   +2.740664817398739e-01   +2.882844174186757e-01   +4.156299398028387e-01; +3.662798362420778e-01   +2.361441998854925e-01   +7.521904099063346e-01   +9.116224774598279e-02   +4.462912796768408e-01   +8.101159171223810e-01   +9.706018507515369e-01   +2.230956672454590e-01   +2.356777218744237e-01   +3.198065458633252e-01   +4.541974548092506e-03   +5.791908126900043e-01; -6.988106378442255e-02   -4.167552589472913e-02   -2.961445064973303e-01   +4.997162099478525e-01   +8.256424869188229e-02   +4.768188854808178e-01   +4.214387972967383e-01   +6.143720843819258e-01   +6.212670183757533e-01   +5.088745869588158e-01   +5.006213703808747e-01   +3.161248180934582e-01; +3.335553903359487e-01   +6.315481370680064e-01   +5.740168155781147e-01   +1.683179218649497e-01   +6.567480689415343e-01   -4.993813799577046e-02   +4.747598378971072e-01   +2.373300089931963e-01   +4.920394859820116e-01   +8.723835047614505e-02   +5.593307496000064e-01   +2.836568251216204e-01; -2.105706065654587e-02   -1.615551738739692e-01   +4.618752770798021e-01   +4.215585141874442e-01   +2.410340143155348e-01   +2.085924133931678e-02   +4.274181196668196e-01   +4.453420196081150e-01   +2.133180541673299e-01   +2.488124029521829e-01   +4.010030706574790e-01   +5.030779160524018e-02; -7.751328225997316e-02   -5.029657303576190e-03   +6.973255102115627e-01   +5.817818945260710e-01   +3.979363187831426e-01   +1.459228253282522e-01   +7.042463961630524e-02   +2.090965372896208e-01   +2.895000400560037e-01   +4.599964196257276e-01   +5.898924974437892e-01   -1.406593766047699e-01; +5.874243424454090e-01   +2.151301781552322e-01   +4.094302304381770e-01   +6.831060492294019e-02   +5.177608306444313e-01   +3.439442757581084e-01   -1.047612015661539e-01   +6.962362775270196e-01   +4.448952899214507e-01   +4.636740692462687e-01   +3.920082332650650e-01   +1.706456118332365e-01; +2.427426495959864e-01   +1.267157134991822e-01   +9.913972735215482e-02   +5.410450383826760e-01   +6.365469541458826e-01   +2.725359904296616e-01   +4.136249404751934e-01   +8.157164687496724e-02   +4.437561208284798e-01   +1.146549032747976e-01   +4.985343085785583e-01   +5.870912613500485e-01; +2.844731527338250e-01   +1.990242442423399e-01   +3.867418645638498e-01   +7.478008319336416e-01   +4.867686248973344e-01   -2.452018691956947e-01   +5.361854819855794e-01   +4.633544751051858e-01   +1.897107023810251e-01   -1.215487836866982e-03   +5.535049776255889e-01   +6.107461251668174e-01; +2.534290859588182e-01   +6.670635802359561e-01   +8.374091952932622e-01   +1.000000000000000e+00   +4.169179914041545e-01   +2.469086847963911e-01   +7.975970355438903e-01   -2.551023152390828e-01   +7.831569063608732e-01   +4.626801942064967e-01   +1.065494866523234e-01   +1.510989572606336e-01; +1.544389243973100e-01   +4.553638767735161e-01   +1.231962981376051e-01   +5.576498366244874e-01   +5.114981606979552e-01   +2.322173660875934e-01   +5.088597548511890e-01   +5.205348382628512e-01   +6.623208457311321e-01   +1.519642882465159e-01   +2.194514959403912e-01   +7.345902358405400e-01; +8.069976800635470e-01   +1.896780310047970e-01   +4.018788637211303e-01   +4.479416511535679e-01   +3.784818269582694e-01   +3.811063936049320e-01   +4.270223888906432e-01   +3.254088245108264e-01   +2.029553585255193e-01   +2.245985288078656e-01   -2.151750641069528e-01   +2.623714552863289e-01];
L2E_Input1_iAMPA_netcon = [+5.243382185061956e-01   +6.043283995326227e-01   +5.572965000274844e-01   +7.657503865201050e-01   +9.626327097265220e-01   +6.651033513875367e-01   +9.469066307375900e-01   +4.526447268066664e-01];
L2I_Input2_iAMPA_netcon = [+8.701583340348154e-01   +5.072029230654183e-01   +6.817843495472508e-01   +6.083317726855766e-01   +5.101118771745412e-01   +8.306854037503771e-01   +2.098554514366944e-01   +6.036328292484975e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
