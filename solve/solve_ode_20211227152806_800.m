function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.701601711133280e-02   +1.502249515541757e-01   +1.072426098705801e-01   +7.871718714793496e-02   +2.853400819928659e-01   +5.009454349440643e-02   +1.267721554905379e-01   +1.449118497113489e-01   +9.721998389959385e-02   +1.669585155955449e-01   +3.724053453624137e-01   +2.960556275269691e-01   +1.283388516761519e-01   +1.749400671232559e-01   +3.063946211950226e-01   +1.388716253024169e-02; +9.359441518897155e-02   +6.882145996518511e-02   +1.087076887013192e-01   +2.164760562982924e-01   +1.347507779814742e-01   +2.738866278922434e-01   +1.455551817060460e-01   +1.297654735005219e-01   +1.188561555038667e-01   +9.302639738832466e-02   +9.366530781953800e-02   -3.631122893981497e-03   +2.851319825595663e-01   +1.698419852748021e-01   +1.675458605786052e-01   +1.974682034924503e-01; +2.102833436105119e-01   +1.109164868957244e-01   +1.065172305085282e-01   +5.379660227984406e-02   +6.498529712353210e-02   +1.034393251181603e-01   +1.907884537082175e-01   +9.156872177273293e-02   +5.410158283053444e-02   +3.132880702453025e-01   +3.102988232717380e-02   +2.246007335625844e-01   +1.883532672419499e-02   +2.290029814650287e-01   +1.454642703057454e-01   +2.704496958713034e-01; +2.576283430238292e-01   +2.814256806510185e-01   +3.230627274523047e-01   +2.910311971501391e-01   +2.798802692135166e-01   +1.298109224999856e-01   +1.566434704090687e-01   +2.944990455248870e-01   +5.245434604452499e-02   +2.027516119345631e-01   +5.517298220444068e-02   -4.478492706317992e-02   +2.089386058976967e-01   +7.607587349188218e-02   +2.774248337761773e-01   -1.768815283510785e-02; +1.002410471699284e-01   +1.988067999100909e-01   +2.924931923740986e-01   +1.784279286891335e-01   -2.224691183250579e-02   +4.808936856738780e-02   +2.692643960607905e-01   +1.827695898362947e-01   +1.006171939827870e-01   +2.043228265787241e-02   +6.331183335128554e-02   +1.091970784018192e-01   +2.419148972365429e-01   +2.090673870836661e-01   +2.400585541000856e-01   +3.083862144531859e-01; +1.530301534219976e-01   +1.681695756329860e-01   +1.390657072881117e-01   +2.691923756163125e-01   +4.315012237497273e-02   +1.067219605881611e-02   +1.786636481885093e-01   +2.169946830159838e-01   +2.408294571489653e-01   +1.739029581377896e-01   +2.959967705174069e-01   +2.828638574353823e-01   +1.080345099111636e-01   +1.758976788358512e-01   +1.041473675553887e-01   +1.148959822079906e-01; +1.933091587939004e-02   +8.247294828385701e-02   +1.618556654202463e-01   +2.915331447472900e-01   +1.027332590991933e-01   +5.349300195294564e-02   +1.867147789192666e-01   +1.910358165757869e-02   +2.903566667864680e-01   +4.565372249189818e-02   +3.187123568580771e-02   +2.023633609675407e-01   +1.027711760515029e-01   +1.374848220940803e-01   +1.935321612645084e-01   +2.007103244241432e-01; +2.456395510877589e-01   +2.767750117887212e-02   +9.163815159920645e-02   +4.430613770809103e-02   +8.732631466122527e-02   +3.441922642899728e-01   +1.123533118346480e-01   +1.345166729705300e-01   -1.090250452559742e-02   +7.241397275622018e-02   +1.673944804095169e-01   +1.453792980404950e-01   +1.057455686890896e-01   +3.046985175439039e-01   +6.298400781028289e-02   +3.414214293730231e-02; +2.003345309398302e-01   +7.785557518278069e-02   +8.274646005950288e-02   +1.928466056153461e-01   +2.338237110653812e-01   +6.621492059402595e-02   +9.624716230001684e-02   +3.045227104924876e-02   +1.940602503989147e-01   +2.365311125039844e-02   +2.260602421449776e-01   +7.945182760299555e-03   +6.810486702023594e-02   +1.483683537569676e-01   +1.734379497800484e-01   +1.239564299379082e-01; +1.835783524545445e-01   +1.587474686039065e-01   +2.229323210375231e-01   +1.338986958678715e-01   +2.595472389886704e-01   +3.077955552312153e-01   +9.881902665447767e-02   +2.421180797908950e-02   +1.164325213172183e-01   +2.817417544364298e-01   +2.039529963905903e-01   +9.008191189415116e-02   +3.268436042955862e-01   +2.290394350094608e-01   +2.366415715158614e-01   +3.155794524428572e-02; +6.245875158998841e-02   +8.519172013009573e-03   +2.356661599542308e-01   +9.645781201188672e-02   +1.046974336019794e-01   +3.374909181468445e-01   +2.236428210593063e-01   +1.016057590847733e-01   +9.864220780536800e-02   +1.267282634030966e-01   -2.745265482489531e-02   +1.844518385656770e-01   +8.976112794499216e-02   +1.055995922350016e-01   +2.684018225351288e-01   +1.087833897803712e-01; +4.075357694078326e-02   +1.161034985872217e-01   -1.592495753872529e-02   +1.512470804757588e-01   +1.326483823033225e-01   +2.436908302665340e-02   +3.361691460503006e-01   +2.656355311654167e-01   +1.691275431946268e-01   +2.026575407252284e-01   +1.331074696194295e-01   +2.491561395605435e-01   +1.949554177363539e-01   +2.245024434663968e-01   +3.122057213370600e-01   +2.704197483053689e-01; +2.932974730489809e-01   +3.079583620216596e-01   +1.159788111747363e-01   +2.271172486336925e-02   +1.781528956997662e-01   +1.509677915176619e-01   +2.237509494302994e-01   +3.733135587685697e-04   +2.616355176128958e-01   +3.228743115937097e-01   +2.255149531059541e-01   +9.478015669473532e-03   +9.790906136186799e-02   +1.675991383328194e-01   +2.067611652041441e-01   +1.236327974094297e-01; +2.816652327474217e-01   +6.465382100782449e-02   +1.950490022673068e-01   +2.203868344154886e-01   +2.596035367270427e-01   +8.580661798220285e-02   +1.433849442213192e-01   +8.201884710342155e-02   +2.188704633587395e-01   +1.635893788959024e-01   +2.656814881507077e-01   +3.080301738873518e-01   +2.081314285575821e-01   +2.398283802423761e-01   +3.583788641817782e-01   +1.425695349617114e-01; +2.412259471833590e-01   +1.019565117530502e-01   +2.372762772066425e-01   +2.677862733299846e-01   +1.856119706696027e-01   +4.690268848273026e-04   +2.580602262832419e-01   +1.465005950702631e-01   +1.537653829698420e-01   +1.426961092650736e-01   +3.247878133868022e-02   +1.682692977412544e-02   +3.290603148962897e-01   +3.460084842244036e-02   +1.550089858743234e-01   +3.024930251240842e-01; +2.959921116539374e-01   +1.567861265035994e-01   +2.582319454127457e-01   +4.173472330923449e-02   +1.922490841416764e-01   +1.861277579997102e-01   +2.077912005943429e-01   +1.967151084990299e-01   +2.076894964706520e-01   +1.013226669430249e-01   +6.283737594628672e-02   +9.396712099422880e-02   +9.852533906222542e-02   +5.758912415222742e-02   +2.141509989329448e-01   +1.896390207042010e-01];
L1E_L1I_iGABA_netcon = [+4.322567061834350e-02   +3.270809542468434e-01   +3.546936866325729e-01   +2.296699895356931e-01   +2.366470592974924e-01   +2.028378331759039e-01   +2.847811097327048e-01   +4.773702240757892e-02   +3.124825450850481e-01   -1.828064090716422e-02   +2.839558670774259e-01   +1.212844015189210e-01   +6.236485251011679e-02   +3.203043077456884e-01   +1.319249864513871e-01   +2.889820383885409e-01; +2.572482795475713e-01   +1.518482780568791e-01   +2.104398783523131e-01   +4.883494960995002e-02   -4.300695322695780e-02   +2.026166588101431e-01   +1.836127275625729e-01   +2.237358629330876e-01   -2.365964734906577e-02   +2.817071002194368e-02   +3.278775192499194e-01   +8.056915624364952e-02   +2.039737797158631e-01   +1.918687069210404e-01   +7.126314976025247e-02   +2.151902506785797e-01; -1.787570542376424e-02   +1.795402253241753e-01   +1.223528109779807e-01   +1.186848497317859e-01   +7.809108698642292e-02   +6.906837095624606e-02   +1.831504072195800e-01   +2.064902433454374e-01   +6.188548803968227e-02   +9.208654910096689e-02   +2.162054682827123e-01   +2.016625892670138e-01   +1.491903745284405e-01   -2.470499798289803e-02   +1.742874921677919e-01   +1.973307647037900e-01; +1.128353044399487e-01   +1.900310430394755e-01   +2.464450598674559e-01   +1.727669233674927e-01   +1.856065137608993e-01   +3.200390337513277e-01   +2.555171517012951e-01   +1.449716382200415e-02   +1.835235187643489e-01   +2.473479947405995e-01   +1.556518619426711e-01   +2.780699941330333e-01   +7.929105096492001e-02   +2.220170655732951e-01   +5.118907832145851e-02   +7.040648093355356e-02; +1.322792897798873e-01   +2.965992410327451e-01   +3.402515575336268e-01   +3.129283339353868e-01   +8.620306507507668e-02   +1.088380466699742e-01   +1.797411433600888e-01   +2.206536713472129e-01   +2.538647165462797e-01   +2.086650380610949e-01   +2.547566379768577e-01   +2.015622564683835e-01   +8.659217980070716e-02   +2.868775971042015e-02   +1.196179927051091e-01   +2.973033050747363e-01; +2.400844338681776e-01   +2.049906915470097e-01   +1.696369661984998e-01   +2.474024162205817e-01   +1.835518209031570e-01   +4.627905448520678e-02   +4.378046876142282e-02   +9.197575890155391e-02   +2.766254272689185e-01   +1.874785694075907e-01   +2.440686239599195e-01   -4.025284895773810e-02   +1.112394060554045e-01   +3.304956048913972e-02   +8.537522478418699e-02   +1.678561840199468e-01; +4.181091058071016e-02   +2.187420663483440e-01   +2.792759791428475e-01   +8.761896603080761e-02   +1.634492215730333e-01   +4.121646084859044e-02   +2.569746177182221e-01   +2.410024250447972e-01   -8.221452301662206e-02   +2.494656398351957e-01   +1.271126264314700e-03   +2.057578789841419e-01   +1.874464213330554e-01   +2.179440271585932e-01   +9.866534427031740e-02   +3.919697341391670e-02; +5.970439503491270e-02   +1.715719106871901e-01   +1.404934441495305e-01   +7.023786159218905e-02   +1.716777812293723e-01   +5.158206405457681e-02   +6.415143923534981e-02   +5.082354539949410e-02   +2.516435772167854e-01   +1.874630111899074e-01   +9.278366787199964e-02   +9.475201623514212e-02   +9.554731761336466e-02   +8.912072433409476e-02   -2.936728260502499e-02   +3.129763993409844e-01; +1.637603076122271e-01   +2.562503757977403e-01   +2.687045213974071e-01   +1.795556833270742e-01   +8.754022021382896e-02   +7.684397424230697e-03   +6.364381064615177e-02   +6.377401083934162e-02   +2.265501088794186e-01   +5.401157263865003e-04   +5.628241576007987e-02   +2.469811193509939e-01   +1.701082861904328e-01   +1.667926664328127e-01   +2.999371781795479e-01   +2.589689036022855e-01; +9.755816719776758e-02   +2.694352113118280e-01   +6.221884972846631e-02   +1.763140690306208e-02   +6.065327254961780e-02   +1.508885681483748e-01   +1.204120190101956e-01   +7.904644027847332e-02   +2.717442763887093e-01   +6.349959179566302e-02   +1.587765063082899e-01   +8.619991132823837e-02   +2.315083433634338e-01   +2.591117937665445e-01   +2.345455025456167e-01   +1.513198904277910e-01; +1.754640235607499e-01   +1.667741312497840e-01   +1.211464615801100e-01   +8.790794062981211e-02   +2.452167090026146e-01   +2.773675389236093e-01   +2.143653915400232e-01   +2.928846263903042e-01   +1.697789393068925e-01   +1.270823074051982e-01   +5.715118627801448e-02   +2.793748114541469e-01   +8.010237365652258e-02   +7.078200131148236e-02   +1.373106424938643e-01   +1.610815298620339e-01; +2.526153075491452e-01   +4.178793214687393e-02   +4.505289980383151e-02   +1.914221959673868e-01   +2.442368565274559e-01   -1.092158838871932e-02   +1.824213903165693e-01   +1.770300808862340e-01   +1.780010625523798e-02   +1.406055708042036e-01   +1.702313932014436e-01   +7.713718461535490e-02   +4.630843278096733e-02   +1.926158317223476e-01   +2.575428296816618e-01   +2.286580401667466e-01; +9.289712881952659e-02   +1.085041144333463e-01   +1.717157338175970e-01   +2.264638461581684e-01   +1.277068883946991e-01   +1.139612255976020e-01   +2.179708706130399e-01   +1.846357584433321e-01   +2.216369446839068e-01   +3.203477630047578e-01   +1.824241633610267e-02   +1.153953920371200e-01   +8.010448987693811e-02   +1.662583688833900e-01   +1.507313858118958e-01   +1.807015616606581e-01; +9.277231780367061e-02   +9.885212910557525e-02   +1.224686856431828e-01   +1.347704179964169e-01   +2.114290251990863e-01   -1.400485717171083e-03   +2.093404795724147e-01   +9.376267829865655e-02   +1.582382317315528e-01   +1.490411971457531e-01   +1.827107356982094e-01   +9.157369785362993e-02   +2.849132711261749e-01   +2.966891622924138e-01   +9.874315614428851e-02   -5.586012606917655e-03; +1.008341094803737e-01   +5.196258701032675e-02   +5.686801976905508e-02   +2.363719254242931e-01   +2.065688494563907e-01   +1.001702605123177e-01   +1.310030152401082e-01   +1.759551448905094e-01   +2.021020685691761e-01   +2.041077026256014e-01   +1.330476740670617e-01   +1.500266251398882e-01   +5.796424977972933e-02   +1.358953209683071e-01   +2.527016959437695e-01   +2.407054769408838e-01; +1.370268737747654e-01   +1.138820222554289e-01   +1.479831918691694e-01   +1.024356748113935e-01   +1.261189480799206e-01   +3.138210649076287e-01   +2.275171296988070e-02   +2.146702776595327e-01   +1.197914873181051e-01   +2.503871686351247e-01   +1.366798671907324e-01   +1.712691162590593e-01   +1.673254091704434e-01   +3.524321456566892e-01   +2.952231803542422e-02   +2.042268550105189e-01];
L2I_L1I_iGABA_netcon = [+2.246578990603012e-01   +2.528925046255921e-01   +1.835088558785060e-01   +1.447079934152335e-01   +1.015745203892267e-01   +2.294697359929143e-01   +1.085005999696267e-01   +2.553957129789337e-01; +3.490181231058948e-02   +1.821508224219053e-01   +6.013134194549522e-02   +1.734554209459400e-01   +1.783606235261114e-01   +2.414063849327754e-01   +2.088947686847788e-01   +4.500142687880400e-02; +5.140104457896433e-02   +1.300351526521972e-01   +2.194155323802719e-01   +1.427969701419589e-01   +2.390924785789294e-01   +2.398571611714064e-02   +2.677273159759778e-01   +2.945833081939230e-01; +7.684596665145089e-02   +2.419523938093045e-01   +8.696315649314379e-02   +1.403293567078982e-01   +1.001758953649231e-01   +2.481286960922950e-01   +1.462257450618530e-01   +3.211471523522755e-01; +2.378921440524973e-01   +1.548085139685995e-01   +1.426920362794718e-01   +1.315071069693016e-01   +3.000583623305108e-01   +2.824720349182117e-01   +1.001946205569891e-01   +2.135092179370244e-01; +2.268354329437676e-01   +2.385502581401748e-01   +3.117777853367721e-01   +2.038722106786639e-01   +2.223218583969318e-01   +1.816409144625931e-01   +1.742077928872302e-01   +2.229476521981400e-01; +2.906142161095442e-01   +8.556364378687177e-03   -6.017809174891114e-02   +2.542143692144211e-01   +2.928022462926434e-02   +7.834331559008405e-02   +1.604627219507211e-01   +1.067002165391518e-01; +1.782436281100228e-01   +8.938983706382669e-02   +1.360763300568383e-01   +3.230681649577082e-01   +1.093464986439131e-01   +2.141561295977089e-01   +9.113556472339099e-02   +7.513613870414759e-02; +2.259271198902037e-01   +1.642956473479738e-01   +4.733663587257839e-02   +1.625078836462199e-01   +1.710508447923896e-01   +2.463401673572856e-01   +3.406094485806941e-01   +2.914914430811921e-02; +1.634961488194397e-01   +2.641113516787765e-01   +1.904488074090910e-01   +2.695071409316299e-01   +2.835774043627145e-01   +5.606429057286741e-02   +3.727338469884016e-02   -7.675101721806604e-03; +2.423208515199391e-01   +2.918584212816109e-02   +2.194872753611832e-01   +1.575029874113637e-01   +1.441464340116342e-01   +3.067792647996260e-02   +2.410036899948859e-01   -7.680766818113557e-02; +1.344574173712417e-01   +2.741971564012910e-01   +1.238838457826494e-01   +1.976225957709596e-01   +2.803356275874351e-01   +1.029004466075989e-01   +1.032417519699147e-01   +7.223789689602857e-02; +1.747975884885992e-01   +6.635130681383798e-02   +5.060830249440013e-02   +2.566455356112480e-01   +9.070081959654878e-02   +2.695826272856838e-01   +1.931304078824058e-01   +1.612818800652091e-01; -2.029158792311412e-02   +2.433940071715303e-01   +5.711740878110536e-02   +1.689957712108207e-02   +1.346582103274353e-01   +1.422621966797545e-01   +3.152502434174805e-01   +1.460745179436883e-01; +5.720518962134920e-02   -4.237558405078401e-02   +1.840052973541138e-01   +1.581629207394902e-01   +1.715373371752603e-01   +2.205005672871067e-01   +2.787358282299658e-01   +1.310551111827233e-01; +7.634383998453632e-02   +2.264103916264812e-01   +2.826352573571510e-02   +2.324429187925700e-01   +5.252870236124875e-02   +1.482844026852703e-01   +1.034540477352914e-01   +8.353502482445690e-02];
L1I_L2I_iGABA_netcon = [+3.248276858413213e-02   +1.586534375847736e-01   +7.543737578291851e-02   +3.876270490095590e-02   +2.924463345445383e-01   +1.385097725744084e-01   +8.597200382009339e-02   +1.680740467433556e-01   +1.293047867057698e-01   +6.762758923012127e-02   +1.093541081203473e-01   +2.006209586924055e-01   +3.965363587450270e-02   +3.418592350532886e-01   +5.380088102311432e-02   +1.163633951490292e-01; +2.382660811810610e-01   +1.386329311330147e-02   +1.058530482333463e-01   +2.328220122012048e-01   +9.384062173461881e-02   +2.087872155963645e-01   +2.136858236457296e-01   +1.674638845169763e-01   +2.518771186263705e-01   +2.928919484543868e-01   +9.935133077342024e-03   +5.758930886518503e-02   +1.960371896348634e-01   +1.013344633815651e-01   +4.690556628024783e-02   +1.875890386278581e-01; +1.639159880444848e-01   +2.261985483410656e-01   +2.068596329115196e-01   +1.886272223860176e-02   +1.698899084853664e-01   +5.569661887303477e-02   +8.055096450420271e-02   +1.101274678174674e-01   +1.676931101621106e-01   +3.266381234920006e-01   +2.683990587878357e-01   +1.063769016147531e-01   +1.805092461120836e-01   +1.109948383583536e-01   +1.021252189178362e-01   +1.200937265947574e-01; +1.957849788898027e-01   +1.361690653275054e-01   +2.121852869834850e-01   -5.993933965954563e-03   +1.470321604903257e-01   +5.131271556922574e-02   +1.398050561252434e-01   +1.290693140245539e-01   +1.796130393975016e-01   +2.712977043051038e-01   +2.895564135763538e-01   +1.567489026933879e-01   +2.612992737895786e-01   +3.186139937266207e-02   +3.093116669123921e-02   +2.513207106860851e-01; +1.868394606516641e-01   +2.308122539955117e-01   +2.085966660227231e-01   +1.033226251665176e-01   +1.961158510205126e-01   +3.331946929523485e-01   +1.198835727416506e-01   +1.429216747603975e-01   +1.559444046761789e-01   +2.093734444382139e-01   +1.588001118148146e-01   +2.399075800756899e-01   +2.656019940623235e-01   +5.144437549352690e-02   +2.321617130111919e-01   +3.426406093298738e-01; +1.116608302997768e-01   +1.423559635917289e-01   +1.340070588553186e-01   +2.113847155714528e-01   +3.289711959098129e-01   +1.056125119959593e-02   -1.352521260280322e-02   +1.927264717004552e-01   +2.118717737864993e-01   +2.631652823767785e-01   +1.878851080534995e-01   +1.514163883770398e-01   +1.991362627385372e-01   +1.805324397784229e-01   +2.225201858362460e-01   +2.984884275377762e-01; +2.718061362519045e-01   +1.236328316098301e-01   +2.780616440110806e-01   +2.822471080014399e-01   -9.655441978938773e-03   +2.349777435747663e-01   +1.655462747172809e-01   +1.251709613560241e-02   +6.687996190619881e-02   +2.970408524108522e-01   +2.766009610312777e-01   +2.866318758696856e-01   +1.605558808395094e-01   -7.330147839637488e-03   +1.588100986193096e-01   +1.532501664603257e-01; +8.914581382665755e-02   +6.690748454727363e-02   +1.815023394839343e-01   +1.568579887509725e-01   +9.111567159397432e-02   +2.708093656636872e-01   +1.936198310310946e-01   +4.786474216618851e-02   +2.896163797766053e-01   +1.354770255122709e-01   +2.545678806890391e-01   +2.808423003714459e-01   +2.161561339352118e-01   +1.338125425050266e-01   +1.582768413331823e-01   +4.478287493875346e-02];
L2E_L1E_iAMPA_netcon = [+1.683292179823992e-01   +2.354276114236392e-01   +3.320023104127297e-01   +9.573766324696116e-02   +7.816792430390242e-03   +1.405758572967722e-01   +8.013254885382268e-02   +1.084677325900036e-01; +1.188994764793690e-01   +2.403327577521548e-02   +2.365660503157386e-01   +1.831533180939154e-01   +1.188345048721295e-01   -4.450570534582057e-03   +2.163685478023622e-01   -2.856708303403534e-03; +1.603398161209681e-01   +6.690997506405411e-02   +1.192094429286368e-01   +2.743127088160439e-01   +2.312213723828918e-01   +3.584281940292875e-01   +3.130670851566811e-01   -1.583601769768164e-02; +2.202363623776283e-01   +1.472129675721627e-01   -1.707815254625467e-02   +5.554566704684018e-02   +7.210162422975307e-04   +3.075269712970983e-01   +1.590710521690685e-01   -1.619394159087309e-03; +1.687614156458022e-01   +2.346408356290403e-01   +2.753720499748463e-01   +1.636549737247855e-01   +1.228091096667017e-01   +1.891172143856297e-01   +1.880237084159370e-02   +2.948821194386744e-02; +3.012193347572034e-01   +3.508138913686313e-01   -4.153917479898651e-02   +2.740124883325450e-01   +2.499490178225121e-03   +2.270391603033546e-01   +1.259266464533760e-01   +2.232211717627657e-01; +2.266121755241548e-02   +2.791613569588154e-01   +1.335697360063444e-01   -3.565921288127764e-03   +6.978380449625740e-02   +2.916805426896760e-01   +1.808268789372386e-01   +2.887884792120717e-01; +2.066375405825010e-01   +3.029327582585891e-01   +1.765317232309989e-01   +2.177385399306163e-01   +2.762664032904943e-01   +1.959576011398796e-01   +2.474339832082652e-01   +1.512525457969302e-01; +9.192809091599277e-02   +5.994033427797665e-02   +1.048303630842827e-01   +1.212538297156739e-01   +3.306992079909114e-01   +2.560684008116905e-01   +2.117730135860383e-02   +1.854335450140362e-01; +9.268904724319305e-02   +2.741658982061840e-01   +2.395809093369960e-01   +2.694895153578761e-01   +3.349215195324288e-01   +1.033756120326259e-01   +2.358807881740087e-01   +7.328368120798186e-02; +1.941099461153680e-01   +2.179771076486747e-01   +3.845303745162313e-02   +2.282019206707291e-02   +1.724044407004286e-01   +3.018053634757912e-01   +2.018662906987431e-01   +6.243928375442322e-03; +3.209542238943378e-01   +1.280922583293021e-01   +8.838698809728623e-02   +1.942172664369381e-01   +2.464609760768213e-01   +4.017410397299204e-01   +1.476281608138633e-01   +2.405070845685057e-01; +1.350693803165652e-01   +2.736387954868660e-01   +3.296251117141217e-01   +9.725010078281987e-02   +2.510082889288346e-01   -4.347256802757361e-02   +2.147484058584195e-01   +2.579528884338441e-01; +1.954517905272189e-01   +8.753840029616830e-02   +1.856851400723976e-01   +9.254319077122508e-02   +1.634648764338947e-02   +1.916994623669325e-01   +2.387616810427325e-01   +1.267052516250201e-01; +2.219245780940035e-01   +2.084160317437011e-01   +1.855352581252399e-02   +3.161756722308996e-02   +1.455756155471496e-01   +2.531038113474558e-01   +1.570375070948075e-01   +6.097342800856234e-02; +1.617939748315412e-01   +1.825291047844599e-01   +1.900946770446498e-01   +5.460347379429808e-02   +1.794513739381427e-01   +9.741459946843588e-02   +2.335718142839173e-01   +6.103966057089026e-02];
L1E_L2E_iAMPA_netcon = [+1.064708557301341e-01   +1.267817115785305e-01   +2.691851070387568e-01   +1.728700483355192e-01   +2.349991943995812e-01   +2.732032181410091e-02   +1.776707269264378e-01   +2.835525763817858e-01   +1.367470349749403e-01   +1.352824974359901e-01   +2.350801216684565e-01   -6.520581319686178e-03   +1.399511611619859e-01   +1.911328183911736e-01   +2.330652361826994e-01   +3.009021467074514e-01; +2.597336768254944e-01   +2.912267671979985e-01   +2.356395566285980e-01   +7.104662846438335e-02   +1.372106324677577e-01   +2.208609630671753e-01   +2.741561481748264e-01   +4.593826772658822e-02   +6.526204282558459e-02   +1.973337715422667e-02   +3.033615309688171e-02   +7.526067010340214e-02   +2.601759514983738e-02   +8.081813360780074e-03   +2.372880264133985e-02   +8.760172814223494e-02; +8.497443373123312e-02   +2.860033128637761e-01   +3.415904308390256e-01   +2.624905412234144e-01   +6.259677813617866e-02   +2.397867083171181e-01   -2.985484718441477e-03   +2.685619696536141e-01   +1.870013763268671e-01   +1.438491873760559e-01   +5.138707321957287e-02   +2.332973512663350e-01   +1.571804356025643e-03   +3.920488450782111e-02   +1.613198150841334e-01   +2.285461150526690e-01; +1.302465565771887e-01   +1.303228322493526e-01   +1.336273835149891e-01   +2.970636761946153e-01   -1.283387405073388e-02   -1.677007832204656e-02   +8.386311097501638e-02   +2.193168072693963e-01   +2.885331913486966e-01   +2.539639835693417e-01   +1.942090119927011e-01   -1.902253456292205e-03   +1.267963038574709e-01   +8.684831333355424e-02   +6.577262092760958e-02   +1.682758933599136e-01; +2.165236922521980e-01   +1.025069353959816e-01   +3.568066050286026e-02   +4.547465891258675e-03   +2.912566702847188e-01   +2.833117497799746e-01   +2.974347597626008e-01   +1.591928606199246e-01   +7.554703739395399e-02   +9.155895226154985e-02   +2.689497423638563e-01   +5.185986701583198e-02   +1.713810032103061e-01   +2.419265538526436e-01   +1.333574702037678e-01   +6.939797819133854e-02; +2.649333921340965e-02   +1.459229566961485e-01   +2.488050721169072e-02   -1.177913684583958e-02   +2.156107842150671e-01   +1.020797507565710e-01   +1.624710511845697e-01   +2.724680070140556e-01   +2.832630346675072e-01   +2.586573191918269e-01   +2.602553631362403e-02   +2.127781863414244e-01   +2.473054526637189e-01   +1.473925770114798e-01   +1.937307627066120e-02   +1.170668198402506e-01; +7.749616483143984e-02   +9.598350481127721e-02   +4.126921264889840e-02   +1.263111559629940e-01   +8.273776451824513e-02   +5.346099393650419e-02   -1.988034545499609e-02   -1.783090754143487e-02   +1.232610634195787e-01   +1.619755684084094e-01   +1.032907518898224e-01   +7.030363034366549e-02   +2.988191129818372e-01   +2.492966936557448e-01   +2.867217042999635e-01   +1.283867042481276e-01; +5.063052100227552e-02   +5.199344204271106e-02   +2.644566190104595e-01   +2.831986015365530e-01   +2.750741347517452e-01   +1.558202413671080e-01   +2.918947939846571e-01   +7.347537218214632e-02   +1.329780576671817e-01   +2.631492267309277e-01   +3.099619717236099e-01   +8.651271180943861e-02   +1.602556328182640e-01   +9.721675775395429e-02   +2.463175422681344e-01   +1.862567687112270e-01];
L2I_L2E_iAMPA_netcon = [+1.209351755115807e-01   +1.988552778507546e-02   +4.056733831933548e-02   +1.478101392138424e-01   +2.928763896081535e-01   +1.510550610726213e-01   +3.510217610464400e-02   +1.898023574415054e-01; +7.851844169274719e-02   +9.805055874371486e-02   +2.624548829015514e-01   +2.189455077073232e-02   +2.114973618456976e-01   +1.295910844057698e-01   +8.288596971690043e-02   +1.868298841189254e-01; -4.005857350382111e-02   +2.826431006435488e-01   +9.853323868769462e-02   +1.531005786185476e-01   +2.452526356249590e-01   +2.968787941467239e-01   +2.110122891692754e-01   +7.620264709664248e-02; +2.675837672760539e-01   +2.991659635449330e-01   +3.100869634971998e-01   +2.274565718770883e-01   +2.150649127050260e-01   +1.549181618099901e-01   +9.163907920812783e-03   +1.892202951602898e-01; +2.268137169096018e-01   +2.604986035499642e-01   +7.374574339160896e-02   -1.965429619913996e-02   +1.329204836713982e-01   +2.583955177027964e-01   +7.560696110308185e-02   +3.075584922907145e-01; +1.520009361652087e-01   +1.494171001306456e-01   +2.759129172861900e-01   +1.530651640802553e-01   +4.830931059493189e-02   +5.525019990163297e-02   +5.089554464682013e-02   +1.915937670534351e-01; +9.760520024721499e-02   +1.901339015223747e-01   +2.694000314808556e-01   -1.736744905539652e-02   -4.674372833020733e-02   +6.495366298653805e-02   +1.212727788084258e-01   +2.958312199270514e-01; +1.644682245851559e-02   +1.219758160876359e-01   +1.616513325178869e-01   +3.868558742622007e-01   +2.707000704147258e-01   +2.659619584027882e-01   +2.994563099076029e-01   +1.168933357432055e-01];
L2E_L2I_iGABA_netcon = [+2.740868802812478e-01   +1.536341054908371e-01   +2.171760054086841e-01   +1.089080188716079e-01   -4.612005475761349e-03   +2.772404422372786e-01   +3.073844609520677e-01   +2.702147438017957e-01; +3.750655687330771e-01   +5.998262200034683e-02   +1.068126925332524e-01   +3.225402447753370e-01   +2.253525555582070e-01   +3.243645147083041e-02   +1.267819910579891e-02   +2.429641694080327e-01; +9.811825807444206e-02   +1.826768072098634e-01   +2.392017658128792e-01   +1.419117636864992e-01   +1.166740090836220e-01   +2.749856457361641e-01   -7.698042904518938e-03   +1.682522973587129e-01; +3.307154921330758e-01   +1.644619874161780e-02   +9.364223869457480e-02   +3.275338067560528e-02   +2.569628265176632e-01   +2.755905848745944e-01   +2.189379114840908e-01   +1.343069777079792e-01; +1.922216849329579e-01   +1.774495673756818e-01   +3.444918500783118e-01   +7.975011773265109e-02   +2.154551640052179e-02   +2.171317982503517e-02   +2.527573125515132e-01   +1.126849675409148e-01; +2.373316243205055e-01   +7.790802018946019e-02   +8.538933134813374e-02   +1.244282010519607e-01   +8.822384811972593e-02   +2.983399797180489e-01   +1.773769945382269e-01   -2.995676651195094e-02; +2.216612368640269e-01   +2.037786578618186e-01   +1.729966352258075e-01   -4.786988358881496e-03   +1.087287401738399e-01   -2.394812927931896e-02   +2.468618003057865e-01   +5.565312273520809e-02; +4.867068369465827e-02   +1.475274949346576e-01   +1.742590934690425e-01   +1.674055104198136e-01   +2.648202268362020e-01   +1.750576875576810e-01   +9.994096055721796e-02   +6.453860989704184e-02];
L3E_L2E_iAMPA_netcon = [+1.464276808831085e-01   +1.943865714869280e-01   +1.117171055628105e-01   -1.441256348737882e-04   +1.506325714227065e-01   +2.385596462087632e-02   +2.785993061871098e-01   +2.222638218765880e-01   +2.514315117244588e-01   +1.796292986799969e-01   +8.759520315765708e-02   +2.421970769842083e-01; +1.396417819674224e-01   +2.602647286018436e-01   +2.493848262923688e-01   +2.644047711488440e-02   +2.289461980320244e-01   +2.360644315078112e-01   +2.362611438423577e-01   +6.425906529712645e-02   +2.226200793069798e-01   +8.191081635891656e-02   +2.123707753905504e-01   +2.533775919512316e-01; +2.352788271928155e-01   +1.741459916622148e-01   +2.633191356532730e-01   +2.948675224919065e-01   -3.516535606108773e-02   +1.007354015151157e-01   +1.769972953206223e-01   -1.237291504332858e-02   +1.484738492711403e-01   +2.651289019731083e-01   +1.432189205356263e-01   -1.911948141932458e-02; +2.223455022539560e-01   +1.628844297340448e-01   +2.383366612318986e-02   +5.510960103930553e-02   +2.736157685504185e-01   +1.209378630451206e-01   +4.872268728456623e-02   +1.425741788864130e-01   +4.270831634162815e-02   +1.303671746953872e-01   +1.855229878267125e-01   +2.535296480533225e-03; +2.320828345222595e-01   +3.221002910424336e-01   +2.848104798568638e-01   +3.175006808640986e-01   +2.657580227195226e-01   +3.154805800625998e-01   +2.070689154283930e-01   +4.954543596705106e-02   +1.521489080555175e-03   +4.311495239816416e-02   +1.809687354648006e-01   +1.670448139199567e-01; +8.001725884836257e-02   +1.403788401511837e-01   +5.503979886283811e-02   +1.244485281249611e-01   +2.122967303616229e-01   +1.875031245218114e-01   +2.934927705904498e-01   +2.794736423943877e-01   +2.845678815620337e-01   +1.057519596481223e-01   +3.277319395509928e-01   -6.720766717161797e-03; +2.524343680139156e-01   +6.920548908249706e-02   +8.329479797862614e-02   +4.550801837634260e-02   +5.901021375670463e-02   +1.085260688587836e-01   +1.623197345955350e-01   +1.102989531139308e-01   +6.506501099423657e-02   +9.035402632566818e-02   +2.903016377995487e-01   +2.979425740222613e-01; +2.845070251435754e-01   +2.779576980508071e-01   +1.335259771958600e-01   +2.458694208248867e-01   +2.246477076703119e-01   +1.175612805418963e-01   +1.064737861338909e-02   +9.521836442625958e-02   +8.190312644852699e-02   +3.818497502365336e-02   +1.717402931836433e-01   +3.836427104051410e-02];
L3I_L2I_iGABA_netcon = [+1.525570418182750e-01   +3.250907915234933e-01   +2.574829530335095e-02   +2.412361567331113e-01   +1.282313557891728e-01   +2.557922671255842e-01   +2.069174684991789e-01   +3.987144426857774e-02   +8.763449871311561e-03   +2.068525992096509e-02   +2.186733823668837e-01   +9.828732310010320e-02; +2.022771706995517e-01   +2.276463262769902e-01   +1.736846242487605e-01   +2.081040665176738e-01   +2.432548471677738e-01   +1.046446090727782e-01   +2.981201145043721e-01   +5.029725472475356e-02   +7.048672364591264e-02   +1.119212731795435e-01   +1.521917256948674e-01   +3.583391411016113e-02; +1.697375476136359e-01   +2.208062339193561e-01   +1.977876972089481e-01   +1.895479195211289e-01   +1.839276773968936e-01   +1.593457421816813e-01   +1.364857580334737e-01   +2.104950974717634e-01   +2.018583940075572e-01   +3.074820551361721e-02   +2.444283950735710e-01   +2.095490515520854e-01; +2.832201321480506e-01   +2.991016618775761e-01   +2.810736586283630e-01   +1.000863570806298e-01   +1.885737478302910e-01   +2.914787061999440e-01   +4.132767267512050e-02   -1.471192942816398e-02   +2.541581637414134e-01   +2.675379128869198e-01   +5.738564820161668e-02   +2.051793310335039e-01; +1.026225903992674e-01   +2.762097459443066e-01   +3.006757271318155e-01   +2.654934253702937e-01   +2.641554714245611e-01   +8.109592089896674e-02   +1.243802910297841e-01   +2.179222998349219e-01   +1.139301199804273e-01   +2.909966668688525e-02   +5.857441286758429e-02   +6.191450637941984e-02; +1.422465969193314e-01   +8.899726784402240e-02   +2.446460196475245e-01   +1.394577073357101e-01   +2.012073374526343e-01   +2.309581900220390e-01   +1.495496023809161e-01   +1.617501780153507e-01   +4.673771206009758e-02   +1.053996195097579e-01   +1.889407720325821e-01   +1.741279209896277e-01; +1.335121935974112e-01   +9.970982145595901e-02   +3.020706139655008e-01   +2.459980353705604e-01   +1.371396685911331e-01   +2.583519306275828e-01   +4.366678537916414e-02   +4.024661906636032e-02   -2.171136111433579e-02   +2.445024174553597e-01   +2.957529992888870e-01   +1.002827249063524e-01; +1.695773313185981e-01   +6.102313491793885e-02   +2.488357765198740e-01   +4.244194805411458e-02   +2.485875586875102e-01   +2.808311774050155e-01   +2.307388404866180e-01   +2.203557943337289e-01   +1.332660777702505e-01   +2.267753340106848e-01   +2.297873184431558e-02   +2.761701625947701e-01];
L2E_L3E_iAMPA_netcon = [+2.394589455365954e-01   +1.049583624578624e-01   +2.402717200800799e-01   +1.938292989284320e-01   +1.625455676165510e-01   +1.449818169064878e-01   +1.638787671189627e-01   +5.455081227945725e-02; +1.729656046858301e-01   +1.819992293281729e-01   +2.058732459570080e-01   +1.751004439349438e-01   +2.615734982002828e-01   +1.113419089504407e-01   +1.378603423619540e-01   +2.495894419393946e-01; +5.826928861665773e-02   +4.992542241745691e-02   +2.023416911347663e-01   +2.515001732049471e-01   +2.291913099230237e-01   +2.593284979708108e-01   +1.807050255966292e-01   -3.828102255277706e-02; +1.069753347800809e-01   +5.752293532928623e-02   +1.506748227051036e-01   +2.602857678950709e-01   +1.003713509589726e-01   +2.947316424799261e-01   +1.903059097451580e-01   +1.031534486956916e-01; +8.182876231780822e-02   +1.927715262090886e-01   +3.208845059355090e-01   -1.788198681046752e-04   +2.111118074454924e-01   +2.247031367114591e-01   +2.121005167989158e-01   +6.488541296177670e-04; +3.521878848940215e-02   +2.918109555816645e-01   +2.255683797146220e-01   +4.627934911289926e-02   +3.282952409938876e-01   +1.423391884506738e-01   +8.915518055884060e-02   +2.248529862865916e-01; +1.219553326630090e-01   +4.860548631326737e-02   +1.648940823344905e-01   +6.068120487812837e-02   +1.006490661340257e-01   +1.841251179453672e-01   +2.556592985292343e-01   +2.040339384832079e-01; +1.597035398597718e-01   -3.036101183475183e-03   -2.659290806420025e-02   -1.302828304357073e-02   +2.937812274062290e-01   +1.197875383880780e-01   +5.350303338653184e-02   +2.375040137013040e-01; +3.230182139136737e-01   +2.416407123067263e-01   +9.859738658739421e-02   +2.518785206571966e-01   -3.287723461026305e-02   +1.227606497877210e-01   +2.321262815656226e-01   +1.025778551029603e-01; +2.537467193707019e-02   +1.170641530219298e-01   +2.749917954537823e-01   +4.228618480401401e-02   +7.802743897414831e-02   +9.816078319585739e-02   +3.181607106463936e-01   +2.763044904377303e-01; +2.299384639016682e-01   +1.770199783119838e-01   +1.148889441435126e-01   +1.588400191870493e-01   +1.159683260292461e-01   +6.132332572416761e-03   +4.972340697588976e-02   +2.377606049797512e-01; +2.345915832534410e-01   +5.607404290203131e-02   +3.186548352362994e-01   +2.331187679783268e-01   +2.226437221110616e-01   +2.566583899620496e-02   +1.617297921692342e-01   +1.120566722775358e-02];
L2I_L3I_iGABA_netcon = [+1.067104091996622e-01   +9.612123044497012e-02   +7.615894158378711e-02   +2.260231960142892e-01   +1.749170807324794e-01   +1.903321876897475e-01   +1.219393000887288e-01   +1.492004439667088e-01; +1.583593387570441e-01   +2.683774969264649e-01   +7.436606639127158e-02   +2.767209467381651e-01   +9.884719681101566e-03   +2.075152065970906e-01   +1.077620247090108e-01   +1.094498903802307e-01; +3.926868619269958e-02   +2.077757695599766e-01   +2.356810311553544e-01   +2.150565264457066e-01   +1.754698764543864e-01   +1.875788902241341e-01   +2.092089572779704e-01   +3.360872713910706e-01; +2.383744270387788e-01   +4.089146303610679e-02   +2.814821509346012e-01   +1.064922802221541e-01   +1.701509662880447e-01   +2.115915023940368e-01   +3.108230057303759e-01   +5.777821807952466e-02; +1.770917150601664e-01   +3.339199787272893e-01   +2.475631931184198e-01   +2.028083418932370e-01   +1.469399353099197e-01   +2.507390807701474e-01   +2.985342810345782e-01   +1.526802604365754e-02; +2.500804441137459e-01   +1.607621254287950e-01   +4.456737933285215e-02   +3.586730516526427e-01   +5.646726166823413e-02   +8.865192244919372e-02   +1.189541280345498e-01   +2.541912695856938e-01; +4.346755601115555e-02   +2.989807425229497e-01   +9.410028375811608e-02   +2.736529486395669e-01   +9.212609869969252e-02   -4.874432002665074e-02   +1.999937523225118e-01   +2.405701297510616e-01; +2.099091121015137e-02   +5.669953463336511e-02   +1.571202326649455e-01   +1.092670629990910e-01   +2.136250318727719e-01   +1.738212458289321e-01   +1.714684174602465e-02   +1.129578231590184e-01; +1.732970675473370e-01   -2.060585678027517e-02   +2.704088736579047e-01   +3.459075364546864e-01   +1.789221609996092e-01   +6.656633236693990e-02   +9.470072407115024e-02   +2.781133687645919e-01; +8.424396771418041e-02   +3.779398596358687e-02   +6.936830270810818e-02   +1.822960963361812e-01   +2.756751781011759e-01   +1.348949003384365e-01   +2.573866936692704e-01   +1.723833865581111e-01; +9.637000788385025e-03   +2.181427038529016e-01   +6.251150477986538e-02   +1.595510811769865e-01   +1.751478904073837e-02   +2.118681372243314e-01   +4.824068202373764e-02   +9.771291594485582e-02; +2.537435020003359e-02   +1.028643299680978e-01   +4.045112027721599e-02   +7.269812615847274e-02   +1.792148436564225e-01   +3.081257987385472e-01   +9.484518479999998e-02   +8.283309157114199e-02];
L3I_L3E_iAMPA_netcon = [+1.470180649374866e-01   +1.653361457833277e-01   +1.765155606947394e-01   +2.068776966991152e-01   +5.020619021365298e-02   +2.385949093548350e-01   +1.097699837891980e-01   +4.089926182848784e-02   -5.050851389728182e-02   -1.178135798966607e-02   +2.354611361777857e-01   +1.916363612986157e-01; +2.583039331878603e-01   +1.116914533978133e-01   +1.329003759964423e-01   +2.982708628269009e-01   +1.927857336880896e-01   +2.029740350176718e-01   +2.651130361271795e-01   +3.517190867329333e-01   +1.425118570622613e-01   +1.130432966824142e-01   +1.750995289026085e-01   +3.150737860118207e-01; +8.209946728630192e-02   +2.583526116522540e-01   +1.194368903196043e-01   +9.851934999382619e-02   +2.470476532094760e-01   +2.695451839582796e-01   +2.145901513705332e-01   +2.279189531044568e-01   +7.244685742603492e-02   +2.480076187630768e-01   +6.303332409840709e-02   +3.055294458735741e-01; +2.648358400364156e-01   +1.364956356378605e-01   +1.759202088506948e-01   +2.596472754615132e-01   +9.690590555075730e-02   +8.390004552679664e-02   +1.760184252973004e-01   +2.700060908103250e-01   +1.833290664302630e-01   +2.379856739373210e-01   +8.796189000024296e-02   +2.253259716599057e-01; +5.564394998990087e-02   +2.714210250457151e-01   +1.124558162363784e-01   +4.736713209497374e-02   +8.554986990061500e-02   +5.031490328664369e-02   +3.369943435648975e-02   +1.179432912505762e-01   +1.470490756793252e-01   +6.489234669233954e-02   +2.607039397168915e-01   +2.440110974220903e-01; +1.293298606365370e-01   +2.629920430313356e-01   +1.420843204267153e-01   +2.737850737168669e-01   +4.454236965084687e-02   +5.073238091371635e-02   +5.120498999575513e-02   +5.056205387362709e-02   +1.005367733093105e-01   +3.389424156082685e-01   +2.213523741466727e-01   +8.251142473957716e-02; +1.957625369675467e-01   +1.801332815658822e-01   +2.382055184464173e-01   +2.653661963553152e-01   +1.730187184247881e-01   +1.334695046671152e-01   +9.192548415008478e-02   +3.140326067170625e-01   +2.300101548390886e-01   +1.797452127794805e-02   -2.727738250698288e-02   -4.097277357922106e-02; +3.429558555550555e-01   +2.744019083752187e-01   +1.759068058818574e-01   +1.929653710238040e-01   +2.099140533723316e-02   +7.189691164047701e-02   +2.205897576340024e-01   +3.028109145414792e-01   +2.071111081332777e-01   +2.560325168546116e-01   +5.043042552752074e-03   +6.863174118129775e-03; +4.646595307677381e-02   +6.508260275374801e-02   +1.315497718530536e-01   +7.486353216046596e-02   +1.219547837709664e-01   +8.024917589058204e-02   +2.552539747545603e-01   +8.371337811680973e-02   +1.678217224391885e-01   +2.375820823780274e-01   +2.249935337670573e-01   +3.014899079669031e-01; +2.086757761497013e-01   +1.009452094659156e-01   +2.154342672904877e-01   +1.407305230458727e-01   +5.517477667328257e-02   +1.604858649152269e-01   +1.296533030943454e-01   +3.895198092486598e-01   +2.477275197722302e-01   +1.495681648362286e-01   +9.034331565718771e-02   +2.462312136154398e-02; +2.357465846609775e-01   +2.193273269405739e-01   +6.309686059931151e-03   +3.443537134143355e-02   +4.575799205125935e-02   +2.460434352091785e-01   +1.526430246751975e-01   +2.534397860011051e-01   +1.957603675717785e-02   +7.458513107526166e-02   +1.865819124258790e-01   +2.143971906849129e-01; +1.732561261456712e-01   +7.053034470589806e-02   +1.375305675468334e-01   +3.384056176841033e-01   -2.545889070797730e-02   +3.278831634564281e-02   +1.884278833872785e-01   +1.995469847486212e-01   +6.337911202446113e-02   +4.590621842221934e-02   +1.372735492438310e-01   +2.730548157680681e-01];
L3E_L3I_iGABA_netcon = [-8.510010022734285e-03   +2.489504771240382e-01   +1.379642340146655e-01   +2.729089184963999e-01   +2.626948161506609e-01   +2.108701196992030e-01   +3.593030076451156e-02   +1.059393916931014e-01   +1.719536068079589e-01   +2.618814531831082e-01   +2.918945484199761e-01   +1.644457096549254e-01; +7.209159542776455e-03   +5.129682539168873e-02   +3.158181983585523e-01   +1.725328647517848e-01   +1.156451453110399e-01   +2.530831466855202e-01   +2.756116532698339e-01   +1.523766281050094e-01   -3.090283224237639e-02   +3.120775281715001e-01   +1.769443293153679e-01   +2.117478380144633e-01; +2.229420868410465e-01   +1.853998777283071e-01   +2.385600109805885e-01   +2.414233412426470e-01   +8.094692610979090e-02   +2.662060640822770e-01   +1.241664582189654e-01   +1.235218667126353e-01   +1.433185771919168e-01   +2.228712361782435e-01   -8.776165365344927e-03   -2.923341025020240e-02; +2.171664328565752e-01   +2.321904130347678e-01   +5.223167891670151e-02   -9.592847717780021e-04   +1.364465181451576e-01   +2.941525462899252e-01   +1.265835039691492e-01   +2.253907080721489e-01   +5.030664803147535e-03   +3.084598757744724e-02   +2.189361177442845e-01   +4.800412800895690e-02; +2.496513409844859e-01   +2.606821267227621e-01   +3.344924843671522e-01   +1.369482334765091e-01   +2.840917784715644e-01   +3.037678562736491e-02   +2.288546874115888e-01   +1.061504188039787e-01   -4.920812781349466e-03   +3.052161415531275e-01   +1.254364753423059e-01   +1.353213193617659e-01; +5.503479147087462e-02   -2.460727388154607e-02   +3.460330225718088e-02   -3.339826370508252e-02   -3.694889180848270e-03   +3.274588000177822e-01   +1.082748215029699e-01   +1.841167540895191e-01   +2.678685408321224e-01   +2.647121008054666e-01   +2.874691562962406e-01   +2.322330924462623e-02; +2.931330191638636e-01   +2.616430580573694e-01   +1.554152606047924e-01   +1.280917444136375e-02   +2.298431820269910e-01   +2.348533309626143e-01   +2.409268873903622e-01   +2.589043019691819e-01   +2.170188445574555e-01   +2.790302483444053e-01   +2.362768643438485e-01   +6.819116851174498e-02; +1.117738617928275e-01   +1.223757088659789e-01   +2.067053765166872e-01   +2.871655316822839e-01   +1.905044237993495e-01   +6.013383270819718e-02   +1.463379837319982e-01   +1.734504633439021e-01   +1.550529737717145e-01   +1.315522284831162e-01   +1.870644588143658e-01   +2.394121712208886e-01; +2.712835332564728e-01   +1.555950111329223e-01   +2.955639368706063e-01   +1.779522632269200e-01   +2.790803571949794e-01   +1.415794569255064e-01   +2.326275904731152e-01   +1.696003414857880e-01   +1.251575406884655e-01   +2.860119256982460e-01   +2.449059087626204e-01   +2.198383450271783e-01; +2.163013900276676e-01   +1.628532041521825e-01   +2.047277666884550e-01   +3.807656157543065e-02   -1.147980062140564e-02   +2.053032942917488e-01   +1.114043604670221e-01   +1.137839690863614e-01   +1.823444707655643e-01   +1.530085214774689e-01   +1.034511149775949e-01   +3.411637425084237e-02; +1.226028765105163e-01   +2.503040481157483e-01   +1.611453434707102e-01   +2.773438124705370e-01   +1.239291712017844e-01   +2.401260085404766e-02   +3.281786453004674e-02   +5.293879058919430e-02   +1.891999762455578e-02   -6.416355155073411e-03   +3.149848882318101e-01   +2.098498941023217e-01; +9.897854558974924e-02   +1.512511010752022e-01   +6.640237775443369e-02   +1.320677562460652e-01   +1.852550478774741e-01   +8.007490510540201e-02   +1.690213184673830e-01   +1.695512663193164e-01   +1.091524830016615e-01   +3.887641994496033e-02   +1.238392835120981e-04   +6.944276101269614e-02];
L2E_Input1_iAMPA_netcon = [+1.611605183230332e-01   +6.112192262582630e-02   +1.796766789814278e-01   +9.676538514050995e-02   +1.833911401078690e-01   +2.143782746042546e-01   +5.190779574502560e-02   +1.628491590193685e-01];
L2I_Input2_iAMPA_netcon = [+1.234895904966338e-01   +6.386798481873901e-02   +3.067530186697501e-01   +2.607729274255630e-01   +1.210523552819781e-01   +1.891276303079350e-01   +1.755574214352958e-01   +2.887899477466845e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
