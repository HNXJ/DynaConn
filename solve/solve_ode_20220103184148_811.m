function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.143017478576902e-01   +9.464937058405825e-01   +6.987145715372243e-01   +1.541519369941230e-01   +9.202474775853384e-01   +2.185592771530604e-01   +7.403520164515281e-01   +3.027640916153356e-01   +5.324492195803914e-01   +8.294778860299222e-01   +9.688505476605196e-01   +9.646425790108304e-01   +6.968868063594574e-01   +3.725320746481789e-01   +2.976209261791383e-01   +3.778022175579165e-01; +3.467045022371010e-01   +1.267799440518360e-02   +1.424822664830644e-01   +1.757840987153938e-01   +7.162078090637650e-02   +8.095476786594137e-01   +7.940732991633150e-01   +7.584823537212249e-01   +7.844607776292887e-01   +1.822974597518338e-01   +4.661480576182740e-01   +6.551431394850559e-01   +3.769148809100761e-01   +2.758718430717365e-01   +6.859090706587565e-01   +9.532357554375320e-01; +2.075486663385087e-01   +4.676932140131709e-01   +8.372860135700562e-02   +7.020335086495164e-01   +3.135466745942581e-01   +3.829418607541072e-01   +6.640535797403433e-01   +9.540789118333579e-01   +4.922623018115258e-02   +9.249559149403145e-01   +8.706640410616077e-01   +2.082160376610946e-01   +5.407955086043436e-01   +7.616865123429603e-02   +7.731315614576282e-01   +8.127872308144237e-01; +2.367648749291452e-02   +4.906828969518353e-01   +4.323744443630207e-01   +8.337575697152827e-01   +6.291715922417074e-01   +8.568308518214056e-01   +4.400703952988015e-01   +8.599825873282769e-03   +4.620863807034823e-01   +4.200827807490651e-01   +9.464638488064859e-01   +8.981237959033859e-01   +5.181011175349438e-01   +1.503630770375069e-01   +7.202952820142664e-01   +8.909098866888887e-01; +7.652012667361663e-01   +5.160953965405586e-01   +8.948372153361959e-01   +8.046894217399493e-02   +9.059679397091454e-01   +3.226057542491620e-01   +5.755336674649353e-01   +4.056758164914552e-01   +9.383748287150865e-01   +3.002131063227462e-01   +2.324311364761825e-01   +4.881086330570893e-01   +7.639587131048640e-01   +3.657993508224301e-01   +2.775587038626930e-01   +6.893589226800036e-02; +5.721494644828755e-01   +2.874677972916678e-01   +7.327395877680789e-01   +8.361430694022042e-01   +7.964257719372869e-01   +3.794122927402025e-01   +5.183892228472328e-01   +1.531836965954544e-01   +4.737180551935073e-01   +3.473132724784661e-01   +9.178191429859706e-01   +6.633006292525777e-01   +8.102409496875110e-02   +7.162821537237053e-01   +1.330874793377662e-02   +9.026477925357665e-01; +5.774493978096532e-01   +5.655237207165508e-01   +6.807545985178232e-01   +5.425015542384541e-01   +6.423784418332886e-01   +6.371175866511407e-01   +7.238429827220358e-01   +8.206638782443236e-01   +7.793279053943262e-01   +9.711107726914970e-01   +6.331849216356343e-01   +5.268162807384811e-01   +5.007773996944038e-03   +5.328635894586677e-01   +1.516157270964181e-02   +6.667226322204208e-01; +3.888273418999406e-01   +5.109292958588874e-01   +2.024794936803023e-01   +9.623620318312530e-01   +4.393214078982989e-01   +3.863236070522754e-01   +2.215863457903765e-01   +2.882945779739132e-01   +1.100662369482710e-01   +5.310970635933595e-01   +2.840157459145849e-01   +7.087254113315999e-01   +4.022994670596689e-01   +2.328537018463330e-01   +9.356594733906660e-01   +3.457933888583270e-01; +5.554749964028919e-01   +6.779864513163840e-01   +5.293690914065864e-01   +6.775097559127263e-01   +7.490814407691803e-01   +6.835938315994816e-02   +9.981663512095310e-01   +9.779686406361411e-01   +5.211389249067579e-01   +7.914046596565646e-01   +8.548338795038579e-01   +7.190645513999805e-01   +6.622215251694453e-01   +4.716246940335126e-01   +9.333154821985432e-01   +8.369398803084311e-01; +1.830808016252751e-01   +6.163636473542020e-01   +8.306883405495804e-01   +3.349094513258331e-01   +8.261653999828558e-01   +1.743205223795436e-02   +6.186709442379249e-01   +6.256747640054147e-01   +6.361418946991632e-01   +7.943566801324728e-01   +1.663117465521663e-01   +2.944656472047075e-01   +3.678728650271144e-01   +7.164858052252591e-01   +3.724465624707858e-01   +1.977831857943742e-01; +1.174152417437993e-01   +5.650634136851799e-01   +1.752711419250996e-01   +2.200971056404423e-01   +3.418732514892644e-01   +8.795195947956040e-01   +9.805070715718356e-01   +7.438962182036241e-01   +5.789865021430775e-01   +1.427442079383373e-01   +8.273971864657229e-01   +1.172204263388229e-01   +3.929289493835630e-01   +5.135760739459100e-01   +1.092327953333043e-01   +8.412751950935085e-01; +5.882901911820787e-02   +5.046582253982239e-01   +5.169365212672905e-01   +5.679293120755026e-01   +1.391404000088235e-01   +1.568618777270433e-01   +4.949846586830294e-01   +8.729454494949208e-01   +8.355328534972323e-01   +4.560139855834476e-01   +2.170446194524922e-01   +3.249771014029154e-01   +1.340059641470962e-01   +5.129593334076765e-01   +7.191080174862520e-01   +4.248035804086930e-01; +9.334176388942265e-01   +6.668133003539968e-01   +3.559228297201751e-01   +9.202250016447854e-04   +5.050883582234813e-01   +9.141087580023833e-01   +5.217897523079094e-01   +3.291152240086287e-01   +1.158049769059948e-01   +4.584956462873754e-01   +2.672276502157303e-01   +4.563090623012077e-01   +3.386756656629789e-01   +3.862876793341308e-01   +4.488591044744965e-01   +5.591663607205318e-01; +7.457314984733506e-01   +6.337040551921026e-01   +6.472048628538205e-01   +5.878333405015131e-01   +4.134437675828714e-01   +5.574035094456864e-01   +8.540232390367628e-01   +9.811502477351651e-02   +5.141474052346602e-02   +9.556042532237101e-01   +8.859788553468982e-02   +7.153043501715681e-01   +1.221845714415282e-01   +4.780398396019127e-01   +1.218566850572645e-02   +4.474830442722764e-01; +2.441088114171391e-01   +1.442427751918860e-01   +2.804150134010567e-01   +8.916014827831745e-01   +1.724159603325731e-01   +9.225683639654848e-01   +2.542774984634872e-01   +4.514725413405765e-01   +5.168359115118675e-01   +5.398677546141420e-02   +9.170514094398270e-01   +4.052488067675064e-01   +3.686031591185622e-01   +7.398431218309034e-01   +1.243420577820138e-01   +7.599417397674134e-01; +2.048198859174311e-01   +1.780860687045195e-01   +4.353021976455083e-01   +2.549659576282203e-01   +4.938172422947897e-01   +5.963868148040002e-01   +5.814068661201390e-01   +2.400821598320596e-01   +6.968387491631586e-01   +3.549831334667244e-02   +7.263062650408658e-01   +2.419831167764836e-01   +2.520123524181606e-01   +7.023656269059967e-01   +6.591613193277740e-01   +9.694185317237286e-02];
L1E_L1I_iGABA_netcon = [+8.430959442343413e-01   +7.528683741192603e-01   +8.744262561723634e-01   +4.364272581534451e-01   +9.185471182717191e-01   +7.783778722749055e-01   +3.214920080108050e-01   +6.413452919497482e-01   +9.373568860819390e-02   +2.638834734812369e-02   +1.288094124267342e-01   +5.187881362341050e-01   +8.698283549699035e-01   +5.754318948998681e-01   +1.664180638619291e-01   +6.273940657569085e-01; +6.205093927005835e-01   +9.961312604570942e-01   +3.088890655920343e-01   +1.478678766366057e-01   +8.831134261936829e-01   +2.737834800445358e-01   +9.630757471087229e-01   +4.302417782393984e-01   +2.923642337490761e-01   +5.140276130824378e-01   +4.229772931420462e-01   +2.038299403197182e-01   +8.044414179790124e-01   +2.887400080568982e-01   +5.470082047782739e-02   +3.374841024591929e-01; +6.712540438612402e-01   +3.714883859657332e-01   +4.325048297556958e-01   +6.536336177636856e-01   +5.858119622258200e-01   +5.270546402081867e-01   +3.528975438669592e-01   +4.794083349558491e-01   +3.273657985464529e-01   +8.630424248158332e-01   +4.804307290922565e-01   +7.757470408678289e-01   +6.459684607864020e-01   +1.322306231574787e-01   +2.119116013981755e-01   +1.567133422580497e-01; +7.816214885994146e-01   +5.029164734169619e-01   +3.817724638075466e-01   +7.219213442801318e-01   +8.347261290997967e-01   +4.032868171406723e-01   +3.202680844933743e-01   +1.008590414297533e-01   +4.820571251959117e-01   +5.833928616862444e-01   +6.729698633878091e-01   +3.921297010572022e-01   +7.337418021722085e-01   +5.044491024677382e-02   +2.031408482830064e-01   +4.008940966914538e-01; +3.087795830380443e-01   +7.570268947533225e-01   +6.568353742808514e-01   +1.613202341313115e-01   +7.762679245875185e-01   +7.800007699963569e-01   +9.086699883830791e-01   +8.067060520892957e-01   +2.409546865360971e-01   +4.219932093888253e-01   +3.568831999176620e-01   +6.689979748300201e-02   +6.665947902960488e-01   +6.223097671447484e-01   +2.178249219845042e-01   +9.130599548433598e-01; +3.292106102682443e-01   +1.278183595898855e-01   +2.383957636747975e-01   +3.425194168021528e-01   +7.864652118527710e-01   +2.545282770021736e-02   +8.847742188152871e-01   +6.322103345779789e-02   +4.531997163602068e-01   +7.135633123565498e-01   +4.947075268180699e-02   +7.569388650507569e-01   +8.802819194057334e-01   +6.054863404977431e-01   +5.799232595082097e-01   +1.485240320734260e-01; +6.343893729529726e-01   +5.175323041565127e-01   +6.861892550818040e-01   +1.050866351728895e-01   +7.005579630259797e-01   +4.122272529363960e-01   +3.535458498299741e-01   +9.540846034723330e-01   +7.586512814970791e-01   +2.341887051469747e-01   +2.893735758763478e-01   +4.543710089927704e-01   +8.526426277050465e-01   +3.721338184537653e-01   +3.290684694769888e-02   +4.647825661695856e-01; +9.017721083710791e-01   +9.058894021577484e-01   +3.270489419067689e-01   +4.172384075887473e-02   +1.809188233335482e-02   +8.249417001842516e-01   +7.498434003277733e-01   +7.724794601884657e-01   +7.162362628856440e-01   +5.902708083003246e-02   +7.938684653612113e-01   +3.204741009162532e-01   +4.035654196000755e-01   +8.317236778270880e-01   +7.946304611380809e-01   +7.639649449739080e-02; +3.703012939693479e-01   +9.889401053101549e-02   +8.806966178034192e-01   +4.785957400865153e-01   +3.297937707840445e-01   +5.921825068512627e-01   +1.259154235044591e-01   +4.415743173890594e-01   +2.365899986721920e-01   +9.751465175515757e-01   +6.507629227869361e-01   +2.778072279808060e-01   +1.046695493305923e-01   +5.206745491469368e-01   +1.350292036386001e-01   +3.413766952254604e-01; +8.823669395095612e-01   +1.788397529650629e-01   +9.989102802253973e-01   +4.775813303331551e-01   +9.471308800349350e-01   +2.136298288708241e-01   +6.006218092711708e-01   +1.645595121900735e-01   +6.993682861595381e-01   +9.690274613206612e-01   +7.089317014858324e-01   +5.834422021818587e-01   +4.028754405619203e-01   +8.015779792342149e-01   +5.835963695814110e-01   +4.968124112366843e-01; +1.240293833013689e-01   +1.725411463583874e-01   +6.819790447828242e-01   +5.459146951337639e-01   +3.990718233441457e-01   +2.961511401345797e-01   +4.377286794386935e-01   +8.000660014999621e-02   +3.056360925299021e-01   +1.364739993294846e-01   +7.643739406287400e-01   +9.128579910554684e-01   +3.400476565912246e-01   +5.704939596485683e-01   +8.522916504063999e-02   +4.903722723596353e-01; +8.855154219087000e-02   +5.343355494808198e-01   +3.451487048352673e-01   +6.523214593620940e-01   +6.322809311455420e-01   +2.688946440636989e-01   +9.595329327061292e-01   +7.420170046946081e-01   +4.692007904622911e-01   -2.958845547007844e-04   +3.851467845914297e-01   +4.509067770775409e-01   +1.149802397283620e-01   +7.152957188132433e-01   +2.289495004115397e-01   +1.281072036812419e-01; +5.468099849963387e-01   +9.785287317048069e-01   +5.602335307420335e-01   +3.487675031024500e-01   +8.589466127958559e-01   +9.287204024169412e-01   +9.648016972141107e-01   +5.434703099873250e-01   +4.442928121151133e-01   +9.356347282178094e-01   +3.623727682502133e-01   +9.807397919967678e-01   +8.518017470177015e-01   +7.330727593583650e-01   +4.529466198850094e-01   +8.460121944636091e-02; +6.113401825169509e-01   +8.433116983748969e-01   +8.904442380949620e-01   +2.557522687808390e-01   +3.759342087790112e-01   +5.528158493671201e-01   +2.423015995686968e-01   +4.855256133761711e-01   +7.345277051885680e-01   +7.402854565362628e-01   +8.118486428052368e-01   +1.103325394000601e-01   +8.912849047091348e-01   +4.544305527470251e-01   +1.797252848891342e-01   +6.743490425400999e-01; +7.283782388364355e-01   +6.713015084314423e-01   +6.472344256604444e-01   +1.757888681607346e-01   +2.037278454966011e-01   +4.324450873679732e-01   +7.709741645062026e-01   +8.949355655166241e-01   +8.761329873489894e-01   +4.315295554330669e-01   +3.865641466619311e-01   +4.162643935887113e-01   +6.865967292740355e-01   +2.823813811420110e-01   +4.155762828414278e-01   +1.210968065102275e-01; +9.899500904198930e-01   +8.501463251046377e-03   +3.765940418263951e-01   +4.770909675846596e-01   +9.115121251931200e-01   +3.284734525763192e-01   +7.121840028753534e-01   +5.823614865591463e-01   +9.128510392505743e-01   +9.440845131804135e-01   +8.719380223535154e-01   +3.842717238248106e-01   +7.434372641955886e-01   +1.520827273087888e-01   +9.667061199426017e-01   +9.897386881183873e-01];
L2I_L1I_iGABA_netcon = [+5.748973528871115e-01   +5.633585082570909e-01   +1.095330152298112e-01   +4.587504975259839e-01   +7.968209109256075e-01   +9.790410721130751e-01   +2.231939727588196e-01   +7.581412050869941e-01; +5.572605151776789e-01   +9.526508842409487e-01   +1.192106155521885e-01   +5.670966068358972e-01   +5.422541503039342e-01   +4.226173285570337e-01   +6.598553915121963e-02   +5.050900573000751e-01; +6.119047833404303e-01   +8.777659508151235e-03   +4.332395618728161e-01   +8.180143742716937e-01   +2.576974047717509e-01   +3.940031473774131e-01   +8.356242385311496e-01   +8.266830231724837e-01; +4.665015334004429e-01   +1.276959785603237e-01   +9.334759926081208e-01   +3.553594065603862e-01   +7.813155833502022e-01   +4.612825072148171e-01   +4.262825430504671e-02   +9.273376957661221e-01; +4.342676420561017e-01   +8.528287663595715e-01   +1.399881769496788e-01   +2.481114058657505e-01   +7.776451754481621e-01   +1.226023596272953e-01   +9.091756706035150e-01   +7.107511995103520e-01; +6.443473513933920e-02   +2.186179470862463e-01   +8.261899810072991e-01   +7.706166791145207e-01   +1.449039677404144e-01   +4.557728496073928e-01   +4.496081199908135e-01   +7.969566829100339e-01; +6.467149318339815e-01   +7.087988846955201e-01   +9.317000704278239e-01   +2.041834163790320e-03   +8.233984373509941e-01   +2.658061074313230e-01   +2.853571259361511e-01   +9.585130456344538e-01; +4.246926630435466e-01   +7.742857968320960e-01   +5.721727651960359e-01   +2.749865632471114e-01   +6.228231034465075e-01   +9.328837346154180e-02   +7.546297174086191e-01   +9.523896953687163e-01; +7.560615198837668e-01   +4.214318106660351e-01   +4.978822465300579e-01   +2.375444309729200e-02   +4.577821046894829e-01   +6.608665273391710e-01   +9.266987923097847e-01   +2.964486314269391e-01; +3.072297079810628e-01   +7.247656248334908e-01   +9.305118019803543e-01   +6.702584186998486e-01   +4.833408054104416e-01   +9.457565099435370e-01   +1.408846308145865e-01   +3.507812400420046e-01; +5.993193130720775e-01   +4.575175002399177e-01   +8.626344676259288e-01   +9.674346385457565e-01   +2.185810812251991e-01   +7.643786245675539e-01   +9.563549286688111e-01   +5.415361558948618e-01; +3.341987798806550e-01   +8.053221595601043e-01   +2.528764542558654e-01   +9.460461982297330e-01   +8.571740241560506e-01   +4.258195290852979e-02   +3.045024775424326e-01   +2.140525160466095e-01; +6.438109182799202e-01   +4.282737232708810e-01   +4.596719830648707e-01   +4.746433239267324e-02   +8.801145351650171e-01   +2.611422581999138e-01   +2.091674719824838e-01   +8.149434943501911e-02; +2.355802653662101e-03   +1.491133473315660e-01   +7.409220574297162e-01   +2.862783811271509e-01   +8.453292463732284e-01   +6.349796446214814e-01   +4.639163815768715e-01   +5.050691058413393e-01; +1.438154766132441e-01   +8.039791524441481e-01   +7.527831057651899e-01   +4.884234539487954e-01   +4.421436210168593e-01   +8.984158175387395e-02   +5.966872840110429e-01   +1.938963836159163e-01; +2.470668935774523e-01   +3.800428633517109e-01   +2.304263087276061e-01   +8.874080020857246e-01   +5.432088747657645e-01   +7.522229689577586e-02   +5.531860181623768e-01   +1.447892317495531e-01];
L1I_L2I_iGABA_netcon = [+6.982818090456242e-01   +8.675825562586611e-01   +6.152469433393706e-01   +5.490632767760019e-02   +1.437554934070829e-01   +2.354435187806626e-01   +8.399209365121921e-01   +3.701854292213647e-01   +7.073289983928248e-01   +3.834564657648049e-01   +2.393790105095623e-01   +6.669536046965467e-01   +1.675784422338229e-01   +5.698296323558214e-01   +4.368372808147220e-02   +4.877788433386295e-02; +5.985994066936834e-01   +7.979988940919573e-01   +6.097371696289265e-01   +5.836074806803564e-02   +7.451807634334677e-01   +5.557192160091319e-01   +1.984320042021276e-01   +5.582940014957526e-01   +1.876625111198921e-01   +7.201041905814560e-01   +5.119817733329842e-01   +3.300247802245844e-01   +1.148342302871216e-01   +8.101904382300261e-01   +4.423293967196735e-01   +9.205674036552368e-01; +1.638633030647844e-01   +6.271051667881056e-01   +3.134337555055897e-01   +5.974032749563716e-01   +9.506097024590208e-01   +1.149998319039583e-01   +6.164033253484612e-01   +8.303444421209435e-01   +2.301627769969956e-01   +6.404559107863319e-01   +7.319626878813522e-01   +5.528030904247033e-01   +7.371490007853478e-01   +6.750059004219517e-01   +9.182965277291045e-01   +1.736843346414854e-01; +4.831152741000433e-01   +4.712511390580055e-01   +1.421657823156821e-01   +6.576380349805638e-01   +2.655844621792241e-01   +8.184524341986417e-01   +1.541612585618706e-01   +7.088712495645605e-01   +9.979751499453550e-01   +1.002398772993645e-01   +7.715245686618285e-01   +5.324178042427881e-01   +2.100677707020332e-01   +4.434125441308367e-01   +8.849198911282585e-01   +7.431538379181382e-01; +2.858585356974604e-01   +2.026767999342969e-02   +6.037261847738993e-01   +4.797839997212953e-01   +9.651666082258055e-02   +6.508506128159534e-01   +5.833631914820843e-01   +1.153223436102866e-01   +9.044776663879707e-01   +4.922393549743057e-01   +6.764355122446962e-01   +9.012268680505346e-01   +4.827990860819228e-01   +8.933994611324805e-01   +9.216410659640263e-02   +4.761174189791376e-01; +4.036117866075917e-01   +1.177253514041963e-01   +8.897763268998903e-01   +9.787062532570943e-01   +2.295393119337831e-01   +2.365875970240466e-01   +5.447191204449205e-01   +7.403126992889000e-01   +1.071881756669870e-02   +5.621044945376242e-01   +8.139094487338716e-01   +2.834535463941028e-01   +5.000798383490039e-02   +7.832145859295409e-01   +6.752763846953499e-01   +2.475221737888468e-01; +4.900243922992045e-01   +7.190861290538169e-01   +5.625372522000602e-01   +8.644131226593226e-01   +8.957770950253426e-01   +3.025097395042766e-01   +6.820674882977654e-01   +9.252042515627714e-01   +8.346618480455928e-01   +5.629615099119623e-02   +4.176406619870753e-01   +1.390968332611566e-01   +5.728653332469530e-01   +5.812880879531228e-01   +8.537077018079833e-03   +6.637317651363873e-01; +8.624190394461654e-01   +6.810862713919523e-01   +6.322471117972709e-01   +9.530456965390961e-01   +1.983025281900801e-01   +3.315111130197265e-01   +6.975697816024554e-01   +9.232538929316227e-01   +2.518156467215737e-01   +8.947839551519203e-02   +4.987387200182686e-01   +9.568754630952028e-01   +4.920166137329408e-01   +6.154851876742357e-01   +1.212730293988047e-01   +6.073233975089368e-01];
L2E_L1E_iAMPA_netcon = [+3.678722870114509e-01   +5.631340817600875e-01   +2.007123686375895e-01   +5.151500112775977e-01   +2.895991235614179e-01   +7.497208117786230e-02   +2.779641792545055e-01   +2.662317363746646e-01; +4.370827844176339e-01   +1.922486923453255e-01   +1.366576903128259e-01   +6.852719090406268e-01   +6.190257319168453e-01   +5.954695798114322e-01   +9.279359978076006e-01   +9.054235092206043e-01; +7.187853757752367e-01   +6.121616318374632e-01   +8.151443949683720e-02   +2.077218029549949e-01   +8.644108883816095e-01   +7.809956092702496e-02   +7.639403159580441e-01   +1.593357289560867e-01; +1.915349698718072e-01   +7.398533587212273e-01   +9.166185773185079e-02   +9.716487628353982e-01   +8.209619970980691e-01   +3.967322494119135e-01   +2.634880921326707e-01   +5.536167666096438e-01; +4.019377197010576e-02   +8.336786104612776e-01   +5.530256495983809e-01   +3.509695775981720e-01   +2.066771083837770e-01   +5.980648805054647e-02   +2.419532372201693e-01   +4.228377240802596e-01; +3.151698180840427e-01   +2.793892952500421e-01   +7.313813748075889e-01   +1.841649409736634e-01   +7.512265355165028e-01   +1.287840160498776e-01   +1.655351271828805e-01   +5.473314556136032e-01; +7.895927973283812e-01   +6.075800199315025e-01   +5.440511595299460e-01   +2.392432923581459e-01   +1.980554001930991e-01   +2.435704807605037e-01   +2.875246375151698e-01   +7.536764381714701e-01; +4.750218169669803e-02   +5.470850779136364e-01   +5.387416583048187e-02   +2.553583393480519e-01   +5.792315582496571e-01   +9.446178982984929e-01   +5.650905580187227e-01   +1.226318873265856e-02; +2.163721380542565e-01   +2.752064488915649e-01   +6.333067237669741e-01   +2.218943261233106e-01   +8.774018316570912e-01   +2.031775361674530e-01   +4.045254702403613e-01   -7.142275389829133e-04; +2.744026731506604e-01   +3.393614755781466e-01   +9.941605285869836e-01   +3.469135859899780e-02   +7.133167941229527e-01   +3.262797990561576e-01   +9.874045108056391e-01   +2.060737073362015e-02; +7.887057550554439e-01   +5.660720374819495e-01   +9.143439302568885e-01   +3.577106684285967e-01   +7.013958661752363e-01   +8.659269974867549e-01   +5.436289290149497e-01   +3.593127952665605e-01; +9.918346373616281e-01   +7.431794791940514e-01   +7.685168408243667e-01   +8.992474328194998e-01   +4.675805407107196e-01   +9.227941661958765e-01   +9.276497339880752e-01   +4.253698382557395e-01; +9.522536617265720e-02   +7.711410670502735e-01   +1.923189382529195e-01   +1.405679527185119e-01   +5.046433765682659e-01   +2.384210109453236e-02   +9.933223300112790e-01   +5.450142256055009e-01; +1.952841771207906e-01   +3.980803864782343e-01   +3.221100800561742e-02   +9.555069922700015e-01   +7.980902246202772e-01   +3.644842269270225e-01   +8.356327715083055e-01   +4.927633888096555e-01; +1.167539406441415e-01   +1.486838307072722e-01   +3.737081088016790e-01   +9.028351966935844e-01   +9.392604106113530e-01   +5.286042230397897e-01   +1.805914420771194e-01   +9.214589132480888e-01; +6.469026157522848e-01   +2.075063668596869e-01   +5.750850377368356e-01   +4.108479425290147e-01   +7.832246751284982e-01   +4.062194837410295e-01   +3.128600664101149e-01   +4.154403118949335e-01];
L1E_L2E_iAMPA_netcon = [+4.981872747182163e-01   +4.499425037010504e-01   +6.156741263887270e-01   +4.899337668016366e-01   +2.303868703617936e-01   +7.224511705639999e-01   +6.940601804541686e-01   +6.325259277496958e-01   +5.230886790368887e-01   +2.400773748762357e-01   +8.779999700271658e-01   +1.738253756514880e-01   +1.365367474367083e-01   +2.424082045384116e-01   +1.837461539341084e-01   +2.409074465154021e-02; +8.395737262700734e-01   +3.693373723084238e-01   +1.034346252567197e-01   +6.608969092006034e-01   +8.372292961853396e-01   +3.812980698151215e-01   +9.797314131926875e-01   +6.264149275543908e-01   +6.736716453256625e-01   +7.306092109779461e-01   +6.585833907871467e-01   +3.033345369108239e-01   +2.839659830811879e-01   +7.474607510801198e-01   +1.460878984593625e-01   +2.502695402542034e-01; +1.843781039410774e-01   +3.006403363040255e-01   +7.533342426111660e-01   +1.780795330747655e-01   +7.341556295581656e-01   +3.844307712688381e-01   +7.517135477451863e-01   +4.073938559313384e-01   +7.773673193061070e-01   +1.351052371756481e-01   +5.369290665011888e-01   +1.092635487056551e-01   +6.267153020442028e-03   +9.357293510355995e-01   +1.334167860093294e-01   +9.886944020136071e-01; +3.362406962445187e-01   +2.329183880690008e-01   +5.377093485338911e-01   +4.786564321780258e-01   +4.904267502086481e-01   +7.150259285388083e-01   +5.531124009877033e-01   +4.250152881294906e-01   +4.637227628882827e-01   +4.173266062118822e-02   +2.522777103040859e-01   +4.515513752546426e-01   +3.059982128789392e-01   +2.987840594475413e-02   +1.729345254865784e-01   +6.300361390844624e-01; +6.941231919341296e-01   +1.377621582345366e-01   +4.431382350302949e-01   +4.995455596806034e-01   +8.497061408392190e-01   +8.386035463685864e-01   +2.916643179041517e-02   +5.115073145821439e-01   +9.079744168721258e-01   +6.490201828009914e-01   +1.062732115014477e-01   +5.844455243647415e-01   +9.034314046451059e-01   +4.363413492314782e-01   +9.232860008732350e-01   +3.569653781114865e-01; +6.927815891581165e-01   +1.002843950700830e-01   +7.435273520074470e-01   +6.000433436332799e-01   +7.141977142461385e-01   +6.681767951056361e-01   +1.963321468539000e-01   +2.585813730890267e-01   +2.387489797090385e-02   +1.997801875036155e-01   +9.720587125057466e-01   +2.247648310504596e-01   +2.945991438518476e-01   +8.315274148023646e-01   +2.604351744173738e-01   +9.370367486624472e-02; +3.682527789944168e-01   +2.261799082672870e-01   +3.868694506735330e-01   +2.410755437424114e-01   +5.218389303937536e-01   +6.497871349942950e-01   +9.421356173876101e-01   +4.224757315186591e-01   +4.812228007471274e-01   +9.732922186516560e-01   +5.981820902298115e-01   +1.104073144192467e-01   +8.331921042127416e-01   +9.989755855698791e-01   +2.064447666050934e-01   +4.094655956254519e-01; +3.272918907948789e-02   +3.468819272376031e-01   +5.261618279749536e-01   +5.163303598913009e-01   +9.390187895822507e-01   +5.643058672267455e-01   +3.966147444715545e-01   +5.241983287999596e-01   +2.707957790723007e-01   +8.205742612487652e-01   +8.190341334143815e-01   +5.614988827014796e-01   +7.445421285702367e-01   +9.192490824365065e-01   +6.124602315440801e-01   +9.314323421545646e-01];
L2I_L2E_iAMPA_netcon = [+6.775648103144600e-01   +6.154458250135609e-01   +4.135782830373875e-02   +7.937968913575327e-01   +5.232874418974233e-01   +8.258417461181157e-01   +6.458017607432162e-01   +3.855913276969241e-01; +2.362698753138445e-02   +9.437642095421125e-01   +5.461812182169162e-02   +9.307043688560886e-01   +5.451441905370895e-02   +1.079220728968424e-01   +4.070685585913414e-02   +1.670582451455685e-01; +7.348842969349498e-01   +9.644894241697972e-01   +4.014598082431349e-01   +9.358942571993221e-01   +2.867516651791040e-01   +2.376169194778013e-02   +5.680949129035083e-01   +4.440813216937500e-01; +2.129251506061469e-01   +3.700337212725313e-01   +9.834933600788742e-01   +1.460213964214425e-01   +7.090393442455959e-01   +1.247765098827268e-02   +3.053147283466285e-01   +8.743517843703503e-01; +8.604098824219144e-01   +7.948624517536345e-01   +7.123501946768681e-01   +3.195627368243436e-01   +8.795442189165465e-01   +3.358553398281174e-01   +2.612999235886268e-01   +4.104575099756247e-01; +1.571010003550659e-01   +7.286428329664145e-01   +9.890137423316858e-01   +4.287221011666845e-01   +3.661777272754850e-01   +6.635527279467258e-01   +7.221219087018732e-01   +1.621342221518699e-01; +6.690292494344505e-01   +9.535073448413672e-01   +6.457505150880106e-01   +7.023085123303063e-01   +5.611023133435719e-01   +5.946360904680490e-01   +3.049491799257267e-01   +6.616094871478067e-01; +9.349443990724985e-01   +1.110700230017648e-02   +5.008893210271846e-01   +6.153914779203581e-01   +8.838087520808727e-01   +7.949862363812056e-02   +8.960521218689289e-01   +9.261386665820123e-01];
L2E_L2I_iGABA_netcon = [+6.126885951447707e-02   +5.198779123784766e-01   +3.529624220386190e-01   +2.606694143241761e-01   +4.156693346373961e-02   +8.913316341763773e-01   +3.432230642046704e-01   +4.514020644938881e-01; +3.544882987854102e-01   +6.897533128846861e-02   +5.572313679604092e-01   +9.844155572885658e-01   +3.607642758265491e-01   +5.406438767281603e-01   +9.349403290820677e-01   +6.709249538997494e-01; +9.327524492747079e-01   +1.846353424578543e-01   +6.913148864497916e-01   +3.489239051198565e-01   +3.646335090004463e-02   +7.170553215631510e-01   +9.180789841806443e-01   +7.696891563636999e-01; +2.400990383185222e-01   +3.166029912073320e-01   -6.153852952275614e-03   +4.022987943587670e-01   +4.852162437386867e-01   +7.098552944103775e-01   +7.252154877406229e-01   +9.269598889998725e-01; +1.041743510812704e-01   +2.447018028572830e-01   +4.758300793561551e-02   +7.527137529569912e-01   +7.233827019459290e-01   +1.677747340568381e-01   +4.441300657604589e-01   +6.592833891233926e-01; +7.154456993139762e-01   +3.216871750348360e-01   +3.076862966257488e-01   +1.026477271778179e-01   +1.347073692939572e-02   +3.520036850264968e-01   +1.522705190668565e-01   +5.021560969360679e-01; +6.664990945729220e-03   +8.810170837774308e-01   +8.690968674533399e-01   +5.901265285550952e-01   +5.172322933535715e-01   +3.794313227333873e-01   +8.329808639758984e-01   +3.431584077489290e-01; +1.845335891662472e-01   +3.009020344065749e-01   +6.264687761806568e-01   +1.225647677175010e-01   +2.403282527522423e-01   +7.582356710536720e-01   +2.578495295547333e-01   +9.454415078394131e-01];
L3E_L2E_iAMPA_netcon = [+8.023573272602279e-02   +1.627533065604767e-02   +3.681791192774266e-01   +4.965323874890891e-01   +1.856938928500300e-02   +9.543031532741393e-01   +3.603296141826685e-01   +1.369356178159352e-02   +2.045169312671264e-01   +6.083203199947886e-02   +2.440458358317283e-01   +9.997430695188368e-01; +9.517002549185463e-01   +9.769787983454246e-01   +1.161297479986483e-01   +6.526511460339808e-02   +8.060679784901845e-01   +3.879263569358354e-01   +2.238933270775497e-01   +1.224558181780847e-01   +3.564909429463167e-01   +7.407684833689318e-01   +5.325262784425953e-01   +3.449724433040352e-01; +6.632717384858210e-01   +7.253435802106928e-01   +5.141841027941783e-01   +8.624675974181664e-01   +7.933876725080039e-01   +6.640298505268774e-01   +7.251300288528033e-01   +6.696866868583151e-01   +8.888388778727341e-01   +9.903395222878039e-01   +3.330668185585032e-01   +8.221368790561625e-01; +1.697682215882237e-01   +8.706562846887765e-01   +6.624333824914759e-03   +9.960858571402016e-01   +4.224498539537097e-01   +5.834589880399780e-01   +7.723262315599966e-01   +5.072932887190167e-01   +8.104380673071365e-01   +7.676806666620074e-01   +6.731629246465072e-01   +1.109032246046559e-01; +1.952446131022649e-01   +8.142272334071413e-01   +8.694954500750596e-01   +1.225084196269947e-01   +6.292752279759375e-01   +5.863837314015551e-02   +3.438118755381441e-01   +7.173615091742754e-02   +3.180790456892090e-01   +8.816777797950380e-01   +8.740805371558569e-01   +7.745729999804321e-01; +9.952716447346536e-01   +3.149450605210602e-02   +9.040347542927831e-01   +1.000701160654080e-01   +5.672565837164520e-01   +7.631230821503061e-02   +5.777985200062703e-01   +5.362298150849287e-01   +5.994147330762576e-01   +3.527244496746024e-02   +9.832889115280392e-01   +1.506884830094090e-01; +9.248505218340891e-01   +9.675679287513121e-02   +1.134450249363008e-01   +1.496549241516715e-01   +8.966330365801334e-01   +2.266980609564318e-01   +6.433642899815425e-01   +6.779733193541443e-01   +6.979226548528003e-01   +7.927889773794187e-01   +1.445911057147290e-01   +7.315399732116764e-01; +9.817011323395268e-01   +8.601539291557342e-02   +4.527999729293208e-02   +1.282247618938240e-01   +7.484427209156197e-01   +4.200775152631675e-01   +3.667221594987001e-01   +5.875162023555293e-01   +1.783611350401970e-01   +7.062475453816295e-01   +8.781246526074372e-01   +1.091275753578870e-01];
L3I_L2I_iGABA_netcon = [+7.674947327900054e-01   +5.358208334709187e-01   +5.974930738398402e-01   +3.048463593091148e-01   +9.663097623255535e-01   +1.146357607212322e-01   +2.974397232944844e-01   +7.958292563160830e-01   +9.139134159534116e-01   +9.936373262892794e-01   +3.086848316081745e-01   +9.968848769331422e-01; +6.377112404403030e-01   +4.517589246176739e-01   +5.620737186990111e-01   +7.620791817532924e-01   +5.432775018485966e-01   +6.943838361302830e-02   +1.698889096277634e-01   +5.207737045952925e-02   +3.868471445347985e-01   +2.874343897975827e-01   +4.420556471154254e-01   +9.133383769876005e-01; +7.964588393336162e-01   +1.138160491023101e-01   +6.815727282164641e-02   +6.477956444794543e-01   +9.812292130009643e-01   +5.194039783262600e-02   +7.238771848999388e-01   +1.809906481326032e-01   +7.509259947121546e-01   +5.165731057950382e-01   +2.091493169902943e-01   +6.917536390540590e-01; +9.605717388231374e-01   +7.203481726728289e-01   +7.679897351814980e-01   +3.321461411729286e-01   +1.241910271153534e-01   +1.301045206780470e-01   +2.990809940051353e-01   +2.459748037918406e-01   +8.792634690514706e-01   +3.599371759483628e-01   +9.399823903751329e-01   +2.215092811991285e-01; +7.165206328079712e-01   +1.870549798250006e-01   +8.674177881913181e-01   +9.717604287896223e-01   +1.675166666116278e-01   +4.921509804958517e-01   +6.777530874980218e-01   +2.616016031671241e-01   +3.925278002986138e-01   +5.180477410157104e-01   +2.894416735946708e-01   +3.152899212025411e-01; +6.430660150304420e-01   +3.238500587377828e-01   +7.090607205583700e-01   +5.331768543368471e-01   +3.336695201549691e-01   +4.670138270617752e-01   +7.458162517156014e-01   +6.486532870160796e-01   +1.674121541051597e-01   +5.010085984376748e-01   +1.218028673287711e-01   +2.357415559686934e-01; +5.117580830784476e-01   +9.660748165401646e-01   +1.084170542417245e-01   +7.511300462286571e-01   +5.314836461620209e-01   +1.582249935073266e-01   +7.460902695154776e-01   +9.752739440868108e-02   +4.363097275684470e-01   +1.890223910313944e-01   +6.893861556697338e-02   +7.079307306355219e-01; +9.514416203539465e-01   +7.004304914696340e-01   +6.660500543777113e-01   +2.687175109105907e-01   +6.925791926043934e-01   +1.377424705988694e-01   +7.843383434800403e-01   +4.701905505412656e-01   +8.570555031520830e-01   +4.786547899735834e-01   +7.293566454699311e-01   +3.755686986254422e-01];
L2E_L3E_iAMPA_netcon = [+6.576663326626845e-01   +3.874829437877568e-01   +2.355714866250816e-01   +4.656502674898580e-01   +9.039748059903914e-01   +9.503602437449804e-01   +7.618446959543617e-01   +3.547916139847873e-01; +3.834407304795069e-01   +2.244435500849663e-02   +9.056425166915607e-01   +2.844713134623921e-01   +6.796654822766722e-01   +2.478545616547787e-02   +9.034851068896058e-01   +6.629014930146631e-01; +3.085135706073341e-01   +3.297144616189195e-01   +4.866002583850033e-01   +2.769867518796603e-01   +8.434982163533171e-01   +5.016592774386754e-01   +7.959023938667568e-01   +5.921091470567097e-01; +1.572585598948218e-01   +4.851295169985205e-01   +5.955938171234950e-01   +1.430041751590825e-01   +9.555379457552061e-02   +3.394135568607385e-01   +9.561486266938395e-01   +5.426276027951967e-02; +7.767398243710537e-01   +2.629728661463995e-01   +9.559114530739513e-01   +1.408736787335735e-01   +7.337153859841078e-01   +6.729739526877719e-01   +5.353341418255556e-01   +2.158787998221600e-01; +7.087787777719012e-01   +5.252101709228216e-01   +8.489158009786531e-02   +2.634820095189749e-01   +5.430587445120277e-01   +1.680645161015989e-01   +1.626057062910172e-01   +6.015870837334084e-01; +1.718536834087066e-01   +4.150796801869921e-01   +2.214748596123931e-01   +6.106149753791177e-01   +2.561770993598885e-01   +2.260993559145238e-01   +1.341368226217118e-01   +2.695465066673336e-01; +4.483263895658092e-01   -3.818633957281830e-03   +1.532760077223952e-01   +1.067384257149893e-01   +7.151568282647242e-01   +1.182132851530907e-01   +3.274664554241116e-02   +1.093284774279454e-01; +8.379708456875673e-01   +8.928926817646058e-01   +3.902703771864178e-01   +4.840467507926848e-01   +3.604732892691924e-01   +9.924074023714761e-01   +6.817161656008994e-01   +2.104020704235446e-01; +6.988042183204728e-01   +2.401779958058154e-01   +1.860040225822391e-01   +8.929057183864620e-01   +8.534113517725215e-01   +1.400813109648669e-01   +5.864792435904844e-01   +8.731852437383532e-01; +7.642766206983215e-01   +7.925017727046235e-01   +7.633668396429206e-01   +1.887854691607902e-01   +8.196081703602367e-01   +7.690564292819745e-01   +2.981688251456935e-01   +4.591698859116135e-01; +9.802525156643074e-01   +5.774632842447567e-01   +2.284268349673491e-01   +5.170006567539996e-02   +6.105574207155139e-01   +6.333948684704166e-01   +7.457725024950358e-02   +7.273610379471606e-01];
L2I_L3I_iGABA_netcon = [+5.889078013886319e-01   +1.467331809028195e-01   +3.447385627819569e-01   +3.699644936584218e-01   +5.986543919137510e-01   +5.070849488432462e-01   +7.732165864497637e-01   +2.647256328455280e-01; +8.452153417919138e-01   +9.898031572820211e-01   +4.696683757893842e-02   +5.364081994911131e-01   +4.783333007037360e-01   +2.383060694486046e-01   +1.783678991309095e-01   +5.859820644864302e-01; +6.040989737469562e-01   +4.805024253802156e-01   +9.418316803470781e-01   +9.744382565687905e-01   +3.766495885258966e-01   +2.731928220982119e-01   +4.544348195037778e-01   +6.805717883371029e-01; +7.441233934985340e-01   +3.608161363037388e-02   +8.669554392175887e-01   +9.967085701199524e-01   +9.787053260833017e-01   +4.048995751700205e-01   +3.059832508988682e-01   +4.156298085476161e-01; +8.485107367485947e-01   +2.707291677060656e-01   +1.333389163808159e-01   +4.146061634837929e-01   +1.385521621019896e-01   +2.610527173496697e-01   +3.879863827820277e-01   +5.119677335085496e-01; +1.454304013573879e-01   +6.747463206577989e-01   +5.898057704624168e-01   +4.492293709102320e-01   +2.703339370891322e-01   +8.539642834193595e-01   +8.028925496921863e-01   +8.134004704765488e-01; +7.427086666059489e-01   +1.450471871220743e-01   +6.319069393663354e-02   +2.541620813123449e-01   +2.265525973016674e-01   +4.790349246003126e-01   +7.777903054341719e-01   +5.451224122929539e-01; +1.731571150052855e-02   +7.726642809642551e-01   +9.475021938105902e-01   +5.994360998787084e-01   +7.928584165503452e-01   +3.421502118357336e-01   +6.463386962860174e-01   +5.890029844716300e-01; +2.280713595795333e-01   +2.669463564808740e-01   +4.967566255494610e-01   +7.739281898162069e-02   +8.181820419753217e-01   +6.388335338751202e-01   +2.427352343068617e-01   +5.344516801607354e-01; +5.369483395977501e-01   +8.810705282079577e-01   +2.604193554285529e-02   +9.119659256501959e-01   +7.939136300645047e-01   +4.159521208629428e-01   +6.075128594498835e-01   +5.400164493564173e-01; +7.195586463649205e-01   +3.702773769051957e-01   +5.757758341839957e-02   +4.727717733654199e-01   +1.123203602597338e-01   +5.442103218269017e-01   +4.187643147945737e-01   +1.516135063768206e-01; +4.349237575492350e-01   +1.061156780192990e-02   +3.002893845900889e-01   +5.078554125934508e-01   +6.320403312697784e-01   +3.408667601647203e-01   +2.949904926419058e-01   +7.031737211675465e-01];
L3I_L3E_iAMPA_netcon = [+6.315470838250656e-02   +7.729115294959168e-01   +5.540980437352142e-01   +5.725785768225281e-01   +9.198384370719093e-01   +8.363199194045545e-01   +8.509515989166184e-01   +8.631857161100425e-01   +5.325307794888847e-01   +9.882344168870616e-01   +4.820751448157289e-01   +3.506202528515337e-01; +9.216188690754037e-01   +8.392451026025736e-01   +8.440561540722260e-01   +9.362228917148079e-01   +5.930028727715628e-01   +3.928587930855757e-01   +6.285012773711151e-01   +8.560891774177287e-01   +5.681721613605009e-01   +7.002480962371859e-01   +7.388096150778253e-01   +4.000660108184104e-01; +1.798857645498138e-01   +5.944880355144292e-01   +9.693649654609668e-01   +7.796058202201839e-01   +5.759272253728399e-01   +6.974451739299936e-02   +4.448700384785983e-01   +9.479933621060400e-01   +9.792552283458736e-01   +8.437203123163733e-01   +5.937236656525728e-01   +9.876594889955522e-01; +5.427406826983069e-01   +7.666875730860850e-01   +4.649581764929789e-01   +5.961871735649995e-01   +6.575052133180286e-01   +3.742893636806854e-01   +2.349930783841649e-01   +6.951171344357469e-01   +9.687901361670750e-01   +7.389773776308576e-01   +2.626397418604300e-01   +2.963715709837025e-01; +3.988498617813675e-01   +6.586579481640480e-01   +7.758947767615055e-01   +5.707653230413604e-02   +4.356130759567816e-01   +8.499373271418722e-01   +5.058034048119903e-02   +3.633469803377968e-01   +5.606184379612482e-01   +9.952434935937996e-01   +6.062126884989084e-01   +2.250929635050541e-01; +9.330618341981480e-03   +5.888164088862503e-01   +2.189961509292003e-02   +5.439863515796047e-01   +9.352156799888666e-01   +2.644400544594449e-02   +7.118041426595190e-01   +3.732631148503933e-01   +5.312796805711036e-01   +5.062896686974266e-01   +2.310398138708095e-01   +3.298697330477195e-01; +1.029405237087914e-01   +2.502510184432010e-02   +6.783373298516779e-01   +8.649473496076622e-01   +1.033591901936587e-01   +4.220911223667147e-01   +8.487578150008401e-01   +8.417504770480996e-01   +4.798473553016149e-01   +1.889489199578927e-01   +1.946948705126211e-01   +1.643791960818436e-01; +8.559829503283991e-01   +6.925227993633503e-01   +8.353360297269392e-01   +3.371601404117469e-01   +4.097658575377843e-01   +2.543477320588667e-01   +4.049739410645552e-01   +3.843136634759517e-01   +9.009416514671397e-01   +9.604005932971097e-01   +2.789582006081074e-03   +3.828241549062967e-01; +3.385210034162801e-01   +3.272684380285231e-01   +6.847967263533292e-01   +1.781986766038373e-01   +8.922161323160160e-01   +7.303709013555341e-02   +2.858856019376655e-01   +7.696136707483539e-01   +4.819926409778316e-01   +4.508373241397529e-01   +6.463158286692293e-01   +5.261405842497656e-01; +1.500553057523213e-01   +7.729777434291847e-02   +8.954500530443835e-01   +8.807626532064299e-01   +7.391167301386695e-01   +9.193095892989311e-01   +2.611011861234108e-01   +7.739705726477280e-01   +4.858901980441921e-01   +6.059524499317552e-01   +4.000769741539277e-01   +5.961356010001513e-01; +8.081620031712442e-01   +7.448762327495453e-01   +9.508076549526870e-02   +8.427799470841656e-01   +9.592241502087042e-01   +2.682644273113131e-01   +5.053771361476147e-01   +4.322356926647691e-01   +3.129907535700703e-01   +6.447770201612383e-01   +2.711905394920520e-01   +1.693737667992942e-01; +6.546299312220474e-01   +9.652286033061073e-01   +6.999048150899397e-02   +8.349839650785713e-01   +9.708809789538918e-01   +1.011487042256185e-01   +1.162864924934809e-01   +4.867710879852697e-01   +8.594997496359007e-01   +7.652880643480033e-01   +3.611000196836012e-03   +7.377966200779335e-02];
L3E_L3I_iGABA_netcon = [+4.379140375383393e-01   +7.204805023335201e-02   +6.752497793164949e-03   +4.952802745068322e-01   +5.430307704916282e-01   +2.522544684638596e-01   +7.178430964333938e-01   +7.617582882985888e-01   +3.788977117284566e-01   +4.478453263590225e-01   +2.005203420082967e-01   +6.496205103413112e-01; +5.829403038775961e-02   +8.078033318370733e-01   +1.313096151584901e-01   +1.926692965862894e-01   +2.109255758660799e-01   +3.335439272225129e-01   +2.210524939132142e-01   +8.880088570221841e-01   +6.102932008479475e-01   +3.940146921430827e-01   +8.284810834801459e-01   +8.992055665119720e-01; +6.259010417779031e-01   +9.088471340680280e-01   +3.094410173887641e-01   +6.422318225123219e-01   +2.704642985487185e-01   +5.918628574676458e-01   +4.984504274981256e-01   +7.326102920386153e-01   +1.671317400181255e-01   +6.686454157532770e-01   +4.472422823185205e-01   +8.371726313578747e-01; +7.994068805314510e-01   +4.254108225873646e-01   +2.378787460961561e-01   +2.551830481039524e-01   +1.317971952425512e-01   +4.820059513086231e-01   +4.746643363747178e-01   +6.965729852243967e-01   +1.058041010685370e-01   +3.367085975403955e-02   +4.231665055924853e-02   +1.701932890422315e-01; +4.015867055544529e-01   +1.840511803913032e-01   +6.480985816181342e-01   +9.489921596456983e-01   +1.619703544888873e-02   +8.985049721446636e-01   +4.304991473604168e-01   +6.467353939558631e-01   +6.254669329021030e-01   +7.868198067468898e-01   +7.680853031181021e-01   +1.604623050468816e-01; +8.837484514872294e-01   +1.823717496914642e-01   +8.069735519575919e-01   +2.885160489945479e-01   +1.467880969496957e-02   +2.950074562831895e-01   +5.554690428543885e-01   +6.188190318975335e-01   +9.513245626408294e-01   +3.782135100675112e-01   +9.717696637872107e-02   +1.364012092879508e-01; +7.230928836512016e-01   +6.716188055745835e-01   +7.412039908306503e-01   +1.482937201380868e-01   +9.794001519940361e-01   +7.977528746383419e-02   +2.060776940757256e-01   +7.731519708592731e-02   +6.654866714636966e-01   +6.500961891535386e-01   +6.526897265793650e-01   +1.588864432902810e-01; +1.968737509407378e-01   +5.235676394241121e-01   +1.227093049814915e-01   +8.703424175176283e-01   +6.464763025528377e-01   +3.919984671876621e-01   +2.764159560270494e-01   +5.477574172366233e-01   +4.717959411523595e-01   +4.970346674391775e-01   +2.711615861282086e-01   +3.945981124435173e-01; +3.740967213580432e-01   +7.765586145690000e-01   +1.722029768361679e-01   +8.857185062940031e-01   +8.158339296831146e-01   +1.984599925829120e-01   +8.137485579895513e-01   +8.844001209384321e-01   +3.410056299299747e-01   +2.136968151598807e-01   +4.381168323810249e-01   +6.653331323231535e-01; +2.122331995850427e-01   +2.996743555719587e-01   +2.726429810150903e-01   +6.681248719452577e-01   +2.767401634281549e-01   +7.224058108943243e-01   +9.430736936435231e-02   +9.866142747849100e-01   +5.901481509006551e-01   +2.158491881876856e-01   +8.485898043882785e-01   +2.238121794307138e-01; +2.594752026673715e-01   +4.736182267900235e-01   +8.138930569843753e-01   +9.977247065640176e-01   +1.366317019471284e-02   +4.205219698338628e-01   +3.206154223332372e-02   +7.096649819998692e-02   +5.472497449417030e-01   +4.516270752848504e-01   +9.017221720103987e-01   +6.442457403139615e-01; +9.920127520771931e-01   +7.073953371326519e-01   +5.904407914959414e-01   +2.681555646702885e-01   +1.024556999761707e-01   +2.679693656974937e-01   +6.451338521476492e-02   +3.210661466137207e-02   +3.968339132305631e-02   +6.287463893277766e-01   +2.845748017811204e-01   +6.127086389140509e-01];
L2E_Input1_iAMPA_netcon = [+9.935283029648017e-01   +9.898996860948416e-01   +9.991447188026930e-01   +9.865385310653114e-01   +9.857475282259129e-01   +9.987179858056384e-01   +9.833772775771680e-01   +9.981593043833855e-01];
L2I_Input2_iAMPA_netcon = [+9.912059298201519e-01   +9.996271494244410e-01   +9.854279774245717e-01   +9.950054843765551e-01   +9.888426192377959e-01   +9.892729365144900e-01   +9.965006304697922e-01   +9.968718009563131e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
