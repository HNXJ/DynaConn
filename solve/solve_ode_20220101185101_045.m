function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.649645766263031e-01   +1.709285469903115e-01   +2.489940780561642e-01   +4.703893422895346e-01   +1.385731309545246e-01   +1.003626676534551e-01   +4.255313018460897e-01   +9.423327514601727e-02   +2.225530258271279e-01   +2.037966826280452e-01   +4.450191158601095e-02   +8.155279313936901e-02   +2.310556041736637e-01   +4.229313103272697e-01   +4.345446730987139e-01   +5.323450457681314e-01; +4.527653447715095e-01   +4.831560602840984e-01   +3.555926477629049e-01   +6.807972105962928e-02   +9.054118653956755e-02   +1.806624906725944e-01   +1.253824567859301e-01   +2.099839350354036e-01   +4.411398471463202e-01   +3.951619070681796e-01   +5.519652767451650e-01   +3.743657940884922e-01   +5.468590205866863e-01   +2.216914940431185e-01   +3.878512524168957e-01   +1.850532349130245e-02; +5.836145688772452e-01   +4.379626587603900e-01   +5.457102191326499e-01   +5.163092180050015e-01   +5.601196220215707e-01   +4.974095533695983e-01   +1.808079331644637e-03   +6.993679418340759e-02   +2.607613018634947e-02   +5.855828820663831e-01   +3.036311423180214e-01   +1.762318421727143e-01   +4.609142723983903e-02   +2.753002041092623e-01   +1.998741896614951e-01   +4.096021099203002e-01; +4.279270012939134e-02   +5.918990800483013e-01   +2.197926540742908e-01   +5.940803455859806e-02   +7.760128735599113e-02   +1.025545987840108e-01   +2.266242544304927e-01   +2.665548742270442e-01   +4.353882904481979e-02   +3.829018179712300e-01   +1.566211098359619e-01   +3.017702083149315e-01   +3.005367263612879e-01   +4.866162036259552e-01   +5.551359157062928e-01   +2.039251155102141e-02; +5.492270264316725e-01   +1.530158948549098e-01   +4.630280829833394e-01   +5.511949610329259e-01   +2.244970484261305e-01   +9.056228551087574e-02   +5.045750486674485e-01   +3.382990032452565e-01   +4.755081307578572e-02   +9.809184769554975e-02   +5.926313628117538e-01   +4.116536539424059e-01   +5.022948112612323e-01   +4.382308431989879e-01   +2.158492829195652e-01   +4.909741726434349e-01; +3.174366473032623e-01   +3.298049795317509e-01   +3.442601997504056e-01   +8.595726608422093e-02   +3.119730110823480e-01   +2.731136116365497e-01   +1.581907614435666e-01   +2.105114918883143e-01   +3.265509996244355e-01   +3.344011618734108e-01   +3.362100498948962e-01   +6.530400375273429e-02   +1.865202843821525e-01   +5.465278154701623e-01   +3.091005935461147e-01   +5.378606449875032e-01; +4.951803609083421e-01   +3.437515576770488e-01   +5.054101227013246e-01   +2.990852932179874e-01   +5.402291262663975e-01   +2.585083553259809e-01   +2.025062789711472e-01   +1.992019231202147e-01   +4.087873631406443e-01   +3.764547447394218e-01   +3.583410903481867e-01   +6.372785950902610e-02   +5.505483645859269e-02   +5.598345672923996e-01   +3.479330579056683e-01   +4.534377583849686e-01; +8.696951823864667e-03   +5.613148528349273e-01   +2.285863479411852e-01   +4.949316194384919e-01   +2.428251353126996e-01   +4.036245371898611e-02   +2.859692434733080e-02   +1.210261495811128e-02   +5.405701461480460e-02   +3.433001160656946e-01   +5.475142482633025e-01   +4.608329426705233e-01   +1.759996441310665e-01   +1.475854897909612e-01   +4.145304435886671e-01   +1.765217969505828e-01; +3.560860433951484e-01   +1.090076307590401e-02   +5.126375162490272e-02   +1.443310893210946e-01   +1.017113695146235e-01   +3.658019093593738e-01   +4.032707522702393e-01   +2.145857726853981e-01   +3.489542228387855e-01   +3.383625619110394e-01   +1.857896479097362e-01   +4.271864424911265e-01   +1.581372221818664e-01   +1.434831475223459e-01   +5.409206920752179e-01   +2.440147899738118e-01; +5.030661603150443e-01   +1.334787975539954e-01   +5.134205687701240e-01   +1.182190366042150e-01   +9.624822193572045e-02   +1.126108850211618e-01   +1.679684131575026e-01   +3.667576041083977e-02   +1.762481302040280e-02   +1.238983485670630e-01   +4.834076371165743e-01   +5.799404175274260e-01   +7.407580629365117e-02   +2.066420737907441e-01   +5.114585382200639e-01   +5.833384409861564e-01; +1.995747722667829e-01   +5.744992982984266e-01   +3.665010249164639e-01   +4.038284348499387e-01   +8.788777387404226e-02   +2.793101139861809e-01   +4.701167028800677e-01   +2.529375990096165e-01   +2.874979418367937e-01   +1.894927181665093e-01   +1.145190813167878e-01   +2.993738378158029e-02   +5.536936064084456e-01   +1.570653001741834e-01   +5.269354735156672e-01   +3.968168578831079e-01; +5.269833625559418e-01   +1.590711167069824e-01   +5.595395668478936e-01   +4.571539049261556e-01   +1.580618923888309e-01   +1.676338943722269e-02   +3.719906579027745e-01   +2.818056408462666e-01   +5.456711363036395e-01   +4.389962930611467e-01   +3.053807756287080e-02   +9.514157567402061e-02   +4.723567856156074e-01   +3.053517986839345e-01   +4.993197488039741e-01   +1.740916868552586e-01; +1.136210936449579e-02   +4.642263184650025e-01   +4.051955645170970e-01   +6.684504216359083e-02   +1.887808583277950e-01   +3.614014975798880e-01   +9.815005948723632e-02   +4.323170513229047e-01   +3.647483157163494e-01   +2.166106434456233e-01   +1.592534158310533e-01   +4.776607719849555e-01   +5.645153603198381e-01   +5.553475562324334e-01   +9.337647044461181e-02   +2.273715022369878e-01; +6.885093537094461e-02   +4.961650965691866e-01   +5.522539235428091e-01   +5.566551084715147e-01   +1.511437764858805e-01   +1.425801940030103e-02   +2.112120305888689e-01   +1.733900723433823e-01   +4.280558247249969e-01   +5.062327144994588e-01   +2.955069713873377e-01   +5.104450332877825e-01   +5.158724577827761e-01   +7.961404829104261e-02   +4.313803970144753e-01   +3.967244789218030e-01; +2.249398453742126e-01   +2.204973953830322e-01   +4.902016537945057e-01   +9.225436061018154e-02   +3.585956991132063e-01   +2.907513867699579e-01   +1.855481684886037e-01   +2.686922381002970e-01   +5.762473662871929e-02   +8.485040893521501e-03   +1.168178131479126e-01   +5.826594603759399e-01   +4.859120769613731e-01   +3.714016449113452e-01   +4.646719438321208e-01   +4.313267968989563e-01; +2.058500631580091e-01   +5.638599442029680e-01   +2.878461967162497e-01   +4.366181141120715e-01   +5.862872455230252e-01   +4.460126427162656e-02   +2.836363357302373e-01   +2.722769378102308e-01   +3.991482660576465e-01   +5.825377230479951e-01   +5.144327577866150e-01   +2.151419828867552e-01   +4.587952550498104e-01   +1.006823467878009e-01   +1.478432143395452e-01   +5.592511565725494e-01];
L1E_L1I_iGABA_netcon = [+3.395773054511470e-01   +3.633011226014329e-01   +1.898247220383080e-01   +4.939253805918676e-01   +1.910782006502433e-01   +5.335035829492378e-01   +3.573690346291470e-03   +1.004857910420943e-01   +2.236773074620921e-01   +5.611482799504901e-01   +2.156930124848466e-01   +3.353961379733084e-02   +8.512350036228460e-02   +3.822504675593161e-01   +4.668174535131258e-01   +2.761673966584819e-01; +1.922007877110167e-01   +9.623331251648146e-03   +3.918852306741932e-01   +5.418861665133055e-01   +5.805741052845004e-01   +3.331644482449390e-01   +8.042715970359060e-02   +5.838847492227922e-01   +3.375421088848009e-01   +5.046275412107947e-01   +1.182505034737987e-01   +5.391859974502238e-01   +1.205227952689990e-01   +5.674859319927449e-01   +3.510713396731032e-01   +4.704002938309606e-01; +5.483678791832148e-01   +4.564936595184216e-01   +1.188752188599306e-01   +5.558799372581128e-01   +5.806433564960428e-01   +3.063849245625039e-01   +5.588344039442414e-01   +3.007939313838462e-01   +2.026371336688777e-01   +9.557691950077649e-02   +7.669313642339591e-02   +2.496879816034815e-01   +1.353018793721552e-01   +5.221611655276064e-01   +1.888683058374277e-01   +1.858293383527359e-01; +1.658410979962074e-01   +1.724612666620226e-01   +5.811589224865239e-01   +2.334546344551467e-01   +3.750889810061498e-01   +4.825303125333759e-01   +7.407863166970341e-02   +4.583523470938492e-01   +5.653085525358619e-01   +4.338079016108049e-01   +5.460486074746720e-01   +2.023878890933667e-02   +2.450478384152822e-01   +4.078752642493019e-01   +3.964347783175252e-01   +4.363305194295646e-01; +5.118525276981006e-01   +6.989012970272541e-02   +2.807351086756612e-02   +9.491567441366749e-02   +5.887228289406624e-02   +1.392724490607528e-01   +3.195618466752511e-01   +3.521154338244157e-01   +1.931918377699387e-01   +2.093327714988849e-01   +3.062067675438307e-01   +9.863667469897626e-02   +2.395347344686715e-01   +2.583260211133004e-01   +2.456578103169055e-01   +2.494089296090501e-02; +5.259436742212307e-01   +1.103678063482677e-02   +8.243087228357023e-02   +2.996877968033710e-01   +4.367750379285033e-02   +1.787401329810600e-01   +4.145757481020798e-01   +5.682986195045092e-01   +2.858118880731370e-01   +3.146724793232153e-01   +4.112203658457103e-01   +3.939334459565367e-02   +2.038758746510414e-01   +2.448424704819556e-01   +8.274032512627746e-02   +9.240478391722337e-02; +5.811182196578919e-01   +2.385178601827527e-01   +5.249139893261698e-01   +2.581479952841653e-01   +5.050289882800503e-01   +1.018496581779471e-01   +5.071966488212388e-01   +2.493258230373891e-01   +2.769725312738581e-01   +3.144519800603796e-01   +2.044287780114487e-01   +5.177102591355545e-01   +7.083300445667097e-02   +3.642818159467163e-01   +4.786775887716745e-01   +8.082924384943136e-03; +5.603693055466037e-01   +9.793046638990405e-02   +9.024939318533748e-02   +3.449973379599788e-01   +5.046493324502026e-01   +9.163772036266685e-02   +1.085080185520722e-01   +8.766291536615088e-02   +7.487889465337708e-02   +1.721750395410893e-01   +1.210786953537654e-01   +1.906716758819824e-01   +4.708885514553675e-01   +6.966269724549026e-02   +2.750662568631982e-01   +1.158319041860614e-01; +4.545291850271088e-01   +3.213652604568981e-01   +4.944481066254331e-01   +1.075035546320221e-01   +4.375990176547265e-01   +4.499171342052499e-01   +5.895451283636918e-01   +7.524888571687396e-02   +5.313556012880875e-01   +2.037120189303784e-01   +3.902948895781813e-01   +3.582124938011556e-01   +4.772853279390055e-02   +2.046269868454717e-01   +4.844094290550936e-01   +1.761217182809826e-01; +3.669977475737395e-01   +5.315979210184912e-01   +2.493136391519966e-01   +3.080144947304358e-02   +5.684330026033687e-01   +2.115205622061421e-01   +3.125982440305509e-01   +3.394329019114474e-01   +4.160429305384194e-02   +4.796439465497709e-01   +1.229258140412682e-01   +1.845940852908775e-01   +2.616598917410532e-01   +3.535690884221658e-01   +6.021843489374551e-02   +3.915489911660456e-01; +4.988025708612457e-01   +4.525067453218689e-01   +2.798324340288377e-01   +3.323312381687681e-01   +2.091636015173739e-01   +1.543633244006804e-01   +2.751485861846554e-01   +6.948819046960163e-03   +1.804261400214507e-01   +2.621820822013460e-01   +2.325695258403745e-01   +4.333612574777072e-01   +3.922564052939033e-01   +1.194225926117723e-01   +2.649281535804630e-01   +5.458939428473282e-01; +2.196732097310067e-01   +2.531770204860937e-01   +3.538679531286375e-01   +4.453414178989333e-01   +3.837296564878843e-01   +1.728972661531429e-01   +1.489532747376533e-01   +4.119783509559781e-01   +2.990700673765828e-01   +4.460803569599658e-01   +4.775124216340011e-01   +1.005168762441231e-03   +4.821676151116618e-02   +2.796422536090952e-01   +4.880405747606600e-01   +2.592616631780975e-01; +4.369461734574763e-01   +1.249092517483334e-01   +3.583547965047243e-01   +5.066931966645962e-01   +4.274762315960094e-01   +3.290396256555983e-01   +2.386134406639837e-01   +3.108066040616760e-01   +2.326677687121610e-01   +2.197183449760245e-01   +1.515890340994023e-01   +1.623637786607967e-01   +4.835945122503170e-01   +5.880958778809003e-01   +2.213793560434903e-01   +3.068782390638583e-01; +2.408442008615594e-01   +9.735421480940733e-02   +2.831426148148676e-01   +2.169995746116427e-01   +2.258339684241552e-01   +4.127104449251588e-01   +4.937491741890886e-02   +5.537024088326270e-01   +5.701434852259409e-01   +4.614370869326271e-01   +7.077836711694624e-03   +2.581865949965174e-01   +8.149026179729765e-02   +1.462361269358642e-01   +1.204702288953423e-01   +5.209020500779014e-01; +3.712111237073187e-01   -3.113348392757982e-03   +2.357992798107449e-01   +6.828881983406136e-02   +1.148917081990651e-01   +4.777547519812107e-02   +5.146794901670168e-01   +2.882637492004909e-01   +5.586988200837948e-01   +3.855156398594961e-01   +2.458154909125771e-01   +5.147089151736421e-01   +2.271237559888303e-01   +5.662923276681691e-01   +5.567302051835881e-01   +4.424233380199820e-01; +1.984281321983209e-01   +9.439118776665913e-02   +9.569460712620066e-02   +3.093211065751889e-01   +4.021433307097096e-01   +5.569090013339217e-01   +2.332704328763935e-01   +4.720534074549097e-02   +5.839515743621329e-01   +1.642199733850803e-01   +3.457402495886591e-01   +3.751976947343084e-01   +6.627962346238088e-02   +5.514586128103876e-02   +7.696363670392031e-02   +1.499280390650757e-01];
L2I_L1I_iGABA_netcon = [+2.731700061323352e-01   +5.717222988465629e-01   +3.621093545336525e-02   +3.581297065412862e-01   +5.498130780244062e-01   +1.900143807877523e-01   +2.257546073161563e-01   +4.128869954840838e-02; +1.124414254240282e-01   +1.240587257959958e-02   +3.810162335474044e-01   +4.686846385849716e-01   +1.829876063418190e-01   +3.459013212096093e-01   +2.222823626637980e-01   +1.620339966075918e-01; +4.365105242282489e-01   +1.358907224536057e-01   +1.385382937712196e-01   +4.136640420959671e-01   +1.365311095873301e-01   +3.718506485958699e-01   +3.407879999127711e-01   +4.118499135455621e-01; +2.615717360919935e-01   +4.258601565351682e-01   +3.877951722044411e-01   +1.936489596876332e-01   +5.212937737181049e-01   +3.632612419467578e-01   +7.128674845608475e-02   +4.399997958066421e-01; +2.847679167611843e-01   +1.275714461101455e-01   +2.581848340401808e-02   +1.390792009127776e-01   +8.635044587647850e-02   +4.940996721735252e-01   +4.428206545184312e-01   +1.367315674461087e-01; +5.630127316475642e-01   +1.977324991034119e-01   +3.831390924374046e-01   +1.954945007917141e-01   +4.643920858025242e-01   +4.562137869593053e-01   +7.067240056061018e-02   +1.074708904421102e-01; +2.332082886522417e-01   +5.110007410374681e-01   +4.242537648693668e-01   +5.044163081751029e-01   +3.839487545180507e-01   +1.900531825139082e-02   +5.761839871021284e-01   +9.940910311148474e-02; +5.797520368871285e-01   +2.442332237907447e-01   +2.666346740648136e-02   +3.205084161806670e-01   +3.112489294125130e-01   +1.515289195125981e-01   +4.824901852069322e-01   +8.565268650061517e-02; +3.387642307263191e-01   +1.470058969390672e-01   +1.745524017096554e-02   +6.493978467872180e-02   +1.235185752226663e-01   +3.408772479658655e-02   +4.667478095777713e-01   +1.432907708444731e-01; +1.671654858119204e-01   +2.542881919789584e-01   +2.484088103634792e-01   +7.774478056321965e-02   +4.958923140495615e-01   +4.025010731413788e-01   +8.315219894046637e-02   +1.646154240604317e-01; +1.728837655862925e-01   +4.539576448996577e-01   +8.246489234799334e-02   +3.998661404785161e-02   +2.589825000121055e-01   +1.680678913727552e-01   +1.244704764983771e-02   +5.918435153171548e-01; +5.673267173114712e-01   +2.132672061892003e-01   +1.854796167263442e-01   +5.660431591790889e-01   +4.807846516067948e-01   +1.250578392804020e-01   +2.007349404425050e-01   +8.737013798006746e-02; +5.941257663163980e-02   +2.991366011118649e-01   +4.635739328092587e-01   +3.667991828097317e-01   +3.880395381519402e-01   +4.061991100915703e-02   +1.732117450218412e-01   +5.825224185939042e-01; +1.965895239822185e-01   +2.012039833095023e-01   +7.759398496104515e-02   +1.291321038238921e-01   +5.722614415717848e-01   +7.002828243996209e-02   +3.005808084828893e-02   +3.270090962729688e-01; +4.592431343202308e-01   +4.351850135954013e-01   +5.588056467074141e-01   +4.541779307583075e-01   +7.110968820359120e-02   +7.246769908481576e-02   +1.131555441622426e-01   +1.221777237058572e-01; +4.230433658575609e-01   +5.400294112774894e-01   +4.261785353448943e-02   +1.178756765958005e-02   +1.287965981613344e-01   +4.682992699866325e-01   +1.942615706177366e-02   +3.787480769426649e-01];
L1I_L2I_iGABA_netcon = [+2.050097726432499e-01   +3.732366817730372e-01   +5.190882260069088e-01   +1.240391332580010e-01   +2.034226419281230e-01   +4.326227117760260e-01   +5.652128768003282e-02   +8.459229778671680e-02   +8.840400433961802e-02   +4.330292195619267e-01   +2.222765409197196e-01   +3.140042940106860e-01   +4.585038262717503e-01   +4.810645599279857e-01   +4.743133402591272e-02   +2.725226565451396e-01; +1.943023931742783e-01   +2.032554258028398e-01   +1.384015725513971e-01   +2.318279281136375e-01   +5.078789701597290e-01   +1.057994492254407e-01   +3.518787189473680e-01   +1.297764268677554e-01   +2.926347153458769e-01   +9.796532492413668e-02   +5.553355528487522e-01   +3.974724836536075e-01   +5.977076453318239e-02   +1.298227229631715e-01   +3.902343552735636e-01   +3.621589215286655e-01; +3.081758615074434e-01   +1.945715264967047e-02   +1.012403915966227e-01   +5.487372543628474e-02   +2.150641843883442e-02   +1.066181950622075e-01   +4.707838179315020e-01   +1.872220642843575e-01   +3.614932691459453e-01   +3.053595192871075e-01   +4.011246669356188e-01   +2.421923851854835e-01   +4.097902313309835e-01   +3.567729594416160e-01   +2.624648825228593e-01   +3.010494094619152e-01; +3.373027371330568e-01   +5.924655159636553e-02   +2.405199818286264e-01   +5.846949974468501e-02   +3.391259151071419e-01   +4.261108374707145e-01   +3.775577115447857e-01   +2.091045520734232e-01   +3.554314032647761e-02   +4.519007333718068e-01   +6.244703361316639e-02   +4.647335411183301e-01   +2.890968767564690e-01   +3.695455055366421e-01   +9.522895887312335e-02   +5.663131149805882e-01; +6.467202560916481e-02   +5.080080818357974e-01   +5.591862618066174e-02   +3.583651684669671e-01   +2.022754991638753e-01   +2.647670289746366e-01   +3.162103060650726e-01   +3.871749659056462e-01   +3.134849437386851e-01   +4.161294007027758e-01   +2.634913713016505e-01   +3.708806572969221e-01   +1.491722183367785e-01   +4.626829038462706e-01   +5.519132038380414e-01   +1.652685024689702e-01; +8.970845179970421e-02   +3.198011366591663e-01   +5.437228309697140e-01   +4.717132986407881e-01   +4.151229828448910e-01   +5.346522488505843e-02   +2.545243327999364e-01   +7.410911195713341e-02   +1.161196619767067e-01   +2.057984010240768e-01   +1.278174776807960e-01   +2.721715913060046e-02   +5.391441000764525e-01   +3.141521004800808e-01   +5.011890954057833e-01   +2.213299818981877e-01; +3.546341151279088e-01   +2.032303808753508e-01   +8.451912723583996e-02   +4.529910154098354e-01   +7.665883413930527e-02   +3.823983244499122e-01   +1.848454103770626e-01   +3.998345172183103e-01   +2.729189709368137e-01   +5.241797934593909e-01   +4.768975506949206e-01   +2.171879321765052e-01   +3.696176093507056e-01   +3.493732799816601e-01   +3.788776221979275e-01   +1.577705552136816e-01; +2.884687961439522e-01   +5.567637966778263e-01   +1.300385807313886e-01   +5.493196252184838e-02   +3.791645234934578e-01   +4.344887038208331e-02   +3.519936218660484e-01   +1.532690191751551e-01   +3.411833395249238e-01   +1.429465351765216e-01   +5.278930483204654e-02   +3.037588076242411e-01   +4.739775176784914e-01   +1.713201754010506e-01   +4.545196081031279e-01   +2.240704432459342e-01];
L2E_L1E_iAMPA_netcon = [+5.345081382848894e-01   +5.016008122785943e-01   +4.552903880854693e-01   +5.675858774476547e-01   +4.821398585655887e-01   +4.288931142728207e-01   +3.483823645548507e-02   +5.814761285217683e-01; +2.881371003435073e-01   +7.873623793232833e-02   +1.465793336816764e-01   +1.233264779598536e-01   +2.266445081712724e-01   +2.339868816627761e-01   +8.713686620018575e-02   +1.793762867595002e-01; +9.058204076212832e-02   +3.805288268104885e-02   +3.222907267145596e-01   +2.942840733138998e-02   +4.166350330184216e-01   +3.520685310751219e-01   +4.743947991246537e-01   +5.882963643249719e-01; +4.266025205474731e-01   +3.086556109035923e-01   +5.845840406245914e-01   +5.639221739988688e-01   +5.168695704533058e-01   +3.388018331063388e-01   +2.233851957989612e-01   +8.614079420630786e-03; +4.697929538218403e-01   +3.405028687492457e-01   +3.047327237148502e-01   +3.911393900033632e-01   +2.731048837215288e-01   +5.406844124113620e-01   +4.940939773896123e-01   +2.091515875175977e-01; +3.437642014955420e-01   +5.881700401918133e-01   +4.866920630445367e-01   +1.470820790537054e-01   +2.323707995575429e-01   +2.562646287011565e-01   +1.766812325834647e-01   +5.056004244467713e-01; +1.618255328361946e-01   +4.326261518778846e-01   +5.037630643660314e-01   +1.558669764608931e-01   +5.168646133116480e-01   +2.929569394460731e-01   +1.468839514420210e-01   +1.626836557859116e-01; +3.627789075532077e-01   +5.218025251895866e-01   +4.722436532714750e-01   +5.832686132847164e-01   +2.968383709094774e-01   +2.372400327079984e-01   +5.466159529024474e-01   +1.744523956525708e-01; +3.116921952899998e-01   +3.195670282863855e-02   +1.925314053031359e-01   +2.343985430700298e-01   +2.581696210407564e-01   +2.413682226652650e-01   +4.637365164678265e-01   +9.112884191327104e-02; +5.413531561914927e-01   +3.735733628898322e-02   +2.667848991009915e-02   +4.881624849416560e-01   +4.767938095496081e-01   +4.640151257741070e-01   +3.622745113308976e-01   +1.836364974560459e-01; +4.341489932853741e-01   +5.183681334656178e-01   +1.233573171508235e-01   +3.217891193958878e-01   +2.206358542582573e-01   +2.485970462309346e-01   +3.462813236731420e-01   +4.610133303334980e-02; +3.379151815413043e-01   +4.573237827218996e-01   +5.813356366960571e-01   +4.139404403234825e-01   +3.091273399494802e-01   +4.573355130908667e-01   +2.556406652948021e-01   +4.887701653483098e-01; +6.844440700559214e-02   +5.662103206247217e-01   +1.080914189597740e-01   +3.668477003371069e-02   +3.392360583846792e-01   +5.299614987015026e-01   +1.664789967633200e-01   +3.882886399379215e-01; +5.769671918574553e-01   +4.408764621021843e-01   +3.416047274005952e-01   +2.397436601216527e-01   +5.241949460510751e-01   +4.483258292988349e-01   +2.934773929390625e-01   +3.436281042395221e-01; +2.077666381999208e-01   +4.165725432782247e-01   +3.448530808485634e-01   +4.418836012592960e-01   +2.679176368341438e-01   +4.201077228389267e-01   +3.859571779929209e-02   +1.526782795368785e-01; +3.086781568956422e-01   +2.180987853707510e-01   +1.627642293592722e-01   +2.444635270264744e-01   +3.669083918945500e-02   +3.945002763664228e-01   +2.760314951921093e-01   +9.670208923192751e-02];
L1E_L2E_iAMPA_netcon = [+2.313468217541793e-01   +3.686903252318542e-01   +4.473466264306031e-01   +5.335043236068757e-01   +4.831480171849181e-01   +5.549555836432343e-01   +3.678817499332856e-01   +4.708903693743317e-01   +2.983869500892434e-01   +2.929499010991770e-02   +1.777494436539396e-01   +4.252636127223267e-01   +2.808367825283473e-01   +9.442588514865130e-02   +9.020375688295311e-02   +1.815899702455629e-01; +3.174317512607750e-01   +2.783106698856486e-01   +3.600652107953061e-01   +2.386906982323170e-01   +5.799510762070114e-01   +1.554867752781275e-01   +2.515386091757743e-01   +3.209099947941866e-01   +3.591389939125670e-01   +4.766077410746414e-01   +5.743996870353317e-01   +1.580331122806197e-01   +1.130913866562516e-01   +1.074564544919355e-01   +4.304666627394105e-01   +1.035069383902418e-01; +3.496397701910183e-01   +5.384823645982076e-01   +1.919575737409502e-01   +5.114657470776061e-01   +9.067649037519056e-02   +3.159531245517442e-01   +2.983807273778110e-01   +3.162014242202653e-01   +5.722836697553411e-01   +4.278640541965049e-01   +3.549267668594908e-01   +5.181911906183059e-01   +3.125741347054010e-01   +3.904773785997556e-01   +3.284127934345800e-01   +5.035221121486998e-01; +1.537415855660357e-01   +3.472119059897606e-01   +3.716854294754257e-01   +8.258537244209102e-02   +2.560180460830603e-01   +6.177269283218072e-02   +4.348776431661834e-02   +7.392380440006223e-02   +3.421711108814978e-01   +3.738570678730931e-01   +3.049469696735979e-01   +2.701677684407458e-01   +2.147523795881180e-01   +6.200262314823472e-02   +5.639716008102029e-01   +4.022694193944740e-01; +1.660910164161707e-01   +3.053520000019355e-01   +4.115016882301703e-01   +4.620136562079735e-01   +5.648657557718288e-02   +1.393057545371350e-01   +2.012584291736592e-02   +9.510451756038384e-02   +4.987282771844740e-01   +3.207075175356176e-02   +2.282384230645317e-02   +1.190253442489810e-01   +2.626821135376221e-01   +5.703345070772462e-01   +3.228125529087890e-01   +5.814880823356373e-01; +1.290723431444958e-01   +2.399205384556759e-01   +3.493397321549006e-01   +4.071912174845233e-01   +1.857801950153885e-01   +1.789966856738405e-01   +1.488839465483129e-01   +5.847470243792052e-01   +4.572649165922812e-01   +2.956240854091580e-01   +5.513157409054719e-01   +4.154201245743999e-01   +2.395537943024777e-01   +1.919362621022752e-01   +1.695575192230381e-01   +1.524506271953005e-01; +5.081216932190254e-01   +1.451801370119815e-02   +5.232690279317743e-01   +2.765081705514718e-01   +3.633957203650010e-02   +5.469887197695360e-01   +2.433018161341868e-01   +2.720648141492167e-02   +5.045413074224230e-01   +3.038955275324312e-01   +3.038555895570368e-01   +1.071576259348323e-01   +4.334694906196362e-01   +3.764977855383258e-01   +1.614960135316942e-01   +5.768614826015652e-01; +5.182261538104295e-01   +2.404352652184934e-01   +4.918108956971968e-01   +2.220099925587786e-01   +1.501708152868342e-01   +2.602433374600504e-01   +4.717630319077739e-01   +4.261031458445810e-01   +3.067925855970089e-01   +1.995545919683224e-01   +1.423678028246873e-01   +3.070465363453636e-01   +3.163071138705734e-01   +2.084227069915530e-02   +2.041257269516939e-01   +1.017329033789725e-01];
L2I_L2E_iAMPA_netcon = [+4.264784752426323e-02   +7.081517280564611e-02   +4.074647503871615e-02   +9.724789170073212e-03   +3.415242925446170e-01   +5.314320506656607e-01   +5.380956075007698e-01   +5.845621369068666e-01; +4.687818352723940e-01   +2.582257656443687e-01   +2.485344823567985e-01   +3.573168900574241e-01   +3.521840496887586e-01   +3.332814957517837e-01   +2.527795407237228e-01   +3.072248791833719e-01; +6.814093121281450e-02   +3.322337897150152e-01   +7.301102515288646e-02   +3.822540432831328e-01   +1.544718754306397e-01   +3.759691051215519e-01   +4.262517119856703e-01   +6.957646417681849e-02; +2.254197145720698e-02   +3.683538447549918e-01   +5.271043001691869e-01   +5.102480419308407e-01   +3.039568580402868e-01   +4.119423664324435e-01   +3.247732593691014e-01   +2.160209857587842e-01; +4.937726956538340e-01   +3.592873618888124e-01   +2.907921451259412e-01   +4.564701051816763e-01   +5.035749066591442e-01   +4.506982556528232e-01   +2.746078119032543e-01   +3.941514081044885e-01; +4.104408316486367e-01   +1.451168403943956e-01   +3.716527241888284e-01   +6.525409630120295e-02   +1.670780021954658e-01   +4.390886780662454e-01   +5.252825359930073e-01   +1.769602524228155e-01; +4.711508303604999e-01   +4.967751054929116e-01   +3.547939983688770e-01   +5.361238156478381e-01   +2.903145450703773e-02   +6.003617558364312e-02   +5.592516910496578e-01   +5.596817639267128e-01; +3.078490238339966e-02   +1.654973057636556e-01   +5.172397851608234e-01   +3.693937008925445e-01   +2.270919134492360e-01   +3.093668970598555e-01   +1.712061658835678e-01   +1.040255806743870e-01];
L2E_L2I_iGABA_netcon = [+4.250090174368907e-01   +3.741207592676994e-01   +4.703295643902979e-01   +1.309685298174736e-01   +1.612765784297584e-01   +2.609309510368296e-02   +3.761914961007303e-01   +9.762338274298722e-02; +3.962538911632477e-01   +2.853660902015744e-01   +3.239878819399442e-01   +2.731581679161356e-01   +4.069721569673889e-01   +6.041791570124042e-02   +5.343628698264639e-02   +1.640094834271918e-02; +1.797521493847067e-01   +2.072440819216801e-01   +9.121367917117496e-02   +2.488169761424081e-01   +5.741731143514288e-01   +4.725885982473071e-02   +5.280067119730428e-01   +2.566181601467233e-01; +5.895354180979157e-01   +7.614798457861069e-02   +3.555287000370956e-01   +4.787397301841025e-02   +5.138133889405125e-01   +1.946106529897547e-01   +5.084086459495368e-01   +2.785964469648279e-01; +4.967551208979330e-01   +2.660238309702184e-02   +1.727681407943701e-02   +1.030626571452124e-01   +1.942661408940919e-01   +4.289031783623471e-01   +4.057454683270764e-01   +3.392165467598284e-01; +1.851673261142550e-01   +1.070106946891501e-01   +2.257758521206200e-01   +9.358743576587913e-02   +4.451291511472819e-02   +6.770592837939045e-03   +4.683820635804158e-03   +1.464704547359521e-01; +1.562284146493050e-01   +5.049386709491637e-01   +4.894989479399874e-01   +2.350492746817637e-01   +5.165453367045805e-01   +2.755577386853570e-01   +2.518367912504366e-01   +3.113118676399158e-01; +7.400575433860604e-02   +4.218061056400441e-01   +3.060149867203895e-01   +3.741887136078903e-01   +1.209055555828472e-01   +1.329782044319830e-01   +8.023859004130024e-02   +1.804218377818570e-01];
L3E_L2E_iAMPA_netcon = [+2.787168753606435e-01   +3.175793947246777e-01   +4.947819493593242e-01   +2.792373273914546e-01   +2.696559817266219e-01   +3.759674578122416e-01   +1.092989061660465e-02   +2.769612098832449e-01   +3.741696898371859e-01   +5.434132692132628e-01   +2.530681209602265e-01   +5.235304224342220e-01; +4.325499806464589e-01   +3.520309897263021e-01   +1.472530504200652e-01   +2.068556882174316e-01   +2.782018054571771e-02   +7.191682096870372e-02   +1.284129082778306e-01   +7.131659431181299e-02   +1.539809810787530e-01   +5.193156733433718e-01   +4.874116038423170e-02   +8.910796987351212e-03; +4.564889759709026e-01   +4.802274841696260e-01   +5.763453519107717e-01   +5.208879259234299e-01   +1.862529608682296e-01   +1.059447028115776e-01   +3.754551716186636e-02   +2.090163745099894e-01   +2.714271336498583e-01   +8.390268255107011e-02   +3.342992162233933e-01   +2.907122537906726e-01; +2.167788406560502e-01   +4.154675097805628e-01   +2.504689396495862e-01   +4.059709402971421e-01   +3.212015091578121e-01   +2.928000910857424e-01   +3.006567342349025e-01   +2.491303877515153e-01   +1.202507470497221e-01   +3.474732403663551e-01   +1.875228631867143e-01   +3.968034304232838e-01; +1.931312470365874e-01   +1.480086032916417e-01   +3.841035571416648e-01   +5.548393432622752e-01   +3.708428345084893e-01   +2.417393892612641e-01   +1.031341517834983e-01   +4.407815283704947e-01   +4.437927857333551e-01   +2.320360637205985e-01   +1.150336843796201e-01   +5.689236152123542e-01; +1.597807457837374e-01   +2.401137038445239e-01   +3.438901893367016e-02   +2.913252287312513e-01   +2.285448549144403e-01   +3.818035619231718e-01   +2.555023945861111e-01   +4.890235904864761e-01   +1.008168409480789e-01   +5.751476152499638e-01   +4.740415505886461e-01   +1.409551518502985e-01; +4.645364673257799e-01   +5.210895730706921e-01   +2.829559488346882e-01   +5.890970557983494e-01   +5.077942517004250e-01   +5.430116682868513e-01   +3.829470967983064e-01   +2.703717423594152e-01   +5.992940232466641e-03   +7.359973656953818e-02   +9.193504871066616e-02   +2.075980313283795e-01; +1.669637850620601e-01   +1.995466015551128e-01   +3.099386902147808e-01   +4.000098191640442e-01   +4.680395858479490e-01   +4.930453878135990e-02   +2.560741879901878e-02   +5.399754092400209e-01   +2.830434311789883e-01   +4.583866849070356e-01   +1.967146940685227e-01   +2.130025791719808e-01];
L3I_L2I_iGABA_netcon = [+4.741570035719360e-01   +3.997912539782150e-01   +3.602461504282096e-01   +5.215603999417666e-02   +3.291485721628266e-01   +1.555885716371922e-01   +3.123194951158848e-02   +5.308102215723928e-01   +1.353971140722568e-01   +2.546353234605275e-02   +4.197895404138227e-02   +3.652054772772446e-01; +3.875205195405135e-02   +5.055188267475523e-02   +1.917183601102951e-01   +3.466058981872734e-01   +4.755917223379956e-01   +3.255141429327681e-01   +2.075314031009297e-01   +5.313144377581328e-01   +4.574452557205499e-01   +3.141073815146179e-01   +5.881406191836879e-01   +1.718588740117659e-01; +2.931302984074408e-01   +1.493314733513307e-01   +3.891167436635001e-02   +2.630513255982221e-01   +4.494715344766709e-01   +2.856684014423516e-01   +3.130186416309336e-01   +2.006663851413263e-02   +3.870489072604665e-01   +7.989155485833553e-02   +1.996634799653587e-01   +3.128181594748592e-01; +1.064648644861057e-01   +1.459182187295080e-01   +4.899579618039719e-01   +2.916045179375120e-01   +4.125304974387403e-01   +3.987528498120949e-01   +1.746123852865274e-01   +1.232641162964539e-01   +1.877427688464420e-01   +2.955639113773014e-01   +2.411347526335231e-01   +2.783862151054865e-01; +2.685240405156090e-01   +1.752733323692857e-01   +5.316425231524902e-01   +5.242379017634279e-01   +6.483119792386345e-02   +1.472586126104433e-01   +4.306948964859397e-01   +4.039028496216684e-01   +1.356325508327513e-01   +3.382565123638190e-01   +1.855173841450778e-01   +1.402547264512967e-01; +8.217496420670888e-02   +5.801942611432457e-01   +1.152403867023225e-01   +4.638435252618078e-01   +1.961437761314635e-01   +4.815194095277510e-01   +4.139065173209300e-01   +5.716415567097716e-01   +3.817166596235201e-01   +5.236126398726939e-01   +5.775562416512935e-01   +6.616439517495067e-02; +4.669561610495481e-01   +2.036130814250159e-01   +2.748789041202059e-01   +1.871645566588016e-01   +9.026815770913041e-02   +2.233986935457192e-01   +4.527835799977974e-01   +4.459406534946411e-01   +3.320993909563655e-01   +7.942041549986938e-02   +2.000086059584259e-01   +1.581585149028658e-01; +1.571155788142532e-01   +4.572831334398969e-01   +3.736232849534489e-01   +5.752918717762918e-01   +5.224361959609147e-01   +4.772054939422942e-01   +1.051067706096001e-01   +2.754239255179451e-01   +1.002317546991593e-01   +2.729045483675200e-01   +5.647866307084286e-01   +4.251496408358215e-02];
L2E_L3E_iAMPA_netcon = [+4.078898143917914e-01   +8.978516735858866e-03   +9.437021357891122e-02   +3.611486708702528e-01   +2.986567614430305e-01   +3.526142780126911e-01   +4.175652700048987e-01   +2.481839950127301e-01; +5.711336637037088e-01   +4.870087175803530e-01   +5.568776471690130e-01   +3.694899044519701e-01   +3.358789572288267e-02   +4.209831688561193e-01   +2.515854603317814e-01   +5.364585448853970e-01; +3.298537819465213e-02   +4.101588807584144e-01   +2.550172248795108e-01   +3.360612769467963e-01   +4.339332161356771e-01   +1.052474784028414e-01   +8.770080519441155e-02   +2.660793159904373e-01; +2.950880616879721e-01   +3.448534200874543e-01   +1.607459558904628e-01   +1.828262613982495e-01   +5.652230807787678e-01   +2.822001983492105e-01   +5.067394833485687e-01   +3.534314206823761e-01; +2.156949701860585e-01   +5.487940634606813e-01   +4.103899748197694e-01   +3.604935630801051e-01   +1.496281642684799e-01   +5.027200236169395e-01   +1.346325540702395e-01   +3.076512818617103e-01; +5.457029936264344e-01   +5.103758406258565e-01   +1.958722089251090e-01   +1.445220375367446e-01   +6.592651662368637e-02   +5.367926771762447e-01   +2.977930141043645e-01   +9.082201517905979e-02; +2.426050141120333e-01   +4.013650102672698e-01   +3.031837676657240e-01   +3.478772581724432e-01   +4.014617146172735e-01   +5.640359171012006e-01   +1.867105157774801e-01   +5.693955871025876e-02; +3.064232436661418e-01   +1.961910249075805e-01   +2.628451275319190e-01   +2.223071246313712e-01   +4.304227947271000e-01   +2.634143110090924e-01   +4.657616067246836e-01   +3.241093835496606e-01; +4.114335504942357e-01   +3.593085511123316e-01   +3.605228316618798e-01   +1.416928587721949e-01   +4.640175263536006e-01   +5.000413384243934e-01   +2.336192366344978e-01   +2.313090662656010e-01; +3.491029474205894e-02   +2.416450822034610e-01   +4.939204365645816e-01   +5.336310988352300e-03   +9.229870891130061e-02   +5.670510170501061e-01   +3.414052552613983e-01   +5.207989774385177e-01; +5.797258119006879e-01   +5.092097377841552e-02   +4.377713124526580e-01   +1.115434098341963e-02   +3.956572566363075e-01   +3.404212797223115e-01   +4.687464408334884e-01   +5.098116671622518e-01; +4.777770294774372e-01   +4.890533514337148e-02   +2.709429205186517e-01   +1.446361328387517e-02   +5.279209582301412e-01   +5.228879400163545e-01   +2.256304039191864e-01   +1.338182281802370e-01];
L2I_L3I_iGABA_netcon = [+1.164262552665636e-01   +5.070303868356107e-01   +2.889109155439961e-01   +3.420561752793413e-01   +3.821564443733910e-01   +3.002274819695692e-01   +3.683253890511052e-01   +5.552896825364659e-01; +8.610205526126163e-03   +4.525448493189059e-01   +6.005837893795592e-02   +8.031054930802929e-03   +5.770065602442594e-01   +5.313439744108513e-01   +1.292851079383517e-01   +1.949283776401832e-01; +5.352957691683436e-01   +1.334660700001122e-01   +3.377249387459608e-01   +4.443926442277115e-01   +1.548566228847540e-02   +2.715191430150165e-01   +8.714038302526718e-03   +5.912258162045645e-01; +2.149224313340820e-01   +1.086716029217835e-01   +5.347962435841872e-01   +5.360579654180987e-01   +5.909761998398041e-01   +5.770611838477970e-02   +4.085380210498045e-01   +4.529348069000941e-01; +2.259213617663123e-01   +1.415715313068349e-01   +7.653275781898172e-02   +2.060419132991725e-01   +3.021145692802129e-01   +1.265576986754597e-01   +5.305438806897045e-02   +4.735130877849470e-01; +2.823598157497765e-01   +4.146803061503934e-01   +4.705872689821656e-01   +8.009238560529085e-02   +3.654529836479840e-02   +4.139227769415760e-01   +5.422180412620684e-01   +4.650596425161101e-01; +2.254187802289104e-01   +4.989192267393998e-01   +5.536092277472688e-01   +4.408464436040094e-01   +1.596814621098756e-01   +4.677668627687092e-01   +4.643080658201985e-01   +9.767719603780785e-02; +9.318970672957426e-02   +1.530312860977335e-01   +2.002932423972297e-01   +4.799878896619594e-02   +2.810606114579612e-01   +3.867670503910535e-01   +3.219876936575379e-01   +4.235567557149962e-01; +1.978741726156071e-02   +1.351329977988812e-02   +8.385001959128834e-02   +3.573845020252654e-01   +2.232839138307840e-02   +3.855755921299578e-01   +6.849547254406420e-02   +4.453133963461343e-01; +3.425483362334016e-01   +8.101639108673121e-02   +6.279970859706345e-02   +2.047111499600258e-01   +1.005720952089954e-01   +3.529858239328506e-01   +7.181550407384278e-02   +3.095022613258129e-01; -1.585727690650983e-04   +5.735100726538207e-01   +1.973254658738343e-01   +2.745965063156142e-03   +6.582527331967980e-02   +1.618987783112736e-01   +5.478060711943508e-01   +1.320854332765061e-01; +2.065040526066032e-01   +8.715835665275594e-02   +5.674188094521456e-01   +2.648866709787717e-01   +3.629385700609208e-01   +6.133299252926954e-02   +2.214204749799324e-01   +1.658391882374195e-01];
L3I_L3E_iAMPA_netcon = [+5.890221516637095e-01   +3.186168071121098e-01   +2.079137897276969e-01   +5.570634544018529e-01   +3.480033615361192e-02   +1.507532165428829e-01   +2.827755182060886e-01   +5.512740734688695e-01   +4.258505091750097e-01   +7.726438985141452e-02   +1.994391109998579e-01   +3.706674168061745e-01; +3.184763055394655e-01   +1.797339842498900e-01   +4.464864153482970e-01   +3.054984134810741e-01   +3.976629464344353e-01   +4.582603164723154e-01   +5.465769558576770e-01   -7.543336557090520e-04   +4.097404683312357e-01   +2.708813904085097e-02   +1.790693264681407e-01   +2.138185309400286e-01; +3.891044846565658e-02   +5.270154077007705e-01   +2.769091811220655e-01   +2.234767512206294e-01   +3.298373571964281e-01   +6.306160681888318e-02   +2.633405403170277e-01   +7.956299749123676e-02   +1.576140758486791e-01   +4.939901507909559e-01   +1.453307315198203e-02   +4.802334166940972e-01; +5.394079938444489e-01   +1.442292543094754e-02   +1.308024477916152e-02   +2.889674670282593e-01   +2.616508728150936e-01   +4.056570205016616e-01   +1.674473755549310e-01   +1.914111372188460e-01   +3.461765357727748e-01   +8.565909486758425e-02   +4.878804590686749e-01   +2.078024364218676e-01; +4.376129272446751e-01   +1.796236792992600e-01   +1.926878837771151e-01   +1.617425080416787e-01   +4.008259570133737e-01   +3.400422649849167e-01   +5.819183343328352e-01   +2.111101327038392e-01   +1.179162960849676e-02   +2.143827657753259e-01   +4.784257770805181e-01   +3.012622244009087e-01; +3.347495293278902e-01   +1.379979299958813e-01   +4.328015114131588e-01   +5.866035701455882e-01   +3.287978639573257e-01   +3.225325779725156e-01   +5.505066870420207e-01   +3.699025077235726e-01   +3.163741674795043e-01   +4.164802885261396e-01   +7.613515636082381e-02   +5.507820283666062e-01; +1.893252354283825e-01   +2.375218339571086e-01   +5.052964691204882e-01   +5.145151838914537e-01   +2.813411760368309e-01   +3.377485756840609e-01   +5.087451477701682e-01   +4.488929590728610e-01   +9.999036838452069e-02   +4.235448838126768e-01   +3.792912013548959e-01   +4.405847814321102e-01; +4.480006328887812e-01   +5.516215602627205e-01   +3.443709724726130e-01   +1.083168240266832e-01   +3.691263942254846e-01   +8.310666883509471e-02   +1.320480698102931e-01   +2.513459378140798e-01   +2.413385749977200e-02   +4.235991886283983e-01   +5.283014459606690e-01   +2.193832294319741e-01; +3.277626041701687e-01   +4.539614789101671e-01   +1.973499639932394e-01   +4.411377094617020e-01   +4.283382554954184e-01   +2.264698980570832e-01   +1.904387944334359e-01   +5.659528584831696e-01   +3.358512502543584e-01   +5.415129060810877e-01   +2.882625921974102e-01   +1.404105058079060e-01; +3.106587776998274e-01   +2.695502273419111e-01   +9.109895324527623e-02   +3.667210999865299e-01   +1.125725361456235e-01   +3.927588645942440e-01   +1.588044859554615e-01   +2.495034255739276e-01   +5.034404221096359e-01   +2.208415999289033e-01   +4.808579044724657e-01   +2.880904192246589e-01; +3.903696617450118e-01   +5.612053797539610e-01   +2.202423155310513e-01   +1.173081062873762e-01   +1.188961737897408e-01   +1.190381344117295e-01   +1.848924775242148e-02   +7.114270562742796e-03   +4.360621300761106e-02   +3.923408921447442e-01   +4.814128311796447e-01   +3.368294103122632e-01; +5.156929774074270e-01   +1.250366753929732e-01   +1.429090795896008e-01   +4.225506704097733e-01   +5.236009138952195e-01   +1.736015045333232e-01   +2.855734828237709e-01   +3.931499340405482e-01   +2.617668017497876e-01   +2.901285158665224e-01   +2.734825526193011e-01   +5.095373325559706e-01];
L3E_L3I_iGABA_netcon = [+2.020169898950437e-01   +2.994927822461975e-02   +1.291304997297953e-01   +9.360297882355093e-02   +4.477112570756657e-01   +1.056345058531994e-01   +1.100220278112843e-02   +5.293973182134123e-01   +2.259381091127385e-01   +2.616617606388900e-02   +1.141630554149881e-01   +3.995192708828030e-01; +1.972175464628326e-01   +3.585629222937973e-01   +5.793334578765691e-01   +2.133668082235987e-01   +5.878898637166100e-02   +3.087896439136697e-01   +1.259211749127239e-01   +3.264361151560561e-01   +2.181329394481093e-01   +5.717346372230933e-01   +2.076520546781815e-01   +2.140592094470477e-01; +1.598404924306690e-01   +5.557041198162658e-01   +1.620940761094615e-01   +2.806917736159882e-01   +2.678414423741409e-01   +4.224694998315419e-01   +5.358479752396125e-01   +4.205489142872353e-02   +1.013439825199584e-01   +1.631214654063300e-01   +3.833214225498498e-01   +4.923960103798135e-01; +1.332751846699718e-01   +5.282226213217676e-01   +2.687830147760905e-01   +4.625962633215459e-01   +1.641385231609799e-01   +5.524945567621309e-01   +5.783610781858440e-01   +3.612412356955658e-01   +3.408847938397888e-01   +2.214752000944871e-01   +3.939612387461250e-01   +3.282192028658423e-01; +4.540374422611567e-01   +3.118466403863653e-01   +9.930888905432113e-04   +5.580058160976336e-01   +8.149000081286467e-02   +2.837168369166735e-01   +5.094373397568858e-01   +3.089625504639593e-01   +2.513896443556456e-01   +5.662512927653578e-01   +2.705973916262628e-01   +2.873389124196040e-01; +5.563201898976008e-01   +3.926731960875541e-01   +2.743416192196523e-01   +2.051947476080484e-01   +4.357472790385684e-01   +1.404248988887843e-01   +2.797796626893020e-01   +4.784502870833269e-01   +1.657954952591174e-01   +1.426302575059029e-01   +6.887759621424608e-02   +4.151026008168680e-01; +4.357839143324514e-01   +1.006461212661263e-01   +5.602368816616776e-01   +2.304246640300737e-01   +1.979294436488704e-01   +3.912925550796602e-01   +3.743800656795589e-01   +4.489868577189062e-01   +3.034659644348185e-02   +5.530822429532049e-02   +1.212797206862103e-01   +1.632597172453230e-01; +1.586647087291973e-01   +1.888445332579921e-01   +3.313177700485065e-01   +2.906183512325616e-01   +5.294331834766037e-01   +4.028131278239634e-01   +3.221924226206401e-01   +1.289036212279022e-01   +4.844619444951210e-01   +3.483810051851462e-01   +6.295114880714928e-02   +2.880774016740303e-01; +1.820945490735243e-01   +3.058581719744767e-01   +2.615773862438723e-01   +1.750982450710465e-01   +4.814971752690978e-01   +2.992437560423161e-01   +8.901913201353207e-02   +4.212246612510227e-01   +5.569085686423048e-01   +1.258138447608748e-01   +1.364358953367698e-01   +4.931753912508511e-01; +9.168191545559495e-02   +9.599131802719220e-02   +2.592862454633241e-01   +5.796838886512614e-01   +3.402067939486375e-01   +6.292491514587240e-02   +4.937304272889446e-01   +1.747397310267941e-01   +3.618269561562376e-01   +4.194004269972673e-01   +8.206812369406787e-02   +3.863600238743445e-01; +5.090556810441474e-01   +1.667620445877633e-01   +1.804009610930466e-01   +2.759510294198376e-01   +1.880104531627496e-01   +1.951011815736802e-01   +5.858977917119147e-01   +7.527151722284374e-03   +1.178118507397114e-01   +1.195298079447748e-01   +4.508972514174595e-02   +2.602666184389874e-01; +1.575382929730123e-01   +3.259647927698603e-01   +7.828947111549342e-02   +2.613034362388510e-02   +5.721696495443755e-01   +3.925678988588542e-01   +2.577308795057070e-01   +1.770260024226586e-01   +6.337219493122394e-02   +2.366941483461671e-01   +5.200172040824632e-01   +1.070877624419707e-01];
L2E_Input1_iAMPA_netcon = [+1.444671314304611e-01   +3.511857267342979e-01   +1.323367719955987e-01   +7.807264024147896e-02   +3.641982546353564e-01   +1.221679454123598e-01   +4.254499699869668e-01   +2.529752374132683e-01];
L2I_Input2_iAMPA_netcon = [+5.826437052152211e-01   +2.942196902030464e-01   +2.968773347966584e-01   +1.467766962061542e-01   +8.846393362640392e-02   +7.980275652950505e-02   +4.342787026370499e-01   +3.384340625625895e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  5.6 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = -10*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
