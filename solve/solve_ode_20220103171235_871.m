function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.838431403418155e-01   +3.247931688646319e-01   +3.887424563813908e-01   +6.259501189646188e-01   +6.225328725816401e-01   +1.033510730158326e-01   +3.363282732671617e-01   -2.351887056098614e-01   +5.098195452455068e-01   +3.245336716945864e-01   +2.488442345220314e-02   +3.440952746692481e-01   +1.689302738459178e-01   -7.160695919885915e-02   -2.191161518161359e-01   +6.074983840665604e-01; -1.833023195975051e-01   +2.854188751786681e-01   -1.125351322895207e-01   +4.964040053157209e-01   +1.482898016039684e-02   +7.964794340311872e-01   +2.558243207480561e-01   +3.702222282287013e-01   +3.832734246828974e-01   -1.271912200940983e-01   +3.219299601530262e-01   +5.863007247616400e-01   +1.304045327454429e-01   +1.841388554287069e-01   +6.376387915950087e-01   +1.442970329975782e-01; +3.257913285315048e-01   +3.547563396954346e-01   +4.389178359769877e-01   +8.237787729706654e-01   +8.828094795389652e-01   +3.717967298523878e-01   +4.498822735406264e-01   +2.675268261676982e-01   +4.395119740624014e-01   +6.680324646891042e-01   +3.195238114544249e-01   +2.114376418648353e-01   +1.470184364643158e-01   +7.907729590903981e-01   +2.254771809460550e-01   +7.862439407173931e-02; +9.336040315373839e-01   +5.853772658610179e-01   +2.357638026936587e-01   -2.224682361479758e-01   +1.019087522248000e-01   +2.230734645580089e-01   +3.352093309523382e-02   +5.336596678884655e-01   +3.355914853397604e-01   +2.517950577236503e-01   +3.118257965364184e-01   +2.535718521142701e-01   -2.305971041290842e-01   +5.873447685295279e-01   +2.003528699129115e-01   +5.655525714029285e-01; -1.934490895835307e-02   +2.406443318424564e-01   +6.191847779432215e-01   +3.729895844428636e-02   +3.049467403343671e-01   +1.122197154691023e-01   +1.255004219847176e-01   +1.244144433157963e-01   +4.514644577237746e-01   +2.368576580007855e-01   +5.452955997953847e-01   +3.887033859261868e-01   +3.780033311365008e-01   -8.781859680870155e-02   +2.050743606740562e-01   +7.624740079010028e-02; +1.381779880255244e-01   +3.813531467825203e-01   +9.887998092606701e-02   +8.913089747360835e-01   +2.790420564833784e-01   +2.735042032171729e-01   +1.480743685766013e-01   +6.659935146747767e-01   +5.846416779335917e-01   +2.573379341788180e-01   +1.985186156095555e-01   +6.800916462561737e-02   +4.748447895989427e-01   +5.321247906302212e-01   +2.145909367159994e-01   +2.132815191430329e-01; +1.731672149461179e-01   +4.375112933110207e-01   +5.497244050867499e-01   +2.363677076690119e-01   +2.092604447934948e-01   +3.586410235040680e-01   +1.361317069667483e-01   -4.501734207194660e-02   +1.341368232061666e-01   +1.809026833657313e-01   -2.879540391691755e-01   +3.839502156417662e-01   +3.495438026164300e-01   +6.967825141658643e-02   +4.602526093251146e-01   +5.899419303246179e-01; +2.364850088170352e-01   +1.172588729974553e-01   +2.723089439085157e-01   +3.182209630103929e-01   -1.224445472352231e-01   +3.832210071048032e-01   +3.933387579434902e-01   +6.637587331267291e-01   +7.486149164085867e-01   +3.039638459984624e-01   +6.528025774837282e-01   +4.746445026486882e-01   +1.612473312815541e-01   +1.928218223040480e-01   +1.480862347230718e-01   +6.622061987804445e-02; +1.510241758343261e-01   +5.350958236540152e-01   +1.065057101521877e-01   -3.448297299581163e-02   +4.927153776586188e-01   +2.531934592421936e-01   +6.788025550551031e-02   +7.434675371141102e-01   +5.323724448456613e-01   +3.604117685202506e-01   +5.460094272525895e-01   +5.045826192851279e-02   +1.000000000000000e+00   +5.001021683360374e-01   +7.148726108230979e-01   +4.067270625207251e-01; +9.013718909238670e-01   +3.467272126374129e-01   +3.868544519236028e-01   +2.869457783624880e-01   +2.736463977455409e-01   +6.551216830212350e-01   +6.562824783635564e-01   +5.991253083741864e-01   +4.463783045086865e-01   +3.276846520022457e-01   +1.033072647196760e-01   +4.166741527416782e-01   +1.492017803605405e-01   +3.824160406885849e-01   +4.168525199403092e-01   +2.527242240667937e-01; +5.867508600960921e-01   +1.910636312918961e-01   +6.271601995626530e-01   +7.321102985794274e-02   -7.882210484117867e-02   -7.107432152065601e-02   +2.027890876795837e-01   +6.904652345542417e-01   +3.804712773189911e-01   +3.093768405601136e-01   +3.081508594214111e-01   +2.519338232091429e-01   +6.474933581069844e-01   +2.204911967634674e-01   +3.961199081344197e-03   +3.232767825785783e-01; -1.279340095313705e-01   -8.288680739596073e-02   +5.578250754183164e-01   +7.219996829860649e-01   +5.104635295823291e-01   +8.168116252597009e-02   +4.219407494897836e-01   +3.013609202150904e-01   +4.011943768695987e-01   +8.229998290131341e-01   +6.300985557658058e-01   +4.914222410117954e-01   +7.823958367897174e-01   -3.343812198938597e-01   +5.499131589516710e-01   +2.218248209672521e-01; -8.404030721253235e-02   +3.831170949478659e-01   +5.470312614413149e-01   +1.949955759413878e-01   +8.823844151986580e-02   -8.368038959876237e-02   -5.091808748004438e-02   -8.932396327625070e-02   +2.602198388990435e-01   +3.282368023034626e-01   +1.007645110896600e-01   +8.640193403686432e-02   +4.200919511111979e-01   +2.074134301439774e-01   +2.116242510547107e-01   +3.053974440637752e-01; +2.582334273511622e-01   +2.438124092543681e-01   +4.120199542253397e-01   +8.045149143047066e-01   +3.766847420789550e-01   +9.990735317747924e-02   -2.131678353469295e-01   +4.327989088074927e-01   +6.092400964747813e-02   +2.464420960476254e-02   -1.299891047765164e-01   +6.885542539834798e-02   -7.269260387856004e-03   +3.606619693464896e-01   +1.270375766115670e-01   +6.741290344572587e-01; +2.194188669586654e-01   +3.917165786792162e-01   +5.880933106090009e-01   +2.471153840370650e-01   +1.941830688745040e-01   +8.936232138273240e-02   +7.442317458002847e-01   +6.478227748565308e-01   +4.491596218733436e-01   +5.646989782827765e-01   +3.748574746557339e-03   +1.836319506830673e-01   +1.985777896356705e-01   +3.983491685262441e-01   +3.889244286847024e-01   -1.262689801629730e-01; +2.660511689995439e-01   +3.684430722620151e-01   +2.143515447793364e-01   +5.505086740182897e-01   +4.268587292337097e-01   +6.932248981892820e-01   +6.057654074369366e-01   -2.977285422977194e-02   +2.822571789774718e-01   +3.489458070271229e-01   +4.419863891508633e-01   +2.825674054863071e-01   +9.170994062328433e-01   -1.032675317562836e-01   -4.101153301532631e-02   +5.535782757482442e-02];
L1E_L1I_iGABA_netcon = [-2.166440645261636e-01   +3.811488214003592e-01   +3.892178143946600e-01   -1.021263269278350e-01   +4.652764883357995e-01   -1.054934705127804e-01   +3.179704231416881e-01   +1.476054504066710e-01   -2.757124055636426e-01   +5.474762302586584e-01   +3.357215905980448e-01   +9.928991893492504e-02   +2.941293958617592e-01   +4.714724095013062e-02   +5.337879223192680e-01   +8.570099082689664e-01; +4.590616042313851e-01   +5.182532368988551e-01   +4.875368386139828e-01   +1.702335759677355e-01   +6.244638173886019e-01   +3.334773617379024e-01   +6.185030950484405e-01   +6.275711955292830e-02   +1.268747854157482e-01   +3.533231511876701e-02   +7.776799846180665e-01   +4.288988648480654e-01   +6.084870876745505e-01   +5.228357217214220e-01   +2.671059876996990e-01   -8.550381214089978e-02; +4.725981636005170e-01   +1.449987437733133e-01   +3.158445503544913e-01   +1.746716459149981e-01   +4.110793267817956e-01   +4.432147009703420e-01   -9.458868219239250e-02   +4.172855223092112e-01   +4.817696099815659e-01   +2.131478938379011e-01   +4.858675958473976e-02   -2.480122339965115e-01   +2.405948357915805e-03   +6.954874723679703e-01   +4.219874807983744e-01   +2.341969190787472e-01; +5.753377310005074e-01   +4.920901170035092e-01   +6.093948533978432e-01   -2.011802162382877e-02   +8.800608742330267e-01   -5.230729961738146e-02   +4.618731771711798e-01   +5.851298703228003e-01   +4.188544391272360e-01   -1.208152765154939e-01   -6.321674762362056e-02   +2.766663819553115e-01   +3.130945318355435e-01   +2.904089442779317e-01   +1.698761940231391e-01   +3.995661767031271e-01; +1.763892102418989e-01   +2.396057429581262e-01   +2.229601431446787e-01   +7.789901435736322e-01   +3.148045925631290e-01   +2.724676666422998e-01   -2.320568736005457e-02   +1.134894333978649e-01   +5.792106062537864e-01   +3.168046201957104e-01   +7.175673662787597e-01   +1.895916104820247e-02   +4.230775932213898e-02   +3.145905047250891e-01   +3.782170042038698e-01   +3.062926718062246e-01; +1.225450266552419e-01   +1.152244764152040e-01   -4.843709822781753e-02   +1.088386392115630e-01   +2.845048420994638e-01   +2.277581980865969e-01   +1.212389613591304e-01   +4.878047049171285e-01   +4.207254440831974e-02   +5.545295438064114e-02   +2.927608889029030e-01   +2.144541249171838e-01   +3.957295452490620e-01   +1.234025544422989e-01   +1.029644550833977e-01   +5.013803502694509e-01; +3.124677386569585e-01   +5.198920594973228e-01   +1.215675738068560e-01   +4.717449020623826e-01   +3.675331392374908e-01   +1.103903450131067e-01   +2.313842220980378e-01   -1.398563296200839e-01   +4.626511729963774e-01   +1.947895053572910e-01   +6.055648142971431e-02   +6.631638619041132e-01   +4.623507949183309e-01   +1.376416173574360e-01   +5.363710744005250e-01   -1.151939557255280e-02; +4.347491719708156e-01   +2.508641212782030e-01   +6.558838717058253e-03   -1.373620099107334e-01   +2.962528154646481e-02   +5.154275365408117e-01   +2.769013895881314e-02   -1.276676160422122e-01   +9.819246495147929e-02   +4.518029100652869e-01   +7.098743296309007e-01   +5.033620950562986e-01   +3.663263292867225e-01   +5.128663866103523e-01   +3.855250999038992e-01   +5.317952274206700e-01; +4.522831300742588e-01   +1.000000000000000e+00   +1.691573257143706e-01   +3.081700483663056e-01   +5.631568595779182e-01   +3.468686100563250e-01   +2.516635467448864e-01   +2.451685058066239e-01   +6.484721114031823e-01   +3.889634498494860e-01   -1.502760516244807e-01   +6.214344863108437e-01   +4.515967669487244e-01   -2.345084424314294e-02   +2.152374127626034e-01   +4.412542518164213e-01; +2.725819021967451e-01   +5.178679645502688e-01   +6.061833227525981e-01   +6.463031339639085e-01   +6.619720064468302e-01   +6.818616463906896e-01   +7.393066724655656e-01   +4.696914007064280e-01   -1.263705476607186e-02   +1.109715350931635e-01   +3.945353856720984e-01   +4.555335960669697e-01   +4.237914831061247e-01   +4.337054896863280e-01   +4.061143294294820e-01   -8.772472615762310e-02; +6.141948688854154e-01   +3.681007979134705e-01   +2.469801079092805e-01   +3.589823975074416e-01   +1.557673219789323e-01   +5.180407434671886e-01   +4.395794476581532e-01   +6.904577077701393e-01   +4.709933135789101e-01   +6.926967933406618e-01   -2.090812393104192e-01   +5.337013099596438e-01   +1.377396672865748e-01   +5.790189045465692e-01   +6.520551340825633e-01   +2.032741273630921e-01; +3.128220985858667e-01   +3.213551050159161e-01   +4.923485312014353e-01   +4.077613016012913e-01   +6.150461855440684e-01   +7.765732558001788e-01   +3.437773169454399e-01   +1.642356582941937e-01   -5.626858195980870e-02   +1.205223890019765e-01   +7.152794399855752e-01   +5.566252571553504e-01   +6.670702707548452e-01   +6.361416251028805e-01   +3.279793472361635e-01   +1.794137362253663e-01; +3.460972136079284e-01   +8.068958074469122e-01   +6.703949238889925e-03   +2.269321499171749e-01   +7.337412798601175e-01   +5.340621717944265e-01   +4.263078348866478e-01   +4.722851098248553e-01   +3.496188551100941e-02   +2.170152049386086e-01   +1.873132856268369e-01   +6.660549631041202e-01   +4.819355798683359e-01   +3.109851689873510e-01   +1.139817340980985e-01   +1.636844368244541e-01; +4.028570722741898e-01   +6.734799394307288e-01   +3.797157919099110e-01   +8.674347961658264e-01   +6.692507071203658e-01   +5.147994661596794e-01   +7.096084331917788e-01   -3.295724854469956e-03   +3.602872075289895e-01   -1.730067325918151e-01   +4.526184995950632e-01   -1.469195519625324e-01   +8.289201715240706e-01   +2.283185597333873e-01   +4.455819352073318e-01   +1.323917598710848e-01; +4.949378449958793e-01   +2.848419321583955e-01   +2.091009940620539e-01   +6.820980149924757e-01   +3.003332566117595e-01   +4.783835373359241e-01   +4.689019908326927e-03   +6.986828259420442e-01   +9.579428617677067e-02   -2.247206257774679e-01   +3.328113415117687e-01   +3.734453338173049e-01   -1.548080023841604e-01   +1.531767405798507e-01   +2.648103057727419e-01   +6.184339631146865e-01; +7.911535108573000e-01   +4.401645492085427e-01   +4.494659495966878e-02   +2.898598762812411e-01   +5.728506438905614e-01   +5.431077306997654e-01   +4.239144360105482e-01   +3.552161575184644e-01   -1.574965601160905e-02   -8.173329949348654e-02   +3.712761525968984e-01   +2.714633700750530e-01   -7.928495034042420e-02   +1.306806503807527e-01   +4.040780811132643e-01   -1.574859574675223e-01];
L2I_L1I_iGABA_netcon = [+3.453689133138786e-01   +2.602208432530385e-01   +3.349326939570318e-01   -2.609323298835107e-01   +1.930328890175459e-01   +1.729327107655793e-01   +4.432363571186280e-01   +3.003939980135174e-01; +8.898844484098967e-02   -1.549669325940590e-01   +2.490256016781238e-02   +2.998822038484096e-01   +5.766550631174000e-01   +3.503885305507651e-01   +7.934479130857305e-01   +3.818203243383556e-01; +5.507856147316078e-01   +8.002528850745395e-02   +4.399646278829788e-01   +2.837968093703173e-01   +4.184871303113473e-01   -6.176777886752705e-02   +7.696105218034581e-01   +2.547100592842864e-01; +1.570796495041668e-01   +7.010617994838119e-01   +6.260859847776407e-01   -8.756111362857276e-02   +7.265906119354493e-01   +3.906031231355633e-01   -4.810170297058557e-02   +4.233770826198140e-01; +4.563206382192181e-01   +4.744880562018467e-01   -1.493244401553697e-01   -1.218785227787980e-01   +6.021044111527938e-01   +3.492446088242784e-01   +1.739134417400041e-01   +6.534174351931091e-01; +4.591978386392770e-01   +7.836502941541327e-01   +2.248809584183358e-01   +8.019775122764341e-01   +5.722164183828183e-01   -9.302349294814889e-02   -2.015769842211656e-01   +1.792972723116915e-02; +7.669765573609022e-02   +9.955411824222424e-02   -5.954862368120032e-02   +5.052940677709505e-01   +4.258347082335825e-01   +7.392896846466290e-03   -1.620630646632948e-02   +2.823701271344012e-01; +4.249707303969506e-01   -1.111214328368160e-01   +6.929768931837619e-01   +1.623729116318414e-01   +5.695052940189922e-01   +1.113467648326898e-01   -1.373989878586959e-01   +3.141195543069066e-01; +3.459963984494030e-01   -1.452315863048515e-02   +8.996116737807101e-02   +6.578940436183955e-01   -4.227480236076482e-02   +5.701638643685506e-01   +4.469296080907194e-01   +1.020971744250768e-01; +4.280204786133596e-02   +4.873049978009033e-01   +5.757969018103372e-01   -2.978147729480203e-01   +6.646957530992044e-01   +6.339172068338941e-02   -1.530290372345601e-01   +1.046318390368112e-01; -1.696715244888162e-01   +8.372969362188955e-02   +3.253753651225944e-01   +5.423107442174638e-01   +6.158529993027213e-01   +6.191577383604920e-01   +8.848755931685012e-03   +6.696825185424539e-01; +4.717923523371009e-01   +4.847136703430948e-01   +1.880195384279049e-02   +5.149918512622628e-01   +3.977992791048895e-01   -2.665674967800590e-01   +5.459617716759406e-01   +1.777198064225199e-01; +3.548133276282764e-01   +3.318818458246959e-01   +4.710747367334556e-01   +3.244104466148905e-01   +3.922962324866726e-01   -4.174337191267608e-02   +5.211955128856082e-01   -1.281266284480620e-02; +2.512506305327971e-01   +4.120359527419930e-01   +1.087378744175268e-01   +8.807729829160765e-01   +2.469099716940837e-01   +6.175701184694290e-01   +4.263495171840754e-01   +2.107446639408422e-01; +1.892496522791559e-01   +7.930478764436018e-01   +8.999734472291853e-01   +7.232534883736093e-01   +1.154733914127280e-01   +5.701948530936848e-01   +1.996764313271571e-01   +5.480844431560526e-01; +7.816064278069121e-01   +3.228062976144501e-01   +1.000000000000000e+00   +7.689316406039364e-01   +5.051422865437308e-01   +2.880004575832735e-01   +5.555655734732572e-01   +9.074196316890162e-01];
L1I_L2I_iGABA_netcon = [-1.632632220382321e-01   +3.024692690828349e-01   +3.621137495030481e-03   +7.247471251267441e-01   +9.409930481882754e-02   +6.653197648005497e-01   +2.698030147784553e-01   +1.819745005785720e-01   +4.608859602363576e-01   +2.191050040112524e-01   +3.017145251811722e-01   +2.046622738576766e-01   +5.823117035764043e-01   +4.634003757149640e-01   +5.686475810087983e-01   +6.545906367078265e-01; +6.162469593138570e-01   +7.711996102500402e-01   -2.023419730174059e-01   -1.739999837466452e-01   +3.607926896013500e-02   +9.620166731874490e-01   +4.292061722724923e-01   -7.815959008936882e-03   +4.573986345940911e-01   +1.000000000000000e+00   +6.588876322045358e-02   +6.784360721577244e-01   +2.638320956762357e-01   +2.034383606181271e-01   +2.271853327574472e-01   +3.856509886459814e-01; -1.779744152357987e-01   +7.008990573350106e-02   +6.335315980902544e-01   -1.456488603982203e-01   -4.062746365562765e-01   +1.274865385048438e-01   -2.022022176611651e-01   +9.259694758050478e-01   +1.970561737634005e-01   +1.105690829750075e-01   +5.062373708470345e-01   +3.440949163211335e-01   +1.628714965944864e-01   +2.536407198519600e-01   +4.800344126545735e-01   +1.339426999427492e-01; +3.045438723484736e-01   +4.814629965492921e-01   +2.406830461748916e-01   +2.046508750381822e-01   +1.346464738612471e-01   +3.086169964780426e-01   +4.595686443114315e-01   +7.188809567492970e-01   +1.676222631594106e-01   -2.503352517618617e-01   -2.645991303593181e-02   +8.298777259076812e-01   +4.489209770204474e-01   +3.157316592238980e-01   +6.280708165234417e-01   +2.814057992723880e-02; +5.757145598401903e-01   +5.883234733567516e-01   -3.198030759219849e-01   +5.509818335071401e-01   +1.229148528911042e-01   +4.802032717598621e-01   +2.438984855271301e-01   +5.987543500102791e-01   +6.434369981766751e-01   +6.287376038062328e-01   +1.246361891900009e-01   +3.200697552918239e-01   +2.139684862204446e-01   +2.036564758130279e-01   +1.246256240914463e-01   +1.764262705282898e-01; +4.785171409984574e-01   +4.812704663605830e-03   +7.015677969956127e-01   +6.604231580695715e-01   +9.261011257691991e-02   -1.767501763917480e-02   +7.925470837716991e-01   +5.048911014419408e-01   +2.252491857365284e-01   +5.040518194472268e-02   -1.164995216003805e-01   -7.683247542181963e-02   +2.621792923843172e-01   +8.961834583621725e-01   +3.931844948831048e-01   -2.151548791719150e-01; +9.032094079996456e-01   +9.753213967687549e-02   +1.070091171177195e-02   +8.012859284658721e-01   +5.321697538345786e-02   +1.050144778804571e-01   +7.408629018349002e-01   +3.760911530978249e-01   +3.845031207515353e-01   +1.716465009452767e-01   +4.340492580545700e-01   -1.758065766113442e-01   +5.294368674313009e-01   +3.195207037668421e-01   +8.184269826983023e-01   -3.490291307467279e-02; +1.621508350152918e-01   +3.171076205607596e-01   +1.664088654473618e-01   -3.042977038663717e-01   +5.613195326377914e-01   +7.068882514890624e-01   +1.126864829881142e-01   +3.663919817695794e-01   -8.252806361958456e-02   +3.559675103088983e-01   +5.410241463844839e-01   +2.099241817736005e-01   +3.268248833710873e-01   +5.887084451858440e-01   +5.417750447672719e-02   +3.294909803410104e-03];
L2E_L1E_iAMPA_netcon = [+3.806668199665642e-01   -7.522374882069158e-02   +1.877734410780614e-01   +2.182551139572919e-01   +7.487556842991252e-01   +4.012102195616504e-01   +4.952011756064058e-01   +3.559559504003530e-01; +5.352036243607670e-01   +2.543538035845810e-01   +5.032710173941211e-01   -2.196377727657246e-01   +3.688812720286929e-01   +5.426115195254051e-01   +7.662858156798747e-01   +1.151396598385177e-01; +1.593719541569402e-01   +4.464288561642603e-01   +5.595878964504412e-01   +3.654041882882846e-01   +3.870976437611487e-01   -2.336582350536742e-01   +3.168896738016458e-01   +5.142945408979775e-02; +4.329692881059292e-01   +1.000000000000000e+00   +7.982078114788974e-01   +3.201042250861796e-01   +4.609556255580735e-01   +7.271750841548640e-01   +3.721927231971138e-01   -1.050418670020248e-01; +6.689889628692555e-01   +5.980308281903493e-01   +2.234515067875937e-01   +6.207132153789614e-02   +1.850525597779855e-01   +3.173509062984967e-01   +1.387303365772268e-01   +5.391679236208288e-01; +4.576675500063728e-01   +7.493700458139421e-01   +4.116344779669648e-01   +7.844059855470851e-01   -1.176761358913104e-01   +8.169715829466342e-01   -4.224574796595532e-02   +5.074535123547338e-01; -5.931482436473370e-02   +4.162788200086366e-01   +6.022452842888001e-02   +3.558685601365454e-01   +3.672392522544652e-01   +3.874851393821462e-01   +6.911600320446130e-01   +3.278036356792505e-02; +3.004123842539755e-01   +3.723485883988485e-01   +5.242696804910159e-01   +4.819929831497892e-01   +9.500885549989591e-02   +3.070075358912929e-01   -1.695694711932854e-01   +6.157943995870296e-01; +6.711046649468396e-01   +5.689519631010560e-01   +8.782625932479640e-01   +1.108270892675894e-01   +2.033005172603471e-01   +5.150007861033213e-01   +2.214469998881899e-01   -1.151312718002602e-01; -1.995470501702294e-01   +4.247888775467260e-01   +1.192703118830662e-01   +3.549490057213285e-01   +6.111165016655798e-01   -7.100874289472213e-02   +2.430639123464159e-01   +5.908576029650273e-01; +9.388573529442053e-02   +9.130767553204432e-02   +3.066823571616141e-01   +4.712737197088551e-01   +2.921905662434179e-01   +8.127534138871974e-01   +3.947587516197953e-01   +4.177022405978350e-01; +6.651438289599075e-01   +8.248496042044730e-01   -1.860437021763810e-01   +4.555355794963091e-01   +6.007059677288142e-01   +4.510360520585464e-01   +2.181384555456700e-01   -8.968528843091451e-02; +3.734218244876372e-01   +3.642679114475650e-01   +4.299745637578034e-01   -7.658220847660059e-02   +2.821489978207448e-01   +4.743894733229201e-01   +2.614438000049236e-01   +7.132504127449221e-01; +5.175656662408837e-01   +1.855497521911453e-01   +3.085332950454209e-01   +4.211468129921996e-01   +6.756746053641647e-01   +4.279600683455440e-01   +3.848842230449341e-01   +5.838583874912872e-01; -2.451718656897310e-01   +8.357466821476723e-01   +4.781015535144353e-01   +4.559980957164780e-01   +4.850738094829482e-01   +7.238709559564772e-01   +8.189423332731534e-02   +1.730296413206867e-01; +7.871647912544241e-02   +1.900690679982592e-01   +6.414748877061390e-01   -9.449637151708952e-02   +3.730953287997182e-01   +5.790484167998212e-01   +5.488075346693927e-01   +5.546523812952544e-02];
L1E_L2E_iAMPA_netcon = [-4.450462811865299e-01   +5.845531539345530e-01   -2.121188927382245e-01   +2.617349455644691e-01   +4.731731735428991e-01   +3.345040336507593e-01   +5.766752967694960e-01   +6.877022046772291e-02   +4.652354029799853e-01   +2.493469767814756e-01   +2.946745082721662e-01   +1.082697373594601e-01   +1.729230633309226e-01   +2.094215341137741e-01   +3.216584753392398e-01   +5.359715429920175e-01; +6.597681718807278e-01   +7.741160930560606e-01   +2.178414376779040e-01   +5.385663160088402e-01   +2.574595560399056e-01   +8.505517925574142e-01   +2.995818055991289e-01   -3.995594865841919e-02   +6.252612397662993e-01   +1.582533030359275e-01   +3.055718555550062e-01   +2.245586059240448e-01   +6.358015069313140e-01   +3.969594172520455e-01   +9.420180250613894e-01   -7.695755186362219e-02; +1.245321016275484e-01   +5.854513866308509e-01   +6.776623681928102e-01   +3.011038203089778e-01   +8.318946665499799e-01   +8.260250391658078e-02   +6.498639267510948e-01   +4.211821235727865e-01   +2.711998890796610e-01   +9.106085582886139e-01   +5.857300137768888e-01   +1.662681938844104e-01   +4.540203161599486e-01   +8.893758022719523e-01   +2.847296887494283e-02   +5.727943421097980e-01; +4.404482120679565e-01   +2.512468417688886e-01   +2.396893265451665e-01   +4.114731601548846e-01   +4.216315952555469e-01   +7.717154801823273e-01   +6.017436726847798e-01   +5.296976840873485e-01   -6.616655054680563e-02   -2.494015113088084e-01   -1.706040508538550e-02   +3.868726173215321e-01   +3.970917011466400e-01   +1.425030889886101e-01   +6.818144640958170e-01   +1.309669003366119e-01; +4.709337347838876e-01   +1.000000000000000e+00   +3.672227215194495e-01   +1.449717542160267e-01   +6.437927594806154e-01   +3.422975705650339e-01   -1.158470897407180e-01   +1.991499610769629e-01   +3.109486806088161e-01   -2.425656707761832e-01   +6.473774636969219e-02   +3.521171486908269e-01   +4.074879620960080e-01   +9.078297568699994e-01   +1.681373718989859e-01   +4.667303683683832e-01; +3.011410951896016e-01   +1.247013415083223e-01   +2.437002162247589e-01   +3.050420904722978e-01   +2.938460712613423e-02   +5.176943196269146e-01   +1.409135467104449e-01   +5.771637958591614e-01   +3.432397355466739e-02   +1.512019166568377e-01   +3.657945630364996e-01   +2.014176361792403e-01   +6.552637136623013e-01   +7.784699742616745e-01   -3.345595242307790e-02   +2.288388749869711e-01; +2.876270177724599e-01   +1.246197232064849e-01   +1.981341579844393e-01   +1.896933080285896e-01   +4.909029869333327e-01   +1.387155467708285e-01   +8.405216957676095e-02   +8.968766141274527e-01   -1.219040067651754e-01   +1.117257095020253e-01   +4.282115192163555e-01   +4.148816343294355e-01   +4.339388085332551e-01   +1.735832708956056e-01   +3.220175746379270e-01   +6.817597241778364e-01; +4.250463459981542e-01   +5.354484281825794e-01   +6.844738114309757e-01   +1.423845494654057e-01   -2.500578366368948e-02   -8.106051348693392e-02   -2.126163269796305e-01   -1.772985101217883e-01   -1.422540158075990e-01   +4.986972403572641e-01   +2.913521466739787e-01   +7.814028182814600e-01   +9.089589571080073e-01   -2.403518682355866e-02   +6.186273299645397e-01   +8.320498539623025e-01];
L2I_L2E_iAMPA_netcon = [-5.226076406766467e-02   +6.233741216738174e-01   +5.096893368302939e-01   +1.000000000000000e+00   -8.660766775372332e-02   +3.607224501868160e-01   +5.270416723168586e-01   +6.889019470227956e-01; +3.873772310796754e-01   +2.667738090674923e-01   -1.224260694806451e-01   +4.710995006724226e-01   +5.841093370641405e-01   +3.727354873578103e-01   +9.508276515234932e-01   +5.243665770868343e-01; +3.873592463168232e-01   +2.579727899863851e-01   +6.251590456322176e-01   -5.294520749881525e-03   -3.005281951790639e-01   +1.884571976679338e-01   +1.857203210769693e-01   +5.715113966546529e-01; +3.624559679453400e-01   -1.564219995508818e-01   +2.636714215351286e-01   +8.322678998909453e-01   +5.062354193577348e-01   +4.176637027627932e-01   +6.781937952200137e-01   -4.221162375205949e-01; +7.960913500151243e-01   +1.792154927681806e-01   +6.421767749763631e-01   +5.886761891914187e-01   +3.912431083860253e-01   +2.988997997245653e-01   +3.644587757887617e-01   +2.967884146341885e-01; +6.790649644911955e-01   +8.086548319683337e-01   +3.972826890893556e-01   +3.737288581024461e-02   +5.230836799418945e-01   -1.516417181031522e-01   +4.939691247540245e-01   -1.556767520456985e-02; +7.088505947507104e-01   +4.063569855116423e-01   +1.059657909268527e-01   +2.196004505822575e-01   +6.766919579831084e-01   +5.662939429976031e-01   +1.173600703397016e-02   +2.408233853655718e-01; +1.292569957401541e-01   +3.411902507115078e-02   +3.181056046217389e-01   +4.127545861134043e-01   +8.905680194036367e-01   +1.267660679904837e-01   +1.335784110873764e-01   +3.040598635112543e-01];
L2E_L2I_iGABA_netcon = [+2.188825695516838e-01   +3.191712167581229e-01   +7.396553371340547e-01   +3.987262843123498e-01   +7.808253018407224e-02   -1.107090910984915e-01   +6.369246898887563e-01   +4.487751289381870e-01; -2.370097441692422e-02   +1.106120364892265e-01   +2.728256087780888e-02   +3.881318326551152e-01   +8.610061933066456e-01   +6.519520557805896e-01   -1.418082525515812e-01   +5.286622898411019e-01; +7.508034238363184e-01   +5.467265366700053e-01   +2.318569033963259e-01   +3.227292225371999e-01   +1.863198715298389e-02   +1.369244425561631e-01   +8.249568998011575e-02   -4.065879384544464e-02; -1.502768981274868e-01   -2.454647525832058e-01   +1.936291708500909e-01   +5.431308796008428e-01   +2.980530414279765e-01   +1.080525463323240e-01   +3.560989280843369e-01   +3.017848207661829e-02; +6.151916847008670e-01   +5.225999009544530e-01   +3.495196500899593e-01   +6.552698182448856e-01   +1.698470260793931e-02   +2.287621663875958e-01   -8.949658613836567e-02   +6.426551255260294e-01; +2.085965029037461e-01   +3.610216895073189e-01   +3.465241939841495e-01   -1.909315724883914e-01   +9.369112664169299e-01   +9.942289542834756e-03   +1.604253329001346e-01   +2.177470880340181e-01; -5.082588955210875e-02   +3.518636775486761e-01   +1.418423779949197e-01   +6.580750571898017e-01   -1.256320554667574e-02   +1.000000000000000e+00   +2.863996596648845e-01   +9.105894635669948e-01; +2.135467436661122e-01   +1.866185672375152e-01   +6.136040509740929e-01   +3.905993577294238e-01   +2.288006362107516e-01   +3.293437018210982e-01   +8.015293057799487e-02   -4.672321055196788e-01];
L3E_L2E_iAMPA_netcon = [+3.543070959090169e-01   +7.102734197511182e-02   +3.615730016932575e-01   +1.253116863264317e-02   +6.973327630192216e-01   +5.458284557086567e-02   +5.962918915958065e-01   +3.779702879985043e-01   +5.906413977578825e-01   +3.990429435795821e-01   -2.875608722822489e-01   -6.115096124046712e-02; +1.596062668057080e-01   +4.615295564667561e-01   +5.203505314873379e-01   +2.054594794684686e-01   +1.552853129407930e-01   +7.446556800636507e-01   +4.218051189583151e-01   +2.791644613766024e-01   +2.412586532663879e-01   -1.436223172185728e-01   +3.663002911762304e-01   +2.788771331009857e-01; +5.145700903323757e-01   +1.606051072690949e-01   +3.948711761106586e-01   +7.116555525514923e-01   +1.415265392544127e-02   +6.752552852681020e-01   +6.632417346618942e-01   +1.000000000000000e+00   +5.068022088051404e-01   +1.882333783523351e-01   +5.659019474005042e-02   +5.942079791433680e-01; +2.959482196505558e-01   +6.356213705056252e-01   +4.553159331202346e-01   +1.800311087085067e-01   +6.858909425234478e-01   +7.784688200613911e-01   +1.632213038514543e-01   +2.031344115295647e-01   +2.373127031300143e-01   +1.147226079847457e-01   +2.088877658027913e-01   +6.872186393366492e-02; +6.195684306198743e-01   +9.295084111660391e-01   +3.995403265509400e-01   +3.454494599277208e-01   +3.995236086465050e-01   +4.443481621609203e-02   +4.842838103897185e-01   +9.728356525390245e-01   -2.601563934611208e-01   +3.686370423667559e-01   -1.738175975647373e-01   +2.743265445632581e-01; -3.983451134415787e-02   +6.956411543218962e-01   +4.702123255746091e-01   +2.672294892153056e-01   +8.033490530054893e-02   -1.042824474604186e-02   +3.635020809048094e-01   +6.781361673865066e-01   +8.504737032433518e-02   +7.182688577016635e-01   +4.693737984785833e-01   +4.625012634319206e-01; -3.964226149052268e-01   +2.801409044634453e-01   +1.536413694156885e-01   +1.419589205441964e-01   +1.810277633377086e-01   +8.508480143308874e-03   +7.524755977359234e-01   +6.087822248723170e-01   +4.195300239501117e-01   +3.902931475839076e-01   +6.462321263959310e-02   +4.784788997212315e-01; +4.257309611931604e-01   +8.850016540837344e-03   +5.677296638951220e-01   +4.207441702764729e-01   +4.537267893925626e-01   +7.997939285329744e-01   +4.132518804706684e-01   +5.036901822121840e-01   +9.099041950579766e-01   -1.513432663187402e-02   +7.498733185317609e-01   -5.902893359571000e-02];
L3I_L2I_iGABA_netcon = [+1.187801768301387e-01   +5.017701847473871e-01   +8.198912562783282e-02   +7.492524863027979e-01   -4.873806195056586e-02   +1.263377286820442e-01   +4.009278005087584e-01   -2.971813551917217e-01   +1.412887045489759e-01   +4.111759271819186e-01   +3.747264856338246e-01   +8.529212557439910e-01; +2.585150091662229e-01   +5.380757485872741e-01   -1.367943871426188e-01   +5.416076123910308e-01   -4.700268699946655e-02   +5.594062545361070e-01   +7.754269399219667e-01   +1.116038532543619e-01   +7.285557860679115e-01   -4.670434972232449e-02   +3.110686095391018e-01   +3.600094391637452e-01; +1.225713674058335e-01   +3.258415207655149e-02   +6.132095184377636e-01   +2.571864469207590e-01   +3.790542045682128e-01   -2.049146677373095e-01   +1.178818996635794e-01   +8.322994011940386e-01   +2.025053618189846e-01   +6.372947832289813e-01   +1.861639947808761e-01   +6.191163659336975e-01; +6.362704621750962e-01   +7.693536886776891e-01   +2.368159948832803e-01   +6.819163997377294e-01   +5.091184968526188e-01   +1.595823812148062e-01   +1.769285982051076e-01   +2.711851719872132e-01   +3.741172484881328e-01   +9.302428889546953e-02   +4.631929312643559e-01   +3.663291186396610e-01; +5.230033961542869e-02   +5.663142540468749e-01   +2.366758095126302e-01   +2.516448651716653e-01   +8.656312020397708e-01   +7.303203838946087e-02   +3.499407688520370e-01   +2.501514158251574e-01   +8.016697069599198e-01   +5.634511293296056e-01   +4.270904843175435e-01   +3.264828524636679e-01; +2.371301669654454e-01   -1.437463194083781e-01   -2.808372550220135e-02   +1.000000000000000e+00   +6.903363789193958e-01   +8.617232702574955e-01   +4.021723515634226e-01   +5.378810259068987e-01   -1.313741803076851e-01   +4.725731045380420e-01   +5.429308000556610e-01   +3.507866489414072e-01; +6.807404605843347e-01   +6.376089915989284e-01   +5.329975877577425e-01   +4.560100597784521e-01   +7.755182464525178e-01   -1.152086924885973e-01   -3.290250637222917e-01   +4.476096605793034e-01   +1.684042643767338e-01   +4.810040153349997e-01   +1.475454831321953e-01   +7.846065044576682e-01; +7.263766120963115e-02   +6.955389422969399e-01   +2.972934332601340e-01   +5.764376924276476e-01   +4.708080740093829e-01   +1.009201210498287e-01   +1.312680022217914e-01   -1.250401956098895e-01   +6.988048925901008e-02   +2.607177450382384e-01   +1.189080732482870e-01   +4.671845867052386e-01];
L2E_L3E_iAMPA_netcon = [+2.441566851812189e-01   +6.039682481166594e-01   +3.718242769691649e-01   +4.210788739017821e-01   +6.736200567489083e-01   +3.683156706509537e-01   +6.160903817244532e-01   +1.828490044937109e-01; +3.755330032086147e-02   +4.474648341379087e-01   +3.177429963360670e-01   +1.606312964810961e-01   +5.660308766037905e-01   +1.409170520654511e-01   +2.546763641888485e-01   -2.342257847019373e-01; +2.961796482797512e-01   -5.925494445107382e-02   +2.174201770233761e-01   +7.637553450684444e-01   +9.884792491192786e-01   -2.629104668567881e-01   +3.122200866455079e-01   +5.942042524924468e-01; +3.292944879907891e-01   +7.790480853300034e-01   +4.503383813573680e-01   -1.583932043990398e-01   +1.429591966692455e-01   +6.138616142348421e-01   -1.889806756226072e-01   +4.711246518397714e-01; +6.126550667697946e-01   +4.225481136908285e-01   +3.940778314288772e-01   +1.624576339441582e-01   +8.790907970371545e-01   +6.034701973249570e-01   +6.004496918419556e-01   +3.303727312823123e-01; -3.572062122128858e-01   +1.916070367809845e-01   +3.679394595628546e-01   +1.000000000000000e+00   -1.071134728354041e-01   +4.620844648598477e-01   +5.074054681928928e-01   +5.474051126768096e-01; -1.163428908053942e-03   +9.929745083702651e-02   +6.196340922542504e-02   +6.511520804096653e-01   +4.758658167248336e-01   +3.645975086835456e-01   +5.853326918696922e-01   +2.103352923729508e-01; -3.271143440704450e-02   +7.895597300713027e-02   +2.525229771402239e-01   +5.834185256673653e-01   -1.098695329261923e-01   +4.972202759354492e-01   +6.410351955088497e-01   +1.149373173911336e-01; +1.332980739978928e-01   +5.783882761172705e-01   +1.406866201414484e-01   +7.583588773730623e-02   +2.627982058216579e-01   +7.926539302966823e-02   +4.707498211605467e-01   +2.749615628790538e-01; +4.420878842532200e-01   +2.112622373855930e-01   +6.784235956678916e-01   -3.781625842901403e-01   +2.063856888937088e-01   +2.168406659635344e-01   +7.843283652279740e-01   +5.014927436340715e-01; +1.524732820311767e-01   +3.625512923283630e-01   +5.400456792530848e-03   +5.131259649446352e-01   -1.598502697201306e-01   +2.010818461641574e-01   +5.373505741938667e-01   +8.852275944381687e-01; +6.132119993517112e-01   -2.426158923064536e-03   +1.947091964971811e-01   +1.194339005820590e-01   +2.680686891480050e-01   +9.677241724863161e-01   +5.519139504647758e-01   +4.000694993414045e-01];
L2I_L3I_iGABA_netcon = [+5.441222948139481e-01   -2.474345741881495e-01   +7.718731494682575e-01   +9.594713081173910e-01   +1.979278063046846e-01   +3.936712272876664e-01   +7.281301007984471e-01   +3.149837332553265e-01; +4.617498530950029e-01   +2.215422905716836e-01   +9.103614293632646e-01   +9.996480451171966e-02   +5.307443754031085e-01   -2.313893417066871e-01   +1.189757653460729e-01   +4.971408555480366e-01; +3.049455094209933e-01   +3.850025038258919e-01   +8.274045047008116e-01   +5.852886317508231e-01   +3.125583140990337e-01   +4.473159999467151e-01   +1.982354201899137e-01   +5.483663459228630e-01; +5.037327023642476e-01   +7.852365053272392e-01   +9.184703331698015e-02   +3.434337977702261e-01   +3.289079278153065e-02   +1.496536974900972e-02   +8.878249749406587e-01   +3.166430532421203e-01; -3.404613207008285e-01   -2.003387612212685e-01   +5.618536672587270e-01   +2.359711600514229e-01   +7.727448993375592e-01   +6.962324659385988e-01   +5.571675237678827e-01   +4.433201570018364e-01; +9.494350949120083e-01   +8.693581797671269e-01   +6.697136942432854e-01   +8.328911962402862e-01   +7.296334787111770e-01   +2.951136299445363e-01   +2.119443166130816e-01   +1.351515022520992e-01; +7.504487597607785e-01   +5.709421342889531e-01   -1.434951281002254e-01   +9.842563398600522e-01   +1.396259612152558e-01   +3.081708228303139e-01   +5.157988630028312e-01   -9.612931712617025e-02; +7.494872082487124e-01   +6.771010646017613e-01   -3.227378356794399e-01   -2.189035186355672e-01   +4.429351321177102e-01   -8.097548199991651e-03   +5.864911186152516e-01   +5.735128627658187e-01; +5.160205828398571e-01   +6.115702404131802e-01   -1.787077124080806e-01   +5.588800294155604e-01   +4.554708188515257e-01   +1.000000000000000e+00   +1.273016103353142e-01   +1.372465787147611e-01; +3.960505035718256e-02   +5.532966836021159e-01   -2.410471071770880e-01   -1.885938213457958e-01   +5.412121562976581e-02   +3.628895888569466e-01   +1.367423555416574e-01   +6.611773116370240e-01; +4.059787418452664e-01   +5.407508436860554e-01   +3.464307544199549e-01   +6.422373900270935e-01   +3.464785125737541e-01   +4.831788228822388e-01   +4.308878708576874e-02   +4.845048293540852e-01; +2.461042776757307e-01   -1.306182671304666e-01   +7.572586719025993e-01   +3.423697864190001e-01   -1.405305633270825e-01   +1.941406788011208e-01   +7.151859375100758e-01   +4.590558418572129e-01];
L3I_L3E_iAMPA_netcon = [+4.291171901846685e-01   +4.681165185738121e-01   +5.013798730578442e-02   +5.387985033059285e-01   +1.415985271528483e-01   +4.303191924542750e-01   +1.204556769392972e-01   -8.900294171521247e-02   +5.952881032028708e-01   +2.198682127386339e-01   +4.204608129879117e-03   +3.913643614640553e-01; +8.982902370250665e-01   +2.651372905999166e-01   -2.318863347573735e-01   +5.407009168502942e-01   +1.211835455058035e-01   +7.431466406432142e-01   +3.885641577772223e-01   +1.801331386035629e-01   +4.781054337109980e-02   +3.360243855872979e-01   +5.409793883482081e-01   +3.701073204232923e-01; +5.034588192307164e-01   +2.166056015760049e-01   +6.502800487260201e-01   +2.124593786868381e-01   -2.264883082542884e-01   +3.417281204453653e-01   -2.467831795427903e-01   +1.394128174159436e-01   +2.190820077384386e-01   +3.015863281887203e-01   +3.490388702092435e-02   +2.233822785508698e-01; +3.400548705781709e-01   +2.384343978507701e-01   +2.238733983554526e-01   +5.076301698899963e-01   +7.765053273834386e-01   -3.165992529920939e-01   +2.369869164230129e-01   +1.703465081576701e-01   +1.938031118304821e-01   +1.015792923360737e-01   +4.464902237640332e-01   +7.716902031828343e-01; -9.628037246807113e-02   +5.771318046013101e-01   -1.162362669099251e-02   +7.572078533316110e-01   +3.680595133587067e-01   +4.935829813532779e-01   +1.337957950504463e-01   +3.102510073397223e-01   +2.032719182908714e-01   -3.775939928729884e-02   +5.564183033205433e-01   +6.133268260979745e-01; +7.534477192153817e-01   +1.762963199498311e-01   +2.691132193432198e-02   +6.292505148374055e-01   +2.004440038635887e-01   +2.926215094417974e-01   +1.625681789331005e-01   +3.761417427361720e-01   +4.786440575892784e-01   +4.456493272326015e-01   +4.872085555522131e-01   +1.557647656740812e-01; +1.310177785305537e-01   +8.332291589622504e-01   -1.536218776723769e-01   +4.655668552801869e-01   +2.464847394036099e-01   -4.839744672047180e-02   +2.858127816467677e-01   +1.901669518035210e-01   +1.544311338293431e-01   +1.946934474382397e-01   +5.301787521459831e-02   +6.855193601706826e-01; +1.197632542530555e-01   +7.207177855067254e-01   +5.902937840428623e-01   +3.554925984535630e-01   +3.383113453319237e-01   +4.721453359270194e-01   +7.319299065540167e-01   +1.846665601731700e-01   +1.431240194330537e-01   +1.434296620705408e-01   +3.657195573469907e-02   +3.806246021539618e-01; -9.906440646336420e-02   +3.771684772927835e-01   +2.065717497446535e-01   +3.734032300832910e-01   -2.197265659808930e-01   +5.118050505644560e-01   -4.266771119536455e-02   +1.000000000000000e+00   +2.652018350472087e-01   +3.141048894079230e-01   +3.534594072460270e-01   +2.285376585301114e-01; -3.226067098039097e-02   +1.659198932419862e-01   +5.633402678940095e-01   +6.198265150349103e-01   +1.620365840187638e-01   +6.124955283512609e-01   -1.322945069761836e-01   +2.175309582212141e-01   +4.536881437328384e-01   +6.727581903504388e-01   +4.068245460564470e-01   +6.373583768287067e-01; +3.206225467282987e-01   +5.562467118263754e-01   -1.390650951882662e-01   +2.882574140953396e-01   +5.456658363421784e-01   +8.000295801969683e-02   +7.027457363043133e-01   +5.736534481606451e-02   +3.489145729362127e-03   +3.465953452262218e-01   +7.783183327429033e-02   +2.724879860525519e-01; +4.770451442709459e-01   +1.582681212994649e-01   +1.925643075519210e-01   +2.166310490504660e-01   -1.160867515809117e-02   +1.670532404037705e-01   +2.966050253822887e-01   +5.937918659728164e-01   +6.212766754532205e-01   +1.867442493777766e-01   +1.789649342567714e-01   +9.319101239001655e-02];
L3E_L3I_iGABA_netcon = [+4.594282011051428e-01   -1.310306208564803e-01   -1.292680658030494e-02   +8.227105700935756e-04   +3.129911990356261e-01   -3.889593129439157e-02   +4.971232561282286e-01   +1.021011304180026e-01   +2.644496991378516e-01   +1.000000000000000e+00   +7.534770101702442e-01   +7.032705944508688e-01; +3.279583149078749e-01   +2.328396028802620e-01   +4.136673366546577e-01   +5.716124643266558e-01   +1.111732948873634e-01   +4.688583323315497e-02   +4.638701456974879e-02   +1.882723889036042e-04   +7.859736592732633e-02   -9.334432938310348e-03   +7.351848545911577e-01   +5.219970066743230e-01; +4.783193126566547e-01   +4.678031290936393e-01   +2.118825387204843e-01   +5.797104465478157e-01   +7.172241617027532e-02   +4.148584404784357e-01   +2.073765294188173e-01   +5.024725362046919e-01   -1.643661071778147e-03   +5.940645796960464e-02   +2.052797990297401e-01   +3.515981638229033e-01; +4.850909587552829e-01   +1.557064555489885e-01   +3.932277989331651e-01   +3.800889083329398e-01   +1.773714298416416e-01   +7.768757116411652e-02   -8.051222006538040e-02   +6.129731709863467e-01   +6.372366993043816e-01   +4.823298865163309e-01   +1.578696989357350e-01   +1.626269161387762e-01; +4.522509891860240e-01   -7.751084589554399e-02   +1.511912293642321e-01   +6.381292541057816e-01   +2.618274171635584e-01   +3.072066628250984e-01   +5.246449615393071e-01   -9.544084638899381e-02   +1.853269110306058e-01   +3.664243066098620e-01   +8.849234052969811e-01   +5.465051683596117e-01; +7.725984257700641e-01   -3.637436535873084e-01   +2.370623546965097e-01   +7.933611546799244e-01   +1.445925052617501e-01   +6.619016592417678e-01   +4.115558943025437e-01   +1.284232719437279e-01   +8.791635668676590e-01   -2.200230332065461e-01   +2.402297735144321e-01   +3.956140709132405e-01; +2.532514464245028e-01   -8.570341875244181e-02   -2.415062886804301e-03   +1.629076742383583e-01   +7.705709262996607e-03   -1.800927462391372e-01   +2.337727017965449e-01   +4.048676920968941e-01   +1.717740160274337e-01   +6.151818447795834e-01   -1.690902967344493e-01   +4.850642299909027e-01; +6.910615548841732e-01   -3.720908750275111e-02   +2.541944984729419e-01   +7.023822612620502e-02   +4.977484830789551e-01   +2.702451859932973e-01   +2.057755377240019e-01   +5.867887137046924e-01   +5.343856920738700e-01   +4.754075137232333e-01   +5.457639184875211e-01   +4.070785202736669e-01; +5.842611984760380e-01   +4.770734735636037e-01   +6.639389387459517e-01   +3.685981815369491e-01   +6.131678264485999e-01   +6.264062797332461e-02   +5.518810556666000e-02   +2.563856468931386e-01   +6.635702626608049e-01   +1.731642536703573e-01   +2.111271849944685e-01   +3.206531376728542e-01; +1.734519170878660e-01   +4.959123553931523e-01   +8.797005070177943e-02   +3.545056060251031e-01   +1.912131654326728e-01   +4.918850426498114e-01   +6.918544237499982e-01   -2.059483393523096e-01   +9.173092786705592e-02   +6.536714909545175e-01   +2.578171230313138e-01   -2.015157805693589e-02; +3.489983878770158e-01   +3.766236976847947e-01   +6.340771127634766e-01   +7.610011369207881e-01   +1.709143916085498e-01   +2.899453194739254e-02   +3.183858846299140e-01   -1.320769913395002e-01   +4.207771027830248e-01   +4.910955798571279e-01   +8.463621569322083e-01   +5.856410065061000e-01; +3.317083854583845e-01   +2.333786854373195e-03   +1.716605830558955e-01   +1.658372502631119e-01   +2.316647420660231e-01   +3.793649606817702e-01   +2.600764943163886e-01   +6.254492629738960e-01   +5.757863201826647e-01   +8.200745402147562e-04   +2.484115600228508e-01   +9.655086191024645e-01];
L2E_Input1_iAMPA_netcon = [+4.325042043338250e-01   +5.629431943807639e-01   +8.332273392870012e-01   +7.860835470692431e-01   +8.227384667154444e-01   +1.000000000000000e+00   +9.575458564274580e-01   +3.932712480490609e-01];
L2I_Input2_iAMPA_netcon = [+7.138181991378437e-01   +1.000000000000000e+00   +8.489268611816456e-01   +7.803646954989601e-01   +6.121404242563540e-01   +9.334065959004314e-01   +3.661781482036555e-01   +8.046990095496627e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
