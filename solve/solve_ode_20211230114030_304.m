function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.748318913666542e-01   +1.700163650414575e-01   +4.160208407054860e-01   +9.225269293695229e-03   +5.275410653024509e-01   +6.066619951678781e-01   +3.976618150571936e-01   +3.656673830705688e-01   +8.326374121884092e-02   +4.095738252535623e-01   +5.297715037707900e-01   +2.255442876356965e-01   +3.654885225188923e-02   +5.896391365127996e-01   +1.616894621814216e-01   +4.793457380672608e-01; +5.619285947007704e-01   +6.660812195355749e-01   +2.628824362942189e-01   +3.378223691078509e-01   +5.501838103348037e-01   +1.934203492698836e-01   +3.509294116262172e-01   +2.469239673729184e-01   +3.985318457929788e-01   +5.903410675436330e-01   +5.540405990153316e-01   +5.839471731116948e-01   +4.907478036194865e-01   +2.607812005400447e-01   +3.113644245656125e-01   +4.830407580392906e-02; +1.722724640052767e-01   +2.234800238077156e-01   +4.186574544594238e-01   +1.878206189358675e-01   +2.430945430914646e-01   +5.584338519351111e-01   +3.449151673297256e-01   +6.060098461911623e-02   +5.815636879756301e-01   +1.739861207641781e-01   +4.234457938232801e-01   +5.598164948217800e-01   +2.791633945261803e-01   +3.465468936766550e-01   +5.186946797496960e-01   +1.846921322572857e-01; +4.254745276174262e-01   +4.428370926409934e-02   +5.234903228536977e-01   +4.340328743982714e-01   +2.546800497884039e-01   +7.585919238834529e-02   +2.488497813473110e-01   +1.473382863545402e-01   +4.726217367123678e-01   +4.214680664824848e-01   +2.893844805232383e-01   +1.179506514147399e-01   +1.119782362051908e-01   +3.203053201914528e-01   +5.960582227946619e-01   +5.024126121209622e-01; +3.970492597555140e-01   +3.454880469933253e-01   +4.807958261696832e-01   +1.495117467621160e-01   +2.329646263311018e-01   +3.698622174464489e-02   +2.289803668737347e-01   +6.399209823858002e-01   +3.541309700492269e-01   +4.967779517681140e-01   +6.214090173598749e-01   +3.809187499959785e-01   +2.122750321342563e-01   +8.247414570575173e-02   +6.164127415541238e-01   +2.769573352202517e-01; -3.318947895011656e-02   +2.313202148132452e-01   +5.779747518364329e-01   +1.923966122118397e-01   +2.546059393749041e-01   +1.278156163430607e-01   +4.559709430281603e-01   +3.991303477608813e-01   +8.873363127013950e-02   +2.166631304053620e-01   +9.693844761214754e-02   +1.930586628167954e-01   +5.308314011836420e-01   +1.526400425668447e-01   +5.460266668091789e-01   +4.154843567227417e-01; +6.573064166263155e-01   +4.710605051098206e-01   +5.172526920678739e-01   +6.110645078804225e-01   +4.124685940528932e-01   -6.301398471028657e-02   +4.920479809074593e-02   +1.308373687275791e-01   +5.847511104341384e-01   +2.257038265891718e-01   +2.252852325547337e-01   +2.458281935773494e-01   -4.107526168642996e-02   +5.193980652474843e-01   +2.919123852235829e-01   +4.678535634652762e-01; +5.336900270738592e-01   -9.768185912858834e-02   +3.661333788197413e-01   +6.472978847027696e-01   +6.497553562647955e-01   +5.207755975653638e-01   +2.172029985073969e-01   +2.658751151448092e-01   +2.651408198211246e-01   +4.926701499623686e-01   +9.209528886791717e-02   +4.853969255786133e-01   +5.044200896394408e-01   +2.869691893679009e-01   +1.288601963054889e-01   +6.209895123205408e-02; +4.175347679017410e-01   +5.505462748051110e-01   +5.684734161511608e-01   +7.224240741211588e-02   +1.082193662714871e-01   +2.323494063197733e-01   +2.799396647983303e-01   +1.412694107511499e-01   +5.235925044681964e-01   +2.151802704664769e-02   +4.896854066983191e-01   +3.087985710514726e-01   +2.332038480706880e-01   +2.583832933696979e-02   +4.443858468608716e-01   +2.620318400730904e-01; +3.892761405471686e-01   +5.533100707028238e-01   +6.268943090212133e-01   +2.176409247500417e-01   +4.947140165614906e-01   +2.315887705310093e-01   +5.589690990860060e-01   +4.906240281523224e-01   +5.675183227952846e-01   +3.632839224171276e-01   +6.608934074918877e-01   +5.892219482614075e-01   +5.036053038447973e-01   +4.661280071464466e-01   +3.974331501159609e-01   +5.536019047022325e-01; +1.374748311421957e-01   +1.843575495625266e-01   +1.706212669768565e-01   +4.207978808469952e-01   +5.885466764445676e-01   +2.536704686677655e-01   -3.723011746401222e-02   +3.144369199518668e-01   +4.946711998516956e-01   +2.387507038977256e-01   +3.092211599111669e-01   +5.720463751169479e-01   +3.097429880499033e-01   +1.524558588729221e-01   +3.412165157996839e-01   +2.034564844780923e-01; +3.784491703676285e-01   +5.158904377530420e-01   +1.302238970860027e-01   +2.246578827146773e-01   +1.239187600741371e-01   +3.257501934059908e-01   +2.896063883009508e-01   +1.444075205429162e-01   +5.209669610059775e-01   +1.774143198266969e-01   +8.405195122241596e-02   +2.707217484138673e-01   +4.673120193817750e-02   +5.798367266807534e-01   +1.121463015378458e-01   +6.019253232064785e-01; +1.411074195247983e-01   +4.307431821147783e-02   +4.709871023886117e-01   +5.546656519032811e-01   -1.871219596804226e-02   +5.602898158833942e-01   +3.265972415451693e-01   +3.521066983878913e-01   +3.101519715456506e-01   +2.878337245931867e-01   +5.828906938525518e-01   +1.971215500303114e-01   +5.757066751036687e-01   +6.063722213760470e-02   +1.309190641610110e-01   +4.045621611205271e-01; +4.139079051952083e-01   +5.635194024423136e-01   +2.820543707781695e-02   +5.472769917688708e-01   +4.870801025579509e-01   -2.641148160967876e-02   +2.857223141487927e-01   +4.917810144549704e-01   +5.113785641998093e-01   +5.666980939087777e-01   +5.381216174199306e-01   +2.215633659056311e-01   +8.638340077299203e-02   +6.821910014937939e-02   +3.028338848203107e-01   +4.426169581041105e-01; +3.972039793351282e-01   +4.595656442203266e-02   +4.908118221279169e-01   +4.901654731767061e-01   +4.368826883732844e-01   +2.548952206147602e-01   +3.397888955209020e-01   +2.823765647572901e-01   +5.103751005524207e-01   +6.050648211666116e-01   -3.663509932325072e-02   -1.016779719789876e-03   +1.085875991685722e-01   +5.004051619039837e-01   +6.569366387937375e-01   -6.635024512933775e-03; +3.717518861446243e-01   +4.251034278844693e-01   +2.357769544329750e-01   +2.490563758955366e-01   +3.251130038088532e-01   +5.589997289008665e-01   +3.694486097110764e-01   +4.611218875980089e-02   +8.323251116845183e-02   +2.987211325894500e-01   +4.311534581007054e-02   +5.214340031244057e-03   +1.709346327968117e-01   +5.474828812157421e-01   +6.351362042950029e-01   +5.440399739331078e-01];
L1E_L1I_iGABA_netcon = [+3.928155079171375e-01   +1.899304282342601e-01   +1.242265156363020e-01   -4.529337430140027e-02   +3.138582829075600e-01   +3.225431844150772e-01   +1.875789849813955e-01   +2.841245843346645e-01   +5.313823629882740e-01   +1.960692289527527e-01   +2.873144818127760e-01   -2.049508265740664e-02   +2.550996684946742e-01   +1.812179310415275e-01   +1.905246228050083e-01   +3.214206301906894e-01; +3.467312378213449e-01   +2.365432733076187e-01   +5.074951327326013e-01   +2.645023177920925e-01   +4.697779383597896e-01   +1.600479765070819e-02   +8.400322602656371e-02   +1.194374632649733e-01   +3.370796375602832e-01   +3.477382400451148e-01   +6.427347137555458e-01   +3.493790656403228e-01   +6.712900931187017e-03   +3.140229798815586e-01   +1.879287509510670e-01   +5.588746653506603e-01; +4.990618115198027e-01   +4.363645025520876e-01   +4.061429913313443e-01   +5.002393876208739e-01   +5.991498659097698e-01   +7.159106677456692e-01   -2.796159727918462e-02   +2.305458161895201e-01   +3.067052554786743e-01   +5.913296615668764e-01   +4.921902483022755e-01   +5.389108959749996e-01   +1.675887203504908e-01   +5.950792697122715e-01   +5.726898991934853e-01   +4.076130881199354e-01; +1.541501241616267e-01   +5.750187466665235e-02   +2.248306279962881e-01   +1.331103456084396e-02   +1.885532070242799e-01   +4.533882148457672e-01   +5.593750841493326e-01   +3.855475819732352e-01   +1.005406911888721e-01   +2.536524595742013e-02   +2.686326314059447e-01   +2.152014670743745e-01   +4.852758940231374e-01   +1.970758638156838e-01   +2.462655691894602e-01   +4.414901908067261e-02; +2.431549507536847e-01   +6.201386953326616e-01   +1.018032645588955e-01   +4.405322533335814e-01   +2.289163398851767e-01   +4.036865577478934e-01   +1.308822053988589e-02   +7.108170965347391e-02   +5.591753437775114e-01   +5.438367844172579e-01   +7.794554317133631e-05   +4.424729319897383e-01   -5.862860856445035e-02   +2.062904098375438e-02   +4.688304414188699e-01   +3.657512810914917e-01; +6.418284612566585e-01   +3.144473855168666e-01   -1.615033076348507e-02   +1.206761274019003e-01   +2.757590107491508e-01   +5.163596632297778e-01   +2.241999142583359e-01   +4.197232260056095e-01   +3.866423907315735e-01   +4.137169950778962e-01   +1.697612355299766e-01   +2.977677040346359e-02   +9.001481621076750e-02   +5.006520971006265e-01   +5.538922795956084e-01   +4.816796218410014e-01; +1.918173451603510e-02   +4.750241610316494e-01   +3.200492620145952e-01   +6.146327798374580e-01   +5.891722477207891e-01   +3.817158982145882e-01   +6.878022510730891e-01   +3.006228219704465e-01   +1.004215883789922e-01   +1.368484458182055e-01   +5.942840584662893e-01   +3.386273854734289e-01   +2.290252053511598e-01   +3.709196184618605e-02   -5.688367395118515e-02   +5.463176316480436e-01; +3.641467168365489e-01   +1.766466572113861e-01   +4.538287718787006e-01   +4.046484304871960e-01   +3.613183486523738e-01   +3.493251294057431e-01   +5.286182658705254e-01   +2.229905824989251e-01   +3.461239908027172e-01   +1.095661290741813e-01   +2.339399665451460e-01   +3.721448789817631e-01   -1.743833922273536e-03   +6.555487117370877e-01   +1.566805843986423e-01   +5.246873691460158e-01; +1.841848057011964e-01   +4.989091361405390e-01   +5.295472906370716e-01   +6.431622415177181e-01   +4.728337718896441e-01   +1.781967625208904e-01   +6.216365238639469e-02   +2.956485197954212e-01   +1.255650957276779e-02   +1.345700966500812e-02   +4.338080378318345e-01   +5.099628091318930e-01   +4.537997128075816e-01   +3.478698951856137e-01   +2.198554030382610e-01   +8.767685036424575e-02; +9.216866151683042e-02   +5.846168215286218e-01   -7.259318735911227e-02   +5.299985444897926e-01   +2.526820074315543e-01   +3.336224887618741e-01   +1.042768857094399e-01   +3.276227684852979e-01   +4.371759708142671e-02   +1.435264670673213e-01   +1.019611941689921e-01   +2.016347448813059e-01   +1.671491524783706e-01   +2.365439379226888e-02   +1.789262343318912e-01   +1.974802679604671e-01; +6.228730101071861e-01   +5.264220931896215e-01   +5.134384867305267e-01   -2.602923602436321e-02   +5.449844643777320e-01   +1.575717125502062e-01   +4.958115072712147e-01   +2.215399156894248e-01   +3.233840729506542e-01   +1.453925763861351e-01   +4.329688142160176e-01   +6.189515611966003e-01   +6.441776707388587e-01   +2.597329174019618e-01   +3.896298736027393e-01   +1.569782910861160e-01; +4.865751842295934e-01   +1.236009426512319e-01   +2.232072762439935e-01   +3.573889166072397e-01   +4.854722628513551e-01   +3.191184181486077e-01   +6.146238812959045e-01   +3.386389802396125e-03   +4.808250916680364e-01   +2.455601599397137e-01   +5.056140384617958e-01   +5.718496424086736e-01   +4.781829278298119e-01   +3.608952392056627e-01   +1.851328819293393e-02   +5.940951934423357e-01; +2.948457804917242e-01   +1.202338228537081e-01   -2.836155890901362e-02   +1.260326406538262e-01   +7.587941480769464e-02   +4.733337522337635e-02   +2.486021785634460e-01   +6.339354800049791e-01   +3.874862741757350e-02   +6.129238993001218e-01   +2.153086944095765e-01   +2.923275333948176e-01   +1.399354890739410e-01   +1.887976583019639e-01   +2.815176864049422e-01   +3.399582702951184e-01; +1.719218237619379e-01   +4.178076208733628e-01   +6.252877258347577e-01   +1.188227562060234e-01   +6.207048188525036e-01   +5.676992747517508e-02   +5.546484093323595e-01   +1.765477793873292e-01   +2.621223624322586e-01   +1.826834741301760e-01   +4.586854733446856e-02   +6.344505285290213e-01   +2.038653986944196e-01   +9.425153187291503e-02   +1.515908995476572e-01   -2.228685299212153e-02; +5.836718831911283e-01   +5.495366089033887e-01   +3.026567283191168e-01   +1.708826546265100e-01   +1.532008211856829e-01   +2.211300720020786e-01   +1.636158540505275e-01   +1.718933321103511e-01   +1.987681031795513e-01   +6.978167569542117e-02   +2.456156729959950e-01   +2.386184322870546e-01   +6.190484746190732e-01   +5.636512901464323e-02   -5.212249632097991e-02   +2.600558124122310e-01; +4.492257141830486e-01   +5.588831086871366e-01   +5.821330281018897e-01   +2.394045417700708e-01   +5.970208611098628e-02   +1.922815040540379e-01   -6.707551515473988e-03   +5.094458175765921e-01   -5.410472485404709e-03   +3.154955311347301e-01   +1.950615745469454e-01   +6.105015735545076e-01   +2.267259727257448e-01   +3.713096615037237e-01   +6.373340334147338e-01   +4.867080431417361e-02];
L2I_L1I_iGABA_netcon = [+5.051581657440749e-01   +2.566844544530822e-01   +1.893058206640778e-01   +5.920436266972301e-01   +3.525125888454257e-01   +4.258467788693525e-01   +2.087103069635672e-01   +6.981027414346883e-01; +1.523103936994118e-01   +8.963511702670249e-02   +1.334210186450996e-01   +3.854016222677082e-01   +1.898070996979594e-01   +1.385899176838368e-01   +4.422172621768944e-01   +1.706543616952761e-01; +2.835410068268553e-01   +5.417488006331520e-01   +3.754316055664818e-01   +2.080709852875308e-01   +4.874968321977972e-01   +5.953987800399335e-01   +4.184818702040807e-01   +1.801633639064179e-01; +7.654020382678368e-02   +5.562232252908123e-01   +2.860863009755575e-01   +5.375843276362733e-01   +4.989059728782348e-02   +5.767919382770562e-01   +3.455027397441756e-01   +4.034948146361444e-02; -3.134391235926904e-03   +2.627410971140722e-01   +3.095731421474949e-01   +6.083554525102793e-02   +3.915789265915368e-01   +3.809184691497115e-01   +4.293868834731512e-01   +3.569201366501289e-01; +2.284120776424266e-01   +5.180605320391698e-01   +1.820266655515036e-01   -4.647493575340528e-03   +5.811423169274046e-01   +1.315139629296314e-01   +5.296452679707446e-01   +2.922342495966047e-01; +8.207451441367956e-02   +2.554005324239124e-01   +2.712889509386750e-01   +3.465217347820108e-02   +2.047837971379760e-02   +4.434411111225989e-01   +4.064080166665034e-01   -2.908641288757604e-02; +4.861086389081403e-01   +3.148416473227991e-01   +5.244590810413368e-01   +3.760400183491516e-01   +2.267698630098207e-01   +8.936541251859896e-02   +4.332211580739032e-01   +1.307860956091821e-01; +1.079922306277154e-01   +5.229732760300151e-01   +6.773533298210557e-02   +6.732782989967595e-02   +4.358779958389669e-02   +4.326503193797601e-01   +5.826109161272196e-01   +3.997014414010587e-02; +1.317190842922873e-01   +6.289761990123978e-01   +4.805701309317694e-01   +1.093000894342521e-02   +4.178885294285192e-01   +1.460629323918624e-01   +1.091155805506279e-01   +4.164672764787234e-01; +3.314831498717093e-02   +5.460463119805546e-01   +4.277449425613072e-01   +3.961671812176479e-04   +3.676668436287423e-01   +1.327710156491465e-01   +2.567151420898053e-01   +3.974705681414700e-01; +5.412386155166345e-01   +1.692725464379955e-01   +1.488398638268950e-01   +1.520330896308130e-02   +2.935884552904679e-01   +1.601309889617163e-01   +2.215882257247095e-01   +1.325167225482514e-01; +3.775570521431486e-01   +5.987635978313455e-01   +1.560888026589586e-01   +3.112381237081596e-01   +3.085910448702597e-01   +4.765335846588625e-01   +1.495214470583280e-01   +3.236553652636587e-02; +3.229879090195996e-01   +1.373474726280026e-01   +2.919953488152660e-01   +2.413756253300040e-01   +2.698951737471179e-01   +1.694993777794630e-01   +4.576523027363615e-01   +3.203694411041364e-01; +4.986448786762642e-01   +2.694614766726026e-01   +5.390325731179109e-01   +5.494113552908565e-01   +3.636347580632372e-01   +3.591484192335146e-01   +2.101256316388483e-02   +1.793869409090663e-01; +1.184836461389819e-01   +6.596729159585184e-01   +3.764938913178419e-01   +4.819671202757728e-01   +4.697668178109367e-01   +6.512228996790980e-01   +3.311578664122286e-01   +4.847989342418085e-01];
L1I_L2I_iGABA_netcon = [+5.125167011907493e-01   -1.048439614766744e-02   +6.278377989303507e-01   +1.360196825087086e-01   +3.921113100388454e-01   +4.721634417044164e-02   +1.666170818358366e-01   +3.463855432330253e-01   +1.100748780550182e-01   +2.985620530586734e-01   -8.972329896711992e-02   +2.620131783207663e-01   +2.817031550815253e-01   +1.701353134857207e-01   +3.634217885603450e-01   +5.418596041562757e-02; +2.790727114092738e-01   +5.629855770763189e-01   +2.496873560133207e-01   +8.648074737464095e-02   +3.516240545233890e-01   +1.124122982957783e-01   +6.300793695392034e-01   +4.711215851044930e-01   +4.168113330443715e-02   +1.834170687760013e-01   +3.233494320452547e-01   +1.917419146971545e-01   +2.850547028750211e-01   +3.306818703200952e-01   +7.740062338090499e-02   +1.506110117187737e-01; +1.546166358606925e-01   +1.459769732892975e-01   +2.672454295185175e-01   +7.030964219806887e-01   +8.787874787794629e-02   +3.707366588628860e-01   +2.347075002376876e-01   +3.140003674389927e-01   +5.960546557219338e-01   +1.045029279762143e-01   +2.173733090263609e-01   +5.607287878171796e-01   +8.361985909367967e-02   +4.177001729718626e-01   +2.396869556511653e-01   +5.962949103981542e-01; +1.589790669594771e-01   +1.130866226854985e-01   +5.972256962333529e-01   +3.773766344724534e-01   +1.648150899915425e-01   +5.075641807604014e-01   +2.104927008983722e-01   +4.220314271146873e-01   +3.289791883474664e-01   +2.319825837519626e-01   +5.447140786328345e-01   +1.659997687376222e-01   +5.036885986562701e-01   +4.973152880679237e-01   +3.095969585918368e-01   +2.264563000124829e-01; +2.689927759501250e-01   +4.982155889333936e-01   +2.144762757430772e-01   +3.728963717866816e-01   +3.152427391226398e-02   +4.686762035560266e-01   +4.453301615426166e-01   +7.240655894044179e-02   +3.287828465270922e-01   +1.611796947360196e-01   +2.757713892644296e-01   +2.778971202013401e-01   +5.557113684761592e-01   +2.254859460677322e-01   +3.058445577742766e-01   +2.754749108851295e-01; +3.195898905071580e-01   +3.847706666514169e-01   +4.841000497735584e-01   +5.079253139311389e-01   +9.965501630947846e-02   +2.256079707027132e-01   +1.025580026723935e-01   +1.269275117065762e-01   +5.924362998495395e-01   +6.267305779892866e-01   +6.479018235009644e-01   +1.636385777491949e-01   +3.597534436711390e-01   +3.939965748007201e-01   +5.038862705991406e-01   +5.412983491889060e-01; +3.603973672587938e-01   +4.094801884434760e-01   +2.939230259978682e-01   +5.104609302334897e-01   +4.543624551118234e-01   +5.181176004643598e-01   +3.211126990332748e-01   +3.783758227124515e-01   +2.412458441886295e-01   +5.529064664445603e-01   +3.118842981453016e-02   +2.303828758301876e-01   +6.521463441542527e-02   +2.715407574436526e-01   +3.898130705680353e-01   +7.024032895944658e-02; +4.918816854194836e-01   +1.463195791498893e-01   +4.992392291680090e-01   +1.078345898500731e-01   +1.617446260674625e-01   +6.236647516526000e-01   +1.035222840674591e-01   +4.014979384504656e-01   +2.217708869338647e-01   +6.138413367721031e-01   +3.664109028424209e-01   +1.849216932585170e-01   +2.254290018521612e-01   +1.457629562300291e-01   -3.430716229555351e-02   +1.094283144414151e-01];
L2E_L1E_iAMPA_netcon = [+2.978034494255164e-01   +2.721615038217873e-01   +5.987179451274300e-01   +2.155761103405707e-01   +1.212494316125559e-01   +3.024450516362268e-01   +2.004242715208424e-01   +5.410946762287810e-01; +2.860509480667230e-01   +1.025776700519141e-01   +6.192061864536216e-01   +4.817237374024390e-01   +4.847979938806067e-01   +4.278090861985674e-01   +9.997014908678457e-02   +2.974233296245967e-01; +4.965881670643040e-01   +7.330259613994373e-02   +8.493821436344751e-02   +3.368459843992741e-01   +5.036290148210083e-02   +4.345716801595801e-01   +2.239939469122101e-01   +1.001319591925478e-01; +4.927206772394677e-01   +2.166910504674817e-01   +7.289138074271787e-02   +1.970561761177284e-01   +1.560379908376179e-01   +1.469037897348595e-01   +2.484088536722602e-01   +5.127666171441829e-01; +2.514705531765051e-01   +5.216181782110869e-02   +1.126622141872912e-01   +5.817445616080633e-01   +1.092511157100830e-01   +5.009331390190369e-01   -5.770261752777655e-03   +1.997389265239759e-01; +1.591126738579001e-01   +4.545642512142120e-01   +2.229191092726532e-01   +6.160352294612682e-01   +6.215163998167056e-01   +2.908188457035479e-01   +4.205769142804412e-01   +4.602002811867522e-01; +4.585280825725929e-01   +3.100953349681511e-01   -2.238020125182722e-02   +5.574292879211827e-01   +5.861685450379323e-01   +3.526486040183652e-01   +4.538104077028655e-01   +2.245002120128352e-01; +1.668431470709081e-01   +1.959099415877052e-01   +7.520330605737131e-02   +4.707839352908910e-01   +1.819920889173323e-01   +5.575299468891628e-01   +4.090509609988673e-01   +5.764217067637954e-01; +1.137667505301736e-01   +4.018405893333323e-01   +2.016321985325402e-01   +5.739643831641346e-01   +2.096318722320402e-01   +4.939179671734569e-01   +4.273623751753460e-01   +5.335871351845138e-01; +3.366639447263396e-01   +5.857959068866808e-01   +1.493920829644507e-01   +2.080372025538266e-01   +2.608321377987418e-02   +2.401320264631165e-01   +1.410536889828892e-01   +2.879234266461198e-01; +2.700131059464734e-01   +1.038331894050245e-01   +9.163333477420821e-02   +4.737762852079552e-01   +2.061279756757037e-01   -2.430183904197475e-02   +4.381845932212102e-01   -1.130729218814360e-02; +4.235973396185753e-01   +4.013421777807589e-01   +5.789579836579206e-01   +4.079190049245013e-01   +2.547862437222715e-01   +4.543436039278710e-01   +1.249976560485247e-01   +6.373493052973492e-02; +1.508608366418506e-01   +4.021019646198539e-01   +6.780156367881820e-01   +4.381777642250408e-01   +5.190829091387806e-01   +1.766440070000787e-02   +2.423374602353887e-01   +5.991860775230012e-01; +5.500508187115232e-01   +4.403653332909466e-01   +5.381603214338013e-01   +1.979946756763235e-01   +2.961347714974149e-02   +2.055288767816085e-01   +5.280983694594716e-01   +3.841634745428240e-01; +4.060415390943737e-01   +8.383954506979575e-02   +2.308864048344722e-02   +5.327463492068116e-01   +5.970381357834436e-01   +5.050469603000329e-01   +4.974369482918252e-02   +2.449697430944955e-01; +3.293622479593995e-01   +5.781595213468040e-01   +1.840594550993673e-01   +4.000833617680633e-01   +4.603489912356087e-01   +5.092405056903505e-01   +1.456042008957685e-01   +3.491557883218407e-01];
L1E_L2E_iAMPA_netcon = [+2.205764443029618e-01   +1.349667732778293e-02   +1.007947650978654e-01   +1.036151474796360e-01   +5.636676184808914e-01   +4.552745213666778e-02   +3.088523854564071e-01   +3.710958788375899e-01   +7.129522450067932e-01   +3.579482424069488e-01   +4.887061535099825e-01   +5.569363247508723e-01   +1.720754762801970e-01   +2.453897369796405e-01   +4.647753088438175e-01   +3.064372180136068e-01; +4.522883201462092e-01   +4.328445837541072e-01   +3.329540869498548e-01   +1.595281104711440e-01   -7.626034862376362e-03   +1.141488866071094e-01   +3.523855847646935e-02   +5.918060721028852e-01   +5.720685032885401e-01   +5.455296075451964e-01   -1.315080896971024e-02   +1.092285729476411e-01   +3.292127664529531e-01   +3.141793568989434e-01   +8.800557368868994e-02   +2.227125871349000e-01; +6.819709256276698e-01   +5.336707163162604e-01   +2.952050010645598e-01   +4.868738109032948e-01   +3.134727235631236e-01   -2.443839091558569e-02   +2.896246178809861e-01   +1.732013441473158e-01   -1.204816898889373e-02   +1.446164322147023e-01   +2.773173315606977e-01   +4.485173216175550e-01   +7.700033944254625e-02   +6.071330331624909e-01   +3.889212088468437e-01   +6.348715540021527e-01; +3.375199370850205e-01   +4.484481732286865e-01   +1.053194091302511e-01   +2.074366560566905e-02   +2.236027610277418e-01   -1.093855365645712e-02   +3.186046593305078e-01   -5.598622858630983e-02   +3.818527905716396e-01   +5.858110213058287e-01   +3.385603826469029e-01   +4.392441663756293e-01   +2.227407799997918e-01   +4.397551259234513e-01   +4.934120231718601e-01   +3.974355319321577e-01; +8.451340167323924e-02   +2.577967339935621e-01   +5.245171365799062e-01   +1.038781522258216e-01   +1.989397596923919e-01   +6.704174807791264e-01   +1.258531410427610e-01   +5.895948680943502e-01   +4.830785941577811e-01   +5.431033810987129e-01   +2.331899868377600e-01   +1.877838284859594e-01   +5.165990953827090e-01   +4.148104900367224e-01   +2.260649331566721e-02   +1.954604632515225e-01; +2.167132527109633e-01   +5.843937701979414e-01   +2.872656165089371e-01   +5.367061222861185e-01   +2.116844664529247e-01   +1.129168961208211e-01   +5.517294112550920e-01   +1.520848714806969e-01   +5.194829763590194e-01   +3.485396150308417e-01   +3.347072495935474e-01   +3.270322692932232e-01   +7.800593724370952e-02   +4.648583969338266e-01   +4.753919974563124e-01   +2.569449563083229e-01; +4.819563091388481e-01   +5.220598311292369e-01   +2.694293586942353e-01   +3.449966321422524e-01   +5.835963801167871e-01   +6.350504974763984e-01   +3.959205576951187e-02   +5.529972175482255e-01   +1.476259668941463e-01   +5.339297670790814e-01   +3.066527947741194e-01   +6.427356974409689e-01   +2.026662392340783e-02   +2.711069782163657e-01   +3.644472820210222e-01   +2.869675705929457e-01; +7.815321662873143e-02   +7.638065384294541e-02   +3.706018963589712e-01   +5.421125875233236e-01   +2.814950195853486e-01   +1.002025124826734e-01   -6.831426781246952e-02   +2.313146866562351e-01   +3.411198285602235e-01   +6.734165062549148e-01   +1.643242806882742e-01   +3.817476879521211e-01   +3.364284941627668e-01   +3.424836210471019e-01   +9.337692617171016e-02   +1.670381728019050e-01];
L2I_L2E_iAMPA_netcon = [+1.398897333531283e-01   +4.732109137662723e-01   -2.659707815079079e-02   +6.574372874773542e-01   +9.902924179402472e-03   +5.300472394475151e-01   +3.546146387869443e-02   +3.656683359160064e-01; -1.235970865850746e-02   +4.231487275713799e-01   +2.148344998600070e-01   +2.678770926668214e-01   -3.118611033294754e-02   +4.936213415856493e-01   +3.982527178050985e-01   +4.498915961905653e-01; +3.943767271247916e-01   +1.186882219107874e-01   +4.331711743952277e-01   +1.025375829008922e-01   +1.232988037129928e-01   +4.600524240055652e-01   +2.900182290153721e-01   +4.102350723827178e-01; +4.072459290090463e-01   +1.194598236269011e-01   +4.455442154019806e-01   +3.799191533740192e-01   +2.101637406295032e-01   +3.527949261181564e-01   +1.455531627694413e-01   +4.389245990470801e-01; +5.329856955959086e-01   +5.226017548059911e-01   +7.773564358965604e-02   +2.442179192260913e-01   +2.431361809835911e-01   +5.305000594838460e-01   +5.228529892898051e-01   +3.792219463835887e-01; +5.765702234927729e-01   +1.556925865599572e-01   +1.006772527894340e-01   +2.296163604770803e-01   +3.608152430412777e-02   +1.571273565959302e-01   +1.780228410714988e-01   +6.146453565976850e-01; +3.131307606164473e-01   +4.316299934749599e-01   +6.427225821324092e-02   +3.148824088021415e-01   +6.143860933712444e-01   +2.901813627464855e-01   +5.364624666050517e-01   +6.556087520976028e-01; +3.800246054409894e-01   +5.926144286961430e-01   -1.011398148578102e-02   +1.826891061165027e-01   +5.306923098435785e-01   +2.724475537783825e-01   +6.071998974503853e-01   +1.948212265423341e-01];
L2E_L2I_iGABA_netcon = [+5.791735644585349e-01   +3.064593561172705e-01   +2.530508840978530e-01   +5.975203593728998e-01   -1.050367486004457e-02   +5.078875528323117e-01   +6.616837914719175e-01   +2.400396413192256e-02; +2.577396657596004e-02   +1.447504694875751e-01   +5.808771657071208e-01   +3.804366444306491e-01   +2.068727432394863e-02   +2.378822258029224e-01   +7.098098473200131e-01   +6.514161936249950e-01; +4.091195812355863e-01   +5.214162985348389e-02   +4.480754496063428e-01   +2.578841481131444e-01   +3.168039927537097e-01   +3.877426116962475e-01   +5.233272778338273e-01   +2.202602998797046e-01; +3.525094632902585e-01   +6.126499554425571e-01   +2.332554678720100e-01   +2.525373491413409e-02   -4.620357887641142e-02   +3.932288420056185e-01   +3.536236289299420e-01   +3.014191910706300e-01; +3.970671933397140e-01   +3.375961896342943e-01   +9.157655810505672e-02   +1.033316861722474e-01   +5.378272330544891e-01   +5.852416730677614e-01   +1.640632981305521e-01   +3.965723846282292e-01; +6.303636613779759e-01   +2.362659986741426e-01   +1.711365750808904e-01   +1.049209910271225e-01   +4.023689205082134e-01   +4.245724166275475e-01   +2.209185222621331e-01   +6.600201743302475e-01; +1.291516207917032e-01   +2.933012262191603e-01   +4.796496462840530e-01   +1.069328226607852e-01   +4.806184970641218e-01   +2.163343843731371e-01   +4.275944258926510e-02   -4.383327827316520e-02; +3.711934471486114e-01   +1.522439103009213e-01   +6.438765935731038e-01   +3.368297669036305e-01   +5.705623777661345e-01   +4.501038684609784e-01   +4.991639802962897e-01   +1.248274323986715e-02];
L3E_L2E_iAMPA_netcon = [+4.239309723907529e-01   -1.521305845177694e-02   +3.119572548843058e-01   +3.743190949419155e-01   +6.536565617979621e-01   +5.062696257895567e-01   +1.572877506639336e-01   +7.076767658562243e-01   +2.450285142317026e-01   +9.623007977947751e-02   +5.342308147475731e-01   +4.934801966685291e-01; +5.811743773180509e-01   +7.081338915702128e-01   +4.456344483656033e-01   +3.966276110490855e-01   +1.798938013083273e-01   +2.184764560585861e-01   +3.157775775716510e-01   +2.004926386032725e-01   +9.116094936768876e-02   +3.066504831402315e-01   -9.590243920869310e-03   +1.711288140241072e-01; +6.793396563599533e-01   +3.522374334622184e-01   +4.419105358007511e-01   +5.198930526088380e-01   +4.673855712379887e-01   +1.922531923407726e-01   +4.706682918681369e-01   +1.020581677751654e-01   +3.840264328075222e-01   +2.304753842539567e-01   +1.975080100463047e-01   +2.441440846344548e-01; +4.344233616314524e-01   +3.347310154935680e-01   +7.898400081338931e-02   +8.518254119996060e-02   +3.879592816523922e-01   +4.446489974745113e-01   +4.193713711607516e-01   +5.802823619993367e-01   +4.412782927926019e-01   +2.948048814544674e-02   +2.327076719208020e-01   +1.629259289818771e-01; +4.412371226167659e-01   +3.769909454899544e-01   +1.707888640518803e-01   +5.015213846301237e-02   +5.402556559525868e-01   +5.178508909391244e-01   +5.032303055347223e-01   +3.161390184362275e-02   +1.051727750095321e-01   -3.312838184548423e-02   +6.335640905560169e-01   +5.034245419620806e-01; +3.182410832565418e-01   +5.721155577338882e-01   +4.652481055908150e-01   -1.216267049646293e-02   +2.767394989960484e-02   +4.424541638614543e-01   +5.174542329414067e-01   +5.324260344527968e-01   +2.254598054954581e-01   +1.262145420052582e-01   +5.009551301505468e-01   +3.445039361590049e-01; +2.979263679034886e-01   +4.147526725856757e-01   +5.459138597905940e-01   +6.332572746173110e-01   +1.641864272418244e-01   +4.466238517041662e-02   +4.784288564577107e-01   +2.801826477914945e-01   +1.034527739148830e-01   +2.344112831230630e-01   +7.726147673079525e-02   +8.676694930560994e-02; +8.796564292406286e-02   +5.025499054951216e-01   +5.397598862226984e-01   +1.354829027161489e-01   +3.798268945342270e-01   +3.981789565000806e-01   +6.009309057175025e-01   +1.901079200568982e-01   +2.884027175216139e-01   +3.633641807683419e-01   +6.510250054223775e-01   +2.662677044019961e-01];
L3I_L2I_iGABA_netcon = [+4.117585771389319e-01   +3.787382546237833e-01   +4.262735762826024e-01   +2.738203612433002e-01   +2.012750443185876e-01   +4.342175414455606e-01   +4.956712669431934e-01   +3.786157360300447e-01   +8.066242537316638e-02   +2.461428479184785e-01   +3.126208673188184e-01   +4.256977061835298e-01; +1.200828952894397e-01   +4.841225825953238e-01   +5.242111020684729e-01   +4.073620937184178e-01   +5.722354050968260e-01   +6.416897065575761e-01   +1.264064987929891e-01   +5.067386377552858e-01   +2.318340353130546e-01   +4.096036701556923e-01   +1.033085366487226e-01   +1.105507955346298e-01; +1.325636174092055e-01   +5.279535977686783e-01   +5.203651802331589e-01   +5.375119518949996e-01   +2.744686704727756e-01   +2.335271645317305e-01   +4.935356683495821e-01   +1.910599296901804e-01   +6.204122947010792e-01   +5.034105282169266e-01   +1.092403359386028e-01   -2.705432729502643e-02; +6.006350914404727e-01   +4.517916072275560e-01   +4.112276864383964e-01   +1.628452388512844e-01   +5.275955546334682e-01   +3.233796636010012e-02   +7.590133152174935e-02   +1.685163595164295e-01   +5.694938607068177e-01   +5.522199063578014e-01   +3.800674149072894e-01   +1.245332424573670e-01; +4.598483655990284e-01   +1.766083468738797e-01   +4.159755026763154e-01   +9.791723158375376e-02   +2.977731004987123e-01   +5.506796456612082e-02   +1.873140043301093e-01   +6.875815243782725e-02   +5.276636052247952e-01   +2.845730291869712e-01   +5.648394024997292e-01   +1.139975520609249e-01; +4.321366428933992e-01   +1.888741772963082e-01   +4.219105328881302e-01   +2.669675280533375e-01   +3.555701015198241e-01   +4.109232402704565e-01   +6.112929587141558e-01   +3.673473353947626e-01   +3.873027414432619e-01   +1.365520520756950e-01   +2.994765511687046e-01   +2.784118945990868e-02; +2.619069348723403e-01   +4.113173859950138e-01   +1.582021533699838e-01   +1.637220289876057e-01   +4.913868108141135e-01   +5.692569618327389e-01   +3.920188396406268e-01   +2.315335811799667e-02   +4.634576402432027e-01   +3.844630708245038e-01   +1.731909032222725e-01   +1.013600895861207e-01; +1.818801440060595e-01   +4.079103742464903e-01   +3.704693231694602e-01   +3.382300676512154e-01   +3.658887996820668e-01   +2.710426331078953e-01   +1.317656431481911e-01   +4.367626690900884e-01   +1.299281448341547e-01   +4.037851920921101e-01   +6.728009181014838e-02   +4.052186864635648e-02];
L2E_L3E_iAMPA_netcon = [+3.620585912906551e-01   +3.649167106966644e-01   +5.368871290357675e-01   -2.060408124512560e-03   +3.089793180529067e-01   +3.617571033608868e-01   +2.507166868934918e-01   +6.651672152060570e-01; +5.477590172720979e-01   +2.802248759255672e-01   +6.451869582715920e-01   -4.939145770027040e-02   +6.941039282888090e-02   +4.742687540396542e-01   +3.256544884735253e-01   +4.273548041874317e-01; +1.559428041304030e-01   +2.168828193193270e-01   +6.726410820329169e-02   +3.710473867010070e-01   +2.374844596537958e-01   +1.813399582932049e-01   +4.671707122817848e-01   +6.667791503495688e-01; +4.497942773501358e-02   +2.442392155026672e-02   +1.779662465372228e-01   +2.956759939580318e-01   +6.926283112821335e-02   +3.766695874842947e-01   +1.139426643418798e-01   +5.825750117863387e-01; +4.376031815100949e-01   +4.479782944040939e-01   +1.657778006690138e-01   +5.966417170600860e-01   +1.672450647172528e-01   +9.165311127298754e-02   -5.375682789590601e-03   +4.063440851230223e-01; +2.853700124344256e-01   +1.341928496301860e-01   +2.108326130316799e-01   +2.971553064094312e-01   +5.042061306270391e-03   +3.658611232786864e-01   +3.813540429819304e-01   +4.229052783008833e-01; +4.620851808061637e-01   +5.544151714119070e-01   +3.481153389463600e-01   +2.602747776980615e-01   +3.259189515274736e-01   +6.887940592364444e-02   +2.974075827326088e-01   +4.830330239837962e-01; +4.089518987123890e-01   +2.923911966824120e-01   +4.168514366863145e-01   +4.454904855783086e-01   +4.293354899040862e-01   +4.628521893464640e-01   +3.556326715145322e-01   +1.082982950837988e-01; +1.246350138385149e-01   +3.335084313795770e-01   +2.767165704379686e-01   +4.613698605841750e-01   +2.922126961916693e-01   +3.138730832381383e-01   +2.340805192246480e-01   +5.734255811413151e-01; +1.759256512179923e-01   +1.833916493909269e-01   +1.372154484314888e-01   +1.083722542671670e-01   +1.391226313998215e-01   +4.413647400328014e-01   +5.074332336382279e-01   +5.461672438800664e-01; +3.912196813333332e-01   +1.782757829702415e-01   +5.172054861258105e-01   +3.547569845521314e-01   +6.758486915449167e-01   +3.323662347274484e-02   +4.257143581268286e-01   +1.643483436567566e-01; +5.869883674140092e-01   +1.781659216183160e-01   +2.980935885840826e-01   +1.249885805147899e-01   +4.015612709515673e-01   +3.438118001550742e-01   +3.470884565489796e-01   +3.534582173446221e-01];
L2I_L3I_iGABA_netcon = [+2.637370514638138e-01   +6.580342065379218e-01   +8.636610630767258e-02   +2.964770915512753e-01   +6.617790796748078e-01   +4.714856615709088e-01   +3.752897708148997e-01   +6.091957323520288e-01; +5.938263747264766e-01   +5.238701345078216e-01   +1.766954950700532e-01   +4.018272941176293e-01   +4.395297097475099e-01   +7.892146094988062e-02   +8.971980388468850e-02   +5.910939687417298e-01; +5.862057741678522e-01   +5.448090921596337e-01   +4.481563871481667e-01   +5.252876333397177e-01   +2.130657711188587e-01   +4.100117323411359e-01   +5.275348690841044e-01   +6.499436409156818e-01; +2.883483170806122e-01   -7.500304665298024e-03   +3.665388806707592e-01   +5.286324937152468e-02   +1.852995781203421e-01   +4.125319635599638e-01   +9.587215516810323e-02   +2.938181483463824e-01; +1.580462198750132e-01   +4.725376754456447e-01   +1.969623128527235e-01   +2.848465920009629e-01   +2.846094292924986e-01   +3.492174011524814e-01   +3.498572187595190e-01   +4.765050609719054e-01; +1.125926420091549e-01   -3.879562320948792e-02   +3.338683802182726e-01   +3.393381377194815e-01   +1.849985469646748e-01   +9.632578994056236e-02   +4.656530754567488e-01   +1.902393835881159e-01; +1.287551836624019e-01   +2.422880218581372e-01   +4.419621379698617e-01   +1.304130203522250e-01   +3.512495475458628e-01   +2.657164960789942e-01   +6.447421491062715e-01   +6.979244015002304e-03; +3.325456970770425e-02   +5.878157798613468e-01   +2.436495620710692e-02   +4.289392453707420e-01   -6.096945510041508e-03   +1.034950521947250e-01   +3.892879425449263e-01   +4.321963444510603e-01; +2.717577540317463e-01   +2.383250907902260e-01   +3.581396758057919e-01   +4.361245857789479e-01   +4.811963652988559e-01   +6.285974074952648e-01   +5.482963934216665e-02   +6.886662495728471e-02; +5.276648616402374e-02   +1.450869437336789e-01   +6.907209065694832e-02   +5.941522834880767e-01   +3.842098829478616e-01   +2.201831020018453e-01   +8.254593215625139e-02   +2.142183410327388e-01; +2.874564696663323e-01   +5.158832893858052e-01   +9.960835262710846e-02   +6.430642837412396e-01   +3.174381484044660e-02   +5.171968067274919e-01   +1.450803812345959e-01   +7.086219950567210e-01; +5.158012961761075e-01   +2.141533423772282e-01   +2.970132772361659e-01   +7.738390443588518e-02   +6.199910986903477e-01   +3.960929309870690e-01   +6.209009336972708e-03   +2.259321182463002e-01];
L3I_L3E_iAMPA_netcon = [+5.203702520978609e-01   +1.873823131737187e-01   +4.010433151147674e-01   +4.479261958169532e-01   +6.097311630222592e-01   +3.269170354756597e-01   +1.988815821935952e-01   +6.879027647893635e-02   +3.119063782595997e-01   +3.052854544631523e-01   +1.263112813376927e-02   +2.645355380394032e-01; +6.129705335998420e-01   +8.667146130634584e-02   +1.909882528528144e-01   +2.149023707474534e-01   +1.492758036444721e-01   +2.550238165149843e-01   +2.110603172373015e-01   +5.564001751362339e-01   +4.717476955281836e-01   +4.448441131422202e-01   +6.347200150131603e-01   +3.975843519256341e-01; +4.331287123666211e-01   +2.778668650175932e-02   +5.610676957191351e-01   +1.281869354497369e-01   +1.568988111208935e-01   +5.148925034912523e-01   +1.048392376884579e-01   +3.830819513277275e-01   +2.422187201818621e-01   +2.944134775603144e-01   +5.566892637887303e-01   +4.142994043570702e-01; +4.335297818957964e-01   +1.021332120703241e-01   +4.150815044667889e-01   +5.492666586395905e-01   +1.005916360556390e-01   +7.269014918875702e-02   +6.245052549465684e-01   +2.637661219181173e-01   +2.393519880977485e-01   +4.843666577652775e-02   +1.605532568072674e-01   +3.089890303114439e-01; +6.041529594545507e-01   +3.007618472093759e-01   +3.116844628539185e-01   +5.391998355371574e-01   +3.452385691739677e-01   +2.239934485719156e-01   -3.148033105237136e-03   +2.980258700481208e-01   +6.652345275767234e-02   +4.097220145763859e-01   +3.696880425443041e-01   +3.558266703270490e-01; +6.592849052755605e-01   +4.866730034314840e-01   +9.942388957356163e-02   +3.789950849107049e-01   +5.795150812222790e-01   +4.080341909857151e-01   +1.179061983057160e-01   +7.615764055231677e-02   +4.256856458063800e-01   +2.914307089530535e-01   +5.878944495108929e-01   +6.300431639651518e-01; +2.645628157367583e-01   +2.571536431338908e-01   +2.337542671932129e-01   +1.461306903228757e-01   +3.080520626557631e-01   +5.155671203043456e-01   +4.198795890142580e-01   +3.017266070314848e-01   +5.415731077094478e-01   +4.985876643394878e-01   +2.701372940691607e-01   +4.380948943747180e-01; +4.396593871834148e-01   +4.748800774272353e-01   +1.312864889814655e-01   +9.752179353203652e-03   +6.042332872083686e-01   +1.010296637243282e-01   +3.255419583756268e-01   +5.166277426011193e-01   +4.667837777287466e-01   +6.466464000582396e-01   +2.890561518349762e-01   +5.422909128891343e-01; +1.426126518742688e-02   +5.495977953578575e-01   +8.774693989611004e-02   +5.283047683493192e-01   +3.320570505739125e-01   +2.750566547248184e-01   +8.293436272348945e-02   +6.498639507715137e-01   -9.766153052902810e-03   +4.099126915138075e-01   +5.483354910285958e-01   +5.766821333252997e-02; +1.464341523362929e-01   +2.765093447394443e-02   +1.110573876231131e-02   +3.844962400134333e-01   +2.678342721480643e-01   +5.386127989147669e-01   +2.167898474264159e-01   +9.761134290853291e-02   +4.531705557596366e-01   +4.468147714789746e-01   +5.095897257186465e-01   +4.688363431724921e-01; +3.858407637383710e-01   +1.205289499842533e-01   +5.582513494998902e-01   +2.583156611335428e-01   +2.788868598876036e-01   +4.327699553659525e-01   +2.309593431663254e-01   +8.460450549252246e-02   +1.250123464329572e-01   +1.997631234217073e-02   +5.079616642603809e-01   +5.507361872874867e-02; +3.264754545266538e-01   -4.751462409968090e-02   +3.810799412606981e-01   +4.150319043672154e-01   +2.254772463570223e-01   +3.940600007059670e-02   -3.393890286031293e-02   +4.098218835582276e-01   +1.870156929109088e-01   +4.623910208879932e-01   +5.904942945633976e-02   +1.638220911741618e-01];
L3E_L3I_iGABA_netcon = [+4.817791825241751e-01   +1.811747383792148e-01   +4.726588772885752e-01   +5.614775503953511e-01   +4.459457786803581e-01   +5.788617238334265e-01   +1.949243003127128e-02   +4.341819392251328e-01   +5.200809567157725e-01   +4.472961758978736e-01   +5.827995410008247e-01   +4.128724419731906e-01; +3.434901791664984e-01   +4.327481656029564e-01   +1.262193079176056e-01   +3.838149110085295e-01   +8.846386390897569e-02   +5.268228156264202e-01   +3.122386870896479e-02   +3.480804526440840e-01   +2.591562167172200e-01   +1.221331563334034e-01   +3.740391383377617e-01   +5.005537329112858e-01; +3.949964755420170e-02   +6.102337040546665e-01   +1.805278962926498e-01   +8.002617697712625e-02   +2.350603405482366e-01   +2.555820777723162e-01   +4.553060326688003e-02   +1.100723167543467e-01   +5.691635585034328e-01   +3.291300065279953e-01   +2.736609725071946e-01   +1.248277909015737e-01; +4.592398090606311e-01   +1.151013708287279e-01   +5.299289270961112e-01   +2.487883146233734e-01   +6.585477592724395e-01   +8.327745991012575e-02   +1.788949086251801e-01   +1.925241723459976e-01   +4.425405714133767e-01   +6.157194119920919e-01   +1.555657766196203e-01   +3.378196663593744e-01; +6.188124003055437e-01   +3.842956330349868e-01   +5.901945124280650e-01   +6.006137973596893e-01   +5.061843310315561e-01   +3.010100744488149e-01   +2.637359942808216e-01   +4.409337436612716e-01   +3.607094157510776e-01   +3.319978860944082e-01   +2.446540496103057e-01   +4.905019387216985e-01; +2.333339901705543e-01   +5.284233194695385e-01   +4.248795818689153e-01   +2.357916746588636e-02   +5.883167946118345e-01   +1.964805618532855e-01   +4.114114219688084e-01   +5.862933556873393e-01   +3.452853015101816e-01   +3.678508356688753e-01   +2.774072250821920e-01   +6.794878852333678e-01; +5.498082846683872e-01   +1.733237300586254e-01   +8.236930881179001e-02   +5.102451993587323e-02   +1.959122230753855e-01   +3.337988250074940e-01   +4.806387050804428e-01   +4.506208968455842e-01   +5.953333211915246e-01   +5.143824933017708e-01   +5.365452480259077e-02   +1.060459366820299e-01; +2.097200536039361e-02   +2.665449122811765e-01   +2.680861317808948e-01   +5.217963526715502e-01   -2.937486616171572e-02   +4.203099508586819e-01   +2.767236313616731e-01   +3.978883145640817e-01   +5.855291572513148e-02   +3.372741941952692e-01   +3.978959100981216e-01   +1.708129502854274e-01; -3.979758880505910e-02   +1.636307616363668e-01   +5.242446183826923e-01   -2.455462760861472e-02   +3.923750282088174e-02   +5.743343894113273e-01   +6.903888274176844e-01   +1.344170777419682e-02   -6.779498479415201e-02   +2.846997293320658e-01   +4.312681239265861e-01   +1.590174131645048e-01; +5.863378666504037e-01   +6.694470603985909e-02   +2.017309264688375e-01   +3.508103740237516e-01   +3.594710654900149e-01   +3.024599184154670e-01   +4.716185007175933e-01   +3.911052868588019e-01   +1.472089597806308e-01   +7.361512480764927e-02   +3.201080929079925e-01   +2.011720401152773e-01; +5.257812216216586e-01   +1.706051297908383e-01   +3.843968198114707e-01   +7.387006430250828e-02   +5.814798319204982e-01   +8.242149528946960e-02   +6.346526803357500e-01   +6.207795655495717e-01   +2.501506445958881e-01   +1.298443171830162e-01   +1.071920742522276e-01   +1.193634522939890e-01; +1.225171777410604e-01   +5.202791472019040e-01   +5.679272105024026e-02   +5.909746765346906e-01   +4.542024443878602e-01   +9.823439950647583e-02   +4.599462898559206e-01   +6.057928120914776e-01   +4.436738254796777e-01   +4.253782218050210e-02   +4.636001195820140e-01   +2.187748671773976e-01];
L2E_Input1_iAMPA_netcon = [+1.799284703914008e-01   +8.468333377167102e-02   +2.929610198102723e-03   +4.797020825223924e-01   +3.019648909830231e-01   +3.229475572826082e-01   +9.483419638257495e-02   +2.634982241792254e-01];
L2I_Input2_iAMPA_netcon = [+1.815565952645409e-01   +7.440706551143514e-02   +9.163180066581678e-02   +2.944807150339508e-01   +1.380072759541375e-01   +6.943385792702980e-02   +1.206233478124058e-01   +3.576224281796395e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.8*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.8*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
