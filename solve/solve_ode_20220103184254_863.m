function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.141075401480401e-01   +9.460457745141515e-01   +6.982052114903730e-01   +1.549474040556524e-01   +9.212246555832200e-01   +2.189760513528129e-01   +7.406655058411696e-01   +3.025840270293318e-01   +5.325576146037196e-01   +8.286860213321275e-01   +9.687948749268397e-01   +9.643110102477493e-01   +6.964318809652944e-01   +3.715880144126848e-01   +2.970764104901069e-01   +3.778199731142244e-01; +3.459469155063006e-01   +1.315163061691091e-02   +1.419014377508297e-01   +1.762910012534799e-01   +7.112969902872020e-02   +8.086842563292626e-01   +7.946750612577892e-01   +7.585115544778003e-01   +7.842406828139452e-01   +1.816413415971983e-01   +4.654724106750622e-01   +6.554025014758003e-01   +3.763139732583665e-01   +2.755573635715913e-01   +6.849713742060118e-01   +9.538605223829416e-01; +2.079475047290204e-01   +4.673416488447538e-01   +8.375286425302428e-02   +7.021791443115544e-01   +3.127335737650617e-01   +3.820035778997791e-01   +6.635632068243026e-01   +9.536343510283464e-01   +4.903707110352781e-02   +9.259697499987958e-01   +8.700504889026957e-01   +2.087513062655334e-01   +5.414184899244567e-01   +7.558172876440450e-02   +7.734171954731973e-01   +8.118771145952115e-01; +2.418324285541720e-02   +4.899214492245940e-01   +4.329936619338364e-01   +8.329991631988698e-01   +6.285805524520393e-01   +8.564739244890088e-01   +4.408424541590306e-01   +8.802207036153394e-03   +4.622017386952252e-01   +4.201802212602944e-01   +9.466560705769592e-01   +8.974584812204048e-01   +5.183959485924116e-01   +1.503198432708720e-01   +7.205088961052188e-01   +8.916178987856588e-01; +7.653013604812815e-01   +5.162078953310254e-01   +8.947200488624907e-01   +8.166759429663302e-02   +9.054864097605482e-01   +3.225547651953311e-01   +5.754290918092682e-01   +4.065650721134050e-01   +9.382484439824115e-01   +2.998036877630114e-01   +2.325837099681279e-01   +4.881043947809741e-01   +7.632038454065787e-01   +3.651302758844448e-01   +2.785303475592449e-01   +6.833025963920375e-02; +5.718024244390645e-01   +2.877201938843836e-01   +7.323158608799250e-01   +8.349826801173651e-01   +7.961636372835614e-01   +3.789662164103774e-01   +5.188180786098616e-01   +1.526940543661653e-01   +4.734489023905533e-01   +3.481814981149657e-01   +9.184198813084171e-01   +6.622938519068460e-01   +8.032325561216790e-02   +7.170670228173107e-01   +1.380410714425000e-02   +9.028719169329689e-01; +5.765723784585199e-01   +5.656805994199153e-01   +6.804834403950117e-01   +5.419208520159057e-01   +6.430417916993777e-01   +6.368527049052303e-01   +7.244263351847141e-01   +8.214622811067376e-01   +7.790110576945025e-01   +9.712251819977056e-01   +6.338930874497763e-01   +5.261531509536747e-01   +4.863809935416699e-03   +5.320172334220625e-01   +1.452079024769120e-02   +6.673939915261494e-01; +3.895350499599463e-01   +5.100052427337043e-01   +2.024795404116655e-01   +9.627336442987691e-01   +4.395997660636077e-01   +3.862868522820622e-01   +2.222905123728570e-01   +2.885405560779662e-01   +1.094461800225328e-01   +5.305922060199132e-01   +2.848955637985855e-01   +7.081356542041443e-01   +4.012730395711847e-01   +2.320593737317867e-01   +9.365369077920107e-01   +3.465285390414020e-01; +5.562962307124321e-01   +6.788201691315927e-01   +5.302152117182650e-01   +6.773581905466124e-01   +7.488772221921252e-01   +6.730145142351114e-02   +9.979210120373208e-01   +9.775352032071674e-01   +5.213356907439884e-01   +7.902751031276674e-01   +8.554538689925471e-01   +7.189853589328649e-01   +6.621690323434224e-01   +4.716529178962061e-01   +9.335415148096982e-01   +8.370092541298159e-01; +1.829715607826896e-01   +6.159969972436303e-01   +8.312592051893981e-01   +3.355629271885817e-01   +8.260502695968666e-01   +1.697026309131499e-02   +6.193747251940047e-01   +6.256783153646931e-01   +6.361242874151294e-01   +7.935925301089866e-01   +1.657722251976687e-01   +2.943412300058476e-01   +3.682633716082256e-01   +7.164558782520124e-01   +3.730591652884597e-01   +1.983204796078478e-01; +1.183782819201680e-01   +5.648680318089586e-01   +1.757431050947725e-01   +2.210201464007605e-01   +3.415742331099395e-01   +8.794754845231623e-01   +9.802580735707944e-01   +7.432972328705443e-01   +5.788740377696843e-01   +1.435824455212309e-01   +8.274648815819453e-01   +1.172847981827289e-01   +3.930293729064326e-01   +5.142496294892187e-01   +1.090932383287989e-01   +8.406572523869972e-01; +5.862783619154238e-02   +5.048111982586526e-01   +5.175983198224822e-01   +5.680093774559960e-01   +1.399407519525834e-01   +1.574372406825826e-01   +4.956948659662344e-01   +8.720752189045718e-01   +8.352331637759188e-01   +4.561479583479254e-01   +2.167728046991384e-01   +3.252714685534785e-01   +1.342645346671875e-01   +5.130946705898631e-01   +7.196055037409340e-01   +4.249285787755234e-01; +9.329342325209400e-01   +6.676295125184549e-01   +3.557963520394594e-01   +3.836321280831711e-04   +5.046299953204640e-01   +9.132284110162783e-01   +5.223144943656359e-01   +3.296864169131143e-01   +1.154960917726583e-01   +4.579027610208539e-01   +2.669310146643201e-01   +4.570054588120152e-01   +3.381020020899742e-01   +3.859213863951190e-01   +4.483710909867769e-01   +5.587792168431435e-01; +7.455462528797396e-01   +6.333835388679113e-01   +6.463703052489511e-01   +5.884885446583609e-01   +4.140066314477388e-01   +5.566043444099383e-01   +8.545397522748915e-01   +9.810447798353687e-02   +5.074224910155665e-02   +9.549008157810653e-01   +8.751709999026262e-02   +7.163838531309705e-01   +1.224649198606647e-01   +4.784941791121686e-01   +1.225441417874966e-02   +4.469689614854322e-01; +2.432115978757319e-01   +1.437143094427098e-01   +2.813533655526878e-01   +8.910449898967997e-01   +1.716420398872587e-01   +9.225806797901037e-01   +2.535055973176882e-01   +4.507565711171042e-01   +5.177806158484609e-01   +5.342631918301610e-02   +9.168255365702896e-01   +4.056437356876783e-01   +3.688643756322150e-01   +7.399251831536970e-01   +1.232678396095524e-01   +7.608169640773791e-01; +2.043815786188687e-01   +1.788611772929405e-01   +4.358471969930336e-01   +2.549654078683568e-01   +4.934753412772362e-01   +5.973452144945045e-01   +5.818492805315770e-01   +2.406121611837964e-01   +6.963198733060312e-01   +3.590225297347958e-02   +7.256678265705467e-01   +2.426258362987602e-01   +2.513739919613869e-01   +7.019164016146057e-01   +6.587061761023257e-01   +9.580023432996448e-02];
L1E_L1I_iGABA_netcon = [+8.428721442139953e-01   +7.526313012045897e-01   +8.737563369520340e-01   +4.363447468737067e-01   +9.185846913639045e-01   +7.791025011698003e-01   +3.221076339003360e-01   +6.408896638867182e-01   +9.424663007800935e-02   +2.572488134014478e-02   +1.286301052630736e-01   +5.196403706683627e-01   +8.700767556019867e-01   +5.763915230105924e-01   +1.656075010472397e-01   +6.274884408985710e-01; +6.211275717549912e-01   +9.955617014559697e-01   +3.097030860605424e-01   +1.474415639162824e-01   +8.827109482106081e-01   +2.730846684285363e-01   +9.627089223964340e-01   +4.303696081104150e-01   +2.924997279459121e-01   +5.143622962036269e-01   +4.237785824821160e-01   +2.036134467998208e-01   +8.033379204988680e-01   +2.878578440869339e-01   +5.393036696541410e-02   +3.367983927183336e-01; +6.707831031523674e-01   +3.706836738565498e-01   +4.330095560453885e-01   +6.545001385477759e-01   +5.855420439628171e-01   +5.273483301358020e-01   +3.524679071131909e-01   +4.785904369368876e-01   +3.267262376721369e-01   +8.622262362945154e-01   +4.810029168434168e-01   +7.758810268457835e-01   +6.462638151813458e-01   +1.318163250740678e-01   +2.112553825377313e-01   +1.571288878171777e-01; +7.821364312005241e-01   +5.027025828803775e-01   +3.813118671512921e-01   +7.215023407910103e-01   +8.349299685486855e-01   +4.037463169769493e-01   +3.204366178104640e-01   +1.005498689386018e-01   +4.825477300435722e-01   +5.828001608561788e-01   +6.736905303519890e-01   +3.913964520679838e-01   +7.341030968457550e-01   +5.079738285752834e-02   +2.035279972562400e-01   +4.014705270416143e-01; +3.095937301791017e-01   +7.575833842606332e-01   +6.565243606559368e-01   +1.622670146664692e-01   +7.761148493489508e-01   +7.795605559277998e-01   +9.088092320430236e-01   +8.060048822601894e-01   +2.409869409737652e-01   +4.215797054102724e-01   +3.569163506837068e-01   +6.681432932339747e-02   +6.669422946653623e-01   +6.230847064802314e-01   +2.178361766311867e-01   +9.129062038503752e-01; +3.294866027056656e-01   +1.266594317427759e-01   +2.377342604486542e-01   +3.425940870945401e-01   +7.862353393038204e-01   +2.602803418073694e-02   +8.849125276892111e-01   +6.428373784365111e-02   +4.535882718253959e-01   +7.141113496421840e-01   +4.967043377456151e-02   +7.568862062938940e-01   +8.812887429028954e-01   +6.045853341979526e-01   +5.789747544693633e-01   +1.487605655855027e-01; +6.338676865600950e-01   +5.174460739825045e-01   +6.867584747194994e-01   +1.058297862770730e-01   +7.015226159914933e-01   +4.118936824473020e-01   +3.537977734791597e-01   +9.543186678567737e-01   +7.589460580367946e-01   +2.336257022087553e-01   +2.899412255363594e-01   +4.539757310427835e-01   +8.529001592537787e-01   +3.710852896240582e-01   +3.341312977751627e-02   +4.644022277919319e-01; +9.020276066047980e-01   +9.057319848934096e-01   +3.264852618559054e-01   +4.124873841945814e-02   +1.748098350170334e-02   +8.258014546656364e-01   +7.495301127554259e-01   +7.729262152545225e-01   +7.172458979087057e-01   +5.941244539931913e-02   +7.944449211495211e-01   +3.194116528898243e-01   +4.036439247248139e-01   +8.311680771132350e-01   +7.952633256464865e-01   +7.724255476872040e-02; +3.709024277939432e-01   +9.901846806474056e-02   +8.807907492859177e-01   +4.784572662677002e-01   +3.304939466401757e-01   +5.924142626816785e-01   +1.262701566564101e-01   +4.412752188697278e-01   +2.376701533622003e-01   +9.762598014921565e-01   +6.509572251092560e-01   +2.781310697444130e-01   +1.046234077904930e-01   +5.195476155952324e-01   +1.350963875926494e-01   +3.423702309020076e-01; +8.815712685818470e-01   +1.786284470349101e-01   +9.993195043284679e-01   +4.775060139116299e-01   +9.475226517691542e-01   +2.127500649478515e-01   +6.000144603845723e-01   +1.652295505649820e-01   +6.996073597132129e-01   +9.695689980795495e-01   +7.095690440164669e-01   +5.841538373376060e-01   +4.036910597275212e-01   +8.007842833876253e-01   +5.825606708664556e-01   +4.959003691868301e-01; +1.241803731607177e-01   +1.731066858355973e-01   +6.811130348866868e-01   +5.462295172206653e-01   +3.989348127052322e-01   +2.961122213469195e-01   +4.366125167389981e-01   +8.093253320564252e-02   +3.056638335341813e-01   +1.366282104669296e-01   +7.641805740789621e-01   +9.120769498624536e-01   +3.406810959125857e-01   +5.704199462303811e-01   +8.595249644673809e-02   +4.899262010816705e-01; +8.845878472941412e-02   +5.340768368023487e-01   +3.455868970597623e-01   +6.528393818443433e-01   +6.317391717556715e-01   +2.683437758671475e-01   +9.585039688505576e-01   +7.418174515965424e-01   +4.691557797257696e-01   +3.083726584747309e-04   +3.846820760534214e-01   +4.505119202844637e-01   +1.149902438623259e-01   +7.145066203141709e-01   +2.280672844533021e-01   +1.275888960678512e-01; +5.460603359522443e-01   +9.784343119991896e-01   +5.606747031902996e-01   +3.489074097640411e-01   +8.591302864064532e-01   +9.281338283824936e-01   +9.642695945442322e-01   +5.435947032826146e-01   +4.438787541487692e-01   +9.363545868890646e-01   +3.614843924784591e-01   +9.806343919822648e-01   +8.527311377950133e-01   +7.334251460336781e-01   +4.522276486927599e-01   +8.553357497484294e-02; +6.104699230810832e-01   +8.438946023968861e-01   +8.898060881256935e-01   +2.565046593853882e-01   +3.765266321871458e-01   +5.536776159106520e-01   +2.419641995907375e-01   +4.858359375868486e-01   +7.341829596746703e-01   +7.404128848420282e-01   +8.110647723564068e-01   +1.109440624532631e-01   +8.918187369616785e-01   +4.548663855303082e-01   +1.786245504594435e-01   +6.739232367559773e-01; +7.281997681183058e-01   +6.722267651415912e-01   +6.461023441359799e-01   +1.764319082108627e-01   +2.037506513509121e-01   +4.335886250109531e-01   +7.708630580314507e-01   +8.956560794709683e-01   +8.759070693972530e-01   +4.324898766235279e-01   +3.857774106149602e-01   +4.158088458692057e-01   +6.862714079548706e-01   +2.822802272327515e-01   +4.149704304965529e-01   +1.217717267248586e-01; +9.910829784740796e-01   +8.463314618744704e-03   +3.769207227262479e-01   +4.777999334299211e-01   +9.118062948617589e-01   +3.287052765870724e-01   +7.125069692380497e-01   +5.830016973022041e-01   +9.131512386507493e-01   +9.439906064784691e-01   +8.715374781290012e-01   +3.832880989368155e-01   +7.428025199518185e-01   +1.518294050780797e-01   +9.661484416281927e-01   +9.898587953558099e-01];
L2I_L1I_iGABA_netcon = [+5.744460660223365e-01   +5.640353634827013e-01   +1.087116233391589e-01   +4.587631313287002e-01   +7.967879489546388e-01   +9.782556966944156e-01   +2.238985547583281e-01   +7.582832568051465e-01; +5.574403659361290e-01   +9.531862078114326e-01   +1.192857759356512e-01   +5.675103702929249e-01   +5.413772670522655e-01   +4.229555530678809e-01   +6.603640744892780e-02   +5.060791060597328e-01; +6.116957662876332e-01   +8.840903807536627e-03   +4.327495912115819e-01   +8.182861013624487e-01   +2.574834414047226e-01   +3.939940267430283e-01   +8.353204924045020e-01   +8.274766071257714e-01; +4.673024097492590e-01   +1.271010105548356e-01   +9.329885319796016e-01   +3.546434690474035e-01   +7.814950886190883e-01   +4.609228090438810e-01   +4.206008396507628e-02   +9.278697906503754e-01; +4.349762128353740e-01   +8.532071644196541e-01   +1.403975172655153e-01   +2.486724565666781e-01   +7.785926190248612e-01   +1.215475053618788e-01   +9.092841559236009e-01   +7.099984888515541e-01; +6.330460405934622e-02   +2.177382340561076e-01   +8.258976306685402e-01   +7.708298916581768e-01   +1.442349380920655e-01   +4.552715412220600e-01   +4.503994595262445e-01   +7.975952718697596e-01; +6.464160405548758e-01   +7.094343927094187e-01   +9.321984590445186e-01   +2.590859523366159e-03   +8.234428649389059e-01   +2.659497901829499e-01   +2.855088968092315e-01   +9.581371354561073e-01; +4.255492008756460e-01   +7.744902659105857e-01   +5.729311550497176e-01   +2.755387270166129e-01   +6.225950164550966e-01   +9.306301132591682e-02   +7.543653744444446e-01   +9.514160755956956e-01; +7.563075340015857e-01   +4.204046515969753e-01   +4.987825174274951e-01   +2.328498933738318e-02   +4.574802101091671e-01   +6.615610333213751e-01   +9.264906952493961e-01   +2.961499404270821e-01; +3.077098649717832e-01   +7.252417271036075e-01   +9.312335920446844e-01   +6.697910617215648e-01   +4.835092003057680e-01   +9.450835739015414e-01   +1.412165945180065e-01   +3.516284266625880e-01; +5.987500470070314e-01   +4.575287693206123e-01   +8.618758966526587e-01   +9.671292372498447e-01   +2.187616700223824e-01   +7.641306770198502e-01   +9.563551037379637e-01   +5.407385583842023e-01; +3.348423041960996e-01   +8.046235086951141e-01   +2.526624110551129e-01   +9.457697221930457e-01   +8.577510574768563e-01   +4.205971705185388e-02   +3.040050010854567e-01   +2.138443450982712e-01; +6.441667426660546e-01   +4.275280685913828e-01   +4.587696045882508e-01   +4.787195758553545e-02   +8.793366593183678e-01   +2.620437060317912e-01   +2.095197575710916e-01   +8.103139411159792e-02; +1.551592734744888e-03   +1.491824255134278e-01   +7.410965649824092e-01   +2.859645262699659e-01   +8.455866917873970e-01   +6.343609802363530e-01   +4.632921375375019e-01   +5.061133119755665e-01; +1.441238267406890e-01   +8.046774427814578e-01   +7.524886260895511e-01   +4.874520099323003e-01   +4.430056952277676e-01   +8.977115761652774e-02   +5.971251846348635e-01   +1.947418041394386e-01; +2.481288747920486e-01   +3.810627247284284e-01   +2.302103219935492e-01   +8.871074632118502e-01   +5.437635432868059e-01   +7.463014064242855e-02   +5.526744394806717e-01   +1.451962354016686e-01];
L1I_L2I_iGABA_netcon = [+6.986229468902574e-01   +8.671972659397476e-01   +6.143176018403550e-01   +5.499038594829829e-02   +1.435106336973442e-01   +2.354354023753973e-01   +8.394591973963937e-01   +3.699798148813788e-01   +7.063464087772303e-01   +3.838043588549234e-01   +2.391127068757447e-01   +6.661855677275935e-01   +1.678544033880508e-01   +5.700618232171787e-01   +4.328548182821850e-02   +4.905097599605679e-02; +5.976874344006942e-01   +7.976751290905283e-01   +6.101829616378460e-01   +5.779296266696348e-02   +7.444248732585486e-01   +5.565248873517950e-01   +1.982153899700251e-01   +5.588290808072781e-01   +1.875840490076679e-01   +7.201403415478831e-01   +5.126567748667740e-01   +3.297286166248793e-01   +1.153351480178685e-01   +8.095867443653746e-01   +4.425003799235453e-01   +9.210210032605788e-01; +1.630901876730201e-01   +6.274475032077470e-01   +3.130894227952740e-01   +5.968070672135986e-01   +9.511090447192461e-01   +1.140619156376297e-01   +6.168715740053048e-01   +8.306678878889838e-01   +2.305564457465631e-01   +6.413110112448195e-01   +7.320113157436048e-01   +5.521546656598029e-01   +7.368137639846263e-01   +6.739830899099820e-01   +9.175012718283332e-01   +1.742257560312324e-01; +4.830999048226449e-01   +4.721360023768085e-01   +1.425791473283451e-01   +6.572489796943776e-01   +2.661155205689319e-01   +8.191770296525807e-01   +1.548676338783948e-01   +7.078904391134404e-01   +9.984443462538762e-01   +1.008629881309775e-01   +7.716791151664411e-01   +5.323395872661605e-01   +2.097217113053227e-01   +4.442074489454116e-01   +8.847645105380673e-01   +7.438194128969685e-01; +2.853203861054721e-01   +1.974425129596820e-02   +6.047267669189108e-01   +4.793968400561636e-01   +9.565213434980598e-02   +6.507812997205144e-01   +5.834795539898431e-01   +1.153213525314153e-01   +9.049821507131725e-01   +4.918481908550168e-01   +6.772122549585827e-01   +9.012343844868109e-01   +4.831954653323532e-01   +8.940725129218036e-01   +9.233044057010177e-02   +4.766818157324189e-01; +4.029825223023557e-01   +1.184049539712600e-01   +8.895610133432524e-01   +9.783903193706056e-01   +2.306303252185465e-01   +2.371922604382227e-01   +5.454776544323947e-01   +7.401999912124699e-01   +1.124108514357546e-02   +5.620549503908105e-01   +8.133087147036613e-01   +2.842135213212782e-01   +5.032814817903647e-02   +7.834146360040165e-01   +6.752647168706003e-01   +2.466852208181440e-01; +4.907330569360699e-01   +7.193070963904448e-01   +5.618073495634602e-01   +8.637539866238534e-01   +8.958402508077297e-01   +3.021359957257187e-01   +6.822341888214610e-01   +9.243456826987170e-01   +8.342565390014651e-01   +5.630297970936981e-02   +4.181803453379739e-01   +1.387907881206888e-01   +5.718806243128476e-01   +5.812810774935580e-01   +8.826664460724633e-03   +6.631353438212847e-01; +8.619352547683673e-01   +6.820347698655754e-01   +6.327505847402369e-01   +9.536116109222842e-01   +1.989530724374820e-01   +3.311001223741428e-01   +6.979561747155505e-01   +9.229449123693009e-01   +2.518335221441267e-01   +8.868043173951218e-02   +4.977582308574144e-01   +9.560567031716963e-01   +4.916484803812918e-01   +6.158804288578182e-01   +1.211232678492823e-01   +6.077284344461754e-01];
L2E_L1E_iAMPA_netcon = [+3.683920247838318e-01   +5.622218266154777e-01   +2.002090158723814e-01   +5.144948068437019e-01   +2.897939383298851e-01   +7.478686873294628e-02   +2.779863546362407e-01   +2.665457725035881e-01; +4.369137422956024e-01   +1.929832271360927e-01   +1.372970333805801e-01   +6.844890686764115e-01   +6.198659357503662e-01   +5.945921390119909e-01   +9.281287161244018e-01   +9.045644391799573e-01; +7.185910752854308e-01   +6.129334755020536e-01   +8.129141337769423e-02   +2.072152791084093e-01   +8.636425741909582e-01   +7.777880396449283e-02   +7.639821366167308e-01   +1.593738534867518e-01; +1.913812881671291e-01   +7.405757697156559e-01   +9.129775373757852e-02   +9.719137291741123e-01   +8.211046152914451e-01   +3.972517398170280e-01   +2.626410640057189e-01   +5.541543962635070e-01; +4.050058963550607e-02   +8.328868238767273e-01   +5.520773976018167e-01   +3.505871098291470e-01   +2.060868500661945e-01   +6.058590251679413e-02   +2.423354296302415e-01   +4.229178411258680e-01; +3.152907787990443e-01   +2.785907786538543e-01   +7.319575979674477e-01   +1.836262950171637e-01   +7.506720145394712e-01   +1.287344850713447e-01   +1.660904318161636e-01   +5.475064538400231e-01; +7.903188627866193e-01   +6.076543398850091e-01   +5.441509206877567e-01   +2.383216657712764e-01   +1.983367722822896e-01   +2.441171615255739e-01   +2.876155744087403e-01   +7.536324818637818e-01; +4.728323092911778e-02   +5.473965712029828e-01   +5.412669368490504e-02   +2.544820332018586e-01   +5.781676867998774e-01   +9.441615960401688e-01   +5.644580240122312e-01   +1.244174144178052e-02; +2.157814131437257e-01   +2.745075480809868e-01   +6.324170107969805e-01   +2.222450286471660e-01   +8.766414686070100e-01   +2.037899473210712e-01   +4.050286829514713e-01   -8.253546597243570e-04; +2.745527953126946e-01   +3.400387519486650e-01   +9.947078825105895e-01   +3.541005835549713e-02   +7.130203013155016e-01   +3.269449852413701e-01   +9.866376068822404e-01   +2.142464767639587e-02; +7.892873662024896e-01   +5.667578615112394e-01   +9.140894108046277e-01   +3.568103174807867e-01   +7.009128996397892e-01   +8.664662136034544e-01   +5.444914051576619e-01   +3.591051152785080e-01; +9.907924717157606e-01   +7.437156328809879e-01   +7.682648021036798e-01   +8.988645563232436e-01   +4.680637932063347e-01   +9.230458251654206e-01   +9.281420906644559e-01   +4.259755218216367e-01; +9.495782446488063e-02   +7.717224049156605e-01   +1.925466544287338e-01   +1.397786185068150e-01   +5.048768664346465e-01   +2.295369579203539e-02   +9.923945744741639e-01   +5.451965877261705e-01; +1.958750987309455e-01   +3.986405389099512e-01   +3.186136280554982e-02   +9.552966453993047e-01   +7.969831692683943e-01   +3.643616106357325e-01   +8.354403360910188e-01   +4.916724234071288e-01; +1.162527818095370e-01   +1.492902128913211e-01   +3.735819196818922e-01   +9.024137721686112e-01   +9.394161748603614e-01   +5.287070320206249e-01   +1.798600739346009e-01   +9.206644039485863e-01; +6.468748472383696e-01   +2.076898199407844e-01   +5.757152506682709e-01   +4.099531407644291e-01   +7.823988231701842e-01   +4.067621344073444e-01   +3.135681978880169e-01   +4.158948751493672e-01];
L1E_L2E_iAMPA_netcon = [+4.975285427935174e-01   +4.501899763112742e-01   +6.160126694085644e-01   +4.901115518935231e-01   +2.293798502404519e-01   +7.216555124134884e-01   +6.948403746956919e-01   +6.328233945739768e-01   +5.223236760949951e-01   +2.407006690469030e-01   +8.769870011155523e-01   +1.741262103393759e-01   +1.369395538845130e-01   +2.428706393737565e-01   +1.842339262169592e-01   +2.362342282749754e-02; +8.387563087069385e-01   +3.692289468393982e-01   +1.031730863376163e-01   +6.611911432969226e-01   +8.363828004549249e-01   +3.811509107183959e-01   +9.803987231441196e-01   +6.271651935563142e-01   +6.732282390045569e-01   +7.297500137513704e-01   +6.591733866916363e-01   +3.027990318760448e-01   +2.834619908029014e-01   +7.480650922024646e-01   +1.459902960839881e-01   +2.512584755286427e-01; +1.849071950743727e-01   +2.997432267843789e-01   +7.524569071949516e-01   +1.784669456619503e-01   +7.340874965147882e-01   +3.839580257600543e-01   +7.510090163641285e-01   +4.077643238445695e-01   +7.770685174890627e-01   +1.353915942710787e-01   +5.366902301635841e-01   +1.097033175483803e-01   +6.642283601187229e-03   +9.363094061402477e-01   +1.328418594556885e-01   +9.890942182022079e-01; +3.364362038672931e-01   +2.325563861201880e-01   +5.374444238439839e-01   +4.779704257376947e-01   +4.895210944947745e-01   +7.156835531315430e-01   +5.537366411389079e-01   +4.248372214049675e-01   +4.639537730225192e-01   +4.102983606149032e-02   +2.525326076525166e-01   +4.519630419040256e-01   +3.057034085904353e-01   +3.027957124683895e-02   +1.729058551168821e-01   +6.295233806590006e-01; +6.930738593434281e-01   +1.373920465684105e-01   +4.434803407106452e-01   +4.990982410726463e-01   +8.489007270300195e-01   +8.390127178727702e-01   +3.008764828382882e-02   +5.109618018309379e-01   +9.080268783607841e-01   +6.493994630213420e-01   +1.059437618556011e-01   +5.837228364174125e-01   +9.044208853424577e-01   +4.359163020900768e-01   +9.227795313888359e-01   +3.576307801254166e-01; +6.927739857342642e-01   +1.001567109339607e-01   +7.433412578359144e-01   +6.003643853142208e-01   +7.146581698484651e-01   +6.685585867494166e-01   +1.958495101347325e-01   +2.587827352300116e-01   +2.470848882602068e-02   +2.004967446165308e-01   +9.711417792906425e-01   +2.241062804599802e-01   +2.942363483762235e-01   +8.317689808117111e-01   +2.597854747896797e-01   +9.403045478136221e-02; +3.676024501930751e-01   +2.262195139259124e-01   +3.876032806061894e-01   +2.403788887689300e-01   +5.225413446734065e-01   +6.503261511221690e-01   +9.416114343655715e-01   +4.225391551512404e-01   +4.806189610902175e-01   +9.728226036297465e-01   +5.976626045785896e-01   +1.109936483825343e-01   +8.335641883358348e-01   +9.989705940830549e-01   +2.057461085266894e-01   +4.093808507487464e-01; +3.341894158997846e-02   +3.463517819155801e-01   +5.268303220470854e-01   +5.170170496796873e-01   +9.380512502768327e-01   +5.632298812915572e-01   +3.972423396049147e-01   +5.235918701583010e-01   +2.707617397380007e-01   +8.211551198035854e-01   +8.199323900518768e-01   +5.608281193274067e-01   +7.455380599308039e-01   +9.203143380861996e-01   +6.135927524388657e-01   +9.310955792150951e-01];
L2I_L2E_iAMPA_netcon = [+6.766242340109698e-01   +6.149348987145404e-01   +4.148144828128423e-02   +7.930206121563863e-01   +5.235353168027099e-01   +8.252995191499829e-01   +6.448546475123770e-01   +3.863964847751041e-01; +2.306478568305214e-02   +9.443352178225932e-01   +5.473493439602343e-02   +9.301635211210526e-01   +5.360909872622603e-02   +1.084582842371505e-01   +3.966543321908006e-02   +1.666216662399019e-01; +7.341949143439127e-01   +9.643284091760368e-01   +4.009322837158391e-01   +9.367558952049889e-01   +2.870735411004132e-01   +2.324327231721758e-02   +5.675991267487650e-01   +4.439949161016986e-01; +2.140593723503335e-01   +3.694507807038390e-01   +9.836642001559739e-01   +1.466574416172901e-01   +7.094631431601039e-01   +1.209354307222159e-02   +3.049326045174499e-01   +8.735448458977793e-01; +8.606817634557177e-01   +7.955647874129915e-01   +7.122482077642847e-01   +3.189106413673015e-01   +8.785866162889434e-01   +3.366039114033618e-01   +2.608672049432935e-01   +4.106085439539310e-01; +1.567034441986446e-01   +7.290532919265965e-01   +9.884903439825722e-01   +4.285444035695568e-01   +3.663384977699979e-01   +6.629515106106469e-01   +7.218765956927807e-01   +1.629089834144035e-01; +6.688929029683592e-01   +9.539002987703834e-01   +6.458515019853591e-01   +7.017541454460205e-01   +5.603751641102588e-01   +5.949262840112030e-01   +3.053229403414738e-01   +6.617040602665201e-01; +9.349143383277243e-01   +1.117707834106137e-02   +5.016964520983099e-01   +6.148013832661068e-01   +8.848042139361789e-01   +7.991897684776478e-02   +8.959457690106811e-01   +9.254382092350709e-01];
L2E_L2I_iGABA_netcon = [+6.017403825487953e-02   +5.203297178126909e-01   +3.524950266885923e-01   +2.614109464291510e-01   +4.151287088185585e-02   +8.904540406197928e-01   +3.435171432795918e-01   +4.513718826848162e-01; +3.544651895154591e-01   +6.926920253624277e-02   +5.578971211685410e-01   +9.845240166242901e-01   +3.610418101131017e-01   +5.402886650058705e-01   +9.347122034129333e-01   +6.711459507680233e-01; +9.323760926905994e-01   +1.847384772164952e-01   +6.912614904080936e-01   +3.490447145864171e-01   +3.586148345338435e-02   +7.177551590181763e-01   +9.183954575045955e-01   +7.689825810730729e-01; +2.404790726623273e-01   +3.161056953110495e-01   -6.651077790679865e-03   +4.019319083144325e-01   +4.857728087897982e-01   +7.101359556154603e-01   +7.253687058058467e-01   +9.274400602498285e-01; +1.033302884724075e-01   +2.440308796610872e-01   +4.783097710852385e-02   +7.518581131461559e-01   +7.224886482343880e-01   +1.682762123237449e-01   +4.430773533086345e-01   +6.584446306437284e-01; +7.155604116054216e-01   +3.215007504497973e-01   +3.081898814115044e-01   +1.022330487540347e-01   +1.423701269326980e-02   +3.518917766448843e-01   +1.523472618592079e-01   +5.017160186378352e-01; +5.837881852931459e-03   +8.801823363360632e-01   +8.693738165840752e-01   +5.910351165452489e-01   +5.169745815243663e-01   +3.792001499110768e-01   +8.323526376213878e-01   +3.425448692269374e-01; +1.853490152134990e-01   +3.014014187550797e-01   +6.273313121104899e-01   +1.224513940895584e-01   +2.397527649761371e-01   +7.581291827255537e-01   +2.574344040516939e-01   +9.463012695686558e-01];
L3E_L2E_iAMPA_netcon = [+7.941462474078026e-02   +1.607497493895930e-02   +3.679749418106114e-01   +4.971255496385797e-01   +1.800759276111271e-02   +9.549365531442738e-01   +3.603796182904522e-01   +1.412685568199752e-02   +2.043598005103002e-01   +6.126759435254778e-02   +2.429054883899605e-01   +9.990330398453801e-01; +9.515839105310686e-01   +9.766043746635890e-01   +1.150456818431627e-01   +6.507911648897337e-02   +8.067017179951170e-01   +3.876908871061235e-01   +2.235823799778379e-01   +1.225710016147851e-01   +3.554923377990797e-01   +7.412945287945043e-01   +5.326890414759710e-01   +3.447455438957455e-01; +6.630934177481196e-01   +7.254210493884661e-01   +5.139463604288333e-01   +8.615595886097707e-01   +7.927268635586395e-01   +6.640862252876115e-01   +7.245833140984220e-01   +6.694320260215026e-01   +8.883282182402263e-01   +9.908110101172095e-01   +3.335326709172424e-01   +8.225405025199467e-01; +1.688776468341124e-01   +8.713619638180831e-01   +7.353191496269076e-03   +9.967099725868495e-01   +4.233125328632077e-01   +5.844729413948647e-01   +7.727985371988653e-01   +5.078845677863347e-01   +8.095929752847378e-01   +7.673583583073084e-01   +6.740268180106447e-01   +1.101499861326442e-01; +1.958594585405908e-01   +8.144797745510391e-01   +8.697073941674490e-01   +1.225953571924892e-01   +6.299827576659601e-01   +5.973472626630400e-02   +3.426443307122006e-01   +7.114757753473151e-02   +3.191078161719987e-01   +8.816255563657288e-01   +8.751088232456913e-01   +7.735914507903523e-01; +9.943241378260350e-01   +3.142909661225221e-02   +9.045548145452422e-01   +1.000935379183902e-01   +5.676236168519281e-01   +7.614741578471465e-02   +5.771987737794662e-01   +5.357501491681376e-01   +5.997104828595003e-01   +3.614668262080171e-02   +9.821676880263801e-01   +1.500136705021053e-01; +9.250757040239199e-01   +9.626537004189886e-02   +1.128643604019363e-01   +1.490594646179897e-01   +8.958157034288811e-01   +2.268952260007580e-01   +6.426997710165843e-01   +6.787702307749209e-01   +6.979732310028290e-01   +7.933807844069299e-01   +1.448140197849153e-01   +7.324546380713831e-01; +9.817812707464293e-01   +8.544585161617867e-02   +4.516373384014562e-02   +1.289994760750895e-01   +7.488919587399242e-01   +4.195926546869395e-01   +3.656755939913092e-01   +5.882835763581685e-01   +1.783221957434380e-01   +7.064241306451369e-01   +8.774035134906938e-01   +1.096144504269673e-01];
L3I_L2I_iGABA_netcon = [+7.676848842568935e-01   +5.355183179062560e-01   +5.976255334788091e-01   +3.054166827886211e-01   +9.662653787924909e-01   +1.151721444805206e-01   +2.980060629947199e-01   +7.956322699348244e-01   +9.141076295285235e-01   +9.941468543129311e-01   +3.096339201256687e-01   +9.965428591383235e-01; +6.375607276082530e-01   +4.526017058172443e-01   +5.623132542739924e-01   +7.623114734935587e-01   +5.440930709356261e-01   +6.961625529201244e-02   +1.692690915263439e-01   +5.196668558124393e-02   +3.864883885722710e-01   +2.869710977385938e-01   +4.423220847353010e-01   +9.144664782942906e-01; +7.968000916568542e-01   +1.142820334208678e-01   +6.819229853712536e-02   +6.473422224477666e-01   +9.810337143150387e-01   +5.125129106682572e-02   +7.240830241209043e-01   +1.812124897044726e-01   +7.499049833718366e-01   +5.161805889854024e-01   +2.086855134001328e-01   +6.915358255467358e-01; +9.598295751588584e-01   +7.205702365426720e-01   +7.680426076499006e-01   +3.321406558809469e-01   +1.243830525002072e-01   +1.298883409090867e-01   +2.985120962436571e-01   +2.469892861522716e-01   +8.796700303725047e-01   +3.594716585259820e-01   +9.408131527274585e-01   +2.212686158413862e-01; +7.170903339298762e-01   +1.865217994889558e-01   +8.681596996508613e-01   +9.711404462706797e-01   +1.684215885807162e-01   +4.918403970054391e-01   +6.771888773561643e-01   +2.618290472729330e-01   +3.925405789079136e-01   +5.176449769465332e-01   +2.901857831528617e-01   +3.156806456412086e-01; +6.433621032781830e-01   +3.246315117945263e-01   +7.080541105136616e-01   +5.323953982298099e-01   +3.338919565901314e-01   +4.674724744350170e-01   +7.461146543136418e-01   +6.476916793012595e-01   +1.677675566253765e-01   +5.012738278220980e-01   +1.221654821262754e-01   +2.367757737473824e-01; +5.121480332778591e-01   +9.664622278195325e-01   +1.078015540512493e-01   +7.514109551893748e-01   +5.315850569574183e-01   +1.581972038038438e-01   +7.458474231061158e-01   +9.756944642872752e-02   +4.367165543569778e-01   +1.880933889587955e-01   +6.943727864752904e-02   +7.079536383184233e-01; +9.514590050011983e-01   +7.011420198747921e-01   +6.660795062633589e-01   +2.688029822253218e-01   +6.929614730969863e-01   +1.386111499178060e-01   +7.845111301565995e-01   +4.694314738627618e-01   +8.575455276383320e-01   +4.778212752950163e-01   +7.290123807636472e-01   +3.764700590495811e-01];
L2E_L3E_iAMPA_netcon = [+6.572447935945888e-01   +3.868103520902182e-01   +2.354705296707518e-01   +4.648662023151871e-01   +9.041782884995927e-01   +9.503463806219673e-01   +7.618909415320758e-01   +3.546780567766357e-01; +3.832848814818348e-01   +2.312824716778225e-02   +9.055814206500273e-01   +2.841333324453407e-01   +6.795099504910017e-01   +2.531640620796066e-02   +9.035502883025660e-01   +6.632839468520060e-01; +3.083561494148508e-01   +3.299236056278596e-01   +4.869993396096658e-01   +2.760995606491933e-01   +8.428771577205620e-01   +5.014598646102019e-01   +7.963640738559215e-01   +5.919904469889109e-01; +1.570462756981183e-01   +4.849171017955085e-01   +5.951013355037761e-01   +1.430952928203075e-01   +9.477755363036396e-02   +3.397073541225922e-01   +9.558479334766848e-01   +5.347628125877708e-02; +7.770660029257137e-01   +2.631993107393093e-01   +9.556359309163527e-01   +1.402796231785828e-01   +7.345334959952838e-01   +6.721123187020218e-01   +5.355234365873108e-01   +2.158953692239024e-01; +7.089615648677362e-01   +5.251835063116415e-01   +8.505262849727852e-02   +2.641566563054998e-01   +5.440341981842516e-01   +1.675361323676338e-01   +1.631638174694570e-01   +6.010324450825661e-01; +1.723922144167395e-01   +4.156541332459733e-01   +2.219878045051858e-01   +6.111213549059509e-01   +2.566326580107545e-01   +2.255272523637396e-01   +1.340671293265923e-01   +2.694161888643769e-01; +4.482891425712103e-01   -3.969436792584737e-03   +1.529237872818033e-01   +1.059862160271481e-01   +7.142779827878516e-01   +1.181420252907468e-01   +3.313599994533253e-02   +1.091378142238332e-01; +8.373495037187526e-01   +8.937050962380152e-01   +3.902621333902282e-01   +4.845102158681167e-01   +3.601647349503887e-01   +9.933788019764975e-01   +6.813308372235802e-01   +2.110186330783623e-01; +6.986304386173300e-01   +2.397189010496639e-01   +1.850843735778881e-01   +8.936203197339028e-01   +8.533629946057429e-01   +1.396676098299155e-01   +5.870457137755284e-01   +8.728386468205468e-01; +7.653261304249809e-01   +7.918723914788834e-01   +7.635117869418074e-01   +1.888033334686618e-01   +8.187564368396201e-01   +7.697910506502580e-01   +2.982245789880515e-01   +4.586925249185071e-01; +9.807630437899030e-01   +5.782166208441001e-01   +2.282743119530276e-01   +5.236824451730775e-02   +6.103282925919320e-01   +6.339881295165002e-01   +7.418045962652403e-02   +7.264089865464850e-01];
L2I_L3I_iGABA_netcon = [+5.894873733713286e-01   +1.472044551576649e-01   +3.439722115801747e-01   +3.694827998568296e-01   +5.990618721802705e-01   +5.067764314854698e-01   +7.727814445376785e-01   +2.648543021884677e-01; +8.456255676947189e-01   +9.903023728685427e-01   +4.603850464292335e-02   +5.371787450226969e-01   +4.780884448133579e-01   +2.373439544389441e-01   +1.791537340686735e-01   +5.854081265786899e-01; +6.046890251035506e-01   +4.805631091131385e-01   +9.420832443699475e-01   +9.751014218145789e-01   +3.766036769904110e-01   +2.725095644412600e-01   +4.542407264055622e-01   +6.797282345181304e-01; +7.444346738954450e-01   +3.666678275020150e-02   +8.666072794941001e-01   +9.970921514045296e-01   +9.792131655976124e-01   +4.055820339660558e-01   +3.063589303156284e-01   +4.155859321531132e-01; +8.495231840771914e-01   +2.697367258554465e-01   +1.336238575232610e-01   +4.143199617316861e-01   +1.385181404430182e-01   +2.609733906969700e-01   +3.875172468213798e-01   +5.112685841981212e-01; +1.459371542927467e-01   +6.751846416728298e-01   +5.905392900041848e-01   +4.503617230017508e-01   +2.713464019572704e-01   +8.542211012135281e-01   +8.038319435522001e-01   +8.139157885736458e-01; +7.425631212809335e-01   +1.458764125461638e-01   +6.275562684736651e-02   +2.546578464960173e-01   +2.265145697951642e-01   +4.791183600401687e-01   +7.774579129374029e-01   +5.445501781038099e-01; +1.729788059513474e-02   +7.730403833179296e-01   +9.466842806052240e-01   +6.004983529008572e-01   +7.922157177444591e-01   +3.421353855883214e-01   +6.467624655494810e-01   +5.898781619690099e-01; +2.283321666383780e-01   +2.673050014125702e-01   +4.973266509462804e-01   +7.773765365826944e-02   +8.179314349710792e-01   +6.387709508271930e-01   +2.426197215315911e-01   +5.354145853526876e-01; +5.379468683651043e-01   +8.804765071385179e-01   +2.659748381729081e-02   +9.124952973754686e-01   +7.929220357893558e-01   +4.155389291866423e-01   +6.078600370763917e-01   +5.408760266786121e-01; +7.205251488002826e-01   +3.693022016469222e-01   +5.768419623696226e-02   +4.728609071274121e-01   +1.128523688613974e-01   +5.438054308361568e-01   +4.185372393667327e-01   +1.511276899477991e-01; +4.346776154330450e-01   +1.000304212592852e-02   +3.009895497567823e-01   +5.078802658115239e-01   +6.329150204148769e-01   +3.398931425860088e-01   +2.946648528479812e-01   +7.038729000731545e-01];
L3I_L3E_iAMPA_netcon = [+6.394959069619058e-02   +7.724375632399436e-01   +5.544600227044156e-01   +5.731609281174493e-01   +9.201758849895524e-01   +8.353830935767567e-01   +8.504521112142539e-01   +8.628295439084798e-01   +5.330575940960443e-01   +9.882274964543224e-01   +4.824128425836606e-01   +3.502325654347340e-01; +9.224297705553537e-01   +8.387295100638918e-01   +8.441145011552946e-01   +9.360430036949751e-01   +5.922384065069177e-01   +3.921995028930569e-01   +6.291454616962749e-01   +8.568528544033688e-01   +5.677579551178707e-01   +7.010664391499427e-01   +7.395503296241682e-01   +4.001994469417626e-01; +1.799518271797825e-01   +5.937050869769203e-01   +9.694443885400156e-01   +7.793103367996188e-01   +5.754895424553719e-01   +6.990306400708772e-02   +4.444443291075101e-01   +9.486436605563787e-01   +9.796412896863708e-01   +8.441701052433660e-01   +5.944966773606887e-01   +9.875151313724182e-01; +5.429482064831272e-01   +7.664023773803353e-01   +4.651404692205618e-01   +5.959695082243730e-01   +6.583602570116702e-01   +3.742415357899003e-01   +2.347291553010487e-01   +6.944322651046259e-01   +9.679972474120089e-01   +7.385665718580608e-01   +2.633238834764524e-01   +2.972408111186742e-01; +3.985734752203930e-01   +6.593545546393503e-01   +7.758311249261740e-01   +5.790558413242830e-02   +4.352616743182232e-01   +8.497713897390513e-01   +5.093445440593058e-02   +3.625529421911726e-01   +5.605329900372843e-01   +9.952244080027115e-01   +6.068264800241999e-01   +2.244528009320363e-01; +9.627322791128047e-03   +5.893659001576211e-01   +2.177726327629849e-02   +5.443132357320589e-01   +9.356461806011870e-01   +2.550918342654126e-02   +7.122547097022921e-01   +3.733806734366389e-01   +5.322606161335569e-01   +5.072112432118426e-01   +2.316190563554860e-01   +3.308092885676457e-01; +1.024441560397559e-01   +2.562878564759235e-02   +6.777977593535532e-01   +8.649673716948332e-01   +1.034926812709906e-01   +4.216590048728833e-01   +8.479187467331636e-01   +8.417950228875846e-01   +4.792691317123646e-01   +1.894493372085160e-01   +1.954295414352630e-01   +1.643667226146467e-01; +8.561170753658658e-01   +6.933622520349439e-01   +8.347929108286758e-01   +3.379428798862743e-01   +4.091094825025206e-01   +2.540530810128021e-01   +4.053582628007019e-01   +3.844554903435121e-01   +9.015721041467073e-01   +9.594290851879543e-01   +2.367280631850011e-03   +3.834129488984859e-01; +3.376585489297480e-01   +3.274314427982203e-01   +6.839148873208820e-01   +1.785411521622165e-01   +8.921443106773360e-01   +7.377096434672749e-02   +2.864853033851776e-01   +7.702759068073769e-01   +4.820231545179158e-01   +4.513468062517215e-01   +6.463219941046797e-01   +5.255628213381596e-01; +1.498441092655446e-01   +7.639791965565773e-02   +8.956752508975733e-01   +8.812078901087363e-01   +7.388955843527615e-01   +9.196615230097017e-01   +2.622625380897258e-01   +7.737761531382277e-01   +4.860397274576395e-01   +6.059597471710165e-01   +4.004064590516825e-01   +5.961146030380612e-01; +8.076338862938771e-01   +7.444009755545186e-01   +9.585086273906764e-02   +8.421047923961821e-01   +9.585938753929297e-01   +2.693078089708640e-01   +5.053265736730370e-01   +4.326872578135898e-01   +3.135316498843195e-01   +6.446148943853588e-01   +2.714710136834286e-01   +1.690264909084946e-01; +6.543737889283981e-01   +9.650054483483413e-01   +6.972559254293881e-02   +8.342156833938599e-01   +9.698917644776359e-01   +1.017038741177675e-01   +1.169204037724451e-01   +4.869353952795811e-01   +8.596716230452496e-01   +7.658498175673428e-01   +3.114378627052663e-03   +7.324121051404267e-02];
L3E_L3I_iGABA_netcon = [+4.373778049208606e-01   +7.119161908524663e-02   +5.943629764697129e-03   +4.955487068746910e-01   +5.431016055878910e-01   +2.523396620205253e-01   +7.178783207210129e-01   +7.620547901828110e-01   +3.782060853979931e-01   +4.486020131089849e-01   +1.998343694327362e-01   +6.500853856582961e-01; +5.754886374342635e-02   +8.073378597572205e-01   +1.320179647149703e-01   +1.924706637981621e-01   +2.111202368245496e-01   +3.337705097264365e-01   +2.216377927429002e-01   +8.884720826193228e-01   +6.102590523355508e-01   +3.935183504727202e-01   +8.281535815506287e-01   +8.992509941054149e-01; +6.263336096524529e-01   +9.088885599516409e-01   +3.084666690243006e-01   +6.416538593985512e-01   +2.703853042689561e-01   +5.916096524367314e-01   +4.979355235965863e-01   +7.321425615492332e-01   +1.678811329906555e-01   +6.683364764558016e-01   +4.467915957546563e-01   +8.379071020429619e-01; +7.985856673679851e-01   +4.252368758577268e-01   +2.389830778946797e-01   +2.557718805761933e-01   +1.321858266672254e-01   +4.817418268674137e-01   +4.756170217091871e-01   +6.972909273600338e-01   +1.052099328911203e-01   +3.305819393975710e-02   +4.231077839744050e-02   +1.708540761755079e-01; +4.010286035778635e-01   +1.841038642060366e-01   +6.486547489830690e-01   +9.492486064478000e-01   +1.612287852818848e-02   +8.980040285764457e-01   +4.311436405257612e-01   +6.460155812131160e-01   +6.253052256395981e-01   +7.874786771461806e-01   +7.685748669455259e-01   +1.602275313155401e-01; +8.836125542390076e-01   +1.826554854737089e-01   +8.078384927633860e-01   +2.874996840139987e-01   +1.525708512463131e-02   +2.947093725644144e-01   +5.557439329726034e-01   +6.195324100429148e-01   +9.514787354196049e-01   +3.789680266689621e-01   +9.723172916718924e-02   +1.357497925253284e-01; +7.235273718509552e-01   +6.723964622440292e-01   +7.410803727720986e-01   +1.492194379363842e-01   +9.794332368575540e-01   +7.875907314972960e-02   +2.066064251906126e-01   +7.786612817951746e-02   +6.659140975151300e-01   +6.508759216088460e-01   +6.529306093112374e-01   +1.595568742458044e-01; +1.969236029949069e-01   +5.240550127605614e-01   +1.220486776523473e-01   +8.706867563274459e-01   +6.467768925743392e-01   +3.921953254869878e-01   +2.769266061524348e-01   +5.484201089466177e-01   +4.720154497079311e-01   +4.976558028634049e-01   +2.710238068029956e-01   +3.939339492635244e-01; +3.742232881271628e-01   +7.769539709731502e-01   +1.717821716744896e-01   +8.865960180900483e-01   +8.166614621596182e-01   +1.984401199621591e-01   +8.131838092313248e-01   +8.846971862192190e-01   +3.407819919735721e-01   +2.129726442865747e-01   +4.370973467663021e-01   +6.663660569372020e-01; +2.129272031242514e-01   +2.997572546197051e-01   +2.732765444961023e-01   +6.687176410262575e-01   +2.767651640886672e-01   +7.221662085112966e-01   +9.498920070548894e-02   +9.871131898499105e-01   +5.906916977569862e-01   +2.161115048719923e-01   +8.491655540215890e-01   +2.229134121910342e-01; +2.588732055860381e-01   +4.733684040147172e-01   +8.141371552409349e-01   +9.979315650904363e-01   +1.450482930915698e-02   +4.212714708953126e-01   +3.281327691396406e-02   +7.129244528378671e-02   +5.465703880078070e-01   +4.510447267254143e-01   +9.021259635010782e-01   +6.435911075194286e-01; +9.924849477930676e-01   +7.068966524093769e-01   +5.914821315446940e-01   +2.679584998256635e-01   +1.019680161916542e-01   +2.674440831268616e-01   +6.442423111215445e-02   +3.306466904940215e-02   +3.902170053203440e-02   +6.292005616236270e-01   +2.852391487688212e-01   +6.122663602565791e-01];
L2E_Input1_iAMPA_netcon = [+9.931448889760495e-01   +9.900003034136440e-01   +9.995215241687689e-01   +9.874902226068029e-01   +9.854975755068481e-01   +9.998341964378114e-01   +9.838672709754223e-01   +9.977155658763559e-01];
L2I_Input2_iAMPA_netcon = [+9.913285847359044e-01   +9.994484615857653e-01   +9.850639605089225e-01   +9.954485841156558e-01   +9.889633438571567e-01   +9.890818455084739e-01   +9.966820904478048e-01   +9.971265269862823e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
