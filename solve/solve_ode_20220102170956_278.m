function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.584434930904215e-04   +8.238031638176534e-03   +1.119034801083611e-02   +1.499261312440413e-02   +5.466272651455364e-03   +1.631910727605941e-02   +3.835461855494336e-03   +5.129027910817305e-04   +1.382887836116302e-03   +7.188597417082976e-03   +7.387732793570855e-03   +5.280686603166717e-03   +6.355128779791862e-03   +1.394774156814926e-02   +9.632003943959383e-03   -5.931913471689040e-03; +7.153784692607427e-03   -1.862681148924757e-03   +1.140571054210624e-02   +1.484464354387435e-02   -4.926001246777165e-04   -4.326054979697072e-04   +1.067419940967676e-02   +1.340951234432752e-02   +9.203418197192432e-03   +8.231706734236201e-03   +1.340872139125970e-02   +6.120558811974101e-03   -1.655656244181695e-03   -3.245310291516757e-03   +9.590859820505490e-03   +4.467188105689237e-03; +4.931633354854899e-03   +9.443580711879288e-03   +1.340055053982680e-02   +7.992690403553262e-03   -3.103727241961501e-03   +1.047145964459052e-02   +1.358166880066122e-02   +6.815098627826244e-03   +4.528779874733418e-03   +1.639453046608653e-03   +8.990709017505946e-03   +2.840126534071741e-03   +6.118214526998695e-03   +8.692044516366161e-03   +1.583597137451140e-02   +7.989260770822742e-03; -3.796521453979006e-04   -2.447991675105751e-03   +4.622713422322004e-03   +7.877314361262674e-03   +1.110727072877387e-03   +9.127652990294943e-03   +1.479596623022175e-02   +1.042118235242319e-02   +1.157160164477847e-02   +2.714123973431978e-03   +1.488559392543894e-02   +1.000378424756107e-02   +8.766364180375730e-03   +1.812107849176336e-02   +5.852708709008960e-03   +3.501346139117605e-03; +7.448936110721663e-03   +5.982021648103829e-03   +4.073849767995219e-03   +9.127511402475790e-03   +8.455653927780346e-03   +1.606404441949733e-02   +4.664348301082075e-03   +8.030167167727534e-03   +7.383775808433544e-03   +2.054574835170334e-02   +4.788857445704301e-03   +7.949275936638323e-03   +5.639245078657346e-03   +9.373904179032118e-03   +1.684415473018618e-02   -6.143226728426681e-04; +9.909149325425661e-03   +1.364349812095639e-03   +1.077000150452445e-02   +3.446256166763273e-03   +5.757032944921137e-03   +8.758539847979925e-03   +1.013307239552421e-02   +8.771570087012051e-04   +2.743014543078427e-03   +7.156341292675719e-03   +7.195333014113807e-03   +5.448560649002022e-03   +5.686417425232669e-03   +5.185428406086308e-03   +4.814830468233280e-03   +1.299889784905364e-02; +1.967587707275948e-03   +8.471093150879001e-03   +1.657763091080647e-02   +1.098523000364954e-02   +1.392906486687208e-02   +7.445893234740486e-03   +4.193856975946215e-03   +1.344494814120255e-02   +1.713997948878576e-02   +6.312256922278026e-03   +2.641779383517333e-03   +6.229188488762890e-03   +1.728342888244854e-03   +1.429299924838269e-02   -1.482645764562957e-03   -3.174924276623705e-03; +1.026067386197243e-02   -2.824974663519484e-04   +1.533955395604983e-02   +1.302969521902755e-02   +9.498563938154913e-03   -3.926536161709448e-03   -1.815449119279383e-03   +4.746985918893691e-04   +1.290050703504467e-02   +1.389884689715794e-02   +2.194093815530028e-03   +9.267678731856549e-03   +3.169245101538972e-03   +2.458955015891144e-03   +1.409333148957419e-02   +1.190904337365724e-02; -2.128265176296872e-03   +9.637524294135322e-03   +8.941647637556617e-03   +1.279154947585039e-02   -2.308736301815733e-03   +1.174506636120620e-02   +5.068573713027988e-03   +9.078950160303561e-03   +6.684945249169157e-03   +1.077462272499890e-02   +2.602487815821661e-03   +1.120829628097327e-02   +4.217171037459012e-03   +1.141232507948223e-02   -2.410008008311512e-03   +2.595763480450833e-03; +4.603422462630221e-03   +8.006305300482330e-03   +2.131476302159522e-02   +4.822920348059668e-03   +6.583324742291042e-03   +3.097355326532840e-03   +2.153586946098739e-03   -3.713324047576503e-03   +3.748664475243280e-03   +5.065401809026141e-05   +8.835063140590307e-03   +6.704359404224950e-03   +9.650403001327445e-03   +1.096610051443768e-02   +1.807051090040666e-02   +8.181033210333238e-03; +7.046895587142307e-03   +1.641507725981479e-03   +1.111414943469896e-02   +1.268406703354858e-02   +9.069125744634834e-03   +4.107109944134029e-03   +8.548382205018962e-03   +9.058223058402832e-03   +5.093634391422614e-03   +3.801158807324928e-03   +1.402389326015149e-02   +1.120050224890313e-02   +3.366379805856252e-03   +3.694438569704067e-03   +1.364328490807205e-02   +6.171277955403637e-03; +8.869208259045521e-03   -8.279324972470897e-04   +1.305650521312310e-04   +4.983525278044691e-03   +9.783861571885098e-03   +1.759536358633754e-02   +5.460626489095842e-03   +8.654194627781329e-03   +1.057602694781642e-02   +1.787633368678659e-03   -2.564445526374568e-03   -2.879403626166769e-03   +1.412624984577574e-02   +3.667728210977846e-03   +4.680374941663726e-03   +5.354670025977382e-03; +5.388630077665851e-03   +1.248674533801534e-02   +1.233844984921114e-02   +3.190856909257200e-03   +1.640106396102456e-02   +5.543073772179861e-03   +1.262820885429662e-02   +1.670096598379283e-02   +1.037333558696360e-02   +4.808796322273773e-03   -9.870550724508775e-04   +1.397544605049998e-02   +1.148460012712961e-02   +7.884744094369027e-03   +9.765487178879956e-03   +1.316547404626270e-02; +1.099622336685511e-02   +1.352469190128338e-02   +5.581882193594529e-03   +1.229982058176636e-02   -1.782168379145434e-03   +5.431035491901838e-03   -5.309903559774250e-04   +5.575330942895051e-03   -7.556810723259419e-04   +9.511488654115456e-03   +1.033122124513622e-03   +1.814681914096812e-02   +9.681846806522777e-03   +6.032875348289897e-03   -1.448185347920444e-03   +2.828310110524136e-03; -1.936270855502975e-03   +1.378591503327696e-02   +1.156699902407585e-02   +7.746334977877307e-03   +7.957990230929995e-03   +3.494716885150082e-03   +8.172577462361797e-04   +7.626075353734788e-03   -3.978785005399773e-04   +1.773385008374119e-02   +8.704231667928296e-03   +1.917917246322582e-03   +1.777607021488538e-03   +1.638556339939925e-02   -1.599382470214034e-03   +6.937815060111853e-03; +1.245173612829088e-02   +5.294092507819456e-03   -2.582212866767449e-03   +1.821317112660246e-02   +9.897849038777455e-04   -1.583000298787372e-03   +8.320914199043759e-03   -1.355078259016976e-03   -9.124262209478200e-06   +1.398983981395421e-02   +1.190054683123381e-02   +1.097282014745749e-03   +1.333548130229140e-02   +1.410252215251398e-02   +1.113378455999151e-02   +1.346168227525685e-02];
L1E_L1I_iGABA_netcon = [+9.748438879410326e-03   +1.102681061056226e-02   +1.964231412599836e-03   +8.712468994346384e-03   +1.383385489933270e-02   +8.088490379108833e-03   +6.058005990720022e-03   -3.430140281576487e-03   -4.655117698577203e-03   +1.099973291364929e-03   +5.091340971008320e-03   +4.419448412552022e-03   +4.231010223204916e-03   +1.895969500502424e-02   -5.569068875833390e-03   +5.459674960631211e-03; +5.013369689279081e-03   +8.733235341838518e-03   +1.001223946646286e-02   +1.190115970292091e-02   +4.365795822388389e-03   +4.571388225304082e-03   -9.323858843620240e-04   +1.517755506705671e-02   +1.431454663129302e-02   -5.024692707028352e-03   -2.886697978277190e-03   +9.446098765859671e-03   +3.405689836658902e-03   +9.330536716171288e-03   +7.247080932452847e-03   +1.088849227957472e-02; +7.027087968591120e-03   +1.444956881816247e-02   +1.244492151960844e-02   +4.529752461291088e-03   +8.607986878861544e-04   +7.302870363380552e-03   +1.068743081204008e-02   +7.535613979165181e-03   +1.204930738483011e-02   +1.499388017725754e-02   +8.443850783705655e-03   +8.270161608281253e-03   +1.353220953130680e-02   +1.037593532585428e-02   +4.588198756998203e-03   +6.721199530722793e-03; -1.641467238942467e-03   +5.233459248153370e-03   +1.617280096008608e-02   +7.479431281595482e-03   -4.975797027796978e-03   +1.060330849711775e-02   +1.022329761431583e-02   +1.260077101934220e-02   +7.718235122076776e-03   +1.016529695874575e-02   +1.147629453310943e-02   +2.884519962024460e-03   +5.802994260394044e-03   +4.324951693254525e-03   +6.697444341551300e-03   +1.181275970604856e-02; +5.411038998151314e-03   +1.579868129042752e-02   +7.742607343871423e-03   +3.587669978806394e-04   +6.735768551376973e-03   +1.632786397401017e-02   +9.331935160945473e-03   +9.592178323587733e-03   +1.723196226969313e-03   +8.213788135777469e-03   +8.323592805474532e-03   +7.628361492714292e-03   +2.232373759054248e-03   +3.730494141502391e-03   +5.913567441192813e-03   +4.657779519585507e-03; +1.100820847569991e-02   +7.560536185491857e-03   -7.304140559536441e-04   +1.501021957312793e-02   +1.962916170633263e-03   -2.022755020698075e-03   +1.519919880894607e-02   +2.756070582159867e-03   +1.382463784956487e-02   +6.041147601003978e-03   +9.069896501984493e-03   +4.650673257294229e-03   +4.107887131853224e-03   -4.058897830092126e-03   +9.412575436278754e-03   -3.761416718164629e-03; +9.154669837017390e-03   +4.214193039512956e-03   +2.123527336904136e-05   +5.272189039719715e-03   +3.200917212301732e-03   +9.038317329838948e-03   +8.213591154300977e-03   +4.064651310242143e-03   +1.400926219101580e-02   -3.178283218537725e-04   +1.610935476459662e-02   +1.534008605910869e-02   +1.643017187431916e-02   +1.020175289200822e-02   +4.223676262020653e-03   +7.970818935695116e-03; +5.030321100563994e-03   +2.153891103647733e-03   -4.211709038463660e-04   +1.751747674552858e-03   +5.146533084673013e-03   +8.275571571301633e-03   +1.362057214391793e-02   +6.578459905126064e-03   +1.129673726400932e-03   +7.518393739126969e-03   +5.609094927357462e-03   +1.689377950378325e-02   +6.898161164236252e-03   +9.000402867252523e-03   +7.421215127846102e-03   +8.410424961125963e-03; +6.874404315270245e-03   +3.198263961445296e-03   +2.995450844047988e-03   -1.753787368829864e-03   +3.813035968379373e-03   +1.273434245627555e-02   +1.459896722459448e-02   +1.617353548736548e-02   +7.074964067071494e-03   +4.103013764384425e-03   +1.348375901909944e-02   +1.762530760365762e-03   +1.498476274224515e-02   +1.798039162962310e-02   +5.206462528837016e-03   +6.526474933447232e-03; -2.113406137570844e-03   +1.585445980344284e-03   -2.736208488381885e-03   +9.068795536185337e-03   +6.100881371234913e-03   +1.274692277536508e-02   +2.763484620299513e-03   +6.239228663055433e-03   +1.684601697980336e-02   +1.463971484127157e-02   +1.635976349091889e-04   +1.460728321219874e-02   +1.576220613726712e-02   +8.801337980878789e-03   +1.024006878880073e-02   +4.407709487263175e-03; +1.662680868954044e-02   +1.788298892108358e-03   +3.797482506728375e-03   +5.186881788530036e-03   +1.259929523059396e-02   +5.425892864238659e-03   +6.401673264967150e-03   +1.570570990067049e-02   +1.022711278588788e-02   +4.783922288727873e-03   +9.873767598449570e-03   +8.616523934866853e-03   +7.340671914059255e-03   +1.761441513283053e-02   +1.123605605558063e-02   +2.849834487057102e-03; +8.328117650426960e-03   +1.334462449399217e-02   +8.474635039345800e-03   +1.122689899311296e-02   +1.330742800439900e-02   +5.028101770148780e-03   +4.478638720687903e-03   -2.550597197029734e-03   +7.293290743495476e-03   +4.805005745992691e-03   +9.359542837884279e-04   +1.519299651040947e-02   +6.737990547540556e-03   +1.279515314549124e-02   +9.256986909313291e-03   +4.076312675318504e-03; +1.468236722326892e-02   +5.982534925259811e-04   +1.204274324767042e-02   -2.518806367358285e-03   +4.629757522585609e-03   +1.104486009099968e-02   +7.754164339664197e-03   +4.525484422384174e-03   +1.473710266548513e-02   +8.680025299835224e-03   +6.470849238956135e-03   +1.240434442650583e-02   +1.494335724871235e-02   +8.590690108779655e-03   +2.821220080053755e-03   +1.499501661153608e-03; +5.458150681785231e-03   +2.439905820956123e-03   +2.855087953297921e-04   -6.231260858009720e-03   +3.620743004094741e-04   +1.183176842354157e-02   +1.803108888152581e-02   +1.013566355325881e-02   -2.451376128469589e-03   +9.405347213421528e-03   +9.725586282492924e-03   +9.580434408674385e-03   +6.899335673146123e-03   +1.995861190905934e-02   +1.266014474091138e-02   +7.990205313301638e-03; +1.000643066077305e-02   +2.818665230341694e-03   +7.708114866236968e-03   +1.275470005321809e-02   +6.402365865258951e-03   +4.385260502303930e-03   +5.759811146341988e-03   +3.197672250540484e-03   +6.223018254878383e-03   +9.366718803594050e-03   +5.038534329604565e-03   +9.291770831355278e-03   +1.497575241787386e-03   -2.430119526154415e-04   -1.191721379024773e-04   +7.808070242089506e-03; +4.756763050746875e-03   +5.600430032866471e-03   +5.454381547077850e-03   +1.113885529542375e-02   +1.405750456992205e-02   +6.737976273885346e-03   +5.065241275617853e-03   +1.490824540355244e-02   +1.310598065747237e-02   -4.182846269459642e-03   -1.115118131756662e-04   +8.267765488904172e-03   +1.264738562573805e-02   +9.247659776514670e-03   +7.138220260728568e-03   +9.961944523053649e-03];
L2I_L1I_iGABA_netcon = [+1.557418550736175e-02   +3.344625602718421e-03   +2.493989521248992e-03   +1.369623377602119e-02   +1.478797171932889e-02   +1.113132418873959e-02   +3.194823720816074e-04   +1.674755979940687e-02; +1.475794563992591e-02   +9.795493812675795e-03   +4.893803104597355e-03   +6.714407702589322e-03   +5.700232292300789e-03   +9.462714739490306e-03   +1.339416370370665e-02   -3.516000331055322e-03; +2.067445591877107e-03   +5.408298988012911e-03   -6.579544651244447e-04   +8.686421195815135e-03   +1.933777792322405e-02   +1.628738906880141e-02   +9.258798104724896e-03   +1.159662174334248e-02; +3.885915629527700e-03   +7.779178562223097e-03   +1.024496292671784e-02   +1.204872583857537e-02   +1.216842950407604e-02   +5.300497863698182e-03   +6.096394787679367e-03   +1.287849731549302e-02; +1.210802325356453e-02   +2.708762122197228e-04   +1.171388500118855e-02   +8.297353128790187e-03   +9.054619872965644e-03   +1.519604868105669e-02   +9.356168156769110e-03   +1.034350420044043e-02; +1.360225549988684e-02   +4.484478157534918e-03   +6.508371832618098e-03   +9.217084234460451e-03   +1.106084218038796e-02   +7.984989622721620e-03   -4.157033965068094e-03   +7.104979374976867e-03; -3.147962564410621e-03   +4.195113291546690e-03   +6.066799792343228e-03   +1.114611526194185e-02   +1.276531732632335e-02   -2.951925799898236e-03   +8.765826913818916e-03   +1.775848757624472e-02; +8.099286008307578e-03   +3.951424790729946e-03   +1.172778063097840e-02   +5.305289946149187e-03   +3.110261107035159e-03   +1.527858168801128e-02   +1.218702129393358e-02   -1.112244853441748e-03; +3.403387086904932e-03   +8.716946230706022e-03   +5.112178248606099e-03   +8.595097028660195e-03   +4.766849115129383e-03   +1.465212894483388e-03   +4.163118079955599e-03   +1.000456301960152e-02; +2.765845321010752e-03   +6.634055464406980e-03   -2.446259192339219e-03   +4.579332621108103e-03   +2.925144734223062e-03   +2.349580979236248e-03   +1.597714158181793e-02   +4.173335687907033e-03; +3.320580218339264e-03   +1.690679106025669e-02   +1.375342630144450e-02   +2.859938370825436e-03   +1.530042366030651e-02   +1.322605456934727e-02   +3.351973910597235e-03   +8.546430570782915e-03; +9.537608902693983e-03   +4.093173268346514e-03   +6.852394116460433e-03   +4.974431074649015e-03   +1.781229947393388e-02   +4.789814494564257e-03   +9.749460217085124e-03   +5.707259190941210e-03; -1.801532856483416e-03   +1.424578785052864e-02   +6.068084133097410e-03   -5.768052316135377e-04   +7.470324256616205e-03   +3.493753540980771e-03   +1.182365058882358e-02   +8.872203657997508e-03; +1.050566014805488e-02   +4.836585365541131e-04   +1.356224446215441e-02   +5.764827283806400e-03   +1.144209158017793e-02   +2.281599694215417e-03   +1.549172784179436e-02   +2.871522856869394e-03; +9.801011516029624e-03   +7.179737597620042e-03   -6.178520036937180e-04   +1.807470593965979e-02   +1.211979593655415e-02   +3.427694160346574e-03   +7.371180888633498e-03   +7.010653872804268e-03; -1.265425714822910e-03   +1.090904752951689e-02   +1.060599941512403e-02   +8.841819917419592e-03   +1.406089851691323e-02   -6.490236627156008e-03   +1.199380860374604e-02   +9.402724191923728e-03];
L1I_L2I_iGABA_netcon = [+1.377120902228828e-02   +1.669362482464302e-02   +1.703631282172332e-03   +2.634039693148976e-03   +3.508522905380355e-03   +1.075003791956163e-02   +1.337523987766072e-02   +1.372821623750942e-02   +1.221384058758110e-02   +1.396147517361479e-02   -4.873865721265075e-03   +1.243728441794671e-03   +2.667382774910422e-03   +1.637164568459427e-03   +5.036191989702204e-03   +1.860144460566671e-02; +1.512597662783374e-02   +1.176151633408438e-02   +4.881980217424855e-03   +8.470087909556421e-03   +1.013690757081728e-02   +9.953115165620396e-03   +1.155492239093642e-02   +1.464327781517280e-02   +8.315556526263184e-03   +1.679536505185516e-02   +9.288576208137712e-03   +5.104489483971150e-03   +2.798806191792627e-03   +5.564325791381062e-03   +2.833329113061804e-03   +1.442353128900952e-02; +5.927288411272055e-03   +8.601239151102001e-03   +2.201130209174825e-03   +9.629261923655897e-03   +2.892949404443543e-03   +1.141652519109398e-02   +4.218805602380423e-03   +1.189463169337674e-02   +5.780869261693273e-03   +1.120570436678989e-02   +1.103029177455887e-02   +1.380642231577184e-03   +8.201161579990485e-03   +3.199145414779281e-03   +8.221648425291581e-03   +4.614245627892842e-03; +4.096832975553951e-03   +3.395562296593755e-03   +1.115296653852122e-02   +1.472074129647560e-02   -4.115819885934058e-03   -2.098207168718735e-03   +6.549085812623214e-03   +6.512348152751767e-03   +6.927132112573707e-03   +6.157624347394826e-03   +7.629069345966057e-03   +2.079574533475230e-03   +2.830590516891162e-03   -8.419386920409802e-04   +9.773422185982799e-03   +8.784922039917159e-03; +6.633070938737319e-04   +1.773349762115282e-02   +1.443842728567180e-02   +9.370606769618570e-03   +8.946884434295003e-03   +1.074095569420695e-02   +1.207900748262201e-02   +2.153734417723330e-02   +4.157253925761893e-03   +1.617982223995701e-03   +5.971007376091706e-03   +4.046643718962994e-03   +6.983585372252328e-03   +1.260222722646723e-02   +7.419874590423925e-03   +7.929815836139605e-03; +7.654821278023427e-03   +9.295709526486524e-03   -1.587493782015819e-04   +1.322120686684866e-02   +7.844642111752852e-03   +1.358916518730353e-02   +1.639468475868357e-02   +1.309166784954187e-02   +1.303703010359282e-02   +8.978957356231668e-03   +1.311753962099323e-02   +1.146340837237282e-02   +2.244934193467484e-03   +1.361431222753027e-02   +1.800561294608792e-02   +1.381459596723967e-02; +1.028723736611144e-02   +1.432730154815198e-03   +1.038378430971283e-02   +1.562660492077511e-02   +1.099465381452025e-02   +1.723287254440511e-02   +1.054324332059961e-02   +3.058402953444629e-03   -5.815382057273533e-03   +9.676001773580257e-03   +4.713079466640934e-03   +1.865306597943070e-03   +1.716024459922366e-02   +6.434475120818951e-03   +1.193544294458783e-02   +8.361345073732988e-03; +1.122078241196241e-02   +5.936763770759746e-04   +7.985633282704931e-03   +8.539193053061339e-03   -1.748278845878658e-03   +7.902703509719999e-03   +9.699591782734501e-03   +1.371717700030153e-02   +5.757496495010337e-03   +9.244194684331342e-03   +5.970492138309726e-03   +6.790940201637252e-03   +3.190933768451578e-03   +2.783184104793064e-03   +1.196829517081451e-02   +8.384533122030441e-03];
L2E_L1E_iAMPA_netcon = [+9.952758801101079e-03   +2.773667416657544e-03   +1.365855085087592e-03   +1.193178296989398e-02   -3.334316060939800e-03   -1.180138984557640e-03   +8.997679753960026e-03   +5.140873940654866e-03; +1.104417525670231e-02   +9.074904578689083e-03   +6.839955561132295e-03   +5.022111393349948e-03   +1.318561724251592e-02   +7.681458655793267e-03   +1.056156634013546e-02   +5.674136960329854e-03; -5.787360714701139e-04   -2.163195558927211e-03   +2.635722740368048e-03   +1.109645827711707e-02   +4.437567810904702e-03   +1.501170455985905e-02   +2.467949253764189e-03   +1.051449089289198e-02; -7.764817690986525e-04   +1.149740309593537e-02   +1.100592092972224e-03   +1.764154561125145e-02   +1.677303630564267e-02   +8.042627611963716e-03   +1.480723757946238e-02   +1.319326938167981e-02; +3.176855797156925e-03   +1.731069014090921e-02   +3.703927674776425e-03   -2.494209569495565e-03   +1.024613474278274e-02   +1.565403248734616e-02   +1.499846640078577e-02   +5.593015574981076e-03; +8.650040729199298e-03   +5.220581556077438e-03   +1.946337181885886e-02   +1.174457756236442e-02   +8.350944923500912e-03   +1.264287190028165e-03   +1.130202273585836e-02   +7.876378913712536e-03; +3.540162279211433e-03   +6.730748678069049e-03   -2.240478768766052e-04   +5.162767956542377e-03   +1.231826149164602e-02   +8.607235836579264e-03   +2.774373807236588e-03   +7.866081997480368e-03; +3.972834390675883e-03   -5.590177131176839e-03   +4.352276915838445e-03   +1.459564860427824e-02   +8.170394527973015e-03   +1.365831691005492e-02   +1.162324020196090e-02   +1.366155352591857e-02; +3.757911116054853e-03   +1.626517340413074e-02   +3.870991328792976e-03   +5.110119968876316e-04   +5.678468885403256e-04   +1.655771419326805e-02   +8.580666907939283e-03   +8.732377266288387e-03; +7.136281233732024e-03   +3.387426815050651e-03   +1.518621271150737e-02   +8.244295236359596e-03   +1.892642911389100e-02   +4.560616561864645e-03   -9.108716979277780e-04   +5.777332299276999e-03; +1.594907044667316e-02   +1.042989809436250e-02   -1.719777215891817e-03   +7.033593524536135e-03   +1.237891708873100e-02   +3.509962711990461e-03   +1.355871938584851e-02   +1.697211316008175e-02; +7.445944375991591e-04   +8.493383085481716e-03   +1.182399861594512e-02   +8.957979397558602e-03   +8.577120996650771e-03   -2.026444256486719e-03   +1.293544534652308e-02   +3.156116965194924e-03; +3.868333379663160e-03   +8.789651226738766e-03   -1.494383330783370e-03   +8.229427411078330e-04   +1.750024027074770e-02   +9.896555853480945e-04   +1.095419384492062e-02   +9.262017100194054e-03; +3.405775159050108e-03   +2.792913346158566e-03   +3.297806744747178e-03   +9.135435078045985e-03   +4.271033701472803e-03   +3.213259526193724e-03   +3.617356798941424e-03   +1.584398673406505e-02; +8.239463257568217e-03   +7.845637011111045e-03   +4.037227875269686e-03   +1.675847999861194e-02   +1.482626383391763e-03   -1.327487871857741e-03   +1.039843704877888e-02   +1.340735438154019e-04; +1.223059878671327e-02   +6.549563378954387e-03   -1.559066285552564e-03   +6.231451918497350e-03   -4.131923686761110e-03   +5.263561555994544e-03   +3.992239558084289e-03   +1.167886962377730e-02];
L1E_L2E_iAMPA_netcon = [-8.468411603504600e-04   -2.521996969920177e-03   +1.166786969590681e-02   +1.470191905175586e-02   +1.250921475483813e-02   +1.454321549219475e-02   +9.861502065921198e-03   +1.508218699466524e-02   +3.049390725142548e-03   +2.855423174989225e-03   +1.045650954251722e-02   +3.770914584861325e-03   +4.510482767906184e-03   +1.278701989151032e-02   +1.035085801436912e-02   +1.256096012685487e-02; +2.035201564834028e-03   +7.892289998876076e-03   +2.358878658088900e-03   +3.754545985155236e-03   +1.859801192367391e-03   +1.660414083557706e-02   -3.366502874844843e-03   +3.728109172945063e-03   -2.618555837136929e-04   +2.991524893887223e-03   +7.143165755603611e-03   +1.017635696278060e-02   +9.231822702874797e-04   -6.174462841497411e-05   +6.085759041344242e-03   +5.413986561553017e-03; +2.611589510809506e-03   +1.195499536912687e-02   +1.554757488698811e-02   +1.859855141718537e-02   +1.513859473407273e-02   +3.129271483656410e-03   +1.100934995896827e-02   -4.557591683965316e-03   +6.076245666336228e-03   +5.922060025848637e-03   +4.947261624768533e-03   +2.207913370008084e-03   +7.760865960257396e-03   +5.151629375469090e-03   +1.524006178588113e-02   -2.876337680452089e-03; +1.198781703270434e-02   -4.306760664814807e-03   -1.053473935602442e-04   +2.033477015510609e-03   +1.076877142758226e-02   +4.606295564540595e-03   +1.394296668832383e-02   +8.491992712629081e-03   +1.197525621694605e-02   +1.049832379731435e-02   +3.275647867269855e-04   +1.100681158707160e-02   +1.518188836948134e-02   -1.351030235995898e-03   +1.905232796230922e-02   +1.412903488056748e-02; +5.941008776945227e-03   +1.447374083642904e-02   +7.897144736572406e-03   +1.730963818476274e-03   +2.373324573437449e-04   +1.197167159297450e-02   +1.142886368634304e-02   +3.506208102846792e-03   +6.215736939992213e-03   +2.969010978220939e-03   +5.729756387281518e-03   +1.200045399947116e-02   +6.852471522414322e-03   +1.023494350352601e-02   +1.945282841228237e-02   -2.466986085303126e-03; +2.810841813912838e-03   +1.380510020702498e-02   -2.282480152315552e-03   +1.747343779813713e-02   +1.654635563724440e-02   +1.706508411628532e-02   +5.526478314520603e-03   +8.050018344522437e-03   +4.630525351292616e-03   +6.888990514725465e-03   +6.283466525084970e-03   +1.700133570143094e-02   +1.403359129603000e-02   +8.596665171711050e-03   -2.043834081413688e-03   +1.267489021111528e-02; +5.293710650412355e-03   +3.769915923713110e-03   +1.592756603081828e-02   +6.331408511008994e-03   +5.853236093087151e-03   +8.229900119834604e-03   +6.897437651678217e-03   +1.392854970158986e-02   +8.920641477134257e-03   +1.465371943680174e-02   +6.790136926428975e-03   -5.528186497963269e-03   +6.391732491165173e-03   +1.139067926701198e-02   +4.289024660416934e-05   +5.265659952839317e-03; -1.205431084055306e-03   +8.368514534076821e-03   +7.641065144742637e-03   +5.179800540618336e-03   +4.607247935238627e-03   +1.712040005636061e-02   +1.017605572616573e-02   +1.139356565112512e-02   +1.553278057638200e-02   +5.628100404097784e-03   +5.837666755825130e-04   +1.797770099753353e-02   +1.630249294121289e-02   +7.291304491810070e-03   +4.674528877929451e-03   +1.032404979164739e-04];
L2I_L2E_iAMPA_netcon = [+9.992333297279950e-03   +9.284805578928091e-03   +1.465654343916283e-02   +6.698841433067981e-03   +1.497917936011896e-02   +4.009497994609068e-03   +5.156380205268402e-03   +9.261082939181335e-03; +1.853292243094143e-04   +8.654037880187590e-04   +1.058641154126735e-02   +1.460978427227787e-02   +9.930015210730170e-03   +7.436411327844999e-03   +8.304657910252759e-03   +1.226407042535172e-02; +1.298239384648356e-02   +1.020756985741153e-02   +1.211768483282264e-02   +1.102404656936362e-02   +5.951711080577606e-03   +9.361444319767565e-03   +1.189438650085223e-02   +1.060610637437113e-02; -1.007738737624998e-03   +1.271011305582468e-03   +1.420201411042671e-02   +9.296541944608062e-03   +1.637305836712841e-02   +3.415493790686676e-03   -2.157291449262738e-03   +1.742664337701736e-02; +7.284452949890411e-03   +9.299697516747630e-03   +4.287840144717323e-03   +2.644421716192885e-03   +9.488911138829681e-03   +1.089844189847299e-02   +4.564305156151131e-03   +7.053165576728818e-03; +1.261942056705198e-02   +5.312100684787519e-03   +1.031417390768069e-02   +9.878144204599754e-03   +4.855546337984613e-03   +4.393048429716663e-03   -3.571422484084858e-03   +1.368299785717273e-02; +1.531139843206844e-02   +6.128995501828324e-03   -4.395330751522580e-03   +1.080946513034962e-03   -2.648709508700550e-03   +8.865242250885686e-03   +7.321632288421066e-04   +6.354679209050243e-03; +1.252431483055164e-02   -1.386991089556931e-03   -9.376780182593185e-04   +5.658259775759803e-03   +1.645757304646454e-02   +2.499208762421107e-03   +5.249446688792622e-03   +5.999855188868079e-03];
L2E_L2I_iGABA_netcon = [+1.281970119760829e-02   -9.553887300079081e-04   +4.298649157330135e-03   +4.898784866965681e-03   +1.374050693242294e-02   +6.610571584374941e-03   +3.974202563179384e-03   +1.596053052427181e-02; +1.981129410218192e-03   +1.092122250924695e-02   +5.968984607812410e-03   -2.140021221269966e-04   +1.558697988322248e-02   +1.109325328403044e-02   +1.387654727557015e-02   +2.844346856924612e-03; +3.088106389118075e-03   +4.948263405823632e-04   +5.701460205455827e-03   +6.042798184278592e-03   +7.730678631526001e-03   -4.333649458282020e-03   +1.186900461288774e-02   +8.502905564246429e-03; +8.818510160214095e-03   +2.181228127484259e-03   -1.682603457654825e-03   +1.285368628651788e-02   +1.051045560297587e-02   +1.371611037877298e-02   +1.251105929933694e-02   +7.836242737333129e-03; +8.030126043546829e-04   +1.000429034085516e-02   +9.663348946747729e-03   +9.542668336172438e-03   +6.304673328783345e-03   +3.007144373075060e-03   +5.214640212217090e-03   -8.115793275546798e-04; +9.430787167841122e-03   -2.417591152084209e-03   +7.709063143396912e-03   +1.122586260972237e-02   +1.228831902468799e-02   +4.901947753269239e-03   +1.738792622340111e-02   +8.856815918954881e-03; +2.750244507568914e-04   +2.119665307592809e-02   +1.108008044893699e-03   -8.664641569308403e-03   +1.061627815175076e-02   +4.715506396732683e-03   +6.543819772590330e-03   +5.797282345904679e-03; +1.619021573909436e-02   +1.726478253556693e-03   +8.349198958553199e-03   -1.431343220770432e-03   +4.077270484737776e-03   +1.248944243865501e-02   +1.309354224016158e-02   +1.469123396162388e-02];
L3E_L2E_iAMPA_netcon = [+6.504693195783525e-03   +1.320316335651699e-02   +4.446280716620821e-03   -7.130414255538771e-04   -8.782700658470845e-03   +1.221404831883345e-02   +3.989169216516991e-03   +1.501634181950160e-02   +6.845780952071821e-04   +5.631766417144855e-03   +3.946349462322193e-03   -1.776993761051287e-03; +5.442734423453286e-03   +1.577584194224932e-02   +2.727937229005445e-03   +8.769991057728254e-03   +7.201989650503704e-03   +6.305136797137592e-03   +1.317850108161146e-02   +1.841511518635904e-02   +1.394928035579373e-02   +1.769195197683784e-02   +1.033912961372283e-02   +1.420065853147392e-03; +4.591131346128307e-04   +1.173492928857581e-02   +8.036205733959328e-04   +1.344796365657615e-02   -1.178541146809606e-03   -3.909431287909886e-03   +9.984707553442843e-03   +2.020970184253027e-02   +8.752024488623712e-03   +8.574158830970659e-03   +9.506505970068926e-03   +1.235488804103961e-02; +1.593305600851686e-03   +2.677035606387540e-03   +1.127419546748788e-02   +1.288806403148845e-02   +5.887173672966942e-03   -6.900136716130240e-05   +7.958429146330326e-03   -1.391367667652849e-03   +3.828809798251225e-03   +1.084023853568259e-02   +3.369749704081191e-03   +6.907374391682358e-03; +1.606201853678684e-02   +3.814934959349829e-03   +3.528554337773319e-03   +1.805794326679263e-02   +7.524310831775998e-03   +4.213271621582949e-03   +1.693370620304948e-02   +5.243761063924138e-04   +6.172025971410789e-03   +1.798747345137797e-02   +8.361175027371054e-03   +5.453035715829231e-03; +1.555685983524261e-02   +4.962266908693648e-03   +3.689414910059733e-03   +4.944180598214429e-03   +4.416361195403322e-03   +1.794220701882779e-02   +1.736893918477248e-02   +8.958951700971374e-03   +4.197819446172335e-03   -6.945942422559644e-04   +1.696991738967025e-02   +2.872952528293332e-03; +1.023543703509956e-02   +5.308378999238836e-03   +1.284512930239087e-02   +6.105697416599385e-03   -2.663836001198092e-03   +4.072984959717333e-03   +6.727720227303390e-03   +8.548400496369603e-03   +1.770529831352711e-03   +2.541795945386014e-03   -5.306013965911721e-04   +6.781190387932216e-03; +1.336740461543875e-02   -9.572083679673610e-04   +1.578803180404171e-04   +5.711328573082913e-03   +6.035908274854548e-03   +3.419713763725554e-03   +1.140945677192445e-03   +3.321672361821771e-03   +3.984112849440363e-03   +1.384638651339373e-02   +6.044222148494285e-04   +6.421215155893915e-03];
L3I_L2I_iGABA_netcon = [+1.057816576150783e-02   +7.859161009845657e-03   +1.331224432706975e-02   +8.789110323859563e-03   +1.439953545200051e-02   +1.084853223497833e-02   +3.711647395852061e-03   -2.853726744141467e-03   +1.570426988548279e-02   +1.249968717412678e-02   -2.488232024892439e-03   +1.792405167760825e-02; +1.114020043556821e-02   +1.379785455794146e-02   +1.612573717232701e-02   +1.867233662819212e-03   +5.512630618975406e-03   +1.348511038064064e-02   +1.872152139622262e-04   +7.305977513344994e-04   +9.174223903128201e-03   +8.762211355565460e-03   -3.749760614186706e-03   +4.196092968579760e-03; -2.382491526932708e-03   +6.845640638504486e-03   +1.111795725592341e-02   -2.985946825868835e-03   +1.004066139165160e-02   -1.751036649709412e-03   +1.041007601588863e-02   +1.380932898845263e-02   +1.193709211283512e-02   -5.412119481665955e-03   +6.910652122370822e-03   +2.145961504006362e-04; +1.704241662439466e-02   +2.711962326464908e-03   -3.646129140331771e-03   +9.437217336847154e-03   +1.450687622332920e-02   +1.006851365429745e-02   -5.269871848258571e-03   +5.673203126551546e-03   +1.448013780415996e-02   +4.091211538644589e-03   +1.323395317151092e-02   +1.337846892905322e-02; +7.514314966184936e-03   +1.813659149446298e-02   -2.596390816273624e-03   +2.622753139070844e-03   +4.794894019910995e-03   +1.173385958469110e-02   +8.323689322320908e-04   -2.987695232646643e-03   +1.531404624613119e-02   +1.286126796560047e-02   -3.897983289788964e-03   +4.669259320088610e-03; -6.765195262308257e-04   +1.149712913432972e-02   +6.286687664711186e-03   +2.002700124977642e-03   +5.903139482048095e-03   +7.441840486790086e-03   +1.095435826359584e-02   +5.701785081723688e-03   -1.508063947964027e-03   +7.402044791078769e-03   +5.632891890811920e-03   +1.064752164086172e-03; +1.335474191002435e-02   +1.020081290666300e-02   +7.186472468785315e-03   +1.425117674685782e-02   +8.648229855067821e-03   +3.132414077473679e-03   +4.538869477398472e-03   +3.752482799378951e-03   +1.094441470631599e-02   +9.190793245134807e-03   +5.226157336091158e-03   +3.544973547885901e-03; +4.101392096248949e-03   +2.143421956976773e-03   +8.635564142216964e-03   +8.264409534267266e-03   +3.988127120744309e-03   +1.036679231043601e-03   +1.969029389020687e-03   +4.657801538756300e-03   +1.319635138737480e-02   +7.951482176768235e-03   +3.097551313519421e-03   +8.092127604364785e-03];
L2E_L3E_iAMPA_netcon = [+1.132081190708627e-02   +1.168233103891702e-02   +1.057614457808784e-02   +9.855643855803453e-03   +1.505124600628736e-03   +7.401597317244924e-03   +1.418761648515002e-02   +1.564680563202223e-02; +6.613394228072451e-03   +1.165498988662782e-02   +1.455679680267505e-02   +7.263531848649568e-03   +6.964212052852890e-03   +9.265710385790969e-03   +1.519151220718969e-02   +9.313496561889019e-03; +1.436545172259627e-02   +1.288794866340832e-02   +1.875042388791898e-02   +1.391464871040504e-02   +9.303655465392449e-03   +1.498885640712659e-02   +8.624629018085712e-03   +1.206010515216430e-02; +3.960591087493314e-03   +1.302086328335883e-02   +8.206069362601378e-03   -8.246891224578568e-04   +7.106245778086675e-03   +9.366072057363057e-03   -2.807694594979360e-04   +2.832335999585548e-03; +6.912441184457084e-03   +1.056819624138607e-02   +2.762982309478934e-03   +1.814086550836840e-03   -7.161518043676668e-05   +5.229599616640350e-03   +1.181532287093612e-02   +1.026184382666385e-02; +1.115478338232046e-02   +1.608277964623465e-02   +1.213409676099233e-02   +3.832310501013757e-03   +1.155262965253704e-02   +2.060845877728194e-02   +5.998969565607956e-03   +1.274147571881237e-02; +2.822079915425594e-03   +2.484713157028983e-03   +9.877845742063707e-03   +1.757067009636260e-04   +7.182114998670871e-03   +1.359751686852730e-02   +6.138016867789713e-04   +6.682690856399526e-03; +1.592950029810173e-02   +1.139451399509551e-02   +1.393667402644324e-02   +1.487081638593530e-02   +7.034492675682381e-03   +1.778415871474478e-02   +1.005908427311250e-02   +4.392293320423717e-03; +5.271517544884475e-03   +5.854086580302843e-03   +1.562256039971464e-02   +1.175456724167141e-02   +1.211160113231980e-02   +8.268945442436455e-03   +1.345462994935259e-02   +9.239229746886691e-03; -2.097962494468355e-03   +7.535978028982837e-03   +1.034052737275647e-02   +1.198614416895517e-02   +1.598587254136499e-02   +1.157528756420513e-03   +3.105230305610463e-04   +1.218682023351203e-02; +1.172658956565288e-02   +3.763134251913646e-03   +1.053890493705689e-02   +8.248958955177525e-03   +1.837093871141870e-02   +1.213495730816112e-02   +4.493202489572549e-03   +1.566082326379378e-03; +2.799090447128511e-03   +9.859833901118073e-03   +4.591684178378396e-03   +1.190051455704709e-02   +8.617754604314343e-03   +9.108419349258981e-04   +1.476511511239866e-02   +1.629192566249706e-02];
L2I_L3I_iGABA_netcon = [+1.818248307570669e-02   +6.249222836086317e-03   +1.906893141210762e-03   +5.711282040875273e-03   +1.045983023238697e-02   +1.626924834434769e-02   -4.232588032401708e-03   +7.446236724183573e-03; +7.351455828613234e-03   +1.191651678587533e-02   +1.617407248496813e-02   -1.527732069361987e-03   +1.134355857423524e-02   +1.281660333065906e-02   +8.728005353278973e-03   +6.145322906893754e-03; +1.052778778953932e-02   +9.977231857693320e-03   +9.283274079963356e-03   +8.740284859847538e-03   +5.089200081283466e-03   +8.202249501884071e-03   +4.760948578253352e-03   +3.557446867844863e-03; -9.817954910799744e-04   +1.146579923349266e-02   -3.603230044718892e-03   +1.307893874987682e-03   +1.398795954630563e-03   +1.313437343647083e-03   +7.247003519571954e-03   +1.106449334641818e-02; +3.176855257722714e-03   +6.500627559478826e-03   +2.248110355267849e-03   +4.363494142664875e-03   +8.377245069455076e-03   +2.150320264480972e-03   +2.217673852475586e-03   +4.275922783966261e-03; -8.673887981745036e-04   -4.566923365405932e-03   +9.832237833298278e-03   +7.096126881946818e-03   +5.151487715185540e-03   +6.708460510447259e-03   +1.145931940163889e-02   +1.127114623499811e-02; +1.426845277707102e-03   +1.106647625199441e-02   +1.130378056618773e-02   +1.214142719851654e-02   +9.963465571778846e-03   -1.259162017913516e-04   +4.922014444780786e-03   +1.048788393283948e-02; -5.226100245512603e-03   +2.000012495942308e-02   -2.683793044426441e-03   +5.537660797173700e-03   +4.768403248191746e-03   +1.326932562553470e-02   +9.793567326711177e-03   +8.478918700670588e-03; +1.090217564405213e-02   +1.160107376293215e-02   +1.694899804263457e-02   +5.188447656106417e-03   +6.527845453364813e-03   +1.472089148450236e-03   +2.158135431392783e-03   +9.829473019487401e-03; +1.195720018765383e-02   +1.187268388384908e-02   -2.626953914362084e-03   +5.946772360263405e-03   +1.858179646757503e-03   -3.310358222346627e-03   +5.705687764287751e-03   +5.408896180933371e-03; +1.373096808380452e-02   +1.819837691922871e-02   +1.497852110924976e-03   +5.541740311949758e-03   +5.010126983033430e-03   +4.371437016552780e-03   +1.201848507074376e-02   -2.426342814233034e-03; +1.361947084017098e-02   -3.489748926507553e-03   -7.152935099098832e-04   +5.350832374239288e-03   +7.155576263108595e-04   +1.222260877544773e-02   +1.101225376655368e-02   +6.196484365660579e-03];
L3I_L3E_iAMPA_netcon = [+8.200829759258583e-03   +1.378478649743474e-02   +8.471987481273927e-03   +9.779613325153640e-03   +1.451226299432857e-02   +6.241836343570304e-03   +8.264754198723663e-03   -3.473793692642973e-04   +1.056168652501207e-02   +2.499743044706980e-03   +5.517428084510312e-03   +4.126525129512020e-03; +7.403870799871483e-03   +7.499739042763684e-03   +1.949287841545997e-03   +6.006118851459481e-03   -4.067675646121841e-03   +1.070642715942551e-02   +8.993803290301229e-03   +5.697342637937035e-03   +5.301428480822564e-03   +8.524023995768956e-03   +1.688110858509262e-02   +1.023399266875253e-02; +4.637149335677105e-03   +1.231207743244662e-02   +3.407191485104320e-03   +1.451230300702586e-02   +5.918059328042546e-03   +6.926206279571955e-03   +6.894345546714127e-03   +1.612296225511115e-03   +1.044035626616089e-02   +8.164206802175203e-03   +7.190742695032642e-03   +1.553693960772287e-02; +1.047450413874984e-02   +1.334343534819882e-02   +5.590569738278732e-03   +3.391864238463916e-03   +7.976859852412817e-03   +1.135306404462310e-02   +1.578886495299191e-02   +4.898880710057896e-03   +1.164648787571296e-02   +1.698955677694574e-02   +9.670790811035687e-03   +1.322711918433358e-02; +3.199124332653101e-03   +7.569813293985643e-03   +5.068547186903078e-03   +1.096978302384389e-02   +9.158035445999496e-03   +4.540770609932788e-03   +1.416411752704478e-02   -1.932805551511828e-03   +6.804728872080111e-03   +2.882961837824190e-03   +5.259173975077155e-03   +8.153518245415227e-03; -2.922747404377951e-03   +5.023326073930814e-03   +1.639351304163663e-02   +1.098862002370799e-02   +1.367166605384922e-02   +7.780958197548830e-03   +1.539363854712350e-02   +2.146675900294806e-03   +1.026552990826419e-02   +1.196063496023509e-03   -3.017149232554156e-03   +4.509691945982562e-03; +1.095213997992925e-02   +2.003632188683823e-03   +9.082717490696206e-03   +4.685277808402517e-03   +7.644567899026861e-03   +1.844514542435120e-03   +5.355013876139581e-03   +1.311158484838792e-02   +1.084339813535387e-02   +1.443499775528459e-02   +5.623571664960005e-03   +9.243232615672978e-03; +9.816933717717840e-03   +1.096719060050682e-03   +1.420786795965079e-02   +5.524862088104743e-03   +1.570850685165852e-02   +6.774418134326757e-03   -9.596548319317821e-04   +5.844673132292410e-03   +2.286577279577181e-03   +3.625899881225101e-03   +4.187682024787888e-03   +1.328018459989265e-02; +3.700595173401122e-03   +1.094920970960337e-02   +6.478486473615350e-03   +8.064354100869435e-03   +8.314741567643561e-03   +1.283769293646444e-02   -3.611944547108138e-03   +1.355556599875992e-02   +1.157639789978530e-02   +1.054572272630708e-02   +8.549340243930796e-03   -7.223651837854469e-04; +1.377975536103562e-02   +8.840729412108513e-03   +1.421796213856250e-02   +9.879573266196538e-03   +1.193101454112025e-02   +1.195281142925857e-02   +1.960848926543980e-03   +1.988109077268508e-02   +8.924497348637265e-03   +5.134955045610106e-03   +9.109573204851623e-03   +3.664862825276683e-03; +8.575548642102117e-03   +5.305913521589450e-03   +1.510296654476055e-02   +1.793200406413366e-02   -5.550070452299485e-03   +1.277837830137389e-02   +1.444441985939679e-03   +5.714433292676476e-03   +2.208001433288067e-03   +1.189987289596959e-02   +4.245545920465632e-03   +2.535220513975659e-03; +1.656629190626140e-03   +4.123854440932126e-03   +2.350859437487976e-03   +1.300548309198513e-02   +5.425397727430992e-03   +9.540225315996234e-04   +1.748172709316143e-02   -5.308622031855995e-04   +1.609326441562546e-03   +1.463053455296403e-03   +1.497698789124472e-02   +3.499907467604658e-03];
L3E_L3I_iGABA_netcon = [-1.371570835986829e-03   +8.472386127561836e-03   +4.512171958674081e-03   +1.673236951846669e-02   +1.021279233435188e-02   +1.516806808015688e-02   +6.088293130288174e-03   +7.788292931484805e-03   +8.104545215644302e-03   +1.269648004801484e-02   +6.191675158680037e-03   +1.130539330199783e-03; +7.704125757441369e-03   +1.133914866142963e-02   +4.789696173696227e-03   +3.588579726095918e-03   +5.602292296814970e-03   +1.195557641290465e-02   +8.986565603413720e-03   +1.129283915493170e-02   +1.198927379242314e-02   +8.846084908239547e-03   +4.391396867820407e-03   +1.912167800251027e-03; -8.591352703921583e-04   +1.024606789334502e-02   +8.089098802198887e-03   +9.768228289659023e-03   -1.664955263713498e-03   +1.457317665329370e-02   +9.407694065735618e-03   +1.303595989789250e-02   +7.930664638415423e-03   +6.490231593856845e-03   +8.049374886747097e-03   +2.744637297619550e-04; -1.246618384242711e-03   -1.162378187650857e-03   +4.258408080647286e-04   +1.271746432964065e-02   +9.593751128517661e-03   +6.408996102416385e-03   -9.204630080044603e-04   +3.916489893257353e-03   +9.409350968430862e-03   +5.758462579375319e-04   -4.294584589894239e-03   +1.055828567904136e-02; +3.760231379691728e-04   +1.089353425690156e-02   +1.817883553929931e-02   +5.839746939980238e-03   +7.263664877476952e-03   +1.054630305288623e-02   +1.631519447402252e-02   +1.398442015381937e-02   +4.837127246288947e-03   +1.160839160663275e-02   +1.450204100287002e-02   +6.203334234704504e-03; +1.265860339714421e-02   +6.742895532928659e-03   +1.546921264107551e-02   +7.930940968521451e-03   +3.816882804303135e-04   +1.958990123382750e-02   -3.575052491294736e-04   -4.262674681242145e-03   +9.834433954326795e-03   +1.162725851519899e-02   +3.111761273139372e-03   -1.539868119903329e-03; +6.999552811990238e-03   +1.003639575654041e-02   +3.958276009321956e-03   +1.144478155990972e-02   +1.005736799497343e-02   +8.358142908286542e-03   +3.321345026594295e-03   -1.193432336223033e-03   +1.148721609436277e-02   -2.052890265625239e-03   -9.653955580542900e-05   +9.269031438949974e-03; +1.945740484200132e-03   +2.005653940987203e-03   +9.570939590783638e-03   +1.526247639366936e-02   +5.570204475510878e-03   +1.284206863642614e-02   +7.977214076954819e-03   +1.041664907100698e-02   +1.265466790164333e-02   +1.424324069471248e-02   +2.982282354779188e-03   +1.340236705504003e-02; +3.253843877245963e-03   +1.934708083844819e-03   +1.445847452746633e-02   +2.003110158263949e-03   +1.269859922502312e-02   +1.232974592284547e-02   +5.541715946537203e-03   +1.945057039782781e-02   +1.132135397458043e-03   +2.013391985553630e-03   +6.695514277194755e-03   +1.014436528946642e-02; +1.520719507016693e-02   +4.731386837314847e-03   +1.600588059003034e-02   +1.489688646141777e-03   -8.586536342201259e-04   +1.805610187661940e-02   +1.028944249633255e-02   +3.039044715554767e-03   +1.365727000523400e-02   +1.399738271581013e-02   +4.770050586660440e-03   +5.395231006357865e-04; +5.522235274782026e-03   +4.751171821923277e-03   +2.550676226501265e-03   +2.079393694159218e-03   +1.153306054813231e-02   +6.423229363850205e-03   +1.604002534991853e-02   +1.086594483364759e-02   +1.096197220840514e-02   +5.748812977213672e-03   -5.227965800338000e-03   +1.166688599052499e-02; +8.698205995495747e-03   +6.095703330895750e-03   +1.271730142932793e-02   +6.572724733539446e-03   +7.125993425966157e-04   +5.489947063207310e-03   +1.320957242655121e-02   -5.200814905416106e-03   +1.912389405358895e-02   +8.006168215958514e-03   +6.596346636399347e-03   +5.008637058811838e-03];
L2E_Input1_iAMPA_netcon = [+1.235576947875037e-02   +1.298525954642685e-02   +9.871292310859169e-03   +1.807685741225323e-02   +2.048270263375593e-02   +1.775718069240460e-02   +1.186630969924108e-02   +5.614726208843285e-03];
L2I_Input2_iAMPA_netcon = [+7.618284167870682e-03   +1.961382716228987e-02   +1.716822651009480e-02   +1.194512680020552e-02   +1.144012123707859e-02   +1.530853904780846e-02   +1.661981018573403e-02   +1.468813913288147e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
