function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.247893174361386e-01   -3.462414744879975e-01   -3.684849884105167e-01   -9.984639671438807e-02   +1.777169681845105e-01   +3.185740369330514e-01   +6.463796907986901e-01   +1.106622923557843e-01   +6.073050322764122e-01   +6.160393218613326e-01   +4.208350506001659e-03   -1.704950899747245e-01   +2.266384929833911e-01   -1.446856748096707e-01   -1.505829403370147e-01   -3.276404519159086e-01; -2.083212820434520e-01   +7.908583979566490e-01   +1.156439865889546e-01   +3.299963313180537e-01   +3.382707526420465e-01   -3.193612439900440e-01   -2.367866013348580e-02   -1.174949413165893e-01   -3.562880221506383e-01   -3.447043983621535e-02   -1.097907831426733e-01   -6.269418855752614e-01   +1.578917480134148e-01   +1.173520062647211e-02   +7.084080504202250e-01   -4.943464839554697e-03; -1.760214774685764e-03   +6.925092249482748e-01   -4.292473193626835e-01   +1.311749748934075e-01   -8.006205771669649e-02   -3.385068712489470e-02   -6.200536698167743e-01   +1.067786316770505e-01   +6.344831018548261e-01   -1.316478532075867e-01   -1.392314174009313e-01   +6.345087380680157e-01   +1.559834050751779e-01   +4.406984577311870e-01   -1.545513912973481e-01   -2.754024864276148e-01; +6.304315030092152e-01   +5.895248102369373e-01   +4.157573496677733e-02   +1.439153473325921e-01   +1.747804794767187e-01   -3.681267435915728e-01   +2.130264944396515e-01   -5.009267553427740e-02   -2.449160899002021e-01   +7.157603654631788e-01   +1.409066187408888e-01   +1.256112060386713e-01   -4.783657299287790e-01   -4.851368912954896e-01   +2.549366193680361e-02   -4.282193680283619e-01; -3.196606602655291e-01   +4.572968639148156e-01   -5.766144553784192e-02   -1.617476808036918e-01   +5.615281921051180e-01   +7.467026322234487e-01   +1.592573994028698e-01   -1.869185655324258e-01   -5.822600028500017e-01   +5.143998213401150e-01   -1.280579923845028e-01   +3.886370729066392e-02   +3.115683080152407e-01   +1.204927532976440e-01   +3.505315452317533e-01   -3.561095227606010e-01; -1.698407022356904e-01   -6.025445658201126e-01   +4.611665465697314e-01   -1.152893502079868e-01   -3.183272297808894e-01   +3.857767843224870e-01   +1.252535659085121e-01   -1.292712712218856e-01   -6.315007153817240e-02   -3.195761022157146e-01   -6.650605720221933e-02   -7.489390730581877e-01   +1.582630032382398e-01   -2.056806372888821e-01   -7.565031089966047e-02   -1.711889009043153e-01; +2.222627456469298e-01   -2.961630925246011e-01   +1.441674036969518e-01   -2.575867898591996e-01   -9.683831727064320e-04   -1.428694922807763e-01   +2.720264902210865e-01   +2.412240147625039e-01   +4.166971781212896e-01   +6.276566113467805e-01   -7.083976234912104e-01   +2.270632043035120e-01   -1.063269246610473e-02   -3.660553352694761e-01   -1.162439768560839e-01   -3.634362510838887e-01; -3.379785996986476e-01   +1.146013234692178e-01   +2.777697294540654e-01   +1.818659023051550e-01   +3.578046529418014e-01   -4.886065248860280e-01   -4.311889773779720e-01   -4.879966592448272e-03   +1.059713696170617e-01   +2.121570217489453e-01   +4.989481121862728e-01   -3.004196586373454e-01   -5.378757734837238e-01   +7.896575092017188e-01   -7.813162140221414e-01   +6.081522560961132e-01; -4.825066373716888e-01   +1.144008582150537e-01   -1.941265600101227e-01   -2.934116595146743e-01   -6.476550685157076e-02   +4.195388238824095e-01   +4.526006863761805e-01   +1.437022724096722e-01   +7.605031618794971e-01   +2.638962456818883e-02   -5.133975728337540e-01   +2.326759565000996e-01   +5.984175809218540e-01   -6.295468085345386e-01   +3.260972205949990e-01   -2.677940163539487e-01; -2.248652145529481e-01   -2.716305924333441e-01   -1.009828249978566e-01   +1.830900752586458e-01   -6.654980207958274e-01   -1.438537723939687e-01   -8.201801135974496e-01   +1.860111288168433e-01   +6.424792528414318e-01   +1.184080743013593e-02   +4.341294085196111e-01   -3.261256951079824e-01   +5.728568271905747e-02   -7.142931613803118e-02   -9.523400009162439e-02   +5.911844828299256e-01; +1.587502364159580e-01   +1.243420916927195e-01   +2.479437698413893e-01   -5.311608592307281e-02   -8.025050423808669e-02   -4.744042177032533e-02   +4.786847527574027e-01   +3.254602411760794e-01   -2.700462596395024e-01   -3.229819255392548e-01   -3.162230904646697e-02   +2.360167226955902e-01   -1.490412416067054e-02   +5.847739842416079e-01   +5.796083960210687e-01   -6.744299037159567e-01; +3.427444610948957e-01   -3.206264183559372e-02   +3.243452567437113e-01   -1.177384814892946e-02   +1.000000000000000e+00   -7.185935442348471e-01   -5.957061048134047e-01   -2.863545056466423e-01   +6.702411547619994e-02   -1.630413867019389e-01   +3.269100226816048e-01   +5.254945268657961e-01   +1.662292966167923e-01   -5.611942025728729e-01   -3.331689731764457e-01   +5.301964024055734e-01; +8.621651921767174e-01   +5.419920804275206e-01   -5.353090255993702e-01   -5.932041243652000e-01   -5.350411884368348e-01   -2.525362377496423e-01   +4.309535009463842e-02   -2.375373691861388e-01   +7.247242213263710e-02   -2.439806590416936e-01   -6.177895091895518e-03   -2.751302443052691e-01   +3.077270606979869e-01   -2.843177294529652e-01   +6.473360260332978e-01   +3.085276587163752e-01; +5.108968150095797e-01   +3.680642411065800e-01   +6.511327187177305e-01   -7.086138739894454e-02   -1.960663596870789e-01   -7.250549258364481e-01   +3.357313385809893e-01   +3.582003503466276e-01   -6.099830446971281e-01   -5.402186330398717e-01   -8.199224314426213e-01   -4.112165758235882e-01   +1.571552515919340e-01   -3.573978279323124e-02   +3.751550860476187e-01   +2.384355985178377e-01; -2.413770450619755e-01   -2.595720853951125e-01   -2.605267220383782e-01   +5.780816203298633e-01   -1.987076498091951e-01   +4.339631647514250e-01   -2.286016608434125e-02   -1.867509013656658e-01   -7.603111926503126e-01   -2.378513324994597e-01   -2.406070336918698e-01   +4.569372546451545e-01   -2.514821568667724e-01   +4.916763397710524e-01   -5.583409915637479e-01   -5.403114261591591e-01; +7.959953347036751e-01   +2.491597018027578e-01   +1.111032836272815e-01   -2.933538736156608e-01   +3.976031799372889e-01   -3.473669993254628e-01   -1.289673186583570e-01   -2.945443680706353e-01   -5.887736145176879e-02   +6.483375699246779e-02   -2.986314025439669e-01   +1.194204518665869e-01   -1.834956038660483e-01   -8.491387639142883e-01   -3.300481197665654e-01   +3.301508386974259e-01];
L1E_L1I_iGABA_netcon = [-8.826953472744674e-02   +2.770785611659051e-01   +4.287091112506570e-01   -7.357111218339839e-01   +3.327409154291067e-01   -5.377031095402238e-01   -3.986748358880659e-02   +7.491918122559040e-01   +2.461814183757128e-01   -1.774418357686819e-01   -5.536096898628285e-01   +4.859335328044579e-01   +2.202884359263852e-01   -1.693725182158743e-01   -8.068011624518519e-02   -2.955060263382889e-01; -1.215870250350732e-01   +6.930600843813831e-01   +4.644361060152313e-02   +9.246217113526199e-01   -4.092058137554582e-01   -1.450103580592845e-01   -8.665669250223890e-02   -2.425655676901937e-01   +1.000000000000000e+00   -1.842142744575635e-01   +1.933638136589056e-01   +4.892705321860379e-01   +4.116472171350143e-01   -7.768153735208054e-03   -4.386830396834717e-01   -5.565859402410770e-01; -2.679403109118243e-01   -7.570339833119771e-01   +2.182060913549250e-01   +2.378159234186224e-01   +1.587926617248191e-01   +4.715740146525534e-03   +2.257633132957818e-01   +4.102996917532655e-01   -7.390440003393673e-01   +3.436717685214990e-01   +3.917396195923158e-02   -3.332599602079664e-01   +6.160862832695700e-01   +3.254780650454344e-01   -4.644004825905190e-01   +6.416361000750427e-01; -5.349136422670128e-02   -6.588464275475172e-01   +3.374729567171204e-02   +4.328949985548156e-02   +3.254919891477264e-01   +6.903580610127205e-01   -6.992476071603952e-03   -7.787041158872099e-02   +1.652661396502363e-01   +7.633271084190871e-02   -6.075696128005629e-01   -4.052519245287125e-01   +4.094706155134953e-01   +3.487007131853526e-01   -6.556608515926675e-01   +7.905080745931428e-02; -2.720425951359224e-01   +5.253603457279723e-01   +5.336266008593799e-01   +7.193722474956600e-02   -8.028679724844189e-02   +6.563400382253568e-01   +1.087052878736706e-01   -2.705737584618410e-01   -2.351728730088994e-01   +2.413916165634246e-01   -3.550128158709975e-02   +5.100199904513820e-01   -2.003133800259239e-01   +3.820325471983892e-01   +3.079330385646157e-01   +1.021376079552767e-01; -1.456004792087638e-01   -3.118867978038884e-01   +1.390111997653596e-01   +6.993800131493093e-01   +3.279179673834894e-01   +5.751166742111480e-01   -1.166480466901722e-02   -2.805911948958381e-01   +4.185543681022206e-01   +6.506742722250174e-01   -2.120666973052377e-01   +2.132593235777108e-02   +5.109333877103255e-01   +2.320987148534304e-01   +5.715728446160977e-01   -9.552170604038458e-02; +4.550160674904205e-02   +1.161985034951909e-01   -5.076158576439682e-01   +1.757856792998200e-01   +5.858940424165701e-01   -5.034666625913149e-01   +1.039889460719392e-01   +2.935119304720001e-01   -8.478960697225881e-01   +1.899706696442657e-01   +4.532876058009308e-01   -2.636892650405859e-01   -3.737809652367997e-01   +1.127105813591115e-02   -2.019824033736844e-01   +1.699694330487476e-01; +1.014791177599780e-02   -2.886928737489270e-02   -4.058124736439763e-01   +1.361373256977053e-01   -1.945740164732541e-01   +6.528464904675745e-02   +3.544359092923907e-02   +5.336863746468220e-01   +7.919944535805862e-01   +1.888742177913878e-01   +1.346042999017158e-01   +1.252445462926097e-01   -2.393903725914258e-01   +4.345398697069593e-01   +6.204458451826276e-01   -9.313474671520162e-01; +1.556079922217266e-01   +2.857112684579521e-01   -1.744712912950540e-01   -3.216658930172285e-01   -1.763894088270478e-01   -9.101745654616619e-02   -8.611662980655279e-01   -4.883923464318205e-01   -2.446761482978943e-02   +7.432945850336672e-02   +5.920624479869316e-02   -2.512035298773027e-01   +3.095955695719257e-01   +7.334728684732460e-01   -2.587883978254152e-01   +1.279203873984056e-01; +4.765875306961357e-01   -8.706261236386055e-02   -2.800552540231272e-01   +8.072769783008125e-02   +7.721652672376947e-01   -1.878418600797364e-01   -1.469856649678573e-01   +4.760642118342300e-01   +4.615661080133602e-01   +3.929481823364352e-01   +3.791216468757713e-01   +1.684219745138472e-01   -1.604846706116650e-01   +2.395916125488768e-01   -3.634168906363661e-01   +3.636609265712977e-01; -3.627703524512806e-01   +1.228554466183526e-01   +2.168959494439300e-01   +5.317347089061156e-01   +1.428219986790051e-01   +1.445903912084496e-01   +1.078772510392788e-01   +5.881028998099066e-01   -5.996698857045077e-01   +4.793035611790398e-01   +1.439798236829852e-01   -1.918656970048740e-01   +4.058960139220076e-01   +3.294752620314522e-01   +1.837655701750890e-01   -3.516365133293531e-01; -4.936837707612101e-01   -1.262546562399279e-01   +2.362184858000950e-01   +1.934676012836925e-01   +1.171326792438233e-01   +4.287668841758245e-01   -8.219953352842954e-02   +1.054809729399093e-01   -3.653409938497544e-01   +6.395159918847901e-01   +6.806118484811232e-01   -2.943716356336264e-01   -3.183812286323274e-01   +2.999417642965918e-01   -1.242146663028690e-01   -3.550863781671817e-01; +4.687557804758753e-01   -4.726694543693334e-01   +4.918859829842687e-01   +7.224257095420239e-02   -1.254429383902970e-01   +1.148471554362607e-01   -1.378932429869902e-01   -3.924426980817122e-01   +5.264828536487746e-01   -1.152144613882209e-01   +2.321632925415379e-01   -5.019733999920731e-01   +3.714086464708654e-01   +1.546317046413644e-01   -4.965285454803506e-01   -9.166560107114373e-02; -5.913078459323090e-01   -3.044305779820807e-01   -8.816226373541777e-02   +2.769528564978806e-03   -6.746901892155417e-01   +2.979764413677033e-01   +5.694865678798501e-01   -2.565983613884318e-01   -3.934456788429695e-02   -4.072138551911036e-01   +2.237753017753065e-02   +1.654151956908834e-01   -1.430289291688079e-01   +7.305486600834690e-02   +3.198868787776329e-02   -3.589761366479123e-01; +1.323715893585752e-01   -4.225659705236809e-01   -2.111321882678497e-03   +4.671990360033778e-01   +4.873456019277662e-01   +6.973497439924868e-01   -1.886622539951697e-01   +1.715373645539874e-01   -1.608606136248092e-01   -3.389590687512619e-01   +1.907615325967540e-01   +2.415401143735329e-01   -8.056060175899737e-02   -3.334691968543761e-01   +3.202051858380607e-01   +2.706946327518069e-02; +4.313078815151732e-01   +4.123059328167714e-01   -1.672590261477436e-01   +1.351915854863563e-01   -1.017470006915386e-01   +6.885003389504021e-01   +2.958697472256811e-01   +6.603119284228344e-01   +2.545499656488681e-02   +1.357745007149600e-01   -3.812111064827423e-01   -7.970802748996751e-02   -2.052293864091672e-01   +5.736518355840448e-01   +1.049659326384327e-01   +1.678823796897713e-01];
L2I_L1I_iGABA_netcon = [+2.952621700547836e-01   +4.896019288740117e-01   -1.755694391856582e-01   +5.364134887000794e-01   +2.840416564109988e-01   -8.213871246428428e-01   +9.102727421471597e-01   -1.408002159696466e-01; -3.050905410732280e-01   +8.039297226262686e-02   -2.212757818259391e-01   +2.640275394915997e-01   -4.601946797333489e-01   +2.262095267861407e-01   -7.251486833305737e-01   +6.403198218532776e-01; +1.050336345958743e-01   +4.625569863512159e-01   +1.001996878409233e-01   +3.682722340267376e-01   +3.586886945011672e-03   -3.161507365430197e-01   -7.225479731353665e-02   +8.999078665483116e-02; +2.629360310289433e-01   +2.000139057324276e-01   +1.759555482705856e-01   -1.202636685361607e-01   +3.763304789058011e-02   -9.281245815804530e-02   +2.215086894619869e-01   -4.341828307582469e-01; +8.075800141564768e-02   -3.909549117787168e-01   -3.417397904571837e-03   +5.648103036439183e-01   +1.331524466051675e-01   +8.444805795486086e-01   +4.265907433494361e-01   -4.354365950851529e-01; -1.615058433147913e-01   +5.065431477324672e-01   -2.063349182696729e-01   -1.553805103270357e-01   +1.998555213365837e-01   +5.699599494444448e-01   +3.458189452686270e-01   +2.273698062392732e-01; -2.947207048245413e-01   +2.871439278648482e-01   +7.758359501720898e-02   -5.971397771846011e-01   +1.528038480602361e-01   -1.000000000000000e+00   -5.519442582148644e-02   -1.503701922143131e-01; +3.152027085026670e-02   -2.475614435877436e-01   -4.571751998672666e-01   -8.780826711998386e-03   +9.276012891913289e-02   +1.278733479009445e-01   +1.150092084987564e-01   -1.231094828242909e-01; +9.380268773508694e-01   -1.076465262895906e-01   +8.889422634679893e-02   +6.098162695218845e-01   -3.198109023678971e-01   +9.979251159294716e-01   +4.994304947488376e-01   +6.230344496022340e-01; +4.765220881094743e-01   -5.122784800506857e-01   -7.262810443759511e-01   +4.270992508209157e-01   -4.385813379631074e-02   +6.308657075730171e-01   +2.987475760242130e-01   -6.874162215933217e-02; -7.522467375715905e-02   -1.027068399759255e-01   -6.222417855030386e-02   +2.852333381468345e-01   +5.871952394719136e-02   -8.452765607279207e-01   +6.787240789187136e-02   +1.796826450261366e-01; -2.235150446685328e-01   +2.428441051357928e-01   +3.184377128026967e-01   +2.428769560301429e-01   +7.855822052877713e-02   -1.739811149330942e-01   +1.177419133266258e-02   +7.462008273758416e-01; +3.706446015705461e-01   +2.347230842047251e-01   -2.659048160408388e-02   +1.495820540784161e-01   +2.311346723002785e-01   -3.697083360448931e-01   -8.806549822168519e-03   +6.890423195886000e-01; +6.753416146482712e-01   -3.759464217443968e-01   +2.768573284278056e-01   +8.682828985489316e-01   +2.334046183440933e-01   +9.051819628594268e-01   -5.787594758796532e-01   +2.250441195083574e-01; +2.623911193063571e-01   -6.255771189429214e-02   +3.929423322259024e-01   +2.026110030595935e-03   +1.347587812886948e-01   -2.767452038299489e-01   -7.632352814719680e-01   -4.538228743773031e-01; +3.484783638194444e-01   -7.912057062024566e-01   +1.525305264818294e-01   +2.284185373862430e-01   -3.635726636649425e-01   +1.251667038833909e-01   +5.059016172452581e-01   +8.312840856884844e-02];
L1I_L2I_iGABA_netcon = [+9.787556121386363e-01   +4.491286329703043e-01   -2.566082485488659e-01   +1.000000000000000e+00   -4.272815709412164e-03   -2.508111837850548e-02   +1.521828789952719e-01   +1.465356835140251e-01   +4.153175055631308e-01   -3.728788055004590e-01   -1.702513449459897e-01   -1.498034640629117e-01   -2.943512790602694e-01   +3.815248981395187e-01   +9.256898128018765e-01   +2.684878424117074e-01; -5.092002183648497e-01   -8.487463989361358e-01   -1.613847040357961e-01   -7.069481734378998e-01   -3.213441778430148e-02   +7.872744544964585e-01   -5.562937661921536e-01   +3.316678491006952e-01   -7.582452205559538e-01   -1.688323000566024e-01   +2.738788001983337e-01   -4.760659481537774e-01   -5.599095254743430e-01   -6.284175043236992e-01   -6.297040869508011e-02   -2.674270066995331e-01; -1.319335924655312e-01   +4.180869185914019e-01   +5.961044208150943e-02   -3.281371803169991e-01   +7.079221246485750e-01   -1.441793327270728e-01   -1.985359997392162e-01   +2.566944469431764e-01   -5.620351219219454e-02   -1.285513287281334e-03   +4.287512020600178e-01   +8.711633409537682e-01   -6.578210104859448e-01   +7.112495155861566e-02   +6.795507493281365e-01   -9.833319720750951e-02; +2.518436230848655e-01   +5.185837659761454e-01   +2.586236308219514e-02   -4.112023355917344e-01   +2.162893098511428e-01   +1.053503535041460e-01   +1.773967086180538e-01   -1.853458483671254e-01   -3.631137818521439e-01   -2.654099608449909e-01   +1.653200142210544e-01   -5.378999487496936e-02   -2.571425272256027e-01   +9.720804589991778e-01   -2.502210327926006e-01   +5.495490428086577e-01; +4.044542853074742e-01   -8.662132212434685e-02   +2.006566324133004e-01   +2.562678243125788e-02   +2.833387099064652e-02   -6.263403594915616e-01   +1.950313526606482e-01   +2.379382406106568e-01   -7.578426816103867e-02   -8.691701846839284e-01   +4.313053930729283e-01   +2.802865068978110e-01   +7.194123708537747e-02   -8.362330826032838e-02   +1.131744439860162e-01   +2.448424550568787e-01; +2.732099809367982e-01   +6.610276151422536e-01   +1.013635860881768e-01   +6.749858568629274e-01   -6.027135116953181e-02   -3.505651254653643e-01   -2.548940849236810e-01   +3.780924033802618e-01   +8.977524483774864e-02   +1.627413962758795e-01   -3.150722711658132e-02   -1.526463113045172e-01   +6.518803495115073e-02   +2.950817256529488e-01   +5.520214335764714e-01   +5.524323799675336e-01; -6.458729021600542e-03   -1.861192052368933e-01   +3.550025517444078e-01   +4.197193649859080e-01   -5.550616633344840e-01   -3.416006976611226e-01   +2.223008420274645e-02   -3.577774417849173e-01   +1.309153285505170e-01   +6.961550060358714e-01   +9.873593157978693e-01   -3.292286767291252e-01   +5.551302041992939e-01   -9.657252997244178e-02   -8.852899245724309e-05   +4.848316518030488e-02; -2.821978405455426e-01   -2.429504147521072e-01   -3.558259698375817e-02   -2.079834261868633e-01   +2.520532422481856e-01   +4.275956342024642e-01   -3.615133322061129e-01   -4.676879927444664e-02   -1.148402513758188e-01   -6.310674912518716e-02   +1.550642355172258e-01   -1.707330229102705e-01   +2.866960658542221e-01   +5.191277450271788e-01   -2.513749528288812e-01   +7.656628596022801e-02];
L2E_L1E_iAMPA_netcon = [-7.523796067671100e-01   +3.259777948074276e-01   -4.384951883504334e-01   +7.702065281820931e-02   -6.415320872153371e-02   -2.106340941516808e-02   -1.183938616616036e-01   +7.144847450547920e-01; +7.214679137849120e-01   +6.432889531537210e-01   -4.298385564753066e-01   -1.806027325325513e-01   +4.894306915292983e-01   -2.267081328519101e-01   -2.066293730897698e-01   -1.801487842490111e-01; +4.241755388186552e-01   +6.083900595534386e-01   -5.021169193904928e-02   -4.581832791965414e-01   -5.037106645535847e-01   +2.076394955827054e-01   +1.504174996375634e-01   -3.818601070173459e-01; +2.942193262512650e-01   -1.255958632715409e-01   +2.483174432781632e-01   -7.961867657461494e-02   -3.516322076865268e-01   +5.089903450876960e-01   +4.599004425277830e-01   +5.078123392767298e-01; -4.842584489153574e-01   +5.521896862004012e-01   +5.984077083143702e-01   +8.631599412674282e-01   +2.987066102037798e-02   -7.586686522915347e-02   -6.085367181781046e-02   +4.186357898193307e-02; -8.573039920004619e-02   -5.435216407755004e-01   +3.952949794012055e-01   +5.843695144609083e-01   +3.899832469861220e-01   +4.937588457590287e-01   +5.482898532352311e-01   +4.251870302319195e-01; +8.893373002348789e-02   -2.202407122855164e-01   +5.214224223866121e-01   -4.712596688054007e-01   +5.706760555533675e-01   -6.724529350969723e-01   -2.866412203037069e-01   +5.227773914400746e-01; -4.791681131064162e-01   -8.029743219342909e-01   -3.360741151362486e-01   -5.592015842615191e-01   -8.645753873582542e-01   +1.651154498679721e-01   -1.775884015380441e-01   -5.022831363734295e-01; -4.655629015426958e-02   -6.575175489706560e-01   -6.552398406776043e-02   +3.746943387523909e-01   -9.733911083475036e-02   -1.117481415054778e-01   -6.522679571425815e-01   +2.745444887988241e-02; -5.800669459857042e-02   -6.324492570783706e-02   +5.210155081130858e-01   +1.048012976954632e-01   +7.717423292909602e-02   +1.802886885287586e-01   +1.540310844847606e-02   +2.882120102115039e-01; +5.193451124812097e-01   +5.954427307694444e-01   +3.381771941983493e-02   -2.617216621148417e-01   -1.000000000000000e+00   +1.636442589921557e-03   -7.296908530224022e-02   -5.538708679999099e-01; +9.827725515071069e-02   +6.869604284567418e-01   -4.751407148592491e-01   +1.765692972273955e-01   +3.282507429974776e-01   +2.410768768436573e-01   +1.968686062852658e-01   +2.201666392719170e-01; -4.358516731687763e-01   +4.951719285317133e-01   -2.346390592634489e-01   -4.405725834316144e-01   +2.428810096869756e-01   -8.787005430490430e-02   +4.503572478137933e-01   -5.721334683591862e-01; +1.803842973311784e-01   +5.030552083858501e-01   -4.589461266198603e-03   -1.309118969849033e-01   -1.898900531015769e-01   -2.727896117558619e-01   -3.391213643694310e-01   -1.776279710343937e-01; +1.441870549122269e-01   -5.409505241061037e-01   +2.830881083348278e-02   -2.233374887504385e-01   +2.829059575826861e-01   +2.294856220055362e-01   -8.092317793691226e-01   -5.890107360323359e-01; +4.294312167572796e-01   +9.997811952198575e-02   -2.016927481280381e-01   +1.032955037743502e-01   -9.420629912928369e-02   +4.736454048090261e-01   +1.985253552573422e-01   +3.259512076254617e-01];
L1E_L2E_iAMPA_netcon = [-1.000000000000000e+00   -4.039961192649869e-01   +3.762792447242019e-01   +5.504370415898502e-01   +5.202313179030498e-01   -1.707357375640235e-01   +3.804774916320033e-01   -7.597112342217719e-01   -7.688079089343725e-01   -2.580776681368684e-01   +3.378671268926490e-01   +4.772173425815464e-01   +9.034379863587728e-03   +3.058224810282747e-01   +3.679632109870454e-02   -2.212157849510580e-01; +2.273875539312198e-01   -6.874445753520506e-01   +1.686264604944253e-01   +3.371283975977524e-01   +4.404233644214228e-01   +2.970396626882007e-01   -3.096362977251199e-01   +1.922706817906771e-01   -1.816164341642368e-01   -5.990295916413502e-02   -1.859519365726675e-01   +2.256965719038535e-02   -5.243307709294391e-01   +1.573962539764645e-01   -1.188235560534198e-01   -2.635426394990927e-02; +3.776820400453608e-01   -3.460247793231741e-01   +1.123263105618675e-01   -3.719917106367071e-01   +3.242024477276345e-01   -6.173670766388363e-02   +4.710991867756589e-01   +6.599879501296472e-01   -9.790767017577784e-01   -2.008670656119382e-02   -7.094346853045934e-01   -7.810188035057812e-01   +4.044922626464854e-01   -1.245739153186137e-01   -5.041211880211612e-01   +3.135765385895719e-01; -9.608571560213576e-02   +7.268122628509016e-01   -4.011510734915050e-01   -3.564779941577554e-01   +5.440518116989648e-01   +1.457914385012714e-02   -2.602050587713557e-01   -6.562682266742423e-01   -1.374054294569967e-01   -4.974586279962019e-01   +2.781989645029678e-01   +5.930946487460761e-02   -5.785545867560368e-01   -4.349809641194161e-01   -4.609150048801565e-01   +6.093666128521303e-01; -7.756207101352400e-02   +6.359954487911966e-01   +3.830065823168826e-01   +6.314435344838160e-01   +3.706362834673009e-01   -1.907524258830005e-01   +8.227771187779704e-01   +5.158550669987124e-01   -5.935174549160193e-01   +6.435768404957180e-02   -3.521057107563552e-01   -7.180608084101923e-01   -6.587109900987426e-01   +5.478404189870816e-01   +6.854064543845875e-01   -1.314797365721561e-01; +3.012112227232116e-01   -6.237528387590994e-01   -4.154199681634707e-01   +4.584839961871083e-01   +1.101618148609801e-02   +2.044536146392152e-01   -3.487169971367753e-01   +6.410697189542772e-01   +4.547431389370266e-01   -5.591454808737643e-01   +1.671449846887889e-01   +3.154638782576475e-01   +3.745627005288554e-01   +5.481628165953507e-01   -6.745261448449047e-01   +3.339606256551200e-01; -4.317996409904889e-01   -3.835279059664802e-01   +8.056709507144186e-02   +6.366213903261958e-01   -3.149172203186615e-01   +5.176941933977343e-01   -1.171512931147243e-01   -6.237012412900846e-01   -3.174508404615810e-02   -5.924461633489945e-01   +1.897278648940974e-01   -7.523090547639882e-01   +3.420690344517850e-01   +9.405860898885907e-01   -2.422885171650705e-01   +7.652738344065781e-01; -2.454818864731802e-01   -7.118083326203387e-01   +1.307581892272808e-02   -1.981591734120653e-01   -2.082264154278770e-01   -6.787863778178003e-01   +3.358037565872142e-01   -1.082908846726507e-01   +4.626750302674497e-01   -3.293069920214289e-02   +7.864608616454692e-01   +5.750122874022662e-01   -1.520980212616683e-01   -2.862897325566583e-02   -6.954278504662676e-01   -5.058482589504136e-03];
L2I_L2E_iAMPA_netcon = [-3.417704675691716e-02   -7.525613997740448e-01   -3.764121359031590e-01   +2.821461941080258e-01   +7.753503490462890e-01   +7.215703435693192e-01   +7.606569329221717e-01   +1.939579450599713e-01; +3.912940669685043e-01   -7.236593704018819e-01   -2.611370928579224e-01   -1.189767419424362e-01   +5.408224050767337e-02   -5.605971070277667e-01   -3.033377399316540e-01   +3.257813845214636e-01; -3.203944377036458e-01   +2.016985941357126e-01   +2.707363961658577e-02   +4.188049691668136e-02   -5.236879700283072e-01   -7.044330759576526e-01   +3.513221983645154e-01   -2.209038142510208e-01; +6.044640103981471e-01   +5.700663860988996e-02   -3.311312519513435e-01   -1.914136078734597e-01   +2.870806517269654e-01   -1.813544706570258e-01   -9.851748006785867e-02   +5.151648014873661e-01; -6.044447745900559e-01   +1.399771139390620e-01   +7.777482224623328e-02   +1.401941716085400e-01   +1.520682455913338e-01   +2.127597889581365e-01   -2.946514211648112e-01   -3.877467618433205e-01; -4.885298749014876e-01   -1.000000000000000e+00   -6.450584200130396e-01   +8.889365972132670e-01   +1.539699074027954e-01   -4.206219852829255e-01   +3.590432851430948e-01   -3.469388848904759e-01; +7.312334502572646e-01   -9.869866704319888e-01   -3.940238373171118e-02   -3.715747051924167e-02   -1.402816515696364e-01   +4.423310940856873e-02   -9.532351914066001e-01   -4.117250053999871e-01; +1.338262943911030e-01   -2.369199550313511e-01   -2.405784092349265e-01   +2.619972548905020e-01   +6.437079990158766e-01   -3.882082195806382e-01   +1.190266525663992e-01   -3.457009825211972e-01];
L2E_L2I_iGABA_netcon = [+7.320536962302751e-02   +9.416346785626613e-01   -1.913434678100739e-01   +6.787642341594265e-01   -5.119199372715832e-02   +6.249338645160204e-01   +2.192594054910111e-01   -7.539040183260559e-02; +4.165927413722635e-01   -7.928213550591151e-02   -4.490735829928690e-02   +4.322552616445338e-01   -7.195663302426436e-01   -2.873104064237071e-01   +6.143921585917462e-01   +2.542851543391618e-01; +3.350496987473188e-01   +2.659408444164189e-01   +8.419018107234706e-01   +4.174917176623164e-01   +6.213656136460605e-01   +9.791647314116944e-02   +8.423222221016553e-01   -2.469474594648695e-01; +5.449863513366320e-01   -1.077955809024796e-01   -1.400380791913317e-01   +3.360322897834774e-01   -4.078766316320526e-02   +2.468955574368731e-01   -5.141086363539384e-01   +2.654154120713481e-02; +5.489811719030521e-01   +4.635086331337489e-01   +6.577385796723820e-01   +1.746074898980284e-01   -1.604481462861483e-01   +6.664027748021886e-01   -1.789747179348470e-01   -1.998935742288028e-01; +9.976625484490224e-01   -5.888291928787892e-01   +3.688965358472455e-01   +2.451533386120573e-01   -7.987094937807039e-01   -3.385230865709256e-01   +5.686242658056578e-01   +1.019762097121060e-01; -2.145822200381856e-01   -6.219173150040698e-01   +7.832452414922614e-01   -5.120041136231170e-01   -1.732782702411590e-01   +4.678339832835977e-01   -4.082578716965711e-01   -4.645235979985372e-01; -2.637235788930109e-02   -8.902396713383001e-02   +4.005615676643663e-01   +6.377435979153860e-01   -4.200284181584829e-01   +2.267550293622380e-01   +2.450879882813121e-01   +6.672765275614042e-01];
L3E_L2E_iAMPA_netcon = [-2.019476171731515e-01   -2.413377868285007e-02   -2.947963115247462e-01   +5.076944807896511e-01   +2.696762724442340e-02   +5.087270027069064e-01   +5.942411526997821e-02   -8.848676526852217e-01   +3.817670087692806e-01   +6.654471006099896e-01   +9.228792039696196e-01   +8.963159560586113e-02; -2.308488025556872e-01   +1.207676419263896e-01   -5.171224123365416e-02   -7.717662758814823e-01   -5.689925661355113e-01   -4.025388685641963e-01   -6.999503644114911e-01   +3.732021791289614e-01   +5.494727586368108e-01   -4.747560832332240e-01   -5.592234357094032e-01   -3.436209042350103e-01; -3.800903892903467e-03   -4.574313462167771e-02   +4.299390959078285e-01   +3.257974384828207e-01   +3.199216234146409e-01   +3.952840490916295e-01   -6.626719626268648e-02   -7.407940547534362e-01   +3.512805133291393e-01   -5.262024074732810e-01   +2.441429787609337e-01   +3.727387114958576e-01; +3.711699431741746e-01   -3.338451413861585e-02   -1.480812507126022e-01   -4.628060270566034e-02   +7.577570745218148e-01   -3.195576216205152e-01   -3.070836600977794e-01   +2.536682117531095e-01   -7.945061471448718e-01   +1.584558132538127e-01   +1.157083337578732e-02   +2.977709101190245e-01; -3.907862232036269e-02   -8.482539662112752e-01   -2.415311047714073e-01   -2.713355004686011e-01   +5.420625196340756e-01   -3.293323744023138e-01   -3.550219850336670e-01   +5.549731328141407e-01   -2.988866488292768e-01   -8.646361547564021e-01   -5.982980618506687e-01   -9.659247551974416e-01; +1.000000000000000e+00   +5.013988011178233e-01   -2.655155355093040e-01   -8.076589927149088e-01   +4.231548407086339e-01   +7.918587019601768e-01   +5.796816979059415e-01   +5.489443610191347e-01   +9.432093651320168e-02   +1.947193419654772e-01   +1.229118895559962e-01   -9.954812052639153e-01; +1.064889154202407e-02   -3.500577747994935e-01   +2.407676331590670e-01   -6.648374835897595e-01   +1.821690272056067e-01   -1.401170134009957e-01   -3.511279132693643e-01   -4.119662269253535e-01   -4.845906022216272e-01   -4.898304311245855e-01   -7.620501902218846e-01   -2.819602491731906e-01; +1.203391523915237e-01   +1.757314224558110e-01   +3.446732048901271e-01   +8.033820103683411e-03   +7.365551107222307e-02   +4.092999388100830e-01   -2.427912408286480e-01   -1.901261620405054e-01   -6.025207832507875e-01   -5.017737044804946e-01   -9.938448000063006e-04   -5.408352316486242e-01];
L3I_L2I_iGABA_netcon = [+1.554849338145649e-02   -3.062218551640505e-01   -2.081399264768382e-01   +4.475060507886632e-02   +8.691605758440233e-01   -2.959469642944970e-01   +3.571943121049256e-01   -5.747627532129986e-01   +7.474446752118389e-01   +4.892272397200653e-01   -1.203514659153086e-01   +1.180315029462941e-01; +3.381788300049666e-01   +9.896162869228975e-02   +6.411121795127586e-01   +4.276160427457171e-01   -1.770417245210038e-02   -5.652876775230113e-01   -1.008600525964790e-01   -4.270084142695650e-01   +3.391192093374659e-01   -2.538144553499525e-01   +5.296325587982644e-01   -1.034480962595433e-01; -8.826156229828891e-01   -6.024290053843473e-01   -1.808051076320812e-02   +4.993981929222394e-01   -3.463850316924593e-01   +5.054721316846555e-01   -4.236655266100537e-01   -3.695134412716019e-01   -4.605013585368384e-01   +5.145367085795817e-01   -3.360942537655955e-01   +2.852652219035937e-01; -6.892197506015821e-02   +7.955079372771418e-01   -5.234281081005960e-01   +1.945226370971556e-01   +1.398421621156071e-01   -1.402316204160829e-01   +6.069701209199919e-01   +2.321329833387715e-01   +6.302293527061485e-01   -4.205006611435152e-01   +3.832032623091381e-01   -7.450210754996808e-02; -2.680469534249140e-01   +7.265430965749419e-01   -3.600300090373318e-01   +2.272237855825443e-01   +3.351209890642486e-01   -3.039795545977282e-01   -8.809466551042333e-02   -9.369564624554985e-01   -7.066932584093719e-01   -2.017049865926187e-01   +1.515556541278035e-01   -1.812482150488820e-01; -1.000000000000000e+00   -6.805441083612801e-02   -1.879254714899827e-01   -2.400836477036654e-01   -4.415005440674744e-01   -3.419019772479654e-01   -7.832305693824838e-01   -7.241293915422855e-01   -5.934349114541868e-01   +2.975851914106226e-01   +3.807735153564527e-01   -5.391865630171357e-01; -3.830208912513515e-01   -5.406284156201192e-01   -3.100233728018216e-01   -4.659405556651554e-01   -7.691506209074649e-02   -1.862555793521053e-01   +7.246666400639455e-01   -6.525176239962419e-02   +1.816788197742760e-01   -6.987629659753053e-01   +7.238480421065486e-01   +7.044503708331566e-01; -6.731935357830270e-02   -6.723109732096332e-01   +3.619615464968644e-01   +2.076384523816644e-02   +2.800688689739832e-01   +8.485303198124079e-01   +6.384339632016397e-01   -6.993431747634002e-01   -5.825686123958899e-01   -5.685307992497991e-02   +1.060135375093335e-01   -6.001383926538686e-01];
L2E_L3E_iAMPA_netcon = [-4.413217772785442e-01   +1.591746691906477e-01   +2.239420385131645e-01   -3.238177797976877e-01   -1.978724628896975e-01   +6.774224479618697e-01   -4.300282298676528e-01   -2.943782282574009e-01; -9.235551720592763e-01   -8.532706678970419e-01   +6.420132636858507e-01   -2.646950481548823e-01   -4.825397902134676e-02   -7.821597631734811e-02   -7.056980734425622e-02   -7.672306502209136e-01; -1.438191647852467e-01   -2.688476347575889e-01   -7.242919972696229e-01   -5.393650316408407e-01   +2.361786515098817e-01   -7.243596530591373e-02   +5.606055608702714e-01   +2.270874566633699e-01; -1.138986039749558e-01   -7.399342226372476e-01   +2.104684325006179e-01   +8.250461324814168e-01   +2.653486878149162e-01   +3.453890571307556e-01   +5.535377335030283e-01   +1.088211680489267e-01; -1.712482418205233e-01   -2.090226110878176e-01   -5.338034342819635e-01   +5.366220262068134e-01   +2.258573861665062e-01   +2.325208282371904e-02   +7.790490278613886e-01   +5.952279629080089e-01; +4.727571137946551e-01   -4.140222748240642e-01   +1.758172436478195e-01   -7.003346690290698e-01   +2.018693218905744e-01   -6.551278072309199e-01   +3.592714524005654e-01   -1.815048188699245e-01; -6.633842404969381e-02   -2.408507858125565e-01   -4.668645149982232e-01   +4.789193617227755e-01   +5.504369549762106e-01   +2.597578519352546e-01   -3.752712752600733e-01   +2.304041527220531e-01; -2.604686760847708e-01   +8.463231996477848e-01   +2.555897709904618e-01   +4.312620765155362e-01   +1.456147412375415e-01   -8.605240014625677e-01   +3.597834572404823e-01   +7.583170409285139e-02; +7.521697676512133e-02   +1.198825049445729e-01   -1.368651829732037e-02   -5.993299926559268e-01   -1.493651961078586e-01   -3.204279264998250e-02   +1.210564125668866e-01   -2.145235134632414e-02; -5.511182408259870e-01   -7.282481811525805e-02   +3.210296665456449e-01   +1.956455345151918e-01   -3.097855657497567e-01   -3.027775869876967e-01   -4.224083683582422e-01   +7.026854082355493e-01; +8.301341616580404e-01   +9.877221411480421e-01   -3.051902451293208e-01   -1.584161983653082e-02   -6.335506490863594e-01   +1.498379997140882e-01   +2.624512297272155e-01   -4.263417980652853e-01; -7.721941100749624e-02   -3.527007975860763e-01   +1.842245967409609e-01   -4.383157884469481e-01   -4.781784634742162e-01   -4.788619175780978e-01   -3.063324113890663e-01   +8.387094532051661e-01];
L2I_L3I_iGABA_netcon = [-3.405051329793842e-01   -7.206114069834511e-01   -1.780479608344083e-01   -2.525892159445118e-01   -1.508070958786363e-01   +4.707996458088889e-01   -5.417790270564126e-01   +4.175087322845126e-01; -1.815823338981762e-01   +3.611481109312458e-01   -5.318292306607176e-01   -1.766875612241628e-01   -1.042738691151913e-01   +4.878420401120889e-01   -6.973738312672609e-02   -4.851623531132658e-01; -3.493762299182814e-01   -8.074562196834806e-02   -1.181630484768024e-01   +9.499426708784139e-02   -4.170367701255493e-01   +8.818915504628484e-02   -1.590110216331535e-01   +1.998968128073046e-01; +2.353947308563577e-02   -1.523205194412277e-01   -2.235216452639071e-01   -1.101864372485089e-01   +5.305759058525954e-01   +3.963125115226004e-01   -4.635598754643087e-01   +1.498961952816011e-01; +1.320370248413126e-01   -2.680507066613286e-01   +2.888721106426322e-01   +3.904073136831538e-01   +4.812732353779207e-01   -2.041926882741856e-01   +5.324274162650816e-02   -2.915156542474989e-01; +3.177333217798553e-01   -7.788505286271180e-02   +2.834504040863740e-02   +4.509256448609445e-01   +4.757833711540737e-01   -4.298404032752021e-01   +2.600194030292389e-01   +4.501760175975961e-01; +9.401499979738101e-02   -5.175412755369498e-02   -3.092347456209323e-01   -4.601813032712342e-01   -4.310126316136216e-01   -5.287369914460305e-01   +2.534003154072880e-01   -1.713412495982522e-01; -3.833976894296990e-01   +1.283716364261244e-01   +1.796597099083806e-02   +2.430331928217692e-01   -1.264538192528286e-02   -5.408927163300098e-01   +1.601487083292441e-01   -2.390191901025507e-01; +4.867000822182981e-01   -1.113790983472684e-01   +1.280133648393783e-01   -1.000000000000000e+00   +2.096790605573965e-01   -2.312081721950888e-02   -3.403301860594028e-02   +3.379695934790829e-01; +2.176615985501867e-01   +4.135980383190803e-01   -7.767208975764840e-02   +6.289331101768724e-01   -4.881538186062480e-02   -1.117827254762005e-03   -7.289010609948024e-02   +3.590317056303753e-01; +5.373451030555109e-01   +1.902228481575084e-01   +4.262608806108358e-01   -2.898183947709848e-03   +8.093266614182114e-02   -9.750357173390919e-02   -6.375547875742897e-01   -6.389472371263447e-01; +4.965159879753451e-01   -9.651108855714871e-02   -2.017117381418096e-01   -1.047808004427554e-01   +8.737876193806726e-02   +5.152981377928963e-02   +1.150497784978806e-01   -1.881861839681504e-02];
L3I_L3E_iAMPA_netcon = [-7.359061989933068e-01   -6.335736182942212e-01   -4.148142900262600e-02   -2.196085524742409e-01   -3.316487839193558e-01   +4.537117640426330e-01   -2.084640243331674e-01   -4.560923220503102e-01   +1.305474417735616e-01   -3.307854110816540e-01   +6.895244401879900e-01   +2.423379324082072e-01; -1.156073480579789e-01   -8.577860718745544e-01   +3.091763617070384e-01   -8.975533387407489e-02   +9.374194979699486e-02   -6.641850901459166e-01   -7.705502907487838e-01   -2.832595558762186e-01   -1.902101060273905e-01   +6.374813398809723e-01   +2.328965703614572e-01   -3.237258474077152e-02; +4.564649081599657e-01   +5.718968122906997e-03   +6.646377460767052e-01   +4.979677339801605e-01   +2.554375757254583e-01   +3.588332219960841e-01   -1.007089768734406e-01   -4.040190753388901e-01   +2.721670878759347e-01   +4.083228698038208e-01   -8.275219040193839e-01   +1.165956184285826e-01; +5.287753593512990e-01   +3.462935655109817e-01   +1.194582846547668e-01   -9.368608821935577e-02   -1.000000000000000e+00   +4.400706786109502e-01   -1.412302596667358e-01   -2.625021485268580e-01   -6.403937984634310e-02   -4.131610893690002e-01   +5.455776940784998e-01   +4.378645996271021e-01; +6.821114080991746e-01   +4.473762669083861e-01   -2.169985962758614e-01   +8.266750431731680e-01   -5.821548690266998e-02   +1.896808255753381e-01   +1.675447497853708e-01   -3.788535075530008e-01   +2.424410502169540e-01   +4.441735149801370e-01   -2.108586925415003e-01   -5.258185191049438e-01; -1.189690859395076e-01   +2.488554968596936e-01   -1.700450091071381e-02   -3.327653199005339e-01   +2.309996727247661e-01   +2.542519188475291e-01   -9.028136188124834e-02   +1.020318403269167e-01   -2.607700043172884e-01   -1.941080089334887e-01   +1.621954037346517e-02   -2.111337101481972e-01; -8.845295139373116e-01   +5.081363864514720e-01   -3.919126534680367e-01   -4.807619019153672e-01   -3.391224334840631e-01   +2.630864388332884e-01   +2.673653486880673e-01   +2.468274308462194e-01   +2.036596214452430e-01   +3.838206940670217e-01   -6.856393980536095e-01   +1.312882811495458e-01; -3.504183203710067e-01   +8.726313748098290e-02   -3.396696707264351e-01   +3.607084810288885e-01   -2.236447408461149e-01   +1.975079265844689e-01   +4.632141462631831e-02   +2.587249604806243e-01   -4.671721872809148e-01   +6.074784958662329e-01   +6.813067282540616e-02   +8.831326303269289e-01; -1.872498436679527e-01   -5.985803736032087e-02   -7.402336626254219e-02   -5.062706549104067e-02   -4.505869834081959e-01   +2.487092494063770e-01   -3.369015134114338e-01   -2.306219982122822e-01   +2.010552020704574e-02   +1.424489987353922e-01   +2.153677765491051e-02   +3.323189920770996e-01; +3.203122210281011e-01   -1.801346635577714e-01   +5.123387155043195e-01   -1.902260734832469e-01   -1.129123237966843e-01   +5.328487781794773e-01   -1.084865761931955e-01   -4.898784474245459e-01   +5.083273069310489e-01   -9.673583699736603e-02   -8.410045888397456e-01   -4.207008793745768e-01; -9.067833401999280e-01   +3.378177801812539e-01   +2.075711116048516e-01   +4.547225114771756e-01   -4.299084336060265e-01   -8.547391536620659e-02   +2.468305134604848e-01   -1.642224714968334e-02   -5.426523438283585e-01   +3.267384263258384e-01   +4.871151226922790e-01   -9.422277923550418e-03; +2.335854330416598e-01   +2.656301000081119e-01   +2.560254039706123e-01   -6.697451792356582e-02   +1.497825526442564e-01   -4.013683667756645e-02   -6.811854606014706e-01   -1.826104675908922e-01   +3.627371750844804e-01   +3.831544721425483e-01   -6.004032540983346e-02   -5.571667759050595e-01];
L3E_L3I_iGABA_netcon = [-2.566676889733072e-01   +5.220227539023480e-02   -2.789182876082632e-01   -5.125262659706576e-01   +7.597622813104601e-02   -9.628252114775391e-01   -5.451538992238348e-01   -6.049364049593504e-01   +1.000000000000000e+00   -1.340087978821887e-01   +6.479721604974695e-01   +2.882847134283213e-01; -3.632436909349606e-01   -1.513476645356774e-01   -2.405102981188424e-01   +2.227544844820149e-01   +5.294940584660704e-02   -3.706701793522802e-01   +2.027554126124480e-02   -9.510092261204798e-01   +7.005628726783961e-01   -5.658178820431218e-01   +5.468556372086284e-01   -4.969872416417355e-02; +3.009618247760436e-01   +2.314062974484289e-01   -2.433091256479332e-02   -6.619927179610904e-01   -6.364669727033404e-02   -3.165149603763535e-01   +1.393899452286318e-02   -5.472671789280771e-01   +3.993601905639003e-01   -2.737200769276816e-01   +6.346047853732112e-01   -3.794973335783972e-02; +4.230802907001830e-01   -2.143078540776276e-01   +1.525805957054744e-01   -4.001646404628316e-01   -4.605159994742782e-01   +8.823335077205003e-01   +6.316919168701113e-02   +5.444369896392256e-01   +1.613880192828482e-01   -5.051200332443911e-01   -7.683129328413971e-01   -1.904505867447723e-01; -8.580749774671638e-02   +8.278466524533031e-01   -1.111097161132254e-01   -3.552134774954989e-01   -4.357574413764511e-02   -1.448375487927392e-01   -3.508292098016476e-02   -2.006324485803349e-02   -4.531231319477518e-01   +2.535204651848694e-01   +5.453154723308039e-02   +2.168071754996791e-01; +4.086892646822987e-01   +2.966252542629316e-01   -3.301097192784048e-01   -1.003248674042110e-01   -5.874931608258460e-01   +4.494206283392411e-01   -3.185856729511895e-01   +5.005714036565534e-01   +3.421730186513988e-01   -7.066809235516373e-01   +4.946355096772940e-01   -4.028907167589826e-02; +1.702175760874928e-01   +1.162072685222647e-01   +1.554242479841475e-01   +7.818662974009326e-01   -4.831029971850827e-02   +3.604020793221441e-01   -4.225360091740812e-02   -1.794077490642458e-01   -4.355968020638591e-01   +3.697214221268069e-01   +9.503963075987304e-02   +9.388708744871796e-02; +6.589813873858992e-01   -3.548002289204535e-01   +4.165541703095312e-01   +7.198125437386148e-01   +4.961582554064477e-02   -8.129597441128525e-02   -2.473729638852538e-01   -1.202995734085354e-01   +6.494280891854644e-02   -2.408830729492077e-01   +1.349083503773025e-01   +2.112487887337141e-01; +2.985495186622190e-01   -3.101925059176102e-01   +3.019067686825598e-01   +3.343142321447947e-01   +2.613452631617971e-01   +1.240577874385563e-01   +2.231065864256561e-01   +1.037784822619453e-01   +7.935477481898250e-02   +8.032309759227531e-02   -3.302333880420432e-01   -1.197331753310021e-01; -5.931122217901819e-01   +4.665241547563193e-01   +5.886152501058735e-01   +2.133195674636491e-01   +4.562255951322282e-01   +1.326132053381726e-01   -2.867688486464962e-01   +6.550387847295173e-01   +6.776604075789971e-01   +1.587651180490559e-01   -1.792014949780760e-01   +1.830360386347484e-01; -1.949697474110195e-01   -4.829535378481239e-01   +3.252470445622835e-01   -1.936002094863470e-02   +7.491342146874680e-01   +1.941116007233834e-01   +8.931963444603996e-01   -2.643361884241591e-01   +5.328539297138937e-01   +6.549665103376341e-01   -7.776342217881418e-01   +2.157607289483125e-01; +4.534844554266962e-01   +7.604157208748195e-01   +4.029265465135324e-02   +1.806099066196822e-01   +7.204784502938506e-01   -2.125761784333946e-02   +4.153819720837849e-01   +2.926660056539039e-01   +2.880201355805139e-01   -1.565580650806908e-01   +4.307428940585175e-01   -1.068836371882748e-01];
L2E_Input1_iAMPA_netcon = [-2.755352541443927e-01   +2.143316780275016e-01   -7.249878733265426e-01   +4.360930072528068e-01   +2.307541322746350e-01   +8.306612097708962e-01   +4.459101631655139e-02   -2.864937223583569e-02];
L2I_Input2_iAMPA_netcon = [-8.738056681970422e-01   +8.798000247852539e-02   -9.018908235796376e-01   +9.835707294242009e-01   -1.785068235569723e-01   -3.268030310339413e-01   -2.382352732522498e-01   -2.712486431111210e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
