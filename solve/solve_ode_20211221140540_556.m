function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.148776180672920e-01   -4.871589403223154e-01   +2.606167087570606e-01   +2.785744928505574e-01   -1.876475525117804e-01   -2.567816745118711e-01   +1.422112469772015e-01   -2.627203054578011e-01   +1.624972888317488e-01   -5.306877701939352e-01   -6.049445669887699e-02   +1.374604103351905e-01   +4.965335358050693e-01   +2.183518310543320e-01   +1.474012088416849e-01   +1.779099925941287e-01; -2.739312664625576e-01   +5.195682851825428e-01   -3.141018510186460e-01   -1.960171197247696e-01   +3.337043357270257e-01   -5.114648251841626e-01   -4.744826618701996e-01   -7.807542223462257e-01   +3.444597328017313e-01   -2.164295309015005e-01   +4.493816825435799e-01   +3.757793431353511e-01   +3.269955771069545e-01   +1.783715725580410e-01   +7.246265210860720e-02   -2.712825364220225e-01; +5.041421809605586e-01   -6.192555249638600e-01   +3.389272789933993e-01   -3.820471882999816e-01   +2.035711597490781e-01   -8.232078665861403e-01   +7.407043808090927e-01   -9.075611102704854e-04   +2.503795356100878e-02   +3.494108058544500e-01   -4.613865140628947e-02   +4.674021320919803e-01   +1.187822706258366e-01   +8.815860991972484e-01   -3.071279541583725e-01   -1.227890605636047e-01; +1.000000000000000e+00   +2.270893838596556e-01   +6.607591064658247e-01   -4.425369571461797e-01   +6.324086429520274e-02   +1.962133045016214e-01   +5.243080696623250e-01   +3.540762377622657e-01   +7.980871130036010e-01   +1.037780944314899e-01   +4.761082785478566e-01   -6.655414838946804e-01   +2.479372361245276e-01   +8.988142608445801e-02   -6.061845121324270e-02   -3.335256485532562e-01; -2.616269736925422e-01   +2.828748494790105e-01   +5.148251100152150e-01   -9.600621702726388e-02   -4.354879353648851e-01   +3.960271362819170e-01   +2.443915403966842e-01   -2.802739228755387e-02   +2.368795339000808e-01   -1.097277327824415e-01   -1.932426379786195e-01   +2.498938227031517e-01   +6.514151217938700e-01   +6.580020934309240e-02   -4.103777130371383e-02   -4.840843385982331e-01; -2.266527228676840e-01   +6.942798678454936e-01   -6.471303177593072e-01   -3.516452283944979e-01   -4.331320384829751e-01   -7.521896196933971e-01   +7.056088330746438e-01   -1.365360098928455e-01   +1.319417530518613e-01   -1.687303704687071e-01   -1.194107019693898e-01   -2.821980352987467e-01   -8.506893279251736e-01   -4.928509097234864e-01   +7.366815305951340e-01   -3.362130728658177e-01; +4.456656993133954e-01   -2.030006273699851e-01   +3.628610955635886e-01   +4.440882779332658e-02   +1.753318942117666e-01   -4.985321880803629e-01   +4.131681654953206e-01   -6.868327927693874e-02   +5.763518440331385e-01   +3.686522464223217e-01   -2.815820667806053e-01   +4.168626273196642e-01   +1.684296240467515e-01   +6.486940318117032e-02   -7.698329676044282e-01   +5.514632387599049e-01; +5.301197484222000e-01   +9.471086739522708e-02   -1.377034711269366e-01   -6.141460643703387e-01   +2.184725740336020e-01   -5.628162800419838e-01   +4.478371932074736e-01   +4.690286801463195e-01   +1.654902746835816e-01   +5.736509449615274e-02   +3.773618394541911e-01   +1.355177761631512e-01   +5.315373356977249e-01   +6.695191369932187e-01   -4.143310374797051e-01   -5.125517752464586e-01; -4.269765032194043e-01   -4.255881251799784e-01   -1.525953189127643e-01   -9.050575308540035e-02   +4.531088509207854e-01   +2.320631075185808e-01   +4.830122985468325e-01   -9.622325747959734e-02   -1.406512503658828e-01   +4.530969174806194e-01   -6.030472982990186e-01   +7.771561544641457e-03   +4.123806023892704e-01   +1.556120981843719e-01   +9.713146249609451e-02   +3.992397941645095e-01; -1.125882367625355e-01   +2.372022770035762e-03   +4.377833030051939e-03   +2.121467776993968e-01   +3.530174103723351e-01   -4.466410168663952e-01   +6.104708970833268e-01   +5.282194650319326e-01   -5.638594800473189e-01   +8.460182841688224e-02   +5.136674295548269e-01   +2.349601934046611e-01   +2.891773262887974e-01   +1.471119721012042e-01   +6.267628419129743e-01   +5.860940562959109e-01; +1.261550184976060e-01   +5.712073235480143e-01   -3.893061978598756e-01   +1.130933365735111e-01   +4.712058067418249e-02   +5.719675992211035e-02   +3.326407228528843e-01   -4.153100410166322e-01   -3.631443699571607e-01   +9.134508661512866e-01   -7.272300082451630e-02   +1.096529650245420e-01   +1.709218043467035e-01   +4.809905718768968e-01   -3.272764785693974e-01   -4.411847773329924e-01; -1.069173785647891e-01   +5.333698724052202e-01   +2.225101740126643e-01   -2.540410719587515e-01   -4.022217682695954e-01   +3.904657026833294e-01   +4.494943701500097e-01   -5.761502307294329e-01   +1.167805417468360e-01   +5.157975211275293e-01   -3.019047978517050e-01   -1.910205183125137e-01   -4.962904373374283e-01   +2.114073290148910e-01   +4.385268879745066e-01   +3.124537666247741e-01; +2.014521767013422e-01   -4.970958875992020e-01   -3.977004502472976e-02   +2.792861772552699e-01   -1.867506047009677e-01   +2.596837530095579e-01   -4.826355917052103e-01   -1.779308739307340e-01   -1.721688301579304e-01   +7.572793344413514e-01   -3.374436750234898e-01   +5.115422732679150e-01   +5.785287475647674e-01   +1.246305042392005e-02   -2.702102916975803e-01   -5.210159095183958e-01; -5.528088193560798e-01   +2.913623505322146e-01   -3.724371231707237e-01   -3.813701391829156e-01   -1.611376737179456e-02   -5.569833727059327e-01   +2.186415779294203e-01   +5.095974511720140e-01   +7.088628570496328e-01   +1.401754935340886e-01   -5.684799075991136e-01   +1.330756039116605e-01   -1.694847160685461e-01   +5.765234547298626e-01   +2.748672027881768e-01   +4.925707314975435e-01; +6.163868386416264e-01   +1.157267582971394e-02   +2.307467205973516e-01   +2.932416850897522e-01   +1.510375714373131e-01   +3.541970299706805e-01   +8.589442593537325e-02   +5.689013159508852e-02   +3.746939844874832e-01   +5.997909741552639e-01   -5.773999458724232e-01   +2.887921820347076e-01   -1.843218938401920e-02   -1.593494485547143e-01   +3.236553091456099e-01   -2.250667720938898e-01; +2.256689038907403e-02   +5.192321093502793e-02   +1.328272868672342e-01   +2.720929451082688e-01   +3.151709470759636e-01   -2.931100298250436e-01   +1.307513987214088e-01   -3.400883413581484e-01   -2.581591209668324e-01   -4.775336210411126e-01   -5.669448285460730e-02   -6.600609532771088e-01   +1.613682670523930e-01   -6.186983918172224e-01   -2.430719870256780e-01   +4.897900136711843e-02];
L1E_L1I_iGABA_netcon = [-3.879025163943708e-01   +4.367459240668433e-01   -9.152560142520638e-02   -1.182573800798964e-01   +2.154174353887645e-01   -4.789897106071555e-01   +1.175797119491134e-01   +3.692274622838831e-01   -9.029382412458986e-02   +6.300063497842034e-01   -9.353160907745805e-03   -7.650652285767570e-02   -3.148731284540118e-01   +5.735763519797471e-01   +1.603021739608849e-02   -6.811422125299572e-01; +7.243044046552677e-01   -1.485883574190080e-01   +3.194853135212116e-01   +5.256595849154039e-01   -2.489463516772916e-02   -4.738234528391066e-01   +3.099509909257558e-01   -4.425226067328056e-01   -4.359499087450168e-01   -6.179767258845098e-01   -2.427630112147226e-01   +1.290561389784277e-01   +6.023929032582394e-01   -7.948548409832421e-02   +4.843073114701678e-01   +8.800598823792687e-02; +6.394991064793316e-01   +1.367857804092439e-01   +4.399363729498692e-01   -5.058878740001711e-01   -8.058963920135802e-01   -1.746354884026869e-01   -2.061154682731543e-01   -3.361836517388136e-01   -4.070122366658421e-01   +4.160813037754520e-01   +4.743290609727297e-02   -3.988536472689816e-01   +5.061404985038309e-01   +4.828983323808834e-01   -7.367961356336541e-01   -1.979509027569418e-01; -1.928814526149120e-01   -1.978657250950679e-01   -1.778087096875332e-01   +3.550095704067903e-01   +1.248411759802181e-01   -1.559223209904917e-01   -4.521874344396550e-01   -3.081988959004504e-01   -5.728701003156927e-01   -4.243943255589954e-01   -3.373864046703131e-01   +7.567387841112937e-02   +2.226690246663365e-01   +2.811558306384361e-01   +2.378323439755093e-01   +2.033813426516745e-02; -6.662694697335587e-01   +9.854896131463495e-02   +2.816267703094981e-01   +6.300999042206062e-02   +1.784030079083765e-01   +2.715122780329029e-01   +2.022157576842784e-02   -3.015217217022432e-01   -1.072934899141159e-01   +3.252621437676936e-01   +4.243774233800549e-01   +5.067014469762545e-01   +1.659813880006877e-01   +4.698947870259617e-02   +4.233846023208394e-01   +7.369988111650808e-02; +4.369794062838556e-01   -7.299010343513052e-01   -2.796763929785726e-01   +1.697879416374353e-01   -2.022948236382789e-01   +6.143728047641678e-01   +4.164287888622902e-01   +1.491431878009161e-01   -3.545683758498082e-01   +2.798991003918425e-01   +4.518551045354709e-01   +9.845486611031862e-01   -1.826033509571610e-01   +3.465589590433473e-01   +1.089853103736287e-01   -1.507488220579392e-01; +4.141175994776559e-01   +5.534558324265383e-01   +5.823882458051914e-01   +6.823857968211695e-01   -1.327785009644183e-01   +4.313993280313367e-02   -2.144738240664871e-02   -2.115679967625504e-01   +3.794976190774557e-01   -5.539708127191496e-01   +4.397958766908879e-01   +4.079683514412912e-01   -4.939635941270231e-01   +3.046592561973288e-01   -3.907043543438546e-01   +7.053650283772042e-01; +4.241180369889452e-01   +4.148055962891137e-02   +3.147784505098334e-01   -7.052680091518816e-02   -5.254211537318534e-01   +2.074578489818856e-01   -2.203689020476344e-01   -3.488518404314435e-01   -1.539210495626185e-01   -3.056807391319032e-02   -3.528465748371659e-01   -4.794278768629693e-02   -3.228092407232232e-01   +5.096828783817643e-01   +1.423657199996290e-01   +4.094189183223149e-02; +2.504476619468625e-01   -1.853901632010381e-01   -8.808022919291367e-01   +1.701683818563753e-01   +1.755448612291218e-01   -7.673024154623800e-01   -5.372302581075505e-01   -1.000000000000000e+00   +5.058085765985318e-01   +5.282278427675922e-01   -1.145177713458934e-01   -7.490559334866764e-02   +5.121775146781693e-01   +4.141162960429900e-01   -3.031134611001162e-01   -4.185043812520015e-01; -4.476332160397034e-01   -1.965237779335206e-01   +1.171192196373743e-01   +8.822352579633791e-02   +6.588232130082359e-01   -7.717268260414749e-02   -3.803159509683495e-01   -1.053712407008859e-02   +7.155501676067214e-01   +4.045054120724665e-01   +6.530977631478815e-01   -5.140453398539815e-02   +2.110638923089124e-01   -4.434601608023375e-01   +7.596747692421417e-01   +7.902440325284013e-02; +2.496965415792740e-02   -2.494577354034332e-01   +2.156638372698773e-01   +7.963582463390621e-02   -1.294223839188803e-01   +1.379197739917173e-01   +1.746502958737153e-01   -3.439106049034382e-01   -4.751610706818339e-01   +5.144764664109829e-01   -3.557597216470562e-01   +6.910930574917072e-01   -2.610851891566908e-01   +4.466388857752795e-01   +4.649410694764602e-01   -7.639827383717924e-01; +4.163895514182566e-02   -4.923326110531966e-01   -4.768946443311232e-01   +3.303691604535578e-01   +6.898692320424430e-01   +2.237544263855920e-01   +5.300476932558332e-01   -2.125229554588008e-01   -1.249882978062337e-01   +3.569029724212302e-01   +5.714684981288337e-01   +6.072611451890386e-01   +2.915295832795413e-01   -8.373873188407639e-01   +4.430555313311237e-01   +2.065965292192277e-01; +2.132451177787980e-01   -1.862119459588767e-01   -2.138628718960777e-01   -3.847655431044311e-01   +2.516866604566609e-01   +1.490173087821098e-01   +1.225294911512691e-01   +3.646934934182421e-01   +4.439742738191859e-01   +4.341819034188709e-01   -6.344402488086348e-01   -1.610504969675487e-01   +4.139616542043017e-01   -2.658012174317301e-01   +1.756724269189441e-02   -3.150400555913644e-01; +2.691816214692060e-01   +1.851202568505329e-01   +1.338329006202106e-01   +1.838869590153856e-02   +1.034763149995818e-01   -2.908429828439984e-01   -4.479132386237741e-01   -3.587315141416328e-01   -8.929611340834920e-01   -1.988016376569433e-01   -4.185976407322372e-01   -3.845631041565268e-01   +4.679769314046587e-01   -1.611763238229299e-01   +2.544348935805071e-01   +3.368549107009767e-01; +3.467094785472085e-01   -4.169977534660037e-01   +2.969303678374658e-01   -5.307246128471458e-01   -6.275607167454950e-01   +6.599139528773804e-02   -9.919416390094384e-02   +1.993136750525648e-01   +5.880579188384838e-01   -4.945330242202144e-01   -1.093888323436707e-01   -6.165878880062099e-01   +2.326490910693654e-01   +5.382106933582749e-02   +6.913194366829220e-01   +6.329055368684934e-01; +5.933589703584645e-01   +8.675327179199891e-01   +1.403239140993394e-01   +3.780052847421198e-02   -3.903386293140497e-01   -3.710481305097989e-01   -2.423681479269575e-01   +4.529626068734115e-01   -4.792387934137997e-01   +3.710700406941903e-01   +1.023830944190631e-01   +4.040011877747540e-01   -5.992477812964520e-01   -3.592596799530286e-01   +5.259788508646189e-01   -5.312252180451386e-02];
L2I_L1I_iGABA_netcon = [+4.055540734632808e-01   +1.295976775726576e-01   +5.163488363025949e-01   -8.493151545950702e-01   +3.882651140383182e-01   +5.117654119838966e-01   -2.287183896432214e-01   +5.175713320910470e-01; -6.921194496710144e-01   +4.014109413405378e-02   +1.724721717406850e-01   +1.776471166719212e-01   -4.033507715730417e-01   +2.263722720922145e-01   +4.851248300664839e-01   -2.228816717621990e-01; +6.392573687799574e-01   +2.365499737506473e-01   +3.578499631260592e-01   +6.637824504846335e-01   +4.462944590420929e-01   +4.150561352801995e-01   -2.777083297541910e-01   -1.000000000000000e+00; -6.896107641687771e-02   +7.232481818701464e-01   +1.685262992962378e-02   +2.879752236541538e-02   -1.100034341322197e-01   -5.410440603559307e-02   +3.884722934530381e-01   -9.864706891741034e-01; +1.922298100305207e-01   -1.723298855612759e-01   +9.320652886050811e-02   +1.203454322199677e-01   -3.706548180534326e-01   -2.140077133717516e-01   -2.801814505498342e-01   +5.714880639112566e-01; +3.023166193800917e-01   -3.334857844634813e-01   -9.560070201171003e-01   +7.754782946993143e-01   -8.583944278442962e-02   -3.092018646311772e-01   +9.107926949520658e-01   -5.214617848414963e-01; +4.640685287716432e-01   +6.224856204371436e-01   -2.575099739100957e-01   -4.031572463493425e-01   +3.393954675950724e-01   -7.885078035385733e-03   +2.662135262085430e-01   -4.269245807923507e-01; +3.703703684325473e-01   -5.698268349990301e-01   +1.688739006255969e-01   +4.469100549743047e-01   -2.490686666543741e-01   +2.069250228325059e-01   +5.873586310346255e-01   +2.381134159493521e-01; +2.852353226206300e-01   -6.601648593195724e-01   +1.545612758197047e-01   -3.979234656142507e-01   +1.801685097776455e-01   -4.589990358334121e-01   +1.370679965423205e-01   +7.526182607139774e-01; -3.161956957455438e-02   +1.939750491694280e-01   -7.788609593566619e-01   -1.596742377110835e-01   -6.932684599245406e-03   -6.715386215515989e-01   +4.688770402109415e-01   -5.552057932652926e-01; +5.492945687715713e-01   +3.514893696160454e-01   +7.362140333038587e-01   +2.031459806920816e-01   +1.312903234334090e-01   +2.479863994748680e-01   +6.552664323956056e-01   -1.588928770838530e-01; +1.689706332822144e-01   +5.860699457276813e-01   +5.486565111069204e-01   +2.813352478160802e-01   -6.136497008865848e-01   +4.273070938798355e-02   -6.443447636201814e-01   +9.316592175807074e-01; -1.892477828904127e-01   +9.508250287560259e-01   +8.270110939490293e-01   -7.187827902601694e-01   +1.844226771224429e-01   -1.183130264584135e-01   -4.565150892761086e-01   +5.623176207505985e-01; -5.802007439804093e-01   +6.656936099111271e-01   +2.542957684670278e-01   +2.714688422216703e-01   -4.840256552939039e-03   -5.073919941275132e-01   -2.194478293938042e-01   +3.183918933387441e-01; +4.722162717755256e-01   +4.878576729348802e-01   -4.977305390163130e-01   +2.563492839774025e-01   +7.690129264860278e-01   +7.563237904951200e-01   -4.610022143457754e-01   +8.870025998532006e-01; -4.301280403570178e-01   -1.382743889494304e-01   +6.365830396006180e-01   -5.219415872176038e-01   +5.027861991336660e-01   +6.062082534394438e-01   +3.655813102831040e-01   +2.791394897282082e-01];
L1I_L2I_iGABA_netcon = [+3.630594830282674e-01   -3.924172442126836e-01   -3.390327739854281e-01   +4.684474216803977e-01   +1.683209487609532e-01   -2.182730195026758e-01   +4.606654829617592e-03   +1.000000000000000e+00   +4.660094307298013e-01   +3.164453763743074e-01   -3.858008785480507e-01   -5.990643159541289e-01   -7.275945333716081e-02   -5.135460578033478e-01   +7.068527024199961e-01   +8.672025180102283e-01; +2.191268611101147e-01   -3.518023279430522e-01   +7.515083911809695e-01   +1.719127117999117e-01   +8.708147407059753e-02   +1.530591110582931e-01   +1.211846210404205e-01   +2.075654069065240e-01   -4.641097062400349e-01   +7.681901654972977e-01   -4.361485633743151e-01   +6.314422303494649e-02   +2.895985164574347e-01   +5.077217870822827e-01   -6.074282811437749e-01   +5.392387284655170e-01; -5.735535030989463e-01   +6.910614600549794e-01   -3.880183835124965e-01   -1.503478524969157e-01   -3.148139069341977e-03   +4.875712902171280e-01   -1.503941520028878e-01   +4.662006819740791e-01   +5.196319128567669e-01   -3.633192028870688e-01   -6.863500232000878e-02   +5.869126067453460e-01   -4.691023036038616e-01   -1.535703582603818e-01   +6.091140586553258e-02   +2.367720888069922e-01; -3.629384405278849e-01   -1.245804163138894e-02   +5.130680045703341e-02   +3.895526598997848e-02   +2.895330104136123e-01   +5.698721709233825e-01   +4.014414681346829e-01   +1.266515588024237e-01   -2.887833053427016e-01   -3.148675613085872e-02   +4.244249968097774e-01   +3.433100213434238e-01   -3.556201938279555e-01   +5.908883702491045e-01   +1.685120277479242e-01   +1.878359229099664e-01; -5.910943806290479e-02   +7.106328453070404e-01   +6.479634610424549e-01   -5.650849686074635e-02   -5.444680839696717e-01   +3.250649881066484e-01   -3.270628029915917e-01   -2.818879136822453e-01   +1.371486073274742e-03   -6.588655975298445e-01   +5.039816684910464e-01   +9.802067561959431e-01   +1.099766074099791e-01   -1.985044763878462e-02   -6.645423682300401e-01   -6.977266107971057e-01; +5.683270130127117e-01   -2.909581584544485e-01   -1.263527831570469e-01   +6.565783492630488e-02   -6.754059606349078e-02   +6.590602927376951e-01   +2.415846653485097e-01   -3.938002425672432e-01   +5.694537478854550e-01   +4.681697990677530e-01   +8.561694544740511e-01   +5.753548073835925e-01   +2.902429593508533e-01   -1.103208212990458e-01   -7.596637466446240e-01   +4.808457069520444e-01; -4.727533976804080e-01   +1.374694577232471e-01   +8.181913712097851e-01   -2.483854923832560e-01   -5.698340722828416e-01   +7.390585675594081e-01   -2.751533658739930e-02   -4.945250309305627e-02   +5.661092761891112e-01   +9.610455551800269e-02   +1.863900355104276e-01   -2.839287127900246e-01   +1.686629327783223e-01   -1.352314197184297e-01   +1.616768187199577e-01   -7.917358747477989e-03; +3.078118282395799e-01   +3.028743197059957e-01   -5.501108891832909e-01   -5.305749399269752e-01   -2.938979292288362e-01   +4.389683752730107e-01   -6.805739140309731e-02   +1.385693177706938e-01   -2.244686672653529e-01   +6.155655903895477e-02   -3.511561031811202e-01   -1.347229367402389e-01   -2.887180959897320e-01   -6.634940953643060e-01   +2.300024024913378e-01   +1.177813558512886e-01];
L2E_L1E_iAMPA_netcon = [+5.355326946671274e-01   +3.756357097165747e-01   -1.060192820810649e-01   -3.743686777641848e-02   -8.986712788953336e-01   +5.398934701136939e-01   +6.076107291115640e-01   +6.278740500379265e-01; -6.665814775860250e-01   +7.381803645709296e-01   -1.436126964272857e-01   +4.267241039501779e-01   -2.214420903604693e-01   +2.183016089748572e-01   +8.993090183851634e-01   +6.331255166082501e-01; +5.329603071626616e-01   -1.848047439824943e-01   +8.351607633095790e-01   +9.287407523130708e-01   +5.604270902123990e-01   +4.894636328070007e-01   +4.925223195353437e-01   +6.495108068417380e-01; +4.712629177941496e-02   +3.504100589666043e-01   +8.175815123037998e-02   +4.487197525287779e-01   -1.536714998058025e-01   +5.834915192171763e-01   -1.600103776099961e-01   -7.004825763804809e-01; -7.258319631883944e-01   +7.126580114852341e-01   +8.193205636761421e-01   -2.950092637963712e-01   -8.458803024221043e-02   -2.449319575405968e-01   -1.697999532762992e-01   -7.219524832659989e-01; -5.555045934071238e-01   +3.470300604291056e-01   -8.781372328030753e-01   -2.963391990005975e-01   +2.828312949950695e-01   +3.449378143641739e-01   +4.159643282790290e-01   -6.553689644666304e-01; +1.296862222048775e-02   -7.234257550914303e-02   -3.744217636822082e-01   +3.471233687996934e-01   +1.881147436065191e-01   +4.108852615945184e-01   -2.074431367602667e-01   +1.060425622706491e-01; -2.572190531175010e-01   +4.670380349846372e-01   +4.875927324861890e-01   +4.849157058312858e-02   -1.393404162801384e-01   -1.000000000000000e+00   -2.326404312956764e-01   -1.833320688323867e-01; -3.327276745726301e-01   -5.986719722261257e-01   -1.552402264260051e-01   +2.057422160174377e-01   +4.039679213674956e-01   -2.568491458853174e-01   -9.080866541624091e-01   +2.488453447235828e-01; -3.243845977435198e-01   -7.520622714607091e-01   -4.313514622844057e-01   +9.219166820709774e-01   +2.285038291393730e-01   +6.628119247652583e-01   +7.779155549190273e-01   +3.168573805096264e-02; -1.919151172630670e-01   +6.189346062532108e-02   +1.328549773345588e-01   +3.206248002901959e-01   -1.096176159846299e-01   +2.420960025426859e-01   -3.678342655923285e-01   -3.803514082866668e-01; +6.452778619222366e-01   -6.463982346838768e-01   -2.755216425062040e-01   +2.692236514018265e-01   +6.135997570528666e-01   +1.752414459304402e-01   -7.252684591394180e-02   +4.541389004725470e-01; -1.198398083045671e-01   +3.093632814947734e-01   +5.252207591019907e-01   -4.368312262867721e-01   +5.055340974341393e-02   -6.727235140115895e-01   -7.806793493092482e-01   -3.437810531961542e-05; +1.189092345991811e-01   -1.324130241465901e-01   +8.012112879020931e-01   +2.022210530003698e-01   -6.869810443324518e-01   +1.677815583050628e-01   +1.425367625156745e-01   +2.064103367896299e-01; +8.089626003668146e-01   +1.872238968157998e-01   -3.341820204472420e-01   -5.485700336493474e-02   -1.530495254507969e-01   -2.513969282049314e-01   -1.361116973046377e-01   +4.144992652485580e-02; -5.207182752018503e-01   +5.062590481117267e-01   -9.358102038324814e-02   +5.689163282990992e-01   -1.183476359482569e-01   -4.952119580266975e-01   +5.778484296486812e-01   -7.392677148206556e-01];
L1E_L2E_iAMPA_netcon = [-1.667696523534708e-01   +8.394257956825520e-01   +6.976625830641858e-01   -4.359954876873796e-01   +1.441596823425410e-01   +6.774714712631605e-01   +1.321496575892598e-01   +6.224477097142679e-01   -1.447298443804599e-01   -3.986085075273051e-01   -1.789412005779281e-01   -8.249795903651530e-01   -6.079915609954222e-01   -3.492465040682754e-01   +7.405640579716012e-01   -9.187444330241221e-01; -2.624224571897664e-01   +5.979480167447519e-02   -2.749415817307666e-01   +3.734969827648896e-01   -5.994445171918659e-01   +5.835423109016177e-01   -7.996576844126122e-01   +4.067478979140577e-01   +3.794220356005932e-01   +9.144547510550509e-01   -2.847953118643676e-01   +2.369729200413708e-01   +8.442266359920125e-01   +3.496613638408133e-01   +2.759110447093371e-01   -4.595752362157346e-01; -1.017383073186791e-01   -7.684841389511370e-01   +3.311976437678381e-01   +5.034764057715366e-02   -7.864841318188247e-01   +6.391624606780338e-01   +3.105459611949860e-01   -1.598510637649365e-01   +4.358131349266403e-01   +1.984237856154405e-01   -8.134699491943133e-01   +7.852477161496014e-01   +7.900403632877423e-01   +1.082762935387006e-02   +5.361922862249373e-01   +3.822888639107165e-01; -4.284711574338356e-01   +4.531415559051388e-01   +4.142925009275733e-01   +8.098466703428204e-01   +3.020681148703006e-01   +1.467198951192785e-01   +1.575362885103080e-01   -1.534109476698886e-01   -1.895398442877775e-01   +2.185478492294156e-01   +2.635439320641040e-01   -4.878937434502315e-01   -3.028271838173260e-01   +9.079962814736187e-01   +7.358317945086125e-03   -5.105481649276359e-01; +2.702908171077841e-01   +2.426394069648156e-01   +5.804438814064622e-01   +4.785677001506558e-01   +1.000000000000000e+00   +5.061104604475748e-01   +6.699038387315573e-01   +4.260288116907352e-01   -5.327096378182035e-01   -8.286143520255269e-01   -5.394741556150642e-02   +5.849195213341525e-01   +1.268356795193860e-01   +4.990778000344247e-01   -5.629522728244483e-01   -3.813470217488515e-01; -4.469790127444274e-02   -2.353220385532444e-01   +4.888945091501624e-02   +5.661773068331949e-01   -5.523426596266516e-01   +7.577949666841832e-01   +2.270442731857495e-01   -3.465505171084117e-01   +4.495751269046174e-01   +6.954753211536832e-01   -2.881360834966167e-01   +5.782058290733009e-01   +5.615724741944819e-01   +5.445552493437648e-01   +5.070401466628222e-01   +4.383229595317653e-01; +5.076083013125445e-01   -1.025062165836859e-01   -1.833565909638644e-01   +4.906270263753613e-01   -7.753495346827759e-01   -9.399531471190090e-01   +2.005634389552057e-01   -6.128299164674910e-01   -5.702971184526031e-01   -1.337698417265734e-01   +5.617392237485128e-01   -1.407223960496181e-01   -1.982182544067247e-01   +5.690138551363009e-01   +8.254517188661241e-01   -4.616819489562610e-02; -5.944584677571373e-01   +2.898260725161840e-01   -2.158560642688235e-01   +9.479458504699605e-02   -8.010849445217519e-02   +4.336151112454352e-01   -1.005816553184613e-01   +6.709474442247638e-01   -1.925396701099868e-01   +2.739206314709801e-01   +3.139590908235611e-01   +3.128086230631182e-01   -1.984340494346293e-01   +4.626369841011665e-01   -2.671225259465985e-01   -2.981202774683234e-01];
L2I_L2E_iAMPA_netcon = [+2.245340847860141e-01   -2.068676363087812e-01   +4.892408747804531e-01   +1.102260193293543e-02   -6.133724473934061e-01   +1.569704185975709e-01   -3.735472225473006e-01   +5.928849518773563e-01; +3.013373383455832e-01   +1.623312063458587e-01   +4.315416732038205e-01   -5.219255300567200e-01   -3.844953469892924e-01   +5.922229757568677e-01   -1.925523673810668e-01   +9.908104744093479e-02; +2.168433994590706e-02   -5.599679152298735e-01   +2.225655154910957e-01   +3.697184615798522e-01   -7.199117210757415e-01   +1.450063657977315e-01   -1.122016702794811e-01   -1.927012273913155e-01; -2.635894102223974e-01   -3.493578285838803e-01   -3.361336899692424e-01   +1.610378076971781e-02   +1.134105062117639e-01   +1.650974491984796e-01   +8.566170494300725e-02   +1.645381691229054e-01; +8.236241065165700e-02   -1.130711364534120e-02   -7.933137738011873e-01   -2.209014290321087e-01   +1.991057897905474e-01   +1.294472476147919e-01   +1.011880177444583e-01   -2.874524065556324e-02; +9.158512614846567e-01   -7.420598687594651e-01   -6.432637368372141e-01   +1.802732712689917e-01   +5.150071323161911e-01   -1.000000000000000e+00   -7.965976802220630e-01   -2.084686487868358e-01; -1.672334542765932e-01   -5.836957524996070e-01   -4.927142484878906e-01   -9.221126720699042e-02   +6.242436915906904e-01   -2.009412342077339e-01   -7.580178065249291e-01   -7.051949936605448e-01; -3.967951090310052e-01   +2.560862300097169e-01   -9.653683205607111e-01   -8.191650506105499e-02   +1.318081811528400e-01   -2.821062592494388e-01   +6.524603737193743e-01   +1.037675285318414e-01];
L2E_L2I_iGABA_netcon = [-3.279029366109681e-01   -2.762832135900161e-01   -3.769183157927448e-01   -2.243446316133634e-01   +3.537996732038752e-01   +6.160501065731444e-01   -1.089719557175303e-01   +9.825657377552041e-02; +7.341863856472480e-01   +1.158993936215098e-01   +5.155955870705076e-01   -5.893656648070523e-01   +4.137427744043808e-01   -4.775313013677500e-03   -1.994293293077095e-01   +2.110510664339573e-01; -3.769687323770747e-02   +3.123552061856501e-01   +8.400582269376888e-01   -7.755062602816288e-01   -2.173513376033112e-01   +1.000000000000000e+00   +4.758755854902422e-01   -4.598987617982784e-01; +5.251659261454206e-01   -3.614026970666248e-01   +7.944500436581955e-01   +3.256393049891939e-01   -8.053333216322031e-02   -3.996635437962003e-01   +2.719672850858812e-01   -1.710542615382374e-01; +5.207471881342934e-01   +1.274064820607821e-02   +2.071403243170374e-01   +4.421889267109482e-01   +7.199351553443915e-02   +2.399068079621456e-01   -5.884110035289468e-01   +5.190160653882866e-02; +1.073051405416263e-01   -7.456818005918407e-01   -7.490015084562848e-02   -2.723820818439887e-01   -6.758633773244408e-01   +2.840032634350680e-02   -5.985150436392658e-01   +4.659112725491805e-01; -2.870845077248360e-01   +6.155266270582148e-01   +3.259634975393504e-02   +9.802681854692107e-02   -1.590056139586738e-01   -2.775004798239487e-01   +1.858441055276932e-01   +1.197514044618233e-01; -5.744744077473328e-01   -2.495483684445381e-01   +9.873482159616651e-01   +2.025794136077292e-01   +5.024262089730543e-01   +1.211154888105731e-01   -2.780906857842889e-01   -5.676409122974988e-01];
L3E_L2E_iAMPA_netcon = [+5.723829811436398e-01   -1.218601322754819e-01   -3.862787641130660e-02   -6.374977363135664e-01   +9.677749135193398e-02   +7.296458700692780e-02   -3.915751092420198e-01   -3.261476588420614e-01   -5.386444008303839e-01   +8.578383326529471e-01   -2.313472888987292e-01   +7.864757905493425e-01; +4.672424931105963e-01   +4.704031670412986e-01   +3.281610627577201e-01   -6.109389034820044e-01   +1.794535269959747e-01   +9.857738560810812e-02   -4.498660516316541e-01   +4.315672417028901e-01   +9.320645542400833e-01   +2.595849436337083e-01   +6.897868654007582e-01   -4.149660558490429e-01; +2.556246710817787e-01   +1.606637273368444e-02   +7.168049549599561e-01   -3.080702657899988e-01   +6.141524647776603e-01   +4.219290473323647e-01   -1.181958470464728e-02   -2.982870033097364e-01   -2.968197609521191e-01   +9.633841759429512e-01   -5.310421278104491e-01   +8.907998632565856e-01; +4.313468113995472e-03   -6.334010104674499e-01   -6.502408904805742e-01   +9.319565881893542e-01   +2.097725998037641e-02   +7.755569119392850e-01   +3.412207433808667e-01   -8.130821835568572e-02   +3.049435429125615e-01   -5.285903731374485e-01   +4.579793714201097e-01   +8.051504701016950e-01; +2.515030978835366e-02   +1.053465692252137e-01   -5.860335175505110e-01   -5.523728838633222e-02   -2.065092499051002e-01   -2.452850839903784e-01   +9.899271955653531e-01   -7.315192652044401e-01   +3.836407097512696e-01   -6.384574017829346e-01   +5.802039738501272e-01   -6.606331997722965e-01; +1.546912209313382e-01   -5.249779230731970e-01   -5.906394793282718e-01   -6.956329564077888e-01   +5.099367621666662e-01   +7.336641043283398e-01   +1.060436185391974e-01   +8.744004677048332e-01   -6.672188734782392e-01   +5.136037747025037e-01   -5.552980256698301e-01   -9.141872071853776e-01; +9.043044109460314e-01   -2.237528759620785e-01   +3.379936569554997e-01   +2.151642810445480e-01   -1.357458593710425e-01   -1.415319207149473e-01   +3.598447874841254e-01   -6.159853687918925e-02   +7.897200799937826e-01   +1.323478818571663e-01   +3.297443172199044e-01   +7.905362123020163e-01; -1.446367962409342e-01   +2.306939193955185e-01   +8.935050738572931e-01   +1.000000000000000e+00   +4.384661458748171e-01   +2.557429418113348e-02   -2.627236619235300e-01   -3.229451730024112e-01   -5.638794624045792e-01   -1.525824547888325e-01   -9.896332193151840e-01   -8.225108589648649e-01];
L3I_L2I_iGABA_netcon = [+6.001533679243020e-01   -5.863302141446812e-01   -8.925295655699574e-02   -1.468823330245203e-01   -6.209750526329757e-01   -6.321224921589796e-01   -8.482502634780937e-01   +3.201520535304548e-01   +5.038813062006311e-01   -8.526557988214818e-02   +5.982342937111546e-01   -8.065957507478489e-01; +2.194393421818056e-01   +5.488209971309521e-01   +2.349447426468453e-01   +4.913307486270747e-01   -2.420493503824513e-01   +3.526128315334557e-01   -4.897392912123435e-01   +1.000000000000000e+00   +5.405723229999050e-01   -2.707352430994735e-01   +1.536797234859923e-01   -1.268734753562506e-01; +3.048650353166009e-01   -2.689579834939351e-01   +7.814153865948791e-01   +1.331183481976188e-01   -3.710791569139048e-01   +2.399202787124960e-01   +7.024424456268289e-01   +1.239160828841495e-01   +3.983265707900355e-01   +6.554069039196451e-01   +1.170830603261125e-01   +7.408844020109102e-01; -2.398167326678932e-01   -1.413203721181878e-01   -1.615147310921870e-01   +6.118901374289948e-01   +4.481762077075709e-01   +4.338901857046316e-01   -1.057724695293517e-01   -5.623802165345186e-01   +2.161427684988971e-01   -4.756793060012027e-01   +1.616547346239131e-01   -6.416056716331465e-01; +2.459022899007747e-02   -5.746907034408743e-01   -4.651834391337063e-01   +1.516372885146812e-01   -4.985308662928332e-01   +3.045278115129226e-01   +7.692895860115629e-01   +4.618271370688569e-01   -3.296034736145562e-01   +2.236134821604353e-02   -4.002321761431183e-01   -6.624341215184680e-01; +5.249902952794370e-01   +1.944276975749799e-01   +3.476843023895494e-01   +4.034969196748170e-01   -2.038441302087381e-01   +3.321810234365673e-01   +1.940087575443118e-02   +5.533654335365845e-01   +3.159167986335924e-01   +2.889699001859666e-01   -5.685549682269484e-01   +3.370375233866337e-01; -5.149627798146781e-01   -4.873799204365652e-01   +2.909043353088684e-01   -7.391787001601690e-01   +2.910542349092196e-01   +1.604226164623954e-01   -9.441643794573648e-01   -4.990740444725854e-01   +5.720359034236295e-01   +5.346605569175772e-01   +1.229483466843254e-01   +8.347264734215049e-01; -3.514929901174849e-01   +2.289975424477987e-02   +7.634718525494260e-01   +9.776239740904998e-02   +3.124506529858382e-01   -9.727154912349387e-01   -7.454427059829710e-01   +7.940103082569617e-01   +2.471186308775659e-01   +4.087290113105064e-01   +3.511690836169252e-01   +8.395272582308502e-01];
L2E_L3E_iAMPA_netcon = [-4.231746221859704e-02   +3.841714612520716e-01   -1.635601631931614e-01   +3.613287631658748e-01   +5.829520057918146e-01   +1.985102795635320e-01   -4.275933751787327e-01   +1.291244495654547e-01; +3.819310521893369e-01   -1.761054271929460e-01   -2.264644777193155e-01   +6.299970188037444e-01   +5.027531395628865e-02   +5.653287494706013e-02   -4.841951188980094e-01   +6.729545626038363e-01; -3.306014736190662e-01   -5.295380587765275e-01   +4.171733367525317e-01   -3.807796114506087e-01   +6.487798546931759e-01   +7.756168259121480e-01   -1.806605882490165e-01   +8.346527150696162e-01; -1.000000000000000e+00   -2.723140923885299e-01   +5.159597388121183e-01   +2.521897021448204e-01   -7.808422677514023e-01   +2.802243501957783e-01   -6.790668788461474e-03   -3.859142221497051e-01; +6.599112703458387e-01   -6.279125718585516e-01   +3.521797547611231e-01   +1.668758409542223e-01   -3.400121855361225e-01   +6.009970736631051e-01   +9.253744244287889e-01   -7.751247452240505e-01; +4.258792933435506e-01   -3.088341724024578e-01   +9.514161895853134e-01   +2.661453194224407e-01   -1.492454902474426e-02   -3.790512352864785e-02   -5.188651457280861e-01   +1.379454111020372e-01; -2.459749566705288e-01   -5.901907943595264e-01   +4.394948040435942e-02   +3.055940749431805e-01   -1.381568714158118e-01   +1.821764265557516e-01   -5.390789444465913e-02   +1.278940104295310e-01; -1.264236603446892e-01   +3.419588133620259e-01   +1.859587466120504e-02   +7.889063990515938e-03   -7.523014541052271e-02   -6.930834466549624e-01   -3.536536404702287e-01   -7.286206986194240e-01; +3.745591778977084e-01   +5.190201047078543e-01   +2.872152000600744e-01   -2.919593581127313e-01   +2.753829279397350e-01   -2.589781103924373e-01   -7.091260224214481e-02   +2.845543619280377e-01; -1.984887913244884e-01   -5.141069549808490e-01   -4.966403614176282e-01   +1.687056283102943e-01   +4.262863973135252e-01   +2.735342282279014e-01   -5.718867635190510e-02   -1.545838802600934e-01; -2.286846229744877e-01   +7.344460595189445e-01   -6.936001175141929e-01   +5.509506103606202e-01   -7.090364583540648e-01   +4.713523742278042e-01   -3.383157091273918e-01   +3.200106057846513e-01; -5.434839393161441e-01   -9.933446512884263e-02   +1.041231875358068e-01   -2.436571045518825e-01   +6.364110598679266e-01   +2.686039949254339e-01   -3.238339199198392e-02   -5.829818031372206e-01];
L2I_L3I_iGABA_netcon = [-2.044152163869696e-01   +4.725234478774647e-01   -2.471606882072101e-02   +2.268050794211132e-01   -4.627486856039963e-01   +5.346637952320429e-01   -2.337014183202391e-01   -3.991066510725458e-01; -3.753067972667858e-01   +1.000000000000000e+00   +4.178546787521009e-01   +6.254868490115360e-01   +1.492032086641440e-01   +1.471612834338470e-01   +3.221915224402353e-01   +6.464324854872657e-01; +9.950073017440761e-02   -8.134696044188030e-01   +1.055300805213477e-01   -2.427313148644120e-01   +5.910168327959422e-01   +3.822814930878047e-01   +6.158347656996997e-02   +8.637556372094572e-01; -4.925877122310839e-01   -3.398154481341141e-01   -2.149841135463560e-01   -9.785024995158019e-02   +8.616721879385948e-01   -4.082225089773578e-01   +1.945346309567868e-01   +1.663943008327123e-01; -3.102175960104965e-01   +2.812947021004810e-02   -8.605226253722624e-02   -5.722556322990894e-01   +2.359399143375003e-01   -2.228344971883129e-01   +3.702027558237314e-01   +5.599000692965454e-02; +4.734839797840106e-01   +9.391846522403073e-01   +3.280681186454180e-01   +4.537916067153485e-02   -2.299271224460313e-01   +2.779236672277908e-01   +4.464110139682174e-01   +6.164500210127259e-01; +5.365139534862796e-01   +7.094939620096542e-01   -1.398006160909839e-01   +3.631089418282415e-01   -4.477957114659348e-01   -4.553948754427553e-01   +6.477430094749136e-01   -5.208638684711434e-01; -4.359264140296273e-01   -1.852079039993946e-01   -2.883220533518605e-01   -1.234640680059542e-02   +6.340826521849255e-01   +4.135507960005484e-01   -2.899048009724528e-01   +2.071737091624203e-01; -9.407088163754343e-02   +5.543006559682012e-01   +3.023489908914844e-01   -5.559073536333454e-01   -7.030740151107843e-01   +5.612494090677247e-01   +4.562204063865570e-01   -1.067109160897137e-01; +3.065025159486552e-01   +9.908202647930664e-01   -3.347363148547047e-01   -5.007777001891063e-01   +6.097115092605616e-01   +3.484182133131665e-01   -7.945178405253047e-01   +2.598935741297778e-01; +3.884822212571890e-01   -4.979236389935360e-01   -2.090034233840327e-01   -2.150787411154527e-01   -4.351423437246061e-01   +8.568023364356979e-02   +3.212455049396000e-01   -4.124932407775471e-01; +6.801149906845110e-01   +5.935513311288528e-01   -7.350989526839306e-01   +4.553254152323470e-01   -4.560100161007209e-01   -2.109784806228014e-01   -5.040133520467156e-02   +3.524103466247717e-01];
L3I_L3E_iAMPA_netcon = [+8.187235860808764e-01   -3.168825247500965e-01   +4.474863323963081e-01   +4.357089153137687e-01   +1.509902073887492e-01   +3.270819242655829e-02   -3.799579249659155e-01   -3.156112974630230e-01   -1.785515072386222e-01   -1.251384410700647e-01   +3.765120085684096e-01   -1.157174479745973e-01; -6.073285776425885e-01   -2.264631421514368e-01   +4.835432295087702e-01   -4.912730583748486e-01   -3.389093854944148e-01   +3.133061099406838e-01   +6.643812948855262e-01   +3.446315344557994e-01   +4.820126102004429e-01   +9.228791501295970e-02   +6.337160245859008e-01   -2.112351761247514e-01; -1.493944646196446e-01   +5.301510899447127e-01   +4.566800018808549e-01   +3.142656513486354e-01   -3.463163048476856e-01   -3.514030558678179e-01   +7.715170714767653e-01   +7.826485340073809e-01   +8.269155620055426e-01   +1.946075565919804e-01   +1.433370381784486e-02   -2.206889333124745e-01; +3.319924997390206e-02   -9.102840202337703e-01   +1.606803831299337e-01   -2.095474608402256e-01   +1.057595116857076e-01   -5.470554349133191e-01   -2.549108716080286e-01   +1.000000000000000e+00   -5.479094916769849e-01   -9.015270606713960e-01   -2.201295925208787e-02   -3.437518390157929e-01; +2.856263281206474e-01   -2.238844108334534e-01   -2.790775364031221e-01   -6.316020728614890e-01   -3.902821431680288e-01   -9.123929536275786e-01   -1.737692674669780e-01   +6.134064002784981e-01   +3.510351486013585e-01   +3.080818132576102e-01   -5.138150007733148e-01   +7.907923741122956e-01; -1.691149938308817e-01   -5.938480004853842e-01   -2.692288131666877e-01   +1.992206112296386e-01   -3.406351347982150e-01   -4.485195222692536e-01   -7.751078462162884e-01   -2.617888457276097e-01   +6.587402661845150e-01   +9.336129323974875e-01   -5.161872390147161e-01   +8.983271160765073e-01; -5.228253372401842e-01   +3.025598493357754e-01   +5.239661979765566e-01   -3.604028944725726e-01   -1.792963595730145e-01   +3.048578839794900e-01   +1.848180996183176e-01   +3.124710504545477e-01   +1.565527897943481e-01   -6.376487438980762e-01   +2.291334810225524e-01   -8.049284141631750e-01; -3.538196021638667e-01   +7.924575932819735e-01   -8.240001588058132e-02   +8.009009422953860e-02   -3.883164005420366e-01   +1.093455222353971e-01   +9.897750006688125e-02   -4.852664644827150e-02   +6.156753641350433e-01   -6.080761182671826e-01   +4.725332511674932e-01   +5.685638591231292e-01; +2.874194598333520e-01   -3.723304612194101e-01   -4.338093971279807e-01   +5.322818813410817e-01   -5.488836828948072e-01   -9.677597668543721e-01   -3.208569846221275e-01   +6.188157044818543e-02   -2.437018937894528e-01   +3.738955944948255e-01   -5.380493731282609e-02   +5.899326050149971e-01; +3.325656111290753e-01   -5.274034254400747e-02   +2.951148363371324e-01   +3.784275611769987e-01   +5.577917450100366e-02   -1.643839293977477e-01   +6.341604368281637e-01   -4.448538759887665e-01   -6.063483484112261e-01   -4.207651812916027e-01   -3.547168628246608e-01   +8.425480917357054e-01; -8.324530281137428e-01   +9.237275707600828e-01   -3.773467057971968e-01   +3.087391776544659e-02   -3.133217758592149e-01   +8.078622144188555e-01   -2.675133907859527e-03   -2.160701630527840e-01   -1.848600236479080e-01   +5.164501714389295e-01   +9.169384316206994e-01   -9.972698777272757e-02; -8.953111789644124e-01   -1.764292966489721e-01   -2.347778454212562e-01   +6.639866447818232e-01   +5.862236055822960e-01   -1.102870145483627e-01   -7.089076623738163e-01   +2.157981978937620e-01   -7.370805372980310e-01   +3.528673016163280e-01   -4.783837352989966e-01   +3.246541650725780e-01];
L3E_L3I_iGABA_netcon = [+4.164595701000903e-02   -6.093073037564557e-01   -2.369448240238034e-01   -4.681643177578900e-01   -4.575383795562067e-01   -1.000000000000000e+00   +3.692777367335431e-01   +8.901706204380981e-01   +2.947487631681459e-01   +7.181007492143249e-01   +3.983655508707873e-01   -3.929076328959403e-01; +1.980499654618256e-01   -3.156554478686326e-01   +4.079181507097289e-01   +5.318480895131522e-01   -3.434569229337420e-01   +4.670741744830176e-01   +3.472525820560604e-01   +5.024324349040553e-01   +3.850602716969674e-01   +9.371319163913351e-01   -9.785325392892254e-02   +2.141957412082679e-01; -8.314003308846470e-02   -1.193832579970248e-01   -5.715659514759246e-01   -2.512540610327876e-01   -2.330241765668757e-01   +4.704846877241871e-01   -8.365933718431406e-01   -1.403250355859614e-01   +3.470501438731050e-02   -2.255244490036680e-01   -2.848924180918120e-01   -1.727340322786926e-01; -9.928446460763345e-02   -1.142029465899551e-01   +4.598869652897058e-01   +1.183641244112072e-01   -7.221501156845238e-02   +1.250075323576428e-01   -7.406315871481501e-01   -6.872113892648565e-01   -1.324587024403818e-01   +2.557345641364680e-01   -2.076619417081594e-01   -3.559203008023483e-01; +2.974552084440226e-01   -5.176068449190112e-01   +5.352523950018763e-01   +3.184268331873983e-01   +5.338594714060199e-01   +1.927145674376084e-01   +1.961326151021263e-01   -4.380360396272105e-01   +1.537563126803395e-01   +2.644412643190376e-01   +9.999129921732673e-01   +3.461557583210306e-01; +3.212509625172160e-01   +1.154711437454942e-01   -5.071771967416990e-04   +5.572161958573386e-01   +3.738146688233973e-01   -5.762445440580651e-01   -3.832835516946574e-01   -3.112512627510302e-01   +9.766198398291940e-01   -7.588435322543905e-01   -1.699518538750166e-01   -8.786929635471246e-01; +5.844949753531099e-01   -5.952058287948299e-01   +9.731332446333428e-01   -6.609466932050048e-02   -6.410295615627383e-01   -1.750871037418368e-01   +5.818195227806661e-01   +5.111341102600715e-02   -2.536025156695477e-01   -4.409264637276535e-02   -4.409134912036544e-01   +7.910341932612440e-01; +1.248562029816629e-01   -2.725531819511556e-01   -3.106502393718884e-01   +3.344572471696936e-01   +9.211658118038987e-01   +3.514899966379802e-01   -3.508186613337018e-01   -2.686229702635214e-01   +4.864800792053281e-01   +2.537556200448055e-01   -5.368695715289390e-01   +1.428023309094411e-01; +8.812482988522287e-01   +5.928949125295332e-01   +3.441938376205035e-01   -2.141811574523485e-01   +4.743834315908307e-01   -6.282930142001704e-01   -7.418577623598260e-01   +2.125191830375874e-02   +8.098801808454506e-02   +7.493721045469294e-01   -3.810719396001098e-02   -6.318701842231147e-01; +3.112800894092169e-01   +3.769913852058318e-02   +2.740404592692521e-01   -3.534938609612026e-01   +2.998438002707774e-01   +3.821676728872960e-01   +5.059345544304868e-01   +1.121094349197754e-01   -3.231164233701486e-01   +6.917524230603295e-01   +3.775738424979576e-01   -9.408648775294135e-01; +1.722762152857149e-01   -5.615327519145306e-01   -5.726740632750998e-01   -6.532892710361180e-01   +7.011587616797474e-01   -5.585892649480565e-01   -5.884287610699380e-01   -3.047963618647052e-01   +9.404184389511032e-02   -4.377915018491638e-01   +5.471157968378741e-01   +4.520898543331578e-01; +3.464543924721969e-01   +9.351976093811084e-01   +1.946429747910612e-01   +5.876188179468014e-01   +3.578781977275997e-02   +8.031905625752221e-02   +3.413057875710362e-02   +6.556966387181875e-01   +2.668049164244020e-01   +6.439743789795619e-01   +6.610290347405866e-01   -1.482147302806524e-01];
L2E_Input1_iAMPA_netcon = [+1.788284079479679e-01   +2.534242125686061e-01   -3.554523360009722e-01   +4.523828535460167e-01   -2.356980003155430e-01   -5.202839921464312e-01   +1.000000000000000e+00   -2.819253482031681e-01];
L2I_Input2_iAMPA_netcon = [-7.096390602645124e-01   -1.926563821524570e-01   +4.278093240149484e-01   -9.681142178984953e-01   -7.110131127485154e-01   +2.075542221199342e-01   +4.580953586382434e-01   +1.861374188937058e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
