function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.700268656293345e-01   +5.120780423845684e-03   +1.406998954501356e-01   +1.236217378323374e-01   +7.919482495788938e-02   +2.086352612181234e-01   +3.578492227597584e-02   +5.518925519008133e-01   -3.125435060769309e-02   +5.463124663386516e-02   +1.780315805616215e-01   +1.108505803206112e-01   +5.274982900435272e-02   +1.264137417669601e-01   +5.417369440372843e-02   +3.628847058591329e-01; +1.843452439963236e-01   +1.550488729467474e-01   +3.496095695866810e-01   -1.574043723250558e-02   +2.268876975557866e-01   +9.593503290762895e-02   +4.652231295623961e-01   +3.680099183023867e-01   -2.174859695299324e-02   +1.445409647903443e-01   +2.214317553428486e-01   +1.954760013887164e-01   +1.808928679409467e-01   +2.654211507506249e-01   +2.226090422779399e-01   +1.217880169538005e-01; +3.371111983984506e-01   +1.664301079882979e-01   +1.466947658237345e-01   +1.590672284357078e-01   +1.864537858747345e-01   +2.724449932920058e-01   +3.627153066564073e-01   +3.461828410253566e-01   +8.893439568799022e-02   +7.229893848281418e-02   +2.110381745266434e-01   +1.709175465053805e-01   +3.266388978387403e-01   +2.248601007306881e-01   +1.482845753884122e-01   +3.181317581697540e-01; +2.587113878672248e-01   +4.641526351389057e-01   +1.817277388022252e-01   +4.441416324690570e-01   +3.756761300580981e-03   +4.174340150511774e-02   +3.105427786350458e-01   +1.542529266551383e-01   +4.522962351130398e-01   +3.138988074925506e-01   +7.131302248250140e-02   +4.793361287969795e-02   +3.583917164468098e-02   +1.191582496286113e-02   +3.162163090906839e-01   +7.187086138832241e-02; +2.539318342498335e-02   +8.278466032960977e-02   -1.811760246321992e-02   +3.549621738568716e-01   -3.738052682497130e-02   +2.288008353905438e-01   -9.499582959255715e-02   +2.104409181444950e-01   -8.824419482671841e-02   +3.213151974535923e-01   +4.762905586961572e-01   +6.250389902778478e-02   +3.520295846594850e-01   +2.603135511203367e-01   +4.333653061365328e-01   +2.139883453527522e-01; +5.180974703617293e-01   +1.874756962151072e-01   +1.671802477436009e-01   +4.090281007209310e-01   +1.887251277250635e-01   +4.682915277977797e-01   +3.989605599593763e-01   +1.115576443240572e-01   +3.322323260241935e-01   +2.403515689675285e-01   +4.145777706230822e-01   -1.256899675929498e-01   -6.510098503802042e-02   +3.102851582326875e-01   +3.722975486204661e-01   +3.762551699183222e-01; +2.180326206551779e-01   +8.641290791489896e-02   +1.100344485968465e-01   +1.453067795951988e-01   +6.553054497710753e-02   +2.503499459632210e-01   +2.392344167981515e-01   +4.057107972058961e-01   +1.674197096872744e-02   -1.180601306076038e-01   -2.452777200446066e-03   +3.973052340175006e-01   +3.004457104093164e-01   -3.654707549902372e-02   +8.529414484914513e-02   +1.798749583609141e-01; +2.357383619650660e-01   +3.160914213579477e-01   +1.067116382210936e-01   +2.590383314688653e-01   +2.774603384314029e-01   +1.704753329962468e-01   +1.334979753838063e-01   +2.832849018479917e-01   +3.737730597522248e-02   +4.673995948496735e-01   +3.635062181067520e-01   +1.946835567150834e-01   +3.052286805536079e-01   +3.819725178750595e-01   +1.025122286179882e-01   +4.230334699931863e-01; +1.550099040360315e-01   +5.826721774432555e-01   +2.755550845197345e-01   +2.091606976381220e-01   +5.832368904525421e-01   +2.757113320585918e-01   +5.339917428867990e-01   +2.794966191877624e-01   +1.054638968859659e-01   +3.053324507078710e-01   +2.638121544010082e-01   +3.583802174311904e-01   +2.991836121187336e-01   +5.117688537068361e-02   +3.174559437188030e-01   +2.293475565002127e-01; +5.513363532587186e-02   -3.046624342512920e-02   -1.495175089049240e-01   -1.166137289662551e-01   +6.638225888990183e-02   +2.261721090584586e-01   -1.221127189058766e-01   -2.315130538146638e-02   +4.433285709064717e-01   +4.380308244060494e-01   +2.349123201486736e-01   +2.463303768545823e-01   +4.482226685851118e-01   +1.376742249520345e-01   +1.762026347883566e-02   +2.260872769368440e-01; +5.301853153542733e-01   +1.691082775217300e-01   -2.394296263725904e-02   +5.178171860364778e-01   +2.127529733842041e-01   -4.795023430921799e-02   -8.599980648914596e-02   +2.901269202340085e-01   +1.933991475553599e-01   -4.177458859402262e-02   +2.606204679837402e-01   -9.261656164777542e-03   -1.435662430352496e-01   -7.594398139167531e-02   -7.309445084177538e-03   +2.836142153746423e-01; +5.452400553436811e-02   +1.978860758979901e-01   +4.348192428768949e-02   +8.219798593994147e-02   +2.666310793264731e-01   +1.733552154512163e-01   -1.449163470240924e-01   +1.948037008093608e-01   +2.441109361495692e-01   +8.846954400910875e-02   +2.818744111318438e-01   +2.740813679042825e-01   +4.102240820274666e-01   +1.691413854346858e-01   +2.466891067093489e-02   +1.204060642253410e-01; +7.918528854088397e-02   +1.829699506373019e-01   -1.607714445969147e-02   -1.373286551457272e-01   +1.088737008595810e-01   +2.370610119183071e-01   +5.425353535593873e-02   +2.870302395763336e-01   +3.480190508033827e-01   +5.601712144917471e-02   +5.579738301950921e-02   +4.878194234075348e-02   +2.091024380878897e-01   +1.720497804880801e-01   +5.357527411576189e-03   +1.255194712390864e-01; -3.861731729671258e-02   +6.807386284067629e-01   +3.874435131501502e-01   +1.482549245053273e-01   +1.166904602366628e-01   +3.725693354290419e-01   +2.030649461820452e-01   +2.817306889649580e-01   +3.453817504402735e-01   +3.431472547240000e-01   +2.512299612317511e-01   +3.405815453961352e-01   +3.050419231340309e-01   -1.506584970378760e-02   +1.840436117613690e-01   -4.656782634006919e-02; +3.898459229552217e-01   +2.922870049198193e-01   +1.849986162114849e-02   +2.717756626706038e-01   +3.857458588652332e-01   +8.112852865105767e-02   +4.130123655767687e-01   +3.477014798388225e-02   -8.469922747381513e-02   +3.088172415234273e-01   +1.925790081042898e-01   +6.420515826925978e-02   +1.513407848878839e-01   +2.687885995272845e-01   +8.496815952016872e-02   +1.737812919976723e-01; -1.056541436313447e-01   +4.785853759132849e-01   +2.606925848118127e-02   +1.089597858984365e-01   +7.951360603821822e-02   +3.981282027242077e-01   +6.217537741362472e-02   +2.776135125095142e-01   +5.810599320178039e-02   +3.043230614640897e-01   +2.351018286783389e-01   +3.112222131221861e-01   +1.372477525582154e-01   +2.083352398718742e-01   -7.363718852999186e-02   +3.718234042153993e-01];
L1E_L1I_iGABA_netcon = [+4.362195573739017e-01   -6.199136025577232e-02   -3.089639404413243e-02   +3.064636454833548e-01   +1.792048563844028e-01   +1.517408841762495e-01   +1.914437923167991e-01   +5.506421406677529e-02   +4.812055869105075e-02   +4.399497905988568e-01   +2.801056060394715e-01   +4.427419504779295e-02   +3.081410365464482e-01   +3.976023771124286e-01   +4.307924876634084e-01   +3.182486179101883e-01; +1.238903277432551e-01   +4.068997619633377e-01   +1.105254262152919e-01   +1.081980105546976e-01   -2.204965443160612e-02   +1.193575185108319e-01   +2.360131077510937e-01   +7.725830151464468e-02   +4.135067513281296e-01   +2.697113695089659e-01   +1.316411229864414e-01   +1.029412486579185e-01   +5.493805601134458e-02   +3.122477679249772e-01   +4.723980207589860e-02   +2.804746606779548e-01; +2.938188177342657e-01   +3.921364848899944e-01   +4.402323031062654e-01   +6.930285806372173e-02   +1.827850611779172e-01   +4.762144673129033e-02   +3.755044037178693e-02   +1.569422395203232e-01   +2.112814469181766e-01   +1.850068397076897e-01   +1.075533560680254e-01   -2.172639745918799e-01   +3.280689184797421e-01   +3.342538885026251e-02   +2.170233728437425e-01   -6.326446851588279e-02; +4.598721390997803e-01   +2.608816909690614e-01   +3.025248392507449e-01   +3.948868543542651e-01   +1.056447275876973e-01   +1.065058356791449e-01   +2.317077278576361e-01   +6.608879243361926e-02   +6.294887988767983e-02   +9.221967186302263e-02   +4.718686049569677e-02   +1.398284149037220e-01   +2.189067495097647e-01   +2.230164467977642e-01   +2.118809080017082e-01   +2.572765685324723e-01; -1.461306782151028e-01   +6.133542241212091e-01   +1.854574323405037e-01   -3.296166621394815e-02   +3.426275702571906e-02   +4.909486414911021e-01   +3.247052543993493e-01   +1.997263702747509e-01   +1.187028192091848e-01   +2.688254391440463e-01   +4.235993700679374e-01   +3.550087526644131e-01   -6.202546130194724e-02   +2.177479149296634e-01   -4.665967149385830e-02   +7.865381850389702e-02; +2.225204012546039e-01   +4.115618371557568e-01   +4.242474812390058e-01   -7.726425322281155e-03   -7.370473785048481e-02   +4.736726089964648e-02   +1.274206879337420e-01   +4.855397302741935e-02   +1.435581088173312e-01   +2.161666604058221e-01   +1.120422623575701e-02   +4.074859247567189e-01   +3.683720566754765e-01   +3.451942394284491e-01   +8.252612078259597e-02   +3.487104630170756e-01; +3.987414277820570e-01   +1.440757955405696e-01   +3.087944939448971e-01   +2.837743566514468e-02   +4.627741341030483e-01   +1.110754053785867e-01   +4.199402051673596e-02   +1.532075469257822e-01   +1.172088590307385e-01   +1.480369560236664e-01   -9.977925016790307e-03   +1.082440416861438e-01   +2.894705887410693e-01   +3.271045918734904e-01   -1.463241687700607e-01   +3.018301208382707e-01; +2.299710403905297e-01   +1.163630200030863e-01   +1.163467184367972e-02   +2.570726745192859e-01   +5.199217637875260e-01   +1.698007956430060e-01   +2.450922884299704e-01   +4.616766079394812e-01   +2.954548992212320e-01   +3.235882680702123e-01   +2.208736283987580e-01   +1.021859130280849e-01   +4.513608389167634e-02   -8.084662897691197e-02   +9.428323618141612e-02   +4.361687029607261e-01; +2.676242408748245e-01   +2.283399185741389e-01   +3.370702824205108e-01   +1.593360049215722e-01   -5.143637344119546e-02   -5.403612447045034e-02   +3.233589128421040e-01   +1.952056706130582e-01   +3.341944284148019e-01   +3.667713702643138e-01   +3.129154988231305e-01   +2.293316792825553e-01   +3.743282732266254e-01   -5.393005961116481e-02   +1.895218763920334e-01   +1.797816418728963e-01; +4.175728030564657e-02   +1.495018907797829e-01   +3.125943974992821e-01   +1.656245779567499e-01   +3.907549033990059e-01   +3.748826476580687e-01   +4.112033275087546e-01   +1.886350594588206e-01   +2.322791818451758e-01   +1.700157930358935e-01   +3.881339450879835e-01   +1.352614904207414e-01   +3.367304469077520e-01   +1.730101849842340e-01   -1.917659621192315e-02   +3.221808940744987e-01; +4.450821006770023e-01   +2.959424515609974e-01   +3.068486323833621e-01   +7.418789443822257e-02   +9.726201842329091e-02   +2.603330715456927e-01   -5.346664424576120e-02   +2.140691506767690e-01   +2.542581778327222e-01   +3.450340866559777e-01   +3.891265231658424e-01   +8.613722909494409e-02   +1.913742474855522e-01   -5.571639693564502e-02   +3.478352927000650e-01   +2.723428599018629e-01; -4.946946783762779e-02   +1.931760529301203e-01   +3.251824529672938e-01   +1.088937576907766e-01   +4.822897422758384e-01   +7.895074913518012e-02   +2.268622303798435e-01   +8.127953010140807e-02   +3.245076705490007e-01   +2.379033619672258e-01   +4.877052968910175e-01   +1.327376939899644e-01   +9.410508443769930e-02   +2.633779871458026e-01   +1.028642431819106e-02   +7.016705645166875e-02; +2.060345673862513e-03   +3.180679103857599e-01   +7.634583800250365e-02   +1.666392297204680e-01   +7.459745209728920e-02   -1.891403251581712e-02   +2.634733131426298e-01   +4.886929642046443e-01   +2.338650692966339e-01   +3.336665239461067e-01   +2.582982340870286e-01   +2.349642681156665e-01   +1.572550280410526e-01   +2.590338897102514e-01   +2.645856543046443e-01   -7.741974044113045e-03; +7.648489524937137e-02   +4.659481288101029e-02   +2.169726745837531e-01   +2.363614934737968e-01   +3.879494072374847e-01   +4.002640338264973e-01   -1.333099041370245e-01   -1.091969617278143e-04   -1.431800437032281e-01   +3.208888297594709e-01   +1.268718050072384e-01   +2.294440307691633e-01   +1.053282827424976e-01   +3.393799753346474e-01   +3.653929883030597e-01   +3.593527664689365e-01; -1.057693929598312e-01   +2.131506087877647e-01   +1.968877723757735e-01   +2.471773943164278e-01   +2.706693129402295e-01   +3.130947280065302e-01   +2.096590731268545e-01   +8.862523755397789e-02   +3.848765876717106e-01   +1.764565769956849e-02   +2.865288585762137e-01   +9.153037480631815e-02   +4.690034560491138e-02   +1.692470499059547e-01   +2.774867607247648e-01   +6.160551601133227e-02; +3.224026175556571e-01   +1.558084187758553e-01   +1.500613278060139e-01   +2.559536777261179e-01   +1.374889187000945e-01   +2.364958382036239e-01   -2.562215034829599e-01   +2.860422476104212e-01   +2.901890232145257e-01   +1.454484938503615e-01   +3.309755573769933e-02   +1.509621089724203e-01   +2.738343243136893e-01   +4.130096016946695e-01   +1.647156341784404e-01   +3.776139414828894e-01];
L2I_L1I_iGABA_netcon = [+4.895715502618250e-01   +4.443243912579256e-01   +2.729381507687851e-01   +4.496916582060287e-01   +1.188151875132505e-01   +7.803395737620136e-02   +1.006924423016767e-01   +3.061460366593016e-01; +3.288496185451715e-01   +3.941422823074699e-01   +1.356030756672010e-02   +3.426608663507439e-01   +3.464866517460554e-01   +7.022701330089882e-02   +2.026146168048116e-01   +3.396535252026602e-01; -2.579269601768133e-02   +2.340175167491946e-01   +3.999072442079546e-01   +4.765394967200646e-01   -5.117727791700291e-03   -4.629712336618315e-02   +2.266235977977315e-01   +2.340076540331021e-01; -7.000921584869972e-02   +3.992022308932902e-02   +2.779480920996269e-01   +1.767259916472879e-01   +1.956773054560913e-01   +4.605965706044258e-01   +1.105619658977968e-01   +7.064718714065234e-02; +5.152753501730961e-01   +3.581626635627515e-01   +1.024079456124367e-02   +7.854945028746430e-02   +5.691421065595896e-02   +4.062790295525931e-01   +3.160223881501455e-01   +1.505659063290837e-01; +3.402919491762339e-01   +2.687621817480019e-01   +3.394270236192932e-01   +1.963673776714467e-01   +2.818765156703478e-01   +1.514465405373465e-01   +2.530202958576750e-01   +6.854182413674992e-02; +7.670071330179400e-02   -1.069842956639654e-01   +1.680014032778558e-01   -7.368363159898611e-02   +4.724058477978974e-02   +3.097296228307841e-01   +2.078350096024116e-01   -5.663478840387168e-02; +1.595862339753008e-01   -7.246747191761965e-03   +3.360751571300338e-01   +2.758207693894397e-01   +4.983927253455449e-01   +1.413296022001708e-01   +2.502275639102884e-02   -1.700267268447991e-02; +2.232082205994714e-03   +1.347252253406704e-01   +2.128672673096432e-01   +8.901755032401740e-02   +1.710476578004161e-01   +4.823102614770998e-01   -1.257398120214415e-01   +8.426422256327964e-02; +3.197097623574505e-02   +1.400312906528203e-01   +3.656176238729043e-01   +4.114582044271428e-01   +2.419546883770744e-01   +4.768306210041985e-01   +4.863405235005404e-01   +4.142814720677426e-01; +4.064431853844598e-02   +1.441205168226570e-02   +3.878495164331081e-01   +4.673254692466191e-01   +3.214234785206769e-01   +2.288536132306411e-01   +2.447700355390145e-01   +8.838799719392273e-02; +1.411136290826798e-01   +3.526426015971101e-01   +3.587810392523177e-01   +3.716639787108919e-02   +2.904619880008672e-01   +3.136787832424467e-01   +1.789007060797477e-01   +8.134363891083495e-02; +2.777156125224507e-01   +1.207563843951880e-01   +3.583573356719257e-01   +3.738173829484091e-01   +2.446291510307499e-01   -7.019890330370629e-02   +2.123916702457937e-01   +1.150596415461512e-01; -4.618530690539135e-03   +6.019832749837262e-02   +3.884298854107322e-01   -3.935837199199498e-02   +2.786261421727338e-01   +2.682641973844955e-01   +3.018896221079821e-01   +1.139565716481339e-01; +4.124553808511162e-01   +4.110437639489274e-01   +1.616584397687091e-01   +2.647704803947311e-02   -1.987804898217330e-02   +3.516802666481947e-02   +3.929611316411797e-01   +7.173205168757721e-02; +5.005770536080681e-01   +2.875142485625728e-01   +8.704216762329402e-02   +1.700184990919440e-01   +4.049665210156966e-01   +7.612470884043096e-02   +1.910603394031407e-01   +1.714971292800991e-01];
L1I_L2I_iGABA_netcon = [+1.811094816642074e-01   +2.171894371202275e-01   +1.291583465138876e-01   +4.047980080428882e-01   +4.313082844573607e-01   +2.580399314840044e-01   +2.850721006481115e-01   +9.488044436672753e-02   +2.936525091904174e-01   -1.350600996857464e-01   +3.323025921321615e-01   +2.934981143007499e-01   +5.966403671017001e-01   +1.306216592258443e-01   -3.375566546886820e-02   +2.414585548531697e-01; +4.083718687019133e-01   +3.772565286826667e-01   +1.699862718941453e-01   +3.503170673563791e-01   +4.181702056254742e-01   +3.159077099408066e-01   -1.461468079951486e-02   +7.534907826232243e-02   +4.503098668048935e-01   +7.718246725795570e-02   +1.997464026434928e-01   +2.029573012670827e-01   +5.089443034029115e-02   +1.753666743365060e-01   +3.185226762451426e-02   +3.982706588477309e-01; +3.498247724220760e-01   -9.120822174230672e-03   +2.777319433998969e-01   +1.940923432363642e-01   +3.724516248849374e-01   +4.712554312373852e-01   +4.833393139509263e-01   +2.720252702924085e-01   +3.457098466213832e-01   +4.125986140591192e-01   -4.725344719279902e-02   +4.048467768781294e-01   +3.635912160903131e-01   +2.223446360320175e-01   +2.543988331134294e-01   +5.242701517028783e-01; +1.578699757882520e-01   +1.898578576084521e-01   +1.106905280113200e-02   +2.071841602327571e-01   +1.340722604332010e-01   +3.184543123649291e-01   +1.442352244511451e-01   +3.301269959858978e-01   +1.242907533030742e-02   +2.917750221632340e-01   +1.622208130354915e-01   +1.713734787594061e-01   +2.191022291406867e-01   -3.524678924956019e-02   +1.992598428752052e-01   +1.944486902959659e-02; +1.643814678220497e-01   +4.308156554500451e-01   -3.724623345272474e-03   +3.287278326854499e-01   +6.658472747539895e-02   +4.593370889458320e-01   +2.029464565295314e-01   +3.006063100098451e-01   +2.370812558759300e-01   +3.153809029051965e-02   +2.056537719101588e-01   +2.725231130573336e-01   -6.127403441762493e-02   +9.570254860281796e-02   +4.630507140642568e-01   +1.054486559131430e-01; +2.256652933752139e-01   +4.070818676824333e-01   +2.487418857963486e-01   +1.963759527404937e-01   +4.807296990935086e-01   +2.181654454938656e-02   +5.144413312143048e-03   +8.731678831363465e-02   +3.627957663856363e-01   +3.424488387982858e-01   +5.059512010322416e-02   +4.725400132187993e-02   +5.748202813574049e-02   +2.180495797684882e-01   -7.336882221159194e-02   +2.470553556252524e-02; +3.012400794082880e-01   +3.887567384553267e-01   +7.813007868987093e-02   +4.814674447734852e-01   +1.968623020223766e-01   +1.242983905162009e-01   +3.005172483535474e-01   +6.651770088010353e-02   -1.134116281598199e-01   +2.645176087733767e-01   +5.571396583153761e-02   +3.338825646877020e-01   -1.462680097195546e-01   +2.928782159435454e-01   +2.942998621569916e-01   -2.027776782180636e-01; +2.173446968284189e-01   +1.130760854181406e-01   -3.061840480268727e-02   +3.455133325244041e-01   +3.597880234131998e-01   +2.248360807897567e-01   +2.055462517591635e-02   -1.043395455684700e-01   +1.673418998082199e-01   +1.301975883690998e-01   +2.876234236073231e-01   +9.044912146594783e-02   +2.939308944170658e-01   +2.847023266849502e-01   +1.012153296003419e-01   +1.565802546921448e-01];
L2E_L1E_iAMPA_netcon = [+3.297646156178382e-01   +4.087922388776533e-01   +3.002266235261846e-01   +3.571724709486705e-01   +7.476322793298817e-02   +2.494421734361106e-01   +2.303607707427882e-01   +1.001493733574153e-01; +3.056207304806550e-01   +4.571928472305606e-01   +1.302590109230371e-01   +2.870618311917407e-01   +2.954725857887537e-01   +3.872141128799020e-01   +5.008625721739023e-01   +3.423618501160568e-01; +4.692646230125830e-01   +2.460035263538398e-01   +2.635300806020210e-01   +1.232648725903888e-01   -3.689487791466678e-02   +1.080027516509979e-02   +2.276133287528987e-01   +3.472964602880631e-01; +5.215715225234887e-02   +4.645687280644695e-01   +3.756936265652859e-01   +1.273570544260834e-01   +5.118115368395577e-01   -9.124778278969894e-02   +1.644964979101527e-01   +2.621783297950956e-01; +1.311710327321661e-01   +5.512505586181275e-02   +1.220943075942838e-01   +2.256086535164139e-01   +3.253234957223879e-01   +3.827004439925925e-01   +9.577341266315792e-03   +3.168015990226087e-01; +2.561227679021582e-01   +2.792205069590516e-02   +2.915953563095007e-01   +1.139468534551878e-01   +5.310063620084291e-01   +3.254232799444426e-01   +1.954006776341520e-01   -8.970782379246628e-02; -2.992684986067065e-02   +4.186158119205367e-01   +1.053658316549765e-01   +8.231019213028291e-02   +1.782928048898507e-01   +1.322874531153460e-01   +1.916430098790083e-01   +4.870325832103937e-02; -6.697404600067819e-03   +5.372725275545869e-01   +1.488124967467782e-01   +2.824202363844345e-01   +2.643857759785139e-01   +3.464142458207876e-01   +4.528821142599481e-01   +3.360042548944788e-01; +4.049215717819243e-02   +4.953568237832537e-01   -7.288736006038526e-02   +2.628009703500805e-01   +1.074869609396296e-01   +1.965322767008812e-01   +3.051459640681818e-01   +2.376627761791513e-01; +3.633726932178698e-01   +2.840068600158811e-01   +1.676257875982649e-01   +3.582297051476872e-01   +1.839334091302432e-01   +4.238912914584764e-01   +1.927692849994378e-01   +3.906178230316498e-03; +2.645863485678804e-01   +1.570462748190417e-01   +3.438733056230835e-01   +2.013579007388704e-01   +9.691382201730832e-02   -2.786361039616120e-02   +2.774263113435245e-01   +1.119118630488881e-01; +2.054481429411600e-01   +3.791403966950053e-01   +1.207514784595737e-01   +2.768356897439201e-01   +1.588199104392797e-01   +1.161613196209792e-01   +3.542726294877891e-01   +2.831764769840113e-01; -3.589316280523139e-02   +1.598059239807962e-01   +5.710410698206388e-02   +2.044447996045872e-02   +2.257333034793046e-01   +2.696624550085404e-01   +4.126419088111990e-01   +9.556794666711778e-02; +1.647451689633752e-01   +1.683061797579462e-01   +3.111677308339351e-01   +1.876765638441770e-01   +4.367794209967159e-02   +2.603784815558084e-01   +2.957107576121072e-01   +4.006293829411984e-01; +1.594931652150588e-01   +2.968491308557590e-01   -7.870067509344961e-02   +1.279135351868142e-01   -1.193887900694756e-01   +1.378664993083446e-01   +3.020831321436347e-01   +3.432604963990613e-02; +1.732862207772977e-01   -1.406921695931429e-01   +5.054204637547621e-02   +1.412198216310634e-01   +3.418313763595079e-02   -6.211615916212872e-02   +5.203961559644171e-03   +2.065812311408906e-01];
L1E_L2E_iAMPA_netcon = [-7.623931713657731e-02   +1.329600494758938e-01   +1.338027054654897e-01   +3.225054175135333e-02   +3.262721333679330e-01   +4.063375046940785e-01   -8.510747054204888e-02   +2.719818841940625e-01   +1.842112428214466e-01   +3.267195358941103e-01   +3.792082585992246e-01   +3.822533568847329e-01   +4.656751058561601e-01   -3.158855376198443e-03   +1.713682563264416e-01   +4.563895230103250e-02; +4.480798058988955e-01   +2.964733589584335e-01   +3.313597502763218e-01   +3.348040919754009e-01   +3.054980695527641e-01   +4.624327525312255e-01   +4.044042642885492e-01   +3.258322917324920e-01   +1.285563555354127e-01   +1.575638939681691e-01   -3.435743913204459e-02   +3.759021628816248e-01   +4.290127414880631e-01   +4.934483449831200e-01   +4.934778682199306e-01   +4.382884331770177e-01; +2.300918993581444e-01   +1.461519040854742e-01   +4.183776216511480e-01   +5.676109457751033e-01   +4.879810101304844e-01   -5.478886612401487e-02   -1.205922116371888e-01   +1.892093421838584e-01   +3.729008517193629e-01   +3.139820176695860e-01   +1.112825844215776e-02   +3.306926121319695e-01   +2.575711967894481e-01   +3.404689497013021e-01   +3.734214759781715e-02   +2.840759583456556e-01; +2.291296399572521e-01   +3.084942157511611e-01   +3.519827098677799e-01   +3.878969800387529e-01   +1.868595729481025e-01   +1.343607575696175e-01   +4.836356064790939e-01   +3.356872956591053e-01   +2.317360609475994e-01   -5.011596150033756e-03   +1.633789867819108e-01   +2.901858957514897e-01   +2.796312658730850e-01   +2.577393265960232e-01   +4.710202359228643e-01   +3.484082544805893e-01; +2.900480250244877e-01   +6.459741111702381e-01   -4.705896254071690e-02   -5.181502231560668e-02   +2.782582920388170e-01   +1.070798529349087e-01   +1.318054431413146e-01   +2.559204333476305e-01   +4.391289775836645e-01   +5.496369713063889e-02   +2.639793698346491e-01   +8.729499006887684e-02   +1.688044630977071e-01   +9.167842029522331e-02   +4.242713429593135e-01   +2.841982718533372e-01; +1.608976794862447e-01   +2.702264905557903e-01   +2.021161530520097e-01   +1.814980429234360e-01   -9.754639405967030e-02   +1.987631305815465e-01   +5.906743181736190e-01   +6.155268770162657e-01   +4.055300540644673e-01   +2.419457131521681e-01   +8.564401364811512e-02   +2.448212942701613e-01   +1.805499989959761e-01   +7.866155994692245e-02   +1.546346824620470e-01   +1.765174034277324e-01; +4.901591944740805e-01   +1.276079553190224e-01   +1.896387070144263e-01   +3.679228570206552e-01   +5.741525315021258e-01   +4.498874660081955e-01   +1.184318242140151e-01   +9.008958143754908e-02   -1.685833677036185e-01   +2.549442763813328e-02   +1.404151637514053e-02   -7.165187732942054e-02   +4.275072221155013e-01   -1.968046765856839e-02   +2.460360986648782e-01   +2.446411715843061e-01; +3.232326039571872e-01   +3.480452263114729e-01   +4.786211425585402e-03   -6.718187740220566e-02   -9.550283501926448e-03   +5.261811324192939e-02   +2.881259812616819e-01   -4.284118627946615e-02   +4.268341980497946e-01   +2.167687389392654e-02   +4.574211614230848e-01   +1.879049513144742e-01   +4.397506760495032e-02   +1.690619736592323e-01   +3.855686082200858e-01   +4.420799143491325e-01];
L2I_L2E_iAMPA_netcon = [+4.825574696611944e-01   +3.767242328639606e-02   -1.229363630324942e-03   +5.001514774483434e-01   +1.461326732578592e-01   +3.587366101733516e-01   +3.581983335978417e-01   +2.044813306738183e-01; +1.280531357976086e-02   +1.097862694797225e-01   +2.317551100451853e-01   +3.108575873331215e-01   +2.734767507349057e-01   +1.987183581781659e-01   +4.678174705897460e-01   +8.834282945274058e-02; +5.067443898844920e-02   +1.221193648673420e-02   +3.325737037191324e-01   +6.113393304965212e-02   +3.483988005031316e-02   +1.158363750919121e-01   +3.073483443658705e-01   +4.608678558849882e-01; +3.190916475772645e-02   +3.318973188617401e-01   +5.756881773624316e-02   +1.425287666802090e-01   +2.855506942927190e-01   +3.158832693300907e-02   -3.398944517780587e-02   +9.659204278543806e-02; +3.000845223093784e-01   +3.223898939560726e-01   +4.676268891746849e-01   +2.661968321061697e-01   +1.820832415990765e-01   +2.643644697713307e-01   +2.861693586657912e-01   +1.437631835728175e-01; +3.837648769493255e-01   +2.988070082191291e-03   +2.314558047470692e-01   -1.579053298476792e-01   +1.378274240237281e-01   +4.640368796913930e-02   +1.663683304527763e-01   +1.130253710797064e-01; +2.455788529597077e-01   +2.258902231890820e-01   +2.459710669357675e-01   +3.458768904915694e-01   +1.779900863680772e-01   +2.510280774104638e-01   +2.599283637227113e-01   +1.941996426449434e-01; +3.802258231412091e-01   +2.686372448088731e-01   +1.654060484278185e-01   +2.468180314792446e-01   +3.879006684484844e-01   +4.646596936338562e-01   +8.530391580016936e-02   -9.660279541896701e-02];
L2E_L2I_iGABA_netcon = [+3.021840252183420e-01   +1.787040361433933e-01   +2.846513956035957e-01   +6.622921852403810e-02   +1.149265917435717e-01   -3.439665756396763e-02   +2.584510142266725e-01   +2.206834268022116e-01; -6.600814282972421e-02   +2.825261904981982e-01   +2.333659274308206e-01   +3.696249343385574e-01   +1.210890095959919e-01   +7.174803105953423e-02   +3.994612959828288e-02   +3.972683184682308e-01; +5.697050144184621e-01   +2.522877951963353e-02   +2.991437102610164e-01   +4.560837687939863e-01   +1.644428751259334e-01   +4.576804020210551e-02   +1.331183991804206e-01   +2.672571536403915e-01; +1.526209275283138e-01   +5.344160245415580e-01   +4.379962262028141e-01   +3.499830088036078e-01   +2.569815023521661e-01   +2.237562854060724e-01   -9.205992237439056e-02   +1.378431194099826e-02; +2.120325665454535e-01   +1.605054926838963e-01   +6.074524813082156e-01   +4.961272234638231e-01   +2.848916016555246e-01   -1.222112213726928e-02   +3.246790100688779e-01   +2.835438563642421e-01; +4.555706848805631e-01   +1.151498173869227e-01   +2.866009156055468e-01   +2.403112607762827e-01   -7.257529645561803e-02   +4.811330426223798e-01   +2.696214723233240e-03   +4.298824080210250e-01; +2.830564749284912e-01   +1.355754085481750e-01   +1.923846979429832e-01   -8.339351521979792e-02   +2.844053157148032e-01   +7.243497725433186e-02   +4.329800754773219e-01   +4.283492981045549e-01; +1.067078888961384e-01   +9.365153534203138e-02   +3.731870488686331e-01   +2.610289234280551e-01   +7.086925808491687e-02   -2.487209036736035e-02   +3.484817171258672e-02   +3.699633778158629e-01];
L3E_L2E_iAMPA_netcon = [+2.756622677509304e-01   +3.523443011419461e-01   +5.618874576069701e-02   -2.870245887325876e-02   +2.981852650833315e-01   +2.551375660854120e-01   -5.014963754321562e-02   +2.164783168079308e-01   +4.068589167697435e-02   +2.602508970870213e-01   -1.172656217507920e-02   -1.133957777106053e-01; +2.568712260451275e-01   +2.706829348597223e-01   +3.145385084831832e-01   +1.615862114698519e-01   +1.946915021442530e-01   +2.679033779086828e-01   +1.703258010660060e-01   +1.807430914466722e-01   +3.045507112826554e-01   -1.614871359044876e-02   +9.970191753358718e-02   +4.168756831996989e-01; +2.134079725128639e-01   +2.757964653166025e-01   +2.720267706887144e-03   -1.006677690288191e-02   +1.014354109068788e-01   +1.755834471462284e-01   +2.123812635358458e-01   +3.342847479534163e-01   +1.711575596666061e-01   +1.681918956319091e-01   +5.888274056660106e-01   +1.871563148578824e-01; +1.545186969239301e-01   -3.963819622619466e-02   +6.019561613300126e-02   +5.882039309632987e-02   -1.099147835259551e-01   +4.566447950722607e-01   +2.788274676073864e-01   +1.171765638932687e-01   +2.250619029586104e-01   +2.259669057163412e-01   +1.607019835724609e-02   +2.779628597286691e-01; +9.170854010500287e-02   +2.677930965723643e-01   +3.204619182102514e-01   +1.044126642317227e-01   +2.386181511284993e-01   +4.024345700245271e-02   +5.088640491826321e-02   +1.286822687520743e-01   +2.660493982435506e-01   +2.585647819835034e-01   +3.220260982147552e-02   +2.866961193137749e-02; +2.563998703691399e-01   +5.422923212539048e-01   -8.324672920204834e-03   +2.764250274811557e-01   +6.988823550471979e-04   +4.631604743599596e-01   +1.984836591987348e-01   +2.004526397560681e-01   +2.207835376588635e-01   +1.481311588233714e-01   +1.118748140152339e-01   +2.465102057553371e-01; +4.146691186899240e-01   +3.425664056927457e-01   -2.255239294041353e-02   -2.903505999048361e-02   +3.782914532361548e-01   +3.181456639664770e-01   +3.280600862349533e-01   +2.520710369406584e-01   +4.662836356210890e-01   +1.092618385944070e-01   +4.165086549008861e-01   -2.919956921478593e-02; +3.022097144987717e-01   +5.202569435613275e-01   +4.839594209487942e-01   +8.060937781986251e-02   +1.806086077028348e-01   +1.612095933944481e-01   -1.609493841936487e-01   +1.970626985741767e-01   +2.207242014486543e-01   -5.039364286190898e-03   +4.437056292969394e-01   +2.662217619483411e-01];
L3I_L2I_iGABA_netcon = [+2.057849515801512e-01   +8.975978592070179e-02   +2.126382821917998e-01   +1.334554852866898e-01   +3.142226365129941e-01   +3.353480439764195e-01   +3.921239457158859e-02   +2.614076816750392e-01   +4.999113639664671e-01   +1.517982649896812e-01   +7.992315051175612e-02   +2.235920672861385e-01; -2.116096486603893e-01   +5.208386198907997e-01   +2.798640373599143e-01   +1.184208889446642e-01   +3.265719611525004e-01   +4.743703502079305e-01   +1.740489542634609e-01   +3.395946044518032e-01   +1.720642123791437e-01   +2.440373833656494e-01   +3.294618494200672e-01   +2.201652130096858e-01; -3.664377709216064e-02   +3.195616057047204e-01   +3.809635802031321e-01   +3.711185020763754e-01   +3.386860073249033e-01   +2.739395380891740e-01   +4.026866154522927e-01   +3.287215809410002e-01   +1.862932418937436e-01   -4.278693144039010e-02   +2.474094859448564e-01   +3.500842211923286e-02; +5.321955531165053e-01   +1.264383846308493e-01   +4.501285561299589e-01   -3.271511809644875e-02   +2.803497477070838e-01   +1.918282956930246e-01   +3.590616413214716e-01   +3.983123522728552e-01   +5.708248152542661e-02   +1.187832890601582e-01   +3.106711109928806e-01   +1.610874116508422e-01; +1.372730502874311e-01   +1.792919891335691e-01   +2.329620386792418e-02   +1.794212782654184e-01   -8.507699014768472e-03   -6.322556505454112e-02   +2.916045676072198e-01   +1.375293067082306e-01   +1.915814768176612e-01   -5.910910854505790e-02   +2.435467074492335e-01   +7.360344259522854e-02; +8.452999492121530e-02   +5.238293360475804e-02   +2.904383945927430e-01   +2.148899287690067e-01   +1.434959856222011e-01   +2.304853194229269e-01   +1.651483780617619e-01   +4.065358657390972e-01   +1.626063266270610e-01   +6.080593193863055e-01   +2.294588199899327e-01   +3.403371533016104e-01; +3.694426379385760e-01   +2.537078899806380e-01   +2.459255247842514e-01   +4.213462770637287e-01   +6.841868506629317e-02   +3.026169007459189e-01   +1.871419328741087e-01   +3.287466150909532e-02   +1.026128084163324e-01   +5.651171182008496e-02   +8.647857945036999e-02   +3.744334493833523e-01; +1.909469228860494e-01   +1.348621484499958e-01   +3.979745593183343e-03   +1.430719075641826e-01   -8.100259225013839e-03   +1.911306978699780e-01   +1.571694972571041e-01   +2.202670207786127e-01   +2.876414236602164e-01   +5.371742596037983e-01   +5.011025864338506e-01   +2.507953862104615e-01];
L2E_L3E_iAMPA_netcon = [+4.436526498244954e-02   +1.933476282746731e-02   +3.102293534871493e-01   +3.828655970007391e-01   -1.247550933932822e-01   +2.917989900627944e-01   +1.477686818374862e-01   +2.866226226187111e-01; -5.655990012643335e-02   +1.765513001663195e-01   +2.923926124045164e-01   +2.236251943711670e-01   +4.538032132603663e-01   +1.655757219451600e-01   +2.231761527130454e-01   +3.597809015152127e-01; +2.484397506177652e-02   +5.931319397788515e-03   +4.866722651900977e-01   +1.971251654338086e-01   +3.436754877133384e-01   -1.123084461082065e-01   +2.984789870560734e-01   +9.492359327842415e-02; +8.212528049223530e-02   +1.856796580714069e-01   +1.158013473053917e-01   -9.278544575169818e-02   +3.595925197768002e-01   -2.584012331087031e-02   +3.603802894843303e-01   +3.360539826511224e-01; +1.442744620041172e-01   +2.549980216893690e-01   +3.188970795223822e-02   +3.851382072094084e-01   +2.526323472845226e-01   +9.919990170579994e-02   +2.932663083129175e-01   -1.733358548285176e-01; +1.221482017142003e-01   +1.073004220107293e-01   +6.797983506129496e-02   -1.708009390419523e-01   +1.849043228362920e-01   +3.309260436412964e-01   +1.835887341055927e-01   +1.972383329446983e-01; +2.395905828637934e-01   +2.946137089606460e-01   +3.683972553197641e-01   +8.126987366067887e-02   +4.980552688200272e-02   +3.622809195534538e-01   +1.231786816412764e-02   +1.586599721873989e-01; +2.992481194136545e-01   -2.043706946278020e-02   +5.751329961256790e-02   +9.052677865498535e-02   -6.609408671030326e-03   +1.872855402597442e-01   +1.942027624909444e-01   +1.517390421745981e-01; +1.741374027697557e-01   +2.101952139908778e-01   +3.030863593762216e-01   +2.195800965166908e-01   +1.293184161200908e-01   -7.990088852183520e-02   +3.765926157107093e-01   +1.948628762385279e-01; +1.345262960545807e-01   +1.853460689352996e-01   +6.751705709019713e-02   +4.288753424308520e-01   +3.098994065451306e-01   +2.382305175292755e-01   +5.302934288073463e-01   +3.216186072055957e-01; +1.259461684700596e-01   -9.626925469367913e-02   +1.630969480520942e-01   +5.966849414096300e-02   -1.003268533972177e-01   +1.563440822138725e-01   +9.276032473175219e-02   -2.495871141374878e-02; +5.157115546831540e-01   +2.444453500080511e-01   +1.702754387549780e-01   +2.445775743481201e-03   -5.713830394050654e-02   -1.229498025729045e-01   +2.766091317987569e-01   +1.525605117896967e-01];
L2I_L3I_iGABA_netcon = [+4.661144893411315e-02   +5.532678008504910e-01   +9.780088503871029e-02   +2.621656181953634e-01   +5.612386578791956e-02   -1.427725241322643e-01   +2.948967774823662e-01   +3.100382084387597e-01; +2.894371552685383e-01   +4.512616700207180e-01   +1.682269391140631e-01   +2.012419378989796e-01   +4.310389801200106e-01   +1.705167905426630e-01   +2.618559692720288e-01   +1.296784605011110e-01; +1.055683069439812e-01   +1.235867093293122e-01   +7.274219829612917e-02   +4.409845638221483e-01   +4.346568364725810e-01   +3.163280923664255e-01   -6.095489299505985e-03   +7.725031647103434e-02; +1.796428342390555e-02   +2.978367641492892e-01   -1.101736478528068e-01   +5.285778093114669e-01   +3.058461817555120e-01   +3.071967289798222e-01   +3.308110717288322e-01   +2.153947694733265e-01; -2.619210688693813e-02   +1.572616858753276e-01   +4.951433906362639e-01   +2.610538269283205e-01   -2.926423499583733e-02   +4.453290645484707e-01   +3.444779616187824e-01   +2.298295325172605e-01; +2.252400241445292e-02   +8.927884497387004e-02   -1.570563667694473e-01   +1.634490553688317e-01   +2.467098944315992e-01   +3.787548222058005e-01   +4.198369761569852e-01   +2.129234457627497e-01; +1.550522126610429e-01   +1.704642636738090e-01   +3.741953534654023e-01   +2.745212791337464e-01   +3.733958471556192e-02   +8.906819360650721e-03   +2.963682324719338e-01   +2.577345851382690e-01; +1.513656310171361e-01   +4.367495251854056e-01   +5.675574437698436e-01   +7.890340383231978e-02   +6.349008174776460e-03   +3.355337347382182e-01   +3.892515497819100e-02   +3.885688183411404e-01; +4.652227990326854e-01   +2.510768815791428e-01   -2.653337093425526e-02   +9.270689306933225e-02   +2.566458865175467e-01   +2.413780481345667e-01   +1.012201852222673e-01   +2.780418609155613e-01; +6.668028949335900e-02   +7.135374161393210e-02   +1.278856026911031e-01   +2.965694927631173e-01   +1.895352106834605e-01   +2.067147879013813e-01   +2.276616224836724e-02   +4.094222295721819e-01; +3.609972214274668e-01   -4.823178027922282e-02   +5.191780344699886e-01   +1.006870912109330e-01   +3.912113132276398e-01   +4.839844076356861e-03   +2.048889967076725e-01   +2.277591812622807e-01; +2.341681800628580e-01   +1.751822319633875e-01   +2.306763111676091e-01   +3.527395164162554e-01   +3.523296937810268e-01   +2.224407430231246e-02   +1.903182224819909e-01   +3.557906533932808e-01];
L3I_L3E_iAMPA_netcon = [+4.174819345252612e-01   +3.317609380613186e-01   +1.921832807790918e-01   +2.401982158549785e-01   +1.986145834245175e-01   -3.817762560594486e-02   +1.919974070911188e-01   +2.585685332171458e-01   +1.009095950741763e-01   +1.553413795780990e-01   +1.828082694811852e-01   +5.365654372886981e-02; +2.611444904147054e-01   -3.999838820776529e-02   +2.749085794203020e-01   +3.822738634587839e-01   +7.711468739141168e-02   +7.153687719382179e-02   +1.187653226139949e-01   +2.255478418358904e-01   +2.549541337336431e-01   +5.362654624829601e-02   +8.897880941796658e-02   -8.507991657151615e-02; +2.043587996825603e-01   +4.737594356504971e-01   +3.558203274762084e-01   +9.661990308947087e-02   +2.756487743903835e-01   +2.791037808822527e-01   +2.974730359989933e-01   +2.249785990753136e-01   +1.978190608954991e-01   +1.532048114139005e-01   +1.521948664785269e-01   +3.818173058583068e-01; +2.349144776398216e-01   +1.673081854923165e-01   +1.725205397710809e-01   +1.597523518944824e-01   +3.707362950734824e-01   +3.653922430274829e-01   +1.195941070258205e-01   +1.754647480790684e-02   +4.656523494038979e-01   +8.587396548843931e-02   +8.728270976986813e-02   +1.978696425790469e-01; +1.553708036359364e-01   -8.325621720778351e-02   -6.419166299488216e-03   +3.897666673215854e-01   +3.773194952391792e-01   +4.063289651017002e-01   +5.755721450261440e-01   +3.736949300811209e-01   +2.281208777513865e-01   +1.554537317607661e-01   +2.349893410533913e-01   +2.398246528685429e-01; -1.330354465788727e-01   +3.058730912844793e-01   +1.787933809427337e-01   +2.916242127541367e-01   +3.610367407844414e-01   -1.770185770618864e-02   +2.860993960169775e-01   +7.822696229728469e-02   +4.541713324951832e-01   -4.480012044568241e-02   +1.491216635899711e-01   +1.065000394677996e-01; +7.803512974888410e-02   +4.998462448463171e-01   +2.283766514309831e-01   +2.078281677100678e-01   +2.791049017045679e-01   +1.219806536249974e-01   +1.993724722015338e-01   -2.016657825212292e-02   +2.670614436304964e-01   +1.048135939676627e-01   +3.204086848294735e-01   +3.255914389544678e-02; +2.355991774588465e-01   +9.939133274746854e-02   +2.134769304646830e-01   +1.564275851182028e-01   +3.265436501284190e-01   +3.686271669362914e-01   +1.031620785597102e-01   +3.170188914729578e-01   +4.104461672752829e-01   +8.363596072619162e-06   +4.272225803037640e-02   +2.709128021474664e-01; +2.173450668444699e-01   +1.796965269250407e-01   +4.078836855302756e-01   +2.022559487383686e-01   +1.545149087837913e-01   +4.232474816828939e-02   +5.429341434007103e-01   +2.129809093517234e-01   -1.049646408966502e-01   +1.773589941419564e-01   +2.405877885197007e-01   +9.907423856199774e-02; -3.887494594211753e-02   +2.938851834404894e-01   +3.000928875967078e-01   -3.734387758043717e-03   +3.010851177186497e-01   +1.626517853489052e-01   +2.406243971221665e-01   +9.483177087587018e-02   +6.732205608067383e-02   -6.761373136034959e-02   +1.102275352093567e-01   -1.396563282727176e-01; +1.938472000066926e-01   +3.214358026418058e-01   +5.584304998530362e-02   -8.200084742004962e-02   +1.175159252288304e-01   -1.600716358372371e-02   +2.611154374160440e-01   +2.576749508976747e-01   +7.369246362022555e-02   +1.124471169448299e-01   +7.845392881775121e-02   +5.380484888788337e-01; +5.175510857510132e-01   +8.134231486071057e-02   +2.015278746872012e-01   -6.544400681372468e-02   +3.549145283261435e-01   +2.600792395892551e-01   -7.066532417953658e-03   -3.642638307589310e-02   +1.200054218035331e-01   +1.822864525514013e-01   +4.273354028306352e-02   +3.861842254384328e-02];
L3E_L3I_iGABA_netcon = [+2.943682507241410e-01   -8.115733758217497e-02   -2.565559590485512e-02   +2.434365361023952e-01   -5.783288098730789e-03   +3.162547792554059e-01   +3.022571395523170e-01   +1.171787101623251e-01   +1.102305464685214e-01   +9.461463567056042e-02   +4.588206215460966e-03   -7.669553027998012e-02; +1.061925883078578e-01   +4.931452190695421e-01   +1.753522247144992e-01   +2.670399516296045e-01   +4.604454390502071e-01   +1.682213689073308e-01   +1.914510181860912e-01   -5.592955477649898e-02   +3.675672540377228e-01   +1.159298424768795e-01   +6.244721508433005e-02   +2.345013823956600e-02; +2.927114133142075e-01   +2.439264846827271e-01   -7.221396633558838e-02   +1.896198472720802e-01   +7.764749502707424e-02   +1.288577641639436e-01   +2.523945065387203e-01   +2.675892394684775e-01   +3.367564994839620e-01   +1.545775858774033e-01   +1.443310560872830e-01   -4.284460097434623e-03; +4.153715506414932e-01   +1.400182167023029e-01   +2.015897357245272e-01   -2.161275839716838e-02   +6.568493595702235e-02   +1.340263339365791e-01   +1.699835154639743e-01   -5.634120914908342e-02   +4.461131572326374e-01   +2.210257341883530e-02   -3.913552675890704e-02   +2.941060048058539e-01; +2.609406848085017e-01   +4.766099270913941e-01   -1.086655836523425e-01   +2.910449519825262e-01   +7.777607865380005e-02   +1.593887035346635e-01   +8.094202908398518e-02   -3.406415923611983e-02   +2.053867177945187e-01   +1.844756674100154e-01   +2.521533595738238e-01   +1.007042246803730e-01; +3.301483843806348e-01   +8.543369014854685e-02   +1.612634820005452e-01   +3.984604284553837e-01   -7.278513455148172e-02   +2.264245657891575e-01   +4.808019153181206e-01   +2.245205037072466e-01   +5.623979883870878e-01   +2.474775081633526e-01   +5.513010667409028e-01   +1.941582794241878e-01; +2.128088325637446e-01   -7.007606951233226e-02   +3.154672518261359e-01   -1.008469496650144e-01   +2.242154452209275e-01   +1.222470359486090e-01   +5.115127430959878e-01   +1.863994442596743e-01   -1.484221335332893e-02   +1.532991992860439e-01   +2.085876379320801e-01   +3.277557288280137e-01; +7.990766153917930e-02   +2.064929203700058e-01   +2.918542123632912e-01   +4.681659880179166e-01   +1.530292141575242e-01   +4.480482826316794e-01   +1.636261657619140e-01   +5.535955812250963e-01   +4.052931841771990e-01   -8.101365914359285e-02   +2.811165515835923e-01   +2.274331047467884e-01; +2.068334637432359e-01   +1.277602017638536e-01   +3.133916992053847e-01   +4.289739396652894e-01   +2.084400724561466e-01   +1.414566643313474e-01   -3.167516179630378e-02   +9.782770795942383e-02   +1.480524625842481e-01   +3.519310079248837e-01   -2.507889859928658e-02   +6.667697279751433e-02; +1.134053172680620e-01   +6.178207438762857e-02   +4.228534673770746e-01   +2.498706429096599e-01   +1.632189075944545e-01   -1.381585686947549e-01   +2.717148621572598e-02   +5.706182255684845e-02   -1.108072632668100e-01   +2.315179351023272e-01   +2.423930992879370e-01   +3.701950140126534e-02; +3.936698503129584e-01   -1.332411274402238e-02   +2.497356804288981e-01   +3.706670833859368e-01   +1.278768959369027e-01   +1.178335586562993e-01   +3.449057643624498e-01   +2.346927620878119e-01   -1.233219343657374e-01   +3.857662041653620e-02   +1.106761141831170e-01   +7.079803614710817e-02; +2.463137917962719e-01   +4.259534732834364e-01   +3.159573139506802e-01   +2.186308673608190e-01   +1.582441612291768e-01   -1.528721213249750e-01   +3.190043443792696e-01   +2.052848908804266e-01   +3.169193066836647e-01   +2.016290359917203e-01   -1.482888079345258e-02   +3.218645856289747e-01];
L2E_Input1_iAMPA_netcon = [+3.295356826839557e-01   +3.177937029494344e-01   +1.515202111751708e-01   +3.883483237263136e-02   +6.742256817408308e-02   +3.785648204819060e-01   +2.858377370940224e-01   +2.564024600939118e-01];
L2I_Input2_iAMPA_netcon = [+2.193230809602079e-01   +2.780077893196091e-01   +4.937560835659441e-02   +4.551166923999858e-02   +1.310068292337909e-01   +4.319162322568146e-01   +2.097661708085719e-01   +2.347312168836646e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
