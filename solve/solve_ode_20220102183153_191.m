function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.241686075352583e-01   +3.497072056951842e-01   +8.561006205043217e-01   +4.064511801150011e-01   +9.771909811101488e-02   +6.608615044223146e-01   -1.106261999510326e-01   +6.378283032809023e-01   +2.520141836535565e-01   +1.000000000000000e+00   +2.530816009181150e-01   -1.990630737864853e-02   +1.639231642844949e-01   +4.869443493065529e-01   +1.151304940557729e-01   +7.713772895609146e-02; +5.362192936254920e-01   +6.564069892795021e-01   +7.283444028022511e-02   +8.151857011333840e-01   +4.892206762672652e-01   +4.514432502257105e-01   +4.374318791861631e-01   +4.432453297194513e-01   +6.776359012564582e-01   +8.365027199862078e-01   +5.472652432389350e-01   +5.058373346648840e-01   +4.424106288083635e-01   +9.513908501797962e-01   +5.032752711216962e-01   +1.901881230198529e-01; +6.948332874476322e-01   +1.306096364023770e-01   -1.337843419076719e-01   +2.850722575531530e-01   +2.940449606561353e-01   -1.711492711384216e-02   +6.295358805659800e-01   +2.895275020450176e-01   +6.358786587838364e-01   +5.009451557369162e-01   +4.331009822441825e-01   -9.176344452522218e-02   +4.733755460536705e-01   -1.604459259717839e-01   +3.541557966149378e-01   +3.441371306170404e-01; +6.515297878740450e-01   -1.533444056760440e-01   +1.693007435618511e-01   +7.026171051078007e-01   +3.289958218107308e-01   +4.936432164042701e-01   +6.748141372725153e-01   +7.197974415767465e-01   +4.577373761072535e-01   +4.402084607479752e-01   +6.739194562168399e-01   +5.706389739337810e-01   +3.132453153237994e-01   +6.521174317858011e-01   +2.697421255521483e-01   +3.530254052001912e-01; +7.525854682741745e-01   +1.103699813893040e-01   +8.896398859110447e-01   +7.572828139804660e-01   -6.000440954481945e-02   +2.291274409468862e-01   +2.791631634412818e-01   +8.181486399623257e-01   +5.151215571304314e-01   +5.199953222469859e-01   +6.426603370774617e-01   +2.155637858805007e-01   +4.032790539866843e-01   -2.266501049019649e-02   +4.659915800717510e-01   +3.313923854183460e-01; +2.539786632277453e-01   +7.355929689652615e-01   +4.355066412143344e-01   +2.396503910845170e-01   +9.378152736798776e-01   +1.454636091897885e-01   +8.613096262609102e-01   +2.085818816940084e-01   +3.574555582700866e-01   -3.430995095348437e-02   +1.036174943900691e-01   +5.730699871061585e-01   +8.292269070236382e-01   +2.833629354299800e-01   +1.948407708328274e-01   +1.253882585463249e-01; +5.750878529702912e-01   +7.294092833658583e-01   +3.709396488465563e-01   +3.197337745100213e-01   +1.198838609032532e-01   +2.118919033348577e-01   +5.330090633814206e-02   -1.429745683005833e-01   +8.439580575301822e-01   +5.072020263467121e-01   +3.334074670590464e-01   +6.564762402638807e-01   +3.869596072871325e-01   +2.826306629915660e-01   +7.981951844019302e-01   +3.493381807976831e-01; +5.027507136819512e-01   +6.555312751815416e-01   +1.970559896091157e-01   +7.999470573968913e-01   -2.036321125788713e-01   -2.431230570632994e-02   +5.660769810373717e-01   +6.416939237096163e-01   +4.392239448563782e-01   +6.041159456825881e-01   +2.632356985898876e-01   +5.745565380655919e-01   +5.904507807863115e-01   +5.543494238463184e-01   +8.497706558588257e-01   +5.089162619575217e-01; +1.922297031770664e-01   +5.603306640168912e-01   +1.691707141786719e-01   +5.280107107974307e-01   +4.086117278190909e-01   +7.535149624705396e-01   +7.529162157456639e-01   +4.044603138053643e-02   +2.938672431040877e-01   +6.184246480389640e-01   +7.867361551170745e-01   -6.272078423030751e-02   +5.568654966455767e-01   +6.483332241625189e-01   +7.041243644138108e-02   +2.993608269266151e-02; -3.614315658338138e-02   +4.459512610222419e-01   +8.784344624983761e-01   +8.686653567010595e-01   +6.207265520745531e-01   +8.565674892771409e-02   +7.295609322020794e-01   +5.294168306302566e-01   +1.521070704953335e-01   +2.616233305643624e-01   +1.909984987380412e-02   +7.051037894542489e-01   +8.939851718271628e-01   +1.304273003564287e-01   +5.360462410085903e-01   +5.750413473108887e-01; +2.167074387621774e-01   +5.740251618662575e-01   +7.218919902492665e-01   +4.242100059165510e-01   +7.190840335298218e-01   +7.000970869490036e-01   +5.193977759699819e-01   +5.083244187750160e-01   +5.374266982189247e-01   +4.115076997978873e-01   +6.103655737842428e-01   +4.090678377170443e-01   +8.095699107943184e-03   +6.721127299579163e-01   +3.721240638914432e-01   +5.701739841349095e-01; +8.791524946851301e-01   +7.371616150203927e-02   +3.731610351241124e-01   +9.919101483974095e-02   +2.966002885329325e-01   +4.761132673270146e-01   +4.068992276874843e-01   +3.660102157962156e-01   +6.961054258713533e-01   -6.101039754278915e-02   +2.881517527381945e-01   +7.415351163729836e-01   +2.431878157512672e-01   +4.111516067344785e-02   +1.513475250323153e-01   +4.979877550537014e-01; -2.558739383850196e-02   +4.570393804767501e-01   +6.534860858442388e-01   +4.991585312143717e-01   +8.034604884471457e-01   +6.095784611425352e-01   +4.050241826240153e-01   +4.702088524615032e-01   +8.478402763930691e-01   +3.922890807364907e-01   +3.167791940097834e-02   +2.353767519689185e-01   +4.116966616647968e-02   -2.416310769776028e-03   +4.833051279594544e-01   +4.156490586730400e-01; +2.874352282466551e-01   +5.294635999017964e-01   +4.629999382147857e-01   +3.621339166214594e-02   +2.876661054427842e-01   +6.605462262567507e-01   +4.287303284891381e-01   +6.089201357009609e-01   +9.362878817826537e-02   +3.886712896632805e-01   +3.890452291069058e-01   +5.347448932401732e-01   +9.122676532601435e-01   +4.610867482145503e-01   +8.784453190422518e-01   +5.133089043496385e-01; +6.359672102165700e-01   +1.376545215750262e-01   +2.329087485946897e-01   +7.101819601310887e-01   +4.083194172634300e-01   +5.130307186102723e-01   +5.654422982098688e-01   -3.312616640329580e-02   +1.326180483687460e-01   +5.356175333846254e-01   +3.690821125209800e-01   +7.550818070032024e-01   +7.940376700235920e-01   +7.284699728115327e-01   +7.235810229253986e-01   +2.607774079225469e-01; -8.008031754887765e-02   +3.887845718042827e-01   +7.378567119147852e-01   +4.064580527961758e-01   +6.909617167283540e-01   +8.346805123548289e-01   +1.310075783207037e-01   +9.004291632658593e-01   -1.153204732695163e-01   +6.279685172560923e-01   +5.074544304360769e-01   +3.527004884423732e-01   +5.508019082671266e-02   +5.962711885338479e-01   +7.504544351490777e-01   +4.114335750898200e-01];
L1E_L1I_iGABA_netcon = [+7.106531664058047e-01   +5.515482899387010e-01   +7.096133802344683e-01   +2.697842785594049e-01   +3.502293717769820e-01   +2.534768206601528e-01   +6.956026136004839e-01   +3.134949891701079e-01   +1.340345104832974e-01   +2.659709253543291e-02   +4.229403852666999e-01   +2.880154262159303e-01   +5.463395352299303e-01   +5.841441867742544e-02   +2.686079768073672e-02   +8.984685070855668e-01; +3.105997753482005e-01   +1.030445345228357e-01   +7.463463274423341e-01   +5.929506052918033e-02   +4.308311248327246e-01   +6.961051881304442e-01   +4.703565359576962e-01   +6.638363833451947e-01   +5.239849533236763e-01   +3.865570781510609e-01   +4.597516476076441e-01   +3.771024055192468e-02   +8.687685486286301e-01   +4.220024450436567e-01   -1.301392652860007e-01   +2.477339533789021e-02; +2.783583874281553e-01   +5.978393842386497e-01   +6.709901130343764e-01   +1.534149839781461e-01   +6.263000398366744e-01   +5.046277451212695e-01   +5.346180738678459e-01   -2.128306469356009e-02   +1.076325045015020e-01   +8.674911245768586e-01   +4.548427589731542e-01   +4.489662681339872e-01   +1.746941985877846e-01   -5.232538473044238e-02   +1.002558384556558e-01   +8.142776749551305e-01; +7.430505554451150e-01   +2.180262922054771e-01   +3.625850351221733e-01   +5.571655132593046e-01   +3.792742418990190e-02   +2.540010548250843e-01   +2.339049464102726e-01   +1.766576298228681e-02   +2.311672306098418e-01   +3.050574512291575e-01   +3.221803001003360e-01   +8.725353118030247e-01   +2.460841446923672e-01   +6.752774065149243e-01   +2.493437491369527e-01   +6.599881162066382e-03; +5.451046377980846e-01   +3.651684503914805e-01   +1.651687099962081e-01   +2.744787234231647e-01   +6.970779567685172e-01   +3.336695200055981e-01   +6.314262755866121e-01   +1.165721114762614e-01   +6.153501457049834e-01   +2.395054546307059e-02   +3.134081572720509e-01   +5.444432469318150e-01   +3.979873290677072e-01   +4.313040210158847e-02   +1.698860447081597e-01   +4.923883281938293e-01; +2.406772983939262e-01   +6.676186589244949e-01   +7.554388357889709e-01   +8.642644119432481e-02   +5.835578816454866e-01   +6.514376939795703e-02   +2.474714257072073e-01   -4.675952278763292e-02   +2.027923796341786e-01   -6.779681306261115e-02   +6.116079234109794e-01   +8.370758441767927e-01   +4.176496289205155e-01   -2.488494183450219e-02   +4.266019623756107e-01   +3.533124021676035e-01; +5.947695357606170e-01   +3.032717011566503e-01   +3.476515497823295e-01   +2.031312115755436e-01   +8.624815462973388e-02   +3.554887702004241e-01   +6.049330036632129e-01   +1.192532913492637e-01   +2.075715195518680e-01   +1.645433513592240e-01   +4.226729104980799e-01   +4.798249837463396e-01   +7.689209738157979e-01   +4.218723587427659e-01   +4.506233772523697e-01   +3.104627643269908e-01; +8.476356346795857e-01   +5.543091085963272e-01   +1.989087256794015e-01   +5.270589096405768e-01   +4.009238855823473e-01   +2.967694580559379e-01   +3.629831825275183e-01   -6.339865330100923e-04   +1.000000000000000e+00   +1.765853472261528e-01   +6.804782741480051e-01   +1.025130717534768e-01   +2.674665183915801e-01   +4.399372076016457e-01   +1.104480793737588e-01   +5.078430042207839e-01; +4.312455239285513e-01   +2.196956171313382e-01   +3.026798311285381e-01   +6.946633034192329e-03   +5.298840604032782e-01   +7.620949583257635e-01   +2.881733966409138e-01   +3.763081500814772e-01   +5.356449391981219e-01   +5.110897275939649e-01   +4.172421132030616e-01   +6.970085762014673e-01   +2.228400947806619e-01   +2.869560417918514e-01   +4.063362910108012e-01   +3.352498604830128e-01; +1.629448418173744e-01   +7.207031746336824e-01   +7.766311878054163e-03   +7.142973630986609e-01   +2.664354480286505e-01   +5.426525686145234e-01   +4.292948169049740e-01   +3.329189099591863e-01   +6.132154804222093e-01   -1.380016756527959e-01   +1.369068261988979e-01   +5.352215273563840e-01   +5.986297388166800e-01   +4.972688688599812e-01   +3.082840281111786e-01   +5.445343400934906e-01; +5.546444980032610e-01   +3.583331502705255e-01   +3.691043163222764e-01   +3.443532880429610e-01   +2.138878385404400e-01   +3.293915663884870e-01   +5.819906355991791e-01   +1.370086816038336e-01   +6.415925386451142e-01   +7.199945212251598e-02   +2.442179616066698e-01   +4.902895443954851e-01   +6.373226541711345e-01   +3.298312644489872e-01   +2.688409421193071e-01   +9.806183367294284e-02; +4.663711573165920e-01   +3.240080329575720e-01   +1.759429844769974e-01   +2.400445026365610e-03   +2.770328178307792e-01   +2.710647919176947e-01   +9.029107087740684e-02   +6.159163620559269e-01   -5.437318409149476e-02   +6.878360457588143e-01   +5.701658414666348e-01   +8.516488305080405e-01   +1.811525480476987e-01   +1.514356586803452e-01   +2.998018219781952e-01   +7.977881175092428e-01; +6.170969386824113e-01   +2.406348053059492e-01   +1.428504741319873e-01   +7.280794029635309e-01   +8.220162483222594e-02   +1.705214445907657e-01   +4.697208430707527e-01   +3.284589363868681e-01   +7.828439006858734e-02   -3.090230825036682e-02   +7.985667240245308e-01   +2.807682963139288e-01   +3.718821635679292e-02   +1.610162072789954e-01   +5.237604222245343e-01   +5.338250057254783e-01; +3.327206180621590e-01   +3.821004318992182e-01   +3.660372155171935e-01   +6.960952890909173e-01   +1.104231120292503e-01   +4.180901966039888e-01   +6.270166002051603e-01   +2.354601548053203e-01   +7.895076053435126e-01   +1.758420176816976e-01   +3.590117565485552e-01   -2.631213502172005e-02   +2.841119776092995e-01   +3.070178285618410e-02   +8.960804799937898e-02   +1.861618229521107e-01; +7.221106383821463e-01   +4.574364896727656e-01   +2.218810269678677e-01   +1.819074381547008e-01   +2.282398036313129e-03   +2.399694704716488e-01   +2.708721893808118e-01   +7.816402944200389e-01   +3.509594162351318e-01   +4.679211870872713e-01   +6.928491397563050e-01   +1.343809742915801e-01   +7.488073930060495e-02   +1.822009161501014e-01   +2.349546783540998e-01   +5.904059716477519e-01; +6.375596951481313e-01   +4.842894024260286e-01   +7.899918148363707e-01   +3.602873336081653e-01   +6.431449414501852e-01   +3.079072558808865e-01   +4.488789360062320e-01   +3.384399052418069e-01   -4.455628314579344e-02   +4.003904777652404e-01   -1.689840912652108e-01   +4.616904544234419e-01   +5.215607634673257e-01   +3.483674313934350e-01   +4.015115194289158e-02   +3.126223495683084e-01];
L2I_L1I_iGABA_netcon = [+6.283340658528981e-01   +1.882462774170220e-01   +2.340797713281677e-01   +8.610056189677929e-01   +2.762833977513640e-01   +4.161037580530504e-01   +9.014018107282079e-02   +5.028608360820486e-01; +4.086469764492985e-01   +7.191221734417517e-01   +2.720018393037552e-01   +3.170718505805162e-01   +5.228263041329024e-01   +3.244224722549837e-01   +5.720856816669010e-01   -1.718344214270622e-01; +5.110409737318660e-01   +4.542880112181330e-01   +4.303293085169086e-01   +2.657682349981487e-01   +4.306367804563399e-01   +1.068851690529981e-01   +3.825525768264195e-01   +2.664077481469495e-01; +4.675965685885339e-01   +1.965558963093070e-01   +1.789452550895349e-01   -8.155272238225136e-02   +7.329751352904335e-01   +3.285808372627231e-01   +4.595241098424295e-01   +5.299926241724386e-01; +2.757094700493338e-01   +9.142422781536289e-01   +3.010001973937532e-01   +7.882805856781135e-01   +2.633927900027703e-01   +3.189781907330421e-01   +3.913592273411901e-01   +2.896103906600437e-01; +5.805163523055863e-01   +6.045988141691540e-02   +3.503830757109929e-01   +3.239609903938012e-01   +1.198802566447031e-01   +4.462472530283428e-01   +4.568632887354930e-01   +8.109581636624533e-01; +4.988685709880658e-01   +1.000000000000000e+00   +8.314053210115983e-01   -4.876122485903549e-03   +4.652190737320523e-01   +2.309744584367084e-01   +5.754488111525409e-01   +2.223182446384575e-01; +4.449340469237114e-01   +4.362536296644582e-01   +2.173778587379321e-01   +2.138313778282805e-01   +4.339083287140427e-01   +3.517431998354472e-01   +2.795426503185042e-01   +1.904325004866475e-01; +6.503620191806588e-01   +8.991337258903518e-01   +5.814565142309455e-02   +6.395429234440050e-01   +1.727753176169452e-02   +1.676571057298836e-01   +2.571559196488107e-01   +3.742674190562617e-01; -4.437611584845025e-03   +1.481487301526749e-01   +2.427624348783302e-01   +7.121243933989321e-01   +7.964915110340394e-01   +3.254405679177647e-01   +9.843100195480445e-02   +8.137736619039025e-01; +1.767169556658006e-01   +8.345464093850561e-01   +2.981151149162102e-01   +6.781264530239118e-01   +2.928113076484695e-01   +3.313426655951437e-01   +4.854319214176069e-01   -9.787526308142702e-03; +5.726860423631992e-01   +1.869467246114027e-01   +7.285324704882740e-01   +1.131201867123388e-01   -7.980717225393592e-02   +7.038916067057241e-01   +4.014413071013538e-01   +4.727321801576458e-01; +3.360399709252201e-01   +7.243034939338850e-01   +9.219605708462987e-01   +1.245770518149155e-01   +6.938517442741254e-02   +1.211379688287386e-01   -9.695806837164116e-02   -1.654185775513055e-01; +1.105018240137106e-01   +2.779582169090860e-01   +5.005325948396881e-02   +1.810202217723282e-03   +3.652791592439489e-01   +2.977036354574450e-01   +3.519361832173891e-01   +2.256860158450952e-01; +6.569922399507735e-01   +6.913491265866825e-01   +8.027181551438095e-01   +6.795416560944826e-01   +5.203211202922761e-01   +7.472388046591426e-01   +5.982352243512161e-01   +6.772254589738551e-01; +2.269481283790239e-01   +2.418520359857718e-01   +7.209952162804718e-01   +4.648022716440764e-01   +1.378988950887625e-01   +3.430650325919798e-01   +7.264765891821512e-01   +9.473548724405582e-01];
L1I_L2I_iGABA_netcon = [+6.403160291977186e-01   +4.969137467829614e-01   +4.207086119253416e-01   +5.902105218461683e-01   +4.643212249266160e-01   +1.563862653911266e-01   +6.513597155988763e-01   +4.750787177141608e-01   +6.064054742304203e-03   +6.070739071615291e-01   +5.005583997164857e-01   +2.992684967743437e-01   +6.788872850028392e-01   +2.312500368148825e-01   +3.653423357590136e-01   +4.055260621002221e-01; +4.310743984761971e-01   +8.145850830021300e-01   +1.272956880987911e-01   +5.748836584131951e-02   +3.383604228686290e-01   +5.613569425505507e-01   +8.447699043229943e-01   +1.626729724896925e-01   +6.843710336100649e-01   +7.169100415079369e-01   +4.245496196421195e-01   +3.407630794713510e-01   +3.947008122284598e-01   +9.729834283055132e-02   +6.837840100563540e-02   +5.327500021377019e-01; +1.592153378333352e-01   +2.506057028824827e-01   +2.413288323565854e-01   +4.182280640584849e-01   +6.818130405169088e-01   +8.397004352414145e-01   +5.421962738490089e-01   +6.997621144415334e-01   +5.912464146834347e-02   +2.237889570474559e-01   -2.055646948758268e-02   +6.099730734105232e-01   +4.856682755553441e-01   +7.484133105660573e-01   +4.239402953140420e-01   -1.210948584036420e-03; +5.480346802115118e-01   +5.067346663530609e-01   +2.737663850977304e-01   +2.704730327482008e-01   +5.573672929788507e-01   +3.593245183436364e-01   +6.960409471832286e-01   +6.518423426540790e-01   +3.249425437665001e-01   +3.349122903155913e-01   +2.271533785289079e-01   +1.834147443153986e-01   +4.741068497594550e-01   +1.826151366748812e-01   +5.554809296780122e-01   +2.635141994234411e-01; +5.361692244760654e-01   +1.880772814879431e-01   +4.350734205252633e-01   +7.917720248124388e-01   +2.494692364245258e-01   +8.337271243205078e-01   +5.379888460599453e-01   +3.118217717318894e-01   +6.614526685735675e-01   +2.592913803653780e-01   -2.693411017395295e-02   +4.456470185424636e-01   +7.446819178925845e-02   +4.744810398202576e-01   +4.607669760599714e-01   +4.884612740752795e-01; +1.562527021541623e-01   +4.346671692499937e-01   +1.031935664418406e-01   +6.772470526207364e-01   +3.413626784724318e-02   +5.151675824819685e-01   +6.455522779917900e-01   +8.198554835321786e-02   +2.841537795043643e-01   +1.041739999027418e-01   +5.138046397059625e-01   +2.114375539085511e-01   +5.880153868017731e-01   +5.216585845303464e-01   +1.782888754096797e-01   +4.467159879083358e-01; +5.447288246662424e-01   +5.329941532911990e-01   +2.951363426751614e-01   +4.276852371833288e-01   +9.443629562984415e-01   +2.375832477610944e-01   +5.236909206306559e-01   +1.760848390690318e-01   +3.535537854925299e-01   +7.126238636490425e-01   +1.954768950189253e-01   +5.653669335103290e-01   +3.715580367326985e-01   +2.514130991264185e-01   +1.864935169902975e-01   +4.538894905879359e-01; +4.634512853969358e-01   +3.344210994126158e-01   -4.276222630120218e-03   +4.179591670055312e-01   +8.460929288925669e-01   +6.352236799542499e-01   +2.636014726895209e-01   +3.809102639577979e-01   -4.700222065079308e-02   +5.853177857447073e-02   +1.000000000000000e+00   +2.797981070658725e-01   +5.888988916538143e-01   +1.844362194623259e-01   +8.122512656971640e-01   +1.466494692126359e-01];
L2E_L1E_iAMPA_netcon = [+6.718510397201043e-01   +5.158157308518624e-01   +3.746403337462512e-02   +3.155907716109622e-01   +8.203089472402503e-01   +5.042621457161218e-01   +4.291784843491082e-01   +5.258938699798302e-01; +6.016148697901877e-02   +4.938524469819854e-01   +9.288776732638131e-02   +2.951328748631771e-01   +4.075702281611571e-01   +2.296359269032744e-01   +4.458994874911624e-01   +4.933025542867678e-01; +2.179165266128596e-01   +9.530217985780046e-01   +4.185116223527267e-01   +1.771330169556985e-01   -4.750316972335237e-02   +5.691409758111423e-01   +4.877662183396820e-01   +6.730176847039812e-01; +4.793336053731315e-01   +2.841076473840903e-01   +1.455568889081608e-01   +7.029976690733479e-01   +1.822635819271984e-01   +2.684308529629649e-01   +3.395655311970704e-01   +3.750373490219815e-01; +3.276310829118694e-01   +4.250284161784235e-01   +1.414672140507969e-01   +6.057108664690881e-01   +5.659919866508664e-01   +5.567878832352888e-01   +1.000000000000000e+00   +7.204253961826274e-01; +6.194497437553191e-01   +1.773413679576249e-01   +6.568089509960350e-01   +1.748708213262719e-01   +3.878953390795657e-01   +6.589240769071153e-01   +7.600585156593306e-01   +1.989285212079285e-01; +3.171546330380512e-01   +5.634924720277744e-01   +2.258741199517145e-01   +2.121867129641629e-01   +1.531818654876036e-01   +1.999482981449622e-01   +5.524494061902505e-01   +4.852052155262546e-02; +4.236120957582929e-01   +6.439387786490708e-01   +8.892850646711818e-01   +3.421253498515311e-01   +1.270747072261396e-01   +5.367310237420106e-01   +5.208202723296159e-01   +4.938568442940042e-02; +7.797958270052018e-01   +5.815499840738337e-01   +1.028330279296896e-01   +5.548168102963955e-01   +3.284061500404473e-01   +4.255647092468084e-01   +1.476441331143833e-01   +3.149934274585053e-01; +3.744538764394231e-01   +6.707827623318241e-01   +6.238395330997218e-01   +2.785880397715990e-01   +3.328323182443494e-01   +3.874256656699810e-01   +5.829638849853661e-01   +7.198734984756712e-01; +1.473893467996871e-01   +3.689532124765137e-01   +3.736913796891695e-01   +3.886380025922943e-01   +4.140562841583900e-01   +3.234609488177664e-01   +1.585041562007573e-01   +6.469599509879586e-01; +4.890108910298712e-02   +3.743677238186144e-01   +5.730544301697120e-01   +4.911982716173051e-02   +3.076243108268001e-01   +3.450128039128246e-01   -1.425988244273896e-01   +2.043663925552416e-01; +2.101392766515496e-01   +4.762240681577133e-01   +1.500148345046813e-01   +5.401710049350007e-01   +6.036292325860748e-01   +2.196317033930404e-01   +3.209482847764663e-01   -9.666790537228713e-02; +2.100715791776536e-01   +3.804381197607748e-01   +3.047854399743570e-01   +7.414302727099236e-01   +4.391152828232160e-01   +4.336082263365128e-02   +4.734441032597355e-01   +3.642672210181133e-01; +2.663469715060786e-01   +2.495376075063273e-01   +7.876610181411150e-01   +2.995688849025149e-01   +3.276893134637825e-01   +7.452741076786151e-01   +3.294386385636005e-01   +5.427513971143622e-01; +3.728666662250063e-01   +2.011616500826245e-01   +1.999030611823556e-01   -8.262836134815042e-02   +6.232215696263343e-01   +3.685306924650174e-01   +3.102828711756191e-01   +7.611318926327550e-01];
L1E_L2E_iAMPA_netcon = [+2.202037703095550e-01   +2.074060404154034e-01   +3.307484562001428e-02   +5.061794743283966e-01   +2.143078994070513e-01   +3.170261813174131e-01   +4.091078133302400e-01   +4.577656462694489e-01   +5.592928526174302e-01   +6.011712713311949e-01   +5.444453626545944e-01   +5.886044592659130e-01   +5.023592567781512e-01   +1.583543311779201e-01   -1.205095743754893e-01   +3.370527248361041e-01; +3.839252081160931e-01   +4.502987444776760e-04   +1.763450652134927e-01   +5.249343413275284e-01   +4.107018022771292e-01   -6.804905080956962e-03   +2.604577616360332e-01   +4.645004463102246e-01   +4.135633957626516e-01   +2.404647567648375e-01   +4.914226044186633e-01   +7.295222911803504e-01   +2.275378999253481e-01   +1.580597886378809e-01   +3.103208547503556e-02   +4.710219937864223e-01; +9.581326601684914e-01   +5.814805384428139e-01   +1.753258037920963e-01   +1.385364975638369e-01   +5.467181824592530e-01   +6.790182831142749e-01   +4.197795775804927e-01   +8.500111340135944e-01   +4.314015657311007e-01   +3.594274482762649e-01   +1.311654769241378e-01   +3.304258126039475e-01   +8.230212109006053e-02   +3.740865048714204e-01   +6.203879618599037e-01   +7.699951696744407e-02; +4.415483126086492e-01   +4.826173169328060e-01   +5.576874488275373e-01   -1.319947928351482e-01   +4.161687115373350e-01   +3.661070070257778e-01   +6.807714012093731e-01   +3.145688666553089e-01   +4.285535381612260e-01   +4.554143297785389e-01   +6.956085186162154e-01   +3.487447215949391e-01   +3.983930705315332e-01   +3.996748999886662e-01   +7.023235743794123e-01   -7.729981473135303e-02; +2.015939418057254e-01   +1.200986485663802e-01   +7.997694711388142e-01   +4.225155103332465e-01   +2.244694265645113e-01   +7.095738944460729e-01   +4.180269974085192e-01   +4.073238835411057e-01   +9.198971601279415e-01   +1.844491927351957e-01   +4.432916158961657e-01   +1.745455895523651e-01   +3.754838645773003e-01   +6.709039202707084e-01   +8.547152885001835e-01   +3.290158341694680e-01; +4.946325573450800e-02   +7.262448183137992e-01   +9.738908799607220e-02   +4.567187834558838e-01   +2.335612351669620e-01   -1.560129357475109e-01   +5.664306780687709e-01   +5.450848729281788e-01   +6.646160622662299e-01   +4.036100066945905e-01   +6.804087453042453e-01   +2.760623027140940e-01   +2.680069508992247e-01   -7.514701483988380e-02   +1.317322244882790e-01   +8.682178879666362e-02; +1.171731242030688e-01   +1.489578206244868e-01   +5.290583327806428e-01   +7.647945430113164e-01   +2.971380152379468e-01   -9.427005634306511e-02   +8.093766344517281e-01   +5.328323584872943e-01   -2.795793802140522e-02   +5.568204998127320e-02   +2.434323008543638e-01   +9.195877240512501e-02   +1.153676375510251e-01   +1.562402182188783e-01   +3.013417855387422e-01   -7.248910246918568e-03; +1.671358414964411e-01   +3.905943885561843e-01   +6.839886311300972e-01   +5.011225659685896e-01   +8.208620703161384e-01   +1.000000000000000e+00   +6.742497146569525e-01   +1.798364764756068e-01   +9.904249684009615e-03   +5.409171167230268e-01   +8.151820560498528e-01   +2.816622389547988e-01   +4.436098996632387e-01   +2.100103362786186e-01   +2.975041470843237e-01   +3.434866387842590e-01];
L2I_L2E_iAMPA_netcon = [+5.903662409518531e-01   +8.759837451990886e-01   +4.611730397625211e-01   +3.636587235464789e-01   +7.817134028494196e-02   +9.633230965983498e-01   +3.605656007499902e-01   +5.660067850554277e-01; +7.770320991677446e-01   +2.096986744927892e-01   +9.831508834681821e-01   +8.926648716652277e-01   +7.628437667344998e-01   +1.586244993282444e-01   +3.173804375051294e-01   +5.064649661006606e-01; +8.391025343889196e-01   +1.672883559112897e-01   +2.741887638269636e-01   +7.290144162118616e-02   +3.979352402076449e-01   +8.106313204420584e-01   +5.711251817666868e-01   +4.865223332234302e-01; +2.902222184862785e-01   +5.992546260785347e-01   +4.578734558311977e-01   +1.000000000000000e+00   +5.250488612237959e-01   +3.486783378245537e-01   +1.726046170816817e-01   +5.302737816565308e-01; +6.945674067672254e-01   +4.004806448791579e-01   +5.484559868091929e-01   +7.056869900767737e-01   +7.045220903828096e-01   +6.794085890743842e-01   +9.326201255815071e-01   -5.459813814453135e-03; +2.972604553667614e-01   +6.797859009596069e-01   +2.402493684332454e-01   +8.476833204936383e-01   +1.629268150500832e-01   +2.408623059510311e-01   +5.386919469252295e-01   +4.340155215632244e-01; +5.739506510222592e-01   +3.978377447275190e-01   +2.626827167239324e-01   +9.087789631122779e-01   +6.450365498486947e-01   +5.753510351333637e-01   +8.448023996672464e-01   +3.066609180334170e-01; +7.627952785593517e-01   +4.002055780670349e-01   +1.083191065297032e-01   +4.967806515098260e-01   +6.999625152463376e-02   +8.865246313943638e-01   -2.685178833131835e-01   +6.102896033117891e-01];
L2E_L2I_iGABA_netcon = [+2.180005601038273e-01   +4.314220722566067e-01   +2.981018356996514e-01   +1.306502877427999e-01   +2.039903654063029e-01   +4.299053974220090e-01   +5.369274281083659e-01   +6.736419227744163e-01; +4.640407283033830e-01   +8.667902831476128e-01   +4.932826567708998e-01   +3.541934534497103e-01   +5.907287322866612e-01   +5.470356546976907e-01   +6.822390624595753e-02   +2.764809198694838e-01; +2.934911265612608e-01   +9.235767119891954e-01   +1.094963874746505e-02   -1.584947290019446e-01   +5.159992778883997e-01   +7.974920897534029e-01   +1.601337469972176e-01   +5.954047531212372e-01; -1.965053387088514e-02   +8.705865784641107e-01   +5.921480868489566e-01   +6.361181990908176e-01   +1.000000000000000e+00   +6.858784409978496e-01   +1.596516115811342e-01   +2.516714671283513e-01; +2.030336141974840e-02   -7.783622862493395e-02   +2.597170973144955e-01   +6.528319033444842e-01   +7.344118179800020e-01   +3.976709107425722e-01   +2.048683027469603e-01   -9.414826536368127e-02; +2.143917259535755e-01   +3.605427499149327e-01   +2.410455390479612e-01   +1.200091152253168e-01   +6.287913389625164e-01   +5.409066259448302e-02   +4.745921707163241e-01   +5.680999152350786e-02; +7.336798071281710e-01   +1.402662985705832e-01   -4.298128093743076e-02   +3.531118954792300e-01   -6.424196161541823e-03   +1.246356201369527e-01   +6.191061752569326e-01   +7.425784914132215e-01; +2.641707599884849e-01   +7.112740017367949e-01   +6.320272756530485e-01   -1.019658554602502e-01   +7.509881249854827e-01   +6.751693142517120e-01   +5.625107521326232e-01   +5.495932525287357e-01];
L3E_L2E_iAMPA_netcon = [+1.505358964453292e-01   +1.260697025796340e-02   +2.850989063423949e-01   +6.952379251026429e-01   +2.453304088551863e-01   +2.270355201449756e-01   +5.405545942632282e-01   +7.273875886947972e-01   +4.148651200514352e-01   +3.897293644502671e-01   -1.028821338228595e-02   +6.219042652592119e-01; +5.479147556855397e-01   +8.884344077981656e-01   +9.492546105832368e-02   +2.176937599536325e-01   +3.718986878224382e-01   +3.591689027547842e-02   +3.699620121633582e-01   +1.526608784114266e-01   +7.894259597419104e-01   +1.511265115829172e-01   +6.275689799613298e-01   +2.527746630260722e-01; +4.906046241558894e-02   +4.899837943985767e-01   +6.381897285875910e-01   +3.416162710876344e-01   +9.664834769680004e-01   +5.315809216457780e-01   +7.817758407441903e-01   +3.982469241236180e-01   +5.914801251799149e-01   +2.409697286724338e-01   +1.257226570516173e-01   +6.808496083025509e-01; +4.435782856526302e-01   +3.710625653600874e-01   +7.841808280880167e-01   +3.825993574119227e-01   +5.587946655700209e-01   +3.612892039056959e-01   +3.327875025660055e-01   +4.053157796950728e-01   +4.327270161730544e-01   +6.640296661873819e-01   +9.023204454537394e-02   +1.714153078197978e-01; +6.877838535745670e-01   +3.216248229661087e-01   +1.007154088058506e-01   +2.225834082342651e-02   +5.830393695475263e-01   +4.003834712186547e-01   +4.980223865918693e-02   +2.154256572171274e-01   +7.723632044886997e-01   +4.916879357651136e-01   +6.962934007239179e-01   +7.617777643211775e-01; +4.185442852675516e-01   +7.128458401267830e-01   +5.834617309220131e-01   +1.600740646561800e-01   +4.820816712983558e-01   +1.000000000000000e+00   +9.586264366575468e-02   +7.635512518722821e-02   +1.738596420853722e-01   +7.009268280680493e-01   +9.555584256793448e-02   +4.624540996636917e-01; +1.772020672188603e-01   +5.325163565041341e-01   +7.437427857285860e-01   +1.998779648770787e-01   +1.841326069787224e-01   +7.680667740485141e-01   +5.996085650210220e-01   +6.493389360663125e-01   +4.301077193714653e-01   +5.826562875776794e-01   -7.199251210969156e-02   +1.586845584524007e-01; -9.222350041058491e-02   +5.567606957204287e-01   +1.474213518240033e-01   +6.536397609113725e-03   +4.529890966586688e-01   +1.756924969401973e-01   +3.126936203907885e-01   +7.374827623631855e-02   +9.781693888696174e-01   +6.736775879176843e-01   +8.841651428297835e-02   +4.472237512389733e-01];
L3I_L2I_iGABA_netcon = [+7.099738417555757e-01   +4.112557710392640e-01   +2.626704303524952e-01   +7.319683623884764e-01   +1.247966069716428e-01   +2.718876577430403e-01   +6.866453991440339e-01   +4.403511867801045e-01   +7.168078051030781e-01   +1.253346612930913e-01   +6.378713175433554e-01   +7.453160316462859e-01; +4.365833301726480e-01   +2.134866719657691e-01   +4.016606819955115e-01   +3.351755277413505e-01   +9.414359053610020e-01   +9.717025914249754e-02   +5.366776206398415e-01   +1.477748828864088e-01   +5.280220319262491e-01   +9.846632333828224e-02   +4.277307148019870e-01   +2.485271597285379e-02; +4.472972212374537e-01   +4.422891671214754e-01   +7.409181862849332e-01   +1.903163373850223e-01   +6.086853856791501e-02   -5.250541603832455e-02   +5.550037991821953e-01   +8.517912342274215e-01   +4.738152945853404e-02   +1.789767331475365e-01   +1.221452113123305e-01   +5.546970127047717e-01; +4.201353235702761e-01   +7.880360650436847e-01   +5.958639217194469e-01   +1.112013836439665e-01   +1.218160937942291e-01   +6.880936483254898e-01   +2.604344840655547e-01   +2.391014037148535e-01   +3.568053657254496e-01   +5.153794329259500e-02   +6.732087224683112e-01   +4.453032237003394e-01; +1.558077297393444e-01   +1.817244869830131e-01   +3.694202104159847e-01   +4.143714249991299e-01   +6.183086627248665e-01   +8.539363652579794e-01   +1.139286051110364e-01   +7.288825638402102e-01   +7.115892659375306e-01   +2.869914900091557e-01   +2.041729307226896e-01   +8.296634207760764e-01; -3.973928534174488e-02   +7.271259099053951e-01   +2.863937724769577e-01   +5.978005363712918e-01   +8.697402480195509e-01   +3.830690993987300e-02   +4.572243086454406e-02   +5.710193143543607e-01   +3.269439474368884e-01   +2.206756655681238e-01   +3.123774075976013e-01   +8.888984990641942e-01; +8.115997126464594e-01   +4.605418333289754e-01   +5.748099557377798e-01   +2.246562578336722e-01   +1.195816869845863e-01   +2.856903099719758e-01   +1.000000000000000e+00   +1.727324932183007e-01   -1.254080196194798e-02   +4.379483603771952e-01   +3.975852683770585e-01   +1.833310400860150e-01; -1.165527288168332e-01   +4.667813392204316e-01   +8.907472163148005e-01   +7.878750200817215e-01   -1.480614322682445e-01   +6.573023176612611e-01   +3.695105919252883e-01   +2.601655313468812e-01   +6.466591640995686e-01   +4.879590084476841e-01   +3.615945896597634e-01   +5.859146675916070e-01];
L2E_L3E_iAMPA_netcon = [+3.476601628077883e-01   +3.561696287639448e-02   +1.676348193658171e-01   +2.657717179382320e-01   +1.340566878007379e-01   -2.652659675596736e-02   +3.398980347414121e-01   -1.608297007177998e-01; +3.846577160709631e-01   +8.921436077693174e-01   +4.653932370408543e-01   +1.045763212444048e-01   +7.613402211474002e-01   +5.405912454808558e-01   -2.215794795388633e-02   -1.093325191235329e-01; +2.854759009109360e-01   +1.894682039159098e-01   +6.709516971227901e-01   +8.448446239709978e-01   +4.973055248214572e-01   +3.805062688352479e-01   -1.918649254792462e-01   +3.493671465774474e-01; +6.120548401107869e-02   +5.540571426181424e-01   +6.663593873895666e-01   +4.932954907930980e-01   +6.823876411382093e-01   +4.513001495788166e-01   -4.471009740429392e-02   -7.608044387961717e-02; +1.029324668158813e-01   +4.371979057055918e-01   +4.436445783286483e-01   +8.259751382893972e-01   +7.966305491877922e-01   +1.301745227832785e-01   +6.453031317913588e-02   +6.293148234931687e-01; +5.825458038755535e-01   +7.741338187380458e-01   +8.145563422051481e-01   +5.987159505755163e-01   +2.196991159930455e-01   +5.086512447206660e-01   +1.000000000000000e+00   +4.796717682916547e-01; -1.247201098099788e-01   +3.704160424330312e-01   +8.915389708944018e-01   +9.087512516629696e-01   +3.409498713461644e-01   +4.490220963354791e-01   +3.912882281066262e-01   +3.669363420051485e-01; +6.763787529952011e-01   +4.193137172245932e-01   +2.181942343354364e-01   +8.790999493886402e-02   +5.549533565447542e-01   +5.244597276464220e-01   +7.740750421365528e-01   +7.857639142194014e-01; +7.593376463304803e-01   +2.146768530123236e-01   +5.743489390924005e-01   +3.070627610281673e-01   +2.504607223977954e-01   +1.776974954316993e-01   +7.752413649659905e-01   +4.000682691533521e-01; +1.166928538512473e-01   +5.033239490811946e-01   +1.261946576093027e-01   +6.877437456091353e-01   +1.853878621852329e-01   +1.742953752360468e-01   +8.182040213014187e-01   +4.632659330498878e-01; +6.700769363082902e-01   +2.322009900914833e-01   +8.612293930773565e-02   +5.157031422323399e-01   +7.281932873451885e-01   +9.852998766534937e-01   +1.527680048343274e-01   +8.981926821243964e-01; -1.206033644918346e-01   +6.990362902093988e-01   +8.134540857143133e-01   +3.878012218400698e-01   -1.025698477443106e-01   +4.097141974192699e-02   +1.437482322472751e-01   +6.059589608907974e-01];
L2I_L3I_iGABA_netcon = [+2.622056223855099e-01   +4.758392520692453e-02   +1.000000000000000e+00   +9.398797976480018e-01   -1.484644595659196e-01   +1.815501845304416e-01   +3.263084530763068e-01   -2.016942204495073e-02; +1.560036692636356e-01   +3.943663229186626e-01   +9.225936829985394e-02   +1.034778508877106e-01   +4.070655019681130e-01   +2.390278995607009e-01   +5.426260117585845e-01   +3.668455212180055e-01; +5.379461680365052e-01   +2.265424190117892e-01   +3.868327679315341e-01   +3.083320488727651e-01   +8.162573852736147e-01   +8.301033202180704e-01   +3.462847871191451e-01   +4.588984628994763e-01; +3.028483274300804e-01   +2.634419092415958e-01   +7.420680185334245e-01   -2.008746291050766e-01   +7.888895151333996e-01   +3.826812080861294e-01   +3.968035342210871e-01   +5.302297448915173e-01; +9.604188202392175e-01   +9.780432822835252e-01   +4.748106095772814e-01   +5.771308029252926e-02   +5.172022510112397e-01   +8.722247689814205e-01   +4.993783837237332e-01   -9.487955123569032e-02; +3.715776755169393e-01   +6.116975090230465e-01   +9.044433572877728e-01   -1.551904029087032e-01   -1.076593830086910e-02   +7.503850254257705e-01   +6.163605755048360e-01   -7.156370012247185e-02; +8.116967465021198e-01   +7.548118731004887e-01   +3.741516501495852e-01   +8.786724814414747e-01   +2.036306880575643e-01   +6.785779522208525e-01   +9.228123320012616e-01   +4.166106368098337e-01; +2.500012573515773e-01   +5.460720274164906e-01   +7.640505449901473e-02   +2.589358904400617e-01   +5.358513361897655e-01   +7.558289859132781e-03   +1.307703144993049e-02   +4.053073501594933e-01; -2.859320520752650e-02   +4.688885723144292e-01   +5.254787905690949e-01   +1.613890227833536e-01   +7.879274131170597e-02   +7.038348871509436e-01   +6.691537116404975e-01   +5.564628597661083e-01; +5.930879119668545e-01   -2.399123441416800e-01   +2.337467519201757e-01   +4.707153212198269e-01   +3.589877288235518e-01   +8.721979340136218e-01   +3.674189050330858e-01   +3.680103326662020e-01; +3.237561944640336e-01   +3.898232498451551e-01   +2.711222412703597e-01   -4.859749253423393e-02   +6.450929728128967e-01   +9.215476523132560e-02   +2.299111811832263e-01   +9.264494097283228e-01; +6.229294879603900e-04   +7.147074217388695e-01   -1.889650110277502e-01   +5.396507789153592e-01   +9.904077685117358e-01   +4.903450047415036e-01   +3.510523471995908e-01   +2.491479383593966e-01];
L3I_L3E_iAMPA_netcon = [+6.961233414946014e-01   +8.034154955425686e-01   -9.020248087533016e-02   +7.037517594928969e-01   +8.723441938239754e-02   +3.206669051539958e-01   +2.538223968538215e-01   +1.264673563509145e-01   +3.107650377290678e-01   +4.997044040840705e-01   +4.045467134484132e-01   +4.211342790167993e-01; +5.127511371985930e-01   +6.794372283525631e-01   +6.640138959879625e-01   +3.921246169196008e-01   +8.313752585907025e-01   +3.875258450104342e-01   +1.220242014013913e-01   +6.085585723231282e-01   +9.323476842135215e-01   +5.588517360901997e-03   +2.660989321043957e-01   +3.178200476912200e-01; +4.385503072180907e-01   +8.418105561322839e-01   +9.091344155993543e-01   +4.043528382275335e-01   +6.767555129803263e-01   +8.306982753978166e-01   +5.390853221633334e-01   +1.094091880453081e-01   +3.216120592005548e-01   +6.314199168928543e-01   +2.757640608923627e-01   +9.446686747231062e-01; +6.113784251703035e-01   +7.451274130252680e-01   +2.482681089262405e-01   +3.615045422403806e-01   +8.381262274879676e-01   +5.773290190431958e-01   -1.191460285289106e-01   +2.849865648292687e-01   +1.820436297778122e-01   +2.402885207850951e-01   +6.165192254077889e-01   +5.315586832943704e-01; +6.517156593303910e-01   +5.119843650525731e-01   +7.489596986275054e-01   +7.545011333516947e-02   +6.851975671509539e-01   +3.087061490284081e-01   +1.699515514370244e-01   +3.500004076623560e-01   +5.820451896953676e-01   +8.009322246009849e-01   +9.647931581276480e-01   +2.845063084307418e-02; +1.683761365878812e-01   +8.496549525055757e-01   +6.863973157758375e-01   +3.130121828708497e-02   +3.418140201363396e-03   +2.744788887327673e-01   +2.838147303270966e-01   -5.672655741584706e-02   +5.365485006923749e-01   +1.235253761686043e-01   +4.505286632655776e-01   +1.472941119733517e-01; -9.178379063945767e-02   +2.650269603708915e-01   +1.597403011899489e-01   +7.089447415211940e-02   +3.839083647007470e-01   -1.641747823993293e-01   +5.431432493528983e-01   +4.049270001518580e-01   -1.250125589772386e-02   -1.091849328505102e-01   +7.071420752210497e-01   +3.106322834326548e-01; +8.686582941649857e-01   +6.094681280197296e-01   +5.016052508711254e-01   +8.063761556220972e-01   -7.580063533974155e-02   +2.940819836061451e-01   +2.521638115406518e-01   +6.815594230488375e-01   +1.664281516178146e-01   -1.048999140176482e-01   +1.911389279767816e-01   +5.330727059871828e-01; +1.711846605016966e-01   +8.977037304348970e-01   +1.886865562564787e-01   +7.040882624179509e-01   +5.335719678883484e-01   +2.576346055011960e-01   -1.776154360711546e-02   +5.881942733504303e-01   +5.210059423930804e-01   +7.931511998736485e-01   +2.511826649998677e-01   +7.096419599568579e-01; +7.341099376643359e-01   +7.930241508661129e-02   +6.075908298099775e-01   -1.205285565738542e-01   +8.098200827191158e-01   +5.661787527732664e-02   +6.634184175453889e-01   +3.411566625604882e-01   +4.943419103595771e-01   +3.636454024379249e-01   +9.229489314125991e-01   +2.206688333165494e-01; +5.685248468813715e-02   +6.063552871794864e-01   +4.848068310342575e-01   +4.435904665138874e-01   +1.000000000000000e+00   +3.798885563379846e-01   +4.452325335898636e-01   +7.708973342746956e-01   +9.039368567166889e-01   +5.087418787995319e-01   +8.134129790796728e-01   +9.334077233740058e-01; +5.952727962469038e-01   +5.288349216280517e-01   +1.768368718472109e-01   +4.110253584553257e-01   +1.420600812511134e-01   +2.456628131459034e-01   +4.850677131468747e-01   +2.248535387737450e-01   +7.910089304618200e-01   +6.443862377534273e-02   +5.284355624175348e-01   +4.259068681517749e-01];
L3E_L3I_iGABA_netcon = [+1.303174701125838e-01   +8.217304997389107e-01   +6.057532186493816e-01   +2.882591195464164e-01   +3.074846737327860e-01   +1.246352641613079e-01   +7.088751263724263e-02   +3.360478818230500e-01   +4.304268880802398e-02   +6.828247980660712e-01   +1.307871238106617e-02   +1.532514899004507e-01; +8.320511175556859e-01   +5.965502355421504e-01   +8.906433259194896e-02   +2.263358747284003e-01   +4.756816270818172e-01   +3.613761241776692e-01   +3.483223658161278e-01   +5.469972473768913e-01   +2.459956008147964e-01   -2.422611717635513e-03   +1.347928330721083e-01   +4.080336635768046e-01; +5.692103372958435e-01   -3.559023427361933e-02   +1.143625318560568e-01   +5.159488308324166e-01   +5.769718743153434e-01   +5.566043329427410e-01   +4.378592915449014e-01   +3.154554071629920e-01   +1.227023226819978e-01   +2.847751879488927e-01   -1.053212268137899e-01   -1.238525496026934e-01; +3.127901105950348e-01   +5.344811454687721e-01   +9.487870108912072e-02   +8.345441391163003e-01   +7.053659342734145e-01   +3.094511231328647e-01   +3.644533153123836e-02   +4.156908971133445e-01   +4.235191645247133e-01   +3.137125612298098e-01   +5.884407232967054e-01   +6.009504546959534e-01; +6.526762849683068e-01   +4.540822914394018e-01   +6.138914357134424e-01   +9.243716500587609e-01   +2.200329711627658e-01   +6.462579090825296e-01   -7.660853932238146e-02   +9.198076429641779e-01   +5.309009026660997e-01   +6.702444227585911e-01   +5.962309253206864e-01   +1.479791320722480e-01; +1.851596613604894e-01   +4.273668825704958e-01   -7.108233081539883e-04   +1.490847175991592e-01   +4.150694624661904e-01   +8.142288908869778e-01   +3.078903890279554e-01   +2.901810597498522e-01   +6.843927968208474e-01   +4.330585482775341e-01   +5.344339125391361e-01   +4.947432106026440e-01; +2.601103347198390e-01   -2.344618340999610e-02   +4.790369399335482e-01   +7.816230410262957e-01   +6.951850735599064e-01   +2.985154109605196e-01   +6.720782783840668e-01   +6.061979059136159e-01   +3.885921298648236e-01   +6.294424880868624e-01   +6.981735102141258e-01   +3.336194283214257e-03; +3.756766652278069e-01   +2.732080343570176e-01   +5.959385148175399e-01   +5.832482212306607e-01   +9.205675179216153e-01   +9.419841990138933e-02   +3.872975995290570e-01   +1.437514590711206e-01   +2.988310731722193e-01   +4.213475012283713e-01   +6.405927647962096e-01   +8.709260074984977e-02; +3.786886850007884e-01   +6.968967482437530e-01   +4.748708755181796e-01   +3.133712748310661e-01   +4.889972190963469e-01   +2.698017382954384e-01   +1.832685741877708e-01   +4.441292562903638e-01   +6.325509242883204e-01   +5.074924296873179e-01   +9.098510369969133e-01   +5.535270093449733e-01; +2.442692641407442e-01   -2.159702415351861e-01   +6.120589530970647e-01   +3.469349472832747e-01   +1.731899494033989e-01   +5.055675384349227e-01   +5.594996203882732e-01   +6.482515268477276e-01   +2.817067761255139e-01   +1.883061224284707e-01   +2.494406053483553e-01   +9.009939744155595e-01; +7.683539299809353e-01   +2.275928054048544e-01   +1.902703610371234e-01   +1.270600427095195e-01   +3.457084506544418e-01   +3.364089555259264e-01   +9.124607019927487e-02   +6.545596324847713e-01   +1.981444883038482e-01   +5.618028330905921e-01   +2.245849583162587e-02   +2.635531037758664e-01; +5.232277553501494e-01   +4.781985987904544e-01   +1.922280839893069e-01   +1.000000000000000e+00   +6.828983480976505e-01   +6.257458339291430e-01   +6.675334322714862e-01   +1.389885895851012e-01   +2.547918506869193e-01   +1.806771815773822e-01   +3.145135228793938e-01   +2.200127906125162e-01];
L2E_Input1_iAMPA_netcon = [+7.425914000620583e-01   +8.375252043307839e-01   +1.000000000000000e+00   +9.490921744735525e-01   +6.709124196619113e-01   +9.508689766124593e-01   +8.736137317841131e-01   +7.091145588628992e-01];
L2I_Input2_iAMPA_netcon = [+9.434817630108068e-01   +8.536653481164292e-01   +9.795081075189058e-01   +8.202081528514287e-01   +6.482021325379637e-01   +8.536645603076979e-01   +1.000000000000000e+00   +7.713405263801328e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
