function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.004517215778272e-01   -1.018217442277978e-01   +2.034594377783204e-01   -3.314270557402008e-02   +9.394145603002377e-03   +1.277304271448813e-01   -1.230077060259480e-01   -1.741993041481237e-01   -3.912980051548834e-01   -1.507012956497467e-01   +2.865740877524326e-01   +1.703198383843415e-01   +1.112412396967444e-01   -1.769347879284260e-01   +5.551784630829343e-02   -2.212448594049652e-01; +2.883495739830761e-01   -2.372169104696633e-01   +2.309117071192516e-01   +1.146083083486335e-01   -2.770168186146435e-01   -6.703439464996953e-02   -2.538882383714778e-01   +1.680480637350642e-01   -4.153734796748676e-01   -5.089231125531857e-02   -1.089773505164466e-01   +1.136157618954648e-01   +2.556654720128465e-02   -5.188168997379886e-02   +3.568499354486433e-02   +4.922477989821220e-01; +1.966932538504613e-01   -4.663638938324209e-01   -1.502117045721328e-01   +1.429767623781643e-01   -2.457411500603761e-01   -8.462877971771209e-02   -6.761428172551712e-02   -1.525175457901091e-01   -3.987040822524489e-01   -1.534931184570295e-01   +3.020948181377693e-01   +1.886731088518861e-01   +4.238770301027943e-01   -2.215053374535429e-01   -1.935364598172065e-01   -1.250540109847322e-02; +8.254906679012582e-02   -7.442054488014804e-02   +1.326359813014125e-02   -2.885711835636000e-01   +3.881993620758448e-01   -4.223310522457451e-01   +3.103104632057616e-01   -1.107959018733013e-01   +1.551976626205564e-01   -6.395378678624927e-04   +3.743552223525624e-01   +1.233122454701266e-01   +2.689536690347927e-01   +6.639144892972035e-02   +3.316898292007062e-01   +1.953136007279512e-01; -2.679203850390379e-02   -1.336344493811121e-01   -4.166249336852055e-01   -2.541078816655553e-01   +1.418432740948805e-01   -2.307042025867809e-01   -2.146100571297470e-01   -9.874868520937263e-02   +1.907367672240952e-01   +3.806515339884438e-01   -2.480832247794299e-02   +2.874586839909163e-02   -1.504916818842794e-01   +2.891197568829689e-01   +1.862109746555011e-01   +7.763685822330901e-02; -1.315804869731544e-01   +1.541602421171999e-01   -2.795660636875946e-01   -1.689831725207591e-01   -1.407478056977836e-01   -2.528239653338604e-02   -3.382169644499759e-01   +1.366321692349270e-02   +1.324541305246470e-01   -4.283714216568966e-01   -1.281592758647272e-01   -2.063612398760126e-01   +7.380560877684013e-02   +3.718399471009484e-02   -3.694143529033386e-01   +3.091677300624085e-01; +9.330574066305604e-02   +1.051681149341491e-01   -2.244509116646559e-02   +1.922722218606233e-01   -2.013979954767968e-01   -4.543652786926469e-01   +3.032561449833369e-01   -1.614324050439836e-01   -3.497379172254158e-01   +5.919247478114290e-02   -1.296485902995298e-01   -2.463894276137326e-01   +2.234326078058442e-01   -6.727402561691112e-02   -1.339599411676480e-01   +1.721100907659756e-03; -5.678955803549611e-02   -1.802137450910324e-01   +1.132067927420711e-01   -1.558527413398448e-01   +1.501028282070148e-01   -2.108157254719323e-01   +5.893691630593011e-01   -1.127425968765155e-01   +3.675495145390362e-01   +5.364681141425517e-02   +2.826688499791420e-01   +2.403956575056819e-01   +7.339119988813966e-02   +1.133077647285298e-01   -2.651387560345134e-01   +2.176548990043778e-01; -2.424103533960768e-01   -1.803689948540880e-01   +3.478680433012147e-01   -2.409906718875382e-01   -2.165665521342237e-01   +1.528534133367619e-01   -2.828686278465051e-01   +8.476746499018986e-02   +8.639789219782625e-02   +5.275384061382102e-02   +4.147392647449101e-02   +1.933494082352311e-01   -1.233923178176148e-01   -1.244699425687108e-02   +2.983255904328004e-02   -4.652412275256508e-02; -1.428479496378842e-01   -1.242606185433202e-01   +3.798410550251608e-02   +1.167101786888548e-01   +2.886716758634702e-01   -2.719738820836283e-01   -8.863499245655972e-02   -5.098755707547358e-01   +2.023541836415428e-01   +9.125626889335137e-02   +1.467988194092643e-02   +4.271923486727780e-03   +1.669255921086886e-02   +2.285095880059314e-01   -1.216962380038061e-01   -1.686955592795463e-01; -2.697619182025311e-01   -5.476979625138992e-02   -1.561312342162479e-01   +2.770783167438750e-01   -4.153696119612002e-01   +2.439670751153644e-01   -2.179759363159063e-01   -2.043642747799559e-01   -4.995550040266326e-02   -2.473348898865118e-01   +8.981131972907616e-02   +7.048738276495090e-02   -4.204729033064970e-01   -3.683359170868455e-01   +1.271018702172448e-01   +8.563658716012618e-02; -1.637329197894497e-01   +4.231080386975668e-02   -1.495945211560910e-01   -5.041439450429608e-02   -4.899299957909119e-02   +3.441394094380400e-01   +4.344392512206984e-01   +1.482478724415401e-01   +2.332103484387003e-02   +4.109666979851135e-01   -2.935807918200546e-01   -3.747406199535765e-01   -1.387833271579202e-01   -8.475786759291171e-02   +3.995122498448481e-02   -1.057409696881021e-02; -7.895809421515783e-02   +7.221429872646991e-02   -2.120458338215018e-01   -6.797196054211335e-03   -3.214941936734897e-03   -2.662944378435867e-02   +2.071086666209489e-01   -1.457151555270738e-01   -3.248554078153353e-01   -4.345282412715021e-01   +1.604302489001068e-01   +1.802010209091958e-01   -1.691089542032595e-01   +1.440752988753343e-01   +2.433191876645205e-01   +9.455738557122045e-02; -7.526223969509692e-02   +4.683872531517284e-02   -2.774375793626195e-01   -1.712511840150941e-01   +7.815086441867941e-02   -6.606424569544754e-02   -1.836166184589631e-01   -3.464379549099821e-01   +9.685815546906396e-02   +9.305618251821743e-02   +4.987483237769036e-02   +1.778145659982574e-01   +5.822380611426925e-03   +1.454256650657229e-01   +3.837099839248093e-02   -1.881528672304291e-01; +3.215117079996086e-01   -1.446611020941891e-01   -9.428153571837017e-02   -1.262400714294544e-01   +3.240304066972739e-01   +4.509433185360323e-01   +1.140692292128314e-01   -2.902600159527817e-02   -3.893299601561219e-01   -7.012628226227369e-02   +1.603882739675624e-01   +3.441532938090768e-01   -2.041639745609002e-01   -1.722319438642955e-01   -3.959243225180475e-01   -4.467441663973133e-01; +2.461881558443973e-02   +1.779739418942937e-01   -2.680666699055156e-01   -3.721782890814647e-01   -5.613718924226029e-02   +2.035284177623619e-01   +3.328236616443778e-02   -8.408075707171310e-02   -3.769835827838811e-03   -3.252330039507495e-01   -3.076836981310291e-01   +2.048048438064429e-01   -1.390120632461295e-01   -3.180508666105908e-01   -3.088115897926109e-02   +1.750629902537953e-01];
L1E_L1I_iGABA_netcon = [+4.609303201345727e-02   +2.085933942941426e-01   +1.526285663485311e-01   -5.492277902768586e-02   -1.396608181023215e-01   -1.072183545062329e-01   -4.416508500431039e-01   -2.944032156349455e-01   -8.163885949332904e-02   -1.353587988686326e-01   -1.813069600517575e-01   -2.473274675205237e-01   -2.490482105258127e-01   -1.290516250100981e-01   +1.281083485818579e-01   -1.378030621029387e-01; -6.444652872395765e-02   -8.866078683159656e-02   -5.652889465577775e-02   -1.024014947984474e-01   -2.141292379506700e-01   +1.241429709035588e-01   +1.296611661286740e-02   +1.379967994171195e-01   -1.435280881101249e-01   -7.011873114825574e-04   +4.832420607620340e-02   +3.525006639398897e-01   +1.625372077406496e-01   -6.664444602870863e-02   -4.155161420584672e-01   -9.790770512275503e-02; -3.988284496972934e-01   +6.427102235878737e-02   -2.791345391936635e-01   +3.749699018391101e-01   -1.089623167988317e-01   -2.608707647959834e-01   -1.754945207497790e-01   +5.560561028241218e-01   +2.960982402416532e-02   +1.924533375924245e-01   +1.193586964113408e-01   -3.189286489777743e-01   -3.627457987363394e-01   -1.134867024769667e-01   -1.408798181479800e-01   -5.580684214863145e-02; -5.252662039994880e-02   -6.682540256584209e-02   -1.531394288132647e-01   -1.729113510332714e-02   +2.206729762348494e-01   -4.891309259176535e-02   -5.034332049999023e-02   -3.640107074023217e-02   -3.159257879302553e-01   +1.640395429654069e-01   -1.639409854913399e-01   +1.065330121660579e-02   -1.492985679356795e-01   +2.398746276877804e-02   -7.961729429999426e-02   -1.542891047643226e-01; -9.116005992840487e-03   +6.751358530363406e-02   -2.150786270652076e-01   +8.166364404393556e-02   +1.474877655444281e-01   +7.169230563559462e-02   +9.318232525465889e-03   +1.935469580352884e-01   +1.792836468540274e-01   +5.848699117724030e-01   -9.123203433823027e-02   -1.984293739611880e-01   +2.893084114559772e-01   +3.567038449914530e-01   +1.260987548202812e-01   +1.966454223722447e-01; +1.988879430179610e-01   +4.465450260264871e-02   +3.976229365536697e-02   +3.560847752723736e-02   -2.892455354999970e-01   +1.266244902741018e-01   -1.735855855213998e-02   +2.476527834936590e-01   +3.617764354952993e-03   -1.293886728150617e-01   -3.307515440048725e-01   -9.667899316666115e-02   -7.400714704676861e-02   -2.856156881594016e-01   +1.958110899136878e-02   +3.238024628768990e-01; +3.431602011229620e-03   +1.297150545823516e-01   -1.898120340327620e-01   +2.616060111907345e-01   +2.017200287722926e-02   -9.368936443142795e-03   -2.010202343717803e-01   +5.446611563714290e-02   -1.130472729922125e-02   +5.828792190999429e-02   -8.943860649657816e-02   +1.573692295606710e-01   -1.714632434947741e-01   +8.810350688072530e-02   +1.386055327290779e-01   +1.136170049455588e-01; +3.714534455544536e-01   +7.831012168048410e-02   +5.983026059153268e-02   +1.331264558640027e-01   -1.064001905780553e-01   -2.848285480626867e-01   -3.451749174979421e-02   -2.490178505948694e-01   -3.078850826482986e-02   +4.309743960084500e-02   +2.123475614408180e-01   +1.495436128457694e-01   +8.480363046575948e-02   +2.070137857880979e-01   +2.632205567435638e-02   -4.657677332620956e-01; -6.265298741132813e-02   -1.129107709763694e-02   -6.471441140712822e-02   -2.784806109061686e-01   +1.278845349019229e-01   -3.717902400856818e-02   +2.543370493888286e-01   -2.547816529696237e-01   -3.142523430643442e-01   -2.416799696162615e-01   -2.054544920921453e-01   +1.048288731386078e-01   -2.259795845048637e-03   +1.390037286077395e-01   -2.892522155210728e-01   +3.753887980058559e-01; +4.923440376450531e-02   -2.036723104884919e-01   +5.423548982449261e-03   +2.602650087483098e-01   +4.263725447065195e-02   +4.610790216384514e-02   +1.865814902824065e-01   +3.348627137253207e-01   -3.776674479812015e-01   -4.098850033158367e-02   -2.055062352390002e-01   +7.029212335746422e-02   -2.214690584870389e-02   +1.082933415546618e-01   -1.942739444654056e-02   +1.092982318727944e-01; -1.728095931418447e-01   -3.133756328301926e-01   -2.650034700222077e-01   -2.363621522805107e-01   -2.671584842335922e-01   -2.846677270959191e-01   +3.022559134506700e-01   +3.950230577385480e-02   +7.402254490623963e-02   -4.223753885088435e-01   +3.877745144012691e-01   -1.345803499868110e-01   +1.317088124209966e-01   -3.056974863426682e-01   -3.524236851861928e-03   +7.640547268584309e-02; +1.976510748156625e-02   +1.829845101209219e-01   +1.075693241679802e-01   +1.827490721902355e-01   -2.121446829709565e-01   +4.057550744064435e-01   +2.875906207936466e-02   -1.365855406749190e-01   +3.461152607689805e-01   +1.698557683137359e-01   -4.871071839261493e-02   +9.838090527488037e-02   -1.234084499066308e-01   +1.215484912896798e-01   -3.490520828671437e-01   -9.423895213901104e-02; -2.747398678243660e-01   -9.749879704078736e-02   +8.771496174261725e-02   -8.517782119614802e-02   +2.918778982424596e-01   +2.337388152807943e-01   +2.354826258498421e-03   +1.071137067112184e-01   -4.031225787746144e-01   -3.963051769117095e-01   -2.011556005198316e-01   +1.537284022731493e-01   +2.468464865466483e-02   -2.855934775376144e-02   +3.177566056643171e-01   +9.918772801123779e-02; +1.887951155298562e-01   +1.364931676225394e-01   +3.547142295016940e-01   +7.926614510551400e-02   -8.364411880764648e-02   -1.472296246033097e-01   -2.368935496929628e-01   -1.218573722751206e-01   +1.972782393825716e-01   -5.672893780849880e-02   -2.446261395449771e-01   +1.200690107680316e-01   -1.948894761703358e-01   +1.449510509254731e-01   +3.142235362171508e-01   +2.163043883073788e-01; +1.560681827644670e-01   -1.200425335424876e-01   +4.292372370756610e-01   -1.403425610756510e-01   -1.192073798314409e-01   +1.238842206948077e-01   +4.064818097436919e-02   -3.177112694474911e-03   +1.227154811658925e-01   +8.619115156930762e-02   -2.127608974891677e-01   +4.786910031359387e-02   +3.375041608434239e-01   -1.843765591821111e-01   -3.233194686867842e-01   +2.157049964074871e-01; +3.023747264036482e-01   +4.201336632973804e-02   +2.264150321500808e-01   -1.832809805816638e-01   -1.924965793343822e-01   -1.898093299470092e-01   +3.927885760371658e-01   +2.052370255553473e-01   +1.205526572614764e-01   -3.865272316434512e-01   +2.903051419425199e-01   +4.661263135231432e-02   +2.190955956460728e-01   +6.066752655205664e-03   +1.337189234686845e-01   -1.412896608895582e-01];
L2I_L1I_iGABA_netcon = [+3.654519679966300e-02   -3.397859801294117e-03   -2.094001201327672e-01   +2.671897130707370e-01   -2.693705257778651e-01   -2.625672669966485e-01   +2.483446018798570e-01   +5.966362305049019e-02; +1.814749216278005e-02   -1.483341210724285e-01   +1.081008216259861e-01   -2.630946374168721e-01   -1.601649402027520e-01   +2.301957787499958e-01   +1.077117575803872e-02   -1.933423571173948e-01; +2.759868493136032e-02   -2.950232754738896e-01   -1.435489162386445e-01   +5.937082503291626e-02   -8.742735340610916e-02   +4.565893930985138e-02   -3.269856595189713e-01   +1.658137156188860e-02; -2.650316825510314e-01   +2.555102864978062e-01   -4.036870800442297e-01   +4.051268448643746e-01   +1.361388901707599e-01   -7.520618512882800e-02   +1.992767977411277e-01   -1.746468711761360e-01; +1.898919167473888e-02   +1.059571170049848e-01   -6.518574566694448e-02   +1.673063890961218e-01   -1.148879780064524e-02   +4.544477602045211e-02   -2.584295044664129e-01   +1.939427453031240e-01; +3.567227281632585e-01   -2.059869377342893e-01   +4.073644762875144e-01   +1.209067181378316e-01   +2.136733612743174e-01   -1.778450298836273e-03   -1.229139738602900e-01   -5.543280091537539e-03; +3.010097307757039e-01   +1.086116434472160e-01   -3.254600818916520e-02   -2.145085235227434e-01   +3.415297626992675e-01   -4.830688941783090e-02   +3.531377633233896e-01   -3.144623558340874e-01; +2.330830757768150e-01   -1.254118432359181e-02   -7.732397627683939e-02   -2.813763996233833e-01   +3.783470669091399e-01   -1.302065225034128e-01   -4.229598606704594e-01   -2.851157568708171e-03; +9.621696622247064e-02   -3.928492495807122e-01   +8.890750939557093e-02   +1.374618219273022e-01   -3.124325474132022e-01   -1.001329728251961e-01   +2.064823360615480e-01   -5.326660809434323e-02; +1.073126563303430e-01   +3.994317108005122e-01   +1.645576556470610e-01   -3.655440230866263e-01   -1.311599337725256e-01   +1.455539430634841e-01   -1.032956527914051e-01   -1.256173760173727e-01; -1.994951950085339e-01   -1.968619087260136e-01   +1.504807610916232e-01   +4.559068763192796e-01   -2.458198420037758e-01   -2.253742298899976e-01   +1.179981558790313e-01   -2.038128452901744e-03; +2.033802406214169e-01   -1.361123163515207e-01   -2.172197324293371e-01   -1.298363747920674e-01   +3.652452125527724e-01   +2.960054824079760e-01   -3.002325694119268e-01   +5.512381752295845e-02; -3.031921748510942e-01   -6.926194840671054e-02   -1.565540915668939e-01   -1.688031865635241e-01   +1.082031723035548e-02   +2.009801868709645e-01   -2.978137298552572e-01   -1.469361833799979e-01; +2.783260809355212e-01   -7.229758477621442e-02   +1.458804879546141e-01   +1.446241305604448e-01   -1.524614592919317e-01   +4.514496759459320e-01   +5.383927237590895e-03   +2.197317693442574e-01; +2.063746502835588e-01   +1.090109873039333e-01   -9.714552931496571e-02   +2.541462335021536e-01   +3.454016546615968e-02   -2.243382309929425e-03   -1.209061969757446e-01   -2.379469429220964e-01; +1.956106248733699e-01   -1.470039542316672e-01   -3.158319212356668e-02   -3.923388930992980e-01   +1.386328138393643e-01   -2.773070777245358e-01   -1.579538132571968e-01   -1.481659876744073e-01];
L1I_L2I_iGABA_netcon = [-1.508704693416534e-01   -5.814861935836893e-02   -6.048904091604274e-02   +1.824901166523118e-01   -2.649432975978419e-01   -1.448581771525147e-01   +1.858124679275537e-01   +5.786903119314002e-02   +3.659246213661176e-01   +1.437800729139208e-01   +1.990836968634268e-01   +2.400660186358448e-01   -2.063222465396111e-01   +1.451296237655219e-01   +6.785740746129058e-02   -3.041401509120717e-01; -3.022429725666183e-01   -3.296644303030038e-01   -1.015387724904716e-01   -3.054924016163902e-01   -2.501210639776115e-01   -2.973240189297349e-01   +1.741404063801850e-01   +4.832579811193594e-02   -4.345156767168179e-02   +2.844407215060360e-02   -2.186830151022540e-01   +2.037107269396733e-01   -1.419229802871876e-01   -5.344863315358381e-01   +1.066473620413676e-01   +6.746647654606203e-02; +3.086044704201485e-01   -3.167405834532636e-01   -1.706477243792918e-01   +1.330634581487439e-03   +4.133651252233175e-02   +3.609619000545088e-01   -1.110555397446052e-01   -2.143532041444466e-01   +2.039217827547750e-01   +1.422693802671366e-01   +1.385720580447364e-01   -1.831521672545878e-01   -1.537611578331401e-01   +3.490687897262473e-01   -2.971958672325041e-01   +5.621101315936700e-02; -3.914017499470358e-01   +2.419544547664346e-02   +2.210378460990726e-01   -8.815230732298669e-02   +1.286755186373878e-01   -1.751915037493244e-01   -1.503373229666498e-01   -4.355232181361284e-01   +4.589929962481087e-03   +1.007879227201529e-01   -8.528921072926046e-02   +2.734181876094108e-01   -1.330525550244756e-01   +1.243340405662157e-01   +1.366069714804462e-01   -4.518793820407901e-01; -4.299084515666377e-02   -1.461778708757103e-01   +4.834786204818477e-01   -4.413255889260919e-01   -8.548975792749453e-02   +1.196944639775760e-01   -2.099558711296172e-01   +2.438169205686863e-01   -1.332244196351004e-01   -1.741888138567599e-03   -6.650781475808433e-02   +2.805424798994633e-01   +1.654445141599112e-01   -5.085260041869588e-02   +1.792418517828767e-01   -2.625205654070485e-01; -1.152393711402673e-01   +2.469244374927005e-01   -1.647489573624763e-01   -5.718215636805651e-02   -2.120959367539040e-01   -2.327547913738199e-01   +1.304472592731237e-01   +1.517006837918557e-01   -3.293101650782015e-01   -1.247480374150552e-03   +1.933853370522046e-02   -9.362756937349621e-02   +1.672357872190360e-01   +1.530836469785614e-01   -2.171907764792939e-02   -1.031627257686331e-02; -6.111905918760087e-02   +1.877629642550991e-01   +1.111552038710920e-02   +4.205189561899440e-01   -1.490154377919869e-02   -6.909271974591980e-02   +2.638340515315656e-01   +3.266957000646420e-02   -2.304770119039265e-02   -3.527363976221464e-01   -6.919637466995655e-02   +1.234108772514797e-01   +1.728950997715449e-01   +3.969825952682702e-01   +9.433796337289033e-02   +1.487845920742696e-01; -9.189615812681820e-02   -1.774753690849792e-01   +1.828979100089460e-01   +3.696164823421033e-01   +7.770486612921117e-02   +3.482635262822867e-01   +3.877003509986337e-01   -1.120288576572550e-01   -5.135054604464416e-03   +2.127173579895758e-01   +1.803080765893285e-01   +4.860790175348752e-02   -9.015772143263254e-02   -1.256771377955586e-01   +9.821617512991379e-02   -1.980139547838579e-02];
L2E_L1E_iAMPA_netcon = [+2.756639258071035e-01   -3.407128715884510e-01   -5.780664456852319e-02   +2.574063335178996e-01   +1.956551584545342e-01   +2.228268022693783e-02   +2.285927327787805e-01   -3.170023979208184e-02; -2.834205707880231e-01   +7.743408046672037e-02   +1.554492324991006e-01   -4.851820643085113e-02   +1.260878345219085e-01   +1.266314661880247e-01   +9.983279515717239e-02   -3.153176845053913e-01; -7.386451682522771e-02   -2.287600086946140e-01   +1.811640421092491e-01   -3.924633001246516e-02   +1.018158055716195e-01   +8.351540191940300e-02   +1.958027422564628e-01   +1.370294883153244e-01; -7.744137046626920e-02   -3.935598703428254e-02   -1.122952079763137e-02   +1.030690680935565e-01   -3.440265775578100e-02   +5.444545792938459e-02   -8.283887175424089e-02   -9.743399186442928e-02; +6.379054116104775e-02   +2.812851780916897e-01   -3.158183722202316e-01   +1.782621186644929e-01   +1.674586824964586e-01   -1.218762763189613e-01   +8.738693637638772e-02   +1.331808975964950e-01; -2.089660090881397e-02   -4.177789128732376e-02   -1.544829640893635e-01   -4.232047895741866e-01   -2.140368976735956e-01   -1.378065188901251e-02   -1.588463897488719e-01   -3.112068864291509e-03; +1.080112616959652e-01   +9.244208778531759e-02   -2.044462094540194e-01   +2.104816772107356e-02   -1.149064057832592e-01   +3.353267782534920e-02   -3.043451702221003e-01   +8.399613209516529e-02; +3.288215879214485e-02   +4.694471026958883e-01   +8.985074086091294e-02   +8.870831874077256e-02   +9.356838402445583e-03   -2.116032193410229e-01   +5.389127350006598e-01   -8.042242162723527e-02; -6.608589939779172e-02   -5.093211468498914e-02   +1.641083215431692e-01   -3.404249542077905e-01   +3.924250308041037e-01   +3.701422098534172e-01   -1.456433745071631e-01   -2.714829201379156e-01; -3.591187325840915e-01   -6.394719895005978e-02   +3.364585726631610e-02   -7.372969223778025e-02   +2.737023529941970e-01   +3.271156138407729e-01   +3.997484359661848e-01   +6.340856547367417e-02; +1.798486755594582e-01   +2.233226948475001e-01   -3.479036854101294e-01   +5.275250885328782e-01   +2.250021150199530e-01   +3.936109810572475e-01   +7.374442995831758e-02   +3.072244140513065e-01; +1.121204239073894e-01   -1.976942794171294e-03   +2.003439949130116e-01   -2.686593016639602e-01   +2.562684113830017e-02   -2.458937616569198e-01   +7.373565044098998e-02   -1.779717110977158e-01; +2.092271382522847e-01   -8.072358728643836e-02   +1.436521401881484e-01   -1.789607870000141e-01   -1.670729036233201e-02   -3.013728864572033e-02   -1.508438165506884e-01   +2.712636137255237e-01; -4.629054049825186e-02   -4.181315641219760e-02   +7.020920811948132e-02   -1.251273546548704e-01   +1.820522999944001e-02   +1.361450415759273e-01   -3.515531372295030e-02   +1.201450930845795e-01; +4.496288701988843e-03   -3.415967548128563e-01   -4.177577009562645e-01   -3.025041614977207e-01   +2.952799251818906e-01   -2.954746495181246e-01   -2.894689174019528e-02   -8.001443932920524e-02; -2.120449191875422e-01   -1.066092133114685e-01   -2.899803270138913e-02   +1.913842839886546e-01   +8.027113508034148e-02   +3.736609085730503e-01   +3.262736613010275e-01   -7.760659993396105e-03];
L1E_L2E_iAMPA_netcon = [-1.078491103763658e-02   -2.575085854480167e-01   -1.269808691101726e-01   +2.384728276536420e-01   +4.995094790056055e-01   -3.586503682825493e-01   -2.171000142495811e-01   -1.542024891493091e-01   +9.040245902640971e-02   +1.092020808855408e-01   +3.198157792984719e-01   -1.006750084909648e-02   +7.885933121847828e-02   +3.396373976365110e-01   -1.144598157335941e-01   -9.755712907623085e-02; -3.788510694484779e-01   -5.785388429808319e-02   -2.176540347284474e-01   -6.166795199092263e-02   +1.850532646863101e-01   +1.705386903468349e-01   -2.457505631197697e-01   +1.460183009847641e-01   +2.988939452544518e-01   -2.217939159569344e-01   -2.257854583730744e-01   -2.966966075917305e-02   +3.287410886722287e-01   +7.969366915709226e-02   -1.478835866849486e-02   -1.612760989575922e-01; +2.708489564306377e-01   +6.069945920209908e-02   +2.858829685656654e-01   +1.197546758995163e-01   -3.834271454614216e-01   +5.289698737896584e-02   -2.373836311928073e-01   +1.066842569186807e-01   -1.483433533424852e-02   +1.587215223639670e-01   +1.477080733353464e-01   +9.710392287603307e-02   -8.223435181420746e-02   +6.987781395479181e-02   -3.001442344423159e-01   -4.582840644594482e-02; +1.266159501584755e-01   +3.497268025177060e-01   +6.295696908965034e-02   -1.564283253698714e-01   -4.282449351721424e-03   +1.791514289235254e-01   +1.241527699748321e-01   -2.786215443923452e-01   +3.547504630897419e-01   +1.073748474623596e-01   +2.772594335053937e-01   -1.592734420511819e-01   +1.712797098006229e-01   -1.613080609511045e-01   +1.788975123021960e-01   +1.483902306810433e-01; +2.726053274324879e-01   +6.684754402788906e-02   -3.473935123605663e-01   -2.490780497638553e-01   -3.106173707223081e-01   +1.256128546631496e-01   +1.936429780547989e-02   -1.715669774628402e-01   -1.350737272928359e-01   -1.651242348065196e-01   +2.806953914226514e-01   +3.898274074171437e-01   -2.564568681433041e-02   +1.808483682320747e-01   +2.425325889200394e-01   +1.467887956623194e-01; +1.948559741028157e-01   -3.065901686153106e-01   -5.489650666123097e-02   -1.312784336502365e-03   -1.849146896759397e-01   -2.489308876488232e-01   +3.714715323569255e-01   -2.484255047285023e-01   -2.642868602088975e-01   -2.552434784515987e-01   -6.291126130708269e-02   +1.407063769234222e-01   -1.943676569838147e-01   -2.400791410450653e-01   +6.513946148191618e-03   +1.487503280634364e-01; -1.851089667402651e-01   -1.060490646158691e-01   +1.950292490580494e-01   -1.267367699424980e-01   +2.127889108226154e-01   -5.931322292832078e-02   +1.867366969717611e-02   -1.573488011548811e-01   +3.865150943754366e-01   -2.115220368818318e-01   -1.490023845686289e-01   -4.542911361294957e-02   +2.468966918269802e-02   +4.242094581697068e-01   -1.946774447053136e-01   +1.885857202188874e-01; +1.190657706493243e-01   -2.657801449290235e-01   +2.773062022609377e-01   -6.382794613984205e-02   +1.189162958707238e-02   -1.389053732926741e-01   -2.688475509171125e-02   -1.632253420594864e-01   -2.528922523442177e-02   +1.285776276786150e-01   +3.223896125791564e-02   -2.168281760277216e-02   +5.841647759371401e-02   +4.063631045002195e-03   -3.783305277526808e-02   +3.316685372462775e-01];
L2I_L2E_iAMPA_netcon = [+3.728537410380494e-01   -1.825848662047629e-01   +1.486133033934571e-01   +5.134609982787797e-02   +1.130334947329131e-01   -9.755158112353748e-02   +2.940723732087118e-01   +1.777590941007192e-01; +3.571934038126973e-03   +1.413269869622439e-01   -4.285151607802721e-01   +3.164853383453135e-02   -1.131177363815634e-02   +1.228777323287743e-01   -3.151810633469866e-01   -4.155001660701744e-01; -3.436252029046374e-01   +5.519077934213784e-02   +1.112432635900965e-01   +1.237182742671731e-01   -2.914902611799890e-01   +2.186133754635122e-01   +7.775526252277275e-02   -2.525121894687530e-01; +2.228172473361530e-01   -3.286551522618785e-01   -6.398050277844058e-02   -7.228983926666205e-02   -1.700277673332658e-01   +3.147887403656069e-02   +3.965190994524181e-02   -9.870123052343630e-02; -2.055730595717275e-01   -9.849182459725428e-02   -4.716608855235744e-02   -7.239899197479813e-02   +7.598837248720597e-02   +6.823835105024437e-02   +2.378993679621504e-01   +1.206855887535054e-01; -4.804425165224485e-02   +2.556532555221161e-01   -8.967806222562274e-03   +8.878863159648087e-02   +3.114968381974513e-01   -2.277489112051348e-01   -1.170995957863062e-01   +4.249595592969260e-02; -1.690825042028803e-01   -1.445522315954016e-01   +3.003501643874065e-01   +1.999563136353328e-01   -3.348306031883703e-02   +1.633978059576761e-01   -6.958890609870044e-02   -2.316363468229930e-01; -1.319118839153667e-01   +5.545109941680124e-02   -7.629043213161540e-02   -9.004119497873676e-02   +3.183544321726181e-01   -2.185114853401089e-01   -2.646250254532968e-01   +2.921495700477969e-01];
L2E_L2I_iGABA_netcon = [-1.062926207238515e-01   -2.088400375314887e-02   -1.577538593315397e-02   -3.821639570930667e-01   +1.475461454078829e-01   +1.142251559913840e-01   -7.846593077077260e-02   -2.358466852118044e-01; -8.090313654969516e-02   -3.979812123022631e-01   -7.718030893546356e-02   -6.124559367132673e-03   +3.249586722415063e-02   -4.615335788276323e-01   +1.210833755018349e-01   +4.373534647790598e-01; -3.009980479359764e-01   +1.410870888295523e-01   +1.822077069567231e-01   +5.537924646217397e-02   +7.588311328701999e-02   -2.741224893402815e-01   +5.249925708365660e-02   -1.292960307855228e-01; +2.517664904657395e-01   +3.473178998919865e-01   +2.434153423579762e-01   -1.416138813118322e-01   +1.767285549593617e-01   -3.841504681541534e-01   +1.914864631568335e-01   +7.027688385487357e-02; -1.304592986238264e-01   -4.336901669049356e-01   -1.323178863773466e-01   +7.727790545210048e-02   +5.634016184537158e-01   +2.394026640411020e-01   +2.545733332887640e-01   +7.980477411863585e-02; -2.863085578372080e-01   +1.723881173326333e-02   -1.201110314031443e-01   -1.765611560057508e-02   -2.877077878335274e-01   -2.051496718604433e-01   -2.395674754635535e-04   +9.308299843815787e-02; +1.757228819750435e-01   -1.431344189871536e-01   -3.589152766357797e-01   +7.310606023242421e-02   +6.510180969101620e-02   -5.392230554268836e-02   +5.459766959749084e-02   -1.304642283278263e-02; -1.127673165700410e-01   +4.181032091446997e-01   +1.173275333171910e-01   +9.267977618941349e-02   -9.094340939357573e-02   -3.939974427870809e-01   -3.081124631604581e-01   -2.670771317016609e-01];
L3E_L2E_iAMPA_netcon = [-2.753167671330795e-02   -2.608881491389264e-01   +1.024455243039105e-02   -4.246867237857542e-01   +1.326809353267413e-03   +2.572511548243900e-01   -1.820060013330291e-01   -2.952863298063273e-01   -2.831251237233758e-01   -4.829798590897370e-02   +1.236509104129542e-01   +1.541299615401208e-01; -2.575901952287617e-02   +3.724179191279873e-01   -2.569140624023426e-02   -1.716336300992900e-01   -3.662027568975114e-01   +1.340878707468569e-01   -1.401000731782038e-01   -2.923688058356963e-01   +7.861873068667868e-02   -1.848676532608961e-01   +3.578598329903319e-02   +2.825813076622828e-02; +2.019737190712720e-01   +3.614295592016805e-02   -3.364163532020376e-02   -1.647127526266871e-01   +8.343251263224706e-02   -1.836501416287717e-04   +2.350942431272145e-01   +1.096425557329579e-01   -1.548885471237569e-01   -6.902525199469536e-02   -3.445147743727082e-01   -2.308749657904300e-01; +6.201244897905814e-02   +2.726251894292521e-04   +1.628441454003591e-01   +4.228908888342681e-02   +1.968135544881976e-02   +5.356796397664673e-01   -1.539447110252920e-01   +3.700215855995098e-01   -7.013549029205843e-02   -2.431728463263693e-01   +3.856678969489679e-01   +1.526768488366015e-01; +6.022419460677977e-02   +3.754975304407812e-01   +2.348883095518774e-01   +8.203778231539768e-02   +1.828767769648075e-01   -8.268227000972279e-02   -4.628406906034103e-01   -2.177102074389927e-01   -4.648511109316653e-02   -2.971238717949293e-02   -1.848767948042719e-01   -3.081533734868216e-02; -2.445291207849785e-01   +1.952730571845004e-01   +2.688511636444153e-02   +3.056577938993337e-01   +2.345736490444231e-02   +1.909018914502990e-01   +1.038230213151221e-01   -8.590059297581243e-02   -3.405750652348902e-01   -9.692950803706925e-02   +2.328814676464314e-02   -1.464164001768336e-01; +1.175826199642892e-01   +1.437203411430761e-01   +3.522087372373370e-01   +1.715916617257749e-01   -1.383311207606830e-01   -3.241355312028309e-03   -2.125250942190581e-01   -3.670667880265640e-01   +4.073021168831139e-01   -9.305488507510783e-02   +2.104278962683345e-01   +3.247867452029096e-02; -2.463498467483438e-01   -3.338205839958042e-01   +1.182225049031987e-01   -9.250654190271770e-02   +6.017083209021619e-02   +1.373831298925715e-01   +2.752475923910697e-02   +8.252039440684886e-02   +2.564978288744411e-01   -1.098400708220307e-01   +4.122260811602602e-01   -3.763441430955337e-01];
L3I_L2I_iGABA_netcon = [+4.142644436980594e-01   +2.847075143415242e-01   -2.779057288647193e-01   +1.891789226332969e-01   -2.868849621086050e-01   -4.367005767691712e-01   +7.390456552297703e-02   -1.170475619668310e-01   +8.935840419960772e-02   +1.398258360632653e-01   +3.338947966949134e-01   +3.362251660541521e-01; +3.694761651698479e-01   -2.319993264792040e-01   -8.341504046706119e-02   +3.953737243822906e-01   +2.046739677095533e-01   +8.127413271249556e-02   +2.036618242529987e-01   -1.441220763447209e-01   +1.047589392453096e-01   -6.267917809973794e-04   -3.579670289638454e-02   +8.779099758662821e-02; -1.908325706593533e-01   -6.251813359043987e-02   -1.232101730279382e-01   -1.222756725074180e-01   -3.456215553896058e-02   -7.236461315702601e-02   +4.260715304746217e-02   -2.055002233436087e-01   -1.665796910351630e-01   -3.143432008440699e-01   +1.395741145476612e-01   +2.380391414132257e-01; +1.300894595285947e-01   +2.677063785482809e-02   -1.625422615084071e-01   -3.460465048615034e-02   +2.121892206274433e-02   +1.585107155697245e-01   +3.410816898520721e-01   +1.179203819289863e-01   +3.260445049273520e-01   -3.978786240943002e-02   -1.174552363431088e-01   +1.708331996407107e-01; +2.297581443324981e-01   -3.719774198066061e-02   +1.536158213147227e-02   +2.492012077464523e-01   +8.005849804069672e-02   +9.610359320790801e-02   -3.637084167959969e-01   +5.445617822933554e-03   -4.414243164886379e-01   +2.184155846138548e-01   +3.160691867774838e-01   +4.167675081459106e-01; -2.370826066555518e-01   +3.280264006991856e-01   -4.180381901252772e-02   +6.356123646114291e-01   -3.629138181216814e-01   +7.539069952979274e-03   -3.121613552608743e-01   -1.433483166493211e-01   -2.360185555188627e-01   +2.309042456807881e-02   -7.828276138029633e-02   +4.039430006609639e-01; +3.702081985672299e-01   -4.115542537752553e-02   -1.174285305944755e-02   -1.265172159955111e-01   -8.569192662827038e-02   +2.301054863750472e-01   -5.781779405557735e-02   -1.099232538160509e-01   -1.685842231760951e-02   -1.874979659256223e-01   +1.063078327868557e-03   -9.177009952246350e-02; -2.032288639552116e-02   -6.926297336005670e-02   -1.173747265887733e-01   +6.001320609389632e-02   +4.417120016419165e-01   +2.429428016397145e-01   -1.050714315472811e-01   +9.373567352742496e-02   -1.056282372202283e-01   -1.726649662235885e-01   +2.817165697052144e-01   -1.147881799165125e-01];
L2E_L3E_iAMPA_netcon = [-1.606764984265024e-01   +2.106423803046040e-01   +2.065778915299423e-01   +4.532507282454159e-01   -1.092674712230769e-01   +2.580895446440125e-01   +2.926063454669902e-01   -3.655713944369104e-01; +1.548211717754671e-01   -7.054123429587597e-03   -2.661010458306107e-01   +6.123257481299657e-02   -1.599718124719100e-01   +2.292007372669174e-01   -1.881658927070354e-01   +9.694207477206032e-02; +7.748173643694234e-03   +2.404792738396322e-01   -1.610322349840790e-01   +3.534154598985059e-01   +8.712581292620999e-02   -9.772953054428055e-02   -2.059051294251085e-01   +2.674718582536492e-01; +2.049791616448601e-02   +1.150604460620364e-01   -1.798304463725144e-01   -4.101377458197838e-02   +3.433548566860727e-02   +1.623999432297151e-01   +2.487819894168061e-02   +1.200979041567808e-01; +1.347415347352729e-01   -7.226751546950122e-02   +7.413263073954229e-02   +9.780409805607841e-02   -4.764631968229687e-02   +2.572310639114742e-01   +2.171192932407405e-01   +4.447584193442899e-02; -5.232928316854846e-03   -1.103293931590314e-01   +6.333852435004869e-02   -1.974422033458210e-01   +1.519064772382452e-01   -9.535917439274585e-02   -3.467776516777389e-01   +1.497013726723933e-01; +8.307549015788752e-02   -1.265738191170724e-01   +6.379961367312748e-02   +1.293728346290169e-01   -1.284407311207236e-01   +9.205140805877965e-02   -3.090933768263743e-01   -1.328014803742672e-03; -7.899481082163404e-02   +1.326625532836210e-01   -1.937257866642820e-01   +1.285837577947084e-02   -1.675067511463189e-01   -2.572873706748574e-02   -1.982293261672359e-01   -4.026016958291090e-02; +1.683053549834031e-02   +4.469954126479824e-02   -2.188189043717388e-01   +4.155581487701177e-01   +9.557482746057430e-03   +2.773876350727076e-01   -7.650146017261272e-02   -1.296675691073289e-01; -4.010098764424277e-01   +5.997618696735557e-02   -1.347321747036771e-01   -1.529022411458187e-01   -5.230000451830974e-02   -1.171200341722104e-01   +1.110777277793275e-02   -3.337389407698729e-02; +1.783188982844178e-02   -7.070106489264752e-02   +2.218725414081888e-01   +2.212025430719515e-01   -4.281362605365203e-04   +5.480095172291522e-03   +4.946560534340595e-02   +1.412376600358726e-01; +3.963791471569893e-02   +7.393999158683730e-02   -1.231001004286335e-01   +1.850074154403304e-01   -5.022007177944732e-02   -1.770799456860538e-01   +2.254875694096852e-01   -1.284015636101461e-01];
L2I_L3I_iGABA_netcon = [-7.452504876791645e-02   +1.257902564700040e-01   +4.665872418854697e-02   +1.129553304836190e-01   -1.702669067888579e-01   -2.184625671620938e-01   +4.162835379912003e-02   -3.150141048929553e-02; +6.900090514019128e-02   +3.290324722224237e-02   -4.448876975602135e-01   +4.742016016868716e-03   -1.179298483094559e-01   +3.107861521285096e-02   +1.639800562688887e-01   -2.793194616997152e-01; -1.534054740646021e-01   -5.570204342095993e-01   +1.230904653507195e-01   -1.605753047106964e-01   +5.490750558573619e-01   -2.630982165507942e-01   -4.076127935804446e-01   +2.429137551419058e-02; +7.282887504188901e-02   -5.458111019527007e-03   +3.404966368948432e-02   -5.055150390895782e-02   -3.028193293925960e-01   -3.180452406874955e-02   +3.329604429670577e-01   -1.074530183108677e-02; -4.283873953895374e-01   -1.867462234545706e-01   -6.773744897947567e-02   -1.621952069627136e-01   -2.301647135756183e-01   -6.769324476794308e-02   +4.563768838052897e-02   +7.771204129474757e-02; +2.393430555494532e-01   +3.287967356869803e-01   -9.320559910952737e-02   +3.408441898350288e-01   -2.680070482369350e-01   +1.646329339527994e-01   -3.461016445913972e-01   +2.219320426204005e-01; -1.864877403318554e-02   -1.973842017781098e-01   -5.472087456680162e-02   +8.271296813720683e-02   +3.815934115607909e-01   -2.060675431312280e-01   -3.735344454675900e-01   +2.313231359898843e-01; -1.573146111351649e-02   +3.038891321298696e-01   +1.394059613625463e-01   +2.250437162794494e-01   +7.050248779440021e-03   +1.544268895121698e-01   -1.082626937346488e-01   -1.087607952839217e-01; -8.988864643795702e-02   -2.362042420139955e-01   -2.791611516664252e-01   +7.612336979850291e-02   +3.970778050209496e-01   -2.843270619844988e-02   +2.296392160283083e-01   -1.196507554706733e-02; +3.669435305493647e-02   -2.829231976705023e-01   +5.158179131278878e-02   -1.789913580929308e-01   -5.868556550473873e-02   +5.878827833094197e-02   +9.102909934428367e-02   +3.240952770358855e-01; -9.711503938605290e-02   +1.279835114216912e-01   -1.865892794381997e-01   +1.080971664393511e-01   -4.684758782451117e-01   -1.535312825918564e-01   -4.602878410824848e-01   +8.207217963411595e-02; -7.829877874525334e-02   -3.106076727343736e-01   -7.023217825783240e-02   -2.173910768876147e-01   +3.025688381634890e-01   -1.732198017394349e-01   -1.086235654286758e-01   +7.376313216177099e-03];
L3I_L3E_iAMPA_netcon = [-3.383297730572843e-02   -1.375437237880584e-01   +3.481178835650025e-01   +2.091445416245046e-01   -5.678134472197706e-02   +2.221433384144453e-01   -2.400889899207634e-01   -7.297388918983311e-02   -1.011182245690176e-01   +1.679991203194412e-01   -2.850768019991751e-01   -2.964568779437174e-01; -3.891666990318920e-02   -4.424486321392546e-02   +3.658469543946360e-01   -1.038569399327420e-02   -9.467040303995727e-02   -3.038456255933294e-01   +4.471461075010741e-01   +3.534264460809948e-03   +3.437208526528575e-01   -6.620188546384020e-03   -1.155539593643348e-01   -2.830393670162022e-01; +6.838499824271621e-02   -3.430781105892954e-01   -1.558763636429606e-01   +2.104998042222798e-01   +9.310601175722318e-02   -6.486309785047954e-02   +1.350045796814936e-01   -3.329979405928881e-01   +3.085406111145883e-03   +8.520303040363095e-02   +1.309798741806966e-01   +4.370575078386877e-01; +1.245948582049322e-01   -1.879472730216566e-01   +3.426762209254050e-01   +1.526985915955513e-01   -2.205854017851420e-01   -2.620994098527699e-01   +1.763433905495674e-01   +9.355793642657045e-02   +9.429343831858418e-02   +5.358316299691152e-02   -1.298787493268270e-01   -1.382961448141874e-01; -2.120211413174878e-01   +1.624286743407440e-02   -2.143590615777112e-01   -3.335895345668857e-01   +2.953400687738311e-01   +1.793115939069151e-02   -1.258244042998737e-01   -1.093715024389435e-01   +2.899850784187256e-01   +1.043092802984221e-01   -2.242335312227954e-01   +1.249746979919272e-01; +1.485524016563757e-01   +1.228288212396230e-01   -1.849942866321919e-01   -8.588616838450905e-02   -7.915444207194303e-02   -1.021668357414466e-01   -5.998794810920097e-02   +3.318741758575259e-01   -1.049718383657789e-01   -1.117611257685879e-01   +1.093983416973998e-01   +2.588074150114930e-02; +8.498690547405288e-02   -1.567829918106810e-01   +7.152107733369670e-02   -1.273202041076247e-01   +5.527659175527790e-01   +2.035559585878172e-01   +1.587349227587327e-01   -5.438033022096375e-03   -1.753543331930373e-01   -2.967198535276270e-01   -2.151069085401530e-01   -6.130522288122628e-03; -4.520627762504172e-01   +1.947535296815354e-01   +1.849232568164243e-01   +3.942539841673777e-01   +1.939254642493426e-01   -2.040097707597263e-03   +1.437022084383371e-01   -1.509370911670851e-02   +8.055175169157740e-02   +2.204274254234618e-01   +1.938444877972574e-01   +1.578392085280914e-01; -8.507582273911038e-02   +2.754818468897767e-01   -4.872271821571848e-02   +1.578928715110719e-01   +2.525938459823456e-01   +3.360817875157361e-01   +1.048034224277777e-01   +1.709925200708705e-01   -1.388638390154031e-01   +1.286640076054422e-01   +1.911006071489209e-01   -1.834514613798290e-01; +1.957215194041119e-01   +3.503441625126481e-01   +1.701737419585513e-01   -3.769945440897148e-01   -2.093624127873138e-01   +5.485108993668388e-02   +4.786024497536636e-02   -2.211356297404909e-01   +2.487115632343581e-01   -3.409262915663436e-01   +6.745985757801104e-02   -3.183453331106042e-01; -2.955122334666593e-02   -4.311820379366702e-02   -1.830721491919158e-02   +3.576344704069257e-02   +1.987358562873449e-01   +2.501012044165931e-01   -1.210541996440045e-01   +1.380470099869361e-01   -1.255890682390086e-01   -1.802176716847477e-01   -7.596250036983573e-02   +3.990795314737473e-02; +4.130611609649351e-01   -1.482217566137296e-01   -2.731608500416260e-01   -4.532251052588150e-01   +1.434718024063669e-01   -6.568860379792196e-02   -1.105172558075113e-02   +2.791594041393242e-01   +2.236632917579549e-01   -8.710004497102102e-02   -1.510377486421911e-01   -3.864464017049880e-01];
L3E_L3I_iGABA_netcon = [-1.852390972572924e-01   +4.014111557999439e-01   -2.639488150832588e-01   -3.152681310669844e-01   +2.582303648502796e-02   +3.362364810136324e-03   +2.378458522302146e-01   -1.121337008890513e-02   +2.532811820707704e-01   -1.868728597968486e-01   +9.286445239713381e-02   -1.826240513932006e-01; +1.358256786006527e-01   +1.840328618386935e-01   -1.455428762544449e-01   -6.626515910125069e-02   -2.696708120105434e-02   +1.767095526529643e-01   +3.353407910790984e-02   -2.848386853731478e-01   +1.614188586201071e-01   -2.029901490598249e-01   +4.657488796106632e-01   -3.683435432351392e-02; -2.512341327174035e-02   -2.002620123063825e-01   +3.578518790602054e-01   -9.355436808054052e-02   -6.234328714826043e-03   +3.038264382985596e-02   +1.417087892783986e-01   +1.038115804338230e-01   +2.780591512304906e-01   +1.393072471666184e-01   +1.395224452582651e-01   -2.826224963803505e-02; -9.276487863602101e-02   -1.473397348605373e-01   -5.721119300474939e-02   -1.480746386371092e-01   -2.037902671034135e-01   +1.780914666053260e-01   -1.251236405900048e-01   +5.603237779686820e-02   -1.564478113719602e-01   +2.710871873750293e-01   +1.469127631518242e-01   +3.213534236899436e-02; -6.815149742721627e-03   -1.284601521556877e-03   -8.724307340249793e-02   +5.152288373472431e-02   -1.339887212722376e-01   -7.102831022069472e-02   -3.158766762637119e-01   -4.387716852506743e-02   +2.830657620107702e-03   +4.110307611293849e-03   -3.173661240193876e-01   -1.034976157891675e-01; +4.308505303858139e-02   -1.421515926942511e-02   -8.835037132439025e-02   -2.001604069463179e-01   +7.808724578279022e-02   +1.861285217923761e-01   +7.553068029475771e-02   -1.614342094145455e-01   -6.251423072866735e-02   -6.393164870759695e-02   +2.121129674198133e-01   -1.317970527226372e-01; -1.613111712694303e-02   +5.299735786941220e-02   +1.272112781163179e-01   +1.306342962831816e-01   -2.081831640549097e-01   -3.769177703391993e-01   -1.177546397427920e-02   +7.018200092890138e-02   -2.080526169153571e-01   +2.299581942119780e-01   +1.890278098598862e-01   -2.252148130672364e-02; -6.395553477853080e-02   -4.067988170495294e-01   -7.673518779779281e-02   +5.855372613064214e-02   -1.376400559732526e-01   +1.371221386779113e-01   +5.825408042560976e-02   +1.977427664723247e-01   -3.235648137887993e-01   +3.643767082830343e-01   +2.143189042221633e-01   -9.369839304691333e-03; +1.196063376322812e-01   +1.402483462261799e-01   +1.858956001915354e-01   -7.813035393279789e-02   -1.578216435103851e-01   -3.686626835905634e-01   -4.077560240598097e-01   +1.922968780616376e-02   -2.847943664202686e-01   +3.537459383901949e-01   -6.414761399884550e-02   -2.164653642826783e-01; -1.300479546651628e-01   -4.503240939382253e-02   +5.543635255511348e-02   -1.397481336084868e-01   -8.766990258081091e-02   -3.923436068522848e-02   -4.358465469993055e-01   -9.421201692687416e-02   -3.629681456481321e-01   +1.378021707686830e-01   +3.259517236443861e-01   +3.800623001219339e-01; +4.107540233876040e-01   +6.772808077977006e-02   -1.595047906691476e-01   -2.711328330303319e-01   -2.011183813880352e-02   +4.323087045650526e-03   -1.708239170514161e-01   +7.348813632696335e-02   -3.581525239313619e-01   -2.117401577309138e-01   +1.159027031417344e-02   -1.426598553072629e-01; +3.018594593186872e-01   -2.690775631409616e-01   +6.616479244530865e-02   -5.187470046128456e-02   +2.957931420566268e-01   -1.682595352508755e-01   -1.309063590011722e-01   +6.395554117770622e-02   +2.292133002762113e-01   +2.408288589322988e-01   +4.115739058116880e-04   -6.645168554108152e-02];
L2E_Input1_iAMPA_netcon = [-2.695587873438982e-02   +4.547529989478663e-01   +7.716390363107903e-02   -4.536818031433645e-03   +1.362904091628561e-01   +3.102666375626412e-01   +8.990175231183146e-02   +1.660621726917679e-01];
L2I_Input2_iAMPA_netcon = [+3.214400949664616e-01   -3.042143187191007e-01   -2.459330236496826e-01   -2.872557071186889e-01   +3.059040706200895e-01   -7.357906872802292e-02   +4.580637748036594e-02   -1.355500409068952e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
