function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.487174080209422e-01   +5.796895407169277e-02   +2.993687239424714e-01   -3.525011874985206e-02   +2.559351970822905e-01   +2.662036272301114e-01   +2.732067257242283e-01   +1.448949983800183e-01   +1.717857980730256e-01   +1.140087139010295e-01   +2.222325627755518e-01   -1.014801295831749e-01   -5.987736064150052e-02   -3.643911733669016e-01   +4.009285878780161e-03   -1.859174821342565e-01; +2.378379179629599e-01   -2.839184712657323e-01   -3.300103873255180e-01   +2.656074447834417e-03   -7.953881055549644e-02   -3.720744104006467e-01   +8.494745810566777e-02   -3.889435386175216e-01   -1.805492254309701e-02   +1.143609295127609e-01   +1.017834694327088e-01   -2.992550178427094e-01   +1.409727183965346e-01   -1.612405228978154e-01   +9.985115975443133e-02   +3.486960447874912e-01; +1.334518539857847e-01   -2.179810291093665e-02   -6.600492890988111e-02   -7.922839542257108e-02   +1.510301370732963e-01   +3.802257283417552e-02   -1.991980635371428e-01   -2.463284784738396e-01   +2.408023629074217e-01   -7.165580602336263e-02   -1.446762822561698e-02   +9.120885679367825e-02   -1.401960884138437e-03   -1.798971044405305e-01   -1.386531682866637e-01   +1.957944452582244e-01; +2.860927735282674e-01   +4.527752007136223e-02   +3.817211170058933e-02   +1.909943760621706e-01   -1.135640224272296e-01   -2.424615868196482e-01   +2.718913993541437e-01   -2.560346849002297e-01   +9.581478305975982e-02   -7.384500703779917e-02   +6.977333756750247e-02   -1.588987290828706e-02   +7.922822475626969e-02   +2.240267326751985e-01   -2.628764094877034e-01   +6.653477004859770e-02; +6.468686555699507e-02   +1.795253628067189e-01   +3.860967241501836e-01   +8.157635908426711e-02   -1.204983759953126e-01   -1.788186958451877e-01   +1.025367325147390e-01   -1.623718491122405e-02   +3.391208382623420e-02   -4.482217944884687e-02   +1.376111001453642e-01   +4.097312741147927e-02   +2.452112722364822e-01   -5.967085540424362e-02   +1.809347994508523e-01   +3.941540576735103e-02; -2.609693844663712e-02   -6.571667574219668e-02   +2.141949672595890e-01   +8.659864611227354e-02   -2.649987317718351e-01   +3.487031936983781e-02   +2.108093525792051e-01   +2.511225655893420e-01   +1.874822569626314e-01   -1.640904326149996e-01   -4.434518192811249e-02   -2.414378516405338e-02   -2.592368174533322e-01   -1.122993091064782e-01   -2.018362733091456e-01   +3.485213818752956e-02; +7.136617146741607e-02   +1.579522185939567e-01   +1.757409647300754e-01   +5.299172988225231e-02   -8.568691265002371e-02   -2.873658978299609e-04   +7.876736893693892e-02   +1.147918680359657e-01   -8.384317302237973e-03   -4.124943507712376e-01   +1.396115152499295e-01   -3.849510196489941e-01   -2.278364436237886e-01   -8.073591170992669e-02   +5.771640186739879e-03   -1.497349014260057e-01; +2.956474933423267e-01   +1.006784817330552e-01   -2.330333880699415e-01   +2.253264977031126e-01   -1.900706627080392e-01   -2.981798456398125e-01   +5.902250861044744e-02   -1.876795302543431e-01   +2.688697579872888e-01   -2.158719001987371e-01   +1.645429938950258e-01   +1.522739978688502e-01   +1.298199867535948e-01   +6.308220539528364e-02   +1.809104482352756e-01   +2.067456955052332e-01; -3.193042799671704e-01   -1.601634229538280e-01   +1.443794897293362e-01   +1.899686201757062e-01   -2.123708275370804e-01   -3.029622098137040e-01   -2.255888258814693e-01   -3.051522103773520e-01   +3.063463669987520e-01   -1.866577853818109e-01   +4.201299861544411e-04   -1.754077999737490e-02   -5.637820057544209e-02   +3.228249731704082e-02   -1.230539556134136e-01   -1.418465209190274e-01; -4.499262080000799e-02   +1.027922180266679e-01   +4.771583222521567e-02   +7.765022969030766e-02   -1.698040296375652e-01   +2.214854100730677e-01   -5.538688702541256e-02   +3.057189160351624e-01   +3.395535893118365e-02   -1.799516167403709e-01   +1.030785910840813e-01   -6.759889936152091e-02   +8.869863436397021e-02   +6.359291720958664e-02   +7.220246300879915e-02   -2.575189353415250e-01; -6.945119813758349e-02   -2.471840619842220e-01   +2.340151393261557e-01   +9.962193097777040e-02   -3.001608549224743e-01   +4.439855278339967e-02   -1.645569833937477e-02   +1.184034859959340e-02   -1.351899767490335e-01   -1.086689106482761e-01   +3.721241053293299e-01   -1.433179139432586e-01   -2.108280189343103e-01   -7.051046476778958e-02   -1.246779908815986e-01   -1.342326123850764e-01; -1.439254615955436e-02   -6.760924819633825e-02   -9.876566950986818e-02   +4.947303784368419e-02   +2.043305691713204e-01   +3.286837107667416e-01   -2.741059538594420e-01   -1.407241697185035e-03   -1.260023311928821e-01   +1.099997361717150e-01   +9.228640798455284e-04   +2.318999160579172e-01   -4.443096248966361e-02   +1.249050968489168e-02   +1.294261637140451e-01   -1.241238951642397e-01; +7.592176824460023e-02   +9.684378034474898e-02   +9.325499408944612e-02   +3.782480742049930e-01   -2.274244742851415e-01   -1.254144442169213e-01   +1.395906354740360e-01   +1.400069200966787e-01   +9.731183721580706e-02   -3.130924587768660e-01   -2.022758486280387e-01   +7.212411399227368e-03   +4.040976990305425e-01   +8.103795543316877e-02   -1.534061666926428e-01   -2.628166504798422e-02; +2.402521829131196e-01   -4.151862181045334e-02   +2.349221619773705e-01   -1.617307891655646e-01   -1.418651586266875e-01   +2.232426529913766e-01   -2.068015510950711e-01   +1.350902270392624e-01   -2.425716374055711e-01   +4.188516642593663e-02   -3.427279316674996e-01   -9.328690163709906e-02   -1.057343735878385e-01   +2.487677353801983e-01   +9.426485303390175e-02   -1.108460728381999e-01; +2.573216678563179e-01   +4.036355701554603e-02   +2.471977179519656e-02   +2.176325065662438e-01   -1.278252091996031e-01   +5.754659378540597e-02   +1.070637497454036e-01   -9.356537994873322e-02   -2.610768220860852e-02   -9.434917331084623e-02   +2.120792653030110e-01   +1.324711731001652e-02   -1.664755275053638e-01   -6.806055319031815e-02   -2.277584699345199e-02   +1.856216954741982e-01; +3.253571578315297e-02   -5.947075129728131e-02   +8.649779504839543e-02   +1.135409854216411e-01   +1.580507475034142e-01   -1.677451125826515e-01   +4.714509620463300e-02   -2.133097597115621e-01   -1.944724609608885e-01   +4.552225462865123e-02   -2.980190242625966e-01   -1.661622079766387e-02   +2.626739537352934e-01   -5.817983884593048e-02   -1.322162227664753e-02   -5.296298524502585e-03];
L1E_L1I_iGABA_netcon = [-1.514818542187866e-01   +7.679985992268051e-02   -2.608141841853580e-01   +2.465758245066357e-01   +1.147123231231751e-01   +1.771432725397762e-01   +1.510151957389991e-01   -7.523220551735724e-02   -2.007643281622108e-01   +1.471785065308526e-01   -2.440757183819987e-01   +3.896311133912743e-01   -3.511157184953919e-01   -9.597183666473008e-02   -1.251203750596184e-02   -4.955380177465454e-02; +5.730488876227860e-02   +1.990270610231323e-02   -2.229822589492816e-01   +2.929244052982464e-01   +9.616488107346481e-02   -3.085643710563676e-03   -9.502924185192496e-03   +1.173279538112682e-01   +5.649978059307524e-02   -8.792689982982449e-02   -1.151463456105437e-01   -1.379493288439415e-02   +1.146265723898774e-01   +9.638813799447066e-02   +1.418841709186818e-01   -2.767559808712042e-01; -1.940595689691283e-01   +5.003725888635355e-02   -1.643671862756289e-01   -3.139546486434581e-01   +6.530257126166150e-02   -4.800693203289210e-02   -1.653794163438526e-01   -3.661273977692558e-03   -6.728156243404251e-02   -8.834097253784443e-02   +1.862309030773435e-01   -1.883278409042661e-01   -5.123492013974333e-02   +7.684620140850695e-02   +1.236498139201012e-02   -3.672893694132321e-01; +2.656957486061723e-01   -1.518761849482535e-02   +2.544528624564544e-01   +1.789475549182842e-01   +1.446103875555752e-01   -1.426647708145569e-01   +1.223197154351064e-01   +6.186119681076635e-02   +3.183160326415008e-01   +3.505492629754935e-02   +1.960081905212375e-01   +2.758246378623995e-01   +1.319622430969719e-01   +3.685765186726550e-02   +5.414129386918612e-02   -7.820284526270589e-02; -2.669241060436200e-01   +2.766514849211319e-02   +9.855865110642811e-02   -3.217737589175468e-01   +2.129323194790666e-01   -9.591383585146014e-02   +1.275895649803534e-01   -9.262536621760320e-02   -1.205656961869619e-01   +7.855140989339565e-02   -2.048002603699695e-01   -3.106009992426458e-01   -1.411005721390667e-01   +2.736472164505451e-01   -6.313975386601825e-02   -9.944243588018659e-02; -3.553006281619402e-02   +1.126529715889248e-01   +1.918873680312747e-02   +1.572675066786254e-02   +1.340821521864050e-01   -7.845683415012739e-02   -1.329700487504318e-01   -2.331847023924037e-01   +1.086344304013926e-01   -1.651376031666072e-01   -9.717140835079592e-02   +9.274666569710725e-02   -1.379387682533438e-01   +1.204908778188798e-01   -5.185548110632704e-02   -2.887838980204349e-01; -3.430977103995555e-01   +5.407085143998729e-02   +2.382218073298525e-01   -2.528019282678498e-01   -1.645383743058628e-01   -1.126526037556382e-01   -1.709334143873627e-01   -6.789987539573578e-02   -1.639072296823910e-01   +2.466709502095617e-01   +1.877079287773909e-01   +1.741317947679396e-01   +2.848869924971340e-01   -2.108654071189235e-02   -1.225477918019966e-01   -2.126145843133004e-01; +1.794314772122300e-01   +1.822966211659437e-01   -1.970096485022714e-02   -6.202677695818027e-02   +4.804579648567071e-02   -1.659482058830031e-01   +2.892828496974408e-01   -1.555977520247179e-01   +4.859940490091302e-02   -3.109481975004761e-02   -7.927144295697963e-02   -1.656397304214875e-01   -8.450071142925498e-02   +2.284434801596659e-01   -4.431300533484598e-01   -7.007611403100929e-02; -1.107761503453314e-01   -2.073954721993576e-01   -1.281072607826385e-01   +1.535418741163659e-01   -1.249931164414554e-01   -4.339211234340554e-02   -8.376980798916675e-02   -3.020902388859049e-01   +3.217305267704605e-01   +5.468342653806366e-02   -1.649382023572132e-01   +1.060385301870095e-01   +4.603319097189591e-02   +9.005361125289060e-02   +1.224241385320368e-01   -2.880785380259784e-01; +2.768853706426436e-01   -3.422138648442749e-01   +2.399763420201860e-02   -1.826069847801433e-01   -1.751906306900248e-01   +9.818939210925309e-02   -1.122861938951408e-01   -2.708504262749913e-02   -3.400126883776289e-02   -1.619346279821036e-01   -2.549680093964475e-01   -3.761962457010233e-02   -2.590214059886269e-01   -4.939508892526660e-02   +1.934237565195040e-01   -4.929949917141126e-02; +1.129564317533178e-01   +1.493978170072727e-01   +1.939454419984095e-01   -1.811103468023131e-01   +1.756046945111659e-01   +2.083078226958770e-01   +2.491237736068459e-01   +3.940692508992469e-03   -6.352387630207093e-02   -1.558572018283078e-01   +1.263589416269268e-01   +1.079469382166164e-01   +2.498075895339725e-01   +3.155210747637697e-01   +1.187063500738620e-01   -2.077650291547303e-01; -2.484489492921014e-01   +1.379087313912147e-01   -2.163294007047160e-01   +1.734154385732880e-01   +2.272400047152600e-01   +2.785327179557400e-01   +1.304923570807298e-01   -4.570571397243736e-02   +6.726116156156496e-02   +1.946838758717611e-01   +2.110288917416505e-01   -6.179517191679257e-02   -1.548513328746570e-01   +1.388515078839210e-01   -1.344518877812595e-01   +3.659375962781281e-01; +7.307325142681244e-02   -2.870986586693841e-01   +5.771048011010270e-02   +4.885367575711322e-02   -4.065609982245061e-01   -2.946881062549785e-01   +1.255145130596033e-01   -6.450332275676061e-02   -6.702509503097076e-02   +2.028487608520111e-01   -1.470881130024091e-01   -2.965057289326982e-02   -1.579707557175726e-01   +6.332652061837184e-02   -1.037980379888079e-01   +3.936989936102916e-02; -3.167183790536328e-01   +1.619077914824695e-01   -1.913254153713628e-02   -1.058607773924353e-01   +6.499486026487275e-02   +2.135217753077067e-01   +8.562775952101526e-02   +1.358233028305469e-01   +5.867721556757852e-02   +3.293148008460844e-01   -1.742813697215951e-01   -2.966699571249498e-01   -2.395022837286437e-02   -1.090895029043300e-01   +2.888876224600954e-01   -3.284451019649731e-02; +7.373955319865053e-02   -1.279084153246996e-01   +2.129926945317318e-02   -1.090046666576002e-01   +9.032520368048902e-02   -1.079351672080270e-01   +1.082551674426911e-01   +7.950924316878824e-02   -3.027622571791529e-02   +1.522360320115731e-02   +5.247000521065337e-02   +8.442817789192773e-02   -2.608375787267208e-01   +1.366179951867262e-01   +2.463622407850422e-01   +1.593654907168942e-01; -2.100041584871809e-01   -1.654671100329756e-01   -3.755838698663318e-01   +5.795651023336588e-02   +1.393376238389642e-01   -2.994807545645118e-01   +1.113025164582164e-01   +1.307203334134260e-01   -2.426199606961669e-01   +1.077469126461884e-01   -1.085845140496990e-02   -3.479789674746084e-01   -6.967054231265291e-02   -9.392738193897826e-04   +6.561120069522447e-03   -2.892166276927654e-02];
L2I_L1I_iGABA_netcon = [-1.895204136610345e-01   -7.143337457505941e-02   +9.426600911278979e-02   -3.267665649121124e-01   +1.203024653910726e-01   +1.411967043937147e-02   -2.870102155992034e-02   +4.160614261312556e-02; +5.342002157880453e-02   -2.596619559996653e-01   +1.372241719330233e-01   +5.825354705470917e-02   -3.079768040022070e-02   +1.406259732178481e-01   +3.863809972508467e-01   -1.598972259751594e-02; -2.430866380677119e-01   +2.846339422419969e-01   -1.805529995910056e-02   -1.990122118285712e-01   +2.709139371139945e-01   -1.234128477654211e-01   -8.080981225166264e-02   -1.180189096129335e-01; +4.553709343178143e-02   -4.296577885074916e-02   -3.614568493953776e-01   -8.789360923416223e-02   +2.666652380445756e-01   +4.313719793539736e-02   +5.512789791571112e-02   -3.328848685240875e-02; -1.374400974105412e-01   -1.885786512601297e-01   -6.653231977321679e-02   -5.700197803665408e-02   +2.086872989391333e-02   +8.368105717092514e-02   +5.643314669852283e-02   +1.571398288648524e-01; -2.017375816246230e-01   -2.040241988258834e-01   +1.631953825559325e-01   +4.111588337902105e-01   -2.881546786441052e-01   -2.585283309531658e-02   +4.367163024806262e-03   -9.446355872656077e-02; -1.857606863656702e-01   +5.690598020965559e-02   +1.317285802335777e-01   -1.090160504410102e-01   -4.128844689606316e-01   +2.853124040528237e-01   -1.782971280822393e-01   -7.460525510168546e-02; +6.919616900145548e-02   -2.222022386016768e-01   -1.630643629157953e-01   +1.535971550439806e-01   -3.773837121361791e-02   +7.685731668490375e-03   -2.904206010691430e-01   -1.491066593535257e-01; -2.212913449407154e-01   -9.794193415216526e-02   -2.239680086535409e-01   +7.045061364869154e-02   -2.189488547057513e-01   +1.782590459964509e-01   +2.728223171740943e-01   +1.515681157162892e-01; -1.648123766102648e-01   -6.700304037556382e-02   -9.618038153946573e-03   -4.715743195975242e-02   +2.129183683082869e-01   -9.749178831750527e-04   -6.606774654949819e-02   +3.497608952428169e-01; -1.338392390781466e-01   -1.130268798249273e-01   +1.077563508039758e-01   -2.801084318858788e-01   +9.710691385370469e-02   -9.348036318101972e-02   -4.376997799874290e-02   -1.401981382955904e-01; +1.096795258327930e-01   +2.861169322426824e-01   -4.122386825323839e-02   +1.193893109173392e-01   +9.404673856769960e-02   -1.391827020139083e-01   +1.648393883046628e-01   -1.038953591946948e-02; +1.172125568806110e-01   +3.094318456161416e-02   -3.442530047682620e-01   +8.666614180651866e-02   +1.184018156655014e-01   +5.583831653591957e-02   +2.178935655490074e-01   -2.270217226199796e-01; -1.714648798872238e-03   +6.966752331975132e-02   -1.882472827873573e-01   +2.220680704983168e-02   -6.827226182913725e-02   +6.663696214878079e-02   -9.742420638424787e-02   -1.062620984863766e-01; +4.508768111074117e-02   -1.156384877513460e-01   +1.448237501707444e-01   -1.054557312614017e-01   -7.188556277649519e-02   -4.607788353867355e-02   +8.277221000868723e-03   +1.059037718570857e-01; -1.551821768305935e-01   -1.086055136817589e-01   +6.453879528297693e-02   -1.830007644301111e-01   +2.611941346318804e-01   +1.575730864975506e-01   +1.399903824369341e-01   +1.155397160633060e-01];
L1I_L2I_iGABA_netcon = [-1.153167172399760e-01   -2.516476235949275e-01   -2.140835377470831e-01   +1.536421391915857e-01   -9.687419009182556e-02   +1.141333638388597e-01   +2.134211710608853e-02   +5.635599632639671e-02   -2.278572499874147e-02   -2.209657236517766e-01   +1.433809885230143e-01   +1.234393336993229e-01   +8.421371152609394e-02   -1.482083727169154e-01   -1.059817805974821e-01   +7.938953273621069e-02; -2.895811252754478e-01   +2.036226379218629e-01   +1.052173394003224e-01   +1.641337250874035e-01   -2.985822657934473e-02   -2.489534264279167e-01   -2.632495597694284e-02   +1.298097762309461e-01   -8.755627253294916e-02   -1.700973147981652e-01   -7.025624771167208e-02   +1.366517754901362e-01   -6.750950149369191e-02   +9.407117314711184e-02   +5.100360872146503e-02   +3.816927992694105e-01; -2.004630174703693e-01   -1.171609261001880e-01   +1.571242376807116e-02   +1.981014028860710e-01   -1.091714338789500e-02   -1.731941679621984e-01   +2.111154438134836e-02   -8.186721673082187e-02   -8.991738299889804e-02   +2.537194172833769e-01   -2.359593937282358e-01   -3.412433167712168e-01   -4.722805740339900e-02   -2.005439589096490e-02   +7.669253521048611e-02   +5.065698361944393e-02; +2.324692087099169e-02   +5.064499436399396e-02   -2.075009890485293e-01   +1.368170378599928e-01   +2.002915278419030e-01   +2.533237988295322e-01   +1.408729763158404e-01   -1.711809949038737e-01   +2.228530467058906e-01   -1.058598402049978e-01   +1.709983493603719e-01   -1.033113845892445e-01   +2.275529653095865e-01   +2.194904833731342e-01   -1.334318996979192e-01   -1.160030736711868e-01; +1.512045053069372e-01   +7.851303670317021e-02   +2.446043441663426e-02   -1.781649386130175e-01   +9.779808046727918e-02   +2.959185160611592e-01   -3.383237863095363e-02   -1.311109052694551e-01   -1.989450458523597e-01   +1.830323365602745e-01   -1.646689550969136e-01   -7.482503949254214e-02   -1.502708458871101e-02   +2.822345785422888e-01   -2.492717197849992e-03   +2.579284317417593e-01; -3.734698552864257e-02   +1.571593695754759e-01   +6.235648612385875e-02   +2.742730841790796e-03   -8.100492488681718e-02   -1.951045683917928e-01   +9.460441349355134e-02   +2.589452740818199e-01   +1.042482402236506e-01   -1.451558770935651e-01   +1.125250441011711e-01   +2.079975685850063e-02   -1.624635001460888e-01   +1.900924597705510e-01   +1.354293622024435e-01   +1.890436371931145e-01; -7.424695010177207e-02   +1.948382674861468e-01   -1.218821246423271e-01   +2.949921458932669e-01   -2.092096427469121e-01   +2.867646173946071e-01   +5.878816394566208e-03   +2.123629907397544e-01   -1.339051766118910e-01   -1.063226478966671e-01   -4.041025195787218e-02   +4.490568871632110e-02   +6.951935304833928e-03   -3.627537210149458e-02   +2.126935162130939e-01   -3.913182650315640e-02; -1.038645885435362e-01   +2.065139003873209e-01   +2.990087911652198e-01   +1.082600984450726e-01   +1.281010572174104e-02   -2.980664219964778e-01   -2.452445250991043e-01   +1.086266649285542e-01   -1.239563004243733e-01   -9.192884178675842e-02   +7.429676522671730e-02   -5.071075729408035e-02   +2.084062301550228e-01   +8.773720242774714e-02   +3.421735991941009e-02   -2.399640261405718e-02];
L2E_L1E_iAMPA_netcon = [+6.061310245392115e-02   +2.215696718904053e-02   +3.189101841394189e-01   +1.192617640484654e-01   -1.035639635561354e-01   +1.018247618866888e-03   +8.425365915005956e-02   -2.471327885487153e-01; +1.936232596292452e-01   -4.824361585804481e-01   -3.959899349363823e-01   -5.132347889450196e-02   +3.607350294454877e-01   +1.068130129887441e-01   -3.428546972946097e-02   +1.171674987683543e-01; +1.228207722979960e-01   +1.066198875561494e-01   -8.087064702833768e-03   +1.419064964885101e-01   -1.670394908443264e-01   -2.610321891913647e-01   -7.175664598913875e-02   +1.410726637408930e-01; +2.754088747737508e-02   -1.043001019626709e-01   +8.904752452411784e-03   -2.583293625447888e-01   +3.595718735935251e-01   +2.520479682414831e-02   +3.663003613619625e-01   +1.198321283039985e-01; -4.304333096883059e-01   -3.624610030763322e-02   -3.591938882856664e-02   +2.974433321707528e-01   +1.746424223590400e-01   -1.567693525588651e-01   -2.589788791551654e-01   -2.951316248441828e-01; -2.399346709577722e-02   -3.253618536842935e-02   -4.501694978917559e-01   +3.378193943495846e-01   +8.067543172568351e-02   -4.685759434150810e-03   +4.100215039014310e-05   +3.639879146124949e-01; +2.114488485289859e-01   -7.409942314710941e-02   -2.716545529648791e-01   -5.409240813675550e-02   +2.160787492780248e-01   +1.094011203335806e-02   -5.058106039021888e-02   +3.608520329589011e-01; -1.409165306876913e-01   +1.559927965540071e-01   +6.583860116998888e-02   -2.136715912525272e-01   +3.699358982524664e-02   +1.013096715183373e-01   -1.595786993573948e-01   -2.114318250244682e-01; -3.484524768583893e-01   -4.894780823622644e-01   +1.790641108716322e-01   -1.673964895437782e-02   -2.202882538373884e-01   +1.321108406129546e-01   -2.645206969328501e-01   -2.059190939192538e-01; -3.791268033709674e-03   +2.796481321458949e-02   -1.687411081900382e-01   -1.133879527387907e-01   -3.255950077690993e-01   +2.032097120323798e-01   -5.282389779848513e-02   +2.932439284856744e-02; -1.210709083273573e-01   -2.212404472880648e-02   -3.328467122533841e-01   +1.380869466290217e-01   +1.353158253519220e-01   -8.988405184050770e-02   +3.116144684243369e-01   -2.695399877883211e-01; -3.038482006397160e-01   -2.169393845653463e-01   +4.837587259922492e-02   -1.991060009381915e-01   -2.918928501514438e-02   +3.796086846962452e-01   +3.959500540128266e-02   +1.188965940185889e-01; +9.846465505815427e-02   +1.302232863864705e-01   -3.390749155030436e-02   +5.352492563475034e-02   +1.023714317746316e-01   +9.771541957819842e-02   +3.007146130145434e-01   +2.725968254131994e-02; -1.671465630769488e-01   -2.113090030528449e-01   +7.123020281608891e-02   -5.224139898268595e-02   -1.007688885478073e-01   +1.708073814830086e-01   -2.001709223587751e-01   +1.961847209653760e-01; -3.078756688636040e-02   -1.747762096842105e-01   +1.356698642530299e-02   -1.381923860919158e-01   -1.724858910163884e-01   -2.495236080926592e-01   -1.362304998537900e-01   -9.951431426610224e-02; +2.929586941291684e-02   +2.640175024375722e-01   +8.567341779214063e-02   -3.007001721400234e-02   +1.782475740009749e-01   -1.925186322673643e-01   +8.168807358139525e-02   -1.614873167215555e-01];
L1E_L2E_iAMPA_netcon = [-1.803531068724569e-01   -1.479584082608900e-01   -4.832464556676934e-02   -2.551942317671832e-01   +1.165462305768508e-01   -2.246610251327386e-01   -1.477713261668278e-01   +2.398724150095878e-02   +1.498096866508689e-01   +1.081771383587422e-01   -8.251784848193776e-02   -5.201895821752946e-02   +2.322264308943488e-01   +2.848596512994416e-01   -1.141535933764022e-01   -1.319344448866811e-01; +9.137977893472754e-02   +2.016253592293348e-01   +8.528672523925011e-02   +2.326711382628987e-01   +1.539890268084776e-01   -4.285782455790044e-02   -1.146424359085787e-01   +9.600695837745268e-03   -3.817094662790559e-02   -8.022784286582292e-02   +2.467486049117087e-02   -5.848683097469447e-02   +3.067219720596305e-02   -3.562696508449102e-01   -4.556843346501933e-02   +9.428823140345659e-02; -2.347979349774001e-02   +2.332267900339768e-01   -6.734731065554668e-02   +1.421125627533417e-01   +4.905800113864028e-02   +1.355296831051738e-01   +4.610701246403913e-02   +1.001884103188868e-01   +4.547178553366070e-02   +1.738085851592693e-01   +2.291897768732925e-01   -7.819129287800181e-03   -3.720252525971877e-01   -2.245051933567110e-03   +2.527129553969920e-01   -2.796185989132614e-01; +1.430011052732320e-02   -2.181559198025471e-01   -2.363796562775879e-01   -1.422619744914309e-01   -3.005601679911847e-02   +1.195894073927542e-01   -1.928189615242837e-01   -6.279191367020809e-02   -2.584003833150385e-02   -3.690282958991426e-01   -8.373642458965222e-02   -1.668966300520860e-01   +1.549668536210627e-01   +1.342405064538380e-01   +1.111304601366387e-01   +5.155749999666952e-02; +4.889638900889530e-02   +7.800412221052064e-02   -2.149656054822696e-01   +2.038374190995891e-01   +2.394194984017012e-01   +2.422701180258697e-01   -9.416296972911739e-02   +5.669922884888649e-03   -2.016060822073879e-01   -9.722061175123439e-02   +1.144964955888798e-01   +2.697529771615755e-01   -2.478683892060620e-01   -7.088309756996064e-03   +2.142767093150019e-03   -8.820470563475588e-02; -2.862731526876371e-01   -1.069731154015006e-01   -6.649381764157579e-02   +4.338707545507534e-02   -1.365729011779422e-01   +1.852194965640903e-01   -5.206199467065707e-02   -8.954169806811010e-02   -7.779202335902274e-02   +2.391582383094619e-01   -2.348068635367818e-01   +2.569224058691061e-01   -1.538938043085344e-01   -1.102540386248393e-01   +3.094070842773098e-01   -3.802225778889801e-02; +2.866243548616363e-01   -1.451689021279964e-01   +1.718145638275690e-02   -3.861636746554028e-02   +4.221609279747922e-01   -1.825806241935285e-01   -1.021459262648912e-01   -7.971085296376254e-02   +9.254572072704143e-02   -1.678975394485467e-01   -2.405771091973015e-02   +2.631058815707621e-01   +3.165576606951210e-01   -1.732400392206035e-01   +3.519696218450644e-01   -2.028803424000597e-02; +6.140607734387613e-02   +3.101265463624414e-02   +2.037280924709406e-01   -2.247246398462285e-01   +1.002737787236741e-01   -1.160108202068341e-03   +1.049403310773016e-01   -3.557696838778043e-01   +1.868629908784919e-03   +3.513665257732099e-02   -2.861894399871219e-01   -5.417175159833545e-03   +2.230293626851628e-01   -6.408137696451179e-02   +3.792017534220884e-01   +6.363783977001945e-02];
L2I_L2E_iAMPA_netcon = [-3.554984633210986e-01   +2.883075724948347e-01   -4.595283398803544e-03   -6.749211161879716e-02   -1.910907997135802e-01   +2.102809544363112e-01   +9.378610659165526e-02   -1.727857392672368e-01; -1.138958805082383e-01   +3.124822063984117e-01   -2.256732788025607e-01   +1.235635103060575e-01   -1.950532436698233e-01   -4.126653653017179e-01   +2.058346412296732e-01   -1.573237062238877e-01; +1.408935084239141e-01   +2.417011793999057e-01   -5.226855153158922e-03   +1.414527473629193e-01   -2.364097271726536e-01   -2.831608750697964e-01   +2.145304372461021e-01   -2.518552679901009e-02; -4.017208239275993e-02   -1.220486606818415e-01   -9.177591659532218e-03   +1.241415038847239e-01   +1.148146913253471e-01   +2.673094646916377e-01   -2.305450943826924e-01   -1.628929573434333e-01; -1.754170615534791e-01   +1.988063366286000e-03   +7.937629375058355e-02   -4.981124099035394e-03   -1.888222787233633e-01   +6.214531664798661e-02   +2.633152433240638e-01   +2.167713137724996e-01; -4.913607115906233e-01   +2.492646174487568e-01   +3.183506830608822e-01   +7.873626334938508e-02   +7.427008141491463e-02   -1.512830086953376e-02   +1.287573534903241e-01   -2.008366792441112e-01; +1.695764666658389e-01   -8.279713332053273e-02   +1.754826593627608e-02   +2.161365994983145e-01   -7.997657971595887e-02   -5.750727277279055e-02   +1.156778281108828e-03   +9.110623114980167e-02; +2.693891682092999e-01   +2.504857896858064e-01   +2.043318205467239e-01   +3.391336790652580e-01   -1.280107627967617e-01   +8.180042858746953e-02   -3.578672952478313e-01   +8.654073863829789e-02];
L2E_L2I_iGABA_netcon = [-1.826490526008082e-01   -2.068815648844887e-01   +1.372378897433462e-01   +1.210834998044981e-01   +6.715608907935278e-02   +8.929541728302687e-02   +1.358496890850498e-01   +2.612750198561798e-01; -2.774672824090635e-01   -1.596128915703818e-01   +1.933788349811973e-02   +2.435156739980026e-01   -2.182349033295221e-02   +2.397600986567407e-01   +5.149942973423546e-02   -1.736503161066066e-02; -1.464158880524239e-01   +1.761273743775711e-01   -8.614611642172004e-02   -3.067265580440103e-02   +7.229151845670834e-02   +2.648198640043875e-01   -5.635232269381338e-02   +1.127068871511144e-01; +8.977672532548282e-02   +1.658498954029998e-02   -1.002454874883628e-01   +2.293235016779448e-02   -1.875864695942195e-02   +1.506600585063063e-01   -4.485299986339550e-01   +2.849191208006203e-01; +5.514956185593300e-02   +2.501446875755065e-01   -7.722255371214645e-02   -9.014447132549350e-02   +1.658074745347215e-01   -2.198060049367251e-01   +2.062014742564016e-01   +9.700856187425411e-02; +8.148493800887839e-02   -9.054266944459241e-02   -3.104884053277913e-01   +1.360678539030541e-01   +1.525940743673956e-01   +5.652827601289138e-02   +1.056523579385766e-01   +2.091398999730211e-01; -1.024680723423776e-01   -5.011696097737567e-01   -1.858199888952446e-01   -4.376476724108634e-02   +2.543082882897335e-01   -1.342982519176752e-01   +2.226416502126820e-01   +1.256700096573804e-04; -1.835140344199574e-02   +6.759721298395363e-02   -9.313361597244946e-02   +2.840655433147674e-01   +3.137138385150107e-01   -1.409212804857489e-01   +2.058161638072270e-01   +1.982656704608246e-02];
L3E_L2E_iAMPA_netcon = [+1.925975422980710e-01   -2.833453720789482e-01   +1.608385985292010e-01   +8.873476781679344e-02   +1.382414681591802e-01   -1.799813896306149e-02   +1.630447641131891e-02   +9.728889996290628e-02   +7.436553815182712e-02   +2.368535846330165e-02   +3.384483542584044e-02   -2.626918073426323e-01; -3.679162800207023e-02   +1.785264483966804e-01   +1.909732523659513e-01   -1.127302773680646e-01   -4.211413526753995e-02   +2.497701046530446e-01   +4.317220484849046e-02   +1.115181123109441e-01   +3.304430986427166e-01   -2.757176324035143e-03   -1.337987675931789e-01   +2.616421528313506e-01; +2.056120512388299e-01   -1.953847974443074e-01   +9.645660422640501e-02   +2.004049178691888e-01   +1.994525429823257e-01   -1.855358523912568e-01   +2.015142101416490e-01   +5.196410130296668e-03   -1.881901410806364e-02   -9.865335541051731e-02   +6.894629409909100e-02   +5.153637646594302e-02; +2.208499836136094e-03   +1.283563874950160e-01   -1.551262612080258e-01   +1.609410975083177e-01   +1.255327574532944e-01   -1.139486714899044e-01   -1.327213626332480e-02   +1.692897492946444e-01   +3.750616957828759e-03   -1.688239204759652e-01   +2.730382100757052e-02   -4.180518493406753e-02; -1.450225113948769e-02   +5.634430836933529e-02   +4.999022948506992e-02   +2.500378650821748e-01   -3.362430282658691e-01   -2.013266349227814e-02   +2.252024657524801e-01   -1.896519369054842e-02   +1.233079435494712e-01   +1.540574503707349e-01   -1.028690731586790e-01   -2.778068378443783e-02; -6.589500453640786e-02   -3.519568396596837e-02   -3.826490355149356e-03   +6.058234251762300e-02   -1.248880178521922e-01   +1.738761126251322e-02   +9.877846480584913e-02   +2.600309990712812e-01   +1.121193808040644e-01   -1.354947516539980e-01   +1.911131291286642e-02   +8.123804097593466e-02; +1.257890466941990e-01   +1.803213620647626e-01   +1.426927547059804e-01   -1.705589100426951e-01   -5.838760968321403e-02   +1.561017248371512e-01   +2.455498415611158e-01   +1.132547726334248e-02   -1.836862826882626e-01   -6.141889543234051e-02   -1.109489446244619e-02   -8.603721054701863e-02; +1.077421414735083e-01   +1.740935063102235e-01   -2.142314323178046e-01   -7.356661626453609e-02   +1.419761433992311e-01   +4.513009355623282e-02   +3.962666711616629e-02   -9.933317386766248e-02   -2.472129185836102e-01   +2.954542397491119e-01   +3.813549495398781e-01   +1.383217157265862e-01];
L3I_L2I_iGABA_netcon = [+3.633148276784542e-01   -2.246121546338863e-01   +3.224923399203271e-01   +4.672216473316655e-01   -2.446621891663528e-01   -8.694368087369467e-02   +1.154564738026092e-01   +1.253471084423026e-01   +5.550865222908503e-02   -2.438035802888007e-01   +2.427142498492106e-01   +2.354840407399370e-01; +2.608858417416560e-02   -1.765679222063320e-01   +4.966239316128024e-03   +1.303216927025187e-01   -2.881092374031880e-01   -1.260360896828913e-01   +5.243913293304635e-02   +1.025781799656331e-01   -7.656492548980903e-02   +1.276303093500118e-01   -6.301181623780128e-05   +1.291235892793568e-01; +2.326623896692608e-01   +1.979028093750514e-01   -1.768842775375790e-01   +3.905555610829934e-01   -5.512174681057951e-02   +9.108017818048625e-02   +4.776677392369378e-02   -2.632404598577472e-02   -6.575790905886299e-02   +2.584477523972777e-01   -9.524541119570484e-02   +1.921300078755959e-01; +1.287882213407540e-01   -3.496770331348015e-01   -2.779381241383954e-01   -7.637290813032077e-03   +3.814951444130182e-02   +1.190701636130612e-01   -9.064106675243111e-02   -3.007128494667234e-02   +2.284905786581695e-01   -1.046548681063545e-01   -2.353796661267456e-01   -3.770118406273429e-01; -3.153141691954241e-02   +2.960657663493166e-02   +1.792124807966881e-01   -4.114852467919579e-01   -1.173487168038652e-01   -1.389703468784869e-01   +2.536397084071200e-02   +3.411320230982180e-03   +3.483576290799276e-01   -1.521759225736739e-02   -1.266682098189677e-01   +1.436977977554943e-01; -3.556789580641482e-01   -1.238744248826342e-02   +8.358229823306407e-02   -4.109473922801586e-01   +2.957306109221670e-02   +3.193284432161831e-01   -2.523528586924852e-01   +1.680515413627469e-01   -5.562495295569035e-02   +8.706667843373420e-02   -2.800355175445542e-01   -2.696448405999197e-01; +2.437657745083530e-01   +2.368653490523970e-02   +4.578409809355161e-02   +2.318083120597258e-03   -3.013788607259075e-01   +3.262978268940936e-02   -8.363344185814275e-02   +2.646039324825933e-03   +5.699127892080763e-02   +1.996830964073385e-01   -1.436017748256721e-01   -1.803837190172630e-01; -1.124136657353127e-01   +3.797593661592251e-01   -3.512903286549606e-01   -8.527443871407323e-02   -1.048411997185273e-01   -5.039640820427826e-02   -1.162754428382668e-01   -9.048005300289441e-02   +1.175966208703529e-01   +1.476420819927337e-01   -1.461534767151661e-01   +6.528245306300033e-02];
L2E_L3E_iAMPA_netcon = [+8.216572115893021e-02   +1.002890866946521e-03   +2.284872344263709e-01   +6.933248159597925e-02   -2.558935799381012e-02   +1.362071745843431e-01   -2.080886841440799e-01   +1.555958483420050e-01; -1.447529291332318e-01   -1.379562746352954e-01   +2.418128443048333e-02   -2.872399845939888e-01   +3.089966559268019e-02   -1.924091318210868e-01   +1.201654634038081e-01   -1.214788818373009e-01; +1.857489192734683e-01   +1.875879210597060e-02   -2.442081868048373e-01   -4.362230793407848e-03   -3.250423675407819e-01   -7.151816410968924e-02   -1.943027005863436e-02   +1.766934987950521e-02; -3.754880895616533e-02   +3.598246097120684e-02   -2.122599800368047e-01   +8.298510874439378e-02   +1.287331389239827e-01   +5.374757683363970e-03   -1.575133255484292e-01   +2.495775114758683e-01; +2.663178666423056e-01   -1.166032103452698e-02   +2.161632453328707e-01   -1.951884994828355e-01   -1.375807076159457e-01   -7.965616343132836e-02   +1.363464216152316e-02   -1.182882701826639e-01; -1.605646570380594e-01   -7.922239852017497e-02   +3.247775541445931e-03   -7.204044837618473e-02   +1.424089103598189e-01   -1.609656250629790e-01   -7.271254269658906e-02   +1.336293525426149e-01; +7.767850382419739e-02   +1.882732058896197e-02   -2.564350105093422e-01   +7.397111420462638e-02   +6.982078923140192e-03   -9.779827371840347e-02   +2.161337573962901e-01   -2.004792338407357e-01; +4.902508767666813e-01   +1.002242848717732e-01   +9.561666751329201e-02   +1.307203799916349e-01   +3.850401381032577e-01   -4.505202984648666e-02   -3.942018903246342e-02   +8.052974485150924e-02; +4.018130280150641e-01   +9.606283803155988e-02   +9.952891680002199e-02   +1.075092144580085e-01   +3.030657598214702e-01   +1.154637316710928e-01   -7.028073461041789e-02   -3.090964528886846e-01; +2.262221460093859e-01   +1.315085623098632e-01   -1.505009044938440e-01   +1.799425696733881e-02   -1.692365586583603e-01   -3.483386427146284e-01   +2.028250293065578e-01   -7.322264679734455e-02; -4.358210611033515e-02   -3.748177723714513e-02   -4.680923856073507e-03   -1.324228056973423e-01   +9.273019951202865e-02   -8.937793174623253e-02   -1.706453846398711e-01   -4.386217803193426e-02; -1.011232316970849e-01   +2.054579062604885e-02   +7.076272711870393e-02   -1.001790404597093e-01   +9.785778283413130e-03   -1.330299438312133e-01   -2.203236449679180e-01   +1.864842858673383e-01];
L2I_L3I_iGABA_netcon = [-7.483570405191822e-02   -5.246727012605395e-02   +1.371018367953316e-01   +2.528262048316060e-01   +1.960057120058465e-02   -4.822857318403720e-02   -2.875787848097774e-01   +1.782325499455722e-01; -5.140969550495010e-02   +2.100974964440801e-02   -1.720954236508258e-02   +2.936925099761177e-01   +1.133121636365156e-01   +2.072435752627904e-01   +1.398266779927230e-01   -3.574840227269152e-01; +1.564556657410420e-01   -1.136232667732298e-01   -1.161282747671305e-01   -1.465495000558072e-02   -2.059784421359288e-01   -1.427095327581990e-01   +1.527212945563753e-01   -5.765757210019012e-02; -1.099986348458085e-01   -7.180451736260482e-02   -1.738095639871771e-01   +1.222850367672708e-01   -6.748244681575853e-02   +1.933025432178461e-01   -5.623845043506774e-02   +1.276475807286168e-01; -2.173287057199963e-01   +1.204041356388166e-01   +8.934975211864246e-03   +1.103516001379235e-01   -2.214270000256466e-02   +1.901590992372920e-01   -3.164592303321662e-01   -1.982611770291255e-01; +3.610019079535803e-02   +1.658240132801938e-01   +1.799548152563512e-01   -1.468081419047444e-01   -5.235743430520035e-02   +1.046499034650483e-01   +5.395129315655436e-02   +6.115078370835740e-02; -2.011691611571501e-01   +1.018817671093160e-01   -4.487533783700769e-02   -3.119761679323212e-02   -9.900284778084176e-03   -3.583178007663580e-02   -1.213466917556253e-02   +5.757874231010931e-02; +1.477934407450601e-01   -1.798258941601259e-02   +7.604191893017449e-02   -7.130344711854625e-02   +9.451349564920078e-02   +1.264213922090490e-01   -1.296504916508936e-01   -1.398098404331172e-01; -7.704798849333677e-02   -3.400521221769329e-01   +9.020059276799808e-02   +1.548437521682053e-01   -1.162592765757287e-01   +1.153921433807762e-01   +1.643941886048289e-01   +6.278161622287386e-02; +2.026249736505996e-01   +5.068307882946833e-02   +1.985109327118416e-01   +4.498108174430377e-02   +4.297513877996630e-02   +2.346452149627432e-01   +1.428459649993134e-01   -1.929961614391760e-01; +7.982003024442103e-03   -1.411879164651034e-03   -3.319950901012370e-02   +7.071763108370997e-02   -4.116076188140227e-01   +3.255873304088931e-01   -6.289442538992121e-03   -1.251949522589499e-01; +2.345220286248068e-02   -7.344222503514711e-02   +1.244968166204428e-01   +7.189282552778310e-02   +1.459217882959465e-01   +1.284361814219405e-01   +2.333906101423064e-01   +1.273612148825526e-01];
L3I_L3E_iAMPA_netcon = [+3.628691725823266e-03   -2.221221842458564e-01   +2.475753000672480e-01   +1.595368119250448e-01   -1.335156558552215e-01   -1.387787768646375e-01   -3.294984985827365e-03   +5.888921761871086e-02   -3.320952985748901e-03   +5.221149336948287e-02   -1.753351515643856e-01   -1.208598033944409e-01; +1.196961298636555e-01   -2.220268036757761e-01   +9.540396235824564e-02   +2.391107620310853e-01   -1.516431307473348e-01   -2.502492436671035e-01   +5.147710177997963e-03   +1.655758302237584e-01   +7.644460479664789e-02   +2.295107439592756e-03   +1.896863889408101e-01   +3.003608845746475e-01; +4.684885857887733e-02   -2.804428307598571e-01   +6.598008740388263e-02   +4.420601280060725e-02   +2.120398215308933e-01   +3.640434699927045e-01   +2.547660770060212e-01   +4.344445993279141e-01   +1.577900666348941e-01   -3.804948446937939e-02   -3.585177906652768e-01   +1.586490001163533e-01; -4.714290067967364e-02   +3.867652216749150e-01   +6.992932563126306e-02   -1.367553930132855e-01   +1.645946187095630e-01   +2.509195287711250e-02   -9.485380304689568e-02   +1.717915576718413e-01   +1.216869260580123e-01   -2.029428587314271e-01   -6.175989707033407e-02   +1.115588898542908e-01; +2.572666904163552e-01   +1.845246629515404e-01   -1.514447326018304e-01   +1.579192868743851e-01   +1.934099301756910e-01   +7.645091532757803e-02   +1.349023368895774e-01   +7.022410557983645e-02   +8.295890529673508e-02   -1.314876843201148e-01   -3.147747885274655e-01   +2.506621974947047e-02; +1.029749463865609e-02   +2.193493537936557e-01   -1.631337834753562e-01   +2.225611354505524e-01   -1.783575972711957e-01   +1.810928142474435e-01   +2.228325100046807e-01   -3.842895214183616e-02   -2.215087453310043e-01   -1.123755111143624e-01   +1.020664894915466e-01   +2.249394420899805e-01; +3.770101120439968e-02   -3.212928295599099e-02   +7.884417602586379e-02   -4.200235857796478e-02   +4.185529242059832e-02   -1.280582390955598e-01   -7.232236040060069e-03   +1.181020356322307e-01   +6.416474352834960e-02   -1.328574237044095e-01   +1.338038679981768e-01   -2.497665011483188e-01; +2.307811762626318e-01   -2.752935391130804e-01   +1.454521182260800e-02   +1.256713903044084e-01   -4.891161467657808e-02   -1.501350464621073e-02   -1.407686043314607e-01   -6.537148095813827e-02   +3.154172027897487e-01   -2.213480008935779e-02   +1.398867809125056e-01   -7.644296434897452e-02; -1.106918135639385e-01   +2.181571268133019e-01   +1.851779618466616e-01   -1.686828333655087e-01   +1.308349748863738e-01   -3.243138223577744e-01   -2.063203723133618e-01   -8.204176867793775e-02   +9.481142942144771e-02   +5.140891481357920e-02   +5.825407143189547e-02   -3.492394115531382e-02; -1.420817430687868e-01   -1.008406042517399e-01   -6.261553985092408e-02   -1.467558448475134e-02   +3.039443866302977e-01   +2.276273627120041e-01   -3.221300477765175e-01   +2.838929699923790e-01   +6.882136152121705e-03   +1.872455839143533e-01   -4.453030551207220e-02   +2.873795222562737e-01; -5.404195090305003e-02   -3.158144113152635e-02   -1.965431749041359e-01   -1.287360978478337e-01   +1.488958430575788e-01   +9.288114028116097e-02   +2.223142482602923e-01   +2.522307301765456e-02   +5.942789000372274e-02   +3.076076050655915e-01   +3.286125411742419e-01   +1.205135221328715e-03; -3.037483212195947e-02   -9.667995585696143e-02   -2.687476709717868e-01   +1.015712350993083e-01   -1.628643759922287e-01   -1.147093076904066e-01   +1.513113813322431e-01   -1.500850606636866e-01   +2.907669285896549e-01   +1.399183483991133e-01   +8.362654871916146e-02   +1.012158968507021e-01];
L3E_L3I_iGABA_netcon = [+6.399224139915932e-02   -3.531303288046701e-02   +1.078838211344005e-02   -1.124030292220122e-01   -1.983987610364525e-02   -1.592017497018465e-01   -8.844107211174024e-02   -2.198251626616169e-01   +1.085118717777902e-01   -2.358136500749006e-01   +5.896406892414451e-02   -2.379307214750357e-03; -1.813868250532209e-01   -1.829407385444164e-02   -1.146974217837095e-01   -1.721033735799823e-01   +3.043860651136365e-01   -2.412959481026211e-01   +2.514329647919317e-01   -2.179267595858994e-01   +1.707153931303886e-02   -3.336270480126574e-01   +6.075309645207174e-02   -1.866676707952834e-01; -1.164675073303800e-01   +5.783852502422475e-02   +2.174111379390685e-01   -1.098782741320085e-01   +1.172103966938234e-01   +2.604250159905730e-01   -1.494414912767151e-01   -1.238860375188941e-01   +1.206073853976081e-02   +4.718835665272969e-02   +5.424152031324046e-02   -7.905533179903683e-02; +2.944587524690949e-01   -1.431061854487148e-01   +1.802002523301873e-01   +1.780443649712251e-01   +9.040571931646157e-02   +1.098274685648370e-01   -2.210610998133054e-01   +2.132307868569375e-01   -1.358550085954066e-01   -6.306646915612388e-02   -2.405972699937868e-02   -1.280305407633334e-01; -8.940486267400669e-02   +7.962661664939578e-02   +6.943536608726969e-02   +1.248379419444773e-01   -4.240610489508183e-02   +7.268136352446962e-02   +6.601084207897033e-02   -1.365551942915646e-01   +1.928136537333010e-01   -2.976131695250150e-02   +3.027580944814608e-01   -9.278824511569002e-02; -6.076146687799826e-02   +2.330702510816882e-01   -3.033667643531157e-01   -1.168947582919527e-01   +4.100003944540264e-01   +3.115288058894344e-01   -9.105644902765661e-02   +1.485076445890244e-01   +9.336506308836029e-02   -1.732505181737579e-01   +2.760967699463696e-01   +1.886627874721844e-01; +2.785147902828276e-01   +1.078021479171162e-01   -1.450080149852558e-02   -3.398059351027662e-01   +3.282241592200727e-02   -2.089715682384823e-01   +3.120844580920174e-02   +9.101891798121316e-02   -2.089362754484969e-01   -5.646223998039424e-02   -2.616894645750026e-01   +8.817751593228160e-02; +2.346842169178081e-01   +1.253635729133027e-01   +1.744929938947949e-01   +1.575557453664136e-01   +1.952178441511660e-01   +1.964109471278147e-01   +9.600022805561208e-03   -2.943386512323096e-02   +2.080000047106649e-01   -1.287901319069565e-01   +3.204663415188035e-01   -1.962005802525932e-02; -2.184783055751325e-02   -1.430425246957519e-01   -1.454826459218480e-01   -1.352182435725207e-01   +1.779202979432108e-01   +3.046514077486399e-01   +1.558206451009311e-01   -1.484196602699198e-01   +2.820476148560521e-01   +2.005891404648608e-01   -3.684845074419912e-01   -3.221676246473673e-02; +2.328436212760047e-01   +2.353988334870287e-01   +3.159741994693246e-02   -5.591361476829432e-02   -1.793065773928683e-01   -2.519235537747246e-01   +2.758971815098938e-01   -1.023791649845395e-01   +1.453736030233901e-01   +1.031604776718118e-01   +9.584398629133127e-02   -2.362484126476611e-01; +1.859013488618932e-02   +1.149977087479867e-02   -4.081225073518898e-01   -6.273021119392720e-02   -1.181408125121158e-01   -1.787249036290063e-01   +1.073666262570188e-01   -1.878842257310382e-01   -1.075975056680092e-01   +9.268576934521144e-02   +1.307619518355188e-01   -1.763276661728285e-01; +8.948235137390417e-02   -4.970139895096711e-01   +4.810993905885719e-02   +2.767077087478610e-01   -3.505247765591746e-01   -1.333960216497113e-01   -1.282094174456087e-01   +7.307958537812492e-02   +1.745939232810870e-01   -2.084476907099794e-01   +4.542006170166646e-03   +2.592862645299162e-01];
L2E_Input1_iAMPA_netcon = [-4.305896764038189e-01   +3.150406733617049e-02   -1.462940528948337e-01   -1.400264008765742e-01   -1.603324557576753e-01   +1.800217766490299e-01   -2.596277377075787e-01   -1.561813247150692e-01];
L2I_Input2_iAMPA_netcon = [-1.622111413110124e-01   -4.747536304512270e-02   -1.394806265800491e-01   -1.322250993502501e-01   +1.348151163740082e-02   +3.896273354658526e-02   -4.135788081191207e-01   +1.544228420790539e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
