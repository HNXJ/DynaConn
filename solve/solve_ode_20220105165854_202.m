function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.244222186909289e-01   +4.224902040138211e-01   +5.308393316186798e-01   +6.361879873286957e-01   +5.996355409346215e-01   +3.412407944696207e-01   +6.482858133908131e-01   +8.394816945592417e-01   +5.442411607187216e-01   +1.928585621441208e-01   +4.485705244752981e-02   +8.224053666715552e-01   +7.681481460346767e-01   +1.100619647838830e-01   -7.283176142411918e-04   +8.385646063588632e-02; +9.827931628604395e-01   +9.611187719258360e-02   +3.238494543254805e-01   +9.570955294675444e-01   +3.873003832435384e-01   +6.065246895219240e-01   +6.784811183372002e-01   +8.319195014061963e-01   +7.223622409217533e-01   +1.378989073034679e-01   +7.530158066570422e-01   +4.304151483291622e-01   +1.678761957017068e-01   +1.361600788675002e-01   +8.653971782468648e-01   +6.268902166406384e-01; +7.306360998185619e-01   +5.969858869846928e-01   +1.055265186938503e-01   +2.414286831413252e-01   +9.158155849296006e-01   +1.917823546099285e-01   +6.345896054583654e-01   +2.556767189435123e-01   +5.214143245105562e-01   +6.958082414827892e-01   +2.409905784033426e-01   +8.877875046250386e-01   +8.632910900506295e-01   +6.793191986732865e-01   +6.130972173731707e-01   +6.616458375558649e-01; +3.450928164758930e-01   +4.724472680223655e-01   +6.112430327152027e-01   +6.763358027656162e-01   +7.928294061549408e-04   +7.397219169495840e-01   +9.460236376024127e-01   +6.139471822709265e-01   +9.928467566674903e-01   +9.267214421184762e-02   +4.423255694458879e-01   +3.915905013394442e-01   +9.901107528842074e-01   +4.947742582618604e-01   +9.887179290359989e-01   +7.301460409624563e-01; +5.862934861493595e-01   +6.958971987565771e-01   +7.804506178214572e-01   +2.883285286901661e-01   +4.625423769321337e-01   +2.419758557806021e-01   +2.092056063646545e-01   +5.826775294986646e-01   +2.213037787389975e-01   +5.236785461823560e-01   +6.873795070894214e-01   +7.694913783669685e-01   +5.156632007551304e-01   +1.884297852055486e-01   +5.262659803553993e-01   +8.929371580487424e-01; +1.084518196840300e-01   +7.005319906472263e-01   +4.236108855244222e-01   +6.705783768776614e-01   +4.253707414727696e-01   +9.197417241196999e-01   +7.089534968633212e-01   +5.414495745389694e-01   +1.047510493144258e-01   +5.317113235003070e-01   +3.583206530606274e-01   +3.969193484248346e-01   +8.844586538556589e-01   +4.941653221167999e-01   +4.808647474904309e-01   +9.823007137141477e-01; +9.053386104831204e-01   +6.396666039313257e-01   +9.086469913652341e-02   +6.939152387074355e-01   +4.603676540048076e-01   +2.707661181079217e-01   +2.369228945449393e-01   +8.708493575827920e-01   +1.112643356591820e-01   +8.611387970811594e-01   +7.364394306519815e-01   +8.095225700611335e-01   +5.875683467327357e-01   +1.488295873217459e-01   +8.025434222460965e-01   +7.692366800281006e-01; +8.816066170950934e-01   +3.291486941580753e-02   +2.648750661569265e-01   +6.695213904940744e-02   +7.710962730654048e-01   +7.655066342408641e-01   +1.193450793045407e-01   +2.646629497050432e-01   +6.583416574104960e-02   +4.847714393265575e-01   +3.940435385427366e-01   +7.549515551737456e-01   +1.551730344248740e-01   +5.422309865632498e-02   +2.283109675203754e-01   +5.832665544422957e-01; +8.179124439940387e-01   +6.819339179267390e-02   +1.536538337029040e-01   +2.524834592869563e-01   +3.239425718007971e-01   +1.899142489298141e-01   +6.078210542218956e-01   +3.160286146685562e-01   +4.046378706666193e-01   +3.926251270284786e-01   +6.839589041798280e-01   +3.779388484660367e-01   +2.001875411418159e-01   +8.511921541373224e-01   +4.968696303351237e-01   +9.267495138244954e-01; +2.598213910952408e-01   +3.193038255927134e-01   +2.817578228849750e-01   +2.214787449942248e-01   +7.836930006693499e-01   +2.857086344122577e-01   +4.524059550597105e-01   +1.187659469716067e-01   +4.473300687918613e-01   +6.715522239982052e-01   +7.041450182132416e-01   +2.170758020282582e-01   +4.077308928670585e-01   +5.610311744494152e-01   +8.992125768877761e-01   +5.810567107936431e-01; +5.939734205680409e-01   +5.297427861149935e-01   +4.417291792700123e-01   +6.687413717344480e-01   +4.701580568151730e-01   +9.073380610762734e-02   +4.589947120135083e-01   +9.401992309956488e-01   +3.658153835724409e-01   +7.417526947558020e-01   +4.425219926058466e-01   +7.905887484659826e-01   +7.477400146487246e-01   +9.297111675619993e-01   +5.757782928396435e-01   +1.663368957291702e-02; +2.254584437006426e-02   +6.541935119127631e-01   +5.260979462703088e-01   +8.446383678952745e-01   +3.643321053754645e-02   +5.778163331888456e-01   +6.619037503323848e-01   +6.457426703010187e-01   +7.622574644981840e-01   +5.190620828923583e-01   +1.863964552118847e-02   +9.497569202724769e-01   +8.236896275070504e-01   +6.978998946000179e-01   +8.438806438343370e-01   +1.212188189994219e-01; +4.258428433451836e-01   +4.071325418044015e-01   +4.586232884190219e-01   +3.451318160795693e-01   +1.761536719000387e-01   +6.833834776083176e-01   +7.698254536441481e-01   +4.804113582822430e-01   +6.264660095320275e-01   +3.449705684340134e-01   +3.292413208432333e-01   +3.287161790570050e-01   +7.913256458891538e-01   +5.842177358006814e-01   +7.384372440436242e-01   +8.620947283618793e-01; +3.117971585938388e-01   +8.197136216238509e-01   +8.751135651255203e-01   +7.819114519895609e-01   +7.198866882825994e-01   +5.465694464133003e-01   +3.499731458645353e-01   +6.395542752856866e-01   +7.724465026852479e-01   +1.495904852486550e-01   +4.237134669056100e-01   +6.732391239305069e-01   +3.199093281538004e-01   +8.148161831207235e-01   +5.866228014357984e-01   +4.827290061529245e-01; +1.607945193230574e-01   +7.200295563478500e-01   +5.189831599779386e-01   +6.771798342148968e-01   +4.739713272796657e-01   +4.245187614796696e-01   +6.615433332159206e-01   +5.446019487104715e-01   +9.324705589420482e-01   +5.869548535606364e-01   +2.687348860394879e-01   +4.399626330748408e-01   +5.338302313979794e-01   +8.805479974024825e-01   +2.446410085149170e-01   +8.450772812390261e-01; +1.774460035499842e-01   +9.682168274690178e-01   +9.450175609559525e-01   +6.932694763575315e-03   +1.529434765542066e-01   +6.437829982587271e-01   +4.156914525274854e-01   +6.472096879906056e-01   +9.734537484883735e-01   +2.610556203997318e-01   +1.967691041059550e-01   +8.329290784001299e-01   +9.009329178514637e-02   +9.897349426632897e-01   +6.652933056327966e-01   +2.093369040399556e-01];
L1E_L1I_iGABA_netcon = [+5.507509073840315e-01   +6.945649409881043e-01   +1.053431695127401e-01   +1.767210643970441e-01   +5.404506481973351e-02   +1.787362485138344e-01   +5.961195035204180e-01   +9.970025912067642e-01   +3.391492470989840e-01   +7.786646416693850e-01   +6.837732220458964e-01   +3.654876539853206e-01   +7.829114774965267e-01   +4.319347036983447e-01   +5.946341150451895e-02   +9.653279093156664e-02; +6.311924994145017e-01   +4.985770644897930e-01   +1.427816175217702e-01   +3.988191133870524e-01   +1.776641672831278e-01   +3.610391247709731e-01   +3.000353841280016e-01   +3.311164225382701e-01   +2.943524585137043e-01   +3.377637370725250e-01   +1.322859293975514e-01   +3.695243691012163e-01   +1.012780349736678e-01   +6.554726337152981e-01   +3.138827731466881e-01   +1.414577503579936e-01; +3.212127898582953e-02   +5.356242499558260e-01   +1.680561693011047e-01   +1.336813774945109e-01   +6.608824632988873e-01   +5.622612607986255e-02   +1.343168773686104e-01   +2.969522017368222e-01   +7.461631710969509e-01   +6.078886610157497e-01   +7.233204264663512e-01   +6.850237713210523e-01   +2.929603195111994e-01   +1.113841189725995e-01   +7.720162584746292e-01   +1.681140947107974e-01; +6.143433631032177e-01   +4.436744934660650e-01   +6.227644678658494e-01   +2.894989797318239e-02   +3.325219711988754e-01   +5.225229699874383e-01   +2.110123496385249e-01   +6.224086077895820e-02   +1.059421848691892e-02   +7.415415391942675e-01   +1.095894516743458e-01   +5.979727061158410e-01   +2.358613119237306e-01   +9.316821082025419e-01   +6.959581558672460e-01   +1.958975511648160e-01; +3.633924775417374e-01   +1.241451894177353e-01   +5.739851197955137e-01   +9.381545563168369e-01   +8.982447161764913e-01   +3.345342319728287e-01   +8.963879759420859e-01   +2.981274350966158e-01   +4.727549769815442e-02   +1.054211711873391e-01   +1.169959887208956e-01   +7.892270084361767e-01   +5.299632342586647e-01   +1.853644651391766e-01   +1.252834119730593e-01   +3.178641999525529e-01; +4.982114218432803e-02   +4.915390198133887e-01   +5.378447007694800e-02   +3.027947775222716e-01   +1.168919471090189e-01   +1.735158399952023e-01   +7.138858852003209e-02   +4.463992277168993e-02   +6.676611241757554e-01   +1.269013330983737e-01   +6.405351015595663e-01   +3.682457421184972e-01   +9.283429973566923e-02   +2.660872240893503e-01   +1.276480982826868e-01   +3.177217518821779e-01; +4.872850168502420e-01   +8.533851285782098e-01   +9.321811724894487e-01   +2.957746447200599e-01   +9.886471352502606e-01   +2.110538495214463e-01   +2.428917063785473e-01   +5.056599100979966e-01   +6.044229436896915e-01   +5.486963303197008e-01   +3.292144824874127e-01   +2.056589311955259e-01   +4.052424504387023e-01   +7.981425169765713e-01   +9.142722996593168e-02   +2.169849075138774e-01; +1.917028779914540e-01   +8.744212105724284e-01   +7.285731143782441e-01   +3.354436698203989e-01   +5.414243462996792e-01   +9.054502117202230e-01   +5.441856638459037e-02   +7.609227500820657e-01   +5.266487626624844e-01   +4.851396843402259e-01   +6.539440979745575e-01   +8.722315394197938e-02   +1.046179917095558e-01   +4.879682450989931e-01   +8.481323582215537e-03   +2.517181116463704e-01; +1.219815573882489e-01   +2.709389592284735e-01   +7.376521989466236e-01   +4.687706194651075e-01   +7.058348455158223e-01   +6.751258198677760e-01   +4.413812097495435e-01   +6.312320859034091e-01   +7.301027469770165e-01   +8.895790125991614e-01   +7.503068452151576e-01   +7.717348417484620e-01   +1.102867311566958e-01   +7.690187495728189e-01   +4.243624532030298e-01   +8.932749745126088e-01; +2.065844528663484e-01   +2.102413489326475e-01   +6.316893047502586e-02   +6.477578395183592e-01   +9.994817600219806e-01   +4.682789364295009e-01   +1.458506680906405e-02   +9.124401741524593e-02   +7.078694365600969e-01   +7.999970299346738e-01   +5.846664289341025e-01   +2.072847713480846e-01   +7.859219683712413e-01   +3.976064954669483e-01   +6.557647285014628e-01   +7.025664250341105e-01; +1.463795676442449e-01   +5.637854152079086e-01   +8.597965796361492e-01   +2.430787217444913e-02   +2.878442803281412e-01   +9.120491205420224e-01   +8.970973239780509e-01   +8.086589192329799e-02   +7.804113418139029e-01   +7.349690214493531e-01   +7.408541569217402e-01   +3.894460439688794e-01   +2.911963275855692e-01   +2.726704266741259e-01   +7.225884193827552e-01   +5.554291236686406e-01; +1.891164174489443e-01   +6.386770850257271e-01   +9.328239802229786e-01   +8.428708324446736e-01   +4.132304270338734e-01   +1.043596004902027e-01   +1.951897228371403e-01   +7.751114619793490e-01   +2.883309648711457e-01   +5.309141051440933e-02   +2.344092465583734e-01   +5.512208177534492e-01   +6.039642358565924e-01   +3.741669263035284e-02   +5.303966054243929e-01   +1.843532557078867e-01; +4.302963632588636e-02   +4.157567500773931e-01   +9.837278796887676e-01   +5.582765696778771e-01   +4.662636536348069e-01   +7.447016352278701e-01   +9.297141323106177e-02   +9.052488229053582e-01   +6.908148818334944e-01   +7.290916949746434e-02   +7.342650406405203e-01   +2.290454768761880e-01   +9.643003400614580e-01   +6.732321774213665e-01   +1.083729994128979e-01   +2.123917493437309e-01; +6.356513450910405e-01   +2.062908869975323e-01   +8.578561436606237e-01   +8.535611287500559e-01   +7.643969444390216e-01   +7.375223690158167e-01   +3.072529969486190e-01   +5.335502915688992e-01   +5.554108838719855e-01   +8.684286275072917e-02   +9.710256731808111e-01   +6.417492608742873e-01   +4.315950379092980e-01   +4.309449706816646e-01   +6.324640603091441e-01   +7.690990956442099e-02; +2.817650021135715e-01   +9.485126962374186e-01   +7.857531567813678e-01   +3.491418049564311e-01   +8.176405722919453e-01   +5.622425685777737e-01   +4.556244781170673e-01   +1.076628127108397e-01   +3.951616668289121e-01   +7.963088354498141e-01   +8.677343300827758e-01   +4.827572202292630e-01   +6.948048108053848e-01   +4.508339870628130e-01   +1.291942456577511e-01   +9.139826118715453e-01; +5.383693416219789e-01   +8.052411623792977e-02   +5.145161272213967e-01   +4.463569193671808e-01   +9.904890901110308e-02   +1.850931154872856e-01   +1.019039970950292e-01   +8.268804966932908e-01   +6.154580841116501e-02   +9.416782507122398e-01   +8.741660092631262e-02   +1.513838540638023e-01   +7.580720259196166e-01   +6.094711049701639e-01   +1.338880579822470e-01   +7.069578836124052e-01];
L2I_L1I_iGABA_netcon = [+5.582665404116951e-01   +1.593639948239683e-01   +4.228483250043703e-01   +6.836073933527799e-01   +8.084564026053548e-01   +7.953487205554611e-01   +7.885668068921825e-01   +2.684868612491912e-02; +3.131935264578715e-01   +7.586193790861364e-01   +4.296735492373144e-01   +4.637914868305238e-01   +7.468353613254481e-01   +5.775054526677547e-01   +8.517878604441433e-01   +4.204706002711682e-01; +1.665462377817600e-01   +8.702277498774582e-01   +1.252491335727437e-01   +2.128747578590666e-01   +1.184101494475251e-01   +4.413400277367472e-01   +5.068962396643042e-01   +1.830242283820708e-01; +6.220646372370153e-01   +3.509761325095299e-01   +2.398968056843877e-02   +9.804662613963921e-02   +5.259411668189690e-01   +2.574772084193045e-01   +6.356227335102312e-01   +7.266390096661846e-01; +9.874759940200637e-01   +6.862247085919990e-01   +2.902941187935282e-01   +8.235067513946358e-01   +3.248075270915665e-01   +7.524854438355139e-01   +9.521204910652803e-01   +3.702652072611175e-01; +1.716291736483560e-01   +2.937491139385391e-01   +3.184634887107625e-01   +1.753932742897680e-01   +5.457571854635972e-01   +2.292965861763129e-01   +4.445668045004696e-01   +8.415400071872294e-01; +2.578285779163104e-01   +5.298861118355170e-01   +6.539062611024948e-01   +1.642084876445599e-01   +3.999375439984076e-01   +6.517108395365556e-02   +5.884313461394125e-02   +7.334254273952169e-01; +3.973520992893088e-01   +8.330478258596032e-01   +9.572727713241184e-01   +6.677299084780023e-01   +4.159707043060289e-01   +7.661999626604931e-01   +8.679265492187433e-01   +5.694631227540347e-01; +7.477757998088949e-02   +5.991098993781030e-01   +9.366450429003602e-01   +8.935401297491508e-01   +1.788256715978744e-01   +6.711461988851342e-01   +6.312755904671208e-01   +1.783428314537944e-01; +6.846143292909256e-01   +3.348366195729501e-01   +4.580589752872340e-01   +5.158828426453805e-01   +2.558754278036176e-01   +7.145254232719852e-01   +3.533541388941763e-01   +9.589996403656100e-01; +4.036518433429884e-01   +2.993180708182298e-01   +2.395138334789748e-01   +7.030313955307935e-01   +1.953771545556210e-02   +6.425069346652353e-01   +9.967826785333119e-01   +2.652230808735117e-01; +9.824810395178728e-01   +4.530547551718080e-01   +7.648577384684071e-01   +1.518801214430327e-01   +9.226616386933594e-01   +4.193185550944916e-01   +2.247351265930522e-01   +9.244819308411666e-01; +4.004871405561306e-01   +4.237816576978570e-01   +7.592747929543745e-01   +9.526585746113955e-01   +6.549194296359859e-01   +3.896206291197211e-01   +6.527781930126689e-01   +2.213958443976632e-01; +6.212231828888070e-01   +3.599210592151346e-01   +7.401124793985833e-01   +5.402180243376588e-01   +9.337033353199780e-01   +8.174034948756175e-01   +6.046603486053514e-01   +3.728759494997895e-01; +1.547279732620475e-01   +5.603482442594920e-01   +7.445437928204154e-01   +6.809152771754176e-01   +1.635407927999735e-01   +3.165316657570021e-01   +3.882925439979343e-01   +8.842313647278617e-02; +3.816422303983060e-01   +7.429459581951882e-01   +1.086514249358167e-01   +3.738893136424675e-02   +9.216303052583505e-01   +8.162678934007463e-01   +1.400355792368942e-01   +6.419751303832442e-01];
L1I_L2I_iGABA_netcon = [+1.809532747615320e-01   +9.116422420066557e-01   +2.760295212469056e-01   +8.733056224239584e-02   +5.331984723814454e-01   +1.065707130895865e-01   +9.880341282717549e-01   +4.121626287975416e-01   +7.192570020487031e-01   +2.176755034830286e-01   +9.218472559228299e-01   +6.736462966483407e-01   +1.071080841592709e-01   +5.565019224532272e-01   +6.308794577191288e-01   +4.837133044517369e-01; +4.585722467027018e-02   +7.996241433751867e-01   +2.472775351029960e-01   +8.033169719834676e-01   +8.872655283391269e-01   +6.152228971510465e-01   +7.669231474972793e-01   +6.003173413574082e-01   +9.965118194844514e-01   +1.262804347469871e-01   +7.703576615500226e-01   +4.771471587837506e-01   +1.811686467651148e-01   +7.714994970210085e-01   +9.996861895067510e-02   +8.946250366931244e-01; +7.234297711636678e-01   +7.444503303867990e-01   +4.516815963555064e-01   +9.894826084534861e-01   +8.981631153004392e-01   +9.406131044397006e-01   +3.363456854252396e-01   +7.497760065686100e-01   +3.544063633275713e-01   +3.093600763815753e-01   +4.223513831391586e-02   +6.238031718859046e-01   +9.980689850337641e-02   +3.123273198911093e-01   +3.919622709786769e-01   +1.387848127157962e-01; +3.484393630390987e-01   +8.128877179133088e-01   +2.264775107423705e-01   +6.654428992432460e-02   +6.251856799496379e-01   +3.534271285392640e-01   +6.633167392089078e-01   +5.837987205760499e-01   +9.702752203233870e-01   +7.247929615079951e-01   +3.794442467922007e-01   +2.378218066995475e-01   +4.902960669102734e-01   +1.779544473764724e-01   +5.572500866595632e-02   +3.888599613012843e-01; +6.603583781595225e-01   +3.840136717219326e-01   +8.041639999682229e-01   +9.398665173840183e-01   +1.375331469267966e-01   +4.110863698328083e-01   +2.459750209922251e-01   +5.511168331583184e-01   +3.479544347969015e-01   +7.832030699853594e-01   +7.038559160870234e-01   +1.775163133480441e-01   +1.927924720288861e-01   +3.382865220512851e-01   +5.004641836534023e-01   +9.274608607086753e-01; +3.852043466870401e-01   +6.177476017691643e-01   +9.856539762441816e-01   +1.787474954343654e-02   +2.185315746549972e-01   +9.830142564088208e-01   +2.945144092198297e-01   +5.807798558907170e-01   +8.861678425320596e-01   +6.921700785466326e-01   +7.276849173885500e-01   +8.289682703482113e-01   +8.938726971947440e-01   +2.100115920076257e-01   +4.314359560458934e-01   +9.188538799676511e-01; +6.280063153914747e-01   +5.772457023541762e-01   +3.008325951921470e-02   +6.852519679986485e-01   +1.819149406193509e-01   +9.455476153157694e-01   +6.780781156118466e-01   +5.111183836572413e-01   +4.551837564395984e-01   +9.612101023573972e-03   +2.250405389640593e-01   +7.662868925382372e-01   +9.888363242226590e-02   +5.105445329475441e-01   +9.979339808768840e-01   +7.158590875182030e-01; +2.284133809659361e-02   +5.277700715356964e-01   +5.357437036388687e-01   +7.829972606546738e-01   +4.199039684653764e-02   +6.769167224360904e-01   +5.268414892480575e-01   +8.081802914194537e-02   +4.146774556026849e-01   +8.453748135586859e-01   +2.687597647280124e-01   +9.346485503272454e-01   +4.536377423137785e-02   +9.050038190300568e-01   +8.105758265990631e-01   +6.178877392811667e-01];
L2E_L1E_iAMPA_netcon = [+3.420415730497938e-01   +7.584535566134005e-01   +5.900127632218564e-01   +5.013894829986207e-01   +8.495029171043712e-02   +4.758067340632355e-02   +9.238388555690159e-01   +4.754757475519818e-01; +9.365768088040791e-01   +4.145849203996932e-01   +6.611386573191772e-01   +4.887591790351664e-01   +9.740416819206992e-01   +3.435855077641634e-01   +8.007639552150890e-01   +3.633938238649458e-01; +1.234472511595164e-01   +4.940681291320584e-01   +4.784290015686087e-02   +8.779103258361322e-01   +6.510588767855116e-01   +7.381621587788996e-01   +2.860341813517258e-01   +7.879282741360690e-01; +7.320056467146455e-01   +6.960974064597778e-01   +3.488242846807157e-01   +3.511966374108733e-01   +2.308377549845692e-01   +7.950578837184729e-01   +5.443939635459637e-01   +7.801654977882544e-01; +6.469962568185343e-01   +9.743594643577443e-01   +4.491694440599818e-01   +4.484583204289082e-01   +4.027838904443443e-01   +5.446748964572991e-01   +9.846272351592577e-01   +6.685793356262066e-01; +8.334522134084241e-01   +3.273911305404020e-01   +2.390260493952532e-01   +9.644512371542715e-01   +1.212406372663867e-01   +6.874218435251398e-01   +7.150840235727532e-01   +1.336475002991881e-01; +3.970114186483126e-01   +8.368522626009492e-01   +7.148558893315508e-01   +4.275288405585165e-02   +2.681382082136197e-01   +8.953725228721090e-01   +8.382596572476302e-01   +2.024223554651553e-02; +7.499099813596847e-01   +7.398486442855804e-01   +8.575358327724032e-01   +9.741355137896615e-01   +2.554857585517242e-01   +5.429278210105361e-02   +4.337580856773923e-01   +5.599669876631594e-01; +8.353202316832028e-01   +9.537260629217782e-01   +2.828873682983267e-01   +1.877580720950049e-01   +3.327092149969271e-01   +3.035941880227244e-01   +4.713298885322217e-01   +3.011333770182277e-01; +3.240412589383649e-01   +3.290681691020766e-02   +7.315864773251799e-01   +6.653104495942321e-01   +1.495022527485201e-01   +4.556959399823447e-02   +5.610580014321684e-01   +9.393522872902714e-01; +5.517756826609562e-01   +3.552064056570325e-01   +1.398665201033750e-01   +5.876541471276469e-01   +3.466441593768901e-01   +1.954683328702976e-01   +2.698069327987166e-01   +9.817469659847533e-01; +9.816147757989272e-01   +6.620652425791608e-01   +8.390771061112926e-01   +6.755842770339338e-01   +1.203890162961354e-01   +7.187500205321725e-01   +7.484512229185536e-01   +2.858743034929538e-01; +5.491067429611395e-01   +2.818767890181945e-01   +1.390663909492839e-01   +3.593415370415148e-01   +8.833435324265322e-01   +7.224045890220617e-01   +5.047451828449594e-01   +8.001264817989618e-01; +3.312387114017717e-01   +2.311477083994559e-01   +5.869283787329140e-01   +6.196907671253273e-01   +9.498575439921932e-02   +8.772398720937770e-01   +6.467865582437841e-01   +8.948513882147728e-01; +6.194272028732893e-01   +7.102855281115235e-01   +3.666089619492174e-01   +8.112302832397917e-01   +9.314258418419514e-01   +5.809523927707682e-01   +3.072971545642790e-01   +5.983279987292816e-01; +3.617871179013775e-01   +6.233819088367655e-01   +8.057724656672178e-01   +1.979408735528915e-02   +3.999208429675843e-01   +7.205154703782489e-02   +1.388280500960597e-01   +8.840966876540646e-01];
L1E_L2E_iAMPA_netcon = [+9.429932339699572e-01   +3.730805598581995e-01   +6.684745523067909e-01   +4.853831808522870e-01   +2.473337200319653e-01   +4.522204223552136e-01   +1.236978630930177e-01   +4.966652674343170e-01   +8.827510471228963e-01   +3.251465066338074e-01   +5.147571051057712e-01   +8.617702259055027e-02   +6.318059115081379e-01   +4.288079415288180e-01   +6.129424414303469e-01   +5.036066409521737e-01; +5.484551441371487e-01   +9.359305078552131e-01   +2.079919773091465e-01   +7.570960190568422e-01   +7.846432863454860e-01   +2.060353000396533e-01   +4.065558254476280e-01   +6.931668362261796e-01   +7.201261349461133e-01   +2.463402256323451e-01   +6.575329058078127e-01   +1.631878466717445e-01   +8.585817178333939e-01   +4.919573217271156e-01   +8.205972562692658e-01   +6.120064061939462e-01; +7.283677917757887e-01   +8.284415254763691e-01   +6.536394514445576e-01   +4.164591467889323e-01   +8.825004791168027e-01   +8.986871840272252e-01   +2.751393065582892e-01   +8.339531904743417e-01   +1.850529946460350e-02   +3.426208750585324e-01   +9.510377787886513e-01   +3.245257911615769e-01   +9.757111840282766e-01   +7.147174248612245e-02   +8.867668050940034e-01   +8.195175722440217e-01; +5.772614165745000e-01   +8.508538665861497e-01   +7.194942003745233e-02   +9.719678041599101e-01   +9.127095306171723e-01   +7.629849984536861e-01   +7.172199282771359e-01   +6.120351410572912e-01   +6.744373815758156e-01   +3.756542341847320e-01   +7.227846852112044e-01   +3.009992555316458e-01   +5.697467620193620e-01   +8.876789054674832e-01   +9.303390203758388e-01   +5.329578688428859e-01; +2.571361950830655e-02   +3.719865321758362e-01   +4.067292306415835e-01   +9.898099239732199e-01   +5.587255525406570e-01   +8.837213151403138e-01   +2.822077193239478e-01   +5.749698550776690e-01   +4.389540361141347e-01   +5.457036896571325e-01   +3.995359466121294e-01   +1.126531398624766e-02   +9.966920089427275e-01   +6.500728204708914e-02   +1.921370283158781e-01   +2.024916801038196e-01; +4.474667058908131e-01   +5.930472004436914e-01   +6.664636246721944e-01   +8.639440950489310e-01   +5.984681405087342e-01   +2.866458544915347e-01   +8.953392865418163e-01   +3.244804945541287e-01   +4.360028724445270e-01   +5.630778156293444e-01   +8.342863717941715e-01   +5.411779798504484e-01   +5.539264667957192e-01   +4.359607698556298e-01   +2.577857171365889e-01   +4.540847292823669e-01; +6.478808200542590e-01   +8.745377680764946e-01   +9.362367268224530e-01   +3.879461073181612e-01   +1.483579640772172e-01   +6.705802941605489e-01   +8.266091818483744e-01   +4.559982451820787e-01   +1.157183297139421e-01   +3.952898213209368e-01   +1.353520416218170e-01   +9.639991944943807e-02   +5.153785708855205e-01   +8.249442409735376e-01   +8.972504686021689e-01   +4.288475079516286e-01; +5.222311172298436e-01   +9.334638250725436e-01   +8.095689749813694e-01   +4.529477131902911e-01   +9.017925072963594e-01   +6.639186239958400e-01   +3.900546983633519e-01   +7.140367061327244e-01   +8.146616049630999e-01   +3.967777845029370e-01   +6.048938067858924e-02   +1.465006710976294e-01   +3.313476054936710e-01   +3.921508357353773e-01   +5.937085942848753e-01   +9.654860577405565e-01];
L2I_L2E_iAMPA_netcon = [+6.188631994125442e-01   +6.962072236454494e-01   +7.342524852808427e-01   +5.902452375949530e-01   +6.695004306147657e-01   +5.526929817023608e-02   +9.919240119979575e-02   +8.479989992635918e-01; +6.974552565112111e-01   +4.263319979435197e-01   +4.300423484025279e-01   +4.590695130629582e-01   +5.002117409559835e-01   +1.535163179845643e-01   +9.081224937497108e-01   +9.175989259804070e-01; +7.211922350403974e-01   +8.365812657411330e-01   +6.932390331406357e-01   +5.199255737996053e-02   +2.202622985897013e-01   +1.993856836754442e-02   +1.106288044896176e-01   +9.862369622205035e-01; +3.471549297140533e-01   +7.303145225306384e-01   +9.451887582457911e-01   +2.284970348110790e-01   +5.718314920359029e-01   +4.352254903333101e-01   +5.182311889884279e-01   +5.042032353639923e-01; +5.170667701922838e-01   +3.599951959779777e-01   +7.845046142935276e-01   +8.338936355301363e-01   +1.223222282590350e-01   +8.314250664622174e-01   +1.424570365097663e-01   +2.714364197288111e-01; +5.571639078776032e-01   +4.542521354181273e-01   +7.050938625018790e-01   +1.556912514959069e-02   +6.707576463369803e-01   +6.176479603861227e-01   +5.595859630665574e-01   +1.018423550014411e-01; +1.582732112873603e-01   +3.881207978438756e-01   +1.099163069745021e-01   +8.641930831607039e-01   +5.994630036816093e-01   +5.197129357454655e-01   +4.397283930064282e-03   +5.079262282341424e-01; +5.635314988995617e-01   +7.748577578355478e-01   +3.898809744507324e-01   +7.909974195415961e-02   +5.603764996462168e-02   +8.636308808740183e-01   +7.681954847162368e-01   +5.847791694022982e-01];
L2E_L2I_iGABA_netcon = [+7.643679718834971e-01   +9.411271647191952e-01   +2.386793716906190e-01   +8.336480529816114e-01   +2.572664543745986e-01   +7.571437906836682e-02   +1.738932477522819e-01   +5.236628832590564e-01; +8.258542017215380e-02   +6.566177802232512e-01   +5.785899494687300e-01   +4.019659558034525e-01   +2.986687772328067e-01   +3.942295612882566e-01   +1.404665037707362e-01   +2.639360826349119e-01; +6.599324674484891e-01   +4.522537446228688e-01   +8.659935936994863e-01   +3.910118908078881e-01   +4.248579010759841e-01   +4.232212197204962e-03   +5.978259251744228e-01   +6.856162299343953e-02; +5.174352978366743e-01   +8.398148270422574e-01   +4.050079503093778e-01   +3.626442471917967e-01   +1.176098911179335e-01   +2.199359845025700e-01   +8.994429239957409e-01   +4.359470852263055e-01; +1.719132494073229e-01   +5.331093372506998e-01   +1.116594859482624e-01   +1.375774815723442e-01   +4.974594590185790e-01   +1.207276736787691e-03   +9.385520000897819e-01   +1.733409535481812e-01; +9.404841124685346e-01   +5.535739646220560e-01   +4.435639268023223e-01   +2.576044899712064e-01   +7.070647956966237e-01   +1.898556020008804e-01   +2.203681321523048e-01   +2.667826589266194e-02; +5.910454886257740e-01   +6.806728875079360e-01   +2.979000966621369e-01   +8.590965115689150e-02   +2.442252825506992e-01   +1.421893260549261e-01   +4.806732065944279e-01   +9.537152401554289e-01; +4.403320445928015e-01   +3.677074615214778e-01   +4.014671922628289e-01   +4.297072502526996e-01   +7.848804354419262e-01   +2.682309669805124e-01   +3.776423218109070e-01   +4.309143354402440e-01];
L3E_L2E_iAMPA_netcon = [+9.619295640171759e-01   +7.726950284539698e-01   +9.116205657857467e-01   +5.311619172963193e-01   +4.846451747826674e-02   +8.194374678428253e-01   +6.250457517159836e-01   +7.479949935657484e-01   +6.735278577253185e-01   +9.051679219682021e-01   +5.817594291047207e-01   +5.915898264328673e-02; +7.624894220887009e-01   +2.272369925695993e-01   +9.073987692897744e-01   +7.161898128676516e-01   +5.522852167806211e-01   +7.275166464204295e-01   +5.423921918696460e-01   +6.458271851689117e-01   +4.316025908514628e-01   +3.934602710398581e-01   +6.863042841420482e-01   +9.804737552022749e-01; +7.959646534914894e-03   +3.701006865440313e-01   +5.913160977072726e-01   +1.802672030347308e-01   +2.745192921759643e-01   +1.772680461796457e-01   +4.373999724285939e-01   +1.218362699305769e-01   +6.923790050507941e-01   +2.462634961186447e-02   +7.211232931676541e-01   +2.842418848740848e-01; +6.798904748615523e-01   +8.925212906076920e-01   +3.313491574490040e-01   +3.351546883763641e-01   +2.435223177177322e-01   +3.600722799958794e-01   +2.868579578922549e-01   +5.055647619969127e-01   +2.570719908683466e-01   +6.702082050346860e-01   +6.490672261975985e-01   +5.929926563814987e-01; +7.051954716995533e-01   +8.567293862536924e-01   +8.536565489618062e-01   +1.873301018241730e-01   +2.432151034378657e-01   +1.862370906313096e-01   +5.006853178379201e-01   +3.480067232651861e-01   +1.234468090806734e-02   +8.376456674711854e-01   +7.251035636855074e-01   +9.608998367504663e-01; +6.449820670174173e-01   +4.004605423391703e-01   +4.431085725798440e-01   +3.210140317092306e-01   +1.541576000304326e-01   +5.762703628087226e-04   +7.622785918991930e-01   +9.060029415374460e-02   +5.314109650015792e-01   +9.714643984639283e-01   +3.747475170849326e-01   +1.866420387356450e-01; +5.539265906635789e-01   +3.183827672129484e-01   +9.017551052929809e-01   +4.045855920154330e-01   +9.576463828408300e-01   +3.140991483650006e-01   +7.617766291764595e-01   +1.479616088166368e-01   +2.798995616428507e-01   +5.647583219954428e-02   +5.797925393318074e-01   +1.929051754475571e-01; +2.178118533306462e-01   +6.090454098851327e-01   +3.435215748007264e-02   +5.482024480812923e-01   +9.358635677062075e-01   +6.986262897796115e-01   +5.773506340066321e-01   +1.996747842782985e-01   +9.461904259420681e-01   +4.506427722271006e-01   +1.143527632090788e-01   +3.406488356237818e-01];
L3I_L2I_iGABA_netcon = [+9.334742860140113e-01   +9.275234836397706e-02   +6.269589203290532e-02   +2.789691623524695e-01   +2.540497344693770e-01   +4.043020614238091e-01   +5.292567457404631e-01   +1.083524439407982e-01   +9.121894567528563e-01   +5.837467321750583e-01   +2.085063548325406e-01   +9.077875200819427e-01; +3.911273388216617e-01   +6.166866547158187e-01   +4.949981386424498e-01   +7.458621269833879e-01   +8.574183095318777e-01   +9.873650170966592e-01   +8.294673929005312e-01   +2.709116261012245e-01   +6.394051444603251e-01   +2.835530084671732e-01   +3.176913707247210e-01   +5.516189600296393e-01; +2.718720534427536e-01   +1.100671845617811e-02   +6.433133606318905e-01   +2.381571655946425e-01   +9.115428161105581e-01   +8.987055001883755e-02   +8.576795983709936e-01   +5.234720968459114e-01   +2.551722667686425e-01   +8.282085958725474e-01   +1.335959268733148e-01   +3.467839304095757e-02; +1.521395563429307e-01   +5.736282532582444e-01   +2.227886161797472e-01   +9.579874860540561e-01   +6.992051085467242e-01   +3.229782996691534e-01   +7.881799179374923e-01   +9.727921572604240e-01   +9.042866417851755e-02   +1.923166187626514e-01   +6.732179994416434e-01   +5.377971232565493e-02; +3.972912011879589e-01   +7.876482600568024e-01   +8.380815006770674e-01   +6.215489387226810e-01   +7.253979700608518e-01   +5.132246196115681e-01   +3.188635471388331e-01   +7.087446701862709e-01   +8.385309546434467e-01   +4.416665961461447e-01   +5.699215269713208e-01   +8.062228157484770e-01; +3.750409323605893e-01   +2.350959413693545e-01   +9.711109506295519e-01   +6.010525938154284e-01   +2.303371654226517e-01   +5.903006379810300e-02   +4.528083775439947e-01   +3.111007980676693e-01   +5.843340893055786e-01   +3.929525469448643e-01   +1.704417405849845e-01   +4.512732784719067e-01; +1.299695984507790e-01   +4.478281752026269e-01   +8.463434232051752e-01   +1.723779029670778e-01   +5.750359159937366e-01   +7.260823846442965e-01   +7.534331574257289e-01   +2.941531091839822e-01   +9.484738215555738e-01   +8.270739837927215e-01   +1.481243093647492e-01   +3.808433408880461e-01; +4.338696639053611e-01   +5.696540503566337e-01   +5.068530239455257e-01   +9.004721528267141e-02   +8.111649041371320e-01   +5.571385528138303e-01   +1.106730589658572e-01   +8.499238201127720e-01   +6.128479427974127e-02   +6.794358921710093e-01   +4.766682138318302e-01   +7.910333628441455e-01];
L2E_L3E_iAMPA_netcon = [+3.648097675891696e-01   +7.554640379561088e-01   +7.340931552788742e-02   +5.171342363978314e-01   +7.583917259203491e-01   +4.323314357879239e-01   +2.000038876418855e-01   +8.759126947053896e-01; +5.314733940639410e-01   +9.968545929392312e-01   +5.916275848737136e-01   +9.941303364120704e-01   +9.952211065678965e-01   +5.428318827043160e-01   +1.937027449437291e-01   +7.865972052957219e-01; +7.132041922947465e-01   +1.874829594536110e-01   +9.106029468883032e-01   +8.569944833845025e-01   +9.624229937490528e-01   +7.119905739788238e-01   +3.267574068330125e-01   +4.674398982554489e-01; +8.703305177848677e-01   +7.808270859301282e-01   +1.918137013445673e-01   +9.608057990485090e-01   +5.361536422644725e-01   +1.539417649107118e-02   +8.802694472475047e-01   +8.135282022214906e-01; +3.290951101086704e-01   +1.960501301665543e-01   +4.316714202624228e-01   +6.783873612692265e-01   +9.659154160125739e-01   +8.020015398245850e-01   +4.720487649902000e-01   +8.964570297181280e-01; +6.494864812459742e-01   +9.918046730530008e-01   +7.492751424910932e-01   +4.027137132133480e-01   +1.165049506548105e-01   +1.423778459482209e-01   +4.039680803679059e-01   +4.282595349400084e-01; +9.761367231613605e-01   +8.014592290715891e-01   +4.048660012057544e-02   +9.343059790591285e-01   +5.010201496987955e-02   +4.790651211903992e-01   +1.805602106529425e-01   +3.341636295229993e-01; +7.636407026141509e-02   +4.241355805199272e-01   +9.455638837322077e-01   +4.795393756058055e-01   +3.035859417894609e-01   +2.557417292736783e-01   +9.694745668880281e-01   +5.957923736399524e-01; +5.884711822449941e-01   +7.286381126568783e-01   +7.634584029101039e-01   +2.297410782983774e-01   +5.817605541517691e-01   +3.685790380219903e-01   +4.092013749388135e-01   +9.017634212710810e-01; +4.125400023579174e-01   +4.981896319246278e-01   +5.568492882784485e-01   +3.965080023746763e-01   +5.327797750930634e-01   +6.609076905441810e-01   +8.444885043403274e-01   +7.022131418197560e-01; +3.083916775329274e-01   +8.085252576015003e-01   +1.831955519385692e-01   +7.040165987494840e-01   +8.999467660152322e-01   +1.681424499178552e-01   +6.165826329913336e-01   +3.788758658514450e-01; +2.632863201677775e-01   +3.563881774133715e-01   +5.001481224100993e-01   +5.591294625000323e-01   +5.408220139685166e-01   +2.802007600831105e-01   +3.739352124879580e-01   +7.350016388945828e-01];
L2I_L3I_iGABA_netcon = [+9.548464594944203e-01   +3.085670138060764e-02   +9.115699860011194e-02   +4.595136750604171e-01   +3.270193205514760e-01   +3.676657399888521e-01   +6.850778366976521e-01   +8.049668070464833e-01; +5.422345053196689e-01   +2.082057579382090e-01   +5.936977133792424e-01   +6.386951288048855e-01   +8.047625346861026e-01   +2.095048243302239e-01   +9.093683875139673e-01   +6.612515102703835e-02; +5.386432509350918e-01   +4.547266605473720e-01   +2.409365099147375e-01   +9.166393504743816e-01   +9.994423689928437e-01   +4.407174413227260e-01   +6.111232259482634e-01   +9.487228938137413e-01; +3.094076984512127e-01   +1.268117848501746e-01   +8.387923764999583e-01   +1.607462443596237e-01   +9.793394177670075e-01   +9.551610550166131e-01   +8.999521317364743e-01   +4.953122074109396e-01; +7.006247646996897e-02   +9.051203729327637e-03   +8.569415085835342e-01   +7.134970913008438e-01   +1.256466515174778e-01   +1.235389008844203e-01   +1.946594172917294e-01   +7.542318715251216e-01; +1.819990690216806e-01   +7.266726534442944e-01   +9.612032870387761e-01   +5.767164056154751e-01   +2.303834970845961e-01   +4.694265381438435e-01   +7.534095967070867e-01   +7.399590736066675e-01; +9.231733065348534e-02   +3.533404428366685e-01   +4.885294154938147e-01   +4.322537056073523e-01   +2.351088470477052e-02   +8.549520287015442e-01   +3.478320515524764e-01   +8.303236888446408e-01; +4.641376700405379e-01   +7.787243735895639e-01   +2.185729775300287e-01   +8.830570841531635e-01   +6.078045642732615e-01   +4.199853502446134e-02   +4.193466133392004e-01   +1.557206045984834e-01; +9.400266752479900e-03   +4.364073379361225e-01   +2.267830247711568e-01   +3.905068974579314e-01   +1.096511078633949e-01   +6.897611717266613e-01   +1.533665964496091e-01   +4.562434931336125e-01; +9.143922925896433e-01   +4.363866424136574e-01   +5.363146554752189e-01   +1.774950691325695e-01   +4.062408608049474e-01   +9.774388252308240e-01   +8.189687699328068e-01   +6.185872335002653e-01; +6.422631463522194e-01   +5.029613913962283e-02   +7.614141905407682e-01   +6.314501021476274e-01   +8.833104161191361e-01   +2.836322749921510e-01   +6.229954200828123e-01   +9.297647898362489e-01; -2.620000873697934e-04   +4.785907707890015e-02   +3.466976718667864e-01   +6.234607581715697e-01   +5.477331540139035e-01   +1.341757655186881e-01   +7.402362418707326e-01   +8.339393876582877e-01];
L3I_L3E_iAMPA_netcon = [+8.942946307510590e-01   +2.553349157637653e-01   +7.400984506498635e-01   +6.821861712238461e-01   +6.015124978326316e-01   +7.485154579657139e-01   +7.458783290053783e-01   +2.231634852391482e-01   +4.566517447395205e-02   +8.002928971238890e-01   +2.910024534130273e-01   +8.024758896468590e-01; +5.819343907079472e-01   +3.230939304374102e-01   +6.933326112244379e-01   +2.361615774559666e-01   +8.556797207839444e-01   +5.430407933339151e-01   +1.272485076301566e-01   +3.515665922321163e-01   +2.137932860521933e-01   +2.330889490205216e-01   +4.036723225821549e-01   +1.036528475245810e-01; +5.835368199040518e-01   +4.017253589883448e-01   +8.225414720147648e-01   +4.554276446582375e-01   +9.898024573889087e-01   +3.400211849071844e-01   +8.223024296111909e-01   +2.862952245016349e-01   +3.967985269211372e-01   +9.305386781746933e-01   +8.634326736705156e-01   +8.204001065433787e-01; +8.551460491747248e-01   +4.049528335475148e-01   +8.292647467745652e-01   +3.837924562134208e-01   +9.297769551014016e-01   +8.322596546279379e-01   +2.584533088517392e-02   +9.263073272519342e-01   +3.343837323885639e-01   +7.632978833684239e-01   +6.145717311640068e-01   +8.410062226208894e-01; +3.337810837194466e-02   +3.867690148269595e-01   +2.950950407407243e-01   +5.385594728106343e-01   +4.107240418865956e-01   +5.511097375524699e-01   +4.160782824543716e-01   +5.052380073310368e-02   +2.286375236928753e-01   +8.280906976251624e-01   +9.900784752445811e-01   +3.555800276320462e-01; +8.843563677273977e-01   +6.092243034507284e-01   +3.090211654658765e-01   +9.912443561426046e-01   +1.009153793895934e-03   +9.574127013930772e-01   +7.307570379124969e-01   +5.924298540091956e-01   +9.351109018544482e-01   +5.729470772634097e-01   +2.035809200736416e-01   +4.290652464767646e-01; +4.065411963178903e-01   +1.649987805630295e-01   +5.241149857943982e-01   +7.550683706416318e-01   +5.418986509804310e-01   +8.930493257717682e-01   +7.814078184884382e-01   +1.617778519487385e-01   +6.810164145902653e-01   +7.928213360143124e-01   +8.283680986667546e-01   +5.700338898348085e-01; +3.627962158029070e-02   +1.894178067519663e-01   +3.270691174009646e-01   +9.809392946703142e-01   +2.084124480732587e-01   +3.581139195040078e-01   +3.677378018098013e-01   +8.369776944643734e-01   +9.631063092740004e-01   +3.294794070697004e-01   +6.766713259654529e-01   +6.996218717375503e-01; +7.466527688997531e-01   +9.620512608982300e-02   +8.337231420257931e-01   +2.351039209141655e-01   +2.193630617209634e-01   +5.481381995195463e-01   +7.461021441348583e-01   +1.671938065149720e-01   +4.386208441378183e-01   +2.235887269886365e-01   +2.484870920493998e-01   +7.430236192962814e-01; +1.557584882815345e-01   +3.220187786820600e-01   +8.085142633958760e-01   +5.290946044409652e-01   +3.279063653716209e-01   +3.462178951646591e-01   +8.928061984570068e-01   +5.011857416588977e-01   +9.390837843164322e-01   +3.115109241391497e-01   +4.774563991733025e-01   +7.576153087466233e-01; +1.448107712339764e-01   +7.701746869429262e-01   +5.590286015749987e-01   +5.380453460689730e-02   +9.555149608666424e-02   +6.230804682507827e-01   +2.446079344025577e-01   +9.988755482224374e-01   +6.002599311573324e-03   +5.847279750505605e-01   +3.995798324761063e-01   +3.896134050811944e-01; +6.062124952594508e-01   +2.350301503980678e-01   +2.634144825298043e-01   +7.577135565660426e-01   +7.495519234922916e-01   +7.981230924787518e-01   +1.298871514980131e-01   +3.547099216581531e-01   +6.102233536441135e-01   +8.295038804185934e-01   +5.991279152629860e-01   +4.269336829135308e-01];
L3E_L3I_iGABA_netcon = [+9.558904246553188e-01   +8.845892078511967e-01   +8.003275480585645e-01   +9.851765622188324e-01   +9.022525955560848e-01   +9.620668378380870e-01   +6.531288825725359e-01   +4.978820303009772e-02   +1.085488218220108e-01   +4.522056587993268e-01   +8.292541431557737e-01   +5.810096270062821e-01; +5.727070750586211e-01   +4.374990212434529e-01   +9.860836229672822e-01   +5.606602034066626e-01   +9.948427771820977e-01   +5.425428866120544e-01   +6.544054611583211e-02   +4.667329335998125e-01   +4.615105164215716e-01   +3.346490811920267e-01   +6.267461163873655e-01   +6.364395070201176e-01; +8.504053945954640e-01   +7.821606500871686e-01   +1.587603967596311e-01   +9.324830107752445e-01   +6.521699049546411e-01   +3.122375281665464e-02   +2.750284673150789e-01   +3.242651067959606e-01   +4.508824020592853e-01   +5.925236847586324e-02   +5.400090855012746e-01   +6.505781494521361e-01; +2.764261926645122e-01   +1.492052112560555e-01   +2.373620728154610e-01   +7.206679311525045e-01   +1.075537433833467e-01   +6.958495903592722e-01   +2.814474109046971e-01   +6.308456846226552e-01   +5.509047082345989e-01   +7.402624284478353e-01   +6.499835021014588e-01   +8.630579330289014e-01; +6.225100378281760e-01   +6.199157750434116e-01   +7.018412808666586e-01   +4.846598352343791e-01   +3.741414621758172e-02   +5.200217082354377e-01   +8.792139998897146e-01   +2.295913595541069e-01   +8.064249498927768e-01   +5.060389603185375e-01   +7.260982969064310e-01   +5.670355066440197e-02; +5.896664835267601e-01   +2.601317936922803e-01   +3.774456438338272e-01   +6.394727292354108e-01   +6.186950924640220e-01   +6.022887129020923e-02   +4.448151522379449e-01   +5.804904310555422e-01   +7.015158223992350e-01   +2.014250306979571e-01   +9.413130724972360e-02   +8.186699116832926e-01; +9.642578809673109e-01   +4.451331604253243e-01   +9.748952698082806e-01   +8.875225983591268e-01   +5.655901807692337e-01   +8.891525762552555e-01   +7.579479642987184e-01   +6.039560389377377e-01   +8.725846883334076e-01   +4.263787879570675e-01   +8.787065963196065e-01   +5.290431250472601e-01; +8.704780529181838e-02   +8.448898435170946e-01   +9.703349591486570e-01   +1.974258588686053e-01   +9.617381877374699e-01   +3.303816904144547e-01   +6.013912861758370e-01   +5.996164921811782e-01   +5.235929183186641e-02   +1.675679120102546e-01   +1.271530471285186e-02   +6.950357538998468e-01; +5.016377476142410e-01   +1.978445760950810e-01   +6.423534479218787e-01   +3.961942047415219e-01   +7.473476660382566e-01   +2.284646140254946e-01   +7.829057403548736e-01   +4.481809874475688e-01   +2.191168858351629e-01   +7.516044428777837e-01   +2.920569988033199e-01   +2.121563581323039e-01; +5.218042223350412e-01   +3.033800216169732e-01   +8.601775389359746e-01   +9.917716857634640e-01   +6.627002061428701e-01   +1.141042861204522e-01   +1.141534871367710e-01   +3.414189759615463e-02   +4.586770091627136e-01   +3.670573129603650e-01   +1.797189403419679e-01   +5.440487670127359e-01; +9.077243366368554e-02   +4.805693663960716e-01   +4.018303075536023e-01   +4.012431206750707e-01   +5.240509591554278e-01   +3.120091721971684e-01   +9.774163196283175e-01   +5.127859345085146e-01   +9.588909792394565e-01   +9.420274542195102e-01   +9.267283461382336e-01   +7.039652494699543e-01; +9.066236295690110e-01   +3.373940654543969e-01   +6.316559557742789e-01   +6.589128870216728e-01   +2.592563937411050e-01   +2.271036175220065e-01   +8.488291690527523e-01   +4.067184235998585e-01   +7.920813093332792e-01   +1.560414109716480e-02   +6.902283168743857e-02   +9.554770143104898e-01];
L2E_Input1_iAMPA_netcon = [+9.967259432036660e-01   +9.999254528180509e-01   +9.980498102628336e-01   +9.992375888032855e-01   +9.966071566256195e-01   +9.970421459095968e-01   +9.976938883895773e-01   +9.966570836978893e-01];
L2I_Input2_iAMPA_netcon = [+9.986794728419434e-01   +9.985215103697385e-01   +9.987933057078288e-01   +9.992587929346228e-01   +9.982819957194203e-01   +9.974957190243671e-01   +9.999656171642342e-01   +9.982085437314165e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
