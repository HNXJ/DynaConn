function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.585183814528443e-02   -6.471423765668929e-02   +4.888822361406345e-02   -1.319308704800267e-02   -4.560631575205962e-02   -4.002129358463042e-02   -7.269935333470406e-04   -5.242886426716190e-02   +1.156770691347509e-02   -4.125832406908878e-02   +1.173507526067471e-03   +2.975746465518837e-02   +3.981917875289023e-02   -3.850811457280501e-02   +2.427048432184689e-02   -1.800298237279838e-02; -4.464670156623254e-02   +3.332330863389339e-02   -1.603821397862509e-02   +4.691376681265085e-02   -6.322434823032167e-03   +4.570114357655695e-02   +1.573044048656375e-02   -7.183333977187445e-03   -3.636520082112427e-02   -9.591108292971332e-03   -7.151655135737185e-03   +6.927937080098377e-02   +1.367739274301378e-02   -3.031301034438884e-02   -5.694138297127050e-02   +4.596039449094124e-02; +1.702090332274370e-02   -2.641217799810420e-02   +4.151206370235055e-02   +8.011075763619580e-02   -2.184516357846712e-02   -9.035890339525369e-03   -6.320503243199616e-02   -2.564156784276216e-02   -9.015521125187465e-02   +1.297515518716561e-02   +2.918195370797329e-02   +1.344776915574978e-02   +8.664374856757844e-02   -7.326508344925821e-02   +7.693792139911756e-02   -1.438532233960622e-02; -5.859033128816768e-02   -5.937436910005171e-02   -9.454549549591977e-03   +4.767862663340823e-02   -1.110479259475796e-02   -3.337672915800477e-02   -1.859482770481179e-02   +3.546850324820441e-02   -1.060075515780462e-01   -9.858510820004927e-02   +5.493086889479263e-02   +4.188913118714096e-02   +5.253571081272063e-02   +7.389341718880192e-02   +4.900697037467847e-02   -1.435432041069811e-03; -5.242327249378315e-04   -3.917841166739131e-02   +5.197021315414750e-03   -1.817422810996978e-02   -7.343949083811013e-02   +3.349236390179892e-02   +1.155744281311748e-02   +3.777970802679385e-02   -5.400152526031243e-03   -5.832992552387659e-02   +4.857689463063931e-02   +6.917423553067446e-02   +3.100580236458235e-02   +3.526152735342476e-02   -2.446968304139317e-02   -3.454685041391211e-02; -8.839202309546382e-02   -8.783587626553641e-03   +7.322668543313907e-02   -6.860727450747889e-02   -3.568654871737279e-03   +4.125084076623832e-02   +3.477025120512732e-02   +6.213762809358650e-03   -2.395974606415073e-02   +1.373688610674932e-02   -2.392823871717543e-02   -2.038892103636474e-02   +4.149047522732510e-02   +1.074446845766262e-02   -9.755411542984763e-02   +2.250120297922095e-02; +2.979354970748005e-02   +4.838549913073484e-02   -8.532358300306948e-02   -8.951529902922441e-02   -4.590494968835363e-02   -2.858919534464910e-02   +5.722126350353648e-03   -5.098000244728251e-02   +1.584042136559238e-02   -2.431662543111789e-02   +3.305125519911237e-02   +6.264679108309345e-03   +1.002788983354946e-01   -2.612517305314909e-02   +7.532549847878391e-02   +3.558510391726652e-02; -6.535371683265978e-03   +5.238517548696307e-02   +8.339373138338033e-02   -6.424871736189702e-02   -6.259524094692033e-02   -4.825007945440027e-02   +1.156481584004707e-01   +6.998580168031913e-02   -7.632995501982787e-02   -1.183239078264832e-02   +6.832465346006120e-02   -1.501543085202938e-02   +5.225927804478055e-02   +2.583589635813828e-03   +6.879392133225205e-02   -3.301976811511803e-02; -5.416621076856297e-02   -4.074832879143300e-02   +6.783614841367461e-02   +3.784107779847133e-02   -3.555617433239192e-02   +6.258750624214604e-02   +3.601025996367786e-02   -3.377478402165541e-03   -8.880955490241520e-02   +3.829939107074344e-02   +2.924858199298395e-02   -6.647885172883011e-02   +8.159627213603482e-02   +1.079758890553485e-01   -2.900116530620983e-02   +3.328637371620248e-02; +3.240292268699506e-02   -1.626878420767357e-02   +1.357221594526133e-03   +3.532401818575838e-02   +7.443400255216388e-02   +4.072903240182116e-02   -5.975412072845422e-03   -3.351679627384299e-02   +1.784232353112310e-02   +1.148396401335819e-02   -3.433193917163421e-02   +2.972892810655421e-02   +1.387366575817455e-02   +7.425441058507100e-02   -5.766606493862477e-02   -8.003814841874998e-02; +4.024884203858643e-02   +4.251700409297196e-02   -2.797868636325591e-02   -3.839726042362328e-02   +3.376493614572951e-02   +1.126004832345478e-01   -3.096143177759493e-03   -4.560131649692951e-02   +6.072899769041133e-02   -1.099301191257155e-02   +2.140051264257734e-02   -2.725221620474318e-02   -8.834601251713919e-02   -5.793157224612705e-02   -4.459724034166997e-02   -2.764036986351922e-02; -2.272592217985799e-02   -5.235078501634715e-02   -1.786621331591739e-02   +4.434365905086490e-02   -4.540682268473115e-02   -5.031814566198156e-02   +2.085417029934494e-02   +2.645318561124029e-02   -7.581586824604081e-02   +5.628281701061752e-02   +1.414987139789335e-02   +9.927850442761175e-03   -1.614059491276226e-02   +1.229722505248793e-02   +6.222289893607946e-02   +4.602789100145930e-02; +2.181977978299318e-02   -7.216559644932644e-02   +2.293317431669738e-02   +1.316513257247567e-03   +2.321037065858956e-02   -5.277781789642916e-02   -2.895458452991775e-03   -2.244594365033876e-02   +5.581510422016456e-02   -4.190211098774480e-02   +5.284067605432069e-04   +1.033323749777285e-01   +4.550578232269380e-03   +7.151041894230589e-02   +3.478988525036841e-02   -3.171666986915996e-02; +3.516484577822804e-02   -8.572483192162941e-03   -3.271230030389817e-03   -2.826127418713521e-03   +6.413826234990803e-02   -6.737211827082648e-02   +5.225663140621425e-02   +1.876696879882356e-02   +2.531643584756735e-02   -1.587374595722853e-03   -7.396867317460762e-02   -9.526522290713943e-03   -6.797880206048761e-02   -3.291747709209504e-02   +5.050510067185079e-02   -1.487451528835061e-02; -4.593212131071680e-02   +1.152321699309968e-03   +4.883339744893189e-03   +5.980496081669736e-02   +3.937758751664157e-02   -7.431932939463791e-02   +2.551041020234542e-02   +1.606992958083008e-03   -7.178328505090530e-03   +2.796216348865356e-02   +4.603667063028580e-02   +1.043120624937497e-03   +8.304093277774701e-03   -6.287964696075297e-02   -2.196123923899500e-02   -1.147661343814400e-01; -3.086010769179044e-02   +3.388020526596668e-02   +4.995309789612164e-02   -2.262783661145404e-02   -6.196500517996616e-02   -4.401663744140732e-02   -3.624802799652057e-02   -1.041818845452937e-01   -1.369749404181923e-02   -7.356690088901959e-03   -3.625327626468992e-02   -2.415177665435011e-02   -2.865737937266442e-02   +9.557744622773460e-03   -3.752552624821269e-03   +5.619200228478512e-02];
L1E_L1I_iGABA_netcon = [-3.712542768386292e-02   +1.218757528739821e-02   -3.189011820716285e-02   +8.152134366591186e-02   -2.383724856555945e-02   -1.993890938007007e-02   -8.482267648837707e-02   -1.709822741455713e-04   +7.498883730373876e-02   +6.714827898008604e-03   +2.378740814166531e-02   -4.801274803068072e-02   +5.252421238294332e-02   -6.983101355499773e-03   -8.894066115926448e-02   -4.951656216946131e-02; +2.994856178553735e-02   -5.834881596818514e-02   -2.302880358876550e-02   +7.451587447779188e-03   +1.204817158623001e-01   -6.391878740573924e-02   -8.967572912483629e-02   -3.652695903517461e-02   +5.037169452297302e-02   -3.253079205300954e-02   -1.418830687315837e-02   +3.969404986140993e-02   +5.193806618636752e-02   +1.992279763976380e-02   -5.041156896885058e-02   -7.829231829011938e-03; +4.574316225260671e-02   +3.572956666953792e-02   -4.180114652864298e-02   +3.114441923879969e-02   -9.982653955622131e-02   +2.310988677532263e-02   -2.975264541933523e-02   +3.424510116909296e-02   -4.251949891378014e-02   -8.070424584931382e-02   +6.040634343055443e-02   -7.178195046102875e-02   +3.008742572657639e-02   -2.012671759092102e-02   +8.721772857774689e-02   +3.453295809888647e-02; -3.990243874112571e-02   -3.176419330888988e-02   +7.118392330540154e-03   -1.186240527541225e-02   +2.012658492653076e-02   +1.215425802511715e-02   +1.232684317901525e-02   +3.424224687048698e-02   -2.821795920589000e-02   +1.133477740284182e-02   +7.741670687255627e-02   -9.137271403907863e-04   -6.870993495646664e-02   -4.989753051634757e-02   +4.407997078140111e-02   -3.627960279024319e-02; -1.228577115758786e-01   +1.206267776188203e-02   -1.300497958558002e-02   +3.713516763212416e-02   -1.410075402723105e-02   +6.023635132744196e-03   +8.305573639072704e-02   +8.752404612307500e-02   +8.888512877976017e-02   +2.326289881017086e-02   -2.421422907559845e-02   -3.171271369755178e-02   +5.864965581440976e-02   +4.148531654501938e-02   -9.202073186541308e-03   +7.948090870790302e-03; +5.830881234932185e-02   +2.765456291781218e-02   +4.080013910353590e-02   +2.405865561372444e-03   +2.198501679559759e-02   -2.448641795585060e-02   +2.859411968958082e-02   -5.895348612263299e-02   -1.236529738390500e-02   -7.393624866979602e-02   -2.495717820263837e-02   +4.114861742139244e-03   +2.304660111572400e-02   +3.416820354591302e-02   +4.689906775224030e-02   -3.431265253488253e-02; -1.218289588843257e-02   -1.312791561770348e-02   -7.331803305585299e-02   +4.905621645226986e-02   -7.893201575569515e-02   +1.670855716948535e-01   +9.673547707782334e-03   +6.706529499084754e-02   -2.125087979188222e-02   +1.267187670810539e-02   +3.155112080989946e-02   -3.839420891941814e-02   +5.317438369297827e-02   -9.067035760357296e-02   -6.552814672627508e-02   +6.751172930351779e-02; +1.652284989720854e-02   -2.604919390594811e-02   -5.335964234381571e-02   -6.826447316408078e-03   -2.662508953359192e-02   -7.866194707491073e-02   -5.765537260105941e-03   +1.191389270461139e-01   -3.624084396308429e-02   -5.097988389198744e-03   +1.072726093928253e-02   +7.208735716861911e-03   -3.892052672704467e-02   -8.522636919395666e-03   +3.159110151308509e-02   +9.512459725873078e-02; -3.014149111230800e-02   -4.982769992048413e-02   +6.963920585324383e-02   +4.372732125957181e-02   +3.583928430219761e-02   -5.838483011456064e-02   +4.148912002496977e-02   -1.711450647991369e-02   -3.560076714857453e-02   -5.757279501732839e-02   -4.172530316169404e-02   +1.224937827686999e-02   +4.290070393131597e-03   +5.030037200676956e-02   -1.500143970061197e-03   +6.973456795948417e-02; -3.849058717491813e-02   +1.715178083231414e-02   -1.512365841087349e-02   +1.398278431610102e-01   -3.457933079331595e-02   +6.949389450149766e-02   -4.152955030029107e-02   +4.614267846594367e-02   -2.457485087183481e-02   +7.494021059755434e-03   -6.330112214177563e-02   -2.341981592129501e-02   -2.085766267331051e-03   +4.298246857137183e-02   -1.041572374918408e-02   -7.393190223455627e-02; -7.238286884091327e-02   -6.430021504608856e-02   -2.024588285492983e-03   -7.890684760550570e-02   -5.972125232477269e-02   -6.778028688897977e-02   -2.539642109072467e-03   -8.811708418107744e-02   +2.728532445004329e-03   -2.024953309304919e-02   -1.940948603702482e-03   -4.293133949757368e-02   -1.207674676014730e-02   +6.219388358125209e-02   -7.112985180395318e-02   -2.540457466200959e-02; -2.843980782493925e-02   +6.599275890321125e-02   +9.140942911075559e-04   -3.945571492560878e-02   +4.038658790464361e-04   -1.664225925197625e-02   -4.802063996291177e-02   -5.026144069460382e-02   +9.695814604979366e-02   +1.162030581185438e-02   -5.873852735151774e-02   -1.855274187853448e-02   +3.415203409338764e-02   -3.486945054034041e-02   -3.428395367092917e-02   +2.574656035350960e-02; +5.290706674612714e-02   +4.689935443739152e-03   -2.508156506418003e-02   +6.623698268691086e-03   +7.054625288103879e-03   +8.522082142425186e-02   -4.848606241319833e-02   +2.560056795067009e-03   -6.799239160106392e-02   -3.551678114680177e-02   +1.040771175013974e-03   +3.807969324056218e-02   -3.900001781157569e-02   -1.095566929712105e-02   -6.521240624910463e-02   +3.337315964433457e-03; +2.284633431196976e-02   -5.143403415135599e-02   +1.633085993899441e-02   +1.086702811308691e-02   -3.297882021604356e-02   -1.441252222350917e-02   +1.954646233898690e-02   -6.580513588291234e-02   +4.806013849559519e-02   +1.018217818860693e-02   -6.105927883094518e-02   +1.474290934381448e-02   -1.853432001056652e-03   +3.632502027683167e-03   +1.030571133621773e-02   +6.123330591135086e-02; -6.850313335061303e-02   -6.451010297661594e-02   -3.261784639252857e-02   +1.367364044676093e-02   +9.003914877489232e-04   +1.972868613138088e-02   +4.358568589595820e-02   -4.729604564220308e-02   +4.137311803529640e-02   +3.863786486861633e-02   +3.427831358771132e-03   -8.876693215796077e-03   +4.454415509366966e-02   -4.081410358468851e-02   -1.064750001272712e-02   -9.157417816748084e-02; +4.572766066380179e-02   +7.810434562319456e-02   +6.644014384456509e-02   -8.433741486452373e-02   +3.196148180554944e-02   -4.811988590625558e-02   -2.214753810397632e-02   -4.047440039444665e-02   -7.024316926076424e-02   +2.468368363155864e-02   -3.489942480046697e-02   -5.676156409186977e-02   +1.095404146247509e-02   +2.575018610821226e-02   -6.508275013898693e-02   +1.476853729021908e-03];
L2I_L1I_iGABA_netcon = [-3.856813659259372e-02   -2.380867068399934e-03   +8.428683121925563e-03   -3.791071938800075e-02   -6.404990928471853e-02   -3.419435553984111e-02   +5.672699008682196e-02   -3.413054747866019e-02; -5.389514455416251e-02   -1.880195751957238e-02   -2.545869996742156e-02   -9.488252926905163e-03   +1.808624174079197e-02   -2.350801076879926e-02   +1.956981802830152e-02   +3.507835625722545e-02; -2.707613087575857e-02   +2.140251625584057e-02   -1.195274202824586e-01   +1.990967254461750e-02   +1.022025439017424e-01   -5.962627902977146e-02   -3.805496986033077e-03   -5.825389140591614e-02; -1.833920607780068e-02   +3.887517086850834e-02   -1.465970565089642e-01   +2.612850307112847e-03   +2.264407013993604e-03   +4.712481931871527e-02   -1.330520948589662e-02   -1.757369443155635e-03; -1.515247946883994e-02   -9.604644990574063e-03   -1.956770935899743e-02   +7.758545459293829e-02   +6.379738925350344e-02   +8.140406695312965e-03   -5.220779074052413e-02   +3.776019811232386e-02; +4.570882773802419e-02   +1.447084621366308e-02   +5.899907966269567e-02   +4.959523315498517e-04   +6.213412329436695e-02   +1.917501997454911e-02   -5.905406615483564e-02   -1.559465011520038e-02; -1.952197068785820e-02   +6.665351653317166e-02   -7.126345841242754e-02   +4.473467244902971e-02   +3.925093349305649e-02   +7.046087101441362e-03   +1.246805952042712e-02   +4.111331404224498e-02; -1.616508247021257e-03   -4.762271617616904e-02   -4.764435132452106e-02   +6.125309318271636e-02   +7.136850463727362e-02   +4.624451633919583e-02   -4.686253312843718e-02   +7.330744414321515e-02; -7.024402626163524e-02   -2.579199606857949e-02   +8.916911799094707e-02   +7.539707341305585e-02   -7.205342403496317e-03   +5.593180420642491e-02   +4.890856592332302e-02   +7.275218552300108e-02; +4.500084949467671e-03   -3.845028129704564e-02   -1.835652551222611e-02   -2.591216501820343e-02   -6.394785303189940e-02   +7.234082990707960e-02   +2.803110422199535e-02   -3.422712436854706e-02; -4.760336859226763e-02   +7.288938666666786e-02   +2.017537301433068e-02   +8.418921242132081e-02   -1.081655938978639e-01   -8.309866914890374e-02   +3.042693374805298e-02   +4.217985088667947e-02; +4.273433936527478e-02   +2.100932872033476e-02   -1.566376327451806e-02   +1.398534465386072e-02   -5.157868831614443e-02   +2.155667171156112e-02   +3.659525032817115e-03   +6.403301740000682e-02; +3.195110258751364e-02   +8.827675849762644e-03   -1.743670460029570e-02   +1.432241105965582e-02   +1.658410004437381e-02   +7.875174275675911e-02   +1.845859617997700e-02   +4.468230460382248e-03; +7.641330988981647e-02   -1.284128041209427e-02   +3.893761951979404e-02   +9.009108199218235e-02   -4.037035054219004e-02   +3.963001332266292e-02   -2.598690592792640e-02   +1.046335134584589e-02; -5.295889062791170e-03   -9.163144145763656e-02   +6.901242961639030e-02   -6.432090886922961e-02   -1.302306586010023e-02   +1.556754457343629e-02   -4.298686903615052e-02   -7.644616362342190e-03; -7.770564966864646e-02   -1.391622989782789e-02   -4.582871300708671e-02   -7.494600932087372e-02   -2.213701915740111e-02   -6.967755533891914e-03   +4.125563443662628e-03   -4.707296529790410e-02];
L1I_L2I_iGABA_netcon = [-2.729033535616958e-02   -1.851308920917091e-02   +1.411627412551951e-02   -8.662349344212159e-03   -8.162402898724147e-02   -1.519880592639412e-02   -3.098842732424036e-03   +1.007258898727890e-01   +3.782436459344768e-02   -2.067250516096098e-02   +1.042749974856468e-02   +2.905599336143896e-02   -3.777708607480144e-02   +2.015438491283236e-02   -2.644074278314482e-02   +2.550253561318052e-02; -9.164836708858276e-02   +5.341686124097458e-02   +1.288371442729753e-02   +2.898976635576723e-02   -7.614733418530117e-03   -5.648248746126380e-02   -4.013944276141589e-02   +7.072403785969475e-02   -2.900690553013994e-02   +3.349156983081607e-02   -7.574333416325905e-02   -6.908029743442144e-02   +7.416295625296902e-02   -5.019008836690853e-02   -2.787506222731615e-02   +4.733456818564174e-02; -2.108768988859179e-02   +2.590199769963083e-02   -4.570438924309052e-02   -5.313721703515026e-02   -1.658885683589214e-02   +5.062966110611217e-02   -2.765689040406652e-02   -7.347529114210662e-03   -5.960198382871606e-03   -4.911233865622743e-02   -3.188123676600807e-02   +8.817720615245492e-02   -2.106391453844512e-02   +3.676048580777813e-02   -5.781904111505544e-02   -1.156079339529457e-02; -1.157374857396173e-02   -7.526781241594913e-02   -9.415361874787967e-03   -1.106384290019712e-02   -3.334741539245310e-02   +1.377339593115792e-02   -3.598108146936323e-02   -1.974857474650293e-02   -6.155852465590538e-02   -2.769017246278485e-02   -3.339203859173233e-02   +3.990571538099217e-02   -4.397472733604506e-02   -1.515394260026528e-02   +3.443309137177038e-02   -9.678809369910690e-02; +3.340313356806796e-02   -6.371228400415961e-02   -6.917438571810151e-03   -3.977807082243492e-02   +7.351994434558343e-02   +6.654366255796668e-02   +1.490743855993633e-02   -5.283836143205094e-02   +2.042343036917740e-02   +9.855437057453825e-04   -9.067813056941720e-03   -5.903085421622915e-02   +1.119908522575979e-02   +6.771191827730474e-02   +2.337810839908518e-02   +2.294864141566523e-03; -6.675185886000946e-02   -5.415934827064299e-03   +4.054826824013805e-02   +6.433315551356017e-02   -3.277594520422497e-02   +8.167702139947834e-02   -1.154182592563919e-02   +2.209953457088545e-02   -1.220080188574587e-02   +2.335502491452185e-02   +2.121017049455468e-02   -2.242506254836043e-02   +1.321330010637883e-02   -2.106007556873938e-02   -2.944701054039880e-02   -1.305002029240067e-01; -2.526775464682882e-02   +1.829412579952247e-02   -7.657538634225095e-03   -6.267076112532317e-02   +1.303534136633158e-01   +1.043750805177394e-01   +4.082456801402664e-02   +6.379661196838854e-02   -1.080631065412283e-02   -1.194935626957474e-01   -3.056378515889159e-02   +6.660543639829541e-02   +5.438774019658007e-02   +8.276881164823927e-03   +3.434133416218412e-02   +1.671765988586235e-02; +6.745819562979953e-02   -7.142037522500001e-02   -4.596128485801566e-03   -1.185188295536840e-03   -5.902844473371748e-02   -5.165771572922213e-02   +1.840704786283642e-02   +4.432906456942312e-03   +5.259038631914497e-02   +5.428797102595268e-02   -5.227657566229840e-02   +5.622309361772283e-02   -4.745158842487662e-02   -3.659162049117628e-02   -7.847643556556219e-03   -5.385070825038427e-02];
L2E_L1E_iAMPA_netcon = [-6.163984936594450e-02   +5.242634118058718e-03   -1.051751273860633e-02   +2.746816759105949e-02   -3.151870251756820e-02   -7.580016112034133e-02   +1.000945654187483e-03   -2.592249375035675e-02; -4.023195314866682e-03   -6.266100469103853e-03   -4.616206853823435e-02   -4.172226705346910e-03   -3.991016447065009e-02   -4.038223254371592e-02   -9.102109730291645e-03   +1.739622176829957e-02; +6.114585904247237e-02   -1.211537961352475e-01   -7.803986254707597e-02   -3.912925677256403e-03   -2.381590021741287e-02   -4.519796365078589e-02   +1.004833799059344e-01   +7.229138257390973e-02; +2.094373291210919e-02   +7.254807677253491e-02   +2.794589365672576e-02   +3.030446551093080e-02   -6.442679491460171e-03   +6.116474680181101e-02   +3.237806548985792e-02   +5.389244034074857e-03; +4.339227463827786e-02   +4.133332041735727e-02   -2.363751816390359e-02   -3.458180306865185e-02   -6.380866199327077e-02   -4.527546756118500e-02   -7.115143699268051e-03   -1.241931217813138e-02; +7.691775584140327e-02   -7.915941771209627e-03   -4.210227787895583e-02   -1.333860765555640e-02   -5.446891210369705e-02   +5.477867422912818e-03   -1.499896022868168e-02   +1.108415655009583e-01; +2.998038341112868e-02   +8.609103380258056e-03   -8.457626915921114e-02   -5.553424246600297e-02   +2.788344718120198e-02   -2.351134825882828e-02   -1.835067599459494e-02   +5.085710499230750e-02; +6.532847413653972e-02   +2.282380594033835e-02   +1.708313107319361e-02   +3.505359392781626e-02   +1.322514943756213e-02   +3.078939390036718e-02   +3.498610648589695e-02   +2.481830482972117e-02; +6.188988910212990e-02   -7.535565927614524e-02   -4.034127138177750e-02   +6.190793208942915e-03   +3.423190516114608e-02   -1.499018025408509e-02   +4.699236431925156e-02   -8.558450935646947e-02; +6.076735773773817e-02   -7.209408877230715e-02   -1.885053208994356e-02   -4.333580461468314e-02   +2.386544698074625e-02   +4.312342566816135e-02   -2.995540893978653e-02   -3.379258557875640e-02; -1.310649794837443e-02   -1.533682637733220e-02   -2.025559282387484e-02   -2.721356309439156e-02   +5.867147940004971e-02   -4.022650326557366e-02   +2.309662587809037e-02   +2.283999210894778e-02; +1.090003226095401e-02   -2.711998180490177e-02   -2.757235571240321e-02   -7.770322826362849e-02   -8.969074546713175e-02   -2.979765849810338e-02   -2.423297085841279e-02   -1.053685058675151e-02; +3.401407833082709e-02   +8.059213424111653e-03   +3.899861605759385e-02   -8.420778299874672e-02   -1.865317296964736e-02   +3.347643853707764e-02   -8.320531663314592e-03   +6.337600998926110e-02; -4.489750224404312e-02   +8.192214778953127e-03   +2.434776070192008e-03   -2.923108773946607e-02   -2.738303436676871e-02   -2.316500442359011e-03   -1.703922509609814e-03   -4.855884766489640e-02; -3.921648593646866e-02   +5.915012991829748e-02   +6.429410959427100e-02   +1.438436161755290e-02   -4.873985451151960e-03   -4.235903076014365e-02   +3.230821340979090e-02   +2.182186209105871e-02; -5.325649632413501e-02   +5.297520383129999e-02   -1.361349979129118e-03   +1.019520716956001e-02   +2.295644061677031e-02   +5.186331923033841e-02   -1.263370771787263e-02   -4.443857576742331e-02];
L1E_L2E_iAMPA_netcon = [-6.211164873875086e-03   +1.353791958165532e-02   -3.462147228649382e-02   +2.535585548583392e-02   +2.859738032533028e-02   +6.360024385665276e-02   +1.296427500599759e-02   +3.025200840655730e-02   -5.201243346507976e-02   -9.971137065840475e-03   +8.888874484666776e-02   -5.047861661640032e-02   +2.912025995903725e-03   -4.349197423137208e-02   +3.562210802514518e-02   -5.025199264126328e-02; -2.901932398675827e-02   -3.705694462642127e-03   -7.908594038567980e-02   +9.221011163165042e-02   +5.727021609695437e-02   +1.775067472513290e-02   -1.889519937624238e-02   +8.274994381946251e-03   +5.743127505488889e-02   -5.891981976872031e-02   -3.873031982598340e-03   +8.879553103781721e-03   -1.954675505384284e-02   +8.792650357665296e-03   -4.022453857730319e-02   -3.504977508641896e-02; -1.637813582774531e-02   +6.193636461396191e-02   +9.002288727452067e-02   -4.246257183050245e-03   -8.793634037052621e-04   +8.727364696387279e-04   -1.055458530649998e-02   -2.897673862557168e-02   -3.833410181080953e-02   -1.727554821426812e-02   +4.152783243236825e-02   -2.579355356772964e-02   -4.136353569245212e-02   +9.935250964084436e-02   +2.572812257208908e-02   -4.164372342781218e-02; +2.343121463248531e-02   -4.934976951405893e-02   -5.867913281695961e-02   +2.765306070495021e-02   -2.094471684485355e-02   -6.535523812298401e-02   -3.058307219624919e-02   -6.228337663113546e-02   -1.670974737537157e-02   -2.748485661764996e-02   +1.503421989418929e-02   +9.270783878208231e-03   -1.109738315101953e-02   +8.014995455938242e-03   +2.263127730295827e-02   +7.532289621910539e-02; +1.034141562365227e-01   -7.715978770245578e-02   +5.176831046433027e-02   -2.430324160597267e-02   +1.276518787593998e-02   +1.323055476143113e-02   -3.845150845908130e-02   +2.573507445932757e-02   +1.182314904497958e-02   -5.894253816888122e-03   +1.687721037479022e-02   -2.612250910009111e-02   -4.846546929942729e-02   +2.789618821440174e-02   +1.274079213635879e-02   -6.106839820738355e-03; +5.897980312821334e-02   -9.322850144097726e-02   +6.482079094207397e-04   +6.808312739826872e-02   -3.285111114825146e-02   +7.220329677391048e-02   +1.643793669850355e-02   -1.949800912657113e-02   -1.297061354719489e-01   +5.641988047087376e-03   -4.957678719256398e-02   +8.688241298666881e-02   +7.404358366814337e-02   +5.161759130901133e-02   +5.803043064264589e-02   -9.185797622042823e-03; +1.365238978871757e-03   +3.819872472151618e-02   +7.369686782466377e-03   -2.005410524129145e-02   -7.190684886590022e-02   +1.803290337123443e-02   -1.353884077832726e-02   +7.812304025537874e-03   -1.785486141575915e-02   +1.662474898184898e-02   +4.459014186835347e-02   -4.590573921329571e-02   +4.804785380519236e-02   +3.431332892499690e-02   -5.757530919516315e-02   -5.569077318325619e-02; -3.735389208589487e-02   -4.335690123530093e-02   +1.756206674485144e-02   -1.700101804302068e-02   -4.327065730666164e-04   -1.851750370177201e-03   +1.492257030714139e-02   -9.557855017310237e-04   +2.419303432381720e-02   +1.959775403750414e-02   +2.284907344905475e-02   +4.363346938475070e-02   +6.024228243036926e-02   -2.967309599318763e-02   -5.558653838684711e-02   +5.054471100992500e-02];
L2I_L2E_iAMPA_netcon = [+7.787445925951629e-02   -7.808895665041417e-02   -4.658394153533509e-02   -3.037329214972811e-02   +7.205705619834503e-02   -2.474849952428312e-02   +1.270821934653649e-02   -5.419849919907282e-02; -3.904617315114333e-03   -4.506379379017821e-02   -6.869568605797419e-02   +9.768050468075283e-02   -1.372794145458659e-02   -1.392005101138160e-02   -3.384181046444766e-02   +5.147537193609370e-03; -5.386101151182679e-02   +1.756916400011749e-02   -4.603200794350444e-02   +4.559612481888917e-02   -3.712461437420014e-02   -1.482881783189782e-02   +4.056278782254632e-02   -7.247669317023719e-02; +7.759254024484687e-02   -1.254779199790377e-02   -4.641919103612125e-03   +5.232713256288823e-02   -9.106094929377957e-02   +4.783648747303144e-02   -3.243024751688416e-02   -3.530756594008499e-02; -5.626609733330889e-02   +7.390084485083098e-02   +1.750032498144437e-02   +6.184223877977829e-03   +3.639320293051570e-03   +6.828561316587291e-02   +7.462335307468923e-02   +7.227419685855473e-02; -2.484444595299607e-02   -4.257253278090056e-02   -5.043566118304834e-03   +7.312322391016728e-02   +5.795114733840639e-02   -9.959885169955201e-03   -1.381242235498003e-01   -2.924009906265568e-02; -2.003896342643380e-02   +1.764556063975134e-02   -1.576959499203988e-02   -1.393392488842672e-02   -5.961121754636960e-02   +5.773228410158962e-02   -2.902223879696436e-02   +1.284086366717066e-02; -3.644594300844902e-03   +7.968257897905191e-03   +1.810801051089948e-02   -2.821661207668714e-02   +5.704725364442126e-02   +2.857653629779622e-03   -3.061370415407711e-02   -2.904761040135803e-02];
L2E_L2I_iGABA_netcon = [+1.663258851298795e-02   -4.052809340375562e-02   +2.874075903747880e-02   +3.841740606867006e-03   +1.219277219873901e-02   -3.787487658136144e-02   +3.131504318904148e-02   -1.960137972171992e-02; +2.076620593649686e-02   -9.935016774852266e-02   +7.474437022508104e-02   +1.941815712488414e-02   +6.398555086531532e-02   -5.789240520024982e-02   -2.308942290403516e-02   +6.043281627972628e-02; -8.715789170491667e-02   +9.655466808592710e-02   -1.827587420091220e-02   +5.784525890482338e-02   +3.904578389636812e-02   -4.186746859186402e-02   +7.703674580503590e-02   -3.900357341351047e-02; +4.252895419900987e-02   +2.507749804151749e-02   +3.253770675410506e-02   -3.375127185677081e-02   +4.879701829970162e-02   -6.046019924861062e-02   +2.354603307237684e-02   +6.526696521859628e-03; -4.363542660908832e-02   +5.215953766247956e-03   -4.147160702672026e-02   +2.384610628885477e-02   -7.174039239038221e-02   -3.912594223871393e-02   +1.600920772379313e-02   -1.928913468047190e-02; +3.862218157615354e-02   -5.581487971429046e-02   +6.167983591172171e-02   +5.475555383385877e-02   -6.445533055252686e-03   +3.570200479161316e-02   -1.743833096151879e-02   +2.710745606764986e-02; +2.283785620919512e-02   +8.654843715459451e-03   -1.584651310909023e-02   +8.408726860779853e-02   +1.957546425409760e-02   +5.597490207378517e-02   +5.585679741866382e-02   +1.072422397453004e-02; -4.612111135809010e-02   +1.090912768269375e-01   +1.426056118799602e-03   +2.894445244791315e-02   -5.185850616654963e-02   -1.900407171700902e-02   -3.983891638724623e-02   -2.201799989060369e-02];
L3E_L2E_iAMPA_netcon = [-2.618782969517525e-02   -5.377845445608497e-03   +1.801464564235483e-02   -4.369698079509368e-03   +7.974450921687630e-02   -3.068663427670651e-02   -5.901137500156808e-02   -1.383778511699661e-02   -3.160460269947877e-02   -3.724223954817844e-02   +4.145924106222989e-02   +1.269301895343264e-02; -6.483491375987209e-02   +1.403382025378330e-02   +3.578260744111704e-02   -2.382350018227980e-02   +6.901457174926345e-02   -4.486877497910997e-02   -6.708500107984432e-03   -1.045630728160106e-02   +2.224710733711688e-02   -1.383679362550759e-02   -2.917949858421017e-02   -4.058635405374073e-02; +3.684943110768736e-02   -5.378630953666919e-02   -8.212790758160435e-02   +2.529237843963117e-02   +6.023826130011810e-02   +3.272563881464327e-02   -1.644454264821051e-02   -7.156052928805930e-02   -4.227481290164469e-02   -6.850845325815817e-02   -8.138614808688768e-02   -8.505934567424375e-04; -2.213592773943088e-03   -4.453772146338206e-02   +5.962913030633715e-02   +4.362250645645015e-04   +1.268424094448960e-02   +8.101631461385130e-02   +5.933314550037135e-02   +7.076553294512991e-02   -1.569199646962281e-02   +5.755437599322864e-02   +3.731385811281298e-03   +1.912170715981603e-02; +8.608939917724888e-02   +8.145735482122883e-02   -4.124364844468445e-02   +5.482967278155948e-03   -2.570589712529730e-03   -2.081279975918620e-02   -1.435262716764065e-02   -6.106158162480970e-03   +3.119670606347040e-02   +7.490840276598641e-02   -7.595458056954730e-03   -2.805602317129795e-04; -6.721279642972416e-02   +3.656596432116015e-02   +1.214201135850139e-02   +2.619192073433572e-02   -9.480613753911613e-03   +7.241650147680181e-02   +4.249772056860376e-02   +3.156496921957322e-03   +5.756764029364329e-02   +1.869143525291027e-02   +7.216683568494880e-02   -2.886383820134312e-02; -4.374132340283099e-02   -4.325427674304014e-02   -2.515509249068346e-02   -5.876428811446725e-02   +2.618878380090977e-02   -6.984815360389661e-03   +3.132459601878357e-02   +1.925580711357785e-02   -8.048683815673982e-03   +6.771685917642783e-02   +1.175025827736507e-02   +3.986981403076424e-02; -7.870342929447997e-02   -4.065547106574146e-02   -6.216197419345795e-02   +6.521422451343645e-02   +1.683249610532322e-02   -4.514899532728622e-02   +1.787910165616223e-02   +8.309367940714148e-02   +8.394857395009343e-03   +4.727174713031941e-02   +1.182095276519874e-02   -1.123741084883392e-01];
L3I_L2I_iGABA_netcon = [-2.828112634685829e-04   -3.556262467133375e-02   +6.405921326166406e-02   -5.889441866066850e-03   -5.718733781763889e-02   -1.250178125241421e-02   +4.531642156676607e-02   +2.058428982160598e-02   -2.163185907494149e-02   -8.939927131116226e-02   +1.860975569813028e-02   -5.965097248321285e-02; +2.142694305045022e-02   +4.634452288055983e-02   +2.705890701514284e-02   -4.017046969921917e-02   -2.725001179384678e-03   -3.970763893465812e-03   +1.911127147797298e-02   +1.295981573018802e-02   +4.135860150639586e-02   +5.776273045537483e-02   +6.449473905389431e-03   +1.523858658273380e-03; -1.479495489215293e-02   -1.176485169272797e-01   +5.572059950393489e-02   +5.911850235733145e-02   +2.245686610669028e-02   +1.614684016461023e-02   +3.663213172605532e-02   -2.146625951453080e-02   +3.797501994578201e-02   +9.857182658372954e-03   +3.703556097595338e-02   +2.780200502380538e-02; +1.876860818016033e-02   +9.308157075921890e-02   +3.043568760257692e-03   +1.275138369587508e-02   +8.912188520510690e-02   -5.869841037454317e-02   +2.550186316828777e-02   +2.325571515919132e-02   +1.627036455883909e-03   -4.756455051222004e-02   +3.505232727382184e-02   -3.204899217190855e-03; +4.777754832951099e-02   -2.386946560500876e-03   +2.072609803343270e-02   -1.454626376900684e-02   +2.405004932632717e-02   +5.975714748234658e-02   -1.994482687193462e-03   -2.102391298904727e-02   -4.456963201999178e-02   +2.946358163595690e-03   +2.421422918778691e-02   +3.524524770846612e-02; -1.941535608474716e-02   -3.858132574718613e-02   -2.135094479113939e-02   -2.599748030483749e-02   -5.153336183395012e-02   -8.317516064417405e-02   +1.494767380543508e-03   +4.229446108713285e-02   -7.887338747339008e-02   -1.272511291133472e-02   -2.389441429785883e-02   +4.221127094466876e-02; -3.717572656738588e-03   +2.009587901675543e-02   -4.515853017792774e-02   -3.090297851510155e-02   -8.622875132450274e-02   -2.863379201306511e-02   -3.065464249595926e-02   -2.140130343661021e-02   -2.924171151523177e-02   -3.855085889631629e-02   -2.723915395559591e-02   +2.837804333406596e-02; -5.264355040106999e-02   +4.548815225235849e-02   -2.717915955508280e-02   -1.152850201903185e-02   -6.669520014317045e-03   -2.337325058181772e-03   +4.444865641131963e-04   +7.383962539407694e-02   -8.896197783586438e-02   -3.547681599743966e-02   +7.154192240546949e-02   -2.378514286222595e-02];
L2E_L3E_iAMPA_netcon = [+1.310017571523905e-02   -3.403875799022894e-02   -5.853986061376951e-02   +1.652039198634625e-02   +7.064148824933419e-02   -1.867179229871531e-02   -7.395248175491245e-02   +5.744388339499661e-03; +9.539645836848711e-02   -8.948089592811868e-03   -5.999937579537373e-03   -2.537040584997078e-02   -2.384742437365197e-02   -5.803167165233546e-02   -3.226496917320076e-02   +1.042638542173480e-01; -5.259096660920258e-02   +5.375381044729577e-02   +4.333958131216784e-02   -2.213165636799273e-02   +3.467479413269980e-02   -8.404122500066811e-03   +2.215242990801827e-02   +1.011972715555558e-02; +9.269315543082328e-02   +5.159174168097128e-02   -3.057716496462479e-02   +3.987771751088191e-02   +3.132621035362106e-02   -3.504809057012791e-02   +1.603414327600458e-03   -1.450180021686274e-02; -4.590718816231252e-02   +4.242953217797425e-03   +1.711337707971487e-02   -2.233009558298409e-03   -4.695763267991326e-02   -5.087324850852185e-02   -1.061809614096627e-01   -2.985606741798903e-02; +5.025466775786132e-02   -4.657873118848650e-02   +7.790283301609014e-04   +6.631432640286644e-02   +2.508627317289023e-02   -4.570881011847913e-02   -4.749746069764266e-02   +3.565764208379502e-02; -1.294570462843966e-02   -4.037039793684309e-02   +3.301342291828850e-02   +9.132316082033046e-02   -9.134939691706728e-03   -1.323145657332728e-02   +3.981155018947604e-03   +2.361678238495906e-02; -2.982702870858930e-02   +1.461122813556326e-02   -2.083722590694696e-02   +3.044613194497493e-02   +3.988694960169889e-02   -3.273768927446347e-02   +1.961960911707071e-03   +1.346317009754921e-02; +6.444486257276152e-02   -6.283174137462932e-02   -1.271666928567650e-02   +9.496492183823596e-03   +5.928379311242563e-02   +1.960332047819313e-02   +1.099405430179998e-02   -1.271229525058791e-02; -4.999714052391158e-02   -9.596881113653455e-03   +4.736639176959744e-02   +4.316340465050897e-03   -4.907396682794825e-02   -2.472748645501253e-02   +1.666822114198762e-02   +4.838320069763889e-02; -5.766966149392266e-02   -3.177072436369253e-03   -9.274974963876426e-02   +4.225273195580335e-02   +5.268760767557737e-02   +4.489887210266228e-02   -3.133602866284491e-02   -1.461872438231686e-02; -1.075294244733391e-02   +1.126244060805031e-02   -2.273584714093867e-02   +4.896589990093213e-02   -5.452926806226084e-03   -1.743922512185596e-02   +1.081286503196780e-02   -1.033274614304510e-01];
L2I_L3I_iGABA_netcon = [-2.153540440554257e-02   +3.383532450580942e-02   +6.017370466361198e-02   -1.161709961391411e-01   -4.510044469319172e-02   -6.877966169234663e-03   +5.029122773606217e-02   -1.017795456211877e-02; -7.445844053559669e-02   +1.265171102696315e-02   -2.529780002979579e-02   +3.056497375306472e-02   -6.301159618920402e-02   -2.721789197579039e-02   +9.526811232324668e-02   -7.441887735077105e-03; +7.403578426689642e-02   -1.067285393266306e-02   -7.658573828681067e-02   -9.185163136639317e-02   -3.948822185227012e-03   +1.764791605262365e-02   +1.416506470976012e-02   +6.147977679423188e-02; -2.240396479678624e-02   +1.225640434882118e-02   -2.843030984721994e-02   -2.725260057814066e-02   +2.021699210075042e-02   -1.913374838643201e-02   -1.784488202396592e-03   -8.395812539994471e-02; -6.951264148248913e-02   +1.369142101468679e-02   -7.862111254764179e-02   +1.141533189563903e-02   +1.640927876119741e-02   +2.956874461537300e-02   -2.459086238352299e-02   +4.524026161951222e-03; +9.455164723656337e-03   -2.798734019974210e-02   -6.080828257389092e-02   -2.457274316900495e-02   +5.370165634176181e-02   +1.131955830523903e-01   +3.256330436683634e-02   -2.555061701298212e-02; -2.119663499140162e-03   +3.787201346718177e-02   +5.066947906659258e-02   -3.798097220540322e-02   +2.739665149456866e-02   -6.052099903039274e-02   +1.566091137644272e-02   +1.593766892556436e-02; +4.416013053990106e-03   +4.555316321589874e-02   -3.803539131034236e-02   +3.019634526312913e-02   -9.962777440340364e-03   +3.079862765836431e-02   -3.313430126201008e-02   -6.409838860873138e-02; +5.815452640332823e-02   +7.890277185534897e-02   -4.842717242370440e-02   +3.261471821962169e-02   +6.973134829578440e-03   -1.711503660178394e-02   +5.145951611501567e-02   -2.131597770346627e-02; -3.239270341012915e-03   -2.600427514056214e-02   -3.728458005972986e-03   -1.383821494138681e-02   +4.980788118454354e-05   -4.932634641952862e-02   -1.643462508277509e-02   -1.539051811693570e-02; -2.391593983948050e-02   -8.214372460290940e-03   +1.352028546109166e-02   +2.571548770227739e-02   +4.563577147756830e-02   +4.858309754107616e-02   -1.407988114294177e-02   +4.367650338354869e-03; -9.634525382580945e-02   +1.215606409245195e-01   -2.778759163049021e-04   +8.894567209094636e-02   +9.461325788575807e-03   -1.605811771651531e-02   +5.930401868169904e-03   -4.711708861232666e-02];
L3I_L3E_iAMPA_netcon = [+7.824060611108660e-02   -3.028360537679768e-02   +1.638271725586398e-01   +3.724506172435151e-02   -1.995257258532267e-03   +3.664363700852039e-02   -7.708776914426781e-02   +1.328677358086089e-02   -4.017294420687247e-02   +2.458697233076113e-02   -4.846954811273882e-03   +1.388912543142383e-02; -3.174111197723592e-02   -3.984220348523950e-02   +1.145249685680856e-01   -2.480590241068276e-03   -4.324924657810696e-03   -1.370023116330992e-01   +4.771252961822081e-02   +9.320303707463273e-02   +5.983984805991938e-02   +3.793903634453490e-02   -1.837323420044082e-02   +7.824039047616135e-03; +4.911743436633749e-02   -3.142908352558238e-02   -9.745043378753128e-02   +1.064467611843622e-02   +1.608403332764629e-02   +7.560269562338459e-03   +4.781138333186107e-03   +5.885762685549495e-02   +2.570372966729783e-02   -9.217778314182223e-02   -1.379903824611846e-02   +8.038876683107855e-02; +2.170607459989713e-02   +3.974382342677087e-02   +4.524836498647347e-02   -2.726341880505582e-02   -1.062277771268660e-03   +3.251104456926265e-02   -3.795023751909304e-02   +3.951171625848297e-03   +3.668702979414614e-02   -3.139886696112447e-03   -4.999462429755000e-02   +1.022521221431463e-01; +1.900033422074553e-02   -9.228688173927660e-02   -5.807070168590410e-02   -1.208981265996636e-01   +4.922679355153428e-03   -4.841122731924452e-02   +6.019748764320675e-02   +3.458468934810073e-02   -4.889448969773082e-02   -5.363105016915126e-02   -4.651820534087830e-03   +2.057959651076620e-03; -2.570901840995385e-03   +2.910022931185424e-02   +3.399953242667885e-02   +1.402483190498543e-02   -3.676647428770023e-02   +2.621056381595849e-02   -1.979524433427203e-02   +7.643296820054621e-03   -1.247217820630723e-02   +7.556948540547159e-02   +6.734111516777197e-02   -4.482431005009318e-03; +6.389996045743986e-02   -3.835756839066103e-02   -6.101245412542985e-02   +2.344197884030218e-02   +2.990170564670349e-02   +1.537604383291051e-02   +3.434928968376141e-02   +1.291855017662403e-02   +4.701245310624168e-03   -2.100234160307585e-02   +3.304237750011746e-02   +8.277228311617153e-02; -1.589333507772909e-02   -1.382541962615623e-02   +8.328721864021355e-02   +9.728056433519478e-03   +4.191824614653548e-02   +2.069640000164187e-02   +1.967584464171466e-02   +5.379829604409204e-02   +9.161890767498118e-03   +9.291614623495330e-03   +3.219343426696221e-02   -2.344754424069458e-04; +6.711197195208636e-02   -6.836327754693556e-03   +7.030261928844564e-02   -1.079853019355692e-01   -6.587420645566160e-03   +3.846662367597404e-02   +3.878402385465398e-02   +1.085013776889321e-02   -5.734059971456200e-02   -1.870471632925306e-02   -1.365273367992078e-02   -5.385430335363332e-02; +1.311802019179182e-02   -4.637843661824149e-02   -8.876142026920811e-02   +6.464444975239468e-02   -4.353501109112807e-02   -2.985041992529153e-02   -2.339792279756177e-02   -7.037274145169298e-03   +4.772263712680078e-02   +6.263809329501198e-02   +6.713427792210960e-02   -4.979404029240243e-02; +7.288036220132852e-03   +6.306173911373723e-02   -8.239703997013355e-02   -7.964327506960081e-02   +9.924944571580564e-02   -1.082889254895868e-01   -6.356785951241356e-02   +3.386597558872789e-02   +2.735673551198908e-02   -1.943781437966271e-02   +9.550085775031590e-02   +5.277632651713339e-02; -7.878683916293056e-02   +9.210394649732739e-02   -1.007035339943529e-02   +5.819636864728113e-02   +4.893799758755671e-02   -9.535089328759992e-02   +3.165533343877237e-02   -4.233124406721682e-02   -7.621817593595318e-02   +8.115028471744419e-02   +7.392336848184898e-02   +5.438957316395396e-03];
L3E_L3I_iGABA_netcon = [-5.121938063620561e-02   +7.225510861653378e-02   +5.386041997412540e-02   -7.326898103506615e-04   -4.895030492090360e-02   -3.538936362545561e-02   +6.554831620372946e-02   +3.255671725577181e-03   -4.285860373889279e-02   -4.241159445387203e-02   -2.827255803229316e-02   +4.531708902534627e-03; +9.090592239939408e-03   +2.551797105809986e-02   -1.283925430721770e-02   +1.918536995777488e-02   +6.546349697777931e-02   +6.320136975213516e-03   -2.065650009765437e-02   +1.660824823396827e-02   -5.382590311279647e-02   -7.601068585490130e-02   +1.207351976422167e-01   -3.479731608711883e-02; -1.763182663692507e-02   +2.647953331596572e-02   +5.360709384740774e-02   +4.039564055611670e-02   +3.331013231583337e-02   -2.665496073038398e-02   +1.381071077110265e-02   -2.719678128526356e-02   -4.887638784853710e-02   -4.393334926482846e-02   -9.555491854435058e-04   +9.380385756927725e-03; -2.271724478100334e-02   -5.247232027222513e-02   -3.462142451054195e-02   +1.154568148651290e-02   +3.561558108401103e-02   +3.574717972352781e-02   -1.083651832444663e-02   +2.293974836409414e-02   +6.009909804162818e-02   +3.464430278893638e-03   -3.296182401301054e-02   +9.859216913757709e-03; +4.006169105016605e-02   -6.946903641284465e-02   -5.563274199937192e-03   +1.860327340566884e-03   +2.150454650579790e-02   -5.720448400877770e-04   -8.943464352225221e-03   -8.428326558113144e-02   +4.007210132140702e-02   +2.502527924051793e-02   -1.698590995625563e-02   +5.904660497221194e-02; -7.436397777608557e-04   -1.402471166200644e-02   +5.666554932009014e-02   -1.705979375189176e-02   +5.703589554854484e-02   -1.878363137037904e-02   -5.230800557583518e-02   -2.932127169756765e-02   -3.562507769174444e-02   -1.235398728616407e-02   -8.364329126532749e-02   +1.702491221952436e-02; -1.042448695403681e-01   -9.726688309068402e-03   +6.188506139024945e-02   -8.895589618892800e-02   +1.213962823973654e-02   -5.932447282186391e-02   -2.113262888866981e-02   -3.193185182358405e-02   +3.180631313322086e-02   +1.261210855510519e-01   -3.829273457910812e-02   -3.469258204787809e-02; -1.114901241817887e-02   +3.118556107757102e-02   -6.768068960822857e-02   -5.266553487697546e-02   -3.397342547405399e-02   +1.390597945366322e-03   +1.453388539578136e-02   +7.726872539051782e-02   +7.078753166524657e-03   +4.766361501123315e-02   -2.795135674670880e-02   -2.178898762259883e-02; -5.080975321708144e-02   +7.587241557783918e-02   +6.788603922197381e-02   -2.661968186657339e-02   -5.758340217330780e-02   -1.011537249880049e-01   -5.093120170484511e-02   +3.313506560835353e-02   +7.021906598760512e-02   -3.100803251650068e-04   +7.038767434279321e-02   +1.383617330065617e-02; +1.210068774084777e-02   -6.328913214855802e-02   +3.878843640873035e-04   -9.403924537686403e-03   +8.374906958379592e-02   -2.603200057050312e-02   -2.659220726488144e-02   -1.956290692800756e-02   +1.291530799674300e-02   +1.817527575317358e-02   -1.315043324608825e-02   -6.423872513008053e-02; +6.067074804972925e-02   +3.621484647359242e-02   -6.871673599764978e-02   +5.659372698815644e-02   -2.697982672779267e-02   +1.043806649985584e-01   +5.083200264631043e-02   -2.749380076871642e-02   +3.869862067223608e-02   -2.571840302907913e-02   +1.600686985950998e-03   +1.087040609174607e-02; -4.463341073931586e-03   -7.575532017468669e-03   +3.895754147516034e-02   -1.179185330339876e-02   +7.130748966010951e-02   -2.474207722235113e-02   +6.902969178845672e-03   +9.290393632075575e-02   -6.662688998769690e-03   +7.052213676346314e-02   -6.542876814935058e-03   -5.336664625625395e-02];
L2E_Input1_iAMPA_netcon = [+4.310308701766701e-04   +5.039272158657627e-03   +3.503216519872928e-02   -6.493852203621529e-02   +3.913771694374697e-02   -3.206743018609723e-02   +8.622033081322941e-02   +2.602249651936001e-02];
L2I_Input2_iAMPA_netcon = [-7.513064946065162e-02   -3.231428206979358e-02   -2.696207373426928e-02   -1.104149407825088e-01   +8.307713749244723e-02   -4.810672495622003e-03   +6.707542689862092e-02   -4.384527830651212e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
