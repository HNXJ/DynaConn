function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.649857897711552e-02   -1.542692627858351e-01   -4.229269568655326e-01   +7.675225441917458e-02   +4.727876322752449e-02   +1.677039310325554e-01   -1.769426503733094e-01   -2.404654548159164e-01   -2.123087909237346e-01   +4.655838593429817e-01   -2.095805056035662e-01   +2.312848978927894e-01   -1.224936801529271e-01   +1.667825309449416e-01   -2.918385751092224e-01   -8.792719162897138e-02; -8.886584938937937e-02   -5.048855095762045e-01   -4.205290901506518e-02   -3.196814117573631e-01   +1.386612053820915e-01   -2.259524750646636e-01   +3.925857353244400e-01   -1.039053991983998e-01   -9.140923527940908e-03   -1.238735283267767e-02   -4.229933638903411e-01   -3.722782051249343e-01   +3.948706699328377e-02   -2.271929742650440e-01   +1.350208852666656e-02   -1.524381041706387e-01; -6.167238630691779e-02   -9.037124631497570e-02   -1.464407528911665e-02   -1.043214715549265e-01   -7.756257855131637e-02   +8.041730249816317e-02   -1.195977729600914e-01   +1.361232423293467e-02   -4.214176367168726e-03   +1.232243513121133e-01   +2.183621036558397e-01   -2.107201859683793e-01   -9.921121669656227e-02   -3.621719484287927e-02   +5.080018390920460e-02   +1.450499229970795e-02; +1.401480629006757e-01   +2.146115729171917e-01   +6.136950168538531e-02   -1.859303509791679e-01   +3.288195239333041e-01   +1.600518153109179e-01   +9.811301641687094e-02   -1.087461680040676e-01   +1.704812442625428e-01   +4.280486377028129e-01   +1.449500838052222e-01   -1.450237515437724e-01   +2.548035138485918e-01   +2.854162211524511e-01   -3.974539069073582e-02   +1.431322324734412e-01; -1.406900674078279e-01   +1.741688486846871e-02   +4.022693943650100e-01   -3.703215399419336e-01   +2.449163234621041e-01   -2.449533493585622e-01   +1.940428905270756e-01   -1.422848212419345e-01   -7.783780267922523e-02   +6.006851408761403e-02   -1.639877221079798e-02   -6.133448838762143e-02   -1.855960031507381e-01   +7.395824820266425e-02   +1.674578118943684e-02   +2.148689287509866e-01; -1.000193440606989e-01   +2.274501140199472e-02   +3.527342619211485e-01   -1.439197124447524e-01   -1.162078503203343e-01   -1.523905789500214e-01   -1.961714483405927e-01   +1.660721193821071e-01   +9.769178337457284e-02   -3.173190966199737e-01   +3.588221818714272e-01   -3.957268991785593e-01   -4.119964371111257e-01   -2.272281325051295e-02   +1.928522315669234e-02   +8.489138188394729e-02; -9.689999366075668e-02   -2.042385374254513e-01   -1.540259373488752e-02   +2.021449105123999e-01   -3.411041768495535e-01   +3.476003445130660e-01   +4.827960493777260e-01   -4.194491779662997e-02   +1.790470745041985e-01   -5.496563557811026e-02   +2.513198354074809e-01   +2.886282527944624e-01   +1.482358675682623e-01   +1.704110929765589e-01   +2.047590721509096e-01   -7.695778622612803e-02; -1.626815755575195e-01   +1.115150815497847e-01   -2.853885724386207e-01   -6.560768165167907e-02   -1.774584936017055e-01   +1.303903228843791e-02   +6.377269019944451e-02   +1.573920136101237e-01   +1.532659775145827e-01   -2.220565382269787e-01   +7.772652980138850e-03   +6.032311652974316e-02   -1.159922194145405e-01   -4.326378154659054e-01   +2.010019061848153e-01   -5.921365509592355e-02; -3.696077879570580e-01   -1.049575482921241e-01   +3.879344797358136e-01   +2.196971056634601e-01   +1.210349631798040e-01   -2.813589698249756e-01   -8.343273067094203e-03   +2.173578489068045e-01   -3.987929666523971e-02   +2.740804145729812e-02   -3.896927950107489e-02   -1.850872874370690e-03   +8.300427408785219e-02   +7.212181847649207e-02   +1.509902171179307e-01   -2.131210338831211e-01; +1.045913549621306e-01   -3.995757281997586e-02   +2.279967007050678e-01   -1.533216927153087e-01   +3.650817378325505e-01   +8.405390877533064e-02   -2.283914839362444e-01   -2.105556445159524e-01   +1.024467932617112e-01   -2.354180724021659e-02   +2.267491931370921e-02   +2.451879602553658e-01   -3.239223589138061e-01   -2.548246196797889e-01   +1.391445418923463e-01   -2.368760023290002e-01; +9.730235841368264e-02   -7.942921915220624e-02   -1.296015376344713e-01   +8.659750892366837e-02   -1.184238178406220e-02   -8.431939955937218e-03   +3.246706000376565e-02   +1.401099417683082e-01   +1.311282015819665e-01   +2.169976474987150e-01   +2.547053966549603e-01   -1.774935738335419e-01   -5.405603885617422e-03   +2.871179138469822e-01   +1.183187661373325e-01   -3.300102943285393e-02; -6.092028371965501e-02   +6.648484621912659e-02   -1.893675494029784e-01   +3.632675874688991e-01   -1.255949327582898e-01   +8.616498679875023e-02   +4.176359913552027e-01   -1.056075717426674e-01   +1.136972379472484e-01   -2.138369850683816e-01   -2.594928748121918e-01   -2.438802929352827e-01   -2.491260391370020e-01   +5.171442010381488e-02   -8.374366688374053e-03   -2.058675353517904e-01; +5.563184443855167e-02   -2.050476148124226e-01   -2.882621337236140e-01   -6.868630318971174e-02   +1.515641207828442e-01   +1.633548078183002e-01   -1.674674639904647e-01   +2.351069426940987e-01   +3.933732108747827e-02   +4.602488046301669e-01   -3.190301810293544e-02   -2.017379574728385e-01   +1.051754212526139e-01   +1.806944774201283e-02   +1.021054140323630e-01   -4.441938067421400e-01; +4.227909339459076e-01   +1.115182049656219e-02   -8.070521848767281e-02   +1.749728085221513e-01   +1.589808685331747e-01   +1.734473979153415e-01   +1.466102461861260e-01   -7.360534706642866e-02   -2.496385630357190e-01   -1.211230259572271e-02   +9.328202146215718e-02   +1.765601454662767e-01   -3.135880696752534e-02   -2.386389356458889e-01   +1.556252046416781e-02   -3.480082122119214e-02; -3.746405123308058e-01   -1.152131673366147e-02   -1.340685140345914e-01   -4.644001658165145e-02   -9.509293994275195e-02   -7.614368712192188e-02   -1.635781984079335e-01   +2.433230898702325e-01   +3.687988602152165e-01   +8.017781063124524e-02   -7.848191345113781e-02   +5.667874342098216e-02   +7.295886612097320e-02   -4.039692808831609e-01   +2.994417830011742e-01   -1.695651056821302e-01; -9.238543914454056e-03   -9.423483517021833e-02   +4.710171786179800e-02   +2.488528828325091e-01   -1.818405373781265e-01   -2.396895176775293e-01   +3.763517508430718e-02   -3.965019001181307e-01   -2.934765225173130e-02   +1.449273314901750e-01   -1.909073952444219e-01   +4.225592925029058e-01   +1.851207242145801e-01   +1.057591368209067e-01   +1.579770243688917e-01   +1.428901421300769e-01];
L1E_L1I_iGABA_netcon = [-2.040103314635023e-01   +1.741836151084779e-01   +6.178592467013055e-02   -2.415752670795636e-01   -2.868745269197160e-01   -4.195924825708878e-01   +5.077005345668170e-03   -2.576479726483786e-01   +2.290095585976694e-01   -2.269707629608491e-01   -3.381797281076588e-01   +1.280504732031340e-01   -2.870229174885577e-01   +1.384713970174821e-01   +2.488216844201123e-01   +2.633822539180213e-02; -2.954565207475388e-01   -4.083273660674985e-03   +6.936920027632829e-02   +1.950902688271014e-01   +2.247802986849783e-01   -4.496537762297184e-02   +4.261756147359065e-01   +3.403010132857257e-01   -9.586889396689053e-04   +2.014752907197274e-03   -1.851168458196378e-01   +1.251800413385806e-02   -1.928406156465173e-01   +1.013177592095960e-03   +4.033507432155354e-01   +3.214142269903985e-01; -9.959012065798294e-02   +6.377370268755203e-02   +2.706006473998663e-01   +2.096610678321975e-01   +9.239031472263459e-06   -7.513686955805066e-02   -3.061457238394562e-01   -1.836234681114338e-01   -1.079790554723792e-03   -6.763477477961868e-02   -3.832359094228228e-02   +1.410564423559058e-01   +1.411619834718324e-01   -3.198890213754108e-02   -2.831184782292404e-01   -2.972291213981861e-01; +1.277406379880265e-01   -2.080625436386467e-02   +2.745866527474358e-02   -2.888602171131452e-01   -9.997763783434882e-02   -2.536453921533184e-02   -6.694533932118996e-02   -3.912784769324236e-01   -3.656277897449337e-03   +9.715524346427400e-02   -2.393687887217495e-01   +2.490309394285325e-01   -2.435034307117390e-01   -3.711379877921434e-01   -1.811342617567314e-01   +2.051577585268394e-01; +2.875516276242881e-01   +1.971994975544407e-02   -3.522524470178864e-01   +6.262441038468052e-02   -6.109977590427612e-02   -1.430530596027213e-01   -1.559922178769001e-01   +3.403065147860964e-01   +1.643758746715102e-01   +3.785545536581789e-02   -2.369150199237524e-02   +2.520742630568213e-01   -4.090619314713770e-02   +3.755480968098051e-01   -4.922396657921926e-02   -2.338209770768619e-01; -2.506741483000434e-01   +1.339193004722239e-01   -1.626810511066109e-01   +1.141308470308272e-01   -8.669330345102710e-02   +2.276423071855044e-02   -1.994280600074703e-01   -1.350828509144283e-01   -3.013851591319536e-01   +4.919372651098200e-02   -5.606947534897344e-02   +6.923418089582298e-02   +2.086891663139557e-01   +2.102587488878977e-01   +3.120989840708236e-01   -2.283289480598380e-01; +2.120299088198577e-01   +2.255588483432110e-01   -3.442660068940767e-02   -1.759085558578955e-01   +6.174318836514007e-02   +2.404130126165337e-01   +1.986751379246819e-01   +5.668873355332783e-02   -2.109284387902210e-01   +1.099452718495668e-01   +1.771590503036931e-01   +1.803766957980345e-01   +7.073365266543186e-02   -3.187826337091338e-01   -1.582929887012210e-01   -5.626198600603151e-02; -5.451212851726504e-02   +2.378500224713394e-01   -3.219197088048181e-02   -1.767990848628186e-01   -8.866728267554150e-02   -1.757574810742756e-01   -2.019081731826043e-01   +2.430292966937065e-01   +6.040393445380104e-02   +2.359326679861237e-01   +3.122004642331017e-01   +1.033250604489963e-01   -1.376394626488092e-02   -7.080675947601311e-03   +5.736546020772840e-02   +1.567666499173848e-01; +1.878009768922985e-01   -4.596388102666569e-01   -5.039616863018392e-02   +3.654244462217887e-01   +1.467987304328411e-02   +1.424303093166555e-01   -1.987199193071031e-01   -2.775364061509826e-01   -3.047216619034044e-01   -1.104184754928023e-02   +1.091849567389598e-01   -2.257703531917093e-03   +3.262761128097991e-01   -2.259311986409757e-02   -1.251663793555383e-01   +3.366481023325925e-02; +2.180211979427164e-01   +5.195170714638236e-02   +3.911743657236030e-01   -1.419473529502714e-01   +3.085223066661881e-01   +1.321637835880264e-01   +1.171119621268558e-01   +2.827093115897378e-01   -1.382284748918531e-01   -1.913188923137140e-01   +7.389634097761361e-02   -1.707798871930214e-01   +4.038119343104091e-02   +1.118533425529975e-01   -2.699206520680754e-01   -1.427198276642477e-01; -1.798957054872793e-01   -4.535422220053207e-01   +2.986915294820798e-01   +1.432997019971442e-02   +3.568108124791550e-01   +2.198700525297447e-01   +1.045518380520480e-01   -1.284260258932738e-01   +2.666397304001705e-01   -2.783096167164174e-01   +2.438649693131564e-01   +2.423060286707808e-01   -1.066206094551364e-01   +8.892386101135047e-03   +1.512971627448229e-02   -2.120556611112079e-01; -2.712926520960245e-01   +2.150266406390225e-02   -2.167316460544034e-01   -1.393276210162848e-01   -3.080060396835100e-01   +3.523322624066186e-01   -3.552714063480950e-01   +1.846357777723118e-01   +2.622207983862499e-01   +1.965255477886108e-02   +7.273386415246087e-02   -2.125281767172033e-01   -5.037681860191804e-02   -7.885667255270874e-02   +6.226494098643016e-02   +1.876419909803200e-01; -2.418368096087648e-01   -5.199920359393001e-02   +6.827831409511462e-02   -1.682615265313646e-01   +1.206620283738559e-01   +2.862088813531770e-01   +5.874606499878268e-02   -5.076663676363745e-01   +2.725259336434568e-01   +7.345889781583284e-02   +1.466202273804224e-01   +2.487670890314342e-01   -3.113411407277057e-02   -1.765723774407928e-01   +4.342807429313640e-01   +1.589869226438539e-02; -1.973006247653167e-01   -3.829608200502377e-04   +5.086519398256115e-02   -2.298776602491605e-01   +1.676558085770837e-01   +3.624190998622885e-02   +2.819091659137147e-01   +2.035444199763763e-01   -3.071563895981843e-01   +1.530074085437629e-01   +1.083537891656088e-01   -4.549663257062096e-01   +1.046568131990991e-01   +1.029321670821512e-01   +2.051837840443856e-02   +1.300983751818196e-01; +7.291394654557656e-02   -2.291693473060293e-02   -5.698644341975276e-02   -1.182857356331070e-01   -1.016776347276222e-01   +1.949262086177505e-01   -1.753237383954827e-02   -2.838809039252480e-01   -1.395258838389576e-02   -2.678576202302737e-01   -2.008241378930593e-01   -1.928587274200487e-02   +2.018834783742316e-01   -2.053290813409314e-01   +9.510926056235466e-02   -7.141941709701141e-02; -1.860314255497343e-01   +1.771912025611275e-01   +8.147302679366249e-02   +3.452362323466536e-01   +1.316207630607804e-01   -6.366221670298666e-02   +2.074431083648113e-01   +3.134852011173536e-02   +3.187621498864852e-02   -2.078697513766050e-01   -1.667374705093072e-01   +4.144264723699241e-01   -4.869292524143165e-02   -5.450150580580868e-02   +3.822303240316076e-01   -1.446672855218359e-01];
L2I_L1I_iGABA_netcon = [-1.497338021466600e-01   +3.475700741241719e-02   -9.647203494175971e-03   +1.431240440569059e-01   -1.694040167877459e-02   -2.638285111435552e-01   +1.164054338690087e-01   +4.693411684499993e-03; +2.129589957069501e-01   +1.896202478403631e-01   -1.867953832605335e-01   -8.600952064469891e-02   -2.566635107765143e-01   -1.907928915215446e-01   +9.604265427838676e-02   -1.372514137897048e-01; +2.457553117242911e-03   +1.369702899576903e-01   -4.019980555668795e-01   +7.144257322677050e-02   +1.394128147352993e-01   +8.361150857585443e-02   +1.328514536771169e-01   -2.059091643652687e-01; +5.379380688698671e-02   +6.113625020942982e-02   -7.800656307371742e-03   -2.646598771691046e-01   -1.551432624108453e-01   +1.616235349453904e-01   +1.291659658901513e-01   -1.217785626689971e-01; -1.862934626305036e-01   -1.947894127138289e-02   -4.853235333333825e-02   +8.270468268350778e-02   +1.789578456320422e-02   -5.533284376927888e-02   -3.897493413786118e-03   -5.604175307492124e-02; +2.327906216382033e-01   -1.382735407195535e-01   +3.224836122844711e-01   +3.944235760687012e-02   -2.975957456092685e-01   -5.440211561541963e-02   +2.286806748506690e-01   +2.972404403737252e-01; +4.127990850343674e-01   +9.084777211263440e-03   +2.320131840244481e-02   -9.707827740417850e-02   +2.374403747768452e-01   +2.453183859741164e-01   -2.085638938864988e-01   -2.358969399288452e-01; -5.239109374392627e-02   +2.061152670673115e-02   +1.688218680886915e-02   +1.860154301814541e-01   -1.602762496031453e-01   -1.200286848042298e-01   +4.229906173014029e-01   +3.310624703627051e-02; +4.494405423239981e-01   -1.353303744286672e-01   +4.603194562380420e-01   -9.316219195000416e-02   +7.466124873237652e-02   -2.637822278686529e-02   +1.910769824037149e-01   -2.980397688894765e-02; -2.302261286444759e-01   -2.817114217612136e-02   +2.244320287397964e-01   +3.730654431414540e-02   -2.201575522861325e-01   +3.030433107787013e-02   +1.153242475502183e-01   +4.707603197500381e-01; +4.386148266169188e-01   +2.264563029384947e-01   +1.806134201114168e-01   +9.606765943979406e-02   -2.248753326373745e-01   +1.729990605806905e-01   +1.235584114581525e-01   +2.417463708044148e-01; +2.782646605418094e-02   +3.468324974743448e-01   +6.621341830440697e-02   +3.301949449001095e-01   -6.042129960872421e-02   +7.566626400556820e-02   +3.881573781235581e-01   -7.104315842127212e-02; +2.787930859225055e-01   +1.380847295643747e-02   +6.647128535594304e-02   -4.806486562281423e-02   -1.300832149194178e-01   +2.484845356515820e-01   -1.334390697528080e-01   -8.922457446942222e-02; +1.928634297670521e-01   -4.007188807485640e-01   -4.539937692316359e-01   -1.616094104600029e-01   -1.849580314611436e-01   -2.184992909301014e-01   -3.372252993434506e-01   -1.051388973053675e-01; -8.925578600150130e-02   -4.796420518566593e-01   +2.267535183109469e-01   +3.330070546640496e-01   -9.899406188358462e-02   -1.278741649955419e-01   +2.837511408169512e-01   -1.031503479487734e-01; -3.116884696011633e-01   +2.826242557200129e-01   +3.356171533230323e-02   +7.435622687056793e-02   -4.084607247988846e-02   +1.021388901922661e-01   +1.599969878851446e-01   -7.021940068877454e-02];
L1I_L2I_iGABA_netcon = [+9.482401147468641e-02   -9.027173210939182e-02   -2.008976482113121e-01   -1.907768622408917e-01   +3.220221596172954e-01   +9.502239066956703e-03   +3.497926162558455e-01   -1.511606914612832e-01   -2.056632090320024e-01   -1.319033492968316e-01   +2.530523801676142e-02   -3.259034424141498e-01   +1.832756382177665e-01   +9.937869859604902e-02   +1.310978605411394e-01   -2.028607930985350e-03; -6.752753548987836e-02   -5.953020107929884e-03   +1.994628828316857e-01   +1.317772505660235e-01   +7.572601648151749e-02   -1.039410221560102e-01   -2.551605430898236e-01   -1.904932120721325e-02   -1.947943001945547e-01   +1.926384605979575e-03   -4.189289241930076e-02   -1.458771069143591e-01   +1.987342254660752e-02   +2.591765225756650e-01   +2.582806965591411e-02   +2.428612848519391e-01; +8.463172683055900e-02   -3.427391465016177e-01   -1.023078844238931e-01   -3.279984173932592e-01   -6.384626831147699e-02   -1.331049126697253e-01   +3.813277058616373e-02   +6.771860325772813e-02   -9.257129636837261e-02   -5.186824310484138e-02   +9.498356213867841e-02   -2.146452931197657e-01   -2.599013107581413e-01   +1.260012223286570e-01   +1.343680134980337e-01   +1.579007283942986e-01; +2.187197805573705e-01   -2.457069551593046e-01   +2.229899864725061e-01   -5.808246746167395e-03   -2.253910562678699e-01   -2.883979090319681e-02   -4.268660481670439e-02   +2.611442140362102e-01   +1.771952198044044e-01   +2.138814307919444e-01   -1.786951993195796e-01   -7.457673025386247e-02   -4.221422823168376e-02   +9.356209413080938e-02   +1.522166355218963e-01   -3.169649984546870e-01; +4.946874747205601e-01   -2.342408072042709e-01   +8.940231204082350e-02   +8.298630757954908e-02   -2.532131750179746e-02   -1.637621846406368e-01   +4.459343270979342e-02   +1.681991368529960e-01   -3.768037865005212e-01   -1.691067939986247e-01   +1.451618258755706e-01   -1.803474820014514e-02   -4.301880436347843e-01   -4.593674303755415e-01   -2.820969128723992e-01   +2.275187830478468e-01; -4.634233518110699e-01   +1.550267176555963e-01   -4.421684504486628e-01   +1.638192110924201e-01   -8.433861342987491e-02   -1.054022634146305e-01   -2.384482482597913e-01   +2.390416677461803e-01   +5.684039310790749e-02   -4.574828017130822e-02   -1.686092914413070e-03   -1.201359465930121e-02   -4.452971386412108e-02   -1.515384061902711e-01   -1.381669571370747e-01   +2.490102349011827e-01; -1.171512411903463e-01   -2.215152017676098e-01   +2.823541646474334e-02   +2.699699048109328e-01   -1.900658239769411e-01   +3.196191402207432e-02   +7.163980870115284e-02   -2.320685920253432e-02   -1.843960071872066e-01   +3.996682836062795e-01   +1.587570677716781e-01   +1.900037954191153e-01   +2.703864184414074e-01   -2.579731953571276e-01   -1.562128966923929e-01   -1.505444141159798e-01; -7.526193469939819e-02   -5.745940379146430e-01   -4.527700911522699e-01   +3.027998370281838e-01   -7.796711102886789e-02   -3.624277265602611e-02   -8.923089612323842e-02   -4.967325165090798e-02   +5.680252175128926e-02   +3.038223771371845e-02   +5.507706431131298e-03   +1.496406138565870e-01   -4.518587344114716e-02   +4.915049235258602e-02   +2.106539872234922e-01   +3.922648504114289e-02];
L2E_L1E_iAMPA_netcon = [+3.859373904545103e-01   +5.626035549879060e-03   -4.620783623724688e-01   -8.106336290844918e-02   -9.010144291558575e-02   -2.110142710385899e-01   -1.769603764881020e-01   -1.816337066957489e-01; +2.240584383327734e-01   +8.837122819995691e-02   +1.486669035334875e-02   -4.600150072682866e-02   -1.046749531003659e-01   +1.237262769563635e-01   -7.624211029315617e-02   -9.546518141838192e-02; +9.931047902807630e-02   +1.203463104407620e-01   -2.922971980478415e-01   +4.127143832437907e-02   +7.113442325286579e-02   +9.961254049076490e-02   +2.879406739775078e-02   +7.520325315842563e-02; -8.657955994225075e-02   +4.996629166899363e-02   -2.203648737892576e-01   +1.415796999304075e-01   +2.490474726910485e-01   -3.488515873535086e-01   -1.400784056324468e-01   -1.059914950776474e-02; -4.477433903770913e-02   -1.171599310731113e-01   -1.562847545256296e-01   -3.056194204728395e-01   -1.525404041004363e-02   +1.271967520708713e-01   +1.620288895176988e-01   -1.236222628650661e-01; -7.944245009359474e-02   +2.124252002907974e-01   +3.138156840687935e-01   -7.634945273172529e-02   -1.908992885482033e-02   +8.983106341380206e-02   +2.037731608396029e-01   -3.003169529325377e-01; -3.643902260651852e-03   +1.624622291973507e-01   -3.504943173776636e-01   -3.988004034985698e-01   -5.547886695514295e-02   +6.958270706349612e-02   -2.418898708005739e-01   +1.129644571307225e-01; +1.992252345452095e-01   -3.109089385123493e-01   +4.885320072970206e-01   -6.157567962526650e-02   +1.167316033593832e-02   +1.108151395029332e-02   -5.829841995247018e-02   +1.007042241799063e-01; -1.836683700184474e-01   +1.373989835923593e-01   -1.150523548422027e-01   -1.420466898331264e-01   -6.326768470695254e-02   +3.660190974783618e-01   -1.330853680064663e-01   -2.285500371636208e-01; -1.232566063629071e-01   -1.064234433229316e-01   +3.333428337902760e-01   -4.533503466666212e-02   +1.675178690918119e-01   -1.762034584889050e-03   -1.671305352975499e-01   +1.034831398349734e-01; +3.586248406021216e-01   +4.747365639628584e-02   -9.626386449690588e-02   -6.637698889144908e-02   +2.173282767230741e-01   +8.071913191944369e-02   +1.810186404576620e-01   -2.985646134642726e-01; +5.179531925725135e-01   -3.691463342402599e-01   +9.254309334585281e-02   +1.644058194929164e-01   +1.152791296733640e-01   -1.885676769212199e-01   -1.508611343899776e-01   +3.757570241698666e-01; +6.466574371964247e-02   -2.386476908813581e-01   +5.631907406887220e-02   -1.486020058899323e-01   +2.099664527777870e-01   +1.282253306706314e-01   -8.013432586033079e-02   -3.106890746896080e-01; -2.485594901479229e-01   -2.231054062613790e-01   -1.916952613421513e-01   -1.739107773501835e-01   +1.598314268147959e-01   -1.333477994359852e-01   +1.453028119089362e-01   -2.804617246576706e-01; -2.166574937825672e-01   -3.572134317494046e-01   +1.078731135767372e-01   +4.787622760670516e-02   -3.508486397541396e-01   -1.513573860735619e-01   -3.196272633674176e-01   +2.095479181786223e-01; -3.420791422122424e-01   -1.416812846772359e-01   -2.919701501110135e-01   +1.997973810268048e-01   -1.233350421767618e-01   +2.409346201586134e-01   +3.593841024174251e-01   -7.475841678410733e-02];
L1E_L2E_iAMPA_netcon = [+1.593220532891584e-01   -2.382273599512978e-01   +3.361241121298595e-01   +1.629377837309859e-02   +3.200240464903881e-01   -3.150231147723056e-01   -8.915214386089249e-03   -1.829467038890251e-03   +4.345057824929268e-01   +1.124478339174689e-01   +1.363796837718639e-01   -2.456638515566869e-01   +3.022199315949918e-01   -3.053650364587143e-01   +3.217804442837119e-03   +1.867753292974794e-01; -4.810103597286274e-02   -1.474108127701305e-01   +1.184758718705567e-01   +7.047210851355976e-02   +1.577143549191029e-01   +2.787408159295168e-01   +3.933496517832778e-02   -1.107362612514361e-01   +1.664754176336968e-01   -6.539252626722700e-02   -8.318533475754310e-02   +2.109290904372682e-01   +3.889040646141519e-03   +8.511824347568003e-03   +1.911797709837230e-01   -2.667401466092144e-01; +8.452217595650832e-03   +7.980586133811408e-02   +3.013427918407016e-01   +5.957618120850597e-02   +1.409714954575229e-01   +1.880865415975798e-01   -8.824310621482931e-02   +1.132103126211944e-01   +4.100565713014008e-01   +1.476138511614347e-01   +2.615056603830275e-01   -1.198553908836045e-01   -1.140241661034665e-01   -5.283876410358720e-01   -1.135274106664333e-01   +2.728051297701792e-02; +2.631337410077772e-01   -1.609849672131148e-01   -3.199799392082593e-02   +3.797838205556608e-01   -1.770364563564497e-03   +1.886057321787337e-01   +3.738464776440820e-02   +3.172209551413372e-01   -3.752400188186444e-01   +4.045700807257832e-01   -4.822276562283095e-03   -3.223787952533996e-02   -3.996852119736016e-01   -5.035683518846508e-01   -6.023654327364021e-02   -6.743233785426461e-03; -1.564135979396144e-01   +9.769305823907100e-02   +2.283104946758260e-01   +4.782953650976404e-01   -2.215419812637966e-01   -7.982076978538311e-02   +1.059635616071213e-01   +3.388705147443002e-01   -9.945360859647603e-02   -2.173766958314671e-01   -2.063581408695752e-01   -1.808876908484285e-01   +2.379055433169767e-01   +2.371152596200051e-01   +2.524313428458255e-01   +1.416777673998411e-01; -4.280165205243523e-01   +1.141685517512317e-01   +2.796786806313102e-02   +1.131597661168966e-01   -1.223115680365466e-01   -7.767365379959923e-03   +2.921036062550041e-02   -3.173874859114772e-02   +3.824662810405803e-01   +9.098909955103707e-02   +1.027949408043249e-01   -1.543627414674317e-01   +2.654269201404195e-02   -6.182668841688549e-02   +3.069909366503821e-01   +3.273208555923270e-01; -4.772819044896943e-01   -4.450561509602671e-01   -1.810691357615239e-01   +3.159364808826819e-02   +3.337655213647470e-01   -3.978808848363190e-02   -3.274422234957234e-01   -2.134306539099144e-01   -4.513683672678692e-02   +6.332419772845523e-02   +4.437715020211974e-02   -1.914566980495686e-01   +2.228870947038890e-01   +4.328620945232664e-02   -3.209460489454843e-01   -2.054396486040167e-01; -2.575255728514993e-02   -3.613989630113509e-01   -5.658685648734166e-02   +4.658759518809780e-02   -6.496807772360280e-03   -2.900182030434335e-01   +7.113987140902589e-02   -8.006659139650399e-02   +9.474373258202827e-02   -2.526219321981470e-01   -3.070029557218260e-01   -2.695987864718727e-01   -1.592269220628784e-01   -7.627093672483490e-02   -1.528068080204495e-02   +3.460790738845832e-02];
L2I_L2E_iAMPA_netcon = [-1.216489537684855e-01   -2.891618385807990e-01   +2.593212338959299e-01   -4.389006916860749e-01   +1.740985320166093e-01   +9.020160773842018e-03   +2.917597812007093e-01   +1.896210678275457e-01; +2.488925373637345e-01   -1.497154588088359e-01   +1.499609276213553e-02   +1.213458614222384e-01   -2.412512510933620e-01   +8.405639181024133e-03   -3.605411543152887e-01   -2.909755757011286e-01; +1.932208925005861e-02   -1.579810239905963e-01   -2.330834859772069e-01   -2.814088215969536e-02   -1.816620934770337e-01   -5.015351007548485e-02   +4.779158257512568e-02   +3.184689253254880e-02; -2.952859714129370e-01   -6.636170109132458e-02   -5.865434700721303e-02   -1.643186188981474e-01   +1.498778832551714e-01   +2.071168514633161e-01   -4.772294507299846e-01   -2.057286222584473e-01; +6.271956471776508e-02   +1.513525982592492e-01   +1.873163353482280e-01   +2.727106464623843e-01   +6.592845178571598e-02   -6.587174233114744e-02   +2.021855149593357e-01   -4.088337886673732e-02; +1.938530544127380e-01   -4.384647689933964e-02   +1.362747186789984e-01   -1.842846941708854e-01   -8.487740726707101e-02   +9.161982531252331e-02   +2.321042725478463e-01   +2.727485337078072e-01; +3.724019977928446e-01   +3.512319857989881e-02   +4.142830890088087e-04   +1.474464354982441e-01   -2.273367988426983e-01   +1.246335604601566e-01   +1.638482950794751e-01   -2.028267621802682e-01; -2.117219504477608e-01   +1.120979339668020e-01   +2.105816715832549e-01   +1.199730998690143e-01   -9.062938809170659e-02   -1.262970850214263e-01   +2.317940426104464e-01   +2.119294457073812e-02];
L2E_L2I_iGABA_netcon = [+5.969439798672872e-02   +1.821142926303052e-01   -3.080113312214614e-01   -4.686743899828036e-02   +3.240054200273529e-01   +1.711437321254473e-02   +6.399287412949381e-02   +3.561774187912592e-01; +1.495970677254452e-01   -9.834300380544087e-03   +2.628243713229510e-01   +4.481974307500708e-02   +2.839565748277922e-02   -7.617399818241252e-02   -2.363805708442835e-01   +1.910121000679953e-01; +1.146262247799296e-01   -3.500196457395192e-02   +1.339720005908823e-01   +1.692142970067534e-01   +2.510883074882831e-01   -2.693144704141227e-01   -4.624274844730844e-02   +2.717822689220223e-01; -2.333493147690947e-02   -3.445456934242440e-01   -1.347970809188033e-01   -3.927824800444980e-02   +6.746941581758498e-02   +2.698223902648206e-03   -2.164121929840168e-04   -1.345952691302454e-01; -2.968292944885781e-01   -3.280650676316029e-01   -3.319343170739578e-03   +2.195823482487207e-01   +7.492965565700650e-02   -2.864120810760940e-02   -4.449409550353702e-01   +2.549715634100078e-01; +4.886043455028682e-02   +3.174991037870287e-01   -1.009950152184738e-01   -3.644326706789119e-01   +1.341419679637284e-01   -1.784193189871189e-01   +3.709591937193936e-02   -8.331987624412129e-02; -2.853134111728094e-01   +3.846735501389700e-01   +5.612713618044372e-01   +1.683142897064097e-02   +1.413159471454692e-01   +8.583179889376018e-02   +3.389265384497968e-02   -3.761997644941455e-01; +2.795010514613562e-01   -5.120809758771563e-01   -9.128605441519318e-02   -2.069277029962448e-02   +2.145947767255386e-01   -1.026814266890533e-01   -2.405266410616945e-01   +1.798631757792911e-01];
L3E_L2E_iAMPA_netcon = [-2.971751419936363e-01   +8.890588791114029e-02   +3.893711980380645e-02   -1.387195404541871e-01   +4.020805870867250e-01   -2.147164855081539e-01   +1.209736429781188e-01   +1.791133391240528e-01   +1.767725479185850e-01   +4.291424144721680e-02   -1.149729697951085e-01   +1.857005763723888e-01; -1.477366648584394e-01   +1.744223500751562e-01   -1.301101651006957e-01   +1.014043655131948e-01   -1.427981310716939e-01   -4.290943344259631e-01   +8.371735775567532e-03   -4.481478111718209e-01   -7.250422183309452e-02   -1.646154294725024e-01   -1.279963125195371e-01   -5.769896493978439e-02; -4.203070968481602e-02   +4.737054482223477e-01   -3.713780541553838e-01   -1.877633867747344e-01   -1.889691776810667e-01   -1.445793532764705e-01   -2.312880635892040e-02   -1.486106981798024e-01   -3.782883390443741e-01   +3.605789332054112e-02   +2.712261077789163e-02   -1.365029241784703e-01; -3.948169699209517e-01   +8.227241286423076e-02   +5.327015618333975e-01   +2.980762276038308e-03   +1.356652356643281e-01   -2.670402249332154e-01   -1.222769466638798e-01   -2.498429990511128e-03   -5.107127551306174e-02   +3.461935952081123e-01   -1.820046550364944e-01   -2.038623345121475e-01; -1.005399825027908e-01   -3.961542535167497e-01   -1.114065693900231e-01   +1.689690449745554e-01   +1.990455139897528e-01   +2.314176448243679e-01   +3.785213762996569e-01   +3.717051462067187e-01   -4.346471363119689e-02   -4.486071530428315e-02   -2.593605823145078e-01   +5.394640741605758e-01; +7.719760088669313e-02   -1.223801020562549e-01   +3.716107565692031e-01   +3.694033316614694e-02   -2.092357527467348e-01   +1.145918874210690e-01   -8.973091669808980e-02   -3.311756151626762e-01   +1.401247662203826e-01   -4.131306070790902e-02   +2.047284293860095e-01   -2.638197374635756e-01; +6.946058442372380e-03   -3.245134658765407e-01   +1.181607343303978e-02   +1.558890730794178e-01   -7.647852189049970e-02   +1.027825306881289e-01   -1.197172073716666e-01   -6.736688691724720e-02   +5.707235853193141e-02   +8.892793470579689e-03   -8.418923053537064e-02   -2.079178924318391e-01; -1.316142438233273e-01   -4.594284784604971e-01   +2.976958949672162e-02   -1.436519956633535e-01   -4.866761614165846e-02   +1.306360472828346e-01   -1.258736102541998e-01   +2.971369107698257e-01   -1.357696625415212e-01   +1.045579435544272e-01   -2.391061650459048e-01   +2.802013838624223e-01];
L3I_L2I_iGABA_netcon = [+1.423080310646114e-01   +1.966255071363800e-01   +1.342770005468878e-01   +1.461782103453654e-01   -1.418284056432502e-01   -2.483163859249053e-01   +1.599165535104122e-01   -1.110503045982996e-02   -3.036177931749627e-01   +2.306165988081450e-02   -1.588899948840611e-01   +1.329848879077913e-02; -2.218195157489757e-01   +1.763040463504950e-01   -1.895327584294263e-01   -1.522961689085425e-01   -2.136649832913777e-01   -1.304906328595507e-01   +1.838037877289009e-01   +2.469273454907041e-01   -1.864818003578310e-01   +2.289960524318792e-02   -7.564192294598901e-02   +2.656305746023003e-01; -2.342071319326523e-01   -2.324935744762887e-01   +1.695952035992918e-01   -1.898729828802343e-01   -3.901686829365912e-01   +6.774844621105329e-02   -3.939724578408689e-01   -2.893999890896262e-01   -5.216211164039762e-01   -1.271661177655557e-01   +1.850227527660677e-02   -1.297958397020798e-01; +1.922784945555665e-01   -1.134505752307715e-01   +1.181134941072068e-03   +4.523019386351320e-01   +8.009041701724412e-02   +1.660250665891562e-01   -3.015506401956936e-01   +1.424465958618358e-01   -4.631384892544536e-02   -3.088270657917294e-01   -3.813554074973998e-01   -1.100009507756737e-01; -2.653809752343347e-01   +2.189669477650771e-01   -2.126950428604252e-01   -4.513743191530947e-02   -1.631520332190097e-01   -3.152407133322455e-01   -1.537386514748241e-01   +1.885956443869347e-01   +4.173312244031241e-02   +1.689765153657105e-01   -2.111173090600968e-01   -1.729351148438607e-01; -3.617791316234386e-01   +3.746760789238917e-01   +3.107896046747661e-01   +2.243784182396269e-01   -8.216074419651180e-02   +1.383737794151411e-02   +1.079995135295259e-01   +1.611625040203230e-01   -2.797512378081952e-02   -7.770067272168776e-02   -1.351933356254519e-01   -5.725479861376553e-02; -4.821972589731147e-02   +2.735300301203205e-01   -1.384091846205991e-01   -5.060794900515970e-01   -1.762853053961672e-01   +2.975697839122256e-01   -2.217144652593629e-01   -2.686390063717098e-01   -5.305875372659514e-01   -1.073374544279310e-01   +8.699387060096850e-02   -1.739394851364867e-02; -1.635660320874253e-01   +1.455911756900877e-01   -1.955040582965022e-01   -1.613439992919517e-01   +1.628842784248621e-01   -1.594902727317575e-01   -3.125424452527443e-01   -8.663022468845112e-02   -6.464489454968364e-02   +1.192735228933701e-01   -1.730507640052688e-02   -3.664818265143194e-01];
L2E_L3E_iAMPA_netcon = [+1.302220309306494e-02   -2.466804046549255e-02   -1.462304509560030e-01   +3.783510381737785e-01   -3.707615011183645e-02   +8.039347382550803e-02   -2.828838632844658e-01   -1.606889709329667e-01; +4.525560008848584e-02   -2.224863179928970e-01   +9.511286801468927e-03   +2.623788559932159e-02   +2.324555575905683e-01   -1.178145072057806e-01   -1.182773446409255e-01   -7.172410334902679e-03; +2.077637291794489e-01   -4.658328156885997e-01   -2.095609266289445e-01   -2.598286461594213e-05   +1.676516432547060e-01   +3.333129865943052e-01   -3.693474927557046e-01   +9.288633412428908e-02; +2.407896082387632e-01   +1.289107752167887e-01   -2.902421105449449e-01   -5.566543677917413e-02   +6.978560240849960e-03   +9.813790173432345e-02   +6.956558314872803e-02   -4.611152283990974e-01; +3.413019508996422e-01   +2.023860443370128e-01   +2.408575315159638e-02   -2.148451607994285e-01   -1.322070263730857e-01   -3.994340544204908e-01   +1.379979718024529e-01   -2.418850379217541e-01; -1.298805725148560e-01   +8.817236885747293e-02   -4.221961522940998e-01   +1.250285272560629e-02   -2.744988252170092e-01   +9.008496864353528e-03   -2.627219285726524e-01   +3.643100129428150e-01; +1.330427490283323e-01   -2.966978972488405e-01   -2.827310862537750e-02   -4.501445777109715e-01   +4.885290211490441e-02   -8.132260760291364e-02   +3.400150911992020e-01   +1.557889545883075e-01; -1.287499676063679e-01   -1.073085678620121e-01   -2.886548273831301e-01   +1.151455323477506e-02   -4.234490332254628e-01   -9.040137977775420e-02   +1.834635178229951e-01   +1.661469781651777e-01; -7.879470088389767e-03   -2.730394503221267e-03   +3.726148223298451e-02   -1.648781294546874e-01   +6.038253608438382e-02   -1.722672433430357e-01   -1.585705047345383e-01   +3.499364190103438e-01; +4.401299395595520e-01   +2.476557308765945e-01   +2.364841046132193e-01   -3.344473537439865e-01   -6.013608532503204e-02   -1.113974195836750e-01   +6.977308307943396e-02   -2.284522510763076e-01; -2.402902547048033e-02   +1.064835335994063e-01   -1.070367309073877e-01   -2.326459101490010e-01   -1.952910753692214e-01   -2.047914190358334e-01   -6.156288336085916e-02   +9.859807720641532e-02; -2.929690720021590e-01   -9.965827186021996e-02   +3.739084557745274e-01   -2.337046604909908e-01   +2.655324791349489e-01   -1.422358389221150e-01   -1.822630304768768e-01   -8.142440049926211e-02];
L2I_L3I_iGABA_netcon = [+6.834031803907231e-02   -7.040495122189719e-02   -6.688850090074916e-02   +6.333859323810682e-02   +5.040081188583048e-02   +3.020231628000015e-01   +4.670700355194313e-01   +1.055711285053284e-02; +1.436411360884081e-01   +4.299242261214495e-02   -1.306995133158541e-01   +1.824471270138746e-01   -9.269817856789701e-02   +9.353003204160885e-02   +1.247851659894728e-01   -2.287827267272861e-02; +1.067749455613104e-01   +2.990131295925677e-01   +1.829393627229972e-01   +3.010683839179127e-01   -8.792355732044387e-02   -7.366214294275836e-03   +2.134154765351979e-01   -1.390043404204532e-01; -3.222280132987246e-01   -6.162266484658296e-02   +1.440730209643568e-01   +2.111874581152204e-01   -1.785454264239105e-01   +1.113352547408856e-01   +4.224913652573016e-01   -2.580650573068645e-01; +4.125336961021606e-02   +2.969193759385411e-01   +3.797528761365628e-01   +1.716839633634680e-01   +1.542705676314421e-01   -1.697747091342541e-01   +3.394025792794946e-01   +3.495481460133051e-01; +1.190629180594566e-01   -1.060639921024853e-01   +4.644044658863552e-01   -2.962525921605340e-01   -1.830596080132105e-01   +2.259934950958880e-01   -1.493419227665995e-02   +4.571427653312641e-01; +1.396717844168182e-01   +4.250617163588658e-02   +4.079450619223478e-01   -8.839409462154293e-02   -2.996803549293839e-01   -1.906032274751746e-01   -6.023628822994641e-02   -1.296758297292052e-01; -1.635930709144014e-01   +2.394769381297168e-02   +2.276263952960276e-01   -1.735552108342124e-01   +2.636919877952382e-01   +2.016317860528774e-02   +2.717766235739008e-01   -5.964366994372444e-03; -1.379899724570471e-01   +4.545919635013065e-01   +2.950555303170374e-01   +2.024560002244103e-01   +1.988462497691956e-01   +1.117863739112861e-01   +1.157361386410406e-01   -9.039970701726885e-02; +3.647235784840068e-02   +1.100868183410791e-01   -2.734519046895260e-02   +9.659153942343057e-02   -3.842980178653436e-01   -1.658095429983027e-01   +1.419894799019031e-01   -2.023013179188456e-01; -4.128993499460922e-02   -3.344731818058677e-01   +1.646169229432780e-01   +1.339525633914086e-01   +1.741329279446445e-01   -2.494446399484093e-01   -2.172626578403519e-02   -2.290251374756015e-01; -8.385869623698639e-02   +9.810663380551404e-02   -1.476009495581592e-01   -1.536482784579116e-01   +4.940547651416197e-02   +2.635184798018353e-02   +3.010976701947378e-01   -8.589328197963381e-02];
L3I_L3E_iAMPA_netcon = [-1.948183393771305e-01   -3.355905906118801e-01   +1.070400462466749e-01   +2.298580840251097e-01   -1.106423122255000e-02   +1.019786011615957e-01   +6.038879913996216e-02   +2.755202514221963e-01   +1.065535322237899e-01   +2.208721470753746e-01   -3.734635035598122e-02   +5.325462117043657e-01; +1.312932134582322e-01   +1.627939815126969e-02   -2.057126909597277e-01   -5.878208590300248e-02   +8.156962086589797e-02   -2.594785635391288e-01   -2.273725619698937e-01   -2.568438118178966e-02   +1.995018683118738e-02   +5.140524656317744e-02   +4.464673840768617e-02   -1.630609307555483e-01; -1.973250899167999e-01   +4.445167406186831e-01   +7.394176466740604e-02   +2.384505325596877e-01   +2.512584380606909e-01   +3.935545885342545e-01   -1.377916305238082e-01   +7.388902771183967e-03   -7.496933509836226e-02   -4.131998857592821e-01   +3.573392741699877e-02   +2.435912969534454e-02; +2.490459345174251e-02   -4.480787995561736e-02   -4.205136879672266e-02   +8.687119912744148e-02   +9.704887728836570e-03   -1.770745642504257e-03   +8.346165813010208e-02   +2.849776400414487e-01   -2.333488619641654e-01   +2.129150920283003e-01   +1.475525227231309e-02   -4.334783040320415e-01; -1.281240693338371e-01   -2.063033442184060e-01   -1.213519662491802e-01   +4.389608842220176e-02   +3.579093492526162e-02   -7.972806885705409e-02   -2.098187557431877e-01   -2.154146556642394e-01   -8.594773094280755e-02   +2.064671198176692e-01   -1.335463789850259e-01   -1.169829163397242e-01; -4.668730262743210e-01   -7.123180872485359e-02   -4.345677383056933e-02   -1.066592757643415e-01   +3.273158758164662e-01   -1.337775406726641e-01   +2.799913904953695e-01   +1.779237967458816e-01   +1.908275164399767e-01   +3.949855315644737e-01   -1.850747957052645e-01   +2.367181996192946e-02; -1.037820065947277e-01   +1.292096532471868e-01   -4.839648361198725e-01   +1.111857109121116e-01   -2.656096424891692e-01   +7.383098766228134e-02   +2.025713803087694e-01   -2.497205417012906e-01   +1.787482285666140e-01   -1.389717561528692e-01   +2.976643227684486e-01   +3.587638990557322e-02; -1.588377173905989e-02   -2.729651252232308e-01   +9.678390912641541e-03   +4.198191225289865e-01   +4.798795996678618e-02   +1.664715191581495e-01   +1.706397344860339e-01   +1.347464092332457e-01   -6.330822833818865e-02   -1.695200095146773e-01   -7.534344745097220e-02   +1.624176598853384e-01; +3.594819643557828e-01   +6.330227760275972e-02   +3.186491017801571e-02   +3.938623525757501e-02   +1.904648377925789e-01   -4.348745902974859e-01   -2.545167143188933e-02   +4.729227457768909e-02   -3.318747796902007e-02   -2.383817730500378e-01   -1.038006778344728e-01   -1.651935089022669e-01; -4.889169449915058e-02   -3.370577485378877e-01   +2.798680938666043e-02   -7.524879499510290e-02   -2.273309671716111e-01   -2.809283661287861e-01   -3.521283885255360e-01   +4.130018003142616e-01   -2.350630806976602e-01   -1.002109158613818e-01   -5.650253614662495e-02   +1.132977136321099e-01; -6.900199741523540e-02   -1.627664422149502e-01   +1.343059664561344e-01   -2.816073502336969e-01   +3.559606356872242e-01   -4.631331083189949e-01   -4.912586517021152e-02   -5.551865763428307e-02   -4.390883326238995e-01   +1.395158494721946e-01   +3.294912413635571e-02   -1.998385852602493e-01; +2.679572119172943e-01   -1.093696029262075e-01   +2.738182427299237e-01   +2.495135623284818e-02   +6.784866918889046e-02   +1.128162880484178e-01   -1.903475973268609e-01   +1.318934943758913e-01   -1.653056883334161e-01   +5.120127565980359e-01   -1.052454638091763e-01   +5.461526488828448e-02];
L3E_L3I_iGABA_netcon = [+4.202171091635469e-02   +2.879503995527868e-01   +3.045289265435270e-01   +2.173288722880208e-01   -1.272590286536082e-02   +1.083434099456795e-01   +5.502789783407664e-01   +2.789631054422696e-03   -1.647939464290849e-01   -2.992835746391381e-01   +2.357287770616488e-01   +3.131937471748566e-01; +1.995712931921711e-02   +1.108637765888150e-01   +1.301930363669815e-01   +2.709488066052539e-01   -9.868232511747510e-02   +2.266214773041171e-01   +8.260851053205814e-02   +2.164664449366310e-02   +9.047881614485453e-02   -6.703658826268583e-02   +4.011400900781201e-02   -1.367178969400149e-01; +1.123929040648840e-01   +3.280882683400722e-01   -1.515096859402784e-01   +3.085942393979086e-01   +4.409330549856785e-01   +2.649473323856918e-02   -2.798509153483880e-01   -3.416265933329067e-01   +8.821238110919608e-02   -1.085375044193560e-01   +1.762270464921352e-02   -3.468750018221977e-01; -1.045800936204760e-02   -1.681366658096144e-01   +2.955555473754043e-01   +1.599400543066438e-01   +1.258849246865322e-01   +1.477525137046618e-01   -3.438664196661120e-01   +1.533689101379217e-02   -3.438925289480732e-01   -5.886673076068022e-03   -3.529232866153640e-01   -1.972434464761768e-01; -5.095835822513575e-01   -2.138737090961198e-01   +2.656864694476074e-01   -1.747599761563463e-01   -3.710314913233000e-02   -2.122673662378982e-01   +1.003874859270463e-01   +4.191883150856340e-02   -4.939598570200454e-02   -1.039744594655599e-01   -2.322775984426625e-01   -5.724517514639699e-02; +2.003950922569421e-01   -9.822568272761548e-02   +2.502691699493736e-01   +3.530855953155740e-02   +2.241804397165985e-02   +2.963526957018557e-01   +1.323332310124156e-01   -1.560670733638923e-01   +8.025097154493109e-02   -1.949125440957161e-01   -4.363245984927094e-02   +2.968821615921782e-01; -8.276080058781540e-02   +1.023568191428361e-01   +1.585197512484405e-02   +4.074071938698788e-01   -2.061567040783274e-01   +2.073260320424636e-01   -2.029776730629000e-01   +8.167134478483820e-02   +3.031820443187630e-01   +1.999613462437438e-01   +8.587337924314357e-02   +2.049821551326936e-01; -3.528384783044063e-01   -1.785638482537120e-01   -2.058703269821845e-02   +1.567801903887103e-01   -6.745298721033055e-02   -2.145023644415251e-01   +9.346236491938935e-03   -9.251926805954686e-03   -1.131212447998199e-01   +3.053668484984141e-01   -3.539010559406195e-01   +2.774608171735346e-01; -2.345069355240208e-01   -1.655176336773301e-01   -2.997821589817037e-01   +6.372658457884865e-02   -1.940240194297805e-01   +1.483005184351968e-02   -3.406997502314834e-01   -7.079754570772953e-02   +1.553028052839861e-01   +3.183010026612145e-01   -1.036315728260394e-01   -1.445298602995144e-01; +2.313071668997639e-01   -1.470734681727049e-01   -7.180944412822046e-02   -6.798876308053253e-02   +1.296007073397447e-01   -4.692739740542573e-03   -6.501544432862923e-02   -1.701164981656225e-01   +7.899527659175870e-02   +6.790306488456199e-02   -6.490599569003203e-02   -7.037306122790352e-02; +2.421223506997764e-01   +1.679806701993995e-01   -8.042367418765434e-03   -1.896961701264259e-02   +2.974876562338039e-01   -1.664184682729423e-01   +2.450492931830382e-01   +5.235433544966275e-02   -1.813070758159293e-01   -2.792277438644220e-01   -2.794844105984012e-02   -2.846349385328106e-01; -4.227777460967715e-02   -2.197664036302077e-02   +1.322239366997391e-01   +2.490202370497082e-01   -2.625162739556670e-01   +1.692914896791347e-01   +3.252314933223941e-01   -1.430124882577946e-01   -3.221235726944715e-01   +7.461635336567012e-02   +9.216059971751912e-02   -2.898828584384454e-01];
L2E_Input1_iAMPA_netcon = [-2.960654977481049e-01   -1.148006510119135e-01   -3.174269629106710e-02   -2.747672765421051e-01   +1.379641937749367e-01   -4.169007731006351e-02   -2.706412390994430e-01   +3.172457817212724e-01];
L2I_Input2_iAMPA_netcon = [-2.934789330089648e-01   -9.380181137571722e-02   +4.118640742688356e-02   +4.354806358644098e-02   +3.441896060236694e-01   +2.805931511948998e-02   +2.648072280230130e-01   -2.573755665336870e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
