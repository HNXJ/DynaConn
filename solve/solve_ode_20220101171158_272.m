function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.168652758472140e-02   +8.604391746182892e-02   +5.888541514139201e-02   +1.895994807913946e-02   +1.576651507312997e-02   +4.715162671370014e-02   +2.043808769044616e-01   +1.923591394230700e-01   +1.839503785652322e-01   +1.950641398305600e-01   +6.108029504440050e-02   +1.397144117016875e-01   +1.100651586689473e-01   +1.471844919609848e-02   +1.680495768976295e-01   +3.364523033115206e-02; +1.540370084503630e-01   +1.655255199252921e-01   +8.171039780267116e-02   +9.620370667758582e-02   +1.911492759030838e-01   +1.994078212382272e-01   +8.920913582138762e-02   +6.959215005472008e-02   +1.905253355453001e-01   +1.829909830530757e-01   +3.244012559369615e-03   +5.381556004149306e-02   +1.596928614832539e-01   +2.146950604798297e-01   +8.038074560287975e-02   +1.980352526878760e-01; +6.691114622900415e-02   +1.438882951057952e-01   +2.200166548439654e-02   +2.109141026417474e-01   +9.771635215113969e-02   +1.074640044005427e-01   +1.617331710751291e-01   +2.029674794599855e-01   +1.565575364953605e-01   +3.881050337710225e-02   +3.378999766500429e-02   +8.394247245557560e-02   +1.174515438890792e-01   +1.049402958204019e-01   +1.613059185145072e-01   +9.646643694757162e-02; +1.217908115395760e-01   +1.019366201060623e-01   +1.430400479269644e-01   +1.152833504439919e-01   +1.485659991612827e-01   +9.410279119278045e-02   +1.812136355221223e-01   +1.050210248247697e-01   +1.263156387594542e-01   +1.267689597381401e-01   +2.020772410269603e-01   +1.465761119031284e-01   +2.555755521912084e-02   +1.982894075781808e-01   +1.072467989326424e-01   +6.671819404558063e-02; +1.967605387884977e-01   +1.124604660607548e-01   +1.177649458852773e-01   +1.206886765359546e-01   +1.311494951918969e-01   +7.751084802837560e-03   +2.002602951483084e-01   +1.050438445308204e-01   +6.235190740629327e-02   +1.788371407327486e-01   +1.428026626293337e-02   +1.733431088941758e-01   +6.014074060829400e-02   +1.995920341188457e-01   +4.034311433212897e-02   +1.771350482863485e-01; +1.852120128654140e-01   +4.938822866781108e-02   +1.315563495764761e-01   +9.894926482984311e-02   +1.483117714825744e-01   +2.463418808731723e-02   +7.154569283618550e-03   +5.662870903712557e-02   +1.814028365026820e-01   +1.255538342698261e-01   +4.120277892799505e-02   +2.153980505853066e-01   +7.775061407424470e-02   +1.919479477697580e-01   -5.814789361650950e-05   +5.539519001892059e-02; +4.791657611972783e-02   +1.346245698623363e-01   +1.811489227687930e-01   +7.087325817518651e-02   +1.461456134975625e-01   +1.413484002442644e-01   +1.318871204344969e-01   +1.763202533861413e-03   +1.964316383649450e-02   +8.292923594057598e-02   +1.214434431555347e-01   +1.706055989179506e-01   +1.546340059415091e-01   +1.996898944902912e-01   +8.856746740891933e-02   +1.748387143944103e-01; +6.908552357080330e-02   +1.213068251854961e-01   -1.071040389894777e-03   +2.010662274504529e-01   +8.074881699725860e-02   +1.411814051481225e-02   +1.535692875180511e-01   +1.855751118463179e-01   +5.604743448427046e-02   +4.648934063681435e-02   +4.918180567930178e-02   +2.048433490034531e-01   +1.644584426173930e-01   +3.077572896592199e-02   +8.257952671872225e-02   +5.496936953985437e-02; +1.513887649239048e-01   +1.208269513588202e-01   +1.397736469933113e-01   +1.071757594793109e-01   +1.343787120364976e-01   +1.991166279534383e-01   +2.525848925042964e-02   +1.647454219368755e-01   +9.980346170085724e-02   +5.651237352145339e-02   +1.453389015113290e-01   +1.980331274083971e-01   +6.385323362353364e-02   +8.466946815244172e-02   +2.065678019428364e-01   +1.831500317970875e-01; +1.737755463076938e-01   +4.949299700452556e-02   +3.046177906494498e-02   +3.927359741707144e-02   +3.553020660766374e-02   +2.314900783266076e-02   +2.843022491483031e-03   +1.357652970627638e-02   +8.008809116185676e-02   +1.546857243269478e-01   +7.530206830302764e-02   +6.631634787547191e-03   +1.193256542925211e-01   +1.422297608379825e-01   +2.085896009252559e-02   +2.737241372823890e-02; +2.071558714336700e-01   +2.032780357761026e-01   +2.007549139061929e-02   +1.045808500952386e-01   +1.249238841246215e-01   +5.359298781139558e-02   +1.686238397294720e-01   +1.660233701387711e-01   +8.363211350374879e-02   +1.331451501955967e-01   +1.753060997884155e-01   +1.726202607065626e-01   +1.751864128906746e-02   +1.203955896206423e-01   +7.853468510769539e-02   +1.324011881831951e-02; +1.690097844967140e-01   +2.053816822854079e-01   +9.523487221252744e-02   +9.769805066430168e-02   -4.332429021866169e-03   +9.144730085762184e-02   +1.787758366417389e-01   +1.446318184999026e-01   +1.776858688364674e-01   +8.945901336501136e-02   +1.616502683476538e-01   +1.136093995458621e-01   +1.334508570034456e-01   +8.753967500582963e-02   +1.685470985269777e-01   +1.752785927879299e-01; +1.725392568664200e-01   +5.095556843683545e-02   +8.103662096959513e-02   +6.349643783450011e-02   +1.891677891711969e-01   +6.733546142284730e-02   +1.545653214979853e-01   +1.392910207777768e-01   +1.097844506391667e-01   +1.453056880096762e-01   +1.093092898060915e-01   +9.648974957159337e-02   +1.585389057686195e-01   +3.528634370786212e-02   +1.662064649386277e-01   +2.739874484921113e-04; +6.366067237564738e-02   +3.908815661658485e-03   +9.348467424068434e-02   +8.168085454848767e-03   +1.860312920774498e-01   +1.275731902587131e-01   +1.586919337345220e-01   +1.339262025350108e-01   +1.493739768217813e-01   +1.968437343034469e-01   +1.075192284662730e-01   +2.747138191229334e-02   +2.915807343758859e-02   +1.976020850356151e-01   +8.882814034530372e-02   +1.600412338491820e-02; +5.272889417468629e-02   +1.491697560332879e-01   +6.202334858672196e-02   +4.893234103772680e-02   +1.552620430935606e-01   +9.949214329333889e-02   +1.136388586823643e-01   +3.813475484684335e-02   +1.560037969739868e-04   +1.896818767518977e-01   +1.581255492854880e-01   +1.750257548795039e-01   +2.882435733688481e-02   +5.132262745478600e-02   +1.943232879021416e-01   +1.096018892512316e-01; +1.394632457518275e-01   +8.400078935646739e-02   -9.541244563004013e-04   +2.036671241428135e-01   +1.485064946436623e-01   +1.147069110250227e-01   +7.402795086198938e-02   +2.004729692698949e-01   +1.295424655861849e-01   +1.839031853897021e-01   +1.413314167174009e-01   +3.283325773406019e-02   +1.782626104048223e-01   +1.784555392256541e-01   +1.403244098430805e-01   +6.262128614643012e-02];
L1E_L1I_iGABA_netcon = [+1.554672179604362e-01   +2.097436804866682e-01   +1.588581297294393e-01   +8.699349526568836e-02   +1.597077509303663e-01   +8.648920736788289e-03   +1.996511232446090e-01   +1.906205872546716e-01   +1.892289071043523e-01   +8.889096452071551e-03   +4.927754613122242e-03   +9.128468734056444e-02   +5.403254985802194e-02   +1.040499744873378e-01   +6.946080227483338e-02   +9.578461063669656e-02; +9.494269737657633e-02   +2.067462228326809e-01   +8.524282445222764e-02   +1.085783698511735e-01   +6.135141854747558e-02   +1.722271765845319e-01   +1.114639565513181e-01   +2.016448293078186e-01   +1.634519413647573e-03   +1.213586821136725e-01   +7.062650645000142e-02   +6.686138079489541e-02   +2.135484730798420e-02   +6.452508239118306e-02   +8.374711593179976e-02   +1.890660108148463e-01; +1.725502196058793e-01   +1.836189709787742e-01   +2.088220655088576e-01   +1.752959850218318e-01   +2.706940647637044e-02   +1.590300435158882e-01   +8.444246854674690e-02   +8.289338397365206e-02   +7.989288920225195e-02   +1.769679678295166e-01   +8.200955660140337e-02   +1.122981357984134e-01   +1.665482577011692e-01   +1.336348761795440e-01   +5.111512996663575e-02   +1.661105698474555e-01; +2.204850797557122e-02   +1.506710224784821e-01   +7.946785825415187e-02   +1.283203236539253e-01   +2.000512234488653e-01   +7.993643352737406e-02   +7.350613186241030e-02   +1.569898289009268e-01   +1.466117616462899e-01   +1.526764264121749e-01   +1.156019687562418e-01   +2.072185753627827e-01   +7.391610596003076e-02   +1.442951514639684e-01   +2.061835662468365e-01   +1.642734100481066e-01; +7.596533608948104e-02   +1.058651270479672e-01   +1.204232568235440e-01   +2.025558988509043e-01   +7.746011766549336e-02   +7.947611241949905e-02   +1.210163204760767e-01   +2.056783998333614e-01   +6.101290799687111e-02   +1.237796356061632e-02   +1.925927243533669e-01   +9.647257831795124e-02   +1.739539156586060e-01   +1.808426223192351e-01   +1.217923723938625e-01   +3.212025905411116e-02; +2.133503710563877e-01   +1.184938806706178e-01   +1.648413034616724e-02   +5.903307369951731e-02   +1.023404943967109e-01   +4.853483548137887e-02   +1.103204851983523e-02   +4.900115370640820e-02   +1.505876946018460e-01   +1.911504818431519e-01   +7.950674143945831e-02   +1.566971371121602e-02   +1.320149216640135e-01   +1.110323978830455e-01   +3.695127662504803e-02   +1.598661023790284e-01; +1.699496990575074e-02   +4.418071391121061e-02   +1.422157538867653e-01   +5.064980664847840e-02   +1.084118722670672e-01   +4.884709241833655e-02   +7.129506297419982e-02   +2.404610906058016e-02   +7.534008580824340e-02   +1.775253208998966e-01   +1.583607060518754e-01   +6.456180094408130e-02   +2.487584689547287e-03   +4.405433672465613e-02   +1.338559170757802e-01   +9.670401890020072e-02; +1.929774601044901e-01   +4.222873931637097e-02   +6.108124903692798e-02   +1.332998924575266e-01   +1.308789662877134e-01   +9.153658501534409e-02   +4.961549613179302e-02   +7.419693698696744e-02   +1.525147939563843e-02   +2.119726604042396e-02   +3.678599490684904e-02   +1.941696276818975e-01   +3.125505702262796e-02   +6.481043468790101e-02   +1.445037426898124e-01   +1.770352665429816e-01; +3.228872121845137e-02   +8.361040257021964e-02   +6.578679856032713e-02   +7.140356132850620e-02   +7.033668713594633e-04   +1.451692694792882e-02   +4.850615187010378e-02   +5.154298918562569e-02   +1.393224546235469e-01   +4.947950136741867e-02   +4.181742998581241e-02   +1.728684427273893e-01   +1.333202117956738e-01   +3.668989464749472e-02   +1.812002963114581e-01   +1.930631507289640e-01; +4.548885525800220e-02   +1.291552442078182e-01   +2.620477936066854e-02   +8.891533931448863e-02   +6.939115387255361e-02   +1.153559938316934e-01   +1.882545515587427e-01   +2.630577442969401e-02   +1.901087621928656e-01   +9.690561051092067e-02   +1.385113138889726e-01   +1.803812101134545e-01   +1.419045682592811e-02   +1.312099290695554e-01   +8.905322834218328e-02   +1.843432456281739e-01; +2.090540918860223e-01   +1.574857127160563e-01   +1.865718017159685e-01   +7.381708165268966e-02   +5.556133147990858e-02   +1.165879619254687e-01   +6.490287019740335e-02   +1.443511026579534e-01   +1.656910012420793e-01   +2.431343809494692e-02   +7.204415349855119e-03   +1.408872937030396e-01   +1.067405523449620e-01   +1.650732234824548e-01   +7.868946759257929e-02   +1.501529477430815e-02; +1.947264291414606e-01   +6.580598392396862e-02   +2.107848670026966e-01   +7.311511578837501e-02   +6.668502931777961e-02   +1.639597070845185e-01   +4.928230673127888e-03   +1.706163874278684e-01   +3.815087979916519e-02   +1.577437775630930e-01   +1.795012277594393e-01   +4.100447692651495e-02   +1.087193304330075e-01   +1.059513706896019e-01   +1.983917674955877e-01   +8.929922097797106e-02; -8.880382457284487e-04   +6.054160676282989e-02   +7.371972628663644e-02   +5.365344149909904e-02   +1.442593355294730e-01   +9.027057875467508e-02   +1.086534723339877e-02   +1.081356791018704e-01   +1.354355720969833e-01   +8.966706250676952e-02   +2.034009194925153e-01   +8.842124180753438e-02   +5.114231916541877e-04   +1.553305593046319e-01   +1.684958149547404e-02   +1.730123024676697e-01; +1.056740562596953e-02   +1.679003211616959e-01   +1.222579487359225e-01   +4.927653017308611e-02   +1.378855063596542e-01   +1.358006037433439e-01   +1.745369086668560e-01   +4.983063822812504e-02   +1.836334340630139e-01   +1.878310172217859e-01   +8.033210904424863e-02   +3.176637833702567e-02   +2.039020352079725e-01   +2.069379017304589e-01   +6.432442340435131e-02   +1.668055304125763e-01; -3.398953251517890e-03   +1.363966525045040e-01   +1.326153331203543e-02   +6.810077887297136e-02   +4.208018301715707e-02   +1.614443842611986e-01   +1.665885450756117e-01   +1.786696904520684e-01   +1.164024367477686e-01   +1.245298389497907e-01   +1.014573657452274e-01   +1.138836092580169e-01   +1.262804328256479e-01   +4.556169552950873e-02   +8.651265880408017e-02   +7.347489707541624e-02; +7.875710858714028e-03   +1.229411210996582e-01   +6.856372156457539e-02   +8.131320408566663e-02   +1.985057820136999e-01   +1.708264893867008e-01   +4.064559951002147e-02   +1.873419192008499e-01   +1.682561316327424e-01   +3.862976058742168e-02   +6.700971395235295e-02   +1.782082115681750e-01   +2.059970441692304e-01   +1.898043129546863e-01   +1.115613931006482e-01   +1.180650642174851e-01];
L2I_L1I_iGABA_netcon = [+9.706166330714916e-04   +1.335604319169166e-01   +2.275494237863147e-02   +1.902674551169854e-01   +1.009722867825181e-01   +1.590751431921264e-01   +9.674398948321421e-02   +2.057812471942052e-02; +5.909538768910138e-02   +8.550935768137645e-03   +1.573301446434847e-01   +4.149616111738189e-02   +4.092857980963670e-02   +4.818543115522636e-02   +1.843765782598178e-01   +1.108252709270889e-01; +1.322203793915327e-01   +7.929121978251440e-02   +9.465447637921684e-02   +1.227512760714401e-01   +1.831146607074226e-02   +2.087368894653658e-01   +6.370387880618514e-02   -4.202621917542765e-04; +1.709562253174522e-01   +1.863887584520472e-01   +1.179035807959035e-01   +1.246634893672062e-01   +1.492803435170386e-01   +4.539167369281456e-02   +1.959689778954121e-01   +1.696961650343204e-01; +1.392954893637218e-01   +3.715590258636505e-02   +5.448461233720968e-02   +1.777368020132525e-01   +1.101103062545432e-02   +1.720810364193399e-01   +5.160319059012650e-02   +9.668893424320357e-02; +1.266299146720620e-01   +1.223933122962887e-02   +1.877383419521627e-01   +9.184732720470359e-02   +1.560840859342133e-01   +1.712631298935187e-01   +2.092571412189232e-01   +4.629083770066882e-02; +1.646123574693835e-01   +5.988665837125032e-02   +2.050680500734512e-01   +1.314231366976719e-01   +3.215978582726982e-02   +6.982848879914243e-02   +3.979575992641014e-02   +1.884318187142230e-01; +3.181769982453608e-02   +1.714433038130896e-01   -4.660958929859997e-03   +1.700606330150290e-01   +2.044347195980435e-01   +4.509806299493220e-02   +1.031124253363765e-01   +5.857517338727392e-02; +1.334959231769065e-01   +1.428438236668078e-01   +6.366069161798144e-02   +1.514846723738998e-01   +1.321940627734385e-01   +5.251623767792572e-02   +8.569178434940633e-02   +5.600377078953578e-02; +1.074314019561002e-01   +6.127053726769591e-02   +9.460510785600694e-02   +1.373957705004688e-01   +2.443358871611541e-02   +1.648392735497209e-01   +1.062782841818328e-01   +1.333966906113311e-01; +1.009719740506104e-01   +1.239341382817733e-01   +1.194722542972362e-02   +1.115271358982758e-02   +9.347062283326779e-02   +4.272187082396129e-02   +5.568398298674056e-02   +1.029075772928375e-01; +4.470741150685962e-02   +1.395154334949755e-01   +2.747982346547899e-02   +8.185306623213308e-02   +3.570707105989209e-02   +1.112999491823947e-01   +8.979269293107538e-02   +1.244575464791223e-01; +1.576787680762392e-01   +1.305587755896246e-01   +4.174714746022976e-02   +1.078572691034568e-01   +4.915731045097766e-03   +1.327227599154167e-01   +4.229783647515445e-02   +2.012163731857871e-01; +1.046692351454105e-01   +1.057351187220424e-01   +2.984219945599976e-02   +2.043104110768154e-01   +8.822409996326583e-02   +2.128220778188677e-01   +1.888883880308328e-02   +1.211679218853506e-01; +6.179546226567938e-02   +1.037919929701701e-01   +2.513778737596081e-02   +1.350357802572278e-01   +2.659370446909681e-02   +6.913614720828558e-02   +2.042139653142715e-02   +3.769560259791703e-02; +1.926783897033664e-02   +1.245945058877828e-01   +1.316595260325747e-01   +1.754809667894133e-01   +3.882375349619049e-02   +1.867838212049508e-01   +2.029136909751599e-01   -1.907335811718870e-03];
L1I_L2I_iGABA_netcon = [+1.187851641584200e-01   +6.720674991853559e-02   +9.228880614725476e-02   +5.159227492646791e-02   +2.930643959364537e-02   +1.545642116943044e-01   +1.010895389140184e-01   +1.806262293610087e-01   +7.396720318723017e-02   +1.497692343305707e-01   +1.465118491230179e-01   +1.857349933299769e-01   +8.254284000310287e-02   +1.698071058830821e-01   +1.329606196223152e-01   +9.310036038484114e-02; +1.458489995205066e-02   +2.770712164613930e-02   +5.343971317012296e-02   +7.204292938363644e-03   +1.973152835085636e-01   +1.333118770172879e-01   +1.520197548632275e-01   +1.429429481665306e-01   +1.394688108737857e-01   +7.988443733995286e-02   +7.577346966132427e-03   +8.226243450967598e-02   +1.270411415171970e-01   -4.811564801485871e-03   +1.297460625402503e-02   +1.258888026009689e-01; +2.601348459495509e-02   +1.784843475050951e-02   -3.832860018545493e-03   +1.410807797739003e-03   +2.102358774265909e-01   +1.426938725246864e-01   +2.010115667012040e-01   +1.826621928901293e-01   +6.065269734130791e-02   +6.532398454413679e-02   +3.169672700643009e-02   +5.150036065468117e-02   +1.771775544001687e-01   +5.348482347558360e-02   +6.391505196248518e-02   +1.876410124783739e-02; +1.044417431636689e-01   +1.697450759926026e-01   +1.075172052045159e-01   +6.500277320222553e-02   +6.516606113837518e-02   +1.221185389421360e-01   +9.055349784636749e-02   +1.861581629985293e-02   +5.625974225299393e-02   +1.113688042103969e-01   +1.855615955867148e-01   +1.894010235687758e-01   +1.579447363649700e-02   +1.593059308510799e-02   +8.027933983898906e-02   +1.289868464734245e-01; +9.247054981167599e-02   +6.049467951503241e-02   +1.536913008783421e-02   +1.851587761560761e-01   +1.219733181595205e-01   +1.838167853061346e-01   +2.634134549500701e-02   +1.150004482086749e-01   +1.923970692573385e-01   +1.250916704683524e-01   +1.812583098786717e-01   +5.450658952179632e-02   +3.757053137465796e-02   +2.027525604244456e-01   +1.709524383529554e-01   +2.067366864923977e-01; +7.479591213746102e-02   +1.547537124974793e-01   +6.582828194397672e-02   +1.688680241368320e-01   +8.938519389798993e-02   +1.633370584718770e-01   +1.698323682027305e-01   +1.411429519866265e-01   +8.451715429038421e-02   +2.490625443820951e-02   +1.114315341373024e-01   +1.816304043113411e-01   +5.352198244623620e-02   +1.312387535431307e-01   +1.864129759700351e-01   +7.235659022271837e-02; +2.022061244213969e-01   +1.192446508689545e-02   +1.086534247729539e-02   +4.670135771228501e-02   +2.106157626741671e-01   +1.184280343598367e-01   +1.981654877295733e-01   +9.567028040210415e-02   +2.027228293854147e-01   +5.097988015944326e-02   +2.076188097868445e-01   +1.033573321303940e-01   +9.732294117154966e-02   +1.190059054293870e-01   +4.914543539164433e-02   +1.546449881974160e-01; +1.499060943685965e-01   +1.313677729960231e-01   +5.261094026919130e-02   +6.001747512426146e-02   +1.804081057102453e-01   +8.432275074917406e-02   +1.194585292442309e-02   +2.969280503713273e-02   +8.348232397771556e-02   +6.539426585853267e-02   +3.287302634863946e-02   +1.984196731515759e-01   +1.344229050258354e-02   +4.467028284085865e-02   +2.029217044357139e-01   +1.956753511686629e-01];
L2E_L1E_iAMPA_netcon = [+1.972770778774331e-01   +7.420453866799313e-02   +1.399539547883238e-01   +1.229116501527389e-01   +1.253036727794442e-02   +6.727350452389645e-02   +1.907700511771903e-01   +8.278811676741717e-03; +6.779594217242228e-02   +6.933473004625666e-02   +1.707819630450340e-01   +4.759120441971271e-02   +1.438816821786656e-01   +1.663656401454701e-02   +6.086526727405535e-02   +1.539862559415685e-01; +7.163610918301337e-02   +4.129531910851120e-02   +1.611678075693155e-01   +1.367185542488149e-01   +1.018225143673690e-01   -7.153745736149951e-03   +4.869454129553945e-02   +8.144060293549993e-02; +1.242960647914651e-01   +3.769270577057893e-02   +5.027383522114412e-02   +1.965602615107418e-01   +1.092518781709755e-01   +5.598218297472533e-02   +1.332014211546685e-01   +8.962914631952933e-03; +3.458896956690424e-02   +1.101649822312913e-01   +1.272751536397500e-02   +1.613634342848639e-02   +5.087179351422100e-02   +1.093126999779959e-01   +4.871239176225840e-02   +5.207402640970730e-02; +4.625553576141814e-02   +1.124833230363075e-01   +2.930658979853730e-02   +9.946140281625496e-02   +1.942308820423901e-01   +2.037444329203160e-01   -7.174575783157963e-03   +1.764645670417370e-01; +8.362828419995003e-02   +8.262818725077939e-02   +2.021037952299906e-01   +8.031645122712019e-02   +4.767087865681317e-02   +1.880046414014458e-02   +9.067901243687815e-02   +1.109856748631917e-01; +3.707878593455849e-02   +2.632466296557846e-03   +1.484060409221577e-01   +1.435024139718326e-01   +5.657299838453447e-02   +9.735943018202783e-02   +1.673290813986808e-01   +1.644857764348282e-01; +6.100507678716963e-02   +1.769772775447666e-01   +7.820750913124223e-03   +1.724531596397369e-01   +1.401842250686302e-01   +5.149122403585073e-02   +6.171118853444318e-02   +7.445367229602805e-02; +2.116563728045233e-02   +1.883205633681983e-01   +1.468023815070363e-01   +1.758326806221439e-01   +8.485467576123662e-02   +1.988509778496826e-01   +2.053910146737349e-01   +1.422413216393997e-01; +1.772280609466142e-01   +7.939454596289533e-02   +1.168963981309923e-01   +3.040706894654427e-02   +9.904451189533646e-02   +1.578573731287570e-01   +7.088663069911014e-02   +3.729115383145995e-02; +1.249800250973318e-01   +2.080103994115013e-01   +8.628208563555603e-02   +1.832775004036978e-01   +2.065956927457186e-01   +1.627163931523157e-01   +1.004254068796201e-01   +2.097385256762571e-01; +1.033854113338992e-01   +1.164432931856495e-01   +3.786911781952947e-02   +1.818304970019816e-01   +3.165610733095209e-02   +1.477188977613551e-02   +4.458259149696694e-02   +6.295525140677112e-02; +9.441513719224912e-02   +1.220983528737241e-01   +1.865950771017799e-01   +8.733039679809480e-02   +9.799715438722133e-02   +1.250685310376337e-01   +1.770572437612850e-01   +1.133395853092406e-01; +1.736654153487924e-01   +5.055530627783323e-02   +8.087133695115777e-02   +4.310815169150484e-02   +4.799085661808452e-02   +1.691806980366163e-01   +1.996269728171700e-01   +1.376275509825307e-01; +1.245198075001691e-01   +1.300008677381427e-02   +5.267725622860202e-02   +1.573522116493263e-01   +1.052718997151756e-01   +1.113116532327387e-02   +1.045788225013929e-01   +1.590030250443509e-01];
L1E_L2E_iAMPA_netcon = [+2.466231264952979e-02   +7.084971052465175e-02   +1.555645419692128e-01   +1.560834147284278e-01   +8.171140904459703e-02   +1.248434792170908e-01   +1.202517450161076e-01   +1.873643319067300e-01   +1.638274328279711e-01   +9.717239590177515e-02   +5.941174988749778e-02   +1.920533582921669e-01   +9.582242287949130e-02   +5.936340526782920e-02   +1.164359720876126e-01   -1.329489881678136e-04; +1.530630623546543e-01   +1.438619743820098e-01   +1.988684717455665e-01   +4.448486435057291e-02   +8.846988472334952e-02   +1.499212931699977e-01   +1.476445207754010e-01   +4.474859636050240e-04   +4.614351015220186e-02   +5.339878065394615e-02   +1.487670328936198e-01   +1.368339967228674e-02   +1.615325726340930e-01   +1.100622874703656e-01   +5.177069644127472e-02   +1.691176148985308e-01; +6.546430186927517e-02   +7.994996860782839e-02   +5.064930231169315e-02   +2.065173452335477e-01   +1.242704239828102e-01   +1.229626098602499e-01   +1.693070953301169e-01   +5.886305344840456e-02   -2.239759341348086e-03   +5.310033229320562e-02   +4.469009271611576e-02   +1.256785470209965e-01   +1.875497691311824e-01   +4.011716404543000e-02   +7.437666695717952e-02   +1.130931155950207e-01; +3.783109547372907e-02   +7.025057226174827e-02   -2.135444754622269e-03   +1.043792291985918e-01   +1.657679133134668e-01   +1.703565050886328e-01   +1.483978126353301e-02   +5.146961921118421e-02   +1.772156231958578e-01   +8.680806285210575e-02   +1.635857816697297e-01   +6.512108076750270e-02   +2.097501462322403e-01   +5.372525173031611e-02   +4.553781600130258e-02   +1.180458258990023e-01; +4.021258735804707e-02   +3.424168651143700e-02   +7.736515810008229e-02   +1.042241712048286e-01   +5.854521908566978e-02   +1.304349612047919e-01   +1.256057687840431e-01   +9.082416415492693e-02   +6.029853403064710e-02   +1.503763523050443e-01   +6.458340427991849e-02   +1.281139075290769e-01   +2.588179421173826e-02   +7.542815307058745e-02   +1.834280746051638e-01   +1.760258247559589e-03; +1.009789135666654e-01   +1.006638929708764e-01   +1.722588484780265e-02   +1.013020148409259e-01   +1.241796540452976e-02   +8.059259644642125e-02   +1.354236916091283e-01   +1.423137975306220e-01   +4.638058943645936e-02   +1.657109287334438e-01   +1.797423143052017e-01   +5.941913921994139e-02   +3.336210442547984e-02   +1.046258325640942e-01   +6.307846350372916e-03   +1.287709318540799e-01; +1.482983727251741e-01   +2.763266385353606e-02   +9.760028474315438e-02   +1.477871163357253e-01   +3.827976461063780e-02   +1.733474255153572e-01   +1.708889928774059e-01   +2.818107048379388e-02   +2.017953664223736e-01   +1.942429713003756e-01   +1.124497599727850e-01   +7.939735998323490e-02   +5.482094691508201e-02   +7.245971413035013e-02   +1.640623401838019e-01   +9.253632789904363e-02; +3.574826223365591e-02   +7.178313985341844e-02   +2.022898369049964e-02   +5.362014399515359e-02   +1.826369155165949e-01   +5.871251429776091e-02   +5.709474028905822e-02   +1.573469148522573e-01   +1.908085922613925e-01   +1.321062452421080e-01   +7.216073737374590e-02   +1.890222059385630e-01   +6.117042385938885e-02   +1.934052805512828e-02   +1.913137709337662e-01   +1.483550937781460e-01];
L2I_L2E_iAMPA_netcon = [+1.196342892872467e-01   +1.600670376785295e-01   +1.794589688897179e-01   +1.847969872504243e-01   +6.813749108498680e-02   +2.120176734343883e-01   +1.778550987562867e-01   +9.419985238727450e-02; +3.050928163230352e-02   +1.531003351297058e-01   +1.084302381378549e-01   +1.252545864655665e-01   +7.275872028438006e-02   +1.392998593342535e-02   +1.639898567361084e-01   +1.270999450028009e-01; +9.327443837282264e-02   +4.490638290640828e-02   +1.851870722601369e-01   +1.277860290354398e-01   +1.105906357404052e-01   +2.028939007578346e-01   +2.666086080081443e-02   +3.922951287162642e-02; +6.080271497070966e-02   +1.532790252853516e-01   +1.744293821508447e-01   +1.510359159485003e-01   +2.112973784730982e-01   +1.951212396455392e-01   +1.312800441855247e-01   +1.833772597664089e-01; +6.312933530987941e-02   +1.987099334317385e-02   +1.935002938765128e-01   +2.072392661946847e-01   +1.646866386414265e-01   +2.884263598240536e-02   +1.281173975196337e-01   +1.692175337314898e-01; +4.470521143474389e-02   +1.667446453351849e-01   +1.521921288939393e-01   +1.153866104765386e-01   +1.150173890086039e-01   +1.862407182986677e-02   +1.243184933485791e-01   +1.807403718659395e-01; +2.196334236889104e-02   +1.422949795996140e-01   +1.189805524550218e-01   +5.033432665828496e-03   +1.835724888576034e-01   +9.157685105604454e-02   +1.618429828407079e-01   +1.817927454815816e-01; +1.729573996579759e-01   +6.246193215319461e-02   +1.237463542876959e-01   +1.433618002136483e-01   +3.777209318833282e-02   +1.607633494370908e-01   +9.568081638844045e-02   +9.657986115993676e-02];
L2E_L2I_iGABA_netcon = [+3.863849765914616e-02   +1.448699039725110e-01   +1.928833125042067e-01   +1.476274722648422e-01   +2.052669063622245e-01   +1.615710944814822e-01   +1.879679894466033e-01   +1.301188164047788e-02; +1.956478275101373e-01   +1.840680955115545e-01   +1.050781391093432e-01   +1.682350522378522e-01   +6.135393920530734e-03   +1.828419771880380e-01   +3.977215868147377e-02   +4.614797719338394e-02; +6.711981304819585e-02   +6.453929214348986e-02   +1.399528192546190e-01   +6.763241613643249e-02   +2.011166444195792e-01   +4.298576044496358e-02   +2.639944165906769e-02   +4.057693498434212e-02; +1.518354041375990e-01   +1.406497936273405e-01   +3.483324993596502e-02   +1.234961708009860e-01   +2.355002193114068e-02   +1.014442935270967e-01   +1.735747969451980e-01   +1.017350926439006e-01; +1.392448129650324e-01   +1.119932024847883e-01   +1.619275212633413e-01   +1.023265108020907e-01   +2.635246565026792e-02   +1.281685491187370e-01   +2.027696810729734e-01   +9.294918501491337e-02; +1.427303893558756e-01   +5.618044513222115e-02   +1.997274309312634e-01   +2.306077128371194e-02   +1.295378165483172e-01   +7.806295437670892e-02   +1.736197111552242e-01   +1.571932398813244e-01; +2.022228553762771e-01   +1.758822899002519e-02   +1.228669224172198e-01   +6.762034069043112e-02   +5.204418808958636e-02   +2.064725017373792e-01   +1.711475747919153e-01   +5.483759845672104e-02; +2.067050314842045e-01   +1.782042645468913e-01   +1.727048612994861e-01   +2.947786951980831e-02   +2.096640121206898e-01   +2.764464964274172e-02   +1.701564481450545e-01   +1.873593179802846e-01];
L3E_L2E_iAMPA_netcon = [+1.347438509128353e-01   +2.248532465197731e-03   +1.186746476618613e-01   +2.757110502178922e-02   -1.187421979369996e-03   +1.867125563660373e-02   +5.903967463714049e-02   +1.872308151660735e-01   +7.766648630274491e-02   +6.875241172959895e-03   +7.118804751796735e-02   +1.998190027571723e-01; +1.652957047200158e-01   +1.745077279799434e-01   +2.406894461298165e-03   +1.071260055632941e-01   +1.673905776542346e-01   +1.594022527985013e-01   +1.378837903588407e-01   +1.132457398546832e-01   +1.714766629452711e-01   +1.560034212015703e-02   +9.676214551600452e-02   +5.122613656218409e-02; +1.337598354548621e-01   +9.809745873748940e-02   +1.844549673890704e-01   +1.336013659718483e-01   +1.410960334332975e-01   +2.313323745004627e-02   +7.290176859624282e-02   +1.058882982846027e-01   +5.470780422630311e-02   +1.137052636308396e-01   +1.190710800522170e-01   +2.017673327528260e-01; +4.351162663149655e-02   +3.865596414798830e-03   +1.506337190997366e-01   +8.873905233434233e-02   +1.171877446226847e-01   +6.977168746061728e-02   +1.235249236565852e-01   +1.215620393816351e-01   +3.521550182335599e-02   +1.940886247104581e-01   +9.267867187799020e-02   +4.880247981152200e-02; +1.264243586399923e-01   +1.003478302163070e-01   +6.652185622823342e-02   +9.440263600612532e-02   +1.794812515761363e-01   +1.380479837140574e-01   +1.755746671999298e-01   +1.673711563283526e-01   +5.192581742601328e-02   +1.839165144435007e-01   +1.111187267808665e-01   +1.506612943675479e-01; +1.304369152169293e-01   +1.922123859021580e-01   +1.822720235040801e-01   +3.804722447853398e-02   +1.196228243340407e-01   +7.956767196218832e-02   +3.366102286705137e-02   +3.951894114441164e-02   +1.302031269567249e-01   +3.014416963245297e-02   +3.448082556949375e-02   +9.867853455719414e-02; +1.943320218511534e-01   +1.094329192519762e-01   +2.059509261631151e-01   +1.586799444809117e-01   +6.635452409111187e-02   +1.395326961482668e-01   +1.256881999633389e-01   +5.681900162453762e-02   +1.133349422096368e-01   +1.629445463374431e-03   +1.984616204039614e-01   +1.904353166204516e-01; +1.177464748973128e-01   +1.835612845946342e-01   +1.950615686801432e-01   +2.080183412170216e-01   +1.897279743797374e-02   +1.479909807185214e-01   +1.677758411916321e-01   +3.302800413257353e-02   +1.959616776389246e-01   +1.676185160497884e-01   +1.985752888061095e-02   +3.323217759064050e-02];
L3I_L2I_iGABA_netcon = [+1.597301938416683e-01   +1.428437162639665e-01   +9.397817612086524e-02   +1.844538376283804e-01   +1.680047449895351e-01   +2.014046932933297e-01   +1.347552392056919e-02   +2.042314322329172e-01   +1.775481902428939e-01   +8.747540971130668e-02   +3.539307874497507e-02   +2.998605505238350e-02; +1.552553904347398e-01   +9.785901677900982e-02   +1.455721389199554e-01   +1.347494797514936e-01   +1.347357798011682e-01   +1.004253312049493e-02   +5.224430667653176e-02   +1.989465359567890e-01   +7.591643665911575e-02   +1.444484111772723e-01   +1.448016236174455e-01   +1.012284884032106e-02; +3.853087850829209e-02   +1.106181115565815e-01   +1.827150822672391e-01   +2.126500942625819e-01   +5.628127945948887e-02   +1.871877531999059e-01   +1.461121410883414e-02   +8.693491303368263e-02   +1.028460271080876e-01   +6.456636708391107e-02   +1.764082501109676e-02   +9.641101721098894e-02; +1.643346021056385e-01   +7.004910700402588e-02   +1.936599060519762e-01   +2.040703308960996e-01   +4.150663909970620e-02   +1.454798347679861e-01   +1.338397216984978e-01   +1.283203080150291e-01   +1.339101669033422e-01   +6.511904914483901e-02   +1.316593339224999e-01   +1.626115088908904e-01; +4.464887095051255e-02   +2.054218760365416e-01   +1.723783637834460e-01   +7.948870466668138e-03   +8.575756668241778e-02   +1.720362013753636e-01   +1.164078824510165e-01   +1.952890990080655e-01   +5.486477889161797e-02   +1.471072055301427e-01   +1.621432675567857e-01   +1.128746076515692e-01; +7.038721370386110e-02   +1.597955376584766e-01   +1.327348425820629e-01   +1.391576574134952e-01   +1.811320125875493e-02   +6.243435992244143e-02   +1.209357030044704e-01   +1.595295316575309e-01   +2.024119571191724e-01   +4.850229871986915e-02   +1.138607663089660e-01   +5.724331971982240e-03; +1.411845844661581e-01   +1.162728577528988e-01   +1.117460434766640e-01   +1.494892131297917e-01   +1.150693908201421e-01   +6.730924307605196e-02   +2.701738140432877e-02   +4.816299801769619e-02   +5.614540432136993e-02   +1.857994882544045e-01   +1.949688922877494e-01   +1.498514251771564e-01; +1.403334269119702e-01   +1.724457426730573e-01   +1.550935923274535e-01   +1.949466781552271e-01   +1.994988344707814e-01   +3.764660075668246e-02   +1.747113473100027e-01   +1.738629130411577e-01   +1.360344418571091e-01   +2.113988072767096e-01   +8.428787643397669e-03   +9.742373115682043e-02];
L2E_L3E_iAMPA_netcon = [+8.144711075240800e-02   +1.837017598160722e-01   +6.744878508406148e-02   +1.973186380722468e-01   +1.147601003023052e-01   +1.351290754173878e-01   +1.375328547106893e-01   +8.503991228448100e-02; +1.228887289155219e-02   +4.211777724168735e-02   +1.337291609631992e-01   +7.473759574543208e-02   +7.709911474974164e-02   +1.116680666569387e-01   +1.742543742369686e-01   +1.901186124647306e-01; +1.978781959829959e-01   +7.043620070540182e-02   -4.591866977800346e-03   +9.925444072290643e-02   +1.202662673159677e-01   +1.968899433938797e-01   +1.021259514514248e-01   +1.245890130364896e-01; -1.072035658056125e-02   +1.609637422940979e-01   +6.911326616274573e-02   +2.050659886809775e-01   +1.670737395005500e-01   +1.725743535720707e-01   +5.723840392955389e-02   +1.653049621639549e-01; +9.842782910152645e-02   +6.661693566836220e-02   +4.401320162908801e-02   +1.235660089187132e-01   +1.356962395375265e-01   +9.756086882287903e-03   +3.099960444598014e-02   +1.294309428212792e-01; +1.597611469233656e-01   +4.579991748489859e-02   +2.541072497381083e-02   +6.907630088095769e-02   +2.090866428425069e-01   +1.670686674445453e-01   +5.111057492925927e-02   +1.048706194907791e-02; +1.530810235765777e-01   +1.063554195443909e-01   +1.163531056063199e-01   +6.110750093894374e-03   +9.862316819104627e-02   +1.783218065340557e-01   +2.030934104784382e-01   +1.110038734801272e-02; +9.765654298312727e-02   +1.575523897187716e-01   +1.573229908884268e-01   +4.802247936249437e-02   +1.154706752610869e-01   +1.250282539753120e-01   +1.190344857873185e-01   +1.464199235199952e-01; +5.443963035816583e-02   +9.911955842324026e-02   +1.305061803929145e-01   +2.497222601276691e-02   +1.320903369922022e-01   +4.989953195696892e-02   +8.482844087248566e-02   +1.902946812728054e-01; +6.242780261376928e-02   +1.250840320633141e-01   +1.158519838995676e-01   +6.626339158419516e-02   +5.439397452209746e-02   +1.113262483390929e-01   +1.297579514516654e-01   +8.899812015952788e-02; +8.110206595028925e-02   +5.638584394954727e-02   +1.739269397314007e-01   +1.666503331975980e-01   +9.302252094426440e-02   +1.036441495939405e-01   +2.111550702472075e-01   +6.036938037437722e-02; +4.351496076214074e-02   +1.021967679129460e-01   +1.075656611638120e-01   +1.975113626019601e-01   +6.226134956516817e-02   +1.205061715800029e-01   +9.692784295370725e-02   +8.068547415418018e-02];
L2I_L3I_iGABA_netcon = [+8.701574770681690e-02   +2.989033752389009e-02   +2.056731338771662e-01   +1.308822490373874e-01   +1.179633286435617e-01   +1.586371847535097e-01   +1.300311597175325e-01   +1.731301226319921e-01; +4.767878208962802e-02   +1.548475248380078e-01   +1.902221850095830e-01   +1.214010397180217e-01   +2.016719788253215e-01   +1.023229431355588e-01   +1.446201079919671e-01   +1.523216851889476e-01; +4.931198060097848e-02   +2.040888247543487e-02   +5.321483834488060e-02   +3.981188197048246e-02   +1.697327353789642e-02   +5.605398640731624e-02   +1.551961273167813e-01   +1.072404216132084e-01; +1.081792195942334e-01   +1.641450616219260e-01   +1.711738838427584e-02   +6.176035649806638e-02   +1.084757926758694e-02   +1.845411761332225e-01   +1.771312386075951e-01   +2.018165055904790e-01; +1.727508059957642e-01   +1.748395629532976e-01   +1.855481621146651e-01   +1.779116301983088e-01   +1.996689309693211e-01   +1.231848165842566e-02   +1.455611098861683e-01   +1.588927720358105e-01; +9.795453896621316e-02   +4.719332684266031e-03   +3.624192406538745e-02   +9.889877224020027e-02   +5.355343681592695e-02   +1.003517846048302e-01   +1.854375465937042e-02   +1.591826280434282e-01; +1.239277377725834e-02   +1.422740012304959e-01   +6.567538680816551e-02   +2.103521826720420e-01   +1.753981670389994e-01   +9.322595102278736e-02   +1.717995098174459e-01   +1.987582597016770e-01; +2.044991011668054e-02   +3.365061380275075e-02   +1.011048183333729e-01   +1.023069011190804e-01   +5.942145125338386e-03   +1.988891306778651e-01   +1.021918190146707e-02   +2.254552474488927e-02; +5.460816365655188e-02   +8.710318949566162e-02   +1.076610751993903e-01   +1.405712224442649e-02   +1.858333096861652e-01   +9.512713763429125e-03   +1.075168696523117e-01   +8.274456644612918e-02; +1.333644009462570e-01   +5.008940564843414e-03   +1.592680227565840e-01   +1.416104773264652e-01   +8.391675154206697e-02   +1.717282215336164e-01   +3.073740304860830e-02   +8.439994589117240e-02; +2.140814441239031e-01   +6.107446959580080e-02   +1.581996671891193e-01   +1.256106816089740e-01   +8.277961964092362e-02   +1.015473313393545e-01   +1.278103316308897e-01   +9.123680178076982e-02; +1.833161386675965e-01   +7.261313705743742e-02   +1.594904826977127e-01   +7.315635092990463e-02   +9.700063528135333e-02   +1.316779490879584e-01   +1.436171169173369e-02   +1.177760096025661e-01];
L3I_L3E_iAMPA_netcon = [+7.237118647014178e-02   +5.520294789456002e-02   +1.178623044843793e-01   +3.425734749864056e-02   +1.128049329837529e-01   +1.263651975794976e-01   +1.282572423063453e-01   +1.900672624580645e-01   +5.971441459404060e-02   +9.619134113741595e-02   +3.183556594491696e-03   +1.455144589568133e-01; +1.395857892530078e-01   +9.214344060281318e-02   +5.140535376139817e-02   +9.228323583396816e-02   +1.602154314684892e-01   +9.409619620511735e-03   +5.575664602441457e-02   +8.544195329491722e-02   +1.861913910360040e-01   +1.409718167900101e-01   +5.958879002536858e-02   +1.861051324114630e-01; +4.501623634848156e-02   +7.223165969386294e-03   +6.597338559878872e-02   +9.688835684429810e-02   +4.762696016770236e-02   +2.657381567656610e-02   +3.993605355122207e-02   +1.901562810839539e-01   +3.523032652487728e-02   +6.148437823786218e-02   +1.541783063712699e-01   +1.860877706174559e-01; +1.521846143636414e-01   +1.505119632502520e-01   +6.722488820801821e-02   +2.120137266160960e-01   +1.316898869125150e-01   +1.425121529593176e-01   +1.664263971076181e-01   +6.190489005006657e-02   +1.340203823141486e-02   +1.843998938475224e-01   +2.864888484169826e-02   +5.126044074158074e-02; +2.612054050155840e-02   +1.271059264423596e-01   +6.702357346766835e-02   +3.569761836670746e-02   +2.857424378509631e-02   +1.167816834972323e-01   +1.368665313839079e-01   +8.328280765577913e-02   +1.041799038013699e-01   +9.451677090108096e-02   +1.070423307680948e-01   +1.446749440170036e-01; +1.201716107818222e-01   +1.260488114642783e-01   +6.053336511057875e-02   +9.664150423060544e-02   +1.212954441233171e-01   +5.727448817152751e-02   +1.367399884191613e-01   +1.836368598465868e-01   +1.900283787660090e-01   -3.122945695134658e-05   +3.014806674126137e-02   +2.627262624616882e-02; +1.854522918652829e-01   +1.539524110779844e-01   +1.894894632465662e-02   +1.227924423398605e-01   +1.492585066420480e-01   +1.109089195141774e-01   +1.781591049895276e-01   +1.963258509988318e-01   +1.980095013539937e-01   +4.675212109495468e-02   +1.876135553475566e-01   +1.868603226687023e-01; +6.323992562827796e-02   +7.461234672906811e-03   +3.656516500054994e-02   +1.270621675193416e-02   +1.679127632166730e-01   +1.584139284559205e-01   +1.028451359895179e-01   +6.257219887589788e-02   +1.284458596084760e-01   +1.375066878596727e-02   +8.304795204073626e-02   +5.287872145153861e-02; +1.104673921450874e-01   +1.835332531050995e-02   +1.267047937596522e-02   +1.444631400215962e-01   +4.969098592961897e-02   +1.858741197670835e-01   +7.422694800750581e-03   +1.289608540558648e-01   +1.421453618912327e-01   +1.446821085690281e-01   +6.939651064269568e-02   +1.369283266288023e-01; +9.938221225389443e-02   +1.503363649349997e-01   +1.311638110882530e-01   +2.113246317964194e-01   +1.887492678491054e-01   +6.468888962482784e-02   +1.150431979797673e-01   +1.237151255691203e-01   +3.693141526593029e-02   +1.215799271792727e-01   +8.893574192484340e-02   +3.654451647791671e-02; +1.579484594158796e-02   +1.813990805582301e-01   +3.846281937989403e-02   +6.214304486461972e-03   +1.721063769716850e-01   +2.050067049329233e-01   +1.275406132170332e-01   +1.499418026574442e-01   +1.103645397984312e-01   +3.212552445647450e-02   +1.449255310261585e-01   +1.804560127550593e-02; +3.900012940763154e-02   +1.274412617101492e-01   +3.868367972102402e-02   +1.750908578033682e-01   +1.785452590256415e-01   +7.099701220021643e-02   +5.932829875385295e-02   +1.303236231524753e-01   +1.501002456878301e-02   +6.487602259095336e-02   +1.218702452921295e-01   +5.432388821733432e-02];
L3E_L3I_iGABA_netcon = [+1.620756042926436e-01   +1.183697333206565e-01   +5.070378006536136e-02   +1.076206207400253e-01   +1.168381109431152e-01   +2.986886808336641e-02   +1.209585470430857e-01   +1.605187764001257e-01   +1.181006664897633e-01   +4.109711841506973e-02   +5.848738000892459e-02   +7.234094079846276e-03; +1.356896975232245e-01   +2.510659644412471e-02   +6.610212668966169e-02   +1.769303078973903e-01   +8.198804658560253e-02   +1.810041232249131e-01   +1.434828540367812e-01   +1.626108690911086e-01   +5.772428445941617e-02   +8.368728680904750e-02   +9.902193855470678e-02   +9.455908443695797e-02; +4.170826636837541e-02   +5.186729913540613e-02   +2.117478034520875e-01   +1.591263492343488e-01   +1.655066375461472e-01   +4.730735782720891e-02   +9.267315181058364e-02   +1.849679744012730e-01   +1.563766840969652e-01   +9.601883006945111e-02   +1.895762367741633e-02   +5.452601851255751e-02; +6.558962461959153e-02   +8.522302914529593e-02   +1.851266961638326e-01   +1.450581236763387e-01   +4.047514722350622e-02   +1.630096525620707e-01   +6.136021210630176e-02   +1.231963038863698e-01   +1.362620502569512e-02   +1.923582364818043e-01   +2.094222148814848e-01   +8.502642388311089e-02; +1.664032088625185e-01   +8.927404490957792e-02   +1.628685701606832e-01   +6.277147163085142e-02   +1.423573080981176e-01   +6.110682143472863e-02   +1.951603511151480e-01   +7.632326461506941e-02   +1.707341860825345e-01   +9.698488629405708e-02   +9.200806915074221e-02   +9.967416715560949e-02; +1.959640734932134e-01   +8.502835522472799e-02   +1.216765885758485e-01   +3.583649849839864e-02   +1.688319116913736e-01   +1.799265120789165e-02   +1.744086754308973e-01   +6.477272197089007e-02   +1.044941636761176e-02   +5.036762527214680e-02   +1.613280763207708e-01   +4.450665005309742e-02; +1.307096023616905e-01   +1.514807328416444e-01   +7.442468273614926e-02   +3.627133013466140e-02   +3.286083840922589e-02   +1.954892209904440e-01   +3.444721887565565e-02   +1.925426254667639e-01   +1.276974624048432e-01   +1.541645763954465e-01   +8.019440819465351e-02   +5.168823065572239e-02; +6.350145533346911e-02   +1.088014510592425e-01   -4.313401254218329e-04   +2.011819244236014e-01   +3.215619349671885e-02   +8.196791203702204e-02   +4.755593100980780e-03   +3.176295777762628e-02   +1.591886664305200e-01   +1.533981391122947e-01   +9.471680688391608e-02   +1.022228081464061e-01; +1.595082664787693e-01   +4.340603490955645e-02   +1.079367538266130e-02   +1.434904223106304e-01   +9.528164935432180e-02   +1.150117218989665e-02   +1.272692617458989e-01   +6.441154063006728e-02   +1.891219302741348e-01   +1.913463999583502e-01   +3.896785219827179e-02   +2.124754543485048e-01; +1.105325343336779e-01   +2.077244730610431e-01   +2.073317848709367e-01   +1.472116946580654e-01   +2.763904556324994e-02   +1.790481332989007e-01   +9.060767797527168e-02   +5.336669498545640e-02   +1.208444426039783e-01   +2.264189917281506e-02   +1.417622811291707e-01   +2.084332775952345e-01; +2.383749855379349e-02   +1.028738746031974e-01   +1.835385989114594e-01   +1.130248099899261e-02   +1.095465706476362e-01   +1.780127464646529e-01   +1.427917743856641e-01   +5.963000972216352e-02   +5.446088052222784e-02   +9.221586034666640e-02   +1.626625551756374e-01   +2.010723193093707e-01; +1.580955575457844e-01   +3.047262724810866e-02   +1.427234805600170e-01   +1.573247684037899e-01   +1.844185218676911e-01   +2.398717474376342e-02   +1.508018484899794e-01   +1.538976993639516e-01   +9.626272154801598e-02   +1.676835704606486e-01   +7.494413867039487e-02   +1.205614784829675e-02];
L2E_Input1_iAMPA_netcon = [+1.436081048240420e-01   +1.595199182936472e-02   +2.880420688242536e-02   +1.848640842859523e-01   +4.787238867128374e-02   +1.841301846858725e-01   +1.700836455582699e-01   +1.119799691715070e-01];
L2I_Input2_iAMPA_netcon = [+1.823539905265650e-01   +3.351190172054912e-02   +1.966553929866632e-01   +1.812828757267801e-01   +1.328517420305602e-01   +1.789166982723644e-01   +7.105244422513546e-02   +1.594354378482143e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = -20*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
