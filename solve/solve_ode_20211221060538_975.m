function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.448915187165576e-02   -1.263047618444199e-02   -1.220182425042478e-01   -5.523358780685108e-02   +5.755885711523323e-02   -2.095564638541054e-01   +6.109969625291691e-01   -3.150916247332797e-01   +2.587931840248339e-01   +4.487548624747989e-01   +3.938542676032070e-01   +5.972777735710901e-03   -2.387013279023106e-01   +6.418767949940213e-02   +4.741662394212013e-01   -8.922159076532776e-01; -4.849942659791275e-01   -4.317429875329680e-01   +1.574739560674017e-01   +3.685886824762404e-01   -1.311711971407133e-01   +7.118619717695451e-03   +3.095221682815582e-01   -2.014990012970655e-01   -5.445035300407715e-01   -5.070300480572444e-01   +4.162320416172373e-01   -1.650804567990005e-01   -5.044265644474003e-01   +2.977826525197497e-01   +3.884796602337109e-02   +3.408543689302102e-01; +5.922940074420269e-01   -2.916220969993744e-01   +3.753663450773385e-01   -3.478625972499276e-01   +3.692471645868798e-01   +4.579341939304252e-02   -1.750723275511553e-01   +4.073089270459930e-01   -9.500701286639410e-02   +6.126092393639941e-01   -2.040361688661560e-02   +1.927616797568674e-01   +4.930621277394536e-01   +1.808281383489074e-01   +4.600716081615094e-02   -1.122020145733683e-01; -1.638597466289269e-01   -3.804702633670901e-01   -1.766123646566621e-01   -5.711616893539556e-01   +6.628790183997606e-02   -1.417146894847124e-01   -3.036083485603355e-01   -5.706361574993364e-01   +5.006823270373927e-01   -6.314998598740945e-01   +9.253498787391362e-02   +4.402933947500446e-01   +3.374022278972072e-03   -1.808628375295393e-01   +4.256677513768046e-01   -5.210430314048318e-01; +1.871932634526755e-01   +3.593536987117093e-01   +2.589297629468078e-01   -1.111183032159496e-01   +2.445228400656439e-01   -3.036880956018522e-01   +6.311568271583610e-01   +6.607669827000610e-01   -1.791904310253079e-02   +6.047222824564952e-02   +5.800282731920560e-01   +4.706027131398141e-01   +6.117253903127288e-01   -4.424726893432847e-01   +3.145429966048988e-01   -1.252854764799934e-02; +7.440061011247489e-01   -7.193087606682879e-01   -2.158388950375680e-01   +7.638188306639467e-02   -1.332497698968431e-01   +4.075915415257100e-01   -3.851595147455630e-01   +3.425598445544819e-01   +1.216859313263577e-01   -3.230763451092332e-01   +1.895775296507242e-01   -2.380736699150368e-01   -2.041864787698566e-01   -3.787343318769494e-01   +3.986442168566386e-01   -3.211342217939713e-02; +1.896938544394857e-01   +1.797115841695603e-01   -4.959018747378219e-02   -5.197087383871223e-01   -4.965481518817623e-01   +1.563421184163892e-01   +3.917668888545242e-02   +9.988903706804721e-02   -6.229336676172039e-01   +2.902403356801494e-01   +3.328632426395117e-01   +3.036909429965770e-01   -7.792501630603320e-02   -9.057113374003700e-01   +2.091679024377754e-01   +4.337548303931869e-01; +2.930254379267693e-01   -3.540474842512299e-01   +3.028235292777060e-01   -2.181279809644353e-01   +1.155354461937906e-01   -6.539227385023265e-01   +4.134902371831153e-01   -1.869993018161130e-01   -4.054382816294335e-01   -2.517431214669186e-01   +2.591901485657524e-01   -1.718477993237460e-01   +1.573918200108543e-01   +2.793862336643075e-01   -4.654242934821273e-02   +6.497327472621452e-01; -5.645338493986363e-02   -4.480110708889574e-02   +8.869977205459867e-02   +2.700751355043800e-01   -3.069015374868858e-01   +7.807124150706894e-01   +4.254546105769216e-02   +4.589423262892349e-01   -4.373356574110812e-02   -2.772299224794819e-01   -3.504451354489593e-01   +6.962132383760542e-01   +2.185869367502023e-01   +1.345292817466712e-01   +2.448449743968349e-01   +3.807551076137486e-02; +3.883281263214052e-01   -1.723039396507305e-01   -3.605684340849550e-01   -5.785390557005379e-01   +4.888860072905257e-01   -5.860943986712865e-01   +1.120732859216597e-01   -2.103173172048708e-01   +2.407398773945806e-01   -3.771361565807522e-01   +6.694514438454380e-01   -4.673387585255262e-01   -3.923027980829672e-01   -3.520555259618615e-01   -4.005996601246882e-01   +4.793824633727509e-01; -4.256834437520915e-01   -1.889025933970477e-01   +8.509044994884696e-02   -2.256417962449533e-01   +9.399645556094274e-02   -4.708987365176919e-01   +2.612959569087142e-02   -3.838444779934076e-01   +4.165816287912886e-01   +1.886828263239441e-01   -2.862979109339213e-01   -4.506846185301285e-01   +3.458511071439367e-01   -3.475577521995000e-01   -9.135764268569135e-02   +3.382281663420444e-02; -1.941151601336513e-01   -1.555336961362828e-01   -2.058320205633673e-01   +7.917834585604800e-01   -3.917379839458313e-01   +7.410088456333880e-02   -1.845435666356509e-01   +7.722754087656475e-02   +2.850625978122706e-01   +2.189926801641246e-01   -5.779276251940627e-01   +9.097475179432724e-02   -4.250566824240522e-01   +5.787170235033832e-01   +6.527856429582497e-01   +3.455966558054676e-01; +3.106340833404780e-01   -3.746293015286961e-01   -7.372941209323415e-01   -5.122317239336918e-02   +3.971272198559330e-01   -3.703660489474895e-01   -2.708760291381200e-01   +1.348061079667832e-01   +2.726613280169508e-01   -1.461325079261560e-01   -5.325331860595308e-01   -1.550442415086017e-01   -4.137509078743736e-01   +2.973124997963795e-01   +2.629843237576706e-01   +5.606253551307647e-01; -6.875171647377577e-01   +1.695003768578311e-01   -5.215598968215460e-01   +1.325204598383217e-01   +1.181708361366716e-01   +2.516528444911512e-01   +5.747341247370124e-01   -2.309968567348056e-01   +5.611765345602275e-01   +4.571438883248082e-01   +3.652845254895203e-02   -1.480921954776534e-01   +4.572500644523533e-01   +3.734843619985478e-02   -1.408678499495176e-01   -1.599488732835309e-01; +4.378210133513624e-01   -5.029317765761820e-02   +3.461300260725901e-01   +3.352463784378232e-01   -3.078711709649873e-02   +1.025923921849812e-01   -3.950962934007367e-01   +5.405314972641095e-02   -2.020743434783394e-01   -1.921219375918118e-03   +5.647673235060033e-03   -1.674245016937023e-01   -4.529736759430438e-01   +6.063690432984739e-02   +4.444213474173537e-01   -4.744397944024860e-01; +2.066493667938752e-01   -3.623861407710839e-01   +3.623610813788852e-01   +8.084345495619745e-01   -1.419412272359281e-01   -2.282118688597006e-01   -3.420828422992807e-02   -1.132929219961172e-01   -4.032517121304209e-02   +8.890716301796717e-02   -1.675294651059239e-01   +1.009076896601084e-01   -3.945563914401374e-01   -7.414409105990197e-01   -3.231544336460920e-01   +3.354037466799739e-01];
L1E_L1I_iGABA_netcon = [-1.664353957064041e-01   +1.565791090530985e-01   +5.598814372921558e-01   +3.452292409290007e-02   -7.567280575094565e-01   -1.081899695913403e-01   -9.248571420962524e-02   -2.591631101092550e-01   +2.784767370613039e-01   -4.712365520826611e-01   +5.329207997102924e-02   +8.243937956897388e-02   -3.552032253016738e-02   +1.877931903402655e-01   -2.918456890883372e-01   -6.599932893237115e-02; -5.389726001325579e-01   -6.498359792478782e-01   +2.129929875803393e-01   +3.642958295599357e-01   -1.339829905425127e-01   -3.752288425885487e-01   -6.005623823547358e-01   +6.481439645150078e-02   -1.817041936658496e-01   -1.444346116517282e-01   +3.819618374323716e-01   +2.286553255778750e-01   +1.690614432691368e-01   +2.310968619867010e-02   -2.715632900637623e-01   -8.206678409686473e-02; +7.152854473275064e-01   +4.545171566950558e-01   +2.344575704785082e-01   -1.382003778063177e-01   -4.583859994984632e-01   +4.717165492372120e-01   +4.631054574064065e-01   -2.089752007314512e-01   +3.712311133539822e-01   -2.206214900085677e-01   +6.529007033837261e-01   -1.363139304686623e-01   +3.864240057654909e-01   -3.994816135039838e-01   -8.272323674941340e-01   +7.552332315841979e-01; -1.458250950283277e-01   +1.544996474364110e-01   +1.000000000000000e+00   -5.901632352811014e-01   +3.941317004883138e-01   +3.357952350932430e-01   -1.539075861398009e-01   -4.271361611836548e-01   +2.334330781515628e-01   +4.307714720880044e-01   -8.507069499019576e-02   -9.276233188513494e-02   -3.012044756688835e-01   +1.431512324526806e-01   +3.794396512412467e-02   -6.662231760735655e-02; -1.859486259469821e-01   +3.483883468444761e-01   +4.600122363372218e-01   -4.980851964842216e-01   +1.204905887242481e-01   +7.673707143052368e-02   +3.116075204776956e-01   +4.518864126762328e-01   -1.251353438443616e-01   -4.422385492632650e-01   +3.879080997794079e-01   -5.740550805391063e-02   -2.790771182717083e-01   +3.456236050034117e-01   +6.998446732926032e-02   +5.863483368464243e-01; -4.263408075276199e-01   -5.434664282948722e-01   +2.834580201103863e-01   +1.584212838829296e-01   -2.870008583234888e-01   -4.966771082590579e-01   -5.256826979532155e-01   -2.434871195096484e-02   -1.686472343158594e-01   -8.413302640417596e-02   +1.200090508755897e-02   +2.705946837741943e-01   +1.177263278478971e-01   +4.622031267256874e-02   -6.711371495408535e-01   -3.794966142502393e-01; -2.382797055392833e-01   +9.717434298444139e-02   +7.202718039675925e-02   +1.402756953901771e-01   -8.008325364689931e-02   +1.678400625879716e-01   -2.742517544594253e-01   +6.764434463886536e-01   +2.642939031149087e-02   +2.293599991573572e-01   +2.480526285186725e-02   -4.980591601761642e-01   +7.669294458081376e-02   -6.420129666237425e-01   -5.429388034004747e-02   -6.084830895122531e-01; -5.121231883837711e-01   -3.147173520136510e-01   -1.499909258029342e-01   -4.953407217502576e-01   +4.137943669446140e-01   +7.000994897080451e-01   -1.722060254285870e-02   -4.552444762817368e-01   -1.879941851920114e-02   +5.118363793245659e-01   -1.634222389171312e-01   +6.233081494617910e-02   +7.767502021149573e-02   +4.186138885109895e-01   +2.957803565646352e-01   -3.316163525737140e-01; +1.769842302566605e-01   +2.705983731543939e-01   -5.191844033920271e-01   +5.156438773998036e-01   +3.927116781360431e-01   +1.246575044557999e-01   -3.130786794460209e-01   -1.683012668074363e-01   +3.480609154609229e-01   -4.731954415999401e-01   +2.250675055960424e-01   +8.158129055534503e-01   +1.376738787799953e-01   +2.330558135065971e-01   +2.921195397957315e-01   -8.502128763143944e-02; +2.674399383337427e-02   -1.842868711877184e-01   -6.309752465581147e-01   -8.724157664181613e-02   -1.123110819272464e-01   -6.698695450109313e-01   -3.378553204531988e-01   -3.307064246596211e-01   +2.363690443716738e-01   -6.476496977018859e-01   +4.813848477384879e-01   -1.107550975833465e-01   +3.811897767818073e-01   -6.382679984936280e-01   +9.429350876627597e-02   +2.039146023809242e-01; +4.574627148521631e-01   +6.209299157359682e-01   +1.572415603028375e-01   -2.303634023920666e-01   -7.710439768166281e-02   -3.773835861165015e-01   +6.716997258840686e-01   -4.847831492270899e-01   -2.173786786436997e-01   +1.773951277083736e-01   +2.969068906945026e-01   +5.491511973936416e-01   +2.371353298404422e-01   -1.430142829681787e-01   -7.837847888790637e-02   -3.029174265837405e-01; -2.538882993369900e-01   +6.046034816947556e-01   +3.465916220203974e-01   -4.302360478486755e-01   +1.974075013045141e-01   -1.240445896219602e-01   -6.542851246539928e-02   +5.586771205224342e-01   +2.227264726264469e-02   +1.899287043592569e-01   +1.774022336089796e-01   -6.880266537074213e-01   -1.628088774140572e-01   -2.939253018718535e-01   +3.125831079491330e-01   -9.227255864059224e-02; -3.725294071155097e-01   -1.239070531339525e-01   +2.640998897624297e-01   +2.786683752982703e-02   +6.097995665034646e-01   -2.706328589521845e-01   +7.538609358843689e-01   -4.986361310161974e-01   -3.322597539785118e-01   +4.252794733285915e-01   -1.766570178433489e-01   -3.583824541508037e-01   -1.559390910923955e-01   +4.847250650221182e-01   +6.611758540037455e-02   +1.567082396770551e-02; +5.642510543972191e-03   -1.967637316678854e-01   -4.750968896568372e-01   -4.478888960543019e-01   +3.947487624921067e-01   +9.898668757687146e-02   +4.857157163395880e-01   +6.758332558524973e-01   +2.676948026972504e-01   -2.309679054145834e-01   +5.111305477502861e-01   -7.958860656690324e-02   +4.946589805579059e-01   -2.663751957896359e-01   -1.603889600355063e-01   +1.754270561722780e-02; -1.436822322450219e-01   +4.447121306109051e-01   -2.279227060440546e-01   +2.833930361678882e-01   +4.630677085195689e-01   -2.248391498738669e-01   +2.264781377937589e-01   -5.147735611872516e-01   +2.745070637011305e-02   -3.193534956313508e-01   -2.146604256339828e-01   +4.617935273117559e-01   +7.750336382514659e-01   +2.522361845461835e-02   -1.168512290143639e-01   -2.110620827674964e-02; +4.655919349446118e-01   +6.567353904873267e-01   +6.090596921812922e-01   +6.706237244966794e-02   -4.162743076160390e-01   +7.816524189494726e-03   +3.195144111763414e-01   -7.310563738898957e-01   +1.378482361081572e-01   -4.413778388893775e-02   -9.108199095590560e-01   +1.294006643392316e-01   -3.428760275845180e-01   +3.657463688700278e-01   +4.274354287649983e-01   +4.149764978196619e-01];
L2I_L1I_iGABA_netcon = [-2.720967073833201e-01   +9.237401774972559e-02   +3.115077263175657e-01   +2.567380865501600e-01   +5.380501432710435e-01   -6.323671433605071e-02   -1.306232071422901e-01   +7.316407169938166e-02; +5.562340304192566e-01   -7.927986464443690e-01   -4.028180604835502e-01   +8.185945009645218e-02   +2.768880148191456e-01   +2.791053862442410e-01   -5.307694274645736e-01   -7.234370528837075e-01; +3.085240143509630e-01   -3.249630092183831e-02   -4.937651595369886e-01   +1.180073008616836e-01   -1.051262384140143e-01   +8.643738316947877e-01   -2.083312421222216e-02   -6.735813629309634e-01; +7.252264177124237e-01   +7.603608941199849e-01   -3.252098024052183e-01   -6.615329155918419e-01   +3.631494161525332e-01   -1.801778262817961e-01   -6.412636908799660e-02   -3.600620710682703e-01; -1.313663351938586e-01   -7.913035889894074e-01   +3.674098744150220e-01   +4.732753114122260e-02   +1.617578220521580e-01   -3.811042211668975e-04   +7.647449277196470e-01   -4.210518433142822e-01; -5.607652868804323e-01   +1.843839973609714e-01   -4.626482273471630e-01   -3.273281429345848e-01   -4.521462023955712e-01   -6.269740603340679e-01   -7.670018677047739e-01   -3.677807228616087e-02; -1.664430141226451e-01   +4.077505348081016e-01   +1.888468802552929e-01   -1.175828671676805e-01   -2.590718645563073e-01   -2.408053583860551e-01   -2.197250761217525e-01   +3.996222604752582e-01; -2.683293989798371e-01   +7.059587951109814e-01   -9.059153224121375e-03   +7.688987878572897e-01   -3.210879901953386e-01   -3.017134230348419e-01   -2.694122138237761e-01   +6.576344878527796e-01; -9.505361276886620e-02   -5.395864431630787e-03   -3.701424094484932e-01   +1.287231588402772e-01   -2.649075751200041e-01   +7.671920618846897e-01   +2.590125542923347e-01   -3.323446679876627e-01; +7.317116396848317e-02   -5.131700202749621e-01   -3.510994777946277e-01   +1.034021056309917e-01   -6.035973536160157e-01   -4.092471365999769e-01   -1.450818291568077e-01   -6.002293084122557e-01; -6.035186612120342e-01   -9.583131298083123e-01   -2.194675635739622e-01   -6.197011720368910e-02   -5.300311179574548e-01   -3.973855148978966e-01   -7.612614506571784e-01   -4.431504067819750e-01; -7.649001430833819e-01   +4.635502984465257e-01   +5.170019840731386e-01   -6.699967671711158e-01   -2.153649428725301e-01   +6.453311479432644e-01   -8.794796310701019e-01   +9.187601777016241e-02; +1.464127194457560e-01   +6.170000518307160e-01   +2.932498377069272e-01   -3.318315776700536e-01   -1.497068127034918e-01   +4.897550430942652e-01   -4.349588161695211e-01   +5.430804466429717e-02; -2.311459208047625e-02   -1.523821140724662e-01   -4.486723831012411e-01   +5.381084297459652e-01   -3.250014661413236e-02   -3.419242975941050e-02   -1.487284965475887e-01   -3.922543985102121e-01; +6.231074679051593e-01   -1.870550824521093e-01   -4.173519591533327e-01   -8.998071863683655e-01   -4.521590067035429e-01   +3.278331676488474e-01   +8.079844901655160e-01   +2.214451128800675e-01; -1.698339737624924e-01   -9.117858958243547e-02   +2.592264085590490e-01   -4.022078436091086e-01   +4.974871377779586e-01   -1.340842258580182e-01   -1.720442991389590e-01   -6.579317217387508e-02];
L1I_L2I_iGABA_netcon = [-1.972147802109548e-01   +3.897589718070498e-01   +3.353390665773839e-01   -3.892036063562595e-01   -3.033961638307077e-01   -4.386907439807889e-01   +4.821566305482972e-01   -5.338031543293869e-01   -3.230479894780622e-01   -5.836400700500503e-01   -5.305888926721040e-01   +4.675470395036267e-01   -2.970413391353087e-02   +9.087639533218890e-02   -2.258365574860410e-01   -1.832899604290871e-01; +5.408441925766238e-01   -3.600679679894255e-01   +5.027747402087956e-01   +4.205482831214440e-01   +4.350873203568293e-01   -1.602611911409298e-01   +1.000000000000000e+00   +1.423281360768574e-01   -1.365705910184252e-01   -3.828005944486138e-01   -2.535120379953158e-01   +2.566689932097120e-01   -1.144259670922781e-01   +3.192983035415689e-01   -6.130998855526171e-01   -8.385456754348330e-02; +4.719929584837311e-01   +7.618641757573366e-02   +6.517514833691184e-01   +1.121241618412018e-01   -3.112079746217863e-01   -6.324669684120089e-01   -1.263277971354385e-01   -1.835809194884748e-01   -2.617388556873985e-01   -4.405626451220388e-01   +3.756705518717258e-02   +1.030692209229499e-01   -5.815381417192631e-01   -9.509116968668335e-02   +3.161039401323528e-01   +1.477570900634179e-01; -2.080195197390536e-01   -5.866973572445744e-01   +3.075737822065812e-01   +4.280724082823167e-01   -4.076034149430086e-01   -4.644401835190111e-01   +2.768649447007017e-01   +1.682154445346185e-01   +4.527445378055869e-01   +2.117222750018475e-01   +5.158350227253289e-01   +2.755156748122150e-01   -2.771423805868953e-01   +8.638370194704340e-01   -4.143304457797270e-01   +3.816317549498154e-01; -1.545517308502346e-01   +2.518577094342284e-01   +5.947059266260017e-01   +4.344241176138349e-01   +7.800889717568927e-01   +4.337063466432173e-01   +1.502590193055039e-01   -7.502026243606713e-02   +6.689612567739368e-02   +6.245819143350225e-01   +2.297009906876133e-01   -2.503653135610591e-01   -9.834198495952835e-02   -1.817045466547118e-01   +5.409930338551776e-01   +5.309168774550966e-01; -3.080236707733962e-01   -3.449938158655013e-01   +2.500943570405570e-01   +2.296179931972414e-01   +9.126018229791254e-02   +3.025988754744131e-01   +1.754699798196924e-01   -2.722355200512405e-01   +1.301073979027814e-01   -3.914387997690116e-02   -2.074780990714004e-01   +3.614019067048341e-01   -4.873042310457500e-01   +7.753985933043274e-01   +3.811093611704041e-01   +3.016257170981185e-01; -5.321848111899518e-01   +5.991780218219425e-01   +3.993759841529559e-02   +2.944188366737695e-02   +5.341654982720249e-01   -3.587242389378949e-02   +5.342061958131306e-01   +1.046953897629235e-01   +3.099743202624839e-01   -4.501703327263359e-01   +2.721404512216761e-01   +1.008902579894781e-01   +2.546913855066898e-01   +2.880282080955731e-02   +3.485359449008962e-01   -4.882323113810387e-02; +1.117108556929538e-01   +1.174108978476917e-01   +5.075274253820901e-02   -2.851858106372404e-01   +2.499330879194828e-01   +1.105380589978006e-01   -2.106793694085849e-01   -4.983720068094978e-01   +2.621776387475609e-02   +7.429830805370030e-03   -6.094858806334840e-01   -3.191350687368901e-01   -9.155641123737757e-02   -4.283818082508901e-03   -7.257134286516560e-02   +2.375469249353641e-01];
L2E_L1E_iAMPA_netcon = [-7.626946620922342e-01   +5.607192837381593e-01   -8.353144535589804e-02   -3.865124891516948e-01   +5.561407264321764e-01   +2.641367809822893e-01   -3.661015792758283e-01   -2.149851719097024e-02; +2.113621787181865e-01   -1.485955625512003e-01   -2.916990349261365e-01   -3.088825008218593e-01   -3.952361525480043e-01   +7.849292312170068e-01   +7.389935002781519e-01   -1.727935093723853e-01; -4.593877701363056e-01   +6.685151435161919e-01   -8.507219598866628e-02   +3.718166113577574e-02   +3.407330445044078e-01   +3.562833010148395e-01   -9.327315958169340e-02   +6.568269149029959e-01; -1.287597099371762e-01   -4.520162067429529e-01   -3.447197045046519e-01   +7.483928836024042e-01   -4.063924109317047e-02   -2.510594328861047e-01   -3.781057693179986e-01   +6.949353699630270e-01; -3.730070904561100e-02   -2.589750626962326e-01   +5.916499735483051e-01   +9.208689694713539e-02   -4.614797070420225e-01   -6.811780089427776e-02   +3.578351837712583e-01   -2.047523968994387e-01; -1.454713416371270e-02   -9.247808110814694e-02   +2.078791027053917e-01   +1.713086493354576e-01   +3.882149467238218e-02   -6.416112326622779e-02   -1.864900018213226e-01   -8.615652375420303e-02; +3.722031242729362e-01   -1.284797941207936e-01   +5.139137493965278e-01   +1.654115213805800e-01   -6.392525811847248e-01   +1.241010215642341e-01   -1.396195284472758e-01   +3.745427751923229e-01; -1.951366668550036e-01   -6.177864432577970e-02   +4.460330897770505e-01   -2.698319967877820e-01   +4.459467019046960e-01   +7.538170815719848e-02   +1.916394618038846e-02   +1.000838672678538e-01; +1.659420657732624e-01   -5.123801297365891e-02   +3.981800963707305e-01   +1.078211973657834e-01   +3.664615262270712e-01   -6.189139653702425e-01   -1.941263326468892e-01   +4.343481535610551e-01; +5.598473046612658e-01   +7.072773216100502e-01   -5.535818891077423e-01   -3.863095996221945e-01   -7.926727675948811e-02   +2.894450752629352e-01   -2.904355393004972e-01   -6.666168027877282e-03; +4.365962173341009e-02   -3.738123592957268e-01   -2.862963857319962e-01   +2.807498013615608e-01   +1.062359655722063e-01   -1.205856714753251e-01   -3.219659479987356e-01   -9.585655391476261e-03; -1.499681026032672e-01   +9.811565367900980e-02   +1.081008472720807e-01   -6.404876335248191e-01   -7.157543211838226e-02   +5.140796338223640e-01   -3.254175749874324e-02   -1.359695755122950e-03; +7.235973349902578e-01   +2.772325538263664e-01   +4.123876311092201e-01   -5.484075195117809e-01   +6.999862900885867e-02   -6.640271619560509e-01   -4.477718195103389e-01   +3.765767717171014e-01; +1.349866870487407e-01   +3.055298686657549e-01   +1.000000000000000e+00   +1.215077105047441e-01   +8.452556596496200e-02   -3.762705816342727e-01   -3.453940375159615e-01   +6.156980613479706e-01; -5.243972284844218e-01   -6.305377214631426e-01   -7.826762584593297e-03   -6.811918985725501e-01   -1.934087856288067e-01   -3.739401907087017e-01   +5.360767955399401e-01   +3.826490387489124e-01; -5.255414747068556e-01   +4.820789418956058e-01   -5.687215481588085e-01   -3.804840452291832e-01   -5.527745787794681e-01   +4.715265047914203e-01   +3.728182397009897e-01   +1.605940296238429e-02];
L1E_L2E_iAMPA_netcon = [-3.194255109108995e-01   -2.538977578694845e-02   +3.636957829377424e-01   -6.513464937119818e-01   +2.782877396652714e-01   -6.866286717447921e-01   -2.944962152950729e-01   -6.660295553132537e-01   +5.487022920420623e-01   -3.678909374722086e-02   -6.335304605605474e-01   -7.264286937774771e-01   +5.579309088282386e-02   -4.081697940141754e-01   -3.218683882126159e-01   +1.600881025649570e-01; +8.620523688909310e-02   -2.641231080321762e-01   +4.438919067062647e-01   +1.653460254379562e-01   -2.178037144355064e-01   -5.805590357871379e-01   +9.226350331537786e-02   -7.563888674138375e-03   -6.842954040160759e-02   +4.799902144918600e-02   -4.638369581519942e-01   -6.916270898220094e-01   -3.185802117409464e-01   -1.103253777684073e-01   -3.078754446050865e-01   +2.354682296256574e-01; +3.594336339779846e-01   -3.897097426323871e-01   +4.714484311495803e-02   -1.529299600426317e-01   -4.444823089658798e-02   -7.095769279418618e-01   -2.595733478742969e-01   -3.228410150468071e-01   -6.417746685278973e-01   +2.096293920160956e-01   +1.702104270625004e-03   -4.035031631568431e-03   -2.046977853221922e-01   -4.608907754227848e-01   -1.203720329117532e-01   +6.525849825686603e-01; +3.730877855434127e-01   +3.106419310651412e-01   -6.029530858432138e-01   -3.760353784885196e-01   -7.247001058407235e-01   +3.067259193045102e-02   +6.137561771206105e-01   -4.148308486240456e-01   +1.076287358405650e-01   -5.655445091593767e-02   +1.245447240610787e-01   -8.455044936071856e-01   -2.509256045730476e-01   -4.972624347403150e-01   +5.020379398028328e-01   +2.917245057034618e-01; +2.542917461116271e-01   +4.689908826835338e-01   +6.383654016146137e-01   -9.556574471681015e-02   -1.777488660768125e-01   -4.767170239617389e-01   +1.264967271756874e-01   -2.454899067272394e-01   +4.474117268342006e-01   -9.273949666844845e-02   -1.308214890255064e-01   +1.063662423849167e-01   +3.443746790020680e-02   -5.856089508431898e-01   -3.020904628808573e-01   +1.578879549443261e-01; +5.787189069579785e-03   +3.015766162803364e-01   +3.469742214573943e-01   +1.972400026855248e-01   +4.484133230242809e-01   -5.281371651871020e-02   -2.419557785350463e-01   +5.759723592774841e-01   -5.248780209658425e-01   -3.049610786820426e-01   +5.873979973310699e-01   -1.558446105585221e-02   -5.156126085605379e-01   +6.438265822702349e-02   +1.420379681586352e-01   +9.383873796137326e-02; -1.953540039932203e-01   +3.946270535876800e-02   -4.953288582080965e-01   -2.493718040360025e-01   +6.660424511378188e-02   -1.248374289381316e-01   +6.394968686484021e-02   +4.952526747026067e-01   -2.601196346218770e-01   +1.813825232731058e-01   +5.540176245890805e-01   -4.895091871456483e-01   -3.521700743861703e-01   +1.680539772955844e-01   -1.905228277567295e-01   +1.914375383872502e-01; -6.230480888420797e-02   +1.375616367302450e-01   +2.349289069304983e-01   -8.050324973663783e-02   -3.985448723413951e-01   -3.325043202414745e-01   +1.788634747404821e-01   -8.956149078557341e-02   +3.066825960225469e-01   -6.819940141452799e-02   -3.106282058553801e-01   -4.588218322190625e-01   -3.480066109509384e-01   +4.432761088818666e-01   +1.739699868450312e-01   -6.113603528840277e-01];
L2I_L2E_iAMPA_netcon = [+2.196196526582421e-01   +2.007346080763083e-01   -2.122919767747842e-01   -1.197735709303749e-01   -1.813232277402893e-01   -2.895040514623035e-01   -2.427394552325852e-02   +3.702501693840416e-01; -2.110168989943483e-01   -1.313292700430607e-01   -6.858334497324953e-01   +5.331905328825898e-01   -6.587015107819879e-01   +4.269965424654786e-01   -1.809526456398648e-01   +3.360526395298372e-01; -6.954284844718218e-01   -5.430095124883392e-01   +4.618850510342499e-01   +1.637854143713280e-01   +4.334509680439513e-02   -6.850429025376077e-01   -7.230599351573437e-01   +4.914689744664162e-01; +2.320088276023841e-01   +2.545861412572990e-01   +2.005042348575832e-01   -1.525415829153914e-01   +8.085763063229369e-01   +3.168030411166263e-01   -9.823946999318489e-02   -6.361892468711523e-01; -4.215562726568277e-01   +1.649480328300083e-01   -2.330877788236704e-01   -7.279494420008491e-01   -1.721571708398679e-01   -7.248133336752092e-01   +3.292911283117496e-01   +6.005332118621127e-01; +1.183271948763713e-01   -2.566870473036130e-01   -2.680899770970907e-01   -7.324562924671226e-01   -2.367228519031095e-01   -4.881560623477369e-01   +8.756478204187033e-02   -2.092399690840776e-01; +4.979135586328606e-01   -6.554112990639922e-01   +6.562164812361451e-01   +5.323814462502602e-01   -3.186508121413964e-01   +4.241574533402366e-01   -4.532457942063610e-01   +4.545104700449621e-01; +1.000000000000000e+00   +7.082222776101103e-01   -2.056484779945963e-01   +1.074281675412489e-01   +1.420638318469025e-01   +2.781659613387743e-01   -9.194436220078487e-01   +5.993966012862729e-01];
L2E_L2I_iGABA_netcon = [+2.089202210986779e-01   +2.524744351609076e-01   +1.045722417753223e-01   -2.794647348459635e-01   -4.041012069200655e-01   +2.558935772556334e-01   +1.288870010043004e-01   -8.483191057930775e-02; -2.993949409121121e-01   -3.931449200051272e-01   -2.937167947138995e-01   +3.492962403210657e-01   -1.938319955615472e-01   +1.570995812347474e-01   +5.421173800382281e-01   +6.650718532643181e-01; +3.393871088747324e-02   +2.933037194737858e-01   +2.238376584826087e-01   +5.310956265016138e-01   +2.119662101603309e-01   -1.497560843363980e-01   -2.067636694997056e-01   +2.202956638142515e-01; -4.055033418126574e-01   -6.374555363032963e-01   +2.203013312772339e-01   -5.857521571727832e-01   +2.613313284504358e-01   -7.966273323333448e-01   -6.147771905371160e-01   -2.547358916912740e-02; +3.566909591284571e-01   -4.670923678271861e-01   +8.648107107236430e-02   +1.248567810643066e-01   +5.230957294032293e-01   +3.437693863611169e-01   -4.861663672724039e-01   -6.317238190083412e-01; -4.371071939128950e-02   -2.375909206855230e-01   -1.628324617952514e-01   -3.358399555174963e-01   -1.443384196777969e-02   -1.778149715688214e-01   -7.851651563861188e-01   +2.237300925028718e-01; +5.290829896629184e-01   -1.251235045364105e-01   -5.394284581746319e-01   -5.944813382350681e-01   -3.732465957311261e-01   +6.761036488330961e-01   +9.468123953612555e-02   -1.647380879049324e-01; +5.490761795767817e-01   +6.781285819580396e-01   +3.965609382189258e-01   -5.010794316247039e-02   -1.817802526608205e-01   -3.692178682334092e-01   -4.186963640162918e-01   -6.434258884441479e-01];
L3E_L2E_iAMPA_netcon = [+4.893092333391751e-01   +1.481938339125134e-01   +1.477301938935984e-01   +2.694748811110761e-01   +3.703284447259909e-01   -8.310391658547455e-03   -3.498810046868293e-01   -2.811502605618291e-01   +5.029751619967776e-01   +4.479051599673838e-01   +6.434232543200159e-02   +3.633795900536446e-01; -2.829818881231398e-01   -6.349083844906842e-01   -5.364290263114996e-01   +7.500129321625712e-02   +4.817975638464884e-01   -2.840510991330711e-01   +3.413623942277060e-01   +2.195211836817746e-01   -7.694146594403779e-01   +1.635563727169585e-01   -4.585592391781402e-01   -3.842767853377102e-01; +7.088376230534469e-01   -2.327449141531444e-01   +4.756873836425270e-02   +2.107673227288246e-01   +3.703409406808167e-01   +2.742406163831471e-02   +3.264836347468707e-01   +2.895736150071600e-02   -7.829183967476795e-01   -1.693326870137090e-01   -6.216682665754022e-02   +1.000000000000000e+00; -6.692994474968814e-01   -8.912667955037362e-01   -2.562896310162950e-02   -6.894913285370564e-01   +5.547904865538743e-01   +2.186452117285622e-01   +5.535119935094940e-01   +2.190328660539718e-01   +3.867457309494404e-01   -3.791118729299711e-01   +4.121592518798898e-01   +7.321710404924356e-02; -7.442983831630574e-01   +1.524048549470074e-01   -2.683978734409629e-01   +3.027746108547864e-02   +6.752151810806718e-01   -1.700271432572175e-01   +5.200280383568582e-01   -7.562073643213865e-02   -3.082469508817882e-01   +4.149804166477316e-01   -9.461813698892542e-02   +1.782005771555672e-01; +1.657099406004768e-01   -6.162924126514617e-01   -8.568505380098576e-02   -3.556443892342984e-01   -1.007472937004905e-01   +1.936682353406197e-02   +4.798400194470410e-01   -3.244928966551225e-01   +7.814904564958705e-01   +2.908029772275589e-03   -6.569691738249275e-02   +3.032258536969887e-01; +3.078687460136950e-01   -5.993756386180292e-01   +2.586289840744841e-01   +1.668560043554586e-01   -6.246557084514809e-01   -4.332524400088506e-01   +3.912921566561325e-01   +3.150250690601103e-01   -2.548434442161507e-02   +1.857968774981194e-02   +8.131920761838995e-01   +1.520620531619892e-01; -8.604358731510030e-01   +2.261883485084137e-01   +4.881355165502559e-01   +5.363629013840949e-01   +3.546742451556847e-01   +1.629061298271798e-01   +7.813007686337271e-01   -7.218850757424181e-03   +6.703643416355447e-02   -1.638054023615998e-01   -6.507245255285693e-01   +4.600431053902388e-01];
L3I_L2I_iGABA_netcon = [+7.753977638637269e-02   +8.439199483824226e-01   +1.034169758379095e-01   +9.038468042279918e-01   -5.003266397183358e-01   +1.646176915902385e-01   +4.946005043575766e-01   +9.315289489694475e-02   -3.884871344150630e-01   +1.889703872762017e-01   -2.979221134856701e-01   +5.929831748852097e-01; +4.255389946816328e-01   -1.218797098950735e-01   -1.927795032082081e-01   +4.558911613880431e-01   +7.375567344778539e-01   +8.153716311045642e-02   +1.000000000000000e+00   +8.371017647430073e-02   +2.472284783461590e-01   +3.679979745318655e-02   -6.172203772415530e-02   +2.064789587698213e-01; +2.195740256671813e-01   +3.317254558862431e-01   -5.501754643066524e-01   -9.330420342036734e-01   +4.434270149604443e-01   +7.182396296593975e-01   +2.713569274254815e-01   -6.065806577621448e-01   -5.344815908964278e-01   -4.741952610395269e-01   +4.484646922643948e-01   +3.123538059387719e-01; +5.569044504146643e-01   -3.600340436229291e-02   +8.921892863921959e-01   +1.544421595656617e-01   -1.735561999684514e-01   +1.698421995377859e-01   +6.763109367064455e-01   -3.190625075960282e-01   +2.350501350760753e-01   +7.178023006967502e-01   +3.923566902149463e-01   +1.946329209345264e-01; -4.852816881857418e-02   -3.874395831284124e-01   -1.360166816944371e-02   -4.501308697851383e-01   -8.552587779124069e-01   +7.041723687323503e-02   -4.905502350358655e-01   -4.935547954500070e-01   -1.283565266886941e-01   +3.611881332643639e-01   -1.362182205316471e-01   +3.362481114416152e-01; +9.597097517648346e-01   +2.841201641211823e-02   +4.309300825690461e-01   +9.188040475801872e-01   -1.724969741526021e-01   -7.391278149871934e-01   -5.545875347687610e-01   +2.543780515658723e-01   +4.675322574699821e-01   -3.605760605095689e-01   +2.776263471043698e-01   +4.008998902561002e-01; +6.791761521100722e-01   +2.892803719095978e-01   +6.220769794984757e-01   +4.085919601305660e-01   +8.405447474416462e-01   -2.165831635941658e-01   -2.978350279758758e-01   -1.545668513776668e-01   -4.747576326446591e-01   +2.804483933026472e-01   +6.260109355248332e-01   +1.735139839132094e-01; -2.153129425966755e-01   +1.114807504979763e-01   -3.991229272830487e-01   +1.404243468530602e-01   +5.993645377062515e-01   +7.588078940848900e-01   -1.619612845131078e-01   -4.900205531270543e-01   +1.015467589506340e-01   -2.615623896006203e-01   -1.766240890512245e-02   +2.878647541326544e-01];
L2E_L3E_iAMPA_netcon = [-2.683772525319156e-02   +2.478463523120011e-01   -1.882909208507149e-01   -6.803851772373415e-03   -1.741211542886301e-01   +3.451237996768555e-01   -6.803310475556250e-02   +4.206239809281265e-01; +3.604549769244807e-01   +1.417584711553466e-02   -1.057365883975582e-01   -1.444888887406831e-01   +3.249110312536280e-01   -8.844678520401594e-02   -1.900973594749169e-01   +4.795294705419160e-01; -1.658880090815907e-01   -3.480638557064019e-01   -4.075931102641123e-01   -1.575335113920594e-01   +7.125723093024098e-01   +2.496934773354829e-01   +3.918376481360779e-01   +4.962866854897732e-02; -6.041927783632732e-01   +9.112920497124505e-02   -1.376532552653322e-01   -3.686396005982219e-01   +1.733740927441216e-01   -5.517640521657544e-01   +4.384866733208792e-01   -3.633140960884307e-01; +6.168244146640804e-01   +4.117409660317106e-02   -3.636585589281325e-01   +4.147758655235271e-01   -6.537301012493482e-01   +7.794715281980891e-02   -7.194639483484289e-02   +1.833509731286453e-02; +4.618218766128313e-01   +1.460204543343465e-01   -1.413134557855443e-01   +4.467885811409116e-01   -6.159201059525068e-03   -3.238302306320161e-01   -3.688859098748891e-01   -4.732251272410904e-01; +6.627086496728378e-01   -1.070955481132930e-01   +9.402489811852387e-01   +1.109744046518525e-01   -2.381319037946434e-01   -3.614078250610894e-01   -1.731552013257426e-01   -2.177287784554842e-01; +4.084040253692613e-01   +4.828974291512458e-01   +6.904336670710454e-02   -6.029424273107623e-01   -3.041710068638592e-01   -2.453436465272297e-02   +2.295499833164841e-01   -2.109942642997497e-01; -2.995656676806256e-01   +2.468319301330761e-02   -4.670566082069468e-01   +6.837629567445332e-01   +5.182727511833656e-01   -7.069438060825090e-02   +2.905316682011794e-01   -5.578865661956581e-01; +9.122873055797512e-02   +3.059243751764834e-01   +1.086747970484545e-01   +6.847400613795503e-01   +7.018283306968455e-01   +2.889824337783419e-01   -4.595554985428544e-01   -6.965357168518370e-01; -2.351437601084442e-01   +2.089899445198422e-01   +3.775052902687831e-01   -6.884952207804568e-02   -5.854292745798937e-01   +5.672088985330836e-01   +3.020799643417224e-01   -3.026718834771573e-01; -6.999040433442529e-01   +4.506374004709534e-01   -1.406491914190308e-01   -3.361191475010457e-01   +5.758362916086278e-01   -2.496676286419447e-02   +2.636765356163990e-01   +2.554091971048723e-01];
L2I_L3I_iGABA_netcon = [-3.879387660230579e-01   +1.748718301345314e-01   +2.395477707356412e-01   +3.585816420636942e-01   -3.215866184996626e-01   -8.858875307463623e-02   -6.030263794522495e-02   -4.020721605721247e-01; -2.081563686777825e-01   +6.742216680570742e-01   +5.140574091090624e-01   -3.306151557669469e-01   -2.306153910813352e-01   +4.145305542303482e-01   +4.898524155613638e-01   +2.258165904723096e-01; -8.901354279562844e-01   +1.730235517254567e-01   -5.324486377477929e-01   -3.914359676211253e-03   -1.287804608789412e-01   +2.759593879101098e-01   +6.162581728196573e-01   +5.330685417612502e-03; +2.582194181543285e-01   +2.566294323752747e-01   -3.180856629479700e-02   -1.220092032945138e-01   -6.091416417281028e-01   -1.381908296721359e-01   +2.441493237405972e-01   +2.967456610654118e-01; -2.010918768361993e-01   -2.320071596443414e-01   +3.544167748179563e-01   -3.899500924761878e-02   +3.735335675971184e-01   +6.368869769122972e-01   +5.734832243040724e-01   +3.543672414521526e-01; -4.815721900144324e-01   +9.439541772216781e-02   -1.138496412016582e-01   -1.052658154561087e-01   -5.553247112344921e-02   +4.197615536465453e-02   -3.669647197775895e-01   -1.225058372005856e-01; +2.161286338685288e-01   +2.887775995708586e-01   +4.239898585314678e-01   +3.464882881338212e-01   +4.652635000447148e-01   +2.493591344228697e-01   -1.196391848622399e-01   -7.255469597744627e-01; +2.623288120727251e-01   -1.958101114977807e-01   +3.958350221926793e-01   -2.843502636309361e-02   -2.506028230718694e-01   +8.525542186384935e-02   -5.164681507831009e-01   +2.578905152325131e-01; -3.189113902976203e-01   -1.137640286066059e-01   -1.395650109379240e-01   -2.639906847272377e-01   -9.012837656516010e-02   -4.337819730542934e-01   +6.637406565545589e-01   +8.033307680819760e-01; -1.795347898053834e-01   -5.013214321506193e-02   -2.687293381015107e-01   +3.105864389483839e-01   -2.763673260665245e-02   +3.802267437018668e-01   -2.340950625146334e-01   -2.401322466499852e-01; +5.794833362394411e-01   +5.021425568502000e-01   +5.142408393267822e-01   +2.565573844898729e-01   -1.281117447608762e-01   -4.588596898645209e-02   +2.249350976697374e-01   -4.535261072612729e-01; -5.199294593459981e-01   -2.817305867660209e-01   +6.030371226337250e-01   -4.035529270624154e-01   +1.829418885458047e-01   -4.235757358453290e-01   +1.423063020975608e-01   -6.040637925065681e-01];
L3I_L3E_iAMPA_netcon = [+1.059839967195871e-01   -7.410148017045212e-02   +2.447332536460300e-01   +5.548694091594706e-01   -5.079280845676980e-01   -2.886278254977408e-01   -1.040601111769386e-01   +4.084994685815131e-02   -2.114374891080852e-01   +2.619031097207167e-01   -3.412774505100428e-01   -1.359320449381445e-02; -1.775913704762636e-01   +3.620007168278383e-01   -2.710663459464632e-01   -1.104085281614692e-01   -6.035582984627729e-01   +8.148801546756548e-02   +3.492637956871830e-01   -9.997326137549060e-02   -1.673723993525987e-01   -1.412700377694809e-01   +1.620509519720987e-01   +6.266868118364637e-01; -3.236064880224818e-01   +1.136167969604755e-01   +2.009310049181608e-03   -3.337703137991305e-01   +2.439185453427646e-01   +4.312026822362025e-01   +5.606378669346749e-01   +5.978133865355374e-01   -5.263146860403856e-01   -1.469469717038865e-01   +2.359578534958250e-01   -3.074399814955422e-01; +7.662105165997343e-02   -2.270982409574752e-02   +2.722577587846955e-01   +3.487073539043884e-01   -1.472120561998376e-01   +4.430142088871863e-01   -1.062011347306869e-01   -1.187997084341935e-01   -9.147491811040279e-02   +5.125110336013770e-01   +3.241553684649920e-01   -6.298043842714345e-01; +1.826127503258007e-01   +6.959168772074362e-01   +3.193562099144306e-01   +2.582255084586704e-01   -4.145411237096367e-01   -4.409721280917559e-01   +1.163582241200384e-01   -4.506254328698179e-01   +7.534988438358380e-01   +2.383122768185083e-02   +1.592701801980471e-01   -1.907638529157087e-01; +3.414113565068086e-01   -1.606688088050289e-01   -8.866686503965424e-02   +6.151095568001945e-02   +1.716692681286033e-01   -1.138641526021286e-01   -2.267577676219554e-02   -3.370862252321543e-01   +5.830247151640182e-01   +1.509609603528034e-01   -1.040472429938338e-01   +3.338115326020408e-01; +6.799944111587352e-01   +4.858927481798715e-01   -5.481376341560416e-01   -5.192454035834683e-01   -5.055212204934412e-02   +1.596430174116652e-01   -6.199211856754909e-01   +1.145376391897597e-01   -6.597236263981730e-02   -8.514371774379134e-02   -5.698019355283700e-01   -5.253757313959045e-01; +1.202067256186905e-01   -9.005118224193444e-02   -2.995672322112437e-01   +2.666080472672550e-01   +4.101664944015727e-02   -2.151322903810089e-01   +7.354922996615409e-01   +4.153217380797173e-01   -5.357637706493312e-02   +2.620620679856101e-03   -2.803617110453647e-01   -1.482834123135799e-01; -2.475742586708705e-01   +2.306324108837495e-01   -7.503216401467022e-02   -2.797465832637900e-01   +1.579611470665623e-01   +4.404613482536048e-02   -1.000000000000000e+00   +7.543270000989308e-01   +8.510977545695548e-01   -1.779338035867984e-01   +5.838838389945709e-01   +4.241987786136638e-01; -1.582541151965790e-01   +5.656913214224382e-01   +7.362545164753340e-01   +3.180249162546523e-01   -1.277652849556550e-01   +3.296853919460557e-02   -1.328020988757897e-02   -1.886380990283925e-01   -1.979214036374861e-01   -6.666355991510733e-01   -2.028780642217426e-01   +1.543806254442746e-01; -3.620783824943759e-01   -3.303880156325041e-01   -4.752495227411653e-01   +5.619293852515108e-01   -5.403879611505484e-01   -5.790623249111007e-01   +6.213485030708983e-02   +1.229384197639785e-01   -4.982028696933329e-02   -3.986250465629229e-01   +2.957856556865130e-01   -7.440924640857777e-01; -7.574944596878181e-01   +2.554352002869013e-01   -1.568464455543306e-02   -4.797441347188040e-01   -3.410942542682932e-01   +6.325340786799089e-02   -9.815889367689790e-02   -1.959258394993323e-01   +3.406757983061778e-01   -7.249907701297825e-02   -1.031607034547468e-01   +1.927467057166460e-01];
L3E_L3I_iGABA_netcon = [-3.605907450054963e-01   -1.508736177943505e-02   -8.683368437772179e-02   -1.009052648394463e-01   +1.325456728996775e-01   +2.925440919660879e-02   -1.223223876103991e-01   -2.370394305565557e-01   -1.000000000000000e+00   +1.512039888184457e-01   -6.902139990834852e-02   +3.045923191028680e-01; +9.600413990248950e-02   -5.461965282266033e-01   +1.400623730406334e-02   +1.579974026023180e-01   +4.475586937072442e-01   -2.724527420576766e-01   -6.685055669940647e-01   -7.897055002939664e-01   -5.158354244178871e-01   +2.433972687432506e-01   +6.673487338080014e-02   +4.295261464671523e-01; -7.915857269392346e-01   +7.361960702098259e-01   -1.782086870822409e-01   -1.398476469054375e-01   +7.467596305837793e-02   +8.426593452520757e-02   +1.191847898642327e-01   +1.463142828447620e-01   +2.942074022954222e-01   +8.978901885652464e-03   -6.993821163426614e-03   +6.059979947760090e-01; -3.976323024270641e-02   +4.220764661135850e-01   +7.345000188764971e-01   -3.783684021595872e-01   +1.158555439625943e-01   -2.969793359001894e-01   +1.411239318204063e-01   +2.509469030314883e-01   -8.164490275205750e-01   +1.452083571986932e-01   -6.233437598414923e-01   -1.161623446681717e-01; +4.003299397213190e-01   +1.752627097828989e-02   +5.527813652509889e-02   +4.005366965882203e-01   -5.585076422547309e-01   +1.954225589846641e-02   +2.298539576359502e-01   +8.241117271322786e-02   +4.888199347344355e-01   -1.853603855644306e-01   -6.616226108030648e-01   -4.485937350731263e-01; +4.071558131462422e-01   +2.385346897501882e-01   +1.056073326427685e-01   +2.723867677346812e-01   +3.533815405606827e-01   +3.383175634883698e-01   +2.138145533182974e-01   -1.280901045077653e-01   -4.331631942084643e-01   +3.054942469542920e-01   -1.194139621703858e-01   -8.143390649090100e-01; -3.447534092086402e-01   +4.938073384362114e-02   -1.055822309458118e-01   +5.755156471803023e-01   -9.449736243208953e-02   +1.550723172386897e-01   -1.386070883090422e-01   +3.600765975071523e-01   +3.880596900948741e-02   +1.098149126895930e-01   -5.548386900499199e-01   +1.488475921043163e-01; +5.278642076910739e-01   -7.494803341218587e-02   +5.540087910183199e-01   +4.569386008000900e-01   -6.406583259365242e-01   +4.070441422538404e-01   -7.121994845678763e-02   -4.289289873409206e-01   +2.804547639725762e-01   -7.347150006108878e-01   +1.325286283557535e-01   -4.721321961216921e-01; +1.705630070393060e-01   +4.107169728927470e-01   +2.687089255487049e-01   -2.063153157173300e-01   -2.934552879114648e-01   +6.949282637249009e-01   +1.546060466738113e-01   -3.231474069323386e-02   -3.420492723210575e-01   +1.729718248164729e-01   -1.681348203969037e-01   -5.551057247076110e-02; -1.009408758986632e-01   -5.832559891544307e-01   -2.171220711828677e-02   -6.417148594981515e-01   -1.488300083724325e-01   +4.852216848666251e-01   -8.226122530790729e-02   +1.318909471458526e-01   +3.889947271300763e-01   -2.380910457758741e-01   -3.488282572772439e-01   +9.129097172114435e-02; +5.513539932323772e-01   -4.076391599785456e-01   +1.774590880414175e-01   +6.357783633184574e-01   -2.484137522407528e-01   -6.147515182319598e-01   -3.071164745195450e-01   +5.062668788238945e-01   +2.764148085539649e-01   +5.113435808796175e-01   -3.996712145362455e-01   -3.399766195863032e-01; -4.421156699759418e-01   -8.398781622324859e-01   -4.725064879132933e-01   -5.660034849513160e-01   +1.580749906337968e-02   -9.316382280347847e-03   -2.922258740194631e-01   -3.521741645748429e-01   -6.611171641346564e-02   +8.606249806959868e-02   +4.749459797597916e-01   -7.537263682932046e-01];
L2E_Input1_iAMPA_netcon = [+8.277691582110793e-01   -7.532547501874011e-01   +6.502089266566752e-02   -9.775684241865340e-02   +2.896765136361486e-01   -3.108922982338036e-01   -2.261192573262296e-01   -8.317919767508395e-01];
L2I_Input2_iAMPA_netcon = [+4.209034137152358e-01   +2.179720336390389e-01   +1.077435260929316e-02   -3.161712852214917e-01   +9.905379026325949e-01   -2.238285151954606e-01   +8.211257143730080e-01   +3.302062726443256e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
