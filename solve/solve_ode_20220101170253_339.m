function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.241741587706718e-01   +8.046155342867448e-02   +3.126811663438166e-01   -1.816573571335253e-01   +1.437582592077804e-01   +4.648578184688051e-01   +4.152199822550054e-01   +2.609657296783671e-01   +1.804378484670858e-01   +1.232678034473525e-01   -1.470951208930969e-01   +1.971729123407506e-01   +6.743612063867868e-02   +2.215004358697830e-01   +6.040865867078684e-01   +6.267758238211308e-01; -5.469870215483964e-02   +2.289883003919404e-01   +2.335215178309486e-01   +2.401254347633113e-01   +5.343627880801369e-01   +2.692813635046862e-01   +2.165222652283537e-01   +8.100354286289638e-02   +3.979455942118907e-01   +8.342695418419795e-02   +5.741009510530879e-01   +1.112995281586554e-02   +1.072975134495707e-01   +3.137282482749396e-01   +1.976322555198358e-01   +3.016530698041732e-02; +3.788333662010769e-01   +4.854086672563539e-01   +1.416244436995312e-01   +2.884100899804128e-01   +2.358080638008200e-01   +3.957683204760964e-01   +3.701994113349906e-01   +3.374478664372293e-01   +1.285668887012797e-01   +3.470937446190879e-01   +4.443553474204068e-01   +3.156806887167896e-01   +2.619375151500528e-01   +4.650598072334481e-01   +2.977564325471883e-01   +2.930309578463755e-01; +4.071479568319189e-01   +1.329827335692142e-01   +4.299986091546348e-01   -1.660061101484305e-01   +9.265559126298378e-02   +2.203114951742964e-01   +5.383481018239770e-02   +2.258865840651264e-01   +3.037076437959227e-01   +2.570310384162103e-01   -1.130159579215041e-01   +4.045098386387932e-01   +1.574690175918739e-01   +2.117145435701075e-01   +3.286513683066802e-01   -1.151744075108215e-01; -1.325676956478030e-01   +1.353145556310003e-01   -1.320357461394063e-01   +4.559029976380358e-01   -1.086344869868359e-01   +7.195373233198245e-02   -9.653688616236378e-02   +3.846642683976443e-01   +2.929438742055042e-01   +4.461566171877177e-02   -1.703517938986557e-02   +2.151958798098803e-02   +2.910656663285563e-03   +6.339843600827808e-01   +1.116910464201349e-01   -4.293448729235040e-02; +1.555316954794755e-01   +6.550335141637498e-01   +2.799680399916276e-01   +2.517977692067163e-01   +7.538913367416578e-02   +6.526066849510315e-01   +4.066216625381432e-01   +2.034567316708356e-01   +2.662566533065877e-01   +2.320760381649661e-01   +4.920451855713825e-01   +2.714046056637065e-01   +7.397784296243150e-02   +5.976373558516486e-01   -2.929469820892341e-02   -4.465913945912697e-03; -1.426682960706535e-01   +3.399236773502241e-01   +2.732357286927024e-01   +6.508837908684581e-02   +1.959328594127824e-02   +1.637693990457971e-01   -1.082422795868523e-01   +1.001760560406017e-01   +2.492559103505303e-01   +1.954396371379863e-01   +4.434432304352360e-01   -2.007109850763761e-02   +2.462099368592482e-01   -3.847633148054662e-01   -7.656232978448556e-02   +4.248319866671052e-01; +3.129182753023969e-01   +2.058808964416572e-01   -1.666599817555064e-01   +3.992840422323425e-01   +2.920674840019279e-01   +5.767766392386597e-01   +1.020306735363847e-01   +1.463887178371596e-01   +1.662701080726973e-01   +8.988577021040584e-02   -8.579660214543298e-02   +3.390768803155721e-01   +2.456440388561570e-01   +7.419629545945511e-02   +5.820359262676440e-01   -2.553334903291397e-01; +1.651784120276046e-01   +6.274201220014901e-01   +3.915973885294567e-01   +2.883193820126994e-01   -1.180572505126068e-01   +1.407890937937346e-01   -2.200173692823224e-02   +5.528012992104254e-01   -4.781022505143570e-02   +1.781325411067915e-01   +2.310435445113881e-01   -5.778472199123100e-02   +1.574130265983670e-01   -5.139440530751490e-02   +2.165646643061545e-01   +4.651244412915647e-01; -3.457841654780847e-01   +5.054801619694869e-01   +1.100718382200137e-01   +1.545427246530585e-01   -2.049993957325717e-01   +3.509980127668308e-01   +2.492538158569056e-01   +9.005472709031710e-02   +5.671951093723810e-01   +2.004467606914318e-01   +2.970605592325156e-01   +3.347323410213863e-01   -1.258110837543970e-01   -1.468676621494053e-03   +3.549967060071438e-01   +2.796186214271471e-01; -7.942236832147308e-03   +3.144200513474794e-01   +1.992545047045648e-01   +6.581261767803635e-02   +4.285882101405417e-01   -2.008519703290061e-02   +4.383820380906839e-01   +2.573126438239732e-01   +2.252598644041967e-01   +2.535292799079476e-01   +1.546772413891105e-02   +1.757625454625216e-02   +1.481197241764184e-01   +7.104044620159125e-01   +7.468127329880882e-02   +2.426225920060592e-01; +4.073903772440133e-01   +1.404841790484629e-01   +2.434668723684760e-01   +5.551469246940100e-02   +3.855919554596778e-01   +2.701971197059947e-01   +1.842029793841692e-01   +9.611013535808935e-02   +9.083585538931051e-02   +5.678307409423912e-01   +1.427785792815731e-01   +2.901773614405380e-01   -7.124710016219971e-02   +2.910554800380190e-01   +6.506254548962432e-01   +1.236305744849036e-01; +4.076650355392434e-01   +3.720105628680851e-01   +1.770342381613202e-01   -7.438639292398708e-02   -2.008399586707736e-02   +2.219021813938242e-01   +2.885313644061192e-01   +2.704779208936964e-01   +4.306172119773539e-03   +6.258740948398529e-02   +8.445282619446451e-03   +6.839766208205211e-01   +2.989167463267206e-01   +5.742555748261989e-01   -1.390746714243246e-01   +6.062789993397303e-01; -4.655709355503593e-02   +9.388618758091116e-02   -1.597400163450083e-01   +1.313155432416532e-01   +3.705350607982381e-01   -4.182238735741604e-02   +5.617063092293879e-01   +1.626077825560140e-01   +2.105754005778412e-01   +2.398955893809543e-01   +1.984784797046784e-01   +5.083895055943836e-01   +3.341136517343621e-01   +8.159569754908247e-02   -4.704870500462656e-02   +2.398893574013750e-02; +8.158719217517299e-02   +1.312048341322961e-01   +2.107046024079128e-01   +6.850860639481867e-01   +2.999907258900246e-01   +1.556536313143763e-01   +2.466472524534083e-01   +3.776056256048223e-02   +9.067131688252725e-03   +1.922257117740457e-01   +2.950736839531773e-01   +8.796697232198832e-02   +2.606414810331132e-01   +8.993207473508941e-02   -1.168560194877661e-01   +5.259072204546351e-01; -1.395193736245965e-01   +5.812676703335024e-01   +1.174602014901057e-01   +2.114182800267314e-01   +5.188409008466130e-02   +6.378579114702839e-01   +2.873014825200201e-01   +5.689845826292866e-01   +4.050392866275857e-01   +1.161202418575376e-01   +3.484366178961951e-01   +4.783888442018384e-01   +6.629164296490967e-01   +3.134335822636035e-01   +1.403751475780690e-01   +4.421032655569121e-01];
L1E_L1I_iGABA_netcon = [+7.052953422397199e-01   -1.881470924777889e-01   +3.145589631638555e-01   +4.053862632659846e-03   +7.590867107540346e-01   +3.938396129764919e-01   +3.069404041812984e-01   -3.316519889514888e-02   +3.335997004540204e-01   +2.193040813747223e-01   +1.147445487540932e-01   +1.951679968903117e-01   -7.347539853706593e-02   +2.801806114139930e-01   +4.165566450878060e-02   -1.464753716247933e-01; +3.299705828128575e-01   +2.085087588969032e-01   +2.050698088890017e-01   -9.102369597338790e-02   +2.500129174409600e-01   +5.206053658348845e-01   +2.844502069151847e-01   +3.811686841672350e-01   +2.517061770237359e-01   +3.162416159206461e-01   +2.027709560675710e-01   +3.643019459264606e-01   +3.114291971433495e-01   +1.165882516444577e-01   +4.616903736876697e-01   +4.187011080619590e-01; +6.203897421827051e-02   +5.450594047384926e-01   +4.154867841921416e-02   +6.202480809475221e-02   -2.471360756610896e-01   +2.035596374792485e-01   +1.784537620544501e-01   +4.160543460682208e-01   +2.090947349758072e-01   +4.566016965940942e-01   +1.152166863338618e-01   +1.153971989998432e-01   -1.956087381015719e-01   -1.621499182391986e-01   -1.271050968221651e-01   +1.031897529201862e-01; +4.189319496668767e-01   +4.843534778280478e-01   -2.681072759403013e-02   -1.362066307029266e-02   -1.270330515431040e-02   +1.500323846509207e-01   -3.570971249776946e-02   +1.182802446483578e-01   +2.912332216967569e-01   +3.617489907382899e-01   +3.458399799666610e-02   -1.335635113029344e-01   +1.672565255233248e-01   -1.291388959709085e-01   -1.820639756443032e-01   +3.799932611094686e-02; -1.597199655231560e-01   +2.165754842421538e-01   +7.036294200586070e-01   +4.062518358331397e-01   +2.155309786375409e-01   +2.115723774661052e-01   +2.521131288569370e-01   +1.848455547783623e-01   +4.743811664454801e-01   +4.976079585609791e-01   +3.565122868773167e-01   +2.492057389034747e-01   +2.988467969971266e-01   -8.414507062616261e-03   +6.951980216186492e-02   +3.720289687964038e-01; +9.101870608749854e-02   +1.958205029832884e-01   +3.767173285190786e-03   +4.662538791007766e-01   +5.526994065983446e-01   +2.040498149899309e-01   +5.649955231993632e-01   +4.449204540077663e-01   +1.676874363870737e-01   +8.853029437978314e-02   +2.064320539187613e-01   +4.497117699951485e-01   -1.914856265633482e-01   +1.696308613420058e-01   +2.613573006402619e-01   -3.089787301851063e-01; +4.151553279696168e-01   +5.156178220005644e-02   +3.394791569343032e-01   -8.688379369442542e-02   +4.403091526180575e-01   +3.608914160753467e-01   +3.511252049233436e-01   +5.998329752527877e-01   +1.037220822993322e-01   +6.208009974913719e-01   +3.911492383463240e-01   +2.675840076249490e-01   -1.150016091244837e-02   +3.034181162007993e-01   +2.015186212105246e-01   +1.178363708553589e-01; +1.148068296129325e-01   +3.732027669628757e-01   +3.140365135742842e-01   -1.874634781245035e-01   +8.982942920483866e-02   +1.683790947685947e-01   +2.172597497172382e-01   +3.337291435905335e-01   -5.429668510620596e-02   +2.561241945603338e-01   +5.297230591129864e-01   +4.030041717514293e-01   +5.534484227452092e-02   -1.041338007440092e-01   +8.652886742927005e-02   -4.450763075122383e-02; +3.268737179752809e-01   -1.912706949558382e-01   +1.947676749091967e-01   +1.314534423287330e-01   +3.065749727731619e-02   +4.918272073210272e-01   +5.250159269543739e-01   -1.366293977766047e-01   +3.806263333745062e-01   -1.234060917752325e-01   -2.401240579726692e-01   -1.196114870652668e-01   -1.442633810144318e-01   +1.077690986790007e-01   +3.339469815483692e-01   +6.358645605371158e-02; +4.754714000352997e-01   +3.405776730600281e-01   -5.489973698375103e-04   +2.134841142946708e-01   +1.956759858866373e-01   +2.631581193585653e-01   +1.529607482575921e-01   +3.433599948191858e-01   +6.093612169219988e-02   +2.614797058646425e-01   +6.537085888670037e-02   +4.773185617456751e-01   -4.395383302447098e-04   +5.570638999288207e-01   +3.048088378606515e-01   +1.650053734807737e-01; -4.325866253641070e-02   +8.983517273171496e-03   +4.274470479777142e-01   +4.835761532717641e-01   +2.152311216780988e-01   +3.914013857771194e-02   +5.111833751338910e-01   -2.714477756770943e-01   +5.294427254566124e-01   +2.200721114701828e-02   +2.230967581519165e-01   +6.031884899357582e-01   +4.839608497387300e-02   +3.229329696057945e-01   +2.788346652735222e-01   +6.786018324065860e-01; -1.222668044442223e-01   +1.373249864496466e-01   +1.469550940796500e-01   +5.004805070944696e-02   +2.028851446452346e-01   +1.386246683850511e-01   +1.474675777995327e-01   +5.309454838579637e-01   +2.368357684737970e-01   -5.830242391884165e-02   +7.135532216941390e-02   +2.485799604988373e-01   -1.571933014055681e-01   +8.197625916865593e-02   +4.136794049716540e-01   +3.399815731898352e-01; +3.531261693535544e-01   +2.117428284141799e-02   +3.636493039459112e-01   +2.380643084770408e-01   +5.840075947237630e-02   +4.332307951730598e-01   -1.255745762698797e-02   +1.619630432677199e-01   +2.955037634774822e-01   +2.131881985933556e-01   -1.310324098260985e-01   +9.246176768473298e-02   +2.413147274816676e-01   +3.348408876287065e-01   +9.630873300867387e-02   +1.883738209540916e-01; +2.488746879839101e-01   +7.893789403675121e-02   +3.605397392582450e-01   +6.032749024233912e-01   +2.999933818681009e-01   -2.228012877712620e-01   +2.272711416946778e-01   +2.136383919044795e-01   -3.894123892226657e-02   +4.101424584119199e-01   +2.284084456888381e-01   +4.941259856529211e-01   +1.408184094302230e-01   +3.141234148905380e-01   +1.578387452825994e-01   +1.180623143602259e-01; +5.353236592984545e-01   +2.469118214456272e-01   +1.454558294004762e-01   +2.204504511999220e-01   +3.253236872293869e-01   -2.113397584374295e-01   +1.308373299964581e-01   +1.557183540664833e-01   +1.401337158604921e-01   +3.580973932048250e-01   +2.361307400189295e-01   -4.188231146301116e-02   -1.144048444397620e-02   +1.560362775934704e-01   +4.371444569390516e-01   -2.702448328756510e-01; +2.300050476866687e-01   +2.518221547709804e-01   +6.864681474290775e-02   +2.087511948888082e-01   +1.861017859283569e-01   -4.157536629978049e-02   +2.470823557819077e-01   -5.836336622981081e-02   +1.784446907248632e-01   +5.772125797834399e-01   +3.655408112062398e-01   +5.977938053521898e-02   +4.141371990366431e-01   +7.048429804583931e-01   +1.030778579256887e-02   +3.488780512563752e-01];
L2I_L1I_iGABA_netcon = [-1.101380551062099e-01   +4.087510876005947e-01   +4.861973527967531e-01   +3.593210717523055e-01   -5.411974809794232e-03   +2.589082005140456e-01   +4.389754784692432e-01   +2.611750629617038e-01; +4.498242627490833e-01   +4.422056536906029e-01   +2.093701059061975e-01   +4.494618913779550e-01   +1.879839368743005e-01   +1.983336969735132e-01   +5.345399302099765e-01   +5.586885126189879e-02; +1.686720702307836e-01   +1.932911347826827e-02   +6.492807909784105e-01   +6.840691916206916e-01   +5.092679204215108e-02   +3.190290024488779e-01   -2.889603970175154e-01   -1.152091303643574e-01; +2.155204947524929e-01   +1.321669247872030e-01   +4.257116180475198e-01   +5.711806269396793e-01   +5.342058776936267e-01   +2.693837475821147e-01   +7.929978595356305e-01   +2.021486367955059e-01; +1.430169258545126e-01   +2.694916901247160e-01   +3.187318246535060e-01   +4.412118653248813e-01   +5.414985906867323e-01   -5.677815341898562e-02   +5.912792495928875e-01   +4.007951393411995e-01; +2.370301620729093e-02   -1.541126362985044e-01   +5.363773498609656e-03   +5.810134793709198e-01   +2.378109624997201e-01   +3.613029065010162e-01   +3.416218865524231e-01   +6.500526870928863e-03; +5.322504158786515e-01   +3.833636474021884e-01   +4.298132879047982e-01   +4.891193467829987e-01   -3.807089438630083e-02   +1.025217972534349e-01   +4.912061200482359e-01   -1.033134380876517e-01; +4.602868353000162e-01   +3.473185375994515e-01   +3.385522977063446e-02   +1.741545587134336e-01   +4.087304446362250e-01   +6.137591324926424e-01   +4.961610076578990e-01   +8.994286897341872e-02; -1.463221516406850e-01   +7.339012231052444e-01   -1.012108223834916e-01   -7.422425204370367e-02   +1.565370536255901e-01   +4.581730200982456e-01   +6.017294538189710e-01   +2.308021724950854e-01; +3.028407310343576e-01   +2.768106438065790e-01   +6.503395985700855e-01   -2.950773359872283e-02   +1.411174447186876e-01   +2.741311698622979e-01   -2.029566467127606e-01   +1.476854789082760e-01; +3.544757907453644e-01   +5.950134026777125e-01   +1.097221489834525e-01   -4.013185873205839e-02   +1.346842215287327e-01   +3.819809438379441e-01   +2.659755690553552e-01   +2.003965864032082e-01; +3.100635430959476e-01   +5.923542071910444e-02   +2.807870742786947e-01   +1.435835789403059e-01   -1.992982520486911e-01   +2.885016447086846e-01   +5.410488238904458e-01   +1.866150816345387e-01; +8.690444322349625e-02   +2.093218515205817e-01   +1.310888183396433e-01   -6.989356355911239e-02   +4.897444720733833e-01   +6.203986035008587e-02   +1.687242164124249e-01   +1.830412914971803e-01; +6.703496601843989e-01   +3.203454915046713e-01   +7.367384694091063e-01   -9.451661964077539e-02   +4.053250104850080e-01   +4.598241223018595e-01   +7.097221990535071e-01   +2.067661354190643e-01; +3.067435526076732e-01   +4.404850079444459e-01   +2.796909806876892e-01   +1.381247161248425e-01   +2.740757003770197e-02   +1.110625540360968e-01   +1.049551884392855e-01   +6.529505901492719e-03; +3.437869953433040e-01   -1.473665387731433e-02   +5.206855662881070e-01   +5.483152941954944e-02   -2.594471832987272e-02   +3.702747258521754e-01   +2.942964900773370e-01   +6.924732790424026e-02];
L1I_L2I_iGABA_netcon = [+4.922493562405598e-02   +1.406505272184509e-01   -8.730916281957023e-02   +1.373910260910212e-01   +3.333279037362188e-01   +4.236323535091833e-01   -1.307753527423442e-01   -7.755071882527530e-02   +2.372401411295958e-01   -2.968836330674279e-01   +6.011530302503209e-01   +1.348008412430959e-01   +2.348857075476550e-01   +3.477686911149411e-01   +3.278696771466597e-01   +3.565236769104096e-03; +2.460982136742541e-01   +2.664530240217394e-01   +6.714760133894546e-02   +2.289747535730857e-02   -1.026052016090029e-01   -5.191721466012850e-04   +1.147553566669687e-01   +3.570111162476522e-01   +7.026315913700458e-01   +3.401567983668857e-01   +3.225605804709193e-01   -2.107391647751941e-02   +1.800074132585535e-01   +1.672630612670238e-01   +7.874839784662270e-02   +1.792413467539860e-01; +4.553752460947788e-01   +2.662048014509928e-01   +3.549325235774011e-01   +5.431226948333138e-01   +2.425319521654159e-01   +2.946713317431425e-01   -2.370342443940988e-01   +2.033070217594067e-01   +5.761532849195154e-02   +3.346629480412162e-01   +2.886803014873854e-01   +8.985498702398265e-02   -1.660962871478502e-01   +1.465579914690912e-01   +5.275597038798047e-01   +1.815195238709561e-02; +4.797713530112581e-03   +3.837066309504477e-01   +4.210562956071298e-01   +4.865719089338819e-01   +1.072638287923477e-01   +4.221879192591516e-01   +6.414686942346054e-01   +6.812978900852001e-01   +8.761576818301335e-02   +1.188159708475032e-01   +5.413457719339440e-02   +1.466566040996895e-01   +4.208829644323618e-01   -2.242190399631926e-02   -8.705466150364785e-02   +1.695229600402501e-01; +1.549333804020009e-01   +5.349960001751477e-01   +2.762040558170349e-01   +2.942313067763465e-01   +5.337191450515151e-01   +4.110987152789731e-01   -1.074379037328648e-01   +2.449143703687712e-02   +5.314718970118610e-02   +6.391974246490448e-01   +4.666735435419189e-01   -3.487446340906296e-02   +4.957430281728527e-01   +1.771417371243060e-01   +6.536999444609408e-01   +2.791208901081320e-01; +6.728548837601932e-02   -1.707904841918560e-01   +2.777946475840205e-01   +3.131008157796293e-01   +9.549735766842123e-02   +6.390573629264327e-01   +2.663318687283415e-01   +1.825142496846639e-01   -4.000793589147583e-01   -1.051724676509967e-01   -4.167605925577290e-02   +1.906963983784275e-01   +5.315522300950971e-01   +6.827550531052238e-01   +2.205499541034515e-01   +3.521938707420014e-01; +4.129448026190394e-01   +4.502068264661312e-01   +3.145084150458654e-01   -1.095843130608428e-01   +5.930498760107248e-01   +1.969445424843650e-01   +2.955887996965813e-02   +1.147897609333153e-01   +1.305450746005513e-01   +3.198935575531695e-01   +4.093121966705483e-01   +1.617006347458222e-01   +6.532725506979270e-01   +3.267786729447751e-01   +2.443984513340088e-01   +3.545127480733379e-01; -1.457933545096279e-01   +1.547307746328945e-01   +5.276691975800538e-01   -7.328708640899888e-02   +3.559236412202808e-01   +3.372889065980801e-01   +1.906834230593306e-01   +2.937191196293804e-01   +6.074796688458456e-01   +3.190150500290411e-01   +2.354402991701868e-01   +1.207481741165937e-01   +2.454117393848397e-01   +5.742239751602582e-01   +4.841117792911484e-01   +3.538367859354034e-01];
L2E_L1E_iAMPA_netcon = [+2.574019438554849e-01   -3.448359844619526e-02   -1.146927605274935e-02   +6.754593118561847e-02   +4.625368402205209e-01   -5.540594569985020e-02   -6.660993016866090e-02   +6.154491551188698e-01; -3.516488187881772e-02   +3.719795660849359e-02   +6.392346041950723e-01   -1.236754791710208e-02   +1.015062740463946e-01   +6.664030386330255e-01   -1.897898245662549e-02   +1.751311250073643e-01; +8.111343594687020e-01   -1.599269653212393e-01   +2.775622601079324e-01   -5.750639741167742e-02   +2.995710704117496e-01   +1.398336318441054e-01   +1.609656713639294e-01   +1.942611103083380e-01; +3.677365202012693e-01   +4.280433413017966e-01   -6.845316730917762e-02   -1.408737506155910e-01   +1.583025234197780e-02   +1.246402411071777e-01   +1.797065366472957e-01   +4.333086348678828e-01; +3.139353792073772e-01   +6.974750280075896e-01   +2.138826893322323e-01   +1.441443433843842e-01   +2.718492423867749e-03   +2.963659311259188e-01   +7.230779774647332e-02   +4.239804949203990e-01; +2.965322958614894e-01   +9.914562990998160e-03   +5.847531092513362e-01   +4.385764129257294e-01   +3.799135433119675e-01   +6.518686919111938e-01   +2.285466447296918e-01   -4.443837232922571e-02; +3.368472174416604e-01   +4.384391172751841e-01   +1.053080024327457e-01   -7.324065324930920e-03   -2.301195077853458e-01   +2.017832600593253e-01   +4.954114395722293e-02   +3.005731548919714e-01; +2.993879816092384e-01   +5.119082889390176e-01   +3.839748884328023e-01   +4.765911493918882e-01   +2.846948409279564e-02   -5.817012838026049e-02   +3.237356741311863e-01   +1.350228287381451e-01; +1.663157041287530e-01   +2.188075239681878e-02   +6.941788581329963e-02   +4.349170695065640e-01   -3.859523999681069e-02   +6.001700892609267e-01   -6.588988667288395e-02   -1.068578724388073e-01; +2.011381769828017e-01   +4.243666377091533e-01   +2.230814526003241e-01   +6.394608006234177e-01   -1.005484452822467e-02   -7.484121786694689e-02   +2.032126052190602e-01   +2.227065553517605e-01; -3.463624746956008e-02   +1.987234387007477e-01   +1.525798458090657e-01   +8.235797497545853e-02   +1.356323531837015e-01   +2.228041232039250e-01   +2.981360740901325e-01   -9.851269266632695e-02; +8.395201913152294e-01   +3.082289207283688e-01   -3.417806022542740e-02   +7.600915152971216e-02   +1.919803032838126e-01   +4.311393259307570e-01   +3.234804421122154e-01   +5.074842177197132e-01; +5.407555448663719e-01   +3.958101008035701e-01   +7.985404491151259e-01   -4.045442792223608e-02   +3.663938712118096e-01   -7.487529582284369e-02   +1.439419690731450e-01   -1.785234011844370e-01; +2.984702687690079e-02   +3.256599863928872e-01   +3.586729891694609e-01   +4.569451254624595e-01   +2.565513410850533e-01   +4.601817893708358e-01   -9.001137667652581e-02   +4.747239233369641e-01; +3.719168145757425e-01   -1.570285998367070e-02   +8.111027128380219e-02   +9.767078084073035e-02   +3.698212344530610e-01   +4.206672922883476e-01   +6.103326467520556e-01   +2.196066297146347e-01; +2.300440170155774e-01   +3.340717914276603e-01   +1.107231608655734e-01   +3.621012767026662e-01   +4.018136586059787e-02   +2.306378422874376e-01   +7.996180453022685e-02   +3.337590955521281e-01];
L1E_L2E_iAMPA_netcon = [+5.849827783970664e-01   +1.359399278913510e-01   -1.912378778755529e-01   -1.112689679335317e-01   +5.708451770738384e-01   +1.446746123352540e-01   +1.517685215216965e-01   +3.176678375587910e-01   +4.707949385523355e-01   +3.497026700044652e-01   +1.373080415524186e-01   +5.645414865288524e-01   +3.709695326633806e-01   -9.414630531243319e-02   +2.826409836547290e-01   +2.899614514477521e-01; +3.075705216030497e-01   +4.254839222579918e-01   +4.285579815460496e-01   +2.326513217593788e-01   +4.043463822177967e-01   +4.726573174578040e-01   +6.242534134363725e-01   +1.418874685376646e-01   +6.182207655482162e-02   +1.307999395456806e-01   +6.984341618599771e-02   +3.359787240383533e-01   +3.485873111048823e-01   -2.634161998605383e-01   +1.893617405443383e-02   +6.225858181248944e-02; +1.532774198119112e-01   +3.406824450885158e-01   +3.784537207473943e-01   +7.430180343409549e-01   +5.116492960841476e-01   +4.134244185505436e-01   -2.231741177193861e-01   +2.622566195101144e-01   +3.586049978970339e-01   -1.373937216354602e-01   +4.529778463474763e-01   +4.889221270305436e-01   +3.560310284867507e-01   +6.527497882879533e-01   +8.596890937057478e-02   +5.227798845124189e-01; -2.348583207083439e-02   +7.317189721332422e-01   +4.262977991055933e-01   +6.042748928420008e-03   +2.166778615914065e-01   +1.063477353267536e-01   +3.469248471428679e-01   +3.872828310260615e-01   +2.923242149304917e-01   +2.428140937164965e-01   +1.942405006247367e-01   +1.062189104973909e-01   +4.452958526933408e-01   +1.971168891552173e-02   +6.173628940422672e-01   +3.852502685044862e-01; +3.733098942180137e-02   +2.913979228980040e-01   +5.254269685617661e-01   +2.914901934967115e-01   +5.744486275236231e-01   +2.552907100517801e-01   +3.945785404182032e-01   +3.257901350164069e-01   +3.638854950159812e-01   -6.335592055122047e-03   +6.165876578333210e-01   +5.869645905330897e-01   +1.682653884122865e-01   +2.701933759471477e-01   +2.091567064791944e-01   +7.940182675485580e-01; +4.128691499306396e-01   +6.902829133037038e-01   +4.998974424468312e-01   +2.162417570137105e-01   +5.327485525760391e-02   +6.022705695574732e-02   +1.925503707128199e-01   +3.925632458175781e-01   +5.188308474998788e-01   +3.212053547151221e-01   +3.817649915864685e-01   +1.681712939567683e-01   +1.813031990091515e-01   +4.905414671793182e-01   -1.805615881933805e-01   +1.510850872052051e-01; -1.684637927220726e-01   +5.785788870915199e-01   +6.552521312873738e-01   +2.350891690736880e-01   +4.243907665203735e-01   +3.569559462053488e-01   +5.621615525432866e-01   +2.050388232796829e-01   +4.145355366574614e-01   +2.727596991571888e-01   -6.914923653983227e-02   -1.274760109030100e-01   +4.167567847796816e-03   +9.018037108298055e-02   +1.601459482590413e-01   +1.482162251400362e-01; +1.950836780846420e-01   -2.213357510026311e-01   -2.081151747542496e-01   -4.347958280315913e-02   +1.773695969460582e-01   +3.560103065176112e-01   +5.090145233786424e-01   +2.384827072058352e-01   +8.348451865039506e-02   +3.745035772225324e-01   +1.319832872415971e-01   +4.774786522767483e-01   +5.214413168771332e-01   +2.112896438873082e-01   +3.902916718068886e-01   -1.920017503895265e-01];
L2I_L2E_iAMPA_netcon = [+3.371858603709091e-01   +5.010165773026262e-02   +5.772827729174910e-01   +2.762921786241820e-01   -1.776797155930830e-02   +3.064643383942711e-01   +3.919805008449213e-01   -6.859353520455033e-02; +4.447103235141310e-01   +2.436260319732343e-01   +5.107618594090211e-01   -3.435101009281818e-02   +3.531067405487914e-01   -5.938423405169427e-02   +1.077005538633476e-01   +2.063112055784051e-01; +1.867149761911804e-01   +5.509556205465806e-01   -3.242458936347876e-01   +2.189497877671401e-01   -7.810540248966932e-02   +4.636017155866548e-01   +1.675814769191294e-01   +5.267341398265428e-01; +5.729874584609083e-02   -4.683905043139549e-02   -2.569439189875350e-02   -2.433280842625769e-02   +3.119146089039151e-01   +6.180277761017718e-02   +6.582087114300722e-02   +3.931945492265897e-01; +5.078189720435791e-01   +6.495749059890121e-01   -3.490050750183447e-02   +4.765367060675337e-01   +4.023169379357701e-01   +6.545375483941756e-01   -4.541940418016815e-02   +1.096258865445397e-01; +2.720241213169866e-02   +3.909424075991946e-01   +1.164550470519083e-01   +1.847167610098862e-01   +5.713487123806698e-02   +1.401288814654317e-01   +1.591148730893601e-01   +2.323000985522224e-01; +4.781235474709781e-01   +2.739175978988176e-01   +2.061563155215453e-01   -1.156694425587416e-02   +3.002764506568572e-01   +7.110476301912548e-01   +2.779878685633355e-01   -2.294869206600597e-01; +4.537497143033171e-01   +5.094076211992262e-01   +3.637241248435661e-01   +6.068535436680860e-01   +5.790645236001530e-01   +3.018655089510504e-01   +2.181988095326144e-01   -9.980183074711620e-02];
L2E_L2I_iGABA_netcon = [+3.952753475968696e-01   -2.427131098530540e-02   +3.456042991168610e-01   +4.866519019352983e-01   +1.606087064044650e-01   +3.711379117288797e-01   +6.558227968338970e-01   +3.677323243275556e-01; +5.226442457227972e-01   +2.539529812374722e-01   +4.466892669582258e-01   +1.661532448951187e-01   +4.928433274146625e-01   +1.221470146341642e-01   +5.025657907975625e-01   -1.598192741721244e-01; +1.540548193218040e-01   -2.255738673141023e-01   +5.420702853398149e-01   +1.453754795693557e-01   -3.254227569869680e-01   +5.670908967790069e-02   +2.007862478790926e-01   +3.474958487040078e-01; +3.709623347116207e-01   +5.023594761547265e-01   +2.401931345002968e-02   -6.793623976417247e-02   +1.243177146276046e-01   +6.243377159204062e-01   +6.142901969563789e-01   +6.509152414855138e-02; +2.723119842902870e-01   +4.492760122115312e-01   +3.422287522126497e-01   +3.051602441112224e-01   -2.066277340466290e-02   -1.620246070292119e-01   +2.552295630534834e-01   +3.430275861656367e-01; -1.244351558570331e-01   +3.376908425949898e-01   +7.112885834400675e-01   +3.351918467810312e-01   +2.280410418241046e-01   +2.726601396798965e-01   +3.762232428988312e-01   +3.709864936563786e-01; +3.503079796119214e-01   +1.840600492285316e-02   +5.874161368517106e-02   +3.421391806145813e-01   +4.178910479136427e-01   +7.039585416138677e-02   +8.348739251277330e-02   +4.166938952606092e-01; +2.115423737443875e-02   +1.778469171991096e-01   +3.274202822876053e-01   +4.166882400893865e-01   +8.229597752560099e-02   +4.196633005571527e-02   +1.107210727706197e-01   +3.000000875920716e-01];
L3E_L2E_iAMPA_netcon = [+7.615809694520459e-02   +4.351698865069333e-01   +6.274606395566557e-01   -3.622264388028015e-01   +4.962864933238368e-01   +2.280579805560533e-01   +1.983857142112897e-01   +8.089570477771085e-02   +5.931567361574139e-01   +6.124413819696671e-02   -1.103680580763034e-01   -9.955030772634856e-03; +1.806649949646651e-01   +3.523642676441799e-01   +1.607566496142889e-01   +4.557825583702679e-01   +6.904030089241461e-01   +2.351255636458174e-01   +3.307374968318564e-01   +4.089122640021365e-01   +1.996799977012715e-01   -1.860243132503442e-01   +2.585091441133227e-01   +5.073878445244305e-01; +2.671448560805419e-01   +2.884184950855591e-01   +5.594572994579396e-01   +3.919710096241127e-01   +8.452802120278291e-02   +6.589858224209925e-01   +5.582523260473635e-01   +7.909867030331938e-02   +3.198395797822086e-01   +3.826478418597355e-01   +2.223385419482292e-01   -2.412109857522000e-01; +3.241110780349251e-01   +3.680480158690822e-01   +5.457045265437740e-02   +1.754981681233634e-01   +7.146719872851193e-02   +1.460083887165226e-01   +4.386611575530741e-01   +2.671215904881976e-01   +1.887201328379038e-01   -1.133497017771098e-02   +8.697389746306572e-02   +5.440397561594139e-01; -1.335628674752834e-01   +3.703893927576215e-01   +5.914678893244103e-02   -1.928303702822357e-01   +2.434080009612387e-01   +3.561092147537077e-01   +4.757063976252288e-01   +1.833905951810842e-01   +5.847493421675639e-01   +2.806613673487016e-01   +2.814488920714859e-01   +6.184544438941715e-01; +3.896087482184645e-01   +1.884144141408508e-01   +2.853074132499334e-01   +2.137587087854603e-01   +3.702288552979695e-01   +2.376530198683712e-01   -4.524495263733858e-02   +4.100594376617911e-01   +2.867944557207988e-01   +2.410024415172377e-01   +3.534175906815485e-01   +3.943797767124650e-01; +1.682323090343264e-01   +5.522262556500173e-01   +2.677781371554717e-01   -3.254124282920179e-02   +1.940837831361683e-01   +1.910758341006986e-01   +5.765986143744583e-01   +2.310038734654261e-01   +6.620213356294899e-01   +2.926064818317705e-01   +6.528172932841573e-01   -2.625642704188075e-02; -1.052384025821842e-01   +3.556810573655620e-01   +4.121773238468186e-01   +1.125314625175031e-01   +2.513893788000143e-01   +1.884080316649504e-02   +2.013202864426898e-01   +4.913809255891791e-01   +8.407107627423308e-02   -1.925388149471366e-01   +1.984507372694626e-01   +3.664810801368384e-01];
L3I_L2I_iGABA_netcon = [+6.080946200625195e-02   +6.134860063320134e-01   +2.082886756035880e-01   +1.311449894726959e-01   +3.271705927485662e-01   +5.706937783787799e-01   +6.780138079557435e-01   +7.505313691802844e-01   +2.492944189605754e-01   +1.952807554841147e-01   +4.891187491291307e-01   +2.643452194172559e-01; +6.498344670845098e-02   +1.643281170184256e-01   +2.303419047227780e-01   +1.063151190255878e-01   +6.296229155741028e-01   +1.957004959511530e-01   +4.974632762773281e-01   +2.004540612220208e-01   +7.773864565639621e-02   +1.806662711056307e-01   +1.381264856196759e-01   +3.182300430098463e-01; +5.872436465279500e-02   +3.852126420678442e-01   +2.146191531060778e-01   +1.626054875284891e-01   +4.996742711029780e-01   +5.425865339997125e-01   +3.352682909478431e-02   +4.264960256872915e-01   -1.852805733279687e-01   +5.280981750761642e-01   +3.924514817249997e-01   +1.564356834030185e-01; +2.634671021190211e-01   +6.956771009702650e-02   +3.239952108026449e-01   -1.112392065999632e-01   -8.570136445480585e-02   +2.083006680385154e-01   +3.458169791581869e-01   +5.442210653806075e-01   +4.229478922537087e-01   +3.303102319678122e-01   +3.642380286507035e-01   +2.878550688607132e-01; +5.075387560860145e-01   +2.303311397040385e-01   +3.062723774494137e-01   +4.423421533377582e-01   +8.174696900418524e-02   -1.587947988515450e-01   +5.240083550418553e-01   +2.232966597376401e-01   +4.687394413357465e-01   +4.835169474068789e-01   +3.075323224939572e-02   -1.350921508737888e-01; +5.747619612998993e-01   +8.269703095861607e-02   +4.631557215748079e-01   +4.577949686232549e-02   +2.885803813719073e-01   +1.734347420861751e-02   +3.033607588018123e-01   +2.170380846974782e-02   +7.038312811551559e-01   +8.259957132735929e-02   +7.946333309720973e-01   +2.291302621000026e-01; +3.096160119968488e-01   -1.607510050859179e-01   +4.405865947847907e-01   +8.109405745575016e-02   -3.043114955250191e-02   +2.315688654584766e-01   +2.489787535385437e-01   +3.436838045048272e-01   +8.753629807392803e-02   +6.045275741319143e-01   +1.357529883334136e-01   +2.457825981569186e-01; +6.718759629427238e-01   +1.056933060830979e-01   +3.505286686472159e-01   +3.215638450888321e-01   +6.373243346245600e-01   +6.130102899674967e-01   +1.559881185848841e-01   +3.195184900797866e-01   +1.007594129456817e-02   +2.438532896292522e-01   -2.639068503086437e-02   +1.966982106354189e-01];
L2E_L3E_iAMPA_netcon = [+4.365361352665590e-01   +4.487402692339451e-01   +7.781875572315440e-01   +1.632780984949921e-01   +3.927276195563366e-01   +3.039717073806210e-01   +4.892438231220711e-01   -1.012314593091565e-02; +3.148836874826257e-01   +4.833777191233637e-01   +4.873636418632423e-01   +6.820386359950542e-01   -2.183374507149462e-01   +3.058334873345036e-01   +5.452443844536838e-02   +2.496223911057233e-01; -2.057571687059618e-01   +1.592398765255490e-01   -8.175501688391645e-02   +2.594467664878582e-02   +2.052264378452816e-01   +3.218122631599587e-01   +5.895249444531019e-01   +5.386159383475390e-01; +2.775729961634489e-01   +4.565173342826099e-01   +5.872026921735510e-01   +2.926593258210258e-01   +1.542795626584051e-01   +1.820519063480544e-01   +4.457587317758627e-01   +1.200854562087220e-01; -1.344754075494575e-01   +1.436584559752993e-01   +3.235191490400250e-01   +2.459753944911330e-02   +6.538176450071969e-01   +3.194793005259494e-01   +3.822043673658246e-02   +2.289611655799653e-01; +1.346423807172038e-02   +6.446351859415818e-01   +3.631277248408022e-01   +5.147547169290085e-01   +4.168639413560454e-01   +7.726502154824333e-02   +5.780666602290868e-02   +1.201578262150573e-01; +3.303162332542261e-01   -1.243520241385244e-01   +5.142993022959881e-01   +6.653743540717983e-01   +3.058841137266975e-01   +2.290599505593612e-02   +4.210867869629583e-01   +5.022989633398888e-01; +3.298321189557929e-01   +4.060415684196489e-01   +2.603953329988598e-01   +1.249732561750513e-01   -7.526277438535983e-03   +1.709969234262178e-01   +2.090253297507700e-01   -6.753935856547774e-02; +1.260297055705147e-01   +3.383482926842786e-01   +1.099437446097801e-01   +4.268140513265366e-02   +2.466881982347067e-01   +8.661294606043576e-02   +7.196714245253948e-02   +1.966955580222578e-01; +4.138607916386716e-01   +2.352585948762071e-01   +7.403223554677142e-02   +5.985289459208407e-01   +1.741219062652778e-01   +5.658960303153413e-01   +5.265497338872978e-01   +3.970236021405290e-01; -1.374124141665824e-02   +4.430297040398579e-01   +3.048278298004167e-01   +3.084876398366421e-01   +8.394431770118375e-02   +5.349018094148292e-01   +2.720206950026616e-01   +6.741265226095820e-02; +5.401025871470511e-02   +9.154579763705932e-02   +4.125621981168990e-01   +3.845199878056985e-01   +7.238915956296860e-02   +2.240345665245664e-01   -1.296184009841947e-01   +2.521798821135877e-01];
L2I_L3I_iGABA_netcon = [+1.592766799474274e-01   +4.841658242153581e-01   +7.233854825789349e-01   +5.678806775982269e-01   +4.565651270216051e-01   +4.054953564049615e-01   +5.873631653156231e-02   +1.567375047789100e-01; +3.024898299492094e-01   +6.366358654270444e-01   +6.282656794790953e-01   +1.174134820982715e-01   +3.739558521188037e-01   +2.019565988434140e-01   +3.205328056466279e-01   +4.621625731291893e-01; +1.792447462871275e-01   -1.635836475140280e-01   +6.924288259047044e-01   +3.730152369043043e-01   +3.901667245248497e-01   +2.488391630913891e-01   +3.770697323175405e-01   +3.952341314900185e-02; +2.139019249528694e-01   +3.457354488802758e-02   +4.730300961157393e-01   +1.919229671874342e-01   +3.080410133685552e-01   +6.044524494655135e-01   +4.323052772226071e-01   +2.624283592903215e-01; +1.133514311245792e-01   +2.233791863294863e-01   -1.063919983713576e-01   +3.020175188282234e-02   +3.949490930726969e-01   +3.329232811708097e-01   -9.851995257889530e-02   +3.705511667349745e-02; +4.769645125092601e-01   +6.234369745793211e-01   +2.410660864104855e-01   +5.817289854414159e-01   +4.439295557550209e-01   +1.810221630437022e-02   +2.953397915961936e-01   +2.170668027512178e-01; +1.772259329356303e-02   +3.731224316894532e-01   +2.071114212986401e-01   +2.497907246030494e-01   +4.879224708252156e-02   +5.108305778346777e-02   -1.836033080597149e-01   +3.362823058966175e-01; -6.135758767096185e-02   +5.397873443228842e-01   +2.966613997792074e-01   +3.022793587438891e-02   +2.927701855196798e-01   +3.509735681668359e-02   +1.768410767745127e-02   +2.849565687496696e-01; +7.811820990090357e-02   +1.890226036281722e-01   +1.638877259895718e-01   +9.970952097433372e-02   +2.378737706603376e-01   +4.190016073468297e-01   +3.952603435677442e-01   +1.816404335392006e-01; +2.711308138487691e-01   +6.176713842685297e-01   +3.175969080197849e-01   +3.297446304037602e-01   +2.557800353073387e-01   -2.584845162535231e-02   +3.692338941094894e-01   +2.578746340141903e-01; +4.512419346879169e-01   +1.895269553051636e-01   -1.466854569309507e-01   +3.101804747614629e-01   -1.073352541624241e-01   +1.235932446494993e-01   +2.328597619096017e-01   +1.494699124979477e-01; +2.052075677414514e-01   +1.532566895440666e-01   +3.332867858375513e-02   +2.363339653065283e-01   -2.174968684866616e-01   +3.170542670930928e-01   +3.933553918430043e-01   +2.175094803688273e-01];
L3I_L3E_iAMPA_netcon = [-1.760441882805573e-01   +7.434808172839200e-02   +5.667312648991407e-01   +1.346442186533865e-01   +5.926056594365501e-01   +2.542258332013366e-01   +1.992102033941388e-01   +8.307493962157723e-02   +2.567754496588643e-01   +5.426285547603923e-01   +4.482260027217413e-01   -8.991546167125425e-02; +6.557548676923639e-01   +8.876280231896479e-02   +2.073737982972551e-02   +1.976423476018223e-01   +4.801262949847533e-01   +7.473529846721912e-02   +1.210545035510047e-01   +3.195507999295661e-01   +4.561469096008167e-01   +1.584382745479078e-01   -7.655842306985253e-03   +3.479048045090204e-01; +6.998014436317257e-02   -7.498495340608116e-02   -4.602353645935746e-03   +4.167819028142967e-01   +1.072092785752421e-02   -9.680008970204095e-02   -3.582286485545755e-01   -3.163469082925041e-01   +6.078457355506293e-01   +9.963011020504708e-02   +1.487051127398583e-01   +2.523952230294642e-01; +4.303215732645178e-01   +6.049852304131073e-02   +2.081759711678116e-01   +2.475774498766800e-01   +3.119021345315574e-02   -3.455635900375786e-02   +4.045393724152942e-01   -7.733947463074435e-02   +1.080882589368697e-01   +1.170164853734788e-01   +5.381869313226515e-01   +4.871043456784304e-01; +5.867388067544019e-01   +2.154628336927087e-01   +2.761013904782417e-01   +2.650403489478934e-02   +4.320636134838901e-01   +4.210165185606914e-01   +7.908496355692730e-01   +1.059915449241619e-01   +2.230596536991235e-01   +6.238679708391748e-01   +2.735313600010990e-01   +4.035978159572308e-01; +2.967798037755963e-01   +5.997017631573696e-03   +1.284122123839849e-01   +3.023702517927787e-01   +1.706543869672426e-01   +1.285482515934354e-02   +4.579560381564341e-01   +3.501985989596466e-02   +2.201753032199629e-01   +6.012993347164197e-01   +2.767842977440523e-01   +3.106383214356921e-01; +5.027585302436643e-01   +6.448930069057975e-02   +2.023000453295666e-01   +3.135401215465081e-01   +3.450961111807790e-01   -3.578580952709548e-01   +3.401810377413264e-01   +5.239569455419780e-01   +2.749390908109580e-01   +3.821902307494223e-01   +3.636305345565496e-01   -4.424433644330600e-02; +1.120851644118878e-01   +3.210336570273656e-01   +6.167744728486507e-01   +3.460337939889387e-01   -7.903631969429112e-02   +3.655148377437846e-01   +2.710872698994216e-01   +2.421516978625994e-01   -1.800283499714536e-02   -1.624093488533922e-02   +5.177634873427192e-02   +3.526999044711651e-01; -2.298907153771321e-01   +4.734163193134566e-02   +1.737315896617998e-01   +3.572548244757100e-01   -1.394379059658948e-01   +1.712389971233596e-01   +8.698894877016103e-02   +4.416594993785880e-01   +4.302030422233616e-01   +3.582285058535318e-01   +1.675451931345486e-01   +1.062223287189032e-01; +2.678170037282681e-01   +4.428415803206942e-01   +3.657581638486000e-01   +5.884380207201121e-01   +3.271920987572504e-01   +1.711631526704209e-01   +4.653040827674341e-01   +2.689768931444454e-01   +1.646411842464580e-01   +1.767510146735043e-01   -2.185111335176765e-01   +7.861386706131763e-01; +8.009090015705920e-01   +4.369794717465389e-01   +1.919331242646088e-01   +1.199262825193040e-01   +5.238798801609197e-01   +2.521956498656528e-01   -2.412041114998966e-01   -1.544202768114062e-01   +4.673297489664825e-01   +2.333234961017900e-01   +3.070613868181694e-01   +1.272194908879671e-01; +1.940428011506679e-01   +3.258030237960147e-01   +2.685483041214767e-01   +2.591667533439976e-01   +3.649054351253099e-01   +2.271966777697271e-01   -1.238952584258159e-01   +1.437586623208200e-01   +2.887323935040524e-01   -1.012779565777036e-01   -1.806753568229345e-01   +5.466015748154963e-01];
L3E_L3I_iGABA_netcon = [+2.930961252440455e-01   +4.948508020412712e-01   +3.222034851507032e-01   +2.594444144009780e-01   +1.113255916611615e-01   -9.721817012407624e-02   +1.471642609719313e-01   +1.670672741702115e-01   +3.881696253071181e-01   +2.717894172133450e-01   -1.735109293026636e-01   +1.933406582726678e-01; +4.904698391782757e-01   +4.922024721242606e-01   +1.220412489357931e-01   +4.674033975830007e-01   -1.430330256170519e-01   -4.108368096322954e-01   +4.878635412838370e-01   +6.206413539023838e-01   +2.663760727693368e-01   +1.540705786114847e-01   +3.182051392624441e-01   +4.433012218942819e-01; +1.514284202918773e-01   +2.369625335588019e-01   +7.902040049401791e-02   -2.876099705653881e-01   +1.543667895317915e-02   +6.771468185944993e-01   +5.215062288684525e-01   +3.105240124285158e-01   +4.160127641805408e-01   +2.230561152517577e-01   +1.668179649456117e-01   +2.498387119343944e-01; -1.520045012069626e-01   +1.746683752473076e-01   +1.246216911331013e-01   +2.643311000345212e-01   +1.807706916705874e-02   -2.922305379694813e-01   +2.266708189706059e-01   +5.526367511971985e-01   +2.993609620637833e-01   +4.035819095660597e-01   +4.000384376839745e-01   +5.086079506572251e-02; +2.121731100690723e-01   +2.917561507474243e-01   +1.416694280517193e-01   -1.614501354926941e-01   +1.858468975454969e-01   +1.097697339180603e-01   +6.760163173607776e-01   +3.479551341141146e-01   +2.201525727181563e-01   +4.281456908189707e-01   +2.834101267511358e-01   -2.199807681261945e-01; +3.998381324230664e-01   +6.314502573826758e-01   +5.181002090948851e-01   +2.441659225785907e-01   +5.127196231181341e-01   +3.145559649158988e-01   -1.798015972871287e-01   -2.027140239679776e-01   +8.433021002434229e-02   +6.422784539076239e-01   +5.758046932361398e-01   +4.636112297013645e-01; +1.677461365202963e-01   +5.152808125362323e-01   -2.385439807753801e-01   +3.859337421367575e-01   +5.291661476156564e-01   +3.776792308615227e-01   +9.424898628004567e-02   +1.271725708453644e-01   -9.269878295097568e-02   +6.312274004452216e-02   +2.086462227235718e-01   +2.204818201586656e-01; +3.562685090424321e-01   +1.402320396330587e-01   +4.336322753638227e-01   -1.850351065140446e-01   +3.417818668801036e-01   +1.768809620052735e-03   +4.231999398361448e-02   -1.006951872136223e-01   +8.095981651049341e-01   +4.828399579746152e-01   -1.110515093561820e-01   +6.071293770240751e-01; +2.972518404948552e-01   +2.940540786403670e-01   +4.453318272184495e-01   +4.460738599970386e-01   +8.504986935244654e-02   +1.750598835840399e-01   +5.146095189862467e-01   -2.060527273466747e-01   +2.325488501863929e-01   +2.121463018145767e-01   +4.449869293783995e-01   +2.519468866882191e-01; +4.607075002361123e-01   +2.080444478358264e-01   +2.429580945447335e-01   +1.567375409140052e-01   +1.367450478930730e-01   +3.359513866838961e-01   +2.341345850400476e-01   -9.656303862738502e-02   +1.875317148284829e-01   +1.248997725918190e-01   +5.668945927103579e-01   +2.707634888872567e-01; +1.850483127886371e-01   -4.533263991530984e-02   +2.630623700465868e-01   +4.240638227070583e-01   +1.216260593778631e-01   +1.639572840216739e-01   +3.465199853371429e-01   +3.658425128829188e-01   +2.777772228284933e-01   +1.411411225249705e-02   +3.647200993501085e-01   +3.170100331262343e-01; +3.531143419867729e-02   +1.807233312054338e-01   +3.462608279131442e-02   +3.200846933631805e-01   -1.173813528920871e-01   +2.370280572832784e-01   -1.594283980180782e-01   -1.234463585472872e-02   +5.032136068108829e-02   +7.139087936710531e-01   -1.070227099803375e-01   -3.098340024431506e-02];
L2E_Input1_iAMPA_netcon = [+3.075891425014134e-01   +3.023308567726643e-01   +8.940309330984615e-02   +2.747918846444482e-02   +2.119810499261048e-01   +1.572768249835191e-01   +2.432779085194229e-01   +6.137866198805579e-02];
L2I_Input2_iAMPA_netcon = [+2.581642458028426e-01   +5.613090529757045e-01   +2.262413735298133e-01   +2.625785034475647e-01   +7.557468068688541e-01   +2.366930294958283e-01   +3.171970968459221e-01   -1.788904457384250e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 60*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 60*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
