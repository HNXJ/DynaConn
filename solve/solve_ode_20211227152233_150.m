function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.429475551627625e-01   +2.325825064295959e-01   +1.022249872800358e-01   +1.284355632437793e-01   +4.422637284931796e-01   +3.298059931677502e-02   +1.802443186009558e-01   +2.316885569964134e-01   +8.897020027201166e-02   +2.745320867561309e-01   +4.520763727950227e-01   +4.159753141562239e-01   +1.329397759649489e-01   +2.879598746319744e-01   +3.974878968233713e-01   -1.694519554677815e-02; +1.012434034383502e-01   +1.199718409399091e-01   +1.550537960869056e-01   +3.283270620335519e-01   +1.520921124510210e-01   +3.255090906418173e-01   +1.360080243256785e-01   +1.021609199762084e-01   +1.488367073092795e-01   +1.645873415549804e-01   +9.969789025446034e-02   -1.962248450700402e-02   +3.722667065172440e-01   +2.065198909341057e-01   +2.171484695076891e-01   +2.861293392844735e-01; +2.909999513530581e-01   +1.794324845231591e-01   +1.951248739149368e-01   +9.725531767372594e-02   +1.360529056663262e-01   +1.059056560571064e-01   +2.968674769468172e-01   +1.218341784933372e-01   +9.815678135072232e-02   +4.330558167635548e-01   +4.387036238273272e-02   +3.839563076143323e-01   +1.926848348517568e-02   +3.390534179462191e-01   +1.505066637764452e-01   +3.689337083502525e-01; +3.625734466615245e-01   +3.612121600312481e-01   +3.919759218081857e-01   +4.117364303219547e-01   +3.639357184307235e-01   +2.287699885161144e-01   +2.059923228360932e-01   +3.678037967365496e-01   +7.087739073833317e-02   +3.157216505413398e-01   +1.013733280726184e-01   -2.966162874931046e-02   +2.370509335031078e-01   +8.321810671307664e-02   +3.286050238361330e-01   -1.816996084702090e-02; +1.750210240482947e-01   +3.247807413543645e-01   +3.773403907591515e-01   +2.320926635908200e-01   +3.810397743867008e-02   +9.792648268990943e-02   +3.782334991830841e-01   +2.616225166894027e-01   +1.129294896538159e-01   +6.434550688825449e-02   +8.594204142701761e-02   +2.020275260380412e-01   +3.381478321934580e-01   +2.416777207220307e-01   +3.437812279405539e-01   +4.558087591379303e-01; +2.234608913576125e-01   +2.193850215609700e-01   +1.904889028440396e-01   +4.226899042934107e-01   +1.206349837585586e-01   +4.124685634663514e-02   +2.132227312960148e-01   +3.022445024186750e-01   +3.282285028288690e-01   +2.464397752239237e-01   +4.170525350215022e-01   +3.677481398858793e-01   +1.828796405155725e-01   +2.077184464547945e-01   +1.442984402020941e-01   +1.375823847569991e-01; +2.565973994023904e-02   +1.306459848158072e-01   +2.461136632345820e-01   +3.547378338096757e-01   +1.424355602079999e-01   +7.714305638550123e-02   +2.176677776668446e-01   +1.392979755997306e-02   +3.645713403807644e-01   +1.021767668199153e-01   +4.999732452256341e-02   +2.105482403002182e-01   +2.093060435373891e-01   +1.761028184099040e-01   +3.096606459413085e-01   +2.649564309804167e-01; +3.499286076734199e-01   +5.837885128994938e-02   +8.236895507859848e-02   +9.942010198001711e-02   +8.772547454223144e-02   +4.694012455127582e-01   +1.680401579172965e-01   +1.814258515662157e-01   -1.553685580409945e-03   +7.195438346089636e-02   +1.684743544625089e-01   +2.101871103303448e-01   +2.027534047088806e-01   +3.394790621182090e-01   +7.385612715850012e-02   +5.381754908746134e-02; +3.052064672542628e-01   +1.091821169946386e-01   +7.153728076497337e-02   +2.637302478783896e-01   +3.090270183219738e-01   +1.414101024201114e-01   +1.733236859253466e-01   +3.674221598493854e-02   +2.182866989814511e-01   +2.928576571415924e-02   +2.620889162671052e-01   +4.905949275806053e-02   +1.296982573792688e-01   +2.452643974978205e-01   +3.215135097466582e-01   +1.731196255026172e-01; +2.816681588082674e-01   +1.915609760680528e-01   +2.764558985688716e-01   +2.350558010031863e-01   +3.568290537551372e-01   +4.402466075884259e-01   +1.143539408070824e-01   -2.426250431096208e-02   +1.797001950716648e-01   +3.808713623800485e-01   +3.024734890180213e-01   +1.151993370410042e-01   +3.995186396010056e-01   +2.790992211918258e-01   +3.055287627364433e-01   +3.616309449997609e-02; +1.024393232420217e-01   -4.579344380510227e-04   +3.149839303532380e-01   +1.051663011229983e-01   +9.448207284813405e-02   +4.702486937567711e-01   +2.906256374212572e-01   +7.828128823360007e-02   +1.563983428398066e-01   +1.239279323629100e-01   +6.560940827016673e-03   +2.699541416675263e-01   +7.663162591587837e-02   +1.217447031230202e-01   +3.056334989291561e-01   +1.595079973553857e-01; +6.321716167308769e-02   +1.460754947500177e-01   +1.795285618390609e-04   +2.713166441914446e-01   +1.597820114927301e-01   +1.616032600166921e-02   +4.320350573869017e-01   +3.921768416513422e-01   +1.843603387991619e-01   +2.097063827678390e-01   +1.925919282289075e-01   +3.212256300031034e-01   +3.389490195313222e-01   +3.180395979844122e-01   +4.264900658628016e-01   +4.080388696882923e-01; +4.174062097450645e-01   +4.089403474901055e-01   +1.152556066812182e-01   +3.759254488701905e-02   +3.194547291548154e-01   +1.931425230393317e-01   +3.393425622519170e-01   +5.152003697099174e-02   +4.123665807770528e-01   +4.031900909106009e-01   +2.555900663489123e-01   +1.413197269149325e-02   +1.701267081643330e-01   +2.106373483938052e-01   +2.338851082520252e-01   +1.183753777273714e-01; +3.752809140060548e-01   +1.132125650342145e-01   +2.808774710297166e-01   +3.575908709733688e-01   +3.456708948816141e-01   +8.374768445682658e-02   +2.146493549376464e-01   +1.646584253054602e-01   +2.733529562281696e-01   +2.725798804008330e-01   +2.830625667095539e-01   +4.726955468034871e-01   +2.353118287268094e-01   +2.928447837346750e-01   +4.544838401317972e-01   +2.135178163845923e-01; +3.339584541639813e-01   +1.504394004261173e-01   +3.347281145977737e-01   +3.527898946194302e-01   +2.192382799055276e-01   +3.686488216904683e-02   +3.299740398394105e-01   +1.788897524928260e-01   +2.173268851427889e-01   +2.732979034942102e-01   +4.700795771833775e-02   +8.651175364475044e-02   +4.347091184994291e-01   +5.260609742673605e-02   +2.056825742793645e-01   +4.231882464282323e-01; +3.943245063332068e-01   +1.957209055438348e-01   +3.046034003382108e-01   +1.272536232472363e-01   +3.196446504798598e-01   +2.672135921770968e-01   +2.855719714385052e-01   +2.659919867882932e-01   +2.125342296564656e-01   +1.606272449687666e-01   +9.323068992210216e-02   +8.948159469382298e-02   +1.220132512422553e-01   +3.733681517480965e-02   +3.009459953964248e-01   +2.925545046488165e-01];
L1E_L1I_iGABA_netcon = [+8.098543734195801e-02   +4.206110428103213e-01   +4.595367513825304e-01   +3.344710407373384e-01   +3.110393766629945e-01   +3.068345597915884e-01   +4.412843448374126e-01   +7.587640582327150e-02   +3.768674031780221e-01   -5.150109656000845e-02   +3.533830170044248e-01   +1.595520262469202e-01   +8.707774716066022e-02   +4.503932912080730e-01   +1.809436974999532e-01   +3.322937347643247e-01; +3.206785549681002e-01   +2.494995115347263e-01   +2.980100650254875e-01   +1.374699300001345e-01   -1.371190452033628e-02   +3.102846693287427e-01   +2.675245610791959e-01   +2.812213374387784e-01   +2.795319275001681e-02   +4.057868610341493e-02   +4.267105085305777e-01   +1.193693656852802e-01   +2.313415535358136e-01   +2.550347277016425e-01   +8.196814118495512e-02   +2.366500805631237e-01; +1.091937090377485e-02   +2.305135003064734e-01   +2.116538014338367e-01   +1.479704880775268e-01   +1.140621356171129e-01   +7.189796700806841e-02   +1.905056870068091e-01   +2.420389511006665e-01   +1.101999211099406e-01   +1.254954235173250e-01   +3.314442751087031e-01   +2.856325992706544e-01   +2.550492169133584e-01   +4.484564508978977e-03   +2.153611424011765e-01   +2.243570155059477e-01; +1.789850931801574e-01   +2.728931575752245e-01   +3.487134208837561e-01   +2.361115899538259e-01   +2.095481198285312e-01   +4.387435292383584e-01   +3.689491876145368e-01   -2.313743663918676e-02   +3.134294786952728e-01   +4.049004304699811e-01   +2.722270096513611e-01   +3.499932898129481e-01   +1.227250534722228e-01   +3.139631080947086e-01   +6.812679993216537e-02   +6.644737969515566e-02; +2.081299140206954e-01   +4.205872909198138e-01   +4.130769885778353e-01   +4.083325117241587e-01   +1.261766948461687e-01   +1.239144610728986e-01   +2.855837907868639e-01   +2.488291577859072e-01   +3.418396828197033e-01   +2.906188741120705e-01   +3.439914013885673e-01   +2.899056756235123e-01   +1.093528275931976e-01   +1.399972322089389e-02   +1.569548329544951e-01   +3.826633499731628e-01; +3.259330039317657e-01   +2.844223131791049e-01   +2.951595753311856e-01   +3.361554398837436e-01   +2.670881105815829e-01   +9.182599352361805e-02   +6.148418410985577e-02   +1.365006571311338e-01   +3.380515415320590e-01   +2.083377181887436e-01   +2.862948331704785e-01   -1.655923757795058e-02   +1.720263453408049e-01   -3.946152667118679e-03   +6.581647453950547e-02   +2.212471484975658e-01; +1.120436372890706e-01   +3.244478651482900e-01   +3.749930817866599e-01   +1.223276066205347e-01   +2.468257056066504e-01   +4.663903872175854e-02   +3.532653102289152e-01   +3.676471485424510e-01   -4.321346397241421e-02   +3.237324040384560e-01   +2.499695637688150e-02   +2.721921323644370e-01   +2.848396532640766e-01   +3.241538239888313e-01   +1.338431177063606e-01   +6.703457750025199e-02; +3.369206659962606e-02   +1.942317481309112e-01   +1.181018257140575e-01   +7.980612135620083e-02   +2.558651123011362e-01   +5.140969875314501e-02   +7.545333612824981e-02   +1.239709022063219e-01   +3.402377388732959e-01   +2.222991464924424e-01   +1.331706788322256e-01   +1.823698681440319e-01   +1.632530999189727e-01   +7.995808084893674e-02   -1.412353647941484e-02   +3.989660262497867e-01; +2.283430193824839e-01   +3.399529509865332e-01   +3.628065638662005e-01   +2.462519909658122e-01   +1.365189087916636e-01   -2.336039759293608e-02   +7.557556999975150e-02   +6.542890297809421e-02   +2.778869774141864e-01   +5.973790681413653e-03   +1.229691973989473e-01   +3.343471081673061e-01   +2.590053951392988e-01   +1.962648402185441e-01   +3.733297056488429e-01   +3.930170701529783e-01; +1.519768380283683e-01   +3.754691831445834e-01   +1.032785463432427e-01   +6.530249349635055e-02   +1.735923762180405e-02   +2.384035050839535e-01   +1.267838912303076e-01   +5.378756839083629e-02   +3.556464254806201e-01   +1.100940072018203e-01   +2.175957077731649e-01   +1.333898436283866e-01   +3.359499656709531e-01   +3.655768221714024e-01   +3.317617256930570e-01   +1.974745041183885e-01; +2.554617875954224e-01   +2.133318988018835e-01   +2.278421354481441e-01   +1.333114675244907e-01   +3.343824108710115e-01   +3.846291879340796e-01   +3.072565688439476e-01   +3.998023347361410e-01   +2.563905589894212e-01   +1.700552481363423e-01   +5.724810155780534e-02   +3.460351126081556e-01   +1.349409742787640e-01   +1.039147810362146e-01   +1.772607479362466e-01   +2.120345638854942e-01; +3.458461607820323e-01   +9.189157964123661e-02   +8.778750256332429e-02   +2.479328280245643e-01   +3.600779530170946e-01   +1.912342354497262e-02   +2.674549747498680e-01   +2.250271546040062e-01   +3.753939459001904e-02   +1.903184417442483e-01   +2.293897227019997e-01   +1.334917105457875e-01   +9.370700064406273e-02   +2.861559314127300e-01   +3.541233131644134e-01   +3.231895067548237e-01; +1.722181546059447e-01   +1.851138830008893e-01   +2.221861311841448e-01   +3.470831625508748e-01   +1.863760859276951e-01   +1.603661220458958e-01   +3.301234548289267e-01   +2.710850559902518e-01   +2.955346185108590e-01   +4.104653582630218e-01   +7.618370091734351e-02   +1.485535126767307e-01   +1.314628031959532e-01   +2.461630463302868e-01   +1.861951143636051e-01   +2.994925577354535e-01; +1.236295714865778e-01   +1.762610821566056e-01   +2.216255977738155e-01   +1.694074325669136e-01   +3.314583287520655e-01   +4.987451854021632e-02   +2.225460802102683e-01   +1.376251411263422e-01   +1.941564979582391e-01   +2.131510476224369e-01   +2.342060934271176e-01   +1.673272453250000e-01   +3.413218835379086e-01   +4.287588485734055e-01   +1.455738533874684e-01   +3.149358219693534e-02; +1.279431161946184e-01   +1.267971871418843e-01   +1.213613696178583e-01   +2.763989528574160e-01   +2.020919334183175e-01   +1.683389819395309e-01   +1.782330491952446e-01   +1.811296052103456e-01   +2.793953199206449e-01   +2.559502218468657e-01   +1.850060419836769e-01   +1.872437359084915e-01   +4.194316539267844e-02   +2.194462989377841e-01   +3.202063514206518e-01   +3.187251748517051e-01; +1.556649208124346e-01   +2.036887362679566e-01   +1.930407925845559e-01   +8.189678518986730e-02   +1.985450367499305e-01   +4.420169352606672e-01   +7.270469304373563e-02   +3.301241055962000e-01   +1.216356472364794e-01   +3.358451955903977e-01   +1.826686752848141e-01   +2.955587777337477e-01   +2.174747786735700e-01   +4.253199206959499e-01   +7.229730238026152e-02   +3.120194580591362e-01];
L2I_L1I_iGABA_netcon = [+3.304951196440445e-01   +3.389100028024685e-01   +3.091930068979432e-01   +2.185532098548617e-01   +7.504340054988813e-02   +3.207868491640544e-01   +1.685486545056465e-01   +3.989687244552858e-01; +1.066152020460637e-02   +1.900508836201734e-01   +9.799306185175566e-02   +2.986868741472852e-01   +2.519508937899559e-01   +3.557138200191121e-01   +2.953644822853865e-01   +7.651709811830512e-02; +1.104413851714291e-01   +1.643907991869586e-01   +3.092595885980065e-01   +2.359029600947564e-01   +3.200708501830596e-01   -2.883529297403313e-02   +2.929848988541386e-01   +4.042150688711068e-01; +9.400310977473396e-02   +3.441326019936096e-01   +1.496355373796391e-01   +2.259302149935426e-01   +1.290082246280091e-01   +3.784750774180343e-01   +1.787684120992430e-01   +4.061917082831666e-01; +3.793917423695956e-01   +2.056768297905026e-01   +1.874018739881615e-01   +1.479283586377620e-01   +4.074435236830289e-01   +4.198221340911278e-01   +1.614842948600566e-01   +2.551919291784027e-01; +2.587314320519515e-01   +2.955296664695681e-01   +4.474977278125294e-01   +2.483399255738426e-01   +2.991688728082517e-01   +1.868388214253885e-01   +1.973783449823257e-01   +3.254573942600343e-01; +4.137237891989838e-01   +7.714338664840918e-03   -1.193554495064069e-02   +3.647013542685851e-01   +9.262706548311070e-02   +1.455038109784927e-01   +2.261710370516058e-01   +1.933183207891833e-01; +2.503703867478498e-01   +1.540526668933475e-01   +1.282995645516777e-01   +4.063269494514884e-01   +1.391732226473559e-01   +2.566431357227442e-01   +1.510902631480552e-01   +1.052452794107838e-01; +2.863628217729581e-01   +1.872509580942898e-01   +4.344803809737474e-02   +1.666424940036647e-01   +2.284449051911339e-01   +3.164658452930068e-01   +4.193063768731528e-01   +9.103371488358741e-02; +2.324953286982767e-01   +3.376437331569759e-01   +2.157673614388802e-01   +3.339296239298716e-01   +3.492169891857410e-01   +1.139548638311759e-01   +1.205591785025041e-01   +5.372163459052813e-02; +3.563469881859111e-01   +3.473540660889847e-02   +2.529095066074156e-01   +2.387728997345500e-01   +2.425706100945596e-01   +4.371266441303999e-02   +3.043461986243721e-01   -4.169903661750123e-02; +2.284949489102923e-01   +4.186047286931179e-01   +2.033480195105330e-01   +2.868675857116058e-01   +4.118307572339903e-01   +1.367911956874969e-01   +1.856385070443559e-01   +1.320979249317247e-01; +1.944145696812653e-01   +5.141512103795401e-02   +8.540603998662609e-02   +4.027914282771173e-01   +1.826900064858206e-01   +4.035105549240732e-01   +2.364059653706474e-01   +2.244920353657221e-01; +3.885760555224147e-02   +3.542132078448729e-01   +6.301869217202534e-02   +7.025825181832458e-02   +1.549322931643909e-01   +1.838535514261515e-01   +4.560396123801156e-01   +1.387723232669661e-01; +1.481790822342443e-02   -5.620628691761371e-02   +2.919844297495785e-01   +2.350505122178886e-01   +1.760901815283037e-01   +2.488334423209756e-01   +3.312708854825183e-01   +1.245857349112769e-01; +1.157891231144063e-01   +3.244142637259240e-01   +6.620157882594099e-02   +3.698865294951195e-01   +7.062348035402627e-02   +2.044537901654205e-01   +1.693140865313303e-01   +1.385553830424509e-01];
L1I_L2I_iGABA_netcon = [+4.766221968533903e-02   +1.589280953574877e-01   +6.869449532122006e-02   +3.864930285015224e-02   +3.744960750065759e-01   +2.172820321441729e-01   +5.958850065757246e-02   +2.298099872209770e-01   +2.074732035545269e-01   +5.772695329978667e-02   +1.250047870133484e-01   +3.254087275446383e-01   +8.817320223292029e-02   +4.390272605040007e-01   +7.122240003066188e-02   +1.502382457378217e-01; +3.145236395697334e-01   +5.557887134697997e-02   +1.532828202680177e-01   +3.589895293172694e-01   +1.201775953734132e-01   +2.983163441925386e-01   +3.117998950381509e-01   +2.409576715822047e-01   +3.732041697841856e-01   +4.195366899045863e-01   +5.057107866449176e-02   +9.218039096241989e-02   +2.123235328745023e-01   +1.874539121157026e-01   +7.563158046408996e-02   +1.827476198781438e-01; +2.433641009742243e-01   +2.745668952923657e-01   +2.369262440124260e-01   +3.644596708376795e-02   +2.524262367842089e-01   +6.998239206141402e-02   +1.517776468697205e-01   +9.264159272006701e-02   +2.231699581531211e-01   +3.934409246053099e-01   +3.503405867481252e-01   +1.883338624667430e-01   +2.574283691293277e-01   +1.593973039877458e-01   +1.065804559345921e-01   +1.620127784088485e-01; +2.506547706865319e-01   +1.960561387465968e-01   +3.437476585526792e-01   -3.832038636067950e-02   +2.137559822184763e-01   +2.864903022004854e-02   +1.994218690498161e-01   +2.307459099786904e-01   +2.385014111415512e-01   +3.582925105709291e-01   +3.982518659017545e-01   +2.099878153752470e-01   +3.380126285458857e-01   +6.096857077697219e-02   +7.270574683503214e-03   +3.702102041508838e-01; +2.406575652613843e-01   +3.217263880592880e-01   +2.761537476024926e-01   +1.523169157194972e-01   +2.500339337493106e-01   +3.928440360533084e-01   +1.476457438299075e-01   +1.749193534320279e-01   +1.960076289168027e-01   +3.089000030023586e-01   +2.629992302843113e-01   +3.195759824449064e-01   +3.020617918852407e-01   +6.629133095532778e-02   +2.794667848204089e-01   +4.407957598491565e-01; +1.523563127109440e-01   +2.025995461070249e-01   +2.005231293783074e-01   +3.134277344758771e-01   +4.735242823623442e-01   +3.111646388858789e-02   -4.135209594957414e-03   +2.791312167534216e-01   +3.380545727926835e-01   +3.622228055273960e-01   +2.777999312259358e-01   +1.780725167310314e-01   +2.226326576722244e-01   +2.264076425528459e-01   +3.437899786077903e-01   +3.928819019617482e-01; +3.648466994142553e-01   +1.729535835257197e-01   +4.070467496796600e-01   +3.852569217071366e-01   -5.291412880660838e-02   +3.382597148356996e-01   +2.421612333822058e-01   +1.551987343380369e-02   +7.743339420870093e-02   +3.807173910093152e-01   +4.144976548054179e-01   +4.024803449034221e-01   +1.853656779405564e-01   +1.141999169884974e-02   +2.723501104699584e-01   +1.502200736341404e-01; +1.415800304415149e-01   +4.883617837034050e-02   +2.600800904080657e-01   +2.233167304740816e-01   +6.740846827391034e-02   +3.982462221422506e-01   +2.516045608044855e-01   +1.019402607418116e-01   +3.972040777010703e-01   +1.974491106645060e-01   +3.495691780752172e-01   +3.253420855397030e-01   +2.929426221599376e-01   +2.169216956605319e-01   +2.463216873983198e-01   +5.498863763933180e-02];
L2E_L1E_iAMPA_netcon = [+1.967544617576656e-01   +2.863032093905343e-01   +4.105452567862829e-01   +1.027512879860024e-01   +2.800242361135738e-02   +2.174358005490002e-01   +1.114794538606008e-01   +2.125580721368489e-01; +1.601989781099048e-01   +8.182322633507517e-02   +2.737375528867929e-01   +2.157591540808539e-01   +1.721111024298480e-01   +7.886457133195021e-02   +3.262116383936996e-01   +8.132255658175890e-03; +2.424335306675096e-01   +5.339034410107348e-02   +1.884150922331715e-01   +3.728978090567502e-01   +3.214328100585934e-01   +4.173710287214321e-01   +3.792000770464268e-01   -3.807038691242350e-02; +3.234944347883874e-01   +1.271969155933649e-01   -9.191265059758437e-03   +5.989773935127480e-02   +1.324098451592517e-02   +3.873191966362342e-01   +2.197323255781917e-01   +3.672136002238146e-02; +2.048409536756987e-01   +3.320940483068698e-01   +3.509675693609251e-01   +2.496170368153997e-01   +1.674780226308911e-01   +2.674249539406620e-01   +3.473091883648227e-02   -2.691340255587229e-02; +3.945983634797940e-01   +4.713862687482591e-01   -1.439190817145472e-02   +3.719372895960838e-01   -1.991573886132086e-02   +3.471010507829334e-01   +2.102619564022936e-01   +3.142648800925535e-01; +1.751528312138376e-02   +3.751647472562927e-01   +2.042227181114850e-01   +1.938545536476525e-02   +2.804659163846123e-02   +4.191791352013076e-01   +2.474957240297320e-01   +4.158725792349199e-01; +2.066586965687056e-01   +4.121727758979702e-01   +2.326034190788255e-01   +3.059964848240189e-01   +3.142043271169188e-01   +2.508734565523416e-01   +3.434337961259598e-01   +2.085083008973081e-01; +1.457158754465853e-01   +8.543217931369182e-02   +1.765375186130428e-01   +1.586700290898291e-01   +4.245813754187973e-01   +3.549635360427167e-01   +1.046495919885094e-01   +2.438807520940175e-01; +1.464942972677005e-01   +3.911372394138798e-01   +3.575444157500633e-01   +4.281606682734760e-01   +4.576337409792501e-01   +1.600168205803036e-01   +2.617993381430665e-01   +1.087571185803518e-01; +2.442267123097845e-01   +2.694953819507857e-01   +3.825741406254836e-02   +2.140953118965077e-02   +1.812065067115841e-01   +3.795171540876504e-01   +3.033300791954717e-01   +2.859458535191453e-02; +4.144896432889058e-01   +1.961180944902182e-01   +1.101819538435512e-01   +2.675068025941018e-01   +3.724464040983540e-01   +4.973155421714511e-01   +2.394760601306895e-01   +3.848204986858359e-01; +2.111434573503556e-01   +3.892889905260605e-01   +4.062165659579434e-01   +1.388746504576426e-01   +4.024350438229513e-01   +1.051889317249512e-03   +2.578655095171573e-01   +3.673857792166274e-01; +2.726264789865072e-01   +1.406678195424167e-01   +2.483918944620571e-01   +1.236905761654046e-01   +2.442472643636330e-02   +3.292888237369563e-01   +3.945281914024640e-01   +1.274099875202111e-01; +2.939642514486271e-01   +3.499598840999171e-01   +7.034377823253626e-02   +1.059119367968361e-01   +2.195225779276874e-01   +3.583071698699781e-01   +2.413526324765021e-01   +1.192732584296640e-01; +2.927324319971785e-01   +2.662593299847630e-01   +2.404771618419037e-01   +9.988699305261411e-02   +2.119586320611331e-01   +1.242298954256554e-01   +3.646868030885545e-01   +3.295828717562027e-02];
L1E_L2E_iAMPA_netcon = [+1.147767832847563e-01   +2.005815898899121e-01   +4.314607963833860e-01   +2.540212639841348e-01   +2.553831339272267e-01   +3.440870843270506e-02   +2.456947980079471e-01   +3.446354090271724e-01   +2.116974864005729e-01   +1.891538980850354e-01   +3.546765524093768e-01   +1.591007855812561e-02   +1.825120027788228e-01   +2.195323388700487e-01   +3.232678741951569e-01   +4.057950254283983e-01; +3.656993970192046e-01   +3.478400768097447e-01   +3.247841071672435e-01   +1.527946941306549e-01   +2.048856987281301e-01   +2.654652313499082e-01   +3.638239715845457e-01   +4.649083114167952e-02   +8.346418718114954e-02   +3.734943153128416e-02   +5.539980801979406e-02   +1.283407297488044e-01   +1.907307260105619e-02   +6.457339714329256e-02   +7.282068322820187e-02   +1.575656516279112e-01; +1.355536012028476e-01   +3.600281926932007e-01   +4.368573324756399e-01   +3.787388212636102e-01   +1.348107574652704e-01   +3.825945496426992e-01   -1.589137217782130e-02   +3.228832118750594e-01   +2.696825027084643e-01   +1.456730315977646e-01   +3.658192035341619e-02   +3.630246319489414e-01   +4.281000639160380e-02   -8.301705052050908e-03   +1.764037026612217e-01   +2.518068282295708e-01; +1.922662809921457e-01   +1.891054811316567e-01   +2.548000076465580e-01   +4.381195734639612e-01   +1.858212305881581e-02   -1.699245691997409e-02   +6.443148504956865e-02   +3.080468439220458e-01   +3.860423533665818e-01   +3.510993179382372e-01   +2.336861494078276e-01   -6.469362829941594e-03   +2.192528269285855e-01   +9.322953777298558e-02   +1.061254766725710e-01   +2.222945541817874e-01; +3.254060224297809e-01   +1.625557734955541e-01   +3.238077696194657e-02   +8.193436536678451e-02   +4.346121062243491e-01   +3.958385382573283e-01   +3.775191758819212e-01   +1.941380047285759e-01   +1.281726797789356e-01   +1.293112973308777e-01   +3.300934888275760e-01   +1.763961426378951e-02   +2.846345820975236e-01   +3.292924609479703e-01   +1.386017992372526e-01   +7.076551726912605e-02; +5.052039492015319e-02   +2.545367705653961e-01   +4.922532325191774e-02   -4.509379304141520e-03   +3.044343002127639e-01   +2.189307338915792e-01   +2.620685811492844e-01   +3.518378601088945e-01   +3.906804577610384e-01   +3.129506587076568e-01   +5.740402280807770e-02   +3.088453892520401e-01   +3.170596799586531e-01   +2.436101940295327e-01   +5.029935942183512e-02   +1.588183937553375e-01; +1.351954230583046e-01   +1.790489634760034e-01   +1.040044680143416e-01   +1.500931595731779e-01   +1.499989285982659e-01   +5.631957724636616e-02   +2.820584890705725e-02   +6.768819473528876e-03   +1.614399597815864e-01   +2.153242434839462e-01   +1.062519547435064e-01   +6.721323585050035e-02   +4.277088270599012e-01   +2.946898734685513e-01   +3.650439932850462e-01   +1.909857576356387e-01; +5.101841748345449e-02   +1.419370868976234e-01   +4.051102540524235e-01   +3.240510952939561e-01   +4.210296187921478e-01   +2.148018949864761e-01   +3.924635530581996e-01   +1.036303660529952e-01   +1.752471725903705e-01   +3.977394569531404e-01   +4.185659313320045e-01   +6.221303566413888e-02   +2.219393798798708e-01   +1.653964018695925e-01   +3.619036100601666e-01   +2.013585408174544e-01];
L2I_L2E_iAMPA_netcon = [+2.004784487030010e-01   +7.326899133841938e-02   +1.190952888423859e-02   +2.060128069413814e-01   +3.730945403027913e-01   +2.699414548541232e-01   +4.210340188814423e-02   +2.323783043024679e-01; +5.919165012661352e-02   +1.043501673538680e-01   +3.964512970198921e-01   -1.758925188733299e-02   +2.644933437909690e-01   +1.568646065049301e-01   +9.793542317557183e-02   +2.420865240872912e-01; -1.527647030161299e-02   +3.895583128409658e-01   +1.130430039900412e-01   +2.133031982166100e-01   +4.053279395994715e-01   +3.895346675957868e-01   +2.848238464644057e-01   +1.286023712280638e-01; +3.353318628253452e-01   +3.820122724043645e-01   +3.966706200924974e-01   +3.259988103917889e-01   +3.384521068432853e-01   +2.639326636912208e-01   +2.913590412079250e-02   +2.503652039295791e-01; +3.580310355542923e-01   +3.970501981525584e-01   +1.238753578895789e-01   -2.011826965693481e-02   +1.648484867172100e-01   +4.171660655397293e-01   +1.141956708449624e-01   +4.334371072963621e-01; +2.604023270537491e-01   +1.762539458031958e-01   +3.552340758543611e-01   +2.403363826720781e-01   +6.395086175731809e-02   +1.232563875435775e-01   +3.231288675990546e-02   +2.882996723115022e-01; +1.184784956255860e-01   +1.957303552067005e-01   +3.072296025097849e-01   +8.246717570564993e-03   -3.897031954029571e-02   +1.135281237010674e-01   +1.739040458304758e-01   +4.378230792696253e-01; +4.085075867506353e-02   +1.702205555859306e-01   +2.044055479775389e-01   +4.762041545439850e-01   +3.685032915360743e-01   +3.241191502222829e-01   +4.065463845699079e-01   +1.730332119114497e-01];
L2E_L2I_iGABA_netcon = [+3.808771462436191e-01   +2.123385905474064e-01   +2.326704674081291e-01   +1.287576482020692e-01   +2.846571842427838e-02   +4.409893910493796e-01   +4.062185481820335e-01   +3.045580777454014e-01; +4.448453311348652e-01   +1.005250848546898e-01   +1.275280518166121e-01   +3.869123949170765e-01   +3.324779932096920e-01   +1.642625834386162e-02   -8.326773651810860e-03   +3.210147853484592e-01; +1.771010986791241e-01   +2.846343530301081e-01   +3.266255840173415e-01   +1.631074461408987e-01   +1.053503863656763e-01   +3.863452824936808e-01   -2.477491950804995e-02   +2.181965336927154e-01; +4.669691425503603e-01   +6.047552239623086e-02   +1.441125740762211e-01   +6.242209669968945e-02   +3.596954591325583e-01   +4.174250676429809e-01   +3.131572246086734e-01   +1.751994622198741e-01; +2.221494177473013e-01   +2.381790400619646e-01   +4.546778522574265e-01   +1.238873305859489e-01   +6.928067871991546e-02   +2.609821941616814e-02   +3.611256577897233e-01   +1.599863441748539e-01; +3.114453143925162e-01   +1.225795124078426e-01   +1.357076335092169e-01   +2.227858937766221e-01   +1.023795718809243e-01   +3.356118736130295e-01   +2.102837468844624e-01   +1.844033163684123e-02; +3.462368388159555e-01   +3.008644815831893e-01   +2.762050739366039e-01   +3.105323354074435e-02   +9.662259131778038e-02   +1.247555056357721e-02   +2.886789170673102e-01   +6.240021855533112e-02; +5.664533762864987e-02   +1.526382579017266e-01   +2.360172029590304e-01   +2.310573358675425e-01   +3.741888412450783e-01   +2.660131312177762e-01   +1.502563604754735e-01   +9.918367202984307e-02];
L3E_L2E_iAMPA_netcon = [+2.173305292152148e-01   +2.884869163813169e-01   +1.403026022517318e-01   -3.856992451247575e-02   +2.528767982267100e-01   +4.564714414882787e-02   +3.988095166935031e-01   +2.472147701790237e-01   +3.225411299403083e-01   +2.557856409678564e-01   +1.058800793476457e-01   +2.574372796456112e-01; +1.280243393010825e-01   +2.903747182810515e-01   +3.009020950278282e-01   +3.887074656656254e-02   +3.541831013798902e-01   +3.393718382849615e-01   +3.128120457394214e-01   +1.091296013209606e-01   +3.561879617406863e-01   +1.125616786085081e-01   +2.760425973277049e-01   +3.716433470517931e-01; +3.455927853751344e-01   +2.727433367466231e-01   +3.601828162456951e-01   +4.011594533749936e-01   +1.231592983509965e-03   +1.037906902152987e-01   +2.327115564492541e-01   -4.799833697524195e-04   +2.676062701887043e-01   +3.190213310196600e-01   +2.259971591956687e-01   -5.034872367745166e-03; +3.625076395537349e-01   +2.168894610820997e-01   +2.208062760387209e-02   +2.303728900902512e-02   +3.411144118568911e-01   +1.517199471720865e-01   +4.129489749175870e-02   +2.426913457578853e-01   +8.964463263972750e-02   +1.339599254265364e-01   +2.450444393647106e-01   +2.578818687675906e-02; +3.182664112744400e-01   +4.551179456068324e-01   +3.803044710122367e-01   +4.337334013964965e-01   +3.277332806328271e-01   +4.046117251283655e-01   +2.923515214967218e-01   +7.520045287365851e-02   +1.240220484831283e-02   +1.225372770773609e-01   +3.232494289184189e-01   +2.944087974296626e-01; +1.024517924014016e-01   +1.335228467437993e-01   +7.577601639928622e-02   +1.659490669671482e-01   +2.985132463187957e-01   +2.954106494984048e-01   +3.890453175821244e-01   +3.727217287409928e-01   +4.024183867630954e-01   +1.579847894403590e-01   +4.080026888165621e-01   +4.078367288995255e-02; +3.353431440074656e-01   +7.906931194072771e-02   +7.980073095994765e-02   +7.102737019034465e-02   +5.792726607953767e-02   +1.799296033858448e-01   +2.772794637703359e-01   +1.819555859485849e-01   +1.219984093191545e-01   +1.647370619499097e-01   +4.182753406908201e-01   +4.063254367761475e-01; +3.639454316074023e-01   +3.418498295046192e-01   +2.200610866013287e-01   +3.644820846557015e-01   +3.550359632664355e-01   +1.206975020116765e-01   +8.895411873135198e-03   +1.568150028748493e-01   +7.254690573704248e-02   +3.361859627750310e-02   +1.658038329804650e-01   +1.250314779296031e-01];
L3I_L2I_iGABA_netcon = [+2.235014001462035e-01   +4.246662843704264e-01   +9.959465143745681e-02   +2.604570275153745e-01   +1.897728726857289e-01   +3.429346799005966e-01   +3.222300537880244e-01   +3.154099640693218e-02   +3.696193795708067e-02   +6.329861834240905e-02   +3.512320514191084e-01   +8.373791435612098e-02; +2.371657843406515e-01   +2.922659477388662e-01   +2.374991272785704e-01   +3.007284008210002e-01   +3.404657371062181e-01   +1.591481811282968e-01   +3.943635765843046e-01   +9.761008316368334e-02   +1.161446224594961e-01   +1.717075860147896e-01   +2.391807522063108e-01   +1.249504987507049e-02; +2.015344908172287e-01   +2.613787901083680e-01   +2.593763525735562e-01   +2.180637934486094e-01   +2.790679711119797e-01   +2.130744574794714e-01   +1.843451972193244e-01   +3.026799608567260e-01   +3.034067915173993e-01   +5.767057222969958e-02   +3.206987391039019e-01   +2.989792692380958e-01; +3.258758359658291e-01   +3.752257369518281e-01   +3.761739664024089e-01   +8.992761069425700e-02   +2.228772963169643e-01   +4.314337523698921e-01   +4.101357983280766e-02   +4.583216980137587e-02   +3.117321361490285e-01   +3.819511191623291e-01   +7.969193640881286e-02   +3.245174736543441e-01; +1.735580840944438e-01   +3.497423485670543e-01   +3.878561443044500e-01   +3.696978238942982e-01   +3.749643897622180e-01   +1.582913835520809e-01   +1.910593980755738e-01   +2.955342918636829e-01   +1.691264970657719e-01   +3.453091731827607e-02   +1.352394097369009e-01   +1.629851847950100e-01; +2.257617146475158e-01   +8.304571901262921e-02   +2.951451739975680e-01   +1.707977060637210e-01   +2.934122855576078e-01   +2.713935453140616e-01   +1.970153649800119e-01   +2.491614336971138e-01   +1.041078037748428e-01   +1.277422574810445e-01   +2.399950390171161e-01   +2.222623757441775e-01; +1.994127236102501e-01   +6.632241497338176e-02   +3.534278039084821e-01   +2.977844878133073e-01   +1.334411021697078e-01   +3.737921911853935e-01   +1.409984911898952e-01   +5.125494248859297e-02   -3.549811699942018e-02   +3.228013735992187e-01   +4.108554299615809e-01   +1.080205011900698e-01; +1.931083585439106e-01   +5.382106123987163e-02   +3.754131932542057e-01   +6.339925816598108e-02   +3.052586620449154e-01   +3.371622407099548e-01   +3.010916641411420e-01   +2.546871187976140e-01   +1.603559075342862e-01   +3.061469655763850e-01   +6.007647106403644e-02   +3.765896314795019e-01];
L2E_L3E_iAMPA_netcon = [+2.557637119699185e-01   +1.320558097696604e-01   +3.287510310016484e-01   +2.958752651337578e-01   +1.967947055759929e-01   +1.534775026551841e-01   +2.165765726833982e-01   +1.079375724901551e-01; +2.613519931873715e-01   +2.052842333187323e-01   +2.531557537378158e-01   +1.877538507823308e-01   +3.915063438143975e-01   +1.374621875855412e-01   +2.274505494516438e-01   +3.740368584680759e-01; +1.055331867833631e-01   +9.853702943567771e-02   +2.653939723663453e-01   +3.139262243519519e-01   +2.937930818152039e-01   +3.402775765892673e-01   +2.446043431125621e-01   +2.371688539269795e-02; +6.827044244054607e-02   +9.047225886484120e-02   +2.090542473395379e-01   +3.864132474081291e-01   +1.305016185175861e-01   +3.474173429204096e-01   +2.491539964532645e-01   +1.126688611054914e-01; +7.838612126639997e-02   +3.057799610585339e-01   +4.381550214241582e-01   +3.496492554365305e-02   +3.102912863749395e-01   +2.967518616842892e-01   +2.919403914850617e-01   +4.399622806386243e-02; +8.417183869031318e-02   +4.035817197304607e-01   +3.015228311198399e-01   +3.324956796060055e-02   +4.136125103182692e-01   +1.457382000647276e-01   +1.283572753172488e-01   +3.482200764949019e-01; +1.731403663427145e-01   +1.070129624917493e-01   +2.136361963023057e-01   +7.134773244679375e-02   +1.175820788301184e-01   +2.847941798901338e-01   +3.100626434453715e-01   +2.449184597069786e-01; +2.742690408297364e-01   +4.820321495233548e-02   +3.082929823190429e-02   -2.251103755795246e-02   +3.562882761575464e-01   +2.255949317465337e-01   +1.205656258859357e-01   +3.735314449283235e-01; +4.386537031706469e-01   +3.041223163078253e-01   +1.426920422256650e-01   +3.694703878562574e-01   -1.289066484412450e-04   +1.181426801030353e-01   +2.776367041045694e-01   +1.316379297740144e-01; +3.140961829534187e-02   +9.827090270768375e-02   +3.748128497094908e-01   +7.044541327109993e-02   +9.786439900921044e-02   +1.226345631715405e-01   +4.228483351454264e-01   +3.874386750936801e-01; +3.337700721505131e-01   +2.912412251275277e-01   +1.853927992228000e-01   +2.696391648611313e-01   +1.589956429168086e-01   -2.928332756098449e-02   +1.141627884198219e-02   +3.044523720642916e-01; +3.591273737208962e-01   +2.259672055618182e-02   +4.058827431494527e-01   +3.359422431268110e-01   +3.047221248285070e-01   +2.198715562888564e-02   +1.615866310824285e-01   -6.793832415893306e-04];
L2I_L3I_iGABA_netcon = [+1.194808073823563e-01   +1.973283586182805e-01   +1.257521933450675e-01   +2.294851960015187e-01   +1.743524188392126e-01   +2.115112710099586e-01   +2.195471954816636e-01   +2.406000404441483e-01; +1.633002978222822e-01   +3.481261897243816e-01   +1.211090207190711e-01   +3.852807383123366e-01   -1.563812855515892e-02   +2.648025713707456e-01   +1.592078163524582e-01   +1.787032693781311e-01; +1.289899948058120e-01   +2.695884855339765e-01   +3.434681922178149e-01   +2.777250770218651e-01   +2.011728583588013e-01   +2.284147156189348e-01   +2.961558345480746e-01   +4.099580783127921e-01; +3.101099615830171e-01   +4.133488384915553e-02   +3.758690997206199e-01   +1.131870764584411e-01   +2.681131025462530e-01   +2.714011947228443e-01   +3.583377107408366e-01   +9.056546743803202e-02; +2.167028148836322e-01   +4.682949921975235e-01   +3.166985604486672e-01   +2.720222174635074e-01   +2.361314664102783e-01   +3.928352457301134e-01   +3.980371135419244e-01   +3.480378935645288e-02; +3.543584169223206e-01   +2.261443323020251e-01   +1.019062841622577e-01   +4.384842740828892e-01   +1.483054554394620e-01   +1.396781551354331e-01   +1.559941582412634e-01   +3.510703366878674e-01; +5.998438477291275e-02   +3.594032358837994e-01   +1.480156662983530e-01   +3.786913958546619e-01   +1.400730859329632e-01   -2.716940586404392e-02   +2.170107101430774e-01   +3.218347099286032e-01; +6.026822193968773e-02   +1.041841482848994e-01   +2.252048796341048e-01   +9.456190644688765e-02   +2.727003189755096e-01   +2.668621021170839e-01   +2.532759844517283e-02   +8.246440658312275e-02; +2.276479079841894e-01   -1.970978812853195e-02   +3.606871529010974e-01   +4.179803573616238e-01   +2.562055812471166e-01   +5.029786751775270e-02   +1.348079566245702e-01   +3.758250237508096e-01; +1.658434467496918e-01   +9.773114198584104e-02   +7.474857927543008e-02   +2.471589675203062e-01   +3.752725769772184e-01   +2.063643315465820e-01   +3.498136326475742e-01   +2.181929590323743e-01; +1.308159759604898e-02   +2.218645946969809e-01   +6.853775780542026e-02   +2.340430437093071e-01   -4.197241509238126e-03   +2.571685978877413e-01   +3.242312877209003e-02   +1.306936544941829e-01; +3.483278508767600e-02   +1.817944786008121e-01   -5.200546695799867e-03   +1.029406617788308e-01   +2.437493730990521e-01   +3.849417698303119e-01   +1.949369006804409e-01   +1.766661326958525e-01];
L3I_L3E_iAMPA_netcon = [+2.066044645028431e-01   +2.176034498734356e-01   +2.534032620927426e-01   +3.671399804277841e-01   +8.107888153196305e-02   +3.142957859355787e-01   +1.179741585189822e-01   +9.006335646648847e-02   -1.955236532536278e-02   +2.681991318336946e-02   +2.848073638231103e-01   +2.571964935768880e-01; +3.524049244895046e-01   +1.701449677073990e-01   +1.793497414383820e-01   +4.473072610298593e-01   +3.084777162861664e-01   +2.246357371486895e-01   +3.665072995099242e-01   +4.544711499789925e-01   +2.091056154594464e-01   +1.158207466436414e-01   +2.605515038565102e-01   +3.986648221318539e-01; +1.220855549841356e-01   +3.547246599494673e-01   +1.353600023698106e-01   +1.485561727480501e-01   +3.422911853675252e-01   +3.245654313446823e-01   +3.157821997345187e-01   +3.211150586439562e-01   +7.375465644654300e-02   +3.448292280697197e-01   +1.589228302067484e-01   +3.857762937808336e-01; +3.986720424902760e-01   +2.475385723742130e-01   +2.631156596114069e-01   +3.463200453614919e-01   +1.424253896984942e-01   +1.261665241885468e-01   +1.851127690253929e-01   +3.588281476329990e-01   +2.915801215088568e-01   +3.972682364940731e-01   +1.283136603652377e-01   +3.289936416964339e-01; +2.476729026182103e-02   +3.486748211849121e-01   +1.783941821958640e-01   +3.578402910056695e-02   +5.684033971764497e-02   +4.365485301381562e-02   +1.035412163551520e-01   +1.296217657240449e-01   +2.105195941574478e-01   +9.513509730972305e-02   +3.946966869824831e-01   +3.163880826311441e-01; +1.547667953402744e-01   +3.290606430047219e-01   +1.783148546042940e-01   +3.864485755540016e-01   +6.025554879785713e-02   +9.744446148276999e-02   +9.995341984676712e-02   +3.650055169578834e-02   +1.068106503176233e-01   +4.626951627550711e-01   +3.336125853661661e-01   +1.010303294975574e-01; +3.001118282088708e-01   +3.053913428334511e-01   +3.475310508310828e-01   +3.303275953859227e-01   +2.553127104926386e-01   +1.993054401531648e-01   +1.516347730667152e-01   +3.783003059064750e-01   +2.987265568744969e-01   +3.723907194117294e-02   -9.344442364532853e-04   -6.370063022304997e-03; +4.389630877618546e-01   +3.894218090225764e-01   +2.294330277170754e-01   +2.933173006880678e-01   +4.657698216077515e-02   +1.395634388334178e-01   +2.395876793950334e-01   +3.699682695664028e-01   +3.095761248991526e-01   +3.783501204338142e-01   +1.611555982069815e-02   +1.015241724345895e-02; +5.627264906520831e-02   +1.585777116780684e-01   +1.505346526421826e-01   +1.560408399136268e-01   +1.835755708510734e-01   +1.400005697242254e-01   +3.696856329060363e-01   +1.092149104972265e-01   +2.843210983402394e-01   +3.045423891788639e-01   +2.432670850522911e-01   +4.028050412604568e-01; +3.023047929257789e-01   +1.126244471748828e-01   +2.367388709702221e-01   +1.737586297179492e-01   +6.842143236549511e-02   +2.573366405911320e-01   +1.951409566964102e-01   +4.756461716846060e-01   +3.428480452245903e-01   +1.810420702472900e-01   +1.483158905499065e-01   +5.850291487974614e-02; +2.721290638797009e-01   +3.192068201830805e-01   -1.501934362214840e-02   +4.678981658235112e-02   +8.669252482955618e-02   +3.236273062296306e-01   +1.316716940344142e-01   +2.997222902252967e-01   +8.003844506529943e-02   +8.928920554918683e-02   +2.374872402553374e-01   +2.857313028755347e-01; +1.826680084196705e-01   +8.465189520480035e-02   +2.233577372370744e-01   +4.707544712195090e-01   +2.116835450834531e-02   +1.785937004197575e-02   +2.866912346988324e-01   +2.908047927181015e-01   +7.241151759857783e-02   +7.833397162504750e-02   +1.694193790543471e-01   +3.624729762865243e-01];
L3E_L3I_iGABA_netcon = [+8.457530391938688e-03   +3.217427852472954e-01   +1.891882080409545e-01   +3.657382853109329e-01   +3.481652553205983e-01   +2.870986622939025e-01   +3.330337293215210e-02   +1.441109060268142e-01   +2.478410751852771e-01   +4.150933602431146e-01   +4.153408864384143e-01   +1.565635727356870e-01; +5.769573694660883e-02   +9.456360011453981e-02   +3.709927273062372e-01   +1.873292373381792e-01   +1.619997271992449e-01   +2.653531745894712e-01   +3.183563524210364e-01   +2.237467933713353e-01   -6.344170554883668e-03   +3.892139590685652e-01   +2.708987176622542e-01   +3.347204044148918e-01; +2.688574603080498e-01   +3.001419868828580e-01   +3.814862663393156e-01   +3.158553030007352e-01   +1.040725905176822e-01   +3.673684675070044e-01   +1.438565047253063e-01   +1.301592710984461e-01   +2.585209041128543e-01   +2.812142421153608e-01   +1.799322774661320e-02   +4.747786662777431e-03; +2.970578298378757e-01   +3.296992504104068e-01   +6.974407303250088e-02   +3.829206285818321e-02   +1.274938034909193e-01   +4.101291280425894e-01   +1.617255274621080e-01   +2.479448313555705e-01   +1.391018786679792e-02   -2.580142846073689e-03   +3.553547675011314e-01   +3.937204769697240e-02; +3.120216884531994e-01   +3.539124592683614e-01   +4.759972168566933e-01   +1.763573789144108e-01   +3.284039153245855e-01   +3.297283931235299e-03   +3.030518424171407e-01   +1.043002438918607e-01   +5.587096624037687e-03   +3.460769334513534e-01   +1.981821224336690e-01   +2.042388112446013e-01; +1.310967004355250e-01   -2.845308148938280e-02   +2.020512698355555e-02   -1.459139097472485e-02   +2.066029286972244e-02   +3.999298499422924e-01   +1.196566609564808e-01   +2.947472111103414e-01   +3.997182269293690e-01   +3.801007677933335e-01   +3.367921275902889e-01   +2.119293203435816e-02; +4.129906591965112e-01   +3.706129240343723e-01   +2.038802662349950e-01   +7.579217566394077e-02   +2.982817864411643e-01   +3.649082123915933e-01   +3.864641321115555e-01   +3.341137768440051e-01   +3.087983229142073e-01   +3.593476082555950e-01   +2.979001036047587e-01   +9.381188780956073e-02; +2.019732131431825e-01   +2.080823355779396e-01   +2.575421677422833e-01   +3.712858796075024e-01   +2.775819238060596e-01   +8.983367580385467e-02   +1.447575470168683e-01   +2.206947043624523e-01   +2.093079163080259e-01   +1.663958201269828e-01   +2.076213242968918e-01   +3.035875029429658e-01; +4.077244994033815e-01   +1.452876241479709e-01   +3.784930353266364e-01   +2.405948890408034e-01   +3.763303082031638e-01   +1.730252965392537e-01   +2.528780907146663e-01   +2.051771295275782e-01   +2.051548360344617e-01   +4.186842168629224e-01   +3.504194914372106e-01   +3.624990485209720e-01; +2.544638867699091e-01   +2.156423646295621e-01   +2.900104982537728e-01   +4.965159199562996e-02   +3.879107029677834e-02   +2.674374563260042e-01   +1.414633047633968e-01   +1.012726334390279e-01   +1.995848050034296e-01   +1.955547158920581e-01   +1.761216650558162e-01   +9.502763306534036e-02; +2.054271234727490e-01   +3.225239449476580e-01   +2.072000299139322e-01   +3.495243048903418e-01   +1.059073421600657e-01   +7.747399511090819e-03   +7.726040375481730e-02   +8.214194159470918e-02   +2.201263015667485e-02   -2.267620240001136e-02   +4.128098832703430e-01   +2.505480695826159e-01; +1.089383153927146e-01   +1.877184004206526e-01   +1.220838255068779e-01   +1.666268864031208e-01   +2.854552974286189e-01   +1.078505450099399e-01   +2.432149490781566e-01   +2.055974053002525e-01   +1.229110441235638e-01   +9.074424442905439e-02   +2.809051633313352e-02   +9.842643843474842e-02];
L2E_Input1_iAMPA_netcon = [+1.449495854062141e-01   +1.034117513728181e-01   +2.626509919674002e-01   +1.551005577264917e-01   +2.557471366898071e-01   +2.574026769528104e-01   +3.366530206451891e-02   +2.542155229139602e-01];
L2I_Input2_iAMPA_netcon = [+1.956863094182505e-01   +1.265495051667064e-01   +3.940024070992725e-01   +3.951703265498261e-01   +2.332669785296628e-01   +2.393521625905421e-01   +2.494329294047097e-01   +3.531628513792762e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
