function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.171099481185310e-01   +8.430985014563561e-01   +9.665005575812461e-01   +2.339721445885246e-01   +2.519387657363537e-01   +8.311585554417250e-01   +1.200096045637754e-02   +4.645275226008886e-01   +3.604301343042983e-01   +2.284854306932501e-01   +3.627761257898807e-01   +1.781953292256502e-01   +5.343135466343621e-01   +2.964107296741655e-01   +2.508483881574073e-01   +7.295880560471973e-02; +1.330011519624964e-01   +9.832447460546474e-01   +8.562881135927729e-01   +7.452610628671590e-01   +3.547750589389884e-01   +7.814636109449453e-01   +7.182272883716838e-01   +1.693452741451106e-01   +7.705318427843606e-02   +7.411354622181267e-01   +6.381500427837382e-01   +7.070729174345097e-01   +5.336681704496811e-01   +2.890671022450149e-01   +7.083078401315570e-01   +2.919819069205738e-01; +3.291277394426491e-01   +3.559075703760058e-01   +3.647698851477176e-01   +6.437089073176443e-01   +5.449863368413221e-01   +4.359604174120288e-01   +6.055300575615329e-02   +7.501638527697490e-01   +3.682351650906813e-01   +5.477407210325924e-01   +9.323708162766873e-01   +2.356105351997312e-01   +5.328861916413875e-01   +2.581811274733809e-02   +4.525807382568951e-01   +9.314443574458755e-01; +2.421098639216481e-01   +6.726113958325524e-01   +9.960168285514752e-02   +2.554824885748719e-01   +9.979830183250087e-01   +9.002236522528815e-01   +2.513365520157030e-01   +6.582377906659159e-01   +8.007199207056582e-01   +4.214057486509086e-02   +2.225134541306845e-01   +9.437049747229987e-01   +6.361889478675317e-01   +1.492304311804785e-01   +7.372545816586655e-01   +4.774481883805839e-01; +5.264217261634802e-02   +7.588264238889011e-01   +9.226619139197370e-01   +8.860875641972145e-01   +5.865639787401894e-01   +3.482525493463295e-01   +5.303813495039547e-01   +2.251641948397878e-01   +3.204477338090446e-01   +5.733879249851929e-01   +2.849079091459368e-01   +6.391432800072170e-01   +4.074077490502908e-01   +9.227552185951786e-01   +2.461509441382583e-01   +9.556365497522665e-01; +1.283706671883573e-01   +2.031350924965216e-01   +8.100246252103085e-01   +8.099129909324337e-01   +6.814874924754089e-01   +9.603332597510098e-01   +3.810549253752313e-01   +4.487441928941904e-01   +8.998241355998479e-01   +9.018805257014937e-01   +8.621704292001460e-01   +2.280997606268169e-01   +4.012723453614761e-01   +1.086526477078410e-01   +9.833576487528913e-01   +3.591526478241192e-01; +2.567299308460731e-01   +8.175490151156583e-01   +4.284314557552405e-02   +4.170215055949042e-01   +9.331231445566316e-01   +5.635897720204579e-01   +4.883998271418269e-01   +6.191357185424898e-01   +9.285749671917641e-01   +9.686421958538342e-01   +7.312088197068024e-01   +2.448621494884385e-02   +4.222427293086360e-01   +4.307413318196586e-01   +7.752834307816486e-01   +9.687382331490932e-01; +7.026205687208981e-01   +8.012854645426547e-01   +8.402879800408501e-01   +4.069605329883238e-01   +6.231780446245393e-01   +4.874978465809449e-01   +7.342019204413931e-02   +3.742302055261702e-01   +9.927636679520031e-01   +9.121317279579474e-01   +7.079889261841801e-02   +7.970648395389562e-01   +9.260495942511268e-01   +6.423163243270325e-01   +3.136425626870641e-01   +9.465934065636412e-01; +5.891159545330628e-01   +2.161400141325519e-02   +3.210882780147175e-01   +6.704169831090710e-02   +4.881328638561371e-01   +1.090604739957282e-01   +1.614377524382495e-02   +6.482336847247668e-01   +5.886774766234971e-01   +8.379808739072955e-01   +7.948994681763011e-01   +5.626762664671525e-01   +4.142225070645043e-01   +2.286666502835649e-01   +9.736888296756264e-01   +8.084182422868097e-01; +7.504510422932492e-01   +5.462078928226871e-01   +5.896337670586790e-01   +2.422094397933811e-01   +4.397220402803356e-01   +3.449849175215779e-01   +1.046682569765804e-01   +3.064643816235772e-01   +7.065778197225543e-02   +9.333531287334087e-01   +5.259799445501804e-02   +1.336735671877638e-01   +3.295281700621022e-01   +7.664007232927921e-01   +3.157451398694814e-01   +8.797799099900991e-01; +4.580502602377466e-01   +7.231313802657185e-03   +2.297453204707402e-02   +1.162488591096627e-01   +9.859174337167670e-01   +6.048767994843022e-01   +2.575629407538213e-01   +2.093072639716450e-01   +2.568271946350373e-01   +9.122266872377223e-01   +6.992787811471235e-02   +8.428368238528663e-01   +5.718222915625979e-01   +9.227040302354634e-01   +3.709731177489748e-02   +1.668001253485616e-01; +1.213620678562396e-01   +4.333616098802485e-02   +9.697179230164006e-01   +5.106716059815520e-01   +6.652009527535576e-01   +5.717909211383135e-01   +7.253045983341302e-01   +4.348819995687362e-01   +6.117112821645421e-01   +1.367667579209749e-01   +3.830627014136681e-01   +9.069904393231060e-01   +1.042318826085816e-01   +4.970991516419221e-01   +4.418929112716887e-01   +9.658315215520742e-02; +5.113716595885687e-01   +2.890209729072384e-01   +6.804111578811712e-01   +3.400898523538873e-01   +2.894559050222152e-02   +5.598796841704491e-01   +4.739134798383027e-01   +8.092331581734266e-01   +2.189748703068925e-01   +9.767646568193612e-01   +1.306655113636548e-01   +4.248064754155819e-01   +2.432645946749515e-01   +2.172295078996735e-01   +3.391393769357265e-01   +2.028076544315990e-01; +7.951056119656917e-02   +9.269463796775401e-01   +8.130277626030494e-01   +7.995477432107870e-01   +8.364423490478756e-01   +5.727717149323330e-01   +3.676791645776052e-01   +8.727783128192428e-01   +3.688283758015037e-01   +3.697513312828104e-01   +9.724459366328078e-01   +6.530200045948624e-01   +6.198845356120346e-01   +5.183293013147252e-01   +1.285822464487757e-01   +3.987736316503693e-01; +1.708363293708341e-01   +2.665635624004826e-01   +1.155391995797816e-01   +4.120788581884333e-01   +4.287126366238644e-01   +7.883575038474119e-02   +6.997013193623102e-01   +2.658287739495597e-01   +8.710539322186442e-01   +5.836930292228971e-01   +1.498840901917145e-01   +9.565396810190911e-01   +6.835991082444891e-01   +2.703809556106217e-01   +7.131626095941651e-01   +1.392261457614703e-01; +5.995020845245261e-01   +2.879953694366927e-01   +3.000325550213280e-01   +6.795216447587995e-01   +5.631190610865519e-01   +6.681073882156894e-01   +2.218796376714013e-01   +9.003553525862754e-02   +6.032640423321504e-01   +4.551715802515361e-01   +3.129561262811845e-02   +4.825355951610978e-01   +2.002223838209173e-01   +9.602976507283755e-01   +9.489363499770378e-01   +3.383747839610051e-02];
L1E_L1I_iGABA_netcon = [+2.572702032304301e-02   +2.342580965076556e-01   +9.247297362504071e-01   +2.791003676507379e-01   +4.435268012083870e-01   +1.618857973187854e-01   +3.106332289647358e-01   +3.680391772850283e-02   +2.568443451172351e-01   +8.115288853044529e-02   +4.745118191463841e-01   +9.774274329495181e-01   +2.008269406597555e-01   +8.958792756197115e-01   +1.338290091731477e-01   +5.047482416115731e-01; +7.724915234358338e-01   +8.333776308592785e-01   +4.977835172670817e-01   +8.671432761558049e-01   +7.368661524106002e-01   +9.144282197643252e-01   +6.646838216104887e-01   +9.078736563566348e-01   +9.843685702382228e-01   +9.592893167875157e-01   +1.074279274663960e-01   +1.483687627190322e-01   +5.878324971667354e-01   +9.858482300727087e-01   +9.591486219094069e-01   +3.055603314178751e-01; +3.668377034902943e-01   +8.245394186518537e-01   +8.884514312868452e-02   +7.596911180706120e-02   +7.036769327448612e-02   +2.179075231572925e-01   +5.980205214313739e-01   +8.825003211949376e-03   +1.068487222585084e-01   +1.254133262962902e-01   +5.435726664638559e-01   +4.651094053487039e-01   +8.717684007138591e-01   +8.325695381872326e-01   +8.390064129492071e-01   +8.139683053502479e-01; +3.433043799107901e-01   +5.565253901441265e-01   +6.902423915225553e-01   +7.694292032745159e-01   +6.553584440863556e-01   +7.047601208666713e-01   +6.142192449517913e-01   +8.897765160082418e-01   +4.653214345531179e-02   +3.729130428626159e-01   +5.324543389119358e-01   +2.159683426744741e-01   +7.880015313996556e-01   +4.247598909078442e-01   +9.486708871470656e-01   +6.004097729818658e-01; +7.596716429937134e-01   +6.273928370118252e-01   +8.590048724148699e-01   +3.752059375316804e-01   +9.875382785675680e-01   +5.342911322685887e-01   +3.789974416195989e-01   +4.484251050574476e-01   +2.899968726786882e-01   +1.188575211432647e-01   +6.563388283939428e-02   +5.150424279665377e-01   +9.142349758628824e-01   +8.165875384120674e-01   +2.836390068861367e-02   +1.801453349324566e-01; +2.803567120309442e-01   -6.103644850237955e-03   +2.823924145788035e-01   +1.257335704494833e-01   +7.224316605977334e-03   +4.141186830090223e-01   +8.850896791489811e-01   +3.349625641582384e-01   +5.861928253339074e-01   +3.793966005103741e-01   +9.763171215214144e-01   +2.336232284588493e-01   +2.758182821061316e-01   +1.928689555913800e-01   +7.294451121726363e-01   +4.623825003000732e-01; +6.613235103084739e-01   +5.604132285612209e-01   +3.935120433579227e-01   +7.893229629432470e-01   +3.215554145304458e-01   +8.683541156032905e-01   +6.573241732483276e-01   +5.595846772360054e-01   +9.048253868856350e-01   +6.647993244803075e-01   +9.463990717386658e-01   +2.815868380237059e-01   +8.277517037822103e-01   +6.143922172600587e-01   +9.894128748054976e-01   +8.758798063494116e-01; +9.906809673806608e-01   +1.439730121999344e-01   +5.891046216589135e-01   +5.357312095559306e-01   +6.368185547567425e-01   +2.297391178567176e-01   +3.102930545986848e-01   +6.318050566047306e-01   +2.173722429181746e-01   +7.948659355485729e-01   +8.100530321842550e-01   +9.935302871971061e-01   +2.831174557234502e-01   +8.148302067440679e-01   +5.201760437643115e-01   +6.308544027227219e-01; +5.432864289304189e-01   +9.870317655997064e-01   +3.723860054670229e-01   +9.629272621597688e-01   +2.444056128170496e-01   +6.955478470305035e-01   +6.232599498310488e-01   +1.000000000000000e+00   +8.583664019916015e-01   +1.307972135098791e-01   +2.181772452589507e-01   +2.256333462326916e-01   +8.719492615477084e-01   +2.301923610609573e-02   +1.827902402564463e-02   +4.814709095851394e-01; +2.834419929908876e-01   +4.181386045186471e-01   +5.788484677957458e-01   +2.832551331204382e-01   +8.262410435874107e-01   +4.379510055533758e-01   +3.283354610312409e-01   +8.702642355249396e-01   +9.440644408386221e-01   +9.685078064077914e-01   +8.124424359359600e-01   +9.268027239557590e-01   +5.144905188166482e-01   +4.022975027604248e-01   +3.442285843324706e-01   +8.823842377972081e-01; +1.116402327167713e-01   +2.387696552872831e-01   +7.850921782404051e-01   +9.217457352679849e-01   +1.413225962498469e-01   +6.220899219064765e-01   +7.218629993169119e-02   +4.740671443301260e-01   +3.978108898095748e-01   +7.351643937911824e-01   +2.601377012129968e-01   +8.983732672573228e-01   +9.547200854975783e-02   +5.240177170280627e-01   +5.056875665968077e-01   +5.210123028741479e-01; +1.754964781329579e-01   +9.789909064350147e-01   +7.683560048994499e-01   +5.591909053454466e-01   +5.159510394779944e-01   +5.349832118136744e-02   +1.623294224332683e-01   +4.018440770405020e-01   +1.666950050922164e-01   +5.837233567203469e-01   +3.074055207531793e-01   +4.413583444613859e-01   +4.454879513590692e-01   +9.291092759953904e-01   +4.940380373121232e-02   +4.756210203533610e-01; +9.244544089202564e-01   +1.168871098535307e-01   +4.954787753562444e-01   +5.828292684914335e-01   +6.774157408990551e-01   +6.254314225669020e-01   +1.857627612505943e-01   +5.857206171137359e-01   +4.972662361913144e-01   +3.476071170327802e-01   +9.858375408895463e-01   +9.884755672876870e-01   +8.649989325370590e-01   +6.053339558694654e-01   +3.554270648410029e-01   +7.459722044606079e-01; +4.535954037358216e-01   +8.720440772947978e-01   +2.963411938292854e-01   +4.031405143571559e-01   +7.731172396878471e-01   +1.499816520303831e-01   +3.798381408703574e-01   +6.589348071374856e-01   +3.249214109717234e-01   +4.794466813189769e-01   +1.829871076375724e-01   +1.564171484684939e-01   +3.133291797628682e-01   +3.029060921885278e-01   +6.396098005539439e-01   +9.512055468928297e-01; +6.171141691670921e-01   +6.318367379295828e-01   +6.728066466846175e-01   +6.960461375756961e-01   +8.699704088344903e-01   +2.092698811392063e-02   +8.665081666729085e-01   +3.815231144269425e-01   +8.394240109033542e-01   +5.173372463034351e-01   +7.083039737118656e-01   +6.135625009890857e-01   +2.223564861783492e-01   +5.226646727210574e-01   +9.157265359612985e-01   +5.160024892083578e-01; +4.943588876185714e-01   +6.560886906346913e-01   +6.027173619244123e-01   +2.715013528298973e-01   +4.380207760792133e-01   +2.959889155816796e-01   +6.254189250705535e-01   +2.155157979018859e-01   +9.114815761933429e-01   +2.864386523302169e-01   +2.351416526664261e-01   +1.604200958426270e-01   +7.986283209003733e-02   +4.962292582988188e-01   +9.243041366533583e-01   +9.548126214122921e-01];
L2I_L1I_iGABA_netcon = [+7.044580024807443e-01   +5.347077817200344e-01   +7.475203072991089e-01   +5.937686069365520e-01   +9.674288417838630e-01   +7.641035698583201e-01   +9.125978259841624e-01   +5.416402326941145e-02; +5.845046343156475e-01   +9.194435674763862e-02   +2.173975065078622e-01   +8.904671150917629e-01   +2.209986877593803e-01   +5.766761670419399e-02   +9.448698413912969e-01   +8.204614584917472e-01; +9.717040118925397e-01   +4.958848592661162e-01   +7.121130178619798e-01   +7.009943904074385e-01   +8.588051197532587e-01   +7.730753888918634e-01   +2.549199977022729e-01   +1.725255699746108e-01; +4.506340672790239e-01   +1.756702181338946e-01   +9.677273707114737e-01   +4.690188209013764e-01   +8.624950911269852e-01   +3.594790885883637e-01   +8.929145969133458e-01   +2.397414527683618e-01; +8.158608640342597e-01   +5.529269782298801e-01   +7.121546211359296e-01   +2.816396660181723e-01   +9.999705880266818e-01   +4.381037367890901e-01   +5.990161487431547e-01   +2.318353444107066e-01; +5.870505949554060e-01   +5.965063021653910e-01   +8.167659449653187e-01   +2.181109070734694e-01   +1.928443037381493e-01   +8.275634548817687e-01   +9.849055235750519e-01   +5.852746682164790e-01; +9.425229134662287e-01   +4.910963681463432e-01   +2.541166352918158e-01   +2.793757664926294e-01   +7.801300553358217e-01   +1.697486463164962e-01   +7.161783856796443e-01   +3.433651489503305e-01; +9.716701513317665e-01   +3.814346734718326e-01   +7.122654401055569e-01   +9.754758923057710e-01   +1.060139652784951e-01   +4.542737161136695e-01   +4.565741890647909e-01   +2.808241417811463e-01; +8.412400730832825e-01   +2.072848580352454e-01   +5.172756260936696e-01   +2.332077578441258e-02   +8.768608851434405e-01   +3.643216313552968e-01   +8.404577345743921e-01   +7.942597912849141e-01; +4.574787426182407e-01   +9.835459339620141e-01   +6.991121072649027e-01   +8.783386785017046e-01   +4.234746756075046e-01   +8.610636658475306e-01   +9.586080714324446e-01   +3.393452633892566e-01; +5.314213227480559e-01   +6.374560125013202e-01   +5.261326287139581e-01   +4.380914838992474e-01   +2.273972896211046e-02   +9.663811073220638e-01   +7.320410828214472e-01   +4.676201102220803e-01; +1.002855844468868e-02   +4.176886576892998e-01   +3.528460176184429e-01   +4.265502679367103e-01   +3.614565611296129e-01   +6.070607778095579e-01   +2.980983390623193e-01   +5.820960505496737e-01; +4.562836768190611e-01   +1.548799371410473e-01   +6.877972570412844e-01   +7.588717202403580e-01   +2.328288924428532e-01   +6.779383276284531e-01   +4.356163486209550e-01   +8.166922438444607e-01; +4.358590678098482e-01   +5.033138160517275e-01   +7.894663118680704e-01   +4.001797850775511e-01   +9.627706048427391e-01   +4.566053791217536e-01   +4.015158126782911e-01   +3.261587258352831e-01; +6.732615822937862e-01   +1.732881976520781e-01   +3.362278809092304e-01   +2.768132775241181e-01   +6.342885914934608e-01   +6.512945216195033e-01   +3.279780371041180e-01   +7.997724685955727e-01; +8.454845497886967e-01   +4.655227998460587e-02   +7.506407592325620e-01   +2.785592432830308e-01   +4.165583692537619e-01   +6.673162931424439e-01   +1.469585728254739e-01   +3.086692132821451e-01];
L1I_L2I_iGABA_netcon = [+5.314279476634731e-01   +1.823462974137627e-01   +7.879305721976851e-01   +2.942042863608705e-01   +6.808072927634783e-01   +3.452222183750776e-01   +8.331562443499345e-01   +2.407717617391736e-01   +6.429212984065038e-01   +9.684781436931265e-01   +4.110331303285282e-01   +4.814667057399283e-01   +3.848092611967485e-02   +8.338758780604830e-01   +6.560402025987344e-01   +4.846765733651496e-01; +2.988251828890355e-02   +8.029875027240978e-02   +3.118565318651378e-01   +3.227740122680559e-01   +8.975519171198507e-01   +3.470416821641424e-01   +3.230735699199327e-01   +1.510897024815514e-01   +4.782643204162225e-01   +2.420286867024790e-01   +2.953282036468707e-01   +2.845625709043223e-01   +9.273804321747876e-01   +1.599923551274309e-01   +9.025037215659441e-01   +2.421541060065733e-01; +3.463722417449245e-01   +6.343880443119225e-01   +4.279931126558335e-01   +7.130734749425163e-01   +2.787173435856254e-01   +5.333541758499061e-01   +7.969583771602931e-01   +1.077072595214515e-01   +8.159797999215356e-01   +5.306433696808717e-01   +6.763233276229209e-01   +9.111271055069778e-01   +9.812440771260936e-01   +7.130313868598657e-01   +3.286915396886156e-01   +1.293544897877208e-01; +8.682929586651904e-01   +1.640143726749565e-01   +6.251213273229701e-01   +9.600144951629093e-01   +5.018422426165843e-01   +9.806995645047457e-01   +6.737965338072015e-01   +9.211940353219103e-02   +3.541887486565184e-02   +3.741179678230767e-01   +4.225047309584972e-01   +5.818485660761682e-01   +3.360893568489438e-01   +5.190230700077894e-01   +2.076290405611686e-01   +1.441315530969060e-01; +9.648590891535693e-01   +8.323414092757384e-01   +7.822170244841402e-01   +6.860715750381379e-01   +2.892072446811064e-01   +6.919758362289896e-01   +7.598021998533956e-01   +6.804665901380635e-01   +1.075162607467662e-01   +7.208747850611902e-01   +1.899057697510242e-01   +3.711711458380152e-01   +5.819013319421790e-02   +2.156030008954024e-01   +7.529001717514694e-01   +1.000000000000000e+00; +5.686553262688124e-01   +4.566335281708741e-01   +1.428244190326185e-01   +4.096810994234418e-01   +9.756809265735737e-01   +1.303883612899196e-01   +7.493170601416159e-01   +6.796536982796042e-01   +5.553977117036614e-01   +7.933412883217491e-01   +3.303961142202479e-01   +4.992369338320362e-01   +8.670168167865443e-01   +8.785360124718458e-02   +1.740026048758689e-01   +5.497422195598990e-02; +7.940755984193691e-01   +9.190084963001983e-02   +3.839884418073826e-01   +3.189105771645024e-01   +5.538783544105961e-01   +9.199157815703279e-01   +2.166539104629355e-02   +2.278859429023458e-01   +7.626225095926272e-01   +9.657240691337300e-01   +9.183155442068440e-01   +8.903041284183634e-01   +1.157303981709137e-01   +3.277795211164365e-01   -3.217172557449476e-03   +5.994132066335501e-01; +8.625459587403701e-01   +4.351258950362162e-01   +1.444256365856926e-03   +9.098050845561627e-01   +1.921153022574309e-01   +9.370733820753815e-01   +8.282693591790994e-01   +3.512193663493773e-02   +7.833501873137322e-01   +7.465674181970286e-02   +9.173558608984435e-01   +1.940659952695978e-02   +8.493765195572254e-01   +9.776753056828325e-02   +9.878164103571874e-01   +6.945949358863180e-01];
L2E_L1E_iAMPA_netcon = [+2.941933280626538e-01   +9.082008189792551e-01   +6.356360971144697e-01   +7.462833669954295e-02   +3.135847367904628e-01   +4.316830541626259e-01   +1.458514740275990e-01   +6.392905745365685e-01; +3.030240515093216e-01   +2.061929815471575e-01   +7.749211044823329e-01   +9.257407655631434e-01   +3.677005014370978e-01   +5.751091107373801e-01   +2.755395143470258e-01   +1.366812107562894e-01; +5.548808541956118e-01   +9.349052609155009e-01   +7.950506920413261e-01   -7.559661335984518e-03   +6.622656064678489e-01   +4.482956101154666e-02   +4.619205956609374e-01   +8.576473002031342e-01; +5.212592213544346e-01   +6.261383827569521e-01   +6.667445510878191e-02   +5.604797075184476e-01   +2.825126264143302e-01   +5.076527894408396e-01   +2.153669264086424e-01   +4.368045087623734e-01; +8.222196993036571e-01   +8.035472359788443e-01   +8.030284620037608e-01   +5.254576110465417e-01   +7.750932783784169e-01   +3.759242499614819e-01   +5.306482298995239e-01   +5.713459635641229e-01; +5.081601196880950e-01   +6.639076001494533e-01   +2.279253217000563e-03   +6.684759333218855e-01   +6.689639246665035e-01   +9.013309504802969e-01   +2.340435453294243e-01   +2.572586055504001e-02; +4.577366486788730e-01   +3.371193946469235e-01   +2.542086810208046e-01   +4.085201141097478e-01   +4.238105501240260e-01   +2.422239615738668e-01   +5.164763286937514e-01   +2.854548309132851e-01; +7.817613117103186e-01   +1.537494241766141e-01   +3.340450033112911e-02   +9.571801934751125e-01   +5.159564606797149e-01   +3.530981968583044e-01   +5.706687148094728e-01   +5.979190562746868e-01; +7.425056333566484e-01   +5.987417212949309e-01   +6.729329077673695e-01   +1.374865029524774e-01   +3.990675337595346e-01   +2.478670704616238e-01   +1.339378790304691e-01   +9.911147213610153e-01; +3.750562733536607e-02   +1.268373046731852e-01   +1.402515492923498e-01   +1.764655842639593e-01   +2.540237274729040e-01   +6.426922612373202e-01   +8.920264690100433e-01   +8.603868566999663e-01; +1.981986201771928e-02   +2.554642573759905e-01   +6.502801164257936e-01   +5.444112879898831e-01   +1.465035573231964e-01   +4.516572778485245e-01   +1.684086889399604e-01   +7.674469170644115e-01; +3.903148896465838e-01   +5.271398698879691e-01   +5.978051784681937e-01   +5.277484111022244e-01   +6.851637224250584e-01   +3.467880632834883e-01   +6.463868634839978e-01   +4.960503692328457e-01; +6.546709351517160e-01   +7.193916060603734e-01   +6.287746795690174e-01   +2.684944725272809e-01   +2.378709433738164e-01   +1.038072481766598e-01   +9.083004284366911e-02   +6.183668304531916e-01; +7.967177355742392e-01   +8.367895667669387e-01   +5.826533154983859e-02   +9.472667166083397e-01   +4.694236122059940e-01   +9.253906499384295e-01   +5.689096240181968e-02   +2.288046437805779e-01; +9.371017564833155e-01   +1.941630192809408e-01   +3.978784551544063e-01   +5.951423834316626e-01   +3.681208544880373e-01   +2.174901855451468e-01   +6.596750048484976e-01   +3.873940037710553e-01; +8.522628007629498e-01   +6.428449085436653e-01   +6.927921900809043e-01   +3.816573812255296e-01   +5.154833155902311e-01   +9.007342106150773e-01   +7.913932247484521e-01   +1.262015402802490e-01];
L1E_L2E_iAMPA_netcon = [+8.968252980575185e-01   +4.893150223298002e-01   +5.865360512268071e-01   +5.541152854889479e-02   +9.794912191469558e-01   +2.540847773184528e-01   +5.325800519585587e-01   +5.184048972029307e-01   +9.650168571289501e-01   +5.379708573759932e-01   +6.316879660605180e-01   +4.952568415409479e-01   +5.072525826925594e-01   +3.511056451153789e-01   +5.455109524415760e-01   +1.854585873818943e-01; +7.753850731127520e-01   +2.185349779774278e-01   +9.427485750421069e-02   +5.478963778342869e-01   +8.315759215912750e-01   +6.672313340897182e-01   +9.323772785175944e-01   +2.823114806935095e-01   +3.378869057841619e-01   +3.494967372341574e-01   +8.139071535322454e-01   +6.873527446606518e-01   +6.573914377321453e-01   +9.002649629368459e-01   +3.880905915760982e-01   +5.606605328281116e-01; +7.833968979992106e-01   +1.076688921534421e-01   +1.027418621935561e-01   +9.531043853756873e-01   +2.548812352575034e-01   +3.683750477429629e-01   +9.919283140372382e-01   +3.123364367263823e-01   +1.625768369353642e-01   +6.280498054298919e-01   +8.468746048091206e-01   +4.611969297191243e-01   +8.975177111831315e-01   +9.845265038753648e-01   +8.612815305913776e-01   +6.662060402828285e-01; +7.146676812667250e-01   +1.263762145339248e-01   +5.760997113070507e-01   +4.185508220321200e-01   +4.086472501781011e-01   +8.378907042165923e-01   +2.097494196672972e-01   +1.701911641152322e-01   +6.239117881308733e-01   +4.342512256210583e-01   +3.992037902361130e-01   +9.617673831470556e-01   +7.584352494792017e-01   +9.023901378448627e-02   +7.381200470000069e-01   +7.701727304083819e-01; +6.144969593868493e-02   +2.746692306593241e-01   +1.620392059404631e-01   +7.839046505366511e-01   +2.009518164381200e-01   +4.613582941731177e-01   +1.000000000000000e+00   +3.144595636538320e-01   +1.640065997498762e-01   +7.614017051863254e-01   +8.536705333490045e-02   +5.744709423779075e-01   +1.070105470060707e-01   +6.294450632501789e-01   +4.075641779609955e-01   +1.054824709515857e-01; +6.362390385251542e-01   +4.776852537536436e-01   +4.102305640591807e-01   -4.605503281305276e-03   +9.716288178468655e-01   +8.049338676611795e-02   +4.945978061144727e-01   +2.116857524925132e-01   +8.194518983388497e-01   +1.000837355320128e-02   +7.580661242854313e-01   +7.155916578744881e-02   +7.091637206462619e-01   +5.238038567585986e-01   +6.757070778234725e-01   +3.165237705690431e-01; +3.139248274308433e-01   +6.431359174464157e-01   +4.147199670077179e-01   +4.127197792464189e-01   +4.085266527181259e-01   +9.312576793235533e-01   +9.195795371593143e-01   +3.943536176317170e-01   +6.830345683291803e-01   +7.640443047900584e-01   +6.458844182193843e-02   +1.398504571010384e-01   +9.100473653369735e-02   +3.650713774257917e-01   +3.691384314356536e-01   +7.521926371749370e-01; +2.121596911643850e-01   +4.665080686999604e-01   +2.933816870411710e-01   +4.186058230559154e-01   +9.296017988233720e-01   +4.929240561103155e-01   +9.718566647769050e-01   +8.910401005730174e-01   +3.996835929689831e-01   +7.564816492439376e-02   +3.698909899559567e-01   +3.305657506735547e-01   +3.600799703506896e-01   +7.459713147615622e-01   +7.147095406468661e-02   +5.372530710216310e-01];
L2I_L2E_iAMPA_netcon = [+3.697036742541954e-01   +2.130622035609632e-01   +4.185355916017275e-01   +5.888742100753712e-01   +1.860606532756306e-01   +9.000470522925105e-01   +6.499021775326856e-01   +2.712943788302521e-01; +5.267221441341925e-01   +2.258812974134605e-01   +6.204643211376751e-01   +2.386466082444745e-01   +6.710645778081915e-01   +8.127119340995668e-01   +5.744313285856141e-02   +5.078146527287989e-01; +6.041413611563436e-01   +3.125712391159156e-02   +6.748760036429615e-01   +5.917669663806795e-01   +1.559802465069871e-01   +6.248239942885393e-01   +8.257455400326048e-01   +3.367031293298828e-02; +4.729977867203697e-01   +2.653364937723171e-01   +8.340818627274617e-02   +9.877568088484827e-01   +3.503545027135143e-01   +6.031058515039676e-01   +9.392229215935834e-01   +1.782407604281637e-01; +1.293609246270032e-01   +4.401748651829435e-01   +3.712166581477773e-01   +8.113981995576890e-01   +8.297743556842233e-01   +5.861200242500544e-01   +6.962556051460544e-01   +3.090429299507246e-01; +8.875193728480831e-01   +5.317821091189046e-01   +8.837060560821487e-01   +8.658997147105615e-01   +7.496227593184335e-01   +8.454025377090245e-01   +9.043221968954482e-01   +5.418474389683753e-01; +1.591949488617166e-01   +5.701011796735779e-01   +9.260658750144957e-01   +9.280260462085368e-01   +9.957196028693895e-02   +7.547358333331632e-01   +2.567829929376935e-01   +7.231091129037479e-02; +5.723156026006959e-01   +3.902932620058626e-01   +1.583525651929300e-01   +2.929987522192344e-01   +7.231089431188551e-01   +4.028141408112932e-01   +9.792640217415951e-01   +6.327624391320597e-01];
L2E_L2I_iGABA_netcon = [+5.138844130523048e-01   +6.601825943707661e-01   +6.694037481420942e-01   +5.812496573017870e-02   +5.165489780497021e-01   +5.160177637406135e-01   +3.472043867093212e-01   +7.653825966560436e-01; +4.588085598784268e-01   +3.971946333597643e-01   +5.333595483876270e-02   +5.194750685453955e-01   +5.026598941900003e-01   +6.166815958912937e-01   +4.910695408009547e-01   +4.937961038600902e-01; +6.390739295543596e-01   +4.833156237373958e-01   +4.327724458397438e-01   +5.679123763461436e-01   +3.486422150599156e-01   +3.033453395197187e-01   +1.979371578109896e-01   +9.899011984552175e-01; +7.570768131884595e-01   +5.506230966742234e-01   +4.492078175871704e-01   +9.192991720620161e-01   +2.186868751205841e-01   +2.948108731941961e-02   +1.297854249358978e-01   +4.778783778209076e-01; +5.196019355922714e-01   +8.373811539238980e-01   +5.275182565025910e-01   +8.638939913676926e-01   +3.679773366124955e-01   +7.938671471143071e-01   +7.150160066167843e-01   +3.576249390408192e-01; +4.358226441208579e-01   +2.907538707275863e-01   +5.290628699420526e-01   +3.856267686058103e-01   +7.864599224088552e-01   +9.184433218903358e-01   +2.735920176187674e-02   +4.885910869701086e-01; +1.603242998049595e-02   +5.019991625895975e-01   +8.664591228334593e-01   +5.835104955796387e-01   +5.009990528535437e-01   +3.984413033951434e-01   +9.616133770446397e-01   -2.394215172402109e-03; +9.297319066151694e-01   +5.661595515822140e-01   +9.813648801988840e-01   +5.009193618639388e-01   +9.736617373718011e-01   +5.875230035458355e-01   +4.065152086564829e-01   +3.825546025017048e-01];
L3E_L2E_iAMPA_netcon = [+2.456045383747920e-01   +9.247103522944954e-01   +4.191375663116035e-01   +8.065447242904156e-01   +1.676823741182067e-01   +4.381658618759124e-01   +4.527741695952499e-01   +8.814414689653022e-02   +1.354359446140938e-01   +5.749601901626574e-01   +1.652800404598016e-01   +4.881397244204206e-01; +2.464595533184271e-01   +5.274416471374410e-01   +1.973097983040806e-01   +2.735980864072017e-01   +6.305523566351608e-01   +9.644602070145073e-01   +7.523494034212665e-01   +5.978446146075131e-01   +2.818606347323113e-01   +5.368333112218662e-02   +4.605433533126429e-03   +9.868882634571988e-02; +8.237958959829198e-01   +3.856847675192330e-01   +5.425617317791450e-01   +8.619709819605309e-02   +8.801350433905533e-01   +8.583407294499874e-01   +5.545140927931927e-01   +7.478614921091105e-01   +6.915237385478911e-01   +3.877403589715220e-01   +4.290421696278254e-01   +9.323545824267564e-01; +1.965235549086730e-01   +4.363808067634951e-01   +2.175597053891967e-01   +8.247235594395803e-01   +5.318781558355866e-01   +6.047333561238923e-01   +8.838041358310670e-01   +3.168270269540682e-01   +8.542866856265250e-01   +8.383131332924509e-01   +4.918839830083747e-01   +2.130212540043905e-01; +2.130993711113776e-01   +8.198216944489924e-01   +4.150688287680048e-01   +7.401786522085935e-02   +2.113036802162929e-01   +9.956065197327081e-01   +5.706232630212764e-03   +6.851652203267942e-01   +4.894706925918133e-02   +8.298789309293867e-01   +2.867902908438659e-01   +2.485155550101930e-01; +4.211623306951517e-01   +3.652976077142914e-01   +8.409058338202183e-01   +9.844645737629123e-01   +4.372208469297992e-01   +9.986693585657980e-01   +1.476616063050346e-01   +4.291626888440077e-01   +5.107060195268304e-01   +7.960618235533913e-01   +6.695719468864973e-01   +8.339107261135101e-01; +1.805584969393847e-01   +5.221250071608340e-01   +6.151334014688209e-01   +1.104941060357283e-01   +6.222261575109702e-01   +4.794478611175224e-01   +8.155959569570654e-01   +1.485144162744924e-01   +4.528782389487840e-01   +3.677338495509609e-01   +9.712663500678000e-01   +7.729967042089003e-01; +5.837978520765451e-01   +5.493416944716962e-02   +4.201391498616345e-01   +2.016989381972260e-01   +2.616091686465030e-02   +9.489166826242176e-01   +4.034097866814862e-01   +4.241887530367572e-01   +8.952129891624830e-01   +9.583057773450830e-01   +9.425472957987832e-01   +3.342028889972422e-01];
L3I_L2I_iGABA_netcon = [+2.394835795443726e-02   +4.022634058205551e-02   +1.686542217205739e-02   +6.935677058196962e-01   +7.744656120079144e-02   +4.589398015558835e-01   +8.399189132914476e-01   +4.426490471214620e-01   +4.478510606891676e-01   +9.882693697250533e-01   +9.468256259204524e-01   +6.566238293619258e-01; +3.705723535685920e-01   +4.580334279671263e-01   +3.020473430305115e-01   +6.594832859705205e-02   +4.518158268463912e-01   +6.207241804307975e-01   +4.366917114899510e-01   +9.018420156088695e-01   +1.293746460372555e-01   +9.645268703299573e-01   +3.054205413405081e-01   +6.273871987019480e-01; +2.987817234316853e-01   +7.498008033851846e-01   +3.194362946828156e-01   +8.126514082719828e-01   +3.614288617065575e-01   +8.264254163708942e-01   +9.362051432778524e-01   +3.943301228137514e-02   +6.374958346874312e-01   +4.711133278434713e-01   +1.596366647713358e-01   +5.815235800069208e-01; +6.298461945895539e-01   +9.641259278393505e-01   +3.757306474062376e-01   +2.760691714915760e-01   +1.723928788851215e-01   +6.028892986662931e-01   +2.319186493875992e-01   +3.359827214157307e-01   +9.894970467567629e-02   +3.697018742366581e-01   +5.535570263203020e-01   +8.359179412953484e-01; +9.562265686438490e-01   +1.212634459932204e-01   +4.711184801741689e-01   +8.256894379365394e-01   +5.297312405454332e-01   +8.905436048310958e-01   +1.235028753130280e-01   +5.443607546608245e-01   +5.611123364349954e-01   +8.347702494949123e-01   +7.835624834824931e-01   +5.420619744119145e-01; +9.717381122519269e-01   +1.974335422408530e-01   +1.283818043025867e-01   +7.405060820627114e-01   +9.718385108741726e-01   +7.228516845514827e-01   +8.900360998291335e-01   +4.957350622484152e-01   +1.314805397095367e-01   +8.921261327991703e-01   +4.223761289728876e-01   +6.584756659830652e-01; +1.002832443223357e-01   +5.337246347678505e-01   +9.544330727277052e-01   +5.947234197155803e-01   +9.863571894569240e-01   +8.741954995913317e-01   +8.701856589515961e-01   +8.552930337871896e-01   +6.176726565215904e-01   +3.622122562704120e-01   +3.035052914063425e-01   +5.936758551651854e-01; +3.416773512760576e-01   +1.964135474302817e-02   +7.871385908126286e-01   +2.117320016531544e-01   +4.755599736133390e-01   +2.822373197476910e-02   -1.593712764883187e-02   +9.913563849701580e-01   +5.122578346472693e-01   +1.055771664132185e-01   +7.386856407125577e-01   +1.342664437520038e-02];
L2E_L3E_iAMPA_netcon = [+9.210142654448142e-01   +3.007126898850349e-01   +5.667142458298121e-01   +6.521838997024960e-01   +1.203232399028822e-02   +6.722090636905290e-01   +7.456903446549602e-01   +5.650650829576406e-02; +3.390282063889905e-01   +5.735236013882812e-01   +6.467885712672565e-01   +7.605427929154630e-01   +2.046481586161947e-01   +2.309340151557078e-01   +8.322931156112151e-01   +1.099802133803076e-01; +6.108705015563968e-01   +5.156567708334659e-01   +9.136927095613605e-01   +7.071935854298229e-01   +9.170229112228214e-01   +4.849685298039132e-01   +9.793079191522500e-01   +5.319505599389009e-01; +1.737550500656724e-01   +9.511545381725702e-01   +9.260074031218639e-01   +4.269575268250717e-01   +3.668929450249919e-01   +9.569803113274203e-01   +2.191612709548106e-01   +5.352123467906714e-01; +6.725655671460061e-02   +2.213448503083386e-01   +7.104084082880404e-01   -5.833402425495975e-03   +1.821860561576071e-01   +4.876523552133398e-01   +5.434809758419465e-01   +6.722205806490327e-01; +4.244962326893268e-01   +7.519866242968610e-01   +2.097925041952218e-01   +8.316817395702196e-01   +4.365642802114328e-02   +1.197735993805688e-02   +4.763894338123654e-01   +3.212472446019864e-01; +5.028563736528169e-01   +8.087624141007381e-01   +7.791941047213714e-01   +2.793382653343447e-01   +8.471877112188058e-01   +2.082934868921812e-01   +7.260706037828401e-01   +1.000000000000000e+00; +2.019065656150714e-02   +5.956431070197751e-01   +9.500243708887671e-01   +4.592287653082036e-01   +8.426776337104580e-02   +7.304666108418777e-01   +1.309865727619124e-01   +3.870640710969297e-01; +9.802388821487555e-01   +9.328085180188568e-01   +6.730697739642261e-02   +1.426925289950464e-01   +1.637110261633768e-01   +9.344737614689946e-01   +2.536234079573332e-01   +9.336347613002156e-01; +1.546531048368156e-01   +3.512575248239043e-01   +7.901989568571519e-01   +3.348596389904503e-01   +3.926396854794041e-01   +9.771362197672804e-01   +2.525366909070426e-02   +9.896303869775818e-01; +6.651965574824781e-01   +4.085636431701101e-01   +2.390316204172538e-01   +1.848834182278060e-01   +1.454408323724731e-01   +3.266235695223101e-01   +2.339404759569869e-01   +1.030773449014627e-01; +1.086320322918681e-01   +6.415302656617392e-01   +7.890888195462176e-01   +4.593088568803090e-01   +5.453663512951502e-02   +7.750584187723475e-01   +7.946966414916843e-01   +8.017075249208814e-01];
L2I_L3I_iGABA_netcon = [+3.731301774807058e-01   +6.395223831345900e-01   +2.501469727858413e-01   +7.175856306821540e-01   +5.989084576621500e-01   +4.862465108015099e-01   +4.087171133493057e-01   +4.980015627015549e-01; +3.373222405002644e-01   +1.597610823113308e-01   -1.343531829768499e-03   +8.793117290672534e-01   +7.668362731356115e-01   +6.591614358003713e-02   +1.016929529049644e-01   +6.823985446449726e-01; +3.425387176561840e-01   +6.414353535063699e-01   +4.052633591177944e-01   +1.317711305357897e-01   +8.696786780983832e-01   +5.876124850156388e-01   +1.643894994059577e-01   +1.112830036920800e-01; +6.414051865352367e-01   +8.867441584278464e-01   +6.338757211096223e-01   +5.250466020764285e-01   +5.613535520313979e-01   +7.329271716873246e-01   +4.530560631339732e-01   +7.431705084117478e-01; +2.616704994864345e-02   +1.804396341105021e-02   +1.213826844953377e-01   +6.413609550480647e-01   +2.427950128089238e-01   +7.117100756258951e-01   +4.655771282987768e-01   +3.797117401996120e-01; +5.122049982084872e-01   +4.864403971655267e-01   +4.691570706857975e-01   +7.471159051751118e-01   +2.877680087728412e-01   +9.156507964154554e-01   +3.337358743440201e-01   +1.119550418028745e-01; +2.727127747620842e-01   +6.203035797466460e-02   +4.971082677820141e-01   +1.000000000000000e+00   +6.913569610815220e-01   +8.179491002279909e-02   +2.702022881928791e-01   +8.135076036495487e-01; +2.443906279686504e-01   +9.534599505291254e-01   +9.823291491625267e-01   +9.679249019741262e-01   +5.281285801604690e-01   +1.362781144952123e-01   +8.005117480095119e-01   +1.189305824437225e-01; +3.789995752098279e-01   +5.157326883231170e-01   +3.332106052029981e-01   +2.007609340319314e-01   +3.317219939314358e-01   +2.948282341551609e-01   +6.131692504819298e-01   +5.108042802843078e-01; +3.993054985292891e-01   +2.082791031584266e-01   +2.053793268664300e-01   +3.576147748453295e-01   +9.764328826084768e-01   +4.894746170927229e-01   +4.853527146400686e-01   +9.630959504227219e-01; +6.303391310628669e-01   +1.306530240142547e-01   +2.972358263293963e-01   +6.568887311067103e-01   +5.045848418690173e-01   +7.784252903639622e-01   +9.471405606974161e-01   +6.899512005043054e-01; +4.182077054962297e-01   +2.653336729705542e-01   +6.659399886215633e-01   +2.967468912561168e-01   +8.440398665557682e-02   -3.704585098874002e-03   +3.134231319514343e-01   +7.002497618542430e-01];
L3I_L3E_iAMPA_netcon = [+8.063616409396335e-02   +7.316766448243325e-01   +1.324991511474861e-01   +2.253477291791107e-01   +2.896272971025508e-01   +6.761122589596169e-01   +8.264792722956403e-02   +3.876810666775898e-01   +5.444700070197314e-01   +3.159970220277585e-01   +6.100421007536710e-01   +8.815407874722917e-01; +3.376581921709113e-01   +8.582813108998562e-01   +2.539374996608423e-01   +3.896878633956914e-01   +8.574699965576403e-01   +3.567529209119465e-01   +3.900091744582964e-01   +4.420725913528652e-01   +6.177386661985815e-01   +2.892149240336100e-01   +7.504449245101927e-01   +2.299207861081517e-01; +4.659465337391140e-01   +3.545059901973701e-01   +7.581956316432935e-01   +9.406917348071668e-01   +6.488218884579260e-01   +6.178175475268936e-01   +9.919891698167167e-01   +4.045070804159396e-01   +2.475165007999022e-01   +3.044526551659567e-01   +9.327615763209964e-01   +8.281175767294978e-01; +5.833088753803868e-01   +8.575497625209121e-02   +5.914299689255856e-01   +8.027613720233902e-01   +4.698822688272531e-01   +5.928106625210244e-01   +5.828744425597622e-01   +6.910065297200253e-01   +5.675522230267347e-01   +2.113398166008828e-01   +4.382877773065528e-01   +4.601848617101227e-01; +9.853879710623349e-01   +8.736661180644767e-01   +6.005298828269368e-01   +4.883984180650870e-01   +2.559889831224363e-01   +3.683179075146812e-01   +2.150822722386305e-02   +2.486849896845063e-01   +1.478941062304298e-02   +2.704160763745886e-01   +9.378692072185077e-02   +5.313955268993128e-01; +4.228025279168104e-01   +2.156922281844070e-01   +6.511554600951414e-01   +4.674616251076372e-01   +9.372939366018327e-01   +6.508856284297766e-01   +3.193801451346221e-01   +8.892068001381238e-02   +2.013485609338821e-01   +5.535496723943508e-01   +3.486218010211227e-01   +5.861563656557334e-02; +4.864588603942139e-01   +2.010115792945236e-01   +8.832486170511885e-01   +8.919613374232526e-01   +1.793790850349005e-01   +3.267955740004866e-01   +3.637061396898887e-01   +1.328767974193650e-01   +9.397220300237450e-01   +6.667839406916440e-01   +2.498742974389319e-01   +5.664533370961945e-02; +3.565276337314080e-01   +4.747244644544648e-01   +2.122101706430724e-01   +5.931707622317465e-01   +8.819593523470424e-01   +2.879585089117465e-01   +3.972146413432214e-01   +2.801284159363521e-01   +3.496665849586996e-01   +2.513946258765586e-01   +6.858957686310150e-01   +5.813395838853894e-01; +3.165273813104996e-01   +5.554126121386787e-01   +3.442532221746734e-01   +5.830775239688589e-01   +5.568790096379246e-01   -4.985152547096969e-03   +7.763846336689847e-02   +8.146761925272619e-02   +3.019691804008259e-01   +2.164058008914511e-01   +9.151143938458507e-01   +9.055727081167747e-01; +7.420862856868909e-01   +6.160332719054296e-01   +5.976968443887145e-01   +3.987784882543738e-01   +4.861807281092947e-01   +4.007876258166952e-01   -1.394248238998654e-02   +6.459966968477142e-01   +2.408570862256525e-02   +9.227106415097833e-01   +4.967544021598428e-01   +1.782023012670773e-01; +8.336715225897673e-02   +2.719677861429557e-01   +6.479387343274025e-01   +2.347719224533732e-01   +7.542533551936884e-02   +5.080998426792802e-01   +1.009604444628640e-01   +7.679816276595354e-01   +7.882439438699291e-01   +1.635471401612250e-01   +6.467619033595349e-01   +2.553891657220673e-01; +6.330776279764067e-01   +6.307132677975450e-01   +4.458519315870934e-01   +6.246017970386890e-01   +6.455418854183266e-01   +4.475998201013738e-01   +3.680927331009311e-01   +8.331748755979522e-01   +6.448167035920790e-01   +4.207143087099977e-01   +5.396642473990383e-01   +4.086559294927563e-01];
L3E_L3I_iGABA_netcon = [+3.612208658660701e-01   +7.775049350668942e-01   +7.340171569092352e-01   +9.567587369978193e-01   +4.638238592113160e-01   +1.051566676004415e-01   +3.133955579161402e-01   +7.223173815523857e-01   +8.157665398872528e-01   +2.595314179995847e-01   +5.445880779941098e-01   +3.153431037749497e-01; +8.787590021480310e-01   +4.197462598068897e-01   +6.117249661851935e-01   +4.506904249115014e-02   +9.558701435962549e-01   +4.207567877720669e-01   +8.536539376383822e-01   +7.486276689584347e-01   +6.691687680507994e-01   +7.609716318238224e-01   +2.691421385503713e-01   +5.463566463301472e-01; +8.494078248937270e-01   +3.342993406978853e-01   +3.847059879379638e-01   +4.762004135049976e-01   +5.755482657181539e-01   +5.568027896416138e-01   +2.617464087702711e-01   +8.871842665729115e-01   +6.380571658640198e-01   +1.079631719268374e-01   +8.173834661181791e-01   +8.586614141109962e-01; +1.127662309236210e-01   +6.738888518119397e-01   +3.198446101240618e-01   +3.139404367328007e-01   +8.625614193825007e-02   +7.363371031325817e-01   +2.681107183453644e-01   +1.293482509968039e-01   +2.824528627737762e-01   +4.974869512904330e-01   +8.055604872771802e-01   +5.707597247370553e-01; +2.617841395214162e-01   +7.844933949721395e-01   +6.176088599560475e-01   +2.977749200858433e-01   +7.509117874895692e-02   +6.209020941356275e-01   +9.302200891923064e-01   +2.502500451676055e-01   +3.308771034925250e-01   +8.246570656379845e-01   +6.447562678904576e-01   +2.274150207205224e-01; +4.626644500038234e-01   +8.328981032693582e-01   +7.685109041175696e-01   +5.157393558453872e-01   +7.681886186506897e-01   +1.055534184467018e-01   +4.044875073613605e-01   +3.694317989746488e-01   +8.369744319397099e-01   +8.960249897146657e-01   +8.400810966135299e-01   +2.753538621312183e-01; +5.206967781126266e-01   +8.108354095508976e-01   +2.460364509191525e-01   +2.787977437708431e-02   +4.333015210677096e-01   +6.752011736834579e-01   +6.367887805650925e-01   +2.042327244449512e-01   +9.983730745816956e-01   +6.456088644773843e-01   +3.723377314789900e-02   +4.103201720842946e-01; +4.760498756544727e-01   +4.274851207995738e-01   +8.760862074227619e-01   +3.803116006407345e-01   +7.760622249554779e-02   +1.228332574465270e-01   +6.193951777484499e-01   +3.549169106731839e-02   +6.210925791615489e-01   +8.636632800181742e-01   +2.355836452389049e-01   +9.894799735158627e-01; +3.354355231710089e-01   +5.942243285484216e-01   +2.286151955902480e-01   +6.972926327099735e-01   +9.406666022440424e-01   +2.549066986501193e-02   +3.413075474295524e-01   +5.983167879299407e-01   +6.283897851046303e-01   +9.788007761573360e-01   +6.973357916886551e-01   +6.541749121785003e-01; +9.277134411399489e-02   +1.908493953039568e-03   +3.379982956408151e-01   +5.858595497446419e-01   +7.789995541050042e-01   +2.612015173806417e-01   +1.630622570973642e-03   +2.954642618328930e-01   +7.373647883239413e-01   +3.075270128598205e-01   +6.423148857278451e-01   +7.844918180623869e-02; +9.519819141399316e-01   +1.044135730224600e-01   +7.445697946701983e-01   +4.888926336973086e-01   +4.453283440744115e-01   +8.733172945032784e-01   +8.129133257897075e-02   +8.129087875770987e-01   +3.643077318791229e-01   +9.774955727396705e-01   +4.379722076621564e-01   +7.590222160204418e-01; +6.758848099078070e-01   +8.506172433616935e-01   +5.031257004099187e-01   +8.951581106464772e-01   +8.673213592743745e-01   +5.086326791835482e-01   +9.855631873286501e-01   +9.288560370946267e-01   +4.809065021343797e-01   +9.307472251716066e-01   +5.651645045642892e-01   +9.367795538620701e-01];
L2E_Input1_iAMPA_netcon = [+9.808455485268511e-01   +9.810016653341629e-01   +1.000000000000000e+00   +9.873138600366140e-01   +9.812194166720533e-01   +9.789936678148984e-01   +9.665593609240702e-01   +9.877329071070030e-01];
L2I_Input2_iAMPA_netcon = [+9.746642910905996e-01   +9.982021465399388e-01   +9.865732919748134e-01   +9.775951375907532e-01   +9.735102747632152e-01   +9.735012004491393e-01   +9.758360176659150e-01   +1.000000000000000e+00];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
