function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+6.232059239563484e-01   +2.180125069647936e-01   +4.543102383622690e-01   -4.890398204943723e-02   +3.391168974329735e-02   +5.738195193169743e-01   +3.241157657831971e-01   +3.138973768699974e-01   +1.616445494253484e-01   +4.630578639823551e-01   +2.056497494180357e-01   +3.409008921448443e-01   +1.938769321296304e-01   +1.504937554336791e-01   +2.694384879633889e-01   -9.585056004813021e-02; +4.080450706546109e-01   +1.823353630728359e-01   -3.476377294358718e-01   -1.639389273743694e-02   +4.849890176954734e-01   +4.447645989944903e-01   -2.413931781087315e-01   +2.535492025929372e-01   +4.070563523582907e-01   +2.315885843656809e-01   +3.553273093193878e-01   +5.324565321897491e-01   +1.316959407900394e-01   +4.414343733877357e-01   -3.611461616326920e-01   +2.835349988018411e-01; +1.284604170150660e-01   +4.884795691740873e-01   -2.276003793688401e-01   +2.298784681210006e-01   +5.285015559061557e-01   +1.815565736379379e-01   +1.054822141557269e-01   +4.300239519042651e-01   -9.339842329982688e-02   +6.206543667797333e-01   -1.774779642168186e-01   +5.586272421361417e-02   +2.398712173647264e-01   +4.014733967540676e-01   -8.914480229508562e-02   +4.509673525766548e-01; +5.913702983104852e-01   +2.874637007090794e-02   +4.868541635693624e-01   +6.564201839080900e-01   +3.611878581406697e-01   +5.230861877343898e-01   +7.881404831360052e-01   +8.146104636040182e-01   +9.240420652913501e-01   +3.630672880051455e-01   +3.803089505680800e-01   +2.238238610230395e-01   +9.704258777136446e-02   +5.115001326378753e-01   +2.204532427601947e-01   +5.534196002175944e-01; +5.458614167423161e-01   +5.604284326959605e-01   +3.668451621936191e-01   +7.448770002620109e-01   +7.492538274849771e-03   +4.829935529697097e-02   +9.984745530730002e-02   +1.000000000000000e+00   +4.097287605724432e-01   +2.360700250287156e-01   +9.582933021443043e-01   +1.889457511119139e-01   +7.208956774075758e-01   -8.254238917503511e-03   +7.651570098475559e-02   +6.991124763382051e-01; +1.670245196632770e-01   +5.252461007170874e-01   +6.405091976935241e-01   +5.836637527122363e-02   +6.511541697272674e-02   +4.915951274109027e-01   +2.730112917214107e-01   +4.552761627524279e-01   +2.776020076537725e-01   +3.476606436777481e-01   -2.093450096477658e-01   +5.084195285428955e-01   +6.608290724917251e-02   +5.334451158096963e-01   +3.166874950424300e-01   +8.389751024588071e-01; +3.528993562248042e-01   +5.592741364267884e-01   +3.081180336814499e-02   +1.060204369400120e-01   +2.765702606910170e-01   +5.674203786517310e-01   +4.819646840255916e-01   -1.433777114941404e-01   +2.893654786171746e-01   +3.499211184749272e-03   +3.427995594492630e-01   +4.997292208827716e-01   +3.849286355586043e-01   +5.069240895698758e-01   -1.260297891641163e-02   +2.150676241256738e-01; +3.050611855444185e-01   +5.584397714555439e-01   +5.155764048738795e-01   -2.694855449996956e-01   +5.099565517866683e-01   -2.111652435024688e-01   +3.264233291537467e-01   +1.467139070332683e-01   +3.994474238674461e-01   +5.166357014842826e-01   +2.247191889204119e-01   +4.204580376816396e-01   +2.567987144058568e-01   +1.940318095120609e-01   +5.154122667336209e-02   +3.652116212943479e-01; +2.989674002190155e-01   +5.661770931259902e-01   +2.912174307405296e-02   +2.014678407570998e-01   +7.127522366137653e-01   +2.843702900517179e-02   +4.337623834221230e-01   +4.357709764299285e-01   -7.199332507248649e-02   +3.652597375484293e-01   +3.986840982219808e-01   -6.362406431355075e-02   +2.951760200734818e-01   +2.163366481340254e-01   +3.549072091322703e-01   -7.554971125842318e-02; +3.323792271604991e-01   +5.744405508137190e-01   +5.193502147346747e-01   +3.139672801355390e-01   +1.808669722907012e-01   +5.699344692116438e-01   +6.279081669116486e-01   +7.249452578585858e-02   -1.863117521209551e-01   +4.722408700860438e-01   +1.967299378304047e-01   +3.869679029977814e-01   +7.672599555378540e-01   +6.794781026127439e-01   +2.580869619110439e-01   +2.482537094044739e-01; +2.058419935273902e-01   +1.580366954827847e-02   +2.831799721556550e-01   +5.019286571634113e-01   +3.963829125143534e-01   +2.625683888923175e-01   +2.686635034224280e-01   +4.512123765564788e-01   +3.379196727978715e-01   -1.937220181687118e-01   -3.614551585713687e-01   +5.032559723707744e-01   +4.884359289499886e-01   +2.994082130204732e-01   +2.500275612657309e-01   +1.176185721509170e-02; +3.713682548522206e-01   +5.652746153901146e-02   +2.204736400249594e-01   +1.988253223324814e-01   +2.626460015838561e-01   +1.273935201984061e-01   +3.056731686305257e-01   -2.944782809187640e-01   -1.542021198225982e-01   +5.660971982762557e-01   +9.292046018888113e-02   -3.141320523062876e-01   +4.873758285394363e-01   +4.303529677492624e-01   +1.096525673540798e-01   +8.708809428029642e-02; -1.296512124853284e-01   +2.285080123823320e-01   +7.874217622055023e-01   +6.195426505437358e-01   +4.870242150494110e-01   +7.883203790530962e-01   +2.341296781761180e-01   +4.512637091916766e-01   -5.306306180474790e-02   +1.250424222759237e-01   +3.621213884591933e-01   +4.798056343873150e-01   +5.230427585764790e-01   +3.652973812628020e-01   +4.117044281446893e-01   +2.931796895195019e-01; +5.260723496367509e-01   +3.644018544885496e-01   +4.059781726870829e-01   +5.925958291427393e-01   +5.578575950671524e-01   +4.725879003959061e-01   +1.407858578802400e-01   +1.211953086988124e-01   +3.969073914621303e-01   -3.662845455679167e-01   +4.413834216133806e-01   +2.006073164677109e-01   -7.596388282846703e-03   -1.234746135300626e-01   -1.670678923183272e-01   +1.227141941413794e-01; -7.455235672786062e-02   +3.994398059696713e-01   +1.065144818120713e-01   +4.281003757691812e-01   +2.325187337463348e-01   +6.467662647843496e-01   -1.012148170156522e-01   +1.305679436294304e-01   -2.152647996186189e-01   +1.465064364542752e-01   +4.916452484541520e-01   +4.162800673033307e-01   +4.052633734729038e-01   +6.682446484655377e-01   +5.654910051977763e-01   +3.493907577513157e-01; +2.365263214914781e-01   +2.457936717138830e-01   -2.110138133266735e-02   +1.943260740694793e-01   +4.852096946748601e-01   +1.275307184856522e-01   -2.343319637941279e-01   +3.815209609670706e-02   +2.462417980664693e-01   +4.857084409783502e-02   +2.056296859040024e-01   +2.603494199302988e-01   +4.565147353355350e-01   -9.555063554697638e-02   +4.417451539497914e-01   -3.122273519065808e-02];
L1E_L1I_iGABA_netcon = [+5.279802447761828e-01   +4.293515714206376e-01   +7.268817080234166e-01   -1.641670691317146e-01   +2.933677711795407e-01   -9.257299134729370e-02   +4.213942178979529e-01   +4.850253709334489e-02   +5.894672534832273e-01   +6.174385426567833e-01   +7.132369237992165e-01   +4.931441544560419e-01   +6.811805441658462e-01   +2.145441988234434e-01   +3.858071516660511e-01   +9.980901791665060e-02; -1.751750011134899e-01   +2.506913873445353e-01   +2.640476266701383e-01   +3.158648839664680e-01   +1.311469774849092e-01   +3.093641492076162e-01   +1.392839313319051e-01   -2.298833689514876e-01   +7.686414569721272e-01   +4.872846032339285e-01   +3.842262149855479e-01   +7.164073626931630e-02   +4.880744719832327e-01   +7.756247208561218e-02   +3.765346315393726e-01   +3.024512601617579e-01; +6.987247975575295e-01   +1.524582156693148e-01   +3.178301975415472e-01   +1.151797786814183e-03   +6.347428426072903e-01   +8.480541330746028e-01   +2.001301413712213e-01   +1.045657262788202e-01   +1.671143394791776e-01   +1.167236742932523e-01   +7.117215945339480e-01   +4.819108392610999e-01   +6.031012231309614e-01   +7.945289127734684e-02   +5.472328941847833e-01   +6.688800078104293e-01; +1.472302427034378e-01   +1.821520062557839e-01   -6.343530841596554e-02   +6.273771547641576e-01   +3.174958566786348e-01   +1.032805423258798e-01   +6.989852272751303e-01   +2.854525757939252e-01   +5.406469426234823e-01   +5.776701864022898e-01   -1.595721722195168e-01   +1.205714267362396e-01   +6.529502550293853e-01   -5.578661950142991e-02   +3.949580533515614e-01   +4.692040421096586e-01; -9.635844624391440e-02   +1.693745691235194e-01   -2.727636372099865e-01   -7.611893203557732e-02   +2.657857452790313e-01   +6.035788602949400e-01   +6.111181406273156e-01   +4.814067541531583e-01   +4.374964309739885e-01   +6.678504089781785e-01   +9.822221487933021e-02   +5.749824215417018e-01   +8.194639249430362e-02   +3.891766108121604e-01   +3.342580414586225e-01   +7.749698314805661e-02; +5.261464815659783e-01   -3.171586685725301e-02   +4.014006712270737e-01   +7.189650212733523e-02   +3.149047464725017e-01   -1.733454804126043e-02   +6.446943242385985e-01   +2.890542377150978e-01   +3.872870813966400e-02   +4.320754932742226e-01   +2.470789729242614e-01   +2.794734916444422e-01   +3.095921229128109e-01   +4.439514274137081e-01   +4.104104452261770e-01   +3.744797455803638e-01; +9.006091276395474e-02   +3.733667914576616e-01   -2.431325100906076e-02   +7.454615426606420e-02   +1.137830791779459e-01   -3.840129010491685e-01   +7.322756894579149e-01   +4.556955301185448e-01   -9.038474002603963e-03   -1.137386172079319e-01   -1.880950772923906e-01   +1.901604374545118e-04   +1.361553152017886e-01   +3.393155010668666e-01   +3.535311271697212e-01   +1.949323671144979e-01; +1.677156691328571e-01   +5.828506605186311e-01   +7.465164429547423e-01   +2.400392553504803e-02   +3.134512073621041e-01   +5.461400322623012e-01   -6.122481151976129e-02   -1.568617622120943e-01   +1.362325305365200e-01   +9.890857315684624e-02   +5.379059485131048e-01   -2.556661636519816e-02   +1.870821480182204e-01   +6.175394076899695e-01   +7.113056663787937e-02   -7.075521741909291e-02; -1.689930823597265e-01   -1.440924863751134e-02   +2.488680726406970e-01   +1.736906887130418e-01   +6.780944972911758e-01   +1.877357506094729e-01   +3.760299382034509e-01   +2.220437731605211e-01   +3.431484374314305e-01   +1.295964862043940e-01   -6.862060123771035e-02   +5.259894139910934e-01   +1.003019267841086e-01   +8.249363731361156e-01   +1.481689816469428e-01   +1.751442041964400e-01; +1.748929650489549e-01   +9.792193189299402e-01   +6.620738999027207e-01   +3.276411768913927e-01   +1.229428068803136e-01   +6.694838089958708e-01   +1.967609263661742e-01   -3.125859971481545e-02   +3.826051198486954e-02   +3.280825811837871e-01   +5.163778660165563e-01   +5.449615981291513e-01   +2.989501036307652e-01   +2.781574035725219e-01   +2.684337348053990e-01   +1.026899584033231e-01; +1.078885546281069e-01   +9.395258574017649e-01   +7.073130420045702e-01   +5.798883112030476e-01   +4.119328816827558e-01   -1.761318340960355e-02   +1.836522548930337e-01   +5.887954239811093e-01   +4.657879107404063e-01   +2.716548457518549e-01   +4.552092504061303e-01   +4.060574482607951e-01   +1.105404927981161e-01   +4.705987713489597e-01   +2.243168751063865e-01   +5.754742469720288e-01; +7.139187118661202e-01   +9.213949257070229e-02   -9.953840787424637e-02   +4.908897805416184e-01   +8.390126131385046e-01   +1.250895628283479e-01   -4.552070599812345e-02   +2.878114234603352e-01   +1.395833833166971e-01   +1.987190203952783e-01   +4.247254967800372e-01   +4.479259740727387e-01   -3.977598227019316e-01   +1.655052179580909e-01   +1.859446814946878e-01   +7.637059586157030e-01; +5.898933402674866e-01   +7.007860708449660e-01   +5.717696006149957e-01   +1.978107182952973e-01   +2.952525500769694e-01   +9.745397497080542e-01   +3.326612448908958e-01   +2.317541430243309e-01   +5.169334568403471e-01   +3.285565498897282e-01   +6.607149938584527e-01   +1.205738480997089e-01   +4.433586131126704e-01   +1.448787604834572e-01   +2.568847076548145e-02   +3.007125552581024e-01; +4.244134110195147e-01   -3.651328269226732e-02   +7.574776198985275e-01   +7.635652817099903e-01   +7.496074130537844e-01   +6.519459980155883e-01   +8.102850922429679e-01   -9.691682473035931e-02   -2.211296753052686e-01   +8.029907409876863e-02   +4.415595306225865e-02   +4.792132160126655e-01   +3.337473983441342e-01   +2.485641365786838e-01   +4.049615419480310e-01   +3.109122089586500e-01; +5.288501351482023e-01   +8.571628509775115e-01   +1.523231836997431e-01   -1.331666897793296e-01   +5.502200924071119e-01   +2.639159909078267e-01   +1.331212436128834e-01   -2.641079474072752e-01   +4.188705690321156e-01   +2.847214664895001e-02   +3.556968943612236e-01   +4.327483107319131e-01   +5.883341448670695e-01   -1.952329824224306e-01   +1.807133422438228e-01   -3.546636771789983e-01; -1.186916945609665e-01   +3.400792318208736e-01   +6.727973005660035e-01   +2.715320747816008e-01   +1.423762568467225e-01   +2.714769185994855e-01   +6.400339397992547e-03   +6.390883625431173e-01   +4.775216208616877e-01   -4.327227393164890e-02   +1.834584335560094e-01   +6.183196175804931e-01   -2.408263943900923e-02   -1.494397973740728e-01   -5.278414909349551e-02   +3.275545408876798e-02];
L2I_L1I_iGABA_netcon = [+1.690433736156199e-01   +2.787310921795568e-01   +6.351905266200489e-01   +2.923375335623307e-01   +5.701021017669574e-01   +6.671721387508872e-01   +5.660968629540273e-01   +6.743247300495966e-01; -2.208013846579869e-02   +3.802994860986834e-02   +2.147513614991991e-01   +3.039681158670761e-01   +2.821232760071655e-01   -2.041742699520991e-01   +5.203820364359548e-01   -1.373490246013770e-02; +4.165991158067450e-01   +4.096930369221186e-01   +3.040040425002939e-02   +3.541832541723683e-01   +3.964325797204904e-01   -2.722685167709693e-01   +3.667124861578213e-01   +4.618954293173366e-01; +3.506303094312103e-01   +2.132847123303938e-01   -1.803740399134834e-03   +4.554685763327386e-01   +1.765447663143410e-01   -3.796655812425571e-01   +1.890667835640006e-01   +9.387461354506976e-03; +1.876038412700154e-01   +5.796913016145644e-01   +1.599466042820270e-01   +5.348068752726237e-02   +4.906307231923283e-01   +1.629498106602288e-01   +5.013290239219415e-01   +6.257033499559808e-01; +3.312156214376360e-01   +3.224954463103863e-01   +3.585995461558242e-01   +5.283010152957653e-01   +2.723595045933143e-01   +2.349751232388750e-01   +4.940299515607756e-01   -1.474846255030090e-01; +1.412537847689974e-01   +5.523427698243950e-01   +4.302134548800281e-01   +7.284432902315964e-01   +1.122437311790041e-01   +5.669768938382277e-02   -2.667802733457689e-02   +2.790833954587574e-01; +5.291685236319041e-01   +4.580138062693676e-01   -4.639756733751700e-02   +4.456687029737090e-01   +1.741898437762541e-01   +3.547584359337785e-01   +2.946458087444173e-01   +1.435302102956917e-01; +4.135551607272965e-01   +2.190659655746992e-01   +6.087239879718703e-01   +2.266530799709231e-01   +6.387911629687927e-02   +8.083389717368638e-01   +1.658821693344255e-01   +5.599691811569358e-01; +7.842068433094731e-01   +3.059380198566153e-01   +3.478061401889384e-02   +3.138786543819037e-01   +2.699988268115646e-01   +1.595539861828806e-02   +1.678362654240820e-01   +4.576444667228965e-01; +2.649525088148994e-01   +6.973341747967289e-01   +1.690561285293006e-01   +5.320239816724047e-01   +3.257656633412770e-01   -9.457167483013912e-02   +6.198731955240454e-01   +5.961540647156406e-01; +6.848248062864176e-01   +9.074993656872028e-01   -1.527377868554149e-01   -3.946863529956156e-02   +1.210450412567389e-01   +2.050353190394396e-01   +2.094767364381427e-01   +7.810506941415898e-02; +8.472609721665204e-01   +1.642548574381828e-01   +6.578159081069478e-01   +1.216288095753677e-01   +4.423565718716558e-01   +1.100841626425174e-01   +7.290622723351449e-01   +9.502071005915874e-02; +6.873252201502615e-01   +2.855319951837086e-01   +4.941283283947995e-01   +1.420790301161552e-01   +3.380564472295170e-01   +3.033128079339115e-01   -1.624340291058407e-01   +5.043671420327767e-02; -2.101228177822008e-01   +9.088623935119249e-01   +2.817725467929384e-01   +1.171059180833687e-01   +2.251458862384818e-01   +4.889294046390188e-01   +2.615852801056830e-01   +2.920643567933808e-01; +2.257747550437042e-02   +5.597815475108613e-01   +2.267914825896293e-01   +3.712600306470136e-01   +9.524868837540033e-02   +3.475171415937529e-01   -3.168158308757379e-02   +8.698850642269447e-02];
L1I_L2I_iGABA_netcon = [+2.163826411720976e-01   +4.237270142598616e-01   +3.620514607941588e-02   +4.357383241271374e-01   +7.728121810103403e-01   -1.282652628572920e-01   +5.150022280287021e-01   +1.963947863765381e-01   +2.685833841181691e-03   +2.677112403989947e-01   +2.927183272432973e-01   +3.412169625219216e-01   +5.622811826212434e-01   +2.144005829808881e-01   -1.777718448985530e-01   +3.215352760398705e-01; +7.002552261263274e-01   +2.317058761779851e-01   +7.020925091690651e-01   +7.500342699444772e-01   +2.511103060402448e-01   +9.622557844118184e-01   +3.593475339455784e-01   +1.805954379472189e-01   +3.816285577553900e-01   -2.306877248750210e-02   -5.769001710630866e-02   +8.906444376216763e-01   +5.383056853090395e-01   +8.701548663310101e-03   +3.981384397148708e-01   +5.594549996349749e-01; +4.419324615461912e-01   -3.493040587170566e-01   +8.698518857438767e-01   +4.274702683994096e-01   +5.332903950086596e-01   +2.600829121920348e-01   +3.805428006111370e-01   +5.278604613039561e-01   +4.884801325794604e-01   +3.584644873459116e-01   -1.071029457337361e-01   +1.825170708982002e-01   +9.070470482275018e-02   +5.636382064531382e-01   +3.384015680173019e-01   +1.500248891544881e-01; +4.985307881246751e-02   +4.976245677955142e-01   +1.122362443278151e-01   +2.076384268160456e-02   +3.218709026622343e-01   +3.491972945285136e-01   +1.000000000000000e+00   +2.942460531088206e-01   +7.839191347901244e-01   +2.736811723600420e-01   +3.933513710402847e-01   +4.841502623408748e-01   +4.841917618319225e-01   +2.052974318003427e-01   +7.947123322145938e-01   +3.963856542066893e-01; +3.099729182822328e-01   +7.215675859244985e-01   +2.920586148398592e-01   +2.470565193659024e-01   +2.424204850513171e-01   +1.286426830246782e-01   +3.967457700439023e-01   -1.212574400990965e-02   -8.644363437458247e-02   +2.618098392688631e-01   +3.777461681113634e-01   +7.071678967005002e-01   +8.363171095278256e-02   +2.774932563773761e-02   +4.543735363167626e-01   +5.801806542941763e-01; +6.186146005966369e-01   +3.650425875332551e-01   +5.318620515992040e-01   -7.309765754973177e-02   +5.039795840101156e-01   +4.378943847566007e-02   +8.127127402348809e-01   +1.290693250568274e-01   +4.030683982361585e-01   +6.428235416305444e-01   +7.491638051375270e-01   +1.600667028096275e-01   +3.371465159533217e-01   +3.767222018232517e-01   +3.380225491978496e-01   +3.913867436212266e-01; +6.788198417801106e-02   +6.611348175091774e-01   +5.767333664853248e-01   +4.679525394119248e-01   +4.724404309847542e-01   +8.067273991025726e-01   +8.115175799199326e-01   +3.005193421940323e-01   +2.435095694635428e-01   -1.102565604451508e-01   +7.336507671130484e-01   +9.789007419981613e-02   +4.754115357852539e-01   +5.539571900733392e-01   +1.677951870598182e-01   +3.078095521225236e-01; +1.822881482506473e-01   +6.807650597938792e-01   +3.413016180248171e-01   +6.157252679940647e-01   +3.767641600691490e-01   +2.623122488021718e-01   +4.100893464199900e-01   -4.135420449556649e-01   +1.091092942165341e-01   +1.609568575718104e-01   +1.970829689112334e-01   +6.243758291367527e-01   +1.701289378770675e-01   +7.215802150339721e-01   +2.681431081791259e-01   +2.628941795844256e-01];
L2E_L1E_iAMPA_netcon = [+1.584290627495405e-01   +4.338671695706841e-01   +3.527531681137669e-01   +4.468565478714430e-01   +2.017235720733124e-01   -1.863298606464829e-03   +3.747311554549451e-01   +5.026543766426510e-01; +4.264213907494960e-01   +7.906243976608315e-04   +6.534271686557444e-02   +1.729415481176976e-01   +2.792609907615608e-01   +1.334225037477463e-01   +1.537269236666130e-01   +4.007908774088475e-01; +1.202981424764014e-01   +3.147282129335657e-01   +2.466334879067142e-01   +9.250790467845479e-01   -5.404642201254627e-02   +2.473775038218858e-01   +7.701078146761332e-03   +5.992564170389547e-01; +3.095387043863438e-01   +8.933184902478374e-02   +2.756180746946955e-01   +3.087167466100021e-01   +5.515087944508292e-01   +4.048128065490900e-02   +3.716961816912199e-01   +2.078532579929643e-01; +5.825633591559808e-01   +6.703250743541901e-01   +2.986326730334957e-01   -1.310926829558946e-01   +9.171877400424706e-02   +2.626877327421491e-01   +9.335810228743679e-02   -5.805955981848702e-02; +5.732969252619474e-01   +4.013323091902813e-01   +5.735619365384266e-01   +4.732837698999082e-01   +6.712019812292526e-01   +3.275187164106900e-01   +5.124116910878314e-01   +6.190733372483173e-01; +8.556672638239410e-01   -5.607144697837878e-02   +1.323064494439055e-01   -1.029008308697152e-01   +1.997139944074129e-01   +2.890850244361828e-01   +4.566344914083457e-01   +5.823051976167646e-01; +6.276145036048714e-01   +3.971831623664527e-01   +1.995404636722345e-01   +5.171695625847237e-01   -1.637809615699439e-01   -1.318214938349400e-01   +3.182888251645945e-01   +9.630590106731848e-01; +2.587250157343057e-01   +3.148901351450129e-02   +4.179053863148848e-01   +1.520752434653155e-01   +3.894336699903566e-01   +5.875000467972260e-01   +4.018512422300915e-01   +8.981335678040209e-02; +3.916122699819022e-01   +3.745382844101166e-01   +1.484448649623033e-01   +6.009519017596482e-01   +4.038068547127664e-01   -4.971589221188464e-01   +4.616030273781268e-01   +3.070194036500527e-01; +2.199541895884917e-01   +2.661051755942803e-01   +4.678974502366189e-01   +5.485147940293285e-01   -3.031455561093797e-02   +1.205742079315680e-01   +4.484897333764862e-01   +3.554830466066151e-01; +4.169722613948446e-01   -8.426986394675694e-02   -4.377662996180068e-01   +6.549108524939229e-01   +3.624197125074917e-01   -2.194519317263249e-01   +2.271415758643643e-01   +2.230147485033354e-01; +7.853020698536994e-02   +2.419088065400485e-01   +2.540050318441667e-01   +8.417935576214721e-03   +4.361879029193216e-01   +7.732414974841052e-02   +9.306890998184672e-02   +2.243386519154190e-01; +7.246498577977591e-02   +4.780391206573926e-01   +5.969162541636270e-01   +4.310692291387251e-01   +9.182932359352605e-02   +4.953544255604245e-01   -2.095715568291476e-02   +3.784188105847208e-01; +1.144958682295473e-01   +1.709301865707702e-01   +4.846057338761792e-02   +5.074368652152881e-01   +3.717707633400497e-01   +2.593347946736055e-01   +2.850605097722896e-01   +6.099233020842250e-01; +2.651411139745023e-01   +8.305605574362651e-02   +2.138073583402690e-01   +1.178206260435694e-01   +2.954293958159241e-01   +2.557985167073858e-01   -1.033076897412125e-01   +2.012138241687697e-01];
L1E_L2E_iAMPA_netcon = [+4.325475210573244e-01   +5.537408382286767e-01   -4.752253214531917e-02   +3.026734849665590e-01   -4.448882896537031e-01   +6.187153804225572e-02   -8.334257360537206e-02   +7.602625154266349e-01   +6.019518537111400e-01   +3.343609126464310e-01   +5.627465596172908e-01   +6.288353547347245e-01   +5.448347674466104e-01   +1.387226595914538e-01   +1.908630653130863e-01   +7.838959123964648e-01; +3.814106062443740e-01   +3.130899326827473e-01   +4.847161712660352e-01   +5.287229468585463e-01   +1.084793209086269e-01   +3.250529299238508e-01   +4.871355017475407e-01   -2.446662399006345e-01   +1.660305828454970e-01   +5.013472062738508e-01   +4.227236540057366e-01   -5.728076833812688e-02   +7.052796635154241e-01   +6.038292039814082e-02   +1.309447720739516e-01   +1.143755590512508e-01; +4.902656552869117e-02   +3.913965133879699e-01   +4.445093231318534e-01   +4.041640024547776e-01   -1.215705079108294e-01   +1.674312390015323e-01   +8.700404538217060e-02   +1.268102995399598e-01   +3.457156989514886e-01   -9.618031965808467e-02   +6.124797997127883e-01   +5.912735497011299e-01   +3.076024721097000e-01   +6.727930748717382e-01   +6.856641343102802e-01   +4.535152964477880e-01; -1.859399576071000e-01   +3.949343577152633e-01   +1.432368217708299e-01   +2.598165085273502e-01   +3.035727943851313e-01   +6.301102608333182e-01   +1.044066345000889e-02   -2.536492339168851e-02   +3.435309017056220e-01   +9.674793613352467e-02   +4.315274121303339e-01   +1.964908200356472e-01   +1.097916667529017e-01   +1.242185877647135e-01   -8.727961558290515e-02   +1.046830480908350e-01; +2.747035532943375e-01   +6.766731400622525e-01   +6.388942240488282e-01   +3.416291178085024e-02   +3.006655070478573e-01   +6.330275711065886e-01   +2.054529897439030e-01   +1.236985295979403e-01   +4.543634686144500e-01   +4.482167737026556e-01   +9.174956535766478e-01   -3.605300521009753e-02   +6.797621808624535e-01   +6.958071742005848e-01   +1.770447936646176e-01   +2.537937343936538e-01; +4.205283963678726e-01   +2.200103514175386e-01   +4.707706879224615e-01   +5.229660102695901e-01   +3.618124359399204e-01   +4.405792550118272e-01   +6.265566295301928e-01   +4.119186813989115e-01   +2.283152146138755e-01   +3.712093512088318e-01   -3.416439908005013e-02   +3.132909381478039e-01   +4.352409830980132e-01   +2.017476986800459e-01   +4.648877232704511e-01   +6.609646043609371e-01; +5.700900062736267e-01   +6.479160325850175e-02   +3.002390133607274e-01   +3.817055080999253e-01   +2.766683090562352e-01   +1.786181049410333e-01   +8.404897010185056e-01   +7.023488287846206e-01   +4.777409541998919e-01   +2.078828338221447e-01   +4.398908557187283e-01   +3.060787155991233e-01   +1.836915315393401e-01   +4.091583017452375e-01   +3.477490070942293e-01   +3.468605977094160e-01; +5.141274357288786e-01   +3.730609876112361e-01   +3.604053605925194e-01   -3.449637382419648e-02   +6.626327355086773e-01   +3.953773155431951e-01   +1.167394065866658e-01   +3.628207960616172e-01   +3.143918132244245e-01   +2.784412083728701e-01   +1.320828953495117e-01   +1.392588378392299e-01   +1.188619649456538e-01   -2.865751243725926e-01   +2.235295195889613e-01   +2.241188408624806e-01];
L2I_L2E_iAMPA_netcon = [+2.967885648764695e-01   +7.736807260578527e-01   +5.758935745044589e-01   +7.513360219073658e-01   +4.839399030263716e-01   -1.899883218316362e-01   +6.327472713644809e-01   +6.549483631185012e-01; +6.034448012425946e-01   +7.244070145180080e-01   +1.924406028357961e-01   -1.537606674310471e-01   +3.115616321265556e-01   -7.996591387696195e-02   +3.460365916951441e-01   +3.748905912772889e-02; +2.580104952646177e-01   +6.227335608090889e-01   +5.894379107424936e-01   -6.420488653177833e-02   +2.015940257956156e-01   +5.833404157235094e-01   +1.246494701927404e-01   +2.542106038296356e-01; +3.994639729681883e-01   +6.928678475971792e-01   +3.854360652614309e-01   +4.639788482015384e-02   +5.380799574285078e-01   +8.437695879723500e-01   +6.036471238432503e-01   +7.899251968323150e-01; +1.000000000000000e+00   +2.335531370498646e-02   +2.184478273028645e-02   -5.816038444032521e-02   +1.172258359093324e-01   +5.727036683314424e-01   +4.425712926106074e-01   +3.539960005602749e-01; +3.168949029872983e-02   +1.305563794829548e-01   +1.311981927949805e-01   +3.515369316494723e-01   +1.750287448462400e-01   +6.845965522117987e-01   +5.750470696953900e-01   +7.587747648554688e-02; +6.937805542886308e-01   +8.878311852148002e-02   +2.891734116142472e-01   +3.984488929694441e-03   +2.518309311642972e-01   +2.349660473867591e-01   +2.533027971390550e-01   +5.218220861030080e-01; +2.023358276479530e-01   +2.819134689084888e-01   +4.644366496102149e-01   -8.439559001252983e-02   +5.076750229025905e-01   +4.537197251255061e-01   +4.605279389837943e-01   +1.018147728448957e-01];
L2E_L2I_iGABA_netcon = [+1.000000000000000e+00   +6.322572311468806e-01   +6.202950435868867e-01   +5.863797681923918e-01   +2.327197337752551e-01   +4.805286228240892e-02   +2.427512464965535e-01   +8.772759519739017e-02; +2.531194744650297e-01   +7.370219350667624e-01   +9.001876065115286e-01   +9.585585911182967e-01   +1.660447672189335e-01   +3.244252849076482e-01   +6.880914153280359e-03   +7.503001981831566e-01; +1.628269662604225e-01   +5.360534961270146e-01   +6.739848550898803e-01   +5.286132366484295e-01   +5.983396381258381e-01   -1.550962340638804e-01   +2.568684965933803e-01   +1.246204215067261e-01; +2.177017377596063e-01   +7.229657657409265e-02   +5.649231233873481e-01   +2.955894814349347e-01   +2.541060391385881e-01   +3.412163626490483e-01   +2.830052724827927e-01   -3.015609780774437e-01; +4.406780626012810e-01   +6.527822062159024e-01   +3.541321572086728e-01   +3.369954238926330e-01   +1.691708369356024e-01   +7.469711007368360e-02   +6.830473279218476e-01   -7.023590930684108e-02; +7.657623560355212e-02   +2.294067505919678e-02   -3.215511093133739e-01   +1.766375283404588e-01   +5.314509038195226e-01   +3.130419310484560e-01   +2.213559044877906e-01   +2.490428087066490e-02; +4.763900806498287e-01   +4.439019003503414e-01   -1.538999776100771e-01   +3.811512986353978e-01   +3.133892310265334e-01   +5.305688571884375e-01   +4.265477531549922e-01   +5.345906380964823e-01; +4.981975918408046e-01   +2.465641396350215e-01   +3.976583850743219e-01   +3.853243014955913e-01   +1.713684649152491e-01   +5.990995592449817e-02   -7.067171958514797e-02   -8.280130510795995e-02];
L3E_L2E_iAMPA_netcon = [-9.876953614844115e-02   -1.691220408722156e-02   +5.146085887050525e-01   +3.157638891913932e-01   +5.202974801122756e-01   +3.687884699869909e-01   +5.426124137160143e-01   +7.349327955056719e-01   +2.829800515072799e-01   +6.998001850387376e-01   +7.358131238623440e-01   +4.223317220948861e-01; +1.972088954331848e-01   +2.906935926538176e-01   +4.797904578777438e-01   +2.608862840208555e-01   +1.771901859319369e-01   +4.512985897776918e-01   +1.563582043752842e-01   +6.512175478700708e-01   +2.377513695577846e-01   +2.849608835759904e-01   +4.344020396362223e-01   -2.266846923099520e-01; -2.864790703838815e-01   +7.681759097179085e-02   +1.865036877905013e-02   +3.915361706954891e-01   -2.824144636415206e-01   +1.050466074200239e-01   +1.159857447264417e-01   +2.602154792205245e-01   -2.615428070270602e-01   +1.898155550281473e-01   -4.078190987945411e-02   +1.475687009743245e-01; +3.295006779508270e-01   +1.602480024907764e-01   +3.671986945327485e-02   +2.535133886010718e-01   +5.605591048155903e-01   +2.019053005060950e-01   +4.995811541188164e-02   -7.575920214090689e-03   +5.394875545495793e-01   +2.549141356209415e-02   +3.033452407674077e-01   +7.583604617779938e-01; +4.625525640703150e-01   +5.934572172553695e-02   +4.876162590248200e-01   +4.738544284098706e-01   +2.251418634387334e-01   +7.247165279118879e-01   +5.706245279414444e-01   +5.789529575973518e-01   +1.867915534232144e-01   +3.012425799254531e-01   +1.490735411733700e-01   +2.443987096876329e-01; +7.357953097073719e-01   +2.041355258234109e-01   -5.823543072706064e-03   +4.247680795204042e-01   +4.589120473096917e-02   +5.419480644121547e-01   +8.069462775442603e-01   +2.763185426522292e-01   +3.339774167692254e-02   +8.556883422980104e-01   +2.821375086518566e-01   +4.243253688621420e-01; -2.755713646926490e-02   +5.225873505490953e-01   +2.770334200244225e-01   -4.787123220857553e-02   +9.873051991560023e-01   -2.057992868777410e-01   +1.325873038791904e-01   +4.910804805076667e-01   -3.180395745390124e-02   +3.443985079221551e-01   +5.042809790184068e-01   +9.503829300178548e-01; +3.605822730571184e-01   +3.540496900642564e-01   +2.791479096286226e-01   +1.589623033718886e-02   +6.500278234615962e-01   -2.265246110152028e-01   +6.882512870035814e-01   -1.031399657860369e-01   +8.689966258450738e-02   +3.273711063289610e-01   +5.708036428404915e-01   +2.457079898771099e-02];
L3I_L2I_iGABA_netcon = [+3.139569686635718e-01   +4.332323464517991e-01   +4.366345856298125e-01   +1.741920733402233e-01   +5.652271520893166e-02   +4.350567282378955e-01   +3.099747856153254e-01   -1.129721352160085e-01   -1.601093372197257e-02   +3.273450163728526e-01   +4.498228685067567e-01   +4.438262485587675e-01; +1.839395237102387e-01   -1.125470778652090e-01   -1.080202989348628e-01   +5.576041096942923e-01   +1.165956248719455e-01   +5.570997483730754e-01   +2.290191708258462e-01   +1.505847614753765e-01   +8.697183004020590e-01   +1.901337635689363e-01   +6.842832123953668e-01   +2.744716068391704e-01; +1.107858767413514e-01   +5.794757869644778e-01   +6.512749156616344e-01   +4.582826205092700e-01   -6.691348173353315e-02   +4.612418155602357e-01   +5.599058716493455e-02   +3.994882585071443e-01   +4.732433708795605e-01   +3.750110066457382e-01   +5.207799544025857e-01   +3.191970898012482e-01; -2.201134966539744e-01   -2.237488183846932e-02   +7.251871536056673e-01   +3.404453311295783e-01   +2.998675638015835e-01   +6.145471101123756e-01   +1.248954185169129e-01   +2.868882629164308e-01   -6.581012621490502e-02   +2.770000799066324e-01   +1.179113577463854e-01   +1.339072380197926e-01; +3.664023681068819e-02   +2.131365448003656e-01   +2.012055356314233e-03   -2.591787196858841e-02   +1.140653312949701e-01   +2.644979593073733e-01   +7.799858310574809e-02   +3.723916189238486e-01   +1.974399016559819e-01   +3.603472107506723e-01   +6.352371753530579e-01   +4.667360620383405e-01; +9.546434026856095e-03   +5.871797300800049e-01   -1.533865957741003e-01   +5.957708352796813e-01   +4.701975296247150e-02   +3.014866203132431e-01   -1.717070549351785e-01   +6.447214423319425e-02   -3.614834020634188e-01   +6.243878632402727e-01   +6.917885193993997e-01   +3.098989351009632e-01; +3.953242803380195e-01   +2.350221027299916e-01   +4.796433293184740e-01   +4.327327433125917e-01   +2.245906018190993e-01   +3.320399578169171e-01   +2.623720626089520e-01   +1.126152308863984e-01   +2.772949518516325e-01   +6.326151234909718e-01   -5.136160020039211e-02   +2.910199701102098e-01; +3.690709251210034e-01   +6.005083267928747e-01   +3.220258949903551e-01   +1.603753392992763e-01   +3.738715750094789e-01   -4.647466233012134e-01   +1.000000000000000e+00   +5.199545914265405e-01   +7.317951493542181e-01   +3.194005370614941e-01   +3.681140158472796e-01   +4.026679665722927e-01];
L2E_L3E_iAMPA_netcon = [-1.070050227189234e-01   +1.642555347308212e-01   -3.075400367745711e-02   +5.677915432204088e-01   +3.592990395876461e-01   +2.612009285801222e-01   +1.080189300505019e-01   -1.209775864469130e-01; +3.526732385643773e-01   +4.003151351614929e-01   +4.405121074063376e-02   +5.131910785676902e-01   +7.112953701709798e-02   +2.903226624469614e-01   +2.022367467694968e-01   +4.948635116453309e-01; +4.957103524580246e-01   +2.724720028201461e-01   +4.641508915097765e-02   +2.098741315920273e-01   +6.775007192851361e-01   +1.753256291185470e-01   +4.521799464700733e-02   +2.747013835019100e-01; +2.061378243600414e-01   +5.787696037613604e-01   +3.755556947960671e-01   +8.264801123643888e-02   +6.761131759029123e-01   +4.382615373342909e-01   -7.129014604443701e-02   +3.595993682479088e-01; +1.681487835091033e-02   +9.979285460293176e-02   +3.419431899679869e-01   +2.742660616737083e-01   +4.301747135633069e-01   -6.004615400581023e-02   +6.037144233003316e-01   +7.529424252198305e-02; +5.072398282811980e-01   +6.422477469720989e-01   +9.444666620644220e-02   +5.626599205416658e-01   +1.624701577687419e-01   +1.882943701482148e-01   +1.757470952523500e-01   +6.911615189967469e-01; -1.410565825414773e-01   +2.768525923389984e-01   +3.677971766570156e-01   +5.513196984626743e-01   -3.223017898266014e-02   -6.846626551881968e-02   +7.135267600901019e-01   +3.744815270925519e-01; -4.304342720071561e-03   +6.831385912229704e-01   +1.020346108941516e-01   +2.548787249789129e-01   +7.156690395887318e-02   +5.740279446892285e-01   +4.297940875391356e-01   -7.716537897536657e-02; +6.066927957877696e-01   +6.226773994537741e-01   +2.039734257258202e-01   +4.957925323342384e-01   +4.034003066594857e-02   +9.830800128656481e-02   +3.908987782483162e-01   +1.000000000000000e+00; +3.271735086407446e-01   -3.925183250418726e-02   +3.503084673387263e-01   +6.691504988413628e-01   +4.262787415560955e-01   -4.189011846721723e-02   +5.378192626681189e-01   -5.196672457508347e-01; +1.102257596786259e-01   +3.301496589727571e-01   +1.209613562367877e-01   -2.073317929177271e-02   +3.119119616718988e-01   -1.021172966912350e-02   +2.316736564672599e-01   +8.096596328758960e-01; +1.725121347203532e-01   +1.858866235960684e-01   +3.824963599440599e-01   +3.563224954013119e-01   +4.949805163644043e-01   +2.615784056475823e-01   +1.205464229646517e-01   +3.076830772910779e-01];
L2I_L3I_iGABA_netcon = [+4.513041286656526e-02   +3.657929016929970e-01   -2.204686196647412e-02   +8.198573611729947e-01   +3.912070506364366e-02   +1.294470538189000e-01   +2.832952720780690e-01   +3.252880415787634e-01; +4.166650217105465e-01   +9.522886479646551e-02   +3.916125716752656e-02   +1.754213180194386e-01   +7.362487928223102e-02   +3.039931801318240e-01   +1.000000000000000e+00   +1.404174013477615e-01; -4.947302008404932e-02   +3.270825238735245e-01   -2.505935225626400e-01   +5.092856367954464e-01   +2.969041783476585e-01   -3.364296007109581e-02   +4.609410660013688e-02   +2.905335952971072e-01; -3.361955578140322e-02   -4.004963686270882e-01   +3.643284420030963e-01   +3.889133681712963e-01   +5.042250387400540e-01   +2.357016728667626e-01   +5.098381740997948e-01   +2.915235247211492e-01; +2.910097189070967e-02   +4.159250105530972e-01   +3.410453507706445e-01   +8.143000496660922e-02   +3.035694633181109e-01   +3.005514935291615e-01   +4.215205202030090e-01   +5.358375351336079e-01; +1.011283322932404e-01   +2.763666864995639e-01   -1.627909874226744e-02   +6.111115873458099e-01   +3.289107448269654e-01   +5.485942550472962e-01   +5.203678456644490e-02   +3.124553058644042e-01; +3.940737029238493e-01   +3.013510944221922e-01   +1.048170222359188e-01   +4.788483160357078e-01   +4.692270016841228e-01   +2.747062706760945e-02   -1.271921193028828e-01   +2.531380484691959e-01; +3.285592736164000e-01   +5.741190976220856e-01   +7.906930856791602e-01   +4.257583802120337e-01   +1.133014904467093e-01   +4.276308316213850e-01   +6.753632394782449e-02   -2.343442265816968e-01; -6.131482885270430e-02   +1.926942436513650e-01   +3.570290208736446e-01   +3.056852859394164e-01   +3.174693696529961e-01   +4.411539955754573e-01   +2.981166082105025e-01   +2.414364936930287e-01; +4.336558820073768e-01   -5.552339288636038e-02   +2.274454142084809e-01   +2.675742604216695e-01   +5.378902061272565e-01   -2.913543877384897e-02   +1.099500244505584e-01   +3.327707057756434e-02; +2.881363844328415e-01   +7.138082623115152e-01   +3.657382994773669e-01   +3.097944283956253e-01   -6.100771960712583e-03   +1.270661868953117e-01   +5.311019333750654e-01   +1.740049420507679e-01; -6.553077715781284e-02   +3.280746568709113e-02   -2.978935306566137e-02   +5.938079436229254e-02   +7.304251922666001e-01   +3.795734881257949e-01   +6.187207845638345e-01   +9.354168827629575e-02];
L3I_L3E_iAMPA_netcon = [+2.461742697052557e-01   +5.061649765109040e-01   -2.536292801012628e-01   +5.977248846813400e-01   +8.377749580584991e-01   +2.041476603291206e-01   +1.846525391223375e-01   +4.129287585434126e-01   +2.047554473982237e-01   +2.254817214756637e-01   +3.046113979841134e-01   +3.960935492896404e-01; +5.386873568449392e-01   +8.516709895151870e-01   +3.081443136078744e-01   +1.896535797993619e-01   -1.360531098716941e-01   +4.900022608611060e-01   +3.950949469949493e-01   +7.993805525106863e-01   -4.125345522161363e-02   +7.485990214017963e-01   +4.294182444759398e-01   +5.687682484731083e-01; +1.952536209642006e-01   +6.515060163591803e-01   +1.802715102350687e-01   -2.509079251825457e-01   +9.442549216490580e-01   +3.269178280785921e-01   +2.244428199088467e-01   +6.532007256038294e-01   +2.971056619154476e-01   +1.903618924778969e-01   +5.327930625170006e-01   +4.997310510154047e-01; +8.672030113238749e-01   +3.652779448269021e-01   +3.832575655245686e-01   +8.542339773674867e-01   +7.726277461449793e-01   +7.173844219976759e-01   +7.051391059822288e-01   +4.286704318989877e-01   +2.614883138022118e-03   +5.472582566331590e-01   +3.237586549416416e-01   +6.653808977664305e-01; +1.973098808449354e-01   +2.528997699249094e-01   +3.866704124687415e-01   -1.118877532406184e-02   +5.009552200851913e-01   +8.913161528804058e-01   +5.301084131718192e-03   +6.921826582548752e-01   +1.000000000000000e+00   +2.978859752132487e-01   +8.254845613744324e-01   -3.715736699299693e-01; -1.122185865474493e-01   +5.505180116646906e-01   +4.278030862253630e-01   +4.533866395366188e-01   +1.077065777388121e-01   -1.964523395115694e-01   +5.416849845153396e-01   -1.045100234229401e-01   +3.002185749058051e-01   +3.518740352108190e-01   +4.141919539981713e-01   +1.854484170796201e-01; +5.018540056696388e-02   -6.345764876885127e-02   +1.369060522848449e-01   +1.460079419804227e-01   +7.287701513017747e-01   +3.218073437697965e-01   +4.744631242920486e-01   +4.430435797108253e-01   +2.259829512215567e-01   +6.625231590455460e-01   +1.070416052216541e-02   +3.233932687380069e-01; +2.910815870567738e-01   -8.778780058236633e-02   +4.647146873716371e-01   +1.968028341722414e-02   +2.814490755330678e-01   -1.043107849783002e-01   +1.117082135095672e-01   +2.519411582254470e-01   -1.037538344234084e-02   +6.246379591853284e-01   +3.356122622180938e-01   +1.205570554286250e-01; +6.074090666459532e-02   +3.432578264399947e-01   +5.282045745150400e-01   +1.477709744829371e-02   +3.331428181383275e-01   +2.592696306934724e-01   +3.645624754969420e-01   +2.777932542863925e-01   +6.964973639674275e-01   -8.968695430053121e-02   +4.955056009970906e-01   +1.952561984658328e-01; +4.715205927575745e-01   +7.008075033233986e-01   +2.831645812447771e-01   +5.047738438630287e-01   -1.250371963284074e-01   +3.853731983331029e-01   +6.638671576082312e-01   +7.537486544340424e-01   +5.602981524063266e-01   -3.311375276611697e-01   +7.981479741889878e-01   +4.179255167837745e-01; -1.877543722395163e-01   +1.777245273000498e-01   +2.934945225859333e-01   +4.130294215760397e-01   -1.074700111870446e-01   +1.219953810889457e-01   -5.856603080205559e-04   +4.543837560559223e-01   +8.048126443342101e-01   +3.383499004742010e-01   +2.009946189142506e-01   +5.606375368883251e-01; +6.582702719271320e-02   +6.858339893582084e-01   +6.999528953866478e-03   +6.166023910417564e-01   +9.271573599165738e-01   +9.427463333581160e-02   +1.886525902974263e-01   +5.629412820063041e-01   +5.279781497367489e-01   +2.204366790029078e-01   +2.116178908235186e-01   +9.152158636304326e-02];
L3E_L3I_iGABA_netcon = [+6.521667878573543e-01   +1.304071370634082e-01   +1.524240098387058e-01   +5.261566363885937e-01   +5.335921484956737e-01   +7.258713719065840e-01   +6.278012191284644e-01   +9.091954946544089e-01   +3.992263758052550e-01   +2.097813537659824e-01   +4.202716251855558e-01   +4.854378032052385e-01; +4.622065161538423e-01   +2.061503387628518e-01   +8.439188623569548e-01   +2.125939876870946e-02   +6.168364903845053e-01   +6.574562637122435e-01   +9.313969778784164e-01   +1.318297190314710e-01   +1.269796692772029e-01   +1.734420957651341e-01   +5.373230858685761e-02   +4.529017535989331e-01; -6.415309921728576e-02   -1.512785130611703e-01   -4.192487229434185e-01   +8.677636547411617e-01   -2.736797139058648e-01   +6.606297398201588e-01   +1.335548616472136e-01   +7.911456331106190e-01   +6.183314067310907e-01   +6.959599489145949e-01   +3.979810517822275e-01   +3.510673578813838e-01; +2.814880935577085e-01   +5.992859266504844e-01   +4.964158804861850e-01   +2.047340073152041e-01   +4.930905031667261e-01   +1.349100620556193e-01   +4.279623081968815e-01   +4.439871871029705e-01   +5.210925310137019e-01   -5.292417708882818e-02   +7.498394671706750e-01   +1.653510388429632e-01; +1.058356983041215e-01   -1.867495276085352e-01   +3.567304548147829e-01   +4.908466535204990e-01   +2.647846057518319e-01   +1.242755036124127e-01   +4.508365592431888e-01   +4.613053354091001e-01   +3.507064207159791e-01   -4.341338650634370e-02   +5.352847492941473e-01   +2.663271601759362e-01; -2.211831408897385e-01   -4.880885248185226e-02   +6.150134983273082e-01   +4.914320348114282e-01   +4.878785002870088e-01   +5.211310914279597e-02   +7.394469657024560e-02   +1.300391020886748e-01   +5.111319273927611e-01   +2.834645087732351e-01   +4.207115704732104e-01   -1.812122404963954e-01; +6.546169019113588e-01   +3.234769902659895e-01   +3.502057590561253e-01   -1.978845689713357e-02   +5.943162444677377e-01   +3.822028556755127e-01   -8.472864161792683e-02   +5.722504460473993e-01   +5.317101818080542e-01   +3.921078161938491e-01   +6.377877264287556e-01   +3.510506984465862e-01; +2.294392492731460e-01   -1.780908291281569e-01   +1.618862864123063e-01   +5.642511900621502e-01   +6.369581357789952e-01   +3.728224064982478e-01   +1.831516622175876e-01   +6.159368630426078e-02   +4.353308336260083e-01   +7.958383961369947e-02   +4.873446250491476e-01   +9.130631688602751e-01; +2.306255744724589e-01   +2.627892811310840e-01   +3.405397749445009e-01   +5.900414267655745e-01   +4.579967941502670e-01   -4.674491198075085e-01   +6.071224415121644e-01   +4.457769875298457e-01   +1.579280491523569e-01   +8.037717945012111e-02   +4.464417248661768e-01   +7.432563897411151e-01; +1.514579773993995e-01   +7.702937527396576e-01   +8.244571402538957e-01   +9.267581663594819e-01   +3.352792163570925e-01   +3.315837899966773e-01   +7.287687976838260e-01   -2.856898288030917e-01   +7.595022563114945e-01   +3.921359361408907e-01   +4.618764416993111e-02   +2.525266735637660e-01; +3.860374565590595e-01   +5.789109693189747e-01   +8.141704042873735e-02   +7.476719007829671e-01   +5.078255595488682e-01   +2.527378740201372e-01   +6.118416089463466e-01   +7.510234934912701e-01   +6.933741558396688e-01   +4.612923425737508e-02   +2.368672333834773e-01   +7.940116252469471e-01; +6.044694255170313e-01   +1.916522051159679e-01   +3.065236890660393e-01   +5.735480922188767e-01   +3.276735785205354e-01   +4.229468643042071e-01   +4.796527912068804e-01   +3.115950184147119e-01   +2.156973299020197e-01   +2.395259967304484e-01   -2.485613830870290e-01   +4.315664273694955e-01];
L2E_Input1_iAMPA_netcon = [+4.553752787639777e-01   +6.824996806994542e-01   +6.806584980824105e-01   +8.988189104962513e-01   +9.526201953105270e-01   +6.168275173170572e-01   +9.329986075634357e-01   +4.309083819370300e-01];
L2I_Input2_iAMPA_netcon = [+9.030692615202176e-01   +4.615988275204817e-01   +5.434945553947338e-01   +5.237021960693810e-01   +5.345068405894350e-01   +9.692357135357716e-01   +7.347415950049473e-02   +6.441920484582069e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
