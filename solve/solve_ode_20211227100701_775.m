function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.710257027773619e-01   -9.082310066362254e-02   +3.540320690263862e-01   -3.045151845528099e-01   +1.432336811727722e-01   -4.200296619137346e-01   +2.329806285871772e-01   +8.180121826569048e-03   +4.862602272046603e-02   -9.227579978197727e-02   +3.714349075455287e-02   +1.899817506812559e-01   +5.140747191328889e-02   +1.482071737129885e-01   +1.885882722196654e-01   -5.195688758814003e-01; +1.284411778400749e-01   -1.358400855761075e-01   +1.712708658144414e-01   +9.264442804029662e-03   -4.423290984114215e-01   -2.315364520732877e-01   -3.132887529315229e-01   -3.938413102771889e-01   +3.114461046907815e-02   +1.283320489100150e-01   -1.959260104061458e-01   +3.200703515896690e-02   -1.313904968172211e-01   +1.407753303977464e-01   -1.054868558987191e-01   -3.600448042872031e-01; -1.414903639460966e-01   +3.669211921974529e-01   -1.353164725284153e-01   +1.547750539248976e-02   +2.802846742511963e-01   +7.572507329042177e-02   -2.121060811928387e-01   -2.067263181294147e-02   -4.590978742321352e-01   +2.644473334388155e-02   -1.350511016878021e-01   -1.918661138798966e-01   +1.042905879775060e-01   -2.660900409096705e-01   +2.002589154037133e-01   -1.464174004939983e-02; -5.358515282477531e-01   +2.818384949125212e-01   -1.554886606396076e-01   +5.806370760839853e-02   +1.314121405860059e-01   +1.541737583230617e-01   +1.929504507863854e-02   +2.118236741212610e-02   +8.136163919173166e-02   +3.658621898846488e-01   -2.829218142635513e-01   -6.601957654391614e-02   +1.521893263263756e-01   -1.520855338806013e-02   -1.344570573000555e-01   -1.924770163905478e-01; -1.131313751890167e-02   +1.929487586452021e-01   -5.311959685031497e-02   -2.579841587424346e-01   +2.260217926108956e-01   -9.060798349845904e-02   -9.117655183163759e-02   +3.929225312402220e-01   +1.816068726379898e-02   +4.237211359947094e-01   -5.231831808340173e-02   +2.995174184951846e-01   -2.316792409670294e-02   -1.055546347982839e-01   +3.275715773999626e-02   +3.384453348174971e-02; +8.685154652270775e-02   +3.907311035947431e-01   -1.964976186008741e-01   +3.300309098447971e-01   -1.878194855567067e-02   +1.259700688037876e-01   +3.147267470276974e-02   -1.055036708119122e-01   +2.729982018220322e-01   -2.971360555445204e-01   +1.205335953271763e-01   +7.415120707723588e-02   +4.801042772382249e-02   -1.891998211274703e-01   -1.368669734401640e-02   -2.842095568923132e-01; -1.047315126660700e-01   +1.177607891676311e-01   +9.855405246130430e-02   -2.668111502333718e-02   +4.934958051019459e-01   +2.568766768411294e-01   +2.120913649390054e-01   -1.917176383460679e-01   -2.637661949127347e-01   +8.016219581590198e-02   -3.071633085087551e-01   -3.752385059970520e-02   +3.105663710266377e-01   -7.273461328017408e-02   +6.177318100213842e-03   +1.876758322046894e-01; -3.706432435925920e-01   -2.763461719137514e-01   +1.436948097960427e-01   -1.235949177113318e-01   -4.605820450557295e-02   +4.601850154301902e-02   +1.109992799677049e-01   +1.621647567741707e-01   -3.810607202458599e-01   +2.232746020959265e-01   -1.785374969119122e-01   +1.841122397800780e-01   +4.191262586803521e-01   +1.097692934558904e-01   -1.589506085322713e-01   -3.726308774079976e-01; -6.836155493190917e-02   -1.804367803286192e-03   -4.588089858646812e-02   +1.494915892474539e-01   -3.055005541064546e-01   -3.296339108276621e-01   +2.150783034499268e-02   -1.159700192776704e-01   -4.439974075382284e-02   -2.497784986517787e-02   +2.030920247538009e-01   -4.860272711711077e-01   -2.505253295304131e-01   -2.277211497494101e-01   +3.343853527448801e-02   -4.836208147132651e-01; +2.223815348981459e-01   -6.942547291673935e-03   +1.793123702714546e-01   -1.086796770059869e-01   -1.557361787394753e-01   +1.091894526219754e-01   +9.215472456179952e-02   +1.229277406110574e-01   -7.867495807100311e-02   +8.202333137700725e-02   +3.291432966028492e-02   -1.170918438692561e-01   +2.354053464992933e-01   +1.734205525924038e-01   +1.368692773133693e-01   -1.227492783741922e-01; -4.579731076216130e-02   +1.631481593933239e-01   -1.012920490078446e-02   -3.246727679238375e-01   -1.693971572352657e-01   +5.898681589672787e-02   +2.729160289292079e-01   -4.054353036817324e-02   -2.176523952212691e-01   -4.323792173733715e-01   -2.559335208451766e-01   +1.469132664762311e-02   -3.654611208693496e-01   -2.422311552444942e-01   -2.366043974790404e-01   -1.336074733294512e-01; +1.704308011269796e-01   +1.890279633786107e-01   +1.288480070358589e-01   +7.253313751349652e-02   +6.058000967263606e-02   +1.290464999247314e-01   +2.342305239486087e-03   -6.554301018774106e-02   -8.243717537030182e-02   +2.246949652493760e-01   -3.642067710943606e-01   +3.799237206696324e-03   -2.518666588587154e-02   -3.633845915339377e-01   +4.444155982263535e-02   +4.821626832568234e-01; +9.696396264931316e-02   -1.977702716101374e-01   +1.471204599754087e-01   +1.375172773586059e-02   +1.351552203394548e-01   +1.327317679659273e-01   -8.486375090356494e-03   +2.127076643863297e-01   -1.346464938922601e-01   -3.134896685833253e-01   -1.141289716888836e-01   +1.727991521079121e-01   +5.177046965086176e-02   +1.929116880538149e-01   -2.772365356962314e-01   +1.663632246588418e-01; -6.391415986185917e-03   +4.302422953801670e-02   -3.916223124884721e-01   +2.662773245103094e-01   +4.470855017440591e-01   -3.326296768853355e-01   +5.873017525948769e-02   +3.290746126587094e-01   -1.771631389690816e-01   -1.507424250828679e-01   +9.954443128736959e-02   -5.884035000856130e-02   -1.165607375580882e-01   +1.384939178079277e-01   -2.792116212652685e-01   -2.094065228037493e-01; -4.719602073835469e-01   -6.166066239937409e-02   -1.559603123290082e-01   -4.845430250974793e-02   +2.781756333591855e-01   -1.554806308980497e-01   +2.915837664713053e-02   +2.659386357200506e-01   +1.388144410954956e-01   -2.076011427873207e-01   +1.965124745558857e-01   +1.632729913342263e-01   +6.840792489689171e-02   +8.404730552330529e-02   -2.968763669515510e-01   -2.711964148248850e-01; +1.241301850015579e-01   -3.591757833208532e-02   -3.941661144204601e-01   -1.079923260362949e-01   +2.126657367439702e-01   -1.866832287907381e-01   +2.912138180487793e-02   -3.403060623833212e-02   +9.190678451307943e-02   -2.770170287177457e-01   +7.082519493737124e-02   +7.532286098752367e-03   -1.451206046039815e-01   -1.275696729225640e-01   -2.485491181179381e-01   -2.450212643737600e-01];
L1E_L1I_iGABA_netcon = [-3.588528429164293e-01   +2.383187086973419e-01   -4.013611398063650e-01   +2.011562941957212e-02   -8.224222909395612e-02   +3.568463218134581e-02   -1.408510807309896e-01   +3.478736444535546e-02   -3.502694536739958e-02   +4.228214672326797e-02   +2.732571677242801e-02   -4.658099927048298e-01   -4.272891349522773e-03   -2.814966109950336e-01   +1.034307546264305e-01   +2.324061087863153e-01; +3.966484374810061e-02   +3.172253505339234e-02   -3.904097328661115e-01   -1.681229965500506e-01   +4.925457195858116e-02   -2.634768661663601e-01   -6.960805861577356e-02   -3.194197704805787e-01   -1.694198305906835e-01   -4.485744384826322e-01   +5.609570754919226e-02   -2.460535874472026e-01   +8.553730670626773e-02   -9.945253330484459e-02   +2.979395714682818e-01   +7.480709897198415e-02; -1.456270377164742e-01   -2.118122323601525e-02   -1.238239845881041e-02   +1.825476951372769e-01   -2.360509873611830e-01   +2.657330557415813e-01   -1.921199606138917e-02   -2.272574870105168e-01   +8.753495121655186e-02   -7.956350764130332e-02   -3.475433846674014e-01   +4.329634207112479e-02   -7.430160811158898e-02   +2.276776735220983e-01   -3.346760206214361e-01   -5.159928236088905e-02; -1.543789084156620e-01   -2.519769806665768e-01   +9.953999889489798e-02   -3.031218165996986e-01   +1.543944284860126e-01   -3.390160161609490e-02   -6.571402275784938e-01   -2.215056008753952e-01   -7.610334773605253e-03   -5.401748679208354e-03   -2.350896858079628e-01   +1.558087485070164e-03   -1.403306637014529e-02   -2.637903471377639e-01   -5.117921398554520e-03   -6.941029359206116e-02; +2.393589125589399e-01   -2.601528222260133e-02   -2.743562752813576e-01   -9.980548394865234e-02   +9.119393797277883e-02   +1.455732228966582e-01   +3.153661353279908e-01   -3.114002345760378e-01   -2.459382422400254e-01   +2.633786631092120e-01   +2.526800667913760e-01   +1.309454131239230e-01   -5.935651829880259e-02   -6.950914064138898e-02   +2.545991406634264e-01   +1.639826029309895e-02; +8.656550656281696e-02   +2.146420911280560e-01   -1.210597092195301e-03   +2.429007028607467e-03   +2.105683639048291e-01   -9.272666098970786e-02   -2.747001556281553e-01   -3.677403435266391e-01   +2.882802707141452e-01   +2.926417565571420e-01   +1.871802210258243e-01   +4.296464481687973e-02   +3.567977619477333e-01   +2.435512486302251e-01   +5.790732054468001e-01   +9.997066950046624e-02; +1.307385832321374e-01   +2.454169694017358e-01   +6.692575830240746e-02   -4.407879550748428e-01   +3.830862840025744e-02   +3.543485822719475e-01   +7.653041448296805e-02   -2.589542036178760e-02   -2.756082011508558e-02   -1.294776550250379e-01   +2.995742997906939e-01   -1.863578962785729e-01   +3.756934942960274e-02   +1.399985686715238e-01   -2.559616043832118e-01   +3.635869176450039e-01; +2.173828922061376e-01   -1.311281553167989e-01   +1.859244657211474e-01   +2.214222724070488e-01   +1.528523397156713e-01   +5.070577985559273e-01   -2.876128030069507e-01   -1.051862637144224e-02   -2.598145001920273e-01   -3.081920877453536e-01   -5.751802159669977e-02   +4.055514767043361e-02   -2.670151182095086e-02   -2.170850870240700e-01   +1.027770888178614e-01   +3.395549256692893e-01; +3.838366880437272e-01   -8.569446057813618e-02   -9.528271238465220e-02   +1.293516536890108e-01   +5.858548133904073e-03   +4.280620123230543e-02   -1.607125028361889e-01   +6.645640345072447e-02   +3.253965947852787e-01   -9.563719521211818e-02   +6.766999289214903e-02   +1.916980867793831e-01   +1.362886687442199e-01   +1.798253802892918e-03   +3.366730803505338e-02   +9.081332261886299e-02; -6.669655714708868e-02   -4.527336923039767e-02   -2.899242494027207e-01   +2.110330882702438e-01   -3.534699006472765e-01   +5.955448074155520e-02   -3.698452367508431e-01   -2.196701718020961e-01   +2.061758000404700e-01   +3.320396288137162e-02   -2.293923681426303e-01   +2.404386083294374e-01   +1.063326217626623e-01   -4.725487053054912e-02   +3.035327940615872e-01   -2.211957884213035e-01; -5.450874778724423e-02   -9.036852310653548e-02   +3.888919834814429e-01   -3.164344161486226e-01   -1.994484299368376e-01   -2.282942418750387e-01   +6.026292386132888e-02   -3.966131732896203e-02   +9.534645757399984e-02   +2.189749262095546e-01   -5.831868895930695e-02   +8.621168935610804e-02   +1.551762576536816e-01   +6.621160456354616e-02   -8.436993506340812e-02   +5.180135473302355e-02; +6.699516024783321e-02   -1.380161151111401e-01   -3.636375713535598e-01   +1.172520956217685e-01   -4.515792852580133e-01   -1.365378320886448e-01   -7.555911225009945e-02   +1.962660430784654e-01   -1.557606902912902e-01   +1.442363239859552e-01   -2.993922506306465e-02   +2.295531588471247e-01   +1.472461539464622e-01   -1.449977857380568e-01   -2.452887574174956e-01   +2.210494268707669e-01; +2.486413338396151e-01   -3.429307316974523e-01   -1.164040032144242e-01   -3.612678745090608e-03   -6.284180882650853e-02   +1.769762574305354e-01   +2.574985326390221e-01   -8.550801028362814e-02   -1.140670936072243e-01   +5.776534374148912e-02   -9.813369497412648e-03   -3.553571908511084e-01   -2.434998314026496e-01   -1.300287212560556e-01   -1.101431696120351e-01   +1.923814117497582e-01; -1.227929461708300e-01   +1.196546846745211e-01   -2.280976082260362e-01   +2.061867312191953e-02   +3.651669577489399e-02   -1.838116301782435e-01   -3.230425851101617e-01   -4.064989474850368e-01   +4.269672221538581e-01   -3.346207317950512e-01   +2.045832809748278e-01   -8.627827754405840e-02   +9.345158422111036e-02   +1.944610400426365e-01   +1.161102932506050e-01   -4.554119557118695e-02; -1.661835081906274e-01   -3.333685650083402e-01   +5.576355042224418e-02   +2.801443569484641e-03   +1.288887258856852e-01   +7.784927149310793e-02   +1.407830510290225e-01   +1.942915827338118e-01   -3.920379897953387e-02   +3.225199868068536e-01   -2.639039347860491e-01   -1.009904637678917e-01   -3.251145576228340e-01   -1.192818839473569e-01   -5.596387112590526e-02   +2.339634293217580e-01; -1.657070464833378e-01   -3.488150709800740e-02   -1.435482353036836e-02   -1.341556012406677e-01   +4.082236779499583e-02   -3.695790486109723e-01   +5.811205296379245e-02   +5.111685599153293e-02   +1.783356675857123e-01   -4.740056431469683e-01   -9.054088490850745e-02   +1.886052327112352e-01   +3.985154786127121e-01   +1.566171687355242e-01   +3.928886994417130e-01   -2.377639336225099e-02];
L2I_L1I_iGABA_netcon = [-2.469506043472828e-01   -3.927575411248973e-01   +3.919011119622169e-01   +8.080346258498525e-02   -1.092264296726859e-01   +4.599683406958034e-01   -2.831395637414770e-01   -6.648105961101423e-02; +7.620208598362456e-02   +1.908737950354786e-01   +1.139178706318562e-01   -4.058053800143855e-01   -7.413381211557014e-02   -1.636701708485120e-01   +3.375456524279547e-03   -1.739021554468705e-01; +1.410981112726874e-02   -1.980903508437395e-01   -1.198222716429736e-01   -1.727333133521110e-02   +2.330593940313884e-01   -4.169500684472895e-02   +1.721695883563079e-01   -1.178716108202653e-01; +2.358444619696518e-02   -5.411153968791862e-02   +1.836277721923939e-01   +2.016617884247303e-01   +8.576302025849117e-02   -2.692674101648512e-02   -1.269505077499382e-01   +1.629646448614024e-01; +2.132487784274456e-01   -3.541875255357327e-01   +1.541888192877320e-01   -1.574548948624046e-01   +1.901037343748168e-01   -2.182328500533836e-01   -7.916013391800480e-02   +1.180807857521940e-01; -2.925253486865912e-01   +3.281478248425456e-01   -1.419475128269772e-01   -3.258530334647596e-01   +1.120164339367361e-01   +2.044763846069528e-02   -2.064385035610597e-01   -1.786467771027505e-02; -4.963630660356388e-02   +6.717789143625143e-02   +7.243334558743997e-02   -9.925408981919889e-02   -8.772433343506243e-02   +3.190377038840304e-01   -9.445806850576664e-02   -1.575725145768982e-01; -4.005580217780007e-01   +3.372680290951902e-01   -3.051728315142879e-01   +6.955879930407699e-02   +9.127714795959149e-02   +5.044097462938304e-01   -3.842098249565355e-02   +1.857901571578099e-01; -1.796108345046035e-01   -1.876970774737030e-01   +7.720697432699272e-02   -3.035386827193687e-01   -2.876586289466822e-02   -1.091612778075704e-01   -3.066831351614843e-02   +1.435217953591775e-01; -2.321818178054655e-01   +2.151962715782412e-01   +1.134324487480244e-01   +3.615483056817070e-01   -2.941233479489812e-02   -1.797490925664646e-01   -4.408834385817696e-01   -1.582758813131285e-01; -1.638697391102104e-02   -3.852840286924643e-01   -3.515733664596982e-02   +5.724620730710692e-01   +2.752172857191294e-01   +2.346024872136253e-01   +8.326447766033584e-03   +2.536811795735889e-01; -1.048718422397101e-01   -1.688933080404359e-01   +4.252233451491198e-02   +1.395583202760229e-01   +2.792100797888385e-01   -1.141738228807702e-01   -6.321900507004097e-02   -3.707989415661382e-02; +1.884093632578674e-01   +2.788040528984719e-01   -8.311313827070876e-02   +1.230105705687441e-01   +1.348259726788134e-01   +1.758149463683797e-01   -3.578163771925191e-01   -2.141055392423512e-01; -1.872047337884324e-01   +2.881635983039443e-02   +5.119736067505345e-02   -9.285445133417823e-02   +3.228463183693167e-02   +3.367177813282500e-01   +1.265950156722040e-01   +3.112896509020595e-01; +2.923134943007715e-01   +8.283784516676490e-02   +1.960009315512653e-01   -3.880154620413716e-01   -3.294381936158386e-02   -2.760331103994187e-01   +2.324927781511005e-02   +4.430877166736130e-02; +2.724709541729272e-01   +1.036965338929830e-01   +1.607688971834162e-01   -1.553095478531319e-01   -2.864143746920519e-01   +1.449899479613942e-01   -2.339960302772627e-01   +3.771112576049296e-02];
L1I_L2I_iGABA_netcon = [+2.775824231485574e-01   -1.301602129725945e-01   -4.503632128712798e-02   +1.373906146409830e-01   -2.769430812829274e-01   +1.146770154352193e-01   +3.188012881798420e-01   -5.214821621926348e-02   +3.087784473840196e-01   -7.652373884090494e-02   -2.091328292961173e-02   +1.785951805572469e-01   +1.655545052092265e-01   +3.115759890966341e-02   +1.392819911634860e-01   -4.142074854950174e-01; -3.775738028167557e-01   +1.178908102629877e-01   +1.027650471135853e-01   -1.458984882276101e-01   -1.770517975933145e-02   -1.927136664260122e-01   -3.933542658259432e-01   -1.418121781289776e-01   +2.534385983080276e-01   -1.305792408339816e-01   -3.957674303319264e-01   +3.330122395416081e-01   -1.855353372742650e-01   +3.961840440454258e-01   -5.481849385173478e-02   +2.181875966322279e-01; -2.286482234988805e-01   -1.931789250832399e-01   +3.205893647897490e-01   +1.198616014104407e-01   -2.879905059980533e-01   -7.949284273217069e-02   +4.281225660097023e-01   -1.418554190554412e-01   -1.956950674277431e-01   -3.726942379059406e-02   +1.053708353584312e-02   +1.666277491198536e-01   -1.000291872949652e-01   +2.115754107398044e-01   +1.031937153157664e-01   +4.399236205454097e-01; -3.835591477329610e-02   +5.542748824725274e-03   -3.136305785393746e-02   +9.235747692614038e-02   -1.506762739967268e-01   -4.814418891323687e-01   +7.502896766231776e-02   +8.744742003114601e-02   -1.751310458933719e-01   +2.334546555970208e-01   -1.724497967998551e-01   +2.717913003261065e-01   +2.861643232524871e-02   +2.628481101894660e-01   +1.153547302855169e-01   +3.599103721351592e-01; +3.346408984090801e-01   -1.341251688132244e-01   +7.569892470479479e-02   -3.604284097503773e-01   +3.096266862940322e-01   +2.824503218472798e-01   +1.933789456049625e-01   +4.939291294122593e-02   -2.806580619931288e-01   +3.337940050978251e-01   -2.248056024816456e-01   +1.165175675770625e-01   +1.567489824882481e-01   +2.689353746404738e-01   +2.056977781323993e-03   -3.548702823776325e-01; -1.483979757096658e-01   +3.238379412227559e-01   +1.738313850418604e-01   -8.337579778799686e-02   -8.230080241039166e-02   +1.119017925593352e-01   +2.191563480827544e-01   -1.189009267652955e-01   -1.987365941300490e-01   +1.384232273475020e-01   +2.838070214354682e-02   -5.650683335002016e-04   +1.581222424201619e-01   +2.091756157177524e-01   +1.193602774874017e-01   -1.241182215499932e-01; -2.632973578383203e-01   +3.702171325390303e-01   +1.379137915823841e-01   +2.501509867015430e-01   -3.331618318588366e-01   -7.066855855079716e-02   -2.132985857782511e-02   +1.814898806949827e-01   +1.509963419547248e-01   -3.226544274391854e-02   -5.033509120819857e-02   +1.264124163904450e-01   -3.428760863556533e-01   -3.555305403354833e-01   +8.944920172297321e-03   +3.417618408352858e-01; -3.973641565221402e-01   -2.282338893650019e-01   -4.013358682108120e-02   -3.341593384661132e-01   -2.078425646548179e-01   -2.687834229362500e-01   -1.911273096400380e-01   +3.270597266796432e-01   -5.094773140638662e-02   -1.911011476593002e-01   -3.283840458343621e-01   +4.572393846287686e-01   -2.248683390761148e-01   +2.607511458246076e-02   +2.988180712522799e-02   +1.288108004959905e-01];
L2E_L1E_iAMPA_netcon = [-6.703464122712578e-02   +4.514137455300277e-01   +1.291515987557752e-01   -1.702309590151948e-01   +7.420581202462684e-02   -1.349598026118201e-01   -9.199041522247295e-02   -7.341217042787615e-02; -1.294976771864472e-01   -1.525017020607898e-02   -3.952260593228595e-01   -5.433059705659651e-02   -2.992824742693714e-02   +5.133961895381903e-02   -5.709202589875609e-02   -1.921285410949921e-01; -4.151869473396912e-01   +1.809626996725653e-01   +5.137039708971931e-01   +2.219607293024264e-01   +2.553680358090156e-01   -9.444271562095599e-02   -1.580988305825947e-01   +1.765917091914221e-01; -2.034536668144580e-01   -1.925388683190508e-01   -1.401851136816835e-01   -2.705134745579819e-01   +3.341630823990260e-01   -2.945495098684013e-01   +5.721392977712256e-02   +3.299125176686931e-01; -1.427311595213145e-01   -5.840748024575097e-02   +5.566031833266304e-02   -1.271626046539558e-01   -1.619689879418332e-01   -1.530850337877695e-01   +3.264129556228997e-02   +5.610184681994668e-02; +7.220690064781494e-02   +4.588395801433228e-01   +7.160449317412743e-02   +2.201571073451634e-01   -6.447233694654075e-02   -8.353578582940274e-02   -1.494359921993509e-01   +1.366957678308005e-01; +2.298498154659041e-01   +1.409556362558798e-01   -1.836335179452954e-01   +4.407998948226013e-01   +4.307062672846607e-02   +6.914465984811262e-02   -1.517557861294884e-01   +4.599445044644759e-02; +2.062622908868423e-02   +1.268203191280736e-01   -1.015997492001653e-01   +2.901682316637227e-01   +4.397020836456897e-01   +9.542624734449251e-02   -4.529234595627477e-02   +1.473447516271070e-01; +2.445606810822868e-01   -3.929306933942520e-02   +2.082405202228055e-01   +3.337784003286493e-02   +8.041292889709260e-02   +5.582612705765772e-02   +2.214090914162100e-01   -5.324858230368659e-01; +1.272121586909847e-01   +1.181343031606601e-01   +3.218281264348222e-02   -1.726953676381229e-01   -1.242898075218961e-02   -7.036789994521755e-02   +3.525621001786151e-01   -1.855533536885245e-01; +1.942645717950593e-01   +1.626330303863361e-02   +7.915563968020783e-02   -7.658341854643833e-02   -1.094515466427681e-01   +3.714996302434881e-01   +1.057471391867061e-01   -1.648285900886227e-01; -3.059593441700315e-02   -1.999881139783448e-01   -2.126208437077844e-01   -2.604157230529882e-01   -4.244105832677059e-01   -2.076920627395417e-01   -1.804467690943710e-01   -1.716483518491865e-01; +1.926373085210592e-01   -4.288066491758601e-01   +6.765128908224720e-02   +1.478404568623244e-01   +2.201368446618363e-01   -1.568874646335555e-01   -3.822535307262194e-01   -3.927632639234251e-02; +6.680818063965696e-02   +8.370026048740299e-02   -3.394924318995886e-01   -1.931263084594132e-01   -2.986729202598039e-02   -3.386821322808437e-01   -2.655948598070170e-01   -2.493914192145413e-02; -1.566723678090789e-01   +1.504480446360443e-01   +2.310132770853037e-01   +6.592780623639710e-02   +2.614897459329754e-01   -1.104779276262337e-01   +2.330646595295395e-01   -2.845979675601094e-03; -5.383946324251337e-02   +2.656875658116940e-02   +5.299363851966118e-02   -2.611094470696563e-01   -1.610575666882225e-01   +3.873582789319764e-01   +2.074012807608397e-01   -1.713435642042984e-01];
L1E_L2E_iAMPA_netcon = [+1.150416579806119e-01   -1.690707997813199e-01   -7.927141490299351e-02   -1.733909637709612e-01   -3.346752525402727e-02   +2.106748180655749e-02   -1.860818374985970e-02   -5.367350908116074e-02   -3.030854185510735e-01   -4.261987721708438e-02   +1.042032831249031e-01   -6.737500389638883e-02   -1.328857377129514e-01   +1.647610161675912e-01   -2.339087414084340e-01   +3.685546831162832e-01; -1.331598582929768e-01   +1.189098935671977e-01   -1.691540996680911e-01   +4.585744524129783e-02   +1.357282680546440e-02   -5.142192145928678e-02   +2.139284620307766e-01   +3.073358485440058e-01   -4.394442524961313e-01   +1.310073630535740e-01   -1.875053302043675e-01   -1.700293264806789e-01   -7.480856310531497e-02   -3.670222094510012e-01   -2.487950980488894e-02   +3.266200310611504e-02; -5.342907258133348e-02   +2.699894309102877e-03   -4.903375882968548e-02   -1.597097051477809e-01   +2.329906865312955e-01   +2.324431030468347e-01   -2.100605707353488e-01   +4.738024329865764e-02   +3.438263251873463e-01   +6.188031106363844e-02   -4.514080973517787e-02   +2.897977811148512e-01   -3.189890605905855e-01   +8.851684606639321e-03   +1.755247200623122e-02   -1.162746517703114e-01; +7.957754757525387e-02   +2.052211480848400e-01   -2.379255109278983e-01   +5.096115856756150e-02   -1.188712552200162e-01   +1.161726310842899e-01   -2.101526971097127e-01   +2.189204168359435e-01   +5.654331560021176e-02   +5.606760131400550e-02   +3.243430659510461e-02   -1.592499105553760e-01   +1.768570343731453e-02   -1.050378237300978e-01   -3.130947657160307e-01   +2.191691038782872e-01; -3.160919270105168e-01   -2.767684907980461e-01   +7.643051036966075e-02   +3.080141459256502e-02   -1.875355966307040e-01   -5.864816663181092e-02   -1.723327858675277e-01   -2.043959060624484e-02   +7.493076297994224e-02   -7.590105421969902e-02   -2.280457406641017e-01   -3.029832264046138e-01   +3.455580377872489e-01   -1.535614831297478e-01   +3.508509192843136e-01   +2.841119759295753e-01; -3.214865677038017e-01   +8.818197092127335e-02   +2.682297229948601e-01   -2.918332454346885e-01   +1.156154829722216e-01   -8.778462654939465e-02   -1.139014164667822e-01   -1.156555126022034e-01   +9.780627083449446e-02   +5.834369264087512e-02   +8.035991970443822e-03   +1.748638215454433e-02   -9.819971810971269e-02   +1.687140724154606e-01   +1.677392199819101e-02   +4.770143343728347e-02; -1.223624722544439e-01   +8.683255413568361e-03   +1.650312594751986e-01   -2.820414054046689e-01   +5.366530144260230e-02   +3.193233770747846e-01   -3.837217511747421e-01   +3.594054788527781e-01   +4.743368616271863e-02   +2.106820689305669e-01   +1.991671522366058e-01   +1.374000295373450e-01   -3.390646331392808e-02   +1.290333669590509e-01   -4.071525423361358e-02   -7.372665493992116e-02; -4.655292780956653e-02   +3.437215554289350e-02   +1.602702158189383e-01   +1.463100268338013e-01   +1.820342188941964e-01   +2.769106824127089e-01   +1.450574331566821e-01   +2.075198471234417e-01   +9.508986274750821e-02   +5.681996277213594e-03   +7.084395658499471e-02   -5.899414467940606e-02   -2.975921176635760e-01   -1.500981098405728e-01   +1.220843052469821e-01   +1.400915960220088e-01];
L2I_L2E_iAMPA_netcon = [+1.939410343913443e-01   +2.547340174980591e-01   +1.960783215904604e-01   +5.042066466489703e-02   -2.062379426121256e-01   -3.385538025554830e-02   +1.312891282493928e-01   -1.792888301783649e-01; +1.390957108897568e-01   -1.330326445160480e-01   -2.976028049797759e-01   -9.364572384423671e-02   -7.595861759833608e-03   +2.437957951065315e-01   +2.908587679538208e-01   -1.025990313396914e-01; +8.956522048194285e-02   +1.571539468206654e-01   -1.155491139352316e-01   +3.331992545801436e-01   -3.950845508401981e-01   +4.702320538650908e-01   +4.291146889353657e-01   +1.637854796065844e-01; -1.836437977331847e-01   +1.998755855219563e-01   +2.596348247062262e-01   -2.624299835274609e-01   -2.491970095290267e-01   +2.175146933913396e-01   +3.830319138400257e-01   +1.000925916378322e-02; +8.937398409992854e-02   +2.074990463889517e-01   -7.637761146950847e-02   +2.121247137331412e-01   -1.648747876485837e-01   -3.107159122387774e-01   +4.546399835679563e-02   +2.335989894980255e-02; -1.261361033724916e-02   +2.885862086759633e-01   -4.198902610927535e-02   +6.628962531380114e-02   -1.629134901628049e-01   +3.709466884405369e-02   +2.038618885949502e-01   -4.329278100110347e-02; -1.304168770797002e-01   +3.071220389474500e-01   +2.134058781494712e-01   -1.764870665649134e-02   +2.499233682562995e-01   -1.154509674310385e-01   -2.194369047499144e-01   -1.410778883204553e-01; +1.854305128332164e-01   +2.933150088898118e-01   +1.580882220503629e-01   -5.362282161991823e-01   -3.834546104472055e-01   +3.514583775294471e-01   -4.987609464449600e-02   -1.523677461582672e-02];
L2E_L2I_iGABA_netcon = [+3.079239035069984e-01   -1.203980598919959e-01   -1.149667226172018e-01   +3.545533150836190e-02   +8.671542616200709e-02   +1.602945224367134e-01   -1.485272392222686e-01   -2.519515234245532e-01; -3.232689577003298e-01   +4.010353878657602e-01   -2.171032192543312e-01   +1.959916851500689e-01   -2.733981824055554e-02   +1.207316832767638e-01   -3.059908203484014e-01   +3.610686034076714e-01; +1.966175817509136e-01   +1.631048527762181e-01   -1.068954992376587e-01   -5.212845408303862e-02   +1.588855824461400e-01   -1.950502936566901e-01   +1.123764976540622e-01   +2.740074556182455e-01; +1.888230310692886e-01   -1.337231055513195e-02   +2.545969537773394e-01   -1.497063427216724e-01   -2.112612985538809e-01   +1.531615210466404e-01   +2.911320467953223e-01   +7.649724251374945e-02; -1.419579669822799e-01   -2.529443008823379e-03   +1.216229648548678e-01   +6.239813101817637e-02   -2.333224992874531e-01   -9.577903691204138e-02   +2.232478455962777e-01   +2.572856910213486e-01; -7.841113032136193e-02   -8.888976483892402e-02   +3.161220416490609e-01   -1.474838709473490e-01   -7.679200429073926e-02   +4.320730898991147e-01   +1.005776137598793e-01   -1.174231707911740e-01; -1.813230242107235e-01   +2.293859626003031e-01   -2.956460837599297e-01   +2.828057033640108e-01   -2.656520951504291e-02   +2.019216626548473e-01   -1.301060714484689e-01   +4.128087044324648e-01; +1.343454727703263e-01   +1.081382058931439e-01   +3.206518819033265e-02   -1.064263911267814e-01   +1.558682141023585e-01   -1.083554269744513e-01   -1.370075401233931e-01   +2.577841303086176e-01];
L3E_L2E_iAMPA_netcon = [-1.186982641848344e-01   -3.246156889297922e-01   +3.257225396226215e-02   -1.172200097247156e-01   +2.286367540856028e-01   -1.602134335148940e-01   +7.250741357068859e-04   -3.391884671857899e-01   -1.673931628954897e-01   +1.006735856386134e-01   -1.200804749708245e-01   -1.908521860545309e-01; -2.504889730229909e-02   -3.650873416752848e-01   -2.347659748959085e-01   +7.805118690278885e-02   +4.175359679977132e-02   +8.656748058260491e-02   -2.506318262411271e-02   +6.942453974858724e-02   +2.551408389362311e-02   +1.147736652524873e-01   +5.586316547237798e-03   -1.032427448208836e-01; +2.670794505845733e-01   +2.486124642877628e-01   -2.082266391815774e-01   +1.428189930929900e-01   -4.288436699993952e-01   -5.967439045242345e-02   +2.195554400958367e-02   -1.762130460622582e-01   -2.659145299284350e-02   -4.675062810559131e-01   +4.116809343492919e-02   -8.687469686632879e-03; +1.152855746451997e-01   +4.307509066699451e-01   +1.202834157560728e-03   -1.025982841563695e-01   +3.609291837157816e-01   -2.787899215467931e-01   +2.108862829557269e-01   +1.991653984156913e-02   -3.123433809103248e-01   -1.049757748147497e-01   +9.257852615627717e-02   +5.650055256255249e-02; +3.411911283488885e-02   +1.084708864652561e-01   -2.460292090857094e-01   +1.790786716290632e-01   +3.409412400818007e-01   +1.511138532710509e-01   +3.647318060048302e-01   +1.122306814309499e-01   -9.941377918547600e-03   +7.954312151111662e-02   -1.604268271162033e-01   +1.709727791314881e-01; -2.667625867740449e-01   +2.437197827840211e-01   -3.292902787718371e-02   +3.761089322371787e-01   -2.104462508830376e-01   +4.171097875075581e-02   +3.958503530162870e-01   +2.014218264853405e-01   +1.359183716044553e-02   +1.887752530547884e-01   -7.506421435438224e-02   +1.430199429767727e-01; +7.204490704260763e-02   +1.716962132074299e-01   +8.458596363767293e-02   -1.474586258814381e-01   +5.192014961871178e-02   -1.359254306472328e-01   -9.663052661115895e-02   -8.240190334490968e-02   -8.196603130983118e-02   +9.461470488160198e-02   -5.068260188301664e-01   -1.602297956434147e-01; -4.057263388198728e-01   -2.262187439797669e-02   -2.401093946000065e-01   -2.959215506812555e-01   -2.900440694372575e-02   +8.335543741335376e-02   +1.734202342037731e-01   +9.743814013788672e-02   -2.531554376667320e-01   -3.370826592075753e-01   +7.315268420996848e-02   -2.395888943237634e-02];
L3I_L2I_iGABA_netcon = [+7.453317070438931e-02   -2.381134680948987e-01   -8.393758132021902e-02   -1.940840946787480e-01   +2.927237666757155e-01   +9.809042907929097e-02   +2.828400455661184e-01   -2.450776737932582e-01   +8.782484799852480e-02   -2.077459121065666e-01   +3.036026847436430e-01   +3.625219746128773e-01; +1.603953614624882e-01   -7.706417832361499e-02   -1.558106499593567e-01   -4.620540562374451e-01   +1.489507289695864e-01   +4.375388597572565e-01   +1.266529027416808e-02   -1.402647096731542e-01   +4.093405496972529e-01   +2.181404381295225e-01   +8.456549768586673e-02   +9.847406798657272e-03; +1.956329416692446e-02   -3.734067241652581e-02   +3.371077322919943e-01   +5.572973471999676e-02   +1.304813689711809e-02   -1.699394071368533e-01   +2.946851063850771e-01   -2.926117635230585e-01   -1.809662614306091e-01   -2.525163321164625e-02   +3.221719904950238e-02   -1.373660266349093e-01; +3.227975543415139e-01   -1.657808890512822e-01   +2.241768933693871e-01   -1.691956542704768e-01   +1.243925804152261e-01   +1.654590395238159e-01   -5.834302658187936e-02   -8.996736118316150e-02   +1.374067098892782e-01   -7.643833592320640e-03   +2.424879444850629e-01   -4.415570092168383e-01; -8.660719855373118e-02   -4.277716341655533e-01   +5.174243335713951e-03   +2.058905884963322e-03   +1.495183094035682e-02   -8.510929545751736e-02   +1.833673989422360e-01   +1.903319206671212e-01   +3.146531000458507e-01   -4.767174707675327e-02   -1.926772111876180e-01   +1.858014077199639e-01; +8.079846118050782e-02   -1.350731282370627e-01   -5.869077593182091e-02   +2.811008351429856e-02   +1.103872541331098e-01   -5.383501154113140e-02   +2.229201412998635e-01   -1.214531638026463e-01   -3.384163582666578e-02   +1.532026934604820e-01   -1.650640863438156e-01   -3.639693719998493e-01; -9.415384130125461e-03   +5.789936282162338e-02   -5.784612908539105e-02   +2.489591363657857e-01   -3.444486195375137e-01   -2.137301921114570e-01   -3.053573777628038e-02   +3.782774310470607e-01   +3.237307994083244e-01   +1.286855251267154e-01   -2.564608405377364e-02   +7.895225994227897e-02; +3.547411612150655e-01   -3.666182581744667e-02   +2.103258092638521e-01   -2.648320715187382e-01   +1.239864931298167e-01   -2.485555728615343e-01   -1.736315186521528e-01   +2.089304938606878e-01   -4.199000673176936e-02   -9.341326181965680e-02   -2.912489293661186e-01   -2.768899196265683e-01];
L2E_L3E_iAMPA_netcon = [+6.338862764947190e-02   -2.458682578846997e-01   -3.520485670328199e-01   -2.679446685782206e-01   +1.677567069451633e-01   +3.755700113998148e-01   -2.849427845086357e-01   +3.194635071648461e-02; -4.259125537844976e-02   +1.692141276577738e-01   +1.441923291235901e-02   +3.016327234605476e-01   +1.901349772183093e-01   -1.470416163902657e-01   -1.228900341646270e-01   +2.599396947232814e-01; +2.230849619853928e-01   -3.299380741125399e-02   +1.526535004333632e-01   +1.484110673080019e-01   -1.509991420448608e-01   +2.154521137582243e-01   +1.273784059629846e-02   -3.096409506434171e-01; -2.329812484769433e-02   -7.799927452797367e-02   -1.296259738550428e-01   +8.566983356979145e-02   +1.053723587002861e-01   -1.926999253821101e-01   +7.647907158980355e-02   -1.400927964171988e-01; +5.299932192156023e-02   +3.571146949912042e-01   +9.481843279978594e-02   -4.791004107400241e-01   +1.921960623068489e-02   +1.115078912596823e-03   +3.491317284137878e-01   -1.414699727052634e-02; +3.012136893730146e-01   +1.187540048205499e-02   +2.273051407319780e-01   -2.323041881923092e-01   -1.418878456007237e-01   +3.000419226161467e-01   +2.579621399747998e-01   -2.908349229825390e-01; +1.587310473235294e-02   +1.494973512374878e-01   -2.414364541966092e-01   +2.259818376527051e-01   -5.286126527970666e-02   +1.566384247485030e-01   -2.326432813021368e-01   +2.687437058206193e-01; +6.948312860945502e-02   +4.410843126704803e-02   -2.721832301815379e-01   +9.204465815519058e-02   +2.345998938923105e-01   +1.393478976656071e-01   -3.926492132725266e-02   -1.057576944505721e-01; +4.561236505823173e-02   +3.779508271392760e-01   +3.289638792756753e-01   -2.547166744709286e-01   +7.124837469124941e-02   +3.870933143384950e-01   +1.291993919922232e-01   +2.859659760057306e-02; +2.599982770110238e-01   -2.413248449671656e-01   +1.442772440452200e-01   +3.365120074582185e-02   -8.966854960598369e-02   +1.073542036090212e-01   +7.111362285298739e-02   +1.848164565876576e-01; +2.813255828003209e-01   -1.070541671130797e-01   -9.355136073210628e-02   +8.842676199365938e-02   +1.519330471805457e-01   +1.105192409619228e-01   +2.335974559787715e-01   +9.745715304304861e-03; -9.265668442283455e-02   -1.237818739591558e-01   +3.031983060536734e-01   -2.967983596052013e-01   +3.496587198987899e-01   +1.026920014091318e-01   -2.151879165862827e-01   -2.775637440408251e-01];
L2I_L3I_iGABA_netcon = [-1.998218932394610e-01   -6.885696582055079e-02   -2.446597400785868e-01   +1.875941662715063e-01   -1.769099208785076e-01   +1.436733198012784e-01   +1.798188979040649e-02   -4.768839389751894e-02; -2.609402506253334e-01   +1.019223147243484e-01   -1.770831674913572e-01   -3.545885699744343e-01   +1.684187360518143e-01   -9.009364923078153e-02   -9.586872993047429e-02   -5.917977011630546e-02; +2.838160286865546e-01   -3.529100867555474e-01   -4.953980358019845e-02   +3.474927378978677e-01   -2.473541670490994e-01   -6.007329217341303e-02   -2.108470777773426e-01   +1.582559637660326e-02; +3.454628589739563e-02   +1.684389627112459e-01   -1.170356737620444e-01   -1.536932605441896e-01   +1.619951563625268e-01   -2.245644817549224e-01   +9.287989918792189e-02   -2.357415804877694e-03; +2.815957503548066e-01   +1.745177491990191e-01   -2.494244540474010e-01   +1.962858916683036e-02   +2.498885494869219e-01   +1.253180830017971e-01   +4.601717665056303e-01   -2.003018697344820e-01; -2.777389076698765e-01   +4.466244922473525e-02   +2.439262925256280e-01   -5.616363091235062e-02   +1.371884896463005e-01   +2.253902142511243e-01   +5.187039669350677e-03   +1.253379075775550e-01; +2.170986944994448e-01   +6.102173747357406e-02   -1.889258597539807e-01   -9.849653901165056e-02   -2.004500042695083e-01   -9.877633594695681e-02   +2.427386121552625e-01   +2.964785607968260e-02; -1.809789460268081e-02   -2.956235840738415e-01   +8.467024675527195e-02   -2.627076739231887e-01   +1.653353431358567e-01   +3.176824665399982e-01   +2.384893066692371e-01   -3.197848888185920e-02; -6.976486053270275e-02   +5.073090635685092e-01   +4.429481518372211e-01   +2.041289274846032e-01   -5.250681242557881e-02   +8.041487589169449e-02   +2.598899694479114e-01   -1.311515816882399e-01; -9.335427246856964e-02   +1.047692232629419e-01   -7.993108541207206e-02   +1.096666576707445e-01   -2.757419569039183e-01   -1.883043974685497e-01   +1.654825878515630e-01   +8.548753350678040e-02; -7.433968506354197e-02   +4.210603583719158e-01   -7.164058887272326e-03   -5.748198251088597e-02   +1.637414005725741e-01   -1.255637968889783e-01   +3.934809193648550e-01   +2.003965951993067e-02; -3.729750357065009e-02   +9.400165875388292e-02   +2.300560779378931e-02   -1.171104231058027e-02   -2.738191975005013e-01   +9.376628064333034e-02   -1.634727108314317e-01   +1.180335939029356e-01];
L3I_L3E_iAMPA_netcon = [-1.024054231981286e-01   +1.696296714824273e-01   +2.105441396845514e-01   -1.717802060934125e-01   +1.224288602661929e-01   -1.194885894585166e-01   -8.389049077909022e-03   -1.130218002343182e-02   -9.572876051223395e-02   +3.236702746682144e-01   -1.688474798076462e-01   -9.901596698082507e-02; -7.172335016999112e-03   -2.515501740807680e-01   +6.002112096325472e-02   -2.014097161085329e-01   -6.515566839155777e-02   -2.141601614328302e-01   -2.021328923664126e-01   +2.839983370448187e-01   +8.893942016718073e-02   -2.247900573096293e-01   -2.626766162863984e-01   +1.786145107981384e-01; -2.355233627873245e-01   +1.142150270627844e-01   -3.919300266302636e-01   +1.781168099105425e-01   +2.597469643528584e-01   -1.331113159843672e-01   +1.032552093784656e-02   -2.502823996904605e-01   -1.697015796947412e-01   -1.882408292172182e-02   -1.861268015233716e-01   -3.466208814240321e-02; -1.461482792666432e-01   -2.689019300651799e-02   +2.936749275514897e-02   +3.175741536581975e-01   -8.963995161454949e-03   -2.810558497151769e-01   +2.849481727125902e-02   +4.579075092612304e-02   -1.219803437042689e-02   +9.665890716897892e-02   -2.340634429746713e-01   -1.176120758346597e-01; -2.300396541427019e-01   -1.057290165312983e-01   -4.704344347607454e-01   +6.509809655256887e-02   -3.703980658432796e-01   -2.728240066262018e-01   -1.457676663041232e-01   -1.672592026994527e-01   +1.558871006593228e-01   -2.817053735759764e-01   -3.075266101561548e-01   +2.094910907801080e-01; +3.765167212511546e-01   +2.713237781176749e-01   +7.413478318775417e-03   -6.624047894783647e-02   +1.754510935579806e-01   -1.701721364848598e-01   +3.493309702786075e-02   +3.956554663281934e-01   -7.596983835732615e-02   +2.877007846356654e-02   -4.804585222921409e-02   +2.373635047294502e-01; -1.562840647378525e-01   -5.310190221581636e-02   -2.347637909026465e-01   +2.122869981732550e-01   +1.558510063714979e-01   +4.855038228728442e-02   -1.831498726273149e-01   -1.770588024279630e-01   +3.238143597561993e-01   -1.202369719581324e-01   +1.380656125390833e-01   -3.660106506678720e-02; -1.054064395504263e-01   +2.955319450513300e-02   -3.728249588731139e-01   -9.400258056841965e-02   -2.598504465561537e-01   -3.501016380180663e-02   -2.893534520736543e-01   -4.871334208608549e-02   -7.283486174283808e-02   +1.849514691570318e-01   -2.811546033340471e-01   -3.221259947658982e-01; -3.180393953929779e-01   -7.201157202376424e-02   -3.766919023024263e-02   -4.752579749784890e-01   +1.931526822720110e-01   +2.848796402634516e-01   +2.437790152664013e-01   +3.350418893470411e-02   +7.657708840689666e-03   +2.425076840851733e-01   -6.681782387248335e-04   -5.472157144727833e-02; -2.978113499074914e-01   +2.377018219226201e-01   -2.318480299670951e-01   -3.232699888072104e-01   +3.056984327906188e-01   +3.816264474705146e-01   +1.176111813908159e-01   +3.220817215507487e-01   -1.178965087971621e-01   +2.384056246249946e-01   +5.215741691914941e-03   +1.054778189773901e-01; +1.121324026604102e-01   -2.224339616683896e-01   +2.818655054306897e-02   +2.406727474483687e-02   -4.041511209633925e-01   -8.445621394157665e-02   -1.767986729824261e-01   -9.542117795541193e-02   +5.665948499383799e-02   +3.535959584871547e-01   -1.861052140971210e-01   -1.452526026793891e-01; -2.210493183730594e-01   +2.619501999457347e-01   -1.830113895232409e-01   -5.977079862895621e-02   +4.243517766756188e-01   -4.110432473859100e-01   +1.453280044561304e-01   +2.296128813461183e-01   -9.209452467973667e-03   +1.646424447895298e-01   +2.066947445163845e-02   +4.729070084225371e-01];
L3E_L3I_iGABA_netcon = [+3.632662855374343e-01   -2.268253269449469e-01   +1.667879700603184e-01   -1.610696479151381e-01   +3.829728435187292e-01   +2.007910485646775e-01   +1.175540213220623e-01   +8.872559905084215e-02   -4.704462468900860e-01   +4.981203446172739e-02   -5.043769248175588e-02   -1.554061169476273e-01; -2.163549005013061e-01   +3.501661232798340e-01   +1.476264267389976e-01   +1.230523307706805e-01   +1.425991256160501e-01   +1.392103947661975e-01   -3.699358161270427e-02   +1.568045354889701e-01   +1.800400201600866e-02   +2.585639360540795e-02   -1.079474801380749e-01   -2.777840277005364e-01; +5.581621605680576e-02   -2.651723138408869e-01   -3.426987727001474e-01   +5.506656927758297e-02   +2.613331931477927e-01   +2.056217290854477e-01   +1.357398316846475e-04   +6.469587851135625e-02   -2.012354147459183e-01   +1.057668193841176e-02   +2.614826563197693e-02   +8.166576473274986e-02; +2.994473632570590e-01   -1.102902009107913e-01   +3.266515546397581e-01   -2.918824557436817e-01   -2.567283001472035e-01   +2.439877235055629e-01   +2.589347533458553e-01   -1.250450344662413e-01   -1.676604527086382e-01   -2.384441064306838e-01   -1.040054770998590e-01   +1.041712742922612e-01; +1.585313780894005e-01   +1.600439724329055e-01   -1.711917716412270e-01   -2.525827735968058e-01   -3.272160212590096e-01   -2.786553437532466e-02   +2.290357262914955e-01   -8.031469488779236e-02   -6.686077429359541e-02   -1.678510283476774e-01   -4.725925800553552e-01   -3.278424477191748e-01; +1.373453525025145e-01   -1.687356205292397e-01   +1.578179158810695e-01   +1.984099693392352e-02   -1.477599321598016e-01   +2.023644852798947e-02   -3.218751633526901e-03   -1.453603578995083e-02   -2.157878913677849e-01   -5.060435048601517e-01   +1.166269894460707e-01   -9.097051545546643e-02; -1.659366207760488e-01   +1.234011663992836e-01   -5.620365291753060e-02   +2.925675421816825e-01   +9.784494660577114e-02   -1.075936954409329e-01   -3.267261493073487e-01   +2.864821183199944e-01   +5.104610998854990e-01   +1.133171474180592e-01   +3.931763816758078e-01   -1.429509645372248e-01; -2.309673349486393e-01   -1.958824220828826e-01   +3.341252477414324e-01   +1.663316980431952e-01   -4.286814941523592e-01   +7.676390719942024e-02   +3.695830095182975e-02   +4.997056839731964e-01   +2.795225405651987e-02   -2.026647063162062e-01   +6.360119242424439e-03   +4.787606502051778e-01; -2.816705816319920e-02   +1.924671126312829e-01   -2.420751389874916e-01   -2.091668631609557e-01   +2.669441117411557e-01   +2.133781640498262e-01   +3.033551225667861e-02   +3.164579915199039e-01   +2.922734020792829e-02   +2.966900815591010e-01   -4.340483771128711e-02   +2.123192151739450e-03; +4.463220665441894e-02   +1.195343561845975e-01   -4.723079010554716e-02   +1.311225784262891e-01   +1.355289424211134e-01   +1.521079047023408e-01   +2.751971993433172e-01   +1.704842226670089e-01   -2.397243917107593e-01   -2.816820476378359e-01   +2.879098762301417e-01   -1.555732294162108e-01; +3.631596517984874e-02   -1.570343175322266e-01   -1.614024490181823e-01   -2.186402646664831e-01   -9.534238360532650e-02   +1.470241766266013e-04   -6.425784376478114e-02   +3.258840153805791e-01   +1.273550945352233e-01   -5.160355729758431e-01   +1.721920995523398e-01   -5.795152211637422e-02; -1.093928675916538e-01   -3.671863939545151e-01   -1.550057585272140e-01   +1.720080099985427e-03   -3.398735601158931e-02   +1.631673328620085e-01   +2.085441535002962e-01   -1.243617724528536e-01   -2.542423347441523e-01   -2.248709053446477e-01   -1.264433869713827e-01   +2.572590558565533e-01];
L2E_Input1_iAMPA_netcon = [-2.425960007105617e-01   -1.519628537312724e-01   +6.088186349400129e-03   +9.468462930432911e-02   +5.066930887122814e-02   -3.378068112723184e-02   +1.678767968697617e-01   +9.948992108502140e-02];
L2I_Input2_iAMPA_netcon = [-1.079944215228940e-01   -9.344125696996805e-02   +4.048655632292025e-01   +6.868895544220555e-02   +1.884374241722659e-01   -6.445149891396351e-02   +7.006867756105836e-02   +4.575193642144383e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
