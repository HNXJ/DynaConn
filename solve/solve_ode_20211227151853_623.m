function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.173645310581966e-01   +2.800804472492398e-01   +1.272257539945124e-01   +1.763026895212780e-01   +5.544854215995195e-01   +2.605174502210043e-02   +2.368598912022145e-01   +2.566942943263849e-01   +1.032377643547568e-01   +3.684713343215198e-01   +5.563701357784263e-01   +5.058461217729177e-01   +1.775419766667679e-01   +3.712357002478808e-01   +4.560789383222652e-01   -4.486560066020195e-03; +1.614696849151469e-01   +1.962496691208125e-01   +1.637584607207290e-01   +4.281176553426242e-01   +1.807214551963836e-01   +3.793863765338866e-01   +1.723862242628115e-01   +1.243497701723915e-01   +1.908194433346657e-01   +1.737665206982227e-01   +1.804811373694100e-01   +2.601493747609242e-02   +4.584545273120308e-01   +2.041319747493924e-01   +2.335456255454652e-01   +3.632239969854719e-01; +3.463718293235198e-01   +2.531350137425484e-01   +2.324917675093475e-01   +9.137379025850678e-02   +2.102372561858299e-01   +1.184787432567659e-01   +3.976367603209298e-01   +1.617630454864029e-01   +8.574914021747745e-02   +5.495793985333856e-01   +4.355536171762213e-02   +5.263493656326478e-01   +3.342533473593060e-02   +4.096521496394733e-01   +1.922445447317075e-01   +4.285304401162258e-01; +4.745442375981651e-01   +4.745889714275462e-01   +5.333562176376312e-01   +4.607039659076672e-01   +4.075017666483771e-01   +3.049018684416471e-01   +2.484450769361195e-01   +4.589446107041992e-01   +9.535302221036693e-02   +3.806740495573956e-01   +1.195942925090331e-01   +5.945859083496423e-03   +2.764843690930570e-01   +6.784055374573958e-02   +3.972208863345479e-01   -2.037989689327853e-02; +2.141364150654225e-01   +4.031532743478467e-01   +4.719204142461106e-01   +2.875957840853338e-01   +6.389845425981935e-02   +1.406226636558494e-01   +4.993151972973980e-01   +3.342547417814394e-01   +1.150957389283327e-01   +8.983564781491532e-02   +9.481864192762812e-02   +2.138000296165889e-01   +4.103371120033716e-01   +3.212411579272296e-01   +4.199152680266611e-01   +5.204577865933155e-01; +2.409235799852344e-01   +2.509012260162352e-01   +2.746346826613406e-01   +4.949606121143753e-01   +1.524827172287348e-01   +1.511566811890889e-02   +2.963911387148188e-01   +3.244579273474369e-01   +4.491049860564833e-01   +3.140102724466191e-01   +5.031995078654292e-01   +4.404560750276130e-01   +1.684146189076925e-01   +2.811727490233595e-01   +2.393116912957143e-01   +1.887433718348338e-01; +7.412533269323884e-02   +1.548740296717457e-01   +3.558609022462513e-01   +4.349578229315287e-01   +1.436188070669671e-01   +1.234646799958316e-01   +2.860576620628331e-01   -6.246528921570134e-03   +4.633299726918259e-01   +1.805468090575260e-01   +7.576939872261011e-02   +2.501772992048172e-01   +2.402015382486349e-01   +2.471151455560241e-01   +4.051353345423265e-01   +3.251122190523933e-01; +3.903238189995591e-01   +2.288679175852617e-02   +1.148379919413073e-01   +1.192785949453754e-01   +1.403408989456253e-01   +5.437839430477815e-01   +1.937338326140508e-01   +2.475558265221167e-01   +5.006958362589880e-02   +1.190349287968085e-01   +1.910620899785345e-01   +2.985202190450737e-01   +1.985546130724500e-01   +4.035723775788946e-01   +1.261529264659972e-01   +1.352297601677387e-01; +3.157949147215249e-01   +1.253489653307620e-01   +7.637924907852529e-02   +3.085252461687193e-01   +3.950017098113332e-01   +1.599912571368807e-01   +2.314809574296992e-01   +6.574269073354726e-02   +2.617730407473052e-01   +5.291273149613526e-02   +3.773291772458472e-01   +5.777692144845641e-02   +1.442919504830711e-01   +3.175214655865400e-01   +4.028849972471689e-01   +2.490037756504529e-01; +3.095688403866260e-01   +2.239971681931544e-01   +3.053148294174844e-01   +2.294249315404226e-01   +4.502315629316002e-01   +5.321316498709184e-01   +1.264781815211077e-01   -2.648438167408143e-03   +1.975123065024038e-01   +4.324285849320213e-01   +3.163509264201149e-01   +1.116074067154175e-01   +4.854126861908663e-01   +3.532993522512728e-01   +3.899404533583889e-01   +6.216010782160523e-02; +1.562446947733681e-01   +5.878953099789984e-02   +4.220106520967387e-01   +1.151620831033445e-01   +1.739713079805302e-01   +5.258535300692035e-01   +4.135285309662759e-01   +1.290906677089345e-01   +2.108794838573615e-01   +1.508002741490022e-01   +4.544512766102006e-02   +3.193737468214928e-01   +1.455768737482098e-01   +1.215752731116784e-01   +3.445006591544393e-01   +2.032998601988215e-01; +8.667892210243715e-02   +1.933383434363196e-01   +2.698446199232027e-02   +3.558978092198957e-01   +2.312208943589026e-01   +3.069637209024622e-02   +5.493822950458321e-01   +4.751967177827296e-01   +2.451744221113752e-01   +2.589240932482669e-01   +2.403538436999683e-01   +3.711467835382360e-01   +3.699477236588509e-01   +3.761603381779571e-01   +5.382120564755877e-01   +4.731668984588016e-01; +4.522521624439489e-01   +4.925305179154831e-01   +9.034176926436158e-02   +9.819758302064639e-02   +4.195404802404726e-01   +2.836048243440096e-01   +4.572300901107222e-01   +9.545964358087990e-04   +4.647534852075978e-01   +4.651865214056463e-01   +3.802336584772508e-01   -1.209309256247846e-02   +2.680367042834952e-01   +2.631970609291147e-01   +2.367255181501114e-01   +9.810808453244278e-02; +4.322305275267340e-01   +1.498253801991672e-01   +3.811880257362688e-01   +4.601626580398306e-01   +4.273377012072200e-01   +1.129685161248432e-01   +2.169242923924179e-01   +1.895104202704691e-01   +3.251489173378588e-01   +3.477408722870652e-01   +3.746270002388364e-01   +5.341634401860081e-01   +2.783604541454576e-01   +3.672331624181195e-01   +5.453065980533675e-01   +2.858280791754222e-01; +4.210928445182299e-01   +1.358516454300660e-01   +4.826644514277620e-01   +4.515804506701670e-01   +2.675864333700009e-01   +3.572366405430592e-02   +4.495721970718537e-01   +2.394639189147592e-01   +3.051719416925129e-01   +3.778822013453431e-01   +3.695456281260327e-02   +5.921321532311001e-02   +5.041696142358525e-01   +2.310830315969033e-02   +2.408582855415022e-01   +5.443457553869683e-01; +5.062592204955094e-01   +2.429157583092914e-01   +3.760375595589008e-01   +1.736425707113837e-01   +4.058360596686832e-01   +3.060135706135023e-01   +3.687049711005638e-01   +2.977376009810561e-01   +2.425168735713302e-01   +1.925964398536581e-01   +1.118965293631153e-01   +1.183235941895964e-01   +1.137635509060411e-01   +7.330694692701152e-02   +3.102818269671268e-01   +3.467290082148141e-01];
L1E_L1I_iGABA_netcon = [+5.546504321179842e-02   +4.824873728315566e-01   +5.382656646892017e-01   +3.851653388326829e-01   +3.552923529446892e-01   +3.847709671936177e-01   +5.691950588362767e-01   +7.750675104067786e-02   +4.618166428142767e-01   -2.062433716536496e-02   +4.593905430780072e-01   +1.623700499599461e-01   +1.292012076650083e-01   +5.609948417843920e-01   +2.070371833376436e-01   +3.623504370467175e-01; +3.811904972227090e-01   +3.320598295025944e-01   +3.456358708463439e-01   +1.789884803204637e-01   +1.740168473811592e-02   +3.985001638877595e-01   +3.740843056392001e-01   +4.033979231404515e-01   +9.109254548027740e-02   +4.020100000413438e-03   +5.107525793674507e-01   +1.374827177102330e-01   +3.006240959389585e-01   +2.885715895029027e-01   +6.828097334486710e-02   +2.293913124268143e-01; +8.560018088265071e-03   +3.302912674793780e-01   +2.470320610387571e-01   +1.920801844375579e-01   +1.229497121626256e-01   +7.668329483531994e-02   +1.884929995858306e-01   +3.158047772655458e-01   +1.271390649879523e-01   +1.074072863995994e-01   +3.812044782399117e-01   +3.281515419347978e-01   +3.280112330155099e-01   +3.669245417551652e-03   +2.390052218056384e-01   +2.645120563690614e-01; +1.829584070224526e-01   +3.645526845341207e-01   +3.866039358229019e-01   +3.179696260790452e-01   +3.172947106242716e-01   +5.315155936191650e-01   +4.333594801631230e-01   -4.679196587850325e-03   +3.645631491720893e-01   +5.349288564307478e-01   +3.038558421191551e-01   +4.468146572054848e-01   +1.489548517000910e-01   +3.268414392017771e-01   +6.859849781179427e-02   +1.118968474742826e-01; +2.546129820874800e-01   +5.215024112655358e-01   +4.916243100191242e-01   +5.128409378657873e-01   +1.634636553665575e-01   +1.131489141838593e-01   +3.667880084552033e-01   +2.727966203318398e-01   +4.039687906387641e-01   +4.107895236101711e-01   +4.634630398904038e-01   +3.688864751679812e-01   +1.441894401112165e-01   +3.928995513097706e-02   +2.244263339351354e-01   +5.120585249396745e-01; +3.683776410069628e-01   +3.802611780301337e-01   +4.113887292324889e-01   +3.958408482465930e-01   +3.162841107179967e-01   +1.366565256691830e-01   +5.342358567270485e-02   +1.757401852492072e-01   +4.534687436131274e-01   +2.686297849764664e-01   +4.059998720314877e-01   -8.689552846880172e-03   +1.912970542181085e-01   +1.396689025524454e-02   +1.211916457012068e-01   +2.890759408658846e-01; +1.540784829299701e-01   +3.625099577810927e-01   +4.497003382092706e-01   +1.817714927044238e-01   +3.079959829630726e-01   +9.920127033972787e-02   +4.511210804777257e-01   +3.952544035856472e-01   -1.952569614106888e-02   +3.662101623695086e-01   +7.473919372706478e-02   +3.779177671560152e-01   +3.423678287406685e-01   +4.100635727367572e-01   +1.501969709375912e-01   +4.068520196213744e-02; +4.718246053545017e-02   +2.725639697691811e-01   +1.560938628788747e-01   +9.563037056817872e-02   +3.107358292191469e-01   +3.293967124948544e-02   +8.963946731557304e-02   +2.191480790699124e-01   +4.362401398313224e-01   +2.107213578298630e-01   +2.100449316190861e-01   +1.672917027736466e-01   +2.314859821156294e-01   +8.636390600217496e-02   -1.163849102965478e-02   +5.329916784988858e-01; +2.472859600585552e-01   +3.892013753523665e-01   +4.845397124784683e-01   +3.238690575216545e-01   +2.075841790965360e-01   -1.802865509721564e-02   +5.351263803106906e-02   +3.959792416790378e-02   +3.484211558990421e-01   +2.754856488867020e-06   +1.780003316947920e-01   +4.254451499042524e-01   +3.071432178680581e-01   +2.424887573616442e-01   +4.524665424497910e-01   +5.406123881150345e-01; +2.085451930707526e-01   +4.395957605458830e-01   +1.580312477824403e-01   +8.026630188594586e-02   +3.133393021948852e-02   +2.938566615506921e-01   +1.556250948193159e-01   +9.449800217528084e-02   +4.161110173044244e-01   +1.188107648613553e-01   +2.582504143055787e-01   +2.177516894604915e-01   +4.393441800343321e-01   +4.452694429121747e-01   +4.181490517913399e-01   +2.170134243209831e-01; +3.251761095655141e-01   +2.977275096809240e-01   +2.883701041363532e-01   +1.603298638957479e-01   +3.633230547002012e-01   +4.761743319384852e-01   +4.099070671973369e-01   +4.562666417422169e-01   +3.040073640073092e-01   +2.616773849356971e-01   +7.084773521784206e-02   +4.288715500746767e-01   +1.375279291805574e-01   +1.552936289731816e-01   +2.413216829186356e-01   +2.574665685037513e-01; +4.245079820604601e-01   +5.608200925974093e-02   +1.142746746009712e-01   +2.755038243779545e-01   +4.141889519688446e-01   +1.725736754348027e-02   +3.377607354735487e-01   +2.965628080169992e-01   +4.541868157044359e-02   +2.856588184541468e-01   +2.561984888798445e-01   +2.023576190734762e-01   +9.794169752590395e-02   +3.578558352653384e-01   +4.503667959920123e-01   +4.074269880098251e-01; +1.855755963279183e-01   +2.419675627793170e-01   +2.853590830236767e-01   +4.110182672096600e-01   +2.349876128417033e-01   +1.683319249576750e-01   +3.937706448793335e-01   +3.731337812903747e-01   +3.532537360631759e-01   +5.145968909450794e-01   +1.014310561286167e-01   +1.778304212211863e-01   +1.736652166989438e-01   +3.058710653325427e-01   +2.437882573254571e-01   +3.723845876696184e-01; +1.217766651703837e-01   +2.315051899030058e-01   +3.268730197426462e-01   +2.793158464144841e-01   +4.146586448451470e-01   +1.121064611298642e-01   +2.658846822050028e-01   +1.938846789920225e-01   +1.784275100582542e-01   +2.320297534090810e-01   +2.360801388127261e-01   +2.105667206121435e-01   +4.636284078342104e-01   +5.294996394249315e-01   +1.685952836695056e-01   +9.004404383505107e-03; +1.693159205837295e-01   +1.221218442415822e-01   +1.903663250791112e-01   +3.103672723179463e-01   +2.391741106958105e-01   +2.599827430242646e-01   +1.659453851850489e-01   +1.875126205850907e-01   +3.448482447519928e-01   +3.389265310081033e-01   +2.237598556660581e-01   +2.004821491114737e-01   +7.313620047264889e-02   +2.356636988688124e-01   +4.057112613120908e-01   +3.936780084002773e-01; +1.838337813445584e-01   +2.724970089290934e-01   +2.507567295689299e-01   +1.314459067054888e-01   +2.946148298969594e-01   +4.751236118498647e-01   +8.105569918177151e-02   +4.392132089530146e-01   +1.232504180238226e-01   +4.143754457150852e-01   +2.486828130553486e-01   +3.459117344336085e-01   +2.622250720494407e-01   +5.109419395942151e-01   +1.194526944313779e-01   +4.114228152002170e-01];
L2I_L1I_iGABA_netcon = [+3.882643204480650e-01   +4.633814977156442e-01   +4.016506087932232e-01   +2.166391611031472e-01   +7.095335362947856e-02   +3.440882090207367e-01   +2.137866363493882e-01   +5.389293721504584e-01; +1.571607547821752e-02   +2.579839416015577e-01   +1.008677491240495e-01   +4.049002933023007e-01   +2.917516322959733e-01   +4.282597192195902e-01   +3.515117372485189e-01   +2.887503781273757e-02; +1.216225940761389e-01   +1.879644233850504e-01   +3.922206174015644e-01   +2.585395179322206e-01   +3.885278612700299e-01   -2.650928745184427e-02   +3.078260412848020e-01   +4.756877287125419e-01; +1.282279936761372e-01   +4.850164397886221e-01   +2.106102118224408e-01   +3.114684296830116e-01   +1.495899785261729e-01   +4.164442187691684e-01   +2.282885218868611e-01   +4.638440004858398e-01; +4.737388230036548e-01   +2.230966263298524e-01   +2.194248363105601e-01   +1.965931986901377e-01   +4.657133879358482e-01   +5.154067722489851e-01   +2.237445304491120e-01   +3.130982166793345e-01; +3.554925454154810e-01   +3.334768048306280e-01   +5.004965469261123e-01   +2.639410633727344e-01   +4.136720282737449e-01   +2.670251135165683e-01   +2.071314838771333e-01   +3.846784550193751e-01; +5.142975403695914e-01   +1.039590033415044e-02   +1.930246937380854e-02   +4.575105317849907e-01   +6.652318397791980e-02   +1.588922568610341e-01   +2.257449360245997e-01   +2.018197300867592e-01; +3.458772829006231e-01   +1.859055228224850e-01   +1.452486050064213e-01   +4.728694422843367e-01   +1.327040544372360e-01   +3.216859722866043e-01   +1.891543948543380e-01   +1.315260018467354e-01; +3.297119076123396e-01   +2.744420407579651e-01   +4.992981923018913e-02   +2.124816395164633e-01   +2.600905585227654e-01   +3.634117208998363e-01   +4.665245378059344e-01   +1.484555607859442e-01; +2.774918035519349e-01   +3.874471305424489e-01   +2.534456328248691e-01   +4.628820153843193e-01   +4.377562620074349e-01   +8.795490199319761e-02   +1.634390782722652e-01   +4.280480012847027e-02; +4.410230119503323e-01   +3.636022432597829e-03   +2.706994930966803e-01   +2.472923427069897e-01   +3.302916020873836e-01   +6.806887912083504e-02   +3.705567055978417e-01   +1.282015277099336e-03; +2.957029956676778e-01   +5.100715859788145e-01   +2.276706175934143e-01   +3.703039679540234e-01   +4.678809529324978e-01   +1.923886504242484e-01   +2.402941803847066e-01   +2.158015126774788e-01; +2.216074005594030e-01   +3.664797046004412e-02   +1.037000845423302e-01   +4.658491816391123e-01   +1.733406608340772e-01   +5.461929999139022e-01   +2.679379542062334e-01   +3.280805980180073e-01; +6.773710264402630e-02   +4.311351471401305e-01   +6.662214671905713e-02   +6.925120116940395e-02   +1.445842448558516e-01   +2.076925258135957e-01   +5.114328587757103e-01   +1.221221223338800e-01; +2.631155885958713e-02   +1.240418068015343e-03   +3.182523828801886e-01   +2.785617582348940e-01   +2.366195853939663e-01   +3.708864959961686e-01   +4.221835357879500e-01   +1.704300796651208e-01; +1.356398466397272e-01   +4.418526762927330e-01   +1.097045876950576e-01   +4.626626278090494e-01   +1.458230345888606e-01   +3.011161757813385e-01   +1.827757816347838e-01   +1.500524568836059e-01];
L1I_L2I_iGABA_netcon = [+3.916149694005110e-02   +2.206757693164962e-01   +8.028718445277654e-02   +1.788610641506456e-02   +5.074399054241009e-01   +2.768579655626565e-01   +3.964699388574982e-02   +3.176052070550377e-01   +1.957558675335803e-01   +7.059488147308147e-02   +1.793618910129821e-01   +3.954731824926075e-01   +1.179897160085814e-01   +5.309922009903278e-01   +1.026886912726272e-01   +2.007686697146593e-01; +4.267009579166288e-01   +6.039556099962320e-02   +2.454523578855460e-01   +4.072355215313669e-01   +9.315759838246783e-02   +3.315265045064025e-01   +3.397813284933801e-01   +2.904391330934835e-01   +4.598996500481743e-01   +4.956285145788548e-01   +9.712279579437449e-02   +9.624855394582529e-02   +2.775598669878750e-01   +2.582061436718215e-01   +1.394540320379970e-01   +2.368352915621259e-01; +2.969522446137975e-01   +2.858870139530236e-01   +3.124370980773991e-01   -1.855103207146402e-02   +3.208752618559077e-01   +6.388111607254199e-02   +1.519294647515813e-01   +1.582544620737566e-01   +2.841679260171851e-01   +4.848081215531998e-01   +4.452001807688732e-01   +2.515732577514043e-01   +3.143602476732872e-01   +1.961681920174696e-01   +8.615209906896934e-02   +2.154170464320915e-01; +3.253115673483766e-01   +2.320831209848516e-01   +4.360289654312655e-01   -7.144849557484956e-04   +2.585870693103490e-01   +1.495379534670548e-02   +2.364188929060998e-01   +3.353356851721233e-01   +3.354860633271128e-01   +4.564756945081648e-01   +4.980715285470209e-01   +2.174525827157640e-01   +4.300854364346587e-01   +8.443788353065275e-02   +1.095341459733293e-02   +4.440526520067039e-01; +2.544001667757921e-01   +4.147501410191613e-01   +3.430272859838993e-01   +1.341031171883797e-01   +2.977022395257384e-01   +5.078570798465055e-01   +2.120948157749797e-01   +1.741149236976001e-01   +2.546169375824156e-01   +4.205471250198265e-01   +3.441311143735671e-01   +3.752697362095772e-01   +3.760703363138412e-01   +1.068754533085728e-01   +3.791621753446206e-01   +5.440473795860994e-01; +1.918823922598658e-01   +2.152282704346888e-01   +2.786878258178395e-01   +3.860322664882269e-01   +5.511339893604063e-01   +2.830528708195247e-02   -1.239014736239001e-02   +4.029895050503360e-01   +3.959536079645746e-01   +4.080160312441989e-01   +3.777366296928866e-01   +1.928146912391833e-01   +2.893554796460213e-01   +3.281480726841920e-01   +4.498109443406528e-01   +4.344681640791359e-01; +4.659456795247301e-01   +2.129010156612517e-01   +4.807322492764773e-01   +4.955364389069181e-01   -2.494606424535532e-02   +4.270155581398750e-01   +3.316572038285370e-01   +3.988184477312015e-02   +9.403046921632545e-02   +4.248735593955826e-01   +5.174848143689754e-01   +5.012257642482453e-01   +2.600289077149819e-01   +9.340169579519032e-03   +3.449078325439653e-01   +1.643305164421859e-01; +1.675453715806724e-01   +9.233565445000823e-02   +3.133655981717055e-01   +2.833269717006134e-01   +7.021719647330768e-02   +5.030777019799113e-01   +3.698186333951326e-01   +1.283730653732527e-01   +4.466226223674525e-01   +3.052462116515940e-01   +4.199450182476286e-01   +3.727485043620540e-01   +3.730228758694364e-01   +2.548047590486796e-01   +2.507917199783713e-01   +7.730725511286683e-02];
L2E_L1E_iAMPA_netcon = [+2.405678549780826e-01   +3.181098210735718e-01   +4.780532158235080e-01   +1.350348349086067e-01   -7.670995068082208e-03   +3.181362893666138e-01   +7.217984979222875e-02   +2.786244308545239e-01; +1.806072201118679e-01   +7.428612978388423e-02   +2.826148959558689e-01   +2.992318947568681e-01   +1.900383078952922e-01   +5.499407606743227e-02   +4.349823956205943e-01   +4.503550977278081e-02; +2.793679466047872e-01   +1.135083130227123e-01   +2.698770190590120e-01   +4.871041876718469e-01   +3.748728973395011e-01   +5.034269993298176e-01   +4.257289111200476e-01   +1.248897893706239e-02; +3.863915722096589e-01   +1.773516331420288e-01   +1.627568205681016e-02   +1.149871343383505e-01   +1.881408079951464e-02   +4.850859364192334e-01   +2.223870027764371e-01   +6.318859762143036e-02; +2.667818714566823e-01   +3.558226623979119e-01   +4.496770105036569e-01   +3.684445624290559e-01   +2.276149680581183e-01   +3.492392545032590e-01   +2.496121585363936e-02   -1.608264178606158e-02; +4.776071607861959e-01   +5.723305051898073e-01   -2.201625266998375e-02   +5.106053248228074e-01   -2.957574005613597e-02   +4.018874370998727e-01   +2.630477592741688e-01   +4.172195388052358e-01; +8.750547133887789e-02   +4.202845689363252e-01   +2.451119200306310e-01   +2.158906077840131e-03   +3.947494353141743e-03   +4.540403076273424e-01   +2.998024487793136e-01   +4.692788269215398e-01; +2.645620560496242e-01   +5.343047539392538e-01   +2.377204445275441e-01   +3.852929212348167e-01   +3.692340344887344e-01   +3.158540187170611e-01   +4.312529268971935e-01   +2.796900090574359e-01; +1.960488728725923e-01   +1.189389175159542e-01   +2.501952872924399e-01   +1.696765643558235e-01   +5.203621460491445e-01   +4.400156872373768e-01   +1.182038926474457e-01   +3.215204018955495e-01; +1.777636438933706e-01   +4.543013554967958e-01   +4.584512991934767e-01   +4.725452661979870e-01   +5.494728668234690e-01   +1.594515642976954e-01   +2.637944095011129e-01   +1.553613553193257e-01; +3.647721739562571e-01   +3.169927230817187e-01   +3.868617229864780e-02   +8.009121021075125e-02   +2.037993422672130e-01   +4.227627633142573e-01   +3.802724638751036e-01   +5.678877088279551e-02; +5.201214615685393e-01   +2.003691632555079e-01   +1.251446146045954e-01   +3.420272024915282e-01   +4.425710330216638e-01   +5.634551727379679e-01   +3.260329205075557e-01   +4.846654538203764e-01; +2.251349704655956e-01   +4.670214688249064e-01   +4.517781743633082e-01   +2.041484256165789e-01   +5.196914244263965e-01   +2.338696492224380e-02   +3.529885177553877e-01   +4.824478820311683e-01; +2.778667252215789e-01   +1.914825904976255e-01   +3.457967745635045e-01   +1.887251363158913e-01   +6.641924942932351e-02   +4.287568757941146e-01   +5.231122647335279e-01   +1.493187078974419e-01; +3.316885554481641e-01   +4.219750106458665e-01   +7.350650747115645e-02   +1.143358489813156e-01   +2.280110512003450e-01   +4.926895606806462e-01   +3.264288481110469e-01   +1.123197231428628e-01; +3.495306528693469e-01   +3.426861062106393e-01   +3.031019501147618e-01   +6.740136002339023e-02   +2.854823985239417e-01   +1.456642071904195e-01   +4.136060566185509e-01   +5.487555460585284e-02];
L1E_L2E_iAMPA_netcon = [+1.353481076583940e-01   +2.421060202270733e-01   +5.509562783599724e-01   +2.867215364948998e-01   +3.396302819073206e-01   +6.664543106111755e-02   +3.070790930165003e-01   +4.245887755739263e-01   +3.149652867704382e-01   +2.415704941782833e-01   +4.086177553179842e-01   +3.623778987268731e-03   +2.212985714652035e-01   +2.496358465448187e-01   +3.903506660223771e-01   +5.002997375086599e-01; +3.845013993446604e-01   +4.664275083746649e-01   +3.878640816271736e-01   +1.662566755213685e-01   +2.743667801830985e-01   +3.401015024760157e-01   +4.339728176769269e-01   +9.035014614162061e-02   +1.063031833210439e-01   +2.765511175964139e-02   +9.060648652358244e-02   +1.755314326678783e-01   +5.825793180243932e-02   +1.464619340876431e-01   +6.327902714862030e-02   +1.822875480762756e-01; +1.925406004508341e-01   +4.860898823234575e-01   +5.429621170307958e-01   +4.874941021432018e-01   +1.724133785636868e-01   +4.505643225617424e-01   +1.946002020228026e-02   +4.389221968758073e-01   +2.943737444717845e-01   +2.015273430232552e-01   +9.960814620635036e-02   +4.651300967617404e-01   +7.731777148775947e-02   +8.244733625739411e-03   +2.245431903745286e-01   +3.015285974152561e-01; +2.296335344068126e-01   +2.129529208695488e-01   +3.007875605339644e-01   +5.606238732616744e-01   +1.291183821202646e-02   +2.715130313964960e-02   +5.138347089564048e-02   +3.441461466677564e-01   +5.095480689063763e-01   +4.055025398430572e-01   +3.196122721369444e-01   -9.754862820608841e-03   +3.178591553364506e-01   +1.152821594354047e-01   +1.334800088451968e-01   +2.753141852675912e-01; +4.570311670669802e-01   +1.740726757903614e-01   +3.141503580226936e-02   +5.664336978466177e-02   +5.434630772385856e-01   +4.739547120686538e-01   +4.748347496606299e-01   +2.296735689307723e-01   +1.501207212314341e-01   +2.098319298568114e-01   +3.862601182588125e-01   +4.566209083580282e-02   +3.541207274110114e-01   +4.032129749563741e-01   +2.141014106848726e-01   +1.382525660325385e-01; +7.127093698860044e-02   +3.285429753795819e-01   +4.195833930522792e-02   -2.134841871485584e-02   +3.985038165767791e-01   +2.756541128815340e-01   +3.027858396392755e-01   +4.514333144039301e-01   +4.797611599280227e-01   +3.789460638387912e-01   +8.588868599003190e-02   +3.893274554165649e-01   +4.155107704377891e-01   +2.546747665362304e-01   +7.887088361818108e-02   +1.731944104733784e-01; +1.385543597219984e-01   +2.149084016718716e-01   +1.561290557098000e-01   +1.483829775589825e-01   +1.779636116988050e-01   +2.245817114655945e-02   +1.251391230380140e-02   +9.628208330480326e-03   +2.127797936880566e-01   +2.975719845055427e-01   +9.565062035871089e-02   +1.119045078920558e-01   +5.583901202550265e-01   +3.368155236545936e-01   +4.652980520007415e-01   +2.696659377967482e-01; +1.289498045214870e-01   +2.206575665042263e-01   +5.127323854957517e-01   +4.380515118907440e-01   +5.298701828478898e-01   +2.747151688012741e-01   +4.856966459960106e-01   +1.492250702512700e-01   +2.119925059763652e-01   +4.907203737455125e-01   +4.793546784368452e-01   +1.106246269936659e-01   +2.681271820556252e-01   +1.435326072804318e-01   +4.387627020929539e-01   +2.743905202746429e-01];
L2I_L2E_iAMPA_netcon = [+3.181302935766209e-01   +1.276340914484032e-01   -6.140228002357931e-04   +2.581023614889316e-01   +4.515866924607516e-01   +3.606582166435612e-01   +6.248258405671287e-02   +3.347522622161473e-01; +9.901470080600278e-02   +1.739508750655552e-01   +4.864614765113336e-01   -8.784657586044730e-03   +3.235877431133255e-01   +1.326960698257457e-01   +1.074742560736879e-01   +3.214814550863301e-01; -1.738845450212531e-02   +4.825597191756404e-01   +1.719581599276238e-01   +2.411248548380240e-01   +4.901791804505188e-01   +5.406933612347401e-01   +3.779390573347026e-01   +1.651464688459445e-01; +4.135755276120563e-01   +4.470777118379852e-01   +4.926723157931953e-01   +4.072063131530335e-01   +4.517372823274914e-01   +3.179723038199874e-01   +2.691422996930235e-03   +2.923997705029576e-01; +4.146965205790190e-01   +4.946602191756049e-01   +1.551891225446851e-01   +2.617782758423779e-02   +2.174637638343327e-01   +4.917211972594155e-01   +1.450046250459897e-01   +5.126570287735644e-01; +2.871275482922386e-01   +2.085382819314492e-01   +4.177372939483011e-01   +3.377055889692263e-01   +1.123402234643161e-01   +1.657885487029952e-01   +8.331882041328108e-02   +3.949818513370443e-01; +1.201867533964669e-01   +1.954873852201801e-01   +4.260016073070992e-01   +4.272065247841524e-02   -1.702886212997922e-02   +1.579680153626080e-01   +2.497819655458105e-01   +5.259309398993294e-01; +4.047869033710275e-02   +2.250880106873768e-01   +2.670337146472191e-01   +5.521242668865612e-01   +4.325052330961865e-01   +3.490241184923529e-01   +5.188529111120296e-01   +1.825088444010682e-01];
L2E_L2I_iGABA_netcon = [+4.252619884940166e-01   +2.418650043734143e-01   +2.457709379178450e-01   +1.623999745289546e-01   +4.295751740809304e-02   +5.090955587075879e-01   +4.736201364903209e-01   +3.439577279309471e-01; +5.471158770815758e-01   +1.746157524853602e-01   +9.586047916780355e-02   +5.146438373955848e-01   +4.706996163047552e-01   +3.555571191061434e-02   +6.901569552123798e-03   +3.687341241298318e-01; +1.945342651163233e-01   +3.288832835100138e-01   +3.969231705528961e-01   +1.597992816051509e-01   +1.343565621404907e-01   +4.550949353713802e-01   +1.882233484075165e-02   +2.426839533717891e-01; +5.400319871313541e-01   +8.446822417605102e-02   +1.742725103333718e-01   +3.215785313251018e-02   +4.863429646131642e-01   +5.157658870227252e-01   +4.428277823709590e-01   +2.621012207271841e-01; +2.844532885448225e-01   +2.738083113880113e-01   +5.450329586335350e-01   +1.408897706035621e-01   +5.342186418765783e-02   +6.069915656435580e-02   +4.679944333861935e-01   +2.248195288205995e-01; +3.858285869162129e-01   +1.487873156630705e-01   +1.355360744647386e-01   +2.746085365244373e-01   +1.332027277479229e-01   +3.468819088027573e-01   +2.697551925114547e-01   +5.054078813653908e-02; +4.438479573453464e-01   +3.424224751493524e-01   +3.956938001941368e-01   +7.625362822152341e-02   +1.257343578530392e-01   +6.147820021016449e-02   +3.788256618406617e-01   +2.962518276649932e-02; +1.293386225834785e-01   +2.052797453771600e-01   +2.720632051783485e-01   +2.772458714467322e-01   +5.012962921818870e-01   +2.845975190234105e-01   +2.057420695225366e-01   +1.114989361605212e-01];
L3E_L2E_iAMPA_netcon = [+2.780468325136235e-01   +3.223590868631620e-01   +1.535194019572794e-01   -9.975819287806390e-03   +3.044101817604545e-01   +5.340164280818072e-02   +4.901106098124653e-01   +3.314912053245297e-01   +3.688992042377268e-01   +3.608995037702950e-01   +9.955436855626110e-02   +2.921453466566976e-01; +1.726899618268802e-01   +3.407309622657601e-01   +3.855047652996098e-01   +2.563039229868208e-02   +4.058968740743951e-01   +4.345299665440590e-01   +3.855837126155454e-01   +1.707303399927602e-01   +4.364526890799881e-01   +1.360046376318284e-01   +3.693696480136175e-01   +4.594407002160043e-01; +3.697157387074570e-01   +2.843137512094872e-01   +4.639874861859931e-01   +4.775674187613719e-01   +4.715625719681095e-03   +1.493358383775127e-01   +2.998457116911294e-01   -1.442039575647355e-02   +3.026998860890619e-01   +4.033026945820504e-01   +2.688385135444983e-01   -1.393177086349250e-02; +3.871577571091009e-01   +2.522583429775352e-01   +2.262453927921574e-02   +5.330571808681288e-02   +4.338118987195652e-01   +2.140279387407579e-01   +1.413831946065669e-02   +2.726821742735013e-01   +1.542886232944479e-01   +1.735350783584210e-01   +3.143293531196916e-01   +6.350177895489388e-02; +3.909983892412903e-01   +5.433550282668577e-01   +4.705462745576786e-01   +5.202711998878607e-01   +4.452592381722783e-01   +4.560812704101166e-01   +3.390991955752117e-01   +1.068068829481247e-01   +6.744355053845419e-02   +8.967095842024272e-02   +3.996745257950548e-01   +3.373762571640177e-01; +1.357865992653354e-01   +1.203180511000152e-01   +6.826435334865448e-02   +1.857841587706698e-01   +4.026068330108400e-01   +3.534290244286813e-01   +4.914276884817331e-01   +4.461280501794957e-01   +4.926657146733571e-01   +1.900689265663705e-01   +5.076976639233614e-01   +3.286523479426630e-02; +3.733925128535414e-01   +8.347656522794314e-02   +5.073294707475615e-02   +5.117342575252762e-02   +2.195625031875642e-02   +2.825062493955521e-01   +3.895258897703914e-01   +1.878135099016696e-01   +1.780418407669581e-01   +1.478588351323132e-01   +4.787524076255220e-01   +5.190201448998643e-01; +4.837093519832256e-01   +4.520206192605605e-01   +3.079621704551718e-01   +4.637745575109574e-01   +4.238147927363703e-01   +1.756572854336417e-01   +1.500381631828825e-02   +1.974178356425390e-01   +8.670563725768278e-02   +6.561806444593017e-02   +2.247931995562521e-01   +1.120613446983786e-01];
L3I_L2I_iGABA_netcon = [+2.943846227791412e-01   +5.432078813286071e-01   +9.341143408530493e-02   +2.921443229446541e-01   +2.745061976573778e-01   +3.804171684238021e-01   +3.753577713678188e-01   +6.423425840839667e-02   +3.256359433244627e-02   +1.456403870474894e-01   +4.773878251863579e-01   +1.214792329314231e-01; +3.114008677630477e-01   +3.779838670971937e-01   +3.056355096216956e-01   +3.635831370883711e-01   +4.170191001110898e-01   +2.112995369312789e-01   +4.656722806134961e-01   +8.320815350445807e-02   +1.711745321771628e-01   +1.947787920030515e-01   +3.100135873704693e-01   +4.479390838636089e-02; +2.542037768361260e-01   +3.868766995063866e-01   +3.041370178432773e-01   +2.275942513716881e-01   +2.803223957415971e-01   +2.308206284667395e-01   +2.523260030034851e-01   +3.311950708886510e-01   +3.416696985405549e-01   +6.329472871479705e-02   +3.440857841681451e-01   +3.701023985922583e-01; +3.912773448493593e-01   +4.741026130604722e-01   +5.015707439205148e-01   +1.109509738411574e-01   +2.930800895730991e-01   +5.214303509254838e-01   +6.218781216772563e-02   +7.973384541062407e-02   +3.545541016136194e-01   +4.262991038628629e-01   +9.909239482592956e-02   +4.089306514874127e-01; +2.604222472837567e-01   +4.446680115915355e-01   +4.253834049977616e-01   +3.967785839350487e-01   +4.682234126565457e-01   +1.702476679101626e-01   +2.148992117044364e-01   +4.121161711832208e-01   +2.794509998659540e-01   +6.643062663719970e-02   +1.918577898804149e-01   +1.675692222921111e-01; +3.145112167648154e-01   +9.305714529801352e-02   +3.479819679092290e-01   +2.011045392727895e-01   +4.156561257501678e-01   +3.170424326642080e-01   +2.482566515104155e-01   +2.861540098398606e-01   +1.531073220555981e-01   +1.441714025733767e-01   +2.778374916570502e-01   +3.426837578772121e-01; +2.642435540016754e-01   +8.514955821486193e-02   +4.282809023357237e-01   +3.604541835619741e-01   +1.439528068296553e-01   +5.037425875310765e-01   +1.756447727886167e-01   +9.440870312385542e-02   +1.224399565806810e-02   +4.316785337178812e-01   +5.046805004062588e-01   +7.730367826917307e-02; +2.215438869071139e-01   +1.162699920126865e-01   +4.658493566583099e-01   +9.391730493473366e-02   +4.003199861035260e-01   +4.500660868236184e-01   +4.023266334097646e-01   +2.998639614535671e-01   +2.345895027111257e-01   +4.112847677561022e-01   +1.149734010382698e-01   +4.333136666033311e-01];
L2E_L3E_iAMPA_netcon = [+3.177642701461424e-01   +1.334799632362484e-01   +4.474766363979091e-01   +3.443300331611652e-01   +2.720105489543797e-01   +2.421038645655682e-01   +2.763945718987950e-01   +1.883577319128823e-01; +2.847473692311150e-01   +2.676788238250178e-01   +3.574029343982104e-01   +2.186547166189838e-01   +5.027885483384061e-01   +1.675850546993052e-01   +3.326962497783255e-01   +5.024972259289864e-01; +1.591899903818365e-01   +1.098106549106798e-01   +3.565440896683458e-01   +3.598309291043874e-01   +3.586398300595370e-01   +4.336894871238369e-01   +3.374569228658368e-01   +4.646697226507590e-02; +1.059310854441862e-01   +1.304571437373263e-01   +2.096539976989842e-01   +5.132709241703112e-01   +1.938892770023048e-01   +4.046504794289650e-01   +3.249818404222771e-01   +1.478918587380437e-01; +1.334506418342090e-01   +3.436527539018199e-01   +5.337112770020236e-01   +3.604950207724004e-02   +3.937502757624984e-01   +3.934526895899574e-01   +4.015303442648895e-01   +2.232554259640561e-02; +9.711291007926860e-02   +4.951084666432408e-01   +3.660726378509765e-01   +1.971079051262296e-02   +5.192424712530636e-01   +2.363614309480979e-01   +1.613694817001189e-01   +4.163404127151420e-01; +1.558178467838991e-01   +1.063067918956551e-01   +2.678419289023237e-01   +3.668029408417344e-02   +1.624767579580847e-01   +3.396220883413699e-01   +3.306372003910218e-01   +2.725631912886005e-01; +3.184682801801436e-01   +5.622704254122961e-02   +2.025768411178482e-02   -1.624172014555540e-02   +4.357490032684938e-01   +2.809999178286610e-01   +9.975858693923589e-02   +4.978793092381492e-01; +5.180317738664638e-01   +3.954899388856929e-01   +1.979961640347424e-01   +4.248615433832125e-01   +2.105159924703635e-02   +1.717359687217099e-01   +3.194853722192670e-01   +2.147894672166277e-01; +1.836902422329090e-02   +1.386460253465670e-01   +4.426978932771742e-01   +6.176349326911337e-02   +1.514704135069527e-01   +9.823524305272160e-02   +4.768244764323193e-01   +5.026450766727750e-01; +3.978433580739663e-01   +4.072088175195459e-01   +2.846958933776992e-01   +3.377968249331627e-01   +2.222555754293094e-01   -8.146286269168801e-03   +1.913167937113242e-02   +4.289606684780301e-01; +4.132376078078609e-01   +1.330435816441787e-02   +4.599807609543872e-01   +4.506205046625221e-01   +3.163230133292568e-01   +4.722861847820396e-02   +1.629356664555870e-01   +1.914654662474429e-02];
L2I_L3I_iGABA_netcon = [+1.374734493808810e-01   +2.561688350820551e-01   +1.531034271998722e-01   +3.033973931444618e-01   +2.346634400462718e-01   +2.695039909418020e-01   +2.501490254793883e-01   +3.222030723445219e-01; +2.155032396833150e-01   +4.286051799829059e-01   +1.432473382794701e-01   +4.659356363554337e-01   -3.616717272844804e-02   +3.238254290617006e-01   +2.001906702296184e-01   +2.538725967093770e-01; +1.707077618861643e-01   +3.412060651294376e-01   +4.275907923992580e-01   +3.111983821947898e-01   +2.305324867526115e-01   +2.511661098219140e-01   +3.552374758392847e-01   +5.121342174670411e-01; +3.591746004037970e-01   +9.869324157329428e-03   +4.557529396056461e-01   +1.510780149977310e-01   +3.167856920237620e-01   +3.222810908227027e-01   +4.600393769621641e-01   +9.526377277681917e-02; +2.548430616525814e-01   +5.367401937988847e-01   +3.653533829639840e-01   +3.262929319425703e-01   +2.308727596061590e-01   +4.501862175778051e-01   +4.763286009092051e-01   +3.469478797620192e-02; +4.279114954496741e-01   +2.973779034796902e-01   +1.158427113495229e-01   +4.757532247964395e-01   +1.841376250752249e-01   +1.424912782537486e-01   +1.976885670633834e-01   +4.470346912023281e-01; +1.340540583262994e-01   +4.394631290680835e-01   +1.400510163610423e-01   +4.417374698402169e-01   +1.946283247090076e-01   +1.285303563678529e-02   +2.576855917155481e-01   +3.377083814633249e-01; +2.464294463647856e-02   +8.622723482998698e-02   +2.953214760202176e-01   +7.157399838524771e-02   +3.340691045209297e-01   +3.251933598638546e-01   +7.129636041653258e-02   +7.775988954546564e-02; +2.172722042794733e-01   +1.139115847865069e-02   +4.371851582955134e-01   +4.925313878802466e-01   +3.573961464658048e-01   +7.818559458094033e-02   +1.605840811251892e-01   +4.595526487250991e-01; +1.972214176735139e-01   +8.709803977018418e-02   +7.971273937891390e-02   +2.951434564574468e-01   +4.787282907143833e-01   +2.704590031019377e-01   +4.702497112167255e-01   +2.538937106563260e-01; +3.002642141157505e-02   +2.635667471737318e-01   +7.284780854629182e-02   +2.729744142451867e-01   +3.185289630128400e-02   +3.142955420735916e-01   +7.117815792654707e-02   +1.118323129792917e-01; +3.309993766367254e-02   +2.355262319385794e-01   +4.419484816731604e-02   +1.345460370055230e-01   +3.002149452137087e-01   +4.616812859959762e-01   +1.957779006925940e-01   +1.712110498926121e-01];
L3I_L3E_iAMPA_netcon = [+2.321175323600528e-01   +2.330273735323811e-01   +2.969558491297363e-01   +4.674735276114206e-01   +1.283294673098264e-01   +3.797770493028921e-01   +1.868061855882751e-01   +1.537265552937926e-01   -2.468633841109845e-03   +2.104896749238788e-02   +3.569107922417226e-01   +3.619605898348776e-01; +4.325542524364688e-01   +2.141509605313109e-01   +1.835820416390946e-01   +5.006835505520498e-01   +4.203909783326126e-01   +2.455770272446478e-01   +4.930459263882344e-01   +5.404871314547804e-01   +2.482140866118848e-01   +1.369843368138301e-01   +3.359404402361275e-01   +4.872880811516774e-01; +1.723658491023854e-01   +4.362662984085447e-01   +1.697755450544879e-01   +1.466650025549304e-01   +3.785793089353326e-01   +4.277740927732283e-01   +4.022440173316836e-01   +4.495681555898013e-01   +1.142833402785238e-01   +4.281007242340081e-01   +1.762344499763581e-01   +4.476925730576646e-01; +5.376189845875243e-01   +3.110378904713049e-01   +3.010264497741618e-01   +4.163212651918738e-01   +1.868029616515127e-01   +2.056604598066176e-01   +2.337543922068109e-01   +4.413844421895174e-01   +3.867620824166797e-01   +4.856515008730178e-01   +1.959344096410915e-01   +3.747606380433526e-01; +4.002885486761192e-02   +4.430377026591321e-01   +2.392594595562131e-01   +1.848776993273222e-02   +1.000298997616591e-01   +1.124109056308420e-01   +6.246193676931105e-02   +1.736618062506785e-01   +2.386366345744483e-01   +1.250416570018685e-01   +4.435470978125700e-01   +3.858020574959312e-01; +2.184971552046003e-01   +3.925347846399425e-01   +1.897417588078319e-01   +4.925182789187028e-01   +6.995307134150507e-02   +1.053702201597983e-01   +1.363757269178746e-01   +1.700125308379312e-02   +1.271156362917788e-01   +5.722433164613950e-01   +3.926013848359160e-01   +7.172357090407043e-02; +3.579841542639923e-01   +3.937449260000983e-01   +4.263313394170153e-01   +3.770777047582491e-01   +2.933961004004296e-01   +2.103142969210703e-01   +2.150708489421977e-01   +4.581132565369440e-01   +3.590059935449276e-01   +3.144583028130518e-03   +4.499133287819046e-02   -2.211917226862457e-02; +4.880987851289870e-01   +4.773833513725583e-01   +2.996113104246489e-01   +3.757404693685946e-01   +1.540586264456380e-02   +1.246418304641461e-01   +3.211881257042973e-01   +4.840974503975380e-01   +3.540865662312744e-01   +4.506062409992663e-01   +3.771626727226997e-02   +5.252820088844378e-02; +8.919280928073288e-02   +1.601452753370595e-01   +1.684853552478653e-01   +2.316187879906015e-01   +2.065060060608675e-01   +1.927677581558725e-01   +4.493426106969171e-01   +1.462878277781248e-01   +3.159425877033236e-01   +4.337386338890852e-01   +3.243047883519247e-01   +5.175316524006760e-01; +3.621832857670463e-01   +1.934780916916208e-01   +2.909810923304320e-01   +2.453859244640620e-01   +7.917686618420017e-02   +3.079127398612330e-01   +2.496285262014919e-01   +5.355565633477308e-01   +4.041712298543712e-01   +1.892732008719848e-01   +1.938670342805900e-01   +2.954598391422503e-02; +3.549706030243692e-01   +4.019286089668055e-01   +3.993243272766799e-02   +8.282539086472440e-02   +1.065243939307335e-01   +3.787317525047836e-01   +1.550259240102949e-01   +3.436051630400033e-01   +8.609898371519509e-02   +1.582328205570277e-01   +2.872735583489758e-01   +3.527633072799751e-01; +2.005356253019675e-01   +6.371261805769717e-02   +2.499557555501746e-01   +5.337793915029833e-01   +4.761292582217302e-02   +5.191656241465227e-02   +2.897344536774265e-01   +3.600836212913914e-01   +3.586115449822259e-02   +9.785883873389895e-02   +1.934732417125649e-01   +4.560074771022078e-01];
L3E_L3I_iGABA_netcon = [+5.414523237777608e-02   +3.998689796220984e-01   +2.669048955208149e-01   +4.394251740165037e-01   +4.079515156465324e-01   +3.276822585640148e-01   +4.332151575428110e-02   +2.295232125126691e-01   +3.225824820038553e-01   +4.700687293424739e-01   +4.957700364688840e-01   +1.884434050854415e-01; +7.739077248449920e-02   +1.057245159696277e-01   +4.988553979019427e-01   +2.448704965629850e-01   +1.723396251309472e-01   +3.112605200104623e-01   +4.515418840667794e-01   +3.131337224781364e-01   +2.219564739013855e-02   +5.144767093033088e-01   +3.467766526274177e-01   +4.371171245720244e-01; +3.721213078541588e-01   +3.482987569355064e-01   +4.666046200844944e-01   +4.076856676567791e-01   +1.159374636232798e-01   +4.678711763868836e-01   +2.313665834219160e-01   +1.439388829259829e-01   +3.304103527744131e-01   +3.312282072961476e-01   +4.132894334384208e-03   +3.551548088803029e-04; +3.734541006922860e-01   +4.000608859966718e-01   +1.119804804629024e-01   +9.721269849070700e-02   +1.663501678731976e-01   +4.795993383924146e-01   +1.943531454334096e-01   +2.473022596870467e-01   -5.526603459913279e-03   +9.403986599738439e-03   +4.575805391610883e-01   +7.966664264040023e-02; +3.302263811066412e-01   +4.627485410390010e-01   +5.675872908813951e-01   +2.385921991540307e-01   +3.856097505568076e-01   +2.332469685533775e-02   +4.063840915602490e-01   +1.441621125218473e-01   +1.247231115411901e-02   +4.653855428834905e-01   +2.527537940048653e-01   +2.739961947088097e-01; +1.383353734898227e-01   -2.618317842781671e-02   +4.963183211346552e-02   +4.657316669661578e-02   +1.206804823491135e-05   +4.341215311307360e-01   +1.596395337851262e-01   +4.108473801793871e-01   +5.114688573442631e-01   +4.736887188949114e-01   +4.541974004443021e-01   +4.482595895256472e-02; +4.795760791451733e-01   +4.695584436026971e-01   +2.451553692089759e-01   +8.785197970723693e-02   +3.247270744509288e-01   +3.953140472151457e-01   +4.848517733547901e-01   +4.547530464386095e-01   +3.939610307587302e-01   +5.081964550638700e-01   +3.723320125016547e-01   +1.042210504125182e-01; +2.694788541295571e-01   +3.042501496985867e-01   +3.248507002704779e-01   +4.751633152749458e-01   +2.784276808553708e-01   +1.187840304481496e-01   +1.700265004431574e-01   +2.452053162323029e-01   +2.529763083812664e-01   +2.595615671298003e-01   +2.866176907885812e-01   +3.474592232969939e-01; +4.685359072948744e-01   +1.562840843130273e-01   +4.739537531129574e-01   +2.970852093243468e-01   +4.452444980775564e-01   +1.830606404858032e-01   +3.021567401307616e-01   +2.463113623314176e-01   +2.899619287521960e-01   +4.895883228307736e-01   +4.041791033003826e-01   +5.072259487745914e-01; +2.851624178227717e-01   +2.717191313991789e-01   +3.422974374763901e-01   +9.026416210526791e-02   +6.160300070434273e-02   +2.876827209253876e-01   +2.297227056417799e-01   +1.285418182891450e-01   +2.788737231579743e-01   +2.329430639994097e-01   +2.399934933511066e-01   +1.427964473783495e-01; +2.542092631688138e-01   +3.923571227655722e-01   +2.219669193667215e-01   +4.226064922926550e-01   +1.149501085375981e-01   +3.097558386121288e-02   +1.149356573050879e-01   +3.514002709537910e-02   +2.429508792697403e-02   -1.566477085705077e-02   +4.866956019513691e-01   +3.455791771452843e-01; +9.089540123889317e-02   +2.322187690163891e-01   +1.871130009324111e-01   +1.937418293683338e-01   +3.631964385525222e-01   +1.285343636971088e-01   +3.335611892181641e-01   +2.612227444226369e-01   +2.129630112393687e-01   +5.393648180146997e-02   +4.416632231561606e-02   +9.368107105326434e-02];
L2E_Input1_iAMPA_netcon = [+1.313282545633961e-01   +1.189568939047871e-01   +3.103000928614923e-01   +1.964946231606442e-01   +2.973377605427187e-01   +3.406420236004881e-01   +3.605590093053027e-02   +3.235351570664130e-01];
L2I_Input2_iAMPA_netcon = [+2.364227836551791e-01   +2.038329521436534e-01   +4.964665761489330e-01   +4.914982331726936e-01   +2.656543768581905e-01   +2.776745160696886e-01   +3.326663446195299e-01   +4.306024030358915e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
