function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.464009649621758e-01   -6.032840344795301e-02   +7.569106171779040e-01   +3.466788593658188e-01   +1.732847088536191e-01   +5.739361651616796e-01   -3.919457981687602e-01   +4.977394656515017e-01   +3.523932610919923e-01   +8.656073394666168e-01   +1.631095047840550e-01   +8.014548978379191e-02   +2.613836581817416e-01   +4.217283338643288e-01   -1.078211772014877e-01   +4.351858014554527e-02; +2.142697398220004e-01   +3.330111578425871e-01   +1.136077914451309e-01   +9.149578182836218e-01   +2.616085805877228e-01   +2.185184986641769e-01   -4.703796088779136e-02   +6.467231552591384e-01   +7.201460750272074e-01   +5.471282456753579e-01   +7.147215968710288e-01   +5.806421540141946e-01   +1.907857849848684e-01   +6.180529750686333e-01   +3.083823071281350e-01   +2.290432420754834e-02; +7.918306606175907e-01   +1.643383104381966e-01   +1.547092852755635e-01   +2.544245651975125e-01   +2.361811344535834e-01   +1.538048997076102e-01   +7.596883747219070e-01   +3.685279244388114e-01   +3.641550278703309e-01   +5.855354403345835e-01   +3.119607660590900e-01   -8.599334858989237e-02   +1.397721955528780e-01   -3.235067900970444e-01   +3.487758860718609e-01   +3.013276441790815e-01; +3.909514649990149e-01   -1.216613707392740e-01   +1.193542517628006e-01   +4.928304772461965e-01   +2.428455508388868e-01   +1.816705275557339e-01   +9.284948722849725e-01   +9.530284972362710e-01   +4.079441296752710e-01   +2.336145055730088e-01   +4.187221530636480e-01   +6.713878408234950e-01   +4.842737920866042e-01   +3.788585798497650e-01   +1.756914495333474e-01   +4.016448885191552e-01; +8.351459526911074e-01   +5.288077616650666e-02   +6.698734224402491e-01   +9.755598975981673e-01   +5.163128629480044e-02   +3.887642301563020e-01   +5.324121096899768e-02   +6.215125961123077e-01   +3.013579712900036e-01   +6.310303181688954e-01   +5.865440594862368e-01   +1.704069494451634e-01   +1.795652318940157e-01   +2.957477065254754e-01   +6.119973473754596e-01   +2.620219587553681e-01; +1.167494929442807e-01   +5.387071528902826e-01   +3.673116574301699e-01   +1.787186734098823e-01   +8.374782436569981e-01   +4.067631598176174e-01   +9.442055842028056e-01   +2.485541764728262e-01   +3.287740357687362e-01   +1.806323508263186e-01   +4.618284735579959e-01   +1.853182142579696e-01   +5.960670023135932e-01   +2.119087451546625e-01   +1.487202375530493e-01   -1.243536852384250e-01; +4.597132351101167e-01   +4.492009224409448e-01   +3.836602542270838e-01   +1.777136390191291e-01   +3.507981305148974e-01   +3.247376571685390e-01   +1.917406197997220e-02   +4.392447412921024e-02   +8.445395804207555e-01   +3.829414495563925e-01   +2.354642306754592e-01   +4.338103590173530e-01   +1.798052794300438e-01   +5.083126204641119e-01   +6.884965052807714e-01   +4.863744146612151e-01; +3.730998711848711e-01   +6.069082806769848e-01   -1.580506599303097e-02   +9.295782624656106e-01   -1.084583962352347e-01   -1.725632899983115e-01   +5.632319422612874e-01   +6.428546319658566e-01   +7.112497211340628e-01   +3.870437781184565e-01   +3.724010570413002e-01   +4.766084604897107e-01   +3.471315440874620e-01   +2.924391975261413e-01   +7.911369954834877e-01   +6.426464528400547e-01; -3.019095049132116e-02   +6.576351450927332e-01   -1.289036851822874e-01   +4.885643461306611e-01   +3.586279024729445e-01   +6.878730864774815e-01   +6.405027188710072e-01   +1.393955667348167e-02   +2.574170141750750e-01   +3.543750405763008e-01   +6.983727412879852e-01   -1.507449381082714e-01   +5.235802016723399e-01   +4.005710159767463e-01   -1.698121318721283e-01   -9.319080472338735e-02; +1.729941042954783e-01   +2.313491842808308e-01   +7.526173730017752e-01   +6.167916675127947e-01   +5.844619682104908e-01   +4.143349075028868e-01   +4.182778307928375e-01   +6.194512469058373e-01   +4.569932303499665e-02   +3.576740192767229e-01   +2.765023468124696e-01   +3.868819678573668e-01   +8.200205289978859e-01   -7.371284278000784e-02   +3.321730105391797e-01   +6.488328496182709e-01; -1.780502337071584e-02   +6.317671628430318e-01   +4.212146890434277e-01   +2.542183149925969e-01   +8.435717624687005e-01   +6.244993953454393e-01   +5.640884539205462e-01   +2.322195924734810e-01   +3.024924593380459e-01   +4.345168305942782e-01   +3.115564080937466e-01   +5.220514199803722e-01   +1.506663821873780e-02   +5.306816701042651e-01   +5.843425510792857e-01   +5.147539453206332e-01; +6.724124337628413e-01   +1.249838575927736e-01   +6.631171938413645e-02   +9.861721417524867e-02   +3.093376225199861e-01   +7.874977017041818e-01   +2.603760423839246e-01   +4.591774063174192e-01   +9.036064429496345e-01   -2.873614278940523e-01   +9.869986222704481e-02   +5.102910294838870e-01   +7.385047050161991e-02   +3.061548860270447e-01   -5.763443945078503e-02   +5.257186860604729e-01; -3.207888417265829e-01   +2.065317736375883e-01   +5.684197478944693e-01   +5.523344673945401e-01   +7.678449971365998e-01   +4.780973526479959e-01   +1.629454449249823e-01   +4.596340614667566e-01   +8.589878432015342e-01   +6.886459165115753e-01   +2.463490118314232e-01   +1.420219514632651e-01   -6.099471908336677e-02   +1.787112850714161e-01   +3.665107097340194e-01   +2.823102998605851e-01; +4.091508537573944e-01   +5.395542291634773e-01   +4.106762392450266e-01   +1.239872752444394e-01   +9.655805248658146e-02   +4.756565011179010e-01   +4.083826483733496e-01   +5.452458381331953e-01   -4.933299931466617e-02   +2.126219203463033e-01   +6.714600817177364e-01   +5.254311833497912e-01   +5.812760751870532e-01   +3.571181331238837e-01   +5.079364836103313e-01   +2.248586356291167e-01; +5.647252014457329e-01   +2.981210355571656e-02   +5.000324878528829e-01   +7.917682148252739e-01   +1.257869503810929e-01   +3.591318588190698e-01   +4.684015075597577e-01   +1.640213172193571e-01   +1.719009170081528e-01   +2.208396846413568e-01   +1.865292366697025e-01   +5.527531169358307e-01   +5.846813158580514e-01   +4.235497224827423e-01   +4.421624394278931e-01   -1.445492074993989e-02; -1.238960905454833e-01   +3.231089938804469e-01   +6.265835655275698e-01   +6.687636446287116e-01   +7.688768155951119e-01   +7.137985967026712e-01   -1.184979838643723e-01   +8.101221042191907e-01   -1.380624375239243e-01   +6.649645084858309e-01   +4.424504423167201e-01   +4.207331510236749e-01   +1.689955228597925e-01   +7.953086893011149e-01   +6.039776223254618e-01   +1.214268772934720e-01];
L1E_L1I_iGABA_netcon = [+6.382153274829843e-01   +5.866603514124528e-01   +3.514331420501080e-01   +4.285226370670605e-01   +2.168763679281042e-01   +2.901753894005650e-02   +3.470963654561215e-01   +3.686109648124246e-01   +1.074103119289569e-01   -9.041689686505341e-02   +2.822441209984592e-01   +1.763406399627762e-01   +5.531535354368283e-01   +1.204341799983362e-01   -2.093046966031130e-01   +1.000000000000000e+00; +4.500168205493281e-03   +5.207908182264651e-02   +4.712337419315353e-01   +3.603539316437061e-02   +3.663037713976767e-01   +6.034929387897583e-01   +4.848596489214066e-01   +3.388562636959493e-01   +4.499618380602509e-01   -4.776965673151185e-02   +2.821041219795544e-01   -3.012742755988287e-02   +8.758220716596516e-01   +4.543138004431359e-01   -8.497003874519149e-02   -1.806388023750254e-01; +1.805852514207978e-01   +3.781168679271001e-01   +3.180625911912502e-01   +2.665978790596010e-01   +3.270860340911662e-01   +1.742484627478189e-01   +2.479439155069916e-01   -1.858031681073744e-01   +2.579015389542986e-01   +7.661358817183462e-01   +3.806663136266525e-01   +3.757227942785948e-01   +2.058763421011660e-01   -1.321100511487712e-01   +2.689090446066468e-01   +5.743058645306941e-01; +6.219857059464575e-01   +1.004507207619754e-01   +1.131677997575626e-01   +4.693652348711987e-01   +7.558090267901135e-03   -1.363034212839942e-01   +2.182483955314948e-01   +1.296629829831843e-02   +2.180862586590186e-01   +1.377629105808272e-01   +1.012894252715732e-01   +8.358822253336904e-01   +1.280705582711578e-01   +3.959180402814486e-01   +1.663330763364995e-01   +3.544772714584563e-02; +2.002902588817993e-01   +3.773568076451758e-01   +8.594214743441961e-02   +1.368607936960191e-01   +5.439166083618772e-01   -4.723045412941448e-02   +1.992536188718215e-01   -8.342801499077217e-03   +3.394300473052011e-01   +1.443276387988451e-02   +1.748041350428370e-01   +2.228403795065426e-01   +3.739723877302666e-01   -1.525525009512881e-01   +9.900636622331996e-02   +4.494530702615734e-01; +7.424824803089517e-03   +3.601538084735917e-01   +6.634242639117248e-01   +2.643654953219939e-01   +4.637322291496007e-01   +4.108855165215902e-01   +6.830546257607022e-02   -7.800573213974796e-02   +1.954613105020062e-01   -7.456657837812819e-02   +2.413102733788146e-01   +4.744949079231121e-01   +1.984753455657334e-01   -2.956840262962743e-01   +3.835756242025426e-01   +4.906785751081110e-01; +3.642998962418488e-01   +1.691663127163127e-02   +1.792534848148331e-01   +2.210323856422579e-01   +5.315323791364927e-02   +3.294860499977832e-01   +1.482947224244859e-01   +1.956807184248509e-01   +1.587992840607830e-01   -1.763382291411245e-02   +4.063923821038635e-01   +3.623137784454150e-01   +5.125873570637656e-01   -3.697357213474479e-02   +1.772132804591801e-01   +1.127865143429073e-01; +2.744665447957051e-01   +5.066326609807912e-01   +1.099173144055063e-01   +4.990110382888875e-01   +2.014389684043202e-01   -1.329016359536993e-01   +1.248748791951784e-01   +5.614574517367883e-02   +7.171932855141048e-01   +5.473961358953429e-02   +2.780542647807822e-01   -6.628180215000043e-02   +3.665352085278920e-01   +2.401314195760582e-01   -5.098925559270339e-03   +5.093966237854598e-01; +3.920167265062149e-01   +1.885340722841881e-01   +3.266401817218378e-01   +1.075922943906463e-02   +6.844869889245374e-02   +6.982177981114476e-01   +2.502822430926789e-01   +1.125759954744660e-01   +4.495426769723904e-01   +4.610338847437228e-01   +2.716896260948726e-01   +3.872429698212015e-01   -5.024718105696357e-02   +5.077947263594793e-02   +5.412174160901039e-01   +4.670181037547253e-01; +1.355709995027546e-01   +5.028911818454830e-01   -1.850701001916820e-01   +4.475402184051469e-01   +7.050537234152318e-02   +5.122429673488449e-01   +3.568746341022017e-01   +2.448240925884065e-01   +4.456386228273058e-01   -1.779575336265250e-01   +9.828875884840971e-02   +4.812730616956485e-01   +3.837281868064223e-01   +6.404846328593523e-01   +1.110589069022463e-01   +5.561859138326658e-01; +2.319883208160273e-01   +1.292656636262881e-01   +1.659782143591295e-01   +2.163036309421918e-01   +2.871968497602819e-01   +3.930455782301698e-01   +3.424234871218130e-01   -2.254004139577174e-03   +4.719298653523669e-01   +2.126550961760339e-01   +6.451700584014157e-02   +4.170984878393689e-01   +2.734391271741944e-01   +1.416894314077512e-01   +2.871461825556113e-01   -6.623984056842848e-02; +4.802975911266602e-01   +2.181033625652503e-01   -6.613245380168538e-02   -4.214654160312234e-02   +2.963520717626729e-01   +2.281394388093485e-01   +4.149681316322454e-01   +5.677137243632018e-01   -7.005878797499168e-02   +1.622510282851912e-01   +4.962486793150176e-01   +7.206457569525037e-01   -3.130439484770835e-02   +1.606529028847669e-01   +1.959815269495018e-01   +3.167494366528544e-01; +6.070729976754102e-01   +4.323546948391998e-01   +1.627762978956362e-01   +5.807677700429295e-01   +5.785128408927386e-02   +1.494078784441151e-01   +2.062176120890083e-01   +2.724437242443524e-01   +1.431661727329695e-01   -6.253731070667454e-02   +4.281271216062645e-01   +8.586096502164434e-02   -7.516094556076734e-03   +2.086537041598015e-01   +5.217304144789194e-01   +1.137163668875556e-01; +5.604588319662543e-01   +3.794027610082737e-01   +3.704239738944399e-01   +3.138493308037638e-01   +1.493929565740205e-01   +3.779719054422834e-01   +5.146163882168402e-01   +1.505617007337604e-01   +5.757089098993408e-01   +1.897052600636109e-01   +4.183085636829211e-01   +2.551424603051453e-02   +2.188417075071075e-01   +5.986171048832547e-03   +2.677604759953081e-01   +1.968283555594880e-01; +6.802127212834228e-01   +1.260209348749380e-01   +3.054415536953420e-01   +1.467291721604566e-01   +1.241422896776184e-02   +2.795385499040035e-01   +6.883218533158869e-02   +3.638527407297125e-01   +2.206835439196824e-01   +3.182395113541286e-01   +6.660999964094158e-01   +1.791501176619065e-01   -8.200808123722525e-02   +2.599816507386815e-02   +3.598960547367316e-01   +3.930852548318047e-01; +3.461294374701009e-01   +9.375309100166094e-03   +5.102206393024297e-01   +8.276534906180631e-02   +5.622261107414734e-01   +4.226617584575274e-01   +3.812828858541344e-01   +2.865574829638207e-01   +2.392185437203745e-02   +2.420431116370125e-01   +3.883328659008110e-02   +4.089364116225996e-01   +4.380201773798346e-01   +3.478061373930446e-01   +1.839438500227376e-01   +4.483666299922596e-01];
L2I_L1I_iGABA_netcon = [+3.518942026883485e-01   +7.519146322141959e-02   +4.684733600997593e-01   +4.162973804352142e-01   +1.008903576157782e-01   +6.590688833997868e-02   -7.573649590517523e-02   +2.997065210147080e-01; +5.186071894549407e-01   +1.000000000000000e+00   +2.362454458418440e-01   +3.695404882285919e-01   +6.432152661275338e-01   +2.547177154981189e-01   +6.252963801013046e-01   -6.537229519507519e-02; +3.180526532866509e-01   +4.183297542004337e-01   +6.328449490684159e-01   +2.227330587456851e-01   +7.557807256575771e-01   -4.344285330206163e-05   +1.734596506762094e-01   -2.033046331854197e-01; +6.170431791724612e-01   +2.564388773250209e-01   +1.056761304970771e-01   -3.096295115516071e-02   +8.215345829440629e-01   +3.826678894431546e-01   +4.508731291429587e-01   +5.731263643677753e-01; +5.785558117805097e-02   +7.355596333182510e-01   +6.592340026181691e-01   +4.253269155603838e-01   +5.726699691141163e-01   -1.752714858051209e-01   +5.669987123392555e-01   +2.870405824728599e-01; +4.886567089301437e-01   +2.446126973246075e-01   +4.923350791627368e-01   +6.298065821868800e-01   +3.529605900258493e-01   +5.715505426657269e-01   +4.218506705433361e-01   +6.250566097376259e-01; +6.781005707523554e-01   +7.957474724373921e-01   +6.128760176014412e-01   -7.080835116126773e-02   +5.876886025362655e-01   +2.028344727628570e-01   +5.764998152005524e-01   +1.302312461788213e-01; +3.764847920844143e-01   +4.187924231520505e-01   +4.652431797913249e-01   +3.285761144830154e-02   +1.918985337942989e-01   +8.625608861711560e-02   +4.563145767183215e-01   +2.305787242765975e-01; +7.870467183964730e-01   +8.702777028490369e-01   +9.408516791303688e-02   +7.653875262885340e-01   -2.538867843520158e-01   +1.764883336188035e-01   +3.662412686120027e-01   +4.026390131909359e-01; -1.875395296891507e-01   +7.067623676497546e-02   +1.889877011989603e-01   +6.802430915695888e-01   +8.206420018988902e-01   +9.466922951353099e-02   +3.639899045844497e-01   +7.043385954056374e-01; +3.498385866272762e-01   +5.000784994674145e-01   +5.936230954126201e-01   +6.838494874596928e-01   +2.611379293389369e-01   -6.250839542547071e-02   +2.991673029096351e-01   +1.304844273506074e-01; +2.394744954739328e-01   +4.793137962596492e-01   +5.258119992214646e-01   +2.917830565285435e-01   -1.863562250449288e-02   +5.374840279644899e-01   +1.564742774658708e-01   +4.785656562726857e-01; +1.506329704977850e-01   +4.487714748929267e-01   +8.670656879039831e-01   -1.158721347201878e-01   -6.511941868805919e-02   -5.261470726371249e-02   -2.411073542041212e-01   -3.112940879314212e-02; +2.095976317596386e-01   +3.615918227425573e-01   +1.190541182153326e-01   -3.261457900385973e-01   +5.839882954463343e-01   +3.415456018792793e-01   +4.553446228426244e-01   +9.866557416912222e-02; +8.584149428848779e-01   +6.929484871573675e-01   +6.301410922179542e-01   +8.470038248256514e-01   +5.781191679087154e-01   +8.096455820923317e-01   +4.429974813032845e-01   +8.084056289581477e-01; +1.302095749457158e-02   +1.528265066466477e-01   +7.237001907726529e-01   +1.367294009951347e-01   +1.463183702189595e-01   +1.959308133877702e-01   +5.220514629356950e-01   +7.959600526674234e-01];
L1I_L2I_iGABA_netcon = [+4.638683267290896e-01   +4.872882276706735e-01   +1.171119639047885e-01   +6.211634930573132e-01   +2.448706337808714e-01   +2.724812046086521e-01   +5.067274324318651e-01   +4.403336535093218e-01   -3.074778863363099e-01   +6.513364402565957e-01   +1.560927365599075e-01   +9.486613147904056e-02   +4.428689404762497e-01   +3.284818892208512e-01   +3.088031984800579e-01   +2.444560016510943e-01; +2.515895249634842e-01   +4.172645698872871e-01   +1.417983620803285e-01   +2.298610302143074e-01   -1.344054104758400e-01   +5.179437719926820e-01   +7.337260275568964e-01   +2.058842085005569e-01   +4.660115554914199e-01   +4.663497553440238e-01   +3.315285861988563e-01   -6.228357948922555e-02   +3.173013725656476e-01   -2.411050274217151e-01   -4.794335067167184e-02   +5.563761595241969e-01; +2.450451872074594e-01   +1.569831903610724e-01   +5.337099479266303e-01   +3.635869658850554e-01   +2.628921180659293e-01   +5.610319491639278e-01   +2.335093376706442e-01   +7.060448221283329e-01   +7.817631995155908e-02   +1.094818191341097e-01   +1.174146636416453e-01   +4.053354134208593e-01   +3.214086245933199e-01   +5.550350488379381e-01   +4.123972752087692e-01   -1.144182318264599e-01; +3.374941696434623e-01   +3.005132152665619e-01   +1.056557244094659e-01   +1.076655723787438e-01   +5.668725450216781e-01   +2.312468043679377e-01   +3.966446686106484e-01   +6.268094509330604e-01   -5.485095123266514e-02   +4.044583506214203e-01   +4.581931770053128e-02   +1.268830949960875e-01   +5.207251588102233e-01   +4.348433371390267e-02   +4.372556451906260e-01   +1.352646598054187e-01; +3.504331144861725e-01   +1.288963649337940e-01   +4.795421206437612e-01   +4.817148102386706e-01   +1.935947932756548e-01   +9.375176842655939e-01   +5.852131678169170e-01   +1.602861715974683e-02   +2.483106732350918e-01   +1.843268783997535e-01   -9.912974748546556e-03   +7.313933191056937e-02   -1.645524176606001e-01   +4.434293760812115e-01   +4.651799108977748e-01   +6.384809679146950e-01; +3.090370478016543e-01   +4.094428874917677e-01   +5.843132475918095e-02   +8.052433294188733e-01   +2.294648817783939e-01   +4.443325022586553e-01   +3.440085334451136e-01   +2.473559402643762e-01   -3.497525916911343e-03   -2.268784782610927e-02   +4.401322768205749e-01   +7.899232823260285e-02   +5.463678508139955e-01   +6.387497793470546e-01   +2.242706160996796e-01   +3.443689384623316e-01; +6.057050033206486e-01   +6.115252426362234e-01   +2.883759420017284e-01   +5.287555777556332e-01   +4.821957151500658e-01   +3.392993411173996e-02   +5.339850622850039e-01   -4.593044177330329e-02   +6.238177917955340e-02   +4.634724728662057e-01   +2.356257340233109e-01   +2.060870677291591e-01   +1.036311045662933e-01   +3.361883245666545e-01   +1.542890090906201e-01   +5.409790196484638e-01; +5.311913399283426e-01   +2.439768292155679e-01   -2.273581727593666e-03   +3.915817856479318e-01   +5.332307649766483e-01   +5.833390696659244e-01   +3.682740744257910e-01   +1.696138523009019e-01   -1.011526064015069e-01   +2.656414061267821e-01   +7.907483280784069e-01   +5.330060708620520e-01   +6.673824502698211e-01   -6.054992304763639e-02   +5.115561657665211e-01   +5.022454981321804e-02];
L2E_L1E_iAMPA_netcon = [+5.455143929266845e-01   +2.941588965142750e-01   +2.428435176139006e-02   +3.338468200619658e-01   +4.078138567054870e-01   +2.806810453823587e-01   +2.338651106960395e-01   +2.983056791606622e-01; -8.170101543759632e-02   +5.138765643698269e-01   -7.757171301698290e-02   +2.290873395428073e-01   +1.121118270135682e-01   -1.495976460669746e-01   +1.962986901538908e-01   +4.261292532296737e-01; +2.574236261071248e-01   +5.618225937311228e-01   +4.505019037776478e-01   +2.321134637086879e-01   +4.784090918451352e-02   +5.371235024867326e-01   +4.911441898597724e-01   +4.122123090154024e-01; +3.830988242341432e-01   +1.429367075663106e-01   +4.448586754888652e-02   +6.015731118634366e-01   +4.861627723700038e-02   +9.225418432043589e-02   +2.047213837037888e-01   +1.875195761233630e-01; -2.187547098705440e-02   +3.352928053831194e-01   +2.188305798981543e-01   +1.759370114198037e-01   +7.195479199460627e-01   +5.549688265745352e-01   +9.978191627001138e-01   +6.248157804071244e-01; +4.063844997729955e-01   -1.043220020548661e-01   +5.646818664670866e-01   -1.881956707464359e-01   +4.723640823441118e-01   +4.384081881117658e-01   +7.281858118894581e-01   +3.238329672293014e-01; +2.361797504141230e-01   +4.018928413694558e-01   +7.666477962651613e-02   +5.245898749222851e-02   -1.314828124391151e-01   +1.513016860231968e-01   +7.439985639217824e-01   +5.670491054822181e-02; +1.474067019739851e-01   +4.519480736675058e-01   +5.748320924019059e-01   +7.687722867192436e-02   +4.310657470283955e-01   +2.910144969949960e-01   +4.522475033764136e-01   -1.644637568528024e-01; +5.680632728437962e-01   +1.487645270298016e-01   +2.855680835893757e-01   +7.465943902779466e-01   +6.926027084871250e-02   +5.552166342801818e-01   -2.069911560641290e-02   +5.062066133692297e-01; +4.103091691030307e-01   +5.976955477891374e-01   +4.129146450913515e-01   +4.042019549333213e-01   +3.636695170884023e-01   -6.386866707442880e-02   +3.069278173174789e-01   +4.323169781337650e-01; -2.566606071486552e-02   +5.712875172170951e-01   +2.030306285372517e-01   +3.197635050830733e-01   +4.477594123397682e-01   +3.865339895992613e-01   -1.955809441494169e-01   +4.135341353379856e-01; +1.696525157125838e-01   +2.498898146341602e-01   +5.664334977990708e-01   +6.796515774621353e-02   +3.158156155905752e-01   +1.887149158215114e-01   -4.658662931705942e-01   +3.316988769526439e-01; +1.724254243864037e-01   +3.762344740308950e-01   +1.368174342597610e-01   +5.507655242859530e-01   +2.777898096554022e-01   -9.786022357787849e-02   +5.440859849546971e-01   -9.779261146187235e-02; +1.803850691074966e-01   +2.346403006198747e-01   +7.772416976630434e-02   +4.301705447513743e-01   +1.581475610812490e-01   -1.442968883100878e-01   +4.204793912632216e-01   +3.243179660327681e-01; +1.295475723346765e-01   +3.855126453197367e-02   +7.137829310235251e-01   +3.873780018182224e-01   -1.231531236731482e-01   +5.929146834928151e-01   +1.884048259942795e-01   +9.717367794024877e-02; +4.334967153369138e-01   -6.569875192977717e-02   +2.328879024532324e-01   -9.315376917736817e-02   +5.894759408900929e-01   +2.150839520600515e-01   +2.748861868122525e-01   +5.565572620079914e-01];
L1E_L2E_iAMPA_netcon = [+1.680818718701830e-01   +2.685046736714113e-01   +2.705177384815274e-02   +4.701521914016408e-01   +1.210337239743914e-01   +1.991059821623644e-01   +3.365642601246543e-01   +2.489894547492002e-01   +5.287446441968238e-01   +4.334011947447305e-01   +5.981548426694286e-01   +7.346436347573028e-01   +6.741827388079299e-01   +2.849148479292781e-01   -1.084023368142970e-01   +1.819407012974633e-01; +4.698948197472504e-01   -1.008023961440653e-01   +1.846905853426440e-01   +3.474038130379588e-01   +3.578188984973996e-01   -2.398056269775195e-02   +1.239263183474223e-01   +3.020992042897480e-01   +1.543749961730779e-01   +3.267609683684758e-01   +3.604395500505175e-01   +7.104788336436044e-01   +3.395736627293267e-01   +2.381449708193740e-01   +3.264647873468378e-01   +2.426589137956549e-01; +6.747394032934785e-01   +3.087880063925297e-01   +2.872383403530300e-02   +9.800453721169328e-02   +4.676385827466008e-01   +4.304191433419546e-01   +9.083898618469707e-02   +7.563899871341337e-01   +4.767565622999044e-01   +2.614858116086450e-01   +3.441426181995749e-01   +3.983744101882976e-01   +8.457598424747605e-02   +5.022195282992985e-01   +2.974485479518987e-01   +2.912251355348690e-03; +3.076260562500998e-01   +4.319023948893880e-02   +8.473886893867943e-01   +5.704477920037927e-02   +1.491263169204303e-01   +1.284510150245972e-01   +9.767683689176120e-01   -1.477038990723521e-01   +3.851256744103166e-01   +4.337259360508746e-01   +6.634066043732848e-01   +1.590126661989156e-01   +1.216655117647538e-01   +3.242869074800735e-01   +4.808164772958520e-01   -2.507535985032408e-02; +2.257762190884998e-01   +1.346704405310252e-01   +8.820712285011749e-01   +4.503873495121615e-01   +4.555801022483171e-01   +6.956626887156897e-01   +4.642677201694221e-01   +3.209952854084226e-01   +7.962363776089910e-01   +3.427807521547398e-01   +4.498908662367533e-02   -8.469611738083639e-03   +4.804540696255823e-01   +5.080182579271988e-01   +8.253310496622128e-01   +1.114261669020272e-01; +3.295143103522624e-01   +6.616474037333365e-01   +2.075951083659527e-01   +4.435809249418503e-01   +1.526799499317838e-01   +1.015025077503921e-01   +6.106826975106610e-01   +3.161154447765279e-01   +5.613287739377689e-01   +3.079552011200815e-01   +6.541393991582358e-01   +1.894631518820986e-01   +8.163750279996682e-02   -8.311921882593001e-02   +9.006482421279274e-02   +3.369711229235473e-01; -6.128436839002622e-03   +2.234898385388806e-01   +4.764451653052322e-01   +6.722825651494627e-01   +3.610564689477544e-01   +2.378780106131434e-01   +8.156729225880154e-01   +2.990111517814802e-01   -1.390292512828034e-01   +1.588066455468902e-01   -8.502959143827041e-02   +8.055674254958952e-03   -3.138801857011894e-01   +2.818965971220059e-01   +3.878839617338247e-01   +9.875944853090421e-02; +5.224568914425384e-01   +2.977604617610511e-01   +6.057878698670073e-01   +6.508035067054153e-01   +7.628616898682559e-01   +8.600064165516460e-01   +6.709554334839742e-01   -1.315235557556129e-02   -4.276874653241638e-01   +3.805878077622483e-01   +6.653568386153619e-01   +3.950852582768118e-01   +1.871709322977068e-01   +5.847918413575049e-03   +3.091482704004359e-01   +3.032537819075216e-01];
L2I_L2E_iAMPA_netcon = [+5.786793343860649e-01   +7.383830240294879e-01   +5.026959803969386e-01   +4.720139824195855e-01   +5.934996183701398e-02   +8.276130876678485e-01   +4.085023745620837e-01   +4.199154572392925e-01; +7.866436943527837e-01   +2.303500086731101e-01   +7.774797629967934e-01   +7.180268507248743e-01   +6.326953248562582e-01   +2.834243022420081e-01   +3.309338556656412e-01   +3.390694927035878e-01; +4.992349625052276e-01   +4.469530909350095e-01   +4.838899085198631e-01   -6.351818464929460e-02   +7.877882319469941e-02   +4.365425716468415e-01   +4.240355815818715e-01   +3.104663763634863e-01; +3.849134117464613e-01   +4.614257784295124e-01   +2.525130771835223e-01   +8.335938581463852e-01   +2.386452997450734e-01   +2.018075523040549e-01   +4.288701858259792e-01   +3.512064005012885e-01; +7.686562532931375e-01   +3.729961796181988e-01   +3.616043322880200e-01   +5.812930133433994e-01   +6.244012819468350e-01   +5.897242658884023e-01   +8.607256158070986e-01   +2.666942630830754e-01; +3.176904338326828e-01   +4.246315238264542e-01   +1.844553369935807e-01   +6.287572499612283e-01   +2.109719767253638e-01   +4.060120718053351e-01   +4.414113640200466e-01   +4.317731051816158e-01; +7.106024296707887e-01   +2.957099313878905e-02   -1.355350794601200e-01   +7.038562540586889e-01   +6.125430725008294e-01   +3.760744253826541e-01   +1.000000000000000e+00   +1.876848199741159e-01; +9.221635715393227e-01   +1.781860380905492e-01   -1.043844881661605e-01   +5.633559950645037e-01   +1.901342736183959e-01   +5.978483545711046e-01   -3.311760175983108e-01   +6.279207638771143e-01];
L2E_L2I_iGABA_netcon = [+1.028557632261309e-01   +2.498580536675072e-01   +4.552455006100817e-01   +2.468308853688492e-01   -7.854549831408349e-02   +5.489176514198792e-01   +2.054906209414994e-01   +5.313616809213260e-01; +3.778409145640989e-01   +6.144055054074345e-01   +5.832928965668858e-01   +5.534814093615306e-01   +7.026632448646315e-01   +5.222361076377418e-01   -1.679373730457520e-02   +2.795809276187224e-01; +5.474808994094213e-02   +8.277369784005773e-01   -2.173031967966415e-01   +1.432191407841646e-01   +6.949973666650875e-01   +7.256075220499681e-01   +6.239786614855188e-02   +7.961366297512305e-01; +4.977312350245815e-02   +7.024040834503522e-01   +5.347618989461912e-01   +4.705434983523243e-01   +9.792634141772287e-01   +4.607099042561764e-01   -1.451660719172231e-01   +2.405162363637085e-03; +2.341880771477365e-01   -1.879541339983424e-01   +1.758531389996504e-01   +5.825571656073761e-01   +3.735401348984279e-01   +1.564428719009903e-01   +3.132051613424360e-01   +9.965892989681206e-02; +7.854622099860190e-02   +2.573749080388825e-01   +2.078060529216444e-01   +3.207402406784869e-01   +4.510072516439495e-01   -2.179926200020908e-01   +4.665348605703372e-01   +8.634168138152026e-02; +5.482749854088526e-01   +2.851878824335192e-01   -6.000873937109424e-02   +1.314311473645539e-01   -4.348992017157342e-02   -2.404972333280685e-03   +3.630047574366366e-01   +7.392227140998763e-01; +4.764632725899702e-01   +5.478831558003502e-01   +3.806046429982163e-01   -3.410276663754964e-01   +5.753288411981805e-01   +2.990061791924493e-01   +6.487046167470202e-01   +5.123853781893766e-01];
L3E_L2E_iAMPA_netcon = [+3.649146707405640e-01   -3.892889996544405e-03   +8.140500021132650e-02   +5.377534144603703e-01   +4.816024715762421e-01   +1.055235151355088e-01   +3.334877484802888e-01   +6.024998952905790e-01   +3.801602954346067e-01   +6.930061684416175e-02   -3.664249609510534e-02   +6.142608997383977e-01; +4.282309972233221e-01   +7.557575338097340e-01   +2.185500553663823e-01   +7.061263392637862e-02   +1.827152412471659e-01   -8.660372774572594e-02   +9.664519977162071e-02   -1.095083669263605e-02   +2.626668528352750e-01   +1.127480795635313e-01   +1.615941978410070e-01   +3.214640608114695e-01; +9.839902492305637e-02   +1.979990526573647e-01   +5.964691841491758e-01   +2.821884818585310e-01   +8.352878076923358e-01   +5.296520497232244e-01   +6.057209242495516e-01   +4.137672671062181e-01   +4.686195329702834e-01   -4.879093318517506e-02   +1.926166554995454e-01   +5.906557405497022e-01; +8.801006296471647e-02   +3.194697102558286e-01   +3.397265170719031e-01   +7.772153405728320e-02   +4.511668254294453e-01   +2.667595408695613e-01   +1.550181439748221e-01   +4.003063951765922e-01   +3.839270962838341e-01   +4.387979077826795e-01   +8.311550623136323e-02   +1.783933900200358e-01; +5.365548480909312e-01   +3.413320463698692e-01   +1.919443978570082e-01   +5.663073430804232e-02   +5.507126074883129e-01   +4.581205040172983e-01   -2.352215515611938e-01   -1.997399686182845e-02   +5.028414356440852e-01   +4.728098175442061e-01   +7.127063856756745e-01   +5.786145374012710e-01; +4.831587601070226e-01   +6.419978411543140e-01   +7.493599166032088e-01   -3.659516331345855e-03   +4.243195114235366e-01   +1.000000000000000e+00   +4.683352239290042e-01   +6.089106289698352e-02   +1.757941924574844e-01   +5.482029114022634e-01   -1.156827950795015e-01   +3.940427332259291e-01; +2.203909986430065e-01   +1.854819631272264e-01   +6.779181550569529e-01   +9.648540756065023e-02   +6.583560722448287e-02   +5.705617648762673e-01   +2.789514982319096e-01   +5.241959573052114e-01   +5.211362470945934e-01   +3.194717212864116e-01   +5.112729023717773e-02   +5.974881749889958e-02; -1.669299092629568e-01   +4.601894901405563e-01   +1.523650628850512e-01   -2.742787985423843e-01   +2.311788263852331e-01   +7.466857890964619e-02   +1.975357184096910e-01   -2.904472440432069e-02   +7.715770862524390e-01   +6.284258456826864e-01   -2.241073907751162e-01   +1.852761498590044e-01];
L3I_L2I_iGABA_netcon = [+5.948191033850765e-01   +5.300502646649510e-01   +2.641057746500774e-01   +8.159766451919882e-01   -4.274329857013386e-02   +2.935502470608264e-01   +6.674994950876953e-01   +5.539015001130140e-01   +6.549644445542357e-01   -2.382659325812349e-02   +3.453441144351483e-01   +7.465319766305467e-01; +3.033148216312023e-01   +3.341279649185121e-01   +1.317239337505984e-01   +3.469283901290941e-01   +6.884114708291669e-01   +3.860783820634294e-01   +3.834209494225549e-01   -1.581635674051645e-01   +3.513534589203585e-01   +3.726492296207374e-01   +3.868598875653251e-01   -3.336163510172700e-01; +1.827128265735704e-01   +4.812334033336389e-01   +6.206994964773257e-01   +1.552361191019329e-01   -1.045265535014661e-01   -1.340166400705264e-01   +4.401364326082706e-01   +6.432815636334359e-01   +1.249642448628519e-01   +2.885363551913271e-01   +2.865837456362946e-02   +5.823011978279882e-01; +4.328788513238928e-01   +6.849926151481782e-01   +1.769186698126989e-01   -1.349217196842183e-01   +2.474845131437502e-01   +6.407156719820283e-01   -1.238380901657865e-01   +8.815982230706296e-02   +4.586623110400065e-01   +7.293809866943692e-02   +4.944306034812626e-01   +4.526491424135044e-01; +5.747218920630263e-02   +1.697892835190228e-01   +3.108283626751226e-01   +6.092341459338299e-01   +6.701748878685921e-01   +7.840363734985664e-01   +1.600459419895045e-02   +1.000000000000000e+00   +6.303117721417915e-01   +2.379258378973021e-01   +2.058199997453176e-01   +7.938825441791659e-01; -3.133274870200785e-01   +7.709353370978612e-01   +3.274348598215250e-01   +3.519809197096510e-01   +9.799056160194018e-01   -3.539593707866810e-02   +3.505954219611637e-01   +4.623258394651861e-01   +1.488067126849549e-01   +3.460092564107196e-01   +3.606294317509847e-01   +6.969475077780787e-01; +5.754273880262823e-01   +3.618191070991475e-01   +8.802485001899296e-01   +2.886094004146560e-01   -2.396651895992256e-02   +5.699598671691899e-01   +8.400432937806113e-01   +1.229900331394776e-01   -1.003108605389849e-01   +4.032735507405664e-01   +3.119501437082239e-01   +3.449825306158008e-01; -8.403713298105383e-03   +1.562099634160982e-01   +8.345856121440246e-01   +7.178359979130472e-01   -1.904298896316269e-01   +6.680857945070561e-01   +5.002018481118338e-01   +9.123201615981688e-02   +6.555377970949234e-01   +3.299461326518914e-01   +4.955697840202833e-01   +2.555600959400584e-01];
L2E_L3E_iAMPA_netcon = [+4.490462873564784e-01   -4.370923638004290e-02   +5.525993319977700e-02   +1.432189681110513e-01   -1.436540422789781e-02   +1.042418514082215e-01   +1.671944526729130e-01   -2.569074939470360e-01; +1.716221812080384e-01   +3.862662212739885e-01   +3.592311545200325e-01   +2.074158230309887e-01   +5.701807891118464e-01   +2.678251393481325e-01   -1.756318733909842e-01   -1.488087516858655e-01; +5.732252182200958e-01   -1.587048476802194e-01   +4.402552074612873e-01   +7.584829864639213e-01   +2.384501973239819e-01   +3.037351388747591e-01   +3.874823267418316e-02   +6.013193731168700e-01; +8.527116024432080e-02   +4.580218998012845e-01   +4.529295244196341e-01   +7.810835211101488e-01   +7.176027022587979e-01   +4.193136700259326e-01   +2.430036493720601e-01   -1.195656373845971e-01; +1.015855500361642e-01   +3.677548229529634e-01   +4.124257567701545e-01   +9.664613354547369e-01   +8.331948274109526e-01   +2.472560067178543e-01   -1.594056285753571e-02   +4.873179426844146e-01; +3.023470786935078e-01   +6.978088952878531e-01   +9.967375217985884e-01   +6.186874523186620e-01   +4.132194251763656e-01   +4.857372496909855e-01   +7.783965945191785e-01   +3.397653109115179e-01; -1.903727278613134e-01   +3.002241315272623e-01   +6.648528229464021e-01   +5.960711568413617e-01   +8.065550739865573e-02   +1.448976094085618e-01   +1.629629281146694e-01   +2.589535510166399e-01; +4.784509535866047e-01   +4.011333184828207e-01   +2.603977646206030e-01   +1.794660136282454e-01   +5.508310551772152e-01   +4.133021213794064e-01   +5.303453737993447e-01   +7.314230705470066e-01; +6.304629209304311e-01   +2.933480423119680e-01   +2.311584242118228e-01   +1.121703446731142e-01   +1.724073060818545e-01   +1.588091106508071e-01   +5.730124366682469e-01   +1.823061396059747e-01; -8.108528329365414e-02   +3.027901115259712e-01   +3.636680029543091e-01   +5.615116844416047e-01   +7.042707155406430e-02   -1.212247762711954e-01   +6.350366885072430e-01   +2.540261983077252e-01; +2.931183498855586e-01   -1.086050044110494e-01   -1.466089091641179e-01   +4.859029131223710e-01   +5.656740909032401e-01   +4.287980491600345e-01   +1.743869140554309e-01   +4.747637843921504e-01; -1.958593037967275e-01   +7.269776662993688e-01   +8.619312437867858e-01   +5.781173816654723e-01   -2.332377592371705e-01   -1.022612323549522e-01   +6.630449006275115e-02   +4.810202026070329e-01];
L2I_L3I_iGABA_netcon = [-1.642739773181430e-02   +2.195964359684785e-01   +7.448422052402029e-01   +6.537229894305647e-01   -1.972819637178223e-01   +5.787880604131184e-01   +4.365259546005746e-01   -1.313102623898433e-01; +6.877726700597625e-02   +3.821409114053542e-01   +3.168232904417947e-02   -9.898771538305944e-02   +3.892879489701687e-01   +2.534232949823195e-01   +2.594806922970772e-01   +4.650199350444481e-02; +7.651930753113229e-01   +4.239387212673598e-01   +2.406732518964587e-01   +4.217782883350326e-01   +3.781847125119109e-01   +9.404737121057702e-01   +2.540052535399129e-01   +2.135091799829750e-01; +4.005850397201317e-01   +3.615632218015942e-01   +6.061934513739339e-01   -8.328483534097925e-02   +3.762975142487419e-01   +3.172407378115070e-01   +4.913885332158938e-02   +4.753375132195195e-01; +7.329481817858948e-01   +7.491890333509265e-01   +1.026041923798289e-01   +2.499058455043269e-01   +2.960606443893838e-01   +5.091928197991875e-01   +1.894666402481567e-01   -1.071582286591018e-01; +2.428173737816283e-01   +3.976189704337630e-01   +6.870925609293660e-01   -4.101694580571242e-01   -8.675439586999528e-02   +5.501231570323900e-01   +2.592971028038952e-01   -1.648481421869051e-01; +8.174591938898265e-01   +5.697735882125545e-01   +1.411752732537950e-01   +5.869109174699919e-01   +2.939802763662285e-01   +5.016578769800570e-01   +6.812276548037376e-01   +3.747621069774058e-01; -5.575847554269590e-02   +5.056240100214824e-01   -2.401645760333767e-01   -7.727596650065789e-02   +3.950830126340118e-01   +2.273774878683078e-02   +2.785671723343989e-01   +4.478655100705111e-01; -3.112844425465950e-01   +4.620011234988223e-01   +4.430069634964569e-01   +1.448243699355950e-01   +3.849839351958935e-02   +6.342332730711516e-01   +5.167758040607559e-01   +4.655237726529406e-01; +6.455271669763943e-01   -2.190244952687237e-01   +3.561089306535070e-01   +6.373056571041717e-02   +5.089887247034557e-01   +5.338033736318171e-01   +7.666703441536152e-02   +5.606300614711529e-01; +5.888583523777037e-01   +2.732906737816661e-01   +1.444785857473613e-01   -1.081434550310929e-01   +5.362588357371402e-01   -7.169707947979423e-02   +2.475254099795998e-01   +7.168513378310447e-01; -9.539796864208683e-02   +6.328219041975944e-01   -1.241318093948316e-01   +3.390156717407227e-01   +8.564949617833643e-01   +1.929398814805895e-01   +1.739056424985861e-01   +2.528945052356651e-01];
L3I_L3E_iAMPA_netcon = [+6.803888681974328e-01   +5.549744397133554e-01   -3.737257368069782e-02   +5.417667156155609e-01   +2.142471303964872e-01   -1.357674954645282e-01   +1.392312713538217e-01   +1.904849591631893e-01   +1.145908141447879e-01   +2.922163681138609e-01   +9.915526251205938e-02   +4.714623207160917e-01; +2.942024633280430e-01   +3.209796170698965e-01   +4.441187452191989e-01   +5.352345889416354e-01   +1.000000000000000e+00   +3.510290618925065e-01   -3.624262679536639e-02   +5.750021587137024e-01   +7.749213664965847e-01   +2.820499443291997e-01   +9.185856040400639e-02   +3.692588434603307e-01; +3.848673665537437e-01   +6.219926370745946e-01   +9.999105131020761e-01   +4.072159218377431e-01   +5.676153746753587e-01   +4.516398309019918e-01   +5.646469929748635e-01   +1.797808633690140e-03   +5.799873050560086e-01   +7.811140942133422e-01   +3.413056898422141e-02   +7.073009865864611e-01; +4.839728604004918e-01   +4.309328589908532e-01   +3.019869141294380e-01   -8.957680848579151e-03   +3.301207044612516e-01   +5.484569912940780e-01   -2.626640571068470e-01   +1.538949481081150e-01   +2.526957867801189e-01   +3.848888977087811e-01   +3.125376594024062e-01   +3.421951248644588e-01; +3.419167000635128e-01   +4.297865671524874e-02   +7.780786133234261e-01   +3.183768174088580e-02   +2.798892526213540e-01   +2.016383867517655e-01   -1.512430287554524e-01   +2.962861277615839e-01   +5.683235113018840e-01   +5.865928359189987e-01   +6.351679943960590e-01   +4.661850044641325e-02; +1.128731123587988e-01   +4.103106364008535e-01   +3.664342899307466e-01   +1.329139955517072e-01   +1.465784393488569e-01   -1.892696883182659e-02   +5.605163378466347e-01   +2.310765544271184e-01   +4.554853425040788e-01   -6.286280304397854e-02   +4.078766120416940e-01   +3.889133706422476e-01; +1.842097987684064e-01   +6.530499964507212e-02   -1.372088211389405e-01   +1.522342677089229e-01   +4.862996110144169e-01   -3.419475248058647e-02   +3.135345654482795e-01   +3.024966480777066e-01   -1.933622673819890e-01   +1.588113113413314e-01   +5.367980723906296e-01   +4.097482096880183e-01; +5.745792806222277e-01   +4.244490189242867e-01   +2.328637708344965e-01   +4.874346447766864e-01   -2.008635382233205e-01   +4.923477089621328e-01   +7.268564104719752e-02   +4.915540161668459e-01   +1.557971117846606e-02   -3.041335739961726e-01   +9.064135907836218e-02   +3.967897430535862e-01; +8.670935946207532e-02   +6.782754277239982e-01   +1.686859439960840e-01   +6.617684786400780e-01   +3.482074439960866e-01   +5.208364028191912e-01   -2.095843720381529e-01   +6.040441964156037e-01   +6.015465709229179e-01   +6.137278812738036e-01   +4.496268714030042e-01   +7.792837445010993e-01; +8.748620980483973e-01   -1.777621289848125e-02   +7.360338896486602e-01   +1.430443184527025e-01   +5.524460467304934e-01   -5.637598866441473e-02   +5.373701240320650e-01   +2.209502939221746e-01   +4.234464644394745e-01   -9.333054629024908e-02   +6.620777017068227e-01   +6.556042450841347e-02; -6.355691288510329e-03   +4.193116268650227e-01   +4.480186827513878e-01   +3.861852218911553e-01   +8.373172069700775e-01   +6.395549717869972e-02   +2.634011462328523e-01   +6.044372420970472e-01   +8.369121145609320e-01   +3.373770913170314e-01   +6.041483846640946e-01   +7.280361428889659e-01; +3.818247640099575e-01   +1.012467828506115e-02   +3.793778993421682e-01   +4.267123235776718e-01   +5.377908924629340e-02   -1.119284400953348e-01   +3.968928297235056e-02   +3.671472603395022e-01   +6.601912898409048e-01   -1.024666269256430e-01   +6.314761142337243e-01   +3.345167870061712e-01];
L3E_L3I_iGABA_netcon = [+1.097097327999496e-01   +7.502496218969810e-01   +3.475098127631167e-01   +2.987175108773402e-01   +4.577816889464444e-01   -8.626910897637420e-02   -2.169749338817961e-01   +3.798094451689267e-01   -5.467001406211955e-02   +4.885975045394681e-01   +2.436639631214385e-01   +3.543596701707148e-03; +4.100606426549073e-01   +2.838515792319993e-01   +1.704835923014915e-01   +3.849737375172305e-02   +2.683510858487931e-01   +7.099323351064608e-02   -3.732672701206158e-02   +4.482127653485163e-01   -1.381478902375701e-02   +1.310584697120965e-01   -6.683163681376257e-02   +1.536767101602765e-01; +4.549759358925829e-01   +5.714118726454587e-02   -8.511656484642340e-02   +2.873965673738993e-01   +5.870056804743373e-01   +3.934309631036723e-01   +5.110438532059812e-01   +3.075088904753028e-01   -1.141320091662178e-01   +3.634314087147795e-01   -3.525718445947202e-01   -1.332756626434858e-01; +2.633961381652964e-01   +4.778469945327036e-01   +1.082466599490665e-01   +2.918219831887914e-01   +6.561129153297789e-01   +4.566319173559627e-01   -1.644531664494480e-01   +1.629779655945750e-01   +6.715956143862529e-01   +6.272672075357879e-01   +2.506189621132758e-01   +3.673077902240091e-01; +4.117502899501784e-01   +1.774702707120212e-01   +3.002452992768371e-01   +6.408890401398204e-01   +8.276639316485107e-02   +3.535798772405090e-01   -3.014299587116152e-01   +4.524093155066523e-01   +3.813711572975642e-01   +6.226548418915605e-01   +2.608920621686273e-01   +1.399618231074650e-01; +3.654368377867965e-01   +2.470193333826593e-01   -1.659757076250234e-01   -2.080831201341343e-01   +6.799440838707888e-01   +7.025423387954028e-01   +1.160416085869859e-01   +3.111465391814089e-01   +5.325331629941622e-01   +4.915885693615927e-01   +3.041783700361734e-01   +1.115440752046509e-01; +4.737448989750154e-02   +2.521078515984131e-01   +4.900662170519847e-01   +1.000000000000000e+00   +2.299374859144186e-01   +1.359572376965489e-01   +6.991173409033850e-01   +6.249778022785747e-01   +1.112347017583981e-01   +5.189491228732738e-01   +5.866137581376337e-01   +3.297825121609200e-03; +1.887503843162465e-01   +1.710434703561358e-01   +4.088411909177095e-01   +4.655827921705779e-01   +4.292483696802198e-01   +2.340704641145495e-01   +3.756742057289979e-01   +6.652063993202924e-02   +2.546819367062657e-01   +4.564706511436079e-01   +5.070707707802354e-01   +2.734420193731310e-01; +2.572665715808461e-01   +4.639609158703117e-01   +2.718543737696352e-01   +5.538729055816163e-02   +4.124805993274798e-01   +2.037836733846180e-01   +1.715947348231032e-01   +1.812290625754986e-01   +5.553337460145329e-01   +7.414448632674521e-01   +5.322609072123360e-01   +3.360539900191478e-01; -1.680186986897163e-01   +9.526448895677511e-02   +6.387513731490889e-01   +1.694961532388927e-01   -1.174191825717086e-01   +2.150987444828863e-01   +4.943003295364819e-01   +3.884237763370684e-01   +3.077610395811314e-01   +9.511938080035003e-02   +3.621543065265464e-01   +6.272046458300212e-01; +2.701044928627697e-01   +2.990200136683350e-01   +1.870443475469759e-01   +4.977447128811387e-02   +4.526646376437490e-01   +1.039385869281473e-01   +2.940762019846384e-01   +3.950739437579205e-01   +2.047409743228528e-01   +6.611109172569375e-01   +1.689789859567054e-01   +1.886251287198056e-01; +2.253148877387857e-01   +4.985300948761990e-01   -1.611487576421871e-01   +4.832172005081261e-01   +6.996606137744646e-01   +5.135756396095487e-01   +4.900165360691289e-01   +1.781648249959784e-01   +5.736759732248191e-02   +1.305366634904326e-01   +1.007665554914379e-01   -3.939395174639390e-02];
L2E_Input1_iAMPA_netcon = [+5.206624921375921e-01   +6.736374728028950e-01   +7.530529453483863e-01   +7.133966263332072e-01   +8.945783549857717e-01   +9.818688137421522e-01   +6.085671606925788e-01   +9.190056504686237e-01];
L2I_Input2_iAMPA_netcon = [+7.058323535440998e-01   +7.996235605945603e-01   +7.224084925606948e-01   +5.979446344956656e-01   +4.375660441126946e-01   +9.805547606363568e-01   +5.530821600949344e-01   +7.030154848762438e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
