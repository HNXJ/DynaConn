function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.013905693705012e-01   -5.756981036799576e-01   +3.480296648277348e-01   +9.267061313608557e-02   -1.107279817222806e-01   +2.082710098830497e-01   -1.116994202915837e-01   +1.777455899314286e-01   +2.372659064719052e-01   -1.215964010566619e-01   +5.049327477243626e-01   +4.325521636685383e-01   +3.330981951491541e-01   -7.262032161719545e-01   -4.513137388917295e-01   -3.697467302334015e-01; -1.216086537779808e-01   +1.990116811508626e-01   +1.532775740183352e-01   +2.526421672111761e-01   +1.102496442056726e-01   -3.332925267639246e-01   +3.105886259297924e-01   +1.652456117742396e-01   +1.110162866815542e-01   -2.026471725408122e-01   +6.454408416016733e-01   -3.851707622141156e-01   +2.342326997830848e-01   -7.753206930893522e-02   -6.268256809073752e-03   -3.904242892418277e-02; +3.917391126298519e-01   -2.666737955323066e-01   +7.196547358079154e-02   -1.131137950561561e-01   +3.244833556287112e-01   +2.202267365344946e-01   -3.926625964464893e-01   +4.911417867044506e-01   -2.032546142735542e-01   +8.759426951885255e-02   -1.633033738165213e-01   +6.163239053097134e-01   +3.369446458314913e-01   +8.100937832853653e-01   -4.908040011719101e-01   +1.661888386566562e-01; +5.634826448544322e-01   -1.138799531540743e-01   +4.256078852828560e-01   -6.743080706980583e-01   -1.191757466385787e-02   +1.263070772477562e-01   +4.086047130339060e-01   -3.595537043038217e-01   +5.360078848588039e-01   -7.600103671492567e-02   -2.234722294427232e-01   -1.415365188705822e-01   +3.814500335214732e-01   -3.236804571420285e-01   -4.169383477620586e-01   +4.135948991827697e-01; +3.490510645978200e-01   -3.492884887213003e-01   +9.630605285911875e-02   -3.838380495917142e-01   +1.372529645222427e-01   +5.220307941617640e-01   -2.369912538701523e-01   -1.799652173736719e-01   -3.145537835454033e-02   +8.554325421513569e-03   +2.161993542456583e-01   +3.003711490437782e-02   +5.778217683007980e-01   +3.167183879710443e-01   -1.779457160516523e-02   -4.677930894986617e-01; -4.524371575147077e-01   -3.164641525223953e-01   +3.808901451220068e-01   +1.006867386911754e-01   +9.687511445523417e-02   +4.621740973230249e-02   -7.895932315176646e-02   -2.724160026780407e-01   -1.560976146430493e-01   -1.342836799250241e-01   +1.960012990696954e-01   +1.446532899153401e-01   -3.001766646599308e-02   -1.424387830365619e-01   +4.844019887790418e-01   -2.506040611994084e-01; +4.041147142193612e-01   -4.073872059442032e-02   +2.196109779542975e-01   -1.197446950562843e-01   +3.256112643995320e-01   -8.528251861537053e-02   +9.180806898467222e-01   +4.308909285594829e-01   +4.986098945643062e-01   +3.726563935259100e-01   -5.116890472529971e-01   +1.976497429533136e-01   +4.191194150171662e-03   -1.425936079919340e-01   -3.822467820575751e-01   +1.689234287025827e-01; -6.943199841952541e-01   +6.767832246685892e-01   +3.029890778848016e-01   -4.208633029851663e-02   -2.788077854447790e-01   -1.150885796132451e-01   +2.720209271943905e-01   -3.259772665158055e-01   -1.174278532882455e-01   -5.028719988881898e-01   +6.605994054782072e-01   -5.708581615649305e-01   -2.802437369217373e-01   -1.091180033264800e-01   -3.373808711741146e-01   +1.552085615793051e-01; +6.945329773189050e-01   -1.159363488021671e-01   +2.187395367984693e-01   -4.899568038072621e-02   -1.989419951458724e-01   -2.031069310916617e-01   +3.451572836967420e-01   -5.598657118186930e-01   +8.351656200661581e-01   +9.935419289657492e-02   -3.222992201173754e-01   +2.930351688626016e-01   -4.631342154947244e-02   +1.518933289229767e-01   +2.415453597985715e-01   -3.572167097374341e-01; +1.101545159063973e-01   +3.313232476899542e-01   -2.342434562531876e-02   -9.171974890503290e-02   -3.216613350196161e-01   +2.485413711991275e-02   +2.474683287217708e-02   +4.016595842639133e-02   +5.284862183903311e-01   +2.237784795952211e-01   +6.426001025025224e-02   +8.829453280567994e-01   +6.995464749247562e-02   +5.940768179042264e-01   -6.519372094533274e-01   +3.773138718745525e-01; -4.064639494484650e-03   -2.946448778571755e-01   -3.863675289681175e-01   +5.988644963099048e-01   -3.291157811322069e-01   -3.986438323408815e-01   +1.815880783698643e-01   -4.152801982025156e-01   -8.208535698266575e-01   -5.451263061590314e-03   -1.417235712854885e-01   +8.241815399845802e-02   +6.048411504109025e-01   +1.088253180980650e-01   +1.939441055137296e-01   -3.627728285462875e-01; +2.147780152450485e-01   +5.562453158143963e-01   -1.818480018898045e-01   -4.768865007331546e-01   +5.215581799316659e-01   -3.507311932800041e-01   -2.539967570916308e-01   -2.113891124236167e-01   -1.567463961404368e-01   -1.813767894810724e-01   +2.331197792768834e-01   -2.726703864079588e-01   +1.291107301214603e-01   -5.094759567342173e-01   -5.317599125895848e-01   +2.827617050070147e-02; +2.754583256954288e-01   -1.202073838664659e-01   +1.629925862232824e-01   -1.737312331059368e-01   -3.136814698921603e-01   +5.135664542692541e-01   +1.858162016271024e-01   +8.083377274968190e-03   -4.655643767271298e-01   +1.491789775220977e-02   +2.579684900895285e-01   +8.273677784880398e-01   -1.575421081304626e-02   -3.614215342667484e-01   +7.899278488352791e-03   -1.353320037463750e-01; +2.265580888823759e-02   +2.041691898919376e-01   +1.546928564911235e-01   -2.158145843294812e-01   -3.475267761941540e-01   -2.112064551020989e-02   +1.495137724968618e-01   -2.336838804066067e-01   -3.878886647182955e-02   -4.850464328745668e-01   -7.827732581751243e-02   +5.737102650807319e-01   -7.291002260953340e-03   +5.859463451491299e-01   +3.231979768348121e-01   +6.437138196405610e-01; -4.148731171107438e-01   +4.823844883818869e-01   -9.614269547027166e-02   +6.246019006778505e-01   -2.977075750765098e-01   -5.379782042352905e-02   +1.090718608673773e-01   +3.048784602561207e-01   -5.856538111908239e-01   +5.380886909906626e-01   -6.489642399332911e-01   +8.155021148782221e-02   -1.821304651490245e-01   +1.833179201568111e-01   -2.363102966553256e-01   +6.448204401559200e-02; +7.499537680634535e-01   +4.175338999551682e-01   +5.304971495391432e-01   +3.166495255291296e-01   -1.003745509438447e-01   -3.815405586008494e-01   -2.439919741396223e-01   -3.289202453244483e-01   -1.468545668060097e-01   -1.576607657963353e-01   -6.635730448766536e-01   -3.217836951441548e-02   -1.680741535745514e-01   -4.471359749704763e-01   -2.802993393069031e-01   -1.535535758465386e-01];
L1E_L1I_iGABA_netcon = [-3.169586688904837e-02   +6.591192855586828e-02   +4.763495032157399e-01   -3.761139303657363e-01   -4.249501421912211e-01   -8.594375851717476e-03   +7.211714414010834e-02   +4.241848140152839e-01   -1.450873100739486e-01   -4.950967015091803e-02   -2.306259904103747e-01   +2.754356964502153e-01   +2.560917559033707e-01   +7.578466532767805e-02   +8.214636007863556e-01   -8.355850339315959e-02; +4.817794026318719e-01   +4.146309310684815e-01   -2.244911155403390e-01   +5.091974697357835e-01   -3.021250461393078e-01   -4.089113404028001e-01   -2.300577477912885e-01   -1.814586159959762e-01   +5.395897999617728e-01   +1.212112128534526e-02   +2.624773409170214e-01   +2.645341968815274e-01   +2.656445960857763e-01   -7.490015060764668e-02   -2.196702764164180e-01   +1.572730241996009e-01; -3.256920028666118e-01   -2.122219535852699e-02   +8.825357073627001e-02   +1.522931206510563e-01   -2.265956165288735e-01   -3.398576138319383e-01   +2.372836895417621e-01   +5.835985503653142e-02   -6.663021717583315e-01   +4.839288683173463e-01   +1.812681537140777e-01   -2.578881236217206e-01   +2.293449934833567e-01   +4.364484123533305e-01   -6.125598355634241e-01   +3.877729287100382e-01; +7.383135807200431e-02   +3.282125502164351e-02   +1.513819969035964e-01   +4.123907130022979e-01   +3.174968203050072e-01   +2.570556082700972e-01   -1.218892168258539e-01   -3.054105755918541e-01   +4.889777149275745e-02   +6.182069579162338e-02   -4.371602089785191e-01   +3.402628101229057e-01   +8.628747400694217e-01   +1.249413594490062e-01   +9.075478836146718e-02   +4.826376299693562e-01; -3.773735794432080e-01   -5.515231414129268e-03   +3.131941624559039e-01   +6.357375287984499e-01   +2.260861322856731e-01   +4.143411158261341e-01   -7.397930001038578e-01   -5.678705794671647e-01   -3.281958885568695e-01   +2.591279444183042e-01   +2.694663090821429e-01   -2.026832615351602e-01   +4.083952776461083e-02   +2.558146255279588e-01   -1.382672792323173e-01   -1.575470503849849e-01; +2.779396944246705e-01   -5.944263434656469e-01   +5.037052312464649e-01   -1.475373461045033e-01   -3.979034696617346e-01   +5.605820850534728e-02   -5.512979173016172e-02   +1.866519387774623e-01   -4.116796526186568e-01   +1.034446534369683e-01   -3.331574858117657e-01   +5.779681388520194e-01   +1.941649587660383e-01   +3.124418099802095e-01   +4.796342670522326e-01   -2.723675682419774e-01; +1.662230169806671e-01   +4.248135110008262e-01   +2.602383433899614e-01   +6.662623396233426e-02   +2.284569259051322e-04   +1.569636536590346e-01   -1.510486773901021e-01   -6.997602671270114e-03   -1.592158273221815e-01   +7.020822112037673e-01   +4.723935734460614e-01   +3.528798238398917e-01   -3.689608252266168e-01   +1.141809707347864e-01   -1.977501398966512e-01   +3.128958029842987e-02; -4.312988729750398e-01   +2.309453303573540e-01   -1.427518233247492e-01   +3.318963422590257e-01   -5.612744098129864e-01   +4.193134302171107e-02   +1.753079691056186e-01   -4.589779254665774e-02   +4.582761028765930e-01   -7.796547861765711e-02   -8.520516974062475e-02   +2.191058081149931e-01   -1.411274362844339e-01   +1.382897423246951e-01   +3.083769445010260e-01   -1.814888418601270e-01; +4.937619738102422e-01   -4.243113331103235e-01   +5.940146515390341e-01   -1.630069164049900e-01   -5.599041388936847e-01   -2.465540049427557e-01   -5.311434973919227e-01   -5.153303472630736e-01   -1.420423179872916e-01   +1.790921320490276e-02   +4.375327476185081e-02   -2.434873629499076e-01   +1.788901164862736e-01   +4.897413240662150e-02   -1.554179924876233e-01   -7.440208390539821e-01; +1.988450220630175e-01   -6.214044882715614e-02   -3.514017955891364e-01   -5.700761735627511e-01   +2.630502722754708e-01   -2.865453572909092e-01   +1.222799471870511e-01   +4.568087510797495e-01   +2.011529077126284e-01   +1.471455755233558e-02   -7.538911318927896e-02   +1.404292845545480e-01   -3.447091053103446e-01   -2.895753561419095e-01   -2.068020574700503e-01   +7.656834642919699e-01; +1.582160038967317e-01   +1.660207363662791e-01   +6.784622598580847e-01   +1.187636982847588e-01   +6.566303849161691e-02   +2.147924862040353e-01   -1.213487217989099e-01   -2.380084137314272e-01   -1.393148833288765e-01   +1.447414093393758e-01   -4.846363585599061e-01   +5.449226142633117e-01   +4.828906328660764e-01   +6.022673970439629e-02   -5.344063641503836e-01   -2.522547241873865e-02; +3.204341665410234e-01   -3.367126444482482e-01   -1.891363505035134e-01   -4.320150137404073e-01   +3.188293402061638e-01   +6.772968023717104e-01   +2.391869838111654e-01   +2.628473294319703e-01   +3.125265326430638e-01   +3.603948427510023e-01   +1.542163766893198e-01   +5.708776902585339e-02   +1.720390919549860e-01   -2.104823659482343e-01   +3.971191202824831e-01   -6.901165984440532e-01; +1.317656107378403e-01   -1.987952288631840e-01   +1.043775062856184e-01   -2.508200728131448e-01   +1.558837534565900e-01   +2.555585236902697e-01   +1.410510503907472e-01   +5.270548135418410e-01   +2.826728017092687e-02   +7.882068914058422e-02   +5.644786248394140e-01   +4.042885781753788e-01   +2.517132452076101e-01   +6.329245214967394e-02   -2.748488921185256e-01   -6.097420295348028e-01; +2.427701471345803e-01   -4.017051817395018e-02   -9.869131853583261e-02   -2.600854317519101e-01   -2.732364962356244e-01   -2.154712253762703e-01   -7.146274154482108e-01   +1.296911009274137e-01   -7.008660708639504e-01   +3.200589810237714e-01   +5.238563567445991e-01   -1.980334989803851e-01   -6.118958144412202e-01   -5.740784822604755e-01   +1.612924116195771e-01   +3.819857154927614e-01; -3.785741147961051e-01   -1.347579058743146e-01   +1.351662934834721e-01   +2.355540471183257e-01   -1.061354444889285e-01   +1.744299798340992e-01   -4.478053079866459e-02   +2.483961324306587e-01   -6.161679887771760e-02   -2.098868870880158e-01   -2.065282374688483e-01   +6.012276305175458e-02   +1.725726248530247e-01   -1.029730703961102e-01   +6.443858231403322e-01   +2.291443785468592e-01; +1.628588110707982e-01   +3.645944066229057e-01   -8.933842297207134e-02   -1.999368364361380e-01   -4.579550187135039e-01   -2.840958347009553e-02   -2.604959634280882e-01   +1.591175712196636e-01   -6.468451400045495e-02   +2.918101859063383e-01   -1.711646552883038e-01   -2.543843560953409e-01   -1.522509014677473e-02   -4.123243025135506e-01   +4.778135521684485e-01   -1.118608717449304e-01];
L2I_L1I_iGABA_netcon = [-6.303940771149605e-02   -8.299485483323620e-03   -6.963393247394969e-02   -2.848450918885923e-01   +3.981402303989014e-01   +2.027030305716761e-01   +6.183237527866807e-01   +7.343347660699005e-02; -8.385981771510851e-01   +2.356207113251187e-02   -1.065231241473739e-01   +5.297301098487557e-01   +4.085897671172734e-01   +1.831182216280301e-01   -4.144399794555187e-02   +5.459266641783769e-01; +5.026176477699897e-01   +6.027357732322902e-01   -1.438148725213889e-01   -2.510653678172034e-01   +1.078679599877368e-01   -4.291133921971081e-01   +5.721082232509322e-01   -2.909387469630879e-01; +4.834380143712786e-01   -5.526198966161281e-02   +3.076873926174646e-01   -2.927558105693310e-01   +1.191025527829075e-01   +2.664933989215166e-01   +4.135954043159679e-01   -9.262110890784092e-01; +1.004469202466988e-01   -5.983665469277824e-02   -4.273765059415021e-01   +7.986086577926995e-01   -7.599812032557780e-02   -3.234574683192782e-01   +3.971398971019641e-02   -5.379781817889677e-01; -3.849984603755074e-01   +1.398348360312063e-02   -8.893120225530009e-01   +5.744796643209329e-01   -7.396492919544807e-01   +4.773753992535320e-01   +2.060801948845387e-01   +5.863277571139601e-01; +2.504906955979999e-01   -1.578299864810839e-01   +1.864513061641821e-01   -1.773440811491055e-02   +1.863083117786346e-01   -1.697001204187820e-01   +1.339666113128825e-01   -7.318814628500194e-01; +2.621576619794984e-01   +1.422731500731535e-01   -2.453265859070042e-01   -3.958770987430994e-01   -3.043419741867701e-01   +4.048514359493096e-01   +7.783563631907066e-01   -4.082944997164368e-01; +3.213362322714819e-01   +1.993879227976044e-01   -1.963291206409355e-01   +8.847925696577474e-02   -1.577848699706415e-01   +5.075880084482708e-01   -2.130370382629987e-02   +1.866133338001975e-01; +6.120606428111958e-01   +1.177832693915568e-01   -3.803234506691235e-01   +5.719519210609629e-01   -3.883988937326440e-01   +2.089962543030553e-01   -2.158628036257530e-01   -5.762177481107927e-01; -1.122925024973039e-01   -1.704388806059693e-01   -1.221576556465150e-01   +7.356964334508281e-01   +6.595281425580308e-01   -9.842475728037270e-02   +2.890982880905563e-01   -1.680867435955700e-02; +6.551856862760027e-01   +1.886327317501720e-03   +3.971986643553217e-01   +6.377577830031628e-02   -4.901205343778523e-01   +3.819682732020220e-01   -1.692019179099568e-01   +2.981647995861172e-01; -5.428538724264609e-01   -2.824751521198753e-01   -1.935792831782035e-01   -1.052525261590619e-01   +3.374510143923354e-01   -3.237172250607135e-01   +1.357754833934516e-01   +3.222375767964387e-02; -5.556232678125369e-01   -4.826814609941595e-01   +5.072660878630154e-01   +5.584914264600706e-01   -3.655745431089046e-02   +1.679739886315732e-01   -3.051524178002081e-01   +5.852484189441233e-01; +1.183729493877051e-01   +6.880227590703193e-01   -4.561697512585320e-01   -3.696555081967903e-01   +6.073396693640045e-01   -2.123850106073228e-01   -1.605867036460891e-01   +1.905822460432809e-01; +1.160570248166778e-01   +2.422754582096506e-01   -9.056541454794460e-02   -4.721231126783477e-01   -5.908212966435911e-02   +5.236317307227298e-01   +1.275537256419579e-02   -4.252611461189629e-01];
L1I_L2I_iGABA_netcon = [+5.527651983465605e-01   +1.402166810760249e-01   +5.970283079823401e-01   +8.434087796242707e-01   -1.911051601683102e-01   -2.103960591874490e-01   -5.525805574051333e-01   +3.631161184909161e-01   +6.375880329616561e-01   +2.812374907943899e-01   -4.195990528124854e-02   +1.333359739918160e-01   +3.464769945401685e-01   -3.537828158745764e-01   +7.628058001726863e-01   +6.255848469350520e-01; -1.866137866362592e-01   -5.617915395584858e-01   +1.563276960923355e-01   -4.354237240674182e-02   -2.400507601369464e-01   +4.780639395772084e-01   -4.372528996095252e-01   +2.513002391707362e-01   -3.427276850935376e-01   +1.337616007604821e-01   -1.854509012549024e-01   -8.007070089075305e-02   -5.480616619088330e-03   -2.909506848953111e-01   +1.301383404401538e-01   +1.397690661119700e-01; -2.014200257973759e-01   +4.273931940644735e-02   +2.282513943250003e-01   -1.602093818055171e-01   -1.093160639436597e-01   -3.918842585157853e-01   +2.914319891822073e-01   -2.186227185719713e-01   -1.289829250799966e-01   +3.866963132290626e-01   +9.313110896374760e-02   +2.986151847156504e-01   -4.855733842411518e-01   +3.180854711876208e-01   -3.050079960455220e-01   -3.937448024790102e-01; +1.475131448435606e-01   +1.810232719398867e-01   +6.554742405013692e-01   -3.957060835138011e-01   +6.558738270401354e-02   -1.920393233813938e-01   +3.127204063244491e-01   +1.993219641587749e-01   -3.267665707535027e-01   +3.970841753707943e-01   +7.576819155492018e-02   +3.000414593759446e-01   +1.747276105771102e-01   +3.698936248152988e-01   +2.334679642408745e-01   -1.691541045995035e-01; -5.854738368772127e-01   -4.673260713173675e-01   +2.682751480167453e-01   -3.210945591003748e-01   -8.306577346098867e-03   +4.084299945050157e-02   +5.722232103623346e-01   +3.245114214640917e-01   -1.296791604075857e-01   -4.559975016363567e-01   -2.010029815828476e-01   +7.012873178493844e-01   +7.700669086830262e-03   -2.385786926107002e-01   +1.881506895048596e-01   +1.996345435660324e-02; +7.402442842573554e-01   +6.471923453484837e-01   -5.680353571112096e-01   -2.102788032001540e-01   -2.523768124735351e-01   -2.735362516686017e-01   -5.357929690970620e-01   -3.031312108772464e-01   -2.234468756962328e-01   -3.247406083907392e-02   +1.380782648933337e-01   +3.014797393521861e-01   +4.988084109731767e-01   -1.510203733431009e-01   -4.591762652151853e-01   -4.963793326317100e-01; -2.346126943125101e-01   -3.843442746906456e-01   +2.890424998764346e-02   +4.663006841028577e-01   +3.557697064363337e-01   -8.515050103183508e-02   +1.645939864931811e-01   +8.992940972745783e-02   +3.390201555737944e-02   -3.748555278986841e-01   +6.526238735777067e-01   -8.286571982061927e-02   +5.141513493433060e-01   +3.168474202833144e-01   -3.519174838349221e-02   +2.054411429867006e-01; +5.321702217493594e-01   +3.348024269705288e-01   -2.616757358452144e-01   +1.248660466717397e-01   -6.210641212958654e-02   -7.786199129224403e-02   -6.960499266857559e-01   +1.553386321222842e-01   -1.302705204433059e-01   +3.300812090191581e-01   +2.237816603028545e-02   -1.985380204411321e-02   +5.494796839227578e-01   -8.204096518636786e-02   +6.308768803847522e-01   -9.072252065525478e-02];
L2E_L1E_iAMPA_netcon = [+3.140996162194202e-01   +3.531661545801866e-01   +4.381912709422913e-01   +2.511022959399259e-01   -4.498757906340127e-01   +3.570794513595141e-01   +1.488721578007837e-01   +3.766919899660365e-01; +2.002927189979374e-01   +6.893252973308612e-01   +1.497289618031411e-01   -7.804131322198247e-01   +1.097760770018876e-01   +5.438610213170314e-01   -9.471482895204686e-02   -1.147168703952302e-01; -7.483083887656585e-01   +3.316647742063695e-01   +5.855180408180913e-01   -1.379594677095443e-01   -5.263554596393344e-01   +6.238065129802788e-01   -2.853827342617676e-01   +4.102416368919780e-01; -1.046073188171766e-01   +5.607029257647416e-02   -2.337479048734060e-01   +2.267461321325764e-01   +4.708656501603149e-02   +3.933731539585774e-01   +2.155259072705969e-01   +1.434971101423716e-01; +2.785981023001617e-01   +3.618225803762371e-01   -4.390756820499880e-01   +4.652270979303946e-01   +1.361390281950153e-01   +1.398661651772284e-01   -5.711840732297871e-02   -2.445693098218354e-01; +3.824470195423366e-01   -4.088783646202753e-01   +9.299644622034225e-03   +5.409283364376578e-01   +2.578208962449668e-02   -3.237586607184708e-01   +4.551479781716185e-01   +1.049420213332671e-01; +8.274583908176282e-01   -2.157616562484930e-01   +1.977086785255948e-01   +3.260227699838179e-01   +6.534118350847077e-01   -3.806585881214432e-01   -3.033028309298572e-02   -2.311623377495422e-01; +4.965606113984976e-01   -2.230048439615490e-01   +3.341764897644343e-01   -6.175593802142876e-01   -1.315094308128558e-01   +1.548055474957749e-02   +5.289537118005476e-01   -2.523481967216307e-01; -1.923811902358539e-01   -2.658037832483826e-01   +5.478280646099794e-03   +2.031869334224641e-01   -1.316972702091945e-01   +3.879104539631379e-01   -4.349530075935369e-01   +1.138627280850220e-01; -1.444853239242851e-01   +3.230958618003552e-01   +2.134098379285905e-01   +5.959886618636009e-02   +6.130986154559025e-01   +3.207550924139669e-01   -3.728206211101147e-01   +2.911850290029199e-01; -6.120938700686360e-01   +3.484184056631711e-01   +2.174282235214287e-01   -1.539736771835339e-01   -4.275199156100820e-01   +2.695413065472662e-01   -4.210741022699495e-01   +1.771707382883570e-01; +4.609706863084645e-01   +1.776320280452655e-02   -2.467992674607001e-01   -1.945908312691135e-01   +7.224252541725645e-01   +2.746916257091514e-01   +3.651268568365689e-01   +4.841731519278008e-01; -8.506016096246703e-02   +5.162476949687365e-01   +3.247516369854667e-01   +1.750718670925259e-01   -2.893436532704544e-01   +1.036161510227483e-01   +1.461968368443644e-01   -5.432160583457664e-01; -8.840117480866845e-01   -1.657584175095771e-01   -2.220674324530411e-01   -5.111901396973911e-01   -5.833359909623618e-01   -6.330857120314024e-01   -4.085854867708981e-02   -3.995979182928153e-01; +1.048996808495207e-01   +1.458326717364042e-01   -3.868687840369365e-01   +2.880624212832053e-01   +1.101491274240311e-01   -2.629171107691451e-01   -2.585155513416090e-01   +4.826707953904537e-01; +5.070953207193815e-01   +2.191804720594182e-02   +3.054564559872482e-01   +5.361065901061607e-01   -3.837145615612564e-01   -1.179506095799586e-01   -1.145553400900541e-01   +4.085747419346007e-01];
L1E_L2E_iAMPA_netcon = [-1.920238155571569e-01   -5.592024115809610e-02   +2.389632618715194e-01   +5.473164654020468e-01   -8.759791868827198e-02   +1.097504287452088e-01   +3.424095082781319e-01   -1.940407623606733e-01   +5.629809269164731e-02   -4.568469002138571e-01   +9.249736161453824e-03   -3.940134778424305e-01   -4.086251091032436e-01   +3.270318882082384e-01   -3.108705177407154e-01   +2.830079500320284e-02; -1.237300887852432e-01   +2.305314354655004e-01   -7.953851546084054e-02   -2.955224473195057e-01   -3.319250139993992e-01   -2.971876519484436e-01   +2.435094694238639e-01   -5.349666215719453e-01   +4.488397189951061e-01   +2.570594513647037e-01   -2.458603514458866e-01   -1.423086634566055e-01   -2.108769421600817e-01   +2.831227602859526e-01   -2.227153925899140e-01   +3.648992206239972e-01; -4.970907603327795e-01   -1.883894943590431e-01   +9.585915740072529e-02   +6.477412086345817e-02   -1.824066123591904e-01   +1.768864592559466e-01   +4.048710871114365e-01   +2.946118422285573e-01   -4.377642143984228e-01   -1.522130858508973e-01   +1.240275438198916e-01   +4.538462034422291e-01   +3.914708463144511e-01   +2.105333884510693e-01   -2.057731937147549e-01   +3.162873817885200e-01; -7.954021105641311e-02   +2.291226151452914e-01   -9.143970198124804e-02   -2.583810738657641e-03   -4.646107114066627e-01   +1.717909170771043e-01   +2.128535648014681e-01   +1.369087040859963e-01   -5.705688343842992e-01   -1.837822883832357e-01   -7.991635944383797e-02   -2.615522798735613e-02   -4.881590731530164e-02   -1.054273373031231e-01   -1.190055615062104e-01   +1.806701095239557e-01; +1.067054813759049e-01   +1.210418166402257e-01   +3.486739805029387e-01   +1.333202560511373e-01   +1.396350337280942e-01   +3.727280918138458e-02   -3.166273481254271e-01   +1.620178611304427e-01   -2.005160649882564e-01   +3.431089430904116e-02   +2.342102503485503e-02   +1.083486468051166e-01   +2.539426930092548e-01   -8.549367620396779e-02   +3.731424086357580e-01   +1.227750044613778e-01; -3.649214435183219e-01   +3.487452445300763e-01   -1.434013556512072e-01   +5.881067607790960e-01   -5.529479255034984e-01   +1.345268353961842e-01   +5.935550815167721e-01   +2.018312046039969e-01   +5.935251534907429e-01   +1.251389224205892e-02   +6.169519479597320e-01   -2.165628972627584e-02   -4.223105233869493e-01   -3.500536261109277e-01   -1.989813100815702e-01   +6.089715383771180e-01; -3.324577106372631e-01   -3.981690140716752e-01   -1.751467130722825e-01   +3.863372894086186e-01   +1.957046719047982e-01   -2.250027686963740e-01   -3.137900793483783e-01   -8.113009225035696e-01   -3.054176836252646e-01   -3.620174619783078e-01   +7.644001011448576e-01   -4.041706489779093e-01   -1.403382741213259e-01   +3.795687915064233e-01   -2.231389637064855e-01   +2.147985888623614e-01; -6.747739609956487e-02   -3.429490576952340e-01   -1.125274516678730e-01   -2.305929285769320e-01   -1.544082530814597e-01   -4.209131806826031e-01   +2.753738847886037e-01   +8.841571908605905e-02   -3.038570401718607e-02   +3.120248286981509e-01   -2.404817790901492e-01   +2.933749183567211e-01   +5.767494142670059e-02   -3.307796269270237e-01   -1.174736699058812e-01   -1.032352551583442e-01];
L2I_L2E_iAMPA_netcon = [-6.568110553774567e-02   +2.353946209848692e-01   +2.833158096685416e-01   +1.708152497648440e-01   -3.427091504088690e-01   -1.268811128860227e-02   +2.662740182589618e-01   -2.020676929184536e-01; +3.610808274644822e-01   +2.762315059808609e-01   +6.683320741542115e-01   +2.269166845077320e-01   +3.678157774630559e-01   +3.072831472477394e-02   +3.800744858357327e-01   +3.062149158042754e-01; +5.356361877722331e-01   +1.089575256784627e-01   +2.925470459838239e-01   +3.418276627375919e-01   +1.802836031605851e-01   +3.743331742142354e-01   +2.985948964591589e-01   -3.780218896003835e-01; +2.539745717171960e-01   -5.648535642539151e-01   +5.571837929423986e-01   -1.121954146611778e-02   -1.636209185861378e-01   -2.317932940929851e-01   -2.855099967981809e-01   +6.365382059952042e-01; -6.245507723664381e-01   -2.579066800972921e-01   -2.296347151066625e-01   -3.550923261301468e-01   +4.010894325160876e-01   +7.228272374409654e-01   +3.218775297612175e-01   -7.345818981823767e-01; +2.702579993105297e-01   -3.619436646717019e-01   -1.738680222596846e-01   -8.292025398578293e-02   +5.664362739685276e-01   +3.125082579998875e-01   +1.632126537462251e-01   -3.936291780697982e-01; +4.755156145850971e-01   -7.764656526853916e-01   -3.382903145075516e-01   +2.343112813280246e-01   +6.710394569298279e-01   +7.397895804634320e-02   -6.426969453322431e-01   -9.842029556122187e-02; -4.223495730071960e-01   -2.650847774081763e-01   -1.836466923308070e-01   +3.122582198078604e-01   +2.628834442849013e-01   -1.747877128637789e-01   +3.646400157983303e-01   -2.694733099456690e-02];
L2E_L2I_iGABA_netcon = [-2.951157376161206e-01   +1.601721933734563e-01   +7.831295922206002e-02   +1.949980870932387e-01   +1.987126908842618e-01   +6.456050425253475e-02   +3.225935243450808e-01   -3.712048054555276e-01; +7.436340461699006e-02   -3.019988247917383e-01   +5.260611510060133e-01   +1.291227095891187e-01   -1.736663285958883e-01   +5.064227601139325e-02   +5.522981978278199e-01   +1.723252598049386e-01; +2.278452276781426e-01   -2.063478298498175e-01   +9.320887264397774e-01   +6.343179168395490e-01   +2.677887481184333e-01   +5.941452755379414e-01   +2.054793550225148e-01   -2.117941402446405e-01; +5.792552896862043e-01   +6.805441276375904e-02   -7.325236446462698e-02   +4.822081940286849e-02   -3.932716727207291e-02   -1.104987812111822e-01   +4.448602833528222e-02   -9.756939093212350e-02; +5.401022493195604e-01   +1.584576776436933e-01   +4.039926169396669e-01   +8.555355500399336e-02   -3.528999605695329e-01   -1.227439617740364e-01   -7.246094299932692e-01   -2.538911827331414e-01; +4.412572507150630e-01   +8.869538266789048e-02   +2.377513188122388e-01   +2.177721610260920e-01   -3.654042864585311e-01   -3.105549580139426e-01   +1.690929717008934e-01   +7.056727577609274e-01; -1.730251678142299e-01   +3.747575924096878e-01   +5.384607871307252e-01   -3.660639850891383e-02   -6.289120421333654e-01   -1.096413851913579e-01   +6.708538450697309e-01   +3.133644960360574e-03; +5.020848198874626e-01   -2.505485059213678e-01   +1.500821032926719e-01   +7.245627018120252e-01   -5.097216574259335e-02   +5.323632988407551e-02   -2.023288106438788e-01   +4.240975683433257e-02];
L3E_L2E_iAMPA_netcon = [-2.173990644373740e-02   -1.039157936386056e-01   -5.610422694617437e-01   +4.024519456817242e-01   -2.779264664308617e-01   +2.814236149348046e-01   -3.924070954891911e-02   -1.365364653274644e-01   -4.498891268910205e-01   +3.310434319984035e-01   +3.023708548237637e-01   -5.678498909618488e-02; +1.820434091112425e-01   +6.624749320282058e-02   +1.325679532642221e-01   -1.438046680807896e-01   -5.154787504403459e-01   -4.853783470883153e-01   +1.030841996943380e-01   +5.856128946929903e-01   -6.077303443359307e-02   -1.638657797893530e-01   -2.831900582543934e-02   +3.367911782544549e-01; -8.818185230550224e-03   +3.002533160011131e-01   -1.488919202629103e-01   -1.185587789391550e-01   +3.870082890613609e-01   -6.236574470201625e-02   -3.192842807855096e-01   -9.988284398996436e-02   +3.482416408632330e-01   -4.141591105542920e-02   -3.291356038520780e-01   +4.924045808904675e-01; +5.321041667932595e-02   -3.171015821067382e-01   -4.652967526393657e-01   +1.811029202322294e-01   -2.758022937434139e-02   -5.109376698351421e-01   -2.883270434671951e-01   +3.067843501284820e-01   +2.755801697633626e-01   -3.168813661753720e-01   +3.781723894931229e-01   +6.152172593253602e-01; +9.910684365777914e-02   -3.746191582976356e-01   -4.610998182471016e-02   +1.661021003555288e-01   +3.412019470993604e-01   -5.582581331395169e-01   -3.310481166761206e-01   +1.209369656038152e-01   +2.320403564165574e-01   -8.185807446693943e-01   +1.290921645724190e-01   -6.056827464076394e-01; +3.135392999423738e-01   -1.245421880877905e-01   -1.002855518421997e-01   -1.665772189920310e-01   -9.344311008714662e-03   +2.733105414284612e-01   -4.688337084114425e-04   +1.871213654118386e-01   -1.832261679322666e-01   +2.568076178665112e-01   +5.759819018023162e-01   -4.631687808509660e-01; +2.086341864654991e-01   +4.005094861575933e-01   -1.367150141432995e-02   -3.303279801475309e-01   -2.548883169844890e-03   -1.407816380464518e-02   +2.142590740138991e-01   +2.001746345702650e-01   +2.370945348778844e-01   -3.345297970610200e-01   -3.622526488029283e-01   -1.993423973503741e-01; -2.830944828966324e-01   -4.198930295915597e-02   +2.307460902967953e-02   -2.930330977539225e-02   +5.434944029041708e-01   +2.800043988795601e-01   -2.676277145070425e-01   -5.047251429611354e-01   -2.572964655426488e-01   -4.078614147520452e-01   +1.257650408829015e-01   -4.692704018419012e-01];
L3I_L2I_iGABA_netcon = [-3.081662250272615e-01   +2.803665869728286e-02   -1.716377003835806e-02   -2.441580229538556e-01   +3.636777435966818e-01   -3.231685865089929e-01   +7.370258918257659e-02   -4.870507007591581e-01   +7.755597557067478e-01   -3.521262804294170e-02   +7.963850138620954e-02   -9.074979428476643e-01; +1.214341012845078e-01   +8.227326652339574e-02   -3.386346550794807e-03   +4.862219816861916e-01   +8.813189377263209e-02   +1.969401504346926e-01   +3.373741751117505e-01   +2.395516061628831e-01   +5.323230131347536e-01   -2.302205276025361e-01   -3.953503356601463e-01   +1.853890695543847e-01; -4.712321577704217e-01   -4.981185069580303e-01   -2.380758245068931e-01   +2.821351256519610e-01   +2.960397764185940e-02   +2.181316108637008e-01   -3.075761053457924e-01   +2.545649268337347e-02   -4.448963442016018e-01   +6.771803211761331e-01   +1.027108927534433e-01   +4.879045197888570e-01; +4.024180293008307e-01   +1.628351066981236e-01   +3.706180622241494e-01   +5.356549914777725e-02   +4.608150577811421e-01   +5.927522278149442e-02   +2.431321933307389e-01   -6.716966557695843e-01   +5.247907347997605e-01   +2.049260786676255e-01   -1.373057981422824e-01   -1.240718772948008e-01; +2.093407687191746e-02   +4.547917495648719e-02   +1.478092847315429e-01   +2.541779856289403e-01   +5.327410072774533e-01   +7.202670734312596e-01   +1.554573686011539e-01   -2.663091471295770e-01   -2.882599012352162e-01   -4.699229983398567e-01   +9.299954056318054e-02   +3.301993686617777e-01; -7.305068990431705e-01   +4.645819079560462e-01   -3.054160739218118e-01   -3.812462219492992e-02   -4.168240940786498e-01   +2.066232980286026e-01   +1.925231256578554e-01   -3.491081551738577e-01   -6.651303924851193e-01   +4.672562850342202e-02   -1.461384927208287e-01   +4.497367913173761e-01; -1.877351682232136e-01   -2.846966412054380e-01   -2.306152407575106e-01   -2.486638166969211e-01   +1.538075307956717e-01   -6.285106541095294e-02   -3.035523540925261e-01   -5.981868281631291e-01   +3.010597820626179e-01   -4.431211050238276e-01   +4.312044277815133e-01   +6.020297215758265e-01; -4.883150241566891e-01   -3.666633500834520e-01   +7.194260808025170e-02   +3.414987038372811e-01   +6.973931711345763e-01   +3.928686161403469e-02   +3.439822317858212e-01   +1.069652020420161e-01   -6.501756526186558e-01   -1.207977479348024e-01   +3.607019670463726e-01   +3.289866464382465e-01];
L2E_L3E_iAMPA_netcon = [+2.776771539636295e-01   +2.346365132815071e-01   -2.664275128233114e-02   +2.241067070509529e-01   -6.661838029142234e-02   -5.647670003394217e-02   -2.786129611747490e-01   +7.654639671610514e-02; +1.336031047063932e-01   -5.070230634804388e-01   +8.230671632627584e-03   +3.152691985152368e-01   +1.828247945621682e-01   +2.396153082138635e-01   -7.671081570185138e-01   -2.775934292216706e-01; +3.675630548721929e-01   -6.267722419177107e-01   +3.459616391556459e-01   -3.377795362818244e-01   -1.338439945846732e-02   +7.098258424566839e-01   +5.627577434436588e-01   +6.105165958519139e-01; -4.929105835707372e-02   -6.094560261261509e-01   -6.065051108031735e-02   +3.201968321106688e-01   -1.118231428623702e-01   -9.290261453515902e-02   -3.381399482562473e-01   -2.788879771572326e-01; +6.370179269358947e-02   +1.652518613438638e-01   +1.559644005671862e-01   -2.873380728394291e-01   +2.417354908050090e-01   +3.788123946158591e-01   +5.724561728703724e-01   -3.274538678171160e-02; +1.237039076590653e-01   -3.962027727027365e-01   +4.156384643041602e-01   -3.550805892168782e-01   +8.304412629943834e-01   -3.353223586876742e-01   -3.008337547024408e-01   +1.215626827197565e-01; -4.950388573206176e-01   +3.497615412993515e-01   +3.124049697811457e-01   +6.874941100774151e-01   +1.398771826596107e-01   -1.285970533140412e-01   -2.203455263402370e-01   +5.132817748960963e-01; -5.538425584362205e-02   +6.178701567297806e-01   -5.528644267312541e-01   -2.522907017024952e-01   +6.077774082851859e-01   +7.314949216058023e-02   +4.800554582317709e-01   +7.420285197272850e-02; +1.469334644709488e-02   +5.401431471811254e-01   -8.471750317995022e-02   +4.549745950268281e-01   -1.577918563358416e-02   -3.174313533515460e-02   -1.059578885215074e-01   +3.402702212905285e-01; +5.748789774031376e-01   -1.971131813011640e-01   -3.017012653211453e-01   +2.930331771325587e-01   -3.003402239294493e-01   -7.322270211145376e-02   +6.925347004876367e-01   -6.403514840960924e-02; +4.201348028899712e-01   +4.197112946345964e-01   -2.874833101936790e-01   +4.207977610318170e-01   -3.449657306385818e-01   +4.106235718596407e-01   +1.305008541063520e-01   +2.002999219721727e-01; -1.106852956695274e-02   -7.211018841039445e-01   +7.580025901952272e-01   -6.443619901364359e-01   -2.246577449558791e-01   -2.113059035109682e-01   -3.159428450058673e-01   +2.517288440215362e-01];
L2I_L3I_iGABA_netcon = [-4.356722625582113e-01   -2.466800629631090e-01   -2.741947924850015e-01   +2.385365119226830e-01   -7.045685867083225e-01   +1.957177784544912e-01   -2.751563357260507e-01   -1.624841740235591e-02; +1.034829530782743e-01   +4.031545716587659e-01   -1.061433839318107e-01   -5.095219229154242e-01   -1.204241832493765e-01   +3.023281438671027e-01   -9.068299906745345e-02   -7.646420286252328e-02; -4.773129341961375e-01   +1.162809830835836e-01   -7.285938067939240e-02   +4.649070636326125e-03   +9.122795574711771e-02   +3.189794751591286e-01   -4.159931712144287e-01   +6.519003518767588e-01; -2.731973256084287e-01   +5.362637739592674e-01   -4.645314281846395e-01   -3.320262393330572e-01   +9.281909726944573e-01   -4.552797065591139e-01   +5.372598542839246e-02   +2.033667640778225e-01; -2.972794750720156e-02   +1.516142977734352e-01   +9.052555539357057e-02   -3.122373247342679e-02   -1.866960382849978e-01   -5.043901381574715e-01   +7.085597004530808e-01   -4.343075256060461e-02; +5.176424669990053e-01   -5.000660633747108e-01   -6.577064436660646e-01   -2.185409697782627e-01   +4.455868821519884e-01   -5.847874429473906e-01   +1.418299164081171e-01   +4.468785183001400e-01; -1.685676889085994e-02   +2.465857162418151e-01   -4.047277650104831e-01   +4.720584344855989e-02   +2.124915803232709e-01   -2.223605223454165e-01   +1.403963439344864e-01   +5.841351200860384e-02; -2.137922655635248e-01   -2.299983274789620e-01   -2.469105864250375e-01   +2.180466944269555e-01   +3.569858327461969e-01   -3.664698717281780e-01   -8.175307566930842e-02   +4.264206778718219e-02; +4.134351304347147e-01   -1.114098530270407e-01   -1.601611365501498e-01   -9.641957955318160e-01   +5.856676022889725e-01   +5.753836894710648e-01   +1.424683171125904e-01   +3.740427702370096e-01; +3.661622391776432e-01   -1.298619891718948e-01   +1.491808643324516e-02   +5.167860632162651e-01   +2.010085426189483e-01   -1.215432988008208e-01   +2.402407570341839e-01   -2.382537254227602e-01; +6.869325364248649e-02   -3.430210951751116e-01   +6.212785871572880e-01   +1.675072161309418e-01   -4.763913576876375e-03   -3.152347755268404e-01   -1.283612896649372e-01   -7.958273309110939e-01; +1.269998667322656e-01   +1.278171650704275e-01   -5.171414156275488e-01   +2.150214144540738e-01   +2.171937187712532e-01   +3.092038247640001e-01   +9.334676565673436e-02   +8.353245898974415e-02];
L3I_L3E_iAMPA_netcon = [+3.140098303220346e-03   -1.303325867455022e-01   -9.565598440849865e-02   -2.470194993034373e-01   +4.106127833953968e-01   +5.073486422007270e-01   -3.680797923140641e-01   -1.808253987226655e-01   -2.250063267410611e-01   -3.540945173272841e-01   -9.580850006711028e-02   +3.641070462641710e-01; -6.461274263853618e-02   -9.714186866185091e-01   +2.817142014117976e-01   -1.205426139816010e-02   -6.378464985786341e-01   -2.490478037937913e-01   -3.709126773719006e-01   -6.967637795937545e-02   -8.033984635775854e-02   -1.324587228241747e-01   +7.598784596331228e-01   -7.898187520638961e-02; -4.044090445072321e-01   +3.102667592099818e-01   +6.007865868194688e-01   -2.753661923466151e-01   +2.996698855426828e-01   +1.052284537458069e-01   -4.958200519983320e-02   -2.022746583232573e-01   -3.065750493510833e-01   +1.835697728557070e-01   -8.746231598071338e-01   -5.077008617530744e-01; +4.456346001520104e-01   -1.278519262554668e-01   +6.006434357900082e-01   +2.139555859539675e-02   -4.556810188780958e-01   -1.137402554007455e-01   -8.211179666580569e-01   -6.683788529364650e-02   +4.969113472510207e-02   +2.836214295612968e-02   -5.488113859428295e-03   -3.431933388326964e-01; -3.477713589002806e-01   -2.978726111451066e-02   -4.980230067320298e-02   +5.816427175984798e-02   -8.614865933177842e-01   +1.429473888642231e-01   +7.595370453191532e-01   +4.302352442588778e-01   -4.582928976033745e-01   +6.446576127683962e-02   -4.893550547123049e-02   -3.008562050144377e-01; -3.869157176719467e-01   +5.662017155640136e-01   -2.469186854891986e-01   +1.865803848543353e-01   -7.800665333733942e-03   -1.045325349669080e-01   +4.721402505444763e-02   -5.343858649002406e-01   -6.362959471471417e-01   +3.007470936051308e-02   -3.548636243504127e-02   +2.664876593080331e-01; -5.749141738321004e-01   +5.780861412035243e-01   -5.277756808441815e-01   -4.731601910996060e-02   +5.369836392430700e-02   +8.697308345126936e-01   +1.398274351110171e-01   +2.305197117823392e-01   +1.089560182290300e-01   -6.246308726530067e-01   +3.691936135891520e-01   -8.045031895595928e-02; -3.317406581055304e-01   +3.579731400430677e-02   +1.643374012016261e-01   +4.045342904463289e-01   +4.941078083597250e-01   +1.924990578069553e-01   -2.113564867084665e-01   -6.633738005366436e-01   -2.618115723995975e-01   +2.693562681156623e-01   +3.412924652372153e-01   +6.675360692036769e-01; -3.328061571542732e-01   -3.140080046484069e-01   +3.762209159443566e-02   +3.062345854107882e-01   +3.722347604821041e-03   -7.251424488648809e-01   -3.369355578375679e-01   -4.381660649996949e-01   -6.633306794754584e-02   -2.293708236723029e-01   -3.333355462733949e-01   -2.354985138622914e-01; -5.450685915071871e-01   -2.050847975937903e-01   +6.305924146069795e-01   +3.826868011665269e-01   -1.319469290020783e-01   -1.496984675562782e-01   +3.003574388384715e-01   -4.995250290604390e-01   -2.204809891118548e-01   -5.479205999633636e-01   -7.233214281742114e-01   +3.884723603085955e-01; -5.604846392408238e-01   +2.687432615425759e-01   -4.073866743102091e-01   +3.046736842179459e-01   -2.415444896189012e-01   +1.404156663924286e-01   -3.244732066881363e-01   +2.941227825975855e-02   -7.709092686124804e-03   +4.969962230980572e-01   -2.754097110044719e-01   -7.327419269878416e-02; -6.603669120894692e-02   +3.406811229994410e-01   -5.693422149095215e-01   +6.083831710938044e-01   +1.104821800415867e-01   -3.260618057999491e-01   -5.729599386541976e-01   -3.288135868860559e-01   +4.981395811972484e-01   +2.415530623827325e-01   -2.043944235003078e-02   -3.112317997016516e-01];
L3E_L3I_iGABA_netcon = [+5.626918603171681e-01   -2.524166910193921e-01   -1.454565762217873e-01   -5.099194999560330e-01   -2.248428927855968e-01   -7.105094376842922e-01   -4.953229137805034e-01   +2.962519330091682e-01   +7.257465803022292e-01   -4.314061294972973e-02   +7.639098941936291e-02   +5.340593822734129e-02; +2.235204474580862e-02   -4.261200097563898e-01   +4.656039789749979e-01   -2.422371433507757e-01   +7.540515525203101e-02   -1.860723349793844e-01   -2.981290650733496e-01   -2.102331889715922e-01   +2.322909293635037e-01   -3.521798652961100e-01   +1.020606801289742e-01   -9.538909876502964e-02; +2.394741184746449e-01   +8.873620880462205e-03   -3.079979135657145e-01   -2.174935645860240e-01   -1.529622734735231e-02   +3.345595835760702e-01   -2.291658751089504e-01   -5.820714906503814e-01   +2.913619096339297e-01   -4.417846468726858e-01   -5.174999646862277e-02   -6.368053392211996e-01; -2.124335770037252e-01   -5.572520936276893e-01   -4.455636273557288e-01   -3.318367020510567e-01   -5.206499814379051e-01   +1.705256859447437e-01   +2.810483324047165e-01   +1.329398348696391e-01   +1.654742012803503e-01   +1.655211291748010e-01   -5.101143422555736e-01   -1.062790242160440e-01; +2.169007949353982e-01   +4.814328846649431e-01   -2.116337957801691e-01   +2.354909398738855e-01   +4.778607434011663e-01   -6.394740067495983e-02   +2.037725417494149e-01   +1.758815630985367e-01   +4.012185946021710e-01   -6.595357492824122e-01   -1.300392135479757e-01   +8.431826965902386e-01; +1.694869482426076e-01   -1.856858569304869e-01   -3.646545936305232e-02   -3.656808687031570e-01   +1.883028576264388e-01   +8.479802479163379e-02   +2.569025320382492e-01   -4.208557662078846e-01   +5.474445959084479e-01   -2.237715281632564e-01   +1.949953060302948e-01   -3.788865690548657e-01; +3.219666050284913e-01   -6.497018531295500e-01   -6.262371586917281e-04   -3.005274222228099e-02   -2.498915248973679e-01   +1.348548729037331e-01   -3.240580725374608e-01   +3.575942662691458e-01   -1.958757075049244e-01   -1.374110114521841e-01   -1.269252472906342e-02   -4.065930734623519e-02; -4.551174185340320e-01   +4.414597168541808e-01   +3.632505525976332e-01   +4.880530246143779e-01   -1.038926022576540e-01   +4.468191887900775e-01   -3.189995059517081e-02   -4.988389214016143e-01   +3.564626480378681e-01   +1.964272423843632e-01   -2.322515654012849e-01   +5.650077071323049e-01; +4.107189725307222e-01   +1.979608855845677e-01   +6.349510972935514e-01   +2.406310898328484e-01   -1.664126054020681e-01   -4.893610411442991e-01   -3.540780640671597e-01   -3.066550097367249e-01   +7.136911091488590e-02   +3.298431912783493e-01   +4.072168065776630e-01   -5.911511310544677e-01; -5.290602572715946e-01   +2.928908353011647e-01   +6.214377081833597e-01   +1.052673498768430e-01   -1.243918478482784e-01   -8.097247864909590e-03   +3.448088766053622e-01   +7.351295429585030e-01   +5.718875029055042e-01   -5.032363401696449e-01   +4.879841421277765e-01   -6.231285185924021e-01; +5.727391768507929e-01   -4.969557550946123e-01   -5.536162591981643e-01   +5.934909021566473e-03   +6.347852582388510e-01   +1.476129831353740e-01   +4.661153013015868e-01   -2.800509023329521e-01   -1.527170787324524e-01   +4.849845528506817e-01   +8.259485405561483e-02   +1.915218593701196e-01; +6.807490756649800e-01   +3.174592753140296e-01   +2.746678022606974e-01   -1.241643910999995e-01   +1.556674679139189e-01   -2.506359058934775e-01   +3.724826403333451e-01   -1.338567613612839e-01   -1.810917330835743e-01   +5.934703145216019e-04   +2.263399643054846e-01   +7.228503258593807e-02];
L2E_Input1_iAMPA_netcon = [+4.718761006439623e-01   +2.967634548752677e-01   -2.786790719767425e-01   +6.770424079445335e-01   +2.055403534635226e-01   +2.288563550934114e-01   -2.874937710574058e-01   +2.605971355282419e-01];
L2I_Input2_iAMPA_netcon = [-2.296875911288007e-01   -2.212323680306870e-01   +3.745076360122719e-01   +6.819289823910646e-01   -7.986101387482244e-01   -1.804369766438786e-01   +3.689893885646427e-01   -7.480514373481888e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
