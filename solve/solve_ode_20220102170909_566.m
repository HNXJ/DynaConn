function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-6.129804220342074e-04   +9.501785095417744e-03   +1.184618549902167e-02   +1.712718822846483e-02   +5.566151385515469e-03   +1.817020954405636e-02   +3.679513106673577e-03   -2.697411122119135e-04   +4.538795774387327e-04   +7.284074153773603e-03   +9.180926671030853e-03   +4.670768477440490e-03   +7.701645304329735e-03   +1.673462513312531e-02   +1.127654389601694e-02   -6.637408017930261e-03; +8.395079733603346e-03   -2.042336370603769e-03   +1.352496149480671e-02   +1.752393634961366e-02   +8.138166892914783e-04   -7.598238226482735e-04   +1.142271778232362e-02   +1.517103005950257e-02   +1.069309285402434e-02   +8.261638882397702e-03   +1.366636979075983e-02   +7.828055718908421e-03   -1.593305459525657e-03   -2.923867694547928e-03   +1.072790944049877e-02   +3.629357896384518e-03; +5.037041916048503e-03   +1.130050648245346e-02   +1.417696375390216e-02   +7.917338396384923e-03   -3.765922155888277e-03   +1.238544306213563e-02   +1.559699192236706e-02   +8.908051682929512e-03   +6.172967752696871e-03   +2.998700341987458e-03   +9.006209842339311e-03   +2.076738925689234e-03   +5.589833742497316e-03   +1.006861652277376e-02   +1.868423691867543e-02   +9.143546877334650e-03; -1.581725990492656e-03   -3.904086749641824e-03   +4.949888940833621e-03   +1.010104283497772e-02   +3.316829818211331e-05   +1.031097437322544e-02   +1.534701713892894e-02   +1.214020632787875e-02   +1.211988193831126e-02   +2.220652547838107e-03   +1.606090152761389e-02   +9.819122396211247e-03   +8.375031995133189e-03   +1.977141676746341e-02   +5.972995420746152e-03   +4.717491969972601e-03; +8.700846875203221e-03   +7.609111833819713e-03   +4.987372750501830e-03   +1.097109604656357e-02   +9.240658140250428e-03   +1.903619509086575e-02   +4.337878676705252e-03   +8.939979085298817e-03   +9.246773812494122e-03   +2.146979041134166e-02   +6.682366659203060e-03   +7.460896431388772e-03   +5.669115624074884e-03   +9.148228615756922e-03   +2.000056390873400e-02   -1.290565831986089e-03; +1.104613701931680e-02   +2.728456757662505e-03   +1.270376008414676e-02   +4.580758154874769e-03   +6.706834553871192e-03   +9.192354392896906e-03   +1.232451250394890e-02   -3.745319876690121e-04   +3.228180980310617e-03   +9.285734307419614e-03   +8.620207749998651e-03   +6.967539749190717e-03   +7.215958893856345e-03   +7.062736511873900e-03   +5.963656543261971e-03   +1.564409883893749e-02; +2.049377758438562e-03   +1.022924170754982e-02   +1.857629245172029e-02   +1.288736448817730e-02   +1.465839149690129e-02   +7.952274061878021e-03   +5.965947432690371e-03   +1.594606478691032e-02   +1.892484523812745e-02   +6.427031043002874e-03   +2.439182542239448e-03   +6.537374768392729e-03   +1.050074600552430e-03   +1.616210901148752e-02   -1.127584332422526e-03   -2.781407176868349e-03; +1.004867797116927e-02   -1.548624517292409e-03   +1.620138581388495e-02   +1.514715874372197e-02   +9.415933306641557e-03   -4.721278718920778e-03   -1.933782941144020e-03   +1.860668942126949e-03   +1.527300022355240e-02   +1.667182519496528e-02   +1.947663497664142e-03   +9.743108605645100e-03   +3.664137696525135e-03   +1.366458883798822e-03   +1.460073292512071e-02   +1.320838515826482e-02; -2.527320143297114e-03   +1.002377307196597e-02   +1.067404002589194e-02   +1.295680723177734e-02   -2.331780192820243e-03   +1.396405213688971e-02   +6.029640765711652e-03   +1.088087195411429e-02   +6.155659555998906e-03   +1.317981644159612e-02   +2.369279654866713e-03   +1.382748937407409e-02   +4.636347033772642e-03   +1.270505700445576e-02   -1.456839572420282e-03   +4.048206085806815e-03; +5.384726869309852e-03   +7.932908876024089e-03   +2.245344364687550e-02   +5.274509170466476e-03   +5.981854448918456e-03   +3.187245249210357e-03   +2.605097358768563e-03   -3.472520271965347e-03   +5.192350416500286e-03   +8.742017657913381e-04   +8.958875693124100e-03   +8.590716341325884e-03   +1.137861542722815e-02   +1.239409896270333e-02   +1.953694796711027e-02   +9.598256434819106e-03; +6.531289522474161e-03   +8.002007001377143e-04   +1.227185180623944e-02   +1.306601682293382e-02   +1.109375275855128e-02   +5.868022058378844e-03   +1.042733220895734e-02   +9.837878182455032e-03   +6.495908801350618e-03   +4.249310447215142e-03   +1.665634408354495e-02   +1.341880038445613e-02   +4.749744373689904e-03   +4.982542485490890e-03   +1.408311738344442e-02   +7.346148732561122e-03; +1.008071252580377e-02   -1.743206438710718e-03   -9.943782310030101e-04   +5.334974588123906e-03   +1.156429554896953e-02   +2.028790247494557e-02   +5.875501734896418e-03   +8.663699788475351e-03   +1.268308900688209e-02   +6.757468703663030e-04   -3.862346467146901e-03   -2.647221299773598e-03   +1.637818684380182e-02   +4.286403953162846e-03   +5.703512481887787e-03   +6.411015998951698e-03; +5.601966624141485e-03   +1.261381767418131e-02   +1.298820425142438e-02   +3.952783990408675e-03   +1.815332788503294e-02   +5.853163594512331e-03   +1.381777305965603e-02   +1.841264947997652e-02   +1.176758436687880e-02   +6.044640397551059e-03   -2.788809955927445e-04   +1.471563163679696e-02   +1.168537914616770e-02   +9.703222970461240e-03   +1.075406623903059e-02   +1.434472683914359e-02; +1.169551172088881e-02   +1.482462932109643e-02   +7.503788828001645e-03   +1.324223738071393e-02   -1.818509798365841e-03   +5.647220020098997e-03   -8.431201522579748e-04   +6.749946181838102e-03   -9.028296044389038e-04   +1.133581249026905e-02   +1.127639210549230e-03   +1.901093184962815e-02   +9.510218067434750e-03   +6.507006077769183e-03   -1.038353619526908e-03   +2.556089899187821e-03; -7.948644088570877e-04   +1.524359206849610e-02   +1.256670301240138e-02   +7.969454361277207e-03   +9.778934849643147e-03   +3.038585560148955e-03   +2.022870215342388e-03   +8.989791658856293e-03   -1.178804516258033e-03   +1.920725743421271e-02   +1.034221078324697e-02   +8.107920494430905e-04   +9.699760596597142e-04   +1.690520946398226e-02   -1.995784901776351e-03   +8.853675078704512e-03; +1.368849392093508e-02   +5.813286527857241e-03   -1.830790127144833e-03   +1.890048679277984e-02   +1.129857353854903e-03   -8.845047518672080e-04   +9.761196095418270e-03   -4.107358515490060e-04   +2.207275478553392e-04   +1.593028808048531e-02   +1.227828392186136e-02   +1.211374157655852e-03   +1.417978118198105e-02   +1.476449973085220e-02   +1.186535794768957e-02   +1.441657482417172e-02];
L1E_L1I_iGABA_netcon = [+1.211642376559953e-02   +1.115261035128000e-02   +2.311087507240750e-03   +8.595349714800594e-03   +1.412020939855258e-02   +1.017989206619231e-02   +7.471688159842550e-03   -4.080892654609636e-03   -5.464302480698971e-03   +1.172581724545466e-03   +6.065916752863654e-03   +6.070036570735860e-03   +4.542915867604525e-03   +2.008177670693741e-02   -4.809653228564590e-03   +5.588880179979675e-03; +4.370246118660102e-03   +1.040458143355241e-02   +1.218831901874497e-02   +1.204429625913674e-02   +4.606143173774821e-03   +6.329226037322329e-03   -1.312326677367535e-03   +1.644728898574482e-02   +1.484812845143488e-02   -4.982058980493217e-03   -2.011228654429533e-03   +1.047143764997280e-02   +3.336534520561628e-03   +9.537800272632752e-03   +7.360550452436372e-03   +1.098176166171910e-02; +8.224151155846701e-03   +1.665623752492117e-02   +1.454159854395236e-02   +4.415518924682279e-03   +9.470464361391244e-04   +7.532791016407541e-03   +1.074247316354001e-02   +9.626825620531356e-03   +1.471533591061078e-02   +1.650165552529726e-02   +8.635765872281043e-03   +8.858564341887176e-03   +1.574537458460499e-02   +1.251305872470659e-02   +4.216304316185523e-03   +7.048439126666638e-03; -1.589350314268042e-03   +6.698576729134235e-03   +1.737781067708735e-02   +7.364204321866880e-03   -5.146400827426468e-03   +1.057309790296460e-02   +1.172705878879764e-02   +1.317871354006261e-02   +8.805620710534832e-03   +1.069799241844958e-02   +1.136860403456128e-02   +1.838631905444363e-03   +6.691651686285714e-03   +5.806295346512063e-03   +8.657304956824713e-03   +1.184706138409014e-02; +7.148032510381854e-03   +1.849600935222412e-02   +8.349655719704779e-03   +1.781476328773702e-03   +7.700588006793831e-03   +1.799318626548369e-02   +9.265498947856703e-03   +9.919438034538529e-03   +6.288195357973393e-04   +8.613925852733330e-03   +8.246325032143696e-03   +9.086201543206107e-03   +3.121127296477664e-03   +4.863594693637523e-03   +7.951218588394282e-03   +4.570710375282727e-03; +1.305816994020885e-02   +9.550030818536679e-03   +2.733554780069889e-04   +1.552994461957101e-02   +2.084483767137468e-03   -2.209302019568581e-03   +1.578341254441832e-02   +2.432790394148396e-03   +1.480468582266523e-02   +7.353341655466228e-03   +1.089994475859269e-02   +6.480637729204992e-03   +3.383297124807824e-03   -3.432644523955398e-03   +1.169526305770700e-02   -3.954283237086323e-03; +1.009649465207895e-02   +5.049698010063696e-03   -6.945249242992187e-04   +6.878365589378054e-03   +2.293980543624881e-03   +9.815070303563321e-03   +9.957241656833904e-03   +4.656113042898659e-03   +1.450851525548325e-02   +2.314113112038352e-04   +1.779670827836164e-02   +1.617185235675983e-02   +1.913726170375360e-02   +1.070585609918154e-02   +3.617312528706778e-03   +9.823558017816363e-03; +6.052148939011199e-03   +1.898660417361834e-03   -3.806161401221750e-04   +2.751975759146570e-03   +6.038153974483533e-03   +8.632489922623186e-03   +1.380535735388425e-02   +7.314825909136234e-03   +4.468432810174183e-04   +8.652875966627605e-03   +5.935705956778142e-03   +1.772587741066855e-02   +7.099043729472375e-03   +1.051633015965814e-02   +7.009633434198304e-03   +1.056112975399844e-02; +7.726542390494747e-03   +3.370766323908547e-03   +3.593045065007711e-03   -2.253694824395375e-03   +4.483773837978376e-03   +1.465477296205563e-02   +1.565997454018302e-02   +1.685607323441359e-02   +7.899568656870078e-03   +5.908847706064757e-03   +1.474695438574263e-02   +2.960061810125735e-03   +1.710572263418989e-02   +1.989710350716012e-02   +6.832328895631155e-03   +6.455312021041763e-03; -2.706236557832246e-03   +1.609498912697378e-03   -3.974935762879783e-03   +1.006562748985104e-02   +6.170302358932900e-03   +1.361424120485413e-02   +3.200316394160064e-03   +6.386667685307781e-03   +1.884446761811025e-02   +1.521773335647794e-02   -4.649244465300818e-04   +1.733998150214157e-02   +1.635527692757511e-02   +1.101711285997155e-02   +1.186262834904922e-02   +4.906857789544702e-03; +1.873926246119836e-02   +1.712401842809146e-03   +4.105873097856308e-03   +6.268905418494288e-03   +1.505322450158007e-02   +5.803403942366143e-03   +7.958224185178430e-03   +1.856334692303470e-02   +9.984294252796601e-03   +4.143649075350758e-03   +1.171558506453485e-02   +9.735891065995386e-03   +7.796702891658763e-03   +1.872205737516475e-02   +1.362930298803996e-02   +3.933531467690460e-03; +1.027016661487585e-02   +1.506763946117609e-02   +8.639396597838179e-03   +1.285910843595609e-02   +1.603434347444262e-02   +5.803042394431477e-03   +4.154959448130601e-03   -3.042013876084330e-03   +6.725473151301928e-03   +6.314135282210439e-03   +8.199558056219561e-04   +1.585844522903749e-02   +8.544579333390940e-03   +1.293039846803543e-02   +9.216513501752165e-03   +4.751831438786440e-03; +1.664032285893438e-02   +5.859663517419644e-04   +1.232730169075454e-02   -4.116892782378375e-03   +4.114815006246832e-03   +1.088747605436719e-02   +9.066824987252961e-03   +4.018704288492885e-03   +1.668908254224818e-02   +8.782024299926625e-03   +7.219544100867396e-03   +1.277740395523775e-02   +1.749050413140346e-02   +9.875434673434262e-03   +1.961278614101431e-03   +8.510065769022474e-04; +4.692432563790308e-03   +3.362283747659157e-03   +4.082110296665404e-04   -5.567723014275983e-03   +7.292920045882844e-04   +1.301954213422267e-02   +2.137397506247123e-02   +1.092776770490955e-02   -3.694590416441786e-03   +9.433782462700492e-03   +1.113951827636361e-02   +9.637639038263816e-03   +6.984852780135393e-03   +2.119176221400568e-02   +1.316366864927523e-02   +1.016268717790339e-02; +1.206334054249027e-02   +3.848896432361034e-03   +9.905852581119604e-03   +1.379558738807257e-02   +6.905032561344133e-03   +5.072744118909629e-03   +6.339301286104795e-03   +3.024521478129821e-03   +6.164908286050926e-03   +1.121702223853127e-02   +4.370371259153813e-03   +1.065095884240383e-02   +1.999583058545575e-03   +8.623077472559086e-04   +1.180410225115141e-03   +9.539699050734480e-03; +6.236356041918946e-03   +6.874593321662273e-03   +6.878978902563455e-03   +1.228847805660352e-02   +1.495106217621233e-02   +7.703171602742297e-03   +6.268405154771078e-03   +1.731198856020065e-02   +1.400460735414775e-02   -3.854214566935832e-03   -3.909148807286272e-05   +9.720569739481698e-03   +1.401245964407662e-02   +1.152040120342556e-02   +8.046270585187566e-03   +1.230841456556496e-02];
L2I_L1I_iGABA_netcon = [+1.845742924100558e-02   +3.495287735475940e-03   +2.259436623600165e-03   +1.574499000731069e-02   +1.776157290201980e-02   +1.108704696483687e-02   +1.898477886307678e-04   +1.961166103672061e-02; +1.570347761122755e-02   +1.088403103880100e-02   +6.433360301631612e-03   +8.309226154015767e-03   +6.344493068292007e-03   +1.042172213079114e-02   +1.626119763209941e-02   -3.961240145992925e-03; +1.204965071872617e-03   +6.968994565154092e-03   +4.336557618914179e-04   +1.058005609791755e-02   +2.075486736782928e-02   +1.744826313767507e-02   +9.848944384196458e-03   +1.202344609611973e-02; +3.089749329777814e-03   +7.822980240394531e-03   +1.005539893629115e-02   +1.251471933963837e-02   +1.403625236249433e-02   +5.062501708464603e-03   +6.011509359668403e-03   +1.520315535147639e-02; +1.411174427544767e-02   +1.204079650042488e-03   +1.354367758530788e-02   +8.075569340018065e-03   +1.124919358263125e-02   +1.696134319969752e-02   +1.170236018260030e-02   +1.276586624322200e-02; +1.399049500437244e-02   +5.893881194003000e-03   +8.214125087255034e-03   +1.161705496364403e-02   +1.216492181385892e-02   +9.204604402101690e-03   -3.459919687870953e-03   +8.074091841788828e-03; -3.727207900583749e-03   +4.288409043534079e-03   +6.102769900096807e-03   +1.111626559957572e-02   +1.404016606221803e-02   -1.896438792948411e-03   +1.097996172626516e-02   +1.963698046545614e-02; +8.598353319738121e-03   +5.249486514805841e-03   +1.295076064424625e-02   +6.703356270067796e-03   +4.320245359700292e-03   +1.713171729596555e-02   +1.308092917467070e-02   -1.375185983862091e-03; +4.320311021529106e-03   +1.013932046125429e-02   +4.384904688874421e-03   +1.046407572973384e-02   +4.424923108980180e-03   +2.414286092256877e-03   +4.511126111412916e-03   +1.173771376199176e-02; +3.190856145913515e-03   +6.035409734789944e-03   -3.338850362255847e-03   +4.624284747354085e-03   +3.854290803545373e-03   +2.910285287235561e-03   +1.804482792258028e-02   +4.735393097347628e-03; +4.056569277935885e-03   +1.935383200315002e-02   +1.440985724506936e-02   +4.112668238979304e-03   +1.746329121514791e-02   +1.561613687160501e-02   +5.069277066696472e-03   +8.194002131835394e-03; +9.317059780877091e-03   +4.831036612579456e-03   +6.269602049357361e-03   +5.666622420403269e-03   +1.912490291207631e-02   +4.689168379083401e-03   +1.055314434473947e-02   +6.229425308484867e-03; -3.119359181090776e-03   +1.567486598182709e-02   +7.737041155269827e-03   -7.001206937918537e-04   +7.120399076587915e-03   +3.619434527100065e-03   +1.440665688273060e-02   +1.016339691206589e-02; +1.118460247667893e-02   +1.735802677635312e-03   +1.593154456161060e-02   +6.708288845707840e-03   +1.138229622080228e-02   +3.153465792043082e-03   +1.693740246939962e-02   +2.278597925575525e-03; +1.005358877973488e-02   +7.137810229666494e-03   -1.948564119556236e-03   +2.005489097192815e-02   +1.265582994449516e-02   +3.336872756498902e-03   +8.787490371609721e-03   +7.881038428041833e-03; -1.556316440606406e-04   +1.126910728987791e-02   +1.056654830231391e-02   +9.153169359162943e-03   +1.518593754135435e-02   -7.976096822087709e-03   +1.292536321190030e-02   +1.135079606422647e-02];
L1I_L2I_iGABA_netcon = [+1.568879401276648e-02   +1.825541139153525e-02   +2.823259757404837e-03   +4.069983412181827e-03   +4.827303835048874e-03   +1.095224279286601e-02   +1.409641065435407e-02   +1.386600459730199e-02   +1.225577152862697e-02   +1.447613119228181e-02   -4.965696114851681e-03   +2.297696602961621e-03   +2.838699946182125e-03   +1.057739062682329e-03   +6.794081533423977e-03   +1.964066810268821e-02; +1.757830551045879e-02   +1.241070558413541e-02   +6.071336044714862e-03   +1.078091857067429e-02   +1.202857236555997e-02   +1.165529989635294e-02   +1.202301357512714e-02   +1.535016188628231e-02   +9.693995182523348e-03   +1.867422646207045e-02   +1.169047619275820e-02   +6.187745972045257e-03   +4.112661930889749e-03   +5.008476002412111e-03   +3.209382436650626e-03   +1.618472944645176e-02; +7.557115311359254e-03   +8.859178741345772e-03   +2.032178546132371e-03   +1.164824199795603e-02   +3.185962707329150e-03   +1.322886262298530e-02   +5.906157073832316e-03   +1.415832367311769e-02   +5.596789058750190e-03   +1.163360233322909e-02   +1.165384584216463e-02   +2.666975561545514e-03   +8.883797434486159e-03   +3.190350570386269e-03   +1.013264302595913e-02   +6.062030576501964e-03; +5.559841179882290e-03   +3.488828279446413e-03   +1.215998642297272e-02   +1.641774338723486e-02   -5.347346216645291e-03   -2.557749130144762e-03   +8.206507566305445e-03   +8.031183911192570e-03   +7.828922351619460e-03   +7.800422828105300e-03   +8.111843415562387e-03   +3.648467700096912e-03   +1.823513286301079e-03   +1.007268381657072e-04   +1.057402042923288e-02   +9.110842494609818e-03; +6.863053788143322e-04   +1.846230148973671e-02   +1.542557742932417e-02   +1.108720250788730e-02   +8.943733148717036e-03   +1.330202838674424e-02   +1.421371506734947e-02   +2.328755472800864e-02   +4.621084540964708e-03   +8.135043476965914e-04   +7.798039564020957e-03   +3.182749305166194e-03   +7.898020696539557e-03   +1.273914481369686e-02   +7.979572138871143e-03   +9.553433021963237e-03; +7.945421583609495e-03   +1.140287856876401e-02   -1.538224689138158e-04   +1.355712086755101e-02   +8.331938561106998e-03   +1.376562420674365e-02   +1.728402014332030e-02   +1.458024328523010e-02   +1.423810258762979e-02   +1.097528911555362e-02   +1.467260439558955e-02   +1.135753545247904e-02   +3.313754947444428e-03   +1.444993728506492e-02   +1.968782758464276e-02   +1.644693807682342e-02; +1.177978258505775e-02   +1.787749249932808e-03   +1.194968723351072e-02   +1.729252684390647e-02   +1.104921358252647e-02   +1.861810716999748e-02   +1.186581807919926e-02   +4.618795158010326e-03   -7.693932084939781e-03   +1.173593587710682e-02   +4.943572746638345e-03   +3.261875845371690e-03   +1.969970612050700e-02   +6.830039738432393e-03   +1.443666900583146e-02   +8.294353782939579e-03; +1.321738237811406e-02   +6.788214659387594e-04   +9.435129503870694e-03   +9.089315260938480e-03   -1.702396302375727e-03   +8.449144633561476e-03   +1.005430254063283e-02   +1.605047055223737e-02   +7.784999394960671e-03   +9.778244016560994e-03   +6.403465059049946e-03   +8.245734996760302e-03   +2.905765885516586e-03   +4.369516576828920e-03   +1.402969324010821e-02   +9.542524273911574e-03];
L2E_L1E_iAMPA_netcon = [+1.130998825150941e-02   +3.345214229455417e-03   +1.231779123529434e-03   +1.216152316814477e-02   -4.204982884855222e-03   -1.656512392211209e-03   +1.131056780721359e-02   +4.828347219964210e-03; +1.112502586827083e-02   +1.016494589826161e-02   +8.234671411069913e-03   +6.189473407863992e-03   +1.336440534680883e-02   +7.835878851368525e-03   +1.062383627709061e-02   +7.116430531593181e-03; -2.340783757995867e-04   -2.580361775452004e-03   +1.690341486353665e-03   +1.244419958499006e-02   +5.740338339085377e-03   +1.683822586677329e-02   +2.427281507277357e-03   +1.100449111722624e-02; -5.975249521928362e-04   +1.385672092397462e-02   +1.621363821228423e-03   +1.973733772197260e-02   +1.886180514050105e-02   +7.954857620861013e-03   +1.573755686584531e-02   +1.596848205497526e-02; +2.709151308963978e-03   +1.811332088502748e-02   +3.140181076918206e-03   -3.340150182840394e-03   +1.263013838830953e-02   +1.811521095912192e-02   +1.591542878448615e-02   +6.506498001323563e-03; +1.018984022071559e-02   +4.801552535760493e-03   +2.060849754867862e-02   +1.337814426808448e-02   +8.415071016178458e-03   +1.439396494242314e-03   +1.326628047400453e-02   +7.968321031691509e-03; +2.932464993476033e-03   +7.231928903342435e-03   +1.096471889409488e-03   +4.491760477781745e-03   +1.319322419629437e-02   +8.827054970170396e-03   +4.387757335746076e-03   +9.537475008293404e-03; +4.219679547692281e-03   -5.499036439518504e-03   +3.484389051633228e-03   +1.735130171816764e-02   +1.007451834427285e-02   +1.449349678124596e-02   +1.290512640362036e-02   +1.468244960221797e-02; +3.951327957908339e-03   +1.763514668637628e-02   +5.634669994862944e-03   +1.123841818309927e-03   +1.866139131666293e-03   +1.824007460560543e-02   +8.206956558545506e-03   +8.633290143858139e-03; +6.783413134337507e-03   +4.231099991223215e-03   +1.697406812239680e-02   +9.041569907735247e-03   +2.139644950792951e-02   +5.103837941305464e-03   -1.674559757771568e-03   +7.521243600814652e-03; +1.715337126895458e-02   +1.119167041454268e-02   -1.078970220222144e-03   +7.110857812285589e-03   +1.460275391859964e-02   +3.142764595527047e-03   +1.373547688544031e-02   +1.763126730892247e-02; -2.200281572038469e-04   +9.881358634438810e-03   +1.204237966065701e-02   +9.623583886223539e-03   +1.061261037326503e-02   -1.539972795954080e-03   +1.481804626134576e-02   +3.553613863726128e-03; +5.269734864282855e-03   +9.656515848339150e-03   -8.086136582117834e-04   +2.078744668022925e-04   +1.811850643585396e-02   +2.179931205554037e-03   +1.252222542567693e-02   +1.004430000048669e-02; +3.763394653710189e-03   +3.801975679952983e-03   +2.771325600589824e-03   +1.044641299329839e-02   +5.693288381273127e-03   +4.528453969633068e-03   +3.785390924967483e-03   +1.712719616759882e-02; +9.281195489919418e-03   +7.784952574094377e-03   +5.244958116816413e-03   +1.803645183909742e-02   +1.945942200506381e-03   -9.577290774350033e-04   +1.059970729559357e-02   -1.338103193494494e-04; +1.286783982227026e-02   +6.683938435692500e-03   -6.113884616974416e-04   +7.018408046138217e-03   -4.426523750312965e-03   +7.201017664171147e-03   +3.239749170055332e-03   +1.231301779432373e-02];
L1E_L2E_iAMPA_netcon = [+2.770891698764405e-04   -1.543098612675429e-03   +1.285004043419574e-02   +1.697366175727160e-02   +1.275975520358197e-02   +1.729706102229373e-02   +1.023162416758533e-02   +1.660007923368028e-02   +3.489997861601866e-03   +4.536684239917479e-03   +1.155328131105553e-02   +5.024178486233846e-03   +4.855452880453647e-03   +1.391398187992254e-02   +1.196080888775874e-02   +1.282387791894657e-02; +1.921642856540620e-03   +9.368171459722628e-03   +3.436679913531250e-03   +5.513585382954708e-03   +1.780460941105955e-03   +1.712240667139481e-02   -3.760788132093436e-03   +3.504327985769768e-03   +3.709417802625591e-04   +2.733905893884009e-03   +8.813369356375509e-03   +1.176777015760612e-02   +1.779758940881748e-03   -9.744109385042225e-04   +7.612420388242779e-03   +5.244618972460259e-03; +3.746711101128549e-03   +1.308816358010451e-02   +1.830775666769552e-02   +2.204385206582020e-02   +1.627794147939029e-02   +3.693565486487090e-03   +1.097089980426887e-02   -5.989970284982082e-03   +5.703445571331077e-03   +7.756348222726382e-03   +6.358240130929187e-03   +1.137842792812102e-03   +8.233169162995321e-03   +6.071556177153966e-03   +1.724265675306901e-02   -3.540995395526988e-03; +1.297109920347792e-02   -6.150725326423178e-03   +1.722244314138039e-04   +1.531777244582735e-03   +1.121884396394929e-02   +5.405366081346191e-03   +1.420263135758020e-02   +9.322222243374693e-03   +1.325451415704781e-02   +1.167258957625779e-02   +5.918362279565108e-04   +1.300220765526742e-02   +1.790746913954245e-02   -1.379171118188317e-03   +2.103010945473719e-02   +1.577797183872271e-02; +5.448828457820208e-03   +1.681923559433293e-02   +9.152437618773381e-03   +1.613609127311668e-03   +6.370493637994693e-04   +1.303370058593823e-02   +1.241571494713511e-02   +3.235143013155149e-03   +6.352555235088406e-03   +2.487825182295263e-03   +6.798912996697109e-03   +1.466533794039427e-02   +6.247041890509737e-03   +1.130237198711450e-02   +2.060853441097210e-02   -1.664093006948445e-03; +3.036142863135973e-03   +1.464785770374836e-02   -2.936704949432372e-03   +1.868572021387907e-02   +1.759721229661113e-02   +1.808612549979235e-02   +6.143795743588805e-03   +8.656382058523992e-03   +6.232652275930976e-03   +6.384352419308505e-03   +8.161580965095293e-03   +1.753432197936931e-02   +1.493411288884773e-02   +1.006562425207506e-02   -1.156192880209892e-03   +1.501767152146273e-02; +5.923176294592542e-03   +4.540038385617900e-03   +1.653023366599169e-02   +7.598318164929044e-03   +7.731563203921770e-03   +9.360500261304125e-03   +8.641908441362384e-03   +1.457925225661067e-02   +9.305076439111146e-03   +1.550667458271983e-02   +6.720089943018408e-03   -6.658129019208725e-03   +5.974110602189773e-03   +1.177249264537711e-02   -6.428923280717294e-04   +6.729429503872226e-03; -2.160545878528245e-03   +1.044941115572993e-02   +7.884967040671695e-03   +4.477880829940970e-03   +5.628904367916106e-03   +1.817197663505034e-02   +1.193356118618946e-02   +1.195340249943002e-02   +1.740034439320936e-02   +6.570861708887390e-03   +1.389191429923810e-03   +2.078073530027667e-02   +1.753549398299758e-02   +9.454159889765033e-03   +5.506035718896599e-03   +8.382740333971392e-04];
L2I_L2E_iAMPA_netcon = [+1.066770421201749e-02   +9.431915266147214e-03   +1.528869402150986e-02   +7.993843939900415e-03   +1.630120753976855e-02   +3.827641535250763e-03   +5.756520936241893e-03   +1.058005472145322e-02; +1.389449578857210e-03   +1.185000906244201e-03   +1.065368885904154e-02   +1.601015187639381e-02   +1.216246280533941e-02   +8.180739548118614e-03   +9.507482013514586e-03   +1.290035703337758e-02; +1.497002458729491e-02   +1.217813901493517e-02   +1.263767964937944e-02   +1.130360928699347e-02   +7.204138395403289e-03   +9.727692856711604e-03   +1.211832303162816e-02   +1.050732378848030e-02; -2.306252964532386e-04   +1.130111223968337e-03   +1.714565042289164e-02   +9.784000556502425e-03   +1.899075000876063e-02   +5.129767250284852e-03   -1.012602953983701e-03   +2.046322923985964e-02; +6.758286255159163e-03   +1.142890340392790e-02   +5.186457351828066e-03   +3.445975649360165e-03   +1.126238683872160e-02   +1.295057210495069e-02   +5.544970076686187e-03   +7.774112837227395e-03; +1.494234326250486e-02   +4.896110394740976e-03   +1.271089723411831e-02   +1.040212275682509e-02   +6.407817972120084e-03   +4.373645094322387e-03   -3.069648081395892e-03   +1.468786832829464e-02; +1.579007009875899e-02   +7.811989754555515e-03   -4.849522093499213e-03   +5.786983436041476e-04   -1.894352911319703e-03   +8.558865434486388e-03   +9.484123425826811e-04   +5.696245019366350e-03; +1.505801253118066e-02   -2.424860326112980e-03   +2.814780444027028e-04   +5.512697818663838e-03   +1.773024093530140e-02   +2.440709879915468e-03   +6.592702967671341e-03   +6.338554933769373e-03];
L2E_L2I_iGABA_netcon = [+1.389154054150438e-02   -9.618167711997676e-04   +4.710245358607411e-03   +4.222784999246302e-03   +1.622410760509482e-02   +7.715429341731097e-03   +3.949916600360329e-03   +1.692938554191570e-02; +2.945994127828641e-03   +1.245544942257228e-02   +5.412288243195001e-03   +1.029474316507629e-03   +1.792256472566287e-02   +1.351319496034052e-02   +1.493069449123967e-02   +2.494233090152907e-03; +4.787275045490536e-03   +1.567718674623430e-03   +7.714167053830259e-03   +5.388206384008185e-03   +8.413189054962968e-03   -6.112481160543182e-03   +1.368483871652209e-02   +1.077342000507259e-02; +9.088356735817314e-03   +3.808063487577912e-03   -1.421330943116032e-03   +1.495336256780253e-02   +1.277398612856620e-02   +1.623795208004216e-02   +1.258515506030698e-02   +8.859079752373114e-03; +2.075758387940144e-03   +1.133502829366621e-02   +9.720022490216050e-03   +1.049500864412668e-02   +7.732537192997768e-03   +3.004502721590936e-03   +5.044747940196278e-03   +2.230653310277188e-04; +1.076459405362937e-02   -3.158545317942977e-03   +9.264638471050851e-03   +1.220613601263203e-02   +1.491909100733932e-02   +6.523671537732680e-03   +2.026500810682183e-02   +1.074749760381302e-02; +8.648664886807709e-04   +2.268306370802356e-02   +1.161810166331153e-03   -9.453983846961889e-03   +1.209965963688398e-02   +5.960078039719535e-03   +6.092447247420719e-03   +6.054372491040114e-03; +1.722330316471783e-02   +2.211368247540074e-03   +1.021261932236042e-02   -5.025517607138959e-04   +4.741020830612214e-03   +1.292045454253934e-02   +1.457492632332822e-02   +1.745784109010821e-02];
L3E_L2E_iAMPA_netcon = [+6.856536159529111e-03   +1.590794628978660e-02   +4.699270387624365e-03   -1.798902155207439e-04   -8.635018987072945e-03   +1.385411550828513e-02   +4.465833195487438e-03   +1.653051443196383e-02   +1.311391039593548e-03   +5.458631466713975e-03   +5.290907949871000e-03   -2.282275578300529e-03; +5.552222508014679e-03   +1.668705690009437e-02   +3.592742579915205e-03   +1.060350235927094e-02   +6.730579334190283e-03   +6.336722029044565e-03   +1.397117938290146e-02   +2.089608987981771e-02   +1.469490308987864e-02   +1.989561300070638e-02   +1.169988487263879e-02   +6.130636731029471e-04; +2.934004685816081e-04   +1.345625224046964e-02   +9.026135905660608e-04   +1.432162713146950e-02   -2.110291475826572e-04   -3.563598344234302e-03   +9.974047905940695e-03   +2.292098471379130e-02   +1.062662070700432e-02   +8.735986886817522e-03   +1.018057639402093e-02   +1.445179920329918e-02; +1.572104248771880e-03   +2.701873583955639e-03   +1.191512909078988e-02   +1.341513411105462e-02   +7.559532110240552e-03   -8.603781307718777e-04   +8.224116872384250e-03   -1.709616997759810e-03   +4.019342463223513e-03   +1.075447189182844e-02   +3.492095905290342e-03   +6.654819461533275e-03; +1.756021984523295e-02   +3.324823500344728e-03   +2.870241587723291e-03   +1.906791789979532e-02   +7.630669469607066e-03   +5.240111634169176e-03   +1.913379142642720e-02   +9.808848829734687e-04   +7.997021095957010e-03   +1.885300142373863e-02   +1.010044268773255e-02   +6.442918993883317e-03; +1.742414065620886e-02   +5.999227234503881e-03   +3.248604493745056e-03   +6.774189762847528e-03   +5.969245222331496e-03   +1.953717563258717e-02   +2.013340069437842e-02   +9.597339357974438e-03   +5.280624458683871e-03   -2.047887987288828e-03   +1.750558297008589e-02   +2.489615037296954e-03; +1.189741583542136e-02   +7.139711578055164e-03   +1.336252461177138e-02   +7.068063083617129e-03   -1.918234180250472e-03   +5.869245748378481e-03   +7.072655593312233e-03   +9.542597996556332e-03   +3.033323333112179e-03   +2.210416242728110e-03   -1.964955700647395e-03   +7.900701505264323e-03; +1.470622234126781e-02   -7.151477718354360e-04   -8.929244647456499e-05   +5.561791487748487e-03   +6.886494964749378e-03   +3.874794280141477e-03   +1.994623025835183e-03   +5.070604288578219e-03   +3.843681895429358e-03   +1.599035275472050e-02   +2.029391490222514e-03   +5.802338050778930e-03];
L3I_L2I_iGABA_netcon = [+1.214795958341335e-02   +8.477017957655193e-03   +1.371330445704045e-02   +1.028556390203697e-02   +1.682305585575576e-02   +1.132401768527738e-02   +4.400507982062204e-03   -4.136623346645281e-03   +1.721211981135532e-02   +1.278795426236736e-02   -1.632079632725638e-03   +1.853885594116727e-02; +1.129624904273667e-02   +1.587862350869268e-02   +1.783208361935863e-02   +2.570814555318802e-03   +6.144033485499316e-03   +1.400947634175066e-02   +2.493729981583258e-04   -2.337140871587284e-04   +1.062784270014192e-02   +8.448857648179714e-03   -5.206762353275470e-03   +5.620623841258973e-03; -2.828518470618848e-03   +8.860490979139702e-03   +1.308183164404931e-02   -4.412607344920287e-03   +1.160023112318610e-02   -1.681405350149641e-03   +1.165475708020051e-02   +1.396483457040041e-02   +1.205575756548650e-02   -5.193425875938335e-03   +8.426362015680408e-03   -4.160191820825696e-04; +1.831357279766195e-02   +2.011753927619596e-03   -3.810676778060439e-03   +9.892128365018942e-03   +1.692258614854457e-02   +1.232059838549614e-02   -6.527918811414519e-03   +6.010628925166133e-03   +1.501565183510194e-02   +3.928231882616361e-03   +1.428490248894950e-02   +1.403714776673036e-02; +9.000922871749761e-03   +2.121472093770669e-02   -1.628299601462742e-03   +2.019806679466035e-03   +5.080185408868560e-03   +1.377787971175500e-02   -2.880310436437479e-04   -3.313704197959556e-03   +1.592051821842442e-02   +1.396249791220397e-02   -4.637317445437763e-03   +4.603791720949713e-03; +5.443861191173924e-04   +1.323606470948749e-02   +6.376003436728753e-03   +1.836789875338806e-03   +5.580790084267383e-03   +8.114255769970982e-03   +1.141112833836532e-02   +6.694040365535508e-03   -1.635026195457134e-03   +7.325897131700631e-03   +6.787540564499344e-03   +1.764610912192462e-03; +1.394804883372922e-02   +1.019361789590435e-02   +8.562566292824736e-03   +1.603769850652764e-02   +8.951353232858361e-03   +3.027881919367779e-03   +4.907214112182134e-03   +2.829655524532039e-03   +1.245685089898897e-02   +9.006181080308788e-03   +6.160519069433915e-03   +5.178601633166221e-03; +3.956212878182213e-03   +2.017356347806455e-03   +1.069644595068983e-02   +9.013341298370088e-03   +3.405148964288518e-03   +9.481723691908903e-05   +1.000357526162265e-03   +4.986221106474263e-03   +1.355490936634500e-02   +8.590337809388855e-03   +2.833250247092109e-03   +9.040548690262778e-03];
L2E_L3E_iAMPA_netcon = [+1.144768010565393e-02   +1.287059791155108e-02   +1.058267753396439e-02   +1.211461849790207e-02   +2.614271229497455e-03   +8.234215642142741e-03   +1.687676472349156e-02   +1.669844573192937e-02; +6.890723145562511e-03   +1.160090239678016e-02   +1.630597660995364e-02   +8.188713090873389e-03   +6.760159224189280e-03   +1.155782478797004e-02   +1.815425177422393e-02   +9.599689032934303e-03; +1.489448147793953e-02   +1.529118512286405e-02   +2.054139989383544e-02   +1.510275929834273e-02   +1.168943955612488e-02   +1.537340968813599e-02   +1.049137328933278e-02   +1.252207981118547e-02; +4.748681063536507e-03   +1.545814337983543e-02   +9.250744111841350e-03   +1.657729275150992e-04   +9.006359781084902e-03   +9.417713723889814e-03   +7.875762639670235e-07   +4.427447499195344e-03; +7.025028283507985e-03   +1.151345244623119e-02   +3.009728369726372e-03   +1.632968616384589e-03   +8.392501679993563e-04   +6.885953249402352e-03   +1.290835777093695e-02   +1.014439333704757e-02; +1.116493522496640e-02   +1.707504937660652e-02   +1.428396908098049e-02   +3.871303229011371e-03   +1.334559479233657e-02   +2.244067195496964e-02   +5.830255602914548e-03   +1.330271033560946e-02; +2.795041898389490e-03   +1.450724318621330e-03   +1.033103341094872e-02   -1.444397835589777e-04   +7.279569927261247e-03   +1.428205052227350e-02   +1.275616888032680e-03   +8.185002143745198e-03; +1.871265878355609e-02   +1.346174823611081e-02   +1.604415776296705e-02   +1.634760316619277e-02   +9.137133663448663e-03   +2.039004429177679e-02   +1.157956778343353e-02   +3.597496498089234e-03; +6.044118948990279e-03   +5.947382160184945e-03   +1.867145744801904e-02   +1.407349469184921e-02   +1.268365314228267e-02   +8.561982865171083e-03   +1.456852438287578e-02   +1.124041988056528e-02; -3.034080145698958e-03   +8.476571154208176e-03   +1.275898732685068e-02   +1.443924306199183e-02   +1.679646676668893e-02   +2.351704651965309e-03   -7.916981423814976e-04   +1.316472221984130e-02; +1.320359650847131e-02   +3.354129819554843e-03   +1.054141497719611e-02   +9.779993928863607e-03   +1.948673045331550e-02   +1.348707109598249e-02   +5.439930887919856e-03   +2.705200038130184e-03; +3.674043802632569e-03   +1.030317597494726e-02   +4.079730644612085e-03   +1.198016557271920e-02   +8.740392644197769e-03   +7.021149477732802e-04   +1.643231436163900e-02   +1.937710863301501e-02];
L2I_L3I_iGABA_netcon = [+2.070142772981588e-02   +5.953086855510766e-03   +1.233096090104552e-03   +5.688305493000097e-03   +1.077741331921192e-02   +1.738196270899639e-02   -5.482314203356816e-03   +8.984869893795570e-03; +9.219526448467156e-03   +1.307848292524701e-02   +1.903617542605921e-02   -9.995563888200519e-04   +1.263527915521520e-02   +1.384126623678294e-02   +8.395328756814542e-03   +6.518654908244838e-03; +1.060827646001657e-02   +1.066043256075601e-02   +1.144741765680331e-02   +9.169165823177979e-03   +4.616970769040970e-03   +9.885518928933912e-03   +5.491416170070535e-03   +2.646684740862739e-03; -1.840310825030817e-03   +1.217272064334774e-02   -4.459651674371567e-03   +1.032013066276093e-03   +2.928333170102580e-03   +2.086958753650565e-03   +7.859460407504737e-03   +1.315706830143216e-02; +4.623777990992587e-03   +6.106312018178263e-03   +3.886224668265692e-03   +5.523206420025185e-03   +8.420994951304221e-03   +2.965349019961349e-03   +2.819966802415701e-03   +5.611200719252769e-03; -1.597331692189086e-03   -6.275014551866248e-03   +9.643667954167323e-03   +6.625034821360815e-03   +4.675178491033605e-03   +8.625624818396044e-03   +1.382324706016752e-02   +1.264576558131656e-02; +2.763466860303672e-03   +1.224219699168706e-02   +1.377325952618735e-02   +1.380674914999701e-02   +9.978635890256715e-03   +3.225008982212902e-04   +6.719246523326079e-03   +1.123481057362044e-02; -4.621361153819417e-03   +2.117253205674813e-02   -2.383659844045679e-03   +7.278022470201624e-03   +5.404159606318899e-03   +1.340535827694903e-02   +1.093446893781896e-02   +9.494574192958802e-03; +1.151445756948069e-02   +1.211669475525197e-02   +1.968673671051602e-02   +5.321619364440471e-03   +6.687505018311491e-03   +5.899447231709514e-04   +1.784068924452676e-03   +1.108981149615013e-02; +1.421466433091312e-02   +1.348434340036245e-02   -2.551267660824393e-03   +7.484835285656801e-03   +2.332774193863985e-03   -4.021164140741570e-03   +6.377342447532903e-03   +6.676818942297187e-03; +1.490280264385460e-02   +2.037742922062864e-02   +3.050546558913563e-03   +6.802258493478609e-03   +6.447086391902945e-03   +5.211854517808636e-03   +1.331084769054379e-02   -3.135022513982750e-03; +1.398776696198172e-02   -4.933925487305116e-03   -6.197015451413876e-04   +6.758466852366068e-03   -5.452782836626092e-04   +1.316318414101568e-02   +1.139489453563726e-02   +7.963658848856650e-03];
L3I_L3E_iAMPA_netcon = [+9.245380347440487e-03   +1.532816489479307e-02   +9.393658474275479e-03   +1.001451149209627e-02   +1.725579800978685e-02   +7.982486785861559e-03   +8.974854673232830e-03   +6.946374632295356e-04   +1.038036854290864e-02   +4.147028077736054e-03   +5.923772946937255e-03   +4.825255234102858e-03; +8.896719763381133e-03   +9.485353806563070e-03   +1.325596990526148e-03   +5.294573422651751e-03   -5.033313769297667e-03   +1.126863217160524e-02   +1.123036368279106e-02   +7.538906961685462e-03   +6.992907298558185e-03   +9.752583777872565e-03   +1.759103664141137e-02   +1.194159610692878e-02; +5.105147936179550e-03   +1.274401261407207e-02   +3.323233592219470e-03   +1.523117063224955e-02   +7.241925465849872e-03   +7.078413572097275e-03   +7.082277066794786e-03   +2.680372406994360e-03   +1.143464635063616e-02   +8.546488009720618e-03   +7.783306726642835e-03   +1.633690042711985e-02; +1.041364721106836e-02   +1.587384399386812e-02   +5.878788394545476e-03   +4.915045532645429e-03   +9.761605890806144e-03   +1.163166492814628e-02   +1.633925068005102e-02   +4.882941538979518e-03   +1.401816604332037e-02   +1.963231502612186e-02   +9.774384957814162e-03   +1.405465256045152e-02; +3.781253406572789e-03   +8.396448080630359e-03   +6.725327595017109e-03   +1.090452815342240e-02   +9.321500978118777e-03   +5.983051203526430e-03   +1.591554191296738e-02   -9.407427839151612e-04   +8.000554181233951e-03   +3.678866197425253e-03   +6.333997383256018e-03   +9.425308455275772e-03; -2.436888332461342e-03   +4.197164648241795e-03   +1.752431724904711e-02   +1.100193315204254e-02   +1.514909112709831e-02   +7.792626517588079e-03   +1.643401397938108e-02   +1.297886581851302e-03   +1.076230992923137e-02   +1.609823502784620e-03   -3.420195723896973e-03   +4.230710413250068e-03; +1.241398610401774e-02   +2.874377660511931e-03   +1.025072297938212e-02   +3.888518965360212e-03   +7.797081496564350e-03   +2.660347677696105e-03   +6.087063017841496e-03   +1.570511447571446e-02   +1.179549829499905e-02   +1.500731462002215e-02   +6.339891131631699e-03   +1.073413057930649e-02; +1.095292809093532e-02   +9.981486035413115e-04   +1.537334302620359e-02   +6.364220050937017e-03   +1.643922642627381e-02   +6.275714596794497e-03   -9.448072555983326e-04   +6.627782497021487e-03   +2.766101190381458e-03   +5.038730590428843e-03   +4.786710003706172e-03   +1.432214529653466e-02; +3.580608965691338e-03   +1.312913325349061e-02   +7.530837984372962e-03   +9.054984287784411e-03   +9.235719051634709e-03   +1.516448037739130e-02   -4.187084697907960e-03   +1.401973005816705e-02   +1.225438585250789e-02   +1.045712570905896e-02   +9.329049665913828e-03   -7.400965492354416e-04; +1.644471077828534e-02   +1.073779727716770e-02   +1.522686478855108e-02   +1.005092214530171e-02   +1.249709488758987e-02   +1.379407547899427e-02   +1.790359545348322e-03   +2.077368620252059e-02   +1.043565039506119e-02   +4.642728926711877e-03   +9.756588533278585e-03   +5.115548932441197e-03; +9.202846160675623e-03   +6.884075697639125e-03   +1.543940923474592e-02   +1.940112494696493e-02   -7.108822210525821e-03   +1.430161759182891e-02   +2.534417666887915e-04   +5.600015437031560e-03   +3.501178777694678e-03   +1.375596045521773e-02   +5.279057397466517e-03   +4.134472168592038e-03; +9.708161992900569e-04   +5.946111004656089e-03   +2.475715909215594e-03   +1.575715504391739e-02   +6.978053960898721e-03   +4.487011742638171e-04   +1.950247526057398e-02   -5.885042940372149e-04   +2.530350966353414e-03   +1.314993464291025e-03   +1.780188224616464e-02   +2.684258015467075e-03];
L3E_L3I_iGABA_netcon = [-5.070716696002044e-04   +9.893195243250035e-03   +5.547464479983213e-03   +1.875295255643946e-02   +1.035970016523457e-02   +1.604891649346928e-02   +5.945164538636812e-03   +9.824930338283085e-03   +8.292153789526722e-03   +1.326229189703958e-02   +5.957374183399250e-03   +1.477890202477000e-06; +9.070137764654112e-03   +1.263614195015931e-02   +6.657851552465229e-03   +5.117318013937115e-03   +6.427096771339780e-03   +1.288505990305747e-02   +9.526535638942709e-03   +1.328838270579974e-02   +1.425626931218232e-02   +8.616046756546050e-03   +4.108907979958278e-03   +1.403772790131672e-03; +1.908296175018335e-04   +1.168339617820784e-02   +1.011925649394825e-02   +1.025142871638889e-02   -2.254251378902825e-03   +1.673826989748688e-02   +9.901791537136957e-03   +1.465848759544589e-02   +7.482263286433066e-03   +7.651469040840436e-03   +7.719131502165797e-03   -8.578720797479424e-04; -2.524819117419026e-04   -1.916038385482555e-03   +6.948194724069631e-04   +1.493918168560218e-02   +1.133137093679069e-02   +6.955633039679294e-03   -3.770418798610046e-04   +5.274198578441851e-03   +1.072109587769433e-02   +1.096525198955300e-03   -4.805091011846696e-03   +1.216571387039850e-02; +1.349158442820772e-04   +1.132227651320981e-02   +1.995148764415754e-02   +5.115333071224095e-03   +7.915670820638075e-03   +1.272699946490345e-02   +1.854122603168478e-02   +1.527481818203236e-02   +5.283562175005167e-03   +1.300712182746849e-02   +1.538642031010706e-02   +6.267415349895378e-03; +1.277292498393541e-02   +8.271602861479918e-03   +1.786426246057374e-02   +7.705612502029907e-03   +7.479166802004660e-04   +2.068754767803661e-02   -5.964141178720966e-04   -5.044325518008128e-03   +1.078122758582865e-02   +1.298489236751723e-02   +3.104318417045600e-03   -1.950114432280897e-03; +7.312896810862270e-03   +9.948682453181291e-03   +4.265756896868276e-03   +1.390755614407812e-02   +1.022054283622996e-02   +9.008706008994970e-03   +4.443459977936464e-03   -1.862833360089946e-03   +1.140803800209340e-02   -3.448777996824199e-03   +7.452963799299611e-04   +9.792381287476519e-03; +2.156544352378146e-03   +2.197666649300121e-03   +9.864102551615303e-03   +1.586522775032219e-02   +6.795848665443683e-03   +1.344916634198592e-02   +9.040644254413682e-03   +1.082022867154817e-02   +1.310399583654990e-02   +1.458468587979296e-02   +3.388742512898998e-03   +1.373624080406109e-02; +4.586489177834155e-03   +3.312279283631246e-03   +1.670469998131082e-02   +3.046571933959545e-03   +1.291789746085177e-02   +1.483562538183509e-02   +6.409475703290755e-03   +2.252433723951605e-02   +1.611946930169814e-03   +2.853100388268050e-03   +7.674081520249972e-03   +1.135407030754751e-02; +1.600610348295542e-02   +4.501449715091125e-03   +1.809671199497326e-02   +3.012713642184982e-03   +2.052414184236084e-04   +1.925323898467768e-02   +1.153307839992668e-02   +4.681125278066741e-03   +1.596781624326190e-02   +1.447325113267160e-02   +5.238327839889902e-03   +1.653439534655815e-04; +7.510178899080089e-03   +6.066257819527383e-03   +2.353442912224626e-03   +1.896316336545488e-03   +1.281989975561766e-02   +7.669055705030651e-03   +1.822050509793046e-02   +1.212403920163378e-02   +1.202157398935895e-02   +7.676625881176756e-03   -5.521686486911079e-03   +1.316196610482658e-02; +1.001500458412620e-02   +7.518859444664149e-03   +1.342348858033168e-02   +8.309083088543529e-03   +1.613849472041815e-03   +4.737453755459633e-03   +1.369642622706661e-02   -6.428132966467884e-03   +2.240409321185687e-02   +9.317656484572237e-03   +7.739166139397775e-03   +4.619997742991403e-03];
L2E_Input1_iAMPA_netcon = [+1.329508251309469e-02   +1.456223587722760e-02   +1.199487085392030e-02   +1.983361543176293e-02   +2.231848305896798e-02   +1.891241668124930e-02   +1.418514153330118e-02   +6.925440144909169e-03];
L2I_Input2_iAMPA_netcon = [+8.793417253931502e-03   +2.138944130437324e-02   +1.998634947174455e-02   +1.221909867367939e-02   +1.222014035572635e-02   +1.826485209192437e-02   +1.770940379558895e-02   +1.633623770087683e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
