function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.995090689681330e-01   +5.254360284395081e-01   +5.763832821380778e-01   +6.669083612375180e-02   +3.878671788594906e-01   +8.474083706472990e-01   +9.367241978453189e-01   +6.827181431105074e-02   +1.120964516028855e-01   +2.985433935673378e-01   +3.668545187127036e-01   +7.891065159906593e-01   +3.736704152163630e-01   +5.360177788115073e-01   +8.894314417959840e-01   +7.507397670003713e-01; +3.600122759854748e-01   +2.572167996197153e-01   +4.700368142865385e-01   +4.849581176438028e-01   +2.836492524596406e-01   +3.018246473787722e-01   +2.014285004917417e-01   +7.812490735211510e-01   +4.756810428578025e-02   +9.048242966213049e-01   +3.867425779602094e-01   +8.530753409365468e-01   +9.545052466491512e-01   +3.223708016972064e-01   +7.451516999992299e-01   +6.608888593129791e-01; +1.477351129859202e-01   +2.013105618728901e-01   +8.716950457165441e-01   +8.673714592108092e-01   +7.444490361503293e-01   +3.786712204841041e-01   +3.919204894066609e-01   +7.512878310119981e-01   +3.437868146692347e-01   +7.507353965296253e-03   +4.914832507577388e-01   +8.927289338046625e-01   +1.745407276934052e-01   +2.503767499260195e-01   +7.928087944172297e-01   +1.605639100696898e-01; +5.663747269700056e-01   +9.881408641333231e-01   +8.251932125707678e-01   +7.834075239155762e-01   +3.119610435129684e-01   +3.829304192668475e-01   +8.459872910953630e-01   +4.165261548955929e-01   +9.158869454872227e-01   +5.355683513239883e-01   +3.566361705388401e-02   +5.420703884159497e-01   +7.911875364243715e-01   +9.639268782731312e-01   +1.594420724063223e-02   +4.621420194539246e-01; +4.884214308433213e-01   +8.957363158049165e-01   +1.807219065591711e-01   +4.023527804297168e-01   +3.193010764346633e-01   +2.081837122940783e-01   +5.692996375547379e-01   +7.402264013160141e-01   +9.837415276695544e-01   +4.093935966062499e-01   +8.283550302650100e-01   +6.408831665885235e-01   +4.609085436544451e-01   +6.601125224517076e-01   +5.245968457355878e-01   +3.552369236860522e-01; +8.509264979726270e-01   +8.501950365929055e-01   +5.952305014741930e-01   +3.567700834189820e-01   +1.555299006528626e-01   +5.669853853853514e-01   +8.077647460117201e-01   +2.295587971087922e-01   +3.277062521703266e-01   +7.420768704605276e-01   +4.309730717117554e-01   +9.510823936063010e-01   +6.182011382668320e-01   +8.059790266847742e-01   +8.195580604080857e-01   +9.181571406872753e-02; +7.315458120343047e-01   +8.393955960766157e-01   +5.042235705631558e-01   +5.799444772424664e-01   +6.252364098004830e-01   +4.944823317165389e-01   +6.488656861598039e-01   +8.864590228168827e-02   +1.838973840943438e-01   +4.262459987191366e-01   +5.826016504098946e-01   +5.950330997334926e-01   +8.139633800643713e-01   +3.616901883127914e-01   +7.404612823440924e-01   +3.186686534759748e-01; +4.081105930791007e-01   +4.974795935460426e-01   +7.632593432563149e-02   +2.486106240891326e-01   +5.211555113013557e-01   +1.834677104539795e-01   +5.393320934116859e-01   +3.045800876961584e-01   +1.914001228417510e-01   +2.518440859317093e-01   +5.900165715856802e-01   +5.081427868465326e-01   +1.864816367189624e-01   +7.295049672704959e-01   +3.003391824221305e-01   +7.201846384253512e-02; +6.309615758403047e-01   +2.425076956678920e-01   +6.810067801139532e-01   +2.989178515999698e-01   +6.845489927224708e-01   +6.030721936808976e-01   +1.744925753232628e-03   +5.280327134050281e-01   +4.777304673498226e-01   +5.678731550374081e-01   +6.326503869537308e-01   +8.597364246745944e-01   +7.013978511007579e-01   +7.636055954990657e-01   +7.683705135949576e-01   +7.794526093050941e-01; +3.352844772301847e-01   +8.209802348652567e-01   +5.838331735074743e-01   +1.365128301422047e-01   +8.530206802047823e-01   +9.129960092157248e-01   +6.654487540328053e-01   +5.526493840518635e-01   +1.556525649371035e-01   +2.621181545540143e-01   +1.279120283919154e-01   +3.672855323588804e-01   +2.913981055281019e-01   +1.142832408158897e-01   +4.162589428984008e-01   +4.470127824162684e-01; +1.988593660021047e-01   +1.763365340796311e-01   +5.248492911305460e-01   +4.794246639206525e-01   +8.268390119355687e-01   +9.134901246553914e-01   +7.261240654253037e-01   +4.376683218056648e-01   +7.583103952193189e-01   +4.733528971433764e-01   +7.185989194022804e-01   +3.479438880144394e-01   +2.175531670710562e-01   +1.524992085769235e-01   +7.345694294053278e-01   -2.416668356980673e-02; +5.433863396078286e-01   +8.675881146470743e-02   +3.489347692117111e-01   +4.081672562597460e-01   +2.880509629670475e-01   +6.323208767276622e-01   +5.152926306958621e-01   +8.159675425812909e-01   +7.835934651790579e-01   +9.595266102703248e-01   +4.905544697150184e-01   +9.268663756716632e-01   +6.135061845600140e-01   +3.641480661231713e-01   +7.199683244932678e-01   +9.244939906573058e-01; -3.177705984982975e-02   +2.945398982438531e-01   +1.000000000000000e+00   +3.018590363812396e-01   +6.351476105373879e-02   +8.362262298271527e-01   +8.584620095379323e-01   +6.126349440059308e-01   +7.549241192607367e-01   +9.711875909926688e-01   +1.639419133392455e-01   +7.828490995568094e-01   +8.195559098846305e-01   +5.310020673411654e-01   +8.460230860792879e-01   +6.833686938648714e-01; +4.087972924445842e-02   +9.911834219526900e-01   +5.652898122924299e-01   +1.753695518521014e-01   +3.231599550954348e-01   +4.724703038187905e-01   +5.897168914781763e-01   +8.470795248541440e-01   +9.672938634230673e-02   +7.922587599328121e-01   +6.791805082416983e-01   +3.812668598331766e-01   +8.521315484885617e-01   +6.528431681165489e-01   +2.692448456507940e-01   +7.013838352248337e-01; +2.252594633181190e-01   +4.072018715362594e-01   +8.077067909381440e-01   +7.589014244847542e-02   +4.146383367422977e-01   +2.340037192468545e-01   +9.038342023866280e-01   +8.281379113167672e-01   +1.639590216441195e-01   +9.942874192808991e-01   +3.162758744437104e-01   +5.775992695763441e-02   +3.497593311013986e-01   +2.888324234158168e-03   +6.127957635146958e-01   +6.748965588437233e-01; +6.436208442676159e-01   +8.201977914431160e-01   +9.106664512178398e-01   +7.138356035739182e-01   +7.716754896597071e-01   +6.174451654827121e-01   +1.029370681685850e-01   +5.540791457275308e-01   +7.551733528991332e-01   +9.065421702610267e-01   +2.849206029534018e-01   +5.593713858515021e-01   +2.297508746860776e-01   +8.676050204755923e-01   +8.504224005321845e-01   +9.565175773389067e-01];
L1E_L1I_iGABA_netcon = [+4.675144702154452e-01   +3.090108155150556e-01   +1.357050362998533e-01   +4.049202323870897e-01   +2.037595696258023e-01   +4.432640298756750e-01   +8.269391363135091e-02   +4.620747614890671e-01   +5.531503348098976e-01   +4.356153673551480e-01   +6.844741381852080e-01   +5.336895185144964e-01   +3.844552235720750e-02   +8.933140985285636e-01   +5.222499835493953e-01   +8.761908599669468e-02; +3.907955348606202e-01   +3.512380632665502e-02   +6.592768229708829e-01   +4.298693068267579e-01   +5.890487445479673e-01   +4.735624792163552e-01   +4.957813369515575e-01   +5.797731865592242e-01   +4.447742854269527e-02   +4.230693955034385e-01   +2.650281235643992e-01   +5.897067792634763e-01   +1.555994718607955e-01   +2.139842644602854e-01   +5.040649790335386e-01   +4.786399484310254e-01; +7.594839822070792e-01   +1.265156537654361e-01   +4.826225453367713e-01   +9.472226215131679e-01   +7.714744298158143e-01   +5.571510132932762e-01   +4.031281021747408e-01   +6.498607051304560e-01   +1.866400073763952e-01   +3.507045486601595e-01   +4.752010597272268e-01   +3.235491696624166e-01   +1.000000000000000e+00   +7.460159844038541e-01   +4.426306426667488e-02   +7.161532997130462e-01; +2.944155013461770e-02   +8.914744573951311e-01   +7.109638366802777e-01   +1.851782424929421e-01   +5.581182005498802e-01   +8.156388280933033e-01   +3.149178850279206e-02   +5.707065156519129e-01   +2.302054697231154e-01   +1.187140976390954e-01   +9.789855470203108e-02   +5.984145963891568e-01   +1.173183725971928e-01   +6.181095641494124e-01   +3.507222566397128e-01   +5.643462423260881e-01; +3.861664135661519e-01   +3.052230454571788e-01   +2.400422268622271e-02   +4.680233995823230e-01   +3.431484969594873e-01   +5.130999681211132e-01   +1.155618268141115e-01   +3.641358150101154e-01   +2.292185655674480e-01   +4.329011732770764e-02   +9.541098512693855e-02   +8.533414152328527e-01   +2.438236218692318e-01   +3.069320526024510e-01   +8.638970476116453e-01   +8.926640365618711e-01; +6.137956355478367e-01   +1.718643529018940e-01   -1.716881572115977e-02   +1.740203304387997e-01   +4.838666663783338e-02   +6.914963820941609e-01   +1.819850882728759e-01   +8.731385812175645e-01   +4.630263934945174e-01   +8.752519917058486e-01   +8.012811723452946e-01   +7.715254099173311e-01   +7.560663422706341e-01   +2.653235743902537e-01   +6.884753250523382e-02   +3.138592938815691e-01; +9.641906850800159e-01   +1.705350098499715e-02   +6.464187667228576e-02   +1.521540022088629e-01   +5.547431640857073e-01   +6.035081000699306e-01   +9.198489572523803e-01   +1.611294445985639e-02   +4.124822053499798e-01   +8.690808071665738e-01   +1.436968421369225e-01   +4.061545939980271e-01   +5.172705270022013e-01   +3.817413000371137e-01   +2.377509746397789e-01   +2.654901476495965e-01; +4.750942644975705e-01   +7.072886305641640e-02   +7.204815177789093e-01   +9.645479468404644e-01   +1.617876487382526e-01   +5.063849759707277e-01   +1.558721566093000e-01   +8.637712960503828e-01   +3.012410264505244e-01   +2.940534267039999e-01   +8.674991743570568e-02   +9.496651688900684e-01   +6.308173489242532e-01   +4.383764111690907e-01   +6.660699111310792e-02   +7.393584236840054e-01; +9.970571150997670e-02   +7.935568536489191e-01   +5.745467167796462e-01   +1.377874646416041e-01   +9.187803517580776e-01   +4.448038114191568e-01   +4.860848007060353e-01   +5.471046115914302e-01   +1.424601810108053e-01   +9.242081432901009e-01   -1.385117287060381e-02   +9.475143671758699e-01   +2.201969948256166e-01   +3.382592154199994e-01   +3.465466188074894e-01   +3.005841802034413e-01; +2.738834748780841e-01   +3.728882796979697e-01   +8.833267159880892e-02   +4.650593093580804e-02   +7.887634726938793e-01   +3.045648671514551e-02   +7.032244840016285e-01   +8.675157844323039e-01   +3.162339052222188e-01   +9.204231548631476e-01   +3.383754903664221e-01   +8.196187887605113e-01   +4.504068225517235e-01   +5.098276610135880e-01   +3.487296058005523e-01   +8.895815735371819e-01; +6.368226492245259e-01   +8.279649267123080e-01   +8.707151341170284e-01   +7.322290169460136e-01   +7.054813432184823e-01   +6.439520053602686e-01   +1.127626879868948e-01   +9.441375141031373e-02   +4.276091494917984e-01   +3.514678614748951e-04   +7.332709979753285e-01   +6.623478578296135e-01   +2.326802795848407e-01   +9.357318050120217e-01   -1.419879643668771e-03   +7.297951874388828e-01; +2.738570464234976e-01   +7.381558706076442e-01   +6.578265591069429e-01   +7.647678862108881e-01   +9.814747253813624e-02   +3.846860707232858e-01   +4.123539029766624e-01   +6.104567473717116e-01   +8.459554996597748e-01   +4.784504605321095e-01   +7.266237260151839e-01   +9.690531436796597e-01   +3.389794112151372e-01   +9.327900903011074e-01   +8.579224528952657e-01   +5.999877672677759e-01; +6.294992457586976e-02   +4.399038847867179e-01   +1.078471730539183e-01   +5.611392866190599e-01   +3.039708826078186e-01   +8.568752524672634e-01   +6.966497490684848e-01   +4.274339591906836e-01   +5.214098126787465e-01   +8.223066647018387e-01   +2.566646579606809e-01   -1.624740293450731e-02   +3.716005502884905e-01   +8.695157537869111e-02   +2.587905707423798e-01   +8.629441506299653e-01; +8.771962209382759e-01   +5.213996236282763e-02   +6.299643203005848e-01   +5.882521302923822e-01   +5.085447623494802e-01   +1.614308106814983e-01   +5.851008391386008e-01   +2.437229909332876e-01   +6.157402267248882e-01   +9.267142525485997e-02   +4.176425787512671e-01   +6.937464691851890e-01   +7.313617942079373e-01   +9.498027825364971e-01   +1.786068357434407e-01   +2.043177946106180e-01; +2.578374113489723e-01   +7.279364496995052e-01   +1.187952528663103e-01   +7.940805601265294e-02   +7.893587899567479e-01   +4.105105114172315e-01   +9.276172638562670e-01   +9.084161815364509e-01   +9.359932199705804e-01   +8.438652050961460e-01   +8.456840733878285e-01   +6.806389537807391e-01   +4.073809902285726e-01   +1.060574696595763e-01   +3.083728712139825e-01   +3.666680066716808e-01; +3.312733038872233e-01   +8.611962357612812e-02   +6.711991360391213e-01   +1.750593329959710e-01   +4.322609196762288e-01   +7.781412080663573e-01   +5.416011650440327e-01   +2.119114070111498e-01   +7.534497140906220e-01   +9.415938833804041e-01   +5.054848941524429e-01   +6.624974123591748e-01   +8.108602859979828e-01   +2.934958084218798e-01   +6.888718207485330e-02   +3.901856473466721e-02];
L2I_L1I_iGABA_netcon = [+9.426321301889207e-02   +6.519873002337625e-01   +9.087893386872533e-01   +7.039906365975077e-02   +6.776914511017372e-01   +4.560125442212394e-01   +8.985355193613299e-01   +8.113393528118661e-01; +1.106241143830772e-01   +3.824443229658545e-01   +4.768754941211511e-01   +2.131039484927125e-01   +8.676575445874031e-01   +4.734317768399013e-02   +6.727140263512975e-01   +9.700585442654218e-01; +9.980106107808491e-02   +8.374208317850168e-01   +6.695548877240022e-01   +7.120807116602179e-01   +7.581750684847074e-01   +6.505500631443195e-01   +4.295063213210160e-01   +2.634501412437613e-01; +7.878164855607980e-01   +5.438314305192820e-01   +5.881591619124933e-01   +8.098994890191172e-01   +3.309798523510449e-01   +1.168729438947754e-01   +3.143462433579125e-01   +6.121979247057140e-02; +8.393837080883337e-01   +1.787619377640773e-01   +5.382430406910744e-01   +1.044041131152120e-01   +9.058386659689248e-01   +2.299391427827630e-01   +1.000000000000000e+00   +1.332397365923375e-01; +6.362152229085845e-01   +6.527630466703290e-01   +6.988861580503468e-01   +8.091720554766836e-01   +8.719805930204204e-01   +8.437715509907787e-01   +3.611832163371539e-01   +7.358462269682027e-01; +9.455563655214683e-01   +1.517488352310994e-01   +4.680561417542663e-01   +2.169510228687673e-01   +5.388910064051671e-01   +4.904338728002671e-01   +1.613289075640983e-01   +6.634664293573048e-01; +7.995733399086437e-01   +4.002713465978482e-01   +1.637097407038049e-01   +8.508452031396400e-01   +8.571852647654137e-01   +8.896710397933065e-01   +9.171911228371936e-01   +4.054038536587486e-01; +1.232810872141992e-01   +6.277692672844630e-01   +2.432633312941488e-02   +2.691905823675227e-01   +3.775347113675799e-01   +5.870146656948939e-01   +7.717698914120867e-01   +1.999461112290642e-01; +9.086097983800242e-01   +8.871414213572648e-01   +2.997314119110202e-01   +8.375902152798377e-01   +3.380682478602550e-01   +9.430668201603083e-02   +5.337125003124967e-01   +2.834241449562662e-01; +3.609822100974476e-01   +1.656169166036746e-01   +7.312076650939782e-01   +7.341999095151051e-01   +6.361985679416549e-02   +1.724296787120434e-01   +5.608672407708083e-01   +1.409288989914004e-01; +1.861556524293314e-01   +3.444076780126784e-01   +4.433510307510898e-01   +6.833458925042459e-01   +4.080612964964030e-01   +3.762063687884786e-01   +4.247841397512572e-01   +1.075894584289549e-01; +8.785198097538846e-01   +8.299579650006637e-01   +1.608163374706705e-01   +6.117689105812366e-01   +4.907083457090654e-01   +9.560070876388344e-02   +7.361806045838859e-02   +8.847147131639411e-01; +4.539173562607468e-01   +8.727196760530925e-01   -2.181553659344287e-02   +2.004280525884286e-01   +6.120667365730893e-01   +9.083054170752597e-01   +6.939344486695417e-01   +7.550006195620159e-01; +6.625637339316770e-01   +5.079733352959827e-01   +5.112285619699459e-01   +3.613594289979831e-01   +7.464518817092223e-01   +2.929697862220631e-01   +1.238719111691436e-01   +5.434360818208639e-01; +7.009952110384877e-02   +3.298149596294988e-01   +3.659031181930451e-01   +1.770254979156912e-01   +8.674113729789033e-01   +7.620223348050481e-01   +5.372593844683390e-01   +3.097306838131594e-01];
L1I_L2I_iGABA_netcon = [+1.039027559354345e-01   +7.813965482559684e-01   +3.536262641528441e-01   +2.818027851025948e-01   +9.084794029474510e-01   +8.591959885876884e-01   +8.347215269845183e-02   +3.299375099230245e-01   -1.954355760728584e-02   +9.206591245773462e-01   +6.781974527387554e-01   +2.268848639633284e-01   +2.947132278654510e-03   +5.514848975636006e-01   +1.357367667557718e-01   +7.854420526937753e-01; +9.510611648958992e-01   +5.485762897821370e-01   +6.597228140772295e-01   +3.728444485163421e-01   +8.674978747858450e-02   +4.146493407991972e-01   +6.258927956654945e-01   +1.332855026565448e-01   +3.838175942238831e-01   +3.511443684358693e-01   +3.021313487039378e-01   +1.336716416350510e-01   +9.134368634734605e-01   +8.296205906239027e-01   +9.460907176373872e-01   +2.234631333204076e-01; +4.617154276044377e-01   +4.563025013291666e-01   +9.709978888585793e-01   +8.312585465399570e-01   +3.083586276302069e-01   +1.008782675061314e-01   +6.580042842538909e-01   +4.789573723996649e-01   +8.763847457263584e-02   +7.596207284997414e-01   +1.987322721253491e-01   +4.317050077116898e-01   +9.984042343333172e-01   +5.731253297786049e-01   +1.117226118956356e-01   +2.393901071070532e-01; +9.144348057451600e-01   +4.400216608135350e-01   +6.178487267609014e-01   +4.141685063380007e-01   +8.372857508538445e-01   +5.975359628113226e-01   +4.396934227026149e-01   +1.949719192021132e-01   +4.702754058616295e-01   +4.112676643525048e-01   +4.771418070543788e-01   +5.019688004341457e-01   +4.361718082677113e-01   +2.365567316544309e-02   +1.481541396252121e-01   +5.299740908059679e-01; +7.231399812759777e-01   +4.444433329139048e-01   +1.159139943737188e-01   +9.647996007957168e-01   +6.151321173915616e-01   +4.633822754727750e-01   +8.060233351687650e-01   +3.660498260777675e-01   +7.609537975721899e-01   +4.686458730719649e-01   +6.746801239976278e-01   +8.897344307165965e-01   +9.921469782655008e-01   +1.203944054591062e-01   +5.382997101660371e-01   +7.125929273450159e-01; +3.734780736327278e-01   +3.291983042278143e-01   +8.852575062271789e-01   +1.214400219659132e-01   +8.767374937876123e-02   +8.083968267262481e-01   +6.186435896095058e-01   +8.845705523382751e-01   +4.758304683655061e-01   +4.624057142562946e-01   +1.000000000000000e+00   +7.740454149167163e-01   +5.121153828033428e-01   +5.474236155311243e-02   +3.706128721926497e-01   +9.677191440684647e-01; +4.607877975048407e-01   +2.013398451330872e-01   +1.774842724964290e-01   +9.364389295252420e-01   +5.300462035774459e-01   +7.067233549207804e-01   +3.252003454504169e-01   +5.637586963749759e-01   -1.089458228011182e-02   +2.476258612107445e-01   +4.045652940074790e-01   +9.018988176823098e-02   +6.883634798683825e-01   +3.319229735286454e-01   +7.119271146360380e-01   +1.421255570641013e-01; +6.488833228761880e-01   +6.648444943993821e-01   +9.164160971350291e-01   +4.457433275953876e-01   +7.837352860761236e-01   +5.848081048076830e-02   +4.734647759505224e-02   +8.176765838623402e-01   +6.466897762946032e-01   +2.592547088398643e-01   +4.670596561008640e-01   +6.276564805907933e-01   +4.251470151121024e-01   +8.966183675206757e-01   +1.256564100353322e-01   +4.059286591778922e-01];
L2E_L1E_iAMPA_netcon = [+7.822013752740631e-02   +5.799452328313801e-01   +7.880515399450494e-01   +7.668433182671273e-01   +5.924862540818163e-01   +6.725486884382248e-01   +9.243353690574297e-01   +8.137852680518266e-02; +2.211108413849720e-01   +2.162661769222123e-01   +1.574233711352636e-01   +3.380318058844301e-01   +5.173592808995379e-01   +6.210648036620201e-01   +7.888112047711234e-01   +1.661595203579697e-01; +3.066232130227371e-01   -2.225752188921271e-02   +9.499439995863338e-01   +6.506980919071406e-01   +2.843542732473784e-01   +6.137118375464737e-01   -9.716195869504493e-03   +4.665808913053822e-01; +1.584355863322628e-01   +1.848272285192886e-01   +9.164772707260193e-01   +1.637051790991869e-01   +4.710267465657857e-01   +9.180542356269721e-01   +4.590894092523752e-01   +6.010464479394823e-01; +9.165796372905508e-01   +3.932843685118413e-02   +6.623074140722934e-01   +9.451737419483381e-01   +1.879216460493926e-01   +7.349330968025484e-01   +6.356338444279434e-01   +8.040032565536426e-01; +9.430758088154664e-01   +4.559093020564504e-01   +6.885323128261831e-01   +6.336101743354421e-01   +2.409165796177585e-01   +8.263594200444997e-01   +5.849751813431282e-01   +9.772520742306348e-01; +9.510694835847483e-01   +8.882936609930604e-01   +9.382291646457106e-01   +1.987696319338490e-01   +1.667614834703572e-01   -3.783721900905268e-02   +8.667069972997932e-01   +7.866175252379577e-01; +7.263074799565383e-01   +9.312387702326895e-01   +7.986060940794947e-01   +5.533910899898629e-01   +6.239593085528737e-01   +8.442420388390069e-01   +8.360192624913378e-01   +7.522956031232774e-01; +7.245742717181544e-02   +3.807166102675746e-01   +7.804953431958868e-01   +5.681158808508859e-01   -2.503657832443738e-03   +7.380887410981419e-01   +8.084677251524615e-01   +9.221524415191827e-01; +4.131711382699407e-01   +4.152055662746179e-01   +5.000986899769193e-01   +2.283109464345569e-01   +8.234426633002013e-01   +3.563375855708216e-01   +5.701182427374396e-01   +8.586853924960848e-01; +8.145805911388178e-01   +9.544023725477937e-01   +3.077987604230669e-01   +1.769773236930204e-01   +2.643153101604757e-01   +8.120149188881732e-01   +1.363390272082046e-01   +2.088094655891722e-03; -1.759225904351346e-02   +6.677182661934301e-01   +6.769616381804302e-01   +2.176162292810671e-01   +4.360949886242727e-01   -1.973496713459762e-03   +7.187308662575297e-01   +7.569145701779711e-01; +2.959019191944743e-01   +9.455149152891540e-01   +9.790890965396799e-01   +1.520610658004648e-01   +4.788367834590825e-01   +2.323192734745950e-01   +7.435419739951742e-02   +9.167270225781144e-01; +2.758009551318573e-01   +1.529537420871048e-01   +5.879092310884767e-01   +9.877643694783373e-01   +8.708179216680653e-01   +8.751944924543873e-01   +2.483216706303116e-01   +1.223834201955399e-01; +6.483698341286730e-01   +7.335111299958402e-01   +3.150563563344698e-01   +8.714709375070768e-01   +6.357915023592995e-01   +5.391373366086769e-01   +6.883139923631145e-01   +8.437126931504143e-01; +5.180459562992389e-01   +8.314042325608211e-01   +7.276508300497603e-02   +6.774012525177409e-01   +3.009535633718768e-01   +4.905578141597058e-01   +5.016557873123424e-01   +3.310712302117105e-01];
L1E_L2E_iAMPA_netcon = [+9.084850393891116e-01   +5.923156406759363e-01   +4.139804676187252e-03   +5.803707880761141e-01   +8.523407635450638e-01   +2.703691066503666e-01   +4.600986879747210e-01   +9.047146408474330e-01   +2.032867279055524e-01   +2.692748131805820e-01   +4.452879330394288e-01   +8.439113736544006e-01   +1.148368087755247e-01   +1.389834869492310e-01   +8.767415087818845e-01   +2.646851586231736e-01; +7.310150963441331e-02   +3.051252367544123e-01   +6.473142588595580e-01   +1.452127423296998e-01   +2.922599522843710e-01   +1.188362219192831e-01   +4.195131645712195e-01   +4.017789833105798e-01   +5.672078979475138e-01   +1.000000000000000e+00   +5.045530307523937e-01   +3.196341851040080e-01   +8.766086629031448e-01   +8.323309310586187e-01   +6.941942465403685e-01   +7.575316754844027e-01; +2.467310109908064e-01   +9.120400371574302e-01   +7.687725669239555e-02   +2.337891615764751e-01   +6.042404955707994e-01   +2.393382758021514e-01   +9.866506518474016e-01   +9.435926039803608e-01   +6.148332318542511e-01   +6.259956495324592e-01   +7.473517168566167e-01   +2.568933723420377e-01   +8.041013446049288e-01   +4.990603194398240e-01   +1.220357431018763e-01   +4.958902072113277e-01; +8.962282515174994e-01   +3.235552475513716e-01   +5.586034582557902e-01   +1.786061163966401e-01   +4.498833232817583e-01   +3.496055911689017e-01   +6.776050805721304e-03   +1.460915334534272e-01   +7.821011008345166e-01   +1.141548186742615e-01   +3.595738576007881e-01   +1.998311504550400e-01   +6.015569902762192e-01   +9.767002818749743e-01   +6.292429779630606e-01   +7.675860259398060e-01; +4.180609510270699e-01   +4.593939299450217e-01   +4.838611666053246e-01   +4.194576459031192e-01   +5.498236276162332e-01   +5.905622246647029e-01   +2.847651176545777e-01   +6.022169158863593e-01   +2.506143859056517e-01   +6.274578014956844e-01   +5.331861794051613e-01   +1.704890333519105e-01   +6.315534505527713e-02   +8.850885526233543e-01   +1.399765025423344e-01   +7.183465145923950e-01; +9.889870878121413e-01   +3.088112045673416e-01   +8.420916872196735e-03   +8.962837670452797e-01   +8.996965053532364e-02   +3.167967697657638e-01   +7.545789624351844e-01   +2.284257125111827e-01   +4.269254137495619e-01   +3.426303092193711e-01   +3.614151214715337e-01   +9.737258536460931e-01   -1.849884521987207e-02   +3.049325139664218e-01   +3.523868632721152e-01   +7.805977613012934e-01; +4.748267996634405e-01   +3.306571665390365e-01   +2.235250122495946e-01   +1.423677564632202e-01   +9.534265341062570e-01   +5.956731518268228e-01   +6.569410816493494e-02   +5.274043059338006e-01   +3.867319154393737e-01   +7.228296587131321e-01   +5.846688305642777e-01   +1.862662564203617e-01   +6.270581694617300e-01   +4.901223035877545e-01   +6.486193089927277e-01   +1.180404130258015e-01; +3.869078075098461e-01   +5.503518183374390e-02   +8.169945796456155e-01   +6.800285282869892e-02   +6.498628572202128e-01   +5.942417486237141e-02   +3.070199507882385e-01   +9.219530873570397e-02   +2.428617085847822e-01   +8.623971072846969e-01   +6.949479091000383e-01   +3.723174019295875e-01   +9.003550278861674e-01   +6.717707505152539e-01   +3.242788357289071e-01   +2.511367424447587e-01];
L2I_L2E_iAMPA_netcon = [+3.904877841186315e-01   +9.966378244537171e-01   +2.545648895011622e-01   +6.971118785469294e-01   +8.734339747389426e-01   +7.624050492799591e-01   +5.870987171908432e-01   +4.672945236780841e-01; +9.581732472707848e-01   +4.750569014574980e-02   +7.617710934286714e-01   +3.075062289270765e-01   +7.117521459841795e-01   +3.443676883993503e-01   +3.818007048609520e-01   +9.507667812856326e-01; +1.000000000000000e+00   +2.516835651823828e-01   +8.048641475467903e-01   +6.255329255852349e-01   +2.763129437020015e-01   +7.057736589062120e-01   +1.323037769848963e-01   +5.210776180898075e-01; +3.728350956311083e-01   +8.828943445700019e-01   +5.432457124357739e-01   +3.753494090765979e-01   +5.508054037860399e-01   +1.690938893205341e-01   +7.374207373090430e-02   +6.755798962049125e-01; +4.350104813737840e-01   +5.290985714893077e-01   +5.374981115025582e-01   +9.831904996913535e-02   +7.755129296208287e-01   +4.089833574248102e-01   +2.110857818097757e-01   +7.665034386084890e-01; +4.239257254993485e-01   +2.619639245734560e-01   +5.758752715612865e-01   +7.911538858417722e-02   +7.190157386194979e-01   +8.659580388102912e-01   -9.268566000595667e-03   +6.463478502520112e-01; +4.178710920415502e-02   +2.635603592566633e-01   +4.754376412661455e-01   +6.173931211534744e-01   +3.223020775366683e-02   +6.739475804811546e-02   +1.823852521295736e-01   +6.201875617836689e-01; +3.884932508769107e-01   +4.763585800737193e-01   +7.989180461186900e-02   +7.729965569636982e-01   +3.113311848558852e-01   +8.766164270219968e-01   +5.375767990806364e-01   +7.328567689332789e-01];
L2E_L2I_iGABA_netcon = [+1.074639795974461e-01   +4.775468138790518e-01   +5.374745664549436e-02   +6.306888478811712e-01   +4.651173917154001e-01   +9.426049657851595e-01   +6.360956859781440e-01   +2.692007280957497e-01; +5.702158149039320e-01   +7.643905782362500e-01   +2.145704109014999e-01   +4.940333845137432e-01   +5.976085639363720e-01   +5.988002922226839e-01   +4.233243418232721e-02   +8.375729788826448e-01; +3.304917298928539e-01   +2.424619025575861e-01   +7.237533621079294e-01   +6.926566502442858e-01   +2.080118577869133e-01   +2.904075244837854e-01   +9.128807361285532e-02   +8.350668058834853e-01; +8.389795097849503e-02   +9.555881410166535e-01   -1.914789542580201e-02   +7.632410994944949e-01   +2.676287432927760e-01   +5.316916136507527e-01   +7.700005924379723e-01   +7.548953212846014e-01; +3.593547487295501e-01   +4.434382877409967e-01   +3.238463767401940e-01   +3.729967189401322e-01   -2.058670588563992e-02   +5.720612427421200e-01   +2.012046882188401e-01   +6.999598350964900e-02; +7.896777881730919e-01   +8.292148168924424e-01   +9.808867953521251e-01   +9.913120486563136e-01   +7.054727872397095e-01   +6.849301963395833e-01   +3.776517797012006e-01   +5.155720830710347e-01; +9.783759289004659e-02   +4.047675757625520e-01   +2.825013937515373e-01   +5.469275153649987e-02   +2.800246318406970e-01   -1.677318230176937e-03   +1.542121648409967e-01   +8.770469976431151e-01; +1.292546347930164e-01   +9.604446368565108e-01   +8.556438088943873e-01   +2.786196921651251e-02   +3.436790138904317e-01   +5.988736526664986e-01   +5.142881301302585e-01   +6.436957486367071e-01];
L3E_L2E_iAMPA_netcon = [+3.644480727022912e-01   +8.026635810239396e-01   +8.860771585261832e-01   +3.199082690375013e-01   +1.139718551597668e-01   +8.657140235893126e-01   +8.654797860419371e-01   +9.508913575176750e-01   +7.213505709402860e-01   +1.264881046791739e-01   +4.554451182819270e-01   +1.352183800494881e-01; +1.352077289677203e-01   +9.427193183054136e-01   +2.105072922647199e-01   +2.524785621641301e-01   +3.288481412239398e-01   +1.387068005559956e-02   +5.395063239297587e-01   +1.536548022795335e-01   +5.044024159329185e-01   +6.295874219008324e-01   +2.398253381524233e-01   +5.090972023956609e-02; +2.920463620361827e-01   +2.014679371506906e-01   +1.102461304224141e-01   +7.000375073897058e-01   +6.911825524625116e-01   +8.984711641622940e-01   +6.468321470728955e-01   +8.671524690153911e-01   +1.648901629670551e-01   +8.561568577271291e-01   +5.451467851846115e-01   +9.150219472906863e-01; +8.767985297885100e-01   +4.282553820925412e-01   +6.101538524600217e-01   +8.256789289717081e-01   +5.430834020932784e-01   +9.659790038883022e-01   +2.674098665641720e-01   +3.182425979033740e-01   +6.211052239433997e-01   +3.552271120767245e-02   +3.576049319327868e-01   +8.128538931481593e-01; +9.176107416558049e-01   +2.645012377693047e-01   +5.422424477834389e-01   +7.567449631062655e-01   +3.299389731596737e-01   +6.832220361220607e-01   +4.885495561469032e-01   +6.795647112790559e-01   +7.115845286425765e-01   +4.112727618828904e-01   +5.520908667887368e-01   +3.334785925688620e-01; +3.036851030750752e-01   +4.875601826730084e-01   +4.767127295751408e-01   +6.815534862938634e-02   +2.615516012252042e-01   +4.034371858601653e-01   +3.072417862519436e-01   +6.362021843745532e-01   +3.869186641142867e-01   +5.953410484792196e-01   +6.735178458775423e-01   +7.996264022391574e-03; +2.211921003923902e-02   +8.099744767767775e-02   +1.278971235428049e-01   +3.276941802460452e-01   +7.831704385536128e-01   +1.000000000000000e+00   +7.020522116654390e-01   +2.421806533259116e-01   +6.689223239803822e-01   +4.017918229897763e-01   +2.839998272661015e-01   +3.211643444804794e-01; +4.006374061657111e-01   +2.626347105911637e-03   +6.866242877881816e-01   +9.290742899684769e-01   +7.045806565311149e-01   +8.331383418878535e-01   +8.568489327788944e-01   +1.191576621636308e-01   +7.997352963631279e-01   +1.555510262332284e-01   +1.429125264660667e-01   +4.233340067405887e-01];
L3I_L2I_iGABA_netcon = [+7.170985900718247e-01   -1.672903968506709e-02   +4.779433422415320e-01   +5.879612927683062e-01   +2.881646925243284e-01   +9.786821141310151e-02   +2.994156224444658e-01   +3.291748842976523e-01   +4.632240850975057e-01   +4.867968579801268e-02   +3.814599505708036e-01   +8.834643878771488e-01; +8.416934320108217e-01   +2.622042763388820e-02   -3.612718860486690e-03   +7.071306016566059e-01   +8.437071560787123e-01   +5.646145938770639e-01   +5.264480624060589e-01   +2.853932770861516e-01   +3.406420256331705e-01   +6.981101529621700e-01   +8.748139171809716e-02   +3.572264923841459e-01; +8.329963142758301e-01   +2.763141215563352e-01   +7.741586270030751e-01   +8.080849779620944e-02   +6.598050229737917e-01   +1.051154889488040e-01   +6.418144768415855e-01   +1.831781499624996e-01   +3.712270468020292e-01   +6.925495845204547e-01   +2.788731938648796e-01   +7.753857979147768e-01; +6.665859747321163e-01   +2.141210429906980e-01   +9.327313746746964e-01   +9.101674779905342e-01   +8.106114089399673e-01   +5.847898934848393e-02   +7.194528468196556e-01   +1.851181123178657e-02   +8.888998030754115e-01   +1.094614287075413e-01   +1.327660933017294e-01   +7.258990082015080e-01; +1.340772074641951e-01   +1.285419070223546e-01   +4.066569131711342e-01   +3.093149552482727e-01   +6.564424344057848e-01   +8.890034493868660e-01   +3.295515152429687e-01   +2.617836919957260e-02   -1.231529691466265e-03   +2.810486813224298e-01   +8.671369951181036e-01   +8.772487130112493e-02; +8.926795620465885e-01   +3.348501470835276e-01   +5.305562285444216e-01   +8.629323358317037e-01   +7.430829545983326e-01   +3.024805002308021e-01   +3.443466985510089e-01   +1.780016578995550e-01   +4.004191492664147e-01   +2.003968762918450e-01   +1.997626510232220e-01   +3.187013528428318e-01; +6.584489533316880e-01   +8.437303151819147e-01   +7.973792737438652e-01   +5.912803317158223e-01   +2.154861091199614e-01   +5.101544531595619e-01   +4.575140057316968e-01   +7.886629063318424e-01   +1.042919860912598e-01   +8.302737334243505e-01   +4.532630178231762e-01   +8.723892127849999e-01; +9.416864450325692e-02   +2.213373301500559e-01   +5.452806408119463e-01   +6.357905077460111e-01   +2.760629141944587e-01   +1.698096810909730e-01   +1.501453603108028e-01   +1.153743205268169e-01   +7.011791054973884e-01   +6.270614668035898e-01   +2.890516338466577e-01   +2.687558606095150e-01];
L2E_L3E_iAMPA_netcon = [+5.092548306724672e-01   +8.727607691198237e-01   +4.419534331164813e-01   +8.140010573777604e-01   +3.653288804574153e-01   +1.298762229331166e-01   +5.305728319603536e-02   +5.279382769503725e-01; +6.373197273621599e-01   +3.906456930962659e-01   +8.346210496701797e-01   +1.191358394895431e-01   +1.571424390343491e-02   +2.214794955542540e-01   +9.085307199155487e-01   +8.787141516811284e-01; +2.362686028515288e-02   +1.781585664979176e-01   +1.000000000000000e+00   +9.365305687411316e-01   +6.941445710771852e-01   +2.419741844963254e-01   +2.994042500052846e-01   +8.651658599064860e-01; +3.577728016246299e-01   +5.512321039648612e-01   +1.075391912762706e-01   +5.720266114508756e-01   +3.246098341591783e-01   +8.972110653170026e-01   +8.172893290306180e-01   +2.019110215483783e-01; +3.773392240643531e-01   +7.589375395150626e-01   +7.999600943424574e-01   +9.248724135143807e-01   +7.700025264078322e-01   +9.311733797137774e-02   +7.096001942881570e-02   +9.226671742090905e-01; +9.123695668899425e-01   +8.344627096988857e-01   +2.586880067095528e-01   +1.423378836673166e-01   +4.403422837560131e-01   +8.964345512476409e-01   +7.365622348844185e-01   +7.676071412496951e-01; +7.579820588671513e-02   +4.220517883993930e-01   +4.434006520686583e-01   +1.060700922660037e-02   +2.614384090082863e-01   +2.434829359422833e-01   +4.069422453150803e-01   +3.420145629726241e-01; +8.990636260266482e-01   +9.578465776638471e-02   +8.314976717518715e-01   +3.128278751361948e-01   +2.018929218728234e-01   +5.439258599492192e-01   +7.758709985567940e-02   +1.823962316100158e-01; +4.154484869868813e-01   +6.717233851738097e-01   +7.418786337130073e-01   +3.410204974773585e-02   +2.485617451914618e-01   +1.080658623357021e-01   +6.757804161204983e-01   +6.556360582458156e-01; +6.276908253663444e-01   +9.205405934755579e-01   +2.716260320877550e-01   +4.671797109235339e-01   +9.292582194433118e-01   +4.934595044563851e-01   +9.083975608469216e-01   +5.541000974983786e-01; +7.314982461426602e-01   +2.292057781576662e-01   +6.935341578952952e-01   +3.525427030820966e-01   +1.526102788727719e-02   +1.118548569651293e-01   +9.762025602008164e-01   +7.167709967582289e-01; +7.764504337989407e-01   +3.036895681692262e-01   +5.373458248207947e-01   +8.646369613612038e-01   +6.922101116845306e-01   +9.718883094911484e-01   +4.002568776150567e-01   +4.825060656842975e-01];
L2I_L3I_iGABA_netcon = [+4.288750565647017e-01   +3.784848338351283e-01   +1.000000000000000e+00   +1.504735278336914e-01   +1.519110761778164e-01   +4.662148379177975e-01   +2.162486755986552e-02   +5.014506350731389e-01; +4.942546542145092e-01   +3.880928772522438e-02   +7.977142608613353e-01   +7.359893737328235e-01   +3.136368392095394e-01   +5.660077417728141e-01   +9.102766160673217e-01   +2.603221502586494e-01; +5.719026223862391e-01   +7.996175775175129e-01   +4.234178670983156e-02   +2.785456400732779e-01   +2.460039234552628e-01   +8.640767315552456e-01   +6.915023835754374e-01   +3.976067529147309e-01; +5.949802366353796e-01   +5.085725051268999e-01   +1.468190851639984e-01   +2.417400889496543e-01   +8.201254271275842e-01   +5.677144855566489e-01   +4.297277091818069e-01   +1.301529994492293e-01; +9.294289987310397e-01   +3.976352847276093e-01   +8.643976337426768e-01   +5.982025914730592e-01   +1.667460743855055e-01   +6.265519942219023e-01   +1.462361431730690e-01   +3.268643518213247e-01; +7.083183396000718e-02   +1.114368543545092e-01   +5.721249892314695e-01   +8.236715292384421e-01   +9.547648272248319e-01   +9.374031170592331e-01   +8.278353678438100e-01   +2.017293532789707e-01; +3.276235119733467e-01   +3.253074891568946e-01   +3.466210375357600e-01   +4.975926007423588e-01   +3.773865807862258e-01   +8.699980943558580e-01   +9.018974946808495e-01   +9.733962678248463e-01; +5.257456694265243e-01   +8.557857555976568e-01   +3.266510877000873e-01   +2.839150032014847e-01   +1.591138474965355e-01   +4.181285153088917e-01   +3.220816962878649e-01   +4.355145154682951e-01; +9.534634999083823e-02   +2.321160743628473e-01   +7.016354486163039e-02   +4.124311096372274e-02   +7.044723878320038e-01   +2.327821744811642e-01   +2.041745031659418e-01   +1.188309879077650e-01; +1.484901448157661e-01   +6.801284529253852e-02   +6.570264768747617e-01   +6.828386711986199e-01   +7.980270469217178e-01   +8.614269708629756e-01   +9.223686239723821e-01   +2.485379054101795e-01; +5.315793159156919e-01   +2.724134753526859e-01   +8.322658927398312e-01   +8.484545925580038e-02   +7.219867125930718e-01   +3.500115402860484e-01   +8.062385644125577e-01   +4.748025581434220e-01; +8.657766472111219e-01   +2.458300072361587e-01   +4.008717849092964e-01   +2.218780518107164e-01   +8.342376455358160e-01   +7.733097703923426e-01   +4.235034884667340e-01   +2.387958683167827e-01];
L3I_L3E_iAMPA_netcon = [+6.797922113738085e-01   +1.860907121938077e-01   +3.238331378221024e-01   +8.883949729787964e-01   +9.057915431803433e-01   +2.934633221400896e-01   +2.740600177685348e-01   +3.301993348198695e-01   +3.948066255125589e-02   +5.754183776540171e-02   +4.404078346704610e-01   -3.009978212717255e-02; +4.209330723355242e-01   +8.319974380295915e-01   +6.694256643004678e-01   +3.480443174966474e-01   +1.837536792717171e-01   +6.598078031531247e-02   +4.858632364549813e-01   +3.083502755892427e-01   +7.307542060544164e-02   +7.072589713306912e-01   +4.739033420643421e-01   +8.346616813515312e-01; +5.282554435302843e-02   +9.754630517350246e-01   +4.265793986937673e-01   +4.775514981649303e-01   +7.193635212856440e-01   +4.501379302420829e-01   +3.153265830841502e-01   +2.077118195335077e-01   +2.911209316288283e-01   +2.005981685369787e-01   +8.778378275890667e-01   +2.699315044728538e-01; +6.326154012247602e-01   +8.375652562548710e-02   +8.908414858007575e-01   +2.191978646435406e-01   +7.982997416449857e-01   +3.005300080214743e-01   +1.788959949679236e-01   +3.386252664090471e-01   +3.065840866025495e-01   +3.899197903183177e-01   +6.280950922730756e-01   +1.274212837038293e-01; +5.305517121613283e-02   +9.058573315894795e-01   +7.361664849872036e-02   +4.042170104715113e-01   +7.716429424208434e-01   +3.397027624195157e-01   +9.408468211476376e-02   +5.156313252389755e-02   +8.132904955043129e-01   +7.655370662216945e-02   +6.071683016601569e-01   +2.290579107770556e-01; +2.021528852359068e-01   +3.500375486992763e-01   +7.977762295034859e-01   +4.606044778976941e-01   +1.720554708339678e-01   +4.079539272715352e-01   +1.081874631583447e-01   +5.059211866434996e-01   +5.690548174256478e-01   +2.615812101552329e-02   +3.207102444343355e-01   +9.804889671370240e-01; +7.813119416578125e-02   +7.309174229253235e-01   +2.335100497812983e-01   +8.395523162962665e-01   +4.844788980104735e-01   +6.161868891216536e-01   +6.176111226576622e-01   +1.614670184243148e-01   +5.605246317261735e-01   +9.629533810000226e-01   +3.810313114873649e-01   +7.510789575477789e-01; +1.421835249254203e-01   +4.918096371784630e-01   +7.165430685438692e-01   +2.816386937982865e-01   +9.514333989457425e-01   +4.215676988523020e-02   +8.697337003496939e-01   +3.297830585305184e-01   +9.888272347369648e-01   +9.286670913264770e-01   +7.863537096085575e-01   +4.098049220907516e-01; +7.865442358925867e-01   +7.240781212873515e-02   -3.000332341894818e-03   +6.686962161937718e-01   +1.000000000000000e+00   +8.347936421939327e-02   +5.307499337933483e-02   +5.486742934969782e-01   +6.258937878224496e-01   +9.154273287754823e-01   +5.758284224016690e-01   +2.925291497409672e-01; +8.161394574730603e-01   +4.784137174273370e-01   +4.680862407897420e-01   +3.315189804309165e-01   +1.721314999749105e-01   +9.414419163850758e-02   +9.101863616307398e-01   +5.797465258650610e-01   +3.775158344463752e-01   +1.851395434905962e-01   +4.170752731966602e-02   +6.981876340783548e-01; +5.143885285224400e-02   +4.808553238074631e-01   +1.494045710143418e-01   +3.978027597926329e-01   +5.926431432364199e-01   +3.958519560177836e-01   +7.473037201700888e-01   +9.213411487051483e-01   +2.576940927045641e-01   +7.270385319901894e-01   -6.958853868740851e-04   +9.056797474556960e-01; +7.141816049336491e-01   +7.051836040211139e-02   +4.489191011715833e-01   +9.536437841946143e-01   +6.584934330631331e-01   +3.069792074326327e-01   +3.198376885659675e-01   +7.610954358857245e-01   +8.231943004551665e-01   +7.016641837159603e-01   +2.094143108600110e-01   +6.387723994284172e-01];
L3E_L3I_iGABA_netcon = [+1.797961065669515e-01   +8.184537599760298e-01   +3.728994732376243e-01   +6.444817766995458e-01   +7.080114318300822e-01   +7.353597622252747e-01   +7.592355356709429e-01   +7.374907466646987e-01   +9.187029277734751e-01   +1.112155344347526e-01   +5.523857090852609e-01   +4.526909190179015e-01; +5.696385959893461e-01   +7.685146796314196e-01   +5.723533291960193e-01   +8.066670605842591e-01   +2.528807329327531e-01   +3.637704603778619e-01   +7.796874635245350e-01   +7.084639686195582e-01   +8.147619637453594e-01   +6.229050209855322e-01   +5.027631678348533e-01   +3.387968896311919e-01; +5.047102299927559e-01   +9.147457739304388e-01   +1.577873543595035e-01   +9.621844398133881e-01   +1.949540487287005e-01   +6.423245559083728e-01   +5.400484665225903e-02   +4.777151226328378e-01   +1.882248607171034e-01   +5.443817061269302e-01   +9.313741644719388e-02   +1.241193144934573e-01; +4.586437116460185e-01   +2.135632801833479e-02   +6.746811029898300e-01   +1.199878345658956e-01   +3.429461609322287e-02   +6.176957260301016e-02   +8.751221932213709e-01   +5.255969588410324e-01   +4.058909447489408e-01   +5.203021721940599e-01   +2.415344425079509e-01   +3.278649014788054e-01; +8.888854759069156e-01   +6.819231618544944e-01   +8.814729168072285e-01   +3.553824879487717e-01   +6.908079746669855e-01   +8.184535412754976e-01   +5.103953952256854e-01   +7.971620247330912e-01   +3.013937630444135e-01   +8.377915112214693e-01   +5.842806043321176e-01   +2.458389279792944e-01; +8.851383754881226e-01   +9.572242988759695e-01   +5.070211369805894e-01   +6.053256697876799e-01   +2.284030304013439e-01   +7.777982225451164e-01   +2.454077057387998e-01   +7.538946572731726e-01   +3.859622437931945e-01   +6.828874357810832e-01   +1.164641034689292e-01   +1.572542916681469e-01; +6.650814198628706e-01   +5.002071596590336e-01   +1.672698665408868e-01   +9.549596618100871e-01   +3.343149207275499e-01   +5.050691634773551e-01   +5.646739581516910e-01   +3.428821627859187e-01   +5.396642669363426e-01   +2.847505691538029e-01   +9.506478967697525e-01   +9.349141766366665e-01; +7.171904855457266e-01   +4.623425378562221e-01   +3.489629912797446e-01   +7.099205504839108e-01   +7.275439621776870e-01   +4.370167937440098e-01   +3.067721368129715e-01   +5.740298231328269e-01   +3.629082916147858e-01   +5.228223543604835e-01   +3.323597040549986e-01   +5.133182503597383e-01; +1.835276528835619e-01   +6.066807832654708e-01   +7.601904597693926e-01   +7.816651939903810e-01   +2.101554414543078e-01   +7.866130911644565e-01   +1.697188689963527e-02   +6.144806822204724e-01   +1.193923404470528e-01   +2.627522171680961e-02   +1.000000000000000e+00   +2.456812333035633e-01; +3.170840833970506e-01   +4.702152996392890e-01   +2.864916139051583e-01   +2.890290662694025e-01   +2.502296419461145e-01   +7.043124169320520e-01   +3.057868591907608e-02   +8.253756627909714e-01   +2.254246846781059e-01   +3.207541473888070e-01   -3.218445875735972e-02   +3.570775350595666e-01; +7.676053194046012e-01   +2.433279047979207e-01   +8.544775578857563e-01   +2.906197282239609e-01   +1.178336797564343e-01   +2.189773525142415e-01   +5.352371007619272e-01   +3.255964916387803e-01   +2.920774314492998e-01   +1.822683467880743e-01   +8.578767085608079e-01   +8.369767956365877e-01; -4.107503680434809e-03   +2.460022187054784e-01   +8.642308336697504e-01   +1.768507109282798e-01   +2.756124230915297e-01   +3.200886718859655e-01   +8.686272827068825e-01   +7.999940190046003e-01   +9.059890459908114e-02   +3.150322507316183e-01   +1.787204430023983e-01   +6.707395144188433e-01];
L2E_Input1_iAMPA_netcon = [+9.525787585353379e-01   +9.162953393929676e-01   +1.000000000000000e+00   +9.747258751835955e-01   +9.056333480498391e-01   +9.156118753794312e-01   +9.462131744400114e-01   +9.692493830891702e-01];
L2I_Input2_iAMPA_netcon = [+9.424285765434657e-01   +9.523195902922621e-01   +9.408858102506191e-01   +9.974927706633648e-01   +9.370068697552792e-01   +9.258401577414557e-01   +9.601737013621248e-01   +1.000000000000000e+00];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
