function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.710568808710422e-01   +3.125786566294551e-01   +6.823829560284487e-01   +9.138069871368737e-02   +1.355205237405832e-01   +1.372926041871179e-01   +6.278283776392372e-01   -9.940920290005011e-02   -4.533349820763033e-01   -5.769538954675230e-01   +3.360454803073553e-01   +4.528785030121868e-02   +2.879632986529047e-03   -6.267848593042213e-01   +6.158844183557783e-01   -7.797831031303922e-01; +5.798373454414643e-01   -9.800822721724295e-02   +2.589778440985679e-02   -1.936202331256134e-01   +8.459845402704456e-02   -2.892555114064814e-01   -1.917077250090070e-01   -2.043617322279448e-01   -5.053041992451758e-01   +9.091272959108193e-02   -4.045610514290120e-02   -1.374667302469008e-01   -5.179885768155181e-01   +4.659499851807180e-01   -3.250280922460194e-01   +1.644975788662566e-01; +1.238620409984048e-01   -1.060342205127885e-01   -1.609967669991864e-01   +2.950425647905997e-02   +2.403387259190611e-02   -1.889512548704815e-01   +7.937699977334438e-02   -8.043449126621141e-02   -4.416652926317521e-02   -4.576781293746526e-01   +4.321657634719762e-02   -3.186141548162392e-01   -2.110235006882239e-01   +4.113770902933371e-01   +2.561369325179079e-01   -6.530248670909656e-01; -5.617827620720317e-01   -9.220039223427054e-02   +8.722483947507175e-01   -1.696165326292055e-01   -5.984366971801976e-02   +3.694194401238931e-01   +3.012046746616645e-01   +8.531937501372074e-02   +3.254527081951999e-01   -4.372250792515070e-01   -5.124766554235918e-01   -5.798297682423978e-01   -1.533096639549152e-01   -5.563531379771540e-01   +4.910571466571303e-01   +7.585179609206242e-01; -1.260323479988487e-01   +5.382937811888789e-01   +3.241990395640478e-01   +2.602019125929095e-01   +2.395818273585875e-01   -3.493383852384958e-01   +1.307692910557142e-01   -3.722073778026910e-01   -3.614352753194414e-01   -1.060616936980850e-01   +5.098228421386109e-02   +1.742215865643054e-01   +1.499206472233412e-01   -1.186735654644214e-01   +5.141942877132152e-01   -3.516664589512410e-01; -2.276134232623399e-01   +1.262981812491792e-01   -2.389179871515149e-01   -2.231588256125893e-01   -4.319813214459271e-01   +1.288693539194058e-01   +6.216396329290030e-01   -7.704739762321203e-01   +1.859658704313132e-02   +1.224235837850437e-01   +5.981500674029494e-01   -1.784987590104128e-01   -5.604239122784176e-01   -2.050419215382641e-01   +1.000000000000000e+00   -3.647070249193192e-01; +5.777694000791195e-02   +7.657484134037943e-01   -7.719546467578808e-01   +3.372989819421482e-01   +8.942490547445400e-02   -2.464732703300859e-01   -1.323493330893860e-01   +9.246226886951639e-02   +6.763629432243329e-01   -1.919374636968890e-01   -2.234200592997022e-01   +1.558328512084838e-01   -2.820225792012233e-01   -2.580525371231224e-01   -5.535235220077320e-01   +3.232703036274012e-01; +5.485693346296252e-01   +5.594948432724712e-01   +1.287319484030846e-01   -3.000110123836031e-01   -2.182041826988756e-01   -1.037969163807716e-01   +7.838331081099452e-01   -5.723679410221386e-02   -1.638725477570088e-01   +1.804868684097908e-01   +5.994500515633289e-01   +3.062641847139909e-01   -5.478794322701681e-01   +3.230295697279347e-01   -3.154720337488122e-01   +2.545782222576974e-01; +5.478461239781386e-01   -6.838854962729993e-01   -3.032978784435040e-01   +5.671873674065168e-01   -1.475287587511781e-01   +1.188646588140539e-01   +3.892786546220067e-01   +3.897177738821375e-01   +2.180085929336980e-01   +6.248889743558451e-01   +5.182539787710008e-02   -5.285536624785949e-01   +9.589645223250945e-01   +2.937180821975873e-01   -5.981500203299426e-01   +1.724271629376097e-03; -4.413992423310533e-01   +6.679747030738845e-01   +1.407626400083489e-01   +6.341169477189419e-01   -7.421626651270455e-01   +4.494853688529244e-01   -1.641938098151114e-01   +1.641475148490190e-01   +6.276965254316857e-01   -4.402635827974292e-01   -2.239460733906375e-01   -3.375668733408843e-01   +3.205099580286549e-01   +5.149090328112225e-01   -2.275146563314153e-01   -8.694498138263468e-02; +3.827879985939159e-02   -4.800587321139009e-01   -1.517641668730140e-01   +2.738763295931589e-02   -9.457196810335251e-02   +3.415075151074158e-01   +3.771915675864962e-01   -3.825960993128169e-01   -3.097275540945467e-01   +9.879620786093292e-01   +9.082361013861566e-01   +5.895444539591165e-01   +2.045505381041744e-01   -7.149541499036967e-01   -2.629902081570636e-01   +2.064017644664698e-01; +8.449924167137274e-02   +2.151298624560316e-01   +1.020217016267786e-01   +9.311440438165872e-01   -1.401603808509077e-01   -2.392589616954887e-01   +3.598529773756086e-01   -3.578890453762781e-01   +5.369059087713896e-01   -2.680455646230217e-01   -3.690636137434962e-01   -6.055241096947965e-01   +2.041371100503441e-01   +1.227961345982000e-01   -3.706477569239351e-01   +4.386301903144907e-01; -4.132990481331725e-01   -4.040426695018773e-01   +2.939011386457626e-01   -1.007031312366647e-01   +4.625011179966004e-01   -1.993109606903034e-01   -9.868241504181829e-02   +8.415067186006829e-01   +3.731097690814785e-01   +5.037805757999568e-01   +1.252145388569807e-01   -6.679052231267152e-01   +3.208023102708221e-01   +3.924150918025417e-01   -4.803346115371147e-01   -1.552527245761222e-01; +2.009690358768439e-01   -6.011821041427851e-01   +3.532226321843090e-01   +6.309113237765882e-01   +3.339547480584862e-01   -4.502117085960351e-01   +2.346459293102910e-01   +2.024974622308936e-01   +3.449073402237844e-01   -4.183414633708766e-01   +2.724002963296730e-01   +7.249999097436702e-02   -8.238300402706492e-02   -7.052594063051285e-01   -1.005462988593541e-01   -1.545776454484924e-01; -3.956447367718609e-01   -3.920057812897088e-01   +5.889312726090733e-01   +2.830533721909409e-01   +5.963432771103684e-01   -3.361060181962566e-01   -7.039917562632528e-01   +4.636506424154141e-02   +1.567112827461160e-01   -4.641850526732342e-01   +9.193687082675667e-01   -1.187449157604305e-01   -5.128906616976759e-01   -1.245849877497732e-01   +2.335605325469647e-01   -5.504835715489497e-01; +3.246698423497320e-02   +2.493093878536874e-01   -8.038793930786269e-02   -1.052500676578514e-01   -2.493683066157879e-01   -2.861267407167541e-01   +3.731419603737317e-01   -2.673764952419604e-01   +2.830009846381429e-01   -2.026892578968907e-01   +3.574730365641046e-01   -3.022564434298935e-01   +4.280810182980799e-01   +1.145214898129603e-02   +4.838286594133870e-01   -2.673964608631631e-01];
L1E_L1I_iGABA_netcon = [-1.194784758823482e-01   +6.354481961859383e-01   -3.084227718748559e-01   -2.531546720455545e-01   -3.925976399624134e-01   -5.828120643766759e-01   +5.223182677862154e-01   -1.955721095262886e-01   +4.130628160097286e-01   +4.835332083007823e-01   +6.151918777099429e-02   -3.981317213090174e-01   -1.714144978185335e-01   +5.145301741338972e-01   -3.882930334487090e-01   +4.214820764458571e-01; +1.769895925133527e-01   -4.004306609532597e-01   +8.056027324406227e-02   +4.262402511354728e-01   +5.915289386221122e-02   -4.969263560094703e-02   +1.492364890099534e-01   -6.231757585751587e-02   +5.046348467375322e-02   +7.179783280885825e-01   +2.117121315313662e-01   -2.309540024073615e-01   -7.660393805793662e-02   +6.103446562543160e-01   -3.820307033048070e-02   +5.457599027607818e-01; +3.225372653360802e-02   -4.657165484998280e-01   -1.444235139742789e-01   +3.248154081241568e-01   +2.376723005405131e-01   -2.424370881153597e-02   -6.464628085172824e-01   +1.295743870770591e-01   +3.668613033441098e-01   +9.286836465423212e-01   +4.287717393366343e-01   -1.830284115381015e-01   -1.554124111558183e-01   +1.580384799672623e-01   -5.627613272361164e-01   +5.605421361665668e-01; -7.809346839426685e-02   -3.393262458656926e-01   +1.230411125564784e-01   +2.833842935203593e-01   +2.880390398866520e-01   +2.823380014074763e-01   +2.148129353624328e-01   +7.371797003421759e-01   -4.327077741408280e-01   +3.321177388717164e-01   +1.241336917058572e-01   -5.355200828991958e-01   -6.944403826328613e-03   -1.017593176268878e-01   -1.518891329164994e-01   +2.358726279188945e-01; -1.804990281889447e-01   -9.261620041393459e-01   +1.066693025606525e-01   -4.397063909502377e-01   -3.784504015632135e-01   +2.769609668924938e-01   +2.718686056655398e-01   -5.617719592556972e-02   +3.103736571729934e-01   +3.531682166880801e-01   +4.899493072521698e-02   -2.350248591287769e-01   +2.166901300080671e-01   +3.554783713104335e-01   -3.873216033901199e-01   -3.358789546165044e-01; +5.073455409518830e-01   -1.226419663638985e-01   +1.227653748157026e-02   -4.444562341543667e-01   +6.146191459359578e-01   -7.111363625395751e-01   -2.536106736237962e-01   +2.232331006448516e-01   +7.342855886120787e-02   +1.032502136492106e-01   +1.860500624423498e-01   +7.334478770350037e-01   +4.042520809834341e-01   +4.045177095848446e-02   +5.992408811008935e-01   +2.833131322807510e-01; -3.369209737856697e-01   -4.700474382033644e-01   +5.801938607967703e-02   -1.039907702599693e-01   -3.246926919817113e-01   -7.426273387769813e-01   -1.254117675361397e-01   -1.423666729730541e-02   +4.741204894499780e-02   +4.477145384760571e-01   +6.471225351617985e-02   +4.210891102268418e-01   +4.558041620345978e-01   -1.261037651419563e-01   -5.430587750866335e-01   +2.792946983811765e-01; -2.822179485179003e-01   +3.800341127524033e-01   +3.255409097078782e-01   -3.187316079640299e-01   +3.420123862727099e-02   +3.392347906530058e-01   -2.891178785837752e-01   -9.585656014083656e-02   -3.114019105744823e-01   -2.857573736042945e-01   +1.249058359239021e-01   -1.888895478842762e-01   +5.471305110895666e-01   +2.631176368797080e-01   -2.821397119136788e-01   -1.183224096076597e-01; -4.341428721679823e-01   +2.378578020448792e-01   +1.042729898794433e-01   +1.983971434332277e-01   -8.231671287257071e-02   -5.846944908520857e-01   -2.953635631004585e-01   +1.461750483607845e-01   -5.793406201244421e-02   -2.192893594548232e-01   +5.917852240567352e-01   -6.693577508171431e-01   -3.660448986372300e-01   +1.605195671352094e-01   -3.999825829129703e-01   +1.176156828169933e-01; +6.920402369912284e-01   +6.349610639846235e-01   +2.401501276063055e-01   +1.100087244267502e-01   -6.938855843418842e-01   +1.401343217171807e-01   +4.234671154841275e-01   -5.210234110152759e-01   -4.156315040315162e-01   +1.907062645009140e-01   -4.488710487700734e-01   +9.004943064499145e-01   +6.762318933125849e-02   -2.564738828223387e-01   -2.673403767092169e-01   -2.257446616646544e-01; -9.201116536772176e-01   -7.097319616025227e-01   -2.353944270545918e-01   -3.226753370162375e-01   -1.315997489286827e-02   -1.748082217415835e-01   +1.537484685672034e-01   +4.407683516728713e-01   +1.961581989501471e-01   +6.994003334562844e-01   +3.164572922472699e-01   +4.387474010903807e-01   +2.310848853234348e-01   +1.442089664958441e-01   -1.062871526103979e-01   +1.974848222563799e-01; -2.628199031171022e-01   -5.638080907412749e-01   -6.499277938000392e-01   -4.722656494157224e-01   -1.395327023939229e-01   -3.883041771068576e-01   +1.111067438106086e-02   +6.464901424779870e-01   -3.360702409268377e-01   +2.062573984758415e-01   -1.912284137050557e-01   +7.592716945101950e-01   +1.354546463348367e-01   -5.110329941425061e-01   +1.205117017744164e-01   -9.171367421207850e-01; -1.000000000000000e+00   +4.786138937225677e-01   +3.848232039283628e-01   +2.341058787225872e-01   +4.385555033763990e-01   +3.677969008013432e-01   -4.166508624567800e-01   -7.892091036474718e-03   +4.928620313351990e-01   +1.727531283421556e-01   -1.548479206495156e-01   -7.536757040418820e-01   +3.688092175798396e-01   +6.407280668431796e-01   -2.465614514620113e-02   -2.895288492348767e-01; +4.675225423169961e-02   -3.518612984230116e-01   +3.828588056890013e-02   +5.191720565459342e-01   +6.262678840019535e-01   -1.672173476109221e-01   +3.786190647203721e-01   -7.224462049439868e-01   +2.432214324518606e-01   -7.099464575117337e-01   -2.107796419488396e-01   -4.829619566379338e-01   +1.620766153527469e-01   +1.441769014395426e-01   +4.438513561970366e-01   -2.441421835410814e-01; -1.977781936932841e-01   -3.418125775073353e-01   +1.597747466958786e-01   -3.481198490797398e-01   +2.033638761792489e-01   +3.724111360512665e-01   -1.834103952292646e-01   -9.675314310975452e-02   +5.903484368382370e-01   +3.664596734736346e-01   +2.457290099344058e-01   -2.849145856729113e-01   -1.911522972484824e-01   -1.054176309004564e-01   -1.792058856109751e-01   +5.451865078234402e-01; +1.283884796640979e-01   +5.249952658771910e-01   -1.077089281084390e-01   +7.759366422965709e-01   +5.101717412753854e-01   -7.881842508798653e-01   -1.100858784685312e-01   -5.293478097233971e-01   -3.516765794708494e-01   +4.109194287383862e-01   +7.473891740277247e-02   +5.289056311388658e-01   -1.587157705234198e-01   +2.100215850660304e-01   -2.931616934970861e-02   +5.616473275314852e-01];
L2I_L1I_iGABA_netcon = [+1.224014780703384e-01   -1.939803593756005e-01   +2.098748642977106e-01   -1.929133503474177e-01   +1.527806384271709e-01   -3.717760593002405e-01   -9.235615596402061e-02   +3.260859713014931e-01; +2.217337923302814e-01   -8.083152989370184e-01   +7.488656739583861e-03   -2.360648955019018e-01   -5.669852001618185e-01   -6.046021331479056e-03   +3.213262890587186e-01   -5.524172858726102e-01; -2.411531330431053e-01   -3.850114261473936e-01   +3.641398454088815e-01   +3.465716195053770e-02   -5.037803250743793e-01   -2.952775015783417e-01   -1.994429895537659e-01   -3.839571358487863e-01; -1.589230924829900e-02   +3.458593082777994e-01   -5.314531472378953e-01   +5.491193561250952e-02   +1.061943210033174e-01   +6.330148363731856e-01   +5.310997962822522e-01   -1.547486862350988e-01; -3.440844560846352e-01   +4.228272569032500e-01   -2.783900107722045e-01   -1.299408252881164e-01   -3.693459000666251e-01   -3.306971662807047e-01   -2.381832373664711e-01   +2.810818532875426e-01; -6.518982039808209e-02   +1.950946905754796e-01   -1.961235491746014e-01   -6.473903567409570e-02   +1.989371569947831e-01   -1.874072781217251e-01   +3.961425019507610e-01   +2.031208684761921e-01; -3.726763842194895e-02   +1.542720587844990e-01   +6.428079343858809e-01   -5.583037087491682e-02   -4.359576766244145e-01   -6.794627917954000e-03   -2.932583869500034e-01   +8.249719949413757e-02; -4.924358074393825e-02   +1.175007089727765e-01   -1.215647663244120e-01   +3.267998102969881e-01   -8.352750246725753e-02   -1.854029385618562e-01   +1.000000000000000e+00   -5.928727053124075e-01; -3.654027463206257e-01   +3.567082179489606e-01   +2.898189907164030e-01   +1.930898742649933e-01   +3.467261447436475e-01   -3.299809809709515e-03   -5.103675380050489e-01   +7.252286476847151e-02; +3.175155799055075e-01   -6.780105629738399e-01   +2.811631008124402e-01   +2.275524861880787e-01   -2.684016455246667e-01   +6.263347106831596e-01   +2.366236116061865e-01   +2.336911165844525e-01; +7.551518921147794e-01   +3.110911442744048e-02   +1.117565299446365e-01   +6.999080091731280e-01   -5.352546072607871e-01   +5.793543854753935e-01   +5.620652489332112e-01   -1.396057219547560e-01; -2.088940223406337e-01   -1.147736093002348e-01   -1.966799742428448e-01   +4.593576022576497e-01   -6.482959870291435e-01   +1.622359829403869e-01   +4.658295229064387e-01   +5.222068881158833e-01; -5.390517280348649e-02   +1.732729884175910e-01   -2.491348756651367e-01   +8.167129162655454e-02   +1.190743629161111e-01   -2.234579357383921e-01   +3.527504953885073e-01   +1.092358194046817e-01; +2.072148462993122e-01   +1.899422599086186e-01   -2.991681796538079e-02   +2.930110335723877e-01   -9.263982178748201e-02   -8.860316513744551e-02   -3.230240712948158e-01   +4.328648933169367e-01; +1.293245380087258e-01   -1.001350324412625e-01   +3.450002419508620e-01   +1.932502904789328e-01   -6.569021384262237e-01   +3.875866061663272e-01   +4.561444252511186e-01   -1.691167772546888e-01; +9.529269499868627e-01   -2.132368690559321e-01   -2.540283000572368e-01   +2.675471373747453e-01   -5.204525596629855e-02   -2.688001948759952e-02   +3.029606790678117e-01   +5.333574528537895e-01];
L1I_L2I_iGABA_netcon = [-1.039947733131852e-02   +3.667579676614555e-01   +3.461541117703998e-01   -2.428489339519866e-01   +1.339784657247782e-01   -1.529020902948912e-01   -3.892117830401822e-01   -1.000000000000000e+00   +3.519503137428647e-01   -8.495619535366922e-01   +3.238440459734047e-01   +5.993902487722572e-01   -4.382252740868582e-02   +7.070160878142768e-01   +6.731412862062324e-01   +4.234948045730542e-01; -2.086130742421287e-01   +1.907398065485348e-01   -2.655783334332669e-02   +1.706574819162733e-01   -2.896483274812919e-02   +3.388506961250111e-01   +8.010694199163316e-01   -2.026115640063767e-02   +5.964689446144847e-01   -4.877038955359456e-01   +6.568060335290191e-01   -5.220450067761234e-01   +6.252105620380488e-01   +3.189929210406250e-01   +8.466255405029987e-01   -6.073110711954994e-01; +1.248349588027117e-01   +1.039334779163706e-01   -6.225087339464267e-02   -3.585432294796921e-01   -8.258313969172228e-02   -9.875524453941149e-02   +1.779361251227343e-02   +2.276794540467889e-01   +5.718004440702842e-01   +3.167771664217098e-02   -4.383504895506065e-01   -1.733202541102912e-01   +7.059529149298738e-02   -5.865814843143659e-02   +1.543627941243424e-02   -7.483780446973511e-02; +6.654842978189628e-03   -1.261339608082777e-01   -4.716372480817280e-01   -4.971959378266602e-02   -1.863855088427165e-01   +2.550959468185860e-02   -1.501556938975794e-01   -2.363918126469213e-02   -7.666178731810822e-03   +1.807068361698085e-01   -2.301826100021561e-01   -2.675405872554095e-01   +4.105838294939316e-01   +1.342819162705220e-01   -3.576312423646221e-01   +4.028441161110819e-02; +4.138873117889471e-02   +6.914165360830084e-02   -1.915316515599039e-02   +6.283592865257924e-03   +7.075691439453781e-01   +3.123144113008344e-01   -1.756852100116624e-01   -1.897807268097731e-01   +7.197315358758071e-01   +6.512352070666666e-01   +1.131302489635223e-01   +5.912605174424845e-01   +4.144747609389510e-01   +8.271297030826663e-02   +1.016480562406123e-02   +1.552207741323987e-01; -7.792834857237447e-01   +1.772526470866669e-01   +2.275680490052516e-01   -1.659122537425599e-01   -1.385795851573142e-01   -4.786078623072249e-01   -6.299811814254766e-02   +4.963064701447361e-01   -2.953523282863921e-01   -3.392955017324650e-01   -1.211386336241648e-01   +6.711628396843226e-01   +3.128657041862464e-02   -7.763196073261971e-01   -2.732104052172536e-01   -7.935924148989075e-03; +7.966378153484492e-01   +1.459512775880307e-01   -3.145172341104883e-01   -3.356375953861493e-01   +7.871742119046591e-01   -2.077367484516166e-01   +3.247683294498659e-03   +2.393766592404544e-01   +1.618533030437672e-01   +3.805038654899118e-01   +3.103687597963363e-01   -1.060634301922176e-03   +6.246679244409258e-01   -4.203594765542178e-01   +3.326049275948310e-03   -7.573212737790996e-01; -1.417555765228409e-01   +9.122686986657545e-02   -1.765365542581843e-01   -6.315929951017065e-01   +4.371327240380702e-01   -1.792844377898612e-01   -4.278915018256634e-01   -4.935062535097909e-01   +2.986833096795445e-01   +1.684264043017273e-01   -2.033729377024445e-01   -1.463049117713978e-01   +2.778172722815258e-01   +2.553671878368705e-02   -4.446684609015668e-01   +3.004886312232254e-01];
L2E_L1E_iAMPA_netcon = [-3.047307116626488e-01   -1.708663792841189e-01   +2.111437005688662e-01   -1.977383664738853e-01   -8.583602584553927e-02   +6.171740293174414e-01   +1.236745968025509e-01   +4.013247833423803e-01; +6.491084739584055e-01   +2.968246771448484e-01   -1.550906410288891e-01   -1.451305802055238e-01   +4.242623784934408e-01   +6.571826257919147e-01   +2.148435505800105e-01   +8.126862518366559e-01; -4.173627406771636e-01   -2.543173628233232e-01   +6.089857449113609e-03   -1.881765705543791e-01   +3.026750696246446e-01   -2.126162758523343e-01   +1.010505089572267e-01   -1.048085480814335e-01; +6.305559216569431e-01   -7.215419902218370e-02   +1.778940579095350e-03   -2.637231271707675e-01   +6.551331344377430e-02   +4.474851470585665e-01   -7.810353817911686e-02   +6.766477624373218e-02; -1.238326669256460e-01   -1.781119565821987e-01   +2.581844145583074e-01   +6.268504713119210e-01   +6.058295595327473e-02   +3.554862713629903e-01   +6.777970484488209e-01   -4.832187651124377e-01; -5.570650854455576e-01   +2.327833451807459e-01   +2.515539175988172e-01   -5.750646291043510e-02   +6.051973673061142e-01   +6.986194260085195e-01   -1.947831230353025e-02   +2.930176245207808e-01; +4.846388739682241e-01   +5.510012138134928e-01   -3.611885896175718e-01   -4.861402274899307e-01   -1.526724582327773e-01   +3.746497531456115e-01   +3.889566908649117e-01   +5.990475269619475e-01; +1.589397646485275e-02   +3.703397662732397e-01   -6.406837506708757e-01   +7.071623499706107e-01   -4.455691706643790e-01   +2.337038282698049e-01   +9.825211310343884e-02   +3.532378287410138e-01; -5.428604359968249e-01   +4.452436463284362e-01   -7.824379962508633e-02   +2.424536694850155e-01   +1.377273829053681e-02   -3.769861618899775e-01   -6.758776581304859e-01   -2.757504639873305e-01; +1.162872793204713e-01   +5.294919285021294e-01   +9.825268985807414e-02   +2.222827491021563e-01   +4.296162529073881e-01   -2.856230473843598e-02   +2.538941044460947e-01   +3.413158458214996e-01; -3.796328085771868e-01   -3.432382646181993e-01   +7.023560789656497e-01   +1.902953982147054e-01   +4.187021989767490e-01   -2.921419343149865e-01   +6.527943507503189e-01   -1.641054669819170e-01; +1.445408264570253e-01   -3.300981122310521e-01   +1.000000000000000e+00   +4.283275349709081e-01   +8.863835025671342e-01   -2.521756811097826e-02   +4.983106651111520e-01   -2.076585480194753e-01; -7.210035978487772e-01   +5.458649468519056e-01   +2.024971588759696e-01   -4.314224003325893e-01   -3.998334266373623e-01   +1.036707339791040e-01   +9.372128085133949e-01   -5.692398959736203e-03; -5.367012972101375e-01   +3.076472692596838e-01   +4.654205118902065e-01   +1.780137394060647e-01   -1.759296653287562e-01   -3.343837100113980e-01   -3.437238155353654e-02   +6.795181984422377e-02; +3.644895306401855e-02   +9.192786105587634e-01   -4.185322564164830e-01   +3.772016652868964e-01   +1.629536866384139e-01   +2.888183907572325e-01   +2.730157533620559e-01   +1.093690786274477e-01; -2.525380548850890e-01   +7.621658551539569e-01   +2.448747264983959e-01   +3.970817466733910e-02   -4.389016484705439e-01   +3.193227375206290e-01   +2.120759965497952e-01   +2.700121744078825e-01];
L1E_L2E_iAMPA_netcon = [-5.817658179512711e-01   +3.764204988262900e-01   +7.647977763443349e-02   -6.967205141059293e-02   +2.130292789746027e-01   -6.246169145528905e-01   +3.208492188953128e-02   -8.138135784364667e-02   -1.475252489793683e-01   +4.649193186860088e-01   +5.506307454216310e-02   +4.532963028665010e-02   -3.364727794546108e-01   +4.588172580023515e-01   +7.326121682273924e-01   +2.258288479042843e-01; +5.898340599519070e-02   -1.604946091432950e-01   -2.375367428965341e-02   -5.838941153082785e-01   +2.791757283683413e-01   -8.350179531484971e-01   +2.336231870274830e-01   -4.158250295087983e-01   -8.009347710207682e-02   +3.330200003910654e-01   -4.398660905019388e-01   -1.487865494497207e-01   +3.307037625723547e-01   +4.569794117528818e-01   +7.339393791327656e-01   -1.506496178320009e-01; -2.053545364179233e-01   -2.623805639669408e-01   +9.705868389795787e-03   -8.527007793347527e-02   +3.833612937692247e-01   +3.340064240003367e-01   +6.695256360416358e-01   +5.661795206676126e-01   -1.670548948500281e-02   +4.640372069106851e-01   +4.841767294569697e-01   +6.504549082201911e-01   -3.590822323402311e-01   -1.709726779225406e-01   -2.497939023542073e-01   +3.859986221447391e-01; +2.809948162285331e-01   -2.619766784849542e-01   +2.021725923020861e-01   +8.523342425137466e-01   +3.520170025326032e-01   -7.283533659081261e-02   +3.650132665601193e-01   -3.952491334574464e-01   +2.952518146730838e-01   -4.666860416768947e-01   +8.598975153886743e-02   +2.408848625217182e-01   -3.315768734137102e-02   -1.798160393923867e-01   +6.351342652999514e-01   +4.643894175668772e-01; -3.230874031308514e-01   +1.401435409612231e-01   +5.859149912696018e-01   +6.620515837778909e-01   +1.172210454494767e-01   +5.659932869708783e-01   +6.008922865547015e-01   +6.023160328694271e-01   +4.120479719967723e-01   -5.589610170759783e-01   -1.766649142957099e-01   +1.152949588881423e-01   -4.410881071700064e-02   -3.826907526268707e-01   -3.278741877431909e-02   -5.099524901852820e-01; +3.343774261410380e-02   -4.558691049377557e-01   -4.898810878564808e-02   +1.858748293584929e-01   -2.610223162946474e-01   -1.449647979430972e-01   -1.590009247979423e-01   -2.947049141438018e-01   -1.304345876462556e-01   -4.006040880536531e-02   +5.832070135945506e-01   +8.466915481600513e-01   +3.848336853949080e-01   -2.144870122473932e-01   -6.829008853881832e-01   -5.920507573654722e-01; +2.663753044572160e-01   +8.313619163467141e-01   +5.711811521648675e-01   +1.935274855098877e-01   -4.602564246685817e-01   +6.530727766912463e-02   +2.238742508118416e-01   -2.957396443120557e-01   +5.470171178233632e-01   +2.546390978760925e-01   +2.174918718535837e-01   +3.773171037403328e-01   +4.303650490407424e-01   +1.545682231750388e-01   +7.393493412744466e-01   +1.477355718066087e-01; -3.721049974000928e-01   +1.000000000000000e+00   -3.652054551180100e-02   +3.089115427144766e-01   -4.390761020550182e-01   +2.755919453233420e-01   -3.995520791214778e-01   +1.871085161128411e-01   +2.665250880902605e-01   -4.051086158797682e-01   -2.529432678184591e-01   +2.626432906630399e-01   +2.462920162199441e-01   +2.999599896018615e-01   +6.315824374911154e-01   +7.805122103164074e-01];
L2I_L2E_iAMPA_netcon = [-2.611952615465541e-01   -4.641266715520441e-01   -9.050284091088460e-02   -6.752987745439400e-02   -2.237301182076959e-01   -2.456402905708642e-01   -1.436055242798152e-01   +9.266340418824485e-01; +5.638924978494821e-01   -5.210092557604059e-01   -6.587472533701398e-02   +1.000000000000000e+00   +5.168457772269065e-02   -1.485869641800208e-01   +5.106911201135577e-03   -4.880994128813258e-01; +1.340772985042184e-01   -5.391464990362140e-01   -1.197561858827033e-01   +3.258787590729673e-01   -2.320598783630748e-01   +7.961976822114017e-02   +1.289446359452679e-01   +5.991835840833502e-01; -2.988970829422224e-01   +2.644503346523114e-01   +6.737885274975958e-01   -6.364100287760920e-01   +2.297682069659268e-01   +5.894024295578296e-02   -4.646628575220205e-01   +1.130429408806916e-01; +2.238579251837359e-01   -8.346264572359589e-02   -4.069875786566891e-01   -4.165779634262122e-01   +8.977674593444693e-02   -4.868199053146020e-01   +6.233722540777910e-01   +3.861292425892661e-01; +3.262232115803754e-01   +8.029258417367873e-01   -1.767697070498403e-02   +3.230440169310255e-01   +1.834986086775112e-01   +1.351423469925316e-01   -1.036140586232160e-01   +3.065420539495917e-01; +7.035445646298977e-03   +1.775814565089316e-01   +3.586103121278388e-01   -4.078492475244211e-01   -8.147082938826636e-02   +6.308547324230852e-01   +4.184003049814750e-01   +1.976060460804261e-02; -1.474301222910012e-01   +5.604213964316260e-01   +4.367916669724433e-02   -4.759806130654413e-01   +3.963291917346168e-01   -5.115622055926641e-01   +6.258760424822249e-01   +4.257349960674527e-01];
L2E_L2I_iGABA_netcon = [+4.374441912017870e-01   -1.291857840312533e-01   -1.685842783187055e-01   -5.280891346126044e-01   +2.567495697326795e-01   -2.202378881559206e-01   +2.935545099949073e-01   +7.273820129014158e-02; +2.366595808869703e-01   +2.095557239504372e-01   -2.560632815722115e-01   +4.970232697934626e-01   -4.136837737206052e-01   -4.387509763477115e-01   -3.024043075371475e-02   +2.289255805879000e-01; +4.007121201784291e-01   -2.811532382705003e-01   -5.477046031756753e-01   -3.271376572701346e-02   -2.751229923167373e-01   -2.787966318815139e-01   +1.000000000000000e+00   +9.033320876794897e-02; -5.825178294052132e-02   +2.201629339887938e-01   +6.133463063028995e-01   -5.198687716790437e-01   +4.999654045793365e-02   +1.223098514601149e-01   +4.861536745798583e-01   +5.905406485475375e-01; +2.858438028278198e-01   -1.388568072575322e-01   -1.497775243355564e-01   -2.896640929166631e-01   +3.420960048830728e-01   -3.805254693461028e-01   -5.728501472107208e-01   +4.872511059396485e-01; +5.957507454159622e-01   +3.584251181439007e-01   +6.459403113410003e-02   -2.138862126384929e-01   +3.277081948385490e-01   +1.130261550148184e-01   -6.320360211637575e-01   -4.531633106347444e-01; +5.253215966066703e-01   -7.091827605235814e-01   -2.509426025320572e-01   +4.589092573892983e-02   +1.626780686114086e-01   -1.277850492722116e-01   +2.292877494491996e-01   -9.685582259098971e-02; -1.051243227805607e-01   +2.315275118994732e-01   +3.511894233151793e-01   +4.242052284158707e-01   +3.331997043976418e-01   +2.043040490315420e-01   +2.426569986073508e-01   +3.145436273331261e-01];
L3E_L2E_iAMPA_netcon = [-4.426151510372741e-01   +1.136039652735699e-01   +6.160051998172705e-02   -9.883364729588152e-02   +7.116707405402251e-01   -1.416235091003469e-01   -7.099137867644765e-01   +2.690195557588765e-01   -4.064760296787334e-02   +1.852667779928077e-02   +6.949648647629716e-03   +1.174907449982179e-02; -8.278025426823872e-01   +3.528126669339412e-01   +2.175360372048955e-01   +3.123321387258979e-01   +2.920133154774420e-01   +1.073504389900613e-01   -5.110604413770840e-01   -4.483494132754845e-01   +3.300255622371321e-01   -1.052913010006136e-01   +8.872973759292682e-02   -4.481909799777457e-01; -7.521100578234325e-01   -5.955712850957036e-01   +6.106631882178202e-01   +6.542801228154568e-01   +2.557005217053760e-01   -5.414973149142770e-01   +3.499722292818634e-01   +4.227893308433886e-02   +6.900278249054547e-01   +8.552059528860861e-02   +2.665371471431345e-01   -1.532392253247439e-01; +4.624923953621465e-01   -3.380573840745098e-01   +2.128423054609755e-01   +6.576185715692255e-01   -2.124139709804737e-01   +2.234934016905490e-01   -2.027150463697809e-01   +1.410252637370785e-01   -4.785394090765122e-01   +8.615204768536318e-01   -5.192377736878466e-01   +2.508306508730835e-01; +5.704595836690270e-01   -1.442370985327364e-01   -1.504859082336911e-01   +6.294916487113020e-01   +2.159355671356034e-02   -5.871109431716974e-01   +6.174498005205198e-01   -4.528386897221087e-02   -1.482357451951167e-01   -2.929460053355792e-01   -6.307588408887782e-02   +5.819372092495492e-01; -2.899108701279303e-01   -5.374605741563336e-01   -4.012005900364005e-01   -1.086360271100402e-01   +5.226381179981586e-01   +4.435129298539766e-01   +6.604865230996915e-01   +1.884923471626177e-01   -1.099681199481470e-02   -1.975730585144927e-01   -4.113337478664960e-01   +1.979522728087401e-01; -2.071494419595102e-01   +2.336479049469162e-01   +2.194120516523001e-01   -8.110294279414116e-01   -2.237058730432907e-01   +6.703743871845826e-01   +3.403541384827797e-01   +1.849880410017913e-01   -3.707072765547706e-02   -7.613219037991078e-01   +7.384065144748145e-01   -7.709111766263714e-01; -7.348736774713756e-01   +5.967843677460812e-01   +4.082538822186472e-01   -2.169089744408043e-01   +4.379177923829403e-01   +6.739155652037018e-01   +2.789017057605771e-01   -3.709285966524523e-01   +3.478600414266548e-01   +5.381841893314179e-01   +3.949436069544059e-01   +4.889617093447605e-01];
L3I_L2I_iGABA_netcon = [-7.399571641601714e-02   -1.516844244164574e-01   +3.803790957542121e-01   -3.526336390018283e-01   -5.876653896758429e-01   +5.589619289665499e-01   -3.851584541759330e-01   +2.748633283094232e-01   -5.674248738889751e-01   -1.748530936742834e-01   -6.835998755359369e-01   +6.675362500480813e-01; -5.162839501946195e-01   +6.701472355538486e-01   -4.467825819529008e-01   -2.835322010225053e-01   +2.774492714506535e-01   +5.847467670843028e-02   +9.676645312707874e-01   -5.537892773673982e-01   -6.043252380057474e-01   -2.080960275109812e-01   +1.183313217914362e-01   -2.276230313078281e-01; +3.521693133111041e-01   +6.039648324725199e-01   +1.387440840048801e-02   +7.040463606341837e-02   +2.901542771943409e-01   +4.931966067632036e-01   +2.221602596137535e-01   +5.696821241439393e-02   +6.981135985676851e-01   +6.227940897218106e-01   -5.940203381459381e-01   -3.742921402217653e-01; +1.939637056563231e-01   -6.215700609483815e-01   +1.787192618938268e-01   -2.718772110052676e-01   +3.039009159782139e-01   +4.496378906571271e-01   +4.409785771665881e-01   -5.191813842338778e-01   +8.207346058230046e-02   +7.298241782616810e-01   +3.120209400393023e-01   +1.504553160796580e-01; -2.304216356939646e-01   -1.949121920783007e-02   +5.506021126966298e-01   +6.077024226518647e-01   +5.255084998341878e-01   -8.846306777196812e-01   -7.498852431594477e-01   +2.684351531963080e-01   -2.285472437540358e-01   -5.921151481626641e-01   -4.896647242938539e-01   -1.313027686376438e-01; -6.148734037779784e-01   -4.732354966516513e-01   -8.330920066158007e-02   -4.062457691349837e-01   -1.603577988628485e-01   +6.413462843937864e-01   -3.269306590672631e-01   +1.000000000000000e+00   -6.656764914177056e-01   -3.430830075747719e-01   -5.707322066975810e-01   +3.113886343295065e-01; +7.539235104119717e-01   -1.680573792644961e-01   -7.208324463302491e-01   +1.342245171444357e-01   -8.360308101642329e-02   -1.021765879088903e-01   +3.012319477702773e-01   +6.527139846777209e-01   +4.748641951794387e-01   +7.204831674434109e-01   -3.005268563749249e-02   -1.251014693075893e-01; +1.227815313162513e-01   +7.362233814398456e-02   +1.902645317667645e-01   +3.729127934202344e-01   -3.330394414251201e-01   +4.031906418208960e-01   -1.388990344604873e-01   +1.729457264406027e-01   -7.871191689126908e-03   +6.520732999781748e-01   +3.346088565261591e-01   +5.721089749141943e-01];
L2E_L3E_iAMPA_netcon = [+3.661264235391311e-01   +1.729208124153095e-01   -1.000000000000000e+00   +8.944673440497177e-01   +3.968641704587239e-02   +1.611698810773046e-01   +4.076760346475479e-01   +7.649822961280051e-01; -2.351349483688760e-01   +4.815308087552616e-01   +8.246179879564987e-01   -2.041350764720651e-01   -1.999497791181472e-01   +6.971988569364331e-01   -3.490175406509718e-01   -5.527710552332845e-03; -6.531532550755231e-02   +8.804433982018391e-01   +6.081121833857134e-01   -4.716487164182261e-02   +8.475404192169776e-01   -3.656006881056386e-01   -5.822398092387326e-01   +3.051290315811928e-01; +5.609652619060902e-01   -5.962224772034321e-01   +5.162196155742341e-01   -6.392695602977305e-01   -8.237350106034493e-01   +1.688474658366534e-02   +4.426263619310847e-01   +1.754649733774068e-01; +2.860755691450176e-01   +9.624827793152008e-03   +4.241281989656104e-01   +4.458005484806912e-01   -2.215159720816897e-01   -5.175784180330343e-01   -5.769387377238450e-02   +3.215115345661065e-01; -5.835968814430339e-01   +1.403509959788889e-01   +2.836528682091497e-01   -5.230427627943932e-02   +1.971756521926858e-01   +4.205195223501886e-01   +8.794988966020542e-02   +2.515128552486983e-01; +4.185533882792239e-01   -2.176396099405465e-01   +5.287486504073177e-01   +5.800491408662933e-01   -6.561697965301403e-01   -2.813431827389893e-03   +3.799401525411500e-01   +8.873503320765526e-01; -4.540161914693752e-01   +4.515567433414356e-01   -2.969777364255295e-01   +7.714155076288195e-01   +3.939992310381344e-01   -6.430250445535722e-02   -4.207628478949461e-01   +2.017390154942101e-01; +8.492265278019157e-02   +4.419547817986959e-01   -2.917316868006401e-02   -2.564434466506231e-01   -2.969401567386979e-01   -7.140797658144521e-01   -4.860472356600550e-01   +4.647625590597825e-01; +3.779022103338514e-01   -2.958139875140191e-02   -5.354267844755505e-01   -9.693965419895291e-01   +3.518037614243755e-01   +7.848083178487475e-01   -2.006448332225271e-01   -2.906449606144697e-01; -6.874016137003981e-01   -1.123515852809586e-01   -1.832247888029349e-01   +1.730802490542857e-01   -1.893812439388255e-01   -6.878540386243617e-01   -1.912143856752911e-01   +3.825686326587596e-01; -4.767996038578405e-01   +1.598440007867550e-01   +1.946392477780321e-02   -2.748802983496634e-01   -8.968817369238359e-02   +1.013654220854744e-01   +7.287209278725572e-02   -6.024810749275853e-01];
L2I_L3I_iGABA_netcon = [+1.925630658069015e-01   +5.300792210689439e-01   +2.765033888774703e-01   +9.717587791251682e-02   -6.214441606388251e-01   -9.591714125996918e-02   +8.092332416202690e-02   +3.355870566079824e-01; -4.142074141704020e-01   +2.856111976910697e-01   +1.450153818470041e-01   +9.486495266575975e-01   +1.699139268166504e-01   -6.532386041891338e-01   +3.370470883054423e-03   -2.403526616482914e-01; +2.531433124917602e-02   +6.098300371612888e-01   +3.862964143343862e-01   +4.902740472301261e-01   +5.964904642899225e-02   -1.146619892065143e-01   -4.980044783294733e-01   -6.060710399427066e-02; -4.254770964267951e-02   -3.785637360230452e-01   +6.660930707939672e-01   -1.184800222985592e-01   +2.106329800434232e-01   +7.694395580362934e-01   -3.997717970476674e-02   +5.173292157009097e-01; +4.663251039933349e-01   +1.643073656861303e-01   +2.948580921844092e-01   +6.017337723815560e-01   -4.137877445877675e-02   -1.900597679417453e-02   +4.046140555575451e-01   +8.975472769076329e-01; +8.797261413751312e-01   -1.273378284898506e-01   +5.027886769957521e-01   -1.378943511160591e-01   -1.822199822841629e-01   -1.301630917956806e-01   +1.570140081775276e-01   -6.362363623491267e-03; -1.001524762665125e-02   -6.302404765737363e-01   +4.987878643653246e-02   -1.412653864185767e-01   +6.408811378878617e-01   +7.690720234716229e-02   -3.424630138359001e-01   -6.708110474291625e-01; -2.222628100935794e-01   -7.335330221645046e-01   +4.867244828289453e-01   -3.912310078947693e-01   -1.873574393882836e-01   +3.889906793936410e-01   -6.376584270158755e-01   +1.671212411502988e-01; -1.476116350005030e-01   -2.805811597529065e-01   -8.161316000773805e-01   -8.842187395808725e-02   -1.014931224783205e-01   +8.503715374484157e-02   -1.185254227967014e-01   -1.633981791405580e-01; +8.731297800984644e-02   +2.069348587254045e-01   +4.185896939046515e-01   -1.000000000000000e+00   +4.518328436230277e-01   -2.576513980141779e-01   +5.506191935768467e-02   +4.239376441503994e-01; -1.388563388034066e-03   -1.285395274555371e-01   -2.284525195024038e-01   -6.211463007418859e-01   +1.114231727636545e-01   +2.062141366529390e-01   -4.027810836614957e-01   -6.880964540131697e-01; +1.159814142480246e-01   -2.403355118735032e-01   -1.218657850074650e-01   +3.586293814810312e-01   +8.943485217982461e-01   -5.195395465243875e-01   +3.221037246051117e-01   -2.086703110945200e-01];
L3I_L3E_iAMPA_netcon = [+3.610228173486754e-01   -3.471611976010235e-02   +2.768127887535977e-01   -4.203873822068903e-01   -2.765169753049116e-01   +1.460798785726564e-01   -1.993781208756267e-01   -1.490010076019566e-01   -3.911735882059500e-01   -5.306339775704437e-01   +5.615837592071018e-01   -2.459112590525999e-01; -3.845720078400189e-01   -3.091971265717774e-01   +5.457879737117842e-01   +3.774159960173741e-01   +3.575521408883647e-01   -8.626267283056986e-01   -5.027311819849547e-01   -2.206760613036000e-01   +1.000000000000000e+00   +3.224273297106179e-01   +5.847264963756261e-01   +9.584461671149795e-02; +2.261502826616582e-01   +5.609054912527441e-01   +2.361425021527498e-01   +2.934812729668956e-01   +6.788023124365302e-01   -8.188111020599542e-01   -6.978505278454971e-01   +1.971125235444137e-01   +9.791447267725405e-02   +6.296098014930024e-01   -6.092003616166212e-01   -5.910588943929075e-01; +1.084169185061165e-03   -1.984435599549062e-01   +3.980777915870715e-01   +3.387291741794733e-01   +3.048954433482532e-01   +9.206668086919230e-02   +7.310551842767761e-01   +1.105110716457740e-01   -7.098544477585615e-01   -6.936450918244147e-02   -5.524606317355635e-01   +4.390629729331303e-01; -5.700116550344577e-01   +4.926764603771599e-01   +1.182429873806648e-01   +9.291469800554021e-02   +2.370617089495467e-01   -4.349805778105812e-01   +9.578787385071572e-03   -3.367444992153569e-01   +6.089180215383151e-01   -2.473100708455839e-04   -1.872213978686613e-01   +2.292690634049730e-01; +5.607054478708660e-01   +1.770858926417908e-01   +2.735797123844970e-01   +2.670668323985833e-01   -9.183169364401494e-02   -8.328971460507762e-01   +1.781284109541193e-02   -3.468684893249865e-01   -1.321797520684362e-01   -4.639480171779758e-01   +2.531828710104255e-01   -7.928645329265054e-01; +5.642007846207192e-01   +6.185390002825113e-01   -1.661239405670617e-01   +4.235008752444525e-01   +7.047329800462510e-01   +2.550564272103477e-01   -3.913270382008637e-01   +3.629985628322207e-01   +8.108025923107701e-01   -6.075598514622432e-01   +3.527004888194135e-01   +6.114132886851573e-02; -1.131418871659807e-01   -5.050838018170271e-01   +2.971301004605621e-01   +1.697933574354644e-01   +2.321539854858046e-01   +2.665298524868914e-01   +4.277695506061991e-01   -1.224157265010812e-01   -3.823248227129671e-01   +4.525952585816044e-01   +2.603509235975495e-01   +1.632182135395547e-01; -5.604523244197805e-01   +4.432482887913907e-02   +1.261966042823557e-01   -3.991314223514082e-02   +1.073813450348498e-01   -3.411523494323592e-01   -4.142500101005216e-01   +5.177999509157042e-01   +8.019740531423522e-01   +8.026285394247078e-01   -3.578905370788345e-01   -4.302707881928046e-01; +8.213519239106436e-01   +5.473026970265867e-01   -3.166083773662697e-01   -2.790513706700605e-01   -2.685214565721324e-01   -3.158451855562089e-01   +5.518809563099211e-01   +8.134391071165593e-01   +1.542757598141172e-01   -3.034749522325073e-01   -1.738319814749195e-01   -1.137681154832204e-01; +2.046650807910517e-01   +2.196941526154457e-01   -6.248272433051254e-01   -1.070325612147906e-01   -1.656526068959304e-02   +1.320655171327751e-01   +2.866714432311238e-01   +9.609193754011405e-02   -5.675087674179735e-02   +4.543188799296995e-01   +6.164235705306798e-01   +4.224525546178250e-03; -1.431223988572266e-01   -6.664728758975700e-01   +9.594167079963746e-01   +4.395612313721153e-01   +4.005649650332773e-01   +3.575283581750692e-02   +2.653102958946810e-01   -3.356941102964335e-01   +4.372525039824853e-01   -3.250876096454517e-01   +1.838958638133181e-01   -5.424116284873584e-01];
L3E_L3I_iGABA_netcon = [-6.884803895822506e-01   +1.583091053785496e-02   +1.225347703427287e-02   -2.060866655434773e-01   +3.054960293793972e-02   +6.753097547577691e-02   -9.793780169202297e-02   +6.239348095863739e-02   +2.474589483384760e-01   +2.601280679108043e-01   -2.622303778193404e-01   +1.974958603968726e-01; +4.609063552664106e-01   -7.419904358587789e-02   -1.011176472117602e-01   -1.665239675644621e-01   +1.283229350832210e-01   +7.910606999839601e-03   +4.016987289556911e-02   -5.588094364318150e-01   -4.457795317140280e-01   -1.201070827806550e-01   +1.449004439234852e-01   +2.736697548213993e-01; +1.210410425869313e-01   +2.875852932866429e-02   +1.403387614560097e-01   +4.051163947780631e-01   +5.644591952923509e-01   +7.778485778557660e-01   +1.832672361363151e-01   -4.545227782116861e-01   -2.554885483218269e-01   -1.350691914001235e-01   +1.756341208685794e-01   +4.923400469674337e-01; +2.555475365346870e-01   +1.339262267306324e-03   +6.773813837380090e-02   -1.831687529336632e-01   -3.439690519510746e-02   -6.446430132598584e-01   -8.043011140083796e-02   +4.074725089002038e-01   +9.633337455299802e-01   +5.553938297103617e-01   +3.449180520908610e-01   +7.433598240547485e-01; +2.719521390261482e-01   -2.939470753311432e-01   +3.163524393919339e-01   -4.011555792804110e-01   -4.410545843292066e-01   +5.070673082668780e-01   +4.056542037707175e-02   -6.245899122196772e-01   -1.407235135763698e-01   +4.042039355802412e-01   +1.568346310407349e-01   +3.381728130889328e-01; +1.672033029523645e-01   -3.282855865102001e-01   +1.903437740785001e-01   -2.255825840049505e-02   -1.553677647786078e-01   +1.085137549254570e-01   -1.839622641186511e-01   +2.771957060946800e-02   -2.375395468339090e-01   -2.501173111103880e-01   -4.216107608182811e-01   -1.399027748744347e-01; -8.492925333304635e-02   -4.615752088189403e-01   +4.189485880844080e-01   -1.567385686176250e-01   +1.481749797907338e-01   +4.644355807991679e-02   -2.473615595417571e-01   +3.961959180639903e-01   -3.036883901569753e-01   +3.528284038899460e-01   +1.370295084775469e-01   +1.130183829391275e-01; -2.703296459013865e-01   +3.217151773037730e-01   +2.739513436740518e-03   -2.676169488846537e-01   -4.817273157164530e-01   -1.749782297358605e-01   -3.793934334661076e-01   +1.180692782254308e-01   +7.396045860833969e-02   +1.672032808260548e-01   +3.689509946627194e-01   -1.250867934088713e-01; -3.254929926523079e-02   -1.245819384280931e-01   +4.128493234932491e-01   +5.493161580611527e-01   +5.107817164039831e-01   -6.363917657283436e-01   -1.890398257850741e-01   +3.141496903394111e-02   -1.627188614023140e-01   +2.939192870413118e-02   +7.560037108440032e-01   +2.973122903800074e-02; -4.808260444525849e-01   -2.332364067080212e-01   -1.676473449112581e-01   +8.424226206673546e-03   -3.169203279019011e-01   -4.073561999886339e-01   +1.072875947011366e-01   -5.977090092800945e-01   -1.095034680419295e-01   -1.977647764190291e-01   -1.885102972100340e-01   -3.820516511960853e-01; +4.246289303660175e-01   -2.139766320108897e-01   -4.248727166656411e-01   -7.444640681245844e-01   +3.062863783256211e-01   +1.949487696143380e-01   -3.753673358018628e-02   -2.504497920130322e-01   -4.855178102102446e-01   +4.470706173683541e-01   -1.215542667289582e-01   +7.346764980457055e-03; +7.617873993533192e-02   -2.151797342698163e-01   -2.099476799845479e-01   +1.144898164992366e-01   +9.778167673094892e-01   +3.879095899501714e-01   +2.542244831599884e-01   +8.884504510854510e-01   -2.967098207680452e-02   +3.073361588005302e-01   +9.731659842310292e-02   +6.791122731464438e-01];
L2E_Input1_iAMPA_netcon = [-4.154074443906151e-01   +9.443024212497380e-01   -4.328885678711513e-01   +2.205377264893005e-02   +3.251859861892886e-02   +2.191419026064566e-01   +7.114586138036874e-01   +5.853352696479717e-01];
L2I_Input2_iAMPA_netcon = [-2.488177194160748e-01   -3.523698380863147e-01   -2.052496486177536e-01   -4.122329521088679e-01   -4.767726865812174e-01   -1.667436869005253e-01   +3.093119714821257e-01   +7.789909088758152e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.4*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.4*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
