function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.201735476633317e-01   +2.184030274967284e-01   +6.093894186270825e-02   +1.431325535675116e-01   +6.605669083557884e-01   +1.281213389138473e-01   +4.056676900128026e-01   +1.318602844073114e-01   +8.679225859614130e-01   +8.095249065299170e-01   +5.856512405457140e-01   +3.736145614147541e-01   +9.157502210315625e-02   +4.714131117081026e-01   +3.545041008754165e-01   +5.927979378743692e-01; +5.684839524757201e-02   +2.927426037032169e-01   +6.626086453983392e-01   +3.935001799235040e-01   -1.001201520009828e-02   +1.905529373169979e-01   +4.241362200761034e-01   +6.256712062347898e-01   +6.198402154999161e-01   +1.917809396840194e-01   +6.945752120734823e-01   +3.102584145857187e-02   +5.380231603386698e-01   +2.325936251167776e-01   +7.551689145523555e-02   +6.414907519296174e-01; +2.618792736138924e-01   +3.303413006314188e-01   +5.829946097473457e-01   +3.595359077893531e-01   +2.901322161864638e-01   +4.028076495580457e-01   +1.392526375739301e-01   +2.243118543757082e-01   +6.397643038598699e-01   +5.472440481896751e-01   +1.725909719875485e-01   +4.727871848636678e-01   +2.546731510977448e-01   +6.983609156202050e-02   +1.564729477308376e-02   +2.662278130199921e-01; +4.360147796142469e-02   +6.545109206137814e-01   +2.831675963453488e-01   +1.965565734287563e-01   +5.742507718610346e-01   +1.729453361385677e-01   +4.076839847030747e-01   +5.009874837776259e-01   +8.401049957184243e-01   +5.818936377679280e-01   +1.959008495786049e-01   +7.155498183380005e-01   +5.706132298303331e-01   +5.127101337594264e-01   +5.061149669688856e-01   +2.823815890004769e-01; +1.067942760408739e-01   +3.467950474544699e-01   +6.934766619009450e-02   +2.652214321363643e-01   +5.017211406184749e-01   +6.270213188231755e-01   +6.061146751913249e-01   +4.778653162631435e-02   +3.385457018541996e-01   +5.506073056110216e-01   +1.231941018293518e-01   +2.561128157491021e-01   +4.021964536675706e-01   +5.452143933811020e-01   +1.386095512092650e-01   +3.645408350913849e-01; +5.905336178174453e-01   +3.526439526911263e-01   -5.985308760227761e-03   +6.921748671052750e-01   +5.049003673274298e-01   +5.115723291185833e-01   +5.332224088772233e-02   +1.679372112152534e-01   +6.251460295354084e-01   +4.954294431089779e-01   +4.098426062284404e-01   +3.254944362597150e-01   +5.691641241276726e-01   +7.704296097989236e-01   +7.445276592504998e-01   +2.430088940087141e-01; -7.755248490840355e-02   +4.198001870754455e-01   +3.412935661953832e-01   +4.426564674739456e-01   +6.053739308795448e-01   +9.434195876186106e-01   +3.501975669778367e-01   +2.025531606406941e-01   +6.386042484160964e-01   +1.095030238144019e-01   +1.767000450705675e-01   +3.568463757051409e-01   +8.240214702733355e-01   +5.532727965068374e-01   +5.995903771829015e-01   +7.979433417397737e-01; +1.542835836577521e-01   +5.493948107060204e-01   +1.091584179129414e-01   +7.426631815993482e-01   +1.107368219028876e-03   +4.962603043836646e-01   +1.711068052360768e-01   -1.056825248446019e-01   +6.880265237608513e-01   +3.830538770184686e-01   +5.517454020544653e-01   +1.352195938296547e-01   +3.616492477894726e-01   +8.491669175508706e-02   -3.446770373815664e-02   +5.940203449837858e-01; +1.338447687058951e-01   +1.893085493639145e-01   +4.574875334098206e-01   +1.921981052749524e-01   +5.028561904036216e-01   +1.752190502644951e-01   +5.807036735571774e-01   +3.690226419992702e-02   +5.666087570455640e-02   +6.883090419874881e-01   +6.500773056557815e-01   +4.766304632802464e-01   +2.211889487782474e-01   +8.257315624701059e-01   +2.431714009039278e-02   +7.662417001942651e-01; +1.613316173010435e-01   -5.985252712155201e-02   +3.849161239672742e-01   +1.857704313251606e-01   +6.810413632572831e-02   +2.978969270079310e-01   +2.557492392177920e-01   +2.147055712671098e-01   +6.072232783844130e-01   +1.604317224630112e-01   +1.883424328235900e-02   +5.253665660652843e-01   +7.138554075628500e-01   +3.416023032010860e-01   +5.802963104050034e-01   +2.869880897740973e-01; +2.996931701070717e-01   +5.455335917445870e-01   +2.569865775308514e-01   +1.666910642255919e-01   +8.913951446175643e-02   +2.112361943436592e-01   +2.545247808699441e-01   +4.350355656679166e-01   +5.385864340396296e-01   +2.468096971737293e-01   +5.160441623204790e-01   +6.132383195502353e-01   -3.804130334281869e-03   +3.391162324523544e-02   +1.575658316569652e-01   +1.256401070902234e-01; +3.841697671001540e-01   +3.930518563742271e-01   +3.695108725026348e-02   +6.965880713585984e-02   +8.958519344763650e-01   +2.737271580336782e-01   +6.604036764193172e-01   +4.580041594605774e-01   +5.772818523718167e-01   +1.620546182358202e-01   +1.690890086506908e-01   -9.853701489915671e-02   +2.187881394342359e-01   +4.016252083274228e-01   +8.332320329997279e-01   +3.103522229938459e-01; +2.184684176876468e-01   +6.057271912138229e-01   +3.021876568362628e-01   +4.347008914809403e-01   +6.956958702235243e-01   +6.827465047612232e-01   +7.374609974677819e-02   +4.211734200317908e-01   +9.138604505677360e-01   +9.294044634682441e-01   +6.565836116473179e-01   +1.938291801395662e-01   +8.424170362009104e-01   +6.420009218224684e-01   +2.150804448845932e-01   +4.312774346780266e-01; +7.766556376787308e-01   +1.699470044439250e-01   +7.490039551948128e-01   +4.325990560795316e-01   +1.454154363758817e-01   +1.793749238316793e-01   +2.413601983111604e-01   +7.846475591077513e-01   +6.663223720674597e-01   -1.213049696736936e-01   +3.841640511404796e-01   +6.923761318177585e-01   +3.158568640878213e-01   +7.248986386933263e-01   +4.564105599958251e-01   +7.145788993147218e-01; +4.535048405359613e-01   +6.404008534516977e-01   +6.200911912784636e-01   +6.195883261066899e-01   +8.815998044150947e-01   +2.252154411247896e-01   +4.835058782068444e-01   +7.159938205006715e-01   +5.511358483979885e-01   +6.992896873032983e-01   +2.940070426842392e-01   +2.834645828234467e-01   +1.673032371717984e-01   +5.586403727474691e-01   +6.893183517660998e-01   +7.884045427573582e-01; +6.461981757451263e-02   +6.897610578461446e-01   +5.033993597649714e-01   +3.210742718145524e-01   +2.680357141701881e-01   +2.218640165427982e-01   +7.911408861656317e-01   +6.038598465604099e-01   +6.964928650009777e-01   +3.796906250220169e-01   +1.961206557413329e-01   +4.158104855009789e-02   +2.485859751374323e-01   +5.686308046381939e-01   +7.631865668282558e-01   +7.010681906610727e-01];
L1E_L1I_iGABA_netcon = [+6.997930420928635e-01   +1.973809142665265e-01   +7.113752609878408e-01   +1.574131497453012e-01   +5.363594353527118e-01   +1.548847997055828e-01   +5.688835671277715e-01   +5.744389537048256e-01   +2.087416316211965e-01   +5.464704648520724e-01   +4.607940223897075e-01   +5.571252474695298e-01   +6.246798110625336e-01   +2.898562820153249e-01   +4.122837077543715e-01   +4.972186257384589e-01; +4.314124795584184e-01   -8.472118654488114e-02   +5.885867804431415e-01   +3.246650483267374e-01   +3.630494935197316e-01   +4.754249549514630e-01   +5.024735074213459e-01   +7.826124758028463e-01   +7.010866642066130e-01   +6.324706994196470e-01   +1.473481714513606e-01   +2.049539217864093e-01   -2.869465088640631e-02   +6.970786162566844e-01   +1.163833786028990e-01   +5.426240595313430e-01; +4.501529394403148e-01   +8.896692930227346e-02   +1.160906781645849e-01   +4.027362180778898e-01   +4.758821053725744e-01   +3.931082367624541e-01   +1.240747849073822e-01   +3.180956378219794e-01   +1.896123612177273e-01   +4.419854941912678e-01   -8.121473362556487e-02   +4.222039640667928e-01   +2.102635979676211e-01   +3.011999076209564e-01   -8.089711646438667e-02   +2.123763636269220e-02; +5.498821470118489e-01   +8.149973312854494e-02   +6.079056815964041e-01   +3.837542788102775e-01   +2.508159165432294e-01   +3.131678462364281e-01   +5.016835130349306e-01   +4.541081009316724e-01   +1.495489962231066e-01   +1.648611201175043e-01   +6.514650557750208e-01   +6.961342507148430e-01   +6.862655031746520e-01   +1.257837756250107e-01   +1.292281185554046e-01   +6.185745081107401e-01; +5.999488660534160e-01   +6.676850506172594e-01   +6.346326084613075e-01   +3.320892191595305e-01   +3.597250497981556e-01   +3.894130584721354e-01   +1.452612549368708e-02   +5.010123396962780e-01   +1.831803839175464e-01   +4.979334239516319e-01   -1.376469244274713e-02   +3.938114962949523e-01   +6.470775375258013e-01   +2.826429387169786e-01   +2.959948916214198e-01   +6.766264738480063e-02; +8.414913010628582e-01   +8.049173760138849e-01   +1.366198463921743e-01   +8.006684983598429e-01   +4.234771355553944e-01   +8.832286237297940e-01   +5.925697085597467e-01   +2.524903573362160e-02   +7.347124422992853e-01   +6.016946935365599e-01   -1.136111400345440e-01   +7.649703724288497e-01   +2.344619677887413e-01   +6.068797452185641e-01   +1.630545199170369e-01   +5.712166768768174e-01; +5.755152260780253e-01   +6.123298382443845e-01   +8.303589496577806e-01   +3.320451045838751e-01   +4.629053751964286e-01   +5.456860227003513e-01   +4.462877305594299e-01   +3.523812736394735e-01   +7.234707757132196e-02   +8.151113417608816e-02   +4.119518705583378e-01   +2.409746071036729e-01   +1.496377193106838e-01   +6.447279831606677e-01   +2.881729527265676e-01   +3.739650855134211e-01; +7.435123404292749e-01   +2.453698362572476e-01   +6.699738840064111e-01   +5.148844446856892e-01   -3.856871897969268e-02   +2.043712843576917e-01   +6.654462922316642e-01   +2.267980546901133e-01   +3.816565544571782e-01   +2.585364563300552e-01   +8.525051848999234e-01   +7.396727337822646e-01   +3.874529362645045e-01   +3.772210777211538e-01   +5.740947852603038e-01   +6.218035666737722e-01; +1.191626059622912e-01   +7.779481126408038e-01   +5.459724171782844e-01   +1.027471555393539e-01   +6.125562060740887e-01   +4.703452883606836e-01   +5.577307611970568e-01   +1.920792201417257e-01   +5.849043019215506e-01   +1.265505190815653e-01   +1.901704185884699e-01   +4.989434539961784e-01   +9.980704437323913e-02   +3.091619481083593e-01   +4.287762421509120e-01   +6.651426924308762e-02; +5.240657278503309e-01   +7.591439615073258e-01   +7.314694845583627e-01   +6.185917467079614e-01   +5.334190227715271e-01   +7.523883829298118e-01   +1.730378999609094e-01   +2.543807246825777e-01   +4.700291158712533e-01   +3.712466445149485e-02   +2.578191084743591e-01   +4.177456050247887e-01   +1.445101694082573e-03   +2.277149389535652e-01   +3.734686458928401e-01   +5.149869788919879e-01; +1.620395098973569e-01   +3.085452292932593e-01   +5.598700973210866e-02   +4.828067902378155e-01   +3.241433641331612e-01   -7.301139198724514e-02   +4.754074448253764e-01   +4.771896376903238e-01   +3.558688562808519e-01   +2.046001439392621e-01   +1.163819764642002e-01   +2.789977781995492e-01   +3.951821721284742e-01   +4.904354754417090e-01   +4.740715708111371e-01   +4.629921798192044e-01; +1.324345480715863e-01   +4.619492216475923e-01   +7.875978547040251e-02   +2.390575296622072e-01   +3.695386109215570e-01   +1.716263146737441e-01   +6.268410148411419e-02   +7.359599453469919e-01   +7.381411564180397e-01   +5.972149216430518e-01   +8.639827393025158e-01   +1.115294380394315e-01   +2.182154283604376e-01   +3.416173952038188e-01   +6.251096839740125e-01   +5.053654351962601e-01; -1.428587068386634e-01   +8.528911774054665e-01   +3.679199289984469e-01   -2.631303939467637e-02   +7.437214864060300e-01   +1.223432116367417e-01   +6.233377333528158e-01   +8.329438885433027e-01   +2.628124072466685e-01   +7.718694280818862e-01   +2.152165287083464e-01   -8.059815285391614e-02   +7.094813384820284e-01   +6.503920296115199e-01   +8.783723812587275e-01   -1.274241914458497e-02; +5.293750207209804e-02   +5.263295900947687e-01   +6.599004651915283e-01   +5.897758276425148e-01   +1.761371841951360e-01   +5.933838300290198e-01   +3.686772050305600e-01   +5.605629536490100e-01   +6.103702432233201e-01   +4.383754184198697e-01   +1.942392186646114e-02   +2.355837023525916e-02   +4.361523693664558e-02   +5.868305696443927e-01   +9.097334611020016e-01   +1.686739854527193e-01; +2.488052302015710e-01   +4.622405968924031e-01   +2.236383063476751e-01   +1.532221889447206e-01   -5.044030979096843e-02   +7.192464774693242e-01   +7.851489334152723e-01   +2.338322740692653e-01   +7.113975161452305e-01   -1.139074115635530e-01   +4.725521093812826e-01   +2.038308837234805e-01   +4.424880300811403e-01   +3.052468041522642e-01   +5.264286578058331e-01   +6.517520261762639e-01; +3.299701100731686e-02   +7.296002562326215e-01   +9.504082909850457e-02   +3.136704009654273e-01   +2.003512301001305e-01   +1.966192151582799e-01   +5.577265686256455e-01   +3.157763704049961e-01   +5.227505379877519e-02   +1.077560490919686e-01   +5.428022305881183e-02   +4.380586274751392e-01   +2.602877272927641e-01   +1.304578937057654e-02   +4.560494141707697e-01   +3.649829243763368e-01];
L2I_L1I_iGABA_netcon = [+2.183686437920894e-01   +4.246970085851488e-01   -2.207439956211901e-02   +2.658053742442233e-01   +3.618336698372397e-01   +2.980951185270427e-01   +2.394972704579093e-01   +1.695228212981845e-01; +3.703786109968945e-01   +4.691777050390599e-01   +7.154406833265872e-01   +7.133600873667068e-01   +6.134061270171982e-01   +4.615629444147187e-01   +6.892003154217686e-01   +7.013674309676756e-01; +5.428416144385722e-01   +8.937040872921393e-01   +7.228035160155342e-01   +8.685968650308004e-02   +6.266345019762518e-01   +3.182074522587178e-01   -1.006246469045734e-02   +7.042840242428180e-01; +2.612902806460766e-01   +1.019772822303055e-01   +3.493249405265222e-01   +6.792079404116387e-01   +2.453136832624197e-01   +2.110868542519676e-01   +7.199038196797456e-01   -3.171113812337414e-02; +3.141163072934766e-01   +2.842089566254099e-01   +3.706069013712618e-01   +5.395418786229638e-01   +7.719768500480710e-01   +7.104704962169235e-01   +7.249093335344370e-02   +5.873592759535344e-01; +3.963250423274178e-01   +3.127414403004699e-01   +6.425574548665695e-01   +8.001133823402684e-01   +7.730224595915918e-01   +4.789840652549976e-01   +1.899814467880525e-01   +8.796816912188241e-02; +2.447285281309308e-01   +4.716270294025568e-01   +1.440190534746943e-01   +4.656210821031325e-01   +2.487257321808154e-01   +6.313454736432417e-01   +6.859794240771120e-01   +2.855090815833503e-01; +3.910423667621549e-01   +1.736696134681330e-01   +3.921680215148348e-02   +4.994473277373023e-01   +8.797436916303265e-01   +8.577731417721361e-01   +2.585958503612517e-01   +3.700311794582422e-01; +5.562139889008665e-01   +3.340169228204991e-01   +2.245889200947305e-01   +2.056528962611011e-01   +5.402461484783566e-01   +2.324324608979435e-01   -1.411109328770349e-02   +6.608117200432339e-01; +2.617005098184119e-01   +7.418285414866620e-01   +1.992644929306376e-01   +4.105674098970186e-01   +9.147111569054169e-02   +7.201917044546406e-01   +5.850756939661829e-01   +4.098831156178342e-01; +3.372171634216006e-02   +5.799203889688204e-01   +1.819521163501127e-01   +6.160477137793074e-01   +3.361612746261035e-01   +1.905362032071728e-01   +3.461455577357309e-01   +7.429387389230335e-01; +7.111234427103515e-01   -1.000540114973748e-01   +4.580485167642206e-01   +1.643125948108353e-01   +7.879475519182152e-01   -3.951526235298722e-02   -9.923745837578954e-02   +3.307312539536216e-01; +4.726193657306288e-01   +4.444012597059416e-01   -2.647063552106010e-02   +3.166334322801683e-01   +8.042517930487870e-01   +6.527690803692083e-01   +1.078157407465249e-01   +3.108629797691867e-02; +1.689421332056920e-01   +5.225072644174589e-01   +3.931598850855407e-01   +9.714334018617693e-02   +3.239118962723934e-01   +1.162894639085363e-01   -8.035744928059543e-02   +4.684579000814650e-01; +7.544462587032932e-02   +1.121133218080866e-01   +8.031527804395437e-01   +5.674210383702452e-01   +1.870695497976261e-01   +1.088290739540477e-01   +3.488387617379856e-01   -6.462703463848653e-02; +9.043105568579626e-02   +3.198155796887127e-01   +3.752478281867045e-01   +1.013241710468206e-01   +2.614087083126793e-01   +6.846571598668494e-01   +5.718992746702477e-01   +1.021469641318186e-01];
L1I_L2I_iGABA_netcon = [+4.933464033491265e-01   +6.468402481887607e-01   +8.042697994896021e-01   -3.485391801459944e-02   +6.707223612013901e-01   +6.775526437119855e-01   +6.782711828482451e-01   +4.330020244577633e-01   +6.536643951022300e-01   +9.496826258664967e-02   +3.961495918641116e-01   +5.910785877350966e-01   +5.269215345764555e-01   +4.582267876579059e-01   +7.665417099797458e-01   +6.317091804256830e-01; +3.989074781819338e-02   +6.414675031060997e-01   +2.693753323790308e-01   +9.427909162155897e-01   +3.644172951320050e-01   +3.907098349900495e-03   +6.381301190579075e-01   +8.937951021272798e-01   +5.745500114368167e-01   +1.271772592564583e-01   +7.013650488501486e-01   +4.983121914440664e-01   +8.026659125418988e-02   +3.880445075570871e-01   +1.961954768168178e-01   +5.978341366722104e-01; +5.496923694234891e-01   +2.892227309841804e-01   +3.875647061709655e-01   +1.969541803080632e-01   +1.711212035683674e-01   +2.971668219656959e-01   +1.655095399050619e-01   +5.969466027956236e-01   +1.233602630807355e-01   +3.912772912630929e-01   +8.421955120348145e-01   -9.946476047000928e-02   +2.739877552911194e-01   +2.064887425190203e-01   +7.155765260701007e-01   +5.882098309336060e-01; +4.903260039714628e-01   +2.973713639423933e-01   +2.105779531861489e-01   +1.749167635073707e-01   +8.760036686716030e-01   +1.389320841216805e-01   +3.965705595997652e-01   +8.195081086453522e-01   +6.317732592576140e-01   +1.518923455875800e-01   +1.047481176801403e-01   -3.946407412099862e-02   +8.130166867478990e-01   +6.026392843697397e-01   +4.345040973969048e-01   +4.190826845054193e-01; +7.865170610745596e-02   +7.376071738099498e-01   +5.955097531745477e-01   +5.054153655017681e-01   +6.766748316572148e-01   +3.157616389863548e-01   +2.378475940322045e-01   +6.217225306514809e-01   +3.719774529081785e-01   +7.360717459301833e-01   +7.075118503051879e-01   +6.021818431676822e-01   +3.704884734897016e-01   +2.957962124356144e-01   +6.926568139589293e-01   +3.782018505186288e-01; +7.297908768492647e-01   +3.931347629992250e-01   +7.718549183116284e-01   +7.816652317398660e-01   +6.993865264378695e-01   +4.349075398147716e-01   +4.445056782590565e-01   +8.135459807619323e-01   +7.270500142947363e-01   +5.634169538526011e-02   +7.225328988545471e-03   +9.093073216912193e-02   +3.635287670196111e-01   +3.439196500406285e-01   +7.019693388007925e-01   +1.688477755367224e-01; +6.271242260443770e-02   +7.027750811280427e-01   +6.483710058668846e-01   +1.715902700447260e-01   +6.456995882968305e-01   +6.947024398761660e-01   +5.682816814579510e-02   +3.151693865910531e-01   +3.916504441795537e-01   +2.027059285234339e-01   +4.482561066094030e-01   +3.707842354060725e-01   +7.411091663069336e-01   -5.263666196547542e-02   +2.243143422439108e-01   +5.859459994105913e-01; +4.640114341855857e-02   +8.822374435069427e-02   +7.226845995969959e-01   +2.009425375855685e-01   +3.543829850508167e-01   +1.392126462431096e-01   +3.624280869311006e-01   +2.602301552314988e-01   +2.792798762250062e-01   +6.439965053693847e-01   +5.003925159816603e-01   +5.418467351598588e-01   +5.358227502683975e-01   +2.444126509538726e-01   +3.010425258941907e-02   +6.906151194953836e-01];
L2E_L1E_iAMPA_netcon = [+6.738735914330026e-01   +1.592560438611676e-02   +3.355944942184703e-01   +5.024788044313185e-01   +4.216670614240142e-01   +1.237773902542992e-01   +7.214067461020675e-01   +7.518362402939377e-03; +1.069366110788925e-01   +5.465555346099860e-01   -9.798776577591357e-02   +3.754186248758608e-01   +2.024618598814012e-02   +3.098478200396199e-01   +2.576745678997786e-01   +1.925107947914007e-01; +8.204859976554911e-01   +6.286635732368200e-01   +4.040803051377939e-01   +2.395681588795812e-01   +8.006529068413653e-01   +5.089252226522497e-01   +5.159596145117853e-01   +6.103878618515567e-01; +3.035998736097183e-01   +2.307918827261498e-01   +2.154104671562152e-01   +2.128090880173512e-01   +4.341465253198755e-01   +7.093993449880523e-01   +3.309646629426215e-01   +2.042074166949463e-01; +7.764459387518786e-01   -6.089925691725529e-02   +4.479082686212724e-01   +3.802607355131271e-01   +6.222314757862878e-01   -1.064465137434256e-02   -9.996487113500388e-03   +2.432611922680332e-01; +1.570551969574468e-01   +5.682590221218853e-01   +8.092958962351736e-02   +2.296848056952663e-01   +6.055855205812453e-01   +3.459679658669795e-01   +7.262505957030907e-01   +4.625179344784105e-01; +1.489056087787690e-01   +4.149491621286926e-01   +6.905117839250285e-01   +5.053418012298543e-02   +2.367242269226211e-01   -2.046609975192616e-02   +3.560275890049001e-01   +4.780642433861682e-01; +7.428073810633586e-01   +1.376847068979444e-01   +3.437067170367258e-01   +8.402693764832412e-01   +5.555465036996523e-01   +2.933254864817577e-01   +4.385210360976260e-01   +4.166539078704782e-01; +5.755910885395787e-01   +1.205319026641382e-01   +3.628805842686184e-01   +6.001432643642844e-01   +5.253070136318621e-01   +5.459279043641445e-01   -7.045133673577911e-02   +4.711166191557357e-01; +4.303731498743040e-01   +4.206068935248992e-01   +1.060912211031251e-01   +1.388945085850074e-01   +4.542691600993606e-01   +9.495942835642526e-02   +4.750017965010631e-01   +4.285914436824595e-01; +1.600768963585109e-01   +7.304010600090431e-01   +3.343770298527673e-01   +4.875395381456893e-01   +6.433463769477432e-01   +3.557844650295436e-01   +4.926784230200766e-01   +7.676217099829646e-01; +3.150971758367938e-02   +5.071582357313310e-01   +6.854066243081187e-01   +1.535302581197346e-01   +7.489202819445389e-01   +4.550434849967482e-01   +4.548830613874472e-01   +8.347189677180586e-02; +8.847627109557974e-01   +5.556320371856706e-01   +1.484643374524221e-01   +4.681402448558742e-02   +2.579185850275418e-01   +4.497875075918925e-01   +6.962490504558384e-01   +1.412301971539295e-01; +1.903436345248655e-01   -1.768678731253115e-02   +8.202662302895311e-01   +1.507967040136021e-01   +9.061544944695932e-01   +7.975720178998194e-01   +6.418930108955059e-01   +3.214365428381109e-01; +6.819240888937982e-01   +4.949451598677570e-01   +2.692344139586289e-01   +4.441756552754111e-01   +2.844201395080720e-01   +5.675213400728416e-01   +5.241521013311048e-02   +1.820669030420252e-01; +7.169792578615333e-01   +5.727406567770851e-01   +6.925093963376195e-01   +2.101150770589022e-01   +1.418960799466493e-01   -1.633780926224514e-02   +4.678656234944452e-01   +5.033851978940161e-01];
L1E_L2E_iAMPA_netcon = [+4.185834243000962e-01   +4.631176922242911e-01   +5.420029488430315e-01   +5.325186231713257e-01   +7.058028512249920e-01   +4.476737189608876e-02   +5.854965289253016e-01   +1.309378441815889e-01   +7.796336083116399e-01   +2.376639172570079e-01   +8.015097597384890e-01   +5.546206394780243e-01   +6.981083494624372e-01   +4.269583733731472e-03   +4.525876137058274e-01   +2.649223012109500e-01; +6.076292570933574e-01   +4.700059681742632e-01   +2.963585231991351e-01   -7.302079502605754e-02   +8.028824533791370e-01   +3.839508065821362e-01   -1.104445764652150e-01   +1.515902395113312e-01   +2.307992039750259e-01   +8.853377390203704e-02   +8.814968590233703e-01   +2.024350637838412e-01   +5.897104411400819e-01   +2.132148059444303e-01   +4.683199327560290e-01   +5.933751445798894e-01; +4.760895130804014e-01   -6.024517942538408e-02   +3.907398199569947e-02   -1.088534786512158e-01   +1.701513604179977e-01   +5.562936148498918e-02   +3.673390079157846e-01   +3.027315262754093e-02   +4.123234715416124e-01   +5.526557530959099e-01   +8.317719872277564e-01   +7.740694550287679e-01   +7.673040579939114e-01   +7.226871800453775e-01   +2.417809210261312e-01   +4.131778632719064e-01; +1.438331279518244e-01   +6.387859621963118e-01   +3.350863456865315e-01   +4.255446294742701e-01   +6.368605875076425e-01   +5.536336381250478e-01   -3.965209704675568e-02   +4.523814566685708e-01   +4.589513935342505e-01   +3.811389520025092e-01   +5.484216504351410e-01   +8.790075562909849e-01   +1.607869428339707e-01   +5.551657972952374e-01   +8.833869131951797e-01   +4.325418735372786e-01; +4.165423004326865e-01   -1.067128986813132e-02   +6.960628594599094e-01   +1.616533029697200e-01   +1.546140252215298e-01   +1.797194614798484e-01   +4.092295173812375e-01   +2.828994010121788e-01   +1.013755943061518e-01   +5.038170825002325e-01   +5.160046032085661e-01   +8.538408387726345e-01   +2.078039040186195e-01   +6.198334281900371e-01   +3.797884486387804e-01   +3.509188965730360e-01; +7.642118128571543e-01   +1.285892778767641e-01   +3.703481887727461e-01   +6.490181226379615e-02   +5.106743480590508e-01   +1.660321009203776e-01   +4.884890024260958e-01   +2.973199656140834e-01   +8.305435620902887e-01   +7.630116784615451e-01   +5.412157553601981e-01   +1.760555997700715e-01   +7.332596269405063e-01   +3.274869243598672e-01   +1.495154812605611e-01   +2.470474109133020e-01; +3.041971826530678e-01   +5.662729006709628e-01   +2.084287404293716e-01   +2.906219565415594e-01   +4.637313645459778e-01   +8.317180042334000e-01   +6.608159941255611e-01   +4.892630386849890e-01   +4.182850379985082e-01   +8.519591538075935e-01   +2.251739962265376e-01   -2.182341541703861e-02   +2.612963817171712e-01   +5.892323790574397e-01   +6.195468194100049e-01   +7.036626222407154e-01; +4.624504279087142e-01   +3.487473024188409e-01   +6.492758526975068e-01   +3.091197018882533e-01   +5.046351229742413e-01   +2.148711725721300e-01   +2.593369491982535e-02   +6.628304160766016e-01   +2.417701467647414e-01   +1.702460290862704e-01   -7.159932818662237e-02   +1.188029330762673e-01   +1.227561487315456e-01   +6.640782056268120e-01   +4.011782995443346e-01   +4.089459677310131e-01];
L2I_L2E_iAMPA_netcon = [+5.600621921647426e-01   +2.213509100742674e-01   +4.271596478669441e-01   +4.178012161926947e-01   +7.462589988387562e-01   +1.362190735942900e-01   +8.448588253280727e-01   +8.936054369008705e-01; +4.117688041661748e-01   +2.427051608739421e-01   +3.991009130653564e-01   +8.539488813577553e-01   +4.334471323900693e-01   +5.625830308363881e-01   +1.917140869837560e-01   +4.861816278441046e-01; +6.164700763147936e-02   +2.227162131008449e-01   +4.614632350030483e-01   +1.513754598019846e-01   +3.628608389465036e-01   +3.951488621197443e-01   +7.361643752483424e-03   +7.439061865265520e-01; +4.159618951254491e-01   +3.994990348254387e-01   +3.603626534510358e-02   +6.155271724293647e-01   +1.576264567622651e-02   +5.789828285898011e-01   +4.844270327626189e-01   +6.731318494452928e-01; +2.729941259446338e-01   +6.481463249668322e-01   +6.530822550070220e-01   +3.357104821875254e-01   +8.645111811721572e-01   +7.673818436140621e-01   +3.863644478952799e-01   +2.674902546661276e-01; +7.953083657900515e-01   +6.250224270761033e-01   +1.866871921277270e-01   +2.174558814816594e-01   +6.219180066650036e-01   +8.134734694192638e-01   +4.549571599407823e-01   +2.184777945333089e-01; +3.898742120635258e-01   +1.212700410016619e-01   +6.477351165482165e-01   +1.685843347616038e-01   +9.109621823926419e-01   +3.788425367528732e-01   +2.277676453619277e-01   +2.574441754117665e-01; +4.983573880980039e-01   +7.678535967572776e-01   +7.264688334378978e-01   +3.079369689640420e-01   +5.190562006300556e-01   +4.552575512115616e-01   +5.893144599748277e-01   +4.160586255553769e-01];
L2E_L2I_iGABA_netcon = [+2.582683435330838e-01   +3.629823164589272e-01   +6.201830994722968e-01   +3.340585102333324e-01   +2.942646486232477e-01   +4.813289002311520e-01   +3.646509514803991e-01   +3.349155600736430e-01; +3.180541060252620e-01   +1.496796221017713e-01   +3.964076410755242e-01   +5.111523675402319e-01   +5.808713770127915e-01   +3.788365687207362e-01   +7.187169388654274e-01   +6.804663193084702e-01; +7.326911736067444e-01   -4.018001939714680e-02   +1.146891196360392e-01   +3.281585706054073e-01   +1.569169750943709e-01   +7.249436966051434e-01   +2.330621127609782e-01   +4.779038480828121e-01; +5.416149082058506e-01   +7.341419900919830e-01   +2.618351420101762e-01   +4.928204488578791e-01   +1.468778881734827e-01   +8.999200882457464e-01   +2.700209165152365e-01   +2.348735351941935e-01; +1.145323593312660e-02   +5.332690169001357e-01   +6.404330798825566e-01   -3.132944349580155e-02   +7.337309066916651e-01   +6.244739726346128e-01   +3.804833808657462e-02   +5.644483046252224e-01; +4.971229869494264e-01   +4.182653032360084e-01   +1.997584778330324e-01   +6.836418790874361e-01   +3.697012602893066e-01   +2.372784829002447e-02   -2.751156995844527e-02   +2.049998699376646e-01; +6.940838211507716e-01   +6.515798876564360e-01   +1.596259486073198e-01   +5.688353201793804e-01   +3.736930640645705e-01   +4.093958790889429e-01   +2.287556425811340e-01   +3.714884370227647e-01; +5.629584394851931e-01   +3.334153420931089e-01   +4.841218798607048e-01   +6.460788369833259e-01   +8.423214960365060e-01   +8.327035938139700e-01   +5.913845250007556e-01   +4.859331041057215e-01];
L3E_L2E_iAMPA_netcon = [+2.585431205000577e-01   +2.712056484759158e-01   +6.154744665010847e-01   +3.518444113279377e-01   +1.787635150391123e-01   +8.700939179077505e-01   +2.488347367220416e-01   +7.215341516024770e-01   +6.101357217352108e-01   +3.992268635396428e-01   +2.511184106935688e-01   +7.963409550399557e-01; +7.048956630994794e-01   +5.333418004626622e-01   -9.324178267324179e-03   -9.501831556375215e-02   +5.512236587168181e-01   +1.777936785549465e-02   +8.051214913677700e-01   +2.693011269782270e-01   +4.996820098321847e-01   +1.966082362392945e-01   +1.375770902027920e-01   +6.972669449942355e-01; +3.816054581180737e-01   +1.765573075692231e-01   +6.407216740072587e-01   +7.717964695637438e-01   +7.717324256074485e-01   +9.034917261607929e-01   +4.278730666183984e-01   +6.804419742400913e-01   +1.484435006582910e-01   +2.829950757741363e-01   +5.629311413201518e-01   +2.647700296389227e-01; +5.460959468229450e-01   +4.922489339547739e-01   +6.277441260236665e-01   +7.354613839440681e-01   +4.257783211050811e-01   +7.026252470692969e-01   +5.957929771936199e-01   +4.468401250289101e-01   +1.963215653894534e-01   +1.855800595758892e-01   +6.583130891693586e-01   +4.002304982628198e-01; +1.532890127788452e-01   +8.291976630465877e-01   +7.382134053848510e-01   +4.203602717825240e-02   +3.418992520251799e-01   +4.867357597636078e-01   +4.967868324548108e-01   +6.306382434143862e-01   +4.198543951120693e-01   +7.258009086608384e-02   +3.948738455057169e-01   +5.280254053011171e-01; +6.561138818653454e-01   +5.400375230681735e-01   +2.090323444128488e-01   +1.485957808263223e-01   +6.473433877294137e-01   +4.996539016739640e-01   +6.570230605191529e-01   +4.953271496231030e-01   +2.226318398750164e-01   +5.457757553919926e-01   +4.905729943503634e-03   +2.296975492558976e-01; +8.480724206374095e-01   +6.316126360926453e-01   +3.965847396578330e-02   +7.964143152085185e-02   +2.635181955444564e-01   +1.430219712405864e-01   +2.857513810364847e-01   +6.236568985839884e-01   +6.703482981085425e-01   +1.678745749581860e-01   +1.225577848276313e-01   +5.556688250742168e-01; +5.323197801020895e-01   +5.714524688928789e-01   +3.450276295932656e-01   +1.272601236471113e-02   +4.730199843788811e-01   +1.354194759117021e-02   +1.522073062768109e-01   +3.017075879296295e-01   +4.983549119117311e-01   +3.819547585020708e-01   -1.346241807470135e-02   +4.788433777515091e-01];
L3I_L2I_iGABA_netcon = [+6.662051298909892e-01   +1.479589720546877e-01   +6.250552255289897e-01   +4.526820179795935e-01   +4.959157848682234e-01   +2.639860200005306e-01   +5.273067525563535e-01   -1.252843325646183e-02   -2.678251678062724e-02   +6.043991695137148e-01   -5.780868164512724e-02   +3.463357944459742e-01; +7.333021167556433e-01   +5.846638041632303e-01   +6.885825238781471e-01   +4.967817897095368e-01   +4.191698038683515e-01   +3.126192249298764e-01   +2.291695459720629e-01   +1.521492926730150e-01   +3.151387410905760e-01   +6.425176779263571e-01   +5.847337558768905e-01   +4.651590967368226e-01; -1.124877528478195e-02   +4.199682493419312e-01   +6.558951143528548e-02   +2.664924548952236e-01   +3.358484846046522e-01   +2.582319060126351e-03   +5.604719343351623e-01   +2.778214746579749e-01   +1.550168398720860e-01   +6.813375985725518e-01   +6.523465851275987e-01   +6.916523586612480e-01; +5.225860756052196e-01   +7.587817465130803e-01   +8.270979249525636e-01   +2.523708543677176e-01   +6.258337536264974e-01   +3.267254321809456e-01   -1.037747106456977e-01   +2.554766401182570e-01   +2.180495569670170e-01   +7.512328151724544e-02   +6.052355319224223e-01   +4.732360123120161e-01; +7.486459443102994e-01   +4.082339544182906e-01   +5.354919050071344e-01   +5.267930898264647e-01   +5.322385480520460e-01   +2.979792335659613e-01   +2.960688488557215e-01   +2.362323678160601e-01   +1.670522709807586e-01   +2.923458411618726e-01   +7.086128384331197e-02   -1.647178289477794e-02; +6.891328038624617e-01   +5.688461916590208e-01   +2.406653725584657e-01   +1.512178509864436e-01   +7.217589673051001e-01   +3.687739093835549e-01   +2.128633596262147e-01   +6.006227614262150e-01   +6.703594724975804e-01   +5.961010700845707e-01   +4.598554608975701e-01   +4.476862329582050e-01; +2.638733420401533e-01   +5.539832867792227e-01   +7.155227104447568e-01   -7.664601224465697e-02   +5.742412139192005e-01   +5.734663777865330e-01   +2.806130436617840e-01   +4.416081984762060e-01   +2.995495050112754e-01   +1.791285653023296e-01   +2.746758359803272e-01   +7.439619926471467e-01; +4.417898035433842e-01   -2.853093122744163e-02   +6.084910592981694e-01   +5.445568085633529e-01   +2.182020988289890e-01   +2.887683937096974e-01   +6.027777397771023e-01   +2.292370914228243e-01   +1.778914871353815e-01   +2.637718756859802e-01   +7.715870466384082e-02   +5.269417547373781e-01];
L2E_L3E_iAMPA_netcon = [+1.929194747707369e-01   +5.552420107739097e-01   +5.856910662647639e-01   +4.932174229464173e-01   +7.176585401059369e-01   +7.573781901569424e-01   +3.332911696117963e-01   +2.193009924329855e-01; +1.003680370531409e-01   +4.924169947816933e-01   +2.084456729823798e-01   +1.347777834252048e-01   +5.750861672156130e-01   +6.119856795178468e-01   +3.635274652461991e-01   +4.851929693685429e-01; +2.471663311630362e-01   +4.860046910610916e-01   +3.296420872337066e-01   +9.191556157846559e-01   +3.430345282782587e-01   +8.353125368424386e-01   -4.342044080001861e-02   -1.369479437031638e-02; +2.111193019462030e-01   +2.213368947104056e-01   +2.995983736153638e-01   +4.931911345349139e-01   +3.056948553361893e-01   +5.864378318243103e-01   +5.174060125077821e-01   +3.078390569748791e-01; -9.208442744170729e-02   -5.806533516447436e-02   +2.787282137198175e-01   -5.471509755894277e-03   +5.889411388050841e-01   +5.784651173097775e-01   +1.299076990303573e-01   +5.984597132591508e-02; +3.187438115386064e-01   +2.682116814140754e-01   +2.809691044820123e-01   +8.816389503242744e-01   +3.656304878307065e-01   -9.034782927251145e-02   +4.687899910545577e-01   +1.334897712660290e-01; +1.710796215201171e-02   +1.879016782627703e-01   +4.502999419712599e-01   +2.090242051936884e-01   +4.233088677886073e-01   +7.959874005866293e-01   +1.271142225269325e-01   +7.401843785485727e-01; +2.014681107715104e-01   +7.043877818591904e-01   +6.284338056332949e-01   +3.015091637807004e-01   +4.660196723943241e-01   +3.742988458726165e-02   +4.277325609321990e-01   +5.361350046519371e-01; -1.215266602282554e-01   +3.569083374690391e-01   +4.331115300154179e-01   +7.381845220979990e-01   +5.793460075306927e-01   +4.124586349064172e-01   +2.478033381759748e-01   +4.471969337533706e-01; +5.677192718184677e-01   +1.414666085113243e-01   +1.399917704607301e-01   +5.141266106849882e-01   +6.262062117668084e-01   +3.296263796311824e-01   +6.249635361633221e-01   +2.079446386700830e-01; +8.465590199460840e-01   +6.412644557444780e-01   +5.146999315335439e-01   +5.012603413822416e-01   +1.465052857300654e-01   +3.851358762945024e-01   +9.392389257075001e-01   +2.525368143419230e-01; +9.231581258755885e-01   +3.760589093815454e-01   +1.351856905172896e-01   +5.292809335334596e-01   +5.555463685021677e-01   +5.169933060664378e-01   +6.785719172372687e-01   +1.599672536771737e-01];
L2I_L3I_iGABA_netcon = [+9.314336403791621e-01   -1.232905072302892e-01   +3.924680477225795e-01   -3.853169763374736e-02   +4.085283124348958e-01   +4.955146066211379e-01   +1.092342107227176e-01   +4.821644781944533e-01; +6.533733439744539e-01   +4.226357379181185e-01   +1.871511758617605e-01   +5.346045419721879e-01   +2.207551391333863e-01   +3.424286196017953e-01   +5.996477044833792e-01   +4.098786401004560e-01; +4.302800918945268e-01   +8.148684942190284e-01   +7.952479074183562e-01   +7.916464446289396e-01   +4.381872454497408e-01   +9.226716307991555e-02   +3.558544379060532e-01   +3.893196825155383e-01; +2.109693767426488e-01   +5.059354459289607e-01   +4.874801463243680e-01   +3.447915295717406e-01   +1.834547751688914e-01   +6.208060938379041e-01   +3.959721429409124e-01   -4.746972229878565e-02; +7.899685077291422e-01   +7.996305990535371e-01   +1.043331189455290e-01   +8.335462500786673e-01   +2.979450480889373e-01   +3.253641906450369e-01   +2.820917572557582e-01   +3.687018608467468e-01; +9.078564316706575e-01   +8.001533521514154e-01   +6.633078502296812e-01   +2.311601816031854e-01   +8.004531663794709e-01   +1.828962847561933e-01   +1.638321806364400e-01   +5.746136383938210e-01; +4.522178529021390e-01   +3.818619422345289e-01   +4.261662722574141e-01   +8.222260746413802e-01   +4.790605581079346e-01   +7.488806278389473e-01   +2.689960231547583e-02   +3.141315978621182e-01; +3.732759489199047e-01   +5.809549860848873e-01   +5.700376863276724e-01   +5.953744096369406e-02   +6.510602458396577e-01   +2.384762308452548e-01   +4.707718853306170e-01   +7.602573150346319e-02; +5.704312360924729e-01   +1.701039442022395e-01   +2.558295863099707e-01   +3.665668348958956e-01   +5.811876415697168e-01   +4.092525956634689e-01   +4.193891179414369e-01   +1.230718019258198e-01; +7.551143944325268e-01   +2.010144656017559e-01   +1.377969508273403e-01   +3.450150684779770e-01   +2.072155819034423e-01   +2.148904045142148e-01   +5.064665590090838e-01   -8.528725262937555e-02; +2.111562052274779e-01   +2.582517426639731e-01   +2.940381641365905e-01   +3.379601659388441e-01   +2.031413806977089e-01   +2.997942593775034e-01   -6.586406584601801e-02   +2.050565786836080e-01; +5.919918841613537e-01   +5.116748801145590e-01   +3.921446460072074e-01   +5.302889659544640e-01   +5.340018621515912e-01   +2.106639255681751e-01   +3.490648011988842e-01   +2.655673695624062e-01];
L3I_L3E_iAMPA_netcon = [+2.069323291677029e-01   +7.503646634209430e-01   +1.226063486342732e-01   +5.995759183734035e-01   +2.489143246439138e-01   +4.940278949695114e-01   -3.510406883503021e-02   +4.089302845583339e-01   +1.659976196782549e-01   +2.662427955386645e-01   +5.027799351120007e-01   +3.410339797277819e-01; +5.526812495940681e-01   +5.355923362511539e-01   +4.403145203943016e-01   +5.081163020444469e-02   +3.576413963024402e-01   +3.586347961405698e-01   +9.973412469121112e-02   +2.581273443598811e-01   +8.071800254486736e-01   +1.486075958087065e-01   +6.364307724328506e-02   +5.986019142944418e-01; +2.645347246744101e-01   +6.074864472060806e-03   +2.049493449452315e-01   +2.441157675917069e-01   +6.323826036975702e-02   +8.209548982609267e-01   +2.763953046680627e-01   +5.100634603271859e-01   +3.415772646079584e-01   +1.975206390155487e-01   +3.592805083490583e-01   +5.735391661586948e-01; -1.183372736578002e-01   +3.127050651864302e-02   +2.551175898994484e-01   +3.800658813841563e-01   +5.939042264845129e-01   +3.590320704129252e-01   +3.006744541088674e-01   +4.188038899472110e-01   -1.989457480934133e-02   +1.407413842512516e-01   +6.983402125802450e-02   +4.318899410415867e-01; +9.645288722579375e-02   +5.849653368471935e-01   +2.573732734517659e-01   +3.187860315623343e-01   +3.486219458344676e-01   +4.551474061080041e-01   +2.503277630583201e-01   +4.708526289592458e-01   +2.512726009734142e-01   +2.812613609747224e-01   +1.541495745626102e-01   +5.147144740370094e-01; +8.941843135589542e-01   +4.946245596840370e-01   +5.044061453010775e-01   +1.853771780747427e-01   +2.627611154311842e-01   +1.889447662087553e-01   +6.247826748009668e-01   +7.602778504414127e-01   +5.303544580828717e-01   +2.103834240971605e-01   +8.848824660531945e-01   +8.575548473989707e-01; +2.770466746145917e-01   +5.630812762888212e-01   +1.886046726944665e-01   +2.830792064754124e-01   +3.330077132499827e-01   +3.814940114949994e-02   +1.342370825185807e-01   +1.179263378707588e-01   +4.700986774943929e-01   +4.619448049195281e-01   +7.789801115122336e-02   +7.007680962746705e-01; +2.503385078453640e-01   +7.359835141477649e-01   +7.902381069225407e-01   +3.502535972115998e-01   +5.948400824858963e-01   +1.390658693543939e-01   +2.550054454450644e-01   +8.815744318298327e-02   +3.816330668419991e-01   +4.172521875673875e-01   +3.129459399969427e-01   +2.287396912001578e-01; +2.965507892641385e-01   -2.564239719862912e-02   +5.207298327189994e-01   +8.727538098581381e-01   +4.546727962102820e-01   +5.056859864836081e-01   +1.198687839604207e-01   +4.791113963398451e-01   +1.028760028102942e-01   +5.651583128628346e-01   +4.271340242780048e-01   +1.411733941337490e-01; +2.039542834607712e-01   +3.353575188880221e-03   +6.088427005574021e-01   +8.316508129807266e-01   +2.211370145609549e-01   +6.755812305279877e-01   +6.649022636264104e-01   +2.864473402867608e-01   +3.476048104379610e-01   +4.151433824764632e-01   +7.556538411168543e-01   +4.560923043096440e-01; +3.003844282855854e-01   +3.823051379101292e-01   +6.813266450176516e-01   +5.143062059038570e-01   +4.250592766624167e-01   +3.032382615112227e-01   +6.030197784507026e-01   +6.406558851942186e-01   +3.143945987394377e-01   +3.026238139940439e-01   +2.283449120089317e-01   +5.932362297956655e-01; +1.898288920361558e-01   +7.789979637915589e-01   +4.438327677013164e-01   +2.986222961977315e-01   +5.798479702636514e-01   +2.294711194890406e-01   +4.403913952185886e-01   +6.296199949282797e-01   +3.702216205596662e-01   +5.419721272009886e-01   +5.050044603059560e-02   +5.875667042166186e-01];
L3E_L3I_iGABA_netcon = [+7.343026668090005e-01   +7.013177861048577e-01   +5.798094941664999e-01   +6.057736576447338e-01   +3.544950771888764e-01   +4.995589015040929e-01   +5.902118881404375e-01   +2.010053229248956e-01   -2.160693420375603e-02   +6.603592811274434e-01   +8.804693239883439e-01   +4.595315720665095e-01; -6.782689413603504e-02   +5.151195165651490e-01   +7.078173541829601e-01   +2.341495494575046e-01   +2.030060792530458e-01   +5.159164768032792e-01   +4.762297704536337e-01   +3.378183400318204e-01   +8.136405711875817e-01   +1.741917911396780e-01   +3.864789475010973e-01   +3.601295560200481e-01; +6.341998897815184e-01   +7.961604751589225e-01   +5.987192967982681e-02   +5.729171112227097e-02   +3.660868504861162e-02   +5.411721579539410e-01   +4.883306857985804e-01   +1.763783903851340e-01   +6.514832435793488e-01   +5.300646324194698e-01   +1.228835675761237e-01   +1.348650736006170e-01; +2.741080474594586e-01   -8.287679157925401e-02   +2.230813445500068e-01   +7.806645802840296e-01   +3.271672013481196e-01   +3.673453897182578e-01   +5.676333738188347e-01   +7.826259932764668e-01   +2.195220998504902e-01   +2.347264368890869e-01   +2.289201061327736e-01   +5.574776050366572e-01; +6.620372586147475e-01   +9.089519353520498e-02   +4.411796938080075e-01   +2.147215314019986e-02   +6.512280347532992e-01   -9.755155747169263e-02   +7.324348711616785e-01   +4.053389129764373e-01   +1.178861301999692e-01   +8.468543954450738e-02   +4.338535083913051e-01   +1.697922515281758e-01; +1.142109649355825e-01   +5.910602075454778e-01   +3.642936111132733e-01   +1.891582583212191e-01   +3.818929150183741e-01   +3.177955989855380e-01   +4.395377154481777e-01   +3.589485047564182e-01   +1.543355014424229e-01   +2.672796449752262e-01   +2.952703782548766e-01   +2.739399618784901e-01; +3.386795349719247e-01   +4.286155305274879e-01   +8.202940035766720e-01   +2.393797087573176e-01   +2.754350334975079e-01   +2.615545176080613e-01   +2.052104284077347e-01   +2.305401166597688e-01   +6.449799242183073e-02   +1.229939689209085e-01   +5.623138848468848e-01   +1.987444191526066e-01; +7.283581397390547e-01   +4.332796292860118e-01   +6.364622984755003e-01   +1.917651207354263e-01   -7.517248330956516e-03   +1.653933174003849e-01   +4.255037976275970e-01   +5.145305203162596e-01   +8.559781761141242e-01   +7.736828877289776e-01   +3.749488371683821e-01   +8.343781767547330e-02; +4.589205283419621e-01   +2.621143446785549e-01   +2.830816695991443e-01   +3.382473530959712e-01   +6.262631339021181e-01   +3.279450688300246e-01   +4.448831828946754e-02   +6.053792575918412e-01   +9.040208490403472e-01   +3.871979072583111e-01   +9.920906938440403e-02   -2.478049823528325e-03; +6.548000968356071e-01   +4.642772232806204e-01   -3.964819179187501e-02   +5.775963385346711e-01   +5.404312404772436e-01   +3.218734029103477e-01   -1.156125117605337e-02   +1.469435955067053e-01   +4.117660578588452e-01   +9.182648105153519e-01   +3.491990797866907e-01   +1.545991916853426e-01; -8.343854743813850e-02   +3.930423770099021e-01   +6.674476929477604e-01   +1.593884084774432e-01   +7.791740625423107e-01   +5.632919709142270e-01   +4.021907016913944e-01   +7.039304964513372e-01   +5.247146533541069e-01   +1.564710014367195e-01   +1.694242918802207e-01   -1.777602957032268e-02; +1.732232840151842e-01   +2.796317773533490e-01   +4.438530323487456e-01   +6.250241504935448e-01   +5.179008855700600e-01   +6.152452950695491e-01   +8.926663082828454e-02   +4.027975373749478e-01   +7.753871711177901e-02   +6.298309382420638e-01   +4.016150081150009e-01   +4.685801318454574e-01];
L2E_Input1_iAMPA_netcon = [+3.079319627345073e-01   +6.199835508944048e-01   +3.532104677562654e-01   +1.124614942727227e-01   +3.811466514987141e-01   +7.415124449380214e-01   +5.055731409526987e-01   +4.207322113108809e-01];
L2I_Input2_iAMPA_netcon = [+5.126012981164285e-01   +1.374952999822793e-01   +5.906069640538341e-01   +4.566350895683077e-01   +1.059449593075116e-01   +2.607974570601643e-01   +4.514517347016689e-01   +1.706733955644599e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.6*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.8*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.8*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.8*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.6*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.8*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.8*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.8*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
