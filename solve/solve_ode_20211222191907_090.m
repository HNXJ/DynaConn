function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-3.381038042270582e-01   +6.914777898325885e-01   +5.485032999386199e-01   -3.565064801327393e-01   +2.378554003515726e-01   +3.852620645916665e-02   +6.849249004491065e-02   -8.835645581857470e-01   -1.167236238980537e-01   +7.220404684239465e-02   +8.785492553799308e-01   +2.992393476494834e-02   +6.428814773859396e-01   -4.268899024205264e-02   +2.354288177150503e-01   -7.861954457501825e-01; -3.400245458161508e-03   -9.699288449963119e-02   -4.473297654964263e-01   -4.403868210169475e-01   +3.432463586285837e-01   -2.844118356242973e-01   -6.274869871214864e-01   -5.993774083804007e-01   +3.531837135707820e-01   -2.784598929357253e-01   -1.426548015936520e-02   -5.729084519944889e-01   +6.249239191101924e-01   -1.922994414542307e-01   -6.384735306689627e-01   +4.203847807583230e-01; +4.383401722612325e-01   +1.755894599285807e-01   -1.410548334520584e-02   -1.862392862439700e-01   -2.664647591782595e-01   -2.549233535860618e-01   -4.485235751094330e-02   +2.830712499634520e-01   -5.883123133993480e-01   -2.929202553358692e-01   -1.642491736852499e-01   -2.854720771805849e-01   +5.968976585479546e-01   -1.108306856769711e-01   -1.668939170189683e-01   -1.804201269832479e-01; -7.091814730249388e-01   +3.318372795145801e-01   +7.722588326070426e-02   +2.344344526444114e-02   +3.075294369241261e-01   +7.227076760880330e-01   -1.781922460542599e-01   +3.955506330017511e-02   -3.176838451484733e-01   +2.913290079922893e-01   +3.299256635428387e-01   +1.393611506077462e-01   -5.028481454486825e-01   +5.093722598579163e-01   +3.803052247258210e-02   +2.357716560701956e-01; +5.682276884807607e-01   -4.810890560960273e-01   -6.966677021900233e-01   +5.835173772035468e-01   -6.111258395619669e-01   +1.920791683315322e-01   +9.238226984359643e-02   +4.911339191409123e-01   +1.669553268378586e-01   -2.558696181414263e-01   -1.536563251471097e-02   +6.366113314611700e-01   +5.859516573935009e-01   +6.405614896319334e-01   +7.814239245668039e-02   -1.137079258113764e-02; -5.793802510073630e-01   +5.000999334407127e-01   +3.657631145301123e-02   -5.251897102180338e-02   -3.063709746528465e-02   +1.973875483767995e-01   -3.702194895813908e-01   -2.430185319068053e-01   -4.081024061086961e-01   +1.177027856155789e-01   -3.077153795916831e-01   +2.458535230252486e-01   +3.239250297911591e-02   -6.687396752327462e-01   +2.884049649867442e-01   +4.684448967265023e-01; +4.846642930915295e-01   +3.182750731468059e-01   -3.929208995067156e-01   -4.475690015778221e-01   -3.912942737741604e-02   +7.968830245792461e-01   +3.065798181099695e-01   -5.963165709990076e-01   -1.819403997068274e-01   -5.722911748109148e-01   -6.292193954360163e-02   -4.448168260152465e-01   +4.254707585049722e-02   -2.667140513713173e-01   +1.325424805006794e-01   +5.390792620012061e-01; -5.237544537277583e-01   +5.576228800287422e-01   -6.243006266783871e-01   +7.020235887298053e-01   +4.861656818643995e-02   +3.435908546599401e-01   +5.310080975310375e-01   +3.424493470193367e-01   -1.090659983442858e-02   +5.478944489880504e-01   +1.405907544643074e-01   -1.937966573638534e-01   -3.033328179510096e-01   +6.668847402342136e-01   -7.557906237547089e-02   -2.273319413604319e-01; +5.108422279234134e-01   -5.545214522019617e-01   -4.947954367915463e-01   +4.980410267074633e-01   -3.024314031972737e-01   +4.561198146305565e-01   -6.470559068454730e-02   -1.314013566895193e-01   -3.078798698101592e-01   +1.229852367679052e-01   +2.135029415459506e-01   -3.853443875586828e-01   -6.017300643631123e-01   -3.174013808932348e-01   -4.434568161299186e-01   -3.390204940526485e-02; +4.715232265767860e-01   +3.986687593254125e-01   +4.780270485171068e-01   +3.886502831719107e-01   -6.013412066002186e-02   -3.272103732468989e-01   -7.277375994188309e-02   -3.510150613865426e-01   -6.452750658517356e-01   -6.523677978051546e-01   +7.792493641736191e-02   -3.733809889639442e-01   -1.391126766189630e-01   -2.242248649150340e-01   +2.168643976981041e-01   -6.224133961932871e-01; +4.260288204859757e-01   -1.339813315859381e-01   -6.451720157019104e-02   -3.610146355434414e-01   +7.264753235859585e-02   -5.529890041307848e-01   -2.353715713800670e-01   -1.000000000000000e+00   +1.238406790414340e-01   -2.006209983360936e-01   +2.586177830232860e-02   +2.079523119986791e-01   +9.122380312594407e-02   -2.259566850165155e-01   +5.486889428068699e-01   -3.014755266753179e-02; -5.722336704934666e-01   +5.625966010289178e-02   +6.415267604454047e-01   -4.913051518801529e-01   -3.382608085160861e-01   -5.109970780501555e-01   +6.581301110951201e-01   -5.352086439900064e-01   +8.179565472899937e-01   +3.843555654514836e-01   +1.067004981272973e-01   +6.891264667509470e-01   -2.533373784115237e-01   -7.061436527455912e-02   -3.997720743689024e-01   -4.130881849891092e-02; +1.503923914589623e-01   -7.468440041404831e-02   +3.861557150921580e-01   +1.711945001514667e-02   -3.044390835613444e-02   +2.434782377213210e-01   -9.843711478175397e-02   -6.533637595947953e-02   -3.844904986169855e-01   +5.754661631525846e-01   +1.450553346658951e-02   +1.491825519876292e-02   +3.591359937709924e-01   +1.495974051863558e-01   +3.527809612120508e-01   -8.577934702477974e-01; -2.893696829764256e-02   +2.650176762275134e-01   -3.898261905113236e-01   -3.189221280390641e-01   -2.999411557701859e-01   +1.822482416613402e-01   -3.874176753007729e-01   -9.230933962495702e-01   -2.082049381109897e-01   +5.599145917103621e-01   -4.153453574104827e-01   +1.411808432829214e-01   +7.126564757084990e-01   +1.925238992895434e-01   +4.798684513147343e-02   +1.504211670687786e-01; -1.522333670992466e-02   +4.817157306583302e-01   -2.566284505725296e-01   +2.534437840063957e-01   -8.824025902814103e-01   +4.820696529810507e-01   -3.165818846653289e-01   +4.472098113465230e-01   -5.929307017300121e-01   -9.145664180243825e-01   -1.185119111747085e-01   +1.374833329274887e-01   -4.704629961085530e-02   -2.637677975493573e-01   -4.081115877923676e-01   -1.953003539026623e-01; -9.511727629741590e-02   -1.586085991937282e-01   -3.404600399888531e-01   -1.412578509441468e-02   -5.526271178287901e-01   +2.108954255357238e-01   -1.543502813845481e-01   -7.731856145471317e-01   -5.143629747495835e-01   +4.020711167409693e-01   +4.289386687548093e-01   +2.718612516438006e-01   +1.468366327748413e-01   -2.732155063489475e-01   +8.947905279234172e-01   +6.223155226753749e-01];
L1E_L1I_iGABA_netcon = [+2.474549598478655e-01   +3.968814876645678e-01   +6.640621619770527e-02   +8.617866278208303e-02   -2.355149926619521e-01   +4.179322116724040e-01   +3.334563370844051e-02   -7.443156171694214e-01   +1.126640129086715e-01   -3.479264866836777e-01   +1.984238457658267e-01   -6.167001395117161e-02   -7.372317658607974e-01   +1.877088682493480e-01   -3.043226829371236e-01   +8.818829580973462e-01; +2.414690894288102e-01   -3.733706708922583e-01   +1.662568909206451e-02   -6.728043764132733e-01   +1.653632720263661e-01   -2.173590105173987e-01   +9.991440788467089e-02   -6.392621049329424e-01   -1.590614748424632e-01   -6.203718193828729e-01   +8.083826411349526e-02   -2.180928133053323e-01   +3.852224939888355e-01   +5.767885799953400e-02   -3.275541648080551e-03   +4.315931491135405e-02; +3.073514612230673e-01   +4.149515170523206e-01   +3.996163071976156e-02   -1.311838493092023e-01   +5.787213801304290e-02   -7.575811828543476e-01   +1.577250997609124e-01   +4.206749769308758e-01   +2.441860841043320e-01   +3.232205485304419e-01   -2.679885119832220e-01   +4.016006716564653e-01   -4.706902272346429e-01   +6.228467679148580e-01   -1.951225598090076e-01   +8.417270603232817e-01; -1.644921894460542e-01   +2.036543789468622e-01   +1.297172151112386e-01   -3.643603214099463e-01   -2.132576654802308e-01   +4.071432114181992e-01   -3.750805015311606e-03   +2.910262813703223e-01   -6.326437203546412e-01   -3.982074025978300e-01   +5.705504188273854e-01   -3.258515729667687e-01   -9.477251544172782e-03   -2.068130698696275e-01   -2.538433187526618e-02   -5.955185815362068e-01; +2.712307593585795e-01   +3.316294916349802e-01   -1.435330308301353e-01   -2.963067209206479e-01   +1.995894651225661e-01   -1.904577073774655e-01   +2.852559369466616e-01   -3.876051156498913e-01   -2.543938865703201e-01   -9.144240876254834e-01   -4.603611424400937e-01   -2.104128105197000e-01   +5.044467080504931e-02   -4.022125298864602e-01   +6.002461868264355e-01   -9.116628075852033e-02; +4.971205907702943e-01   +2.015701725607345e-02   -9.017154963140545e-02   -1.781859223668259e-01   -2.195077020902799e-01   -3.589017260974920e-01   +6.673666938603792e-01   -3.930237075218865e-02   -1.569375142847607e-01   +1.670614519329625e-01   +4.927909231825705e-01   +1.424559684468317e-01   +1.075457958711358e-01   +9.473092738783870e-03   +1.159487799115124e-01   -5.602200523180827e-01; +1.322770305625297e-01   -2.531868068205482e-01   -2.876721671124707e-01   -7.944130945906579e-02   -1.165448289754173e-01   +8.363749709484695e-02   -7.703747073975498e-02   -2.049578438673773e-01   +2.190232269173804e-01   -1.883450540356307e-01   -2.735291930137206e-01   -2.400291643516628e-01   +4.834017165890419e-01   +4.782780706291370e-01   -4.077739649521923e-01   -3.719650764292550e-02; +2.212134328694833e-01   -2.769743668122044e-01   +5.997908016160061e-02   -2.207901931698150e-01   -7.776456590417992e-02   +7.146397000788146e-02   -1.611064781444757e-01   +2.738818264256385e-01   +4.140836868506874e-01   -6.130973233242232e-01   +1.092536980498251e-01   -4.112171619821903e-01   -2.447934544862747e-01   +2.840989321410886e-01   +6.631843627198800e-01   +9.427063117379857e-02; +6.460311786516090e-01   -5.900712317571385e-01   +1.984937007578777e-01   -2.347228131750617e-01   -1.583593424313003e-01   -3.994761360325625e-01   +5.593814329706783e-01   +1.469465775856270e-01   -1.675010001273695e-01   -1.672736174115556e-01   -2.698955501935330e-01   -2.787891122623456e-01   -2.734807989235251e-02   -2.591372055226542e-01   -6.315492255670782e-01   -3.521831896294753e-01; +1.017676054986267e-01   -8.187751123465868e-03   +2.059890717342344e-01   -7.991783279731239e-02   +1.147385522968142e-01   +6.391329121954208e-01   -1.407151848285325e-01   +2.485240723185209e-01   +1.560067435861716e-01   -5.376013538922933e-02   -4.868492664566004e-01   -2.389918214673452e-01   -1.226343932967783e-01   -2.200145331723770e-01   +3.567934836486464e-01   +4.397631231534908e-01; +1.146032675002625e-01   +2.620677124880333e-01   +7.469356407121754e-01   +7.690986683900117e-02   +6.728984416562264e-02   +6.270758502957272e-02   -3.106001095323892e-01   +2.752750110660263e-01   +4.537827681625214e-02   -6.154020783038336e-01   -6.064540518364935e-02   +5.507266071844396e-01   -3.017520759607697e-01   +1.186135402912888e-01   +1.062929861790760e-02   +2.628254329249766e-01; +1.264537159453724e-01   -1.000000000000000e+00   -5.324364719630660e-02   +6.030649406060838e-01   -1.908292683194492e-01   -5.505279528518043e-01   -1.585636561274418e-01   -1.932925846051801e-01   -6.848667108701625e-02   +2.772357608030037e-01   +1.951680593639990e-01   +6.018262687291240e-01   +6.355037652956791e-02   +1.865869547519186e-02   +6.265610568018611e-01   +1.031690900179440e-01; +2.934221463798933e-01   -3.398885197800496e-02   -1.181829014125390e-01   -4.514999379726223e-01   -2.548432983614051e-01   +7.222231189166135e-01   -5.329054657682537e-01   -2.155637667704906e-01   -1.578838789447098e-01   -4.530327896075391e-01   -5.902285334649245e-02   -1.335264755563823e-01   +4.209628415348136e-02   +7.998309361486715e-01   -2.852805652437020e-01   +1.793700644203179e-01; -7.217795707691252e-02   +4.344046569929704e-01   -4.260932586045746e-01   +6.987040250484309e-01   +1.145066422058442e-01   +7.526131999247491e-02   +2.774732392864413e-03   +2.665719226590001e-01   -4.557847336502932e-01   -1.727325021047620e-01   +3.240899745176996e-01   +7.454791171732050e-01   +1.264295238084985e-01   +1.085233085294065e-01   +9.219825179140039e-03   -2.381701077093961e-01; +3.221699499804364e-01   -1.008333227810107e-01   +1.600301338658624e-01   -6.032748918695451e-01   +6.319051849097745e-02   +2.403556815939230e-02   +5.136967538871264e-01   -1.164652252556259e-01   -4.880492116921887e-01   -2.108949196183700e-01   -4.556655937879526e-01   -5.648033736603268e-01   +6.666000290719972e-01   -6.094508169099219e-01   +9.865788206341467e-01   +4.694431792743073e-02; -1.387300562603866e-01   +3.763086820025268e-01   +3.302413949130600e-01   +3.506040453918072e-02   -1.542628126364783e-01   -8.850396977052870e-02   +1.486577138412595e-01   -3.590372502744164e-01   +1.283378295622187e-03   -4.990347641125830e-01   -2.637453394506284e-01   -1.624278669231350e-01   -1.981239527289686e-01   +2.798431468650444e-01   +6.555997502397264e-01   -2.903661463221830e-01];
L2I_L1I_iGABA_netcon = [+3.258741896182216e-01   -3.168978741807498e-01   +3.140353833241191e-01   -1.844841961255424e-01   -1.827102680077222e-01   +3.825336141497065e-02   +2.693854917270318e-02   -1.594538185921252e-01; +2.943956363224381e-01   +4.436924651708682e-01   +3.269116990587682e-01   +2.210101941473358e-01   +2.754451945344041e-01   +1.253580362129899e-01   -5.019830562680954e-02   +7.847867427448316e-01; +5.173016760163750e-01   -2.520512914377924e-01   -1.752413187824956e-01   -3.052779925163310e-01   +3.114523477753924e-01   +2.627259956875129e-01   +3.946317260732608e-02   -6.202679196444676e-01; +1.535867668883870e-01   +4.256603216063455e-01   +1.287220572949191e-01   -6.531960563150362e-02   +2.038817129983015e-02   -1.360640039646506e-01   -1.422261792365774e-01   -6.318047856447451e-01; -4.667493061142948e-01   +3.555631041851074e-01   -1.983878512239955e-01   -2.498568424002541e-01   +1.775613602711419e-01   +4.036738720156048e-01   -1.885157793685364e-01   -6.590824776355614e-01; +3.751395295254177e-01   +9.357467996092442e-02   -4.258369541850188e-01   +3.045458160992111e-01   -3.455295580939004e-01   +3.117020371027928e-01   -2.980062428243979e-01   -3.705378817100943e-01; -3.525131933427499e-01   -4.953141595216791e-01   +1.453888635319007e-01   -3.316071359112555e-01   +1.483657010234487e-01   -1.121422418285452e-01   +1.409097442457097e-01   +2.553839732163935e-01; -4.579140771957192e-01   -6.006420894547172e-01   -1.196261482705515e-01   +2.029074667718149e-01   +9.299376030755563e-01   +4.846272443961127e-01   +2.400855666354339e-01   +3.500381503845242e-01; -4.250878237099218e-01   -2.741898452693609e-01   +7.875525856331140e-01   -6.958532833860693e-01   +6.696536308529847e-01   -1.145799371240541e-01   +1.734516841907197e-01   -1.351580564570755e-01; +4.333626456778180e-02   -3.557565149634783e-01   -1.296922716876268e-01   +5.577211473281179e-01   +9.856707770477710e-02   +5.260696194445823e-01   -1.723264836533902e-01   -8.283315793073643e-01; +1.625205583717716e-01   -6.993096032288991e-01   -3.309567885669979e-01   +7.378721359569622e-01   +2.823932124239971e-01   -5.492156248770963e-01   -1.639121195633471e-01   +2.231552881391844e-01; -1.943545750444206e-01   -4.351308784834748e-01   -5.641812848235662e-02   +2.469241820332586e-01   -3.335915946950813e-01   +6.509573463873911e-02   -4.494317506831344e-01   +1.000000000000000e+00; -6.297377661921445e-01   +6.430458666257772e-01   +5.935807513769472e-01   -2.664133224473356e-01   +6.610737904231476e-01   -1.754265417769343e-01   +1.578238660183493e-01   +6.996532726391304e-01; +2.131425318329813e-01   +8.633056514762304e-01   -4.642003156245884e-02   -2.688709642636642e-01   +5.656114498424953e-01   +2.292509360076329e-01   +2.847942735463583e-01   -3.342103984602039e-01; -4.074367423507121e-01   -5.110391276888067e-01   -3.471230567403038e-01   +4.454737515502878e-01   -3.754202287860679e-01   +5.648836969436746e-02   +7.128950532875221e-01   -3.275026619947072e-01; -2.231847346979627e-02   -5.149189815049574e-01   -5.159049878758365e-01   +2.520750891397122e-01   +3.788984401203888e-01   -8.621396373007349e-02   -5.032510929936318e-01   +6.788260132908825e-01];
L1I_L2I_iGABA_netcon = [-6.738537042437306e-01   -2.951298494303998e-01   -2.202361549574404e-01   -6.587465810390476e-02   +5.268883231228423e-01   -1.851846919538501e-01   -6.395745480855370e-01   -2.277413160967556e-01   +8.031748993746384e-01   -3.320761671817783e-01   +2.402321177669187e-02   +1.327858248955484e-01   +8.940947304916352e-01   -2.608928627841211e-01   +8.611589823706766e-01   +6.217160978715247e-02; +7.036284650532890e-01   -3.490562767560657e-01   +4.338453127044534e-02   +4.818436235806346e-01   -1.235479097275035e-01   -1.914552293669387e-01   -1.723119039684427e-01   -5.423299824328958e-01   +2.903522787674379e-01   -3.416583747736801e-01   -4.759746546363058e-01   -2.927928378126896e-01   +4.521538049178557e-01   -1.899902282373044e-01   -3.397951525549452e-01   +3.431084449520892e-01; -1.642112916887784e-01   -4.762123206690407e-01   -1.304385070637018e-01   +2.316842954526987e-01   +1.940736808746878e-01   -1.516755240243000e-01   +1.409577198504426e-01   +1.314749861266239e-01   +1.886302221806604e-01   +9.463305573053929e-01   +7.778933209087426e-01   -3.167100127493307e-02   -9.031593104351272e-03   -4.624755330895535e-01   -1.692346543711097e-01   +8.260274145030270e-01; -4.064862084290698e-01   +4.320706516281914e-03   +1.550520386882437e-01   +1.242158728602261e-01   -4.385108824471705e-01   -2.383629133398432e-01   +7.138806292302623e-01   -9.631305177264831e-01   +1.879885784800303e-01   +4.687738250627829e-01   -1.774045982076713e-01   -1.157977218636760e-01   -1.412171956823634e-01   +4.879346310928206e-01   +1.712276499428316e-01   +5.654739629605312e-01; -7.660590727090338e-03   +6.891288034731972e-01   -3.551963734440993e-01   -3.799028107852991e-02   +8.839451019872813e-02   -5.376236258429197e-01   -2.094801003141598e-01   +4.218691346313988e-01   +2.330625798599295e-01   -7.893551578065511e-02   -5.139201586418757e-01   +1.834470603125847e-02   +5.754340025725548e-02   +2.156017252381303e-01   +3.592012111789689e-01   -4.242607706874449e-01; -6.654913429498215e-01   -6.298852633267327e-01   -1.608022013452600e-01   +1.081917927481033e-02   +1.868928055036926e-01   -2.940953277411036e-01   -1.555029531840691e-01   -3.537284406869740e-01   -2.248336520142070e-01   -9.735507327791243e-02   +1.446767530869322e-02   -4.238711960832941e-01   +5.540257533552634e-01   +1.238100540206349e-01   +1.333426681844437e-02   +2.542067879913276e-01; -4.451709736361546e-01   +5.429819532207867e-01   +4.950433619781198e-01   +9.491444896821845e-01   -2.915289433437083e-01   -1.038325357640831e-02   -4.135841696807060e-01   -7.890102802424873e-02   +4.896534026162273e-01   -5.517006650983195e-01   +5.398640631528369e-01   +9.352465124367203e-02   +4.239980971716214e-01   +1.000000000000000e+00   -3.003753002425060e-01   +3.679437114784754e-01; -1.749824488052560e-01   +6.196600766103708e-01   -1.809975043059399e-01   -4.775620254380240e-01   +5.327120525676131e-01   +4.058729679327520e-01   +7.450490539594476e-01   +7.635604923880938e-01   +1.286827389399590e-02   +7.537357978662262e-01   +8.320834923713026e-02   -6.245885090126436e-01   +5.326597647807074e-01   +2.350874385021029e-01   -6.365149307313403e-02   +8.075355288806054e-01];
L2E_L1E_iAMPA_netcon = [+3.304755381826900e-01   +5.993116657667226e-02   +7.874495543203873e-01   -6.571765431662417e-01   -1.553445212220720e-01   +7.521927911380808e-01   +3.731726077785755e-02   +1.450363056442028e-02; +2.955335942746707e-01   +1.658724157815799e-01   -7.709490608494309e-01   +8.064584212926569e-02   -6.700934637446695e-01   +3.014218244992282e-01   -2.785150974346807e-01   +5.631560237757389e-01; -2.452857357995913e-01   -1.792205895058995e-01   -7.068438528681106e-02   -8.267130023539103e-01   -3.983231364474700e-01   -1.442218614107557e-01   -2.137491445114263e-01   +1.245338963250889e-01; -1.309911556910025e-01   -3.451664245332639e-01   -1.872304268277102e-01   +1.122161847680269e-01   +3.215027240019665e-01   -3.029810117457969e-01   -4.719794726325370e-01   +3.558981351492330e-01; -2.743996218415417e-02   -7.708558451879480e-02   +2.442708441284569e-01   +2.599324521658160e-01   +3.097315817306230e-01   +4.987085337535271e-01   +7.224192574803395e-01   -8.083611729098129e-01; -2.845855228841725e-01   +1.850027249584578e-02   +2.307555835590699e-01   -4.093676336535790e-01   -5.546041276926031e-01   -6.127166434252076e-01   -7.301932631978476e-01   -3.228812479847665e-01; +1.262410571354412e-01   -4.824559838322651e-01   +7.820756490267099e-01   +3.512991635460213e-01   +6.321659514936140e-01   +2.178442647488165e-01   +9.587728237270138e-02   +5.367992224746244e-01; -4.287632659355720e-01   -1.377878780545404e-01   +9.816119961429111e-01   +1.856150504564082e-01   -3.854115287014319e-01   -6.135191626903918e-01   -3.608624132096773e-02   -5.768038464341136e-01; +1.040247808746318e-01   -3.542570803012201e-01   -6.124731813141252e-01   +2.765191810485532e-01   +1.762679021683175e-01   -6.922153664314277e-01   -2.282367983488011e-01   -1.478835959740379e-01; -5.137859550456533e-01   -1.389290330679657e-01   -2.325168977690213e-01   +6.163524542003659e-01   +2.528096550643531e-01   -4.389333456528257e-01   +3.703776878134935e-01   +5.629789963658119e-01; -1.000000000000000e+00   -7.012384468301687e-01   +5.042433136122653e-01   -6.649035522430771e-02   +6.216990504438156e-01   -5.583103032624271e-01   -5.414156061898914e-01   +9.338199952703130e-02; -2.490359490022690e-01   -1.368650674935535e-01   -2.550640692663123e-01   +3.447470264998092e-01   -1.943177967341797e-02   -2.566482716682938e-01   +8.180731815893150e-03   -1.834908499292077e-01; -2.786219666250328e-01   +6.280912785673638e-02   -6.789490313984603e-01   -3.022306259490022e-01   -6.932172128523931e-01   +6.641907125426398e-02   +9.478669094239223e-01   -7.911093361371005e-01; -1.030063553113789e-01   -3.748784941893509e-01   +3.923380809731414e-01   +1.417474711130179e-01   +1.902452255277280e-01   -3.526953368826413e-01   -5.179356757735695e-02   +6.794383352259420e-01; -1.899956175212531e-01   +4.402402046708264e-01   -2.239454881145808e-01   -1.482444160229490e-01   -4.997942130229535e-02   +2.174358522155453e-01   +3.065298805124235e-01   -5.112619118975065e-01; +6.001092199756644e-01   +3.484471234822372e-01   +3.091618455267157e-01   +1.772924659958146e-01   -2.223835103503457e-01   -2.359685830480169e-01   -8.296809575155735e-01   +3.859595794213219e-01];
L1E_L2E_iAMPA_netcon = [+3.984226240687130e-01   -7.601785134927851e-01   -4.352266693038932e-02   +5.243129132930781e-01   +4.313589888768314e-01   +4.092236350060438e-01   -4.358423404520723e-01   +5.427035272883167e-01   -1.846497366658693e-02   -2.335096070724113e-01   +5.236950573186564e-01   -5.521403033539822e-01   +6.260398330379916e-01   +7.128574212499101e-01   +6.826919701382541e-01   -2.082683435835084e-02; +5.769524241621607e-01   -2.829135153106406e-01   +2.407466241117658e-01   -5.482131628735176e-01   +2.799779368050749e-01   -6.884838703589058e-02   +4.141143370047173e-01   -7.111473628698191e-01   +1.559537477755338e-01   -4.239218873022627e-01   -1.157322886903205e-01   +4.216992986444889e-03   +4.671515921894589e-01   +1.762744875761484e-02   +2.809075385078711e-01   +1.057880448472576e-01; +2.835337246655618e-01   +6.545874203835376e-01   +1.471366377231544e-01   +2.626631710091589e-01   +2.553408408918265e-02   +5.386350136765011e-02   +6.974344844840155e-01   +1.438146686783814e-01   -2.788501811758755e-01   -9.778673097405885e-02   +6.748115837477533e-01   -3.329616836429007e-01   +5.564130597549695e-01   +1.866807515325587e-01   +4.342723278980506e-01   -3.219432461665030e-01; +6.536365398457684e-02   +2.696324010042001e-01   -1.905740815830446e-01   +7.795172371404764e-01   -3.250849788604894e-01   +9.783738598985592e-03   +8.877609870847208e-01   +7.861491419370498e-01   +4.127867533614507e-01   +1.503052530261737e-01   +6.063891396042946e-01   -6.040795893833787e-01   -9.169755203224400e-02   -1.263783615506722e-01   +5.753465182384651e-02   +5.540052183813299e-01; +4.725577485782985e-01   +2.753134285100029e-01   -6.955628739582230e-01   -4.749547910866024e-01   -3.224251113558465e-01   +1.238738842851111e-01   +8.227683907763023e-02   +4.029567361871478e-01   -3.155283946714556e-01   -5.018215456168773e-01   +5.029148122528446e-01   -4.873919916708326e-01   +2.849645336944743e-01   -5.787948980148454e-01   +2.339337257126783e-01   +4.402018901301558e-02; +8.096230184282252e-02   -6.792227615356523e-01   +6.819505523725078e-02   +9.168026761585878e-02   +1.793571244102673e-01   -2.135742334338608e-01   -4.115920628161904e-01   +1.152463770762097e-02   +8.354697584841165e-03   +3.084216533835074e-01   +4.762107883253048e-01   -6.840796329315793e-01   -5.642650281342050e-01   +7.426658235112579e-02   -4.196646459649195e-01   -5.426248195850965e-01; -1.125657288040454e-01   +1.000000000000000e+00   +4.607430455154675e-01   +3.720386093813149e-01   -3.084230296162182e-01   -2.208964622811612e-01   +1.503847861801047e-01   -7.889539036015080e-01   -2.487185004356222e-01   -1.769049462175820e-01   +7.504361539238501e-01   +9.483203556232085e-01   +6.304624320333040e-01   +6.906049415180632e-01   -1.343339590892650e-01   -5.408298308909804e-01; -1.533094526949607e-02   -1.430209392569246e-01   -6.033646223851482e-01   -3.619395882848203e-01   -1.196094478876078e-01   -1.918138164515112e-02   -1.146284683299318e-01   +1.403326891891026e-01   +5.527836692416757e-02   -1.222332945911507e-01   -3.534224267883030e-02   -7.312423918517228e-01   -6.174139772401645e-02   +2.057048480515430e-01   -6.089476729243962e-01   +1.743408954525672e-01];
L2I_L2E_iAMPA_netcon = [+3.477289736803280e-01   -8.988413420530588e-01   +1.429221269886470e-01   +1.325250664889072e-01   -1.660923735977268e-01   -6.398691308153964e-02   +2.078683452844516e-01   +9.560250101754758e-02; -5.832695706550564e-01   +6.499509969113756e-01   +4.849404727654692e-02   -1.340771037413762e-01   -1.931740438427177e-01   +7.738456529373569e-01   -1.148292179649783e-01   -5.062054571091508e-01; -2.265865158370221e-01   +5.715052192136650e-01   -3.722655255541339e-01   +2.672834127773760e-02   -7.345627705348410e-01   +5.684292487838141e-01   +5.693394408101449e-02   -2.578976785031081e-01; -5.510616505774890e-01   -4.710372577272132e-01   -4.588759054535201e-01   +4.169815207090080e-01   +7.403773597048963e-02   -1.995971693079207e-01   -4.509189711657949e-02   +3.310563294579603e-01; -4.526599925098096e-01   +3.575992274337640e-01   +9.537646858928744e-02   +3.213125152819868e-01   -1.065339590545914e-01   -6.206695657987199e-01   +4.707930801695115e-01   +9.753511697350861e-01; -2.080290172123008e-01   +3.414646886586483e-01   -6.349339214192452e-01   +2.523520692150549e-01   +2.268650489013639e-01   -6.879260779749813e-02   +5.815633471997874e-01   +3.663889864729139e-01; +2.545887252112504e-01   +2.432233491020878e-01   -7.982445470614049e-01   +1.788521966022944e-01   +5.064817589924318e-01   +7.683214910940925e-02   -2.458594471093645e-01   +1.083557846368821e-01; +3.568090764365817e-03   +2.138739536152697e-01   -6.432144491219278e-01   -3.139337466018882e-01   -1.712231242624740e-01   +4.071215517318812e-01   +5.837892922318724e-01   +9.334396035365025e-01];
L2E_L2I_iGABA_netcon = [-1.677765398076720e-01   +1.000000000000000e+00   -2.422793552828881e-01   -1.720971839389215e-01   -7.546588943589139e-01   -2.078143532098560e-01   +7.146927184719424e-04   +2.536300440781394e-01; -2.979089831357716e-01   +4.971978155316153e-02   -8.177449129372713e-02   +3.352025865306730e-01   -3.114215856343773e-01   -2.316119721436194e-01   +6.800589111328258e-01   +5.013272032782810e-01; -4.608747967898775e-01   +2.817093099248324e-01   +3.714752638572977e-01   -6.183320779043963e-01   -9.679853475289522e-02   +2.358315492947763e-01   +3.972081082881995e-01   -4.888746142278130e-01; +4.694903679656168e-01   +2.431906600587382e-01   +2.397655127358091e-01   -4.065232823797915e-01   +2.107726646641560e-02   +9.022032088146455e-03   +3.592725958375133e-01   -1.721802734753138e-01; -2.676833244429616e-01   +2.293699029182267e-01   -3.160291535986780e-01   -1.557778260330910e-01   +1.618105685136756e-01   +3.040975256796909e-01   +3.080882470465426e-01   +1.355702764252929e-01; +2.819429665276670e-02   +2.170605663702072e-01   -1.019687695203503e-01   +9.279837230653055e-02   -7.154419504621296e-01   -2.911491137345760e-01   +5.575010202657054e-01   -1.393639939567607e-01; +6.314392300324950e-01   -1.157951963150371e-01   +3.926529194557770e-01   -5.784373035189567e-01   -7.603553899177627e-02   -2.733765436578454e-01   -4.832916227208328e-01   -1.201913526699095e-03; +3.766754656089327e-01   +8.249468287950183e-01   +2.394167262541011e-01   +3.258332612304014e-01   +4.567902678091357e-01   +2.848167335774280e-01   +9.776995786540502e-02   -3.696879739982298e-01];
L3E_L2E_iAMPA_netcon = [-4.310698678525838e-01   -3.456910647608364e-01   +5.494155214888803e-01   -9.227672786610432e-01   +9.872631411438827e-02   -2.183884315382133e-01   +4.935619494257323e-01   -5.154834840821658e-01   -6.297680479742055e-01   -4.415729337140930e-01   +9.305182534505904e-02   -5.890416454200321e-01; -4.886385037953049e-01   +1.380590751573743e-01   +6.268042969540951e-01   +4.498732412374680e-01   +2.298483865955639e-01   +1.722175376078862e-01   -2.153175964419525e-01   +4.369288247259370e-01   -1.772078612527054e-01   -3.327827991478857e-01   -1.573674255873120e-01   -1.535741785516201e-01; -1.051545830005151e-01   -5.421761025904067e-01   +4.116488351643744e-01   -3.979639519126894e-01   +8.979117563071695e-02   -2.458624256597526e-01   +1.300480467229738e-01   +1.203169673903860e-01   +3.455018175317909e-01   -1.263835808138636e-01   +9.022386473487567e-01   -6.304964138807893e-01; -3.714569354935831e-01   -1.093866480737572e-01   -2.173366995671377e-01   +1.958764972156667e-01   -2.010454561679963e-01   -3.500436443681049e-01   -4.435100765937991e-01   +6.125350339816039e-02   +2.536296976070126e-01   -7.872832960086014e-01   +3.873370905702145e-01   +5.514679281722536e-02; -1.966080719192042e-01   +2.041390757285528e-01   +2.779339099550869e-01   -3.907076561049795e-01   -2.182158769411013e-01   +6.686057823202971e-01   -2.802374432593936e-01   +4.220689462702937e-01   -1.626400768854627e-01   +4.585581260241294e-01   -1.582904038713237e-01   +1.268790786458025e-01; +7.390698866915861e-01   +6.152629528498720e-02   +2.909295363738674e-01   -3.591642681320658e-01   -3.839692723468940e-01   +1.911584762872503e-01   -3.848212947569161e-01   -1.929119750431446e-01   -5.494164681522546e-01   +3.627849200426634e-01   -3.964486661919286e-01   -2.340345010032100e-01; -2.013452928457932e-01   +6.136795116183756e-01   -1.667647421679690e-01   -1.000000000000000e+00   -2.651286023434545e-01   +2.658122045154072e-01   -4.392473541138205e-01   -1.242315011622759e-01   +5.516078948540765e-03   -6.056518552596923e-01   -1.681431495606275e-01   +1.258168726631123e-02; -1.979951731919066e-01   -8.440872917696128e-02   -2.716603469693785e-01   -2.986683471442645e-01   +1.630014401866358e-01   +6.880326822504569e-01   -3.228241229713337e-01   -5.916944962230993e-01   -5.119662957826302e-01   -4.698453458626334e-01   +6.107925223366285e-01   -1.722993129168027e-01];
L3I_L2I_iGABA_netcon = [-3.655002813692503e-01   +8.933675780061451e-02   -5.394243319915003e-01   -4.785868390187604e-01   -2.659764708102736e-01   +2.175464121018400e-01   -2.467015820540063e-02   +2.990834289555961e-01   -7.292027706370374e-02   +8.666934220817665e-01   -7.236238194729490e-01   -2.312313379788477e-01; -7.611160881965828e-01   +2.032306527841619e-01   -9.219946518777240e-02   -1.725153209378697e-02   -3.772522011789924e-01   -4.677541960045297e-01   +2.135246486947063e-01   +5.818323266497285e-01   +2.111153167221632e-02   -7.319614589205416e-02   +5.178627718163035e-02   -2.423577019877155e-01; +2.050606196733414e-01   -4.561470908425292e-02   -3.310941233029946e-02   +2.974661679768577e-02   -5.872051154990350e-01   +3.345271071853441e-01   -5.372383988158580e-01   -4.114265239256186e-02   +3.987155502095792e-01   +3.238005915397179e-01   -1.811758377203491e-01   -8.805751138531213e-01; -1.000000000000000e+00   +2.768473113655622e-01   -7.690461767223923e-01   -2.632405490306535e-01   -3.952427468152400e-01   -6.205418650954694e-01   +1.381413157817745e-01   -5.917264293984154e-01   -6.393540937818613e-01   +3.578840491698149e-02   +5.123249396701096e-01   -7.798272498073208e-01; -5.385895106933054e-01   +2.779535627140833e-01   +2.337827232714796e-01   +8.306432325928101e-01   +3.345829584033990e-01   +1.040227300399591e-01   -4.874731855861111e-01   -1.003887223860275e-01   -7.720923306171842e-01   -4.946049435988287e-01   +1.629839633797824e-02   +7.175041957443470e-02; -6.301548239385907e-02   -1.656143378992201e-01   +7.881007191352284e-01   -6.766644186053580e-01   -2.893551501835624e-01   -1.972800834788223e-01   -4.742032010719445e-01   +5.941548735170580e-01   -4.758298003802283e-01   -2.372582395854309e-01   -2.779864741527189e-01   -1.948587866944113e-01; -5.971786487272895e-01   +2.025379312168381e-01   +3.900299280123384e-01   -2.101986844944310e-01   -1.179511313484485e-01   +4.338229447948224e-01   -8.675332574600143e-02   -5.315465981754689e-01   +6.416163930521834e-01   +1.085831325139972e-01   -5.094995328513745e-01   -4.050904870188604e-01; -3.563383586605237e-01   -3.555682107897114e-01   -4.027529013421947e-01   +4.499020476430493e-01   +4.127583026406387e-01   -1.913952470339437e-02   +2.905171980430284e-01   +1.416380187068353e-01   -2.972345845730980e-01   +7.258043005431811e-01   +2.057361326835513e-01   +3.456820318544511e-02];
L2E_L3E_iAMPA_netcon = [+1.498845019147585e-01   +3.753214657921207e-01   -4.585871231820245e-01   +1.227664038308791e-01   +7.835091445917872e-01   -8.112854369445596e-02   -2.681270959578431e-01   +1.802734085455549e-01; -1.580266156891714e-01   -5.867448815165940e-01   -2.364708194116922e-01   +3.864436348783335e-01   -2.581377009718023e-01   +2.554676192651285e-01   -3.693495518463062e-01   -8.847038109784235e-02; -1.374626822833309e-02   -4.552077447963536e-01   -1.592024217284169e-01   -1.511481896128800e-01   -8.845940856530682e-02   +8.260578349581250e-02   -1.461390546343429e-01   -1.550263977844749e-01; +2.723668559194118e-01   +2.034422320030793e-01   -1.127234662158349e-01   +2.180783572839274e-01   +1.317158397367124e-01   +3.590531909015440e-01   -7.115993157371997e-02   -6.963905602481112e-01; -1.660914819892150e-01   -2.874839671487461e-01   +2.182565136167289e-01   -6.263713519138346e-01   +2.705589250504217e-01   -2.403828111145405e-01   +1.000000000000000e+00   +4.854271127645324e-01; -7.757064106215982e-01   -6.568853524796064e-01   +7.591992984688896e-03   -2.698021026794555e-01   +7.396111335911806e-02   +4.335457826849193e-02   +9.188534748224003e-02   -2.362957150395013e-02; +4.744154219967018e-01   -5.626343308011751e-01   +5.381806439935505e-01   -3.042955060413348e-01   -3.442868085076625e-01   -8.118460901477700e-02   -9.020844098309697e-03   -2.044321900649675e-01; -5.365032846836023e-01   +3.901757222700203e-01   +1.605274352715515e-01   +3.745655675116512e-01   -1.203606222618860e-01   +7.519814545382715e-02   -8.637125371237810e-02   +2.147066074816247e-01; -2.678853072505877e-01   -4.593265162260162e-01   -8.071251135166463e-02   +5.138053554949378e-01   +4.591071218573681e-01   -3.771497288006822e-01   -3.410420461328969e-01   -3.335302502564883e-01; -2.447387894824503e-01   -8.603110890580601e-01   +6.574286040802574e-01   +1.401696875806058e-01   +5.424730846871005e-01   +1.177198823990450e-01   -3.069834674005717e-01   +1.720102002101064e-01; -1.060800844532085e-01   +2.220151397100564e-01   -7.894060793102496e-01   -4.997860533761449e-02   +7.009596716927534e-01   +9.230801130218553e-01   -8.590731594058613e-04   +4.732778346526248e-01; +2.691436277598487e-01   +5.054522686835401e-01   +1.597671153269607e-01   -7.941498129530844e-01   +2.889000948547901e-01   +4.699981682744999e-01   -9.737036342395398e-02   +3.664971976874327e-01];
L2I_L3I_iGABA_netcon = [+2.100770612503499e-01   +1.824854943816633e-01   -9.943591458991569e-02   -2.717024050203900e-01   +6.847646586087597e-01   -3.498463369884932e-01   -3.998248802368625e-01   -4.467606231001163e-01; -9.540292748844048e-02   -7.927049404291143e-01   +3.078998115099097e-01   +2.909706036068509e-01   +3.963371652185702e-01   -7.633832317247935e-01   -4.602752436908936e-01   +1.517799289974032e-01; +4.224199774655393e-01   -1.035734767429468e-01   +1.828815118956653e-01   +2.883804861069152e-01   -1.846908819616062e-01   +2.020991054661305e-01   +5.539845775701600e-01   +2.682529917878821e-01; +5.170807642857045e-01   +9.588246719627441e-02   +9.450054981183112e-01   -4.376430890528852e-01   -8.558984156902959e-01   +1.050461200776982e-01   -5.560281727618308e-01   +2.746346608139639e-01; -3.846728713840748e-02   +2.346157598986751e-02   -8.199992990829330e-02   -7.041945838707744e-02   -3.618967299438387e-01   -1.265598265555979e-01   +1.735432024310872e-01   +7.670587534076487e-01; +4.303841566893791e-01   -5.145839618201095e-01   -6.253580963171104e-01   -5.336344489748844e-02   +6.959845310891664e-01   +8.229471992273756e-01   +5.953991662472113e-01   -5.700616367095901e-03; -2.584591440217153e-01   +2.075012779182617e-02   +5.802956146923839e-01   -8.877233647079175e-02   +8.409353782532200e-01   -1.702377053492398e-01   +9.346437710468800e-01   +2.010923572326284e-02; +2.512397387594397e-01   +3.821961770554735e-01   +5.492467387545694e-02   +4.570634512909060e-01   -4.840537502422683e-01   -5.707070569755210e-01   -6.200255225870569e-01   -3.410561116113361e-01; +4.016392221015812e-01   +5.155590234731073e-01   -5.189557213397520e-01   -1.638694315259767e-01   +4.889358911781347e-01   -2.368044516845569e-01   +7.008805485350708e-02   +2.430333962570683e-01; -2.183802322209408e-01   +1.769735292265745e-01   -2.843334452612276e-01   -4.590098471084257e-01   +5.734823584596878e-01   -8.598562019049074e-01   -1.940168043615725e-02   +1.129370597423601e-02; +9.988661461247024e-02   +4.257127470231367e-01   -6.935523945669960e-01   +3.204184006798999e-01   -4.052685555570116e-01   +3.250137795425476e-03   +1.922398248335008e-01   -2.963669260641191e-01; +6.425714659824854e-01   +8.035398186009873e-03   -5.497880711128522e-01   +7.533836335521678e-01   +6.076546172626689e-01   +1.838483462435004e-01   -5.346051612705089e-01   +6.833068776534013e-02];
L3I_L3E_iAMPA_netcon = [+5.902217864797294e-01   +1.178310673366985e-01   +6.794520915172720e-01   -4.004966246753688e-01   -5.297400012715987e-02   +2.529547753451757e-01   +5.394829718848229e-01   +6.356623533006941e-01   -1.290501910747962e-01   -4.039167357330724e-01   +2.070881532366908e-01   +1.515558537724677e-01; -1.762295441675363e-01   -3.269278344543736e-01   +8.343013785961123e-02   +6.794024239984505e-01   +1.859039713575610e-01   +9.474006651660508e-02   -6.748948793362433e-01   +1.284356994886288e-01   -5.853230004303124e-01   -5.773681132913105e-01   -1.019039263252764e-01   +4.412295779213045e-01; -3.159922215360869e-01   +4.084640059084522e-01   +2.401278510305842e-01   -4.331070078398948e-01   -7.074314290634365e-01   -9.310891006794494e-01   +3.721110604837451e-01   -3.741205096111491e-01   +4.577074782984582e-02   +2.130610121249343e-02   +2.790219913434422e-01   +2.495903616775451e-01; -4.639541054364121e-01   -8.240097095242799e-01   +4.033446689262067e-01   +2.474941392242496e-01   +1.011651426237988e-01   -8.017790494388388e-01   -3.088062451595426e-01   -3.910551835280315e-01   +1.044099173876993e-01   +3.048069617033900e-02   -2.766222333382304e-01   +8.455583890850612e-01; -1.498712410617679e-01   +6.182793936499705e-01   +3.354398094201196e-02   -4.966825665196394e-01   -7.211108130944839e-02   -3.058156675072652e-01   -8.304711662629498e-01   +1.188125318871712e-01   +3.049922695512035e-01   +1.188602041093921e-02   -3.229197442504643e-01   -7.686163923904792e-01; +4.102114375863443e-01   -9.568813308782277e-01   -2.409002536431089e-01   +5.275977721629498e-01   +6.259103937701227e-01   +3.559470905626304e-01   +3.391589617448300e-02   -4.860680568894194e-01   +9.793534273278362e-02   -5.427181975625766e-01   +3.987656964411422e-02   +1.338913109306346e-01; +2.889296806151573e-01   +7.398420994565968e-02   +8.299709317552080e-01   -1.451029362233839e-01   +2.564605737537005e-01   +7.637909663332115e-02   -2.078782636006461e-01   +7.157530003286587e-01   +9.577708311979257e-01   +4.953086465919611e-01   -2.220502583690154e-01   +1.666114002113591e-01; +4.474274699139756e-01   -3.713247394584163e-01   +1.886620586937359e-01   -4.731641989179776e-01   +3.478308916583734e-01   -1.040305358465288e-01   +1.215819460669646e-02   +4.492699240171113e-01   +3.046179114321313e-01   -2.505340086454236e-01   +3.438295152361852e-01   +1.321864705017519e-01; -3.261987027387165e-01   +6.351538174105102e-02   +5.063326583663477e-01   +2.063557884387822e-01   +2.302112140590793e-01   -2.653414715966956e-02   +4.018539389631866e-01   -1.467538462983680e-02   +6.710665110075477e-01   -9.435121106929478e-02   +7.654708479856812e-01   -8.190904789821266e-02; -9.268404393745240e-01   +5.220693431670713e-01   +7.321698256936308e-01   +1.476679574902057e-01   -5.232312629126326e-01   +5.184869061319859e-01   +6.841308757671956e-01   -2.765453315618028e-01   +7.028436198284040e-02   +1.966573848697933e-01   +4.080748749160095e-01   -2.627047765540348e-01; +6.019487587572564e-01   -1.567677628886700e-01   -2.019923240905875e-01   -5.163521610491573e-01   -1.000000000000000e+00   +4.495973736847946e-01   +4.425424926612244e-01   -3.149945377056012e-01   +7.555531464699536e-01   +1.201762602634649e-01   +8.405029844601034e-01   -7.022555264049202e-01; -1.382597841081071e-01   -3.080246656926700e-01   +2.047687861037930e-01   +3.913487909821682e-01   -6.621187252984980e-01   -1.181071131046720e-01   +5.217169792805441e-02   +1.662882761790991e-01   +6.833679113646735e-01   -2.804559177302983e-01   +4.591435877555947e-02   +9.182006388141004e-02];
L3E_L3I_iGABA_netcon = [+5.681198155553652e-01   +1.141732447665477e-01   -3.423912440968992e-01   -4.895104699361068e-01   -4.164372732528843e-02   +8.267236571204749e-03   +2.537469802986108e-01   -1.824441907581933e-01   +6.138771138522481e-01   -4.505314481616197e-01   -2.484263829958403e-01   +3.149867018104446e-01; +2.912884633689584e-01   +5.631277624064083e-01   -6.917765413312424e-01   -3.432964185263202e-01   -5.432376771551427e-01   -5.260786963487704e-01   +4.793351629181131e-02   -5.285703171572673e-01   +2.534669413843473e-01   +6.828210848382666e-01   -4.283961802586078e-01   -1.265936813882361e-01; -2.445284358129636e-01   +1.810891517648579e-02   -5.805414144393608e-01   -3.697489740179188e-01   +1.174213583627523e-01   +1.835525691496594e-01   +3.742499671307122e-01   -9.687041420002324e-02   -6.742047690171354e-01   +1.491298269875701e-01   +3.691360213911041e-01   +2.171214077504034e-01; -4.573051801168217e-01   +2.452855854415261e-01   -1.539862081952633e-02   -6.430247750680109e-01   -7.110385167092436e-01   -3.870593879441984e-01   -1.088573153196184e-01   -1.875255371880080e-02   +4.076181395688031e-02   -4.549384283068392e-01   +7.376431462922931e-01   +6.330650053574701e-01; +2.195727675458022e-01   -2.673711120007627e-01   -1.941300005015938e-01   +6.820804431201881e-01   -8.968485297150922e-01   -3.483290387076837e-01   +5.400761417691919e-01   -4.408519121941835e-01   +2.419906563078398e-01   -1.104787372310618e-01   +9.106136303032736e-02   +3.010451484777870e-02; +1.000000000000000e+00   +1.605262913684627e-01   +1.007785124232785e-01   -1.266735739308525e-01   -5.943701802685084e-01   -2.508209090625516e-01   -9.528462051388686e-01   +5.478835692619658e-01   +2.237705495214136e-01   +2.172114186494057e-01   -3.129431503249270e-02   +3.329306655806223e-01; +6.788423245931325e-01   +1.160278314520341e-01   -5.884686863889187e-02   -8.267202216988446e-01   -3.209567867376176e-01   +7.103260271869974e-01   -2.949448142501820e-02   +9.747712479032948e-02   +4.107350946551677e-01   -1.099143541239564e-01   +6.725680964639330e-01   -1.368848119007222e-01; +8.836828547356641e-02   +1.843758983356903e-01   -1.018025390547262e-01   +7.443824126258257e-01   -2.842982566820066e-01   -1.572430282137630e-01   +7.366136329334302e-02   -3.481369350674341e-01   -2.568707264101266e-01   +7.161746843588672e-01   +1.084835888529125e-01   -6.625903517751534e-02; +1.609368794154779e-01   -1.674250355151091e-01   +4.856251695842786e-01   +4.355577605918434e-01   +3.874115805907454e-01   -2.664860412074538e-02   +3.846934547787397e-01   +2.381623660705614e-01   -4.836554609862628e-01   -4.552210758004241e-01   +5.430585834175460e-01   -2.083772031980494e-01; -3.111754533855953e-02   +1.306302605258052e-01   +1.732258257530979e-01   -2.730797914823281e-01   +5.578722664895525e-01   +7.147536253866880e-01   +5.912706590441311e-01   +1.353237374000120e-01   -2.539361764045402e-01   +5.280696258176660e-02   -8.690742431807411e-01   -4.763703774236352e-01; +6.374867796500683e-01   -5.300105276218746e-02   -4.597709228144718e-02   +1.150444600796385e-01   -7.850287137302711e-01   -9.340054291780665e-01   -4.848310416120382e-01   +4.343182206389131e-01   -1.563981792502272e-01   +1.060531292558749e-02   +3.028393750583823e-01   +4.162628334526315e-01; +4.639296254053034e-01   +1.508447993468941e-01   +7.272583818848208e-02   +6.666811075373642e-02   +5.119701368855588e-01   -3.226585396468294e-01   -8.367895825694786e-01   +9.047547255941331e-02   +7.107615571861057e-01   -4.192711155560777e-02   -4.486766035450511e-01   -3.141521012261805e-01];
L2E_Input1_iAMPA_netcon = [-1.000000000000000e+00   -3.792393874820096e-01   +2.119899363982551e-01   -6.657753180409104e-01   +2.974755689245637e-01   +4.395941651767065e-01   +5.272636641754054e-01   +5.193059530930683e-01];
L2I_Input2_iAMPA_netcon = [+1.664666990481071e-01   -6.991128029181113e-01   +1.000000000000000e+00   +1.196459753723099e-01   -5.792309207218412e-01   +6.894541343002512e-01   +5.239413598721848e-01   +8.162478986898550e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.4*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.4*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
