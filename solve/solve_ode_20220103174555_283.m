function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.473515183152863e-01   +6.330742867414995e-01   +6.594926401153639e-01   -5.970303930408823e-01   +5.070364145007920e-01   -3.641799966606216e-01   +4.329942261974093e-01   +5.488585464977609e-01   +1.423081249040702e-01   -7.903998619300295e-01   -4.380716887754462e-01   +6.293737929053780e-01   -7.192518168328087e-01   -5.412947633845344e-01   +7.204874056405088e-01   +2.869140597371094e-01; +5.672842951343648e-01   -2.562589186384225e-01   +7.506982188707703e-02   -3.501992054450434e-01   -1.375210120877269e-01   +7.374771329725721e-01   +6.491229366609502e-01   -7.830946616830242e-01   +6.084679312177866e-04   -1.217678879352155e-01   +1.757809491799282e-01   -2.017452025615200e-01   +2.283348203115624e-01   -3.773252997056261e-01   +3.347785412567124e-01   -8.280666198053926e-01; -1.102676328430206e-01   +3.798939203287459e-01   +2.935231403353619e-01   -7.822999952885334e-01   -3.608139490244479e-01   -3.878715007886483e-01   -1.174153879671379e-01   +4.943798753705386e-01   -3.292086242331462e-01   -7.760503525405892e-01   -1.248983418179109e-01   -4.982246961788777e-01   -2.971864264633938e-01   -3.553229073970755e-02   -3.660405988578677e-01   -1.409285136266298e-01; -3.541522056388227e-01   -4.975065009023772e-01   -4.645705441515872e-03   -6.483509249008075e-01   +1.297292189901997e-01   -3.680086670972019e-01   -6.717888378733898e-01   +3.595374968516155e-01   -2.923036222720478e-01   +6.001441403613709e-01   -5.009308899878265e-02   +3.547078579287093e-01   -4.861506593852309e-02   -2.642836428873780e-01   -2.595377959625325e-01   -1.527307458855368e-02; -5.686087116555583e-01   -7.910548275145254e-02   +1.256516786141693e-01   +7.492271615878845e-02   -4.520896354383070e-02   +1.447110391963675e-01   +6.993945650003360e-01   +1.205602361869853e-01   +5.256256224470504e-01   +4.256077248663139e-01   -5.335776545871398e-01   -4.989135738926405e-01   -1.456812120486096e-01   -1.149852371963996e-01   +3.408963529265929e-01   -5.627291475977565e-01; +5.864947399035876e-01   -7.857491162896257e-01   -3.268757124918958e-01   -1.726571271905185e-01   -4.364739389760829e-01   -1.637817092634412e-03   -7.585544277548646e-01   -3.084984915453485e-01   -1.438604452664781e-01   -7.726390915918527e-01   +1.098193473761399e-01   -2.836756980564517e-01   +7.225186688214706e-01   -1.086795824767606e-01   +8.342117984108456e-01   -5.133865980361221e-01; -3.779812969785777e-01   -2.360622504490575e-01   -2.042149262924945e-02   +2.947548799468432e-01   +2.326741070946595e-01   +3.484303707628549e-01   -1.672405952496934e-01   -3.160578240705951e-01   -4.437817201626578e-01   -4.388162822372438e-02   +2.206881767791414e-01   +3.355195206378979e-01   +1.645549359640746e-01   +3.480819458019379e-01   -6.388034403823795e-01   +6.383962311415532e-02; -2.874953607360586e-01   -3.214129547935793e-01   +5.767559022689217e-01   -3.012942930032946e-01   +5.424073768257257e-01   -4.847159362924890e-01   -7.069811708638004e-01   +6.501513936750444e-01   -3.929065871190577e-01   -7.399599856066232e-02   -2.880322674454694e-02   +7.170796341750240e-01   -3.964148893586902e-01   -1.249000463521563e-01   -6.126236020884775e-01   +8.401839668730255e-01; -3.221367695386030e-01   -6.749878282261489e-01   -2.254753532283799e-02   -2.944382130241489e-01   -7.706086767944144e-02   -3.635676799832379e-01   +3.251271655163385e-01   -6.815222818929462e-01   -4.972940926788470e-01   -1.714009329422164e-01   -5.316171684381215e-01   +4.647256124242511e-01   -4.882979088936032e-01   -4.657393735793011e-01   +6.849321157820101e-01   +6.158991410300250e-01; -6.774359938328606e-02   -6.480328022086499e-01   +7.690032601127953e-01   +8.171345675268533e-01   +1.824465368495120e-01   -2.259910029770627e-01   -7.820128303271795e-02   +5.909846457678877e-01   +1.613233003952347e-02   -5.050099138034906e-01   +1.298295710119915e-01   +2.731288896174324e-01   -5.737317582669557e-01   -8.083258415934640e-02   -7.535395864404076e-01   -7.288689873238769e-01; -6.766364969464124e-01   +4.114029206976658e-01   +1.362047565317970e-01   +3.897022811754241e-01   +5.507734175818464e-01   -2.261592735097984e-01   -5.068247068949158e-01   -5.257241752667914e-01   -1.223783225662861e-01   -6.430930543119457e-01   -3.008244269769568e-01   +6.329755151057594e-01   +5.466980717673037e-01   -1.646030011258961e-01   +3.505916563841421e-01   -6.489504243488816e-01; +3.106243394572702e-01   -7.268966832967426e-01   -7.924963832901707e-01   +4.583415728234031e-02   +7.815608530565237e-01   +5.389474941891452e-01   -4.758940962698030e-01   -3.388430723756036e-01   -6.967337850850501e-01   -3.913045750200888e-01   -3.678246054811561e-01   -5.069738040751233e-01   -1.946093827442849e-01   -2.443807448527407e-01   -4.115482953609759e-01   +8.097504354274679e-02; +5.542772504390979e-01   +7.333220590653186e-01   -8.591131451950820e-01   +8.429539968500924e-01   -4.109073334757945e-01   +6.161860213222808e-01   +1.494089085067571e-01   +3.839055881583106e-01   -4.945524804979852e-01   +6.220970932155896e-01   -4.606266535507295e-01   -3.626898374927031e-01   -3.023089327567062e-01   -4.343452399767734e-01   -8.546084977102413e-01   +5.299965526796294e-01; +4.982353354612644e-01   +3.251076769869998e-01   +3.059455437916388e-02   -3.181355707524696e-01   -3.910034757747083e-01   +6.699502398633096e-02   +4.850659997541191e-01   -4.071442738750223e-01   +5.985707914279355e-01   -4.590088865128074e-01   +9.522067910406842e-01   +1.017170155941335e-01   -9.766559543095200e-02   -3.880862481337862e-01   +1.586444166536767e-01   -2.195861786802225e-01; -6.812437054942323e-01   +1.000000000000000e+00   -2.866315055060762e-01   +4.443976817497250e-01   -7.721216965435306e-01   +5.060373609940673e-01   +5.831513964149282e-01   -6.033138171022902e-01   +2.295048448531418e-01   -6.411644655645670e-01   +4.160050061822398e-01   -6.924360059495340e-01   +1.132529295869976e-01   +5.603973922833626e-01   +5.639011537613742e-01   -5.575454233826500e-02; +4.224736795797989e-01   +3.822963839891649e-01   +2.972421170233124e-01   -1.176347411334715e-01   +1.332132568922383e-01   -1.789475420722062e-01   +1.865529688746854e-01   -6.623693417694638e-01   -4.669394395755324e-01   +7.768693980739568e-03   +2.659279147045993e-01   -1.255096064697946e-01   -5.476003775798921e-01   +4.393392299642893e-01   +3.211594682316898e-01   -5.592908422203562e-01];
L1E_L1I_iGABA_netcon = [-1.099546849590492e-02   +8.233789875146724e-03   +6.984412597857689e-02   +4.102157758532125e-01   +9.459911366900432e-01   +4.046936211299331e-01   -6.149811220180365e-01   -4.939483883341289e-01   -1.926748278103854e-01   -3.874686439544255e-01   -2.926535870509717e-01   -7.756062255245508e-01   +4.370989163260470e-02   +8.577788050256081e-01   +4.948790515345855e-01   -7.833801185627670e-01; +8.933843016090487e-01   -3.883051795144640e-01   -8.923587858262658e-02   +3.786309122867023e-01   +4.064477560174857e-01   +4.536745284596593e-01   +6.277329292443693e-01   -5.226743680459792e-01   +3.972545376120893e-01   +1.502311270166540e-01   +7.474272226974326e-01   +4.891117785825114e-01   +4.034341268164223e-01   +4.910514827484302e-01   +7.907898666903236e-01   +5.550899541121511e-01; -8.668130986186061e-01   +2.241807843640038e-01   -4.254269031939464e-01   -4.037315319331826e-01   -5.643264703659338e-01   -8.777279788623935e-01   -3.839077730338804e-01   +1.734236643029418e-01   +1.741426689882005e-01   -4.078844656662584e-02   +7.025106479942116e-01   +3.020585204715689e-01   +3.033284539441246e-01   +2.699379857082878e-01   -1.630727135333316e-01   -7.855125024983813e-02; -4.684837050018629e-01   -6.238830762907125e-01   +3.741130918066470e-01   +5.422547309005436e-02   -5.382783802883403e-01   -1.069902792830910e-02   +1.589917346865711e-01   +5.288822716882786e-01   +6.761839494386553e-02   +1.177442774772990e-01   +1.535325812196703e-01   +3.416117571795347e-02   -3.417544790892000e-01   +5.739090654738646e-01   -5.743138904784206e-01   +2.791483687583437e-01; +9.622124796586038e-01   +3.924651901611018e-01   +7.856514645331904e-02   +2.257011344067332e-01   +6.072613437192016e-02   +8.198460440874243e-01   +9.399180763012558e-01   +9.936029488695781e-02   -4.002849323119013e-01   -1.837420699824225e-01   +2.662082392877903e-01   -1.484449270365479e-01   -4.495462709033604e-01   +5.173606876120340e-01   -7.428625294624990e-01   -8.675516201395665e-01; -4.772784335639790e-01   +5.805482208811461e-01   -2.173037891191120e-01   -1.894298319060283e-01   -2.357674235616132e-02   -2.579452958449641e-01   +6.766097091223088e-03   -5.445602824139910e-01   -1.953434813951528e-01   -1.759012907583625e-01   -5.875518823445647e-01   +4.006977073244626e-01   -5.693321784137914e-01   +3.934908196788663e-01   -4.494854497141792e-01   +7.035014148556982e-01; -1.561249206994526e-01   -3.656884279806970e-02   +6.447295130066614e-01   -8.069479476011201e-01   -3.818678575125694e-01   +2.476727809080778e-01   +7.051884769640185e-01   -3.464467567887688e-01   -2.195290562516225e-01   -3.589858195456717e-01   +3.602271730155183e-02   -5.581419703320568e-01   +8.520613019120709e-01   -5.933050654278571e-01   +6.625730328047277e-01   +8.854452109082350e-01; -1.816907976693475e-01   +5.279903508529450e-01   -5.255110242015878e-01   +5.874073517926947e-01   +3.184358582951926e-01   +1.136530825290554e-01   -6.121130416850571e-01   +7.870649793417355e-01   +9.829811848605043e-01   -3.153186469496514e-01   -5.895309711001336e-03   -7.882554829311401e-02   -6.415373625240807e-02   -1.557531548352756e-01   -1.648612834684882e-02   -4.202041637451926e-01; +5.414993919038825e-01   +3.643105887519316e-01   +4.342434973655502e-01   +8.499743894641825e-01   +5.624917403760363e-01   -1.502919509749711e-01   +9.313785923289004e-01   -5.779906616266109e-01   +5.863958573505328e-01   -1.132533559918473e-01   -8.445187935544638e-01   -2.351297981563779e-01   -9.091630643770254e-01   -8.301674929415130e-01   -7.530522584157676e-01   -2.257071964734517e-01; -3.053318095020936e-01   -6.438158053721534e-01   +2.973303181590187e-02   +8.802620967949731e-01   -5.198630093695846e-01   -3.093258459094154e-01   +2.648689542034600e-01   +5.528776421221170e-01   -3.948859354017011e-01   +1.561394093305002e-01   -4.335021389531382e-01   +1.297334835170791e-01   -4.719073526944220e-01   -2.659290831235454e-01   -6.116029830781252e-01   -8.136896726259271e-02; +3.272528465769084e-01   -7.901901722410465e-01   -1.528777573917671e-02   -5.777171002983326e-01   -4.435457661638229e-01   -3.900811244142393e-01   +9.022671242298900e-01   +3.785793043322348e-01   +4.146917051590048e-01   +5.988630848408776e-01   +1.484971443647938e-01   -2.986119560261270e-01   +7.511501615009293e-01   +4.485599616337941e-01   -1.911412436661483e-01   +4.564155439896245e-01; +4.795783051425075e-01   +3.614135358285794e-01   -5.040878708924519e-01   +1.768903045005830e-01   +1.204615031852888e-01   +7.529872489409913e-02   +1.280860276096794e-01   +3.878888315240125e-01   -2.133182804899145e-01   +3.925918653154338e-01   -5.099662225567462e-02   +5.985259880446963e-01   +7.235185736570481e-01   -4.821137867793517e-01   +9.252677847889276e-02   +2.560304082221683e-01; -5.175967664047365e-01   +3.614373545601890e-01   -3.366169270985915e-01   -1.852321379490347e-01   +4.513173934177813e-01   +4.386915057089394e-01   -2.486051030700585e-01   -7.314204249848785e-01   -1.994159497011621e-01   -7.285804003185471e-01   +3.864004150745400e-01   -7.916088676865099e-02   +8.673727647366821e-01   +8.453513565300947e-01   +8.981117099945859e-01   -4.724462356379619e-01; +3.551149928990809e-01   -6.958204082375559e-02   +4.607987249651391e-01   -3.963880246459474e-01   +6.724822543079267e-02   +4.297390259581365e-01   +6.126718008765003e-01   -5.841009326693920e-01   +1.378828949002634e-02   +2.327251619064458e-01   -7.097902508133089e-01   +6.887790922043661e-01   -8.597696008006463e-01   -6.182654921614410e-01   -2.655782117855159e-01   -2.649748612463204e-01; +6.494029201304901e-01   +1.221653200256202e-01   +3.294581624933657e-01   +1.753660552639476e-01   +3.878514698177203e-01   +3.643165068756551e-01   +6.553057781535930e-01   +1.000000000000000e+00   +1.983639692266658e-01   +1.266228959272389e-01   -6.754260346649679e-02   -5.614582270652784e-01   +7.171171321410893e-01   -8.139462457386974e-03   +6.121113126582649e-01   -5.792334896199310e-01; -8.133502100455144e-02   +6.823890720009470e-01   -2.014799433050937e-01   +7.927697025155600e-01   -1.235596811094700e-01   -1.886876249833544e-01   +5.747097674132530e-01   +3.888873849202643e-01   -5.464560644132821e-01   +3.608319679279011e-01   +4.503510962145930e-02   +1.229642887360406e-02   -1.511656335798272e-01   -4.214004549383629e-01   +5.306889427790522e-01   -1.974920384698452e-01];
L2I_L1I_iGABA_netcon = [+8.225551035293776e-01   -6.048030461031088e-01   +4.432557544881938e-01   +2.430485980999349e-01   +1.982823481633418e-01   -8.570299141368009e-01   +3.740653398689608e-01   +6.945876190588456e-01; +8.369849374917644e-01   -7.873124352472701e-01   -7.032415434097207e-01   +3.838766627532189e-01   +2.579113625483386e-01   +4.276333140317315e-01   -5.457128668420316e-01   -5.679404436218987e-01; -7.208755835479919e-01   -7.692749908593265e-01   -3.621327563456896e-01   +2.400729480181318e-01   +3.458720232722918e-01   -5.724889949767340e-01   -1.558826300068696e-01   +1.000000000000000e+00; -3.957848161466656e-01   +5.292496257586670e-01   -5.841327536053479e-01   +7.224291823490768e-01   -5.398098476394974e-02   +2.551496734513428e-01   -6.029202288464047e-01   -5.082735837142093e-01; -2.137178912194064e-01   +1.737268908383363e-02   +2.777522193929031e-01   +6.102068780677681e-01   +6.511673509021367e-01   -2.566691997410254e-01   +7.998973494721716e-01   -8.507812852604954e-02; -4.728251580262106e-01   +4.423542246612369e-02   -2.155806943420112e-01   -4.788614808785667e-01   -7.885096224330562e-01   +6.468844574664981e-01   -4.963727658076093e-01   +8.092016140005169e-01; -5.878582411086568e-02   -2.339430263451674e-01   +5.920333375380696e-01   +3.405975617897251e-02   +7.783139583680166e-01   -4.110311280052568e-01   +8.314214692890957e-01   +2.549887364959925e-01; +6.875562011832665e-01   -6.116432492680510e-01   -4.873050419205871e-01   +2.959006340915915e-01   +1.807966149075847e-01   +1.935746041376296e-01   +1.889905035634350e-01   +1.129378824356110e-02; +2.484917506426180e-01   +6.420689986575012e-01   -2.333339760743447e-01   +5.617373942064035e-01   -3.788209655109680e-01   -1.671892794738161e-01   +8.402860590919131e-02   +1.176983340949562e-01; -4.846740395813743e-01   +4.632183303989384e-01   -1.924089973230822e-01   -1.690143813816247e-01   -1.810586839523248e-01   +1.488654370364589e-01   -2.586998122368113e-01   +1.679547263593050e-01; -8.064571158686397e-01   +3.134601326998065e-01   +1.986528022037535e-01   +7.594259933948434e-01   -1.148184268067747e-01   +4.858023428428205e-01   -1.990990492748806e-02   -3.552290909665097e-01; +7.025157974399624e-01   +5.333334527518664e-01   -3.085760595236917e-01   +4.821920390498767e-01   -1.566241068508343e-01   -8.149306030593730e-01   -5.447004542061867e-01   +4.223641593981675e-01; +1.374633865845817e-01   -4.867140696509704e-01   -1.277358677379997e-01   +8.224822898284697e-01   -1.379517713223211e-01   -4.250038156796456e-03   +1.125944912019584e-01   +2.994991817838745e-01; -9.000290590842745e-02   +4.463402105541741e-01   -9.498196505954695e-01   -4.158215685032888e-01   -4.485176554889786e-01   +6.780199901077668e-01   +1.414218419811134e-02   +7.481344019675417e-01; +4.228158473528806e-01   +2.017294397380135e-01   -3.923070661030306e-01   +6.317422258708029e-01   -4.768138216912834e-01   -1.719855608040281e-01   -1.854632492622769e-01   -1.272600177709835e-01; -5.697578334148699e-01   -4.794472018474553e-01   -6.950086435826467e-01   +5.855516554587016e-02   +2.406037397270825e-01   -6.269462279272831e-01   +7.197057971837714e-01   -4.896890139291956e-01];
L1I_L2I_iGABA_netcon = [+7.648203375030880e-01   -1.314920540935803e-01   -5.700954704293161e-01   -9.663735877991693e-01   +2.765566903117562e-01   +5.192445938635893e-01   -3.346567412709464e-01   +9.039184556450455e-01   -6.023095777397015e-02   -8.704929624244410e-02   +2.819857905147003e-01   +5.930618658681572e-01   -6.747400068403216e-01   -1.422977945396132e-01   -1.392642813658979e-01   -3.426369565496749e-01; +8.124428352182436e-01   +6.343531649819835e-01   +6.039292045023657e-03   -4.138180481680750e-01   +3.171816303624480e-02   +4.538269314899187e-01   -3.379502730075450e-01   -6.387502020043070e-01   -4.048177585551067e-01   +4.723177534287457e-01   -2.652541284331452e-01   +9.257363074470709e-02   +6.163796786543698e-01   +1.467608422998628e-01   -1.722211734744118e-01   +4.410128649746619e-03; -9.010979535419463e-01   -8.228676774022339e-02   +1.924308174547911e-02   +7.197420445168163e-01   +7.808324849779794e-01   -6.777745705462329e-01   -5.288689620130296e-01   -5.972339312346451e-01   -8.891292745381979e-03   -6.635950781941600e-01   -4.802994471730659e-01   +4.184631631442449e-01   +9.380219731692629e-01   -7.290413730789792e-01   +6.267527561781154e-01   +2.710729602018992e-01; -6.700383780130617e-01   +5.708221097894490e-01   -9.897056363913967e-02   +1.411192215567720e-01   -6.232464120212220e-01   -6.267276686766590e-01   +3.599962675524148e-01   +8.606752380047827e-02   +2.217558756821188e-02   -3.419337620481643e-01   +4.685897671004905e-02   -3.167462346339591e-01   +9.694051492003747e-02   -3.850799492725526e-01   -3.622850682557966e-01   +7.766058810939729e-01; +8.885267976701141e-01   -1.346524190593406e-01   +2.834016980357038e-01   -1.927329219186841e-01   +4.456928644520830e-01   +1.455235564293677e-01   +3.697852725042255e-01   +5.384161668684604e-01   -5.917049278391531e-01   -5.505041283558477e-02   -1.509938661104575e-01   +6.708780193690758e-01   -2.384184072863958e-01   -4.605555865662563e-01   -9.708075535029759e-02   +5.204484490795804e-01; -2.389527392939004e-01   +6.642977841021253e-01   -3.355815226985537e-01   -3.465011342803446e-01   +8.572380242558398e-01   +8.533439878649741e-01   -2.471803651920040e-01   +6.392969752097514e-01   +8.182826094185643e-01   -7.002833141857645e-01   +4.445817437540920e-01   -6.576802677482395e-01   +8.608447467981886e-01   +3.384886600623005e-02   +4.923124519373783e-01   +5.729901573766458e-01; +7.899089617838887e-01   +2.643161059809983e-01   -4.791306113950785e-01   +4.680712004539732e-01   +2.303749122318094e-01   -3.941733988345211e-01   -5.683273333494165e-01   -7.343634448935726e-01   +9.191317380497002e-01   +1.462462361396308e-02   -1.406506991418642e-01   -2.003794394608461e-01   -7.663470344292199e-01   -3.295436863329700e-01   -6.276011667437900e-01   +1.000000000000000e+00; -2.085007452566338e-01   +6.365140647697026e-01   +9.685486864106556e-02   -2.587279124572037e-01   -8.429598604730366e-01   -8.188104070485759e-02   -6.273483341927367e-01   +4.543468585069263e-01   +7.972851841496891e-01   +3.853323705894067e-01   +2.162154558121498e-01   -3.999421806930292e-01   -3.297193694582307e-01   +3.551673996084015e-01   -3.257040172672008e-01   -2.302962273975671e-01];
L2E_L1E_iAMPA_netcon = [+2.250096430790815e-01   -2.541227210174744e-01   -2.645106594511747e-01   +2.615158670158408e-01   -6.907577795340289e-01   +8.503909316958312e-01   +6.267352533753302e-01   -9.009587835363667e-03; -4.111442561398078e-01   -3.889741355137706e-01   +2.784303944486977e-01   -4.283034676863269e-01   -2.715207356375891e-01   -9.785734506916135e-01   -2.205097045529961e-01   +9.834240482359938e-02; +6.551167957099561e-01   +2.341955288114910e-01   -7.748986431463354e-01   +5.787021173971659e-01   +5.756391147890148e-02   +7.751105365911839e-01   +5.566419209409634e-02   -7.275449422110274e-01; +2.061540627956988e-01   +6.864305081786598e-01   +2.726005641612606e-02   +6.547738053245803e-01   +1.000000000000000e+00   +7.101977185641357e-01   +3.761293991934271e-01   +5.556316609794048e-01; +7.267709400832864e-01   -9.485891119216793e-01   -1.020968264857675e-01   -4.998411376735733e-01   -1.395270038530565e-01   +7.036703705532817e-01   +2.887021730697407e-01   -6.508625131162992e-01; -2.482573472261629e-01   +5.811124427426451e-01   -7.308186282192232e-01   -6.246058861972060e-01   -2.072556586007409e-01   -7.839209500077283e-01   +7.077658282509708e-01   +6.280158707354839e-01; -7.325975397606824e-01   -4.895420516309545e-01   +7.266311547025367e-01   -5.420537374072475e-01   -4.178051853016325e-01   +4.945188840334265e-01   +2.016211084738699e-01   -3.379716313563181e-01; +6.356616688910946e-02   +3.382760312929358e-01   -5.558323942800166e-01   -6.992616305541638e-01   -4.514828055650620e-01   +5.488386788717265e-01   -5.422421303205968e-01   +5.320650921585395e-01; +3.771810352969087e-01   +7.034706198182145e-01   -2.698835856893867e-01   +7.185178269342439e-01   -3.420145770466699e-01   -5.592768675810759e-01   -5.141828348902231e-01   -3.152065999338007e-01; -6.096643928971405e-01   -2.259034375734993e-01   +9.621305853617949e-02   -5.979409879701516e-02   -3.934611235825294e-01   +3.177008567663878e-01   +2.681421919243996e-01   -4.997923303168741e-01; +4.367529293440925e-01   -7.812693020297000e-01   -1.266113662787123e-01   +5.509465209949789e-01   +7.410581914889478e-01   -2.902421812721885e-01   -2.734184032892212e-01   -2.546713913803347e-02; -4.115071917071604e-01   -1.314311885395492e-01   +7.856018632037541e-01   +4.966118546236464e-01   +3.902145994115354e-01   +1.017552670652873e-01   -8.084004931234343e-01   -2.975416454033251e-01; -4.665816274463853e-01   -8.234192174023696e-01   +5.010578525122726e-01   -8.047867066082032e-01   +3.249478519815352e-02   +2.664442377434295e-01   +2.915567992113597e-01   +7.877404924530702e-01; -4.512086705499537e-01   -8.598196420954081e-01   +4.919630757551804e-01   -7.059418260819482e-01   +1.047958911559837e-01   +6.235314120018075e-01   -4.003579092846004e-01   +4.478426007771971e-01; -5.342067811128577e-01   +3.639854047354830e-01   +7.278883814620478e-02   -4.683833294165853e-01   -4.794895283827861e-01   -2.411459270718636e-02   -8.563327354733893e-01   -6.042490922746722e-02; -5.848119123624362e-01   -3.629541706576635e-01   +4.908283723299828e-01   -2.426743191076055e-02   +1.615180594463853e-01   -6.856143673174139e-01   +4.886003739455064e-01   +2.228513632909004e-01];
L1E_L2E_iAMPA_netcon = [-7.935711291157737e-01   +2.385170924437658e-01   -5.847235489167291e-01   -9.603170137047012e-02   +7.506127732634774e-01   -5.936931518470142e-01   +9.844800188480628e-01   +3.730123403560319e-01   +7.170759532924119e-02   -5.642477274623936e-01   -1.961111072119860e-01   -1.738209622276829e-01   -4.549030237103459e-02   -2.468340988238012e-01   +4.818323227870356e-01   +4.280101288935184e-01; -6.073519933410781e-01   +4.476766371557064e-01   +2.516397026826701e-01   -9.274241995602392e-01   -5.333182528049143e-01   -4.167811097189938e-01   +3.308549058072123e-01   -6.450535038357106e-01   -4.676210086788587e-01   +8.681288828294328e-01   -5.786055235303559e-01   -1.306770219272227e-01   +6.656824946363211e-01   -4.597249694392076e-02   -7.086156900579043e-01   -5.848222895193008e-02; +9.863366757882570e-02   -8.934319849491352e-01   -9.288208544243619e-01   +9.776891995349913e-01   +7.138247929473996e-01   -2.556799113789147e-01   -5.262197304258026e-01   +5.059129947240240e-01   -4.913365447366088e-01   -7.389924457437957e-01   +2.694901075781798e-01   +3.624935378804735e-01   +4.772340299734651e-01   -4.448234587065421e-01   +6.161232051753776e-01   +4.179696210672045e-01; +8.564467930669791e-01   -1.210213398365123e-01   -7.915483423097555e-01   -4.937040771429130e-01   +8.498896818840919e-01   +1.264043194770162e-01   +6.776819184664860e-01   -6.013541551979791e-01   -4.055395121561233e-01   +5.107922020164370e-01   -2.950665814983200e-01   -7.704068928190346e-01   -1.878743788850726e-01   -7.509976969176616e-01   +3.426833738077427e-01   -8.161866031369227e-01; -2.578558331900799e-01   -4.552434118148022e-01   -7.433042875055031e-01   -7.324671718713318e-01   -4.946269722260435e-01   +2.910086204025517e-01   -4.097713474385479e-01   +7.148199426615653e-01   +6.013422944519058e-01   +4.010484782181826e-02   +1.000000000000000e+00   +1.584867278998674e-02   +1.479153982041916e-01   +4.287476985278689e-01   -4.646594372201359e-01   -9.067868780758288e-01; -1.909328903950516e-01   -5.520772647550160e-01   +6.221346543439313e-03   -4.730147290157734e-02   +5.793921861588410e-01   -3.631401404086858e-01   -3.923313480444368e-01   -3.327971901265087e-01   -7.466369110166604e-01   +4.876236124572770e-01   -2.397279245116943e-01   +9.734580795221946e-02   +2.161947562152107e-01   -3.812201145171234e-01   +4.429232348007296e-01   -2.590951767245103e-01; +1.842244887515687e-01   +5.684325100563183e-01   +1.158287853565133e-01   +2.572329263833369e-02   +1.757272899385787e-01   +4.764725949766537e-01   +8.533822988638805e-01   +8.131284398752643e-01   -3.146226816991236e-01   -4.518252222227622e-01   -5.669475198988888e-01   +2.302918304802483e-01   +2.157859323067511e-01   -8.243388513762135e-01   -7.254946332430292e-01   +3.069165058878923e-01; -5.435367461337259e-01   -1.805672625706137e-01   +5.491544601793263e-01   +6.418897285552433e-01   -6.692883317382952e-01   -8.254257286841919e-02   -2.576149787146063e-01   -5.898228185263061e-01   -2.931162141287139e-01   -1.771427527224562e-01   -2.770883245303335e-01   +3.948082128511253e-01   +4.196395697555987e-01   +9.716364046377844e-02   +1.575655779037013e-01   -4.683514790541588e-01];
L2I_L2E_iAMPA_netcon = [-4.529289285810733e-01   +8.199872978448509e-01   +6.144206691853301e-01   +5.796757888892748e-01   +7.672688455626476e-01   +5.716474044215023e-01   +5.776142503858676e-01   +8.302980145229922e-01; +5.869257772756701e-01   -6.677843456952004e-02   -7.421813855330642e-01   +7.833669223864585e-02   -2.413480473586923e-01   -9.156723845868786e-01   +6.856254144623861e-01   -2.701440055689211e-02; +7.845587194270979e-01   +8.478326610965997e-01   -1.915710970963919e-01   -7.842043237150518e-01   -4.839843332816480e-01   -3.394678619712710e-01   -4.647012842560821e-01   -1.776948198948606e-01; -5.931406400160054e-02   -4.036590240884401e-01   +7.393925247645504e-02   -1.144574276880641e-01   -6.073147109561307e-01   +5.916374338842081e-01   +8.797350101019993e-01   +2.854928061783458e-01; -4.022569999642432e-01   +7.422658600456138e-01   +1.846178376875922e-01   +7.402945623440352e-02   +3.733254178537388e-01   -4.740994759512246e-01   -8.435403798380017e-01   -3.444941389990606e-01; +6.172105802709260e-01   -7.700404115747261e-01   +1.950940907006887e-02   +2.048425341423219e-01   -5.194782159206908e-01   -5.114961792332435e-01   -3.071423540337210e-01   -8.715094595289926e-01; -7.684384994440180e-01   +6.554298987488308e-01   -2.575946941462398e-01   -3.599748272769866e-01   +6.032377651856903e-01   +8.658800066182978e-01   +8.460224109019722e-01   +7.318730199084875e-01; -1.000000000000000e+00   -9.903934809288278e-03   +8.258463501348600e-01   -4.478697467638255e-01   +1.707789951813998e-01   -4.351472043251731e-01   -2.740416181293795e-02   -6.048216152333536e-01];
L2E_L2I_iGABA_netcon = [+8.283974619646519e-01   -5.668652623994314e-01   -1.361111306977720e-01   +7.127727560772653e-01   +3.638683216917247e-01   -4.520248578037525e-01   +3.405999236619697e-01   -1.000000000000000e+00; +1.551316757025569e-01   -6.401022671033891e-01   -2.301598639494469e-02   -3.085527507638166e-01   -9.745227546801537e-02   -1.288570559138768e-01   +6.226812762637219e-01   +2.954681137834160e-01; -3.946622427827053e-01   -1.939041358253944e-01   +9.192266902235963e-01   +3.964827708409895e-01   +5.090321914730992e-01   +5.857963147671067e-01   +2.740360134385592e-01   -5.080258592302693e-01; +8.843720651928278e-01   +1.826931743090160e-01   -3.170732376861586e-01   -9.602091198691337e-02   -2.374187541456454e-01   +4.791739628754099e-02   -4.004325849085343e-01   +7.936837788005536e-01; -3.079489918455416e-01   -3.495488551066558e-01   -4.056055453394656e-01   +6.177305989114130e-01   +2.870126060574917e-01   +6.017735613112010e-01   -1.807768915327245e-01   +4.983737220991240e-01; +6.352231401637797e-01   +4.035115533033449e-01   -3.823580055185645e-01   -5.668476807683824e-01   -3.618557637308975e-01   +5.299516269982747e-01   -4.425647111759562e-01   -7.184426787176412e-02; -1.163335518917625e-02   -2.531680756742788e-01   -6.473714335292431e-02   +8.479326092052890e-02   -6.707574244534144e-02   +1.159456030028433e-01   -7.344619683374841e-01   -5.480345219083797e-02; +4.159364161634782e-01   -6.546307985563628e-03   +7.952079887626973e-01   -2.530591433805451e-01   -2.306965270888537e-01   +2.617838254258716e-01   +2.253946805513289e-01   +6.061910760291296e-01];
L3E_L2E_iAMPA_netcon = [-8.414205779374846e-01   -7.878524911688617e-01   -5.515307415885107e-01   -6.556756449172422e-01   -1.229979159921967e-01   +6.668976057950902e-01   -5.432338705905602e-02   +1.519228360786092e-01   +2.338522696113088e-01   -6.470745849999547e-01   +5.363149735559745e-01   -2.528102493909676e-01; -2.157357081864560e-01   -9.578082273456933e-01   -1.938186450076595e-01   +7.154310680180079e-01   +7.692578397270837e-01   +2.381282794946384e-01   -5.885800709601190e-01   +4.847502984459729e-01   -2.966016007146264e-01   -5.826636291959917e-01   -2.706482468679782e-01   -8.962586163336508e-02; +2.101742290754460e-02   +8.548639787775506e-01   -4.157576774669113e-01   +5.332017097693325e-01   -8.793063656437867e-01   -1.557691103158440e-02   +2.321124558311647e-01   -7.776599797978498e-01   -8.025119212611336e-01   +3.757449630961267e-01   -6.165831921503303e-01   -6.716882904807326e-01; -4.236875732443655e-01   -5.201005696018293e-01   +5.985254373367958e-01   -5.556732420323162e-01   +3.559541738184320e-01   +8.966647758038290e-01   -1.196174716946667e-01   +1.449350332352589e-01   +1.156013979709030e-01   -4.637640462470173e-01   +5.349354059487945e-01   -4.194321155583889e-01; +1.001577414096641e-01   -2.920481677764338e-01   +2.341539303435436e-01   -8.420581035001511e-01   -5.490030321700162e-01   +6.092923139048481e-01   +2.569500526460133e-01   -1.135930070518905e-01   +9.053305186968792e-01   +5.103209698236768e-01   -1.286640321591657e-01   +5.348064541936522e-01; +3.080088061551413e-01   +3.264046411177291e-01   -1.036564179449448e-01   -4.000904898539678e-01   +5.159628544472485e-01   -4.380965701912682e-01   -2.423172343571203e-01   -1.000000000000000e+00   -1.627255986395092e-01   -5.871740880713880e-01   -7.488675160825718e-01   -3.501099917325892e-01; -6.231770313786321e-01   -2.806424389434103e-01   -7.111078452640417e-01   +5.403121142381582e-01   -3.544340727340456e-01   +7.712871945493933e-02   -4.451857438543952e-01   +7.154082437555578e-01   -4.285665426816146e-02   +7.705634206109338e-02   -2.727205453040765e-01   +2.593554467446342e-01; -5.691932666511406e-01   -5.064699418300802e-01   +2.489141827107010e-01   -6.633128663986825e-01   +6.890306480249865e-01   -4.387220083784428e-01   +1.907591864875881e-01   -6.138156150912190e-01   -4.998415678895250e-01   -4.784498936991796e-01   -7.435973391213478e-01   +4.149255666499503e-01];
L3I_L2I_iGABA_netcon = [+7.023472161471968e-01   -3.447194636474162e-01   -5.261614359040464e-01   -9.477353333811740e-03   +9.094218627317237e-01   +2.591998791950539e-01   -2.815367141759317e-01   +5.291822802426650e-01   -1.711026170403795e-01   +1.846156107330410e-01   +3.866274983226267e-01   +4.699282887064050e-01; -3.310255218038287e-01   +2.296163373282022e-01   +5.233348920064957e-01   +1.547440687241932e-01   -9.700225743254808e-03   +1.431874383066372e-01   +6.299002200611485e-01   +7.019921941094845e-01   -7.229562444697137e-02   +7.045595137385751e-01   +4.111584242639997e-01   -4.515496623136446e-01; -9.736355739408832e-02   +4.505808191031849e-01   -4.527248348267526e-01   -5.346785438795056e-01   -5.847636682531689e-01   +7.927421025802423e-03   +9.138529051516691e-01   +8.595184002049392e-03   +1.196346191364258e-02   +7.731891955953090e-01   -3.763797046604535e-01   +5.823224021677889e-01; +4.503155120667301e-02   +4.802338670069141e-01   +3.431708050940710e-01   +8.529027401403740e-01   +8.426479678095731e-01   -3.456412004108922e-01   +8.049162423660137e-01   -3.598365046182236e-01   -1.478675351554308e-01   -3.471315153502810e-01   -2.833158260665099e-01   +6.627953560123244e-01; -1.941183105356684e-01   +1.405521546507265e-01   +6.526671724606420e-01   -1.127951775209999e-01   +6.560441050080515e-01   -3.373062890882224e-01   +3.280153158562518e-01   -3.452546110829097e-01   -1.647340414816170e-01   -4.996739295104827e-01   +3.489292131830378e-01   +4.126042735184970e-01; +7.596318744944123e-01   -4.397341577581098e-01   +4.517471347341843e-01   +1.000000000000000e+00   -2.121219612648734e-01   +6.034345230235579e-01   -6.524460013759111e-01   +8.067158024180974e-01   +5.523781487893789e-01   -4.101249839781504e-01   +3.800739023934663e-01   -1.740225332523292e-01; +4.303225204827855e-01   -5.070105596159802e-01   -4.344812686857530e-01   -1.157879440639901e-01   -6.682058656508298e-01   -1.442837557412830e-01   +7.580909664551311e-01   +3.001941062785888e-01   -3.577346579076484e-01   -6.079747111511291e-01   +2.967473957720095e-01   -2.383166970599765e-01; -3.779663007581331e-01   +5.480048153187708e-01   +2.081466918995556e-01   +7.838130429844871e-01   +7.339734698627099e-01   +3.981443103382868e-01   +6.198187728086207e-01   +2.990282986685768e-01   -5.700332393656190e-01   +2.308428593498007e-01   -5.680544998790743e-01   -6.536826802868179e-01];
L2E_L3E_iAMPA_netcon = [+5.617386865886513e-01   -1.800051158476461e-01   -2.575984201343369e-01   -5.762938793807644e-01   +8.141679165771453e-01   -3.783993919013651e-01   +6.798704567562013e-01   -1.814209126291286e-01; +7.963300839089394e-01   -6.817127299175041e-01   -3.236563840589086e-01   +5.489771012605721e-01   +1.386992032618943e-01   +4.219557580150896e-01   +1.444494961081464e-01   -2.233629586947213e-01; +6.923509340160188e-01   +5.867692232000976e-01   -1.789149770403305e-01   -2.776295488262953e-01   -4.689346276023428e-01   +1.871651306985309e-02   -7.220429721819402e-02   +6.602099758510569e-01; -6.513380412857663e-01   +5.270253153264773e-01   +5.121020524903291e-02   +7.979324565169783e-01   -4.972934117104993e-01   +4.076822495541062e-01   +3.136219537036919e-01   -1.304726001830585e-02; -1.618621059220194e-01   +5.150131570658547e-01   +2.826462106565859e-01   +5.870299758760765e-01   -6.276667269232502e-01   +5.417428257042078e-02   -9.225550715681173e-02   +1.197401819297744e-01; +2.207310399171474e-01   -2.345454537954247e-01   +1.045337570936895e-01   -7.641234934014444e-02   +1.825211563760606e-01   -5.249749913273201e-01   +1.562185030030660e-01   +3.966186302551737e-02; +4.607950389223991e-01   -4.609625283611271e-01   +1.584577835878882e-01   -1.408317829574589e-01   +2.613914996660259e-01   -3.603877558205947e-02   +8.587866771674605e-01   +6.524740755513240e-01; -1.655237373415900e-01   -6.895478999024733e-01   -4.064629131427829e-01   +6.979254407705491e-01   +2.165695550016526e-02   +1.010646483304509e-01   +6.630487002002043e-01   +3.152740466362691e-01; +8.848282912851179e-01   -6.426046799082914e-01   -5.264540511073780e-01   -2.908512149562338e-01   -1.698720268313090e-01   +6.084191626996870e-02   +2.340679477743748e-01   +2.014552810233438e-01; -4.287514792312700e-01   -4.675071048820734e-01   +2.665515557325502e-01   +3.688149075118773e-03   +4.170290796386629e-01   +9.738931120731711e-02   +4.069335569936961e-01   -4.484571075722587e-01; -6.837742966269070e-01   -2.139095074884698e-01   -8.465750929818978e-01   +3.695913915994272e-02   +3.917993822248731e-01   -9.207299803293457e-01   +5.246865471570407e-01   -6.691232738636643e-01; +2.301871314366896e-01   +4.340742452355894e-01   -1.395045298725987e-01   -1.000000000000000e+00   -6.879741073603110e-02   +9.893605036888493e-02   +2.708154184067582e-01   -5.804191021317023e-01];
L2I_L3I_iGABA_netcon = [+7.203296968705681e-01   +5.656587810521877e-01   +1.990943656147071e-02   -9.137476283378794e-01   +7.632165310512944e-01   +1.119469473574842e-01   +5.561742194589937e-01   -4.696436895563540e-01; -3.442672718511846e-02   -2.937031338604340e-01   +3.540237449661566e-01   -7.079821956212734e-01   +7.392888954359597e-01   -7.124537610505980e-01   -3.493148065965022e-01   -4.439182180165204e-01; +4.222195717452232e-02   +2.505272178407456e-01   -2.412421357388808e-01   -6.118696192117432e-01   +4.211556604227685e-01   +3.802167295727036e-01   +6.330060354674051e-01   +3.417775403523964e-01; -9.656861060514781e-01   -7.683798924565236e-01   -6.294420474776046e-01   -3.214024014183347e-02   +1.855545348317871e-01   -3.759324788791485e-01   +4.112423312052015e-01   -5.444250904705831e-01; -1.335900648461704e-01   +3.571303487288685e-01   -2.650127241957068e-01   -5.495668056700137e-01   -8.487262941620967e-01   -5.808245358703695e-01   +8.444864481786289e-01   -5.568556302434462e-01; +6.860247369349461e-01   -4.196012821190919e-02   -6.690573223386275e-01   -5.872839372286790e-01   -5.491479991368626e-01   +5.572117356115673e-01   +2.372275876555602e-01   -3.562710308158338e-01; +1.835053483446544e-01   +6.435407421704884e-01   -7.860999065198196e-02   +6.681533172564209e-01   +6.873612982421147e-01   +3.290566785068151e-02   -8.985251385175771e-01   -3.079301530645187e-01; -8.322511320407687e-01   -2.207895514179359e-02   +6.183440268644936e-01   -1.427873346153556e-01   -1.256466167824114e-01   -1.000000000000000e+00   -7.060962317736506e-01   +5.584046503246406e-01; -2.932777315995286e-01   -8.050607811227579e-01   -2.376767488081012e-01   +6.744098706364994e-01   +5.388599427156582e-01   +1.093171675797801e-02   +8.738275111692638e-01   -5.036112331276693e-01; -6.125980313285215e-01   -5.027050048677127e-01   +7.601575142695665e-01   -4.112513318755820e-01   +8.202533252953083e-01   -4.304301030598985e-01   -1.766677229210692e-01   -5.206458047411500e-01; -7.188875375051684e-01   +1.092071542250774e-01   -3.842513965827170e-01   +5.936392852553561e-01   +5.471551714663236e-01   -1.290049490313094e-01   -2.593405630871942e-01   +5.300947027014526e-01; -1.992311199507769e-01   +5.153625361001938e-02   +2.452067399003513e-01   -7.296361788025494e-01   -3.691507040204992e-02   +1.821852320851866e-01   +7.655031628076751e-01   -7.888389977876581e-01];
L3I_L3E_iAMPA_netcon = [-5.784106315192847e-01   -3.418631373647256e-01   +1.965436537986914e-02   -2.313765039019867e-01   -1.841907576706752e-01   +9.409558538327522e-01   -1.320766774607781e-01   +3.091890565241050e-01   -9.092291248422048e-04   +3.245057816420781e-02   -4.989667474745849e-02   +3.938526332205232e-01; -2.996241577844366e-01   -1.703536796628642e-01   -4.527192271168444e-01   -9.374552336588344e-01   +3.113311508292804e-01   +6.960499648417066e-01   +1.943294789513654e-01   +1.289756783854185e-01   +7.206710825482364e-01   +4.553213214026724e-01   +9.579609891036535e-01   -6.518494584466674e-01; -2.101735988370588e-01   +3.284216836619561e-02   +8.495762221274517e-02   +4.419158003627865e-01   +2.534842888544334e-01   -2.947988058766101e-01   +6.811698145043827e-01   -7.248067773195883e-01   -1.645333930224232e-01   -6.980722151518400e-01   -4.663396690876226e-01   +4.795389343496983e-01; -6.909530541182521e-02   +4.703956364074104e-01   +8.949200049497951e-01   -1.314033556187229e-01   -5.396628845577819e-01   -5.459870627174512e-01   -2.997012924777078e-01   -6.832537514919206e-01   +5.260922161553854e-01   -1.916957324464677e-01   -7.176658839430988e-01   -5.861768036456630e-01; -4.869259616596830e-01   +2.863487752443224e-01   +2.864212763244503e-01   -1.569514186084310e-01   +4.405866179641959e-01   -1.583141238099827e-01   -2.766458632250745e-01   -5.237569913131407e-01   -6.498217869141693e-01   -1.048840884522743e-01   -6.527787746026686e-02   +4.861481273862081e-02; +2.916327870049838e-01   -5.759030344027819e-01   -4.879028362337559e-02   +4.486262462685137e-01   -1.390935692419396e-01   -4.589154798222879e-01   +4.125338387925818e-01   +9.671431439117226e-02   +6.172239868372563e-01   +6.090163081401598e-01   +1.145681586416064e-01   -1.470912905544171e-01; -4.956356701330125e-01   +7.621150469072507e-01   -5.095440590687982e-01   +7.375095416672116e-02   -8.511377214822717e-01   -3.702411968746570e-01   -8.066815039274043e-01   +4.159895370487542e-01   +2.575106419965582e-01   -4.663114848091258e-01   -4.097422798256445e-01   -3.152077684079136e-01; +5.389603428851683e-01   +3.844107149092165e-01   -6.127374251533487e-01   -2.504092733346884e-01   +8.567532509275071e-02   +1.993112454194656e-01   +2.539128514294891e-01   +2.962622994065762e-01   +2.310559703344672e-01   +6.174056523240928e-01   -2.774714262770790e-01   +2.401018604125459e-02; -5.575861665965646e-01   +1.265295939795509e-01   +7.930219494613309e-01   -4.372522717778844e-01   +7.532565926491087e-01   +5.323559433472376e-01   -4.910401192529381e-01   +2.417215787044812e-01   +6.063265280250126e-01   +5.085447374236267e-01   +3.272401939639114e-01   +2.389864394033236e-01; +6.574666530277858e-01   +1.000000000000000e+00   +2.889393554481915e-01   +6.014547879498193e-01   +9.509002094438024e-01   -5.623502473790690e-02   -8.494702480845647e-01   +3.425545994130905e-01   -6.391721691877986e-01   +6.456826952279668e-01   +7.638111255154557e-02   +2.230278617847686e-01; +6.923370968664836e-01   +1.258567102050286e-01   -4.254732095803965e-01   -8.811008463806779e-01   +3.290732517163831e-01   +4.281243173005140e-01   -5.895375685107785e-01   -1.961641181341330e-01   -1.802842192907854e-01   +1.576743513501752e-01   -2.862446308275254e-01   -3.657198234840083e-01; +2.983905299956129e-01   -5.467821170424410e-02   +6.554098166089797e-02   -2.167655946467439e-01   +7.816141576023298e-01   -6.248925059612205e-02   +3.348228501229693e-01   -3.500475892363695e-01   +5.970868344049834e-01   -5.338574977193701e-01   -4.514840211140095e-01   +3.719882227637695e-01];
L3E_L3I_iGABA_netcon = [-2.039028300464690e-01   -2.162985699765452e-01   -2.971555633111130e-01   +7.905347186877698e-02   -2.788035897316345e-01   +2.707167859361063e-01   -2.642402118434414e-01   -3.299414425723420e-01   -8.319495017515820e-01   -6.408306013154611e-01   +2.432407511085663e-01   +5.598837887129274e-01; +2.712215437584838e-01   +2.122524023454234e-01   -7.621375637919122e-01   +3.326627477978758e-01   +9.327779913033535e-02   -4.377805563656265e-01   -4.809759752943506e-02   +4.151568780705109e-01   +8.170809491381480e-01   -4.476809391599714e-01   +7.189454583422827e-01   +1.154796091583875e-01; -6.832386079345686e-02   -4.072916967233747e-01   -2.103885574831866e-01   +3.354249324114921e-01   +2.988588347878353e-01   +4.074431926226816e-01   +5.791017073839833e-01   +8.382349831653180e-01   -4.735522640700596e-01   -2.119474780532725e-01   -7.436240791428835e-01   +7.303478199135270e-02; +1.064844111030246e-01   +4.244411481534529e-01   +2.916697669892618e-01   +8.234518338917419e-01   -6.553418000690822e-01   -8.274778124484695e-02   +9.287068005201249e-01   -5.186904304419794e-01   +5.166681592602947e-01   -7.332394838534187e-01   +4.164683428105140e-01   -5.442665640394456e-01; -1.251680809637394e-01   +5.415538768346709e-01   +5.558582194195953e-01   -2.276328846751382e-01   -1.320660754657571e-01   -8.991576440957776e-02   +5.494339059549445e-01   -3.408616531309325e-01   -6.003298632233659e-01   +4.184326718350886e-01   -4.397966531269126e-01   -9.275821353661772e-01; +4.064367661738889e-01   +7.356417943133801e-01   -4.738466178464124e-01   -7.204460335404792e-01   +9.175298080987954e-01   -6.114924723012369e-01   -5.528767321830336e-01   -3.636533731657044e-03   +5.937334431419062e-01   -3.043600177369411e-01   +1.094650193148139e-01   -2.109731268270608e-01; -9.724188702078176e-02   +4.499735110274311e-01   -1.925185909192813e-01   +4.468202171373879e-01   -5.511120295573695e-01   +4.330270717770133e-01   -2.079509129626885e-01   +1.786108553655969e-01   +1.000000000000000e+00   -1.548132406603749e-01   -1.614837864613091e-01   -1.022286789988568e-01; +5.659829202558129e-01   +2.246457709537885e-01   +2.184828260210874e-01   -6.840774795542430e-02   +5.809043486357474e-01   +9.324532011153686e-02   -1.699855701656870e-01   +2.459024839665815e-01   -9.042806300442194e-01   +6.202140251633943e-01   -8.379984519506625e-01   +2.249473212798736e-01; -7.774268176364458e-01   +1.881305036792617e-01   +6.182924900352040e-01   +2.298962702876112e-01   +3.789587320317711e-01   +1.654818179933926e-01   -3.136960230025878e-01   +2.148041034348915e-01   +1.093917243163381e-01   -2.010922734440070e-01   -3.084541435424636e-01   +7.009971525478730e-01; +3.199332238408858e-01   -3.406170666711985e-01   -2.584399893413730e-01   +2.159687596206111e-01   -5.575250285211448e-01   -4.801661315521960e-01   +6.700315318499881e-01   +4.368415288076750e-01   +6.267949989475319e-02   -1.065311384632204e-01   +1.734257084993645e-01   +7.958103101094454e-01; +2.916930734380624e-01   -5.696033565317147e-01   -2.360741082579949e-01   +2.348429295361118e-01   -4.008252575551301e-02   -1.891444358914122e-01   +6.477330840324853e-02   -2.579705193379314e-01   +2.398077273276983e-01   -1.713616124159109e-01   +1.910175781690079e-01   +4.258923518376939e-01; +8.565827223639034e-01   +7.218430487080770e-01   +5.799949805513663e-01   -4.098174191246975e-01   +5.232888807911399e-01   +1.047664297109472e-01   -5.159656232699755e-01   +3.687025840921850e-01   +2.111142282369580e-01   -4.161471955833021e-01   -2.830833630368647e-01   -4.217925009186622e-01];
L2E_Input1_iAMPA_netcon = [+1.000000000000000e+00   -2.780382594062210e-02   +6.850480281937887e-01   -6.081203072760349e-01   -2.419370828793107e-01   +4.856034895321459e-02   -2.466470540443921e-01   +7.128119889685627e-01];
L2I_Input2_iAMPA_netcon = [+8.275295275070232e-01   +2.960597242242989e-01   -3.697793911767567e-01   +4.959355147118157e-01   -7.484960902450705e-01   -6.143793914287212e-01   -1.000000000000000e+00   +2.377941498171092e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
