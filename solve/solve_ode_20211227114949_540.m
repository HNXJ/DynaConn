function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.260970232878505e-01   +1.050759787468646e-01   +3.893226191137625e-01   -3.054116022654741e-01   +3.371392173242298e-01   -1.346006908630945e-01   -3.296394380731569e-01   +1.546959965506686e-01   +6.367013838500514e-02   +3.861516517578012e-01   +1.375822094243432e-01   +4.715631558639027e-01   +2.679632339455269e-01   -1.840688602512118e-01   -1.056231886203868e-01   +2.672731129873679e-04; -1.692069729742538e-01   +3.156488637305095e-01   +3.199724457113660e-01   +1.552232677282154e-01   -1.322244433531642e-01   -1.908251277208965e-02   -1.905014374785648e-01   +4.620907912590001e-01   -1.021568343172045e-01   +7.833625384447343e-02   +2.585255148653013e-01   -4.063322028331571e-01   -3.359943691802626e-01   +2.190403129645760e-01   -1.732417566735604e-01   +2.618181784025764e-02; +7.711871401336302e-02   -9.068861109517475e-02   -8.532218586747228e-02   +3.915499513667099e-01   -3.082472028146601e-01   +2.068410294165289e-01   -2.304998887717127e-01   -2.530171393977372e-01   +1.515094468594501e-01   -5.540286642156513e-01   -2.353276972824955e-02   -3.734199834428208e-01   -8.487482150194570e-03   -2.896536920883944e-04   -5.100774093489210e-02   -8.458303433596392e-02; +3.328619985561955e-01   +5.923052444165994e-02   -1.034561510798253e-01   -1.513330719015647e-01   -3.790352700959880e-01   -2.680958704399999e-01   -2.502300010468947e-01   +6.852056237223744e-02   -3.232010954714056e-01   -5.732616560407691e-02   +4.274511280226084e-01   -1.497649029025665e-01   -1.518040130982948e-01   +2.249865499198558e-01   -4.333634622669771e-01   +1.676505913567508e-01; +2.322705450004233e-01   -3.294815798477394e-01   -2.728739534189542e-01   +1.276404023896738e-01   +2.664757671173660e-01   -1.510693716846298e-01   +2.940034719786140e-01   +3.723264819157156e-01   +5.487871125435837e-02   +9.980896306389403e-02   +4.066524724448711e-02   +7.025057931357975e-02   -1.188162026223675e-01   +4.984834862120997e-01   -2.581616832454178e-02   -8.212105893425226e-02; -4.841962926111985e-02   -1.895273944908549e-02   -2.262878953194712e-01   -3.187109909051222e-01   +2.319352087198195e-02   +1.470096335225111e-02   -3.854933283943459e-01   -2.163500880871239e-01   +2.480906876664304e-02   +2.569103749161109e-02   +2.795138531365359e-01   -9.721855450873243e-02   +1.383961823242967e-01   +8.008756649084406e-02   -3.892589502832647e-01   -2.872292410198575e-01; -3.587534872585308e-01   +8.589354865445670e-02   -7.831197923436348e-02   -2.141135804285227e-01   -1.010570387763112e-01   -3.982130295948759e-01   -1.042651484690707e-01   +7.976929466582426e-02   -3.166308753347626e-01   +8.683428660664942e-02   -2.115406970482515e-01   +1.166170693775285e-01   -3.737757528401708e-02   -1.520385930887240e-02   +2.299680395355744e-01   +9.658597879991473e-02; -8.395530787059205e-02   -2.371013038649509e-01   +2.007124664953211e-01   +3.068039595296490e-02   +3.037986583389183e-01   -3.188389406980137e-01   +1.753438758208404e-01   +3.483640556501190e-02   -4.023955915538795e-01   -2.804005937638501e-01   +8.926817886261697e-02   -4.199274580853714e-02   -8.850847790478315e-02   -3.022539891507157e-01   -1.692526252953006e-01   -1.369065556535592e-01; -7.297647319505662e-03   -2.704375998553104e-02   +3.280615333959603e-01   -2.889234938914739e-01   -7.799166345249206e-02   -2.759881308462755e-01   +2.753030193369425e-01   +3.453649095230221e-01   +3.042409656906735e-01   -4.955955151526842e-02   +1.021130374860966e-01   -3.723295843657092e-01   +2.518120654997656e-01   -4.902249773098617e-02   +1.633510869943985e-02   -4.428765758435247e-01; -1.678448520159929e-01   -9.245194933764687e-02   +3.429378281410221e-01   +3.501445632981699e-01   -3.575134807998934e-02   +7.578257119247495e-02   +1.389780129143161e-01   -3.134541147339787e-01   +2.032182387893124e-01   +1.595740881918788e-01   +2.300929387024934e-01   -5.399847463153764e-01   -8.977961028157898e-02   -1.255148980587956e-01   -3.633712784180803e-01   +2.602656857467142e-01; -2.260149199218971e-01   +3.502395538543406e-01   -3.693419153624798e-01   -2.540807117381788e-01   +1.887743538226959e-01   +4.745501842357034e-01   -2.462277548932562e-01   +7.411938929576878e-02   +8.379014235957159e-02   -3.147456386192336e-01   +3.090918142320578e-01   +1.829881983396670e-01   +1.225094142305129e-01   -6.077112435436333e-02   -3.033491388272468e-01   +2.549282629824572e-01; +8.089572850802168e-02   -1.503749652504217e-01   +4.002747010195601e-01   +3.687024234757179e-01   -3.131875518372792e-01   +2.390482380224493e-01   -1.403398181036765e-01   +3.505877189951068e-01   -2.842453280729527e-01   +2.043924578968387e-01   -1.865029794926006e-01   -2.898653518003737e-01   +7.705312035851040e-02   +5.339253080511604e-02   +2.155413386528349e-02   +2.752097596523009e-01; +2.189117394545895e-01   +2.689105151248206e-03   +1.499222593208220e-01   +4.718067496637146e-02   -2.576722756969454e-01   +1.046953116097137e-01   +1.938080363726221e-01   -2.808706594726355e-01   -1.096154857260597e-01   +3.227854847500040e-01   +2.327999117878775e-01   +1.974327365096323e-01   -3.535259530320939e-01   -4.507975059716963e-02   -1.032872215830695e-01   -1.880333347942953e-01; -1.991749611557715e-01   -8.840983495181468e-02   +4.276347790659175e-02   +2.825247552948298e-01   +6.778252340612034e-02   -4.314114142109599e-02   -2.708751495702197e-01   +3.983745985493145e-01   -1.156961663440102e-01   -7.581535614998393e-03   -9.970253113479524e-02   +5.955828275101669e-02   -2.279073675975171e-01   -1.770873738205973e-01   +4.368536634181884e-02   +2.589959276052102e-01; -1.764503384307128e-02   -5.808423948308220e-02   -3.015638221372824e-01   +4.502679506264692e-03   -5.743683943141067e-02   +1.682844833330766e-01   +4.970439536429118e-01   +1.848621379142456e-02   +5.364301957245671e-02   -1.747275393922715e-01   -1.731133776475892e-01   -3.629831778557864e-01   -1.753277060064070e-01   -1.545435507314190e-01   -1.734387891998837e-01   -9.681613260417689e-02; +2.057815615125909e-01   -6.193786233770553e-02   +2.909998920959043e-01   +1.565027949492580e-01   +2.655743892482036e-01   +2.680197505994627e-01   -3.238278717059107e-01   +1.172065238189850e-01   +1.748847613312457e-01   -3.099667976151907e-01   +3.795476794336844e-01   -1.264949541239754e-01   -1.420069628239873e-01   -2.595775204219708e-01   +3.928626960210371e-01   -5.386851032164704e-02];
L1E_L1I_iGABA_netcon = [+3.423608599883184e-02   -5.929735391673688e-02   +3.872276420476856e-03   -7.005977560069894e-02   +2.248150328683933e-02   +5.644152098085773e-01   -3.466480472836861e-01   -2.064622993060277e-01   -1.462724968646096e-01   +3.296730718773810e-01   -2.164557813297310e-01   +1.297341436063396e-01   +9.485165475494702e-02   -3.557628827370732e-01   -1.817080376152208e-01   -4.744694701713497e-01; -1.842843331310152e-01   +1.391416452531777e-01   -4.156337266436999e-02   +5.151158459038043e-02   -1.377319433661008e-01   -5.550587882931345e-02   -1.553899599756948e-01   +2.572304067407236e-01   -1.045985135397567e-01   -3.414627179560035e-01   +3.252186631381564e-01   -7.738814112252831e-02   -9.402054192857189e-02   +3.447136454716786e-01   +1.591462284751133e-02   +2.444906155469474e-01; +4.947420287537579e-02   +4.357158660744611e-01   +1.906905987081610e-02   -1.701727752964090e-01   +5.801926190107078e-01   +2.307569226069354e-01   -1.904017292051225e-01   +1.244556328473521e-01   +1.090913968111495e-01   +2.763847771977742e-01   -3.415759600895360e-02   -5.123172923003846e-02   +2.045210382004811e-01   -3.616387819245693e-01   +2.678046100154799e-01   +1.375386215176782e-01; -1.803414365144512e-01   -3.010261700036402e-01   -1.388400341376976e-01   +1.329176562525826e-01   -3.515005273253773e-01   +7.031841921513624e-02   +5.871994604158657e-01   +3.554873392726479e-01   +1.289127566403193e-02   -5.834320513779649e-01   +8.143217618627001e-02   -2.122578522756985e-02   +3.194545413291823e-01   +2.063695983550142e-01   +8.778497021341648e-02   -2.072901004505873e-01; -3.530025544983343e-01   -2.608937493165586e-01   -2.233497781559122e-01   -2.776247408464005e-01   -2.237364221536814e-02   -3.513820079946526e-01   +9.391018621495607e-02   -1.602230974164679e-01   -1.053259696795869e-01   +2.884191856455597e-01   +1.030795208570865e-01   -3.347390469831389e-01   -3.016417055978203e-01   -2.457767138261023e-01   +3.430980893983875e-01   +9.765266407155888e-02; -1.898999289854383e-01   -2.694364726676915e-01   -2.692978303209960e-01   -2.395184758434712e-01   +1.318309426152771e-01   +4.179980950653333e-01   -3.739151875354583e-01   +1.543672942130729e-01   -2.429230873273431e-01   -2.668388559116296e-01   +1.109715011295243e-01   +1.552513231246843e-01   -3.098822071735620e-01   -2.962049759242336e-01   -8.295028950398735e-02   -2.673507035245252e-01; +9.972416675542384e-03   +1.028398294336673e-01   +1.676516323945906e-01   +1.264501524327867e-01   +1.003461114151345e-01   +2.126849794614790e-01   +2.542728861768742e-01   -4.266378326002915e-01   +4.158919264881916e-01   +7.163300132240216e-02   -3.756411999707447e-02   +3.677823644957519e-01   -1.992435740514710e-01   -3.024131860553391e-01   +4.956936895913694e-01   -1.882843603540515e-01; +1.180620123675935e-02   +1.400102332872771e-01   +3.930642422399044e-01   +2.632617169906815e-03   -3.697684717602812e-01   +2.385748908018999e-01   +1.976486897137141e-01   +1.208178614197005e-01   -9.261072341589871e-02   -3.812229442794315e-01   -1.929046891833666e-01   +3.965029755136004e-01   +7.149305050891894e-02   +4.307643713144173e-02   +1.572990616772246e-01   -7.303120536070327e-02; -3.407081042760260e-01   +2.348329974685608e-01   -3.813915860653922e-01   -8.331313154389450e-02   -8.234705333685410e-02   +5.277366884091352e-01   -1.331241760041981e-01   -1.058903419338400e-01   -3.653475991689366e-02   +4.087769397919572e-01   -3.678781001214443e-01   -3.986103440189034e-01   +8.600511524903266e-02   +4.129100177295651e-01   -2.762145537830612e-01   +2.696613866531016e-01; -8.814314318429643e-02   -1.697556896850695e-01   -3.034924768278185e-01   +1.286502130267521e-01   +2.088014968552170e-01   +5.924301308760764e-01   -3.574228938084376e-02   +6.423555093539197e-02   -2.992152383621542e-01   +1.619166467827481e-01   -2.681432415172866e-02   +2.485211256613405e-01   -1.342274185838013e-01   +3.011719856407544e-02   -2.352959927006887e-01   +1.267552963170601e-01; -1.262724863827166e-02   +1.796406617371130e-02   +2.282082451129274e-01   +4.262252551015291e-01   -9.424407199913803e-02   -8.363426937137985e-02   +2.127069273244009e-01   +1.118863366379423e-01   -4.580153435802963e-01   +1.620863128661107e-02   +1.793746726087568e-01   +2.055757890306713e-02   +1.731991436233671e-01   +9.840594206858785e-02   +1.560788524550767e-01   +1.092220467402061e-01; +2.528037381632073e-01   +1.213492396391289e-02   -1.522628379953539e-01   +2.695399303982803e-01   -2.290876505937681e-01   +3.792716841904665e-01   -3.525725875675908e-01   -1.326941581435823e-01   -2.380702858793438e-01   -7.264134501905051e-04   +5.211087033880443e-01   +8.788748094999262e-02   +1.025870743367502e-01   -8.665161701427576e-02   -8.047681237431170e-02   -3.436796649573817e-01; -1.217206460002814e-01   -1.672410704709938e-01   +3.325180595301342e-01   +1.407691805939642e-01   +1.277726383126496e-01   -1.186517981985478e-01   -1.263254887854979e-01   +1.851299623988353e-01   -1.976354656755254e-01   -1.608342125352623e-01   +1.582783775266506e-01   +7.239339453321442e-02   -3.861915147618800e-02   -7.424790422032698e-02   -3.919346096738060e-01   +2.031214351040674e-01; +2.900748107173688e-01   +3.148668519600863e-01   -4.194693662487385e-01   -2.431879218577667e-01   -9.378914038289797e-02   +1.164870129873188e-01   -2.839060000508245e-02   -3.917750792792886e-01   +1.411196017850637e-01   +1.269954752153127e-01   +1.332049949363535e-01   +6.314000527747785e-02   +5.674851149369099e-02   +2.947591891665819e-01   +1.444855708284801e-01   -4.554619495489927e-01; +1.267042642268273e-01   -4.075764076301285e-02   -1.418875350978760e-01   +1.927234423366082e-01   -5.408951350770644e-01   +1.329659971152832e-01   -4.319704755633122e-02   -2.539940922583140e-01   -2.114518740163792e-02   +7.359318182297950e-02   -1.387336759530916e-01   -2.501506179040296e-01   -1.648783026551887e-01   -2.404559083870585e-01   +2.779772173704844e-02   -5.668191090807129e-01; -2.643744795133671e-01   -3.670643489948231e-01   -1.195108046188564e-01   +2.509835109525109e-01   -3.000513942280388e-01   +1.633424524279063e-01   +1.025621398258547e-01   +2.968362350448250e-01   -1.167378464004264e-01   -6.398011242267052e-02   +1.906837469713621e-02   +5.170750734622538e-01   -3.861652319716212e-02   +2.533785115184356e-01   +2.046585879578473e-01   -2.573886902168239e-01];
L2I_L1I_iGABA_netcon = [+1.640363753287048e-01   -2.388488785393442e-02   +1.577378033572657e-01   -3.071091756444556e-01   +1.534276888767317e-01   +3.401603579046608e-01   +4.846092644149474e-02   -2.526465958614456e-01; -1.876380641545339e-02   -1.302544026661532e-01   -8.709408914967802e-02   +2.095087370322489e-01   -3.311729439170624e-01   +4.464070523263360e-01   +4.388147410414541e-01   +1.940911735205749e-01; +1.841896139603292e-01   -4.377446002885686e-01   -9.678481767754429e-02   -2.029111715164077e-01   +5.900310154483109e-01   -3.760410197371797e-01   +2.575348187432379e-01   +6.420804183830005e-02; -3.017876539795171e-01   +2.901784376865632e-01   -2.047518447556727e-01   -2.242515865698822e-02   +1.555086970464944e-01   -1.813368674497731e-01   -1.157643527791067e-01   +4.709251871138889e-02; -3.021377597970789e-01   +4.023200395017797e-02   +2.171039432183784e-01   +1.366242719389127e-01   +3.635180764089110e-01   +9.407493993898013e-02   -3.898271111097098e-01   -1.168847211166310e-01; +1.853728715162070e-01   -2.962459878145609e-01   +2.903476229843990e-01   -1.440005879353191e-01   +1.637709085724884e-01   -2.393973407968486e-01   -5.231398920024909e-03   +1.079470468079295e-01; -2.515615051255384e-01   -3.506942179351580e-01   +4.588585089710051e-02   +5.008992994213989e-01   -1.761898068964462e-01   +8.924976670750354e-02   -1.596654443756851e-01   +4.447672731607115e-03; +3.336945003647760e-01   +1.340846373045359e-01   +9.987771923822293e-02   +2.148496731490958e-01   -1.031938091565553e-01   +3.447786547098615e-01   -3.687829019225716e-02   -1.041048239845249e-01; -6.216707748585030e-02   +1.604064351990880e-01   -7.053825949131512e-02   +2.040988403411194e-03   -1.388939351889422e-01   -1.029623857105936e-01   +4.594062172714926e-01   -1.431865797617566e-01; +1.974417076130937e-01   +1.998733852195338e-01   -2.340570450464894e-01   -1.985067001055896e-01   +2.169126538565046e-01   +3.826378080491031e-01   -4.609630472668017e-01   -5.186962580886223e-01; +1.285837358288744e-01   -1.096915968915912e-01   -3.514195452231501e-01   -1.216206093094334e-01   +2.355145060507222e-01   -6.395748125027840e-01   +3.449719221408366e-01   -1.117933522978639e-01; -4.914020061535103e-01   -4.215004410824423e-01   -8.479847384472361e-02   -7.586317991158763e-02   +1.928226346899888e-01   +2.141831434624012e-01   +2.964490427666387e-01   +6.868209711326301e-02; +3.007663090701626e-01   -1.947026460299234e-01   +2.196423236727367e-01   +4.297885526104051e-02   +1.063318967793228e-01   -2.718992965934907e-02   +3.154761783306646e-01   +3.000196851463572e-01; +1.443582091635232e-01   -9.314499716285429e-02   -4.904862222533505e-02   -2.233839891533465e-01   +2.961881404919975e-01   +2.536652979069937e-02   +4.365544803228381e-02   -2.075321278875081e-02; -2.877197855866750e-02   -8.268487993471374e-02   +1.797166321567762e-01   +8.878589359452399e-02   +4.494879094654832e-01   +9.992418713046358e-02   -1.522581724225371e-01   -6.796530876701647e-02; -1.172368250287490e-01   +2.423011901499307e-01   +1.719305436390778e-01   -5.263748935202613e-02   -1.329282042471988e-02   +2.746616108228879e-01   -1.043028856495529e-01   +1.169824956242397e-01];
L1I_L2I_iGABA_netcon = [+3.495991040123237e-01   -2.695406690529714e-01   -1.029944975192668e-02   +8.177576599025327e-02   -3.130712459649683e-02   -8.788909586155635e-02   -2.682929360038642e-01   +1.713561442730963e-01   +8.148029683561456e-02   -2.040161146032005e-01   -3.421555304677604e-01   -4.162083479373578e-01   -3.111827519390036e-01   +1.549588613740970e-02   +2.399197383095171e-01   -1.652930071089812e-01; -5.274385141100999e-01   -3.007704143835626e-01   +2.924718098491026e-01   -2.817735950297123e-01   +1.737624798808173e-01   +3.344014624379190e-02   +1.053266678812289e-01   +1.750891383934187e-01   -1.751886620176488e-01   -2.235145756360612e-01   +5.215760177584554e-01   +1.495664414905467e-01   +3.380309342532379e-01   -1.850194892502716e-01   +2.116726479699523e-01   -1.484547008155574e-01; -2.783547924484442e-02   +5.713813397656142e-02   -2.270938302881773e-01   +9.888662562942012e-02   -7.444799606588479e-02   +3.377506287927341e-01   +2.440831100518043e-01   +3.375067690346441e-02   +2.368147567387213e-01   -4.451931647939314e-02   -4.539724989001855e-01   +5.351804660489472e-02   -2.752975598605387e-01   -1.334836808217520e-01   +3.352868009281892e-02   +3.454889268943988e-01; -1.607325951074452e-02   +7.830636082701434e-02   -1.592295104420895e-02   -1.835610204188917e-01   -3.979353835464030e-03   -1.396359016902005e-01   +2.145646283948457e-01   +5.097184223373454e-02   -2.452715389488653e-01   -2.719906321139931e-01   -5.076243085060524e-02   -1.310278766875339e-01   +7.721767487555731e-02   -2.268986504994585e-01   +1.707767850511763e-01   -7.836620459237564e-02; +2.920173112512853e-01   +3.111126270978298e-01   +2.494144211597109e-01   -2.641576227774006e-01   -1.774949513513946e-01   -1.690881170331728e-01   -2.058578207928542e-01   -2.637603305667648e-01   +2.006886328642574e-01   -1.033590775612848e-01   +5.446925844608471e-01   +5.856025469722907e-02   -2.489503376830002e-01   +2.276517762373649e-01   -1.809840765992562e-01   -4.615652413156232e-01; -3.204238418806298e-01   -7.737787893717391e-02   +1.431171305656549e-01   -2.604981533225326e-01   +8.135155456430126e-02   +1.096334706046279e-01   +3.235348470704778e-01   +3.561013903596495e-02   +2.072068256355021e-01   -2.543296995548027e-01   +1.377968898298512e-01   -1.751456969084970e-02   +1.050564238210010e-01   -7.683781594739894e-02   +9.067612369957895e-02   -2.007079427701853e-01; +5.769728704803198e-02   +2.174903906899178e-01   +9.379184532188556e-03   +1.886421135474968e-01   -2.674566635347964e-01   +4.991342403742265e-02   +1.318898281189266e-01   +1.026512527779510e-01   +4.633681112475501e-01   +2.040101426610590e-01   -1.152837300354839e-01   -1.388503166805726e-01   -2.435409771956535e-01   +1.816400039174756e-01   +2.626469069827141e-01   +3.352226431602409e-01; +2.633697201331641e-01   +1.546150948752772e-01   -4.450538639313790e-01   -2.555580872813221e-01   -7.686446809593295e-04   +3.431402912449031e-01   -2.220485912671187e-01   -2.850219120473744e-01   +4.115872778341949e-01   +5.853078755194790e-02   +5.998334229452131e-02   -1.591896416365016e-01   -4.991176639716605e-01   -3.053671683560681e-01   +3.278869735183952e-01   -2.879955628013504e-02];
L2E_L1E_iAMPA_netcon = [+6.385680032818083e-02   -2.422340785745124e-01   +1.111094734386024e-01   -1.030358474292908e-01   -4.468930140654304e-02   +1.519681246065030e-01   -1.490057441080709e-01   -7.100110390235281e-02; -7.834452460441163e-02   +1.515210170227479e-01   +4.232003739640680e-03   +4.374301081814825e-01   +3.259408933261823e-01   -2.295649895917781e-01   -5.579766430264629e-02   -2.352356899959060e-01; -1.623758466937321e-01   -2.093627821470863e-01   -2.828276011795730e-02   +2.922120573425223e-01   +2.694021632767775e-01   +1.280505201718388e-02   -6.950501231452570e-02   +2.534027870495720e-01; +4.254422932525872e-01   +6.312276245319681e-02   +1.901099194185960e-01   -3.349399698241254e-01   -2.279433604581581e-01   -1.945993688552053e-02   +3.582744779201162e-01   -4.053674930254439e-01; -7.057753710020784e-02   +1.841770286992487e-02   +2.421925940298831e-01   -3.534478717091816e-01   +5.412743988751893e-02   -1.598850330626627e-01   -9.850843413508935e-02   +2.157332189757019e-01; +2.317944012210471e-03   +1.564637627090260e-01   +2.139681951923616e-01   -2.842522333974046e-01   +1.479726229823822e-01   +2.677399550106518e-02   -1.681705912909032e-01   -5.654777380475765e-01; -2.668493472563721e-02   +2.064367625107861e-01   +2.377446010348996e-01   +3.399533033152130e-03   -8.997256081051708e-02   +3.332250692624883e-03   -4.338913852962376e-02   -2.291252591357556e-01; -2.668286810065454e-02   +1.167758782932093e-01   +2.576507762581022e-01   -6.747735723222267e-02   +3.571303042555798e-01   -1.107591972646761e-01   -2.155083835040258e-01   +4.367421645896086e-01; -3.432215392085763e-02   -1.132251296034392e-03   -2.138812761343051e-01   +1.333837794343592e-01   -1.120741621198790e-01   +2.685873380283817e-01   -2.599279527541992e-01   -3.046536681806016e-01; +1.196036633411780e-01   -3.848512195242881e-01   -2.096973628138118e-01   -9.935277371503724e-02   -5.899423189594434e-02   -3.198515436699270e-02   -2.015005082361223e-01   +2.268563114861916e-01; +4.006659894481053e-01   +5.023545179676955e-01   -1.040022278441445e-01   +1.820229474513456e-01   +5.790311737306264e-02   -1.501288710909209e-01   -3.477810002602968e-02   -2.360859200447549e-01; -2.340031142297826e-01   -6.575104564291366e-02   +1.158243746924843e-01   +2.609862247764314e-01   -2.723091894928212e-01   +6.883945871275139e-02   -2.428433833169573e-01   -3.589441466197926e-01; +1.447464124091488e-01   +3.360113030053830e-02   -5.873611536937193e-01   +2.411538303602905e-02   +1.705383349529028e-01   +5.503574799913320e-02   +2.627845510580598e-01   +1.617472450723960e-01; +2.002211713849867e-01   -8.935869254764260e-02   +1.657324267715251e-01   -3.854286035493163e-01   -7.721764290712734e-03   +1.421389961940293e-01   -5.179060910890869e-02   +3.129099542003902e-01; +1.916908013888195e-01   -7.601209219132306e-02   -1.233334939948849e-02   -1.720162384568682e-01   -2.510552643182809e-01   -2.589934919585111e-01   -2.049180945012776e-01   +2.760676577387163e-01; +2.406229007404926e-01   -3.602710347116385e-02   +2.128667193092369e-01   -3.033113844385101e-01   +3.362107258583035e-01   -2.252323890898622e-01   -1.706172330827832e-01   -1.171336649029495e-01];
L1E_L2E_iAMPA_netcon = [+1.476181024258374e-01   +1.033264812393087e-01   +1.179867488039515e-01   -3.437823977514362e-01   +3.860762535550739e-01   -4.431291727783515e-02   +1.333112303137293e-01   +2.494149264854750e-04   +7.319336977996758e-02   -6.645359316293929e-02   +6.550351496321144e-02   -1.226802165365835e-01   +3.302666134481378e-01   +2.524797142161317e-01   -1.914141127846095e-01   +4.034220336774530e-02; +1.675608593668766e-01   +3.894715343211167e-02   +2.964398497963067e-01   -5.398800880870155e-01   +1.208266297118489e-01   +1.501937786431144e-01   -2.805023238021954e-01   -1.667620443735693e-01   -1.976997702459668e-04   -1.304722992946406e-01   -4.589771314559713e-01   +7.932679357227425e-02   -1.002864167558720e-01   -2.179443773259891e-01   +1.655435793812096e-02   -1.569651557262158e-02; +8.674121030976378e-02   +3.618979616605891e-01   +4.688249009093297e-02   +4.141387293379951e-01   +4.171749162643143e-02   -7.023903406795831e-02   +2.235172838587133e-01   -1.269187901746381e-02   -7.941769863783113e-02   +1.655808294759327e-01   +3.987922877255111e-01   -2.433513489680610e-01   +2.603287139806993e-02   -1.525163669474871e-01   -3.150401777177069e-01   -1.312336986817707e-01; -4.954559944578910e-02   +3.923190901459764e-01   +1.012003723165271e-01   -1.842265321958783e-01   +2.653676670694647e-01   -3.234163823684674e-02   +2.676200610434773e-02   +3.482401327483939e-01   +2.021856298378734e-01   -2.716722223081257e-01   +1.361153638996717e-01   +4.721622935567404e-02   -3.772397076401027e-02   -2.631975292546406e-01   -1.712973289170530e-01   +1.294192433192471e-01; +2.407913175425042e-02   +2.371645731141675e-02   -1.099995289428167e-01   -1.742053662146016e-01   +4.393863647012361e-02   +2.037165987048615e-01   -4.423444844878663e-01   -7.285813758617474e-02   +2.850830651834101e-01   +4.552705948054377e-02   -3.548252127123966e-01   -1.867291704786879e-01   +4.917507664560709e-02   -1.529678329950827e-01   -1.299067880994495e-01   -1.105653496220362e-01; +1.791283304635868e-01   -2.090929293629368e-01   +1.559199145313729e-01   +1.436114504098917e-01   -2.713395273303067e-01   -9.515951663640000e-02   -1.723987098575518e-01   +3.343814973143197e-01   +2.923245687450254e-02   -4.923294617029730e-01   +2.710692617232869e-01   -5.710638354784492e-02   -3.019413601863896e-01   -1.065303291788693e-01   +1.336295028245254e-01   -3.812365710320960e-02; +6.542771305626494e-02   +2.628295303665998e-01   +6.711961634936656e-02   -1.405095631557692e-01   -6.536674759121626e-02   +2.728538540175598e-01   -1.355804319933553e-02   -2.481620649414763e-01   -6.464464453804358e-02   -4.510918181440082e-01   -3.756310948465840e-01   -1.756991753243875e-01   -1.517004225450687e-01   +6.627663237070822e-02   -3.176434403462165e-01   -2.888532209125659e-01; -5.351815692465288e-02   -2.351766318242321e-01   +1.332452515435144e-01   +4.382939748272660e-01   -7.840103654849928e-02   +2.642361417044086e-02   -1.839843316586998e-02   +3.135867851689362e-01   +4.820229841005150e-01   +3.460284898271090e-01   -2.340372973392461e-01   -4.841343453010720e-01   -1.369397610388472e-02   -3.739815851976088e-01   -2.720372908198957e-01   -1.134939185739996e-01];
L2I_L2E_iAMPA_netcon = [+1.557462771063580e-01   -3.852863532357529e-01   +3.076576183821413e-01   +6.837748053259796e-02   +7.173859871010616e-02   +4.742928516772964e-01   +1.233872031799307e-01   +2.650804016754868e-02; +5.534451386792597e-02   -1.854820360662506e-01   +4.075360546355619e-01   -4.507261040634677e-02   +5.710557615267334e-02   +1.877640685399290e-01   +7.889552839718854e-02   +4.606319424696477e-02; -4.537893824281405e-02   +3.396196914340577e-01   +2.286553630486516e-01   -7.093812428492394e-02   +9.158703723645140e-02   +3.024065141070912e-01   -2.326993237606116e-01   -2.369734823509759e-01; +3.766920497197346e-01   -9.090120812008837e-02   -1.595823766644058e-01   -2.142804015315842e-01   -2.484675812753048e-02   +1.318197449452137e-01   +5.676285077840228e-02   +1.581890617031915e-02; +1.581610345165141e-01   -3.983083722548905e-01   +9.672260632241525e-03   +1.555878246229535e-01   -2.028255448900893e-01   +1.449499613570931e-01   +2.320788435688743e-02   -1.507389275960125e-01; +1.016039723043957e-01   +1.636377073714229e-01   +2.514741296388786e-01   -1.342877307328462e-01   +1.619469455249087e-01   -2.483846865123568e-01   +1.946438056826220e-01   +8.056848431230297e-02; +2.450390306021457e-01   +3.996863064487028e-02   -6.081470982700468e-03   +3.577180401672596e-02   -3.021237317146133e-01   -2.914047932707851e-01   -8.922647291183800e-02   +7.788100724140049e-02; -3.477949516200091e-01   -2.502768910466402e-01   +1.861080450806424e-02   -5.429878137827265e-02   -1.803835081519707e-01   -1.152610428582499e-01   -2.851549063314636e-01   +2.860013506774926e-01];
L2E_L2I_iGABA_netcon = [-2.893686657880772e-01   +8.914558568906550e-04   +2.982986281451703e-01   +3.790684026136409e-01   -3.055472978182634e-01   -2.964903811785262e-01   -1.808922973040524e-01   -2.553606231572222e-01; +5.074987966181198e-02   -3.564520956200850e-01   +1.531275204175792e-01   -3.086546082316995e-01   +2.637613019932896e-01   +9.441011887099079e-02   -5.275180642612110e-02   +8.991583331198684e-02; +7.731902679598712e-02   +2.105576996244301e-01   -3.963393401893500e-01   -2.795212010414256e-01   -5.021532646246031e-02   -3.151677776922364e-01   -5.635769974268300e-01   +1.901117360122055e-02; +1.266014772119209e-01   +3.893716011963927e-01   +2.355050472173890e-01   +4.635569921738609e-01   -1.222665526930775e-01   +2.885529783259921e-01   -1.852505611061707e-01   +2.090083282890301e-01; +3.363306623010450e-01   +1.296731572843197e-01   -1.470217608938825e-01   +1.238119793841718e-01   +1.271842485578273e-01   +2.464554583267958e-01   -2.056528410843069e-01   -1.508072459485643e-01; -1.938272432843693e-01   +1.974129091750581e-01   +1.245793810805370e-01   -1.481954295337750e-01   +5.185009335353978e-02   +4.809142209841752e-02   -2.722068672497586e-02   -3.073046939129024e-01; +2.420259993933360e-01   +1.636699827044497e-01   -1.064252843956412e-01   -8.668929211026048e-02   -2.523961771223598e-01   -2.100073371715848e-01   +1.781564095560463e-01   +1.278951023157934e-01; -1.592319102793637e-01   -3.496249961106901e-01   +2.103706285850885e-01   -1.499901354416960e-01   +1.833141726163951e-01   -2.878091722194590e-01   +1.480271542369004e-01   -1.372940881967216e-01];
L3E_L2E_iAMPA_netcon = [-2.555477507401034e-01   +3.432015119693184e-01   +9.706135433432746e-02   -1.026699523231186e-01   -1.284179402865373e-01   +9.868444540539011e-02   +1.023759388767219e-01   +1.427087995659512e-01   -6.533813949714723e-03   -3.058343356178310e-01   -2.555478912836126e-01   +3.043264438148641e-02; +1.348181572466103e-01   +2.264444569642282e-01   +2.287383197380307e-01   +2.120355418724822e-01   -2.549512396439515e-01   -4.424750841721474e-02   -2.546502311512469e-01   +2.845627992936257e-01   -4.464751855351518e-01   +3.821768357192676e-01   +1.845459391716024e-01   +1.032323259775457e-01; -1.105992268683305e-01   +3.048492283414874e-01   -2.258305577879320e-01   +1.051265304043731e-01   +5.147688827710972e-02   -3.183620801904045e-01   -1.491126269593707e-01   +4.233992784383352e-01   +4.484141295923200e-01   -1.333858595506803e-01   +3.158424600739868e-02   +7.158193465881585e-02; +1.577255168353457e-01   -2.694479110085259e-01   +7.842178091408770e-02   -1.596179526007214e-01   +1.139996828583766e-01   +2.379687895193096e-01   +1.952128796051300e-01   -1.048769966490581e-01   -2.432125481667335e-01   -3.524492597224869e-01   +2.930993574043737e-01   +1.909836480525755e-01; -2.884545603385644e-02   -1.931343857162607e-01   +1.880497425269214e-01   +7.014528028733144e-02   -7.703261811326467e-03   -2.264270055629055e-02   -1.585877749645060e-01   -2.315365725782557e-01   +2.181379066054134e-01   +2.267883994788664e-01   +5.405762925885374e-02   +2.816348837415684e-01; -1.207381522161085e-01   +2.299176499809996e-01   -1.058293422178175e-02   +1.350523807103382e-02   +2.937820420302584e-01   +1.566888044986071e-01   -1.556001910909285e-01   -1.829155460378942e-01   -8.718235696382826e-02   +2.999232623245228e-01   -3.750753469750983e-01   -1.042583966678667e-01; +1.484228204624037e-01   -1.373838607556708e-01   +3.185415774194152e-01   +1.608930191850451e-01   +2.185185116462919e-01   +3.459036621389887e-01   +4.726823633123177e-01   +2.983348477461440e-01   +5.586396214831835e-02   -3.288647674996658e-01   -2.589432913079530e-02   -1.966043062826711e-02; -2.037372117206073e-01   -6.096597262559825e-02   +2.255446854528153e-01   -3.768764957959922e-01   +2.117916376523827e-01   +2.609829319076588e-01   +1.495512553558561e-01   -1.757156923643739e-01   +2.218774112104512e-01   -2.771405281680906e-01   -7.855803945373384e-02   +8.390409997394788e-02];
L3I_L2I_iGABA_netcon = [+2.602425125291334e-01   +1.775555709469746e-01   +2.125471408040827e-01   +3.965531537595157e-02   +3.526731893995447e-01   -2.549577467241195e-01   -2.626950454849202e-01   +1.612382062096642e-01   +5.072266790473114e-02   -9.873814617806280e-02   +2.516928515623617e-01   -1.783459762975857e-02; +1.666513041719948e-01   -1.843946487814181e-01   +2.462279865464329e-01   -2.534627928653790e-01   +3.322810935558706e-01   +1.965289280705285e-01   +4.714448850865911e-01   +3.211407113594816e-01   +1.808503369868402e-01   +6.569837095789391e-02   -2.298086210477370e-01   -2.764930929461835e-01; -6.839266138803327e-02   -3.794821858091147e-01   -3.508215496421409e-01   +6.029108493254930e-02   +3.064231122182031e-01   -1.365214664641600e-01   +6.190870333461962e-02   -2.604284899147136e-01   -3.667264480146928e-02   -2.199692215254133e-01   -1.483751154884794e-01   +3.855776698229801e-01; -1.524841354378230e-02   +2.694610362055463e-01   +2.552427511028905e-01   +3.933274065104798e-01   +2.560661950577060e-01   -3.282075094040328e-01   +3.193084661155996e-01   +2.526794472457186e-01   -2.658714549057200e-02   +3.025431941803707e-01   +2.207820846699601e-01   +1.101645877545239e-01; -4.100861013671895e-01   -1.965144279549011e-01   +1.488114145786973e-01   -2.435103598107412e-01   +2.531353888646584e-01   +4.194852319684589e-01   -4.971297615084969e-02   -6.397549644908611e-01   +8.942522210574505e-02   -1.804772710899963e-01   +6.662689837650486e-02   +6.430027951935172e-02; -3.301716234658698e-01   +2.862781966093821e-01   +4.152790868253477e-01   +3.471401850169385e-02   -3.827106257050382e-01   -1.965310467401116e-04   +2.424159576748157e-01   +1.111747457350031e-01   -1.644261012743808e-01   -2.945809245944057e-01   -1.258469077404774e-01   -5.049107078706995e-02; -1.633912485355773e-01   -3.316732982623006e-01   +4.038402882875605e-01   -4.268892898156704e-02   +4.265205116165169e-02   +2.304736599681189e-01   +2.903130839475486e-01   -1.947893510216142e-01   +8.451081801816797e-02   -4.758712700365780e-01   -3.757466734473026e-01   -2.364085980207976e-01; -6.757937796753555e-02   +9.158630660572364e-02   -2.157855955547820e-01   -2.014015361712551e-01   +2.495420973094312e-01   +2.637437941849194e-01   +1.653062095599671e-01   +2.674556664783289e-01   -3.246721167066481e-01   +2.511129944776332e-01   +1.106234418977003e-01   +1.969430441759983e-01];
L2E_L3E_iAMPA_netcon = [-8.234764030180178e-02   -2.762500500072854e-01   -8.157639528206981e-02   -1.890441266256099e-02   +3.960850572946003e-01   -4.486279202399680e-01   +8.283196054701401e-02   +6.841653219559973e-02; +9.100616776951877e-02   -1.747956162553398e-01   -4.513556375318128e-02   +1.044341912898946e-01   -4.487950914335741e-01   +2.491046577760989e-01   -3.908766130890955e-01   +4.010106780974837e-01; +4.539216255652638e-02   -2.174716619026968e-01   -1.638455935494584e-02   -3.866745990142505e-01   +3.240613094283312e-02   +1.958840114009520e-01   +3.344811921002824e-01   -7.723938937636166e-02; -7.274125216360058e-02   +5.295402851197016e-01   +1.346649409196191e-02   +2.790412388358504e-02   +1.883633320773773e-01   -2.857340690874672e-01   +9.041435680743462e-02   -9.913024252539263e-02; -1.972420492249605e-02   +6.565809347655799e-02   +1.591291366666143e-01   +7.952508456146343e-02   -1.578241873506392e-02   -3.477343857065617e-01   +1.887118497517894e-01   +2.426976661723984e-01; -6.289223325317979e-02   +1.420351107443757e-02   +1.135588787816481e-01   -3.178504941868539e-01   +1.438550191662501e-02   +7.359501376155234e-02   -1.223109421888148e-01   -6.930785489582536e-02; -2.708461082248895e-01   +1.075756978129924e-01   -4.696058755350187e-02   +5.264539429600026e-02   +1.831011297747085e-01   +2.630233487064558e-01   +1.475602627286914e-01   -3.185992951142589e-01; -1.100533763624459e-01   +4.385817203254165e-01   -1.662714158716686e-01   +9.098294344807452e-02   +1.189437664694499e-01   -2.812233726876904e-01   -2.716461385898138e-01   +2.738419128972079e-01; -2.821108209976457e-01   -7.813940584183551e-02   -3.576083753374756e-02   +3.648422468502596e-02   -6.987299777007917e-02   +3.069961421254052e-01   +2.715270262990853e-02   -2.522824121934697e-02; -4.057671941622782e-01   +2.185931184508703e-01   -1.461106108654790e-01   -1.134858229859735e-01   -6.343798050772832e-02   +4.144215212086366e-01   +1.026147735516231e-02   +2.692222987184404e-01; +2.363322791213412e-01   +2.523726765180284e-01   -1.408923686815992e-01   +8.469209347674225e-02   +2.698351769842530e-01   -1.303429987660077e-01   -3.255936008274413e-01   +1.197194709342951e-01; +3.372813164531616e-01   -1.614150572122965e-01   -3.737211107071120e-03   -8.762855643272527e-02   +2.972735401788884e-03   +3.085756421244387e-02   +8.881338941042943e-02   +2.186136336608272e-01];
L2I_L3I_iGABA_netcon = [+1.075061823815946e-01   +1.813662070331653e-01   +1.974898555804709e-01   -4.263332516535562e-02   -1.655055009995651e-01   -1.557416178055402e-01   +2.027926544232962e-01   +2.734296186076645e-01; -1.317329112134028e-01   -4.910188634436385e-02   +7.219017121565624e-02   +1.674121173614600e-02   +1.535263472889706e-01   +1.467578081917310e-01   -5.413014777351917e-01   -3.842416923545909e-02; -3.865671154233254e-02   +1.202718249134258e-01   -5.648030005174656e-02   +9.351278527326413e-02   +2.719033353595766e-01   +1.222141316176368e-01   -7.470011783133751e-02   -3.747775426851883e-01; -2.115155161073335e-01   +1.996873248280323e-01   -3.488057373861799e-01   +5.154560727862254e-01   -1.829325265169604e-02   +2.492934228489816e-01   +5.581556413016187e-02   -6.535901304112426e-02; -9.875339428198335e-02   +6.286461365381651e-02   +1.378682467991720e-02   -1.003033448981336e-01   +2.555320407626704e-01   +1.112745178186825e-01   -2.147237168828530e-01   +3.294085021031321e-01; -2.772543496025786e-01   +4.647806181763553e-01   -5.208168392825273e-02   +1.155085259016492e-01   +3.604211947675204e-01   -2.466084641109214e-01   +2.263658482762824e-01   -1.614428180649009e-01; -8.647895848691919e-02   -2.507927136187401e-01   -3.942821172789333e-01   -2.467600746605711e-01   -3.163653756519923e-01   -1.830068426405572e-01   -2.440978219465244e-01   +1.432034239689389e-01; +1.734635895350392e-01   -3.188809959721428e-02   +1.673113608800494e-01   +1.567118701861624e-01   +1.475871847229916e-01   +1.224387000947896e-01   +4.324563115480881e-01   -1.698425809639720e-01; +7.318276584093975e-02   -6.468293674031422e-02   +2.178501781580276e-01   +4.048677618115492e-01   -3.309448154226749e-02   -1.018311050200443e-02   +3.381287557165411e-01   +7.455993185059484e-02; +1.998588151598403e-01   +2.411639147193124e-01   +4.328654471032399e-01   -8.712055312271488e-02   -5.051212252756669e-02   +1.708687165683420e-01   -1.927706399822574e-01   +2.469068552724126e-01; +8.205945808598508e-02   +1.952792085470337e-01   +9.991413024323104e-03   -1.472158354611078e-01   -2.701488827139107e-01   +2.753689892847555e-01   -4.976504785893004e-02   -1.482346040004728e-01; -1.393140280710000e-01   -3.489867719546227e-01   -8.556390580641685e-02   -3.095810492770860e-02   +2.575959477224860e-01   -3.469783695104109e-01   +1.392982982063583e-01   -2.890439149059192e-01];
L3I_L3E_iAMPA_netcon = [-3.087446047229322e-01   -3.129098695147274e-01   -2.020270939013671e-02   -1.207840486564372e-01   +2.368684351186632e-01   -1.303479922057343e-01   +6.328257868697545e-02   -1.527343233522247e-01   -2.305046236673811e-01   +5.933925202438583e-02   -2.328287860259047e-01   -9.138674543507780e-04; -1.927119191985911e-01   -1.719703495203909e-02   -2.435617296809391e-01   +1.248221984173443e-01   +1.640325894687847e-02   +1.923751462937548e-02   -2.060931871432283e-01   -3.931201489368060e-03   -1.228482439684253e-01   +2.652896008354137e-01   +1.552510227216869e-01   +2.684094416151991e-01; -2.201671427819118e-01   +1.342206495560547e-01   +4.187637138433697e-02   +1.855436242171359e-02   +1.029008872077453e-02   -2.377350542398081e-01   -2.223462187599318e-01   +6.926746165592862e-02   +3.737890508791681e-01   +5.126408261654755e-02   +3.162997745285195e-01   -1.749888663444249e-01; -2.662180945937975e-02   +1.226396640423574e-01   +5.376655942617860e-02   +5.616401333036031e-02   -1.366550229449340e-01   +9.110263858358127e-02   +1.188857956717906e-01   +1.888549271587972e-01   -1.915948067444309e-01   -5.157053536810945e-02   +2.337699733452883e-02   +3.328069235812375e-01; -3.271712576167629e-01   -4.283281731472426e-01   +2.203573148914870e-01   +3.810223452267281e-01   +5.764199372480333e-02   +3.716866155964538e-01   +2.744547582292869e-01   -2.152863951992626e-01   -1.494546903654139e-01   +1.023405993392871e-01   -1.641759376051938e-01   -3.584320812248537e-01; -2.829422261317638e-01   +2.078307812057353e-01   -1.613092666391841e-01   -1.681251080048305e-01   +4.723006657878638e-01   -3.602814025113630e-01   +1.084295857218263e-01   +2.572320742081262e-01   +1.218606553547839e-01   -1.412853547007006e-01   -2.096230501489482e-01   -2.553223952991508e-01; +2.290031791514918e-01   -5.198969942949895e-02   +3.159943498899966e-01   -7.875241967741502e-02   +3.563341930615899e-01   -1.487253810234736e-01   -2.060083266228382e-01   +2.107824965448115e-01   -1.857600860518221e-01   +2.750157632887482e-01   +1.515036533636177e-02   +2.748557247731358e-02; +1.455492321861541e-01   -2.750328975511503e-01   +3.671742826748289e-01   +3.941742331696588e-01   +1.068130771336069e-01   +7.873184494261701e-02   +7.865618799249907e-03   -7.343388221660641e-02   -1.690123894852568e-01   +1.767516504968148e-01   +2.192359719891516e-01   +2.101608411326433e-01; -2.882415520612990e-01   +4.899159928175175e-01   +1.656060224492385e-01   +5.114946976568172e-02   +3.335634325361015e-01   -2.751811207995576e-01   -2.488510718191432e-01   -1.146670276435478e-01   +3.604207668682887e-01   +2.270677940863167e-01   -2.761609648141752e-01   -3.160040792423878e-01; -1.335002925428566e-01   -6.944539190721716e-02   +4.607975122345689e-01   +2.127520282393662e-01   -1.988145684218795e-01   -2.817030718713619e-01   +1.062952602846540e-01   -1.924564158318584e-01   +1.547720746550516e-01   -3.545067968910233e-01   +2.377996911483329e-01   -3.596311346765733e-01; +1.080117014870816e-01   -5.878516208887286e-02   -2.646262848149084e-01   +4.663113386907854e-01   -3.095799552029600e-01   -5.180144995674282e-02   -1.324441544551570e-01   -1.876726545077376e-01   -1.865504601918675e-01   +1.534463384603382e-01   +4.565291082450387e-02   +3.073470177627949e-01; -3.001845856950404e-01   -2.071656866001350e-01   +1.039825586662348e-01   +1.872295506231501e-01   +5.676684408262367e-02   +1.107821648219442e-01   +3.544421564050254e-01   +1.013719601640087e-02   +3.008900567681945e-01   +2.899703062970860e-02   -6.675598333227149e-02   -2.751940404364419e-01];
L3E_L3I_iGABA_netcon = [+3.617698697969824e-01   +8.377605565009133e-02   -1.007657747064866e-02   -1.996125311739071e-01   +1.748978724069252e-01   +1.182516485791094e-01   -2.454552122794292e-01   -2.131532709686942e-02   -3.062227680568992e-01   +1.990092128574408e-01   +4.083219000113157e-02   +1.572764497232786e-02; +8.554079064237244e-02   -4.188777431903970e-02   +2.346214432147039e-01   +3.341958342623507e-01   -3.768890501401780e-01   -3.057293693301710e-03   +3.273653020481581e-01   -1.089320938457983e-01   +4.390988040386043e-01   -3.227442795287078e-01   -2.942566211858253e-02   -2.943377914350077e-01; -6.199267599968611e-03   +1.644518175370545e-01   -4.442754386200334e-02   -1.598994363389400e-01   +1.350243441533123e-01   +1.940512987038442e-02   -4.801586891655574e-02   +2.077481398164476e-01   -1.705973127608566e-01   +3.113518986114490e-01   +1.775386070876409e-01   +1.463480914010418e-02; +1.253253063836179e-02   +1.136387680533134e-01   -3.419827282435235e-01   +1.670059712398340e-01   +7.823175086993886e-02   +2.248755422649282e-01   -3.155990065977079e-01   +1.196110683545859e-01   -2.738391052864384e-01   -6.722066269556667e-02   -1.667639080719623e-01   -3.383776843197164e-01; +3.464840773746879e-01   +2.127545559501298e-01   +2.647614988016251e-01   +2.267360536802959e-03   -3.438858686374837e-01   +1.223852744758699e-01   -3.980839651462251e-01   -9.246700817820722e-02   +4.588432121100688e-01   -3.513015526944197e-01   -2.594888436484660e-01   +2.103800891383634e-01; -2.707297931117652e-01   -1.763023111374022e-02   -2.020757090716787e-01   +2.475689341226842e-03   -3.529741031620037e-01   +2.135570143492634e-01   -2.546320222154320e-02   -8.621145006243169e-03   +3.756288298777484e-01   -2.083092900812045e-02   +7.006956274556864e-02   +1.833862356657081e-01; -2.326952322615213e-01   +3.100770124011206e-01   -1.889397642212634e-01   +1.254947523855066e-01   +1.880814065411943e-01   +1.396156987101315e-01   -1.992773869701511e-01   +4.106935294212778e-01   -5.329185648498687e-01   +5.434496508216141e-02   +1.924156086304386e-01   -2.145191961272330e-01; -3.661651022980963e-01   -1.868667222499440e-01   -2.251841390230962e-02   -1.427312167451179e-01   +3.100930585208299e-02   +5.262198532627933e-01   -1.409928687047647e-02   +3.449688682963584e-01   +1.190976422114687e-03   +1.815015133247817e-01   -3.177389126279845e-01   -2.083261236284448e-01; +2.287242547004244e-01   +5.273956411230976e-01   +1.205180312792992e-02   +5.690744974931761e-02   -7.739452991842666e-02   +1.315535858143060e-01   +3.075212720084833e-01   -2.001994735888609e-01   +2.033922217501951e-01   -3.391634938744502e-01   -1.977069499702843e-01   +2.736459554004441e-01; +1.364322183653990e-02   +1.238590594317643e-01   +1.612775395688443e-01   +3.773165819171049e-01   -6.455073356402807e-02   -3.102375474131922e-01   +7.363668917934071e-02   -8.302485127929655e-02   -4.437039003893425e-01   -4.060561924040479e-02   -2.298773960290443e-01   +3.124342009832456e-01; -3.953002315071092e-01   +1.217001586247729e-01   +2.877811312644566e-01   -1.963653786344139e-01   -2.333804206253717e-03   +2.867508991307328e-02   -3.406703724644992e-01   -1.830642412739990e-01   -6.235457196818715e-02   -9.953135882772300e-02   -3.980886833269475e-01   -3.508779519927090e-02; +6.024260363725713e-01   +3.917882990228758e-02   +2.186973136160490e-01   +9.427471150469377e-02   +2.178037427773521e-01   -2.955679031398509e-01   +4.072713308408354e-02   +7.814715744366812e-02   -6.049026307785707e-02   +1.876053954418317e-02   +3.159808139195776e-01   +9.477681650609548e-02];
L2E_Input1_iAMPA_netcon = [-1.989363590377871e-01   +4.312523314235908e-01   -8.690448800539427e-02   -1.618227148440455e-01   +2.853034078508021e-01   -1.426027342087254e-01   -1.223945465679312e-02   +3.333957494002467e-01];
L2I_Input2_iAMPA_netcon = [+1.505969002713116e-01   -1.795989090319248e-01   -1.132778096503757e-01   +8.840057757163350e-02   +1.576354241080615e-01   -9.438951218389206e-02   +3.228940703319706e-01   +2.952662593210794e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
