function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.637312763277962e-01   -7.236856915608756e-01   +1.607790355352695e-01   +1.960038730663249e-01   +4.186142624352271e-02   +1.184039896302528e-01   -2.694333384511056e-01   -5.780500822868372e-02   +4.348684483671088e-01   +6.711005130577627e-01   +4.189412418845747e-01   -2.194136320464183e-01   +6.614342601919043e-01   -2.652930756688257e-01   -3.925559298047042e-01   -4.224927482590361e-01; +4.818630336327859e-01   +6.025601495539310e-01   +1.711164252494921e-02   +2.194524192405584e-01   +2.488612692146585e-01   +5.398425454845998e-01   -4.861128667864254e-01   +1.288369834746407e-01   -5.532475242224671e-02   -1.403283450551029e-02   +3.233405364431061e-01   +2.724783332511322e-01   +6.043426093010357e-01   -1.489728763913561e-01   -9.076407417574922e-02   -1.771253986068254e-02; +3.622479975433529e-01   -3.632605386728316e-02   -4.363579723114288e-01   -1.244765205505183e-01   -2.465696859768726e-01   +6.258557515343685e-01   +7.059043109419856e-01   -4.017428337446572e-01   +1.603855852142316e-01   +2.561194355014516e-01   +1.362114908111998e-01   -2.325199543294791e-01   -1.918283099480078e-01   -4.502328426549860e-01   -1.203550495791108e-01   +7.995626235178701e-01; +4.123443231259694e-01   -1.893475849138350e-01   -1.165101149858006e-01   +4.171431442273219e-01   +1.866422291144562e-01   +7.915480186745685e-01   +7.775060247923902e-01   +2.779790908003907e-01   +2.853993068751460e-01   -8.472695378469794e-02   +1.753301056452046e-01   +2.727013390740295e-01   -3.915492862502546e-01   +5.037816795784054e-01   +2.614945878090884e-01   +7.558610841037293e-01; +6.322727429525710e-01   -9.419701636833097e-02   +8.703124543688220e-01   +1.029403291360697e-01   +4.029121337470724e-02   +2.845810333045592e-01   -1.258042417258347e-01   -2.563980060232972e-01   +2.464735672362039e-01   +3.015221334470273e-01   +8.874400751059836e-01   +2.833661816548915e-01   +1.126770565642598e-01   -2.104462616928695e-01   +1.493929408306437e-01   +2.785774340792519e-01; -3.381477247428333e-01   +5.786700560378980e-01   +9.156600494865588e-01   -1.809047338830406e-01   +5.591118213133467e-01   +1.096682010020817e-01   +3.615627926223989e-01   -1.235840134156831e-02   +3.558433393295218e-01   +3.450935360242868e-02   -1.008259903270946e-01   -1.541687548186553e-01   +1.817625844870041e-01   +7.330850844003028e-02   -2.474528912541059e-01   -2.865245593366498e-01; +4.722374004080851e-02   +3.719789183755861e-01   +3.201043269063110e-01   +1.771948138407646e-01   -3.489344253784222e-01   -2.235325292400263e-02   -1.199700260157750e-01   -3.935857601883392e-01   -6.154587535137327e-01   +3.274209787621213e-01   -1.134271996564416e-01   +1.663686908570237e-01   +4.281434466225725e-01   -2.941572771746020e-02   +6.688483764796928e-01   +1.764613745462515e-01; -3.475981336359810e-01   +7.201692290071482e-01   -7.444488631183997e-02   +6.107116628930636e-02   +1.431776542475697e-01   -6.557195101236457e-02   +5.439529095494133e-01   +1.750720762346310e-01   +3.159342749474016e-01   -1.322703296579441e-01   +1.441156503931112e-01   -1.135631173981905e-01   +2.094296473813080e-01   +1.114904346587793e-01   -2.797138872477128e-01   -1.112375858291392e-02; +1.282721049541060e-01   +6.583736431630901e-01   +1.893086207751613e-01   -2.621354958325898e-01   +3.087268721778016e-01   +5.327548718906625e-01   -2.802125589687448e-01   -4.931847555183171e-01   +5.632056228705427e-01   -1.079505196865163e-01   +4.081440146637936e-01   +1.431214533316588e-01   +8.491307923789430e-02   +3.815150530522750e-01   -2.215784009359422e-01   +6.861695505557500e-02; +5.960986592787215e-01   -6.277284671297033e-02   -7.461331309999478e-02   +4.232561278220799e-01   -1.041690780378024e-01   +4.854058946024645e-02   +3.919825816300384e-01   +7.345457812984582e-03   -3.216618769874497e-01   -4.387033418577267e-01   +6.344294196458076e-01   -1.378996738445723e-02   +5.052960737585969e-01   +2.382059397290206e-01   -1.064538803609678e-01   +1.485644542258942e-01; +4.575269786550525e-01   +7.857249797436987e-01   -1.543254095556814e-01   -4.666002723426581e-01   +2.756456049473752e-01   +3.500909760945051e-02   +3.741673060786137e-02   -3.055333404493372e-01   +3.459556253522873e-01   +3.307807823191989e-01   +1.449371059149198e-01   -1.064545281298294e-01   -4.090187302742310e-01   -4.805997709225600e-02   +1.499057546391746e-01   -2.340859931186997e-01; +4.109229750527364e-01   +1.027339490041748e-02   -5.075297771843457e-01   -2.269661266611947e-01   -2.689859908189290e-01   +2.460505012827808e-01   +7.089836816831636e-02   +9.409936406847591e-03   +1.034867896379245e-01   -7.203255520634614e-01   +3.317313273573974e-01   +2.812774158748129e-01   +6.031093260821649e-01   -4.984895550019597e-02   -1.314994202304883e-01   +3.870105645683720e-02; -5.250848005886422e-01   +2.200983485009466e-01   -1.493418219217111e-01   -1.041169914170054e-01   +6.183363735926223e-01   +5.194045659878075e-01   -2.056982678843787e-01   +2.042308974291246e-01   +2.710475808094563e-01   +8.413506681819505e-01   +1.380712680300454e-01   +1.683845246646611e-01   -2.860824907056750e-01   +1.241687735493969e-01   -3.016435195637164e-02   +4.161156930765285e-01; -6.682548968871316e-01   +4.397549403979352e-01   +1.535794094934052e-01   -7.176621181281050e-01   +4.247364586431134e-01   +2.413423725732147e-01   -4.351685041007344e-02   +1.873339777640714e-01   -7.043005221600174e-01   +5.067341023585908e-01   +6.744364780541439e-01   -9.890323180532509e-02   -3.002512736593186e-01   +5.271934516022984e-01   -6.288073810360982e-02   -5.786965042785054e-01; +3.192429080987227e-01   -2.624518677821754e-01   +3.913809545212524e-01   +3.501104770489718e-01   +2.288195640357905e-01   -8.318927098345352e-02   -9.965831415178188e-02   +4.146411235089440e-01   +8.439164527776383e-02   -2.389053922523485e-01   +3.813752021409068e-01   +1.725472309557352e-01   +6.497408336823651e-01   -1.885022647713680e-01   +2.180242699484403e-01   -1.938575844902232e-02; -7.445687806851042e-01   +2.549327965916057e-01   -4.968630984414630e-01   +6.679213552578623e-01   +6.579547420159549e-01   +6.475551441143934e-01   -3.610041535865576e-01   +8.214190850905041e-01   -5.935206610907038e-01   +2.392372980643881e-01   +3.936453496946063e-02   -1.758120768235378e-02   -1.299974711978519e-01   +3.008003840278787e-01   -5.816677380884003e-02   +3.041049012950230e-01];
L1E_L1I_iGABA_netcon = [+2.109458643102353e-02   +6.028989646699434e-01   -3.007611104695294e-01   -2.200286450990171e-01   +5.068954741918710e-01   -8.641493589854922e-02   +5.690565671096727e-01   +4.914511692812442e-01   -5.523019702138451e-01   -1.740570994671203e-01   -4.111917704934661e-01   +7.288664053987667e-01   +5.434434238134896e-01   -4.769254037119650e-01   +7.343488161874888e-01   +3.970107669954240e-01; -1.284991563613494e-01   +1.265873325448281e-01   +8.965756576192448e-01   -2.090834573499832e-01   +4.813248654185711e-01   -2.243396359140404e-01   +6.403584155773387e-01   +6.013504277311004e-01   +2.783341163610218e-01   +5.109502876140221e-01   +1.197243827142223e-01   -1.612098617648713e-01   +2.634987976480947e-01   +5.047375209816553e-01   +3.931266364060802e-01   +1.007695347682812e-01; +3.723230976053919e-01   +4.737086652442035e-01   -3.516333470818009e-01   +2.227480049504805e-01   -1.939514363326018e-01   -2.244305631050478e-01   -1.634380167875734e-01   -3.940398067324271e-01   +4.786198240877007e-01   +1.041442813197593e-01   -5.150954027585899e-01   +4.798158431465956e-01   -3.166491780364119e-01   -3.961869091544984e-01   +6.164313494324992e-01   +6.986320659158525e-02; +4.045125391157284e-01   -3.200019181411194e-01   -6.207472155912752e-01   +1.985912734423275e-01   +4.197279670388040e-02   -7.007285970406005e-02   -1.008211189562933e-01   +5.474956177392481e-03   +1.965168586235708e-01   +5.056657786090684e-01   +1.663907028936333e-01   +2.743362699812570e-01   -9.161396210391387e-02   +2.326711295108116e-01   +6.446260923468587e-01   -2.684882230661061e-01; -3.164393024777471e-03   +2.054858242915950e-01   +4.072462248904241e-01   +7.561198175718037e-02   +1.442572527467010e-01   -2.960882013212187e-01   -4.109613807149401e-01   -7.391328681880454e-01   +2.285013721478107e-01   +4.156284163701163e-02   +2.196187657147460e-01   +8.457356944894852e-01   +6.056574011934268e-01   +3.267138910372314e-02   -4.355227469999192e-01   +3.015381679067924e-01; +1.077144959130868e-01   -1.970367959829059e-01   -2.248643416024362e-01   -2.645827872082800e-01   -9.040522282825682e-02   +3.754407686204272e-01   -6.367496100412051e-02   -2.631198055851231e-01   +1.213044649539019e-01   +2.510841659373806e-02   -1.328089483848574e-01   +2.283003681151936e-01   +3.811987508253287e-01   -2.051148925691568e-02   +3.174267616060381e-01   -2.796534793007811e-01; -8.362651246926479e-01   -4.625797724193666e-01   +4.382579433984498e-03   -6.438531229647783e-01   +2.804787487281530e-01   -2.131964932255946e-01   -5.010195344527826e-01   -2.575751447749927e-01   +5.128340622338947e-01   +3.979422563239839e-01   +4.913527917614425e-01   +1.422605655143829e-01   -9.540779406279019e-02   +3.149339983843616e-01   +8.354564173231596e-01   +2.873898467431811e-01; +5.377514548282593e-01   +2.817164885471626e-01   -1.915939072818694e-01   -1.445648820537916e-01   -1.303951435728263e-01   -2.387407975319006e-01   +7.960640409305705e-01   +8.343765441162490e-03   +3.368804142458733e-01   -1.068209702614704e-01   -4.429468294831125e-03   -2.878225693410916e-01   +1.000000000000000e+00   +3.087211629156901e-01   +5.944160177946864e-01   +8.739661507989968e-01; -2.593544209499104e-02   +6.906642280319260e-01   +1.993479434363936e-01   -4.119517502297287e-01   -3.193189965875035e-01   +2.506272567142603e-01   -2.247073237868904e-01   +2.036271421194861e-01   +1.361560603316236e-01   -2.290924386457638e-01   -1.903184801135066e-01   -4.335209770225493e-01   -1.404198580527374e-01   -2.622391125622430e-02   +4.915073920266423e-01   +4.002859087968353e-01; +4.319357239541418e-01   +4.604392560808189e-01   -2.184633176926118e-01   -3.431613349275996e-01   -1.684139141305590e-01   +2.963727197133759e-01   -2.382943561656536e-01   +9.461546207983622e-02   +4.562937347316662e-01   +1.515345719869384e-02   -7.003132866322281e-01   +1.306011520718944e-01   +6.010036699860575e-01   +4.348575924609340e-02   -2.274295261709020e-01   -4.306516409219011e-02; +3.592276025807841e-01   +2.469405317072387e-02   -7.024788665370747e-02   +3.543393750336675e-01   +2.087399074844268e-01   -7.512572116156903e-02   +2.372642919403822e-01   -2.276275577075643e-01   +4.095886051297368e-01   +4.443972166199809e-01   -5.524494379458850e-01   +4.026802102633751e-01   +5.624109981820784e-01   +3.075071808408509e-01   +1.815991640551283e-01   -5.005935895567359e-01; -2.157637496845929e-01   +1.320508145786093e-01   -2.236896479392430e-02   -3.262063672093699e-01   +4.818719613273981e-01   -1.999899261368599e-01   -2.397177765339250e-01   +1.764184393856364e-01   +1.808063179609066e-02   -1.361460222700784e-01   +1.539462661992828e-01   -2.536628828490425e-01   +3.147869461128249e-01   +3.286366899665698e-01   +5.530917264740699e-01   +2.176017188917053e-02; +3.339799350759445e-01   +5.706899993866547e-02   -1.080664753842814e-01   +1.954802689650397e-01   -2.081030395455997e-01   -7.029876866271011e-02   -8.173121864411926e-03   +4.428294752494113e-02   +3.347545569986971e-01   +1.873322021121044e-01   -1.306448372403054e-01   -3.259320485471037e-01   +4.783587593790055e-01   +1.048429505713447e-01   -1.553388575150698e-02   +3.232691461920726e-01; +5.301617332025896e-01   +7.065370500502967e-02   -2.077106942141201e-01   -5.043093756731287e-02   +8.255923391335669e-02   -2.771227834020810e-01   +2.089257104666846e-01   -6.495353957138809e-02   +6.141189744231299e-01   +1.071114970405618e-01   -1.802979643682544e-01   +2.212354870763445e-01   -1.086590237367801e-01   -8.940752888551539e-03   -3.325194108222819e-01   +1.400156025469575e-01; -9.996567166481556e-02   +1.540552178327535e-01   -1.882543869279827e-01   +2.035927850297770e-01   -1.466914615992311e-01   +1.841778748014488e-01   +7.719570520384457e-02   +3.224435248995020e-01   +4.967703308271887e-01   +8.745836834577227e-02   +6.000315380250120e-01   +1.051922424642342e-01   -1.671346639185310e-01   -4.920292443193330e-01   +8.188131841322712e-01   -3.048574087439354e-02; -2.100072029804745e-01   +3.794475614739420e-01   -4.373340145929209e-01   -1.355315233919350e-01   -1.221888596180248e-01   -2.258455081195122e-01   -1.424301037227271e-01   +8.501246774213824e-03   +3.166804807542420e-01   +4.761267633534421e-02   -2.843799028925710e-01   -1.702125408803553e-01   +3.124050311140418e-01   +4.919189912250982e-01   +4.781891485815455e-02   -2.031727358731548e-02];
L2I_L1I_iGABA_netcon = [-5.713685095761727e-02   -1.311911203518132e-01   -2.341301521874790e-01   +8.369901145671658e-01   -1.474569784770028e-01   +3.837479160493711e-01   +4.741763096458164e-02   +8.676507336803212e-02; -5.974081033684016e-02   +7.660089054244654e-01   -1.156270425422646e-01   -3.901986112457903e-02   +2.694955223274312e-01   +7.272323060700470e-01   +1.863197669393781e-01   -2.218828477197173e-01; +4.495135434996013e-01   -2.665528501124342e-02   -9.551163612176147e-02   +4.691268921310907e-01   -3.127543569845080e-02   -1.792184328767717e-01   -1.149122511510905e-03   +2.425843820742194e-01; +1.421831080339530e-01   +2.162361367699711e-01   +7.045760677429871e-01   +5.858669693698881e-01   +1.902145506629931e-01   +3.161028644538645e-01   +2.623194808728353e-01   -2.771153862509040e-01; +4.473132265213189e-02   -1.634666551280600e-02   +7.438180629387385e-01   +7.879582330710788e-01   +8.924900109103465e-01   +9.806291383356688e-02   +3.708155672555721e-01   +3.888827139925950e-01; -4.382831527918928e-01   +1.672034434151991e-01   +8.635254346332634e-01   +4.627318942459716e-01   -7.613358093741615e-02   +6.062162258854404e-01   +4.390054769696495e-01   +7.093127449782655e-01; +1.326656213047296e-01   -7.937083901475428e-02   +2.529350339941947e-01   +4.974497417859015e-02   -5.589229534815408e-03   +9.072370276854576e-01   +3.145441494369827e-01   -2.139114002865394e-01; -3.647207647680886e-01   +4.180602828032630e-01   +3.630625920253501e-01   +2.684459192440515e-01   +5.927786333969323e-01   -1.868886415482723e-01   +4.955342515878435e-01   -1.205969231801156e-01; +1.708244739636264e-01   +7.895967691081838e-01   -7.791921988867047e-01   +4.841440922185458e-01   +4.544667930643403e-01   +8.433178181731272e-01   +1.917146394723598e-01   -2.161210280459435e-01; +7.223762995479997e-02   -4.514748705357821e-01   +5.232852212354996e-01   +2.866979114620889e-02   +2.227234545849098e-01   +6.414663819365298e-01   -7.872132063757509e-01   -6.111640074024326e-02; -2.280143082373914e-01   +3.574994267241876e-01   -8.889317317928469e-03   +2.729193432508423e-01   +4.638181547033507e-02   -9.991201637344697e-02   +1.657968141043842e-01   +4.329353529176969e-01; +3.304872856737552e-01   +3.479281803496712e-01   +3.210329763448238e-01   +5.304791781338997e-02   +2.188705573327278e-02   +2.802051560826871e-01   +7.014911693517332e-01   +3.187536633305337e-01; +2.096848238764663e-01   +1.785980762655197e-01   -4.127987812561045e-01   +2.140700435523986e-01   +2.166506686888441e-02   -5.406464230998128e-01   -2.050131428399416e-01   +1.525097034188746e-01; -2.629867021937514e-01   -4.349735297245835e-01   -3.216925349421393e-02   -4.210091480033085e-01   +2.644950803162374e-01   -3.948121258529599e-01   +7.290532118468662e-01   +4.508316701417816e-01; +5.415995650753456e-01   +5.883339151365700e-01   +5.416280763175921e-01   +2.630984093000779e-01   -3.560994788329427e-01   +6.944179289533986e-01   +7.927747007849653e-01   +3.098589669262448e-01; +4.048710336219476e-02   +1.890440150392911e-01   +4.846090626803148e-01   +5.920472932106939e-01   +7.098376144227231e-01   +2.526329015926081e-01   +3.405030212543415e-01   +1.914423842191743e-01];
L1I_L2I_iGABA_netcon = [+3.955362295460440e-01   -6.343023737391394e-02   -2.428501584181243e-02   +2.111778978418964e-01   +1.034984212337126e-01   +7.878855470707739e-02   -3.558427172361863e-01   -2.048579936042148e-01   -4.997755434607794e-02   +5.568518272013460e-01   +1.356190578919418e-01   -1.263870295745135e-01   -3.556606863870952e-01   -1.629859801036129e-02   -1.604999391163784e-01   +2.399999697551777e-01; +1.284340349779490e-01   -3.829442342503263e-01   -1.009045426952838e-01   +1.567069992610046e-01   -3.025006487519256e-01   -1.494211843608472e-02   +4.518925321306416e-01   +1.100217626639126e-01   +3.444283078383888e-01   +6.336083603904895e-01   +1.738979691509676e-01   -1.087197292655420e-01   +2.578266483900664e-02   -4.789665922060341e-01   +4.873938551548441e-01   +3.312326826450176e-01; +1.630577761080093e-01   -4.013786469356449e-02   -9.197681189976739e-02   +2.827913541660750e-01   -9.290091061240929e-03   -6.910540698425403e-01   +3.645547744962385e-02   -1.982580870452598e-01   -2.058611437541064e-01   +2.654250130463157e-01   -2.608124720402151e-01   -1.130771731040011e-01   -8.739803567257978e-03   +6.054394627986248e-01   +7.247004257384976e-01   +5.795685822989326e-02; +1.891657125927577e-01   +3.020265849690759e-01   +2.668671196681870e-01   -2.859356327665975e-01   +4.068499590004951e-01   +9.569574718592907e-01   +2.939064257746420e-02   +2.269961961971545e-02   +3.763971366179079e-01   +6.159371777424792e-01   +1.784674717470935e-01   +1.736936161654578e-01   +1.840095273465795e-01   +6.770676158527795e-01   +2.891373638588333e-01   +6.603204058852544e-01; -3.409953686673119e-01   -1.090593288145625e-01   +4.055978215883535e-01   +2.781289072516890e-01   -1.090131062074337e-01   +4.919664472879995e-01   +4.752054659052459e-01   +4.733308964680655e-01   +3.252418129561871e-01   +2.228746757632053e-01   -1.881446521505918e-01   +3.677261612201299e-01   -6.413854899993561e-01   +3.884310468131639e-01   +4.644477469959810e-01   +9.560325267860110e-01; -8.735163073037090e-02   +5.467089445638827e-01   -8.325949260447455e-01   +1.121469381672274e-01   +1.574363046721316e-02   -7.840230854617318e-03   +3.085256013889692e-01   +3.767127472027926e-01   +3.003486462279030e-01   +3.625252182065380e-01   +3.137044970646649e-01   -2.649658567058500e-01   +3.120592160030741e-01   +8.823282801413288e-01   +2.508264825875178e-01   +1.313526929141817e-01; +1.195505200053212e-01   +5.824377111952009e-01   -4.417176869217429e-01   +5.205021523847103e-01   +3.449018996998255e-01   -3.238590813138520e-01   +1.607959999677622e-01   -1.022243582797618e-01   -6.095062035269601e-01   -2.364070960736015e-01   +5.214032759746606e-01   +6.858918045557795e-01   -6.169364417552793e-02   +4.618938100480153e-01   -1.247226228549204e-01   +9.970799277271580e-02; +5.711746611287796e-01   +1.073552835161270e-01   +2.703890680458933e-01   -9.259653089377093e-02   +1.063074167909114e-02   +3.449339977936018e-01   -1.039482252584162e-01   -2.482372827427816e-01   +1.766144052226638e-01   +2.628766855064976e-02   +1.873872228261540e-01   +3.706180489869265e-01   -1.052797700960168e-01   +3.436451055183601e-01   -4.633695093416876e-02   +4.254267367372125e-01];
L2E_L1E_iAMPA_netcon = [+1.890474721858149e-01   -6.624738978820390e-01   +1.148663084239337e-01   +4.998772349624822e-01   +2.401881397523770e-01   +3.590084906900340e-01   +5.101807214732494e-01   -4.485142880189815e-01; -2.497959239298434e-01   +9.888496897243922e-02   -4.888093743295708e-01   +3.969214316921213e-01   +4.016727942191354e-01   +2.128297892111801e-01   +2.419220342450671e-01   +4.273929022458711e-01; +6.034354536161661e-01   +2.214198048257878e-01   -9.114881922247539e-02   +4.584899936347049e-01   -2.646305829496287e-02   -6.851720109518779e-02   +8.104422656543812e-02   +2.356790818996837e-01; +4.033758233726680e-02   -2.849849907232084e-01   -3.884124116132239e-01   +2.903079561041567e-01   +3.623754808016504e-02   -2.604354633938690e-01   -4.509489096009507e-01   -2.488782108448822e-01; +3.192023793697862e-01   +1.390388518846706e-01   +4.490523685795883e-01   -4.219460624741024e-01   +2.889107886066176e-01   -3.413115200456069e-01   +2.605386841191469e-01   +4.584186638581842e-01; +8.138140609293644e-01   -2.722001950707329e-01   -3.611336219944186e-03   +6.093557717552782e-01   +3.772345824168870e-01   +6.402457465528113e-01   +5.661891634420082e-01   +6.204665435576167e-01; -3.984630768796992e-01   +8.256048695146078e-01   -1.223108335299280e-01   -9.787373379075061e-02   -9.640808912791131e-02   +6.327590451010390e-01   +6.087033139376393e-01   -4.083158753152786e-01; -5.390058358009982e-02   +5.482143054035682e-01   +7.358657198508636e-01   -1.759508059413173e-01   +4.231711515937493e-01   +1.928867022447022e-01   +5.837136818777980e-01   -1.069575929412979e-01; -4.339227412906623e-02   +3.949491353839601e-01   +9.877547603927412e-01   +4.069735706869382e-01   -1.000000000000000e+00   +5.979871047239572e-01   +6.653510475226058e-01   -4.016750906003240e-01; -5.317890001504235e-01   +4.052570559409621e-01   +1.659096936796205e-01   +4.507742769640485e-01   -1.281364586615107e-01   -4.702292207251560e-01   -1.054248254869862e-01   -7.805463421792570e-02; -2.532914689451388e-01   +6.901759251073433e-01   +6.551621633082498e-01   +4.095409870022062e-01   +2.056541141959512e-01   +2.285664732280133e-01   -1.492768510489995e-02   +2.911287097099020e-01; +3.444491951768484e-01   -4.282070526058443e-02   +4.549689517743782e-01   +3.254286115435233e-01   -2.562563420026520e-01   +5.299479935479480e-02   -9.434084744464712e-02   -4.220635395510787e-01; -5.882148749923027e-02   +1.730266449298632e-01   +9.711634241573576e-02   +2.298734384979682e-01   +3.996451858686632e-01   -8.650018185900029e-01   +4.061755025448749e-01   -1.374457605980400e-01; +4.270754657689541e-01   +6.002872226757979e-01   +6.953879795142881e-02   +4.950906933788356e-02   +4.676931146720930e-01   +2.424695846216832e-01   -3.439952187643599e-01   +2.010747561298972e-01; +1.055528431896054e-01   +2.204357516162720e-01   +3.910712336625846e-02   -1.602405998690527e-01   +2.941143971762949e-02   -3.483813770941886e-01   -3.170910258857649e-01   -4.902176558811172e-01; -2.333062871080735e-01   +4.394339097439231e-01   -8.706496196245529e-01   -1.312973225110399e-01   -1.068001500291241e-01   +8.511914701882582e-02   +6.143994492676756e-01   -2.957938522649037e-01];
L1E_L2E_iAMPA_netcon = [+3.406551644250401e-01   +3.645215160247961e-01   +4.043583538560080e-02   -4.659173655150037e-02   +4.880540818830797e-03   +3.659084094908140e-01   +5.470723548178775e-01   +1.024725293741276e-01   +1.536075119313636e-01   -8.183914495514734e-02   +7.128933109949003e-01   -2.843023259919298e-01   -2.642501487102099e-01   -5.974286784427524e-02   +5.501644593116356e-02   -5.391787121924687e-02; +2.762172227420308e-01   -7.923518396467041e-02   +1.697406549526886e-01   -6.020847608682919e-02   +2.537624684834845e-01   +5.903718238082065e-02   +8.522890061826138e-01   +4.167870800836457e-01   +2.568712522906811e-01   +1.200256845747033e-01   +6.209180906081916e-01   +5.592023582274530e-02   +8.964614268191164e-01   +2.145606273223761e-01   +4.290943755743872e-02   -1.596296892317451e-01; +8.856641880451303e-01   -3.777132773699479e-01   +1.626753300957053e-01   +3.124582603635938e-01   +7.269438684940650e-01   +9.280140274013265e-02   +1.862244800178089e-01   -2.738629362538283e-01   +4.446689665573109e-01   -1.114376876195046e-01   -5.646532465973692e-01   +2.516956229823978e-01   -5.943704897334606e-02   +3.969346728936964e-01   +5.880404758304558e-02   +8.199165929451541e-02; +1.499633834112830e-01   -2.016055403601613e-01   -6.153122714421694e-01   +5.854292252119568e-01   -1.621729438157203e-01   +9.031650496608772e-01   +9.896435916070681e-01   -3.597072193016806e-01   +2.956882475300749e-01   +1.991016447338771e-01   +4.776955192811900e-01   -1.961603613068279e-02   -5.518735822835902e-01   +8.743723707123796e-01   +4.397016457790126e-01   -1.246690307393806e-01; -1.514668159385170e-01   -3.209311838928973e-01   +8.421353782015814e-02   +7.096082201894266e-02   +4.783635647244410e-02   -8.497386837302341e-02   +2.752416996132290e-01   +6.943502023638286e-01   +3.455636053940532e-01   -2.512796530900676e-02   +2.055838200213038e-01   -4.086025949759021e-01   -1.300404536597138e-01   -1.806914490880399e-01   +3.825608932063557e-02   -4.244133809088365e-01; -1.164104325668218e-01   +6.885837774146134e-01   +4.547006087558976e-02   +3.451179670378739e-01   -1.702949297570444e-01   -8.534578047171147e-02   +8.257296777238921e-01   +9.645977415766958e-02   +1.769836722083503e-01   +2.705489162374277e-01   +2.385552600123804e-01   +7.298727958620313e-02   -2.090512289272984e-01   +1.726577607387626e-01   -1.752198433607357e-02   +9.688503081301896e-01; -7.131958067531902e-02   +6.615986372228054e-01   +1.517696794700545e-01   -5.078085046212365e-02   +3.050793574021433e-01   -1.028207169866531e-01   +4.313100524486335e-01   -7.889276359306767e-01   -4.932131779173972e-01   +3.336159402814285e-01   -2.390218117302789e-01   -3.042299358361686e-01   -6.324205596377743e-01   +7.359166709019824e-01   +4.995255997554459e-01   +6.250287166645588e-01; +4.653096932093490e-01   +8.206292218309960e-02   -1.138242916506779e-02   +5.282043384240094e-01   +2.755384338391620e-01   +4.805214218360359e-01   -2.818919286248854e-01   +2.681411921662833e-01   -4.327333812012488e-03   +3.882260105066451e-01   -2.641219736935119e-02   +3.508172145256512e-01   -8.243495434244690e-01   -1.884369852770729e-01   +1.894261464140516e-01   +4.325058302274942e-01];
L2I_L2E_iAMPA_netcon = [+1.366539658792359e-01   +5.371453239922495e-01   +5.442809470132680e-01   +7.770732104642300e-02   +2.331971272579013e-01   +9.291421140636351e-02   +1.498513538389301e-01   +5.365882815359929e-01; +6.029141396381689e-01   +2.007007299793417e-01   +4.181201089048757e-01   +8.299565912603897e-01   +8.006239505748539e-02   +2.942144734264666e-01   +2.095729820102548e-01   +3.777710257512846e-01; +1.817479006329835e-01   +4.444724467701683e-01   -1.598190674292419e-01   +5.462648239294692e-01   +9.134145610866942e-02   +5.825704210629783e-01   +7.886523246190310e-01   -5.377477827991687e-02; +2.747039540380438e-01   +3.980886839559180e-01   -4.733534540898308e-01   -7.052412924901111e-02   +7.161919019835336e-01   +3.128512831805512e-01   +1.304017316380907e-01   +6.628808976294690e-01; +7.804460363848056e-01   +3.092444352240412e-01   -5.354728964577318e-01   +3.204013734922918e-01   +8.358091995631908e-01   -2.232093207551075e-01   +2.215051240596507e-01   -7.659993734161005e-02; +3.706500462693342e-01   +1.929437821047532e-01   -5.687558399902102e-01   +3.694321483990886e-01   -2.696563133505095e-01   +1.003808829975331e-01   +4.472316494419460e-01   -1.436728461193392e-01; +5.812134288310888e-01   -1.254530632011224e-01   +6.118325714462977e-01   +3.969391980181846e-01   +1.228183493497346e-01   +1.025879893526026e-02   +5.315126291083532e-01   -5.670539621285501e-01; +2.247015421281271e-01   +6.954319258059716e-02   -5.091821176405222e-01   +9.553667371967729e-02   -5.763271288905539e-02   -1.951648534149995e-01   -2.049082185265412e-01   +8.810728161941055e-01];
L2E_L2I_iGABA_netcon = [+3.466654324240762e-01   +7.226140497053464e-01   -1.966267778856260e-01   -3.903533940699364e-01   +1.617367790645440e-01   -4.667493702727743e-02   -6.061523401705695e-01   +5.657384379033433e-01; +1.444463872583822e-01   +5.007424445979882e-01   +2.648737513620306e-01   +7.898680361967306e-01   +4.142685376199903e-01   -1.608973349019238e-01   -6.209682489251206e-01   +6.500841909608393e-02; +1.323402713550892e-02   +7.455961673435421e-01   -4.602009595109753e-01   -5.727388718532300e-01   -1.869044544732373e-02   +7.937497762496394e-01   +3.138713310139100e-02   -3.046889307873552e-02; +7.820867071286867e-01   +2.469118411754898e-01   +1.811590164715123e-01   +8.008835933020687e-01   +6.909832720009587e-01   -2.779211871002373e-01   -4.233833384329748e-01   -1.247820232268504e-02; -4.979053831583159e-01   +1.363212265496793e-02   -2.823844566019893e-01   +2.252795404269906e-01   +6.260386127010806e-01   +3.322260205512328e-01   -3.807837516533695e-02   +5.767662651192479e-02; +6.603847074642087e-01   +2.312038993104994e-01   -6.239533558164497e-02   +2.293904754443964e-01   +6.887907929411671e-02   -7.100836262432081e-02   +4.270161777790832e-01   -5.109132395364011e-01; -6.719148740854831e-01   +9.292316678317908e-02   +1.932989219900202e-02   -7.947075154478503e-02   -2.814348901640722e-02   -2.412977031137618e-01   +1.522068513586095e-01   +7.503469479379314e-01; +2.635279468453914e-01   +2.381432848452227e-02   +5.169903611236562e-01   -1.576182693680555e-01   +7.071801459341857e-01   +1.648237877928995e-01   +4.933652388221244e-02   +7.767167557070516e-01];
L3E_L2E_iAMPA_netcon = [-2.184431845865957e-01   -2.723182292729657e-01   -4.311733952399300e-01   +1.878873477363044e-01   +9.248158819429023e-01   -3.054160461590216e-01   +9.727177157326442e-02   +8.688012001299114e-01   +3.521727024179716e-01   -6.759624254080547e-03   +4.571724261986983e-01   -6.401116484881273e-01; -3.830405619827791e-01   +2.240185100541869e-01   -2.957712246867437e-01   -5.852086587946100e-01   -4.919053114911355e-01   -7.332551418176195e-02   -7.624627672960740e-02   -1.113909477964893e-01   -1.365348793996065e-01   +5.257617650289219e-01   -3.211769606915504e-01   +4.378569986425365e-01; -4.951795916006780e-01   -1.912832396733999e-01   +6.065514087738839e-01   -1.742781356712770e-02   +2.410267673211047e-01   +1.529467791831870e-01   -2.754672969280332e-01   -2.359808318470113e-01   +6.190397503247254e-01   -4.371589368106252e-01   +7.237279516175266e-01   +2.317053746526604e-01; +6.743746988521377e-01   +5.701691284839755e-01   -3.589039509737584e-01   +8.081031363854009e-01   +9.357990606501957e-01   +4.259828662901027e-01   +5.873516093672417e-01   +5.858285047376047e-01   +1.299678479531546e-01   -1.738502122391658e-01   -2.087008569914091e-01   +2.496400620361664e-01; +7.052580236674937e-02   +6.137303359617169e-01   +1.000000000000000e+00   -1.083073028933028e-02   +5.659259287194269e-01   +7.872330700179202e-01   -4.108187755873908e-02   -1.402636036513434e-01   -5.865875776267159e-01   +2.781201588830084e-01   +2.251579712980535e-01   +1.751483401316483e-01; -1.662091210825304e-01   +3.419874922453247e-01   +5.475264515410295e-01   +4.753381994361294e-02   +7.347378219901269e-01   +5.256359716614392e-01   -2.147812485600546e-01   +1.741251082931080e-01   -2.365540645001014e-01   +3.491949721011317e-01   -2.120912345636918e-01   -4.704004192857263e-01; +4.526331159798663e-01   +4.154880853911375e-02   -1.334058757740296e-01   +1.218027723367170e-01   +4.163147133671913e-02   +4.727418395794992e-01   +2.257713531285150e-02   +2.581532581828748e-01   -1.598355093666996e-01   +6.850980922225507e-02   -1.334967674282704e-01   +8.252069255698753e-02; -2.413612032957314e-01   +4.312110137473010e-01   +1.146352126906849e-01   -3.658627823788335e-01   +5.200555005010822e-01   -5.193591394253568e-01   +9.454625937257362e-02   -4.439881581912286e-01   +3.246141407971551e-01   -1.076333002188643e-01   +6.174635034356809e-01   +2.102650117665682e-02];
L3I_L2I_iGABA_netcon = [+8.771309385427845e-01   +5.691255529419521e-01   +1.131294027768382e-01   +2.307457104979728e-01   -1.560937741226512e-01   -8.276595048046023e-02   +7.110182185323025e-01   +8.722631329301813e-01   +2.274585295395152e-01   +6.016450534415859e-01   +2.730546682032242e-02   +1.519618976660097e-01; +8.467277509876839e-02   -2.423639806456835e-01   -2.259461710020072e-01   -7.724236441005589e-05   +8.375558848289576e-03   -5.399179321483769e-02   +2.233977757997367e-01   -2.693101538675327e-02   -1.052750570468617e-01   +6.238964789665837e-02   -6.080763565428507e-02   +4.566999121561569e-01; +5.380064029711926e-02   -2.744187022930911e-02   +1.264700770648432e-01   +1.630886433546251e-01   -3.303385914208610e-01   +4.166439630927331e-01   -1.050955772192133e-01   +1.154583631674715e-01   -6.221915284605217e-02   -3.343792673490148e-01   -9.844276993336103e-02   +7.541754609915950e-01; +2.213673366440871e-01   +1.663187356450961e-01   +2.947859580556981e-01   -1.321009997673095e-01   +6.733771903733309e-02   +4.499949039408098e-01   +2.596284637592995e-01   -5.971323078551120e-02   +4.910936375671985e-01   +3.002619071344722e-01   +2.952985209765973e-01   +1.847816189553926e-01; -6.683839426747624e-02   +3.192156815822768e-01   -2.094898207062301e-02   -5.545115368906669e-01   +2.153453598395366e-01   +2.988055111788646e-01   +1.040718303202844e-01   -2.639467999486515e-01   +2.825269561684334e-01   +1.742953856821023e-01   +5.769010768939038e-03   +2.574802733902939e-01; -1.235623149816962e-01   +9.524544519076170e-02   +3.464503865897740e-01   -1.291588915046571e-01   -3.020947724836004e-02   +3.000199506722844e-01   -1.808326628427871e-01   -6.206402851790259e-02   +1.973374851410792e-01   -2.368689285786233e-01   -7.495893419740348e-01   -2.752575740851179e-01; -2.667979746044130e-03   -5.915554739239262e-02   +3.374558210142699e-01   +3.776950165930398e-01   +1.911191472326065e-02   +4.632962156599061e-01   +3.119744101924897e-01   -2.296513062042780e-01   -5.688904076673108e-02   +3.433290438294460e-01   +3.384957693456911e-01   -4.409750457923676e-01; +1.245776056090325e-01   +7.224709620703351e-02   +2.620247277402912e-01   +6.266419904894030e-02   -1.211169088990832e-01   +4.141307939017943e-01   +2.346825105989477e-01   +5.081343395746217e-01   +4.563685118279066e-01   +2.194809529916347e-01   +1.854955332703558e-01   +3.712045372141796e-01];
L2E_L3E_iAMPA_netcon = [+8.142711107100861e-01   +2.569487591671132e-01   +7.878831088453205e-02   -3.011843011804903e-01   -1.085276549032654e-01   -1.064697975233980e-02   +7.165911543916947e-01   +4.640862856616984e-01; +5.116439074626338e-01   -3.164780377573893e-01   -4.015706332295471e-01   -1.258959616378219e-02   +6.934062357881340e-01   -8.483609075800606e-01   -6.383243092538912e-01   -4.501152579924875e-01; +1.031144872593742e-01   +7.272504222458544e-02   +5.182906626531061e-01   +7.228500002365987e-02   +2.576223510790401e-01   +2.542930372795702e-01   -2.197777356139335e-01   -3.847129768420409e-01; +7.708060825614971e-01   +1.728712242632887e-01   +7.380135744149616e-01   +8.061904497250080e-01   +1.802255492691114e-01   +2.952959320953193e-01   -2.280347528697608e-01   -5.298135280867780e-01; +2.430439640561476e-03   -2.610538865576994e-01   +4.595310542073283e-01   +4.643498103027854e-01   +1.077788238280694e-01   -1.807586166172297e-01   -1.210663823915952e-01   -5.933923579895424e-01; +3.933434700262572e-01   +2.730928175260633e-01   +4.233673662736600e-02   +5.350349197940807e-01   -1.551795684417064e-01   +3.032483375840104e-01   +3.860124636389985e-01   +2.124040240408829e-01; +1.502448326058691e-01   +7.294247849855690e-01   +9.557990913757521e-01   -2.702012068631945e-01   +3.102340231158041e-01   +4.768678704765973e-01   +3.281325767630802e-01   -1.381151864690936e-01; +3.439173169965112e-01   +5.802901795370168e-01   -5.059843936899889e-01   +1.421762900032484e-01   -3.214716274842105e-01   +1.801392293199122e-02   +1.204252081999299e-02   +6.369648052826188e-01; -4.240083369966702e-01   +5.067374594143405e-01   +7.488087864051817e-01   +4.398669904137701e-01   -3.938224997909631e-01   -2.528780158113477e-01   +4.595151398075747e-01   -2.766187614661276e-01; -3.136521133031343e-01   +1.258079526714043e-02   +4.489568227868924e-01   +1.399107622332431e-01   +4.116887588756853e-01   -6.178962172561699e-01   +4.981470354783954e-01   +1.898877700584106e-02; +6.576803701641561e-01   +6.047381786294657e-01   -2.149257905949162e-02   +2.624584640265449e-01   +4.325954119683687e-01   +7.853915476540336e-01   -4.925365820624819e-01   +2.752901412248349e-02; -3.740990087933024e-02   +2.107945220494475e-01   +4.847046708097578e-01   -1.358376502718688e-01   -1.629670941345861e-01   -1.261874574293579e-01   -2.197815876934414e-02   +3.475688595522496e-01];
L2I_L3I_iGABA_netcon = [+3.457083969025443e-01   +2.751807523776389e-01   +3.145072092888596e-01   +6.041478649527572e-02   +3.163549832123358e-01   +7.942908529490406e-01   +8.926769029802457e-01   +3.421777855045985e-01; -2.244624456358436e-01   +2.901356416403103e-01   +4.443979024905206e-01   -5.505992678471777e-02   -3.181643773054674e-01   -7.784223924346154e-02   +5.090447274118000e-01   +8.095110164694999e-01; +1.950108091630389e-01   +7.097205292250427e-01   +5.632957800323303e-01   +2.594498092896011e-01   +4.900207216421300e-01   +2.794120911402585e-01   -1.229959881899050e-01   -7.185046445259047e-02; +1.053118936548642e-01   -5.206782509980173e-01   +4.130232515534636e-01   +1.529619667728089e-01   -1.812462875431358e-01   +1.192683837190133e-01   +1.575923690310397e-01   +2.745740536165898e-01; -1.180353219065536e-01   -6.500784706251553e-02   +6.735471270696716e-02   +1.903751751547207e-01   -1.964591842948787e-01   +7.630541468555821e-02   +1.229027121866267e-01   -3.028096634453135e-02; -2.357713350878467e-01   +8.984591910022904e-01   +2.342156327407195e-01   +5.207860336418206e-01   +3.882126336951459e-01   +1.715778497394778e-01   -2.516537823110923e-01   +2.385193248926058e-02; -2.094106176769031e-01   +6.362212377725787e-01   +3.942478260185604e-01   +3.598907672653482e-01   -2.311023178758537e-01   -7.759045504602879e-03   +5.376704140380809e-01   +4.723808044490608e-01; -4.232981871669739e-01   +4.950962670344496e-01   +4.916708268454667e-01   +4.119783255612350e-01   +1.009770671256091e-01   +6.531954584286874e-01   +1.952639950617242e-01   +7.643123187065569e-01; -6.850065279342399e-01   +3.049399562806236e-01   +8.652853973490823e-02   +3.547971356257552e-01   +1.996928267486721e-01   +2.964183383082251e-02   +5.457110731696067e-02   +1.674921022896493e-01; -5.505259619846330e-02   +1.276152665508886e-01   +5.148610686449138e-01   +3.236475897203813e-01   +4.438453200156977e-01   +3.241582866645407e-01   +3.661020888670676e-01   +1.381731555292240e-01; +4.582489629802775e-01   -2.305399323638274e-01   -4.784076446329457e-01   +5.287957975876320e-01   +1.543740006875458e-01   +2.628845812404018e-01   -4.969469710245340e-02   -1.387714308225786e-01; +9.446631308131463e-02   +6.254970152834562e-01   -7.089938413866784e-02   +2.262099579150344e-01   +7.013599746762099e-01   +5.140445124276855e-01   -3.317875276278143e-01   -2.810524263267407e-01];
L3I_L3E_iAMPA_netcon = [+2.245952665901456e-01   -7.572981246068730e-01   +2.530517135639367e-01   -2.474996127765618e-01   +3.414215762600538e-01   +5.407989889187788e-01   +2.051084006512521e-02   +4.565938191072028e-01   +5.066050148653739e-01   -2.614682911319326e-01   +8.926395089488477e-02   +4.760071687183138e-01; -3.087494749432220e-01   +5.572838955395700e-01   +9.169173131705133e-02   +4.901799793286943e-01   +2.043350010766813e-01   -9.400472424984627e-02   +6.064101803118735e-01   +9.820220628387641e-01   +5.443993895027550e-01   -1.182706300524279e-01   -2.453946186008856e-01   -2.926465340706161e-01; +9.501285556084643e-02   -6.877643076764001e-02   +2.204117942222496e-01   +1.242577520064586e-01   +5.999204194985812e-01   +7.126073799547326e-02   +2.418222478504585e-01   -3.050371067512611e-01   +4.765952640815492e-01   +2.769253412313304e-01   -3.070673541917510e-01   -2.974921401303441e-01; -3.183481532856192e-02   -3.630805216505857e-02   +1.011753187530480e-01   -1.574365892160238e-01   +2.297345061027593e-01   +1.779351714292281e-01   +3.384399720813438e-01   +3.534391969359177e-01   -1.099794968410671e-01   +2.163225141702290e-01   +3.768551181922322e-01   +3.952843152454213e-01; -1.975792802519907e-01   +4.813997771530776e-01   +7.230533786373663e-01   +6.430561028478308e-01   +1.908788930899602e-03   +3.304257200069664e-01   +3.531926756728827e-01   +3.351576256305200e-01   +1.300865447476749e-01   -3.740053368049983e-01   +1.579148340114361e-01   +6.036190382432048e-01; +1.252645589016634e-01   -2.318151129269396e-01   -4.299192198465688e-01   -1.738225159177151e-01   -6.579629234661741e-03   -1.696461717283067e-01   +4.863811521641578e-01   +7.367973021773949e-02   +8.287928671859043e-02   +3.882459995876630e-01   -1.983914532878707e-01   +6.999233639097117e-01; +7.769198440655978e-02   +2.163801481262036e-01   -6.244306676254828e-02   +3.393913996213812e-01   +5.921706976678993e-01   +6.631135995460845e-02   -4.069520620319604e-02   +4.959564731634036e-02   +1.014472430976529e-01   -1.128972008169220e-01   -2.394381118053295e-01   -1.217371147825948e-01; +4.371621653881340e-01   +4.188881857079252e-01   -2.094394406004671e-02   -7.363080491394068e-02   +5.910274585123934e-01   +5.656530722843953e-01   -2.196920706751038e-01   +3.211297482385318e-01   -1.183393410839714e-02   -5.351119380318209e-02   -3.159212749129199e-01   +3.506556541469472e-01; -2.241581978388638e-01   +3.746616599557829e-01   +2.439778930243408e-01   +8.517376393394083e-01   -1.391541772033072e-01   +5.111589553887258e-01   +1.577393769873771e-01   +7.829137857233037e-02   +3.993424844901968e-02   +3.079572774150038e-01   +1.098213728670587e-01   +4.306958410051612e-01; +8.793994092745158e-01   -2.415470167915881e-01   +1.389646780453390e-01   -2.104368232590345e-01   +1.327807939569020e-01   -2.910979827322961e-01   +6.368881984952800e-02   +3.436104616838754e-01   -9.150069587936119e-02   +5.786346272816430e-02   +4.978158799431681e-01   -5.159869618029210e-01; -1.008449737321829e-01   +5.969231553811256e-01   +5.134407407087722e-01   +1.540571027488835e-01   +3.535775309111180e-01   +1.172801126854282e-01   +1.944941235843327e-01   +8.082993312832601e-02   +1.216540934657967e-01   +1.494650145021180e-01   -2.335174692219283e-01   +5.632341920213140e-01; -1.516248739495423e-01   +4.917665815763290e-01   +1.033510830462444e-01   +5.410383431293819e-01   -5.142837307602688e-01   -3.915946783658701e-01   -1.894483244958512e-01   +3.401259111675365e-01   +8.618625227593393e-02   +3.756011847230438e-02   +1.230639060256054e-01   -6.667441698566939e-02];
L3E_L3I_iGABA_netcon = [+2.879109910191873e-02   +7.346133839231318e-02   +2.321659100376717e-01   +1.442160359174182e-01   +1.939175848272715e-01   +8.051659840984296e-02   -9.523859726978745e-02   +2.937293739136230e-01   -2.580136924613843e-01   +7.868043627641756e-01   +2.320158307983854e-01   +4.864124171826508e-01; +4.476995098876498e-01   -1.742442500544825e-01   +6.228821207653112e-03   +2.910159671202098e-01   +3.890755309485686e-01   -1.854859693161675e-01   +1.054115642661423e-01   +2.277540962249067e-02   -4.802731597050117e-02   +1.440285034758574e-01   -8.731011743097039e-01   +1.011332149884823e-01; +3.155462187923794e-01   -1.844992161198622e-01   -4.294020773654554e-01   -4.497097891747792e-01   -1.489403797323947e-01   +4.033772748384090e-01   +5.733815742599946e-01   -1.148527662246435e-01   +1.864556814956764e-02   -1.207039029925427e-01   -6.928445358041803e-02   +1.445760508535240e-01; +3.195473839349797e-01   -3.973192965622921e-02   +9.253056409278798e-02   +3.412756876872830e-01   +9.132343342578745e-01   -3.762313235753503e-01   -2.597843043594106e-01   +2.365135760385317e-01   +9.082689925285617e-01   +1.942547725655701e-01   +4.505613376369269e-01   -2.558181709605960e-01; +3.019957606458088e-01   +5.246316312571770e-01   -3.148651533767338e-01   +4.139352475479540e-01   +4.992581288867939e-03   +4.516587399888274e-02   +2.517533448073304e-01   +2.544227911474499e-01   +6.292907881780452e-02   +7.266915584648225e-01   +2.293791163283808e-01   -9.058915467538911e-02; +1.355813161097846e-01   +4.066616629401634e-01   -3.761721940709045e-02   -5.815761805470889e-02   +2.578214185863775e-01   -2.203457490243917e-02   +9.149382923605950e-02   +4.213574890729510e-02   +2.331300222195419e-01   -3.591985113002064e-01   +9.661894992465894e-02   -1.183091955027840e-01; -4.573189017872965e-01   +3.219164152851586e-01   +2.450142420801907e-01   +7.227801547015368e-01   +3.143794253952972e-01   +4.253168716873079e-01   +4.712255164632453e-01   +5.251014279808786e-01   -1.170915862150543e-01   +5.114784870536306e-01   +3.723080054212140e-01   +1.243321048768773e-01; -1.524026226363291e-01   +2.536597325836124e-01   +3.535607623955555e-01   -1.968759858949490e-01   +1.987554837910660e-01   -1.442949038804826e-01   -7.788184027476051e-01   +4.997085680331515e-01   -1.805041464595022e-01   -5.812967601775136e-01   +3.032788515008411e-01   +3.138689133448787e-01; +7.800868083853586e-02   -2.418786026326850e-01   +4.696767435520947e-01   -3.886784244744054e-01   +2.915282908023940e-01   -2.256280917712186e-01   -8.409762422461928e-01   +2.795878907228280e-01   +2.936909672765313e-01   +6.859526947037200e-01   -1.974571045791348e-02   +4.824635180535242e-01; +2.180595576337944e-01   -8.719650333055573e-02   +1.464623682490399e-01   -1.955107447859493e-01   -4.731455462310780e-01   +1.512111559584324e-01   -6.287358938280264e-01   +2.894454546331225e-01   +1.536665638100186e-01   -4.925932709164235e-02   +5.842687593905869e-01   +2.027226803821882e-01; -1.732690987948726e-01   -1.469433470876209e-01   +4.524611125820841e-01   -5.184613729215743e-01   -3.040020274698634e-01   -2.240467704519425e-01   +2.601195912979745e-01   -1.246840156371010e-01   +2.444922144063470e-01   -3.830165290387957e-01   -2.842542757089439e-01   +6.001809154143142e-01; +1.529259842643318e-01   -9.308329714978292e-02   -3.630842588741275e-01   -2.538354760539300e-01   +8.439863113603556e-01   -2.361007518582817e-01   +3.675581176277426e-01   +5.580879391298421e-01   -1.975927236437745e-01   -4.671671220765018e-01   +6.531529287058437e-02   -6.317134068401677e-01];
L2E_Input1_iAMPA_netcon = [+7.748499372215176e-01   +9.896093902684134e-01   +5.047206443724507e-01   -1.244850903780195e-01   +2.695843902435675e-01   -6.000504596749444e-02   +6.908616769600630e-01   +2.221684040993368e-01];
L2I_Input2_iAMPA_netcon = [+4.640543127074113e-01   +7.723836719770401e-01   -6.330432470402453e-02   +1.602466044091488e-01   +1.865049152984863e-01   +3.895912620527626e-01   -1.332177875854189e-01   -3.334098853476400e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
